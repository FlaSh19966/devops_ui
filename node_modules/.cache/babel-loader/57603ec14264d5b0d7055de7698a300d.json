{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue","mtime":1660042032563},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IHsgdHNPYmplY3RLZXl3b3JkIH0gZnJvbSAiQGJhYmVsL3R5cGVzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJBZGRUYXNrUGFnZSIsCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsXSwKICBjb21wb25lbnRzOiB7CiAgICBNdWx0aXNlbGVjdDogTXVsdGlzZWxlY3QKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpbnB1dF9saXN0OiB7CiAgICAgICAgdGFza19uYW1lOiAiIiwKICAgICAgICBpbnRlbnQ6ICIiLAogICAgICAgIGZpZWxkczogW10sCiAgICAgICAgcXVlc3Rpb246ICIiLAogICAgICAgIHF1ZXN0aW9uX2lkOiAiIgogICAgICB9LAogICAgICB0b3RhbF9wYWdlczogMSwKICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICBwYWdlX25vOiAxLAogICAgICBxdWVzdGlvbl90ZXh0OiBmYWxzZSwKICAgICAgcXVlc3Rpb25fZW50ZXJlZDogIiIsCiAgICAgIGludGVudGxpc3Q6IFtdLAogICAgICB0YXNrX2xpc3Q6IFtdLAogICAgICBvcmlnaW5hbF9pbnRlbnRfbGlzdDogW10sCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgIHF1ZXN0aW9uc19saXN0OiBbXSwKICAgICAgLy8gaGFyc2gKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgdGFza190eXBlOiAiRGVmYXVsdCIsCiAgICAgIHRhc2tfdHlwZXM6IFsiRW1haWwiLCAiU01TIiwgIkRlZmF1bHQiXSwKICAgICAgZW1haWxfdG9fdXNlcjogdHJ1ZSwKICAgICAgYWRkX2N1c3RvbXNfZW1haWw6IHRydWUsCiAgICAgIG5ld19jdXN0b21fZW1haWw6IG51bGwsCiAgICAgIGN1c3RvbV9lbWFpbHM6IFtdLAogICAgICBlbWFpbF90aXRsZTogbnVsbCwKICAgICAgZW1haWxfYm9keTogbnVsbCwKICAgICAgZW1haWxfdmFyaWFibGVzOiBbXSwKICAgICAgc21zX3RvX3VzZXI6IHRydWUsCiAgICAgIGFkZF9jdXN0b21zX251bWJlcjogdHJ1ZSwKICAgICAgbmV3X2N1c3RvbV9udW1iZXI6IG51bGwsCiAgICAgIGN1c3RvbV9udW1iZXI6IFtdLAogICAgICBzbXNfYm9keTogbnVsbCwKICAgICAgc21zX3ZhcmlibGVzOiBbXSwKICAgICAgc2VsZWN0ZWRfdGFzazogbnVsbCwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZSwKICAgICAgLy8gLS0tLQogICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIiA/IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKSA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIikgOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICB2YXJpYWJsZTogInt7bmFtZX19IiwKICAgICAgcHJldmlldzogZmFsc2UsCiAgICAgIGRlbGV0ZV90YXNrX2lkczogW10sCiAgICAgIGJvZHlfY29udGVudDogIkhpIHt7bmFtZX19LFxuICAgICAgICBZb3UgYXJlIHJlY2VpdmluZyB0aGlzIGVtYWlsIGJlY2F1c2UgeW91IChvciBzb21lb25lIGVsc2UpIGhhdmUgcmVxdWVzdGVkIHRvIHJlc2V0IHRoZSBwYXNzd29yZCBvZiB7e25hbWV9fSBhY2NvdW50LlxuICAgICAgICBQbGVhc2UgY2xpY2sgb24gdGhlIGZvbGxvd2luZyBsaW5rLCBvciBwYXN0ZSB0aGlzIGludG8geW91ciBicm93c2VyIHRvIGNvbXBsZXRlIHRoZSBwcm9jZXNzOlxuICAgICAgICBodHRwczovL2NlbnNlLmFpL2NoYW5nZS1wYXNzd29yZFxuICAgICAgICBJZiB5b3UgZGlkIG5vdCByZXF1ZXN0IHRoaXMsIHBsZWFzZSBpZ25vcmUgdGhpcyBlbWFpbCBhbmQgeW91ciBwYXNzd29yZCB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuXG5cbiAgICAgICAgUmVnYXJkcyxcbiAgICAgICAgQWRtaW4iCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMubG9hZF90YXNrKCk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiTmVyVHJhaW5pbmdQYWdlRGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQgPSB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjdGFza21vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmNsZWFyX2ZpZWxkcygpOwogICAgfSk7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgIC8vICQoJ2RpdjppbnB1dCcpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoX25hbWU6IGZ1bmN0aW9uIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRfdGFzazogZnVuY3Rpb24gYWRkX3Rhc2soKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGxvYWRfdGFzazogZnVuY3Rpb24gbG9hZF90YXNrKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpICYmIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2Ugc2VsZWN0IGEgY29tcGFueSBuYW1lIGZyb20gdGhlIGRyb3Bkb3duIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgfQoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2hvd19pbnRlbnRfdXJsKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGdldF9pbnRlbnRzOiB0cnVlLAogICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIgogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgLy8gICB0aGlzLmludGVudGxpc3QucHVzaCgKICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIikKICAgICAgICAvLyAgICk7CiAgICAgICAgLy8gfQogICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgX3RoaXMyLmludGVudGxpc3QucHVzaChyZXNwb25zZS5kYXRhW2ldKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJNQWlOIExJU1QiLCByZXNwb25zZS5kYXRhLlRhc2tzTGlzdCk7CiAgICAgICAgX3RoaXMyLnRhc2tfbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUgPT0gImRlZmF1bHQiKSB7CiAgICAgICAgICAgIHZhciBkZXNjID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgUXVlc3Rpb25JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5TbG90TmFtZSwKICAgICAgICAgICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgIF90aGlzMi50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IGRlc2MsCiAgICAgICAgICAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgICAgICAgICBUYXNrX1R5cGU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUgPT0gIkVtYWlsIikgewogICAgICAgICAgICBfdGhpczIudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgIEludGVudDogIk5vbmUiLAogICAgICAgICAgICAgIC8vIEludGVudDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uSW50ZW50LAogICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrRGV0YWlscywKICAgICAgICAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUgPT0gIlNNUyIpIHsKICAgICAgICAgICAgX3RoaXMyLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICBJbnRlbnQ6ICJOb25lIiwKICAgICAgICAgICAgICAvLyBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0RldGFpbHMsCiAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgIFRhc2tfVHlwZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldKSB7CiAgICAgICAgICAgIHZhciBfZGVzYyA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgX2Rlc2MucHVzaCh7CiAgICAgICAgICAgICAgICBRdWVzdGlvbklkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlNsb3ROYW1lLAogICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgIF90aGlzMi50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IF9kZXNjLAogICAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZQogICAgICAgICAgICAgIH0pOyAvLyBjb25zb2xlLmxvZygidGFzayBpZCIpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tJRCkKCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF90aGlzMi5vcmlnaW5hbF9pbnRlbnRfbGlzdCA9IF90aGlzMi50YXNrX2xpc3Q7IC8vIGNvbnNvbGUubG9nKHRoaXMub3JpZ2luYWxfaW50ZW50X2xpc3QpOwogICAgICAgIC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAvLyAgIGxldCBkZXNjID0gW107CiAgICAgICAgLy8gICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAvLyAgICAgZGVzYy5wdXNoKHsKICAgICAgICAvLyAgICAgICBUZXh0OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlRleHQKICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgIC8vICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAvLyAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAvLyAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgLy8gICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYywKICAgICAgICAvLyAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgLy8gICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSwKICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfQoKICAgICAgICBfdGhpczIudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCiAgICAgICAgX3RoaXMyLnNldHBhZ2luYXRpb24oX3RoaXMyLnBhZ2Vfbm8pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWRkX3F1ZXN0aW9uOiBmdW5jdGlvbiBhZGRfcXVlc3Rpb24odHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGNvdW50ID0gdGhpcy5xdWVzdGlvbnNfbGlzdC5sZW5ndGggKyAyOwogICAgICAgICAgdGhpcy5xdWVzdGlvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgVGV4dDogIiIsCiAgICAgICAgICAgIFF1ZXN0aW9uSWQ6ICJRdWVzdGlvbl9OdW1iZXJfIiArIGNvdW50ICsgIl8iICsgbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgIH0pOwogICAgICAgICAgY291bnQgPSBjb3VudCArIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgIFRleHQ6ICIiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9lbWFpbDogZnVuY3Rpb24gYWRkX2VtYWlsKHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5jdXN0b21fZW1haWxzLnB1c2godGhpcy5uZXdfY3VzdG9tX2VtYWlsKTsKICAgICAgICB0aGlzLm5ld19jdXN0b21fZW1haWwgPSBudWxsOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLmN1c3RvbV9lbWFpbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9udW1iZXI6IGZ1bmN0aW9uIGFkZF9udW1iZXIodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIgJiYgZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICB0aGlzLmN1c3RvbV9udW1iZXIucHVzaCh0aGlzLm5ld19jdXN0b21fbnVtYmVyKTsKICAgICAgICB0aGlzLm5ld19jdXN0b21fbnVtYmVyID0gbnVsbDsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5jdXN0b21fbnVtYmVyLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBpbnRlbnRfc2VsZWN0ZWRfYXBpOiBmdW5jdGlvbiBpbnRlbnRfc2VsZWN0ZWRfYXBpKCkge30sCiAgICBlZGl0X21vZGFsOiBmdW5jdGlvbiBlZGl0X21vZGFsKCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgaW5kZXggPSB0aGlzLnNlbGVjdGVkX3Rhc2s7CiAgICAgIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKICAgICAgdGhpcy5wcmV2aWV3ID0gZmFsc2U7IC8vIHRoaXMudGFza190eXBlID0gQm9vbGVhbih0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlKQogICAgICAvLyAgID8gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZQogICAgICAvLyAgIDogIkRlZmF1bHQiCiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uSW50ZW50OwogICAgICAvLyB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tOYW1lOwogICAgICAvLyB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvblswXS5UZXh0OwogICAgICAvLyB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zcGxpY2UoMCwgMSk7CiAgICAgIC8vIGZvciAodmFyIGogaW4gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24pIHsKICAgICAgLy8gICB0aGlzLnF1ZXN0aW9uc19saXN0LnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb25bal0pOwogICAgICAvLyB9CiAgICB9LAogICAgc2VsZWN0ZWRfdGFza3M6IGZ1bmN0aW9uIHNlbGVjdGVkX3Rhc2tzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0aGlzLnRhc2tfbGlzdDsKICAgICAgICB9IGVsc2UgaWYgKCFldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goaW5kZXgpOwogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHZhciB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKGluZGV4KTsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnNwbGljZSh2YWxfaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZF9lZGl0X3Rhc2tzOiBmdW5jdGlvbiBhZGRfZWRpdF90YXNrcygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAodGhpcy50YXNrX3R5cGUgPT0gIkRlZmF1bHQiKSB7CiAgICAgICAgdmFyIGVtcHR5X3F1ZXN0aW9ucyA9IHRoaXMucXVlc3Rpb25zX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChxdWVzdGlvbikgewogICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLlRleHQgPT0gIiI7CiAgICAgICAgfSk7CgogICAgICAgIGlmICh0aGlzLmVtcHR5X2ZpZWxkc19jaGVjaygpICYmICh0aGlzLnF1ZXN0aW9uc19saXN0Lmxlbmd0aCA9PSAwIHx8IGVtcHR5X3F1ZXN0aW9ucy5sZW5ndGggPT0gMCkpIHsKICAgICAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5maWVsZHMucHVzaCh7CiAgICAgICAgICAvLyAgIFRleHQ6IHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbgogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHRoaXMucXVlc3Rpb25zX2xpc3QpIHsKICAgICAgICAgIC8vICAgdGhpcy5pbnB1dF9saXN0LmZpZWxkcy5wdXNoKHRoaXMucXVlc3Rpb25zX2xpc3RbaV0pOwogICAgICAgICAgLy8gfQogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0ID09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGVkaXRfb2JqZWN0ID0ge307CiAgICAgICAgICAgIHZhciBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhID0ge307CiAgICAgICAgICAgIHZhciBpID0gMTsKICAgICAgICAgICAgdmFyIHRhc2txdWVzdGlvbiA9IFtdOwogICAgICAgICAgICB0YXNrcXVlc3Rpb24ucHVzaCh7CiAgICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgICAgVGV4dDogdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlZGl0X29iamVjdFt0aGlzLmlucHV0X2xpc3QucXVlc3Rpb25faWRdID0gdGFza3F1ZXN0aW9uWzBdOwogICAgICAgICAgICBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhW3RoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbl9pZF0gPSB7CiAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgIGZyb21fZW50aXR5OiBmYWxzZSwKICAgICAgICAgICAgICBpbnRlbnQ6IHRydWUsCiAgICAgICAgICAgICAgbm90X2ludGVudDogZmFsc2UKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvciAoaSA9IDI7IGkgPCB0aGlzLnF1ZXN0aW9uc19saXN0Lmxlbmd0aCArIDI7IGkrKykgewogICAgICAgICAgICAgIHRhc2txdWVzdGlvbi5wdXNoKHsKICAgICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgICAgVGV4dDogdGhpcy5xdWVzdGlvbnNfbGlzdFtpIC0gMl0uVGV4dAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGVkaXRfb2JqZWN0W3RoaXMucXVlc3Rpb25zX2xpc3RbaSAtIDJdLlF1ZXN0aW9uSWRdID0gdGFza3F1ZXN0aW9uW2kgLSAxXTsKICAgICAgICAgICAgICBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhW3RoaXMucXVlc3Rpb25zX2xpc3RbaSAtIDJdLlF1ZXN0aW9uSWRdID0gewogICAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IGZhbHNlLAogICAgICAgICAgICAgICAgaW50ZW50OiB0cnVlLAogICAgICAgICAgICAgICAgbm90X2ludGVudDogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCJUaGlzIGlzIHRoZSBFRElUIG9iamVjdCIsIGVkaXRfb2JqZWN0KTsKCgogICAgICAgICAgICBheGlvcy5wdXQoYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmlucHV0X2xpc3QuaW50ZW50LAogICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogZWRpdF9vYmplY3QsCiAgICAgICAgICAgICAgdGFza19pZDogdGhpcy50YXNrX2xpc3RbdGhpcy5zZWxlY3RlZF90YXNrXS5UYXNrX0lkLAogICAgICAgICAgICAgIHRhc2tfdHlwZTogIkRlZmF1bHQiIC8vIHRhc2tfZGV0YWlsczogdGhpcy5pbnB1dF9saXN0LmZpZWxkcwoKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJUYXNrIEVkaXQiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogIlRoZSBzYXZlZCBjaGFuZ2VzIHdvdWxkIGJlIHJlZmxlY3RlZCBvbmNlIHRoZSBtb2RlbCBpcyB0cmFpbmVkLiIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFZGl0ID09IGZhbHNlKSB7CiAgICAgICAgICAgIHZhciBvYmplY3QgPSB7fTsKICAgICAgICAgICAgdmFyIHNsb3RfbWFwcGluZ19kYXRhID0ge307CiAgICAgICAgICAgIHZhciBfaSA9IDE7CiAgICAgICAgICAgIHZhciB0YXNrcXVlc3Rpb24gPSBbXTsKICAgICAgICAgICAgdGFza3F1ZXN0aW9uLnB1c2goewogICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgIFRleHQ6IHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHVuaXF1ZV9rZXkgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgICAgb2JqZWN0WyJRdWVzdGlvbl9OdW1iZXJfMSIgKyAiXyIgKyB1bmlxdWVfa2V5XSA9IHRhc2txdWVzdGlvblswXTsKICAgICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGFbIlF1ZXN0aW9uX051bWJlcl8xIiArICJfIiArIHVuaXF1ZV9rZXldID0gewogICAgICAgICAgICAgIGZyb21fdGV4dDogdHJ1ZSwKICAgICAgICAgICAgICBmcm9tX2VudGl0eTogZmFsc2UsCiAgICAgICAgICAgICAgaW50ZW50OiB0cnVlLAogICAgICAgICAgICAgIG5vdF9pbnRlbnQ6IGZhbHNlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmb3IgKF9pID0gMjsgX2kgPCB0aGlzLnF1ZXN0aW9uc19saXN0Lmxlbmd0aCArIDI7IF9pKyspIHsKICAgICAgICAgICAgICB0YXNrcXVlc3Rpb24ucHVzaCh7CiAgICAgICAgICAgICAgICBUeXBlOiAiQXNrIiwKICAgICAgICAgICAgICAgIFRleHQ6IHRoaXMucXVlc3Rpb25zX2xpc3RbX2kgLSAyXS5UZXh0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIHVuaXF1ZV9rZXlfMiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgIG9iamVjdFsiUXVlc3Rpb25fTnVtYmVyXyIgKyBfaSArICJfIiArIHVuaXF1ZV9rZXlfMl0gPSB0YXNrcXVlc3Rpb25bX2kgLSAxXTsKICAgICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YVsiUXVlc3Rpb25fTnVtYmVyXyIgKyBfaSArICJfIiArIHVuaXF1ZV9rZXlfMl0gPSB7CiAgICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgICBmcm9tX2VudGl0eTogZmFsc2UsCiAgICAgICAgICAgICAgICBpbnRlbnQ6IHRydWUsCiAgICAgICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coIlRoaXMgaXMgdGhlIG9iamVjdCIsIG9iamVjdCk7CgoKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGFza19saXN0X3VybCgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQsCiAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgLy8gdGFza19kZXRhaWxzOiB0aGlzLmlucHV0X2xpc3QuZmllbGRzLAogICAgICAgICAgICAgIHNsb3RfbWFwcGluZ19kYXRhOiBzbG90X21hcHBpbmdfZGF0YSwKICAgICAgICAgICAgICB0YXNrX25hbWU6IHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJUYXNrIEFkZGVkIikgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFzayBoYXMgYmVlbiBhZGRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICBfdGhpczMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX3R5cGUgPT0gIkVtYWlsIikgewogICAgICAgIHZhciBvYmplY3QgPSB7fTsKICAgICAgICB2YXIgYWxsb2sgPSB0cnVlOwoKICAgICAgICBpZiAodGhpcy5lbWFpbF90aXRsZSA9PSBudWxsIHx8IHRoaXMuZW1haWxfdGl0bGUgPT0gIiIgfHwgdGhpcy5lbWFpbF9ib2R5ID09IG51bGwgfHwgdGhpcy5lbWFpbF9ib2R5ID09ICIiKSB7CiAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgIH0gLy8gaWYodGhpcy5hZGRfY3VzdG9tc19lbWFpbCYmdGhpcy5jdXN0b21fZW1haWxzLmxlbmd0aD09MCl7CiAgICAgICAgLy8gICBhbGxvayA9IGZhbHNlOwogICAgICAgIC8vIH0KCgogICAgICAgIGlmICh0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID09ICIiKSB7CiAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuZW1haWxfdmFyaWFibGVzW19pMl0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiIgfHwgdGhpcy5lbWFpbF92YXJpYWJsZXNbX2kyXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSBudWxsIHx8IHRoaXMuZW1haWxfdmFyaWFibGVzW19pMl0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiAiKSB7CiAgICAgICAgICAgICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFsbG9rKSB7CiAgICAgICAgICBvYmplY3RbInN1YmplY3QiXSA9IHRoaXMuZW1haWxfdGl0bGU7CiAgICAgICAgICBvYmplY3RbImJvZHkiXSA9IHRoaXMuZW1haWxfYm9keTsKICAgICAgICAgIG9iamVjdFsidXNlcl9lbWFpbCJdID0gdGhpcy5lbWFpbF90b191c2VyOwogICAgICAgICAgb2JqZWN0WyJjdXN0b21fZW1haWxzIl0gPSB0aGlzLmN1c3RvbV9lbWFpbHM7CiAgICAgICAgICBvYmplY3RbImVtYWlsX3ZhcmlhYmxlcyJdID0gdGhpcy5lbWFpbF92YXJpYWJsZXM7CgogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0ID09IGZhbHNlKSB7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm9wZW5fZm9ybV90YXNrcygpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQsCiAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgIHRhc2tfdHlwZTogIkVtYWlsIiwKICAgICAgICAgICAgICB0YXNrX2RldGFpbHM6IG9iamVjdAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPSAiVGFzayBBZGRlZCIpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhc2sgaGFzIGJlZW4gYWRkZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgX3RoaXMzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFZGl0ID09IHRydWUpIHsKICAgICAgICAgICAgYXhpb3MucHV0KGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmlucHV0X2xpc3QuaW50ZW50LAogICAgICAgICAgICAgIHRhc2tfbmFtZTogdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSwKICAgICAgICAgICAgICB0YXNrX3R5cGU6ICJFbWFpbCIsCiAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgdGFza19pZDogdGhpcy50YXNrX2xpc3RbdGhpcy5zZWxlY3RlZF90YXNrXS5UYXNrX0lkCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9ICJUYXNrIEVkaXQiKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGVkaXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICBfdGhpczMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCBmaWVsZHMuIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMudGFza190eXBlID09ICJTTVMiKSB7CiAgICAgICAgdmFyIG9iamVjdCA9IHt9OwogICAgICAgIHZhciBhbGxvayA9IHRydWU7CgogICAgICAgIGlmICh0aGlzLnNtc19ib2R5ID09IG51bGwgfHwgdGhpcy5zbXNfYm9keSA9PSAiIikgewogICAgICAgICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICB9IC8vIGlmKHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyJiZ0aGlzLmN1c3RvbV9udW1iZXIubGVuZ3RoPT0wKXsKICAgICAgICAvLyAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgLy8gfQoKCiAgICAgICAgaWYgKHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5zbXNfdmFyaWJsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgdGhpcy5zbXNfdmFyaWJsZXMubGVuZ3RoOyBfaTMrKykgewogICAgICAgICAgICBpZiAodGhpcy5zbXNfdmFyaWJsZXNbX2kzXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSAiIiB8fCB0aGlzLnNtc192YXJpYmxlc1tfaTNdLnZhcmlhYmxlX2Rlc2NyaXB0aW9uID09IG51bGwgfHwgdGhpcy5zbXNfdmFyaWJsZXNbX2kzXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSAiICIpIHsKICAgICAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYWxsb2spIHsKICAgICAgICAgIG9iamVjdFsiYm9keSJdID0gdGhpcy5zbXNfYm9keTsKICAgICAgICAgIG9iamVjdFsidXNlcl9udW1iZXIiXSA9IHRoaXMuc21zX3RvX3VzZXI7CiAgICAgICAgICBvYmplY3RbImN1c3RvbV9udW1iZXJzIl0gPSB0aGlzLmN1c3RvbV9udW1iZXI7CiAgICAgICAgICBvYmplY3RbInNtc192YXJpYWJsZXMiXSA9IHRoaXMuc21zX3ZhcmlibGVzOwoKICAgICAgICAgIGlmICh0aGlzLmlzRWRpdCA9PSBmYWxzZSkgewogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgIHRhc2tfdHlwZTogIlNNUyIsCiAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID0gIlRhc2sgQWRkZWQiKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIF90aGlzMy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRWRpdCA9PSB0cnVlKSB7CiAgICAgICAgICAgIGF4aW9zLnB1dChhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIHRhc2tfbmFtZTogdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSwKICAgICAgICAgICAgICB0YXNrX3R5cGU6ICJTTVMiLAogICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogb2JqZWN0LAogICAgICAgICAgICAgIHRhc2tfaWQ6IHRoaXMudGFza19saXN0W3RoaXMuc2VsZWN0ZWRfdGFza10uVGFza19JZAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPSAiVGFzayBFZGl0IikgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFzayBoYXMgYmVlbiBlZGl0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgX3RoaXMzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3NlbGVjdGVkOiBmdW5jdGlvbiBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIk5vIHRhc2sgc2VsZWN0ZWQhIiwKICAgICAgICAgIHRleHQ6ICIiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kZWxldGVfdGFza19pZHMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2RlbGV0ZSB0YXNrJyk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhpLlRhc2tfSWQpOwogICAgICAgICAgdGhpcy5kZWxldGVfdGFza19pZHMucHVzaCh0aGlzLnRhc2tfbGlzdFt0aGlzLmNoZWNrZWRfbGlzdFtpXV0uVGFza19JZCk7CiAgICAgICAgfSAvLyBjb25zb2xlLmxvZyh0aGlzLmRlbGV0ZV90YXNrX2lkcyk7CgoKICAgICAgICB0aGlzLmRlbGV0ZV90YXNrc19hcGkoKTsgLy8gbGV0IHF1ZXN0aW9ubGlzdCA9IFtdLGRlbGV0ZV90YXNrX2lkcwogICAgICAgIC8vICAgcmVzcG9uc2VsaXN0ID0gW10sCiAgICAgICAgLy8gICBpbnRlbnRsaXN0ID0gW10sCiAgICAgICAgLy8gICBzb3VyY2VsaXN0ID0gW107CiAgICAgICAgLy8gZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgIC8vICAgcXVlc3Rpb25saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucXVlc3Rpb24pOwogICAgICAgIC8vICAgcmVzcG9uc2VsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucmVzcG9uc2UpOwogICAgICAgIC8vICAgc291cmNlbGlzdC5wdXNoKHRoaXMuY2hlY2tlZF9saXN0W2ldLnNvdXJjZSk7CiAgICAgICAgLy8gICBpbnRlbnRsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0uaW50ZW50KTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gdGhpcy5kZWxldGVfdGFza3NfYXBpKHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0LCBpbnRlbnRsaXN0KTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9zaW5nbGU6IGZ1bmN0aW9uIGRlbGV0ZV9zaW5nbGUoaW5kZXgpIHsKICAgICAgLy8gbGV0IGludGVudHMgPSBbXTsKICAgICAgLy8gaW50ZW50cy5wdXNoKHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQpOwogICAgICAvLyBjb25zb2xlLmxvZyhpbmRleCk7CiAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzID0gW107CiAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzLnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfSWQpOyAvLyBjb25zb2xlLmxvZyh0aGlzLmRlbGV0ZV90YXNrX2lkcyk7CgogICAgICB0aGlzLmRlbGV0ZV90YXNrc19hcGkoKTsgLy8gY29uc29sZS5sb2coImRlbGV0ZSBzaW5nbGUiKQogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19JZCkKICAgIH0sCiAgICBkZWxldGVfdGFza3NfYXBpOiBmdW5jdGlvbiBkZWxldGVfdGFza3NfYXBpKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUgaXQhIgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLmRlbGV0ZShhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksIHsKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgdGFza19pZHM6IF90aGlzNC5kZWxldGVfdGFza19pZHMKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczQuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkZhaWx1cmUiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJGYWlsZWQgdG8gZGVsZXRlIHRhc2suIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIlRhc2sgd2FzIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIF90aGlzNC5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsgLy8gYXhpb3MKICAgICAgICAgIC8vICAgLmRlbGV0ZShhcGlfY2FsbHMudGFza19saXN0X3VybCgpLCB7CiAgICAgICAgICAvLyAgICAgZGF0YTogewogICAgICAgICAgLy8gICAgICAgaW50ZW50czogaW50ZW50cywKICAgICAgICAgIC8vICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIC8vICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIC8vICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbgogICAgICAgICAgLy8gICAgIH0KICAgICAgICAgIC8vICAgfSwgewogICAgICAgICAgLy8gICBoZWFkZXJzOiB7CiAgICAgICAgICAvLyAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAvLyAgIH0sCiAgICAgICAgICAvLyB9KQogICAgICAgICAgLy8gICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlRhc2socykgRGVsZXRlZCIpIHsKICAgICAgICAgIC8vICAgICAgIFN3YWwuZmlyZSgKICAgICAgICAgIC8vICAgICAgICAgIkRlbGV0ZWQhIiwKICAgICAgICAgIC8vICAgICAgICAgIllvdXIgdGFzayhzKSBoYXZlIGJlZW4gZGVsZXRlZC4iLAogICAgICAgICAgLy8gICAgICAgICAic3VjY2VzcyIKICAgICAgICAgIC8vICAgICAgICk7CiAgICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIC8vICAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAvLyAgICAgICB9LCAyNTAwKTsKICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAvLyAgIH0pCiAgICAgICAgICAvLyAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIC8vICAgICBpZiAoCiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAvLyAgICAgKSB7CiAgICAgICAgICAvLyAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgLy8gICAgIH0KICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlbXB0eV9maWVsZHNfY2hlY2s6IGZ1bmN0aW9uIGVtcHR5X2ZpZWxkc19jaGVjaygpIHsKICAgICAgaWYgKHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPT0gIiIgfHwgdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9PSAiIiB8fCB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIGZpZWxkcyIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gZm9yICh2YXIgaSBpbiB0aGlzLmlucHV0X2xpc3QuZmllbGRzKSB7CiAgICAgICAgLy8gICBpZiAoCiAgICAgICAgLy8gICAgIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPT0gIiIgfHwKICAgICAgICAvLyAgICAgdGhpcy5pbnB1dF9saXN0LmludGVudCA9PSAiIiB8fAogICAgICAgIC8vICAgICB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPT0gIiIKICAgICAgICAvLyAgICkgewogICAgICAgIC8vICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIGZpZWxkcyIpOwogICAgICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgLy8gICB9IGVsc2UgaWYgKHRoaXMuaW5wdXRfbGlzdC5maWVsZHNbaV0udmFsdWUgPT0gIiIpIHsKICAgICAgICAvLyAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSBmaWVsZHMiKTsKICAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vICAgfSBlbHNlIGlmICgKICAgICAgICAvLyAgICAgaSA9PSB0aGlzLmlucHV0X2xpc3QuZmllbGRzLmxlbmd0aCAtIDEgJiYKICAgICAgICAvLyAgICAgdGhpcy5pbnB1dF9saXN0LmZpZWxkc1tpXS52YWx1ZSAhPSAiIgogICAgICAgIC8vICAgKSB7CiAgICAgICAgLy8gICAgIHJldHVybiB0cnVlOwogICAgICAgIC8vICAgfQogICAgICAgIC8vIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyX2ZpZWxkczogZnVuY3Rpb24gY2xlYXJfZmllbGRzKCkgewogICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID0gIiI7CiAgICAgIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSAiIjsKICAgICAgdGhpcy5pbnB1dF9saXN0LmZpZWxkcyA9IFtdOwogICAgICB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSAiIjsKICAgICAgdGhpcy5xdWVzdGlvbnNfbGlzdCA9IFtdOwogICAgICB0aGlzLmlzRWRpdCA9IGZhbHNlOwogICAgICB0aGlzLnByZXZpZXcgPSBmYWxzZTsKICAgICAgdGhpcy5xdWVzdGlvbl90ZXh0ID0gZmFsc2U7CiAgICAgIHRoaXMudGFza19saXN0W3RoaXMuc2VsZWN0ZWRfdGFza10gPSB0aGlzLm9yaWdpbmFsX2ludGVudF9saXN0W3RoaXMuc2VsZWN0ZWRfdGFza107CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgdGhpcy5zZWFyY2hfcHJvZHVjdCgpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX3Byb2R1Y3Q6IGZ1bmN0aW9uIHNlYXJjaF9wcm9kdWN0KCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIC8vIGlmKHRoaXMuc2VhcmNoX2J5IT0nJyl7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAvLyBzZWFyY2hieTogdGhpcy5zZWFyY2hfYnksCiAgICAgICAgICBrZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5wYWdlY291bnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIF90aGlzNS5wYWdlX25vID0gMTsKICAgICAgICAgICAgX3RoaXM1LnRhc2tfbGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczUub3JpZ2luYWxfaW50ZW50X2xpc3QgPSByZXNwb25zZS5kYXRhLlRhc2tzTGlzdDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgICB2YXIgZGVzYyA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgICAgX3RoaXM1LnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczUudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCiAgICAgICAgICAgIF90aGlzNS5zZXRwYWdpbmF0aW9uKF90aGlzNS5wYWdlX25vKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFRhc2tzIEZvdW5kIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIk5vIFRhc2sgRm91bmQiKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgX3RoaXM1LmxvYWRfdGFzaygpOwogICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgX3RoaXM1LmxvYWRfdGFzaygpOwogICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIkVudGVyIHByb3BlciBkYXRhIGZvciBzZWFyY2hpbmciKTsKICAgICAgfSAvLyB9ZWxzZXsKICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlNlbGVjdCBoZWFkZXIgZm9yIHNlYXJjaGluZyIpOwogICAgICAvLyB9CgogICAgfSwKICAgIHBhZ2VfcmVxdWlyZTogZnVuY3Rpb24gcGFnZV9yZXF1aXJlKHBhZ2UpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50YXNrX2xpc3RfdXJsKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM2LnRhc2tfbGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczYub3JpZ2luYWxfaW50ZW50X2xpc3QgPSByZXNwb25zZS5kYXRhLlRhc2tzTGlzdDsKCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgICB2YXIgZGVzYyA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgICAgX3RoaXM2LnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczYudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCiAgICAgICAgICAgIF90aGlzNi5zZXRwYWdpbmF0aW9uKF90aGlzNi5wYWdlX25vKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBpZiAocGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZW5vOwogICAgICAgICAgfQoKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAgIC8vIHNlYXJjaGJ5OiB0aGlzLnNlYXJjaF9ieSwKICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogcGFnZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnZWNvdW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIF90aGlzNi5wYWdlX25vID0gcGFnZTsKICAgICAgICAgICAgICBfdGhpczYudGFza19saXN0ID0gW107CiAgICAgICAgICAgICAgX3RoaXM2Lm9yaWdpbmFsX2ludGVudF9saXN0ID0gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3Q7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgICAgIHZhciBkZXNjID0gW107CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgVGFza05hbWU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tOYW1lLAogICAgICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IGRlc2MKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczYudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCiAgICAgICAgICAgICAgX3RoaXM2LnNldHBhZ2luYXRpb24oX3RoaXM2LnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgX3RoaXM2LmxvYWRfdGFzaygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCA0OyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTUgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTUrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k1ICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pNiA9IDA7IF9pNiA8IHBhZ2Vfbm8gKyAzOyBfaTYrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k2ICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTcgPSBwYWdlX25vIC0gNDsgX2k3IDwgdGhpcy50b3RhbF9wYWdlczsgX2k3KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNyArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTggPSBwYWdlX25vIC0gMzsgX2k4IDw9IHBhZ2Vfbm8gKyAzOyBfaTgrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k4KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX21zZ190b191c2VyOiBmdW5jdGlvbiBzZW5kX21zZ190b191c2VyKCkgewogICAgICBpZiAodGhpcy5hZGRfY3VzdG9tc19lbWFpbCB8fCAhdGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiAhdGhpcy5lbWFpbF90b191c2VyKSB7CiAgICAgICAgdGhpcy5lbWFpbF90b191c2VyID0gIXRoaXMuZW1haWxfdG9fdXNlcjsKICAgICAgfSBlbHNlIGlmICghdGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiB0aGlzLmVtYWlsX3RvX3VzZXIpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHNlbGVjdCBhdGxlYXN0IG9uZSB0eXBlIG9mIHJlY2lwaWVudCIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9tc2dfdG9fY3VzdG9tX3VzZXI6IGZ1bmN0aW9uIHNlbmRfbXNnX3RvX2N1c3RvbV91c2VyKCkgewogICAgICBpZiAodGhpcy5lbWFpbF90b191c2VyIHx8ICF0aGlzLmFkZF9jdXN0b21zX2VtYWlsICYmICF0aGlzLmVtYWlsX3RvX3VzZXIpIHsKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX2VtYWlsID0gIXRoaXMuYWRkX2N1c3RvbXNfZW1haWw7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiAhdGhpcy5lbWFpbF90b191c2VyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdHlwZSBvZiByZWNpcGllbnQiKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfc21zX3RvX3VzZXI6IGZ1bmN0aW9uIHNlbmRfc21zX3RvX3VzZXIoKSB7CiAgICAgIGlmICh0aGlzLmFkZF9jdXN0b21zX251bWJlciB8fCAhdGhpcy5hZGRfY3VzdG9tc19udW1iZXIgJiYgIXRoaXMuc21zX3RvX3VzZXIpIHsKICAgICAgICB0aGlzLnNtc190b191c2VyID0gIXRoaXMuc21zX3RvX3VzZXI7CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyICYmIHRoaXMuc21zX3RvX3VzZXIpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHNlbGVjdCBhdGxlYXN0IG9uZSB0eXBlIG9mIHJlY2lwaWVudCIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9zbXNfdG9fY3VzdG9tX3VzZXI6IGZ1bmN0aW9uIHNlbmRfc21zX3RvX2N1c3RvbV91c2VyKCkgewogICAgICBpZiAodGhpcy5zbXNfdG9fdXNlciB8fCAhdGhpcy5hZGRfY3VzdG9tc19udW1iZXIgJiYgIXRoaXMuc21zX3RvX3VzZXIpIHsKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX251bWJlciA9ICF0aGlzLmFkZF9jdXN0b21zX251bWJlcjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmFkZF9jdXN0b21zX251bWJlciAmJiAhdGhpcy5zbXNfdG9fdXNlcikgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGF0bGVhc3Qgb25lIHR5cGUgb2YgcmVjaXBpZW50Iik7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja2ZvcmVtYWlsdmFyaWFibGVzOiBmdW5jdGlvbiBjaGVja2ZvcmVtYWlsdmFyaWFibGVzKCkgewogICAgICB2YXIgYXJyU3RyMSA9IHRoaXMuZW1haWxfYm9keS5zcGxpdCgie3siKTsKICAgICAgdmFyIGFyclN0cjIgPSBbXTsKICAgICAgdmFyIG5ld192YXJfbGlzdCA9IFtdOwogICAgICB2YXIgbmV3X3Zhcl9hY3Rpb24gPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJyU3RyMS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChhcnJTdHIxW2ldLmluY2x1ZGVzKCJ9fSIpKSB7CiAgICAgICAgICBhcnJTdHIyLnB1c2goYXJyU3RyMVtpXS5zcGxpdCgifX0iKVswXSk7CgogICAgICAgICAgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pID09IC0xKSB7CiAgICAgICAgICAgIG5ld192YXJfbGlzdC5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwogICAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJhZGQiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIF9pOSA9IDA7IF9pOSA8IHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aDsgX2k5KyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9saXN0LmluZGV4T2YodGhpcy5lbWFpbF92YXJpYWJsZXNbX2k5XS52YXJpYWJsZV9uYW1lKSA+IC0xKSB7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvbltuZXdfdmFyX2xpc3QuaW5kZXhPZih0aGlzLmVtYWlsX3ZhcmlhYmxlc1tfaTldLnZhcmlhYmxlX25hbWUpXSA9ICJrZWVwIjsKICAgICAgICB9IGVsc2UgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuZW1haWxfdmFyaWFibGVzW19pOV0udmFyaWFibGVfbmFtZSkgPT0gLTEpIHsKICAgICAgICAgIG5ld192YXJfbGlzdC5wdXNoKHRoaXMuZW1haWxfdmFyaWFibGVzW19pOV0udmFyaWFibGVfbmFtZSk7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJyZW1vdmUiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIF9pMTAgPSAwOyBfaTEwIDwgbmV3X3Zhcl9saXN0Lmxlbmd0aDsgX2kxMCsrKSB7CiAgICAgICAgaWYgKG5ld192YXJfYWN0aW9uW19pMTBdID09ICJhZGQiKSB7CiAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5wdXNoKHsKICAgICAgICAgICAgdmFyaWFibGVfbmFtZTogbmV3X3Zhcl9saXN0W19pMTBdLAogICAgICAgICAgICB2YXJpYWJsZV9kZXNjcmlwdGlvbjogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChuZXdfdmFyX2FjdGlvbltfaTEwXSA9PSAicmVtb3ZlIikgewogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAodGhpcy5lbWFpbF92YXJpYWJsZXNbal0udmFyaWFibGVfbmFtZSA9PSBuZXdfdmFyX2xpc3RbX2kxMF0pIHsKICAgICAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjaGVja2ZvcnNtc3ZhcmlhYmxlczogZnVuY3Rpb24gY2hlY2tmb3JzbXN2YXJpYWJsZXMoKSB7CiAgICAgIC8vIHNtc192YXJpYmxlcwogICAgICB2YXIgYXJyU3RyMSA9IHRoaXMuc21zX2JvZHkuc3BsaXQoInt7Iik7CiAgICAgIHZhciBhcnJTdHIyID0gW107CiAgICAgIHZhciBuZXdfdmFyX2xpc3QgPSBbXTsKICAgICAgdmFyIG5ld192YXJfYWN0aW9uID0gW107CgogICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyclN0cjEubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJyU3RyMVtpXS5pbmNsdWRlcygifX0iKSkgewogICAgICAgICAgYXJyU3RyMi5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwoKICAgICAgICAgIGlmIChuZXdfdmFyX2xpc3QuaW5kZXhPZihhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKSA9PSAtMSkgewogICAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaChhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKTsKICAgICAgICAgICAgbmV3X3Zhcl9hY3Rpb24ucHVzaCgiYWRkIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHZhciBfaTExID0gMDsgX2kxMSA8IHRoaXMuc21zX3ZhcmlibGVzLmxlbmd0aDsgX2kxMSsrKSB7CiAgICAgICAgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuc21zX3ZhcmlibGVzW19pMTFdLnZhcmlhYmxlX25hbWUpID4gLTEpIHsKICAgICAgICAgIG5ld192YXJfYWN0aW9uW25ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuc21zX3ZhcmlibGVzW19pMTFdLnZhcmlhYmxlX25hbWUpXSA9ICJrZWVwIjsKICAgICAgICB9IGVsc2UgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuc21zX3ZhcmlibGVzW19pMTFdLnZhcmlhYmxlX25hbWUpID09IC0xKSB7CiAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaCh0aGlzLnNtc192YXJpYmxlc1tfaTExXS52YXJpYWJsZV9uYW1lKTsKICAgICAgICAgIG5ld192YXJfYWN0aW9uLnB1c2goInJlbW92ZSIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgX2kxMiA9IDA7IF9pMTIgPCBuZXdfdmFyX2xpc3QubGVuZ3RoOyBfaTEyKyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9hY3Rpb25bX2kxMl0gPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuc21zX3ZhcmlibGVzLnB1c2goewogICAgICAgICAgICB2YXJpYWJsZV9uYW1lOiBuZXdfdmFyX2xpc3RbX2kxMl0sCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiBudWxsCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKG5ld192YXJfYWN0aW9uW19pMTJdID09ICJyZW1vdmUiKSB7CiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuc21zX3ZhcmlibGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNtc192YXJpYmxlc1tqXS52YXJpYWJsZV9uYW1lID09IG5ld192YXJfbGlzdFtfaTEyXSkgewogICAgICAgICAgICAgIHRoaXMuc21zX3ZhcmlibGVzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5wcmV2aWV3OiBmdW5jdGlvbiBvcGVucHJldmlldyhpbmRleCkgewogICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy50YXNrX3R5cGUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlOyAvLyB0aGlzLnByZXZpZXcgPSB0cnVlOwoKICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlOwogICAgICB0aGlzLnByZXZpZXcgPSBmYWxzZTsKICAgICAgdGhpcy5zZWxlY3RlZF90YXNrID0gaW5kZXg7CiAgICAgIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza05hbWU7CgogICAgICBpZiAodGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSA9PSAiZGVmYXVsdCIgfHwgIUJvb2xlYW4odGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSkpIHsKICAgICAgICB0aGlzLnRhc2tfdHlwZSA9ICJEZWZhdWx0IjsKICAgICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLkludGVudDsKICAgICAgICB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvblswXS5UZXh0OwogICAgICAgIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbl9pZCA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uWzBdLlF1ZXN0aW9uSWQ7CgogICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbltqXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGUgPT0gIkVtYWlsIikgewogICAgICAgIC8vIHRoaXMuY3VzdG9tX2VtYWlscyA9IHRoaXMuZ2V0ZGF0YXNvYnModGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uY3VzdG9tX2VtYWlscyk7CiAgICAgICAgLy8gdGhpcy5jdXN0b21fZW1haWxzID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uY3VzdG9tX2VtYWlsczsKICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmN1c3RvbV9lbWFpbHMpOwogICAgICAgIHRoaXMuY3VzdG9tX2VtYWlscyA9IFtdOwoKICAgICAgICBmb3IgKHZhciBfaTEzID0gMDsgX2kxMyA8IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHMubGVuZ3RoOyBfaTEzKyspIHsKICAgICAgICAgIHRoaXMuY3VzdG9tX2VtYWlscy5wdXNoKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHNbX2kxM10pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5lbWFpbF90aXRsZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnN1YmplY3Q7CiAgICAgICAgdGhpcy5lbWFpbF9ib2R5ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uYm9keTsKICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcyA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmVtYWlsX3ZhcmlhYmxlcykgewogICAgICAgICAgdGhpcy5lbWFpbF92YXJpYWJsZXMucHVzaCh7CiAgICAgICAgICAgIHZhcmlhYmxlX25hbWU6IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9uYW1lLAogICAgICAgICAgICB2YXJpYWJsZV9kZXNjcmlwdGlvbjogdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSA9PSAiU01TIikgewogICAgICAgIHRoaXMuY3VzdG9tX251bWJlciA9IFtdOwoKICAgICAgICBmb3IgKHZhciBfaTE0ID0gMDsgX2kxNCA8IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9udW1iZXJzLmxlbmd0aDsgX2kxNCsrKSB7CiAgICAgICAgICB0aGlzLmN1c3RvbV9udW1iZXIucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5jdXN0b21fbnVtYmVyc1tfaTE0XSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNtc19ib2R5ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uYm9keTsKICAgICAgICB0aGlzLnNtc192YXJpYmxlcyA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnNtc192YXJpYWJsZXMpIHsKICAgICAgICAgIHRoaXMuc21zX3ZhcmlibGVzLnB1c2goewogICAgICAgICAgICB2YXJpYWJsZV9uYW1lOiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zbXNfdmFyaWFibGVzW2ldLnZhcmlhYmxlX25hbWUsCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zbXNfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gLy8gdGhpcy5pc0VkaXQgPSB0cnVlOwogICAgICAvLyB0aGlzLnRhc2tfdHlwZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGU7CiAgICAgIC8vIHRoaXMucHJldmlldyA9IHRydWU7CiAgICAgIC8vIHRoaXMuc2VsZWN0ZWRfdGFzayA9IGluZGV4OwogICAgICAvLyB0aGlzLnRhc2tfdHlwZSA9ICdEZWZhdWx0JzsKICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LmludGVudCA9IHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQ7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza05hbWU7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uWzBdLlRleHQ7CiAgICAgIC8vIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnNwbGljZSgwLCAxKTsKICAgICAgLy8gZm9yICh2YXIgaj0xO2o8dGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24ubGVuZ3RoO2orKykgewogICAgICAvLyAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbltqXSk7CiAgICAgIC8vIH0KICAgICAgLy8gY29uc29sZS5sb2codGhpcy50YXNrX2xpc3RbaW5kZXhdKTsKCiAgICB9IC8vIGdldGRhdGFzb2JzKGRhdGEpewogICAgLy8gICB2YXIgeDsKICAgIC8vICAgY29uc29sZS5sb2coZGF0YSx4KTsKICAgIC8vICAgeD1kYXRhOwogICAgLy8gICBjb25zb2xlLmxvZyhkYXRhLHgpOwogICAgLy8gICByZXR1cm4geDsKICAgIC8vIH0sCgogIH0KfTs="},null]}