{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/HR Management/HrScheduler.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/HR Management/HrScheduler.vue","mtime":1655466542524},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7IC8vIGltcG9ydCBUaW1lUGlja2VyIGZyb20gImFudC1kZXNpZ24tdnVlL2xpYi90aW1lLXBpY2tlciI7CgppbXBvcnQgQ2FsZW5kYXIgZnJvbSAiLi4vLi4vLi4vLi4vLi4vcHVibGljL2pzL3R1aS1jYWxlbmRhci5taW4uanMiOwppbXBvcnQgRGF0ZVBpY2tlciBmcm9tICJ0dWktZGF0ZS1waWNrZXIiOwppbXBvcnQgInR1aS1kYXRlLXBpY2tlci9kaXN0L3R1aS1kYXRlLXBpY2tlci5jc3MiOwppbXBvcnQgIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9jc3Mvc2Vnb2UtdWkuY3NzIjsKaW1wb3J0ICIuLi8uLi8uLi8uLi8uLi9wdWJsaWMvY3NzL3R1aS1jYWxlbmRhci5taW4uY3NzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJJbnRlcnZpZXcgU2NoZWR1bGVyIiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY2FsZW5kYXJJbnN0YW5jZTogbnVsbCwKICAgICAgY3VycmVudF9jYWxlbmRhcl92aWV3OiAnZGF5JywKICAgICAgc2hvd19zcGlubmVyOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfdGltZTogIiIsCiAgICAgIGRpc3BsYXlfc2VsZWN0ZWRfdGltZTogIiIsCiAgICAgIHNjaGVkdWxlZF90aW1lOiAiIiwKICAgICAgc2VsZWN0ZWRfZGF0ZTogIiIsCiAgICAgIGNhbmRpZGF0ZV9uYW1lOiAiIiwKICAgICAgdmlzaXRvcl9udW1iZXI6ICIiLAogICAgICBjYW5kaWRhdGVfcG9zaXRpb246ICIiLAogICAgICBjYW5kaWRhdGVfZW1haWw6ICIiLAogICAgICBzY2hlZHVsZV9saXN0OiBbXSwKICAgICAgc2VsZWN0ZWRfc2NoZWR1bGVfaWQ6ICIiLAogICAgICBzZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90OiAiIiwKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgcGhvbmVfbnVtYmVyX3ZhbGlkaXR5OiAvXCtbMC05XXs5LDE0fSQvLAogICAgICBmdWxsX3RpbWVfc2xvdHM6IFtdLAogICAgICB0aW1lX3Nsb3RzOiBbXSwKICAgICAgd29ya2luZ19ocnM6IHsKICAgICAgICAiTW9uZGF5IjogW10sCiAgICAgICAgIlR1ZXNkYXkiOiBbXSwKICAgICAgICAiV2VkbmVzZGF5IjogW10sCiAgICAgICAgIlRodXJzZGF5IjogW10sCiAgICAgICAgIkZyaWRheSI6IFtdLAogICAgICAgICJTYXR1cmRheSI6IFtdLAogICAgICAgICJTdW5kYXkiOiBbXQogICAgICB9LAogICAgICBzZWxlY3RlZF90aW1lX3Nsb3Q6ICIiLAogICAgICBidWZmZXJfdGltZV9wZXJpb2Q6ICIiLAogICAgICBtaW5pbXVtX25vdGljZV9kYXlzOiAiIiwKICAgICAgbWVldGluZ19kYXlzX3JhbmdlOiAiIiwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgc2NoZWR1bGluZ19jb250YWN0X251bWJlcjogIiIsCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgRmlsZSIsCiAgICAgIHdlZWtfZGF5czogWyJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5IiwgIlN1bmRheSJdLAogICAgICBkYXlzSW5Nb250aDogW10sCiAgICAgIGFjdGl2ZU1vbnRoWWVhcjogJycsCiAgICAgIGNzdl9maWxlOiAiIiwKICAgICAgc2hvd19jaGVja19hbmRfY2hhbmdlX3N0YXR1czogdHJ1ZSwKICAgICAgdXNlcl90eXBlOiBudWxsLAogICAgICB2aXNpdF9zdGF0dXNfZGF0YTogbnVsbCwKICAgICAgdmlzaXRfc3RhdHVzX2NvbXBhcmlzb25fZGF0YTogW10sCiAgICAgIGRhaWx5X2RhdGU6ICIiLAogICAgICBpc1Jlc2NoZWR1bGU6IHRydWUsCiAgICAgIGRhdGVwaWNrZXJJbnN0YW5jZTogbnVsbCwKICAgICAgbmV3X3NlbGVjdGVkX2RhdGU6ICIiLAogICAgICBlZGl0X3NjaGVkdWxpbmc6IGZhbHNlLAogICAgICB0ZW1wX2RhdGE6ICIiLAogICAgICBpc0FwcG9pbnRtZW50Q29uZmlybWVkOiBmYWxzZSwKICAgICAgYXBwb2ludG1lbnRTdGF0dXM6ICIiLAogICAgICB2aXNpdFN0YXR1czogIiIsCiAgICAgIEFwcG9pbnRtZW50SUQ6ICcnLAogICAgICBpc1Jlc2NoZWR1bGV0aW1lOiBmYWxzZSwKICAgICAgdGVtcF9uYW1lOiAiIiwKICAgICAgdGVtcF9wb3NpdGlvbjogIiIsCiAgICAgIHRlbXBfZW1haWw6ICIiLAogICAgICB0ZW1wX2FwcG9pbnRtZW50X2RhdGU6ICIiLAogICAgICB0ZW1wX2FwcG9pbnRtZW50X3RpbWU6ICIiLAogICAgICB0ZW1wX3RpbWVfc2xvdHM6IFtdLAogICAgICBjb21wYW55aWQ6ICIiLAogICAgICBjb21wYW55bmFtZTogIiIsCiAgICAgIHN1cHBvcnRfbnVtYmVyc19saXN0OiBbXSwKICAgICAgZmlsbGVkX3RpbWVfc2xvdHNfc2VsZWN0ZWRfZGF0ZTogW10KICAgIH07CiAgfSwKICBjb21wb25lbnRzOiB7Ly8gVGltZVBpY2tlcgogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZhbGlkUGhvbmVOdW1iZXI6IGZ1bmN0aW9uIHZhbGlkUGhvbmVOdW1iZXIoKSB7CiAgICAgIGlmICh0aGlzLnBob25lX251bWJlcl92YWxpZGl0eS50ZXN0KHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlci5yZXBsYWNlKC9ccysvZywgJycpKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyIGluIHRoZSBmb3JtYXQ6ICtDb3VudHJ5Q29kZSBOdW1iZXIiOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlTW9kYWxUaXRsZTogZnVuY3Rpb24gY3JlYXRlTW9kYWxUaXRsZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY2FuZGlkYXRlX25hbWUuc3BsaXQoJyAnKS5zbGljZSgwLCAxKS5tYXAoZnVuY3Rpb24gKHdvcmQpIHsKICAgICAgICByZXR1cm4gd29yZC5jaGFyQXQoMCk7CiAgICAgIH0pLmpvaW4oJycpLnRvVXBwZXJDYXNlKCk7CiAgICB9LAogICAgdGltZVNsb3RzTGlzdDogZnVuY3Rpb24gdGltZVNsb3RzTGlzdCgpIHsKICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDIzOyBpICs9IDEpIHsKICAgICAgICBsaXN0LnB1c2goewogICAgICAgICAgZGlzcGxheTogbW9tZW50KGksIFsnaCddKS5mb3JtYXQoJ2g6bW0gQScpLAogICAgICAgICAgdmFsdWU6IG1vbWVudChpLCBbJ2gnXSkuZm9ybWF0KCdIOm1tJykKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGxpc3Q7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgY3VycmVudF9jYWxlbmRhcl92aWV3OiBmdW5jdGlvbiBjdXJyZW50X2NhbGVuZGFyX3ZpZXcobmV3VmFsKSB7CiAgICAgIHRoaXMudG9nZ2xlX3ZpZXcobmV3VmFsKTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UgPSBuZXcgQ2FsZW5kYXIoIiNjYWxlbmRhciIsIHsKICAgICAgZGVmYXVsdFZpZXc6ICJkYXkiLAogICAgICB0YXNrVmlldzogZmFsc2UsCiAgICAgIHNjaGVkdWxlVmlldzogWyJ0aW1lIl0sCiAgICAgIHRoZW1lOiB7CiAgICAgICAgJ21vbnRoLmRheW5hbWUudGV4dEFsaWduJzogJ2NlbnRlcicsCiAgICAgICAgJ21vbnRoLmRheW5hbWUudGV4dFRyYW5zZm9ybSc6ICd1cHBlcmNhc2UnLAogICAgICAgICd3ZWVrLmRheW5hbWUuYm9yZGVyTGVmdCc6ICcxcHggc29saWQgI0RGREZERicsCiAgICAgICAgJ21vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cyc6ICcycHgnLAogICAgICAgICdtb250aC5zY2hlZHVsZS5tYXJnaW5Ub3AnOiAnMnB4JywKICAgICAgICAnbW9udGguc2NoZWR1bGUubWFyZ2luTGVmdCc6ICc4cHgnLAogICAgICAgICdtb250aC5zY2hlZHVsZS5tYXJnaW5SaWdodCc6ICc4cHgnLAogICAgICAgICd3ZWVrLmRheWdyaWQuYmFja2dyb3VuZENvbG9yJzogJ25vbmUnLAogICAgICAgICd3ZWVrLmRheW5hbWUudGV4dEFsaWduJzogJ2NlbnRlcicsCiAgICAgICAgJ3dlZWsuZGF5bmFtZS50ZXh0VHJhbnNmb3JtJzogJ3VwcGVyY2FzZScsCiAgICAgICAgJ3dlZWsudGltZWdyaWRIb3Jpem9udGFsTGluZS5ib3JkZXJCb3R0b20nOiAnMXB4IGRhc2hlZCAjRjFGMUYxJywKICAgICAgICAnd2Vlay50aW1lZ3JpZC5ib3JkZXJSaWdodCc6ICcxcHggc29saWQgI0RGREZERicKICAgICAgfSwKICAgICAgdGVtcGxhdGU6IHsKICAgICAgICBtb250aEdyaWRIZWFkZXI6IGZ1bmN0aW9uIG1vbnRoR3JpZEhlYWRlcihkYXlNb2RlbCkgewogICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQoZGF5TW9kZWwuZGF0ZSwgWydZWVlZLU1NLUREJ10pLmZvcm1hdCgnREQnKTsKICAgICAgICAgIHZhciBjbGFzc05hbWVzID0gWyd0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LWdyaWQtZGF0ZSAnXTsKCiAgICAgICAgICBpZiAoZGF5TW9kZWwuaXNUb2RheSkgewogICAgICAgICAgICBjbGFzc05hbWVzLnB1c2goJ3R1aS1mdWxsLWNhbGVuZGFyLXdlZWtkYXktZ3JpZC1kYXRlLWRlY29yYXRvcicpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyBjbGFzc05hbWVzLmpvaW4oJyAnKSArICciPicgKyBkYXRlICsgJzwvc3Bhbj4nOwogICAgICAgIH0sCiAgICAgICAgbW9udGhEYXluYW1lOiBmdW5jdGlvbiBtb250aERheW5hbWUobW9kZWwpIHsKICAgICAgICAgIHJldHVybiAiPHNwYW4gc3R5bGU9XCJjb2xvcjojOTU5NTk1XCI+Ii5jb25jYXQobW9kZWwubGFiZWwudG9TdHJpbmcoKS50b0xvY2FsZVVwcGVyQ2FzZSgpLCAiPC9zcGFuPiIpOwogICAgICAgIH0sCiAgICAgICAgd2Vla0RheW5hbWU6IGZ1bmN0aW9uIHdlZWtEYXluYW1lKG1vZGVsKSB7CiAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1kYXluYW1lLWRhdGUiPjwvc3Bhbj4mbmJzcDsmbmJzcDs8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItZGF5bmFtZS1uYW1lIj4nICsgbW9kZWwuZGF5TmFtZS50b0xvY2FsZVVwcGVyQ2FzZSgpICsgJzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdXNlQ3JlYXRpb25Qb3B1cDogZmFsc2UsCiAgICAgIHVzZURldGFpbFBvcHVwOiBmYWxzZQogICAgfSk7CiAgICB0aGlzLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9ICJkYXkiOwogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJjbGlja0RheW5hbWUiLCBmdW5jdGlvbiAoZSkgewogICAgICBpZiAodm0uY2FsZW5kYXJJbnN0YW5jZS5nZXRWaWV3TmFtZSgpID09PSAid2VlayIpIHsKICAgICAgICB2bS5jYWxlbmRhckluc3RhbmNlLnNldERhdGUobmV3IERhdGUoZS5kYXRlKSk7CiAgICAgICAgdm0uY2FsZW5kYXJJbnN0YW5jZS5jaGFuZ2VWaWV3KCJkYXkiLCB0cnVlKTsKICAgICAgICB0aGlzLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9ICJkYXkiOwogICAgICAgIHZtLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5vbigiYWZ0ZXJSZW5kZXJTY2hlZHVsZSIsIGZ1bmN0aW9uIChlKSB7fSk7CiAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIF90aGlzLm5ld19zY2hlZHVsZShlLnN0YXJ0Ll9kYXRlKTsKCiAgICAgIGUuZ3VpZGUuY2xlYXJHdWlkZUVsZW1lbnQoKTsKICAgIH0pOwogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJjbGlja1NjaGVkdWxlIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGlmIChldmVudC5zY2hlZHVsZS5yYXcuaXNIb2xpZGF5KSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJZb3UgY2Fubm90IGVudGVyIGEgc2NoZWR1bGUgZm9yIHRoaXMgZGF0ZS4gXG4gUmVhc29uOiAiICsgZXZlbnQuc2NoZWR1bGUucmF3LnJlYXNvbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHNjaGVkdWxlID0gZXZlbnQuc2NoZWR1bGU7CiAgICAgICAgdm0uY2FuZGlkYXRlX25hbWUgPSBzY2hlZHVsZS50aXRsZTsKICAgICAgICB2bS5jYW5kaWRhdGVfcG9zaXRpb24gPSBzY2hlZHVsZS5yYXcuY2FuZGlkYXRlX3Bvc2l0aW9uOwogICAgICAgIHZtLmNhbmRpZGF0ZV9lbWFpbCA9IHNjaGVkdWxlLnJhdy5jYW5kaWRhdGVfZW1haWw7CiAgICAgICAgdm0udmlzaXRvcl9udW1iZXIgPSBzY2hlZHVsZS5yYXcucGhvbmVfbnVtYmVyOwogICAgICAgIHZhciBzZWxlY3RlZF90aW1lID0gc2NoZWR1bGUucmF3LnN0YXJ0ICsgIi0iICsgc2NoZWR1bGUucmF3LmVuZDsKICAgICAgICB2YXIgc2VsZWN0ZWRfdGltZV9zdGFydCA9IG1vbWVudChzY2hlZHVsZS5yYXcuc3RhcnQsIFsnSEg6bW0nXSkuZm9ybWF0KCdoaDptbSBBJyk7CiAgICAgICAgdmFyIHNlbGVjdGVkX3RpbWVfZW5kID0gbW9tZW50KHNjaGVkdWxlLnJhdy5lbmQsIFsnSEg6bW0nXSkuZm9ybWF0KCdoaDptbSBBJyk7CiAgICAgICAgdm0uZGlzcGxheV9zZWxlY3RlZF90aW1lID0gIiIuY29uY2F0KHNlbGVjdGVkX3RpbWVfc3RhcnQsICIgLSAiKS5jb25jYXQoc2VsZWN0ZWRfdGltZV9lbmQpOwogICAgICAgIHZtLnNlbGVjdGVkX3NjaGVkdWxlX2lkID0gc2NoZWR1bGUuaWQ7CiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdCA9IHNjaGVkdWxlLnJhdy52aXNpdF9zbG90OwogICAgICAgIHZtLmdldF90aW1lX3Nsb3RzKHNjaGVkdWxlLnN0YXJ0Ll9kYXRlLCAiI3NjaGVkdWxlX2RldGFpbHMiLCBzZWxlY3RlZF90aW1lKTsKICAgICAgICB2bS5hcHBvaW50bWVudFN0YXR1cyA9IHNjaGVkdWxlLnJhdy5hcHBvaW50bWVudF9zdGF0dXM7CiAgICAgICAgdm0uQXBwb2ludG1lbnRJRCA9IHNjaGVkdWxlLnJhdy5hcHBvaW50bWVudF9pZDsKICAgICAgICB2bS52aXNpdFN0YXR1cyA9IHNjaGVkdWxlLnJhdy52aXNpdF9zdGF0dXM7CiAgICAgICAgdm0ub3BlbkNoZWNrQW5kQ2hhbmdlU3RhdHVzTW9kYWwoc2NoZWR1bGUucmF3LmFwcG9pbnRtZW50X2lkLCBzY2hlZHVsZS5zdGFydC5fZGF0ZSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICQoIiNzY2hlZHVsZV9kZXRhaWxzIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF2bS5lZGl0X3NjaGVkdWxpbmcpIHsKICAgICAgICB2bS5jYW5kaWRhdGVfbmFtZSA9ICIiOwogICAgICAgIHZtLmNhbmRpZGF0ZV9wb3NpdGlvbiA9ICIiOwogICAgICAgIHZtLmNhbmRpZGF0ZV9lbWFpbCA9ICIiOwogICAgICAgIHZtLnZpc2l0b3JfbnVtYmVyID0gIiI7CiAgICAgICAgdm0uc2VsZWN0ZWRfdGltZSA9ICIiOwogICAgICAgIHZtLmlzRWRpdCA9IGZhbHNlOwogICAgICAgIHZtLnNlbGVjdGVkX3NjaGVkdWxlX2lkID0gIiI7CiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdCA9ICIiOwogICAgICAgIHZtLmlzUmVzY2hlZHVsZXRpbWUgPSBmYWxzZTsKICAgICAgICB2bS5lZGl0X3NjaGVkdWxpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgICAkKCIjc2NoZWR1bGVfY3JlYXRlIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdm0uY2FuZGlkYXRlX25hbWUgPSAiIjsKICAgICAgdm0uY2FuZGlkYXRlX3Bvc2l0aW9uID0gIiI7CiAgICAgIHZtLmNhbmRpZGF0ZV9lbWFpbCA9ICIiOwogICAgICB2bS52aXNpdG9yX251bWJlciA9ICIiOwogICAgICB2bS5zZWxlY3RlZF90aW1lID0gIiI7CiAgICB9KTsKICAgICQoIiNzY2hlZHVsaW5nX21vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdm0uc2NoZWR1bGluZ19jb250YWN0X251bWJlciA9ICIiOwogICAgICB2bS5jc3ZfZmlsZSA9ICIiOwogICAgICB2bS5maWxlX2xhYmVsID0gIkNob29zZSBGaWxlIjsKICAgIH0pOwogICAgdmFyIHgsCiAgICAgICAgaSwKICAgICAgICBqLAogICAgICAgIGwsCiAgICAgICAgbGwsCiAgICAgICAgc2VsRWxtbnQsCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgdm0gPSB0aGlzOwogICAgLypsb29rIGZvciBhbnkgZWxlbWVudHMgd2l0aCB0aGUgY2xhc3MgImN1c3RvbS1zY2hlZHVsZXItc2VsZWN0IjoqLwoKICAgIHggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjdXN0b20tc2NoZWR1bGVyLXNlbGVjdCIpOwogICAgbCA9IHgubGVuZ3RoOwoKICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHsKICAgICAgc2VsRWxtbnQgPSB4W2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZWxlY3QiKVswXTsKICAgICAgbGwgPSBzZWxFbG1udC5sZW5ndGg7CiAgICAgIC8qZm9yIGVhY2ggZWxlbWVudCwgY3JlYXRlIGEgbmV3IERJViB0aGF0IHdpbGwgYWN0IGFzIHRoZSBzZWxlY3RlZCBpdGVtOiovCgogICAgICBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7CiAgICAgIGEuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzZWxlY3Qtc2VsZWN0ZWQiKTsKICAgICAgYS5pbm5lckhUTUwgPSBzZWxFbG1udC5vcHRpb25zW3NlbEVsbW50LnNlbGVjdGVkSW5kZXhdLmlubmVySFRNTDsKICAgICAgeFtpXS5hcHBlbmRDaGlsZChhKTsKICAgICAgLypmb3IgZWFjaCBlbGVtZW50LCBjcmVhdGUgYSBuZXcgRElWIHRoYXQgd2lsbCBjb250YWluIHRoZSBvcHRpb24gbGlzdDoqLwoKICAgICAgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpOwogICAgICBiLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic2VsZWN0LWl0ZW1zIHNlbGVjdC1oaWRlIik7CgogICAgICBmb3IgKGogPSAxOyBqIDwgbGw7IGorKykgewogICAgICAgIC8qZm9yIGVhY2ggb3B0aW9uIGluIHRoZSBvcmlnaW5hbCBzZWxlY3QgZWxlbWVudCwKICAgICAgICBjcmVhdGUgYSBuZXcgRElWIHRoYXQgd2lsbCBhY3QgYXMgYW4gb3B0aW9uIGl0ZW06Ki8KICAgICAgICBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7CiAgICAgICAgYy5pbm5lckhUTUwgPSBzZWxFbG1udC5vcHRpb25zW2pdLmlubmVySFRNTDsKICAgICAgICBjLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIC8qd2hlbiBhbiBpdGVtIGlzIGNsaWNrZWQsIHVwZGF0ZSB0aGUgb3JpZ2luYWwgc2VsZWN0IGJveCwKICAgICAgICAgIGFuZCB0aGUgc2VsZWN0ZWQgaXRlbToqLwogICAgICAgICAgdmFyIHksIGksIGssIHMsIGgsIHNsLCB5bDsKICAgICAgICAgIHMgPSB0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2VsZWN0IilbMF07CiAgICAgICAgICBzbCA9IHMubGVuZ3RoOwogICAgICAgICAgaCA9IHRoaXMucGFyZW50Tm9kZS5wcmV2aW91c1NpYmxpbmc7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNsOyBpKyspIHsKICAgICAgICAgICAgaWYgKHMub3B0aW9uc1tpXS5pbm5lckhUTUwgPT0gdGhpcy5pbm5lckhUTUwpIHsKICAgICAgICAgICAgICBzLnNlbGVjdGVkSW5kZXggPSBpOwogICAgICAgICAgICAgIGguaW5uZXJIVE1MID0gdGhpcy5pbm5lckhUTUw7CiAgICAgICAgICAgICAgeSA9IHRoaXMucGFyZW50Tm9kZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzYW1lLWFzLXNlbGVjdGVkIik7CiAgICAgICAgICAgICAgeWwgPSB5Lmxlbmd0aDsKCiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IHlsOyBrKyspIHsKICAgICAgICAgICAgICAgIHlba10ucmVtb3ZlQXR0cmlidXRlKCJjbGFzcyIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInNhbWUtYXMtc2VsZWN0ZWQiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGguY2xpY2soKTsKICAgICAgICAgIHZtLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9IHNlbEVsbW50LnZhbHVlOwogICAgICAgIH0pOwogICAgICAgIGIuYXBwZW5kQ2hpbGQoYyk7CiAgICAgIH0KCiAgICAgIHhbaV0uYXBwZW5kQ2hpbGQoYik7CiAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoZSkgewogICAgICAgIC8qd2hlbiB0aGUgc2VsZWN0IGJveCBpcyBjbGlja2VkLCBjbG9zZSBhbnkgb3RoZXIgc2VsZWN0IGJveGVzLAogICAgICAgIGFuZCBvcGVuL2Nsb3NlIHRoZSBjdXJyZW50IHNlbGVjdCBib3g6Ki8KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGNsb3NlQWxsU2VsZWN0KHRoaXMpOwogICAgICAgIHRoaXMubmV4dFNpYmxpbmcuY2xhc3NMaXN0LnRvZ2dsZSgic2VsZWN0LWhpZGUiKTsKICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoInNlbGVjdC1hcnJvdy1hY3RpdmUiKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xvc2VBbGxTZWxlY3QoZWxtbnQpIHsKICAgICAgLyphIGZ1bmN0aW9uIHRoYXQgd2lsbCBjbG9zZSBhbGwgc2VsZWN0IGJveGVzIGluIHRoZSBkb2N1bWVudCwKICAgICAgZXhjZXB0IHRoZSBjdXJyZW50IHNlbGVjdCBib3g6Ki8KICAgICAgdmFyIHgsCiAgICAgICAgICB5LAogICAgICAgICAgaSwKICAgICAgICAgIHhsLAogICAgICAgICAgeWwsCiAgICAgICAgICBhcnJObyA9IFtdOwogICAgICB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgic2VsZWN0LWl0ZW1zIik7CiAgICAgIHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWxlY3Qtc2VsZWN0ZWQiKTsKICAgICAgeGwgPSB4Lmxlbmd0aDsKICAgICAgeWwgPSB5Lmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCB5bDsgaSsrKSB7CiAgICAgICAgaWYgKGVsbW50ID09IHlbaV0pIHsKICAgICAgICAgIGFyck5vLnB1c2goaSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHlbaV0uY2xhc3NMaXN0LnJlbW92ZSgic2VsZWN0LWFycm93LWFjdGl2ZSIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChpID0gMDsgaSA8IHhsOyBpKyspIHsKICAgICAgICBpZiAoYXJyTm8uaW5kZXhPZihpKSkgewogICAgICAgICAgeFtpXS5jbGFzc0xpc3QuYWRkKCJzZWxlY3QtaGlkZSIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyppZiB0aGUgdXNlciBjbGlja3MgYW55d2hlcmUgb3V0c2lkZSB0aGUgc2VsZWN0IGJveCwKICAgIHRoZW4gY2xvc2UgYWxsIHNlbGVjdCBib3hlczoqLwoKCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGNsb3NlQWxsU2VsZWN0KTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGludGVydmlld2Vyc19kZXRhaWw6IGZ1bmN0aW9uIGludGVydmlld2Vyc19kZXRhaWwoKSB7Ly9Uby1EbwogICAgICAvLyBpc19nZXQgKyBnZXRfYWxsIC0+IHJldHVybnMgYWxsIGludGVydmlld2VycyBsaXN0CiAgICAgIC8vIGlzX2dldCArIHJlcV9pbnRlcnZpZXdlcl9lbWFpbCAtPiByZXR1cm5zIHNpbmdsZSBpbnRlcnZpZXdlciBkZXRhaWxzIHdpdGggdGhlaXIgd29ya2luZyBob3VyCiAgICAgIC8vIGNvbXBhbnlfaWQgPSByZXF1ZXN0Lmpzb24uZ2V0KCdjb21wYW55X2lkJywgTm9uZSkKICAgICAgLy8gY29tcGFueV9uYW1lID0gcmVxdWVzdC5qc29uLmdldCgnY29tcGFueV9uYW1lJywgTm9uZSkKICAgICAgLy8gaXNfZ2V0ID0gcmVxdWVzdC5qc29uLmdldCgnaXNfZ2V0JywgRmFsc2UpCiAgICAgIC8vIGdldF9hbGwgPSByZXF1ZXN0Lmpzb24uZ2V0KCdnZXRfYWxsJywgRmFsc2UpCiAgICAgIC8vIGlzX3NhdmUgPSByZXF1ZXN0Lmpzb24uZ2V0KCdpc19zYXZlJywgRmFsc2UpCiAgICAgIC8vIGlzX2VkaXQgPSByZXF1ZXN0Lmpzb24uZ2V0KCdpc19lZGl0JywgRmFsc2UpCiAgICAgIC8vIGlzX3NlYXJjaCA9IHJlcXVlc3QuanNvbi5nZXQoJ2lzX3NlYXJjaCcsIEZhbHNlKQogICAgICAvLyBzZWFyY2hfa2V5ID0gcmVxdWVzdC5qc29uLmdldCgnc2VhcmNoX2tleScsIE5vbmUpCiAgICAgIC8vIHJlcV9pbnRlcnZpZXdlcl9lbWFpbCA9IHJlcXVlc3QuanNvbi5nZXQoJ3JlcV9pbnRlcnZpZXdlcl9lbWFpbCcsIE5vbmUpCiAgICAgIC8vIGludGVydmlld2Vyc19kZXRhaWwgPSByZXF1ZXN0Lmpzb24uZ2V0KCdpbnRlcnZpZXdlcnNfZGV0YWlsJywgTm9uZSkKICAgICAgLy8gcGFnZV9ubyA9IHJlcXVlc3QuanNvbi5nZXQoJ3BhZ2Vfbm8nLCAxKQogICAgICAvLyBwZXJfcGFnZSA9IHJlcXVlc3QuanNvbi5nZXQoJ3Blcl9wYWdlJywgMTApCiAgICB9LAogICAgYWRkX3RpbWluZ19zbG90OiBmdW5jdGlvbiBhZGRfdGltaW5nX3Nsb3QoZGF5cykgewogICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgaWYgKEJvb2xlYW4odGhpcy53b3JraW5nX2hyc1tkYXlzXSkpIHsKICAgICAgICB0aGlzLndvcmtpbmdfaHJzW2RheXNdLnB1c2goewogICAgICAgICAgRW5kVGltZTogIiIsCiAgICAgICAgICBTdGFydFRpbWU6ICIiCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53b3JraW5nX2hyc1tkYXlzXSA9IFt7CiAgICAgICAgICBFbmRUaW1lOiAiIiwKICAgICAgICAgIFN0YXJ0VGltZTogIiIKICAgICAgICB9XTsKICAgICAgfQoKICAgICAgdm0uJHNldCh2bS53b3JraW5nX2hycywgZGF5cywgdm0ud29ya2luZ19ocnNbZGF5c10pOwogICAgfSwKICAgIHJlbW92ZV90aW1pbmdfc2xvdDogZnVuY3Rpb24gcmVtb3ZlX3RpbWluZ19zbG90KGRheXMsIGluZGV4KSB7CiAgICAgIHRoaXMud29ya2luZ19ocnNbZGF5c10uc3BsaWNlKGluZGV4LCAxKTsKICAgIH0sCiAgICBvcGVuX3NjaGVkdWxpbmdfbW9kYWw6IGZ1bmN0aW9uIG9wZW5fc2NoZWR1bGluZ19tb2RhbCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuZWRpdF9zY2hlZHVsaW5nID0gZmFsc2U7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxpbmdfc2V0dGluZ3NfdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGdldFNjaGVkdWxpbmdJbmZvOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwgJiYgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfdGhpczIuc2NoZWR1bGluZ19jb250YWN0X251bWJlciA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLnBob25lX251bWJlcjsKICAgICAgICAgIF90aGlzMi5zZWxlY3RlZF90aW1lX3Nsb3QgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby50aW1lX3Nsb3QgIT09IG51bGwgPyByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby50aW1lX3Nsb3QgOiAiIjsKICAgICAgICAgIF90aGlzMi5idWZmZXJfdGltZV9wZXJpb2QgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5idWZmZXJfdGltZSAhPT0gbnVsbCA/IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLmJ1ZmZlcl90aW1lIDogIiI7CiAgICAgICAgICBfdGhpczIubWluaW11bV9ub3RpY2VfZGF5cyA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLm1pbmltdW1fbm90aWNlX2RheXMgIT09IG51bGwgPyByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5taW5pbXVtX25vdGljZV9kYXlzIDogIiI7CiAgICAgICAgICBfdGhpczIubWVldGluZ19kYXlzX3JhbmdlID0gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ubWVldGluZ19kYXlzX3JhbmdlICE9PSBudWxsID8gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ubWVldGluZ19kYXlzX3JhbmdlIDogIiI7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLkhvbGlkYXlfbGlzdF9maWxlX25hbWUgPT0gIiIgfHwgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uSG9saWRheV9saXN0X2ZpbGVfbmFtZSA9PSBudWxsKSB7fSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyLmZpbGVfbGFiZWwgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5Ib2xpZGF5X2xpc3RfZmlsZV9uYW1lOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby53b3JraW5nX2hycyAhPSBudWxsIHx8IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLndvcmtpbmdfaHJzICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBfdGhpczIud29ya2luZ19ocnMgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby53b3JraW5nX2hyczsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coZXJyKTsKICAgICAgICBfdGhpczIuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgIH0pOwogICAgfSwKICAgIGdldF90aW1lX3Nsb3RzOiBmdW5jdGlvbiBnZXRfdGltZV9zbG90cyhzdGFydF9kYXRlLCB0eXBlLCBzZWxlY3RlZF90aW1lLCBpc19yZXNjaGVkdWxpbmcpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuZWRpdF9zY2hlZHVsaW5nID0gaXNfcmVzY2hlZHVsaW5nID09PSAiaXNfcmVzY2hlZHVsaW5nIjsKCiAgICAgIGlmIChpc19yZXNjaGVkdWxpbmcgPT09ICJpc19yZXNjaGVkdWxpbmciKSB7CiAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CiAgICAgIH0KCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX2dldF9zY2hlZHVsZV9hcHBvaW50bWVudCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBEYXRlOiBtb21lbnQoc3RhcnRfZGF0ZSkuZm9ybWF0KCdZWVlZLU1NLUREJyksCiAgICAgICAgYXBwb2ludG1lbnRfZGF0ZTogbW9tZW50KHN0YXJ0X2RhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczMuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09IG51bGwpIHt9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJQbGVhc2UgdXBkYXRlIHlvdXIgc2NoZWR1bGVyIHNldHRpbmdzIikgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgdXBkYXRlIHlvdXIgc2NoZWR1bGVyIHNldHRpbmdzIik7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2YXIgZHQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBfdGhpczMuZnVsbF90aW1lX3Nsb3RzID0gW107CiAgICAgICAgICAgIHZhciBnZXRfZnVsbF9zbG90X2xpc3QgPSB0cnVlOwogICAgICAgICAgICB2YXIgdGVtcF9zdGFydF9kYXRlID0gbmV3IERhdGUoc3RhcnRfZGF0ZSk7CgogICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgPiBkdC5nZXRGdWxsWWVhcigpKSB7fSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSA9PSBkdC5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRNb250aCgpID4gZHQuZ2V0TW9udGgoKSkge30gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldE1vbnRoKCkgPT0gZHQuZ2V0TW9udGgoKSkgewogICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXREYXRlKCkgPiBkdC5nZXREYXRlKCkpIHt9IGVsc2UgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXREYXRlKCkgPT0gZHQuZ2V0RGF0ZSgpKSB7CiAgICAgICAgICAgICAgICAgIGdldF9mdWxsX3Nsb3RfbGlzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBpZiAobW9tZW50KHN0YXJ0X2RhdGUpLmRpZmYobW9tZW50KCksICJkYXkiKSA8PSAwKSB7CiAgICAgICAgICAgIC8vICAgZ2V0X2Z1bGxfc2xvdF9saXN0ID0gZmFsc2U7CiAgICAgICAgICAgIC8vIH0KCgogICAgICAgICAgICBpZiAoZ2V0X2Z1bGxfc2xvdF9saXN0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgICAgX3RoaXMzLmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczMuZ2VuZXJhdGVfdGltZShyZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLCByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzFdKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMpIHsKICAgICAgICAgICAgICAgIGlmIChkdC5nZXRIb3VycygpIDwgTnVtYmVyKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSkpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMzLmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLmdlbmVyYXRlX3RpbWUocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXSwgcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXSkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAvLyBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHMpIHsKICAgICAgICAgICAgICAvLyAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAgIC8vICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXSwKICAgICAgICAgICAgICAvLyAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKAogICAgICAgICAgICAgIC8vICAgICAgIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXSwKICAgICAgICAgICAgICAvLyAgICAgICByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0KICAgICAgICAgICAgICAvLyAgICAgKQogICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKEJvb2xlYW4oc2VsZWN0ZWRfdGltZSkpIHsKICAgICAgICAgICAgICBfdGhpczMuaXNFZGl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgX3RoaXMzLnNlbGVjdGVkX3RpbWUgPSBzZWxlY3RlZF90aW1lOwogICAgICAgICAgICAgIF90aGlzMy5zY2hlZHVsZWRfdGltZSA9IF90aGlzMy5nZW5lcmF0ZV90aW1lKHNlbGVjdGVkX3RpbWUuc3BsaXQoIi0iKVswXSwgc2VsZWN0ZWRfdGltZS5zcGxpdCgiLSIpWzFdKTsKICAgICAgICAgICAgICBfdGhpczMudGltZV9zbG90cyA9IFtdOyAvLyB0aGlzLnRpbWVfc2xvdHMucHVzaCh7CiAgICAgICAgICAgICAgLy8gICB2YWx1ZTogc2VsZWN0ZWRfdGltZSwKICAgICAgICAgICAgICAvLyAgIHRleHQ6IHRoaXMuZ2VuZXJhdGVfdGltZSgKICAgICAgICAgICAgICAvLyAgICAgc2VsZWN0ZWRfdGltZS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMV0KICAgICAgICAgICAgICAvLyAgICkKICAgICAgICAgICAgICAvLyB9KQoKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIF90aGlzMy5mdWxsX3RpbWVfc2xvdHMpIHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoX3RoaXMzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZSkgPT0gLTEgfHwgX3RoaXMzLnNlbGVjdGVkX3RpbWUgPT0gX3RoaXMzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczMudGltZV9zbG90cy5wdXNoKF90aGlzMy5mdWxsX3RpbWVfc2xvdHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gZm9yICh2YXIgaSBpbiB0aGlzLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgIC8vICAgdGhpcy50aW1lX3Nsb3RzLnB1c2godGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0pOwogICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIUJvb2xlYW4oc2VsZWN0ZWRfdGltZSkpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90cy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgX3RoaXMzLnRpbWVfc2xvdHMgPSBfdGhpczMuZnVsbF90aW1lX3Nsb3RzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczMudGltZV9zbG90cyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gX3RoaXMzLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90cy5pbmRleE9mKF90aGlzMy5mdWxsX3RpbWVfc2xvdHNbaV0udmFsdWUpID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnRpbWVfc2xvdHMucHVzaChfdGhpczMuZnVsbF90aW1lX3Nsb3RzW2ldKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyAgdGhpcy50aW1lX3Nsb3RzID0gcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90czsKCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX3RoaXMzLnRpbWVfc2xvdHMubGVuZ3RoID09PSAwICYmIHR5cGUgPT0gJ3NjaGVkdWxlX2RldGFpbHMnKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdObyBGcmVlIFNsb3RzIGZvciB0aGlzIERhdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAkKHR5cGUpLm1vZGFsKCJzaG93Iik7CiAgICAgICAgICAgICAgX3RoaXMzLnRlbXBfbmFtZSA9IF90aGlzMy5jYW5kaWRhdGVfbmFtZTsKICAgICAgICAgICAgICBfdGhpczMudGVtcF9wb3NpdGlvbiA9IF90aGlzMy5jYW5kaWRhdGVfcG9zaXRpb247CiAgICAgICAgICAgICAgX3RoaXMzLnRlbXBfZW1haWwgPSBfdGhpczMuY2FuZGlkYXRlX2VtYWlsOwogICAgICAgICAgICAgIF90aGlzMy50ZW1wX2FwcG9pbnRtZW50X3RpbWUgPSBfdGhpczMuc2VsZWN0ZWRfdGltZTsKICAgICAgICAgICAgICBfdGhpczMuaXNSZXNjaGVkdWxlID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgbkRhdGUgPSBuZXcgRGF0ZShzdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoc3RhcnRfZGF0ZS5nZXRNb250aCgpIDwgOSA/ICIwIiArIChzdGFydF9kYXRlLmdldE1vbnRoKCkgKyAxKSA6IHN0YXJ0X2RhdGUuZ2V0TW9udGgoKSArIDEpICsgIi0iICsgc3RhcnRfZGF0ZS5nZXREYXRlKCkpOwogICAgICAgICAgICAgIF90aGlzMy50ZW1wX2RhdGEgPSBuRGF0ZTsKICAgICAgICAgICAgICBfdGhpczMucHJldmlvdXNfdmlzaXRfZGF0ZSA9IG5EYXRlOwogICAgICAgICAgICAgIF90aGlzMy50ZW1wX2FwcG9pbnRtZW50X2RhdGUgPSBtb21lbnQobkRhdGUpLmZvcm1hdCgiTU0tREQtWVlZWSIpOwogICAgICAgICAgICAgIHZhciBtaWRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIF90aGlzMy5kYXRlcGlja2VySW5zdGFuY2UgPSBuZXcgRGF0ZVBpY2tlcigiI2RhdGVwaWNrZXIiLCB7CiAgICAgICAgICAgICAgICBkYXRlOiBuRGF0ZSwKICAgICAgICAgICAgICAgIG1pbkRhdGU6IG1pZGF0ZSwKICAgICAgICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6ICIjZGF0ZXBpY2tlci1pbnB1dCIsCiAgICAgICAgICAgICAgICAgIGZvcm1hdDogInl5eXktTU0tZGQiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2V0UmFuZ2VzOiBbW25ldyBEYXRlKCksIG5ldyBEYXRlKDIwNTAsIDEyLCAxMildXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciB2bSA9IF90aGlzMzsKCiAgICAgICAgICAgICAgX3RoaXMzLmRhdGVwaWNrZXJJbnN0YW5jZS5vbigiY2xvc2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvL3ZhciB4PSBuRGF0ZQogICAgICAgICAgICAgICAgdm0uY2hlY2tkYXRlKCk7IC8vICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyB9LCAxMDAwKTsKCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBfdGhpczMuc2hvd19zcGlubmVyID0gZmFsc2U7IC8vIGNvbnNvbGUubG9nKGVycm9yKTsKCiAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgfSk7CiAgICB9LAogICAgc2FtcGxlX2hvbGlkYXk6IGZ1bmN0aW9uIHNhbXBsZV9ob2xpZGF5KCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuaG9saWRheV9maWxlX2Rvd25sb2FkKCksCiAgICAgICAgcmVzcG9uc2VUeXBlOiAiYmxvYiIsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9LAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGlzSG9saWRheUZpbGU6IHRydWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIGZpbGUiKSB7CiAgICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgImhvbGlkYXlTYW1wbGVGaWxlLmNzdiIpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZpbGVpbnB1dDogZnVuY3Rpb24gZmlsZWlucHV0KGUpIHsKICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CgogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA8IDEwMDAwMDApIHsKICAgICAgICBpZiAoZmlsZXNbMF0ubmFtZS5pbmNsdWRlcygiY3N2IikpIHsKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgICB0aGlzLmNyZWF0ZUNTVihmaWxlc1swXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiVXBsb2FkIG9ubHkgLmNzdiBmaWxlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMU1CIik7CiAgICAgIH0KCiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICB9LAogICAgY3JlYXRlQ1NWOiBmdW5jdGlvbiBjcmVhdGVDU1YoZmlsZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM1LmNzdl9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBzZW5kX3NjaGVkdWxpbmc6IGZ1bmN0aW9uIHNlbmRfc2NoZWR1bGluZygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgY2hlY2sgPSBmYWxzZTsKCiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy53b3JraW5nX2hycykgewogICAgICAgIGZvciAodmFyIGogaW4gdGhpcy53b3JraW5nX2hyc1tpXSkgewogICAgICAgICAgaWYgKHRoaXMud29ya2luZ19ocnNbaV1bal0uU3RhcnRUaW1lID09ICIiIHx8IHRoaXMud29ya2luZ19ocnNbaV1bal0uRW5kVGltZSA9PSAiIikgewogICAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2hlY2sgPT0gdHJ1ZSkgewogICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIkZpbGwgdGltZSBzbG90cyIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBpZiAodGhpcy51c2VyX3JvbGUgPT0gIkFkbWluIikgewoKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX3RpbWVfc2xvdCAhPSAiIiAmJiB0aGlzLnNjaGVkdWxpbmdfY29udGFjdF9udW1iZXIgIT0gIiIgJiYgdGhpcy52YWxpZFBob25lTnVtYmVyID09IHRydWUgJiYgdGhpcy5idWZmZXJfdGltZV9wZXJpb2QgIT0gIiIgJiYgdGhpcy5taW5pbXVtX25vdGljZV9kYXlzICE9ICIiICYmIHRoaXMubWVldGluZ19kYXlzX3JhbmdlICE9ICIiKSB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxpbmdfc2V0dGluZ3NfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGdldFNjaGVkdWxpbmdJbmZvOiBmYWxzZSwKICAgICAgICAgIGlzdXBkYXRlOiB0cnVlLAogICAgICAgICAgLy8gdXBkYXRlQ29udGFjdDogdHJ1ZSwKICAgICAgICAgIENvbnRhY3ROdW1iZXI6IHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlciwKICAgICAgICAgIHRpbWVzbG90OiBOdW1iZXIodGhpcy5zZWxlY3RlZF90aW1lX3Nsb3QpLAogICAgICAgICAgYnVmZmVyX3RpbWU6IE51bWJlcih0aGlzLmJ1ZmZlcl90aW1lX3BlcmlvZCksCiAgICAgICAgICBtZWV0aW5nX2RheXNfcmFuZ2U6IE51bWJlcih0aGlzLm1lZXRpbmdfZGF5c19yYW5nZSksCiAgICAgICAgICBtaW5pbXVtX25vdGljZV9kYXlzOiBOdW1iZXIodGhpcy5taW5pbXVtX25vdGljZV9kYXlzKSwKICAgICAgICAgIHdvcmtpbmdfaHJzOiB0aGlzLndvcmtpbmdfaHJzLAogICAgICAgICAgaXN1cGRhdGVIb2xpZGF5OiB0aGlzLmNzdl9maWxlICE9ICIiID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgaG9saWRheV9saXN0X2ZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsLAogICAgICAgICAgaG9saWRheV9saXN0X2ZpbGVfZGF0YTogdGhpcy5jc3ZfZmlsZSA9PSAiIiA/IG51bGwgOiB0aGlzLmNzdl9maWxlCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczYuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM2LmhpZGVfbW9kYWwoInNjaGVkdWxpbmdfbW9kYWwiKTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEubXNnID09ICJTY2hlZHVsaW5nIGluZm8gdXBkYXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgc2NoZWR1bGluZyBpbmZvcm1hdGlvbiBoYXMgYmVlbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseSIpOwoKICAgICAgICAgICAgX3RoaXM2LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW52YWxpZCBIZWFkZXIiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIHlvdXIgaGVhZGVycyBhcyBwcm92aWRlZCBpbiB0aGUgc2FtcGxlIGZpbGUgYmVsb3cuIik7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICIiKSB7fSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09IG51bGwpIHsKICAgICAgICAgICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGlmICh0aGlzLnZhbGlkUGhvbmVOdW1iZXIgIT0gdHJ1ZSAgJiYgdGhpcy5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyICE9ICIiKXsKICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiTW9iaWxlIG51bWJlciBpcyBpbnZhbGlkLCBwbGVhc2UgZW50ZXIgaW4gZm9ybWF0OiArIENvdW50cnlDb2RlIE51bWJlciIpOwogICAgICAgIC8vIH1lbHNlewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOyAvLyB9CiAgICAgIH0KICAgIH0sCiAgICBnZW5lcmF0ZV90aW1lOiBmdW5jdGlvbiBnZW5lcmF0ZV90aW1lKHN0YXJ0X3RpbWUsIGVuZF90aW1lKSB7CiAgICAgIHZhciBzdGFydCA9IG1vbWVudChzdGFydF90aW1lLCBbImhoOm1tIl0pLmZvcm1hdCgiaGg6bW0gQSIpOwogICAgICB2YXIgZW5kID0gbW9tZW50KGVuZF90aW1lLCBbImhoOm1tIl0pLmZvcm1hdCgiaGg6bW0gQSIpOwogICAgICByZXR1cm4gIiIuY29uY2F0KHN0YXJ0LCAiLSIpLmNvbmNhdChlbmQpOwogICAgfSwKICAgIG5ld19zY2hlZHVsZTogZnVuY3Rpb24gbmV3X3NjaGVkdWxlKHN0YXJ0RGF0ZSkgewogICAgICB2YXIgc2NoZWR1bGVEYXRlID0gJyc7CgogICAgICBpZiAobW9tZW50KHN0YXJ0RGF0ZSwgJ1lZWVktTU0tREQnLCB0cnVlKS5pc1ZhbGlkKCkpIHsKICAgICAgICBzY2hlZHVsZURhdGUgPSBzdGFydERhdGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2NoZWR1bGVEYXRlID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKTsKICAgICAgfQoKICAgICAgdmFyIGhvbGlkYXlfZGF0ZSA9IHRoaXMuc2NoZWR1bGVfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgcmV0dXJuIG1vbWVudChzY2hlZHVsZS5zdGFydCkuZm9ybWF0KCJZWVlZIE1NTU0gREQiKSA9PSBtb21lbnQoc2NoZWR1bGVEYXRlKS5mb3JtYXQoIllZWVkgTU1NTSBERCIpICYmIHNjaGVkdWxlLnJhdy5pc0hvbGlkYXkgPT0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHZhciB0b2RheV90aW1lID0gbmV3IERhdGUoKTsKICAgICAgdmFyIHN0YXJ0X3RpbWUgPSBzY2hlZHVsZURhdGU7CiAgICAgIHRoaXMuc2VsZWN0ZWRfZGF0ZSA9IHN0YXJ0X3RpbWU7CiAgICAgIHN0YXJ0X3RpbWUuc2V0SG91cnMoMCwgMCwgMCwgMCk7CgogICAgICBpZiAodGhpcy5kYXRlX2NvbmRpdGlvbih0b2RheV90aW1lLCBzdGFydF90aW1lKSAmJiBob2xpZGF5X2RhdGUubGVuZ3RoID09IDAgJiYgbW9tZW50KHN0YXJ0X3RpbWUpLmZvcm1hdCgiZGRkZCIpICE9ICJTdW5kYXkiKSB7CiAgICAgICAgdGhpcy5nZXRfdGltZV9zbG90cyhzY2hlZHVsZURhdGUsICIjc2NoZWR1bGVfY3JlYXRlIik7CiAgICAgIH0gZWxzZSBpZiAoaG9saWRheV9kYXRlLmxlbmd0aCA+IDApIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIllvdSBjYW5ub3QgZW50ZXIgYSBzY2hlZHVsZSBmb3IgdGhpcyBkYXRlLiBcbiBSZWFzb246ICIgKyBob2xpZGF5X2RhdGVbMF0ucmF3LnJlYXNvbik7CiAgICAgIH0gZWxzZSB7fQogICAgfSwKICAgIGNyZWF0ZV9hcHBvaW50bWVudDogZnVuY3Rpb24gY3JlYXRlX2FwcG9pbnRtZW50KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHZhciByZWdleCA9IC9cK1swLTldezksMTR9JC87CiAgICAgIHZhciB4ID0gdGhpcy52aXNpdG9yX251bWJlci5yZXBsYWNlKC9ccysvZywgJycpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKHRoaXMuY2FuZGlkYXRlX3Bvc2l0aW9uID09ICIiIHx8IHRoaXMuY2FuZGlkYXRlX2VtYWlsID09ICIiIHx8IHRoaXMuY2FuZGlkYXRlX25hbWUgPT0gIiIgfHwgdGhpcy52aXNpdG9yX251bWJlciA9PSAiIiB8fCB0aGlzLnNlbGVjdGVkX3RpbWUgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghcmVnZXgudGVzdCh4KSkgewogICAgICAgIHRvYXN0ci5lcnJvcigiTW9iaWxlIG51bWJlciBpcyBpbnZhbGlkLCBwbGVhc2UgZW50ZXIgaW4gZm9ybWF0OiArIENvdW50cnlDb2RlIE51bWJlciIpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFZGl0KSB7CiAgICAgICAgdmFyIGFwcG9pbnRtZW50X3BheWxvYWQgPSB7CiAgICAgICAgICBDYW5kaWRhdGVOYW1lOiB0aGlzLmNhbmRpZGF0ZV9uYW1lLAogICAgICAgICAgQ2FuZGlkYXRlUG9zaXRpb246IHRoaXMuY2FuZGlkYXRlX3Bvc2l0aW9uLAogICAgICAgICAgQ2FuZGlkYXRlRW1haWw6IHRoaXMuY2FuZGlkYXRlX2VtYWlsLAogICAgICAgICAgVmlzaXRTbG90OiB0aGlzLnNlbGVjdGVkX3RpbWUsCiAgICAgICAgICBQaG9uZU51bWJlcjogdGhpcy52aXNpdG9yX251bWJlciwKICAgICAgICAgIFZpc2l0RGF0ZTogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90LnNwbGl0KCIgIilbMF0KICAgICAgICB9OwogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9lZGl0X2RlbGV0ZV91cmwoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZGF0ZTogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90LnNwbGl0KCIgIilbMF0sCiAgICAgICAgICBpc19lZGl0OiB0aGlzLmlzRWRpdCwKICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX2lkLAogICAgICAgICAgYXBwb2ludG1lbnRfaW5mbzogYXBwb2ludG1lbnRfcGF5bG9hZAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIkVkaXQgQXBwb2ludG1lbnQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIGFwcG9pbnRtZW50IGhhcyBiZWVuIGVkaXRlZCBzdWNjZXNzZnVsbHkuIik7CgogICAgICAgICAgICBfdGhpczcuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIik7CgogICAgICAgICAgICBfdGhpczcudXBkYXRlX3NjaGVkdWxlc19saXN0KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgICBfdGhpczcuaGlkZV9tb2RhbCgic2NoZWR1bGVfZGV0YWlscyIpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgIF90aGlzNy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9heGlvcyRwb3N0OwoKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfYXBwb2ludG1lbnRfdXJsKCksIChfYXhpb3MkcG9zdCA9IHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHBob25lX251bWJlcjogdGhpcy52aXNpdG9yX251bWJlciwKICAgICAgICAgIGNhbmRpZGF0ZV9uYW1lOiB0aGlzLmNhbmRpZGF0ZV9uYW1lLAogICAgICAgICAgY2FuZGlkYXRlX3Bvc2l0aW9uOiB0aGlzLmNhbmRpZGF0ZV9wb3NpdGlvbgogICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgImNhbmRpZGF0ZV9wb3NpdGlvbiIsIHRoaXMuY2FuZGlkYXRlX2VtYWlsKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAidmlzaXRfc2xvdCIsIHRoaXMuc2VsZWN0ZWRfdGltZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInZpc2l0X2RhdGUiLCAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlKSwgX2F4aW9zJHBvc3QpLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tc2cgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubXNnID09ICJBcHBvaW50bWVudCBBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIGFwcG9pbnRtZW50IGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LiIpOwoKICAgICAgICAgICAgX3RoaXM3LmhpZGVfbW9kYWwoInNjaGVkdWxlX2NyZWF0ZSIpOwoKICAgICAgICAgICAgX3RoaXM3LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgICAgX3RoaXM3LmhpZGVfbW9kYWwoInNjaGVkdWxlX2NyZWF0ZSIpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgIF90aGlzNy5oaWRlX21vZGFsKCJzY2hlZHVsZV9jcmVhdGUiKTsKCiAgICAgICAgICBfdGhpczcuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfYXBwb2ludG1lbnQ6IGZ1bmN0aW9uIGRlbGV0ZV9hcHBvaW50bWVudCgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBzd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIllvdSB3b24ndCBiZSBhYmxlIHRvIHJldmVydCB0aGlzISIsCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgZGVsZXRlISEiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIF90aGlzOC5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfZWRpdF9kZWxldGVfdXJsKCksIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19kZWxldGU6IHRydWUsCiAgICAgICAgICAgIGRhdGU6IF90aGlzOC5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90LnNwbGl0KCIgIilbMF0sCiAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiBfdGhpczguc2VsZWN0ZWRfc2NoZWR1bGVfaWQKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM4LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM4LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgX3RoaXM4LmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiRGVsZXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gZGVsZXRlZCBzdWNjZXNzZnVsbHkuIik7CgogICAgICAgICAgICAgIF90aGlzOC51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgICAgIF90aGlzOC5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgICBfdGhpczguaGlkZV9tb2RhbCgic2NoZWR1bGVfZGV0YWlscyIpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICByZW5kZXJfc2NoZWR1bGU6IGZ1bmN0aW9uIHJlbmRlcl9zY2hlZHVsZShkYXRhKSB7CiAgICAgIHZhciBzY2hlZHVsZSA9IFtdOwoKICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgZm9yICh2YXIgaiBpbiBkYXRhW2ldKSB7CiAgICAgICAgICBpZiAoaiA9PSAiSG9saWRheSIpIHsKICAgICAgICAgICAgc2NoZWR1bGUucHVzaCh7CiAgICAgICAgICAgICAgaWQ6IGosCiAgICAgICAgICAgICAgY2FsZW5kYXJJZDogIjEiLAogICAgICAgICAgICAgIHRpdGxlOiAiSG9saWRheSIsCiAgICAgICAgICAgICAgY2F0ZWdvcnk6ICJ0aW1lIiwKICAgICAgICAgICAgICBkdWVEYXRlQ2xhc3M6ICIiLAogICAgICAgICAgICAgIHJhdzogewogICAgICAgICAgICAgICAgcmVhc29uOiBkYXRhW2ldW2pdLlJlYXNvbiwKICAgICAgICAgICAgICAgIGlzSG9saWRheTogdHJ1ZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMuc2V0X3RpbWVfaW50ZXJ2YWxzKGksICIwMDowMCIpLAogICAgICAgICAgICAgIGVuZDogdGhpcy5zZXRfdGltZV9pbnRlcnZhbHMoaSwgIjIzOjU5IikKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBBcHBvaW50bWVudFN0YXR1czogIm5vbmUiCiAgICAgICAgICAgIC8vIFBob25lTnVtYmVyOiAiKzkxOTg2OTUzMzkwNzYiCiAgICAgICAgICAgIC8vIFJlc2NoZWR1bGVkQXBwb2ludG1lbnRGcm9tOiBudWxsCiAgICAgICAgICAgIC8vIFJlc2NoZWR1bGVkQXBwb2ludG1lbnRUbzogbnVsbAogICAgICAgICAgICAvLyBSZXNjaGVkdWxlZEZyb206IG51bGwKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRUbzogbnVsbAogICAgICAgICAgICAvLyBTeW1wdG9tczogImpqampqIgogICAgICAgICAgICAvLyBWaXNpdERhdGU6ICJUdWUsIDE5IEFwciAyMDIyIDAwOjAwOjAwIEdNVCIKICAgICAgICAgICAgLy8gVmlzaXRSZWFzb246ICJnZ2ciCiAgICAgICAgICAgIC8vIFZpc2l0U2xvdDogIjIwMjItMDQtMTkgMDg6MDAtMDk6MDAiCiAgICAgICAgICAgIC8vIFZpc2l0U3RhdHVzOiAibm90LXZpc2l0ZWQiCiAgICAgICAgICAgIC8vIFZpc2l0b3JOYW1lOiAiYWtpIgogICAgICAgICAgICAvLyBBcHBvaW50bWVudFN0YXR1czogIm5vbmUiCiAgICAgICAgICAgIC8vIENhbmRpZGF0ZUNvbnRhY3ROdW1iZXI6ICI4ODg4ODk5OTk5IgogICAgICAgICAgICAvLyBDYW5kaWRhdGVFbWFpbDogInNhZ2FyLmJoYW51c2hhbGlAc2FrZWMuYWMuaW4iCiAgICAgICAgICAgIC8vIENhbmRpZGF0ZU5hbWU6ICJzYWdhciBiaGFudXNoYWxpIgogICAgICAgICAgICAvLyBDYW5kaWRhdGVQb3NpdGlvbjogIlB5dGhvbiIKICAgICAgICAgICAgLy8gQ2FuZGlkYXRlVmlzaXRTbG90OiAiMjAyMi0wNC0yMCAwOTo0NS0xMDoxNSIKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRBcHBvaW50bWVudEZyb206IG51bGwKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRBcHBvaW50bWVudFRvOiBudWxsCiAgICAgICAgICAgIC8vIFJlc2NoZWR1bGVkRnJvbTogbnVsbAogICAgICAgICAgICAvLyBSZXNjaGVkdWxlZFRvOiBudWxsCiAgICAgICAgICAgIC8vIFZpc2l0RGF0ZTogIldlZCwgMjAgQXByIDIwMjIgMDA6MDA6MDAgR01UIgogICAgICAgICAgICAvLyBWaXNpdFN0YXR1czogIm5vdC12aXNpdGVkIgogICAgICAgICAgICBzY2hlZHVsZS5wdXNoKHsKICAgICAgICAgICAgICBpZDogaiwKICAgICAgICAgICAgICBjYWxlbmRhcklkOiAiMSIsCiAgICAgICAgICAgICAgdGl0bGU6IGRhdGFbaV1bal0uQ2FuZGlkYXRlTmFtZSwKICAgICAgICAgICAgICAvL3RpdGxlOiB0aGlzLmNhbGVuZGFySW5zdGFuY2UudGVtcGxhdGUoKSwKICAgICAgICAgICAgICBjYXRlZ29yeTogInRpbWUiLAogICAgICAgICAgICAgIGR1ZURhdGVDbGFzczogIiIsCiAgICAgICAgICAgICAgcmF3OiB7CiAgICAgICAgICAgICAgICBwaG9uZV9udW1iZXI6IGRhdGFbaV1bal0uQ2FuZGlkYXRlQ29udGFjdE51bWJlciwKICAgICAgICAgICAgICAgIGNhbmRpZGF0ZV9wb3NpdGlvbjogZGF0YVtpXVtqXS5DYW5kaWRhdGVQb3NpdGlvbiwKICAgICAgICAgICAgICAgIGNhbmRpZGF0ZV9lbWFpbDogZGF0YVtpXVtqXS5DYW5kaWRhdGVFbWFpbCwKICAgICAgICAgICAgICAgIC8vIHJlYXNvbjogZGF0YVtpXVtqXS5WaXNpdFJlYXNvbiwKICAgICAgICAgICAgICAgIC8vIHN5bXB0b21zOiBkYXRhW2ldW2pdLlN5bXB0b21zLAogICAgICAgICAgICAgICAgdmlzaXRfc2xvdDogZGF0YVtpXVtqXS5DYW5kaWRhdGVWaXNpdFNsb3QsCiAgICAgICAgICAgICAgICBzdGFydDogZGF0YVtpXVtqXS5DYW5kaWRhdGVWaXNpdFNsb3Quc3BsaXQoIiAiKVsxXS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAgICAgZW5kOiBkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzFdLnNwbGl0KCItIilbMV0sCiAgICAgICAgICAgICAgICBpc0hvbGlkYXk6IGZhbHNlLAogICAgICAgICAgICAgICAgYXBwb2ludG1lbnRfc3RhdHVzOiBkYXRhW2ldW2pdLkFwcG9pbnRtZW50U3RhdHVzLAogICAgICAgICAgICAgICAgdmlzaXRfc3RhdHVzOiBkYXRhW2ldW2pdLlZpc2l0U3RhdHVzLAogICAgICAgICAgICAgICAgYXBwb2ludG1lbnRfaWQ6IGoKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnNldF90aW1lX2ludGVydmFscyhkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzBdLCBkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzFdLnNwbGl0KCItIilbMF0pLAogICAgICAgICAgICAgIGVuZDogZGF0YVtpXVtqXS5DYW5kaWRhdGVWaXNpdFNsb3Quc3BsaXQoIiAiKVsxXS5zcGxpdCgiLSIpWzFdID09ICIwMDowMCIgPyB0aGlzLnNldF90aW1lX2ludGVydmFscyhkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzBdLCAiMjM6NTkiKSA6IHRoaXMuc2V0X3RpbWVfaW50ZXJ2YWxzKGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sIGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMV0uc3BsaXQoIi0iKVsxXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnNjaGVkdWxlX2xpc3QgPSBzY2hlZHVsZTsKICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLmNsZWFyKCk7CiAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5jcmVhdGVTY2hlZHVsZXMoc2NoZWR1bGUpOwogICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UucmVuZGVyKCk7CiAgICB9LAogICAgc2V0UmVuZGVyUmFuZ2VUZXh0OiBmdW5jdGlvbiBzZXRSZW5kZXJSYW5nZVRleHQoKSB7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgIHZhciByZW5kZXJSYW5nZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZW5kZXJSYW5nZSIpOwogICAgICB2YXIgb3B0aW9ucyA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXRPcHRpb25zKCk7CiAgICAgIHZhciB2aWV3TmFtZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXRWaWV3TmFtZSgpOwogICAgICB2YXIgaHRtbCA9IFtdOwoKICAgICAgaWYgKHZpZXdOYW1lID09PSAibW9udGgiICYmICghb3B0aW9ucy5tb250aC52aXNpYmxlV2Vla3NDb3VudCB8fCBvcHRpb25zLm1vbnRoLnZpc2libGVXZWVrc0NvdW50ID4gNCkgfHwgdmlld05hbWUgPT09ICJkYXkiKSB7CiAgICAgICAgaHRtbC5wdXNoKG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSkuZm9ybWF0KCJNTU1NIFlZWVkiKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlUmFuZ2VTdGFydCgpLmdldFRpbWUoKTsKICAgICAgICB2YXIgZW5kRGF0ZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlUmFuZ2VFbmQoKS5nZXRUaW1lKCk7CgogICAgICAgIGlmIChtb21lbnQoZW5kRGF0ZSkuc3VidHJhY3Qoc3RhcnREYXRlLCAneWVhcicpKSB7CiAgICAgICAgICBodG1sLnB1c2goIiIuY29uY2F0KG1vbWVudChzdGFydERhdGUpLmZvcm1hdCgiRCBNTU1NIFlZWVkiKSwgIiB0byAiKS5jb25jYXQobW9tZW50KGVuZERhdGUpLmZvcm1hdCgiRCBNTU1NIFlZWVkiKSkpOwogICAgICAgIH0gZWxzZSBpZiAobW9tZW50KGVuZERhdGUpLnN1YnRyYWN0KHN0YXJ0RGF0ZSwgJ21vbnRoJykpIHsKICAgICAgICAgIGh0bWwucHVzaCgiIi5jb25jYXQobW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJEIE1NTU0iKSwgIiB0byAiKS5jb25jYXQobW9tZW50KGVuZERhdGUpLmZvcm1hdCgiRCBNTU1NIFlZWVkiKSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBodG1sLnB1c2goIiIuY29uY2F0KG1vbWVudChzdGFydERhdGUpLmZvcm1hdCgiRCIpLCAiIHRvICIpLmNvbmNhdChtb21lbnQoZW5kRGF0ZSkuZm9ybWF0KCJEIE1NTU0gWVlZWSIpKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmdlbmVyYXRlX2RheXNfaW5fbW9udGgobW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoJ0QnKSwgbW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoJ01NTU0nKSwgbW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoIllZWVkiKSk7CiAgICAgIHJlbmRlclJhbmdlLmlubmVySFRNTCA9IGh0bWwuam9pbigiIik7CiAgICAgIHRoaXMuZGFpbHlfZGF0ZSA9IHJlbmRlclJhbmdlLmlubmVySFRNTDsKICAgIH0sCiAgICBkYXRlX2NvbmRpdGlvbjogZnVuY3Rpb24gZGF0ZV9jb25kaXRpb24oZnJvbV9vYmplY3QsIHRvX29iamVjdCkgewogICAgICBpZiAoZnJvbV9vYmplY3QgIT09IG51bGwgJiYgdG9fb2JqZWN0ICE9PSBudWxsKSB7CiAgICAgICAgaWYgKHRvX29iamVjdC5nZXRGdWxsWWVhcigpID4gZnJvbV9vYmplY3QuZ2V0RnVsbFllYXIoKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmICh0b19vYmplY3QuZ2V0RnVsbFllYXIoKSA9PSBmcm9tX29iamVjdC5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICBpZiAodG9fb2JqZWN0LmdldE1vbnRoKCkgPiBmcm9tX29iamVjdC5nZXRNb250aCgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmICh0b19vYmplY3QuZ2V0TW9udGgoKSA9PSBmcm9tX29iamVjdC5nZXRNb250aCgpKSB7CiAgICAgICAgICAgIGlmIChOdW1iZXIodG9fb2JqZWN0LmdldERhdGUoKSkgPj0gTnVtYmVyKGZyb21fb2JqZWN0LmdldERhdGUoKSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChmcm9tX29iamVjdCA9PT0gbnVsbCAmJiB0b19vYmplY3QgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICB0b2dnbGVfdmlldzogZnVuY3Rpb24gdG9nZ2xlX3ZpZXcodHlwZSkgewogICAgICBpZiAodHlwZSA9PSAiZGF5IikgewogICAgICAgIHRoaXMuc2hvd19jaGVja19hbmRfY2hhbmdlX3N0YXR1cyA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X2NoZWNrX2FuZF9jaGFuZ2Vfc3RhdHVzID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5jaGFuZ2VWaWV3KHR5cGUsIHRydWUpOwogICAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgfSwKICAgIHN3aXRjaF9jYWxlbmRhcjogZnVuY3Rpb24gc3dpdGNoX2NhbGVuZGFyKHR5cGUsIGRhdGUpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAodHlwZSA9PSAidG9kYXkiKSB7CiAgICAgICAgdGhpcy5jdXJyZW50X2NhbGVuZGFyX3ZpZXcgPSAiZGF5IjsKICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UudG9kYXkoKTsgLy8gdGhpcy5zZXRSZW5kZXJSYW5nZVRleHQoKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJ3ZWVrIiB8fCB0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJkYXkiKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gIm5leHQiKSB7CiAgICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UubmV4dCgpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicHJldiIpIHsKICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5wcmV2KCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJjdXN0b20iKSB7CiAgICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2Uuc2V0RGF0ZShuZXcgRGF0ZSh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLnNldERhdGUoZGF0ZSkpKTsKICAgICAgICB9IC8vIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CgogICAgICB9IGVsc2UgaWYgKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gIm1vbnRoIikgewogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKCiAgICAgICAgaWYgKHR5cGUgPT0gIm5leHQiKSB7CiAgICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UubmV4dCgpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicHJldiIpIHsKICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5wcmV2KCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX2dldF9zY2hlZHVsZV9pbmZvX3VybCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBmaXJzdF9kYXk6IHRoaXMubW9udGhfcmFuZ2UoInN0YXJ0X3RpbWUiKSwKICAgICAgICBsYXN0X2RheTogdGhpcy5tb250aF9yYW5nZSgiZW5kX3RpbWUiKQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM5LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBfdGhpczkucmVuZGVyX3NjaGVkdWxlKHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICB9LAogICAgbW9udGhfcmFuZ2U6IGZ1bmN0aW9uIG1vbnRoX3JhbmdlKHR5cGUpIHsKICAgICAgdmFyIHRpbWUgPSBtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpOwogICAgICB0aW1lID0gbW9tZW50KHRpbWUpLmRheXNJbk1vbnRoKCk7CgogICAgICBpZiAodHlwZSA9PSAic3RhcnRfdGltZSIpIHsKICAgICAgICB2YXIgc3RhcnRfdGltZSA9IG51bGw7CgogICAgICAgIGlmICh0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJ3ZWVrIikgewogICAgICAgICAgc3RhcnRfdGltZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fcmVuZGVyUmFuZ2Uuc3RhcnQuX2RhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXJ0X3RpbWUgPSBuZXcgRGF0ZSh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLl9kYXRlLmdldEZ1bGxZZWFyKCksIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuX2RhdGUuZ2V0TW9udGgoKSwgMSk7CiAgICAgICAgfQoKICAgICAgICBzdGFydF90aW1lID0gc3RhcnRfdGltZS5nZXRGdWxsWWVhcigpICsgIi0iICsgKHN0YXJ0X3RpbWUuZ2V0TW9udGgoKSA8IDkgPyAiMCIgKyAoc3RhcnRfdGltZS5nZXRNb250aCgpICsgMSkgOiBzdGFydF90aW1lLmdldE1vbnRoKCkgKyAxKSArICItIiArIChzdGFydF90aW1lLmdldERhdGUoKSA8IDEwID8gIjAiICsgc3RhcnRfdGltZS5nZXREYXRlKCkgOiBzdGFydF90aW1lLmdldERhdGUoKSk7CiAgICAgICAgcmV0dXJuIHN0YXJ0X3RpbWU7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiZW5kX3RpbWUiKSB7CiAgICAgICAgdmFyIGVuZF90aW1lID0gbnVsbDsKCiAgICAgICAgaWYgKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gIndlZWsiKSB7CiAgICAgICAgICBlbmRfdGltZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fcmVuZGVyUmFuZ2UuZW5kLl9kYXRlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbmRfdGltZSA9IG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuX2RhdGUuZ2V0RnVsbFllYXIoKSwgdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5fZGF0ZS5nZXRNb250aCgpLCB0aW1lKTsKICAgICAgICB9CgogICAgICAgIGVuZF90aW1lID0gZW5kX3RpbWUuZ2V0RnVsbFllYXIoKSArICItIiArIChlbmRfdGltZS5nZXRNb250aCgpIDwgOSA/ICIwIiArIChlbmRfdGltZS5nZXRNb250aCgpICsgMSkgOiBlbmRfdGltZS5nZXRNb250aCgpICsgMSkgKyAiLSIgKyAoZW5kX3RpbWUuZ2V0RGF0ZSgpIDwgMTAgPyAiMCIgKyBlbmRfdGltZS5nZXREYXRlKCkgOiBlbmRfdGltZS5nZXREYXRlKCkpOwogICAgICAgIHJldHVybiBlbmRfdGltZTsKICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlX2RheXNfaW5fbW9udGg6IGZ1bmN0aW9uIGdlbmVyYXRlX2RheXNfaW5fbW9udGgoZGF5LCBtb250aCwgeWVhcikgewogICAgICB2YXIgdG90YWxfZGF5cyA9IG1vbWVudCgiIi5jb25jYXQobW9udGgsICIgIikuY29uY2F0KHllYXIpLCBbJ01NTU0gWVlZWSddKS5kYXlzSW5Nb250aCgpOwogICAgICB0aGlzLmRheXNJbk1vbnRoID0gW107CgogICAgICBmb3IgKHZhciBpID0gMSwgbiA9IHRvdGFsX2RheXM7IGkgPD0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5kYXlzSW5Nb250aC5wdXNoKHsKICAgICAgICAgIGRheTogbW9tZW50KCIiLmNvbmNhdChpLCAiICIpLmNvbmNhdChtb250aCwgIiAiKS5jb25jYXQoeWVhciksIFsnRCBNTU1NIFlZWVknXSkuZm9ybWF0KCdkZCcpLAogICAgICAgICAgZGF0ZTogaSwKICAgICAgICAgIGlzX2FjdGl2ZTogbW9tZW50KCIiLmNvbmNhdChkYXksICIgIikuY29uY2F0KG1vbnRoLCAiICIpLmNvbmNhdCh5ZWFyKSwgWydEIE1NTU0gWVlZWSddKS5pc1NhbWUobW9tZW50KCIiLmNvbmNhdChpLCAiICIpLmNvbmNhdChtb250aCwgIiAiKS5jb25jYXQoeWVhciksIFsnRCBNTU1NIFlZWVknXSksICdkYXknKQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc2V0X3RpbWVfaW50ZXJ2YWxzOiBmdW5jdGlvbiBzZXRfdGltZV9pbnRlcnZhbHMoeWVhciwgdGltZSkgewogICAgICB2YXIgdm0gPSBuZXcgRGF0ZSh5ZWFyLnNwbGl0KCItIilbMF0sIHllYXIuc3BsaXQoIi0iKVsxXSAtIDEsIHllYXIuc3BsaXQoIi0iKVsyXSwgdGltZS5zcGxpdCgiOiIpWzBdLCB0aW1lLnNwbGl0KCI6IilbMV0pOwogICAgICB2bSA9IG1vbWVudCh2bSkuZm9ybWF0KCk7CiAgICAgIHJldHVybiB2bTsKICAgIH0sCiAgICBvcGVuQ2hlY2tBbmRDaGFuZ2VTdGF0dXNNb2RhbDogZnVuY3Rpb24gb3BlbkNoZWNrQW5kQ2hhbmdlU3RhdHVzTW9kYWwoQXBwb2ludG1lbnRJRCwgc2NoZWR1bGVEYXRlKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsgLy8gdmFyIGRhdGVUb1NlbmQgPSBtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpLmZvcm1hdCgKICAgICAgLy8gICAiWVlZWS1NTS1ERCIKICAgICAgLy8gKTsKCiAgICAgIHZhciBkYXRlVG9TZW5kID0gbW9tZW50KHNjaGVkdWxlRGF0ZSkuZm9ybWF0KCJZWVlZLU1NLUREIik7IC8vIHZhciBkYXRlb2JqID0gbmV3IERhdGUobW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoIk1NTU0gREQsIFlZWVkiKSk7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ocl92aXNpdF9zdGF0dXNfaW5mbygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBkYXRlOiBkYXRlVG9TZW5kLAogICAgICAgIGlzX2dldDogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5sZW5ndGggIT0gMCkgewogICAgICAgICAgdmFyIGFwcG9pbnRtZW50RmlsdGVyID0gcmVzcG9uc2UuZGF0YS5kYXRhLmZpbHRlcihmdW5jdGlvbiAoYXBwdCkgewogICAgICAgICAgICByZXR1cm4gYXBwdFsiQXBwb2ludG1lbnRJRCJdID09IEFwcG9pbnRtZW50SUQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoYXBwb2ludG1lbnRGaWx0ZXIubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIF90aGlzMTAudmlzaXRTdGF0dXMgPSBhcHBvaW50bWVudEZpbHRlclswXVsiVmlzaXRTdGF0dXMiXTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgdmFyIGNvbmZpcm1lZF9hcHB0ID0gW107CiAgICAgICAgICB2YXIgbm9uZV9hcHB0ID0gW107CiAgICAgICAgICB2YXIgcmVzY2hlZHVsZV9hcHB0ID0gW107CiAgICAgICAgICB2YXIgZGVsZXRlZF9hcHB0ID0gW107IC8vIHRoaXMudmlzaXRfc3RhdHVzX2NvbXBhcmlzb25fZGF0YSA9IHRoaXMudmlzaXRfc3RhdHVzX2RhdGEuc2xpY2UoKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBfdGhpczEwLnNjaGVkdWxlX2xpc3QubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAvLyB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJDb21wYXJlVmlzaXRTdGF0dXMiXSA9CiAgICAgICAgICAgICAgLy8gICByZXNwb25zZS5kYXRhLmRhdGFbaV0uVmlzaXRTdGF0dXM7CiAgICAgICAgICAgICAgaWYgKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRJRCA9PT0gX3RoaXMxMC5zY2hlZHVsZV9saXN0W2pdLmlkKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJBcHBvaW50bWVudFN0YXR1cyJdID0gX3RoaXMxMC5zY2hlZHVsZV9saXN0W2pdLnJhdy5hcHBvaW50bWVudF9zdGF0dXM7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkFwcG9pbnRtZW50U3RhdHVzIl0gPT09ICdjb25maXJtZWQnKSB7CiAgICAgICAgICAgICAgICAgIGNvbmZpcm1lZF9hcHB0LnB1c2goX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkFwcG9pbnRtZW50U3RhdHVzIl0gPT09ICdub25lJykgewogICAgICAgICAgICAgICAgICBub25lX2FwcHQucHVzaChfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQXBwb2ludG1lbnRTdGF0dXMiXSA9PT0gJ3Jlc2NoZWR1bGVkJykgewogICAgICAgICAgICAgICAgICByZXNjaGVkdWxlX2FwcHQucHVzaChfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQXBwb2ludG1lbnRTdGF0dXMiXSA9PT0gJ2RlbGV0ZWQnKSB7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZWRfYXBwdC5wdXNoKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV0pOwogICAgICAgICAgICAgICAgfSAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSA9IFtdOwogICAgICAgICAgICAgICAgLy8gIHRoaXMudmlzaXRfc3RhdHVzX2RhdGEgKz0gbm9uZV9hcHB0OwogICAgICAgICAgICAgICAgLy8gIHRoaXMudmlzaXRfc3RhdHVzX2RhdGEgKz0gY29uZmlybWVkX2FwcHQ7CiAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSByZXNjaGVkdWxlX2FwcHQ7CiAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSBkZWxldGVkX2FwcHQ7CgogICAgICAgICAgICAgIH0gLy8gdGhpcy52aXNpdF9zdGF0dXNfY29tcGFyaXNvbl9kYXRhLnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhW2ldKTsKCgogICAgICAgICAgICAgIF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkNvbXBhcmVWaXNpdFN0YXR1cyJdID0gcmVzcG9uc2UuZGF0YS5kYXRhW2ldLlZpc2l0U3RhdHVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YSA9IFtdOwogICAgICAgICAgX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YSA9IF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGEuY29uY2F0KG5vbmVfYXBwdCwgY29uZmlybWVkX2FwcHQsIHJlc2NoZWR1bGVfYXBwdCwgZGVsZXRlZF9hcHB0KTsgLy8gIHRoaXMudmlzaXRfc3RhdHVzX2RhdGEuY29uY2F0KCBjb25maXJtZWRfYXBwdCk7CiAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5jb25jYXQocmVzY2hlZHVsZV9hcHB0KTsKICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmNvbmNhdChkZWxldGVkX2FwcHQpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT09ICdObyBBcHBvaW50bWVudHMgU2NoZWR1bGVkJyB8fCByZXNwb25zZS5kYXRhLmRhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhID0gW107CiAgICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgICB0ZXh0OiAiTm8gQXBwb2ludG1lbnRzIGhhdmUgYmVlbiBzY2hlZHVsZWQgZm9yICIgKyAiICIgKyBfdGhpczEwLmRhaWx5X2RhdGUsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiT2theSIKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge30pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIF90aGlzMTAuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgfSk7CiAgICB9LAogICAgY2hhbmdlU2luZ2xlVmlzaXRTdGF0dXM6IGZ1bmN0aW9uIGNoYW5nZVNpbmdsZVZpc2l0U3RhdHVzKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBkYXRlVG9TZW5kID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsKICAgICAgdmFyIGZvcm1MZW5ndGggPSB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmxlbmd0aDsKICAgICAgdmFyIGFycmF5ID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1MZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkFwcG9pbnRtZW50SUQgPT09IHRoaXMuQXBwb2ludG1lbnRJRCkgewogICAgICAgICAgYXJyYXkucHVzaCh7CiAgICAgICAgICAgIEFwcG9pbnRtZW50SUQ6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRJRCwKICAgICAgICAgICAgVmlzaXRvck5hbWU6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRvck5hbWUsCiAgICAgICAgICAgIFZpc2l0U2xvdDogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdFNsb3QsCiAgICAgICAgICAgIEFwcG9pbnRtZW50U3RhdHVzOiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkFwcG9pbnRtZW50U3RhdHVzLAogICAgICAgICAgICBWaXNpdFN0YXR1czogdGhpcy52aXNpdFN0YXR1cwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoYXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX3Zpc2l0X3N0YXR1c19pbmZvKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHJlc3BvbnNlX3Zpc2l0X3N0YXR1czogYXJyYXksCiAgICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgICAgZGF0ZTogZGF0ZVRvU2VuZAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIlZpc2l0IFN0YXR1cyBFZGl0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJWaXNpdCBTdGF0dXMgQ2hhbmdlZCBTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMTEuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZCIpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZCIpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY2hhbmdlVmlzaXRTdGF0dXM6IGZ1bmN0aW9uIGNoYW5nZVZpc2l0U3RhdHVzKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBkYXRlVG9TZW5kID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsKICAgICAgdmFyIGZvcm1MZW5ndGggPSB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmxlbmd0aDsKICAgICAgdmFyIGFycmF5ID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1MZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkNvbXBhcmVWaXNpdFN0YXR1cyA9PT0gdGhpcy52aXNpdFN0YXR1cyAvLyB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLlZpc2l0U3RhdHVzCiAgICAgICAgKSB7fSBlbHNlIHsKICAgICAgICAgIGFycmF5LnB1c2goewogICAgICAgICAgICBBcHBvaW50bWVudElEOiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkFwcG9pbnRtZW50SUQsCiAgICAgICAgICAgIFZpc2l0b3JOYW1lOiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLlZpc2l0b3JOYW1lLAogICAgICAgICAgICBWaXNpdFNsb3Q6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRTbG90LAogICAgICAgICAgICBBcHBvaW50bWVudFN0YXR1czogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudFN0YXR1cywKICAgICAgICAgICAgVmlzaXRTdGF0dXM6IHRoaXMudmlzaXRTdGF0dXMgLy8gVmlzaXRTdGF0dXM6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRTdGF0dXMKCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfdmlzaXRfc3RhdHVzX2luZm8oKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgcmVzcG9uc2VfdmlzaXRfc3RhdHVzOiBhcnJheSwKICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICBkYXRlOiBkYXRlVG9TZW5kCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEyLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiVmlzaXQgU3RhdHVzIEVkaXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIlZpc2l0IFN0YXR1cyBDaGFuZ2VkIFN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBfdGhpczEyLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjb25maXJtUmVzY2hlZHVsZTogZnVuY3Rpb24gY29uZmlybVJlc2NoZWR1bGUoKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHZhciBpc19pbnZhbGlkID0gbW9tZW50KHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlLCBbJ01NLURELVlZWVknXSkuZGlmZihtb21lbnQoJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSwgWydZWVlZLU1NLUREJ10pLCAiZGF5IikgPT09IDAgJiYgdGhpcy50ZW1wX2FwcG9pbnRtZW50X3RpbWUgPT0gdGhpcy5zZWxlY3RlZF90aW1lOwoKICAgICAgaWYgKGlzX2ludmFsaWQpIHsKICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGV4dDogIkl0IGxvb2tzIGxpa2UgeW91IGhhdmUgbm90IG1hZGUgYW55IGNoYW5nZSB0byB0aGUgYXBwb2ludG1lbnQgZGF0ZSBhbmQgYXBwb2ludG1lbnQgdGltZSIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIHRpbWVyOiA5MDAwCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbGxlZF90aW1lX3Nsb3RzX3NlbGVjdGVkX2RhdGUuaW5jbHVkZXModGhpcy5zZWxlY3RlZF90aW1lKSB8fCB0aGlzLnNlbGVjdGVkX3RpbWUgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9heGlvcyRwb3N0MjsKCiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIHZhciBkYXRlU2VsZWN0ZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGF0ZXBpY2tlci1pbnB1dCIpLnZhbHVlOwogICAgICAgIHZhciBwcmV2aW91c0RhdGUgPSBtb21lbnQodGhpcy50ZW1wX2FwcG9pbnRtZW50X2RhdGUsIFsnTU0tREQtWVlZWSddKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ocl9yZXNjaGVkdWxlX2FwcG9pbnRtZW50KCksIChfYXhpb3MkcG9zdDIgPSB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIHBob25lX251bWJlcjogdGhpcy52aXNpdG9yX251bWJlciwKICAgICAgICAgIGNhbmRpZGF0ZV9uYW1lOiB0aGlzLmNhbmRpZGF0ZV9uYW1lLAogICAgICAgICAgY2FuZGlkYXRlX3Bvc2l0aW9uOiB0aGlzLmNhbmRpZGF0ZV9wb3NpdGlvbiwKICAgICAgICAgIHZpc2l0X3Nsb3Q6IHRoaXMuc2VsZWN0ZWRfdGltZQogICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJjYW5kaWRhdGVfcG9zaXRpb24iLCB0aGlzLmNhbmRpZGF0ZV9wb3NpdGlvbiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJjYW5kaWRhdGVfZW1haWwiLCB0aGlzLmNhbmRpZGF0ZV9lbWFpbCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJ2aXNpdF9kYXRlIiwgZGF0ZVNlbGVjdGVkKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInByZXZpb3VzX3Zpc2l0X2RhdGUiLCBwcmV2aW91c0RhdGUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAidG9rZW4iLCB0aGlzLiRzZXNzaW9uLmdldCgiQm90VG9rZW4iKSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJhcHBvaW50bWVudF9pZCIsIHRoaXMuc2VsZWN0ZWRfc2NoZWR1bGVfaWQpLCBfYXhpb3MkcG9zdDIpLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIC8vIHRoaXMuaGlkZV9tb2RhbCgic2NoZWR1bGluZ19tb2RhbCIpCiAgICAgICAgICBfdGhpczEzLmVkaXRfc2NoZWR1bGluZyA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzMTMuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIik7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJBcHBvaW50bWVudCBSZXNjaGVkdWxlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIF90aGlzMTMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJBcHBvaW50bWVudCBIYXMgQmVlbiBSZXNjaGVkdWxlZCBTdWNjZXNzZnVsbHkiKTsKCiAgICAgICAgICAgIF90aGlzMTMudXBkYXRlX3NjaGVkdWxlc19saXN0KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczEzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgX3RoaXMxMy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKCiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZXRoaW5nIFdlbnQgV3JvbmciKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIC8vICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgIC8vIH0sIDEwMDApOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgX3RoaXMxMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZCIpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAga2VlcGNoZWNraW5nZGF0ZTogZnVuY3Rpb24ga2VlcGNoZWNraW5nZGF0ZSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICB0aGlzLmRhdGVwaWNrZXJJbnN0YW5jZS5vbigiY2xvc2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gdm0uc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICB2bS5jaGVja2RhdGUoKTsKICAgICAgfSk7CiAgICB9LAogICAgY2hlY2tkYXRlOiBmdW5jdGlvbiBjaGVja2RhdGUoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIC8vZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGR0ID0gbmV3IERhdGUoKTsKCiAgICAgIGlmICh0aGlzLmRhdGVfY29uZGl0aW9uKGR0LCBuZXcgRGF0ZSgkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlKSkpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkX2RhdGUgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOwogICAgICAgIHZhciBzdGFydF9kYXRlID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsKICAgICAgICB2YXIgc2VsZWN0ZWRfdGltZSA9IHRoaXMuc2VsZWN0ZWRfdGltZTsKICAgICAgICB2YXIgdGltZSA9IGR0LmdldEhvdXJzKCkgKyAiOiIgKyBkdC5nZXRNaW51dGVzKCkgKyAiOiIgKyBkdC5nZXRTZWNvbmRzKCk7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfZ2V0X3NjaGVkdWxlX2FwcG9pbnRtZW50KCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLAogICAgICAgICAgRGF0ZTogdGhpcy5zZWxlY3RlZF9kYXRlLAogICAgICAgICAgYXBwb2ludG1lbnRfZGF0ZTogdGhpcy5zZWxlY3RlZF9kYXRlLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxNC5uZXdfc2VsZWN0ZWRfZGF0ZSA9ICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWU7IC8vICAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlID0gdGhpcy5zZWxlY3RlZF9kYXRlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09IG51bGwpIHt9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJQbGVhc2UgdXBkYXRlIHlvdXIgc2NoZWR1bGVyIHNldHRpbmdzIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGlmIChyZXNwb25zZS5kYXRhLkZ1bGxUaW1lU2xvdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gICB2YXIgZHQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAvLyAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzID0gW107CiAgICAgICAgICAgIC8vICAgdGhpcy50aW1lX3Nsb3RzID0gW107CiAgICAgICAgICAgIC8vICAgLy8gZm9yICh2YXIgaSBpbiB0aGlzLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAvLyAgIC8vICAgICB0aGlzLmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgLy8gICAvLyAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGEuRnVsbFRpbWVTbG90W2ldLAogICAgICAgICAgICAvLyAgIC8vICAgICB0ZXh0OiB0aGlzLmdlbmVyYXRlX3RpbWUoCiAgICAgICAgICAgIC8vICAgLy8gICAgICAgcmVzcG9uc2UuZGF0YS5GdWxsVGltZVNsb3RbaV0uc3BsaXQoIi0iKVswXSwKICAgICAgICAgICAgLy8gICAvLyAgICAgICByZXNwb25zZS5kYXRhLkZ1bGxUaW1lU2xvdFtpXS5zcGxpdCgiLSIpWzFdCiAgICAgICAgICAgIC8vICAgLy8gICAgICkKICAgICAgICAgICAgLy8gICAvLyAgICAgfSk7CiAgICAgICAgICAgIC8vICAgLy8gICBpZiAoCiAgICAgICAgICAgIC8vICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuQXZhaWxhYmxlVGltZVNsb3QuaW5kZXhPZigKICAgICAgICAgICAgLy8gICAvLyAgICAgICB0aGlzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZQogICAgICAgICAgICAvLyAgIC8vICAgICApID09IC0xCiAgICAgICAgICAgIC8vICAgLy8gICApIHsKICAgICAgICAgICAgLy8gICAvLyAgICAgdGhpcy50aW1lX3Nsb3RzLnB1c2godGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0pOwogICAgICAgICAgICAvLyAgIC8vICAgfQogICAgICAgICAgICAvLyAgIC8vIH0KICAgICAgICAgICAgLy8gICAgIGZvcih2YXIgaSBpbiByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzKXsKICAgICAgICAgICAgLy8gICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7CiAgICAgICAgICAgIC8vICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0sCiAgICAgICAgICAgIC8vICAgICAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKAogICAgICAgICAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXSwKICAgICAgICAgICAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0KICAgICAgICAgICAgLy8gICAgICAgICApCiAgICAgICAgICAgIC8vICAgICAgIH0pCiAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgIC8vICAgICAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlID0gdGhpcy5zZWxlY3RlZF9kYXRlCiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgX3RoaXMxNC5pc1Jlc2NoZWR1bGV0aW1lID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXMxNC5mdWxsX3RpbWVfc2xvdHMgPSBbXTsKICAgICAgICAgICAgX3RoaXMxNC50aW1lX3Nsb3RzID0gW107CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdmFyIGR0ID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICBfdGhpczE0LmZ1bGxfdGltZV9zbG90cyA9IFtdOwogICAgICAgICAgICAgIHZhciBnZXRfZnVsbF9zbG90X2xpc3QgPSB0cnVlOwogICAgICAgICAgICAgIHZhciB0ZW1wX3N0YXJ0X2RhdGUgPSBuZXcgRGF0ZShzdGFydF9kYXRlKTsKCiAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRGdWxsWWVhcigpID4gZHQuZ2V0RnVsbFllYXIoKSkge30gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgPT0gZHQuZ2V0RnVsbFllYXIoKSkgewogICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRNb250aCgpID4gZHQuZ2V0TW9udGgoKSkge30gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldE1vbnRoKCkgPT0gZHQuZ2V0TW9udGgoKSkgewogICAgICAgICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA+IGR0LmdldERhdGUoKSkge30gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA9PSBkdC5nZXREYXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICBnZXRfZnVsbF9zbG90X2xpc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGdldF9mdWxsX3Nsb3RfbGlzdCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgICAgICBfdGhpczE0LmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxNC5nZW5lcmF0ZV90aW1lKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0pCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgICAgIGlmIChkdC5nZXRIb3VycygpIDwgTnVtYmVyKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSkpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczE0LmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXSwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTQuZ2VuZXJhdGVfdGltZShyZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLCByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzFdKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAvLyBpZiAoc2VsZWN0ZWRfdGltZSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAvLyAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgLy8gICB0aGlzLnNlbGVjdGVkX3RpbWUgPSBzZWxlY3RlZF90aW1lOwogICAgICAgICAgICAgIC8vICAgdGhpcy5zY2hlZHVsZWRfdGltZSA9IHRoaXMuZ2VuZXJhdGVfdGltZSgKICAgICAgICAgICAgICAvLyAgICAgc2VsZWN0ZWRfdGltZS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMV0KICAgICAgICAgICAgICAvLyAgICk7CiAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChzZWxlY3RlZF90aW1lID09IHVuZGVmaW5lZCkgewoKCiAgICAgICAgICAgICAgX3RoaXMxNC5maWxsZWRfdGltZV9zbG90c19zZWxlY3RlZF9kYXRlID0gcmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90czsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZmlsbGVkX3RpbWVfc2xvdHMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIF90aGlzMTQudGltZV9zbG90cyA9IF90aGlzMTQuZnVsbF90aW1lX3Nsb3RzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczE0LnRpbWVfc2xvdHMgPSBbXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIF90aGlzMTQuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoX3RoaXMxNC5mdWxsX3RpbWVfc2xvdHNbaV0udmFsdWUpID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxNC50aW1lX3Nsb3RzLnB1c2goX3RoaXMxNC5mdWxsX3RpbWVfc2xvdHNbaV0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8vIHRoaXMudGltZV9zbG90cyA9IHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHM7CgogICAgICAgICAgICAgIH0gLy99CgogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgQSBWYWxpZCBEYXRlIik7CiAgICAgICAgdGhpcy5kYXRlcGlja2VySW5zdGFuY2Uub3BlbigpOwogICAgICAgICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUgPSB0aGlzLm5ld19zZWxlY3RlZF9kYXRlOwogICAgICB9CiAgICB9LAogICAgc2VuZF9yZW1pbmRlcjogZnVuY3Rpb24gc2VuZF9yZW1pbmRlcihBcHBvaW50bWVudElEKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiIFlvdSB3YW50IHRvIFNlbmQgdGhlIFJlbWluZGVyIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBTZW5kISEiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIF90aGlzMTUuc2hvd19zcGlubmVyID0gdHJ1ZTsgLy8gdmFyIHRvZGF5c19kYXRlID0gdGhpcy5kYWlseV9kYXRlOwoKICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoX3RoaXMxNS50ZW1wX2FwcG9pbnRtZW50X2RhdGUpOwogICAgICAgICAgdmFyIHByZXZpb3VzRGF0ZSA9IGQuZ2V0RnVsbFllYXIoKSArICItIiArIChkLmdldE1vbnRoKCkgKyAxKSArICItIiArIGQuZ2V0RGF0ZSgpOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2VuZF9yZW1pbmRlcigpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBhcHBvaW50bWVudF9pZDogQXBwb2ludG1lbnRJRCwKICAgICAgICAgICAgZGF0ZTogcHJldmlvdXNEYXRlLAogICAgICAgICAgICB2aXNpdF9zbG90OiBfdGhpczE1LmRpc3BsYXlfc2VsZWN0ZWRfdGltZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczE1LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxNS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN1Y2Nlc3MgPT0gdHJ1ZSkgewogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJOb3RpZmljYXRpb24gSGFzIGJlZW4gc2VudCIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2VzcyA9PSBmYWxzZSkgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiQ291bGQgTm90IFNlbmQgTm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICBfdGhpczE1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjb25maXJtQXBwb2ludG1lbnQ6IGZ1bmN0aW9uIGNvbmZpcm1BcHBvaW50bWVudCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGlzX2ludmFsaWQgPSBtb21lbnQoKS5kaWZmKG1vbWVudCgiIi5jb25jYXQodGhpcy50ZW1wX2FwcG9pbnRtZW50X3RpbWUsICIgIikuY29uY2F0KHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlKSwgWydISDptbSBNTS1ERC1ZWVlZJ10pLCAibWludXRlIikgPj0gMDsgLy8gaWYgKCh0aGlzLnRlbXBfYXBwb2ludG1lbnRfZGF0ZSAhPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlKSB8fCB0aGlzLnRlbXBfYXBwb2ludG1lbnRfdGltZSAhPSB0aGlzLnNlbGVjdGVkX3RpbWUpIHsKCiAgICAgIGlmIChpc19pbnZhbGlkKSB7CiAgICAgICAgc3dhbC5maXJlKHsKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRleHQ6ICJJdCBsb29rcyBsaWtlIHlvdSBoYXZlIG1hZGUgY2hhbmdlIHRvIHRoZSBhcHBvaW50bWVudCBkYXRlIGFuZCBhcHBvaW50bWVudCB0aW1lLCBzbyBwbGVhc2UgcmVzY2hlZHVsZSB0aGUgYXBwb2ludG1lbnQgZmlyc3QiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICB0aW1lcjogNTAwMAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge30pOwogICAgICB9IGVsc2UgewogICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgICAgdGV4dDogIiBZb3Ugd2FudCB0byBDb25maXJtIHRoZSBBcHBwb2ludG1lbnQ/IFRoaXMgd2lsbCBzZW5kIGEgbWVzc2FnZSB0byB0aGUgcGF0aWVudCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBpZiAoX3RoaXMxNi50ZW1wX25hbWUgIT0gX3RoaXMxNi5jYW5kaWRhdGVfbmFtZSB8fCBfdGhpczE2LnRlbXBfcG9zaXRpb24gIT0gX3RoaXMxNi5jYW5kaWRhdGVfcG9zaXRpb24gfHwgX3RoaXMxNi50ZW1wX2VtYWlsICE9IF90aGlzMTYuY2FuZGlkYXRlX2VtYWlsKSB7CiAgICAgICAgICAgICAgdmFyIF9hcHBvaW50bWVudF9wYXlsb2FkOwoKICAgICAgICAgICAgICAvLyBhbGVydCgiSGkiKTsKICAgICAgICAgICAgICB2YXIgYXBwb2ludG1lbnRfcGF5bG9hZCA9IChfYXBwb2ludG1lbnRfcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgIGNhbmRpZGF0ZV9uYW1lOiBfdGhpczE2LmNhbmRpZGF0ZV9uYW1lLAogICAgICAgICAgICAgICAgY2FuZGlkYXRlX3Bvc2l0aW9uOiBfdGhpczE2LmNhbmRpZGF0ZV9wb3NpdGlvbgogICAgICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXBwb2ludG1lbnRfcGF5bG9hZCwgImNhbmRpZGF0ZV9wb3NpdGlvbiIsIF90aGlzMTYuY2FuZGlkYXRlX2VtYWlsKSwgX2RlZmluZVByb3BlcnR5KF9hcHBvaW50bWVudF9wYXlsb2FkLCAiVmlzaXRTbG90IiwgX3RoaXMxNi5zZWxlY3RlZF90aW1lKSwgX2RlZmluZVByb3BlcnR5KF9hcHBvaW50bWVudF9wYXlsb2FkLCAiUGhvbmVOdW1iZXIiLCBfdGhpczE2LnZpc2l0b3JfbnVtYmVyKSwgX2RlZmluZVByb3BlcnR5KF9hcHBvaW50bWVudF9wYXlsb2FkLCAiVmlzaXREYXRlIiwgX3RoaXMxNi5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90LnNwbGl0KCIgIilbMF0pLCBfYXBwb2ludG1lbnRfcGF5bG9hZCk7CiAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxlX2VkaXRfZGVsZXRlX3VybCgpLCB7CiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGVtYWlsOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBkYXRlOiBfdGhpczE2LnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXSwKICAgICAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9pZDogX3RoaXMxNi5zZWxlY3RlZF9zY2hlZHVsZV9pZCwKICAgICAgICAgICAgICAgIGFwcG9pbnRtZW50X2luZm86IGFwcG9pbnRtZW50X3BheWxvYWQKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxNi4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLm1zZyA9PSAiRWRpdCBBcHBvaW50bWVudCIpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gZWRpdGVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICAgICAgJCgiI3NjaGVkdWxlX2RldGFpbHMiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgJCgiI3NjaGVkdWxlX2RldGFpbHMiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczE2LnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgICAgIHZhciBkYXRlU2VsZWN0ZWQgPSBtb21lbnQoX3RoaXMxNi50ZW1wX2FwcG9pbnRtZW50X2RhdGUsIFsnTU0tREQtWVlZWSddKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgICAgdmFyIERhdGUxID0gX3RoaXMxNi5wcmV2aW91c192aXNpdF9kYXRlOwogICAgICAgICAgICB2YXIgcHJldmlvdXNEYXRlID0gbW9tZW50KERhdGUxKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY29uZmlybV9hcHBvaW50bWVudCgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIHBob25lX251bWJlcjogX3RoaXMxNi52aXNpdG9yX251bWJlciwKICAgICAgICAgICAgICBjYW5kaWRhdGVfbmFtZTogX3RoaXMxNi5jYW5kaWRhdGVfbmFtZSwKICAgICAgICAgICAgICBjYW5kaWRhdGVfcG9zaXRpb246IF90aGlzMTYuY2FuZGlkYXRlX3Bvc2l0aW9uLAogICAgICAgICAgICAgIHZpc2l0X3Nsb3Q6IF90aGlzMTYuc2VsZWN0ZWRfdGltZSwKICAgICAgICAgICAgICBjYW5kaWRhdGVfZW1haWw6IF90aGlzMTYuY2FuZGlkYXRlX2VtYWlsLAogICAgICAgICAgICAgIHZpc2l0X2RhdGU6IGRhdGVTZWxlY3RlZCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBhcHBvaW50bWVudF9pZDogX3RoaXMxNi5zZWxlY3RlZF9zY2hlZHVsZV9pZAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczE2LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgX3RoaXMxNi5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiQXBwb2ludG1lbnQgQ29uZmlybWVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiQXBwb2ludG1lbnQgaGFzIGJlZW4gQ29uZmlybWVkIik7CgogICAgICAgICAgICAgICAgX3RoaXMxNi51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJBcHBvaW50bWVudCBDb25maXJtYXRpb24gRmFpbGVkIikgewogICAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJBcHBvaW50bWVudCBDb25maXJtYXRpb24gRmFpbGVkIik7CgogICAgICAgICAgICAgICAgX3RoaXMxNi51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJBbiBFcnJvciBPY2N1cnJlZCIpIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWV0aGluZyBXZW50IFdyb25nIik7CgogICAgICAgICAgICAgICAgX3RoaXMxNi51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgIF90aGlzMTYuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjYW5jZWxfcmVzY2hlZHVsZTogZnVuY3Rpb24gY2FuY2VsX3Jlc2NoZWR1bGUoKSB7CiAgICAgIHRoaXMuaXNSZXNjaGVkdWxlID0gIXRoaXMuaXNSZXNjaGVkdWxlOyAvLyAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMudGVtcF9kYXRhOwogICAgfSwKICAgIGNvbnZlcnRfY2FzaW5nOiBmdW5jdGlvbiBjb252ZXJ0X2Nhc2luZyh0ZXh0KSB7CiAgICAgIGlmICh0ZXh0ID09PSAnbm9uZScpIHsKICAgICAgICB0ZXh0ID0gJ3NjaGVkdWxlZCc7CiAgICAgIH0KCiAgICAgIHRleHQgPSB0ZXh0LnRvU3RyaW5nKCk7CiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1x3XFMqL2csIGZ1bmN0aW9uICh0eHQpIHsKICAgICAgICByZXR1cm4gdHh0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHh0LnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHR4dDsKICAgIH0sCiAgICBoaWRlX21vZGFsOiBmdW5jdGlvbiBoaWRlX21vZGFsKGlkKSB7CiAgICAgICQoIiMiLmNvbmNhdChpZCkpLm1vZGFsKCdoaWRlJyk7CiAgICB9LAogICAgdXBkYXRlX3NjaGVkdWxlc19saXN0OiBmdW5jdGlvbiB1cGRhdGVfc2NoZWR1bGVzX2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX2dldF9zY2hlZHVsZV9pbmZvX3VybCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBmaXJzdF9kYXk6IHRoaXMubW9udGhfcmFuZ2UoInN0YXJ0X3RpbWUiKSwKICAgICAgICBsYXN0X2RheTogdGhpcy5tb250aF9yYW5nZSgiZW5kX3RpbWUiKQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxNy5yZW5kZXJfc2NoZWR1bGUocmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB9KTsKICAgIH0KICB9Cn07"},null]}