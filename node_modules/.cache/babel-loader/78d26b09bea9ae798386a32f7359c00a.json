{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/eslint-loader/index.js??ref--13-0!/home/vimalesh/Learning/devops_ui/public/js/tui-calendar.min.js","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/public/js/tui-calendar.min.js","mtime":1643027096116},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmRlZmluZS1nZXR0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXNldHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0Lmxvb2t1cC1nZXR0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Quc2VhbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiKTsKCnZhciBfdHlwZW9mID0gcmVxdWlyZSgiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiIpOwoKLyohCiAqIFRPQVNUIFVJIENhbGVuZGFyCiAqIEB2ZXJzaW9uIDEuMTIuMTMgfCBUaHUgU2VwIDI0IDIwMjAKICogQGF1dGhvciBOSE4gRkUgRGV2ZWxvcG1lbnQgTGFiIDxkbF9qYXZhc2NyaXB0QG5obi5jb20+CiAqIEBsaWNlbnNlIE1JVAogKi8KIWZ1bmN0aW9uIChlLCB0KSB7CiAgIm9iamVjdCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgJiYgIm9iamVjdCIgPT0gKHR5cGVvZiBtb2R1bGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG1vZHVsZSkpID8gbW9kdWxlLmV4cG9ydHMgPSB0KHJlcXVpcmUoInR1aS1jb2RlLXNuaXBwZXQiKSwgcmVxdWlyZSgidHVpLWRhdGUtcGlja2VyIikpIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZGVmaW5lICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWyJ0dWktY29kZS1zbmlwcGV0IiwgInR1aS1kYXRlLXBpY2tlciJdLCB0KSA6ICJvYmplY3QiID09ICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID8gZXhwb3J0cy5DYWxlbmRhciA9IHQocmVxdWlyZSgidHVpLWNvZGUtc25pcHBldCIpLCByZXF1aXJlKCJ0dWktZGF0ZS1waWNrZXIiKSkgOiAoZS50dWkgPSBlLnR1aSB8fCB7fSwgZS50dWkuQ2FsZW5kYXIgPSB0KGUudHVpICYmIGUudHVpLnV0aWwsIGUudHVpICYmIGUudHVpLkRhdGVQaWNrZXIpKTsKfSh3aW5kb3csIGZ1bmN0aW9uIChlLCB0KSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgdCA9IHt9OwoKICAgIGZ1bmN0aW9uIG4obCkgewogICAgICBpZiAodFtsXSkgcmV0dXJuIHRbbF0uZXhwb3J0czsKICAgICAgdmFyIG8gPSB0W2xdID0gewogICAgICAgIGk6IGwsCiAgICAgICAgbDogITEsCiAgICAgICAgZXhwb3J0czoge30KICAgICAgfTsKICAgICAgcmV0dXJuIGVbbF0uY2FsbChvLmV4cG9ydHMsIG8sIG8uZXhwb3J0cywgbiksIG8ubCA9ICEwLCBvLmV4cG9ydHM7CiAgICB9CgogICAgcmV0dXJuIG4ubSA9IGUsIG4uYyA9IHQsIG4uZCA9IGZ1bmN0aW9uIChlLCB0LCBsKSB7CiAgICAgIG4ubyhlLCB0KSB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgdCwgewogICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgIGdldDogbAogICAgICB9KTsKICAgIH0sIG4uciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLnRvU3RyaW5nVGFnICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICAgICAgICB2YWx1ZTogIk1vZHVsZSIKICAgICAgfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogITAKICAgICAgfSk7CiAgICB9LCBuLnQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBpZiAoMSAmIHQgJiYgKGUgPSBuKGUpKSwgOCAmIHQpIHJldHVybiBlOwogICAgICBpZiAoNCAmIHQgJiYgIm9iamVjdCIgPT0gX3R5cGVvZihlKSAmJiBlICYmIGUuX19lc01vZHVsZSkgcmV0dXJuIGU7CiAgICAgIHZhciBsID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaWYgKG4ucihsKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGwsICJkZWZhdWx0IiwgewogICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgIHZhbHVlOiBlCiAgICAgIH0pLCAyICYgdCAmJiAic3RyaW5nIiAhPSB0eXBlb2YgZSkgZm9yICh2YXIgbyBpbiBlKSB7CiAgICAgICAgbi5kKGwsIG8sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZVt0XTsKICAgICAgICB9LmJpbmQobnVsbCwgbykpOwogICAgICB9CiAgICAgIHJldHVybiBsOwogICAgfSwgbi5uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlICYmIGUuX19lc01vZHVsZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZS5kZWZhdWx0OwogICAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBlOwogICAgICB9OwogICAgICByZXR1cm4gbi5kKHQsICJhIiwgdCksIHQ7CiAgICB9LCBuLm8gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpOwogICAgfSwgbi5wID0gIi9kaXN0IiwgbihuLnMgPSAzNik7CiAgfShbZnVuY3Rpb24gKHQsIG4pIHsKICAgIHQuZXhwb3J0cyA9IGU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCwKICAgICAgICBvID0gbig2KSwKICAgICAgICBpID0gbigxMyksCiAgICAgICAgYSA9IG4oMCksCiAgICAgICAgciA9IC9eYXV0byR8XiR8JS87CiAgICB2YXIgcyA9IChsID0gewogICAgICBhcHBlbmRIVE1MRWxlbWVudDogZnVuY3Rpb24gYXBwZW5kSFRNTEVsZW1lbnQoZSwgdCwgbikgewogICAgICAgIHZhciBsOwogICAgICAgIHJldHVybiBuID0gbiB8fCAiIiwgKGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGUpKS5jbGFzc05hbWUgPSBuLCB0ID8gdC5hcHBlbmRDaGlsZChsKSA6IGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobCksIGw7CiAgICAgIH0sCiAgICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGUpIHsKICAgICAgICBlICYmIGUucGFyZW50Tm9kZSAmJiBlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZSk7CiAgICAgIH0sCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KGUpIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSk7CiAgICAgIH0sCiAgICAgIF9tYXRjaGVyOiBmdW5jdGlvbiBfbWF0Y2hlcihlLCB0KSB7CiAgICAgICAgcmV0dXJuIC9eXC4vLnRlc3QodCkgPyBsLmhhc0NsYXNzKGUsIHQucmVwbGFjZSgiLiIsICIiKSkgOiAvXiMvLnRlc3QodCkgPyBlLmlkID09PSB0LnJlcGxhY2UoIiMiLCAiIikgOiBlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHQudG9Mb3dlckNhc2UoKTsKICAgICAgfSwKICAgICAgZmluZDogZnVuY3Rpb24gZmluZChlLCB0LCBuKSB7CiAgICAgICAgdmFyIG8gPSBbXSwKICAgICAgICAgICAgaSA9ICExLAogICAgICAgICAgICByID0gYS5pc1VuZGVmaW5lZChuKSB8fCAhMSA9PT0gbiwKICAgICAgICAgICAgcyA9IGEuaXNGdW5jdGlvbihuKTsKICAgICAgICByZXR1cm4gYS5pc1N0cmluZyh0KSAmJiAodCA9IGwuZ2V0KHQpKSwgZnVuY3Rpb24gZSh0LCBhKSB7CiAgICAgICAgICBmb3IgKHZhciBjLCB1ID0gdC5jaGlsZE5vZGVzLCBkID0gMCwgaCA9IHUubGVuZ3RoOyBkIDwgaDsgZCArPSAxKSB7CiAgICAgICAgICAgIGlmICgiI3RleHQiICE9PSAoYyA9IHVbZF0pLm5vZGVOYW1lKSBpZiAobC5fbWF0Y2hlcihjLCBhKSkgewogICAgICAgICAgICAgIGlmICgocyAmJiBuKGMpIHx8ICFzKSAmJiBvLnB1c2goYyksIHIpIHsKICAgICAgICAgICAgICAgIGkgPSAhMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChjLmNoaWxkTm9kZXMubGVuZ3RoID4gMCAmJiAoZShjLCBhKSwgaSkpIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0odCA9IHQgfHwgd2luZG93LmRvY3VtZW50LmJvZHksIGUpLCByID8gb1swXSB8fCBudWxsIDogbzsKICAgICAgfSwKICAgICAgY2xvc2VzdDogZnVuY3Rpb24gY2xvc2VzdChlLCB0LCBuKSB7CiAgICAgICAgdmFyIG87CiAgICAgICAgaWYgKCFlKSByZXR1cm4gbnVsbDsKICAgICAgICBpZiAobyA9IGUucGFyZW50Tm9kZSwgIW4gJiYgbC5fbWF0Y2hlcihlLCB0KSkgcmV0dXJuIGU7CgogICAgICAgIGZvciAoOyBvICYmIG8gIT09IHdpbmRvdy5kb2N1bWVudC5ib2R5OykgewogICAgICAgICAgaWYgKGwuX21hdGNoZXIobywgdCkpIHJldHVybiBvOwogICAgICAgICAgbyA9IG8ucGFyZW50Tm9kZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9LAogICAgICB0ZXh0OiBmdW5jdGlvbiB0ZXh0KGUpIHsKICAgICAgICB2YXIgdCA9ICIiLAogICAgICAgICAgICBuID0gMCwKICAgICAgICAgICAgbyA9IGUubm9kZVR5cGU7CgogICAgICAgIGlmIChvKSB7CiAgICAgICAgICBpZiAoMSA9PT0gbyB8fCA5ID09PSBvIHx8IDExID09PSBvKSB7CiAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZS50ZXh0Q29udGVudCkgcmV0dXJuIGUudGV4dENvbnRlbnQ7CgogICAgICAgICAgICBmb3IgKGUgPSBlLmZpcnN0Q2hpbGQ7IGU7IGUgPSBlLm5leHRTaWJsaW5nKSB7CiAgICAgICAgICAgICAgdCArPSBsLnRleHQoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoMyA9PT0gbyB8fCA0ID09PSBvKSByZXR1cm4gZS5ub2RlVmFsdWU7CiAgICAgICAgfSBlbHNlIGZvciAoOyBlW25dOyBuICs9IDEpIHsKICAgICAgICAgIHQgKz0gbC50ZXh0KGVbbl0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0sCiAgICAgIHNldERhdGE6IGZ1bmN0aW9uIHNldERhdGEoZSwgdCwgbikgewogICAgICAgICJkYXRhc2V0IiBpbiBlID8gZS5kYXRhc2V0W3RdID0gbiA6IGUuc2V0QXR0cmlidXRlKCJkYXRhLSIgKyB0LCBuKTsKICAgICAgfSwKICAgICAgZ2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YShlLCB0KSB7CiAgICAgICAgcmV0dXJuICJkYXRhc2V0IiBpbiBlID8gZS5kYXRhc2V0W3RdIDogZS5nZXRBdHRyaWJ1dGUoImRhdGEtIiArIHQpOwogICAgICB9LAogICAgICBoYXNDbGFzczogZnVuY3Rpb24gaGFzQ2xhc3MoZSwgdCkgewogICAgICAgIHZhciBuOwogICAgICAgIHJldHVybiBhLmlzVW5kZWZpbmVkKGUuY2xhc3NMaXN0KSA/IChuID0gbC5nZXRDbGFzcyhlKSkubGVuZ3RoID4gMCAmJiBuZXcgUmVnRXhwKCIoXnxcXHMpIiArIHQgKyAiKFxcc3wkKSIpLnRlc3QobikgOiBlLmNsYXNzTGlzdC5jb250YWlucyh0KTsKICAgICAgfSwKICAgICAgYWRkQ2xhc3M6IGZ1bmN0aW9uIGFkZENsYXNzKGUsIHQpIHsKICAgICAgICB2YXIgbjsKICAgICAgICBhLmlzVW5kZWZpbmVkKGUuY2xhc3NMaXN0KSA/IGwuaGFzQ2xhc3MoZSwgdCkgfHwgKG4gPSBsLmdldENsYXNzKGUpLCBsLnNldENsYXNzKGUsIChuID8gbiArICIgIiA6ICIiKSArIHQpKSA6IGEuZm9yRWFjaEFycmF5KHQuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGUuY2xhc3NMaXN0LmFkZCh0KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgc2V0Q2xhc3M6IGZ1bmN0aW9uIHNldENsYXNzKGUsIHQpIHsKICAgICAgICBhLmlzVW5kZWZpbmVkKGUuY2xhc3NOYW1lLmJhc2VWYWwpID8gZS5jbGFzc05hbWUgPSB0IDogZS5jbGFzc05hbWUuYmFzZVZhbCA9IHQ7CiAgICAgIH0sCiAgICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbiByZW1vdmVDbGFzcyhlLCB0KSB7CiAgICAgICAgdmFyIG4gPSAiIjsKICAgICAgICBhLmlzVW5kZWZpbmVkKGUuY2xhc3NMaXN0KSA/IChuID0gKCIgIiArIGwuZ2V0Q2xhc3MoZSkgKyAiICIpLnJlcGxhY2UoIiAiICsgdCArICIgIiwgIiAiKSwgbC5zZXRDbGFzcyhlLCBuLnJlcGxhY2UoL15cc1xzKi8sICIiKS5yZXBsYWNlKC9cc1xzKiQvLCAiIikpKSA6IGUuY2xhc3NMaXN0LnJlbW92ZSh0KTsKICAgICAgfSwKICAgICAgZ2V0Q2xhc3M6IGZ1bmN0aW9uIGdldENsYXNzKGUpIHsKICAgICAgICByZXR1cm4gZSAmJiBlLmNsYXNzTmFtZSA/IGEuaXNVbmRlZmluZWQoZS5jbGFzc05hbWUuYmFzZVZhbCkgPyBlLmNsYXNzTmFtZSA6IGUuY2xhc3NOYW1lLmJhc2VWYWwgOiAiIjsKICAgICAgfSwKICAgICAgZ2V0U3R5bGU6IGZ1bmN0aW9uIGdldFN0eWxlKGUsIHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgbCA9IGUuc3R5bGVbdF0gfHwgZS5jdXJyZW50U3R5bGUgJiYgZS5jdXJyZW50U3R5bGVbdF07CiAgICAgICAgcmV0dXJuIGwgJiYgImF1dG8iICE9PSBsIHx8ICFkb2N1bWVudC5kZWZhdWx0VmlldyB8fCAobCA9IChuID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlLCBudWxsKSkgPyBuW3RdIDogbnVsbCksICJhdXRvIiA9PT0gbCA/IG51bGwgOiBsOwogICAgICB9LAogICAgICBnZXRDb21wdXRlZFN0eWxlOiBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlKGUpIHsKICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmRlZmF1bHRWaWV3OwogICAgICAgIHJldHVybiB0ICYmIHQuZ2V0Q29tcHV0ZWRTdHlsZSA/IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZSkgOiB7CiAgICAgICAgICBnZXRQcm9wZXJ0eVZhbHVlOiBmdW5jdGlvbiBnZXRQcm9wZXJ0eVZhbHVlKHQpIHsKICAgICAgICAgICAgdmFyIG4gPSAvKFwtKFthLXpdKXsxfSkvZzsKICAgICAgICAgICAgcmV0dXJuICJmbG9hdCIgPT09IHQgJiYgKHQgPSAic3R5bGVGbG9hdCIpLCBuLnRlc3QodCkgJiYgKHQgPSB0LnJlcGxhY2UobiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBhcmd1bWVudHNbMl0udG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgfSkpLCBlLmN1cnJlbnRTdHlsZVt0XSA/IGUuY3VycmVudFN0eWxlW3RdIDogbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9LAogICAgICBzZXRQb3NpdGlvbjogZnVuY3Rpb24gc2V0UG9zaXRpb24oZSwgdCwgbikgewogICAgICAgIHQgPSBhLmlzVW5kZWZpbmVkKHQpID8gMCA6IHQsIG4gPSBhLmlzVW5kZWZpbmVkKG4pID8gMCA6IG4sIGUuX3BvcyA9IFt0LCBuXSwgZS5zdHlsZS5sZWZ0ID0gYS5pc051bWJlcih0KSA/IHQgKyAicHgiIDogdCwgZS5zdHlsZS50b3AgPSBhLmlzTnVtYmVyKG4pID8gbiArICJweCIgOiBuOwogICAgICB9LAogICAgICBzZXRMVFJCOiBmdW5jdGlvbiBzZXRMVFJCKGUsIHQpIHsKICAgICAgICB2YXIgbjsKICAgICAgICBbImxlZnQiLCAidG9wIiwgInJpZ2h0IiwgImJvdHRvbSJdLmZvckVhY2goZnVuY3Rpb24gKGwpIHsKICAgICAgICAgIG4gPSBhLmlzVW5kZWZpbmVkKHRbbF0pID8gIiIgOiB0W2xdLCBlLnN0eWxlW2xdID0gYS5pc051bWJlcihuKSA/IG4gKyAicHgiIDogbjsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZ2V0UG9zaXRpb246IGZ1bmN0aW9uIGdldFBvc2l0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgbiwgbCwgbzsKICAgICAgICByZXR1cm4gdCAmJiAoZS5fcG9zID0gbnVsbCksIGUuX3BvcyA/IGUuX3BvcyA6IChuID0gMCwgbCA9IDAsIChyLnRlc3QoZS5zdHlsZS5sZWZ0KSB8fCByLnRlc3QoZS5zdHlsZS50b3ApKSAmJiAiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiBpbiBlID8gKG4gPSAobyA9IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLmxlZnQsIGwgPSBvLnRvcCkgOiAobiA9IHBhcnNlRmxvYXQoZS5zdHlsZS5sZWZ0IHx8IDApLCBsID0gcGFyc2VGbG9hdChlLnN0eWxlLnRvcCB8fCAwKSksIFtuLCBsXSk7CiAgICAgIH0sCiAgICAgIGdldFNpemU6IGZ1bmN0aW9uIGdldFNpemUoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuID0gbC5nZXRTdHlsZShlLCAid2lkdGgiKSwKICAgICAgICAgICAgbyA9IGwuZ2V0U3R5bGUoZSwgImhlaWdodCIpOwogICAgICAgIHJldHVybiAoci50ZXN0KG4pIHx8IHIudGVzdChvKSB8fCBhLmlzTnVsbChuKSB8fCBhLmlzTnVsbChvKSkgJiYgImdldEJvdW5kaW5nQ2xpZW50UmVjdCIgaW4gZSA/IChuID0gKHQgPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKS53aWR0aCB8fCBlLm9mZnNldFdpZHRoLCBvID0gdC5oZWlnaHQgfHwgZS5vZmZzZXRIZWlnaHQpIDogKG4gPSBwYXJzZUZsb2F0KG4gfHwgMCksIG8gPSBwYXJzZUZsb2F0KG8gfHwgMCkpLCBbbiwgb107CiAgICAgIH0sCiAgICAgIGdldEJDUmVjdDogZnVuY3Rpb24gZ2V0QkNSZWN0KGUpIHsKICAgICAgICB2YXIgdCA9IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgcmV0dXJuIHQgPSBhLmV4dGVuZCh7CiAgICAgICAgICB3aWR0aDogZS5vZmZzZXRXaWR0aCwKICAgICAgICAgIGhlaWdodDogZS5vZmZzZXRIZWlnaHQKICAgICAgICB9LCB0KTsKICAgICAgfSwKICAgICAgdGVzdFByb3A6IGZ1bmN0aW9uIHRlc3RQcm9wKGUpIHsKICAgICAgICBmb3IgKHZhciB0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLCBuID0gMCwgbCA9IGUubGVuZ3RoOyBuIDwgbDsgbiArPSAxKSB7CiAgICAgICAgICBpZiAoZVtuXSBpbiB0KSByZXR1cm4gZVtuXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAhMTsKICAgICAgfSwKICAgICAgZ2V0Rm9ybURhdGE6IGZ1bmN0aW9uIGdldEZvcm1EYXRhKGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBpKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgICAgICB9KSwKICAgICAgICAgICAgbiA9IGZ1bmN0aW9uIG4oZSkgewogICAgICAgICAgcmV0dXJuICFlLmRpc2FibGVkOwogICAgICAgIH0sCiAgICAgICAgICAgIG8gPSB7fTsKCiAgICAgICAgcmV0dXJuIHQuYWRkLmFwcGx5KHQsIGwuZmluZCgiaW5wdXQiLCBlLCBuKS5jb25jYXQobC5maW5kKCJzZWxlY3QiLCBlLCBuKSkuY29uY2F0KGwuZmluZCgidGV4dGFyZWEiLCBlLCBuKSkpLCB0ID0gdC5ncm91cEJ5KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZSAmJiBlLmdldEF0dHJpYnV0ZSgibmFtZSIpIHx8ICJfb3RoZXIiOwogICAgICAgIH0pLCBhLmZvckVhY2godCwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICJfb3RoZXIiICE9PSB0ICYmIGUuZWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICB2YXIgaSA9IG4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIHIgPSBuLnR5cGUsCiAgICAgICAgICAgICAgICBzID0gW107CiAgICAgICAgICAgICJyYWRpbyIgPT09IHIgPyBzID0gW2UuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHJldHVybiBlLmNoZWNrZWQ7CiAgICAgICAgICAgIH0pLnRvQXJyYXkoKS5wb3AoKV0gOiAiY2hlY2tib3giID09PSByID8gcyA9IGUuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHJldHVybiBlLmNoZWNrZWQ7CiAgICAgICAgICAgIH0pLnRvQXJyYXkoKSA6ICJzZWxlY3QiID09PSBpID8gZS5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuICEhZS5jaGlsZE5vZGVzLmxlbmd0aDsKICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHMgPSBzLmNvbmNhdChsLmZpbmQoIm9wdGlvbiIsIGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZS5zZWxlY3RlZDsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pIDogcyA9IGUuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHJldHVybiAiIiAhPT0gZS52YWx1ZTsKICAgICAgICAgICAgfSkudG9BcnJheSgpLCAocyA9IGEubWFwKHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUudmFsdWU7CiAgICAgICAgICAgIH0pKS5sZW5ndGggPyAxID09PSBzLmxlbmd0aCAmJiAocyA9IHNbMF0pIDogcyA9ICIiLCBvW3RdID0gczsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBvOwogICAgICB9CiAgICB9KS50ZXN0UHJvcChbInVzZXJTZWxlY3QiLCAiV2Via2l0VXNlclNlbGVjdCIsICJPVXNlclNlbGVjdCIsICJNb3pVc2VyU2VsZWN0IiwgIm1zVXNlclNlbGVjdCJdKSwKICAgICAgICBjID0gKCJvbnNlbGVjdHN0YXJ0IiBpbiBkb2N1bWVudCksCiAgICAgICAgdSA9ICIiOwogICAgbC5kaXNhYmxlVGV4dFNlbGVjdGlvbiA9IGMgPyBmdW5jdGlvbiAoZSwgdCkgewogICAgICBvLm9uKGUsICJzZWxlY3RzdGFydCIsIHQgfHwgby5wcmV2ZW50RGVmYXVsdCk7CiAgICB9IDogZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLnN0eWxlOwogICAgICB1ID0gdFtzXSwgdFtzXSA9ICJub25lIjsKICAgIH0sIGwuZW5hYmxlVGV4dFNlbGVjdGlvbiA9IGMgPyBmdW5jdGlvbiAoZSwgdCkgewogICAgICBvLm9mZih3aW5kb3csICJzZWxlY3RzdGFydCIsIHQgfHwgby5wcmV2ZW50RGVmYXVsdCk7CiAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGVbc10gPSB1OwogICAgfSwgbC5kaXNhYmxlSW1hZ2VEcmFnID0gZnVuY3Rpb24gKCkgewogICAgICBvLm9uKHdpbmRvdywgImRyYWdzdGFydCIsIG8ucHJldmVudERlZmF1bHQpOwogICAgfSwgbC5lbmFibGVJbWFnZURyYWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG8ub2ZmKHdpbmRvdywgImRyYWdzdGFydCIsIG8ucHJldmVudERlZmF1bHQpOwogICAgfSwgZS5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gInR1aS1mdWxsLWNhbGVuZGFyLSIsCiAgICAgICAgbyA9IG5ldyBSZWdFeHAoIl4iICsgbCArICJ3ZWVrZGF5W1xcc110dWktdmlldy0oXFxkKykiKSwKICAgICAgICBpID0gbmV3IFJlZ0V4cCgiXiIgKyBsICsgInNjaGVkdWxlKC10aXRsZSk/JCIpLAogICAgICAgIGEgPSB7CiAgICAgIHRocm93RXJyb3I6IGZ1bmN0aW9uIHRocm93RXJyb3IoZSkgewogICAgICAgIGFsZXJ0KGUpOwogICAgICB9LAogICAgICBjc3NQcmVmaXg6IGwsCiAgICAgIGNsYXNzbmFtZTogZnVuY3Rpb24gY2xhc3NuYW1lKGUpIHsKICAgICAgICByZXR1cm4gIi4iID09PSAoZSA9IGUgfHwgIiIpLmNoYXJBdCgwKSA/ICIuIiArIGEuY3NzUHJlZml4ICsgZS5zbGljZSgxKSA6IGEuY3NzUHJlZml4ICsgZTsKICAgICAgfSwKICAgICAgYWxsZGF5OiB7CiAgICAgICAgZ2V0Vmlld0lEUmVnRXhwOiBvLAogICAgICAgIGNoZWNrQ29uZFJlZ0V4cDogaQogICAgICB9LAogICAgICBkYXlncmlkOiB7CiAgICAgICAgZ2V0Vmlld0lEUmVnRXhwOiBvLAogICAgICAgIGNoZWNrQ29uZFJlZ0V4cDogaQogICAgICB9LAogICAgICB0aW1lOiB7CiAgICAgICAgZ2V0Vmlld0lEUmVnRXhwOiBuZXcgUmVnRXhwKCJeIiArIGwgKyAidGltZS1kYXRlW1xcc110dWktdmlldy0oXFxkKykiKQogICAgICB9CiAgICB9OwogICAgZS5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gbig0KS5EYXRlLAogICAgICAgICAgYSA9IG4oMjYpLAogICAgICAgICAgciA9IG4oMCksCiAgICAgICAgICBzID0gL14oXGR7NH1bLXxcL10qXGR7Mn1bLXxcL10qXGR7Mn0pXHM/KFxkezJ9OlxkezJ9OlxkezJ9KT8kLywKICAgICAgICAgIGMgPSB7fSwKICAgICAgICAgIHUgPSB7fTsKICAgICAgbyA9IHsKICAgICAgICBZWVlZTU1ERDogZnVuY3Rpb24gWVlZWU1NREQoZSkgewogICAgICAgICAgcmV0dXJuIFtlLmdldEZ1bGxZZWFyKCksIGwubGVhZGluZ1plcm8oZS5nZXRNb250aCgpICsgMSwgMiksIGwubGVhZGluZ1plcm8oZS5nZXREYXRlKCksIDIpXS5qb2luKCIiKTsKICAgICAgICB9LAogICAgICAgIFlZWVk6IGZ1bmN0aW9uIFlZWVkoZSkgewogICAgICAgICAgcmV0dXJuIFN0cmluZyhlLmdldEZ1bGxZZWFyKCkpOwogICAgICAgIH0sCiAgICAgICAgTU06IGZ1bmN0aW9uIE1NKGUpIHsKICAgICAgICAgIHJldHVybiBsLmxlYWRpbmdaZXJvKGUuZ2V0TW9udGgoKSArIDEsIDIpOwogICAgICAgIH0sCiAgICAgICAgREQ6IGZ1bmN0aW9uIEREKGUpIHsKICAgICAgICAgIHJldHVybiBsLmxlYWRpbmdaZXJvKGUuZ2V0RGF0ZSgpLCAyKTsKICAgICAgICB9LAogICAgICAgICJISDptbSI6IGZ1bmN0aW9uIEhITW0oZSkgewogICAgICAgICAgdmFyIHQgPSBlLmdldEhvdXJzKCksCiAgICAgICAgICAgICAgbiA9IGUuZ2V0TWludXRlcygpOwogICAgICAgICAgcmV0dXJuIGwubGVhZGluZ1plcm8odCwgMikgKyAiOiIgKyBsLmxlYWRpbmdaZXJvKG4sIDIpOwogICAgICAgIH0sCiAgICAgICAgImhoOm1tIjogZnVuY3Rpb24gaGhNbShlKSB7CiAgICAgICAgICB2YXIgdCA9IGUuZ2V0SG91cnMoKSwKICAgICAgICAgICAgICBuID0gZS5nZXRNaW51dGVzKCk7CiAgICAgICAgICByZXR1cm4gdCA+IDEyICYmICh0ICU9IDEyKSwgbC5sZWFkaW5nWmVybyh0LCAyKSArICI6IiArIGwubGVhZGluZ1plcm8obiwgMik7CiAgICAgICAgfSwKICAgICAgICB0dDogZnVuY3Rpb24gdHQoZSkgewogICAgICAgICAgcmV0dXJuIGUuZ2V0SG91cnMoKSA8IDEyID8gImFtIiA6ICJwbSI7CiAgICAgICAgfQogICAgICB9LCBsID0gewogICAgICAgIE1JTExJU0VDT05EU19QRVJfREFZOiA4NjRlNSwKICAgICAgICBNSUxMSVNFQ09ORFNfUEVSX0hPVVI6IDM2ZTUsCiAgICAgICAgTUlMTElTRUNPTkRTX1BFUl9NSU5VVEVTOiA2ZTQsCiAgICAgICAgTUlMTElTRUNPTkRTX1NDSEVEVUxFX01JTl9EVVJBVElPTjogMTJlNSwKICAgICAgICBfY29udk1pbGxpc2Vjb25kczogZnVuY3Rpb24gX2NvbnZNaWxsaXNlY29uZHMoZSwgbiwgbCkgewogICAgICAgICAgdmFyIG8gPSB7CiAgICAgICAgICAgIGRheTogMCwKICAgICAgICAgICAgaG91cjogMSwKICAgICAgICAgICAgbWludXRlczogMiwKICAgICAgICAgICAgc2Vjb25kczogMwogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBlIGluIG8gJiYgIXQuaXNOYU4obikgJiYgci5yZWR1Y2UoW25dLmNvbmNhdChbMjQsIDYwLCA2MCwgMWUzXS5zbGljZShvW2VdKSksIGwpOwogICAgICAgIH0sCiAgICAgICAgbWlsbGlzZWNvbmRzVG86IGZ1bmN0aW9uIG1pbGxpc2Vjb25kc1RvKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gYywKICAgICAgICAgICAgICBvID0gZSArIHQ7CiAgICAgICAgICByZXR1cm4gbltvXSB8fCAobltvXSA9IGwuX2NvbnZNaWxsaXNlY29uZHMoZSwgdCwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGUgLyB0OwogICAgICAgICAgfSkpLCBuW29dOwogICAgICAgIH0sCiAgICAgICAgbWlsbGlzZWNvbmRzRnJvbTogZnVuY3Rpb24gbWlsbGlzZWNvbmRzRnJvbShlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IHUsCiAgICAgICAgICAgICAgbyA9IGUgKyB0OwogICAgICAgICAgcmV0dXJuIG5bb10gfHwgKG5bb10gPSBsLl9jb252TWlsbGlzZWNvbmRzKGUsIHQsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiBlICogdDsKICAgICAgICAgIH0pKSwgbltvXTsKICAgICAgICB9LAogICAgICAgIG1pbnV0ZXNGcm9tSG91cnM6IGZ1bmN0aW9uIG1pbnV0ZXNGcm9tSG91cnMoZSkgewogICAgICAgICAgcmV0dXJuIDYwICogZTsKICAgICAgICB9LAogICAgICAgIHJhbmdlOiBmdW5jdGlvbiByYW5nZShlLCB0LCBuKSB7CiAgICAgICAgICBmb3IgKHZhciBvID0gZS5nZXRUaW1lKCksIHIgPSB0LmdldFRpbWUoKSwgcyA9IG8sIGMgPSBhKG5ldyBpKGUpKSwgdSA9IFtdOyBzIDw9IHIgJiYgciA+PSBjLmQuZ2V0VGltZSgpOykgewogICAgICAgICAgICB1LnB1c2gobC5zdGFydChjLmQpKSwgcyArPSBuLCBjLmFkZERhdGUoMSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHU7CiAgICAgICAgfSwKICAgICAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoZSkgewogICAgICAgICAgcmV0dXJuIG5ldyBpKGUpOwogICAgICAgIH0sCiAgICAgICAgY29tcGFyZTogZnVuY3Rpb24gY29tcGFyZShlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IGUuZ2V0VGltZSgpLAogICAgICAgICAgICAgIGwgPSB0LmdldFRpbWUoKTsKICAgICAgICAgIHJldHVybiBuIDwgbCA/IC0xIDogbiA+IGwgPyAxIDogMDsKICAgICAgICB9LAogICAgICAgIGlzU2FtZU1vbnRoOiBmdW5jdGlvbiBpc1NhbWVNb250aChlLCB0KSB7CiAgICAgICAgICByZXR1cm4gZS5nZXRGdWxsWWVhcigpID09PSB0LmdldEZ1bGxZZWFyKCkgJiYgZS5nZXRNb250aCgpID09PSB0LmdldE1vbnRoKCk7CiAgICAgICAgfSwKICAgICAgICBpc1NhbWVEYXRlOiBmdW5jdGlvbiBpc1NhbWVEYXRlKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBsLmlzU2FtZU1vbnRoKGUsIHQpICYmIGUuZ2V0RGF0ZSgpID09PSB0LmdldERhdGUoKTsKICAgICAgICB9LAogICAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uIGlzVmFsaWQoZSkgewogICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBpICYmICF3aW5kb3cuaXNOYU4oZS5nZXRUaW1lKCkpOwogICAgICAgIH0sCiAgICAgICAgdG9VVEM6IGZ1bmN0aW9uIHRvVVRDKGUpIHsKICAgICAgICAgIHZhciB0ID0gZS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgbiA9IGwubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSk7CiAgICAgICAgICByZXR1cm4gbmV3IGkodCArIG4pOwogICAgICAgIH0sCiAgICAgICAgbGVhZGluZ1plcm86IGZ1bmN0aW9uIGxlYWRpbmdaZXJvKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gIiIsCiAgICAgICAgICAgICAgbCA9IDA7CiAgICAgICAgICBpZiAoU3RyaW5nKGUpLmxlbmd0aCA+IHQpIHJldHVybiBTdHJpbmcoZSk7CgogICAgICAgICAgZm9yICg7IGwgPCB0IC0gMTsgbCArPSAxKSB7CiAgICAgICAgICAgIG4gKz0gIjAiOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAobiArIGUpLnNsaWNlKC0xICogdCk7CiAgICAgICAgfSwKICAgICAgICBwYXJzZTogZnVuY3Rpb24gcGFyc2UoZSwgdCkgewogICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgIGEgPSBlLm1hdGNoKHMpOwogICAgICAgICAgcmV0dXJuIHIuaXNVbmRlZmluZWQodCkgJiYgKHQgPSAtMSksICEhYSAmJiAoZS5sZW5ndGggPiA4ID8gKG4gPSB+ZS5pbmRleE9mKCIvIikgPyAiLyIgOiAiLSIsIGwgPSAoYSA9IGEuc3BsaWNlKDEpKVswXS5zcGxpdChuKSwgbyA9IGFbMV0gPyBhWzFdLnNwbGl0KCI6IikgOiBbMCwgMCwgMF0pIDogKGwgPSBbKGEgPSBhWzBdKS5zdWJzdHIoMCwgNCksIGEuc3Vic3RyKDQsIDIpLCBhLnN1YnN0cig2LCAyKV0sIG8gPSBbMCwgMCwgMF0pLCBuZXcgaSgpLnNldFdpdGhSYXcoTnVtYmVyKGxbMF0pLCBOdW1iZXIobFsxXSkgKyB0LCBOdW1iZXIobFsyXSksIE51bWJlcihvWzBdKSwgTnVtYmVyKG9bMV0pLCBOdW1iZXIob1syXSksIDApKTsKICAgICAgICB9LAogICAgICAgIHJhdzogZnVuY3Rpb24gcmF3KGUpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHk6IGUuZ2V0RnVsbFllYXIoKSwKICAgICAgICAgICAgTTogZS5nZXRNb250aCgpLAogICAgICAgICAgICBkOiBlLmdldERhdGUoKSwKICAgICAgICAgICAgaDogZS5nZXRIb3VycygpLAogICAgICAgICAgICBtOiBlLmdldE1pbnV0ZXMoKSwKICAgICAgICAgICAgczogZS5nZXRTZWNvbmRzKCksCiAgICAgICAgICAgIG1zOiBlLmdldE1pbGxpc2Vjb25kcygpCiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KGUpIHsKICAgICAgICAgIHZhciB0ID0gZSA/IG5ldyBpKGUpIDogbmV3IGkoKTsKICAgICAgICAgIHJldHVybiB0LnNldEhvdXJzKDAsIDAsIDAsIDApLCB0OwogICAgICAgIH0sCiAgICAgICAgZW5kOiBmdW5jdGlvbiBlbmQoZSkgewogICAgICAgICAgdmFyIHQgPSBlID8gbmV3IGkoZSkgOiBuZXcgaSgpOwogICAgICAgICAgcmV0dXJuIHQuc2V0SG91cnMoMjMsIDU5LCA1OSwgMCksIHQ7CiAgICAgICAgfSwKICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIGZvcm1hdChlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IHQ7CiAgICAgICAgICByZXR1cm4gci5mb3JFYWNoT3duUHJvcGVydGllcyhvLCBmdW5jdGlvbiAodCwgbCkgewogICAgICAgICAgICBuID0gbi5yZXBsYWNlKGwsIHQoZSkpOwogICAgICAgICAgfSksIG47CiAgICAgICAgfSwKICAgICAgICBzdGFydERhdGVPZk1vbnRoOiBmdW5jdGlvbiBzdGFydERhdGVPZk1vbnRoKGUpIHsKICAgICAgICAgIHZhciB0ID0gbmV3IGkoZSk7CiAgICAgICAgICByZXR1cm4gdC5zZXREYXRlKDEpLCB0LnNldEhvdXJzKDAsIDAsIDAsIDApLCB0OwogICAgICAgIH0sCiAgICAgICAgZW5kRGF0ZU9mTW9udGg6IGZ1bmN0aW9uIGVuZERhdGVPZk1vbnRoKGUpIHsKICAgICAgICAgIHZhciB0ID0gbC5zdGFydERhdGVPZk1vbnRoKGUpOwogICAgICAgICAgcmV0dXJuIHQuc2V0TW9udGgodC5nZXRNb250aCgpICsgMSksIHQuc2V0RGF0ZSh0LmdldERhdGUoKSAtIDEpLCB0LnNldEhvdXJzKDIzLCA1OSwgNTkpLCB0OwogICAgICAgIH0sCiAgICAgICAgYXJyMmRDYWxlbmRhcjogZnVuY3Rpb24gYXJyMmRDYWxlbmRhcihlLCB0LCBuKSB7CiAgICAgICAgICB2YXIgbywKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgdSwKICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgcCwKICAgICAgICAgICAgICBtLAogICAgICAgICAgICAgIGYgPSBbXSwKICAgICAgICAgICAgICBnID0gdC5zdGFydERheU9mV2VlaywKICAgICAgICAgICAgICB5ID0gISFyLmlzVW5kZWZpbmVkKHQuaXNBbHdheXM2V2VlaykgfHwgdC5pc0Fsd2F5czZXZWVrLAogICAgICAgICAgICAgIFMgPSB0LnZpc2libGVXZWVrc0NvdW50LAogICAgICAgICAgICAgIF8gPSB0Lndvcmt3ZWVrOwogICAgICAgICAgcmV0dXJuIFMgPyAocyA9IG5ldyBpKGUpLCAoYyA9IGEobmV3IGkoZSkpKS5hZGREYXRlKDcgKiAoUyAtIDEpKSwgYyA9IGMuZCkgOiAocyA9IGwuc3RhcnREYXRlT2ZNb250aChlKSwgYyA9IGwuZW5kRGF0ZU9mTW9udGgoZSkpLCBvID0gci5yYW5nZShnLCA3KS5jb25jYXQoci5yYW5nZSg3KSkuc2xpY2UoMCwgNyksIHUgPSByLmluQXJyYXkocy5nZXREYXkoKSwgbyksIGggPSA3IC0gKHIuaW5BcnJheShjLmdldERheSgpLCBvKSArIDEpLCBkID0gUyA/IDcgKiBTIDogeSA/IDQyIDogdSArIGMuZ2V0RGF0ZSgpICsgaCwgcCA9IGwuc3RhcnQocykuYWRkRGF0ZSgtdSksIHIuZm9yRWFjaEFycmF5KHIucmFuZ2UoZCksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0OwogICAgICAgICAgICBlICUgNyB8fCAobSA9IGZbZSAvIDddID0gW10pLCB0ID0gbC5zdGFydChwKSwgdCA9IG4gPyBuKHQpIDogdCwgXyAmJiBsLmlzV2Vla2VuZCh0LmdldERheSgpKSB8fCBtLnB1c2godCksIHAuc2V0RGF0ZShwLmdldERhdGUoKSArIDEpOwogICAgICAgICAgfSksIGY7CiAgICAgICAgfSwKICAgICAgICBnZXRHcmlkTGVmdEFuZFdpZHRoOiBmdW5jdGlvbiBnZXRHcmlkTGVmdEFuZFdpZHRoKGUsIHQsIG4sIG8pIHsKICAgICAgICAgIHZhciBpID0gMTAwIC8gZSwKICAgICAgICAgICAgICBhID0gZSA+IDUgPyAxMDAgLyAoZSAtIDEpIDogaSwKICAgICAgICAgICAgICBzID0gMCwKICAgICAgICAgICAgICBjID0gci5yYW5nZShuLCA3KS5jb25jYXQoci5yYW5nZShlKSkuc2xpY2UoMCwgNyk7CiAgICAgICAgICByZXR1cm4gbyAmJiAoYyA9IHIuZmlsdGVyKGMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHJldHVybiAhbC5pc1dlZWtlbmQoZSk7CiAgICAgICAgICB9KSksIHQgPSAhbyAmJiB0LCByLm1hcChjLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICB2YXIgbywKICAgICAgICAgICAgICAgIHIgPSB0ID8gYSA6IGk7CiAgICAgICAgICAgIHJldHVybiBlID4gNSAmJiB0ICYmIGwuaXNXZWVrZW5kKG4pICYmIChyID0gYSAvIDIpLCBvID0gewogICAgICAgICAgICAgIGRheTogbiwKICAgICAgICAgICAgICB3aWR0aDogciwKICAgICAgICAgICAgICBsZWZ0OiBzCiAgICAgICAgICAgIH0sIHMgKz0gciwgbzsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgaXNXZWVrZW5kOiBmdW5jdGlvbiBpc1dlZWtlbmQoZSkgewogICAgICAgICAgcmV0dXJuIDAgPT09IGUgfHwgNiA9PT0gZTsKICAgICAgICB9LAogICAgICAgIGlzQmV0d2VlbldpdGhEYXRlOiBmdW5jdGlvbiBpc0JldHdlZW5XaXRoRGF0ZShlLCB0LCBuKSB7CiAgICAgICAgICByZXR1cm4gZSA9IHBhcnNlSW50KGwuZm9ybWF0KGUsICJZWVlZTU1ERCIpLCAxMCksIHQgPSBwYXJzZUludChsLmZvcm1hdCh0LCAiWVlZWU1NREQiKSwgMTApLCBuID0gcGFyc2VJbnQobC5mb3JtYXQobiwgIllZWVlNTUREIiksIDEwKSwgdCA8PSBlICYmIGUgPD0gbjsKICAgICAgICB9LAogICAgICAgIGlzU3RhcnRPZkRheTogZnVuY3Rpb24gaXNTdGFydE9mRGF5KGUpIHsKICAgICAgICAgIHJldHVybiAhbC5jb21wYXJlKGwuc3RhcnQoZSksIGUpOwogICAgICAgIH0sCiAgICAgICAgY29udmVydFN0YXJ0RGF5VG9MYXN0RGF5OiBmdW5jdGlvbiBjb252ZXJ0U3RhcnREYXlUb0xhc3REYXkoZSkgewogICAgICAgICAgdmFyIHQgPSBuZXcgaShlKTsKICAgICAgICAgIHJldHVybiBsLmlzU3RhcnRPZkRheShlKSAmJiAodC5zZXREYXRlKHQuZ2V0RGF0ZSgpIC0gMSksIHQuc2V0SG91cnMoMjMsIDU5LCA1OSkpLCB0OwogICAgICAgIH0sCiAgICAgICAgZ2V0U3RhcnRPZk5leHREYXk6IGZ1bmN0aW9uIGdldFN0YXJ0T2ZOZXh0RGF5KGUpIHsKICAgICAgICAgIHZhciB0ID0gbC5zdGFydChlKTsKICAgICAgICAgIHJldHVybiB0LnNldEhvdXJzKDI0KSwgdDsKICAgICAgICB9LAogICAgICAgIGdldERhdGVEaWZmZXJlbmNlOiBmdW5jdGlvbiBnZXREYXRlRGlmZmVyZW5jZShlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IG5ldyBpKGUuZ2V0RnVsbFllYXIoKSwgZS5nZXRNb250aCgpLCBlLmdldERhdGUoKSkuZ2V0VGltZSgpLAogICAgICAgICAgICAgIG8gPSBuZXcgaSh0LmdldEZ1bGxZZWFyKCksIHQuZ2V0TW9udGgoKSwgdC5nZXREYXRlKCkpLmdldFRpbWUoKTsKICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKChuIC0gbykgLyBsLk1JTExJU0VDT05EU19QRVJfREFZKTsKICAgICAgICB9LAogICAgICAgIGdldEhvdXJEaWZmZXJlbmNlOiBmdW5jdGlvbiBnZXRIb3VyRGlmZmVyZW5jZShlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IG5ldyBpKGUpLmdldFRpbWUoKSwKICAgICAgICAgICAgICBvID0gbmV3IGkodCkuZ2V0VGltZSgpOwogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKG4gLSBvKSAvIGwuTUlMTElTRUNPTkRTX1BFUl9IT1VSKTsKICAgICAgICB9LAogICAgICAgIGhhc011bHRpRGF0ZXM6IGZ1bmN0aW9uIGhhc011bHRpRGF0ZXMoZSwgdCkgewogICAgICAgICAgdmFyIG4gPSBsLmdldERhdGVEaWZmZXJlbmNlKGUsIHQpLAogICAgICAgICAgICAgIG8gPSBNYXRoLmFicyhsLmdldEhvdXJEaWZmZXJlbmNlKGUsIHQpKSwKICAgICAgICAgICAgICBpID0gLTEgPT09IG4gJiYgbyA8IDI0ICYmIGwuaXNTdGFydE9mRGF5KHQpOwogICAgICAgICAgcmV0dXJuICFsLmlzU2FtZURhdGUoZSwgdCkgJiYgIWk7CiAgICAgICAgfQogICAgICB9LCBlLmV4cG9ydHMgPSBsOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gcygpLAogICAgICAgIGkgPSBvLAogICAgICAgIGEgPSBudWxsLAogICAgICAgIHIgPSAhMTsKCiAgICBmdW5jdGlvbiBzKGUpIHsKICAgICAgcmV0dXJuIGUgPSBlIHx8IERhdGUubm93KCksIDZlNCAqIG5ldyBEYXRlKGUpLmdldFRpbWV6b25lT2Zmc2V0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gYyhlKSB7CiAgICAgIHJldHVybiAhciAmJiBhID8gNmU0ICogYShlKSA6IGk7CiAgICB9CgogICAgZnVuY3Rpb24gdShlKSB7CiAgICAgIHZhciB0ID0gRGF0ZS5VVEMuYXBwbHkobnVsbCwgZSk7CiAgICAgIHJldHVybiBuZXcgRGF0ZSh0ICsgcyh0KSk7CiAgICB9CgogICAgZnVuY3Rpb24gZChlKSB7CiAgICAgIHZhciB0OwogICAgICBpZiAoZSBpbnN0YW5jZW9mIG0pIHQgPSBlLmdldFVUQ1RpbWUoKTtlbHNlIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgZSkgdCA9IGU7ZWxzZSB7CiAgICAgICAgaWYgKG51bGwgIT09IGUpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBUeXBlIik7CiAgICAgICAgdCA9IDA7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBEYXRlKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGgoZSkgewogICAgICB2YXIgdDsKICAgICAgaWYgKGUgaW5zdGFuY2VvZiBEYXRlKSB0ID0gZS5nZXRUaW1lKCk7ZWxzZSB7CiAgICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZiBlKSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgVHlwZSIpOwogICAgICAgIHQgPSBEYXRlLnBhcnNlKGUpOwogICAgICB9CiAgICAgIHJldHVybiB0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHMoZSksCiAgICAgICAgICAgIG4gPSBjKGUpOwogICAgICAgIHJldHVybiBlIC0gbiArIHQgKyAobiA/IDAgOiBvIC0gdCk7CiAgICAgIH0odCksIG5ldyBEYXRlKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHAoZSkgewogICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIERhdGUgfHwgInN0cmluZyIgPT0gdHlwZW9mIGU7CiAgICB9CgogICAgZnVuY3Rpb24gbShlKSB7CiAgICAgIHZhciB0OwogICAgICBsLmlzVW5kZWZpbmVkKGUpICYmIChlID0gRGF0ZS5ub3coKSksIHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IHUoYXJndW1lbnRzKSA6IHAoZSkgPyBoKGUpIDogZChlKSwgdGhpcy5fZGF0ZSA9IHQ7CiAgICB9CgogICAgbS5wcm90b3R5cGUuZ2V0VGltZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLl9kYXRlLmdldFRpbWUoKTsKCiAgICAgIHJldHVybiBlICsgYyhlKSAtIHMoZSk7CiAgICB9LCBtLnByb3RvdHlwZS5nZXRVVENUaW1lID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fZGF0ZS5nZXRUaW1lKCk7CiAgICB9LCBtLnByb3RvdHlwZS50b1VUQ1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2RhdGUudG9VVENTdHJpbmcoKTsKICAgIH0sIG0ucHJvdG90eXBlLnRvRGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2RhdGU7CiAgICB9LCBtLnByb3RvdHlwZS52YWx1ZU9mID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5nZXRUaW1lKCk7CiAgICB9LCBtLnByb3RvdHlwZS5hZGREYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0RGF0ZSh0aGlzLmdldERhdGUoKSArIGUpLCB0aGlzOwogICAgfSwgbS5wcm90b3R5cGUuYWRkTWludXRlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnNldE1pbnV0ZXModGhpcy5nZXRNaW51dGVzKCkgKyBlKSwgdGhpczsKICAgIH0sIG0ucHJvdG90eXBlLmFkZE1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnNldE1pbGxpc2Vjb25kcyh0aGlzLmdldE1pbGxpc2Vjb25kcygpICsgZSksIHRoaXM7CiAgICB9LCBtLnByb3RvdHlwZS5zZXRXaXRoUmF3ID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwsIG8sIGksIGEpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0RnVsbFllYXIoZSwgdCwgbiksIHRoaXMuc2V0SG91cnMobCwgbywgaSwgYSksIHRoaXM7CiAgICB9LCBtLnByb3RvdHlwZS50b0xvY2FsVGltZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmdldFRpbWUoKSwKICAgICAgICAgIHQgPSB0aGlzLmdldFVUQ1RpbWUoKTsKICAgICAgcmV0dXJuIG5ldyBtKHQgLSAoZSAtIHQpKTsKICAgIH0sIFsiZ2V0RGF0ZSIsICJnZXREYXkiLCAiZ2V0RnVsbFllYXIiLCAiZ2V0SG91cnMiLCAiZ2V0TWlsbGlzZWNvbmRzIiwgImdldE1pbnV0ZXMiLCAiZ2V0TW9udGgiLCAiZ2V0U2Vjb25kcyJdLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgbS5wcm90b3R5cGVbZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGVbZV0uYXBwbHkodGhpcy5fZGF0ZSwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0pLCBbInNldERhdGUiLCAic2V0RnVsbFllYXIiLCAic2V0SG91cnMiLCAic2V0TWlsbGlzZWNvbmRzIiwgInNldE1pbnV0ZXMiLCAic2V0TW9udGgiLCAic2V0U2Vjb25kcyJdLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgbS5wcm90b3R5cGVbZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGVbZV0uYXBwbHkodGhpcy5fZGF0ZSwgYXJndW1lbnRzKSwgdGhpcy5nZXRUaW1lKCk7CiAgICAgIH07CiAgICB9KSwgZS5leHBvcnRzID0gewogICAgICBEYXRlOiBtLAogICAgICBzZXRPZmZzZXQ6IGZ1bmN0aW9uIHNldE9mZnNldChlKSB7CiAgICAgICAgaSA9IDZlNCAqIGU7CiAgICAgIH0sCiAgICAgIHNldE9mZnNldEJ5VGltZXpvbmVPcHRpb246IGZ1bmN0aW9uIHNldE9mZnNldEJ5VGltZXpvbmVPcHRpb24oZSkgewogICAgICAgIHRoaXMuc2V0T2Zmc2V0KC1lKSwgciA9ICEwOwogICAgICB9LAogICAgICBnZXRPZmZzZXQ6IGZ1bmN0aW9uIGdldE9mZnNldCgpIHsKICAgICAgICByZXR1cm4gciA/IGkgLyA2ZTQgOiAwOwogICAgICB9LAogICAgICBzZXRPZmZzZXRDYWxsYmFjazogZnVuY3Rpb24gc2V0T2Zmc2V0Q2FsbGJhY2soZSkgewogICAgICAgIGEgPSBlOwogICAgICB9LAogICAgICByZXN0b3JlT2Zmc2V0OiBmdW5jdGlvbiByZXN0b3JlT2Zmc2V0KCkgewogICAgICAgIGkgPSBzKCk7CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMSksCiAgICAgICAgaSA9IG4oMTMpLAogICAgICAgIGEgPSBuKDMpOwoKICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICByZXR1cm4gZS5jaWQoKTsKICAgIH0KCiAgICBlLmV4cG9ydHMgPSB7CiAgICAgIGNyZWF0ZVNjaGVkdWxlQ29sbGVjdGlvbjogZnVuY3Rpb24gY3JlYXRlU2NoZWR1bGVDb2xsZWN0aW9uKGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBpKHIpOwogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoICYmIHQuYWRkLmFwcGx5KHQsIGFyZ3VtZW50cyksIHQ7CiAgICAgIH0sCiAgICAgIHJhdGlvOiBmdW5jdGlvbiByYXRpbyhlLCB0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQgKiBuIC8gZTsKICAgICAgfSwKICAgICAgbmVhcmVzdDogZnVuY3Rpb24gbmVhcmVzdChlLCB0KSB7CiAgICAgICAgdmFyIG4gPSBsLm1hcCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGUgLSB0KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdFtsLmluQXJyYXkoTWF0aC5taW4uYXBwbHkobnVsbCwgbiksIG4pXTsKICAgICAgfSwKICAgICAgbWl4aW46IGZ1bmN0aW9uIG1peGluKGUsIHQpIHsKICAgICAgICBsLmV4dGVuZCh0LnByb3RvdHlwZSwgZSk7CiAgICAgIH0sCiAgICAgIGxpbWl0OiBmdW5jdGlvbiBsaW1pdChlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwgPSBNYXRoLm1heC5hcHBseShudWxsLCBbZV0uY29uY2F0KHQpKTsKICAgICAgICByZXR1cm4gbCA9IE1hdGgubWluLmFwcGx5KG51bGwsIFtsXS5jb25jYXQobikpOwogICAgICB9LAogICAgICBsaW1pdERhdGU6IGZ1bmN0aW9uIGxpbWl0RGF0ZShlLCB0LCBuKSB7CiAgICAgICAgcmV0dXJuIGUgPCB0ID8gdCA6IGUgPiBuID8gbiA6IGU7CiAgICAgIH0sCiAgICAgIG1heERhdGU6IGZ1bmN0aW9uIG1heERhdGUoZSwgdCkgewogICAgICAgIHJldHVybiBlID4gdCA/IGUgOiB0OwogICAgICB9LAogICAgICBzdHJpcFRhZ3M6IGZ1bmN0aW9uIHN0cmlwVGFncyhlKSB7CiAgICAgICAgcmV0dXJuIGUucmVwbGFjZSgvPChbXj5dKyk+L2dpLCAiIik7CiAgICAgIH0sCiAgICAgIGZpcnN0SW4yZEFycmF5OiBmdW5jdGlvbiBmaXJzdEluMmRBcnJheShlKSB7CiAgICAgICAgcmV0dXJuIGwucGljayhlLCAiMCIsICIwIik7CiAgICAgIH0sCiAgICAgIGxhc3RJbjJkQXJyYXk6IGZ1bmN0aW9uIGxhc3RJbjJkQXJyYXkoZSkgewogICAgICAgIHZhciB0ID0gZS5sZW5ndGggLSAxLAogICAgICAgICAgICBuID0gZVt0XS5sZW5ndGggLSAxOwogICAgICAgIHJldHVybiBsLnBpY2soZSwgdCwgbik7CiAgICAgIH0sCiAgICAgIHNldEF1dG9FbGxpcHNpczogZnVuY3Rpb24gc2V0QXV0b0VsbGlwc2lzKGUsIHQsIG4pIHsKICAgICAgICBsLmZvckVhY2goby5maW5kKGUsIHQsICEwKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIChuIHx8IGUub2Zmc2V0V2lkdGggPCBlLnNjcm9sbFdpZHRoKSAmJiBlLnNldEF0dHJpYnV0ZSgidGl0bGUiLCBvLmdldERhdGEoZSwgInRpdGxlIikpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlLCB0LCBuKSB7CiAgICAgICAgdmFyIG8gPSB0LnNwbGl0KCIuIiksCiAgICAgICAgICAgIGkgPSBlOwogICAgICAgIGwuZm9yRWFjaChvLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaVtlXSA9IGlbZV0gfHwge30sIHQgPT09IG8ubGVuZ3RoIC0gMSA/IGlbZV0gPSBuIDogaSA9IGlbZV07CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNoaWZ0QXJyYXk6IGZ1bmN0aW9uIHNoaWZ0QXJyYXkoZSwgdCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBsID0gTWF0aC5hYnModCk7CiAgICAgICAgaWYgKHQgPiAwKSBmb3IgKG4gPSAwOyBuIDwgbDsgbiArPSAxKSB7CiAgICAgICAgICBlLnB1c2goZS5zaGlmdCgpKTsKICAgICAgICB9IGVsc2UgaWYgKHQgPCAwKSBmb3IgKG4gPSAwOyBuIDwgbDsgbiArPSAxKSB7CiAgICAgICAgICBlLnVuc2hpZnQoZS5wb3AoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlOwogICAgICB9LAogICAgICB0YWtlQXJyYXk6IGZ1bmN0aW9uIHRha2VBcnJheShlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwgPSBlLmxlbmd0aCAtIG4sCiAgICAgICAgICAgIG8gPSB0OwogICAgICAgIHJldHVybiBlLnNwbGljZShuLCBsKSwgZS5zcGxpY2UoMCwgbyksIGU7CiAgICAgIH0sCiAgICAgIHNoaWZ0SG91cnM6IGZ1bmN0aW9uIHNoaWZ0SG91cnMoZSwgdCkgewogICAgICAgIHJldHVybiB0ID4gMCA/IGUgPSAoZSArIHQpICUgMjQgOiB0IDwgMCAmJiAoZSA9IChlICs9IHQpID4gMCA/IGUgOiAyNCArIGUpLCBlOwogICAgICB9LAogICAgICBwYXJzZVVuaXQ6IGZ1bmN0aW9uIHBhcnNlVW5pdChlKSB7CiAgICAgICAgcmV0dXJuIFtwYXJzZUZsb2F0KGUsIDEwKSwgZS5tYXRjaCgvW1xkLlwtK10qXHMqKC4qKS8pWzFdIHx8ICIiXTsKICAgICAgfSwKICAgICAgZmluZDogZnVuY3Rpb24gZmluZChlLCB0LCBuKSB7CiAgICAgICAgdmFyIG87CiAgICAgICAgcmV0dXJuIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIHQgJiYgKG8gPSB0KGUpKSwgIW8gfHwgKG8gPSBlLCAhMSk7CiAgICAgICAgfSwgbiksIG87CiAgICAgIH0sCiAgICAgIGdldFNjaGVkdWxlQ2hhbmdlczogZnVuY3Rpb24gZ2V0U2NoZWR1bGVDaGFuZ2VzKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbyA9IHt9LAogICAgICAgICAgICBpID0gWyJzdGFydCIsICJlbmQiXTsKICAgICAgICByZXR1cm4gbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpLmluZGV4T2YodCkgPiAtMSA/IGEuY29tcGFyZShlW3RdLCBuW3RdKSAmJiAob1t0XSA9IG5bdF0pIDogbC5pc1VuZGVmaW5lZChuW3RdKSB8fCBlW3RdID09PSBuW3RdIHx8IChvW3RdID0gblt0XSk7CiAgICAgICAgfSksIGwuaXNFbXB0eShvKSA/IG51bGwgOiBvOwogICAgICB9CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBbInRvdWNoc3RhcnQiLCAibW91c2Vkb3duIl0sCiAgICAgICAgaSA9IHsKICAgICAgb246IGZ1bmN0aW9uIG9uKGUsIHQsIG4sIG8pIHsKICAgICAgICBsLmlzU3RyaW5nKHQpID8gbC5mb3JFYWNoKHQuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkuX29uKGUsIHQsIG4sIG8pOwogICAgICAgIH0pIDogbC5mb3JFYWNoT3duUHJvcGVydGllcyh0LCBmdW5jdGlvbiAodCwgbCkgewogICAgICAgICAgaS5fb24oZSwgbCwgdCwgbik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9vbjogZnVuY3Rpb24gX29uKGUsIHQsIG4sIG8pIHsKICAgICAgICB2YXIgYSwgciwgczsKICAgICAgICBhID0gdCArIGwuc3RhbXAobikgKyAobyA/ICJfIiArIGwuc3RhbXAobykgOiAiIiksIGUuX2V2dCAmJiBlLl9ldnRbYV0gfHwgKHMgPSByID0gZnVuY3Rpb24gcih0KSB7CiAgICAgICAgICBuLmNhbGwobyB8fCBlLCB0IHx8IHdpbmRvdy5ldmVudCk7CiAgICAgICAgfSwgImFkZEV2ZW50TGlzdGVuZXIiIGluIGUgPyAibW91c2VlbnRlciIgPT09IHQgfHwgIm1vdXNlbGVhdmUiID09PSB0ID8gKHIgPSBmdW5jdGlvbiByKHQpIHsKICAgICAgICAgIHQgPSB0IHx8IHdpbmRvdy5ldmVudCwgaS5fY2hlY2tNb3VzZShlLCB0KSAmJiBzKHQpOwogICAgICAgIH0sIGUuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VlbnRlciIgPT09IHQgPyAibW91c2VvdmVyIiA6ICJtb3VzZW91dCIsIHIsICExKSkgOiAoIm1vdXNld2hlZWwiID09PSB0ICYmIGUuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLCByLCAhMSksIGUuYWRkRXZlbnRMaXN0ZW5lcih0LCByLCAhMSkpIDogImF0dGFjaEV2ZW50IiBpbiBlICYmIGUuYXR0YWNoRXZlbnQoIm9uIiArIHQsIHIpLCBlLl9ldnQgPSBlLl9ldnQgfHwge30sIGUuX2V2dFthXSA9IHIpOwogICAgICB9LAogICAgICBvZmY6IGZ1bmN0aW9uIG9mZihlLCB0LCBuLCBvKSB7CiAgICAgICAgbC5pc1N0cmluZyh0KSA/IGwuZm9yRWFjaCh0LnNwbGl0KCIgIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpLl9vZmYoZSwgdCwgbiwgbyk7CiAgICAgICAgfSkgOiBsLmZvckVhY2hPd25Qcm9wZXJ0aWVzKHQsIGZ1bmN0aW9uICh0LCBsKSB7CiAgICAgICAgICBpLl9vZmYoZSwgbCwgdCwgbik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9vZmY6IGZ1bmN0aW9uIF9vZmYoZSwgdCwgbiwgbykgewogICAgICAgIHZhciBpID0gdCArIGwuc3RhbXAobikgKyAobyA/ICJfIiArIGwuc3RhbXAobykgOiAiIiksCiAgICAgICAgICAgIGEgPSBlLl9ldnQgJiYgZS5fZXZ0W2ldOwoKICAgICAgICBpZiAoYSkgewogICAgICAgICAgaWYgKCJyZW1vdmVFdmVudExpc3RlbmVyIiBpbiBlKSAibW91c2VlbnRlciIgPT09IHQgfHwgIm1vdXNlbGVhdmUiID09PSB0ID8gZS5yZW1vdmVFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiA9PT0gdCA/ICJtb3VzZW92ZXIiIDogIm1vdXNlb3V0IiwgYSwgITEpIDogKCJtb3VzZXdoZWVsIiA9PT0gdCAmJiBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTU1vdXNlU2Nyb2xsIiwgYSwgITEpLCBlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCwgYSwgITEpKTtlbHNlIGlmICgiZGV0YWNoRXZlbnQiIGluIGUpIHRyeSB7CiAgICAgICAgICAgIGUuZGV0YWNoRXZlbnQoIm9uIiArIHQsIGEpOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgIGRlbGV0ZSBlLl9ldnRbaV0sIGwua2V5cyhlLl9ldnQpLmxlbmd0aCB8fCBkZWxldGUgZS5fZXZ0OwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25jZTogZnVuY3Rpb24gb25jZShlLCB0LCBuLCBvKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzOwogICAgICAgIGwuaXNPYmplY3QodCkgPyBsLmZvckVhY2hPd25Qcm9wZXJ0aWVzKHQsIGZ1bmN0aW9uICh0LCBsKSB7CiAgICAgICAgICBpLm9uY2UoZSwgbCwgdCwgbik7CiAgICAgICAgfSkgOiBpLm9uKGUsIHQsIGZ1bmN0aW9uIGwoKSB7CiAgICAgICAgICBuLmFwcGx5KG8gfHwgZSwgYXJndW1lbnRzKSwgYS5fb2ZmKGUsIHQsIGwsIG8pOwogICAgICAgIH0sIG8pOwogICAgICB9LAogICAgICBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbihlKSB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24gPyBlLnN0b3BQcm9wYWdhdGlvbigpIDogZS5jYW5jZWxCdWJibGUgPSAhMDsKICAgICAgfSwKICAgICAgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0KGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9ICExOwogICAgICB9LAogICAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKGUpIHsKICAgICAgICBpLnByZXZlbnREZWZhdWx0KGUpLCBpLnN0b3BQcm9wYWdhdGlvbihlKTsKICAgICAgfSwKICAgICAgZGlzYWJsZVNjcm9sbFByb3BhZ2F0aW9uOiBmdW5jdGlvbiBkaXNhYmxlU2Nyb2xsUHJvcGFnYXRpb24oZSkgewogICAgICAgIGkub24oZSwgIm1vdXNld2hlZWwgTW96TW91c2VQaXhlbFNjcm9sbCIsIGkuc3RvcFByb3BhZ2F0aW9uKTsKICAgICAgfSwKICAgICAgZGlzYWJsZUNsaWNrUHJvcGFnYXRpb246IGZ1bmN0aW9uIGRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKGUpIHsKICAgICAgICBpLm9uKGUsIG8uam9pbigiICIpICsgIiBjbGljayBkYmxjbGljayIsIGkuc3RvcFByb3BhZ2F0aW9uKTsKICAgICAgfSwKICAgICAgZ2V0TW91c2VQb3NpdGlvbjogZnVuY3Rpb24gZ2V0TW91c2VQb3NpdGlvbihlLCB0KSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgcmV0dXJuIHQgPyAobiA9IHQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIFtlLmNsaWVudFggLSBuLmxlZnQgLSB0LmNsaWVudExlZnQsIGUuY2xpZW50WSAtIG4udG9wIC0gdC5jbGllbnRUb3BdKSA6IFtlLmNsaWVudFgsIGUuY2xpZW50WV07CiAgICAgIH0sCiAgICAgIGdldFdoZWVsRGVsdGE6IGZ1bmN0aW9uIGdldFdoZWVsRGVsdGEoZSkgewogICAgICAgIHZhciB0ID0gMDsKICAgICAgICByZXR1cm4gZS53aGVlbERlbHRhICYmICh0ID0gZS53aGVlbERlbHRhIC8gMTIwKSwgZS5kZXRhaWwgJiYgKHQgPSAtZS5kZXRhaWwgLyAzKSwgdDsKICAgICAgfSwKICAgICAgX2NoZWNrTW91c2U6IGZ1bmN0aW9uIF9jaGVja01vdXNlKGUsIHQpIHsKICAgICAgICB2YXIgbiA9IHQucmVsYXRlZFRhcmdldDsKICAgICAgICBpZiAoIW4pIHJldHVybiAhMDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoOyBuICYmIG4gIT09IGU7KSB7CiAgICAgICAgICAgIG4gPSBuLnBhcmVudE5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuICExOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG4gIT09IGU7CiAgICAgIH0sCiAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uIHRyaWdnZXIoZSwgdCwgbikgewogICAgICAgIGwuaXNVbmRlZmluZWQobikgJiYgLyhtb3VzZXxjbGljaykvLmV4ZWModCkgJiYgKG4gPSBpLm1vdXNlRXZlbnQodCkpLCBlLmRpc3BhdGNoRXZlbnQgPyBlLmRpc3BhdGNoRXZlbnQobikgOiBlLmZpcmVFdmVudCAmJiBlLmZpcmVFdmVudCgib24iICsgdCwgbik7CiAgICAgIH0sCiAgICAgIG1vdXNlRXZlbnQ6IGZ1bmN0aW9uIG1vdXNlRXZlbnQoZSwgdCkgewogICAgICAgIHZhciBuLCBvOwogICAgICAgIHJldHVybiBvID0gbC5leHRlbmQoewogICAgICAgICAgYnViYmxlczogITAsCiAgICAgICAgICBjYW5jZWxhYmxlOiAibW91c2Vtb3ZlIiAhPT0gZSwKICAgICAgICAgIHZpZXc6IHdpbmRvdywKICAgICAgICAgIHdoZWVsRGVsdGE6IDAsCiAgICAgICAgICBkZXRhaWw6IDAsCiAgICAgICAgICBzY3JlZW5YOiAwLAogICAgICAgICAgc2NyZWVuWTogMCwKICAgICAgICAgIGNsaWVudFg6IDAsCiAgICAgICAgICBjbGllbnRZOiAwLAogICAgICAgICAgY3RybEtleTogITEsCiAgICAgICAgICBhbHRLZXk6ICExLAogICAgICAgICAgc2hpZnRLZXk6ICExLAogICAgICAgICAgbWV0YUtleTogITEsCiAgICAgICAgICBidXR0b246IDAsCiAgICAgICAgICByZWxhdGVkVGFyZ2V0OiB2b2lkIDAKICAgICAgICB9LCB0KSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRXZlbnQgPyAobiA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpKS5pbml0TW91c2VFdmVudChlLCBvLmJ1YmJsZXMsIG8uY2FuY2VsYWJsZSwgby52aWV3LCBvLmRldGFpbCwgby5zY3JlZW5YLCBvLnNjcmVlblksIG8uY2xpZW50WCwgby5jbGllbnRZLCBvLmN0cmxLZXksIG8uYWx0S2V5LCBvLnNoaWZ0S2V5LCBvLm1ldGFLZXksIG8uYnV0dG9uLCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUpIDogZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QgJiYgKG4gPSBkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCgpLCBsLmZvckVhY2gobywgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIG5bdF0gPSBlOwogICAgICAgIH0sIHRoaXMpLCBuLmJ1dHRvbiA9IHsKICAgICAgICAgIDA6IDEsCiAgICAgICAgICAxOiA0LAogICAgICAgICAgMjogMgogICAgICAgIH1bbi5idXR0b25dIHx8IG4uYnV0dG9uKSwgbjsKICAgICAgfSwKICAgICAgZ2V0TW91c2VCdXR0b246IGZ1bmN0aW9uIGdldE1vdXNlQnV0dG9uKGUpIHsKICAgICAgICB2YXIgdDsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZSgiTW91c2VFdmVudHMiLCAiMi4wIikgPyBlLmJ1dHRvbiA6ICh0ID0gU3RyaW5nKGUuYnV0dG9uKSwgIjAsMSwzLDUsNyIuaW5kZXhPZih0KSA+IC0xID8gMCA6ICIyLDYiLmluZGV4T2YodCkgPiAtMSA/IDIgOiB+IjQiLmluZGV4T2YodCkgPyAxIDogLTEpOwogICAgICB9LAogICAgICBnZXRFdmVudFRhcmdldDogZnVuY3Rpb24gZ2V0RXZlbnRUYXJnZXQoZSkgewogICAgICAgIHJldHVybiBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CiAgICAgIH0KICAgIH07CiAgICBlLmV4cG9ydHMgPSBpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICBlLmV4cG9ydHMgPSBuKDIxKS5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDEpLAogICAgICAgIGkgPSBuKDEzKTsKCiAgICBmdW5jdGlvbiBhKGUpIHsKICAgICAgdmFyIHQgPSBsLnN0YW1wKHRoaXMpOwogICAgICBsLmlzVW5kZWZpbmVkKGUpICYmIChlID0gby5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IikpLCBvLmFkZENsYXNzKGUsIHRoaXMuY3NzcHJlZml4KHQpKSwgdGhpcy5pZCA9IHQsIHRoaXMuY29udGFpbmVyID0gZSwgdGhpcy5jaGlsZHJlbiA9IG5ldyBpKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGwuc3RhbXAoZSk7CiAgICAgIH0pLCB0aGlzLnBhcmVudCA9IG51bGwsIHRoaXMuc3RhdGUgPSB7fTsKICAgIH0KCiAgICBhLnByb3RvdHlwZS5jc3NQcmVmaXggPSAidHVpLXZpZXctIiwgYS5wcm90b3R5cGUuYWRkQ2hpbGQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB0ICYmIHQuY2FsbChlLCB0aGlzKSwgZS5wYXJlbnQgPSB0aGlzLCB0aGlzLmNoaWxkcmVuLmFkZChlKTsKICAgIH0sIGEucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSBsLmlzTnVtYmVyKGUpID8gdGhpcy5jaGlsZHJlbi5pdGVtc1tlXSA6IGU7CiAgICAgIGUgPSBsLnN0YW1wKG4pLCB0ICYmIHQuY2FsbChuLCB0aGlzKSwgdGhpcy5jaGlsZHJlbi5yZW1vdmUoZSk7CiAgICB9LCBhLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGUucmVuZGVyKCk7CiAgICAgIH0pOwogICAgfSwgYS5wcm90b3R5cGUucmVjdXJzaXZlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgbC5pc0Z1bmN0aW9uKGUpICYmICh0IHx8IGUodGhpcyksIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHQucmVjdXJzaXZlKGUpOwogICAgICB9KSk7CiAgICB9LCBhLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIGUgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLCB0ID0gdGhpcy5wYXJlbnQ7IHQ7KSB7CiAgICAgICAgbC5pc0Z1bmN0aW9uKHQuX29uUmVzaXplKSAmJiB0Ll9vblJlc2l6ZS5hcHBseSh0LCBlKSwgdCA9IHQucGFyZW50OwogICAgICB9CiAgICB9LCBhLnByb3RvdHlwZS5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHt9LCBhLnByb3RvdHlwZS5fZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fYmVmb3JlRGVzdHJveSgpLCB0aGlzLmNoaWxkcmVuLmNsZWFyKCksIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9ICIiLCB0aGlzLmlkID0gdGhpcy5wYXJlbnQgPSB0aGlzLmNoaWxkcmVuID0gdGhpcy5jb250YWluZXIgPSBudWxsOwogICAgfSwgYS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGUuZGVzdHJveSghMCksIGUuX2Rlc3Ryb3koKTsKICAgICAgfSksIGUgfHwgdGhpcy5fZGVzdHJveSgpOwogICAgfSwgYS5wcm90b3R5cGUuZ2V0Vmlld0JvdW5kID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuY29udGFpbmVyLAogICAgICAgICAgdCA9IG8uZ2V0UG9zaXRpb24oZSksCiAgICAgICAgICBuID0gby5nZXRTaXplKGUpOwogICAgICByZXR1cm4gewogICAgICAgIHg6IHRbMF0sCiAgICAgICAgeTogdFsxXSwKICAgICAgICB3aWR0aDogblswXSwKICAgICAgICBoZWlnaHQ6IG5bMV0KICAgICAgfTsKICAgIH0sIGEucHJvdG90eXBlLmNzc3ByZWZpeCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmNzc1ByZWZpeCArIChlIHx8ICIiKTsKICAgIH0sIGEucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgbC5leHRlbmQodGhpcy5zdGF0ZSwgZSk7CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihhKSwgZS5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAoZSwgdCkgewogICAgdmFyIG47CgogICAgbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KCk7CgogICAgdHJ5IHsKICAgICAgbiA9IG4gfHwgbmV3IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICJvYmplY3QiID09ICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih3aW5kb3cpKSAmJiAobiA9IHdpbmRvdyk7CiAgICB9CgogICAgZS5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmV4dGVuZCA9IHIsIHQuaW5kZXhPZiA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGZvciAodmFyIG4gPSAwLCBsID0gZS5sZW5ndGg7IG4gPCBsOyBuKyspIHsKICAgICAgICBpZiAoZVtuXSA9PT0gdCkgcmV0dXJuIG47CiAgICAgIH0KCiAgICAgIHJldHVybiAtMTsKICAgIH0sIHQuZXNjYXBlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgZSkgewogICAgICAgIGlmIChlICYmIGUudG9IVE1MKSByZXR1cm4gZS50b0hUTUwoKTsKICAgICAgICBpZiAobnVsbCA9PSBlKSByZXR1cm4gIiI7CiAgICAgICAgaWYgKCFlKSByZXR1cm4gZSArICIiOwogICAgICAgIGUgPSAiIiArIGU7CiAgICAgIH0KCiAgICAgIGlmICghaS50ZXN0KGUpKSByZXR1cm4gZTsKICAgICAgcmV0dXJuIGUucmVwbGFjZShvLCBhKTsKICAgIH0sIHQuaXNFbXB0eSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiAhZSAmJiAwICE9PSBlIHx8ICEoIXUoZSkgfHwgMCAhPT0gZS5sZW5ndGgpOwogICAgfSwgdC5jcmVhdGVGcmFtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gcih7fSwgZSk7CiAgICAgIHJldHVybiB0Ll9wYXJlbnQgPSBlLCB0OwogICAgfSwgdC5ibG9ja1BhcmFtcyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiBlLnBhdGggPSB0LCBlOwogICAgfSwgdC5hcHBlbmRDb250ZXh0UGF0aCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiAoZSA/IGUgKyAiLiIgOiAiIikgKyB0OwogICAgfTsKICAgIHZhciBsID0gewogICAgICAiJiI6ICImYW1wOyIsCiAgICAgICI8IjogIiZsdDsiLAogICAgICAiPiI6ICImZ3Q7IiwKICAgICAgJyInOiAiJnF1b3Q7IiwKICAgICAgIiciOiAiJiN4Mjc7IiwKICAgICAgImAiOiAiJiN4NjA7IiwKICAgICAgIj0iOiAiJiN4M0Q7IgogICAgfSwKICAgICAgICBvID0gL1smPD4iJ2A9XS9nLAogICAgICAgIGkgPSAvWyY8PiInYD1dLzsKCiAgICBmdW5jdGlvbiBhKGUpIHsKICAgICAgcmV0dXJuIGxbZV07CiAgICB9CgogICAgZnVuY3Rpb24gcihlKSB7CiAgICAgIGZvciAodmFyIHQgPSAxOyB0IDwgYXJndW1lbnRzLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgZm9yICh2YXIgbiBpbiBhcmd1bWVudHNbdF0pIHsKICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhcmd1bWVudHNbdF0sIG4pICYmIChlW25dID0gYXJndW1lbnRzW3RdW25dKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfQoKICAgIHZhciBzID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICAgIHQudG9TdHJpbmcgPSBzOwoKICAgIHZhciBjID0gZnVuY3Rpb24gYyhlKSB7CiAgICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBlOwogICAgfTsKCiAgICBjKC94LykgJiYgKHQuaXNGdW5jdGlvbiA9IGMgPSBmdW5jdGlvbiBjKGUpIHsKICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgJiYgIltvYmplY3QgRnVuY3Rpb25dIiA9PT0gcy5jYWxsKGUpOwogICAgfSksIHQuaXNGdW5jdGlvbiA9IGM7CgogICAgdmFyIHUgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiAhKCFlIHx8ICJvYmplY3QiICE9IF90eXBlb2YoZSkpICYmICJbb2JqZWN0IEFycmF5XSIgPT09IHMuY2FsbChlKTsKICAgIH07CgogICAgdC5pc0FycmF5ID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gbigwKTsKCiAgICAgIGZ1bmN0aW9uIGEoZSkgewogICAgICAgIHJldHVybiB0WyJ3ZWJraXQiICsgZV0gfHwgdFsibW96IiArIGVdIHx8IHRbIm1zIiArIGVdOwogICAgICB9CgogICAgICBsID0gdC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgYSgiUmVxdWVzdEFuaW1hdGlvbkZyYW1lIikgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBlLmNhbGwodCk7CiAgICAgIH0sIG8gPSB0LmNhbmNlbEFuaW1hdGlvbkZyYW1lIHx8IGEoIkNhbmNlbEFuaW1hdGlvbkZyYW1lIikgfHwgYSgiQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIikgfHwgZnVuY3Rpb24gKCkge30sIGUuZXhwb3J0cyA9IHsKICAgICAgICByZXF1ZXN0QW5pbUZyYW1lOiBmdW5jdGlvbiByZXF1ZXN0QW5pbUZyYW1lKGUsIG4pIHsKICAgICAgICAgIHJldHVybiBsLmNhbGwodCwgaS5iaW5kKGUsIG4pKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbEFuaW1GcmFtZTogZnVuY3Rpb24gY2FuY2VsQW5pbUZyYW1lKGUpIHsKICAgICAgICAgIGUgJiYgby5jYWxsKHQsIGUpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMDsKICAgIHZhciBsID0gWyJkZXNjcmlwdGlvbiIsICJmaWxlTmFtZSIsICJsaW5lTnVtYmVyIiwgImVuZExpbmVOdW1iZXIiLCAibWVzc2FnZSIsICJuYW1lIiwgIm51bWJlciIsICJzdGFjayJdOwoKICAgIGZ1bmN0aW9uIG8oZSwgdCkgewogICAgICB2YXIgbiA9IHQgJiYgdC5sb2MsCiAgICAgICAgICBpID0gdm9pZCAwLAogICAgICAgICAgYSA9IHZvaWQgMCwKICAgICAgICAgIHIgPSB2b2lkIDAsCiAgICAgICAgICBzID0gdm9pZCAwOwogICAgICBuICYmIChpID0gbi5zdGFydC5saW5lLCBhID0gbi5lbmQubGluZSwgciA9IG4uc3RhcnQuY29sdW1uLCBzID0gbi5lbmQuY29sdW1uLCBlICs9ICIgLSAiICsgaSArICI6IiArIHIpOwoKICAgICAgZm9yICh2YXIgYyA9IEVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIGUpLCB1ID0gMDsgdSA8IGwubGVuZ3RoOyB1KyspIHsKICAgICAgICB0aGlzW2xbdV1dID0gY1tsW3VdXTsKICAgICAgfQoKICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UgJiYgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgbyk7CgogICAgICB0cnkgewogICAgICAgIG4gJiYgKHRoaXMubGluZU51bWJlciA9IGksIHRoaXMuZW5kTGluZU51bWJlciA9IGEsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA/IChPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgImNvbHVtbiIsIHsKICAgICAgICAgIHZhbHVlOiByLAogICAgICAgICAgZW51bWVyYWJsZTogITAKICAgICAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJlbmRDb2x1bW4iLCB7CiAgICAgICAgICB2YWx1ZTogcywKICAgICAgICAgIGVudW1lcmFibGU6ICEwCiAgICAgICAgfSkpIDogKHRoaXMuY29sdW1uID0gciwgdGhpcy5lbmRDb2x1bW4gPSBzKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CgogICAgby5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKSwgdC5kZWZhdWx0ID0gbywgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBsLmZvckVhY2hPd25Qcm9wZXJ0aWVzLAogICAgICAgIGkgPSBsLmZvckVhY2hBcnJheSwKICAgICAgICBhID0gbC5pc0Z1bmN0aW9uLAogICAgICAgIHIgPSBsLmlzT2JqZWN0LAogICAgICAgIHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CgogICAgZnVuY3Rpb24gYyhlKSB7CiAgICAgIHRoaXMuaXRlbXMgPSB7fSwgdGhpcy5sZW5ndGggPSAwLCBhKGUpICYmICh0aGlzLmdldEl0ZW1JRCA9IGUpOwogICAgfQoKICAgIGMuYW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHJldHVybiBlID0gcy5jYWxsKGFyZ3VtZW50cyksIHQgPSBlLmxlbmd0aCwgZnVuY3Rpb24gKG4pIHsKICAgICAgICBmb3IgKHZhciBsID0gMDsgbCA8IHQ7IGwgKz0gMSkgewogICAgICAgICAgaWYgKCFlW2xdLmNhbGwobnVsbCwgbikpIHJldHVybiAhMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAhMDsKICAgICAgfTsKICAgIH0sIGMucHJvdG90eXBlLmdldEl0ZW1JRCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBTdHJpbmcoZS5faWQpOwogICAgfSwgYy5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IHRoaXM7CiAgICAgIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gaShzLmNhbGwoYXJndW1lbnRzKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBsLmFkZChlKTsKICAgICAgfSkgOiAodCA9IHRoaXMuZ2V0SXRlbUlEKGUpLCAobiA9IHRoaXMuaXRlbXMpW3RdIHx8ICh0aGlzLmxlbmd0aCArPSAxKSwgblt0XSA9IGUpOwogICAgfSwgYy5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbyA9IHRoaXMsCiAgICAgICAgICBpID0gW107CiAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA/IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gaSA9IGwubWFwKHMuY2FsbChhcmd1bWVudHMpLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBvLnJlbW92ZShlKTsKICAgICAgfSkgOiAodCA9IHRoaXMuaXRlbXMsIHIoZSkgJiYgKGUgPSB0aGlzLmdldEl0ZW1JRChlKSksIHRbZV0gPyAodGhpcy5sZW5ndGggLT0gMSwgbiA9IHRbZV0sIGRlbGV0ZSB0W2VdLCBuKSA6IGkpIDogaTsKICAgIH0sIGMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLml0ZW1zID0ge30sIHRoaXMubGVuZ3RoID0gMDsKICAgIH0sIGMucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LCBuOwogICAgICByZXR1cm4gISF0aGlzLmxlbmd0aCAmJiAodCA9IGEoZSksIG4gPSAhMSwgdCA/IHRoaXMuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAhMCAhPT0gZSh0KSB8fCAobiA9ICEwLCAhMSk7CiAgICAgIH0pIDogKGUgPSByKGUpID8gdGhpcy5nZXRJdGVtSUQoZSkgOiBlLCBuID0gbC5pc0V4aXN0eSh0aGlzLml0ZW1zW2VdKSksIG4pOwogICAgfSwgYy5wcm90b3R5cGUuZG9XaGVuSGFzID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0aGlzLml0ZW1zW2VdOwogICAgICBsLmlzRXhpc3R5KG8pICYmIHQuY2FsbChuIHx8IHRoaXMsIG8pOwogICAgfSwgYy5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gbmV3IGMoKTsKICAgICAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoImdldEl0ZW1JRCIpICYmICh0LmdldEl0ZW1JRCA9IHRoaXMuZ2V0SXRlbUlEKSwgdGhpcy5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgITAgPT09IGUobikgJiYgdC5hZGQobik7CiAgICAgIH0pLCB0OwogICAgfSwgYy5wcm90b3R5cGUuZ3JvdXBCeSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSB7fSwKICAgICAgICAgIHIgPSBhKGUpLAogICAgICAgICAgcyA9IHRoaXMuZ2V0SXRlbUlEOwoKICAgICAgaWYgKGwuaXNBcnJheShlKSkgewogICAgICAgIGlmIChsLmZvckVhY2hBcnJheShlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaVtTdHJpbmcoZSldID0gbmV3IGMocyk7CiAgICAgICAgfSksICF0KSByZXR1cm4gaTsKICAgICAgICBlID0gdCwgciA9ICEwOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgciA/IG8gPSBlKHQpIDogKG8gPSB0W2VdLCBhKG8pICYmIChvID0gby5hcHBseSh0KSkpLCAobiA9IGlbb10pIHx8IChuID0gaVtvXSA9IG5ldyBjKHMpKSwgbi5hZGQodCk7CiAgICAgIH0pLCBpOwogICAgfSwgYy5wcm90b3R5cGUuc2luZ2xlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gbC5pc0Z1bmN0aW9uKGUpOwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChsKSB7CiAgICAgICAgcmV0dXJuIG4gJiYgIWUobCkgfHwgKHQgPSBsLCAhMSk7CiAgICAgIH0sIHRoaXMpLCB0OwogICAgfSwgYy5wcm90b3R5cGUuc29ydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gW107CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICB0LnB1c2goZSk7CiAgICAgIH0pLCBhKGUpICYmICh0ID0gdC5zb3J0KGUpKSwgdDsKICAgIH0sIGMucHJvdG90eXBlLmVhY2ggPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBvKHRoaXMuaXRlbXMsIGUsIHQgfHwgdGhpcyk7CiAgICB9LCBjLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5sZW5ndGggPyBsLm1hcCh0aGlzLml0ZW1zLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlOwogICAgICB9KSA6IFtdOwogICAgfSwgZS5leHBvcnRzID0gYzsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbig0KS5EYXRlLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDU1KSwKICAgICAgICByID0gbig1NiksCiAgICAgICAgcyA9IGkuTUlMTElTRUNPTkRTX1NDSEVEVUxFX01JTl9EVVJBVElPTiwKICAgICAgICBjID0gImFsbGRheSI7CgogICAgZnVuY3Rpb24gdSgpIHsKICAgICAgdGhpcy5pZCA9ICIiLCB0aGlzLnRpdGxlID0gIiIsIHRoaXMuYm9keSA9ICIiLCB0aGlzLmlzQWxsRGF5ID0gITEsIHRoaXMuc3RhcnQgPSBudWxsLCB0aGlzLmVuZCA9IG51bGwsIHRoaXMuY29sb3IgPSAiIzAwMCIsIHRoaXMuaXNWaXNpYmxlID0gITAsIHRoaXMuYmdDb2xvciA9ICIjYTFiNTZjIiwgdGhpcy5kcmFnQmdDb2xvciA9ICIjYTFiNTZjIiwgdGhpcy5ib3JkZXJDb2xvciA9ICIjMDAwIiwgdGhpcy5jYWxlbmRhcklkID0gIiIsIHRoaXMuY2F0ZWdvcnkgPSAiIiwgdGhpcy5kdWVEYXRlQ2xhc3MgPSAiIiwgdGhpcy5jdXN0b21TdHlsZSA9ICIiLCB0aGlzLmlzUGVuZGluZyA9ICExLCB0aGlzLmlzRm9jdXNlZCA9ICExLCB0aGlzLmlzUmVhZE9ubHkgPSAhMSwgdGhpcy5pc1ByaXZhdGUgPSAhMSwgdGhpcy5sb2NhdGlvbiA9ICIiLCB0aGlzLmF0dGVuZGVlcyA9IFtdLCB0aGlzLnJlY3VycmVuY2VSdWxlID0gIiIsIHRoaXMuc3RhdGUgPSAiIiwgdGhpcy5nb2luZ0R1cmF0aW9uID0gMCwgdGhpcy5jb21pbmdEdXJhdGlvbiA9IDAsIHRoaXMucmF3ID0gbnVsbCwgbC5zdGFtcCh0aGlzKTsKICAgIH0KCiAgICB1LnNjaGVtYSA9IHsKICAgICAgcmVxdWlyZWQ6IFsidGl0bGUiXSwKICAgICAgZGF0ZVJhbmdlOiBbInN0YXJ0IiwgImVuZCJdCiAgICB9LCB1LmNyZWF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gbmV3IHUoKTsKICAgICAgcmV0dXJuIHQuaW5pdChlKSwgdDsKICAgIH0sIHUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZSkgewogICAgICAoZSA9IGwuZXh0ZW5kKHt9LCBlKSkuY2F0ZWdvcnkgPT09IGMgJiYgKGUuaXNBbGxEYXkgPSAhMCksIHRoaXMuaWQgPSBlLmlkIHx8ICIiLCB0aGlzLnRpdGxlID0gZS50aXRsZSB8fCAiIiwgdGhpcy5ib2R5ID0gZS5ib2R5IHx8ICIiLCB0aGlzLmlzQWxsRGF5ID0gISFsLmlzRXhpc3R5KGUuaXNBbGxEYXkpICYmIGUuaXNBbGxEYXksIHRoaXMuaXNWaXNpYmxlID0gIWwuaXNFeGlzdHkoZS5pc1Zpc2libGUpIHx8IGUuaXNWaXNpYmxlLCB0aGlzLmNvbG9yID0gZS5jb2xvciB8fCB0aGlzLmNvbG9yLCB0aGlzLmJnQ29sb3IgPSBlLmJnQ29sb3IgfHwgdGhpcy5iZ0NvbG9yLCB0aGlzLmRyYWdCZ0NvbG9yID0gZS5kcmFnQmdDb2xvciB8fCB0aGlzLmRyYWdCZ0NvbG9yLCB0aGlzLmJvcmRlckNvbG9yID0gZS5ib3JkZXJDb2xvciB8fCB0aGlzLmJvcmRlckNvbG9yLCB0aGlzLmNhbGVuZGFySWQgPSBlLmNhbGVuZGFySWQgfHwgIiIsIHRoaXMuY2F0ZWdvcnkgPSBlLmNhdGVnb3J5IHx8ICIiLCB0aGlzLmR1ZURhdGVDbGFzcyA9IGUuZHVlRGF0ZUNsYXNzIHx8ICIiLCB0aGlzLmN1c3RvbVN0eWxlID0gZS5jdXN0b21TdHlsZSB8fCAiIiwgdGhpcy5sb2NhdGlvbiA9IGUubG9jYXRpb24gfHwgIiIsIHRoaXMuYXR0ZW5kZWVzID0gZS5hdHRlbmRlZXMgfHwgW10sIHRoaXMucmVjdXJyZW5jZVJ1bGUgPSBlLnJlY3VycmVuY2VSdWxlIHx8ICIiLCB0aGlzLmlzUHJpdmF0ZSA9IGUuaXNQcml2YXRlIHx8ICExLCB0aGlzLmlzUGVuZGluZyA9IGUuaXNQZW5kaW5nIHx8ICExLCB0aGlzLmlzRm9jdXNlZCA9IGUuaXNGb2N1c2VkIHx8ICExLCB0aGlzLmlzUmVhZE9ubHkgPSBlLmlzUmVhZE9ubHkgfHwgITEsIHRoaXMuZ29pbmdEdXJhdGlvbiA9IGUuZ29pbmdEdXJhdGlvbiB8fCAwLCB0aGlzLmNvbWluZ0R1cmF0aW9uID0gZS5jb21pbmdEdXJhdGlvbiB8fCAwLCB0aGlzLnN0YXRlID0gZS5zdGF0ZSB8fCAiIiwgdGhpcy5pc0FsbERheSA/IHRoaXMuc2V0QWxsRGF5UGVyaW9kKGUuc3RhcnQsIGUuZW5kKSA6IHRoaXMuc2V0VGltZVBlcmlvZChlLnN0YXJ0LCBlLmVuZCksIHRoaXMucmF3ID0gZS5yYXcgfHwgbnVsbDsKICAgIH0sIHUucHJvdG90eXBlLnNldEFsbERheVBlcmlvZCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGUgPSBsLmlzU3RyaW5nKGUpID8gaS5wYXJzZShlLnN1YnN0cmluZygwLCAxMCkpIDogbmV3IG8oZSB8fCBEYXRlLm5vdygpKSwgdCA9IGwuaXNTdHJpbmcodCkgPyBpLnBhcnNlKHQuc3Vic3RyaW5nKDAsIDEwKSkgOiBuZXcgbyh0IHx8IHRoaXMuc3RhcnQpLCB0aGlzLnN0YXJ0ID0gZSwgdGhpcy5zdGFydC5zZXRIb3VycygwLCAwLCAwKSwgdGhpcy5lbmQgPSB0IHx8IG5ldyBvKHRoaXMuc3RhcnQpLCB0aGlzLmVuZC5zZXRIb3VycygyMywgNTksIDU5KTsKICAgIH0sIHUucHJvdG90eXBlLnNldFRpbWVQZXJpb2QgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB0aGlzLnN0YXJ0ID0gbmV3IG8oZSB8fCBEYXRlLm5vdygpKSwgdGhpcy5lbmQgPSBuZXcgbyh0IHx8IHRoaXMuc3RhcnQpLCB0IHx8IHRoaXMuZW5kLnNldE1pbnV0ZXModGhpcy5lbmQuZ2V0TWludXRlcygpICsgMzApOwogICAgfSwgdS5wcm90b3R5cGUuZ2V0U3RhcnRzID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5zdGFydDsKICAgIH0sIHUucHJvdG90eXBlLmdldEVuZHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmVuZDsKICAgIH0sIHUucHJvdG90eXBlLmNpZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGwuc3RhbXAodGhpcyk7CiAgICB9LCB1LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5pZCA9PT0gZS5pZCAmJiB0aGlzLnRpdGxlID09PSBlLnRpdGxlICYmIHRoaXMuYm9keSA9PT0gZS5ib2R5ICYmIHRoaXMuaXNBbGxEYXkgPT09IGUuaXNBbGxEYXkgJiYgMCA9PT0gaS5jb21wYXJlKHRoaXMuZ2V0U3RhcnRzKCksIGUuZ2V0U3RhcnRzKCkpICYmIDAgPT09IGkuY29tcGFyZSh0aGlzLmdldEVuZHMoKSwgZS5nZXRFbmRzKCkpICYmIHRoaXMuY29sb3IgPT09IGUuY29sb3IgJiYgdGhpcy5iZ0NvbG9yID09PSBlLmJnQ29sb3IgJiYgdGhpcy5kcmFnQmdDb2xvciA9PT0gZS5kcmFnQmdDb2xvciAmJiB0aGlzLmJvcmRlckNvbG9yID09PSBlLmJvcmRlckNvbG9yOwogICAgfSwgdS5wcm90b3R5cGUuZHVyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5nZXRTdGFydHMoKSwKICAgICAgICAgIHQgPSB0aGlzLmdldEVuZHMoKTsKICAgICAgcmV0dXJuIHRoaXMuaXNBbGxEYXkgPyBpLmVuZCh0KSAtIGkuc3RhcnQoZSkgOiB0IC0gZTsKICAgIH0sIHUucHJvdG90eXBlLmNvbGxpZGVzV2l0aCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5nZXRTdGFydHMoKSwKICAgICAgICAgIG4gPSB0aGlzLmdldEVuZHMoKSwKICAgICAgICAgIGwgPSBlLmdldFN0YXJ0cygpLAogICAgICAgICAgbyA9IGUuZ2V0RW5kcygpLAogICAgICAgICAgYSA9IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIHRoaXMuZ29pbmdEdXJhdGlvbiksCiAgICAgICAgICByID0gaS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgdGhpcy5jb21pbmdEdXJhdGlvbiksCiAgICAgICAgICBjID0gaS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgZS5nb2luZ0R1cmF0aW9uKSwKICAgICAgICAgIHUgPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLmNvbWluZ0R1cmF0aW9uKTsKICAgICAgcmV0dXJuIE1hdGguYWJzKG4gLSB0KSA8IHMgJiYgKG4gKz0gcyksIE1hdGguYWJzKG8gLSBsKSA8IHMgJiYgKG8gKz0gcyksIG4gKz0gciwgbyArPSB1LCAobCAtPSBjKSA+ICh0IC09IGEpICYmIGwgPCBuIHx8IG8gPiB0ICYmIG8gPCBuIHx8IGwgPD0gdCAmJiBvID49IG47CiAgICB9LCByLm1peGluKHUucHJvdG90eXBlKSwgYS5taXhpbih1LnByb3RvdHlwZSksIGUuZXhwb3J0cyA9IHU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMyk7CgogICAgZnVuY3Rpb24gaShlLCB0KSB7CiAgICAgIHJldHVybiBlICE9PSB0ID8gZSA/IC0xIDogMSA6IDA7CiAgICB9CgogICAgZnVuY3Rpb24gYShlLCB0KSB7CiAgICAgIHZhciBuID0gU3RyaW5nKGUpLAogICAgICAgICAgbCA9IFN0cmluZyh0KTsKICAgICAgcmV0dXJuIG4gPiBsID8gMSA6IG4gPCBsID8gLTEgOiAwOwogICAgfQoKICAgIGUuZXhwb3J0cyA9IHsKICAgICAgYnNlYXJjaDogZnVuY3Rpb24gYnNlYXJjaChlLCB0LCBuLCBsKSB7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHIgPSAwLAogICAgICAgICAgICBzID0gZS5sZW5ndGggLSAxOwoKICAgICAgICBmb3IgKGwgPSBsIHx8IGE7IHIgPD0gczspIHsKICAgICAgICAgIGlmIChvID0gKHIgKyBzKSAvIDIgfCAwLCAoaSA9IGwobiA/IG4oZVtvXSkgOiBlW29dLCB0KSkgPCAwKSByID0gbyArIDE7ZWxzZSB7CiAgICAgICAgICAgIGlmICghKGkgPiAwKSkgcmV0dXJuIG87CiAgICAgICAgICAgIHMgPSBvIC0gMTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB+czsKICAgICAgfSwKICAgICAgY29tcGFyZTogewogICAgICAgIHNjaGVkdWxlOiB7CiAgICAgICAgICBhc2M6IGZ1bmN0aW9uIGFzYyhlLCB0KSB7CiAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgICAgYyA9IGUudmFsdWVPZigpLAogICAgICAgICAgICAgICAgdSA9IHQudmFsdWVPZigpOwogICAgICAgICAgICByZXR1cm4gKHIgPSBpKGMuaXNBbGxEYXkgfHwgZS5oYXNNdWx0aURhdGVzLCB1LmlzQWxsRGF5IHx8IHQuaGFzTXVsdGlEYXRlcykpID8gciA6IChzID0gby5jb21wYXJlKGUuZ2V0U3RhcnRzKCksIHQuZ2V0U3RhcnRzKCkpKSA/IHMgOiAobiA9IGUuZHVyYXRpb24oKSkgPCAoYSA9IHQuZHVyYXRpb24oKSkgPyAxIDogbiA+IGEgPyAtMSA6IGwuc3RhbXAoYykgLSBsLnN0YW1wKHUpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYm9vbDogewogICAgICAgICAgYXNjOiBpLAogICAgICAgICAgZGVzYzogZnVuY3Rpb24gZGVzYyhlLCB0KSB7CiAgICAgICAgICAgIHJldHVybiBlICE9PSB0ID8gZSA/IDEgOiAtMSA6IDA7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBudW06IHsKICAgICAgICAgIGFzYzogZnVuY3Rpb24gYXNjKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihlKSAtIE51bWJlcih0KTsKICAgICAgICAgIH0sCiAgICAgICAgICBkZXNjOiBmdW5jdGlvbiBkZXNjKGUsIHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBOdW1iZXIoZSk7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodCkgLSBuOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RyOiB7CiAgICAgICAgICBhc2M6IGEsCiAgICAgICAgICBkZXNjOiBmdW5jdGlvbiBkZXNjKGUsIHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBTdHJpbmcoZSksCiAgICAgICAgICAgICAgICBsID0gU3RyaW5nKHQpOwogICAgICAgICAgICByZXR1cm4gbiA+IGwgPyAtMSA6IG4gPCBsID8gMSA6IDA7CiAgICAgICAgICB9LAogICAgICAgICAgYXNjSWdub3JlQ2FzZTogZnVuY3Rpb24gYXNjSWdub3JlQ2FzZShlLCB0KSB7CiAgICAgICAgICAgIHZhciBuID0gU3RyaW5nKGUpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICBsID0gU3RyaW5nKHQpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHJldHVybiBuID4gbCA/IDEgOiBuIDwgbCA/IC0xIDogMDsKICAgICAgICAgIH0sCiAgICAgICAgICBkZXNjSWdub3JlQ2FzZTogZnVuY3Rpb24gZGVzY0lnbm9yZUNhc2UoZSwgdCkgewogICAgICAgICAgICB2YXIgbiA9IFN0cmluZyhlKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgbCA9IFN0cmluZyh0KS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gbiA+IGwgPyAtMSA6IG4gPCBsID8gMSA6IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpLAogICAgICAgIGEgPSBuKDgpOwoKICAgIGZ1bmN0aW9uIHIoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSB0W3IuUFJPUF9LRVldOwogICAgICBsIHx8IChsID0gdFtyLlBST1BfS0VZXSA9IFtdKSwgbC5wdXNoKHRoaXMpLCB0aGlzLnNpYmxpbmcgPSBsLCB0aGlzLnpJbmRleCA9IHRoaXMuZ2V0TGFyZ2VzdFpJbmRleCgpIHx8IHIuSU5JVF9aSU5ERVgsIChuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIsIG4uc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBpLmFkZENsYXNzKG4sIG8uY2xhc3NuYW1lKCJmbG9hdGluZy1sYXllciIpKSwgdC5hcHBlbmRDaGlsZChuKSwgYS5jYWxsKHRoaXMsIG4pLCB0aGlzLnBhcmVudCA9IHQ7CiAgICB9CgogICAgbC5pbmhlcml0KHIsIGEpLCByLlBST1BfS0VZID0gIl9fZmVfZmxvYXRpbmdfbGF5ZXIiLCByLklOSVRfWklOREVYID0gOTk5LCByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciBlID0gdGhpcy5wYXJlbnQsIHQgPSB0aGlzLnNpYmxpbmcsIG4gPSAwLCBsID0gdC5sZW5ndGg7IG4gPCBsOyBuICs9IDEpIHsKICAgICAgICBpZiAodFtuXSA9PT0gdGhpcykgewogICAgICAgICAgdC5zcGxpY2UobiwgMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghdC5sZW5ndGgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgZGVsZXRlIGVbci5QUk9QX0tFWV07CiAgICAgICAgfSBjYXRjaCAodCkgewogICAgICAgICAgZVtyLlBST1BfS0VZXSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBlLnN0eWxlLnBvc2l0aW9uID0gIiI7CiAgICAgIH0KCiAgICAgIGkucmVtb3ZlKHRoaXMuY29udGFpbmVyKSwgdGhpcy5zaWJsaW5nID0gbnVsbCwgYS5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpOwogICAgfSwgci5wcm90b3R5cGUuaXNWaXNpYmxlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gIm5vbmUiICE9PSB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5OwogICAgfSwgci5wcm90b3R5cGUuc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBpLnNldFBvc2l0aW9uKHRoaXMuY29udGFpbmVyLCBlLCB0KTsKICAgIH0sIHIucHJvdG90eXBlLnNldExUUkIgPSBmdW5jdGlvbiAoZSkgewogICAgICBpLnNldExUUkIodGhpcy5jb250YWluZXIsIGUpOwogICAgfSwgci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gdGhpcy5jb250YWluZXI7CiAgICAgIGUgPSBsLmlzTnVtYmVyKGUpID8gZSArICJweCIgOiBlLCB0ID0gbC5pc051bWJlcih0KSA/IHQgKyAicHgiIDogdCwgbi5zdHlsZS53aWR0aCA9IGUsIG4uc3R5bGUuaGVpZ2h0ID0gdDsKICAgIH0sIHIucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSBlOwogICAgfSwgci5wcm90b3R5cGUuZ2V0TGFyZ2VzdFpJbmRleCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSBsLm1hcCh0aGlzLnNpYmxpbmcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUuekluZGV4OwogICAgICB9KTsKICAgICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIGUpOwogICAgfSwgci5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5nZXRMYXJnZXN0WkluZGV4KCkgKyAxOwogICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS56SW5kZXggPSB0aGlzLnpJbmRleCA9IGU7CiAgICB9LCByLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmZvY3VzKCksIHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgfSwgci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIH0sIGUuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMSksCiAgICAgICAgaSA9IG4oNiksCiAgICAgICAgYSA9IG4oNSksCiAgICAgICAgciA9IG4oMyksCiAgICAgICAgcyA9IE1hdGgubWF4LAogICAgICAgIGMgPSBNYXRoLm1pbiwKICAgICAgICB1ID0gewogICAgICBfcmV0cml2ZVNjaGVkdWxlRGF0YTogZnVuY3Rpb24gX3JldHJpdmVTY2hlZHVsZURhdGEoZSwgdCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBsLAogICAgICAgICAgICByLAogICAgICAgICAgICB1LAogICAgICAgICAgICBoLAogICAgICAgICAgICBwLAogICAgICAgICAgICBtLAogICAgICAgICAgICBmID0gZS5jaGlsZHJlbi5zaW5nbGUoKTsKICAgICAgICByZXR1cm4gISFmICYmIChuID0gZi5jb250YWluZXIsIG0gPSBmLmdldFJlbmRlckRhdGVSYW5nZSgpLCBsID0gbS5sZW5ndGgsIHAgPSBmLmdldFJlbmRlckRhdGVHcmlkcygpLCByID0gby5nZXRTaXplKG4pWzBdLCB1ID0gaS5nZXRNb3VzZVBvc2l0aW9uKHQsIG4pLCBoID0gZChwLCBhLnJhdGlvKHIsIDEwMCwgdVswXSkpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG8gPSBpLmdldE1vdXNlUG9zaXRpb24odCwgbilbMF0sCiAgICAgICAgICAgICAgdSA9IGQocCwgYS5yYXRpbyhyLCAxMDAsIG8pKTsKICAgICAgICAgIHJldHVybiB1ID0gcyh1LCAwKSwgdSA9IGModSwgbCAtIDEpLCB7CiAgICAgICAgICAgIHJlbGF0ZWRWaWV3OiBlLAogICAgICAgICAgICBkcmFnU3RhcnRYSW5kZXg6IGgsCiAgICAgICAgICAgIGRhdGVzSW5SYW5nZTogbCwKICAgICAgICAgICAgeEluZGV4OiB1LAogICAgICAgICAgICB0cmlnZ2VyRXZlbnQ6IHQudHlwZSwKICAgICAgICAgICAgZ3JpZHM6IHAsCiAgICAgICAgICAgIHJhbmdlOiBtCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9LAogICAgICBfcmV0cml2ZVNjaGVkdWxlRGF0YUZyb21EYXRlOiBmdW5jdGlvbiBfcmV0cml2ZVNjaGVkdWxlRGF0YUZyb21EYXRlKGUsIHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgbywKICAgICAgICAgICAgaSwKICAgICAgICAgICAgYSA9IGUuY2hpbGRyZW4uc2luZ2xlKCksCiAgICAgICAgICAgIHUgPSAwLAogICAgICAgICAgICBkID0gMDsKICAgICAgICByZXR1cm4gISFhICYmIChuID0gKGkgPSBhLmdldFJlbmRlckRhdGVSYW5nZSgpKS5sZW5ndGgsIG8gPSBhLmdldFJlbmRlckRhdGVHcmlkcygpLCBsLmZvckVhY2goaSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICAgIHIuaXNTYW1lRGF0ZShlLCB0KSAmJiAodSA9IGQgPSBuKTsKICAgICAgICB9KSwgdSA9IHModSwgMCksIHUgPSBjKHUsIG4gLSAxKSwgewogICAgICAgICAgcmVsYXRlZFZpZXc6IGUsCiAgICAgICAgICBkcmFnU3RhcnRYSW5kZXg6IGQsCiAgICAgICAgICBkYXRlc0luUmFuZ2U6IG4sCiAgICAgICAgICB4SW5kZXg6IHUsCiAgICAgICAgICB0cmlnZ2VyRXZlbnQ6ICJtYW51YWwiLAogICAgICAgICAgZ3JpZHM6IG8sCiAgICAgICAgICByYW5nZTogaQogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIGQoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSAwLAogICAgICAgICAgbyA9IGUubGVuZ3RoOwoKICAgICAgZm9yICh0IDwgMCAmJiAodCA9IDApOyBsIDwgbzsgbCArPSAxKSB7CiAgICAgICAgaWYgKChuID0gZVtsXSkubGVmdCA8PSB0ICYmIHQgPD0gbi5sZWZ0ICsgbi53aWR0aCkgcmV0dXJuIGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBsOwogICAgfQoKICAgIGUuZXhwb3J0cyA9IHU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oNSksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oNiksCiAgICAgICAgciA9IG4oMzEpLAogICAgICAgIHMgPSBuKDQpLkRhdGUsCiAgICAgICAgYyA9IHsKICAgICAgX2NhbGNHcmlkWUluZGV4OiBmdW5jdGlvbiBfY2FsY0dyaWRZSW5kZXgoZSwgdCwgbikgewogICAgICAgIHZhciBsID0gaS5taWxsaXNlY29uZHNUbygiaG91ciIsIG4gKiBlIC8gdCksCiAgICAgICAgICAgIGEgPSAwIHwgbDsKICAgICAgICByZXR1cm4gYSArIChvLm5lYXJlc3QobCAtIGEsIFswLCAxXSkgPyAuNSA6IDApOwogICAgICB9LAogICAgICBfcmV0cml2ZVNjaGVkdWxlRGF0YTogZnVuY3Rpb24gX3JldHJpdmVTY2hlZHVsZURhdGEoZSkgewogICAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgICAgbiA9IGUuY29udGFpbmVyLAogICAgICAgICAgICBjID0gZS5vcHRpb25zLAogICAgICAgICAgICB1ID0gZS5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsCiAgICAgICAgICAgIGQgPSBlLmdldERhdGUoKSwKICAgICAgICAgICAgaCA9IGMuaG91ckVuZCAtIGMuaG91clN0YXJ0LAogICAgICAgICAgICBwID0gaS5taWxsaXNlY29uZHNGcm9tKCJob3VyIiwgaCk7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtLCBmKSB7CiAgICAgICAgICB2YXIgZyA9IHIubihhLmdldE1vdXNlUG9zaXRpb24obSwgbikpLnksCiAgICAgICAgICAgICAgeSA9IG8ucmF0aW8odSwgaCwgZyksCiAgICAgICAgICAgICAgUyA9IG5ldyBzKGQpLmFkZE1pbnV0ZXMoaS5taW51dGVzRnJvbUhvdXJzKHkpKSwKICAgICAgICAgICAgICBfID0gdC5fY2FsY0dyaWRZSW5kZXgocCwgdSwgZyksCiAgICAgICAgICAgICAgQyA9IG5ldyBzKGQpLmFkZE1pbnV0ZXMoaS5taW51dGVzRnJvbUhvdXJzKF8gKyBjLmhvdXJTdGFydCkpOwoKICAgICAgICAgIHJldHVybiBsLmV4dGVuZCh7CiAgICAgICAgICAgIHRhcmdldDogYS5nZXRFdmVudFRhcmdldChtKSwKICAgICAgICAgICAgcmVsYXRlZFZpZXc6IGUsCiAgICAgICAgICAgIG9yaWdpbkV2ZW50OiBtLAogICAgICAgICAgICBtb3VzZVk6IGcsCiAgICAgICAgICAgIGdyaWRZOiB5LAogICAgICAgICAgICB0aW1lWTogUywKICAgICAgICAgICAgbmVhcmVzdEdyaWRZOiBfLAogICAgICAgICAgICBuZWFyZXN0R3JpZFRpbWVZOiBDLAogICAgICAgICAgICB0cmlnZ2VyRXZlbnQ6IG0udHlwZQogICAgICAgICAgfSwgZik7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgX3JldHJpdmVTY2hlZHVsZURhdGFGcm9tRGF0ZTogZnVuY3Rpb24gX3JldHJpdmVTY2hlZHVsZURhdGFGcm9tRGF0ZShlLCB0LCBuLCBsKSB7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGMgPSBlLmdldERhdGUoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGFyZ2V0OiBlLAogICAgICAgICAgcmVsYXRlZFZpZXc6IGUsCiAgICAgICAgICBncmlkWTogbyA9IHQuZ2V0SG91cnMoKSAtIGwgKyB1KHQuZ2V0TWludXRlcygpKSwKICAgICAgICAgIHRpbWVZOiBuZXcgcyhjKS5hZGRNaW51dGVzKGkubWludXRlc0Zyb21Ib3VycyhvKSksCiAgICAgICAgICBuZWFyZXN0R3JpZFk6IGEgPSBvLAogICAgICAgICAgbmVhcmVzdEdyaWRUaW1lWTogbmV3IHMoYykuYWRkTWludXRlcyhpLm1pbnV0ZXNGcm9tSG91cnMoYSkpLAogICAgICAgICAgbmVhcmVzdEdyaWRFbmRZOiByID0gbi5nZXRIb3VycygpIC0gbCArIHUobi5nZXRNaW51dGVzKCkpLAogICAgICAgICAgbmVhcmVzdEdyaWRFbmRUaW1lWTogbmV3IHMoYykuYWRkTWludXRlcyhpLm1pbnV0ZXNGcm9tSG91cnMocikpLAogICAgICAgICAgdHJpZ2dlckV2ZW50OiAibWFudWFsIiwKICAgICAgICAgIGhvdXJTdGFydDogbAogICAgICAgIH07CiAgICAgIH0sCiAgICAgIG1peGluOiBmdW5jdGlvbiBtaXhpbihlKSB7CiAgICAgICAgdmFyIHQgPSBlLnByb3RvdHlwZTsKICAgICAgICBsLmZvckVhY2goYywgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICAgICJtaXhpbiIgIT09IG4gJiYgKHRbbl0gPSBlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiB1KGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHJldHVybiAwID09PSBlID8gdCA9IDAgOiBlID4gMzAgPyB0ID0gMSA6IGUgPD0gMzAgJiYgKHQgPSAuNSksIHQ7CiAgICB9CgogICAgZS5leHBvcnRzID0gYzsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbig1KSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbig2KSwKICAgICAgICByID0gTWF0aC5mbG9vcjsKCiAgICBlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUuY2hpbGRyZW4sCiAgICAgICAgICBuID0gdC5zb3J0KGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGwuc3RhbXAoZSkgLSBsLnN0YW1wKHQpOwogICAgICB9KSwKICAgICAgICAgIHMgPSB0Lmxlbmd0aCwKICAgICAgICAgIGMgPSB0LnNpbmdsZSgpLmdldFJlbmRlckRhdGVSYW5nZSgpLmxlbmd0aCwKICAgICAgICAgIHUgPSBsLnBpY2soZS52TGF5b3V0LnBhbmVsc1sxXSwgImNvbnRhaW5lciIpLAogICAgICAgICAgZCA9IGkuZ2V0U2l6ZSh1KSwKICAgICAgICAgIGggPSBlLmdyaWRzOwogICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgcCwKICAgICAgICAgICAgbSA9IGEuZ2V0TW91c2VQb3NpdGlvbihlLCB1KSwKICAgICAgICAgICAgZiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBmb3IgKHZhciB0LCBuID0gMCwgbCA9IGgubGVuZ3RoOyBuIDwgbDsgbiArPSAxKSB7CiAgICAgICAgICAgIGlmICgodCA9IGhbbl0pLmxlZnQgPD0gZSAmJiBlIDw9IHQubGVmdCArIHQud2lkdGgpIHJldHVybiBuOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlIDwgMCA/IC0xIDogbjsKICAgICAgICB9KG8ucmF0aW8oZFswXSwgMTAwLCBtWzBdKSksCiAgICAgICAgICAgIGcgPSByKG8ucmF0aW8oZFsxXSwgcywgbVsxXSkpOwoKICAgICAgICByZXR1cm4gZyA8IDAgJiYgKGcgPSAwKSwgZyA+PSBuLmxlbmd0aCAmJiAoZyA9IG4ubGVuZ3RoIC0gMSksICh0ID0gbC5waWNrKG4sIGcpKSA/IChmIDwgMCAmJiAoZiA9IDApLCBmID49IChwID0gdC5nZXRSZW5kZXJEYXRlUmFuZ2UoKSkubGVuZ3RoICYmIChmID0gcC5sZW5ndGggLSAxKSwgKGkgPSBsLnBpY2socCwgZikpID8gewogICAgICAgICAgeDogZiwKICAgICAgICAgIHk6IGcsCiAgICAgICAgICBzaXplWDogYywKICAgICAgICAgIHNpemVZOiBzLAogICAgICAgICAgZGF0ZTogaSwKICAgICAgICAgIHdlZWtkYXlWaWV3OiB0LAogICAgICAgICAgdHJpZ2dlckV2ZW50OiBlLnR5cGUKICAgICAgICB9IDogbnVsbCkgOiBudWxsOwogICAgICB9OwogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgZS5leHBvcnRzID0gbigyMSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBmdW5jdGlvbiBsKGUpIHsKICAgICAgcmV0dXJuIGUgJiYgZS5fX2VzTW9kdWxlID8gZSA6IHsKICAgICAgICBkZWZhdWx0OiBlCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbyhlKSB7CiAgICAgIGlmIChlICYmIGUuX19lc01vZHVsZSkgcmV0dXJuIGU7CiAgICAgIHZhciB0ID0ge307CiAgICAgIGlmIChudWxsICE9IGUpIGZvciAodmFyIG4gaW4gZSkgewogICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBuKSAmJiAodFtuXSA9IGVbbl0pOwogICAgICB9CiAgICAgIHJldHVybiB0LmRlZmF1bHQgPSBlLCB0OwogICAgfQoKICAgIHQuX19lc01vZHVsZSA9ICEwOwogICAgdmFyIGkgPSBvKG4oMjIpKSwKICAgICAgICBhID0gbChuKDQ4KSksCiAgICAgICAgciA9IGwobigxMikpLAogICAgICAgIHMgPSBvKG4oMTApKSwKICAgICAgICBjID0gbyhuKDQ5KSksCiAgICAgICAgdSA9IGwobig1MSkpOwoKICAgIGZ1bmN0aW9uIGQoKSB7CiAgICAgIHZhciBlID0gbmV3IGkuSGFuZGxlYmFyc0Vudmlyb25tZW50KCk7CiAgICAgIHJldHVybiBzLmV4dGVuZChlLCBpKSwgZS5TYWZlU3RyaW5nID0gYS5kZWZhdWx0LCBlLkV4Y2VwdGlvbiA9IHIuZGVmYXVsdCwgZS5VdGlscyA9IHMsIGUuZXNjYXBlRXhwcmVzc2lvbiA9IHMuZXNjYXBlRXhwcmVzc2lvbiwgZS5WTSA9IGMsIGUudGVtcGxhdGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBjLnRlbXBsYXRlKHQsIGUpOwogICAgICB9LCBlOwogICAgfQoKICAgIHZhciBoID0gZCgpOwogICAgaC5jcmVhdGUgPSBkLCB1LmRlZmF1bHQoaCksIGguZGVmYXVsdCA9IGgsIHQuZGVmYXVsdCA9IGgsIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGwoZSkgewogICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogewogICAgICAgIGRlZmF1bHQ6IGUKICAgICAgfTsKICAgIH0KCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5IYW5kbGViYXJzRW52aXJvbm1lbnQgPSB1OwogICAgdmFyIG8gPSBuKDEwKSwKICAgICAgICBpID0gbChuKDEyKSksCiAgICAgICAgYSA9IG4oMjMpLAogICAgICAgIHIgPSBuKDQ1KSwKICAgICAgICBzID0gbChuKDI0KSksCiAgICAgICAgYyA9IG4oMjUpOwogICAgdC5WRVJTSU9OID0gIjQuNy4zIjsKICAgIHQuQ09NUElMRVJfUkVWSVNJT04gPSA4OwogICAgdC5MQVNUX0NPTVBBVElCTEVfQ09NUElMRVJfUkVWSVNJT04gPSA3OwogICAgdC5SRVZJU0lPTl9DSEFOR0VTID0gewogICAgICAxOiAiPD0gMS4wLnJjLjIiLAogICAgICAyOiAiPT0gMS4wLjAtcmMuMyIsCiAgICAgIDM6ICI9PSAxLjAuMC1yYy40IiwKICAgICAgNDogIj09IDEueC54IiwKICAgICAgNTogIj09IDIuMC4wLWFscGhhLngiLAogICAgICA2OiAiPj0gMi4wLjAtYmV0YS4xIiwKICAgICAgNzogIj49IDQuMC4wIDw0LjMuMCIsCiAgICAgIDg6ICI+PSA0LjMuMCIKICAgIH07CgogICAgZnVuY3Rpb24gdShlLCB0LCBuKSB7CiAgICAgIHRoaXMuaGVscGVycyA9IGUgfHwge30sIHRoaXMucGFydGlhbHMgPSB0IHx8IHt9LCB0aGlzLmRlY29yYXRvcnMgPSBuIHx8IHt9LCBhLnJlZ2lzdGVyRGVmYXVsdEhlbHBlcnModGhpcyksIHIucmVnaXN0ZXJEZWZhdWx0RGVjb3JhdG9ycyh0aGlzKTsKICAgIH0KCiAgICB1LnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IHUsCiAgICAgIGxvZ2dlcjogcy5kZWZhdWx0LAogICAgICBsb2c6IHMuZGVmYXVsdC5sb2csCiAgICAgIHJlZ2lzdGVySGVscGVyOiBmdW5jdGlvbiByZWdpc3RlckhlbHBlcihlLCB0KSB7CiAgICAgICAgaWYgKCJbb2JqZWN0IE9iamVjdF0iID09PSBvLnRvU3RyaW5nLmNhbGwoZSkpIHsKICAgICAgICAgIGlmICh0KSB0aHJvdyBuZXcgaS5kZWZhdWx0KCJBcmcgbm90IHN1cHBvcnRlZCB3aXRoIG11bHRpcGxlIGhlbHBlcnMiKTsKICAgICAgICAgIG8uZXh0ZW5kKHRoaXMuaGVscGVycywgZSk7CiAgICAgICAgfSBlbHNlIHRoaXMuaGVscGVyc1tlXSA9IHQ7CiAgICAgIH0sCiAgICAgIHVucmVnaXN0ZXJIZWxwZXI6IGZ1bmN0aW9uIHVucmVnaXN0ZXJIZWxwZXIoZSkgewogICAgICAgIGRlbGV0ZSB0aGlzLmhlbHBlcnNbZV07CiAgICAgIH0sCiAgICAgIHJlZ2lzdGVyUGFydGlhbDogZnVuY3Rpb24gcmVnaXN0ZXJQYXJ0aWFsKGUsIHQpIHsKICAgICAgICBpZiAoIltvYmplY3QgT2JqZWN0XSIgPT09IG8udG9TdHJpbmcuY2FsbChlKSkgby5leHRlbmQodGhpcy5wYXJ0aWFscywgZSk7ZWxzZSB7CiAgICAgICAgICBpZiAodm9pZCAwID09PSB0KSB0aHJvdyBuZXcgaS5kZWZhdWx0KCdBdHRlbXB0aW5nIHRvIHJlZ2lzdGVyIGEgcGFydGlhbCBjYWxsZWQgIicgKyBlICsgJyIgYXMgdW5kZWZpbmVkJyk7CiAgICAgICAgICB0aGlzLnBhcnRpYWxzW2VdID0gdDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHVucmVnaXN0ZXJQYXJ0aWFsOiBmdW5jdGlvbiB1bnJlZ2lzdGVyUGFydGlhbChlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMucGFydGlhbHNbZV07CiAgICAgIH0sCiAgICAgIHJlZ2lzdGVyRGVjb3JhdG9yOiBmdW5jdGlvbiByZWdpc3RlckRlY29yYXRvcihlLCB0KSB7CiAgICAgICAgaWYgKCJbb2JqZWN0IE9iamVjdF0iID09PSBvLnRvU3RyaW5nLmNhbGwoZSkpIHsKICAgICAgICAgIGlmICh0KSB0aHJvdyBuZXcgaS5kZWZhdWx0KCJBcmcgbm90IHN1cHBvcnRlZCB3aXRoIG11bHRpcGxlIGRlY29yYXRvcnMiKTsKICAgICAgICAgIG8uZXh0ZW5kKHRoaXMuZGVjb3JhdG9ycywgZSk7CiAgICAgICAgfSBlbHNlIHRoaXMuZGVjb3JhdG9yc1tlXSA9IHQ7CiAgICAgIH0sCiAgICAgIHVucmVnaXN0ZXJEZWNvcmF0b3I6IGZ1bmN0aW9uIHVucmVnaXN0ZXJEZWNvcmF0b3IoZSkgewogICAgICAgIGRlbGV0ZSB0aGlzLmRlY29yYXRvcnNbZV07CiAgICAgIH0sCiAgICAgIHJlc2V0TG9nZ2VkUHJvcGVydHlBY2Nlc3NlczogZnVuY3Rpb24gcmVzZXRMb2dnZWRQcm9wZXJ0eUFjY2Vzc2VzKCkgewogICAgICAgIGMucmVzZXRMb2dnZWRQcm9wZXJ0aWVzKCk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgZCA9IHMuZGVmYXVsdC5sb2c7CiAgICB0LmxvZyA9IGQsIHQuY3JlYXRlRnJhbWUgPSBvLmNyZWF0ZUZyYW1lLCB0LmxvZ2dlciA9IHMuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGwoZSkgewogICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogewogICAgICAgIGRlZmF1bHQ6IGUKICAgICAgfTsKICAgIH0KCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5yZWdpc3RlckRlZmF1bHRIZWxwZXJzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgby5kZWZhdWx0KGUpLCBpLmRlZmF1bHQoZSksIGEuZGVmYXVsdChlKSwgci5kZWZhdWx0KGUpLCBzLmRlZmF1bHQoZSksIGMuZGVmYXVsdChlKSwgdS5kZWZhdWx0KGUpOwogICAgfSwgdC5tb3ZlSGVscGVyVG9Ib29rcyA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIGUuaGVscGVyc1t0XSAmJiAoZS5ob29rc1t0XSA9IGUuaGVscGVyc1t0XSwgbiB8fCBkZWxldGUgZS5oZWxwZXJzW3RdKTsKICAgIH07CiAgICB2YXIgbyA9IGwobigzOCkpLAogICAgICAgIGkgPSBsKG4oMzkpKSwKICAgICAgICBhID0gbChuKDQwKSksCiAgICAgICAgciA9IGwobig0MSkpLAogICAgICAgIHMgPSBsKG4oNDIpKSwKICAgICAgICBjID0gbChuKDQzKSksCiAgICAgICAgdSA9IGwobig0NCkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCA9IG4oMTApLAogICAgICAgIG8gPSB7CiAgICAgIG1ldGhvZE1hcDogWyJkZWJ1ZyIsICJpbmZvIiwgIndhcm4iLCAiZXJyb3IiXSwKICAgICAgbGV2ZWw6ICJpbmZvIiwKICAgICAgbG9va3VwTGV2ZWw6IGZ1bmN0aW9uIGxvb2t1cExldmVsKGUpIHsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIGUpIHsKICAgICAgICAgIHZhciB0ID0gbC5pbmRleE9mKG8ubWV0aG9kTWFwLCBlLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgZSA9IHQgPj0gMCA/IHQgOiBwYXJzZUludChlLCAxMCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZTsKICAgICAgfSwKICAgICAgbG9nOiBmdW5jdGlvbiBsb2coZSkgewogICAgICAgIGlmIChlID0gby5sb29rdXBMZXZlbChlKSwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGNvbnNvbGUgJiYgby5sb29rdXBMZXZlbChvLmxldmVsKSA8PSBlKSB7CiAgICAgICAgICB2YXIgdCA9IG8ubWV0aG9kTWFwW2VdOwogICAgICAgICAgY29uc29sZVt0XSB8fCAodCA9ICJsb2ciKTsKCiAgICAgICAgICBmb3IgKHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCwgbCA9IEFycmF5KG4gPiAxID8gbiAtIDEgOiAwKSwgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgbFtpIC0gMV0gPSBhcmd1bWVudHNbaV07CiAgICAgICAgICB9CgogICAgICAgICAgY29uc29sZVt0XS5hcHBseShjb25zb2xlLCBsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICB0LmRlZmF1bHQgPSBvLCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5jcmVhdGVQcm90b0FjY2Vzc0NvbnRyb2wgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHQuY29uc3RydWN0b3IgPSAhMSwgdC5fX2RlZmluZUdldHRlcl9fID0gITEsIHQuX19kZWZpbmVTZXR0ZXJfXyA9ICExLCB0Ll9fbG9va3VwR2V0dGVyX18gPSAhMTsKICAgICAgdmFyIG4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICByZXR1cm4gbi5fX3Byb3RvX18gPSAhMSwgewogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgIHdoaXRlbGlzdDogbC5jcmVhdGVOZXdMb29rdXBPYmplY3QobiwgZS5hbGxvd2VkUHJvdG9Qcm9wZXJ0aWVzKSwKICAgICAgICAgIGRlZmF1bHRWYWx1ZTogZS5hbGxvd1Byb3RvUHJvcGVydGllc0J5RGVmYXVsdAogICAgICAgIH0sCiAgICAgICAgbWV0aG9kczogewogICAgICAgICAgd2hpdGVsaXN0OiBsLmNyZWF0ZU5ld0xvb2t1cE9iamVjdCh0LCBlLmFsbG93ZWRQcm90b01ldGhvZHMpLAogICAgICAgICAgZGVmYXVsdFZhbHVlOiBlLmFsbG93UHJvdG9NZXRob2RzQnlEZWZhdWx0CiAgICAgICAgfQogICAgICB9OwogICAgfSwgdC5yZXN1bHRJc0FsbG93ZWQgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICByZXR1cm4gYSgiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gdC5tZXRob2RzIDogdC5wcm9wZXJ0aWVzLCBuKTsKICAgIH0sIHQucmVzZXRMb2dnZWRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCkgewogICAgICBPYmplY3Qua2V5cyhpKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZGVsZXRlIGlbZV07CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgbCA9IG4oNDcpLAogICAgICAgIG8gPSBmdW5jdGlvbiAoZSkgewogICAgICBpZiAoZSAmJiBlLl9fZXNNb2R1bGUpIHJldHVybiBlOwogICAgICB2YXIgdCA9IHt9OwogICAgICBpZiAobnVsbCAhPSBlKSBmb3IgKHZhciBuIGluIGUpIHsKICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbikgJiYgKHRbbl0gPSBlW25dKTsKICAgICAgfQogICAgICByZXR1cm4gdC5kZWZhdWx0ID0gZSwgdDsKICAgIH0obigyNCkpLAogICAgICAgIGkgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIGZ1bmN0aW9uIGEoZSwgdCkgewogICAgICByZXR1cm4gdm9pZCAwICE9PSBlLndoaXRlbGlzdFt0XSA/ICEwID09PSBlLndoaXRlbGlzdFt0XSA6IHZvaWQgMCAhPT0gZS5kZWZhdWx0VmFsdWUgPyBlLmRlZmF1bHRWYWx1ZSA6IChmdW5jdGlvbiAoZSkgewogICAgICAgICEwICE9PSBpW2VdICYmIChpW2VdID0gITAsIG8ubG9nKCJlcnJvciIsICdIYW5kbGViYXJzOiBBY2Nlc3MgaGFzIGJlZW4gZGVuaWVkIHRvIHJlc29sdmUgdGhlIHByb3BlcnR5ICInICsgZSArICciIGJlY2F1c2UgaXQgaXMgbm90IGFuICJvd24gcHJvcGVydHkiIG9mIGl0cyBwYXJlbnQuXG5Zb3UgY2FuIGFkZCBhIHJ1bnRpbWUgb3B0aW9uIHRvIGRpc2FibGUgdGhlIGNoZWNrIG9yIHRoaXMgd2FybmluZzpcblNlZSBodHRwczovL2hhbmRsZWJhcnNqcy5jb20vYXBpLXJlZmVyZW5jZS9ydW50aW1lLW9wdGlvbnMuaHRtbCNvcHRpb25zLXRvLWNvbnRyb2wtcHJvdG90eXBlLWFjY2VzcyBmb3IgZGV0YWlscycpKTsKICAgICAgfSh0KSwgITEpOwogICAgfQogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDQpLkRhdGU7CgogICAgZnVuY3Rpb24gbyhlKSB7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBvKSkgcmV0dXJuIG5ldyBvKGUpOwogICAgICBlIGluc3RhbmNlb2YgbCB8fCAoZSA9IG5ldyBsKGUpKSwgdGhpcy5kID0gZTsKICAgIH0KCiAgICBvLnByb3RvdHlwZS5zYWZlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIGUuY29uc3RydWN0b3IgPT09IG8gPyBlLmQgOiBlOwogICAgfSwgby5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBuZXcgbyhuZXcgbCh0aGlzLmQpKTsKICAgIH0sIG8ucHJvdG90eXBlLmFkZERhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5kLnNldERhdGUodGhpcy5kLmdldERhdGUoKSArIGUpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuYWRkTW9udGggPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZC5nZXRNb250aCgpLAogICAgICAgICAgbiA9IHRoaXMuZC5nZXREYXRlKCksCiAgICAgICAgICBsID0gdGhpcy5faXNMZWFwWWVhcigpLAogICAgICAgICAgbyA9IHQgKyBlLAogICAgICAgICAgaSA9IHRoaXMuY2xvbmUoKSwKICAgICAgICAgIGEgPSBuOwoKICAgICAgcmV0dXJuIGUgJiYgKDEgPT09IG8gPyBhID0gbCA/IDI5IDogMjggOiAoZSA+IDAgPyBpLmQuc2V0TW9udGgobyArIDEsIDApIDogaS5kLnNldE1vbnRoKHQsIDApLCBhID0gaS5kLmdldERhdGUoKSkpLCB0aGlzLmQuc2V0TW9udGgobywgTWF0aC5taW4obiwgYSkpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuX2lzTGVhcFllYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5kLmdldEZ1bGxZZWFyKCk7CiAgICAgIHJldHVybiBlICUgNCA9PSAwICYmIGUgJSAxMDAgIT0gMCB8fCAhKGUgJSA0MDApOwogICAgfSwgby5wcm90b3R5cGUuc2V0SG91cnMgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICByZXR1cm4gdGhpcy5kLnNldEhvdXJzKGUsIHQsIG4sIGwpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuaXNCZXR3ZWVuID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLnNhZmU7CiAgICAgIHJldHVybiBuKGUpIDw9IHRoaXMuZCAmJiB0aGlzLmQgPD0gbih0KTsKICAgIH0sIGUuZXhwb3J0cyA9IG87CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oMSksCiAgICAgICAgICBpID0gbig2KSwKICAgICAgICAgIGEgPSBuKDIpOwoKICAgICAgZnVuY3Rpb24gcihlLCB0KSB7CiAgICAgICAgaS5vbih0LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgICBkaXN0YW5jZTogMTAsCiAgICAgICAgICBleGNsdWRlOiBudWxsCiAgICAgICAgfSwgZSksIHRoaXMuY29udGFpbmVyID0gdCwgdGhpcy5fY2FuY2VsbGVkID0gITEsIHRoaXMuX2lzTW92ZWQgPSAhMSwgdGhpcy5fZGlzdGFuY2UgPSAwLCB0aGlzLl9kcmFnU3RhcnRGaXJlZCA9ICExLCB0aGlzLl9kcmFnU3RhcnRFdmVudERhdGEgPSBudWxsOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzKGUpIHsKICAgICAgICBvLmNsb3Nlc3QoZS50YXJnZXQsIGEuY2xhc3NuYW1lKCIucG9wdXAiKSkgfHwgaS5wcmV2ZW50RGVmYXVsdChlKTsKICAgICAgfQoKICAgICAgci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpLm9mZih0aGlzLmNvbnRhaW5lciwgIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKSwgdGhpcy5faXNNb3ZlZCA9IG51bGwsIHRoaXMuY29udGFpbmVyID0gbnVsbDsKICAgICAgfSwgci5wcm90b3R5cGUuX2NsZWFyRGF0YSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jYW5jZWxsZWQgPSAhMSwgdGhpcy5fZGlzdGFuY2UgPSAwLCB0aGlzLl9pc01vdmVkID0gITEsIHRoaXMuX2RyYWdTdGFydEZpcmVkID0gITEsIHRoaXMuX2RyYWdTdGFydEV2ZW50RGF0YSA9IG51bGw7CiAgICAgIH0sIHIucHJvdG90eXBlLl90b2dnbGVEcmFnRXZlbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBsLAogICAgICAgICAgICBhID0gdGhpcy5jb250YWluZXI7CiAgICAgICAgZSA/IChuID0gIm9uIiwgbCA9ICJkaXNhYmxlIikgOiAobiA9ICJvZmYiLCBsID0gImVuYWJsZSIpLCBvW2wgKyAiVGV4dFNlbGVjdGlvbiJdKGEsIHMpLCBvW2wgKyAiSW1hZ2VEcmFnIl0oYSwgcyksIGlbbl0odC5kb2N1bWVudCwgewogICAgICAgICAgbW91c2Vtb3ZlOiB0aGlzLl9vbk1vdXNlTW92ZSwKICAgICAgICAgIG1vdXNldXA6IHRoaXMuX29uTW91c2VVcAogICAgICAgIH0sIHRoaXMpOwogICAgICB9LCByLnByb3RvdHlwZS5fZ2V0RXZlbnREYXRhID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGFyZ2V0OiBpLmdldEV2ZW50VGFyZ2V0KGUpLAogICAgICAgICAgb3JpZ2luRXZlbnQ6IGUKICAgICAgICB9OwogICAgICB9LCByLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBuID0gaS5nZXRFdmVudFRhcmdldChlKTsKICAgICAgICAwID09PSBpLmdldE1vdXNlQnV0dG9uKGUpICYmICh0LmV4Y2x1ZGUgJiYgdC5leGNsdWRlKG4pID8gdGhpcy5fY2FuY2VsbGVkID0gITAgOiAodGhpcy5fY2xlYXJEYXRhKCksIHRoaXMuX2RyYWdTdGFydEV2ZW50RGF0YSA9IHRoaXMuX2dldEV2ZW50RGF0YShlKSwgdGhpcy5fdG9nZ2xlRHJhZ0V2ZW50KCEwKSwgdGhpcy5maXJlKCJtb3VzZWRvd24iLCB0aGlzLl9kcmFnU3RhcnRFdmVudERhdGEpKSk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbk1vdXNlTW92ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgaWYgKHRoaXMuX2NhbmNlbGxlZCkgdGhpcy5fY2xlYXJEYXRhKCk7ZWxzZSBpZiAodCA9IHRoaXMub3B0aW9ucy5kaXN0YW5jZSwgcyhlKSwgdGhpcy5fZGlzdGFuY2UgPCB0KSB0aGlzLl9kaXN0YW5jZSArPSAxO2Vsc2UgewogICAgICAgICAgaWYgKHRoaXMuX2lzTW92ZWQgPSAhMCwgIXRoaXMuX2RyYWdTdGFydEZpcmVkICYmICh0aGlzLl9kcmFnU3RhcnRGaXJlZCA9ICEwLCAhdGhpcy5pbnZva2UoImRyYWdTdGFydCIsIHRoaXMuX2RyYWdTdGFydEV2ZW50RGF0YSkpKSByZXR1cm4gdGhpcy5fdG9nZ2xlRHJhZ0V2ZW50KCExKSwgdm9pZCB0aGlzLl9jbGVhckRhdGEoKTsKICAgICAgICAgIHRoaXMuZmlyZSgiZHJhZyIsIHRoaXMuX2dldEV2ZW50RGF0YShlKSk7CiAgICAgICAgfQogICAgICB9LCByLnByb3RvdHlwZS5fb25Nb3VzZVVwID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl9jYW5jZWxsZWQgfHwgKHRoaXMuX3RvZ2dsZURyYWdFdmVudCghMSksIHRoaXMuX2lzTW92ZWQgPyAodGhpcy5faXNNb3ZlZCA9ICExLCB0aGlzLmZpcmUoImRyYWdFbmQiLCB0aGlzLl9nZXRFdmVudERhdGEoZSkpKSA6IHRoaXMuZmlyZSgiY2xpY2siLCB0aGlzLl9nZXRFdmVudERhdGEoZSkpLCB0aGlzLl9jbGVhckRhdGEoKSk7CiAgICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKHIpLCBlLmV4cG9ydHMgPSByOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigzKSwKICAgICAgICBpID0gby5NSUxMSVNFQ09ORFNfU0NIRURVTEVfTUlOX0RVUkFUSU9OOwoKICAgIGZ1bmN0aW9uIGEoZSkgewogICAgICB0aGlzLm1vZGVsID0gZSwgdGhpcy50b3AgPSAwLCB0aGlzLmxlZnQgPSAwLCB0aGlzLndpZHRoID0gMCwgdGhpcy5oZWlnaHQgPSAwLCB0aGlzLmhhc0NvbGxpZGUgPSAhMSwgdGhpcy5leHRyYVNwYWNlID0gMCwgdGhpcy5oaWRkZW4gPSAhMSwgdGhpcy5oYXNNdWx0aURhdGVzID0gITEsIHRoaXMucmVuZGVyU3RhcnRzID0gbnVsbCwgdGhpcy5leGNlZWRMZWZ0ID0gITEsIHRoaXMucmVuZGVyRW5kcyA9IG51bGwsIHRoaXMuZXhjZWVkUmlnaHQgPSAhMTsKICAgIH0KCiAgICBhLmNyZWF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBuZXcgYShlKTsKICAgIH0sIGEucHJvdG90eXBlLmdldFN0YXJ0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMucmVuZGVyU3RhcnRzID8gdGhpcy5yZW5kZXJTdGFydHMgOiB0aGlzLm1vZGVsLnN0YXJ0OwogICAgfSwgYS5wcm90b3R5cGUuZ2V0RW5kcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRW5kcyA/IHRoaXMucmVuZGVyRW5kcyA6IHRoaXMubW9kZWwuZW5kOwogICAgfSwgYS5wcm90b3R5cGUuY2lkID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbC5zdGFtcCh0aGlzLm1vZGVsKTsKICAgIH0sIGEucHJvdG90eXBlLnZhbHVlT2YgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsOwogICAgfSwgYS5wcm90b3R5cGUuZHVyYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsLmR1cmF0aW9uKCk7CiAgICB9LCBhLnByb3RvdHlwZS5jb2xsaWRlc1dpdGggPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ2V0U3RhcnRzKCksCiAgICAgICAgICBuID0gdGhpcy5nZXRFbmRzKCksCiAgICAgICAgICBsID0gZS5nZXRTdGFydHMoKSwKICAgICAgICAgIGEgPSBlLmdldEVuZHMoKSwKICAgICAgICAgIHIgPSBvLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCB0aGlzLnZhbHVlT2YoKS5nb2luZ0R1cmF0aW9uKSwKICAgICAgICAgIHMgPSBvLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCB0aGlzLnZhbHVlT2YoKS5jb21pbmdEdXJhdGlvbiksCiAgICAgICAgICBjID0gby5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgZS52YWx1ZU9mKCkuZ29pbmdEdXJhdGlvbiksCiAgICAgICAgICB1ID0gby5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgZS52YWx1ZU9mKCkuY29taW5nRHVyYXRpb24pOwogICAgICByZXR1cm4gTWF0aC5hYnMobiAtIHQpIDwgaSAmJiAobiArPSBpKSwgTWF0aC5hYnMoYSAtIGwpIDwgaSAmJiAoYSArPSBpKSwgbiArPSBzLCBhICs9IHUsIChsIC09IGMpID4gKHQgLT0gcikgJiYgbCA8IG4gfHwgYSA+IHQgJiYgYSA8IG4gfHwgbCA8PSB0ICYmIGEgPj0gbjsKICAgIH0sIGUuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oNSksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oNiksCiAgICAgICAgcyA9IG4oOCksCiAgICAgICAgYyA9IG4oNjQpLAogICAgICAgIHUgPSBuKDI3KSwKICAgICAgICBkID0gTWF0aC5hYnM7CgogICAgZnVuY3Rpb24gaChlLCB0LCBuKSB7CiAgICAgIHZhciBpLCByOwogICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgaCkpIHJldHVybiBuZXcgaChlLCB0KTsKICAgICAgcy5jYWxsKHRoaXMsIHQpLCBhLmFkZENsYXNzKHQsIG8uY2xhc3NuYW1lKCJ2bGF5b3V0LWNvbnRhaW5lciIpKSwgaSA9IHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBwYW5lbHM6IFtdLAogICAgICAgIHBhbmVsSGVpZ2h0czogW10KICAgICAgfSwgZSksIHRoaXMucGFuZWxzID0gW10sIHRoaXMuX2RyYWcgPSBuZXcgdSh7CiAgICAgICAgZGlzdGFuY2U6IDEwLAogICAgICAgIGV4Y2x1ZGU6IGZ1bmN0aW9uIGV4Y2x1ZGUoZSkgewogICAgICAgICAgcmV0dXJuICFhLmhhc0NsYXNzKGUsIG8uY2xhc3NuYW1lKCJzcGxpdHRlciIpKTsKICAgICAgICB9CiAgICAgIH0sIHQpLCB0aGlzLl9kcmFnLm9uKHsKICAgICAgICBkcmFnU3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0LAogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuX2RyYWdEYXRhID0gbnVsbCwgdGhpcy50aGVtZSA9IG4sIGkucGFuZWxzLmxlbmd0aCAmJiAoaS5wYW5lbEhlaWdodHMubGVuZ3RoICYmIChyID0gaS5wYW5lbEhlaWdodHMuc2xpY2UoKSwgbC5mb3JFYWNoKGkucGFuZWxzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGUuaXNTcGxpdHRlciB8fCBlLmF1dG9IZWlnaHQgfHwgKGUuaGVpZ2h0ID0gci5zaGlmdCgpKTsKICAgICAgfSkpLCB0aGlzLmFkZFBhbmVscyhpLnBhbmVscywgdGhpcy5jb250YWluZXIpKSwgdGhpcy5yZWZyZXNoKCk7CiAgICB9CgogICAgbC5pbmhlcml0KGgsIHMpLCBoLnByb3RvdHlwZS5nZXRMYXlvdXREYXRhID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IFtdOwogICAgICByZXR1cm4gbC5mb3JFYWNoKHRoaXMucGFuZWxzLCBmdW5jdGlvbiAodCkgewogICAgICAgIHQuaXNTcGxpdHRlcigpIHx8IHQub3B0aW9ucy5hdXRvSGVpZ2h0IHx8IGUucHVzaCh0LmdldEhlaWdodCgpKTsKICAgICAgfSksIGU7CiAgICB9LCBoLnByb3RvdHlwZS5zZXRMYXlvdXREYXRhID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZS5sZW5ndGggJiYgKGwuZm9yRWFjaCh0aGlzLnBhbmVscywgZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LmlzU3BsaXR0ZXIoKSB8fCB0Lm9wdGlvbnMuYXV0b0hlaWdodCB8fCB0LnNldEhlaWdodChudWxsLCBlLnNoaWZ0KCkpOwogICAgICB9KSwgdGhpcy5yZWZyZXNoKCkpOwogICAgfSwgaC5wcm90b3R5cGUubmV4dFBhbmVsID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMucGFuZWxzW2UuaW5kZXggKyAxXTsKICAgIH0sIGgucHJvdG90eXBlLnByZXZQYW5lbCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnBhbmVsc1tlLmluZGV4IC0gMV07CiAgICB9LCBoLnByb3RvdHlwZS5faW5pdGlhbGl6ZUd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gZS5jbG9uZU5vZGUoITApOwogICAgICByZXR1cm4gYS5hZGRDbGFzcyhuLCBvLmNsYXNzbmFtZSgic3BsaXR0ZXItZ3VpZGUiKSksIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQobiwgdCksIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKG4pLCBuOwogICAgfSwgaC5wcm90b3R5cGUuX3JlZnJlc2hHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBlLnN0eWxlLnRvcCA9IHQgKyAicHgiOwogICAgfSwgaC5wcm90b3R5cGUuX2NsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgYS5yZW1vdmUoZSk7CiAgICB9LCBoLnByb3RvdHlwZS5fcmVzaXplID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYSA9IGQodCAtIG4pLAogICAgICAgICAgciA9IFtdLAogICAgICAgICAgcyA9IG4gPiB0LAogICAgICAgICAgYyA9IHMgPyAibmV4dFBhbmVsIiA6ICJwcmV2UGFuZWwiOwoKICAgICAgZm9yIChpID0gKG8gPSB0aGlzW3MgPyAicHJldlBhbmVsIiA6ICJuZXh0UGFuZWwiXShlKSkuZ2V0UmVzaXplSW5mb0J5R3Jvd3RoKGEpLCByLnB1c2goW28sIGlbMF1dKSwgbyA9IHRoaXNbY10obyk7IGwuaXNFeGlzdHkobyk7IG8gPSB0aGlzW2NdKG8pKSB7CiAgICAgICAgby5pc1NwbGl0dGVyKCkgfHwgKGkgPSBvLmdldFJlc2l6ZUluZm9CeUdyb3d0aCgtYSksIHIucHVzaChbbywgaVswXV0pLCBhIC09IGlbMV0pOwogICAgICB9CgogICAgICBsLmZvckVhY2gociwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlWzBdLnNldEhlaWdodChudWxsLCBlWzFdLCAhMCksIGVbMF0uZmlyZSgicmVzaXplIik7CiAgICAgIH0pOwogICAgfSwgaC5wcm90b3R5cGUuX2dldE1vdXNlWUFkZGl0aW9uYWxMaW1pdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IDAsCiAgICAgICAgICBvID0gMCwKICAgICAgICAgIGkgPSBmdW5jdGlvbiBpKGUpIHsKICAgICAgICByZXR1cm4gZS5pc1NwbGl0dGVyKCkgPyBlLmdldEhlaWdodCgpIDogZS5vcHRpb25zLm1pbkhlaWdodDsKICAgICAgfTsKCiAgICAgIGZvciAodCA9IHRoaXMucHJldlBhbmVsKGUpOyBsLmlzRXhpc3R5KHQpOyB0ID0gdGhpcy5wcmV2UGFuZWwodCkpIHsKICAgICAgICBuICs9IGkodCk7CiAgICAgIH0KCiAgICAgIGZvciAodCA9IHRoaXMubmV4dFBhbmVsKGUpOyBsLmlzRXhpc3R5KHQpOyB0ID0gdGhpcy5uZXh0UGFuZWwodCkpIHsKICAgICAgICBvICs9IGkodCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBbbiwgb107CiAgICB9LCBoLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUub3JpZ2luRXZlbnQsCiAgICAgICAgICBuID0gZS50YXJnZXQsCiAgICAgICAgICBpID0gYS5nZXREYXRhKG4sICJwYW5lbEluZGV4IiksCiAgICAgICAgICBzID0gdGhpcy5wYW5lbHNbaV0sCiAgICAgICAgICBjID0gcy5nZXRIZWlnaHQoKSwKICAgICAgICAgIHUgPSByLmdldE1vdXNlUG9zaXRpb24odCwgbilbMV0sCiAgICAgICAgICBkID0gci5nZXRNb3VzZVBvc2l0aW9uKHQsIHRoaXMuY29udGFpbmVyKVsxXSwKICAgICAgICAgIGggPSB0aGlzLl9pbml0aWFsaXplR3VpZGVFbGVtZW50KG4sIGQpOwoKICAgICAgcy5hZGRDbGFzcyhvLmNsYXNzbmFtZSgic3BsaXR0ZXItZm9jdXNlZCIpKSwgdGhpcy5fZHJhZ0RhdGEgPSB7CiAgICAgICAgc3BsUGFuZWw6IHMsCiAgICAgICAgc3BsT2Zmc2V0WTogdSwKICAgICAgICBndWlkZUVsZW1lbnQ6IGgsCiAgICAgICAgc3RhcnRZOiBkIC0gdSwKICAgICAgICBtaW5ZOiAwLAogICAgICAgIG1heFk6IHRoaXMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0IC0gYwogICAgICB9LCBsLmJyb3dzZXIubXNpZSB8fCBhLmFkZENsYXNzKGRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZyIpKTsKICAgIH0sIGgucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuX2RyYWdEYXRhLAogICAgICAgICAgbiA9IHIuZ2V0TW91c2VQb3NpdGlvbihlLm9yaWdpbkV2ZW50LCB0aGlzLmNvbnRhaW5lcilbMV07CiAgICAgIG4gPSBpLmxpbWl0KG4gLSB0LnNwbE9mZnNldFksIFt0Lm1pblldLCBbdC5tYXhZXSksIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQodC5ndWlkZUVsZW1lbnQsIG4pOwogICAgfSwgaC5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fZHJhZ0RhdGEsCiAgICAgICAgICBuID0gdGhpcy5fZ2V0TW91c2VZQWRkaXRpb25hbExpbWl0KHQuc3BsUGFuZWwpLAogICAgICAgICAgbCA9IHIuZ2V0TW91c2VQb3NpdGlvbihlLm9yaWdpbkV2ZW50LCB0aGlzLmNvbnRhaW5lcilbMV07CgogICAgICBsID0gaS5saW1pdChsIC0gdC5zcGxPZmZzZXRZLCBbdC5taW5ZICsgblswXV0sIFt0Lm1heFkgLSBuWzFdXSksIHRoaXMuX3Jlc2l6ZSh0LnNwbFBhbmVsLCB0LnN0YXJ0WSwgbCksIHRoaXMuZmlyZSgicmVzaXplIiwgewogICAgICAgIGxheW91dERhdGE6IHRoaXMuZ2V0TGF5b3V0RGF0YSgpCiAgICAgIH0pLCB0aGlzLl9kcmFnRGF0YSA9IG51bGwsIHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50KHQuZ3VpZGVFbGVtZW50KSwgdC5zcGxQYW5lbC5yZW1vdmVDbGFzcyhvLmNsYXNzbmFtZSgic3BsaXR0ZXItZm9jdXNlZCIpKSwgYS5yZW1vdmVDbGFzcyhkb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgicmVzaXppbmciKSk7CiAgICB9LCBoLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSwKICAgICAgICAgIHQgPSBbXSwKICAgICAgICAgIG4gPSB0aGlzLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgIG8gPSAwOwogICAgICBuICYmIChsLmZvckVhY2godGhpcy5wYW5lbHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5vcHRpb25zLmF1dG9IZWlnaHQgPyB0LnB1c2goZSkgOiBvICs9IGUuZ2V0SGVpZ2h0KCk7CiAgICAgIH0pLCBlID0gKG4gLSBvKSAvIHQubGVuZ3RoLCBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LnNldEhlaWdodChudWxsLCBlKTsKICAgICAgfSkpOwogICAgfSwgaC5wcm90b3R5cGUuYWRkUGFuZWwgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLAogICAgICAgICAgbyA9IHRoaXMucGFuZWxzLAogICAgICAgICAgaSA9IG8ubGVuZ3RoOwogICAgICBlID0gbC5leHRlbmQoewogICAgICAgIGluZGV4OiBpCiAgICAgIH0sIGUpLCBvLnB1c2gobmV3IGMoZSwgbiwgdGhpcy50aGVtZSkpLCB0LmFwcGVuZENoaWxkKG4pOwogICAgfSwgaC5wcm90b3R5cGUuYWRkUGFuZWxzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLAogICAgICAgICAgbyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbi5hZGRQYW5lbChlLCBvKTsKICAgICAgfSksIHQuYXBwZW5kQ2hpbGQobyk7CiAgICB9LCBoLnByb3RvdHlwZS5nZXRQYW5lbEJ5TmFtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICByZXR1cm4gbC5mb3JFYWNoKHRoaXMucGFuZWxzLCBmdW5jdGlvbiAobikgewogICAgICAgIG4ubmFtZSA9PT0gZSAmJiAodCA9IG4pOwogICAgICB9KSwgdDsKICAgIH0sIGUuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oNCkuRGF0ZSwKICAgICAgICBzID0gbig4KTsKCiAgICBmdW5jdGlvbiBjKGUsIHQpIHsKICAgICAgdCA9IGkuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIHQsIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5IikpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgY29udGFpbmVyQm90dG9tR3V0dGVyOiA4LAogICAgICAgIHNjaGVkdWxlSGVpZ2h0OiAxOCwKICAgICAgICBzY2hlZHVsZUd1dHRlcjogMiwKICAgICAgICBuYXJyb3dXZWVrZW5kOiAhMSwKICAgICAgICBzdGFydERheU9mV2VlazogMCwKICAgICAgICB3b3Jrd2VlazogITEKICAgICAgfSwgZSksIHRoaXMuX2NhY2hlUGFyZW50Vmlld01vZGVsID0gbnVsbCwgcy5jYWxsKHRoaXMsIHQpOwogICAgfQoKICAgIGwuaW5oZXJpdChjLCBzKSwgYy5wcm90b3R5cGUuZ2V0UmVuZGVyRGF0ZVJhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fY2FjaGVQYXJlbnRWaWV3TW9kZWwucmFuZ2U7CiAgICB9LCBjLnByb3RvdHlwZS5nZXRSZW5kZXJEYXRlR3JpZHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbC5ncmlkczsKICAgIH0sIGMucHJvdG90eXBlLmdldEJhc2VWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIG4gPSBlLnJhbmdlLAogICAgICAgICAgbyA9IDEwMCAvIG4ubGVuZ3RoLAogICAgICAgICAgaSA9IGUuZ3JpZHMsCiAgICAgICAgICBzID0gZS5leGNlZWREYXRlIHx8IHt9LAogICAgICAgICAgYyA9IGUudGhlbWUsCiAgICAgICAgICB1ID0gbmV3IHIoKS50b0xvY2FsVGltZSgpOwogICAgICByZXR1cm4gdGhpcy5fY2FjaGVQYXJlbnRWaWV3TW9kZWwgPSBlLCB7CiAgICAgICAgd2lkdGg6IG8sCiAgICAgICAgc2NoZWR1bGVIZWlnaHQ6IHQuc2NoZWR1bGVIZWlnaHQsCiAgICAgICAgc2NoZWR1bGVCbG9ja0hlaWdodDogdC5zY2hlZHVsZUhlaWdodCArIHQuc2NoZWR1bGVHdXR0ZXIsCiAgICAgICAgc2NoZWR1bGVCbG9ja0d1dHRlcjogdC5zY2hlZHVsZUd1dHRlciwKICAgICAgICBkYXRlczogbC5tYXAobiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gZS5nZXREYXkoKSwKICAgICAgICAgICAgICBsID0gYS5mb3JtYXQobmV3IHIoZSksICJZWVlZTU1ERCIpLAogICAgICAgICAgICAgIG8gPSBhLmlzU2FtZURhdGUodSwgZSk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkYXRlOiBhLmZvcm1hdChlLCAiWVlZWS1NTS1ERCIpLAogICAgICAgICAgICBtb250aDogZS5nZXRNb250aCgpICsgMSwKICAgICAgICAgICAgZGF5OiBuLAogICAgICAgICAgICBpc1RvZGF5OiBvLAogICAgICAgICAgICB5bWQ6IGwsCiAgICAgICAgICAgIGhpZGRlblNjaGVkdWxlczogc1tsXSB8fCAwLAogICAgICAgICAgICB3aWR0aDogaVt0XSA/IGlbdF0ud2lkdGggOiAwLAogICAgICAgICAgICBsZWZ0OiBpW3RdID8gaVt0XS5sZWZ0IDogMCwKICAgICAgICAgICAgY29sb3I6IHRoaXMuX2dldERheU5hbWVDb2xvcihjLCBuLCBvKSwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLl9nZXREYXlCYWNrZ3JvdW5kQ29sb3IoYywgbikKICAgICAgICAgIH07CiAgICAgICAgfSwgdGhpcykKICAgICAgfTsKICAgIH0sIGMucHJvdG90eXBlLmdldEV4Y2VlZERhdGUgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IHRoaXMuX2luaXRFeGNlZWREYXRlKG4pOwoKICAgICAgcmV0dXJuIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuOwogICAgICAgICAgICAhdCB8fCB0LnRvcCA8IGUgfHwgKHQuaGlkZGVuID0gITAsIG4gPSBhLnJhbmdlKHQuZ2V0U3RhcnRzKCksIHQuZ2V0RW5kcygpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwgbC5mb3JFYWNoKG4sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBhLmZvcm1hdChlLCAiWVlZWU1NREQiKTsKICAgICAgICAgICAgICBvW3RdICs9IDE7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KSwgbzsKICAgIH0sIGMucHJvdG90eXBlLl9pbml0RXhjZWVkRGF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0ge307CiAgICAgIHJldHVybiBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiA9IGEuZm9ybWF0KGUsICJZWVlZTU1ERCIpOwogICAgICAgIHRbbl0gPSAwOwogICAgICB9KSwgdDsKICAgIH0sIGMucHJvdG90eXBlLl9nZXREYXlOYW1lQ29sb3IgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICB2YXIgbyA9ICIiOwogICAgICByZXR1cm4gZSAmJiAobyA9IDAgPT09IHQgPyBsID8gZS5tb250aC5ob2xpZGF5RXhjZXB0VGhpc01vbnRoLmNvbG9yIDogZS5jb21tb24uaG9saWRheS5jb2xvciA6IDYgPT09IHQgPyBsID8gZS5tb250aC5kYXlFeGNlcHRUaGlzTW9udGguY29sb3IgOiBlLmNvbW1vbi5zYXR1cmRheS5jb2xvciA6IG4gPyBlLmNvbW1vbi50b2RheS5jb2xvciA6IGwgPyBlLm1vbnRoLmRheUV4Y2VwdFRoaXNNb250aC5jb2xvciA6IGUuY29tbW9uLmRheW5hbWUuY29sb3IpLCBvOwogICAgfSwgYy5wcm90b3R5cGUuX2dldERheUJhY2tncm91bmRDb2xvciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gIiI7CiAgICAgIHJldHVybiBlICYmIChuID0gMCA9PT0gdCB8fCA2ID09PSB0ID8gZS5tb250aC53ZWVrZW5kLmJhY2tncm91bmRDb2xvciA6ICJpbmhlcml0IiksIG47CiAgICB9LCBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApOwoKICAgIGZ1bmN0aW9uIG8oZSwgdCwgbikgewogICAgICB0aGlzLnggPSBuID8gTWF0aC5yb3VuZChlKSA6IGUsIHRoaXMueSA9IG4gPyBNYXRoLnJvdW5kKHQpIDogdDsKICAgIH0KCiAgICBvLmdldFJhdGlvID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIHQgPT09IG4gPyBlLmNsb25lKCkgOiBlLm11bHRpcGx5QnkobikuX2RpdmlkZUJ5KHQpOwogICAgfSwgby5uID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBvID8gZSA6IGwuaXNBcnJheShlKSA/IG5ldyBvKGVbMF0sIGVbMV0sIHQpIDogbmV3IG8oZSwgdCwgbik7CiAgICB9LCBvLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBvKHRoaXMueCwgdGhpcy55KTsKICAgIH0sIG8ucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX2FkZChvLm4oZSkpOwogICAgfSwgby5wcm90b3R5cGUuX2FkZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnggKz0gZS54LCB0aGlzLnkgKz0gZS55LCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuc3VidHJhY3QgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLl9zdWJ0cmFjdChvLm4oZSkpOwogICAgfSwgby5wcm90b3R5cGUuX3N1YnRyYWN0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMueCAtPSBlLngsIHRoaXMueSAtPSBlLnksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5kaXZpZGVCeSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX2RpdmlkZUJ5KGUpOwogICAgfSwgby5wcm90b3R5cGUuX2RpdmlkZUJ5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMueCAvPSBlLCB0aGlzLnkgLz0gZSwgdGhpczsKICAgIH0sIG8ucHJvdG90eXBlLm11bHRpcGx5QnkgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLl9tdWx0aXBseUJ5KGUpOwogICAgfSwgby5wcm90b3R5cGUuX211bHRpcGx5QnkgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy54ICo9IGUsIHRoaXMueSAqPSBlLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUucm91bmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX3JvdW5kKCk7CiAgICB9LCBvLnByb3RvdHlwZS5fcm91bmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnggPSBNYXRoLnJvdW5kKHRoaXMueCksIHRoaXMueSA9IE1hdGgucm91bmQodGhpcy55KSwgdGhpczsKICAgIH0sIG8ucHJvdG90eXBlLnJldmVyc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX3JldmVyc2UoKTsKICAgIH0sIG8ucHJvdG90eXBlLl9yZXZlcnNlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy54ICo9IC0xLCB0aGlzLnkgKj0gLTEsIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5mbG9vciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fZmxvb3IoKTsKICAgIH0sIG8ucHJvdG90eXBlLl9mbG9vciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMueCA9IE1hdGguZmxvb3IodGhpcy54KSwgdGhpcy55ID0gTWF0aC5mbG9vcih0aGlzLnkpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuY2VpbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fY2VpbCgpOwogICAgfSwgby5wcm90b3R5cGUuX2NlaWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnggPSBNYXRoLmNlaWwodGhpcy54KSwgdGhpcy55ID0gTWF0aC5jZWlsKHRoaXMueSksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5yb3RhdGUgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLl9yb3RhdGUoZSwgdCwgbiwgbCk7CiAgICB9LCBvLnByb3RvdHlwZS5fcm90YXRlID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwpIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYSA9IGUgKiAoTWF0aC5QSSAvIDE4MCk7CiAgICAgIHJldHVybiBuID0gbiB8fCBwYXJzZUZsb2F0KE1hdGguY29zKGEpLnRvRml4ZWQoOCkpLCBsID0gbCB8fCBwYXJzZUZsb2F0KE1hdGguc2luKGEpLnRvRml4ZWQoOCkpLCB0aGlzLl9zdWJ0cmFjdCh0KSwgbyA9IHRoaXMueCwgaSA9IHRoaXMueSwgdGhpcy54ID0gbyAqIG4gLSBpICogbCwgdGhpcy55ID0gbyAqIGwgKyBpICogbiwgdGhpcy5fYWRkKHQpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUuZGlzdGFuY2VUbyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LCBuOwogICAgICByZXR1cm4gdCA9IChlID0gby5uKGUpKS54IC0gdGhpcy54LCBuID0gZS55IC0gdGhpcy55LCBNYXRoLnNxcnQodCAqIHQgKyBuICogbik7CiAgICB9LCBvLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gKGUgPSBvLm4oZSkpLnggPT09IHRoaXMueCAmJiBlLnkgPT09IHRoaXMueTsKICAgIH0sIG8ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gIlBvaW50KCIgKyB0aGlzLnggKyAiLCAiICsgdGhpcy55ICsgIikiOwogICAgfSwgby5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueV07CiAgICB9LCBlLmV4cG9ydHMgPSBvOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDgpLAogICAgICAgIG8gPSBuKDE2KSwKICAgICAgICBpID0gbigwKSwKICAgICAgICBhID0gbig3OSksCiAgICAgICAgciA9IG4oNCksCiAgICAgICAgcyA9IG4oMiksCiAgICAgICAgYyA9IG4oNiksCiAgICAgICAgdSA9IG4oMSksCiAgICAgICAgZCA9IG4oNSksCiAgICAgICAgaCA9IG4oMyksCiAgICAgICAgcCA9IG4oODApLAogICAgICAgIG0gPSByLkRhdGU7CgogICAgZnVuY3Rpb24gZihlLCB0LCBuKSB7CiAgICAgIGwuY2FsbCh0aGlzLCBlKSwgdGhpcy5sYXllciA9IG5ldyBvKG51bGwsIGUpLCB0aGlzLl92aWV3TW9kZWwgPSBudWxsLCB0aGlzLl9zZWxlY3RlZENhbCA9IG51bGwsIHRoaXMuX3NjaGVkdWxlID0gbnVsbCwgdGhpcy5jYWxlbmRhcnMgPSB0LCB0aGlzLl9mb2N1c2VkRHJvcGRvd24gPSBudWxsLCB0aGlzLl91c2FnZVN0YXRpc3RpY3MgPSBuLCB0aGlzLl9vbkNsaWNrTGlzdGVuZXJzID0gW3RoaXMuX3NlbGVjdERyb3Bkb3duTWVudUl0ZW0uYmluZCh0aGlzKSwgdGhpcy5fdG9nZ2xlRHJvcGRvd25NZW51Vmlldy5iaW5kKHRoaXMpLCB0aGlzLl9jbG9zZURyb3Bkb3duTWVudVZpZXcuYmluZCh0aGlzLCBudWxsKSwgdGhpcy5fY2xvc2VQb3B1cC5iaW5kKHRoaXMpLCB0aGlzLl90b2dnbGVJc0FsbGRheS5iaW5kKHRoaXMpLCB0aGlzLl90b2dnbGVJc1ByaXZhdGUuYmluZCh0aGlzKSwgdGhpcy5fb25DbGlja1NhdmVTY2hlZHVsZS5iaW5kKHRoaXMpXSwgYy5vbihlLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKTsKICAgIH0KCiAgICBpLmluaGVyaXQoZiwgbCksIGYucHJvdG90eXBlLl9vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gYy5nZXRFdmVudFRhcmdldChlKTsKICAgICAgdS5jbG9zZXN0KHQsIHMuY2xhc3NuYW1lKCIuZmxvYXRpbmctbGF5ZXIiKSkgfHwgdGhpcy5oaWRlKCk7CiAgICB9LCBmLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmxheWVyLmRlc3Ryb3koKSwgdGhpcy5sYXllciA9IG51bGwsIGMub2ZmKHRoaXMuY29udGFpbmVyLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKSwgYy5vZmYoZG9jdW1lbnQuYm9keSwgIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKSwgbC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpOwogICAgfSwgZi5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGMuZ2V0RXZlbnRUYXJnZXQoZSk7CiAgICAgIGkuZm9yRWFjaCh0aGlzLl9vbkNsaWNrTGlzdGVuZXJzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAhZSh0KTsKICAgICAgfSk7CiAgICB9LCBmLnByb3RvdHlwZS5fY2xvc2VQb3B1cCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gcy5jbGFzc25hbWUoInBvcHVwLWNsb3NlIik7CiAgICAgIHJldHVybiAhKCF1Lmhhc0NsYXNzKGUsIHQpICYmICF1LmNsb3Nlc3QoZSwgIi4iICsgdCkpICYmICh0aGlzLmhpZGUoKSwgITApOwogICAgfSwgZi5wcm90b3R5cGUuX3RvZ2dsZURyb3Bkb3duTWVudVZpZXcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHMuY2xhc3NuYW1lKCJkcm9wZG93bi1idXR0b24iKSwKICAgICAgICAgIG4gPSB1Lmhhc0NsYXNzKGUsIHQpID8gZSA6IHUuY2xvc2VzdChlLCAiLiIgKyB0KTsKICAgICAgcmV0dXJuICEhbiAmJiAodS5oYXNDbGFzcyhuLnBhcmVudE5vZGUsIHMuY2xhc3NuYW1lKCJvcGVuIikpID8gdGhpcy5fY2xvc2VEcm9wZG93bk1lbnVWaWV3KG4ucGFyZW50Tm9kZSkgOiB0aGlzLl9vcGVuRHJvcGRvd25NZW51VmlldyhuLnBhcmVudE5vZGUpLCAhMCk7CiAgICB9LCBmLnByb3RvdHlwZS5fY2xvc2VEcm9wZG93bk1lbnVWaWV3ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgKGUgPSBlIHx8IHRoaXMuX2ZvY3VzZWREcm9wZG93bikgJiYgKHUucmVtb3ZlQ2xhc3MoZSwgcy5jbGFzc25hbWUoIm9wZW4iKSksIHRoaXMuX2ZvY3VzZWREcm9wZG93biA9IG51bGwpOwogICAgfSwgZi5wcm90b3R5cGUuX29wZW5Ecm9wZG93bk1lbnVWaWV3ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdS5hZGRDbGFzcyhlLCBzLmNsYXNzbmFtZSgib3BlbiIpKSwgdGhpcy5fZm9jdXNlZERyb3Bkb3duID0gZTsKICAgIH0sIGYucHJvdG90eXBlLl9zZWxlY3REcm9wZG93bk1lbnVJdGVtID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gcy5jbGFzc25hbWUoImRyb3Bkb3duLW1lbnUtaXRlbSIpLAogICAgICAgICAgYSA9IHMuY2xhc3NuYW1lKCJpY29uIiksCiAgICAgICAgICByID0gcy5jbGFzc25hbWUoImNvbnRlbnQiKSwKICAgICAgICAgIGMgPSB1Lmhhc0NsYXNzKGUsIGkpID8gZSA6IHUuY2xvc2VzdChlLCAiLiIgKyBpKTsKICAgICAgcmV0dXJuICEhYyAmJiAodCA9IHUuZmluZCgiLiIgKyBhLCBjKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgfHwgInRyYW5zcGFyZW50IiwgbiA9IHUuZmluZCgiLiIgKyByLCBjKS5pbm5lckhUTUwsIGwgPSB1LmNsb3Nlc3QoYywgcy5jbGFzc25hbWUoIi5kcm9wZG93biIpKSwgbyA9IHUuZmluZChzLmNsYXNzbmFtZSgiLmRyb3Bkb3duLWJ1dHRvbiIpLCBsKSwgdS5maW5kKCIuIiArIHIsIG8pLmlubmVyVGV4dCA9IG4sIHUuaGFzQ2xhc3MobCwgcy5jbGFzc25hbWUoInNlY3Rpb24tY2FsZW5kYXIiKSkgJiYgKHUuZmluZCgiLiIgKyBhLCBvKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0LCB0aGlzLl9zZWxlY3RlZENhbCA9IGQuZmluZCh0aGlzLmNhbGVuZGFycywgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZS5pZCA9PT0gdS5nZXREYXRhKGMsICJjYWxlbmRhcklkIik7CiAgICAgIH0pKSwgdS5yZW1vdmVDbGFzcyhsLCBzLmNsYXNzbmFtZSgib3BlbiIpKSwgITApOwogICAgfSwgZi5wcm90b3R5cGUuX3RvZ2dsZUlzQWxsZGF5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gcy5jbGFzc25hbWUoInNlY3Rpb24tYWxsZGF5IiksCiAgICAgICAgICBsID0gdS5oYXNDbGFzcyhlLCBuKSA/IGUgOiB1LmNsb3Nlc3QoZSwgIi4iICsgbik7CiAgICAgIHJldHVybiAhIWwgJiYgKCh0ID0gdS5maW5kKHMuY2xhc3NuYW1lKCIuY2hlY2tib3gtc3F1YXJlIiksIGwpKS5jaGVja2VkID0gIXQuY2hlY2tlZCwgITApOwogICAgfSwgZi5wcm90b3R5cGUuX3RvZ2dsZUlzUHJpdmF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gcy5jbGFzc25hbWUoInNlY3Rpb24tcHJpdmF0ZSIpLAogICAgICAgICAgbiA9IHUuaGFzQ2xhc3MoZSwgdCkgPyBlIDogdS5jbG9zZXN0KGUsICIuIiArIHQpOwogICAgICByZXR1cm4gISFuICYmICh1Lmhhc0NsYXNzKG4sIHMuY2xhc3NuYW1lKCJwdWJsaWMiKSkgPyB1LnJlbW92ZUNsYXNzKG4sIHMuY2xhc3NuYW1lKCJwdWJsaWMiKSkgOiB1LmFkZENsYXNzKG4sIHMuY2xhc3NuYW1lKCJwdWJsaWMiKSksICEwKTsKICAgIH0sIGYucHJvdG90eXBlLl9vbkNsaWNrU2F2ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgYSwKICAgICAgICAgIHIgPSBzLmNsYXNzbmFtZSgicG9wdXAtc2F2ZSIpLAogICAgICAgICAgYyA9IHMuY3NzUHJlZml4OwogICAgICByZXR1cm4gISghdS5oYXNDbGFzcyhlLCByKSAmJiAhdS5jbG9zZXN0KGUsICIuIiArIHIpKSAmJiAodCA9IHUuZ2V0KGMgKyAic2NoZWR1bGUtdGl0bGUiKSwgbiA9IG5ldyBtKHRoaXMucmFuZ2VQaWNrZXIuZ2V0U3RhcnREYXRlKCkpLnRvTG9jYWxUaW1lKCksIGwgPSBuZXcgbSh0aGlzLnJhbmdlUGlja2VyLmdldEVuZERhdGUoKSkudG9Mb2NhbFRpbWUoKSwgdGhpcy5fdmFsaWRhdGVGb3JtKHQsIG4sIGwpID8gKGEgPSAhIXUuZ2V0KGMgKyAic2NoZWR1bGUtYWxsZGF5IikuY2hlY2tlZCwgbyA9IHRoaXMuX2dldFJhbmdlRGF0ZShuLCBsLCBhKSwgaSA9IHsKICAgICAgICBjYWxlbmRhcklkOiB0aGlzLl9zZWxlY3RlZENhbCA/IHRoaXMuX3NlbGVjdGVkQ2FsLmlkIDogbnVsbCwKICAgICAgICB0aXRsZTogdCwKICAgICAgICBsb2NhdGlvbjogdS5nZXQoYyArICJzY2hlZHVsZS1sb2NhdGlvbiIpLAogICAgICAgIHN0YXJ0OiBvLnN0YXJ0LAogICAgICAgIGVuZDogby5lbmQsCiAgICAgICAgaXNBbGxEYXk6IGEsCiAgICAgICAgc3RhdGU6IHUuZ2V0KGMgKyAic2NoZWR1bGUtc3RhdGUiKS5pbm5lclRleHQsCiAgICAgICAgaXNQcml2YXRlOiAhdS5oYXNDbGFzcyh1LmdldChjICsgInNjaGVkdWxlLXByaXZhdGUiKSwgcy5jbGFzc25hbWUoInB1YmxpYyIpKQogICAgICB9LCB0aGlzLl9pc0VkaXRNb2RlID8gdGhpcy5fb25DbGlja1VwZGF0ZVNjaGVkdWxlKGkpIDogdGhpcy5fb25DbGlja0NyZWF0ZVNjaGVkdWxlKGkpLCB0aGlzLmhpZGUoKSwgITApIDogKHQudmFsdWUgfHwgdC5mb2N1cygpLCAhMSkpOwogICAgfSwgZi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IHRoaXMuY2FsZW5kYXJzLAogICAgICAgICAgbyA9IHRoaXMubGF5ZXIsCiAgICAgICAgICBhID0gdGhpczsKICAgICAgZS56SW5kZXggPSB0aGlzLmxheWVyLnpJbmRleCArIDUsIGUuY2FsZW5kYXJzID0gbCwgbC5sZW5ndGggJiYgKGUuc2VsZWN0ZWRDYWwgPSB0aGlzLl9zZWxlY3RlZENhbCA9IGxbMF0pLCB0aGlzLl9pc0VkaXRNb2RlID0gZS5zY2hlZHVsZSAmJiBlLnNjaGVkdWxlLmlkLCB0aGlzLl9pc0VkaXRNb2RlID8gKHQgPSBlLnRhcmdldCwgZSA9IHRoaXMuX21ha2VFZGl0TW9kZURhdGEoZSkpIDogKHRoaXMuZ3VpZGUgPSBlLmd1aWRlLCB0ID0gKG4gPSB0aGlzLl9nZXRHdWlkZUVsZW1lbnRzKHRoaXMuZ3VpZGUpKS5sZW5ndGggPyBuWzBdIDogbnVsbCksIG8uc2V0Q29udGVudChwKGUpKSwgdGhpcy5fY3JlYXRlRGF0ZXBpY2tlcihlLnN0YXJ0LCBlLmVuZCwgZS5pc0FsbERheSksIG8uc2hvdygpLCB0ICYmIHRoaXMuX3NldFBvcHVwUG9zaXRpb25BbmRBcnJvd0RpcmVjdGlvbih0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSwgaS5kZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgYy5vbihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgYS5fb25Nb3VzZURvd24sIGEpOwogICAgICB9KSgpOwogICAgfSwgZi5wcm90b3R5cGUuX21ha2VFZGl0TW9kZURhdGEgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBhLAogICAgICAgICAgciwKICAgICAgICAgIHMgPSBlLnNjaGVkdWxlLAogICAgICAgICAgYyA9IHMucmF3IHx8IHt9LAogICAgICAgICAgdSA9IHRoaXMuY2FsZW5kYXJzLAogICAgICAgICAgaCA9IHMuaWQ7CiAgICAgIHJldHVybiB0ID0gcy50aXRsZSwgbiA9ICJwcml2YXRlIiA9PT0gYy5jbGFzcywgbCA9IHMubG9jYXRpb24sIG8gPSBzLnN0YXJ0LCBpID0gcy5lbmQsIGEgPSBzLmlzQWxsRGF5LCByID0gcy5zdGF0ZSwgZS5zZWxlY3RlZENhbCA9IHRoaXMuX3NlbGVjdGVkQ2FsID0gZC5maW5kKHRoaXMuY2FsZW5kYXJzLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmlkID09PSBlLnNjaGVkdWxlLmNhbGVuZGFySWQ7CiAgICAgIH0pLCB0aGlzLl9zY2hlZHVsZSA9IHMsIHsKICAgICAgICBpZDogaCwKICAgICAgICBzZWxlY3RlZENhbDogdGhpcy5fc2VsZWN0ZWRDYWwsCiAgICAgICAgY2FsZW5kYXJzOiB1LAogICAgICAgIHRpdGxlOiB0LAogICAgICAgIGlzUHJpdmF0ZTogbiwKICAgICAgICBsb2NhdGlvbjogbCwKICAgICAgICBpc0FsbERheTogYSwKICAgICAgICBzdGF0ZTogciwKICAgICAgICBzdGFydDogbywKICAgICAgICBlbmQ6IGksCiAgICAgICAgcmF3OiB7CiAgICAgICAgICBjbGFzczogbiA/ICJwcml2YXRlIiA6ICJwdWJsaWMiCiAgICAgICAgfSwKICAgICAgICB6SW5kZXg6IHRoaXMubGF5ZXIuekluZGV4ICsgNSwKICAgICAgICBpc0VkaXRNb2RlOiB0aGlzLl9pc0VkaXRNb2RlCiAgICAgIH07CiAgICB9LCBmLnByb3RvdHlwZS5fc2V0UG9wdXBQb3NpdGlvbkFuZEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB1LmZpbmQocy5jbGFzc25hbWUoIi5wb3B1cCIpLCB0aGlzLmxheWVyLmNvbnRhaW5lciksCiAgICAgICAgICBuID0gewogICAgICAgIHdpZHRoOiB0Lm9mZnNldFdpZHRoLAogICAgICAgIGhlaWdodDogdC5vZmZzZXRIZWlnaHQKICAgICAgfSwKICAgICAgICAgIGwgPSB0aGlzLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwKICAgICAgICAgIG8gPSB0aGlzLl9jYWxjUmVuZGVyaW5nRGF0YShuLCBsLCBlKTsKCiAgICAgIHRoaXMubGF5ZXIuc2V0UG9zaXRpb24oby54LCBvLnkpLCB0aGlzLl9zZXRBcnJvd0RpcmVjdGlvbihvLmFycm93KTsKICAgIH0sIGYucHJvdG90eXBlLl9nZXRHdWlkZUVsZW1lbnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBbXSwKICAgICAgICAgIG4gPSAwOwogICAgICBpZiAoZS5ndWlkZUVsZW1lbnQpIHQucHVzaChlLmd1aWRlRWxlbWVudCk7ZWxzZSBpZiAoZS5ndWlkZUVsZW1lbnRzKSBmb3IgKDsgbiA8IDY7IG4gKz0gMSkgewogICAgICAgIGUuZ3VpZGVFbGVtZW50c1tuXSAmJiB0LnB1c2goZS5ndWlkZUVsZW1lbnRzW25dKTsKICAgICAgfQogICAgICByZXR1cm4gdDsKICAgIH0sIGYucHJvdG90eXBlLl9nZXRCb3VuZE9mRmlyc3RSb3dHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdDsKICAgICAgcmV0dXJuIGUubGVuZ3RoID8gewogICAgICAgIHRvcDogKHQgPSBlWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKS50b3AsCiAgICAgICAgbGVmdDogdC5sZWZ0LAogICAgICAgIGJvdHRvbTogdC5ib3R0b20sCiAgICAgICAgcmlnaHQ6IHQucmlnaHQKICAgICAgfSA6IG51bGw7CiAgICB9LCBmLnByb3RvdHlwZS5fZ2V0WUFuZEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgdmFyIGkgPSAiYXJyb3ctYm90dG9tIiwKICAgICAgICAgIGEgPSBlIC0gbjsKICAgICAgcmV0dXJuIGEgPCBsID8gKGEgPSB0IC0gbCArIDMsIGkgPSAiYXJyb3ctdG9wIikgOiBhID0gYSAtIGwgLSAzLCBhICsgbiA+IG8gJiYgKGEgPSBvIC0gbiAtIGwgLSAzKSwgewogICAgICAgIHk6IGEsCiAgICAgICAgYXJyb3dEaXJlY3Rpb246IGkKICAgICAgfTsKICAgIH0sIGYucHJvdG90eXBlLl9nZXRYQW5kQXJyb3dMZWZ0ID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgdmFyIGksCiAgICAgICAgICBhID0gKGUgKyB0KSAvIDIsCiAgICAgICAgICByID0gYSAtIG4gLyAyOwogICAgICByZXR1cm4gciArIG4gPiBvID8gaSA9IGEgLSAociA9IHQgLSBuICsgOCkgOiByICs9IDgsIHIgPCBsID8gKHIgPSAwLCBpID0gYSAtIGwgLSA4KSA6IHIgPSByIC0gbCAtIDgsIHsKICAgICAgICB4OiByLAogICAgICAgIGFycm93TGVmdDogaQogICAgICB9OwogICAgfSwgZi5wcm90b3R5cGUuX2NhbGNSZW5kZXJpbmdEYXRhID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwgPSB0aGlzLl9nZXRZQW5kQXJyb3dEaXJlY3Rpb24obi50b3AsIG4uYm90dG9tLCBlLmhlaWdodCwgdC50b3AsIHQuYm90dG9tKSwKICAgICAgICAgIG8gPSB0aGlzLl9nZXRYQW5kQXJyb3dMZWZ0KG4ubGVmdCwgbi5yaWdodCwgZS53aWR0aCwgdC5sZWZ0LCB0LnJpZ2h0KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgeDogby54LAogICAgICAgIHk6IGwueSwKICAgICAgICBhcnJvdzogewogICAgICAgICAgZGlyZWN0aW9uOiBsLmFycm93RGlyZWN0aW9uLAogICAgICAgICAgcG9zaXRpb246IG8uYXJyb3dMZWZ0CiAgICAgICAgfQogICAgICB9OwogICAgfSwgZi5wcm90b3R5cGUuX3NldEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLmRpcmVjdGlvbiB8fCAiYXJyb3ctYm90dG9tIiwKICAgICAgICAgIG4gPSB1LmdldChzLmNsYXNzbmFtZSgicG9wdXAtYXJyb3ciKSksCiAgICAgICAgICBsID0gdS5maW5kKHMuY2xhc3NuYW1lKCIucG9wdXAtYXJyb3ctYm9yZGVyIiwgbikpOwogICAgICB0ICE9PSBzLmNsYXNzbmFtZSgiYXJyb3ctYm90dG9tIikgJiYgKHUucmVtb3ZlQ2xhc3Mobiwgcy5jbGFzc25hbWUoImFycm93LWJvdHRvbSIpKSwgdS5hZGRDbGFzcyhuLCBzLmNsYXNzbmFtZSh0KSkpLCBlLnBvc2l0aW9uICYmIChsLnN0eWxlLmxlZnQgPSBlLnBvc2l0aW9uICsgInB4Iik7CiAgICB9LCBmLnByb3RvdHlwZS5fY3JlYXRlRGF0ZXBpY2tlciA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsID0gcy5jc3NQcmVmaXg7CiAgICAgIHRoaXMucmFuZ2VQaWNrZXIgPSBhLmNyZWF0ZVJhbmdlUGlja2VyKHsKICAgICAgICBzdGFydHBpY2tlcjogewogICAgICAgICAgZGF0ZTogbmV3IG0oZSkudG9EYXRlKCksCiAgICAgICAgICBpbnB1dDogIiMiICsgbCArICJzY2hlZHVsZS1zdGFydC1kYXRlIiwKICAgICAgICAgIGNvbnRhaW5lcjogIiMiICsgbCArICJzdGFydHBpY2tlci1jb250YWluZXIiCiAgICAgICAgfSwKICAgICAgICBlbmRwaWNrZXI6IHsKICAgICAgICAgIGRhdGU6IG5ldyBtKHQpLnRvRGF0ZSgpLAogICAgICAgICAgaW5wdXQ6ICIjIiArIGwgKyAic2NoZWR1bGUtZW5kLWRhdGUiLAogICAgICAgICAgY29udGFpbmVyOiAiIyIgKyBsICsgImVuZHBpY2tlci1jb250YWluZXIiCiAgICAgICAgfSwKICAgICAgICBmb3JtYXQ6IG4gPyAieXl5eS1NTS1kZCIgOiAieXl5eS1NTS1kZCBISDptbSIsCiAgICAgICAgdGltZXBpY2tlcjogbiA/IG51bGwgOiB7CiAgICAgICAgICBzaG93TWVyaWRpZW06ICExLAogICAgICAgICAgdXNhZ2VTdGF0aXN0aWNzOiB0aGlzLl91c2FnZVN0YXRpc3RpY3MKICAgICAgICB9LAogICAgICAgIHVzYWdlU3RhdGlzdGljczogdGhpcy5fdXNhZ2VTdGF0aXN0aWNzCiAgICAgIH0pOwogICAgfSwgZi5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5sYXllci5oaWRlKCksIHRoaXMuZ3VpZGUgJiYgKHRoaXMuZ3VpZGUuY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy5ndWlkZSA9IG51bGwpLCBjLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpOwogICAgfSwgZi5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fdmlld01vZGVsICYmIHRoaXMubGF5ZXIuc2V0Q29udGVudCh0aGlzLnRtcGwodGhpcy5fdmlld01vZGVsKSk7CiAgICB9LCBmLnByb3RvdHlwZS5zZXRDYWxlbmRhcnMgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmNhbGVuZGFycyA9IGUgfHwgW107CiAgICB9LCBmLnByb3RvdHlwZS5fdmFsaWRhdGVGb3JtID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgcmV0dXJuICEhZS52YWx1ZSAmJiAhKCF0ICYmICFuKSAmJiAxICE9PSBoLmNvbXBhcmUodCwgbik7CiAgICB9LCBmLnByb3RvdHlwZS5fZ2V0UmFuZ2VEYXRlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIG4gJiYgKGUuc2V0SG91cnMoMCwgMCwgMCksIHQgPSBoLmlzU3RhcnRPZkRheSh0KSA/IGguY29udmVydFN0YXJ0RGF5VG9MYXN0RGF5KHQpIDogdC5zZXRIb3VycygyMywgNTksIDU5KSksIHsKICAgICAgICBzdGFydDogbmV3IG0oZSksCiAgICAgICAgZW5kOiBuZXcgbSh0KQogICAgICB9OwogICAgfSwgZi5wcm90b3R5cGUuX29uQ2xpY2tVcGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZC5nZXRTY2hlZHVsZUNoYW5nZXModGhpcy5fc2NoZWR1bGUsIFsiY2FsZW5kYXJJZCIsICJ0aXRsZSIsICJsb2NhdGlvbiIsICJzdGFydCIsICJlbmQiLCAiaXNBbGxEYXkiLCAic3RhdGUiXSwgewogICAgICAgIGNhbGVuZGFySWQ6IGUuY2FsZW5kYXJJZCwKICAgICAgICB0aXRsZTogZS50aXRsZS52YWx1ZSwKICAgICAgICBsb2NhdGlvbjogZS5sb2NhdGlvbi52YWx1ZSwKICAgICAgICBzdGFydDogZS5zdGFydCwKICAgICAgICBlbmQ6IGUuZW5kLAogICAgICAgIGlzQWxsRGF5OiBlLmlzQWxsRGF5LAogICAgICAgIHN0YXRlOiBlLnN0YXRlCiAgICAgIH0pOwogICAgICB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiBpLmV4dGVuZCh7CiAgICAgICAgICByYXc6IHsKICAgICAgICAgICAgY2xhc3M6IGUuaXNQcml2YXRlID8gInByaXZhdGUiIDogInB1YmxpYyIKICAgICAgICAgIH0KICAgICAgICB9LCB0aGlzLl9zY2hlZHVsZSksCiAgICAgICAgY2hhbmdlczogdCwKICAgICAgICBzdGFydDogZS5zdGFydCwKICAgICAgICBlbmQ6IGUuZW5kLAogICAgICAgIGNhbGVuZGFyOiB0aGlzLl9zZWxlY3RlZENhbCwKICAgICAgICB0cmlnZ2VyRXZlbnROYW1lOiAiY2xpY2siCiAgICAgIH0pOwogICAgfSwgZi5wcm90b3R5cGUuX29uQ2xpY2tDcmVhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgY2FsZW5kYXJJZDogZS5jYWxlbmRhcklkLAogICAgICAgIHRpdGxlOiBlLnRpdGxlLnZhbHVlLAogICAgICAgIGxvY2F0aW9uOiBlLmxvY2F0aW9uLnZhbHVlLAogICAgICAgIHJhdzogewogICAgICAgICAgY2xhc3M6IGUuaXNQcml2YXRlID8gInByaXZhdGUiIDogInB1YmxpYyIKICAgICAgICB9LAogICAgICAgIHN0YXJ0OiBlLnN0YXJ0LAogICAgICAgIGVuZDogZS5lbmQsCiAgICAgICAgaXNBbGxEYXk6IGUuaXNBbGxEYXksCiAgICAgICAgc3RhdGU6IGUuc3RhdGUKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSBmOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDgpLAogICAgICAgIG8gPSBuKDE2KSwKICAgICAgICBpID0gbigwKSwKICAgICAgICBhID0gbigyKSwKICAgICAgICByID0gbig2KSwKICAgICAgICBzID0gbigxKSwKICAgICAgICBjID0gbig4MSk7CgogICAgZnVuY3Rpb24gdShlKSB7CiAgICAgIGwuY2FsbCh0aGlzLCBlKSwgdGhpcy5sYXllciA9IG5ldyBvKG51bGwsIGUpLCB0aGlzLl92aWV3TW9kZWwgPSBudWxsLCB0aGlzLl9zY2hlZHVsZSA9IG51bGwsIHRoaXMuX2NhbGVuZGFyID0gbnVsbCwgci5vbihlLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKTsKICAgIH0KCiAgICBpLmluaGVyaXQodSwgbCksIHUucHJvdG90eXBlLl9vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gci5nZXRFdmVudFRhcmdldChlKTsKICAgICAgcy5jbG9zZXN0KHQsIGEuY2xhc3NuYW1lKCIuZmxvYXRpbmctbGF5ZXIiKSkgfHwgdGhpcy5oaWRlKCk7CiAgICB9LCB1LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmxheWVyLmRlc3Ryb3koKSwgdGhpcy5sYXllciA9IG51bGwsIHIub2ZmKHRoaXMuY29udGFpbmVyLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKSwgci5vZmYoZG9jdW1lbnQuYm9keSwgIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKSwgbC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpOwogICAgfSwgdS5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHIuZ2V0RXZlbnRUYXJnZXQoZSk7CiAgICAgIHRoaXMuX29uQ2xpY2tFZGl0U2NoZWR1bGUodCksIHRoaXMuX29uQ2xpY2tEZWxldGVTY2hlZHVsZSh0KTsKICAgIH0sIHUucHJvdG90eXBlLl9vbkNsaWNrRWRpdFNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBhLmNsYXNzbmFtZSgicG9wdXAtZWRpdCIpOwogICAgICAocy5oYXNDbGFzcyhlLCB0KSB8fCBzLmNsb3Nlc3QoZSwgIi4iICsgdCkpICYmICh0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiB0aGlzLl9zY2hlZHVsZSwKICAgICAgICB0cmlnZ2VyRXZlbnROYW1lOiAiY2xpY2siLAogICAgICAgIHRhcmdldDogdGhpcy5fc2NoZWR1bGVFbAogICAgICB9KSwgdGhpcy5oaWRlKCkpOwogICAgfSwgdS5wcm90b3R5cGUuX29uQ2xpY2tEZWxldGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gYS5jbGFzc25hbWUoInBvcHVwLWRlbGV0ZSIpOwogICAgICAocy5oYXNDbGFzcyhlLCB0KSB8fCBzLmNsb3Nlc3QoZSwgIi4iICsgdCkpICYmICh0aGlzLmZpcmUoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiB0aGlzLl9zY2hlZHVsZQogICAgICB9KSwgdGhpcy5oaWRlKCkpOwogICAgfSwgdS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmxheWVyLAogICAgICAgICAgbiA9IHRoaXM7CiAgICAgIHQuc2V0Q29udGVudChjKHsKICAgICAgICBzY2hlZHVsZTogZS5zY2hlZHVsZSwKICAgICAgICBjYWxlbmRhcjogZS5jYWxlbmRhcgogICAgICB9KSksIHQuc2hvdygpLCB0aGlzLl9zZXRQb3B1cFBvc2l0aW9uQW5kQXJyb3dEaXJlY3Rpb24oZS5ldmVudCksIHRoaXMuX3NjaGVkdWxlID0gZS5zY2hlZHVsZSwgdGhpcy5fY2FsZW5kYXIgPSBlLmNhbGVuZGFyLCBpLmRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgICByLm9uKGRvY3VtZW50LmJvZHksICJtb3VzZWRvd24iLCBuLl9vbk1vdXNlRG93biwgbik7CiAgICAgIH0pKCk7CiAgICB9LCB1LnByb3RvdHlwZS5fc2V0UG9wdXBQb3NpdGlvbkFuZEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gcy5maW5kKGEuY2xhc3NuYW1lKCIucG9wdXAiKSwgdGhpcy5sYXllci5jb250YWluZXIpLAogICAgICAgICAgbCA9IHsKICAgICAgICB3aWR0aDogbi5vZmZzZXRXaWR0aCwKICAgICAgICBoZWlnaHQ6IG4ub2Zmc2V0SGVpZ2h0CiAgICAgIH0sCiAgICAgICAgICBvID0gdGhpcy5jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksCiAgICAgICAgICBpID0gci5nZXRFdmVudFRhcmdldChlKSwKICAgICAgICAgIGMgPSBzLmNsb3Nlc3QoaSwgYS5jbGFzc25hbWUoIi50aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siKSkgfHwgcy5jbG9zZXN0KGksIGEuY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZSIpKSB8fCBpLAogICAgICAgICAgdSA9IGMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHRoaXMuX3NjaGVkdWxlRWwgPSBjLCB0ID0gdGhpcy5fY2FsY1JlbmRlcmluZ0RhdGEobCwgbywgdSksIHRoaXMubGF5ZXIuc2V0UG9zaXRpb24odC54LCB0LnkpLCB0aGlzLl9zZXRBcnJvd0RpcmVjdGlvbih0LmFycm93KTsKICAgIH0sIHUucHJvdG90eXBlLl9nZXRZQW5kQXJyb3dUb3AgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbykgewogICAgICB2YXIgaSwgYSwgcjsKICAgICAgcmV0dXJuIChhID0gKGkgPSAoKGUgPSBlIDwgMCA/IDAgOiBlKSArIHQpIC8gMikgLSBuIC8gMikgPCBsID8gKGEgPSAwLCByID0gaSAtIGwgLSA4KSA6IGEgKyBuID4gbyA/IHIgPSBpIC0gKGEgPSBNYXRoLm1heChvIC0gbiAtIGwsIDApKSAtIGwgLSA4IDogYSAtPSBsLCAociA8IDAgfHwgciA+IG4pICYmIChyID0gbnVsbCksIHsKICAgICAgICB5OiBhLAogICAgICAgIGFycm93VG9wOiByCiAgICAgIH07CiAgICB9LCB1LnByb3RvdHlwZS5fZ2V0WEFuZEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgdmFyIGkgPSAiYXJyb3ctbGVmdCIsCiAgICAgICAgICBhID0gdDsKICAgICAgcmV0dXJuIGEgKyBuID4gbyA/IChpID0gImFycm93LXJpZ2h0IiwgYSA9IGUgLSBuIC0gNCkgOiBhICs9IDQsIGEgPCBsID8gYSA9IDAgOiBhIC09IGwsIHsKICAgICAgICB4OiBhLAogICAgICAgIGFycm93RGlyZWN0aW9uOiBpCiAgICAgIH07CiAgICB9LCB1LnByb3RvdHlwZS5fY2FsY1JlbmRlcmluZ0RhdGEgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbCA9IHRoaXMuX2dldFlBbmRBcnJvd1RvcChuLnRvcCwgbi5ib3R0b20sIGUuaGVpZ2h0LCB0LnRvcCwgdC5ib3R0b20pLAogICAgICAgICAgbyA9IHRoaXMuX2dldFhBbmRBcnJvd0RpcmVjdGlvbihuLmxlZnQsIG4ucmlnaHQsIGUud2lkdGgsIHQubGVmdCwgdC5yaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIHg6IG8ueCwKICAgICAgICB5OiBsLnksCiAgICAgICAgYXJyb3c6IHsKICAgICAgICAgIGRpcmVjdGlvbjogby5hcnJvd0RpcmVjdGlvbiwKICAgICAgICAgIHBvc2l0aW9uOiBsLmFycm93VG9wCiAgICAgICAgfQogICAgICB9OwogICAgfSwgdS5wcm90b3R5cGUuX3NldEFycm93RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLmRpcmVjdGlvbiB8fCAiYXJyb3ctbGVmdCIsCiAgICAgICAgICBuID0gcy5maW5kKGEuY2xhc3NuYW1lKCIucG9wdXAtYXJyb3ciKSwgdGhpcy5sYXllci5jb250YWluZXIpLAogICAgICAgICAgbCA9IHMuZmluZChhLmNsYXNzbmFtZSgiLnBvcHVwLWFycm93LWJvcmRlciIpLCBuKTsKICAgICAgdCAhPT0gYS5jbGFzc25hbWUoImFycm93LWxlZnQiKSAmJiAocy5yZW1vdmVDbGFzcyhuLCBhLmNsYXNzbmFtZSgiYXJyb3ctbGVmdCIpKSwgcy5hZGRDbGFzcyhuLCBhLmNsYXNzbmFtZSh0KSkpLCBlLnBvc2l0aW9uICYmIChsLnN0eWxlLnRvcCA9IGUucG9zaXRpb24gKyAicHgiKTsKICAgIH0sIHUucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMubGF5ZXIuaGlkZSgpLCB0aGlzLmd1aWRlICYmICh0aGlzLmd1aWRlLmNsZWFyR3VpZGVFbGVtZW50KCksIHRoaXMuZ3VpZGUgPSBudWxsKSwgci5vZmYoZG9jdW1lbnQuYm9keSwgIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKTsKICAgIH0sIHUucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuX3ZpZXdNb2RlbCAmJiB0aGlzLmxheWVyLnNldENvbnRlbnQodGhpcy50bXBsKHRoaXMuX3ZpZXdNb2RlbCkpOwogICAgfSwgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbigxNyksCiAgICAgICAgcyA9IG4oODQpLAogICAgICAgIGMgPSBuKDQpLkRhdGU7CgogICAgZnVuY3Rpb24gdShlLCB0LCBuKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLnZpZXcgPSB0LCB0aGlzLmNvbnRyb2xsZXIgPSBuLCB0aGlzLl9kcmFnU3RhcnQgPSBudWxsLCBlLm9uKHsKICAgICAgICBkcmFnU3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0CiAgICAgIH0sIHRoaXMpLCB0aGlzLmd1aWRlID0gbmV3IHModGhpcyk7CiAgICB9CgogICAgdS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmRyYWdIYW5kbGVyID0gdGhpcy52aWV3ID0gdGhpcy5jb250cm9sbGVyID0gdGhpcy5ndWlkZSA9IHRoaXMuX2RyYWdTdGFydCA9IG51bGw7CiAgICB9LCB1LnByb3RvdHlwZS5jaGVja0V4cGVjdGVkQ29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgaSA9IGEuZ2V0Q2xhc3MoZSk7CiAgICAgIHJldHVybiAhfmkuaW5kZXhPZihvLmNsYXNzbmFtZSgid2Vla2RheS1yZXNpemUtaGFuZGxlIikpICYmICEhKHQgPSBhLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5IikpKSAmJiAhKCEobiA9IChpID0gYS5nZXRDbGFzcyh0KSkubWF0Y2goby5kYXlncmlkLmdldFZpZXdJRFJlZ0V4cCkpIHx8IG4ubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudmlldy5jaGlsZHJlbi5pdGVtcywgblsxXSk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBpLAogICAgICAgICAgciwKICAgICAgICAgIHMsCiAgICAgICAgICBjID0gZS50YXJnZXQsCiAgICAgICAgICB1ID0gdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGMpLAogICAgICAgICAgZCA9IHRoaXMuY29udHJvbGxlcjsKICAgICAgdSAmJiAodCA9IGEuY2xvc2VzdChjLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSwgITApKSAmJiAobiA9IGEuZ2V0RGF0YSh0LCAiaWQiKSwgKGkgPSBkLnNjaGVkdWxlcy5pdGVtc1tuXSkgJiYgKGkuaXNSZWFkT25seSB8fCAociA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEodGhpcy52aWV3LCBlLm9yaWdpbkV2ZW50KSwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gciwgcyA9IHRoaXMuX2RyYWdTdGFydCA9IHIoZS5vcmlnaW5FdmVudCksIGwuZXh0ZW5kKHMsIHsKICAgICAgICBzY2hlZHVsZUJsb2NrRWxlbWVudDogdCwKICAgICAgICBtb2RlbDogaQogICAgICB9KSwgdGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgdGhpcy5maXJlKCJkcmFnc3RhcnQiLCBzKSkpKTsKICAgIH0sIHUucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYzsKICAgICAgdCAmJiB0aGlzLmZpcmUoImRyYWciLCB0KGUub3JpZ2luRXZlbnQpKTsKICAgIH0sIHUucHJvdG90eXBlLl91cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS50YXJnZXRNb2RlbCwKICAgICAgICAgIG4gPSBlLnhJbmRleCAtIGUuZHJhZ1N0YXJ0WEluZGV4LAogICAgICAgICAgbCA9IG5ldyBjKHQuc3RhcnQpLAogICAgICAgICAgbyA9IG5ldyBjKHQuZW5kKTsKICAgICAgbCA9IGwuYWRkRGF0ZShuKSwgbyA9IG8uYWRkRGF0ZShuKSwgdGhpcy5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIHsKICAgICAgICBzY2hlZHVsZTogdCwKICAgICAgICBjaGFuZ2VzOiB7CiAgICAgICAgICBzdGFydDogbCwKICAgICAgICAgIGVuZDogbwogICAgICAgIH0sCiAgICAgICAgc3RhcnQ6IGwsCiAgICAgICAgZW5kOiBvCiAgICAgIH0pOwogICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvLAogICAgICAgICAgaSA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgIGEgPSB0aGlzLl9kcmFnU3RhcnQ7CiAgICAgIGkgJiYgYSAmJiAodGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIG8gPSBpKGUub3JpZ2luRXZlbnQpLCBsLmV4dGVuZChvLCB7CiAgICAgICAgdGFyZ2V0TW9kZWw6IGEubW9kZWwKICAgICAgfSksIG4gfHwgdGhpcy5fdXBkYXRlU2NoZWR1bGUobyksIHRoaXMuZmlyZSh0IHx8ICJkcmFnZW5kIiwgbyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX2RyYWdTdGFydCA9IG51bGwpOwogICAgfSwgdS5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9vbkRyYWdFbmQoZSwgImNsaWNrIiwgITApOwogICAgfSwgaS5taXhpbihyLCB1KSwgbC5DdXN0b21FdmVudHMubWl4aW4odSksIGUuZXhwb3J0cyA9IHU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oNCkuRGF0ZSwKICAgICAgICBzID0gbigxMDYpLAogICAgICAgIGMgPSBNYXRoLm1heCwKICAgICAgICB1ID0gTWF0aC5taW4sCiAgICAgICAgZCA9IE1hdGguYWJzLAogICAgICAgIGggPSBNYXRoLmZsb29yOwoKICAgIGZ1bmN0aW9uIHAoZSwgdCkgewogICAgICB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgdG9wOiAwLAogICAgICAgIGhlaWdodDogIjIwcHgiLAogICAgICAgIGJnQ29sb3I6ICIjZjdjYTg4IiwKICAgICAgICBsYWJlbDogIk5ldyBldmVudCIsCiAgICAgICAgaXNSZXNpemVNb2RlOiAhMSwKICAgICAgICBpc0NyZWF0aW9uTW9kZTogITEsCiAgICAgICAgc3R5bGVzOiB0aGlzLl9nZXRTdHlsZXModC5jb250cm9sbGVyLnRoZW1lKQogICAgICB9LCBlKSwgdGhpcy52aWV3ID0gdCwgdGhpcy53ZWVrcyA9IHQuY2hpbGRyZW4uc29ydChmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHJldHVybiBsLnN0YW1wKGUpIC0gbC5zdGFtcCh0KTsKICAgICAgfSksIHRoaXMuZGF5cyA9IHQuY2hpbGRyZW4uc2luZ2xlKCkuZ2V0UmVuZGVyRGF0ZVJhbmdlKCkubGVuZ3RoLCB0aGlzLnN0YXJ0Q29vcmQgPSBbMCwgMF0sIHRoaXMuZ3VpZGVFbGVtZW50cyA9IHt9LCB0aGlzLmdyaWRzID0gdC5ncmlkczsKICAgIH0KCiAgICBwLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmNsZWFyKCksIHRoaXMub3B0aW9ucyA9IHRoaXMudmlldyA9IHRoaXMud2Vla3MgPSB0aGlzLmRheXMgPSB0aGlzLnN0YXJ0Q29vcmQgPSB0aGlzLmd1aWRlRWxlbWVudHMgPSBudWxsOwogICAgfSwgcC5wcm90b3R5cGUuY2xlYXJHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZGVzdHJveSgpOwogICAgfSwgcC5wcm90b3R5cGUuX2dldFJhdGlvVmFsdWVJbldlZWsgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gKHRoaXMuZ3JpZHNbZV0gfHwgewogICAgICAgIGxlZnQ6IDEwMAogICAgICB9KS5sZWZ0OwogICAgfSwgcC5wcm90b3R5cGUuX2NyZWF0ZUd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgcmV0dXJuIGUuaW5uZXJIVE1MID0gcyh0aGlzLm9wdGlvbnMpLCBlLmZpcnN0Q2hpbGQ7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0R3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmd1aWRlRWxlbWVudHMsCiAgICAgICAgICBuID0gdFtlXSwKICAgICAgICAgIGwgPSB0aGlzLndlZWtzW2VdOwogICAgICByZXR1cm4gbCA/IChuIHx8IChuID0gdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50KCksIGwuY29udGFpbmVyLmFwcGVuZENoaWxkKG4pLCB0W2VdID0gbiksIG4pIDogbnVsbDsKICAgIH0sIHAucHJvdG90eXBlLl9nZXRDb29yZEJ5RGF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGZvciAodmFyIHQgPSB0aGlzLndlZWtzLCBuID0gbC5waWNrKHRoaXMudmlldywgIm9wdGlvbnMiLCAid29ya3dlZWsiKSA/IHRoaXMuZGF5cyArIDIgOiB0aGlzLmRheXMsIG8gPSBmdW5jdGlvbiBvKGUsIHQpIHsKICAgICAgICByZXR1cm4gaChhLm1pbGxpc2Vjb25kc1RvKCJkYXkiLCBkKHQgLSBlKSkpOwogICAgICB9LCBpID0gYS5zdGFydCh0WzBdLm9wdGlvbnMucmVuZGVyU3RhcnREYXRlKSwgcyA9IGUgPCBpLCBjID0gbmV3IHIoaSksIHUgPSBuZXcgcihpKS5hZGREYXRlKHMgPyAtbiA6IG4pLmFkZERhdGUoLTEpLCBwID0gbyhlLCBjKSwgbSA9IDA7ICFhLmlzQmV0d2VlbldpdGhEYXRlKGUsIGMsIHUpOykgewogICAgICAgIGMuYWRkRGF0ZShzID8gLW4gOiBuKSwgdSA9IG5ldyByKGMpLmFkZERhdGUobiAtIDEpLCBwID0gbyhlLCBjKSwgbSArPSBzID8gLTEgOiAxOwogICAgICB9CgogICAgICByZXR1cm4gW3AsIG1dOwogICAgfSwgcC5wcm90b3R5cGUuX2dldExpbWl0ZWRDb29yZCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbyA9IGVbMF0sCiAgICAgICAgICBpID0gZVsxXTsKICAgICAgcmV0dXJuIHQgPSB0IHx8IFswLCAwXSwgbiA9IG4gfHwgW3RoaXMuZGF5cyAtIDEsIHRoaXMud2Vla3MubGVuZ3RoIC0gMV0sIGkgPCB0WzFdID8gbCA9IHQuc2xpY2UoMCkgOiBpID4gblsxXSA/IGwgPSBuLnNsaWNlKDApIDogKG8gPSBjKHRbMF0sIG8pLCBsID0gW28gPSB1KG5bMF0sIG8pLCBpXSksIGw7CiAgICB9LCBwLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIG8gPSBlLnRhcmdldCwKICAgICAgICAgIGkgPSBlLm1vZGVsLAogICAgICAgICAgcyA9IGUueCwKICAgICAgICAgIGMgPSBlLnksCiAgICAgICAgICB1ID0gbmV3IHIodGhpcy52aWV3Lm9wdGlvbnMucmVuZGVyTW9udGgpOwogICAgICBuLmlzQ3JlYXRpb25Nb2RlID8gaSAmJiAhYS5pc1NhbWVNb250aCh1LCBpLnN0YXJ0KSAmJiAoaS5zdGFydC5zZXRNb250aCh1LmdldE1vbnRoKCkpLCBpLnN0YXJ0LnNldERhdGUoMSksIGkuZW5kLnNldE1vbnRoKHUuZ2V0TW9udGgoKSksIGkuZW5kLnNldERhdGUoMSkpIDogKHMgPSAodCA9IHRoaXMuX2dldENvb3JkQnlEYXRlKGkuZ2V0U3RhcnRzKCkpKVswXSwgYyA9IHRbMV0sIGwuZXh0ZW5kKHRoaXMub3B0aW9ucywgewogICAgICAgIHRvcDogcGFyc2VJbnQoby5zdHlsZS50b3AsIDEwKSArICJweCIsCiAgICAgICAgaGVpZ2h0OiBwYXJzZUludChvLnN0eWxlLmhlaWdodCwgMTApICsgInB4IiwKICAgICAgICBsYWJlbDogaS50aXRsZQogICAgICB9LCBpKSksIChsLmlzVW5kZWZpbmVkKHMpIHx8IGwuaXNVbmRlZmluZWQoYykpICYmIChzID0gKHQgPSB0aGlzLl9nZXRDb29yZEJ5RGF0ZShpLmdldFN0YXJ0cygpKSlbMF0sIGMgPSB0WzFdKSwgdGhpcy5zdGFydENvb3JkID0gW3MsIGNdLCB0aGlzLnVwZGF0ZShzLCBjKTsKICAgIH0sIHAucHJvdG90eXBlLl91cGRhdGVHdWlkZXMgPSBmdW5jdGlvbiAoZSkgewogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IGUuZ3VpZGUsCiAgICAgICAgICAgIG4gPSBvLmNsYXNzbmFtZSgibW9udGgtZXhjZWVkLWxlZnQiKSwKICAgICAgICAgICAgbCA9IG8uY2xhc3NuYW1lKCJtb250aC1leGNlZWQtcmlnaHQiKTsKICAgICAgICB0LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCB0LnN0eWxlLmxlZnQgPSBlLmxlZnQgKyAiJSIsIHQuc3R5bGUud2lkdGggPSBlLndpZHRoICsgIiUiLCBlLmV4Y2VlZEwgPyBpLmFkZENsYXNzKHQsIG4pIDogaS5yZW1vdmVDbGFzcyh0LCBuKSwgZS5leGNlZWRSID8gaS5hZGRDbGFzcyh0LCBsKSA6IGkucmVtb3ZlQ2xhc3ModCwgbCk7CiAgICAgIH0pOwogICAgfSwgcC5wcm90b3R5cGUuX2dldE9yaWdpbkluZGljYXRlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbyA9IHUoZVswXSwgdFswXSksCiAgICAgICAgICBpID0gYyhlWzBdLCB0WzBdKSArIDE7CiAgICAgIHJldHVybiB0WzFdID4gZVsxXSA/IChvID0gZVswXSwgaSA9IHRoaXMuZGF5cywgbCA9ICEwKSA6IHRbMV0gPCBlWzFdICYmIChvID0gMCwgaSA9IGVbMF0gKyAxLCBuID0gITApLCB7CiAgICAgICAgbGVmdDogdGhpcy5fZ2V0UmF0aW9WYWx1ZUluV2VlayhvKSwKICAgICAgICB3aWR0aDogdGhpcy5fZ2V0UmF0aW9WYWx1ZUluV2VlayhpKSAtIHRoaXMuX2dldFJhdGlvVmFsdWVJbldlZWsobyksCiAgICAgICAgZXhjZWVkTDogbiwKICAgICAgICBleGNlZWRSOiBsCiAgICAgIH07CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0TW91c2VJbmRpY2F0ZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8gPSB0WzBdLAogICAgICAgICAgaSA9IHRbMF0gKyAxOwogICAgICByZXR1cm4gdFsxXSA+IGVbMV0gPyAobyA9IDAsIG4gPSAhMCkgOiB0WzFdIDwgZVsxXSAmJiAoaSA9IHRoaXMuZGF5cywgbCA9ICEwKSwgewogICAgICAgIGxlZnQ6IHRoaXMuX2dldFJhdGlvVmFsdWVJbldlZWsobyksCiAgICAgICAgd2lkdGg6IHRoaXMuX2dldFJhdGlvVmFsdWVJbldlZWsoaSkgLSB0aGlzLl9nZXRSYXRpb1ZhbHVlSW5XZWVrKG8pLAogICAgICAgIGV4Y2VlZEw6IG4sCiAgICAgICAgZXhjZWVkUjogbAogICAgICB9OwogICAgfSwgcC5wcm90b3R5cGUuX2dldENvbnRhaW5JbmRpY2F0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBsZWZ0OiAwLAogICAgICAgIHdpZHRoOiAxMDAsCiAgICAgICAgZXhjZWVkTDogITAsCiAgICAgICAgZXhjZWVkUjogITAKICAgICAgfTsKICAgIH0sIHAucHJvdG90eXBlLl9yZW1vdmVHdWlkZUVsZW1lbnRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmd1aWRlRWxlbWVudHM7CiAgICAgIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGkucmVtb3ZlKHRbZV0pLCBkZWxldGUgdFtlXTsKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0RXhjbHVkZXNJblJhbmdlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB1LmFwcGx5KG51bGwsIGUpLAogICAgICAgICAgbyA9IGMuYXBwbHkobnVsbCwgZSksCiAgICAgICAgICBpID0gW107CiAgICAgIHJldHVybiBsLmZvckVhY2godCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAoKGUgPSBwYXJzZUludChlLCAxMCkpIDwgbiB8fCBlID4gbykgJiYgaS5wdXNoKGUpOwogICAgICB9KSwgaTsKICAgIH0sIHAucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gdGhpcywKICAgICAgICAgIG8gPSB0aGlzLnN0YXJ0Q29vcmQsCiAgICAgICAgICBpID0gW2UsIHRdLAogICAgICAgICAgYSA9IHRoaXMub3B0aW9ucy5pc1Jlc2l6ZU1vZGUgPyB0aGlzLl9nZXRMaW1pdGVkQ29vcmQoaSwgbykgOiBpLAogICAgICAgICAgciA9IGwua2V5cyh0aGlzLmd1aWRlRWxlbWVudHMpLAogICAgICAgICAgcyA9IGwucmFuZ2UodShvWzFdLCBhWzFdKSwgYyhvWzFdLCBhWzFdKSArIDEpLAogICAgICAgICAgZCA9IHRoaXMuX2dldEV4Y2x1ZGVzSW5SYW5nZShzLCByKSwKICAgICAgICAgIGggPSB7fTsKCiAgICAgIHRoaXMuX3JlbW92ZUd1aWRlRWxlbWVudHMoZCksIGwuZm9yRWFjaChzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICByID0gbi5fZ2V0R3VpZGVFbGVtZW50KGUpOwoKICAgICAgICByICYmICh0ID0gZSA9PT0gb1sxXSA/IG4uX2dldE9yaWdpbkluZGljYXRlKG8sIGEpIDogZSA9PT0gaVsxXSA/IG4uX2dldE1vdXNlSW5kaWNhdGUobywgaSkgOiBuLl9nZXRDb250YWluSW5kaWNhdGUoKSwgaFtlXSA9IGwuZXh0ZW5kKHsKICAgICAgICAgIGd1aWRlOiByCiAgICAgICAgfSwgdCkpOwogICAgICB9KSwgdGhpcy5fdXBkYXRlR3VpZGVzKGgpOwogICAgfSwgcC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGwuZm9yRWFjaCh0aGlzLmd1aWRlRWxlbWVudHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaS5yZW1vdmUoZSk7CiAgICAgIH0pLCB0aGlzLmd1aWRlRWxlbWVudHMgPSB7fTsKICAgIH0sIHAucHJvdG90eXBlLl9nZXRTdHlsZXMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHt9OwogICAgICByZXR1cm4gZSAmJiAodC5ib3JkZXIgPSBlLmNvbW1vbi5jcmVhdGlvbkd1aWRlLmJvcmRlciwgdC5iYWNrZ3JvdW5kQ29sb3IgPSBlLmNvbW1vbi5jcmVhdGlvbkd1aWRlLmJhY2tncm91bmRDb2xvciwgdC5zY2hlZHVsZUhlaWdodCA9IGUubW9udGguc2NoZWR1bGUuaGVpZ2h0LCB0LnNjaGVkdWxlR3V0dGVyID0gZS5tb250aC5zY2hlZHVsZS5tYXJnaW5Ub3AsIHQubWFyZ2luTGVmdCA9IGUubW9udGguc2NoZWR1bGUubWFyZ2luTGVmdCwgdC5tYXJnaW5SaWdodCA9IGUubW9udGguc2NoZWR1bGUubWFyZ2luUmlnaHQsIHQuYm9yZGVyUmFkaXVzID0gZS5tb250aC5zY2hlZHVsZS5ib3JkZXJSYWRpdXMpLCB0OwogICAgfSwgZS5leHBvcnRzID0gcDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigzNyk7CiAgICAgIG4oMTE0KSwgbigxMTUpLCB0LmpRdWVyeSAmJiAodC5qUXVlcnkuZm4udHVpQ2FsZW5kYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGkgPSB0aGlzLmdldCgwKSwKICAgICAgICAgICAgYSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpOwogICAgICAgIGlmIChpKSBpZiAoZSA9IGwucGljayhhLCAwKSB8fCB7fSwgbiA9IHQualF1ZXJ5LmRhdGEoaSwgInR1aUNhbGVuZGFyIikpIHsKICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiBuW2VdKSByZXR1cm4gbltlXS5hcHBseShuLCBhLnNsaWNlKDEpKTsKICAgICAgICB9IGVsc2UgbiA9IG5ldyBvKGksIGUpLCB0LmpRdWVyeS5kYXRhKGksICJ0dWlDYWxlbmRhciIsIG4pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KSwgZS5leHBvcnRzID0gbzsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMjApLAogICAgICAgIGkgPSBuKDI2KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig1MiksCiAgICAgICAgcyA9IG4oMjcpLAogICAgICAgIGMgPSBuKDUzKSwKICAgICAgICB1ID0gbig2MyksCiAgICAgICAgZCA9IG4oOTcpLAogICAgICAgIGggPSBuKDQpLkRhdGUsCiAgICAgICAgcCA9IG4oMiksCiAgICAgICAgbSA9IG4oNCksCiAgICAgICAgZiA9IG4oMTEpLAogICAgICAgIGcgPSBNYXRoLm1pbjsKCiAgICBmdW5jdGlvbiB5KGUsIHQpIHsKICAgICAgITAgPT09ICh0ID0gbC5leHRlbmQoewogICAgICAgIHVzYWdlU3RhdGlzdGljczogITAKICAgICAgfSwgdCkpLnVzYWdlU3RhdGlzdGljcyAmJiBsLnNlbmRIb3N0bmFtZSAmJiBsLnNlbmRIb3N0bmFtZSgiY2FsZW5kYXIiLCAiVUEtMTI5OTUxNjk5LTEiKSwgbC5pc1N0cmluZyhlKSAmJiAoZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSkpLCB0aGlzLl9jYWxlbmRhckNvbG9yID0ge30sIHRoaXMuX3JlbmRlckRhdGUgPSBhLnN0YXJ0KCksIHRoaXMuX3JlbmRlclJhbmdlID0gewogICAgICAgIHN0YXJ0OiBudWxsLAogICAgICAgIGVuZDogbnVsbAogICAgICB9LCB0aGlzLl9jb250cm9sbGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gYyhlKTsKICAgICAgfSh0KSwgdGhpcy5fY29udHJvbGxlci5zZXRDYWxlbmRhcnModC5jYWxlbmRhcnMpLCB0aGlzLl9sYXlvdXQgPSBuZXcgcihlLCB0aGlzLl9jb250cm9sbGVyLnRoZW1lKSwgdGhpcy5fZHJhZ0hhbmRsZXIgPSBuZXcgcyh7CiAgICAgICAgZGlzdGFuY2U6IDEwCiAgICAgIH0sIHRoaXMuX2xheW91dC5jb250YWluZXIpLCB0aGlzLl92aWV3TmFtZSA9IHQuZGVmYXVsdFZpZXcgfHwgIndlZWsiLCB0aGlzLl9yZWZyZXNoTWV0aG9kID0gbnVsbCwgdGhpcy5fc2Nyb2xsVG9Ob3dNZXRob2QgPSBudWxsLCB0aGlzLl9yZXF1ZXN0U2Nyb2xsVG9Ob3cgPSAhMSwgdGhpcy5fb3BlbkNyZWF0aW9uUG9wdXAgPSBudWxsLCB0aGlzLl9oaWRlTW9yZVZpZXcgPSBudWxsLCB0aGlzLl9yZXF1ZXN0UmVuZGVyID0gMCwgdGhpcy5fb3B0aW9ucyA9IHt9LCB0aGlzLl9pbml0aWFsaXplKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIFMoZSwgdCkgewogICAgICBlLnJlY3Vyc2l2ZShmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuID0gZS5vcHRpb25zOwogICAgICAgIG4gJiYgdChlLCBuKTsKICAgICAgfSk7CiAgICB9CgogICAgeS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fZHJhZ0hhbmRsZXIuZGVzdHJveSgpLCB0aGlzLl9jb250cm9sbGVyLm9mZigpLCB0aGlzLl9sYXlvdXQuY2xlYXIoKSwgdGhpcy5fbGF5b3V0LmRlc3Ryb3koKSwgbC5mb3JFYWNoKHRoaXMuX29wdGlvbnMudGVtcGxhdGUsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZSAmJiBvLnVucmVnaXN0ZXJIZWxwZXIodCArICItdG1wbCIpOwogICAgICB9KSwgdGhpcy5fb3B0aW9ucyA9IHRoaXMuX3JlbmRlckRhdGUgPSB0aGlzLl9jb250cm9sbGVyID0gdGhpcy5fbGF5b3V0ID0gdGhpcy5fZHJhZ0hhbmRsZXIgPSB0aGlzLl92aWV3TmFtZSA9IHRoaXMuX3JlZnJlc2hNZXRob2QgPSB0aGlzLl9zY3JvbGxUb05vd01ldGhvZCA9IG51bGw7CiAgICB9LCB5LnByb3RvdHlwZS5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fY29udHJvbGxlciwKICAgICAgICAgIG4gPSB0aGlzLl92aWV3TmFtZTsKICAgICAgdGhpcy5fb3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0VmlldzogbiwKICAgICAgICB0YXNrVmlldzogITAsCiAgICAgICAgc2NoZWR1bGVWaWV3OiAhMCwKICAgICAgICB0ZW1wbGF0ZTogbC5leHRlbmQoewogICAgICAgICAgYWxsZGF5OiBudWxsLAogICAgICAgICAgdGltZTogbnVsbAogICAgICAgIH0sIGwucGljayhlLCAidGVtcGxhdGUiKSB8fCB7fSksCiAgICAgICAgd2VlazogbC5leHRlbmQoe30sIGwucGljayhlLCAid2VlayIpIHx8IHt9KSwKICAgICAgICBtb250aDogbC5leHRlbmQoe30sIGwucGljayhlLCAibW9udGgiKSB8fCB7fSksCiAgICAgICAgY2FsZW5kYXJzOiBbXSwKICAgICAgICB1c2VDcmVhdGlvblBvcHVwOiAhMSwKICAgICAgICB1c2VEZXRhaWxQb3B1cDogITEsCiAgICAgICAgdGltZXpvbmVzOiBlLnRpbWV6b25lcyB8fCBbXSwKICAgICAgICBkaXNhYmxlRGJsQ2xpY2s6ICExLAogICAgICAgIGRpc2FibGVDbGljazogITEsCiAgICAgICAgaXNSZWFkT25seTogITEKICAgICAgfSwgZSksIHRoaXMuX29wdGlvbnMud2VlayA9IGwuZXh0ZW5kKHsKICAgICAgICBzdGFydERheU9mV2VlazogMCwKICAgICAgICB3b3Jrd2VlazogITEKICAgICAgfSwgbC5waWNrKHRoaXMuX29wdGlvbnMsICJ3ZWVrIikgfHwge30pLCB0aGlzLl9vcHRpb25zLm1vbnRoID0gbC5leHRlbmQoewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAwLAogICAgICAgIHdvcmt3ZWVrOiAhMSwKICAgICAgICBzY2hlZHVsZUZpbHRlcjogZnVuY3Rpb24gc2NoZWR1bGVGaWx0ZXIoZSkgewogICAgICAgICAgcmV0dXJuIEJvb2xlYW4oZS5pc1Zpc2libGUpICYmICgiYWxsZGF5IiA9PT0gZS5jYXRlZ29yeSB8fCAidGltZSIgPT09IGUuY2F0ZWdvcnkpOwogICAgICAgIH0KICAgICAgfSwgbC5waWNrKGUsICJtb250aCIpIHx8IHt9KSwgdGhpcy5fb3B0aW9ucy5pc1JlYWRPbmx5ICYmICh0aGlzLl9vcHRpb25zLnVzZUNyZWF0aW9uUG9wdXAgPSAhMSksIHRoaXMuX2xheW91dC5jb250cm9sbGVyID0gdCwgdGhpcy5fc2V0QWRkaXRpb25hbEludGVybmFsT3B0aW9ucyhlKSwgdGhpcy5jaGFuZ2VWaWV3KG4sICEwKTsKICAgIH0sIHkucHJvdG90eXBlLl9zZXRBZGRpdGlvbmFsSW50ZXJuYWxPcHRpb25zID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLnRpbWV6b25lcyB8fCBbXTsKICAgICAgbC5mb3JFYWNoKGUudGVtcGxhdGUsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgZSAmJiBvLnJlZ2lzdGVySGVscGVyKHQgKyAiLXRtcGwiLCBlKTsKICAgICAgfSksIGwuZm9yRWFjaChlLmNhbGVuZGFycyB8fCBbXSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLnNldENhbGVuZGFyQ29sb3IoZS5pZCwgZSwgITApOwogICAgICB9LCB0aGlzKSwgdC5sZW5ndGggJiYgbS5zZXRPZmZzZXRCeVRpbWV6b25lT3B0aW9uKHRbMF0udGltZXpvbmVPZmZzZXQpOwogICAgfSwgeS5wcm90b3R5cGUuY3JlYXRlU2NoZWR1bGVzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5fc2V0U2NoZWR1bGVDb2xvcihlLmNhbGVuZGFySWQsIGUpOwogICAgICB9LCB0aGlzKSwgdGhpcy5fY29udHJvbGxlci5jcmVhdGVTY2hlZHVsZXMoZSwgdCksIHQgfHwgdGhpcy5yZW5kZXIoKTsKICAgIH0sIHkucHJvdG90eXBlLmdldFNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NvbnRyb2xsZXIuc2NoZWR1bGVzLnNpbmdsZShmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBuLmlkID09PSBlICYmIG4uY2FsZW5kYXJJZCA9PT0gdDsKICAgICAgfSk7CiAgICB9LCB5LnByb3RvdHlwZS51cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgIHZhciBvID0gdGhpcy5fY29udHJvbGxlciwKICAgICAgICAgIGkgPSBvLnNjaGVkdWxlcy5zaW5nbGUoZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gbi5pZCA9PT0gZSAmJiBuLmNhbGVuZGFySWQgPT09IHQ7CiAgICAgIH0pOwogICAgICBuICYmIGkgJiYgKG4gPSB0aGlzLl9oYXNDaGFuZ2VkQ2FsZW5kYXIoaSwgbikgPyB0aGlzLl9zZXRTY2hlZHVsZUNvbG9yKG4uY2FsZW5kYXJJZCwgbikgOiBuLCBvLnVwZGF0ZVNjaGVkdWxlKGksIG4pLCBsIHx8IHRoaXMucmVuZGVyKCkpOwogICAgfSwgeS5wcm90b3R5cGUuX2hhc0NoYW5nZWRDYWxlbmRhciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiBlICYmIHQuY2FsZW5kYXJJZCAmJiBlLmNhbGVuZGFySWQgIT09IHQuY2FsZW5kYXJJZDsKICAgIH0sIHkucHJvdG90eXBlLl9zZXRTY2hlZHVsZUNvbG9yID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLl9jYWxlbmRhckNvbG9yW2VdOwogICAgICByZXR1cm4gbiAmJiAodC5jb2xvciA9IHQuY29sb3IgfHwgbi5jb2xvciwgdC5iZ0NvbG9yID0gdC5iZ0NvbG9yIHx8IG4uYmdDb2xvciwgdC5ib3JkZXJDb2xvciA9IHQuYm9yZGVyQ29sb3IgfHwgbi5ib3JkZXJDb2xvciwgdC5kcmFnQmdDb2xvciA9IHQuZHJhZ0JnQ29sb3IgfHwgbi5kcmFnQmdDb2xvciksIHQ7CiAgICB9LCB5LnByb3RvdHlwZS5kZWxldGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsID0gdGhpcy5fY29udHJvbGxlciwKICAgICAgICAgIG8gPSBsLnNjaGVkdWxlcy5zaW5nbGUoZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gbi5pZCA9PT0gZSAmJiBuLmNhbGVuZGFySWQgPT09IHQ7CiAgICAgIH0pOwogICAgICBvICYmIChsLmRlbGV0ZVNjaGVkdWxlKG8pLCBuIHx8IHRoaXMucmVuZGVyKCkpOwogICAgfSwgeS5wcm90b3R5cGUuX2dldFdlZWtEYXlSYW5nZSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvLCBpLCByLCBzOwogICAgICByZXR1cm4gdCA9IHQgfHwgMCwgbyA9IChlID0gbC5pc0RhdGUoZSkgPyBlIDogbmV3IGgoZSkpLmdldERheSgpLCBpID0gbmV3IGgoZSkuYWRkRGF0ZSgtbyArIHQpLCByID0gbmV3IGgoaSkuYWRkRGF0ZSg2KSwgbyA8IHQgJiYgKGkgPSBuZXcgaChpKS5hZGREYXRlKC03KSwgciA9IG5ldyBoKHIpLmFkZERhdGUoLTcpKSwgbiAmJiAocyA9IGEucmFuZ2UoYS5zdGFydChpKSwgYS5lbmQociksIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLCBpID0gKHMgPSBsLmZpbHRlcihzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAhYS5pc1dlZWtlbmQoZS5nZXREYXkoKSk7CiAgICAgIH0pKVswXSwgciA9IHNbcy5sZW5ndGggLSAxXSksIFtpID0gYS5zdGFydChpKSwgciA9IGEuc3RhcnQocildOwogICAgfSwgeS5wcm90b3R5cGUudG9nZ2xlU2NoZWR1bGVzID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0aGlzLl9jb250cm9sbGVyLnNjaGVkdWxlczsKICAgICAgbiA9ICFsLmlzRXhpc3R5KG4pIHx8IG4sIGUgPSBsLmlzQXJyYXkoZSkgPyBlIDogW2VdLCBvLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICB+bC5pbkFycmF5KG4uY2FsZW5kYXJJZCwgZSkgJiYgbi5zZXQoImlzVmlzaWJsZSIsICF0KTsKICAgICAgfSksIG4gJiYgdGhpcy5yZW5kZXIoKTsKICAgIH0sIHkucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX3JlcXVlc3RSZW5kZXIgJiYgZi5jYW5jZWxBbmltRnJhbWUodGhpcy5fcmVxdWVzdFJlbmRlciksIGUgPyB0aGlzLl9yZW5kZXJGdW5jKCkgOiB0aGlzLl9yZXF1ZXN0UmVuZGVyID0gZi5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX3JlbmRlckZ1bmMsIHRoaXMpOwogICAgfSwgeS5wcm90b3R5cGUuX3JlbmRlckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuX3JlZnJlc2hNZXRob2QgJiYgdGhpcy5fcmVmcmVzaE1ldGhvZCgpLCB0aGlzLl9sYXlvdXQgJiYgdGhpcy5fbGF5b3V0LnJlbmRlcigpLCB0aGlzLl9zY3JvbGxUb05vd01ldGhvZCAmJiB0aGlzLl9yZXF1ZXN0U2Nyb2xsVG9Ob3cgJiYgdGhpcy5fc2Nyb2xsVG9Ob3dNZXRob2QoKSwgdGhpcy5fcmVxdWVzdFNjcm9sbFRvTm93ID0gITEsIHRoaXMuX3JlcXVlc3RSZW5kZXIgPSBudWxsOwogICAgfSwgeS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9jb250cm9sbGVyLmNsZWFyU2NoZWR1bGVzKCksIHRoaXMucmVuZGVyKGUpOwogICAgfSwgeS5wcm90b3R5cGUuc2Nyb2xsVG9Ob3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuX3Njcm9sbFRvTm93TWV0aG9kICYmICh0aGlzLl9yZXF1ZXN0U2Nyb2xsVG9Ob3cgPSAhMCk7CiAgICB9LCB5LnByb3RvdHlwZS50b2RheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fcmVuZGVyRGF0ZSA9IGEuc3RhcnQoKSwgdGhpcy5fc2V0Vmlld05hbWUodGhpcy5fdmlld05hbWUpLCB0aGlzLm1vdmUoKSwgdGhpcy5yZW5kZXIoKTsKICAgIH0sIHkucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIHMsCiAgICAgICAgICBjLAogICAgICAgICAgdSwKICAgICAgICAgIGQsCiAgICAgICAgICBwID0gaShhLnN0YXJ0KHRoaXMuX3JlbmRlckRhdGUpKSwKICAgICAgICAgIG0gPSB0aGlzLl92aWV3TmFtZSwKICAgICAgICAgIGYgPSB0aGlzLl9nZXRDdXJyZW50VmlldygpLAogICAgICAgICAgeSA9IFM7CgogICAgICBlID0gbC5pc0V4aXN0eShlKSA/IGUgOiAwLCAibW9udGgiID09PSBtID8gKHIgPSBsLnBpY2sodGhpcy5fb3B0aW9ucywgIm1vbnRoIiwgInN0YXJ0RGF5T2ZXZWVrIikgfHwgMCwgcyA9IGcobC5waWNrKHRoaXMuX29wdGlvbnMsICJtb250aCIsICJ2aXNpYmxlV2Vla3NDb3VudCIpIHx8IDAsIDYpLCBjID0gbC5waWNrKHRoaXMuX29wdGlvbnMsICJtb250aCIsICJ3b3Jrd2VlayIpIHx8ICExLCB1ID0gbC5waWNrKHRoaXMuX29wdGlvbnMsICJtb250aCIsICJpc0Fsd2F5czZXZWVrIiksIHMgPyAoZCA9IHsKICAgICAgICBzdGFydERheU9mV2VlazogciwKICAgICAgICBpc0Fsd2F5czZXZWVrOiAhMSwKICAgICAgICB2aXNpYmxlV2Vla3NDb3VudDogcywKICAgICAgICB3b3Jrd2VlazogYwogICAgICB9LCBwLmFkZERhdGUoNyAqIGUgKiBkLnZpc2libGVXZWVrc0NvdW50KSwgbyA9IGEuYXJyMmRDYWxlbmRhcihwLmQsIGQpLCB5KGYsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdC5yZW5kZXJNb250aCA9IG5ldyBoKHAuZCk7CiAgICAgIH0pKSA6IChkID0gewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiByLAogICAgICAgIGlzQWx3YXlzNldlZWs6IHUsCiAgICAgICAgd29ya3dlZWs6IGMKICAgICAgfSwgcC5hZGRNb250aChlKSwgbyA9IGEuYXJyMmRDYWxlbmRhcihwLmQsIGQpLCB5KGYsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdC5yZW5kZXJNb250aCA9IG5ldyBoKHAuZCk7CiAgICAgIH0pKSwgdCA9IG9bMF1bMF0sIG4gPSBvW28ubGVuZ3RoIC0gMV1bb1tvLmxlbmd0aCAtIDFdLmxlbmd0aCAtIDFdKSA6ICJ3ZWVrIiA9PT0gbSA/IChwLmFkZERhdGUoNyAqIGUpLCByID0gbC5waWNrKHRoaXMuX29wdGlvbnMsICJ3ZWVrIiwgInN0YXJ0RGF5T2ZXZWVrIikgfHwgMCwgYyA9IGwucGljayh0aGlzLl9vcHRpb25zLCAid2VlayIsICJ3b3Jrd2VlayIpIHx8ICExLCBvID0gdGhpcy5fZ2V0V2Vla0RheVJhbmdlKHAuZCwgciwgYyksIHQgPSBvWzBdLCBuID0gb1sxXSwgeShmLCBmdW5jdGlvbiAoZSwgbCkgewogICAgICAgIGwucmVuZGVyU3RhcnREYXRlID0gbmV3IGgodCksIGwucmVuZGVyRW5kRGF0ZSA9IG5ldyBoKG4pLCBlLnNldFN0YXRlKHsKICAgICAgICAgIGNvbGxhcHNlZDogITAKICAgICAgICB9KTsKICAgICAgfSkpIDogImRheSIgPT09IG0gJiYgKHAuYWRkRGF0ZShlKSwgdCA9IGEuc3RhcnQocC5kKSwgbiA9IGEuZW5kKHAuZCksIHkoZiwgZnVuY3Rpb24gKGUsIGwpIHsKICAgICAgICBsLnJlbmRlclN0YXJ0RGF0ZSA9IG5ldyBoKHQpLCBsLnJlbmRlckVuZERhdGUgPSBuZXcgaChuKSwgZS5zZXRTdGF0ZSh7CiAgICAgICAgICBjb2xsYXBzZWQ6ICEwCiAgICAgICAgfSk7CiAgICAgIH0pKSwgdGhpcy5fcmVuZGVyRGF0ZSA9IHAuZCwgdGhpcy5fcmVuZGVyUmFuZ2UgPSB7CiAgICAgICAgc3RhcnQ6IHQsCiAgICAgICAgZW5kOiBuCiAgICAgIH07CiAgICB9LCB5LnByb3RvdHlwZS5zZXREYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgbC5pc1N0cmluZyhlKSAmJiAoZSA9IGEucGFyc2UoZSkpLCB0aGlzLl9yZW5kZXJEYXRlID0gbmV3IGgoZSksIHRoaXMuX3NldFZpZXdOYW1lKHRoaXMuX3ZpZXdOYW1lKSwgdGhpcy5tb3ZlKDApLCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5tb3ZlKDEpLCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUucHJldiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5tb3ZlKC0xKSwgdGhpcy5yZW5kZXIoKTsKICAgIH0sIHkucHJvdG90eXBlLl9nZXRDdXJyZW50VmlldyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLl92aWV3TmFtZTsKICAgICAgcmV0dXJuICJkYXkiID09PSBlICYmIChlID0gIndlZWsiKSwgbC5waWNrKHRoaXMuX2xheW91dC5jaGlsZHJlbi5pdGVtcywgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5zZXRDYWxlbmRhckNvbG9yID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0aGlzLl9jYWxlbmRhckNvbG9yLAogICAgICAgICAgaSA9IHRoaXMuX2NvbnRyb2xsZXIuc2NoZWR1bGVzLAogICAgICAgICAgYSA9IG9bZV07CiAgICAgIGwuaXNPYmplY3QodCkgfHwgcC50aHJvd0Vycm9yKCJDYWxlbmRhciNjaGFuZ2VDYWxlbmRhckNvbG9yKCk6IGNvbG9yIOuKlCB7Y29sb3I6ICcnLCBiZ0NvbG9yOiAnJ30g7ZiV7YOc7Jes7JW8IO2VqeuLiOuLpC4iKSwgYSA9IG9bZV0gPSBsLmV4dGVuZCh7CiAgICAgICAgY29sb3I6ICIjMDAwIiwKICAgICAgICBiZ0NvbG9yOiAiI2ExYjU2YyIsCiAgICAgICAgYm9yZGVyQ29sb3I6ICIjYTFiNTZjIiwKICAgICAgICBkcmFnQmdDb2xvcjogIiNhMWI1NmMiCiAgICAgIH0sIHQpLCBpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LmNhbGVuZGFySWQgPT09IGUgJiYgKHQuY29sb3IgPSBhLmNvbG9yLCB0LmJnQ29sb3IgPSBhLmJnQ29sb3IsIHQuYm9yZGVyQ29sb3IgPSBhLmJvcmRlckNvbG9yLCB0LmRyYWdCZ0NvbG9yID0gYS5kcmFnQmdDb2xvcik7CiAgICAgIH0pLCBuIHx8IHRoaXMucmVuZGVyKCk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiY2xpY2tTY2hlZHVsZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQ2xpY2tNb3JlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJjbGlja01vcmUiLCBlKTsKICAgIH0sIHkucHJvdG90eXBlLl9vbkNsaWNrRGF5bmFtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiY2xpY2tEYXluYW1lIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25CZWZvcmVDcmVhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9vcHRpb25zLnVzZUNyZWF0aW9uUG9wdXAgJiYgIWUudXNlQ3JlYXRpb25Qb3B1cCAmJiB0aGlzLl9zaG93Q3JlYXRpb25Qb3B1cCA/IHRoaXMuX3Nob3dDcmVhdGlvblBvcHVwKGUpIDogdGhpcy5maXJlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQmVmb3JlVXBkYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQmVmb3JlRGVsZXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJiZWZvcmVEZWxldGVTY2hlZHVsZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQWZ0ZXJSZW5kZXJTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiYWZ0ZXJSZW5kZXJTY2hlZHVsZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQ2xpY2tUaW1lem9uZXNDb2xsYXBzZUJ0biA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiY2xpY2tUaW1lem9uZXNDb2xsYXBzZUJ0biIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX3RvZ2dsZVZpZXdTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gdGhpcywKICAgICAgICAgIG8gPSB0LmhhbmRsZXIsCiAgICAgICAgICBpID0gZSA/ICJvbiIgOiAib2ZmIjsKICAgICAgbC5mb3JFYWNoKG8uY2xpY2ssIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZVtpXSgiY2xpY2tTY2hlZHVsZSIsIG4uX29uQ2xpY2ssIG4pOwogICAgICB9KSwgbC5mb3JFYWNoKG8uZGF5bmFtZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlW2ldKCJjbGlja0RheW5hbWUiLCBuLl9vbkNsaWNrRGF5bmFtZSwgbik7CiAgICAgIH0pLCBsLmZvckVhY2goby5jcmVhdGlvbiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlW2ldKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIG4uX29uQmVmb3JlQ3JlYXRlLCBuKSwgZVtpXSgiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBuLl9vbkJlZm9yZURlbGV0ZSwgbik7CiAgICAgIH0pLCBsLmZvckVhY2goby5tb3ZlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGVbaV0oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgbi5fb25CZWZvcmVVcGRhdGUsIG4pOwogICAgICB9KSwgbC5mb3JFYWNoKG8ucmVzaXplLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGVbaV0oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgbi5fb25CZWZvcmVVcGRhdGUsIG4pOwogICAgICB9KSwgdFtpXSgiYWZ0ZXJSZW5kZXJTY2hlZHVsZSIsIG4uX29uQWZ0ZXJSZW5kZXJTY2hlZHVsZSwgbiksIHRbaV0oImNsaWNrVGltZXpvbmVzQ29sbGFwc2VCdG4iLCBuLl9vbkNsaWNrVGltZXpvbmVzQ29sbGFwc2VCdG4sIG4pLCB0W2ldKCJjbGlja01vcmUiLCBuLl9vbkNsaWNrTW9yZSwgbik7CiAgICB9LCB5LnByb3RvdHlwZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0gdGhpcywKICAgICAgICAgIG8gPSB0aGlzLl9sYXlvdXQsCiAgICAgICAgICBpID0gdGhpcy5fY29udHJvbGxlciwKICAgICAgICAgIGEgPSB0aGlzLl9kcmFnSGFuZGxlciwKICAgICAgICAgIHIgPSB0aGlzLl9vcHRpb25zLAogICAgICAgICAgcyA9IHRoaXMuX3ZpZXdOYW1lOwogICAgICAodCB8fCBzICE9PSBlKSAmJiAodGhpcy5fc2V0Vmlld05hbWUoZSksICJkYXkiID09PSBzICYmIChzID0gIndlZWsiKSwgImRheSIgPT09IGUgJiYgKGUgPSAid2VlayIpLCBvLmNoaWxkcmVuLmRvV2hlbkhhcyhzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGwuX3RvZ2dsZVZpZXdTY2hlZHVsZSghMSwgZSk7CiAgICAgIH0pLCBvLmNsZWFyKCksICJtb250aCIgPT09IGUgPyBuID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwpIHsKICAgICAgICByZXR1cm4gZChlLCB0LCBuLCBsKTsKICAgICAgfShpLCBvLmNvbnRhaW5lciwgYSwgcikgOiAid2VlayIgIT09IGUgJiYgImRheSIgIT09IGUgfHwgKG4gPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiB1KGUsIHQsIG4sIGwsIG8pOwogICAgICB9KGksIG8uY29udGFpbmVyLCBhLCByLCB0aGlzLmdldFZpZXdOYW1lKCkpKSwgby5hZGRDaGlsZChuLnZpZXcpLCBvLmNoaWxkcmVuLmRvV2hlbkhhcyhlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGwuX3RvZ2dsZVZpZXdTY2hlZHVsZSghMCwgZSk7CiAgICAgIH0pLCB0aGlzLl9yZWZyZXNoTWV0aG9kID0gbi5yZWZyZXNoLCB0aGlzLl9zY3JvbGxUb05vd01ldGhvZCA9IG4uc2Nyb2xsVG9Ob3csIHRoaXMuX29wZW5DcmVhdGlvblBvcHVwID0gbi5vcGVuQ3JlYXRpb25Qb3B1cCwgdGhpcy5fc2hvd0NyZWF0aW9uUG9wdXAgPSBuLnNob3dDcmVhdGlvblBvcHVwLCB0aGlzLl9oaWRlTW9yZVZpZXcgPSBuLmhpZGVNb3JlVmlldywgdGhpcy5tb3ZlKCksIHRoaXMucmVuZGVyKCkpOwogICAgfSwgeS5wcm90b3R5cGUudG9nZ2xlVGFza1ZpZXcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuX3ZpZXdOYW1lOwogICAgICB0aGlzLl9vcHRpb25zLnRhc2tWaWV3ID0gZSwgdGhpcy5jaGFuZ2VWaWV3KHQsICEwKTsKICAgIH0sIHkucHJvdG90eXBlLnRvZ2dsZVNjaGVkdWxlVmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fdmlld05hbWU7CiAgICAgIHRoaXMuX29wdGlvbnMuc2NoZWR1bGVWaWV3ID0gZSwgdGhpcy5jaGFuZ2VWaWV3KHQsICEwKTsKICAgIH0sIHkucHJvdG90eXBlLl9zZXRWaWV3TmFtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX3ZpZXdOYW1lID0gZTsKICAgIH0sIHkucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICByZXR1cm4gdGhpcy5nZXRTY2hlZHVsZShlLCB0KSA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXNjaGVkdWxlLWlkPSInICsgZSArICciXVtkYXRhLWNhbGVuZGFyLWlkPSInICsgdCArICciXScpIDogbnVsbDsKICAgIH0sIHkucHJvdG90eXBlLnNldFRoZW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9jb250cm9sbGVyLnNldFRoZW1lKGUpOwoKICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKCEwKSwgdDsKICAgIH0sIHkucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBsLmlzT2JqZWN0KGUpICYmICFsLmlzQXJyYXkoZSkgPyBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICAgIHRoaXMuX29wdGlvbnNbdF1bbl0gPSBlOwogICAgICAgIH0sIHRoaXMpIDogdGhpcy5fb3B0aW9uc1t0XSA9IGU7CiAgICAgIH0sIHRoaXMpLCB0aGlzLl9zZXRBZGRpdGlvbmFsSW50ZXJuYWxPcHRpb25zKGUpLCB0IHx8IHRoaXMuY2hhbmdlVmlldyh0aGlzLl92aWV3TmFtZSwgITApOwogICAgfSwgeS5wcm90b3R5cGUuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7CiAgICB9LCB5LnByb3RvdHlwZS5nZXREYXRlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fcmVuZGVyRGF0ZTsKICAgIH0sIHkucHJvdG90eXBlLmdldERhdGVSYW5nZVN0YXJ0ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fcmVuZGVyUmFuZ2Uuc3RhcnQ7CiAgICB9LCB5LnByb3RvdHlwZS5nZXREYXRlUmFuZ2VFbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJSYW5nZS5lbmQ7CiAgICB9LCB5LnByb3RvdHlwZS5nZXRWaWV3TmFtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdOYW1lOwogICAgfSwgeS5wcm90b3R5cGUuc2V0Q2FsZW5kYXJzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgbC5mb3JFYWNoKGUgfHwgW10sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5zZXRDYWxlbmRhckNvbG9yKGUuaWQsIGUsICEwKTsKICAgICAgfSwgdGhpcyksIHRoaXMuX2NvbnRyb2xsZXIuc2V0Q2FsZW5kYXJzKGUpLCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUub3BlbkNyZWF0aW9uUG9wdXAgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9vcGVuQ3JlYXRpb25Qb3B1cCAmJiB0aGlzLl9vcGVuQ3JlYXRpb25Qb3B1cChlKTsKICAgIH0sIHkucHJvdG90eXBlLmhpZGVNb3JlVmlldyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5faGlkZU1vcmVWaWV3ICYmIHRoaXMuX2hpZGVNb3JlVmlldygpOwogICAgfSwgeS5zZXRUaW1lem9uZU9mZnNldCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIG0uc2V0T2Zmc2V0KGUpOwogICAgfSwgeS5zZXRUaW1lem9uZU9mZnNldENhbGxiYWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgbS5zZXRPZmZzZXRDYWxsYmFjayhlKTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKHkpLCBlLmV4cG9ydHMgPSB5OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCA9IG4oMTApOwogICAgdC5kZWZhdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZS5yZWdpc3RlckhlbHBlcigiYmxvY2tIZWxwZXJNaXNzaW5nIiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICB2YXIgbyA9IG4uaW52ZXJzZSwKICAgICAgICAgICAgaSA9IG4uZm47CiAgICAgICAgaWYgKCEwID09PSB0KSByZXR1cm4gaSh0aGlzKTsKICAgICAgICBpZiAoITEgPT09IHQgfHwgbnVsbCA9PSB0KSByZXR1cm4gbyh0aGlzKTsKICAgICAgICBpZiAobC5pc0FycmF5KHQpKSByZXR1cm4gdC5sZW5ndGggPiAwID8gKG4uaWRzICYmIChuLmlkcyA9IFtuLm5hbWVdKSwgZS5oZWxwZXJzLmVhY2godCwgbikpIDogbyh0aGlzKTsKCiAgICAgICAgaWYgKG4uZGF0YSAmJiBuLmlkcykgewogICAgICAgICAgdmFyIGEgPSBsLmNyZWF0ZUZyYW1lKG4uZGF0YSk7CiAgICAgICAgICBhLmNvbnRleHRQYXRoID0gbC5hcHBlbmRDb250ZXh0UGF0aChuLmRhdGEuY29udGV4dFBhdGgsIG4ubmFtZSksIG4gPSB7CiAgICAgICAgICAgIGRhdGE6IGEKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaSh0LCBuKTsKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKGwpIHsKICAgICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICAgIHZhciBvLAogICAgICAgICAgaSA9IG4oMTApLAogICAgICAgICAgYSA9IG4oMTIpLAogICAgICAgICAgciA9IChvID0gYSkgJiYgby5fX2VzTW9kdWxlID8gbyA6IHsKICAgICAgICBkZWZhdWx0OiBvCiAgICAgIH07CiAgICAgIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5yZWdpc3RlckhlbHBlcigiZWFjaCIsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoIXQpIHRocm93IG5ldyByLmRlZmF1bHQoIk11c3QgcGFzcyBpdGVyYXRvciB0byAjZWFjaCIpOwogICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgbyA9IHQuZm4sCiAgICAgICAgICAgICAgYSA9IHQuaW52ZXJzZSwKICAgICAgICAgICAgICBzID0gMCwKICAgICAgICAgICAgICBjID0gIiIsCiAgICAgICAgICAgICAgdSA9IHZvaWQgMCwKICAgICAgICAgICAgICBkID0gdm9pZCAwOwoKICAgICAgICAgIGZ1bmN0aW9uIGgodCwgbiwgbCkgewogICAgICAgICAgICB1ICYmICh1LmtleSA9IHQsIHUuaW5kZXggPSBuLCB1LmZpcnN0ID0gMCA9PT0gbiwgdS5sYXN0ID0gISFsLCBkICYmICh1LmNvbnRleHRQYXRoID0gZCArIHQpKSwgYyArPSBvKGVbdF0sIHsKICAgICAgICAgICAgICBkYXRhOiB1LAogICAgICAgICAgICAgIGJsb2NrUGFyYW1zOiBpLmJsb2NrUGFyYW1zKFtlW3RdLCB0XSwgW2QgKyB0LCBudWxsXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHQuZGF0YSAmJiB0LmlkcyAmJiAoZCA9IGkuYXBwZW5kQ29udGV4dFBhdGgodC5kYXRhLmNvbnRleHRQYXRoLCB0Lmlkc1swXSkgKyAiLiIpLCBpLmlzRnVuY3Rpb24oZSkgJiYgKGUgPSBlLmNhbGwodGhpcykpLCB0LmRhdGEgJiYgKHUgPSBpLmNyZWF0ZUZyYW1lKHQuZGF0YSkpLCBlICYmICJvYmplY3QiID09IF90eXBlb2YoZSkpIGlmIChpLmlzQXJyYXkoZSkpIGZvciAodmFyIHAgPSBlLmxlbmd0aDsgcyA8IHA7IHMrKykgewogICAgICAgICAgICBzIGluIGUgJiYgaChzLCBzLCBzID09PSBlLmxlbmd0aCAtIDEpOwogICAgICAgICAgfSBlbHNlIGlmIChsLlN5bWJvbCAmJiBlW2wuU3ltYm9sLml0ZXJhdG9yXSkgewogICAgICAgICAgICBmb3IgKHZhciBtID0gW10sIGYgPSBlW2wuU3ltYm9sLml0ZXJhdG9yXSgpLCBnID0gZi5uZXh0KCk7ICFnLmRvbmU7IGcgPSBmLm5leHQoKSkgewogICAgICAgICAgICAgIG0ucHVzaChnLnZhbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChwID0gKGUgPSBtKS5sZW5ndGg7IHMgPCBwOyBzKyspIHsKICAgICAgICAgICAgICBoKHMsIHMsIHMgPT09IGUubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBuID0gdm9pZCAwLCBPYmplY3Qua2V5cyhlKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZvaWQgMCAhPT0gbiAmJiBoKG4sIHMgLSAxKSwgbiA9IGUsIHMrKzsKICAgICAgICAgIH0pLCB2b2lkIDAgIT09IG4gJiYgaChuLCBzIC0gMSwgITApOwogICAgICAgICAgcmV0dXJuIDAgPT09IHMgJiYgKGMgPSBhKHRoaXMpKSwgYzsKICAgICAgICB9KTsKICAgICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwOwogICAgdmFyIGwsCiAgICAgICAgbyA9IG4oMTIpLAogICAgICAgIGkgPSAobCA9IG8pICYmIGwuX19lc01vZHVsZSA/IGwgOiB7CiAgICAgIGRlZmF1bHQ6IGwKICAgIH07CiAgICB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJoZWxwZXJNaXNzaW5nIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICgxICE9PSBhcmd1bWVudHMubGVuZ3RoKSB0aHJvdyBuZXcgaS5kZWZhdWx0KCdNaXNzaW5nIGhlbHBlcjogIicgKyBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdLm5hbWUgKyAnIicpOwogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwOwogICAgdmFyIGwsCiAgICAgICAgbyA9IG4oMTApLAogICAgICAgIGkgPSBuKDEyKSwKICAgICAgICBhID0gKGwgPSBpKSAmJiBsLl9fZXNNb2R1bGUgPyBsIDogewogICAgICBkZWZhdWx0OiBsCiAgICB9OwogICAgdC5kZWZhdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZS5yZWdpc3RlckhlbHBlcigiaWYiLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICgyICE9IGFyZ3VtZW50cy5sZW5ndGgpIHRocm93IG5ldyBhLmRlZmF1bHQoIiNpZiByZXF1aXJlcyBleGFjdGx5IG9uZSBhcmd1bWVudCIpOwogICAgICAgIHJldHVybiBvLmlzRnVuY3Rpb24oZSkgJiYgKGUgPSBlLmNhbGwodGhpcykpLCAhdC5oYXNoLmluY2x1ZGVaZXJvICYmICFlIHx8IG8uaXNFbXB0eShlKSA/IHQuaW52ZXJzZSh0aGlzKSA6IHQuZm4odGhpcyk7CiAgICAgIH0pLCBlLnJlZ2lzdGVySGVscGVyKCJ1bmxlc3MiLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIGlmICgyICE9IGFyZ3VtZW50cy5sZW5ndGgpIHRocm93IG5ldyBhLmRlZmF1bHQoIiN1bmxlc3MgcmVxdWlyZXMgZXhhY3RseSBvbmUgYXJndW1lbnQiKTsKICAgICAgICByZXR1cm4gZS5oZWxwZXJzLmlmLmNhbGwodGhpcywgdCwgewogICAgICAgICAgZm46IG4uaW52ZXJzZSwKICAgICAgICAgIGludmVyc2U6IG4uZm4sCiAgICAgICAgICBoYXNoOiBuLmhhc2gKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5kZWZhdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZS5yZWdpc3RlckhlbHBlcigibG9nIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIHQgPSBbdm9pZCAwXSwgbiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0sIGwgPSAwOyBsIDwgYXJndW1lbnRzLmxlbmd0aCAtIDE7IGwrKykgewogICAgICAgICAgdC5wdXNoKGFyZ3VtZW50c1tsXSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbyA9IDE7CiAgICAgICAgbnVsbCAhPSBuLmhhc2gubGV2ZWwgPyBvID0gbi5oYXNoLmxldmVsIDogbi5kYXRhICYmIG51bGwgIT0gbi5kYXRhLmxldmVsICYmIChvID0gbi5kYXRhLmxldmVsKSwgdFswXSA9IG8sIGUubG9nLmFwcGx5KGUsIHQpOwogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJsb29rdXAiLCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICAgIHJldHVybiBlID8gbi5sb29rdXBQcm9wZXJ0eShlLCB0KSA6IGU7CiAgICAgIH0pOwogICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCwKICAgICAgICBvID0gbigxMCksCiAgICAgICAgaSA9IG4oMTIpLAogICAgICAgIGEgPSAobCA9IGkpICYmIGwuX19lc01vZHVsZSA/IGwgOiB7CiAgICAgIGRlZmF1bHQ6IGwKICAgIH07CiAgICB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJ3aXRoIiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBpZiAoMiAhPSBhcmd1bWVudHMubGVuZ3RoKSB0aHJvdyBuZXcgYS5kZWZhdWx0KCIjd2l0aCByZXF1aXJlcyBleGFjdGx5IG9uZSBhcmd1bWVudCIpOwogICAgICAgIG8uaXNGdW5jdGlvbihlKSAmJiAoZSA9IGUuY2FsbCh0aGlzKSk7CiAgICAgICAgdmFyIG4gPSB0LmZuOwogICAgICAgIGlmIChvLmlzRW1wdHkoZSkpIHJldHVybiB0LmludmVyc2UodGhpcyk7CiAgICAgICAgdmFyIGwgPSB0LmRhdGE7CiAgICAgICAgcmV0dXJuIHQuZGF0YSAmJiB0LmlkcyAmJiAoKGwgPSBvLmNyZWF0ZUZyYW1lKHQuZGF0YSkpLmNvbnRleHRQYXRoID0gby5hcHBlbmRDb250ZXh0UGF0aCh0LmRhdGEuY29udGV4dFBhdGgsIHQuaWRzWzBdKSksIG4oZSwgewogICAgICAgICAgZGF0YTogbCwKICAgICAgICAgIGJsb2NrUGFyYW1zOiBvLmJsb2NrUGFyYW1zKFtlXSwgW2wgJiYgbC5jb250ZXh0UGF0aF0pCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITAsIHQucmVnaXN0ZXJEZWZhdWx0RGVjb3JhdG9ycyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGkuZGVmYXVsdChlKTsKICAgIH07CiAgICB2YXIgbCwKICAgICAgICBvID0gbig0NiksCiAgICAgICAgaSA9IChsID0gbykgJiYgbC5fX2VzTW9kdWxlID8gbCA6IHsKICAgICAgZGVmYXVsdDogbAogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwOwogICAgdmFyIGwgPSBuKDEwKTsKICAgIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGUucmVnaXN0ZXJEZWNvcmF0b3IoImlubGluZSIsIGZ1bmN0aW9uIChlLCB0LCBuLCBvKSB7CiAgICAgICAgdmFyIGkgPSBlOwogICAgICAgIHJldHVybiB0LnBhcnRpYWxzIHx8ICh0LnBhcnRpYWxzID0ge30sIGkgPSBmdW5jdGlvbiBpKG8sIF9pKSB7CiAgICAgICAgICB2YXIgYSA9IG4ucGFydGlhbHM7CiAgICAgICAgICBuLnBhcnRpYWxzID0gbC5leHRlbmQoe30sIGEsIHQucGFydGlhbHMpOwogICAgICAgICAgdmFyIHIgPSBlKG8sIF9pKTsKICAgICAgICAgIHJldHVybiBuLnBhcnRpYWxzID0gYSwgcjsKICAgICAgICB9KSwgdC5wYXJ0aWFsc1tvLmFyZ3NbMF1dID0gby5mbiwgaTsKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5jcmVhdGVOZXdMb29rdXBPYmplY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIGUgPSBhcmd1bWVudHMubGVuZ3RoLCB0ID0gQXJyYXkoZSksIG4gPSAwOyBuIDwgZTsgbisrKSB7CiAgICAgICAgdFtuXSA9IGFyZ3VtZW50c1tuXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGwuZXh0ZW5kLmFwcGx5KHZvaWQgMCwgW09iamVjdC5jcmVhdGUobnVsbCldLmNvbmNhdCh0KSk7CiAgICB9OwogICAgdmFyIGwgPSBuKDEwKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGwoZSkgewogICAgICB0aGlzLnN0cmluZyA9IGU7CiAgICB9CgogICAgdC5fX2VzTW9kdWxlID0gITAsIGwucHJvdG90eXBlLnRvU3RyaW5nID0gbC5wcm90b3R5cGUudG9IVE1MID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gIiIgKyB0aGlzLnN0cmluZzsKICAgIH0sIHQuZGVmYXVsdCA9IGwsIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmNoZWNrUmV2aXNpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUgJiYgZVswXSB8fCAxLAogICAgICAgICAgbiA9IHIuQ09NUElMRVJfUkVWSVNJT047CiAgICAgIGlmICh0ID49IHIuTEFTVF9DT01QQVRJQkxFX0NPTVBJTEVSX1JFVklTSU9OICYmIHQgPD0gci5DT01QSUxFUl9SRVZJU0lPTikgcmV0dXJuOwoKICAgICAgaWYgKHQgPCByLkxBU1RfQ09NUEFUSUJMRV9DT01QSUxFUl9SRVZJU0lPTikgewogICAgICAgIHZhciBsID0gci5SRVZJU0lPTl9DSEFOR0VTW25dLAogICAgICAgICAgICBvID0gci5SRVZJU0lPTl9DSEFOR0VTW3RdOwogICAgICAgIHRocm93IG5ldyBhLmRlZmF1bHQoIlRlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGFuIG9sZGVyIHZlcnNpb24gb2YgSGFuZGxlYmFycyB0aGFuIHRoZSBjdXJyZW50IHJ1bnRpbWUuIFBsZWFzZSB1cGRhdGUgeW91ciBwcmVjb21waWxlciB0byBhIG5ld2VyIHZlcnNpb24gKCIgKyBsICsgIikgb3IgZG93bmdyYWRlIHlvdXIgcnVudGltZSB0byBhbiBvbGRlciB2ZXJzaW9uICgiICsgbyArICIpLiIpOwogICAgICB9CgogICAgICB0aHJvdyBuZXcgYS5kZWZhdWx0KCJUZW1wbGF0ZSB3YXMgcHJlY29tcGlsZWQgd2l0aCBhIG5ld2VyIHZlcnNpb24gb2YgSGFuZGxlYmFycyB0aGFuIHRoZSBjdXJyZW50IHJ1bnRpbWUuIFBsZWFzZSB1cGRhdGUgeW91ciBydW50aW1lIHRvIGEgbmV3ZXIgdmVyc2lvbiAoIiArIGVbMV0gKyAiKS4iKTsKICAgIH0sIHQudGVtcGxhdGUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBpZiAoIXQpIHRocm93IG5ldyBhLmRlZmF1bHQoIk5vIGVudmlyb25tZW50IHBhc3NlZCB0byB0ZW1wbGF0ZSIpOwogICAgICBpZiAoIWUgfHwgIWUubWFpbikgdGhyb3cgbmV3IGEuZGVmYXVsdCgiVW5rbm93biB0ZW1wbGF0ZSBvYmplY3Q6ICIgKyBfdHlwZW9mKGUpKTsKICAgICAgZS5tYWluLmRlY29yYXRvciA9IGUubWFpbl9kLCB0LlZNLmNoZWNrUmV2aXNpb24oZS5jb21waWxlcik7CiAgICAgIHZhciBuID0gZS5jb21waWxlciAmJiA3ID09PSBlLmNvbXBpbGVyWzBdOwogICAgICB2YXIgbCA9IHsKICAgICAgICBzdHJpY3Q6IGZ1bmN0aW9uIHN0cmljdChlLCB0LCBuKSB7CiAgICAgICAgICBpZiAoIWUgfHwgISh0IGluIGUpKSB0aHJvdyBuZXcgYS5kZWZhdWx0KCciJyArIHQgKyAnIiBub3QgZGVmaW5lZCBpbiAnICsgZSwgewogICAgICAgICAgICBsb2M6IG4KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGVbdF07CiAgICAgICAgfSwKICAgICAgICBsb29rdXBQcm9wZXJ0eTogZnVuY3Rpb24gbG9va3VwUHJvcGVydHkoZSwgdCkgewogICAgICAgICAgdmFyIG4gPSBlW3RdOwogICAgICAgICAgcmV0dXJuIG51bGwgPT0gbiB8fCBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkgfHwgdS5yZXN1bHRJc0FsbG93ZWQobiwgbC5wcm90b0FjY2Vzc0NvbnRyb2wsIHQpID8gbiA6IHZvaWQgMDsKICAgICAgICB9LAogICAgICAgIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKGUsIHQpIHsKICAgICAgICAgIGZvciAodmFyIG4gPSBlLmxlbmd0aCwgbyA9IDA7IG8gPCBuOyBvKyspIHsKICAgICAgICAgICAgaWYgKG51bGwgIT0gKGVbb10gJiYgbC5sb29rdXBQcm9wZXJ0eShlW29dLCB0KSkpIHJldHVybiBlW29dW3RdOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbGFtYmRhOiBmdW5jdGlvbiBsYW1iZGEoZSwgdCkgewogICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyBlLmNhbGwodCkgOiBlOwogICAgICAgIH0sCiAgICAgICAgZXNjYXBlRXhwcmVzc2lvbjogby5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgIGludm9rZVBhcnRpYWw6IGZ1bmN0aW9uIGludm9rZVBhcnRpYWwobiwgbCwgaSkgewogICAgICAgICAgaS5oYXNoICYmIChsID0gby5leHRlbmQoe30sIGwsIGkuaGFzaCksIGkuaWRzICYmIChpLmlkc1swXSA9ICEwKSksIG4gPSB0LlZNLnJlc29sdmVQYXJ0aWFsLmNhbGwodGhpcywgbiwgbCwgaSk7CiAgICAgICAgICB2YXIgciA9IG8uZXh0ZW5kKHt9LCBpLCB7CiAgICAgICAgICAgIGhvb2tzOiB0aGlzLmhvb2tzLAogICAgICAgICAgICBwcm90b0FjY2Vzc0NvbnRyb2w6IHRoaXMucHJvdG9BY2Nlc3NDb250cm9sCiAgICAgICAgICB9KSwKICAgICAgICAgICAgICBzID0gdC5WTS5pbnZva2VQYXJ0aWFsLmNhbGwodGhpcywgbiwgbCwgcik7CgogICAgICAgICAgaWYgKG51bGwgPT0gcyAmJiB0LmNvbXBpbGUgJiYgKGkucGFydGlhbHNbaS5uYW1lXSA9IHQuY29tcGlsZShuLCBlLmNvbXBpbGVyT3B0aW9ucywgdCksIHMgPSBpLnBhcnRpYWxzW2kubmFtZV0obCwgcikpLCBudWxsICE9IHMpIHsKICAgICAgICAgICAgaWYgKGkuaW5kZW50KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IHMuc3BsaXQoIlxuIiksIHUgPSAwLCBkID0gYy5sZW5ndGg7IHUgPCBkICYmIChjW3VdIHx8IHUgKyAxICE9PSBkKTsgdSsrKSB7CiAgICAgICAgICAgICAgICBjW3VdID0gaS5pbmRlbnQgKyBjW3VdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcyA9IGMuam9pbigiXG4iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgICB9CgogICAgICAgICAgdGhyb3cgbmV3IGEuZGVmYXVsdCgiVGhlIHBhcnRpYWwgIiArIGkubmFtZSArICIgY291bGQgbm90IGJlIGNvbXBpbGVkIHdoZW4gcnVubmluZyBpbiBydW50aW1lLW9ubHkgbW9kZSIpOwogICAgICAgIH0sCiAgICAgICAgZm46IGZ1bmN0aW9uIGZuKHQpIHsKICAgICAgICAgIHZhciBuID0gZVt0XTsKICAgICAgICAgIHJldHVybiBuLmRlY29yYXRvciA9IGVbdCArICJfZCJdLCBuOwogICAgICAgIH0sCiAgICAgICAgcHJvZ3JhbXM6IFtdLAogICAgICAgIHByb2dyYW06IGZ1bmN0aW9uIHByb2dyYW0oZSwgdCwgbiwgbCwgbykgewogICAgICAgICAgdmFyIGkgPSB0aGlzLnByb2dyYW1zW2VdLAogICAgICAgICAgICAgIGEgPSB0aGlzLmZuKGUpOwogICAgICAgICAgcmV0dXJuIHQgfHwgbyB8fCBsIHx8IG4gPyBpID0gZCh0aGlzLCBlLCBhLCB0LCBuLCBsLCBvKSA6IGkgfHwgKGkgPSB0aGlzLnByb2dyYW1zW2VdID0gZCh0aGlzLCBlLCBhKSksIGk7CiAgICAgICAgfSwKICAgICAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKGUsIHQpIHsKICAgICAgICAgIGZvciAoOyBlICYmIHQtLTspIHsKICAgICAgICAgICAgZSA9IGUuX3BhcmVudDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZTsKICAgICAgICB9LAogICAgICAgIG1lcmdlSWZOZWVkZWQ6IGZ1bmN0aW9uIG1lcmdlSWZOZWVkZWQoZSwgdCkgewogICAgICAgICAgdmFyIG4gPSBlIHx8IHQ7CiAgICAgICAgICByZXR1cm4gZSAmJiB0ICYmIGUgIT09IHQgJiYgKG4gPSBvLmV4dGVuZCh7fSwgdCwgZSkpLCBuOwogICAgICAgIH0sCiAgICAgICAgbnVsbENvbnRleHQ6IE9iamVjdC5zZWFsKHt9KSwKICAgICAgICBub29wOiB0LlZNLm5vb3AsCiAgICAgICAgY29tcGlsZXJJbmZvOiBlLmNvbXBpbGVyCiAgICAgIH07CgogICAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCB2b2lkIDAgPT09IGFyZ3VtZW50c1sxXSA/IHt9IDogYXJndW1lbnRzWzFdLAogICAgICAgICAgICBvID0gbi5kYXRhOwogICAgICAgIGkuX3NldHVwKG4pLCAhbi5wYXJ0aWFsICYmIGUudXNlRGF0YSAmJiAobyA9IHAodCwgbykpOwogICAgICAgIHZhciBhID0gdm9pZCAwLAogICAgICAgICAgICByID0gZS51c2VCbG9ja1BhcmFtcyA/IFtdIDogdm9pZCAwOwoKICAgICAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgICAgIHJldHVybiAiIiArIGUubWFpbihsLCB0LCBsLmhlbHBlcnMsIGwucGFydGlhbHMsIG8sIHIsIGEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGUudXNlRGVwdGhzICYmIChhID0gbi5kZXB0aHMgPyB0ICE9IG4uZGVwdGhzWzBdID8gW3RdLmNvbmNhdChuLmRlcHRocykgOiBuLmRlcHRocyA6IFt0XSksIChzID0gbShlLm1haW4sIHMsIGwsIG4uZGVwdGhzIHx8IFtdLCBvLCByKSkodCwgbik7CiAgICAgIH0KCiAgICAgIHJldHVybiBpLmlzVG9wID0gITAsIGkuX3NldHVwID0gZnVuY3Rpb24gKGkpIHsKICAgICAgICBpZiAoaS5wYXJ0aWFsKSBsLnByb3RvQWNjZXNzQ29udHJvbCA9IGkucHJvdG9BY2Nlc3NDb250cm9sLCBsLmhlbHBlcnMgPSBpLmhlbHBlcnMsIGwucGFydGlhbHMgPSBpLnBhcnRpYWxzLCBsLmRlY29yYXRvcnMgPSBpLmRlY29yYXRvcnMsIGwuaG9va3MgPSBpLmhvb2tzO2Vsc2UgewogICAgICAgICAgdmFyIGEgPSBvLmV4dGVuZCh7fSwgdC5oZWxwZXJzLCBpLmhlbHBlcnMpOwogICAgICAgICAgIWZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgIE9iamVjdC5rZXlzKGUpLmZvckVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICB2YXIgbCA9IGVbbl07CgogICAgICAgICAgICAgIGVbbl0gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSB0Lmxvb2t1cFByb3BlcnR5OwogICAgICAgICAgICAgICAgcmV0dXJuIGMud3JhcEhlbHBlcihlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gby5leHRlbmQoewogICAgICAgICAgICAgICAgICAgIGxvb2t1cFByb3BlcnR5OiBuCiAgICAgICAgICAgICAgICAgIH0sIGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfShsLCB0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KGEsIGwpLCBsLmhlbHBlcnMgPSBhLCBlLnVzZVBhcnRpYWwgJiYgKGwucGFydGlhbHMgPSBsLm1lcmdlSWZOZWVkZWQoaS5wYXJ0aWFscywgdC5wYXJ0aWFscykpLCAoZS51c2VQYXJ0aWFsIHx8IGUudXNlRGVjb3JhdG9ycykgJiYgKGwuZGVjb3JhdG9ycyA9IG8uZXh0ZW5kKHt9LCB0LmRlY29yYXRvcnMsIGkuZGVjb3JhdG9ycykpLCBsLmhvb2tzID0ge30sIGwucHJvdG9BY2Nlc3NDb250cm9sID0gdS5jcmVhdGVQcm90b0FjY2Vzc0NvbnRyb2woaSk7CiAgICAgICAgICB2YXIgciA9IGkuYWxsb3dDYWxsc1RvSGVscGVyTWlzc2luZyB8fCBuOwogICAgICAgICAgcy5tb3ZlSGVscGVyVG9Ib29rcyhsLCAiaGVscGVyTWlzc2luZyIsIHIpLCBzLm1vdmVIZWxwZXJUb0hvb2tzKGwsICJibG9ja0hlbHBlck1pc3NpbmciLCByKTsKICAgICAgICB9CiAgICAgIH0sIGkuX2NoaWxkID0gZnVuY3Rpb24gKHQsIG4sIG8sIGkpIHsKICAgICAgICBpZiAoZS51c2VCbG9ja1BhcmFtcyAmJiAhbykgdGhyb3cgbmV3IGEuZGVmYXVsdCgibXVzdCBwYXNzIGJsb2NrIHBhcmFtcyIpOwogICAgICAgIGlmIChlLnVzZURlcHRocyAmJiAhaSkgdGhyb3cgbmV3IGEuZGVmYXVsdCgibXVzdCBwYXNzIHBhcmVudCBkZXB0aHMiKTsKICAgICAgICByZXR1cm4gZChsLCB0LCBlW3RdLCBuLCAwLCBvLCBpKTsKICAgICAgfSwgaTsKICAgIH0sIHQud3JhcFByb2dyYW0gPSBkLCB0LnJlc29sdmVQYXJ0aWFsID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgZSA/IGUuY2FsbCB8fCBuLm5hbWUgfHwgKG4ubmFtZSA9IGUsIGUgPSBuLnBhcnRpYWxzW2VdKSA6IGUgPSAiQHBhcnRpYWwtYmxvY2siID09PSBuLm5hbWUgPyBuLmRhdGFbInBhcnRpYWwtYmxvY2siXSA6IG4ucGFydGlhbHNbbi5uYW1lXTsKICAgICAgcmV0dXJuIGU7CiAgICB9LCB0Lmludm9rZVBhcnRpYWwgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbCA9IG4uZGF0YSAmJiBuLmRhdGFbInBhcnRpYWwtYmxvY2siXTsKICAgICAgbi5wYXJ0aWFsID0gITAsIG4uaWRzICYmIChuLmRhdGEuY29udGV4dFBhdGggPSBuLmlkc1swXSB8fCBuLmRhdGEuY29udGV4dFBhdGgpOwogICAgICB2YXIgaSA9IHZvaWQgMDsKICAgICAgbi5mbiAmJiBuLmZuICE9PSBoICYmIGZ1bmN0aW9uICgpIHsKICAgICAgICBuLmRhdGEgPSByLmNyZWF0ZUZyYW1lKG4uZGF0YSk7CiAgICAgICAgdmFyIGUgPSBuLmZuOwogICAgICAgIGkgPSBuLmRhdGFbInBhcnRpYWwtYmxvY2siXSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCB2b2lkIDAgPT09IGFyZ3VtZW50c1sxXSA/IHt9IDogYXJndW1lbnRzWzFdOwogICAgICAgICAgcmV0dXJuIG4uZGF0YSA9IHIuY3JlYXRlRnJhbWUobi5kYXRhKSwgbi5kYXRhWyJwYXJ0aWFsLWJsb2NrIl0gPSBsLCBlKHQsIG4pOwogICAgICAgIH0sIGUucGFydGlhbHMgJiYgKG4ucGFydGlhbHMgPSBvLmV4dGVuZCh7fSwgbi5wYXJ0aWFscywgZS5wYXJ0aWFscykpOwogICAgICB9KCk7CiAgICAgIHZvaWQgMCA9PT0gZSAmJiBpICYmIChlID0gaSk7CiAgICAgIGlmICh2b2lkIDAgPT09IGUpIHRocm93IG5ldyBhLmRlZmF1bHQoIlRoZSBwYXJ0aWFsICIgKyBuLm5hbWUgKyAiIGNvdWxkIG5vdCBiZSBmb3VuZCIpOwogICAgICBpZiAoZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSByZXR1cm4gZSh0LCBuKTsKICAgIH0sIHQubm9vcCA9IGg7CgogICAgdmFyIGwsCiAgICAgICAgbyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlICYmIGUuX19lc01vZHVsZSkgcmV0dXJuIGU7CiAgICAgIHZhciB0ID0ge307CiAgICAgIGlmIChudWxsICE9IGUpIGZvciAodmFyIG4gaW4gZSkgewogICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBuKSAmJiAodFtuXSA9IGVbbl0pOwogICAgICB9CiAgICAgIHJldHVybiB0LmRlZmF1bHQgPSBlLCB0OwogICAgfShuKDEwKSksCiAgICAgICAgaSA9IG4oMTIpLAogICAgICAgIGEgPSAobCA9IGkpICYmIGwuX19lc01vZHVsZSA/IGwgOiB7CiAgICAgIGRlZmF1bHQ6IGwKICAgIH0sCiAgICAgICAgciA9IG4oMjIpLAogICAgICAgIHMgPSBuKDIzKSwKICAgICAgICBjID0gbig1MCksCiAgICAgICAgdSA9IG4oMjUpOwoKICAgIGZ1bmN0aW9uIGQoZSwgdCwgbiwgbCwgbywgaSwgYSkgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB2YXIgbyA9IGFyZ3VtZW50cy5sZW5ndGggPD0gMSB8fCB2b2lkIDAgPT09IGFyZ3VtZW50c1sxXSA/IHt9IDogYXJndW1lbnRzWzFdLAogICAgICAgICAgICByID0gYTsKICAgICAgICByZXR1cm4gIWEgfHwgdCA9PSBhWzBdIHx8IHQgPT09IGUubnVsbENvbnRleHQgJiYgbnVsbCA9PT0gYVswXSB8fCAociA9IFt0XS5jb25jYXQoYSkpLCBuKGUsIHQsIGUuaGVscGVycywgZS5wYXJ0aWFscywgby5kYXRhIHx8IGwsIGkgJiYgW28uYmxvY2tQYXJhbXNdLmNvbmNhdChpKSwgcik7CiAgICAgIH0KCiAgICAgIHJldHVybiAociA9IG0obiwgciwgZSwgYSwgbCwgaSkpLnByb2dyYW0gPSB0LCByLmRlcHRoID0gYSA/IGEubGVuZ3RoIDogMCwgci5ibG9ja1BhcmFtcyA9IG8gfHwgMCwgcjsKICAgIH0KCiAgICBmdW5jdGlvbiBoKCkgewogICAgICByZXR1cm4gIiI7CiAgICB9CgogICAgZnVuY3Rpb24gcChlLCB0KSB7CiAgICAgIHJldHVybiB0ICYmICJyb290IiBpbiB0IHx8ICgodCA9IHQgPyByLmNyZWF0ZUZyYW1lKHQpIDoge30pLnJvb3QgPSBlKSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBtKGUsIHQsIG4sIGwsIGksIGEpIHsKICAgICAgaWYgKGUuZGVjb3JhdG9yKSB7CiAgICAgICAgdmFyIHIgPSB7fTsKICAgICAgICB0ID0gZS5kZWNvcmF0b3IodCwgciwgbiwgbCAmJiBsWzBdLCBpLCBhLCBsKSwgby5leHRlbmQodCwgcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0OwogICAgfQogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITAsIHQud3JhcEhlbHBlciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlKSByZXR1cm4gZTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0gPSB0KG4pLCBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uIChuKSB7CiAgICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdm9pZCAwICE9PSBuID8gbiA6IHdpbmRvdywKICAgICAgICAgICAgbCA9IHQuSGFuZGxlYmFyczsKCiAgICAgICAgZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHQuSGFuZGxlYmFycyA9PT0gZSAmJiAodC5IYW5kbGViYXJzID0gbCksIGU7CiAgICAgICAgfTsKICAgICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbigxMyksCiAgICAgICAgciA9IG4oOCk7CgogICAgZnVuY3Rpb24gcyhlLCB0KSB7CiAgICAgIGUgPSBpLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBlLCBvLmNsYXNzbmFtZSgibGF5b3V0IikpLCB0aGlzLmNvbnRhaW5lciA9IGUsIHRoaXMuY2hpbGRyZW4gPSBuZXcgYShmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlLnZpZXdOYW1lOwogICAgICB9KSwgdGhpcy50aGVtZSA9IHQsIHRoaXMuYXBwbHlUaGVtZSgpOwogICAgfQoKICAgIGwuaW5oZXJpdChzLCByKSwgcy5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGUuZGVzdHJveSgpOwogICAgICB9KSwgdGhpcy5jaGlsZHJlbi5jbGVhcigpLCB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsKICAgIH0sIHMucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5yZW1vdmUoZSk7CiAgICB9LCBzLnByb3RvdHlwZS50b2dnbGVDaGlsZFZpZXcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gWyJhZGQiLCAicmVtb3ZlIl07CiAgICAgIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoYSkgewogICAgICAgIHQgPSBhLmNvbnRhaW5lciwgbiA9IE51bWJlcihhLnZpZXdOYW1lID09PSBlKSwgaVtsW25dICsgIkNsYXNzIl0odCwgby5jbGFzc25hbWUoImhpZGRlbiIpKTsKICAgICAgfSk7CiAgICB9LCBzLnByb3RvdHlwZS5hcHBseVRoZW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuY29udGFpbmVyLnN0eWxlLAogICAgICAgICAgdCA9IHRoaXMudGhlbWUuY29tbW9uOwogICAgICBlLmJhY2tncm91bmRDb2xvciA9IHQuYmFja2dyb3VuZENvbG9yOwogICAgfSwgZS5leHBvcnRzID0gczsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbig1NCksCiAgICAgICAgaSA9IG4oNjApLAogICAgICAgIGEgPSBuKDYxKSwKICAgICAgICByID0gbig2Mik7CgogICAgZnVuY3Rpb24gcyhlLCB0LCBuKSB7CiAgICAgIHZhciBvID0gdFtuXSA9IHt9OwogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICBvW25dID0gbC5iaW5kKGUsIHQpOwogICAgICB9KTsKICAgIH0KCiAgICBlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IG5ldyBvKGUpOwogICAgICByZXR1cm4gcyhpLCB0LCAiQ29yZSIpLCBzKGEsIHQsICJXZWVrIiksIHMociwgdCwgIk1vbnRoIiksIHQuQ29yZS50aGVtZSA9IHQudGhlbWUsIHQuV2Vlay50aGVtZSA9IHQudGhlbWUsIHQuTW9udGgudGhlbWUgPSB0LnRoZW1lLCB0OwogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigxNCksCiAgICAgICAgaSA9IG4oMjgpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDUpLAogICAgICAgIHMgPSBuKDU3KTsKCiAgICBmdW5jdGlvbiBjKGUpIHsKICAgICAgZSA9IGUgfHwge30sIHRoaXMuZ3JvdXBGdW5jID0gZS5ncm91cEZ1bmMgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IGUubW9kZWw7CiAgICAgICAgcmV0dXJuIGUubW9kZWwuaXNBbGxEYXkgfHwgInRpbWUiID09PSB0LmNhdGVnb3J5ICYmIHQuZW5kIC0gdC5zdGFydCA+IGEuTUlMTElTRUNPTkRTX1BFUl9EQVkgPyAiYWxsZGF5IiA6IHQuY2F0ZWdvcnk7CiAgICAgIH0sIHRoaXMuc2NoZWR1bGVzID0gci5jcmVhdGVTY2hlZHVsZUNvbGxlY3Rpb24oKSwgdGhpcy5kYXRlTWF0cml4ID0ge30sIHRoaXMudGhlbWUgPSBuZXcgcyhlLnRoZW1lKSwgdGhpcy5jYWxlbmRhcnMgPSBbXTsKICAgIH0KCiAgICBjLnByb3RvdHlwZS5fZ2V0Q29udGFpbkRhdGVzSW5TY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS5nZXRTdGFydHMoKSwKICAgICAgICAgIG4gPSBlLmdldEVuZHMoKSwKICAgICAgICAgIGwgPSBhLnN0YXJ0KHQpLAogICAgICAgICAgbyA9IDAgPT09IGEuY29tcGFyZSh0LCBuKSA/IG4gOiBhLmNvbnZlcnRTdGFydERheVRvTGFzdERheShuKSwKICAgICAgICAgIGkgPSBhLmVuZChvKTsKICAgICAgcmV0dXJuIGEucmFuZ2UobCwgaSwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSk7CiAgICB9LCBjLnByb3RvdHlwZS5jcmVhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCA9IHsKICAgICAgICBkYXRhOiBlCiAgICAgIH07CiAgICAgIHJldHVybiB0aGlzLmludm9rZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCBsKSA/IChuID0gdGhpcy5hZGRTY2hlZHVsZShvLmNyZWF0ZShlKSksIHQgfHwgdGhpcy5maXJlKCJjcmVhdGVkU2NoZWR1bGUiLCBuKSwgbikgOiBudWxsOwogICAgfSwgYy5wcm90b3R5cGUuY3JlYXRlU2NoZWR1bGVzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzOwogICAgICByZXR1cm4gbC5tYXAoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbi5jcmVhdGVTY2hlZHVsZShlLCB0KTsKICAgICAgfSk7CiAgICB9LCBjLnByb3RvdHlwZS51cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gdC5zdGFydCB8fCBlLnN0YXJ0LAogICAgICAgICAgbyA9IHQuZW5kIHx8IGUuZW5kOwogICAgICByZXR1cm4gWyJtaWxlc3RvbmUiLCAidGFzayIsICJhbGxkYXkiLCAidGltZSJdLmluZGV4T2YoKHQgPSB0IHx8IHt9KS5jYXRlZ29yeSkgPiAtMSAmJiBlLnNldCgiY2F0ZWdvcnkiLCB0LmNhdGVnb3J5KSwgImFsbGRheSIgPT09IHQuY2F0ZWdvcnkgJiYgKHQuaXNBbGxEYXkgPSAhMCksIGwuaXNVbmRlZmluZWQodC5pc0FsbERheSkgfHwgZS5zZXQoImlzQWxsRGF5IiwgdC5pc0FsbERheSksIGwuaXNVbmRlZmluZWQodC5jYWxlbmRhcklkKSB8fCBlLnNldCgiY2FsZW5kYXJJZCIsIHQuY2FsZW5kYXJJZCksIHQudGl0bGUgJiYgZS5zZXQoInRpdGxlIiwgdC50aXRsZSksIHQuYm9keSAmJiBlLnNldCgiYm9keSIsIHQuYm9keSksICh0LnN0YXJ0IHx8IHQuZW5kKSAmJiAoZS5pc0FsbERheSA/IGUuc2V0QWxsRGF5UGVyaW9kKG4sIG8pIDogZS5zZXRUaW1lUGVyaW9kKG4sIG8pKSwgdC5jb2xvciAmJiBlLnNldCgiY29sb3IiLCB0LmNvbG9yKSwgdC5iZ0NvbG9yICYmIGUuc2V0KCJiZ0NvbG9yIiwgdC5iZ0NvbG9yKSwgdC5ib3JkZXJDb2xvciAmJiBlLnNldCgiYm9yZGVyQ29sb3IiLCB0LmJvcmRlckNvbG9yKSwgdC5vcmlnaW4gJiYgZS5zZXQoIm9yaWdpbiIsIHQub3JpZ2luKSwgbC5pc1VuZGVmaW5lZCh0LmlzUGVuZGluZykgfHwgZS5zZXQoImlzUGVuZGluZyIsIHQuaXNQZW5kaW5nKSwgbC5pc1VuZGVmaW5lZCh0LmlzRm9jdXNlZCkgfHwgZS5zZXQoImlzRm9jdXNlZCIsIHQuaXNGb2N1c2VkKSwgbC5pc1VuZGVmaW5lZCh0LmlzUmVhZE9ubHkpIHx8IGUuc2V0KCJpc1JlYWRPbmx5IiwgdC5pc1JlYWRPbmx5KSwgdC5sb2NhdGlvbiAmJiBlLnNldCgibG9jYXRpb24iLCB0LmxvY2F0aW9uKSwgdC5zdGF0ZSAmJiBlLnNldCgic3RhdGUiLCB0LnN0YXRlKSwgdC5yYXcgJiYgZS5zZXQoInJhdyIsIHQucmF3KSwgdGhpcy5fcmVtb3ZlRnJvbU1hdHJpeChlKSwgdGhpcy5fYWRkVG9NYXRyaXgoZSksIHRoaXMuZmlyZSgidXBkYXRlU2NoZWR1bGUiKSwgZTsKICAgIH0sIGMucHJvdG90eXBlLmRlbGV0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlbW92ZUZyb21NYXRyaXgoZSksIHRoaXMuc2NoZWR1bGVzLnJlbW92ZShlKSwgZTsKICAgIH0sIGMucHJvdG90eXBlLl9hZGRUb01hdHJpeCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5kYXRlTWF0cml4LAogICAgICAgICAgbiA9IHRoaXMuX2dldENvbnRhaW5EYXRlc0luU2NoZWR1bGUoZSk7CgogICAgICBsLmZvckVhY2gobiwgZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgbyA9IGEuZm9ybWF0KG4sICJZWVlZTU1ERCIpOwogICAgICAgICh0W29dID0gdFtvXSB8fCBbXSkucHVzaChsLnN0YW1wKGUpKTsKICAgICAgfSk7CiAgICB9LCBjLnByb3RvdHlwZS5fcmVtb3ZlRnJvbU1hdHJpeCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gbC5zdGFtcChlKTsKICAgICAgbC5mb3JFYWNoKHRoaXMuZGF0ZU1hdHJpeCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiA9IGwuaW5BcnJheSh0LCBlKTsKICAgICAgICB+biAmJiBlLnNwbGljZShuLCAxKTsKICAgICAgfSwgdGhpcyk7CiAgICB9LCBjLnByb3RvdHlwZS5hZGRTY2hlZHVsZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiB0aGlzLnNjaGVkdWxlcy5hZGQoZSksIHRoaXMuX2FkZFRvTWF0cml4KGUpLCB0IHx8IHRoaXMuZmlyZSgiYWRkZWRTY2hlZHVsZSIsIGUpLCBlOwogICAgfSwgYy5wcm90b3R5cGUuc3BsaXRTY2hlZHVsZUJ5RGF0ZVJhbmdlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSBhLnJhbmdlKGEuc3RhcnQoZSksIGEuZW5kKHQpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwKICAgICAgICAgIGkgPSB0aGlzLmRhdGVNYXRyaXgsCiAgICAgICAgICBzID0ge307CiAgICAgIHJldHVybiBsLmZvckVhY2hBcnJheShvLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBvID0gYS5mb3JtYXQoZSwgIllZWVlNTUREIiksCiAgICAgICAgICAgIGMgPSBpW29dOwogICAgICAgIHQgPSBzW29dID0gci5jcmVhdGVTY2hlZHVsZUNvbGxlY3Rpb24oKSwgYyAmJiBjLmxlbmd0aCAmJiBsLmZvckVhY2hBcnJheShjLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbi5kb1doZW5IYXMoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdC5hZGQoZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSksIHM7CiAgICB9LCBjLnByb3RvdHlwZS5maW5kQnlEYXRlUmFuZ2UgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBzLAogICAgICAgICAgYyA9IGEucmFuZ2UoYS5zdGFydChlKSwgYS5lbmQodCksIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLAogICAgICAgICAgdSA9IHRoaXMuc2NoZWR1bGVzLml0ZW1zLAogICAgICAgICAgZCA9IHRoaXMuZGF0ZU1hdHJpeCwKICAgICAgICAgIGggPSBhLmZvcm1hdCwKICAgICAgICAgIHAgPSB7fTsKICAgICAgcmV0dXJuIGwuZm9yRWFjaEFycmF5KGMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbyA9IGgoZSwgIllZWVlNTUREIiksIG4gPSBkW29dLCBzID0gcFtvXSA9IHIuY3JlYXRlU2NoZWR1bGVDb2xsZWN0aW9uKCksIG4gJiYgbi5sZW5ndGggJiYgcy5hZGQuYXBwbHkocywgbC5tYXAobiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBpLmNyZWF0ZSh1W2VdKTsKICAgICAgICB9KSk7CiAgICAgIH0pLCBwOwogICAgfSwgYy5wcm90b3R5cGUuY2xlYXJTY2hlZHVsZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZGF0ZU1hdHJpeCA9IHt9LCB0aGlzLnNjaGVkdWxlcy5jbGVhcigpLCB0aGlzLmZpcmUoImNsZWFyU2NoZWR1bGVzIik7CiAgICB9LCBjLnByb3RvdHlwZS5zZXRUaGVtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnRoZW1lLnNldFN0eWxlcyhlKTsKICAgIH0sIGMucHJvdG90eXBlLnNldENhbGVuZGFycyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuY2FsZW5kYXJzID0gZTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKGMpLCBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBsLmlzRXhpc3R5LAogICAgICAgIGkgPSBsLnBpY2ssCiAgICAgICAgYSA9IGwuaXNGdW5jdGlvbiwKICAgICAgICByID0gewogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlLCB0KSB7CiAgICAgICAgdGhpc1tlXSAhPT0gdCAmJiAodGhpc1tlXSA9IHQsIHRoaXMuX2NoYW5nZWQgfHwgKHRoaXMuX2NoYW5nZWQgPSB7fSksIHRoaXMuX2NoYW5nZWRbZV0gPSAhMCwgdGhpcy5fZGlydHkgPSAhMCk7CiAgICAgIH0sCiAgICAgIGlzRGlydHk6IGZ1bmN0aW9uIGlzRGlydHkoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5fZGlydHk7CiAgICAgIH0sCiAgICAgIGRpcnR5OiBmdW5jdGlvbiBkaXJ0eShlKSB7CiAgICAgICAgKGUgPSAhbyhlKSB8fCBlKSB8fCAodGhpcy5fY2hhbmdlZCA9IHt9KSwgdGhpcy5fZGlydHkgPSBlOwogICAgICB9LAogICAgICBkZWxldGVQcm9wOiBmdW5jdGlvbiBkZWxldGVQcm9wKGUpIHsKICAgICAgICBkZWxldGUgdGhpc1tlXSwgdGhpcy5fY2hhbmdlZCAmJiBkZWxldGUgdGhpcy5fY2hhbmdlZFtlXTsKICAgICAgfSwKICAgICAgaXNQcm9wQ2hhbmdlZDogZnVuY3Rpb24gaXNQcm9wQ2hhbmdlZChlKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5fY2hhbmdlZCAmJiAhMCA9PT0gdGhpcy5fY2hhbmdlZFtlXTsKICAgICAgfSwKICAgICAgbWl4aW46IGZ1bmN0aW9uIG1peGluKGUpIHsKICAgICAgICB2YXIgdCA9IC8oXl98bWl4aW58d3JhcCkvOwogICAgICAgIGwuZm9yRWFjaE93blByb3BlcnRpZXMociwgZnVuY3Rpb24gKG4sIGwpIHsKICAgICAgICAgIHQudGVzdChsKSB8fCAoZVtsXSA9IHJbbF0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB3cmFwOiBmdW5jdGlvbiB3cmFwKGUsIHQsIG4pIHsKICAgICAgICB2YXIgcywKICAgICAgICAgICAgYyA9IHIud3JhcDsKICAgICAgICBsLmlzT2JqZWN0KHQpID8gbC5mb3JFYWNoT3duUHJvcGVydGllcyh0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgYyhlLCBuLCB0KTsKICAgICAgICB9KSA6IChuID0gIW8obikgfHwgbiwgZS5fd3JhcHBlciB8fCAoZS5fd3JhcHBlciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyksCiAgICAgICAgICAgICAgICBsID0gZS5hcHBseSh0aGlzLCBuKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RpcnR5ID0gdCwgbDsKICAgICAgICAgIH07CiAgICAgICAgfSksIG8oaShlLCB0KSkgJiYgYShlW3RdKSAmJiAhbyhpKGUsIHQsICJfd3JhcHBlZCIpKSAmJiAocyA9IGVbdF0sIGVbdF0gPSBlLl93cmFwcGVyKHMsIG4pLCBlW3RdLl93cmFwcGVkID0gITApKTsKICAgICAgfQogICAgfTsKICAgIGUuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCwKICAgICAgICBvID0gbig0KS5EYXRlLAogICAgICAgIGkgPSBuKDApLAogICAgICAgIGEgPSAvXlxzKnxccyokL2csCiAgICAgICAgciA9IG4oMyk7CiAgICBsID0gewogICAgICB0cmltOiBmdW5jdGlvbiB0cmltKGUpIHsKICAgICAgICByZXR1cm4gZS5yZXBsYWNlKGEsICIiKTsKICAgICAgfSwKICAgICAgdmFsaWRhdG9yczogewogICAgICAgIHJlcXVpcmVkOiBmdW5jdGlvbiByZXF1aXJlZChlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9ICEwOwogICAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbzsKICAgICAgICAgICAgcmV0dXJuIG8gPSBlW3RdLCBuID0gIWkuaXNVbmRlZmluZWQobykgJiYgIiIgIT09IGwudHJpbShvKTsKICAgICAgICAgIH0pLCBuOwogICAgICAgIH0sCiAgICAgICAgZGF0ZVJhbmdlOiBmdW5jdGlvbiBkYXRlUmFuZ2UoZSwgdCkgewogICAgICAgICAgdmFyIG4sIGw7CiAgICAgICAgICByZXR1cm4gIWkuaXNFeGlzdHkoZSkgfHwgMiAhPT0gdC5sZW5ndGggfHwgKG4gPSBuZXcgbyhlW3RbMF1dKSwgbCA9IG5ldyBvKGVbdFsxXV0pLCAhKCFyLmlzVmFsaWQobikgfHwgIXIuaXNWYWxpZChsKSkgJiYgMSAhPT0gci5jb21wYXJlKG4sIGwpKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGlzVmFsaWQ6IGZ1bmN0aW9uIGlzVmFsaWQoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHQgPSB0aGlzLAogICAgICAgICAgICBuID0gdGhpcy5jb25zdHJ1Y3Rvci5zY2hlbWEsCiAgICAgICAgICAgIG8gPSBsLnZhbGlkYXRvcnMsCiAgICAgICAgICAgIGEgPSAhMDsKICAgICAgICByZXR1cm4gIW4gfHwgKGkuZm9yRWFjaChuLCBmdW5jdGlvbiAobiwgbCkgewogICAgICAgICAgcmV0dXJuICEoZSA9IG9bbF0pIHx8IChhID0gZSh0LCBuKSk7CiAgICAgICAgfSksIGEpOwogICAgICB9LAogICAgICBwYXJhbWV0ZXJpemU6IGZ1bmN0aW9uIHBhcmFtZXRlcml6ZSgpIHsKICAgICAgICB2YXIgZSA9IHt9LAogICAgICAgICAgICB0ID0gaS5pc0Z1bmN0aW9uOwogICAgICAgIHJldHVybiBpLmZvckVhY2godGhpcywgZnVuY3Rpb24gKG4sIGwpIHsKICAgICAgICAgIHQobikgfHwgKGVbbF0gPSBuKTsKICAgICAgICB9KSwgZTsKICAgICAgfSwKICAgICAgbWl4aW46IGZ1bmN0aW9uIG1peGluKGUpIHsKICAgICAgICBpLmZvckVhY2gobCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICJtaXhpbiIgIT09IG4gJiYgKGVbbl0gPSB0KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgZS5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbig1OCksCiAgICAgICAgaSA9IG4oNTkpLAogICAgICAgIGEgPSBuKDUpOwoKICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICB2YXIgdCA9IGUgfHwgbzsKICAgICAgdGhpcy5fbWFwID0gbmV3IGwuSGFzaE1hcCgpLCB0aGlzLnNldFN0eWxlcyh0KTsKICAgIH0KCiAgICByLnByb3RvdHlwZS5nZXRTdHlsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLl9tYXAuZ2V0KGUpOwogICAgfSwgci5wcm90b3R5cGUuc2V0U3R5bGUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHt9OwogICAgICByZXR1cm4gbltlXSA9IHQsIDAgPT09IHRoaXMuc2V0U3R5bGVzKG4pLmxlbmd0aDsKICAgIH0sIHIucHJvdG90eXBlLnNldFN0eWxlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gW107CiAgICAgIHJldHVybiBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICBsLmlzVW5kZWZpbmVkKGlbbl0pID8gdC5wdXNoKG4pIDogKHRoaXMuX21hcC5zZXQobiwgZSksIGEuc2V0KHRoaXMsIG4sIGUpKTsKICAgICAgfSwgdGhpcyksIGwuZm9yRWFjaChpLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHRoaXMuZ2V0U3R5bGUodCkgfHwgKHRoaXMuX21hcC5zZXQodCwgZSksIGEuc2V0KHRoaXMsIHQsIGUpKTsKICAgICAgfSwgdGhpcyksIHQ7CiAgICB9LCByLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLl9tYXAua2V5cygpLAogICAgICAgICAgdCA9IHt9OwoKICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4gPSBlLnNwbGl0KCIuIilbMF07CiAgICAgICAgdFtuXSB8fCAodFtuXSA9IG4pOwogICAgICB9KSwgbC5mb3JFYWNoKHQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZGVsZXRlIHRoaXNbZV07CiAgICAgIH0sIHRoaXMpLCB0aGlzLl9tYXAucmVtb3ZlQWxsKCk7CiAgICB9LCBlLmV4cG9ydHMgPSByOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZS5leHBvcnRzID0gewogICAgICAiY29tbW9uLmJvcmRlciI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJjb21tb24uYmFja2dyb3VuZENvbG9yIjogIndoaXRlIiwKICAgICAgImNvbW1vbi5ob2xpZGF5LmNvbG9yIjogIiNmZjQwNDAiLAogICAgICAiY29tbW9uLnNhdHVyZGF5LmNvbG9yIjogIiMzMzMiLAogICAgICAiY29tbW9uLmRheW5hbWUuY29sb3IiOiAiIzMzMyIsCiAgICAgICJjb21tb24udG9kYXkuY29sb3IiOiAiIzMzMyIsCiAgICAgICJjb21tb24uY3JlYXRpb25HdWlkZS5iYWNrZ3JvdW5kQ29sb3IiOiAicmdiYSg4MSwgOTIsIDIzMCwgMC4wNSkiLAogICAgICAiY29tbW9uLmNyZWF0aW9uR3VpZGUuYm9yZGVyIjogIjFweCBzb2xpZCAjNTE1Y2U2IiwKICAgICAgIm1vbnRoLmRheW5hbWUuaGVpZ2h0IjogIjMxcHgiLAogICAgICAibW9udGguZGF5bmFtZS5ib3JkZXJMZWZ0IjogIm5vbmUiLAogICAgICAibW9udGguZGF5bmFtZS5wYWRkaW5nTGVmdCI6ICIxMHB4IiwKICAgICAgIm1vbnRoLmRheW5hbWUucGFkZGluZ1JpZ2h0IjogIjAiLAogICAgICAibW9udGguZGF5bmFtZS5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJtb250aC5kYXluYW1lLmZvbnRTaXplIjogIjEycHgiLAogICAgICAibW9udGguZGF5bmFtZS5mb250V2VpZ2h0IjogIm5vcm1hbCIsCiAgICAgICJtb250aC5kYXluYW1lLnRleHRBbGlnbiI6ICJsZWZ0IiwKICAgICAgIm1vbnRoLmhvbGlkYXlFeGNlcHRUaGlzTW9udGguY29sb3IiOiAicmdiYSgyNTUsIDY0LCA2NCwgMC40KSIsCiAgICAgICJtb250aC5kYXlFeGNlcHRUaGlzTW9udGguY29sb3IiOiAicmdiYSg1MSwgNTEsIDUxLCAwLjQpIiwKICAgICAgIm1vbnRoLndlZWtlbmQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAibW9udGguZGF5LmZvbnRTaXplIjogIjE0cHgiLAogICAgICAibW9udGguc2NoZWR1bGUuYm9yZGVyUmFkaXVzIjogIjJweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5oZWlnaHQiOiAiMjRweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5tYXJnaW5Ub3AiOiAiMnB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLm1hcmdpbkxlZnQiOiAiOHB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLm1hcmdpblJpZ2h0IjogIjhweCIsCiAgICAgICJtb250aC5tb3JlVmlldy5ib3JkZXIiOiAiMXB4IHNvbGlkICNkNWQ1ZDUiLAogICAgICAibW9udGgubW9yZVZpZXcuYm94U2hhZG93IjogIjAgMnB4IDZweCAwIHJnYmEoMCwgMCwgMCwgMC4xKSIsCiAgICAgICJtb250aC5tb3JlVmlldy5iYWNrZ3JvdW5kQ29sb3IiOiAid2hpdGUiLAogICAgICAibW9udGgubW9yZVZpZXcucGFkZGluZ0JvdHRvbSI6ICIxN3B4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUuaGVpZ2h0IjogIjQ0cHgiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5tYXJnaW5Cb3R0b20iOiAiMTJweCIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLmJvcmRlckJvdHRvbSI6ICJub25lIiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUucGFkZGluZyI6ICIxMnB4IDE3cHggMCAxN3B4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3TGlzdC5wYWRkaW5nIjogIjAgMTdweCIsCiAgICAgICJ3ZWVrLmRheW5hbWUuaGVpZ2h0IjogIjQycHgiLAogICAgICAid2Vlay5kYXluYW1lLmJvcmRlclRvcCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLmRheW5hbWUuYm9yZGVyQm90dG9tIjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsuZGF5bmFtZS5ib3JkZXJMZWZ0IjogIm5vbmUiLAogICAgICAid2Vlay5kYXluYW1lLnBhZGRpbmdMZWZ0IjogIjAiLAogICAgICAid2Vlay5kYXluYW1lLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsuZGF5bmFtZS50ZXh0QWxpZ24iOiAibGVmdCIsCiAgICAgICJ3ZWVrLnRvZGF5LmNvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5wYXN0RGF5LmNvbG9yIjogIiNiYmIiLAogICAgICAid2Vlay52cGFuZWxTcGxpdHRlci5ib3JkZXIiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay52cGFuZWxTcGxpdHRlci5oZWlnaHQiOiAiM3B4IiwKICAgICAgIndlZWsuZGF5Z3JpZC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLmRheWdyaWQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC53aWR0aCI6ICI3MnB4IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC5wYWRkaW5nUmlnaHQiOiAiOHB4IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50b2RheS5iYWNrZ3JvdW5kQ29sb3IiOiAicmdiYSg4MSwgOTIsIDIzMCwgMC4wNSkiLAogICAgICAid2Vlay53ZWVrZW5kLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0LndpZHRoIjogIjcycHgiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuZm9udFNpemUiOiAiMTFweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkT25lSG91ci5oZWlnaHQiOiAiNTJweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkSGFsZkhvdXIuaGVpZ2h0IjogIjI2cHgiLAogICAgICAid2Vlay50aW1lZ3JpZEhhbGZIb3VyLmJvcmRlckJvdHRvbSI6ICJub25lIiwKICAgICAgIndlZWsudGltZWdyaWRIb3Jpem9udGFsTGluZS5ib3JkZXJCb3R0b20iOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZC5wYWRkaW5nUmlnaHQiOiAiOHB4IiwKICAgICAgIndlZWsudGltZWdyaWQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZFNjaGVkdWxlLmJvcmRlclJhZGl1cyI6ICIycHgiLAogICAgICAid2Vlay50aW1lZ3JpZFNjaGVkdWxlLnBhZGRpbmdMZWZ0IjogIjJweCIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lLmNvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZS5mb250U2l6ZSI6ICIxMXB4IiwKICAgICAgIndlZWsuY3VycmVudFRpbWUuZm9udFdlaWdodCI6ICJub3JtYWwiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVQYXN0LmJvcmRlciI6ICIxcHggZGFzaGVkICM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVCdWxsZXQuYmFja2dyb3VuZENvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVUb2RheS5ib3JkZXIiOiAiMXB4IHNvbGlkICM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVGdXR1cmUuYm9yZGVyIjogIm5vbmUiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmNvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmZvbnRTaXplIjogIjExcHgiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmZvbnRXZWlnaHQiOiAiYm9sZCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5ib3JkZXJSYWRpdXMiOiAiMnB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLmhlaWdodCI6ICIyNHB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLm1hcmdpblRvcCI6ICIycHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUubWFyZ2luTGVmdCI6ICI4cHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUubWFyZ2luUmlnaHQiOiAiOHB4IgogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGUuZXhwb3J0cyA9IHsKICAgICAgImNvbW1vbi5ib3JkZXIiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAiY29tbW9uLmJhY2tncm91bmRDb2xvciI6ICJ3aGl0ZSIsCiAgICAgICJjb21tb24uaG9saWRheS5jb2xvciI6ICIjZmY0MDQwIiwKICAgICAgImNvbW1vbi5zYXR1cmRheS5jb2xvciI6ICIjMzMzIiwKICAgICAgImNvbW1vbi5kYXluYW1lLmNvbG9yIjogIiMzMzMiLAogICAgICAiY29tbW9uLnRvZGF5LmNvbG9yIjogIiMzMzMiLAogICAgICAiY29tbW9uLmNyZWF0aW9uR3VpZGUuYmFja2dyb3VuZENvbG9yIjogInJnYmEoODEsIDkyLCAyMzAsIDAuMDUpIiwKICAgICAgImNvbW1vbi5jcmVhdGlvbkd1aWRlLmJvcmRlciI6ICIxcHggc29saWQgIzUxNWNlNiIsCiAgICAgICJtb250aC5kYXluYW1lLmhlaWdodCI6ICIzMXB4IiwKICAgICAgIm1vbnRoLmRheW5hbWUuYm9yZGVyTGVmdCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJtb250aC5kYXluYW1lLnBhZGRpbmdMZWZ0IjogIjEwcHgiLAogICAgICAibW9udGguZGF5bmFtZS5wYWRkaW5nUmlnaHQiOiAiMTBweCIsCiAgICAgICJtb250aC5kYXluYW1lLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIm1vbnRoLmRheW5hbWUuZm9udFNpemUiOiAiMTJweCIsCiAgICAgICJtb250aC5kYXluYW1lLmZvbnRXZWlnaHQiOiAibm9ybWFsIiwKICAgICAgIm1vbnRoLmRheW5hbWUudGV4dEFsaWduIjogImxlZnQiLAogICAgICAibW9udGguaG9saWRheUV4Y2VwdFRoaXNNb250aC5jb2xvciI6ICJyZ2JhKDI1NSwgNjQsIDY0LCAwLjQpIiwKICAgICAgIm1vbnRoLmRheUV4Y2VwdFRoaXNNb250aC5jb2xvciI6ICJyZ2JhKDUxLCA1MSwgNTEsIDAuNCkiLAogICAgICAibW9udGgud2Vla2VuZC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJtb250aC5kYXkuZm9udFNpemUiOiAiMTRweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5ib3JkZXJSYWRpdXMiOiAiMnB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLmhlaWdodCI6ICIyNHB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCI6ICIycHgiLAogICAgICAibW9udGguc2NoZWR1bGUubWFyZ2luTGVmdCI6ICI4cHgiLAogICAgICAibW9udGguc2NoZWR1bGUubWFyZ2luUmlnaHQiOiAiOHB4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LmJvcmRlciI6ICIxcHggc29saWQgI2Q1ZDVkNSIsCiAgICAgICJtb250aC5tb3JlVmlldy5ib3hTaGFkb3ciOiAiMCAycHggNnB4IDAgcmdiYSgwLCAwLCAwLCAwLjEpIiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LmJhY2tncm91bmRDb2xvciI6ICJ3aGl0ZSIsCiAgICAgICJtb250aC5tb3JlVmlldy5wYWRkaW5nQm90dG9tIjogIjE3cHgiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5oZWlnaHQiOiAiNDRweCIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLm1hcmdpbkJvdHRvbSI6ICIxMnB4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5ib3JkZXJCb3R0b20iOiAibm9uZSIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLnBhZGRpbmciOiAiMTJweCAxN3B4IDAgMTdweCIsCiAgICAgICJtb250aC5tb3JlVmlld0xpc3QucGFkZGluZyI6ICIwIDE3cHgiLAogICAgICAid2Vlay5kYXluYW1lLmhlaWdodCI6ICI0MnB4IiwKICAgICAgIndlZWsuZGF5bmFtZS5ib3JkZXJUb3AiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay5kYXluYW1lLmJvcmRlckJvdHRvbSI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLmRheW5hbWUuYm9yZGVyTGVmdCI6ICJpbmhlcml0IiwKICAgICAgIndlZWsuZGF5bmFtZS5wYWRkaW5nTGVmdCI6ICIwIiwKICAgICAgIndlZWsuZGF5bmFtZS5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLmRheW5hbWUudGV4dEFsaWduIjogImxlZnQiLAogICAgICAid2Vlay50b2RheS5jb2xvciI6ICIjMzMzIiwKICAgICAgIndlZWsucGFzdERheS5jb2xvciI6ICIjYmJiIiwKICAgICAgIndlZWsudnBhbmVsU3BsaXR0ZXIuYm9yZGVyIjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsudnBhbmVsU3BsaXR0ZXIuaGVpZ2h0IjogIjNweCIsCiAgICAgICJ3ZWVrLmRheWdyaWQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay5kYXlncmlkLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQud2lkdGgiOiAiNzJweCIsCiAgICAgICJ3ZWVrLmRheWdyaWRMZWZ0LmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQucGFkZGluZ1JpZ2h0IjogIjhweCIsCiAgICAgICJ3ZWVrLmRheWdyaWRMZWZ0LmJvcmRlclJpZ2h0IjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsudG9kYXkuYmFja2dyb3VuZENvbG9yIjogInJnYmEoODEsIDkyLCAyMzAsIDAuMDUpIiwKICAgICAgIndlZWsud2Vla2VuZC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkTGVmdC53aWR0aCI6ICI3MnB4IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0LmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0LmJvcmRlclJpZ2h0IjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0LmZvbnRTaXplIjogIjExcHgiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnRUaW1lem9uZUxhYmVsLmhlaWdodCI6ICI0MHB4IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0QWRkaXRpb25hbFRpbWV6b25lLmJhY2tncm91bmRDb2xvciI6ICJ3aGl0ZSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkT25lSG91ci5oZWlnaHQiOiAiNTJweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkSGFsZkhvdXIuaGVpZ2h0IjogIjI2cHgiLAogICAgICAid2Vlay50aW1lZ3JpZEhhbGZIb3VyLmJvcmRlckJvdHRvbSI6ICJub25lIiwKICAgICAgIndlZWsudGltZWdyaWRIb3Jpem9udGFsTGluZS5ib3JkZXJCb3R0b20iOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZC5wYWRkaW5nUmlnaHQiOiAiOHB4IiwKICAgICAgIndlZWsudGltZWdyaWQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZFNjaGVkdWxlLmJvcmRlclJhZGl1cyI6ICIycHgiLAogICAgICAid2Vlay50aW1lZ3JpZFNjaGVkdWxlLnBhZGRpbmdMZWZ0IjogIjJweCIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lLmNvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZS5mb250U2l6ZSI6ICIxMXB4IiwKICAgICAgIndlZWsuY3VycmVudFRpbWUuZm9udFdlaWdodCI6ICJub3JtYWwiLAogICAgICAid2Vlay5wYXN0VGltZS5jb2xvciI6ICIjYmJiIiwKICAgICAgIndlZWsucGFzdFRpbWUuZm9udFdlaWdodCI6ICJub3JtYWwiLAogICAgICAid2Vlay5mdXR1cmVUaW1lLmNvbG9yIjogIiMzMzMiLAogICAgICAid2Vlay5mdXR1cmVUaW1lLmZvbnRXZWlnaHQiOiAibm9ybWFsIiwKICAgICAgIndlZWsuY3VycmVudFRpbWVMaW5lUGFzdC5ib3JkZXIiOiAiMXB4IGRhc2hlZCAjNTE1Y2U2IiwKICAgICAgIndlZWsuY3VycmVudFRpbWVMaW5lQnVsbGV0LmJhY2tncm91bmRDb2xvciI6ICIjNTE1Y2U2IiwKICAgICAgIndlZWsuY3VycmVudFRpbWVMaW5lVG9kYXkuYm9yZGVyIjogIjFweCBzb2xpZCAjNTE1Y2U2IiwKICAgICAgIndlZWsuY3VycmVudFRpbWVMaW5lRnV0dXJlLmJvcmRlciI6ICJub25lIiwKICAgICAgIndlZWsuY3JlYXRpb25HdWlkZS5jb2xvciI6ICIjNTE1Y2U2IiwKICAgICAgIndlZWsuY3JlYXRpb25HdWlkZS5mb250U2l6ZSI6ICIxMXB4IiwKICAgICAgIndlZWsuY3JlYXRpb25HdWlkZS5mb250V2VpZ2h0IjogImJvbGQiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUuYm9yZGVyUmFkaXVzIjogIjJweCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5oZWlnaHQiOiAiMjRweCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5tYXJnaW5Ub3AiOiAiMnB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLm1hcmdpbkxlZnQiOiAiOHB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLm1hcmdpblJpZ2h0IjogIjhweCIKICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IGwuZm9yRWFjaEFycmF5LAogICAgICAgIGkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oNCkuRGF0ZSwKICAgICAgICBzID0gbigxMyksCiAgICAgICAgYyA9IG4oMjgpLAogICAgICAgIHUgPSB7CiAgICAgIGdldENvbGxpc2lvbkdyb3VwOiBmdW5jdGlvbiBnZXRDb2xsaXNpb25Hcm91cChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4gPSBbXSwKICAgICAgICAgICAgYSA9ICExOwogICAgICAgIHJldHVybiBlLmxlbmd0aCA/IChuWzBdID0gW2wuc3RhbXAoZVswXS52YWx1ZU9mKCkpXSwgbyhlLnNsaWNlKDEpLCBmdW5jdGlvbiAociwgcykgewogICAgICAgICAgYSA9ICExLCB0ID0gaS5hcHBseShlLCBbMCwgcyArIDFdKS5yZXZlcnNlKCksIG8odCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuICFyLmNvbGxpZGVzV2l0aChlKSB8fCAoYSA9ICEwLCBvKG4uc2xpY2UoMCkucmV2ZXJzZSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiAhfmwuaW5BcnJheShsLnN0YW1wKGUudmFsdWVPZigpKSwgdCkgfHwgKHQucHVzaChsLnN0YW1wKHIudmFsdWVPZigpKSksICExKTsKICAgICAgICAgICAgfSksICExKTsKICAgICAgICAgIH0pLCBhIHx8IG4ucHVzaChbbC5zdGFtcChyLnZhbHVlT2YoKSldKTsKICAgICAgICB9KSwgbikgOiBuOwogICAgICB9LAogICAgICBnZXRMYXN0Um93SW5Db2x1bW46IGZ1bmN0aW9uIGdldExhc3RSb3dJbkNvbHVtbihlLCB0KSB7CiAgICAgICAgZm9yICh2YXIgbiA9IGUubGVuZ3RoOyBuID4gMDspIHsKICAgICAgICAgIGlmIChuIC09IDEsICFsLmlzVW5kZWZpbmVkKGVbbl1bdF0pKSByZXR1cm4gbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiAhMTsKICAgICAgfSwKICAgICAgZ2V0TWF0cmljZXM6IGZ1bmN0aW9uIGdldE1hdHJpY2VzKGUsIHQpIHsKICAgICAgICB2YXIgbiA9IFtdLAogICAgICAgICAgICBpID0gdS5nZXRMYXN0Um93SW5Db2x1bW47CiAgICAgICAgcmV0dXJuIG8odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBhID0gW1tdXTsKICAgICAgICAgIG8odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiwgbywgciA9IGUuaXRlbXNbdF0sIHMgPSAwLCBjID0gITE7ICFjOykgewogICAgICAgICAgICAgICExID09PSAobyA9IGkoYSwgcykpID8gKGFbMF0ucHVzaChyKSwgYyA9ICEwKSA6IHIuY29sbGlkZXNXaXRoKGFbb11bc10pIHx8IChuID0gbyArIDEsIGwuaXNVbmRlZmluZWQoYVtuXSkgJiYgKGFbbl0gPSBbXSksIGFbbl1bc10gPSByLCBjID0gITApLCBzICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLCBuLnB1c2goYSk7CiAgICAgICAgfSksIG47CiAgICAgIH0sCiAgICAgIGdldFNjaGVkdWxlSW5EYXRlUmFuZ2VGaWx0ZXI6IGZ1bmN0aW9uIGdldFNjaGVkdWxlSW5EYXRlUmFuZ2VGaWx0ZXIoZSwgdCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICAgICAgdmFyIGwgPSBuLmdldFN0YXJ0cygpOwogICAgICAgICAgcmV0dXJuICEobi5nZXRFbmRzKCkgPCBlIHx8IGwgPiB0KTsKICAgICAgICB9OwogICAgICB9LAogICAgICBwb3NpdGlvblZpZXdNb2RlbHM6IGZ1bmN0aW9uIHBvc2l0aW9uVmlld01vZGVscyhlLCB0LCBuLCBpKSB7CiAgICAgICAgdmFyIHIsIHM7CiAgICAgICAgciA9IGwubWFwKGEucmFuZ2UoZSwgdCwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gYS5mb3JtYXQoZSwgIllZWVlNTUREIik7CiAgICAgICAgfSksIG8obiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIG8oZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgbyhlLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICAgIHZhciBuLCBvOwogICAgICAgICAgICAgIGUgJiYgKG4gPSBhLmZvcm1hdChlLmdldFN0YXJ0cygpLCAiWVlZWU1NREQiKSwgcyA9IGUuaGFzTXVsdGlEYXRlcyA/IGEuZW5kKGUuZ2V0RW5kcygpKSA6IGEuY29udmVydFN0YXJ0RGF5VG9MYXN0RGF5KGUuZ2V0RW5kcygpKSwgbyA9IGEucmFuZ2UoYS5zdGFydChlLmdldFN0YXJ0cygpKSwgcywgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSkubGVuZ3RoLCBlLnRvcCA9IHQsIGUubGVmdCA9IGwuaW5BcnJheShuLCByKSwgZS53aWR0aCA9IG8sIGkgJiYgaShlKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGxpbWl0UmVuZGVyUmFuZ2U6IGZ1bmN0aW9uIGxpbWl0UmVuZGVyUmFuZ2UoZSwgdCwgbikgewogICAgICAgIGZ1bmN0aW9uIGwobikgewogICAgICAgICAgcmV0dXJuIG4uZ2V0U3RhcnRzKCkgPCBlICYmIChuLmV4Y2VlZExlZnQgPSAhMCwgbi5yZW5kZXJTdGFydHMgPSBuZXcgcihlKSksIG4uZ2V0RW5kcygpID4gdCAmJiAobi5leGNlZWRSaWdodCA9ICEwLCBuLnJlbmRlckVuZHMgPSBuZXcgcih0KSksIG47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbi5jb25zdHJ1Y3RvciA9PT0gcyA/IChuLmVhY2gobCksIG51bGwpIDogbChuKTsKICAgICAgfSwKICAgICAgY29udmVydFRvVmlld01vZGVsOiBmdW5jdGlvbiBjb252ZXJ0VG9WaWV3TW9kZWwoZSkgewogICAgICAgIHZhciB0OwogICAgICAgIHJldHVybiB0ID0gbmV3IHMoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmNpZCgpOwogICAgICAgIH0pLCBlLmVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHQuYWRkKGMuY3JlYXRlKGUpKTsKICAgICAgICB9KSwgdDsKICAgICAgfQogICAgfTsKICAgIGUuZXhwb3J0cyA9IHU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMTMpLAogICAgICAgIGkgPSBuKDE1KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBhLk1JTExJU0VDT05EU19TQ0hFRFVMRV9NSU5fRFVSQVRJT04sCiAgICAgICAgYyA9IHsKICAgICAgZ2VuZXJhdGVUaW1lQXJyYXlJblJvdzogZnVuY3Rpb24gZ2VuZXJhdGVUaW1lQXJyYXlJblJvdyhlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGMgPSBbXSwKICAgICAgICAgICAgdSA9IFtdLAogICAgICAgICAgICBkID0gTWF0aC5tYXguYXBwbHkobnVsbCwgbC5tYXAoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmxlbmd0aDsKICAgICAgICB9KSk7CgogICAgICAgIGZvciAobiA9IDE7IG4gPCBkOyBuICs9IDEpIHsKICAgICAgICAgIGZvciAodCA9IDAsIG8gPSBsLnBpY2soZSwgdCwgbik7IG87KSB7CiAgICAgICAgICAgIGkgPSBvLmdldFN0YXJ0cygpLmdldFRpbWUoKSAtIGEubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIG8udmFsdWVPZigpLmdvaW5nRHVyYXRpb24pLCByID0gby5nZXRFbmRzKCkuZ2V0VGltZSgpICsgYS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgby52YWx1ZU9mKCkuY29taW5nRHVyYXRpb24pLCBNYXRoLmFicyhyIC0gaSkgPCBzICYmIChyICs9IHMpLCB1LnB1c2goW2ksIHJdKSwgdCArPSAxLCBvID0gbC5waWNrKGUsIHQsIG4pOwogICAgICAgICAgfQoKICAgICAgICAgIGMucHVzaCh1KSwgdSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGM7CiAgICAgIH0sCiAgICAgIGhhc0NvbGxpZGU6IGZ1bmN0aW9uIGhhc0NvbGxpZGUoZSwgdCwgbikgewogICAgICAgIHZhciBsLAogICAgICAgICAgICBvLAogICAgICAgICAgICBhLAogICAgICAgICAgICByLAogICAgICAgICAgICBzID0gZnVuY3Rpb24gcyhlKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRbZV07CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgICAgIGMgPSBNYXRoLmFicywKICAgICAgICAgICAgdSA9IGkuY29tcGFyZS5udW0uYXNjOwoKICAgICAgICByZXR1cm4gISFlLmxlbmd0aCAmJiAobCA9IGMoaS5ic2VhcmNoKGUsIHQsIHMoMCksIHUpKSwgbyA9IGMoaS5ic2VhcmNoKGUsIHQsIHMoMSksIHUpKSwgYSA9IGMoaS5ic2VhcmNoKGUsIG4sIHMoMCksIHUpKSwgciA9IGMoaS5ic2VhcmNoKGUsIG4sIHMoMSksIHUpKSwgIShsID09PSBvICYmIG8gPT09IGEgJiYgYSA9PT0gcikpOwogICAgICB9LAogICAgICBnZXRDb2xsaWRlczogZnVuY3Rpb24gZ2V0Q29sbGlkZXMoZSkgewogICAgICAgIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCwgbjsKICAgICAgICAgIHQgPSBjLmdlbmVyYXRlVGltZUFycmF5SW5Sb3coZSksIG4gPSBNYXRoLm1heC5hcHBseShudWxsLCBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gZS5sZW5ndGg7CiAgICAgICAgICB9KSksIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlLCBsKSB7CiAgICAgICAgICAgICAgdmFyIG8sIGksIHI7CiAgICAgICAgICAgICAgaWYgKGUpIGZvciAobyA9IGUuZ2V0U3RhcnRzKCkuZ2V0VGltZSgpLCBpID0gZS5nZXRFbmRzKCkuZ2V0VGltZSgpLCBNYXRoLmFicyhpIC0gbykgPCBzICYmIChpICs9IHMpLCBvIC09IGEubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIGUudmFsdWVPZigpLmdvaW5nRHVyYXRpb24pLCBpICs9IGEubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIGUudmFsdWVPZigpLmNvbWluZ0R1cmF0aW9uKSwgaSAtPSAxLCByID0gbCArIDE7IHIgPCBuOyByICs9IDEpIHsKICAgICAgICAgICAgICAgIGlmIChjLmhhc0NvbGxpZGUodFtyIC0gMV0sIG8sIGkpKSB7CiAgICAgICAgICAgICAgICAgIGUuaGFzQ29sbGlkZSA9ICEwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlLmV4dHJhU3BhY2UgKz0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGdldFZpZXdNb2RlbEZvclRpbWVWaWV3OiBmdW5jdGlvbiBnZXRWaWV3TW9kZWxGb3JUaW1lVmlldyhlLCB0LCBuLCBvLCBpKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLAogICAgICAgICAgICByID0gdGhpcy5zcGxpdFNjaGVkdWxlQnlEYXRlUmFuZ2UoZSwgdCwgbiksCiAgICAgICAgICAgIHMgPSB7fSwKICAgICAgICAgICAgdSA9IGMuX21ha2VHZXRWaWV3TW9kZWxGdW5jRm9yVGltZVZpZXcobywgaSk7CgogICAgICAgIHJldHVybiBsLmZvckVhY2gociwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgbyA9IHUoZSk7CiAgICAgICAgICBuID0gYS5Db3JlLmdldENvbGxpc2lvbkdyb3VwKG8pLCBsID0gYS5Db3JlLmdldE1hdHJpY2VzKGUsIG4pLCBhLldlZWsuZ2V0Q29sbGlkZXMobCksIHNbdF0gPSBsOwogICAgICAgIH0pLCBzOwogICAgICB9LAogICAgICBfbWFrZUdldFZpZXdNb2RlbEZ1bmNGb3JUaW1lVmlldzogZnVuY3Rpb24gX21ha2VHZXRWaWV3TW9kZWxGdW5jRm9yVGltZVZpZXcoZSwgdCkgewogICAgICAgIHJldHVybiAwID09PSBlICYmIDI0ID09PSB0ID8gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLnNvcnQoaS5jb21wYXJlLnNjaGVkdWxlLmFzYyk7CiAgICAgICAgfSA6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICByZXR1cm4gbi5maW5kKGMuX21ha2VIb3VyUmFuZ2VGaWx0ZXIoZSwgdCkpLnNvcnQoaS5jb21wYXJlLnNjaGVkdWxlLmFzYyk7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgX21ha2VIb3VyUmFuZ2VGaWx0ZXI6IGZ1bmN0aW9uIF9tYWtlSG91clJhbmdlRmlsdGVyKGUsIHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBsID0gbi5tb2RlbC5zdGFydCwKICAgICAgICAgICAgICBvID0gbi5tb2RlbC5lbmQsCiAgICAgICAgICAgICAgaSA9IGwuZ2V0RnVsbFllYXIoKSwKICAgICAgICAgICAgICBhID0gbC5nZXRNb250aCgpLAogICAgICAgICAgICAgIHMgPSBsLmdldERhdGUoKSwKICAgICAgICAgICAgICBjID0gbmV3IHIoaSwgYSwgcykuc2V0SG91cnMoZSksCiAgICAgICAgICAgICAgdSA9IG5ldyByKGksIGEsIHMpLnNldEhvdXJzKHQpOwogICAgICAgICAgcmV0dXJuIGwgPj0gYyAmJiBsIDwgdSB8fCBvID4gYyAmJiBvIDw9IHUgfHwgbCA8IGMgJiYgbyA+IGMgfHwgbyA+IHUgJiYgbCA8IHU7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgX2FkZE11bHRpRGF0ZXNJbmZvOiBmdW5jdGlvbiBfYWRkTXVsdGlEYXRlc0luZm8oZSkgewogICAgICAgIGUuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQgPSBlLm1vZGVsOwogICAgICAgICAgZS5oYXNNdWx0aURhdGVzID0gITAsIGUucmVuZGVyU3RhcnRzID0gYS5zdGFydCh0LmdldFN0YXJ0cygpKSwgZS5yZW5kZXJFbmRzID0gYS5jb252ZXJ0U3RhcnREYXlUb0xhc3REYXkodC5nZXRFbmRzKCkpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRWaWV3TW9kZWxGb3JBbGxkYXlWaWV3OiBmdW5jdGlvbiBnZXRWaWV3TW9kZWxGb3JBbGxkYXlWaWV3KGUsIHQsIG4pIHsKICAgICAgICB2YXIgbCwKICAgICAgICAgICAgbywKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IHRoaXMuQ29yZSwKICAgICAgICAgICAgcyA9IHRoaXMuV2VlazsKICAgICAgICByZXR1cm4gbiAmJiBuLmxlbmd0aCA/IChzLl9hZGRNdWx0aURhdGVzSW5mbyhuKSwgci5saW1pdFJlbmRlclJhbmdlKGUsIHQsIG4pLCBsID0gbi5zb3J0KGkuY29tcGFyZS5zY2hlZHVsZS5hc2MpLCBvID0gci5nZXRDb2xsaXNpb25Hcm91cChsKSwgYSA9IHIuZ2V0TWF0cmljZXMobiwgbyksIHIucG9zaXRpb25WaWV3TW9kZWxzKGUsIHQsIGEpLCBhKSA6IFtdOwogICAgICB9LAogICAgICBmaW5kQnlEYXRlUmFuZ2U6IGZ1bmN0aW9uIGZpbmRCeURhdGVSYW5nZShlLCB0LCBuLCBpLCBhKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIGMgPSB0aGlzLkNvcmUsCiAgICAgICAgICAgIHUgPSB0aGlzLldlZWssCiAgICAgICAgICAgIGQgPSBjLmdldFNjaGVkdWxlSW5EYXRlUmFuZ2VGaWx0ZXIoZSwgdCksCiAgICAgICAgICAgIGggPSBsLnBsdWNrKG4sICJuYW1lIiksCiAgICAgICAgICAgIHAgPSBsLnBpY2soYSwgImhvdXJTdGFydCIpLAogICAgICAgICAgICBtID0gbC5waWNrKGEsICJob3VyRW5kIik7CiAgICAgICAgcmV0dXJuIGkgPSBpIHx8IFtdLCBkID0gby5hbmQuYXBwbHkobnVsbCwgW2RdLmNvbmNhdChpKSksIHIgPSB0aGlzLnNjaGVkdWxlcy5maW5kKGQpLCByID0gYy5jb252ZXJ0VG9WaWV3TW9kZWwociksIHMgPSByLmdyb3VwQnkoaCwgdGhpcy5ncm91cEZ1bmMpLCBsLmZvckVhY2gobiwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBsID0gbi5uYW1lOwogICAgICAgICAgImRheWdyaWQiID09PSBuLnR5cGUgPyBzW2xdID0gdS5nZXRWaWV3TW9kZWxGb3JBbGxkYXlWaWV3KGUsIHQsIHNbbF0pIDogInRpbWVncmlkIiA9PT0gbi50eXBlICYmIChzW2xdID0gdS5nZXRWaWV3TW9kZWxGb3JUaW1lVmlldyhlLCB0LCBzW2xdLCBwLCBtKSk7CiAgICAgICAgfSksIHM7CiAgICAgIH0sCiAgICAgIGdldEV4Y2VlZERhdGU6IGZ1bmN0aW9uIGdldEV4Y2VlZERhdGUoZSwgdCwgbikgewogICAgICAgIHZhciBvID0ge307CiAgICAgICAgcmV0dXJuIGwuZm9yRWFjaChuLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQgPSBhLmZvcm1hdChlLCAiWVlZWU1NREQiKTsKICAgICAgICAgIG9bdF0gPSAwOwogICAgICAgIH0pLCBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgbjsKICAgICAgICAgICAgICAhdCB8fCB0LnRvcCA8IGUgfHwgKG4gPSBhLnJhbmdlKHQuZ2V0U3RhcnRzKCksIHQuZ2V0RW5kcygpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwgbC5mb3JFYWNoKG4sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGEuZm9ybWF0KGUsICJZWVlZTU1ERCIpOwogICAgICAgICAgICAgICAgb1t0XSArPSAxOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSwgbzsKICAgICAgfSwKICAgICAgZXhjbHVkZUV4Y2VlZFNjaGVkdWxlczogZnVuY3Rpb24gZXhjbHVkZUV4Y2VlZFNjaGVkdWxlcyhlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUubWFwKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZS5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGUubGVuZ3RoID4gdCA/IGUuZmlsdGVyKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUudG9wIDwgdDsKICAgICAgICAgICAgfSwgdGhpcykgOiBlOwogICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KICAgIH07CiAgICBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDE1KSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbigxMyksCiAgICAgICAgciA9IE1hdGgubWF4LAogICAgICAgIHMgPSB7CiAgICAgIF9vbmx5VGltZUZpbHRlcjogZnVuY3Rpb24gX29ubHlUaW1lRmlsdGVyKGUpIHsKICAgICAgICByZXR1cm4gIWUubW9kZWwuaXNBbGxEYXkgJiYgIWUuaGFzTXVsdGlEYXRlczsKICAgICAgfSwKICAgICAgX29ubHlBbGxkYXlGaWx0ZXI6IGZ1bmN0aW9uIF9vbmx5QWxsZGF5RmlsdGVyKGUpIHsKICAgICAgICByZXR1cm4gZS5tb2RlbC5pc0FsbERheSB8fCBlLmhhc011bHRpRGF0ZXM7CiAgICAgIH0sCiAgICAgIF93ZWlnaHRUb3BWYWx1ZTogZnVuY3Rpb24gX3dlaWdodFRvcFZhbHVlKGUpIHsKICAgICAgICBlLnRvcCA9IGUudG9wIHx8IDAsIGUudG9wICs9IDE7CiAgICAgIH0sCiAgICAgIF9hZGp1c3RSZW5kZXJSYW5nZTogZnVuY3Rpb24gX2FkanVzdFJlbmRlclJhbmdlKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbCA9IHRoaXMuQ29yZTsKICAgICAgICBuLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIChuLm1vZGVsLmlzQWxsRGF5IHx8IG4uaGFzTXVsdGlEYXRlcykgJiYgbC5saW1pdFJlbmRlclJhbmdlKGUsIHQsIG4pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBfZ2V0QWxsZGF5TWF4VG9wSW5kZXhBdFlNRDogZnVuY3Rpb24gX2dldEFsbGRheU1heFRvcEluZGV4QXRZTUQoZSwgdCkgewogICAgICAgIHZhciBuID0gdGhpcy5kYXRlTWF0cml4LAogICAgICAgICAgICBvID0gW107CiAgICAgICAgcmV0dXJuIGwuZm9yRWFjaChuW2VdLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdC5kb1doZW5IYXMoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgby5wdXNoKGUudG9wKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBvLmxlbmd0aCA+IDAgPyByLmFwcGx5KG51bGwsIG8pIDogMDsKICAgICAgfSwKICAgICAgX2FkanVzdFRpbWVUb3BJbmRleDogZnVuY3Rpb24gX2FkanVzdFRpbWVUb3BJbmRleChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLk1vbnRoLAogICAgICAgICAgICBuID0gdC5fZ2V0QWxsZGF5TWF4VG9wSW5kZXhBdFlNRCwKICAgICAgICAgICAgYSA9IGUuZmluZCh0Ll9vbmx5QWxsZGF5RmlsdGVyKSwKICAgICAgICAgICAgciA9IGUuZmluZCh0Ll9vbmx5VGltZUZpbHRlcikuc29ydChvLmNvbXBhcmUuc2NoZWR1bGUuYXNjKSwKICAgICAgICAgICAgcyA9IHt9OwogICAgICAgIHIuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQgPSBpLmZvcm1hdChlLmdldFN0YXJ0cygpLCAiWVlZWU1NREQiKSwKICAgICAgICAgICAgICBvID0gc1t0XTsKICAgICAgICAgIGwuaXNVbmRlZmluZWQobykgJiYgKG8gPSBzW3RdID0gbih0LCBhKSksIHNbdF0gPSBlLnRvcCA9IG8gKyAxOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBfc3RhY2tUaW1lRnJvbVRvcDogZnVuY3Rpb24gX3N0YWNrVGltZUZyb21Ub3AoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5Nb250aCwKICAgICAgICAgICAgbiA9IGUuZmluZCh0Ll9vbmx5QWxsZGF5RmlsdGVyKSwKICAgICAgICAgICAgYSA9IGUuZmluZCh0Ll9vbmx5VGltZUZpbHRlcikuc29ydChvLmNvbXBhcmUuc2NoZWR1bGUuYXNjKSwKICAgICAgICAgICAgcyA9IHt9LAogICAgICAgICAgICBjID0gdGhpcy5kYXRlTWF0cml4OwogICAgICAgIGEuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQsCiAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICBhID0gaS5mb3JtYXQoZS5nZXRTdGFydHMoKSwgIllZWVlNTUREIiksCiAgICAgICAgICAgICAgdSA9IHNbYV07CiAgICAgICAgICBpZiAobC5pc1VuZGVmaW5lZCh1KSAmJiAodSA9IHNbYV0gPSBbXSwgbC5mb3JFYWNoKGNbYV0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIG4uZG9XaGVuSGFzKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdS5wdXNoKGUudG9wKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSksIGwuaW5BcnJheShlLnRvcCwgdSkgPj0gMCkgZm9yICh0ID0gci5hcHBseShudWxsLCB1KSArIDEsIG8gPSAxOyBvIDw9IHQgJiYgKGUudG9wID0gbywgIShsLmluQXJyYXkoZS50b3AsIHUpIDwgMCkpOyBvICs9IDEpIHsKICAgICAgICAgICAgOwogICAgICAgICAgfQogICAgICAgICAgdS5wdXNoKGUudG9wKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgX2FkZE11bHRpRGF0ZXNJbmZvOiBmdW5jdGlvbiBfYWRkTXVsdGlEYXRlc0luZm8oZSkgewogICAgICAgIGUuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQgPSBlLm1vZGVsLAogICAgICAgICAgICAgIG4gPSB0LmdldFN0YXJ0cygpLAogICAgICAgICAgICAgIGwgPSB0LmdldEVuZHMoKTsKICAgICAgICAgIGUuaGFzTXVsdGlEYXRlcyA9IGkuaGFzTXVsdGlEYXRlcyhuLCBsKSwgIXQuaXNBbGxEYXkgJiYgZS5oYXNNdWx0aURhdGVzICYmIChlLnJlbmRlclN0YXJ0cyA9IGkuc3RhcnQobiksIGUucmVuZGVyRW5kcyA9IGkuY29udmVydFN0YXJ0RGF5VG9MYXN0RGF5KGwpKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZmluZEJ5RGF0ZVJhbmdlOiBmdW5jdGlvbiBmaW5kQnlEYXRlUmFuZ2UoZSwgdCwgbiwgbCkgewogICAgICAgIHZhciBpLAogICAgICAgICAgICByLAogICAgICAgICAgICBzLAogICAgICAgICAgICBjLAogICAgICAgICAgICB1LAogICAgICAgICAgICBkID0gdGhpcy5Db3JlLAogICAgICAgICAgICBoID0gdGhpcy5Nb250aCwKICAgICAgICAgICAgcCA9IGQuZ2V0U2NoZWR1bGVJbkRhdGVSYW5nZUZpbHRlcihlLCB0KTsKICAgICAgICByZXR1cm4gbCA9IGwgfHwgITEsIG4gPSBuIHx8IFtdLCBwID0gYS5hbmQuYXBwbHkobnVsbCwgW3BdLmNvbmNhdChuKSksIGkgPSB0aGlzLnNjaGVkdWxlcy5maW5kKHApLCByID0gZC5jb252ZXJ0VG9WaWV3TW9kZWwoaSksIGguX2FkZE11bHRpRGF0ZXNJbmZvKHIpLCBoLl9hZGp1c3RSZW5kZXJSYW5nZShlLCB0LCByKSwgcyA9IHIuc29ydChvLmNvbXBhcmUuc2NoZWR1bGUuYXNjKSwgYyA9IGQuZ2V0Q29sbGlzaW9uR3JvdXAocyksIHUgPSBkLmdldE1hdHJpY2VzKHIsIGMpLCBkLnBvc2l0aW9uVmlld01vZGVscyhlLCB0LCB1LCBoLl93ZWlnaHRUb3BWYWx1ZSksIGwgPyBoLl9hZGp1c3RUaW1lVG9wSW5kZXgocikgOiBoLl9zdGFja1RpbWVGcm9tVG9wKHIpLCB1OwogICAgICB9CiAgICB9OwogICAgZS5leHBvcnRzID0gczsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbig1KSwKICAgICAgICByID0gbigyOSksCiAgICAgICAgcyA9IG4oMTEpLAogICAgICAgIGMgPSBuKDE0KSwKICAgICAgICB1ID0gbig2NSksCiAgICAgICAgZCA9IG4oNjYpLAogICAgICAgIGggPSBuKDY4KSwKICAgICAgICBwID0gbig3MiksCiAgICAgICAgbSA9IG4oMzIpLAogICAgICAgIGYgPSBuKDMzKSwKICAgICAgICBnID0gbig4MiksCiAgICAgICAgeSA9IG4oODMpLAogICAgICAgIFMgPSBuKDg1KSwKICAgICAgICBfID0gbigzNCksCiAgICAgICAgQyA9IG4oODcpLAogICAgICAgIHYgPSBuKDg5KSwKICAgICAgICBFID0gbig5MCksCiAgICAgICAgdyA9IG4oOTIpLAogICAgICAgIFAgPSBuKDk1KSwKICAgICAgICBrID0gewogICAgICBjbGljazogeSwKICAgICAgY3JlYXRpb246IFMsCiAgICAgIG1vdmU6IF8sCiAgICAgIHJlc2l6ZTogQwogICAgfSwKICAgICAgICBSID0gewogICAgICBjbGljazogdiwKICAgICAgY3JlYXRpb246IEUsCiAgICAgIG1vdmU6IHcsCiAgICAgIHJlc2l6ZTogUAogICAgfSwKICAgICAgICBJID0gW3sKICAgICAgbmFtZTogIm1pbGVzdG9uZSIsCiAgICAgIHR5cGU6ICJkYXlncmlkIiwKICAgICAgbWluSGVpZ2h0OiAyMCwKICAgICAgbWF4SGVpZ2h0OiA4MCwKICAgICAgc2hvd0V4cGFuZGFibGVCdXR0b246ICEwLAogICAgICBtYXhFeHBhbmRhYmxlSGVpZ2h0OiAyMTAsCiAgICAgIGhhbmRsZXJzOiBbImNsaWNrIl0sCiAgICAgIHNob3c6ICEwCiAgICB9LCB7CiAgICAgIG5hbWU6ICJ0YXNrIiwKICAgICAgdHlwZTogImRheWdyaWQiLAogICAgICBtaW5IZWlnaHQ6IDQwLAogICAgICBtYXhIZWlnaHQ6IDEyMCwKICAgICAgc2hvd0V4cGFuZGFibGVCdXR0b246ICEwLAogICAgICBtYXhFeHBhbmRhYmxlSGVpZ2h0OiAyMTAsCiAgICAgIGhhbmRsZXJzOiBbImNsaWNrIiwgIm1vdmUiXSwKICAgICAgc2hvdzogITAKICAgIH0sIHsKICAgICAgbmFtZTogImFsbGRheSIsCiAgICAgIHR5cGU6ICJkYXlncmlkIiwKICAgICAgbWluSGVpZ2h0OiAzMCwKICAgICAgbWF4SGVpZ2h0OiA4MCwKICAgICAgc2hvd0V4cGFuZGFibGVCdXR0b246ICEwLAogICAgICBtYXhFeHBhbmRhYmxlSGVpZ2h0OiAyMTAsCiAgICAgIGhhbmRsZXJzOiBbImNsaWNrIiwgImNyZWF0aW9uIiwgIm1vdmUiLCAicmVzaXplIl0sCiAgICAgIHNob3c6ICEwCiAgICB9LCB7CiAgICAgIG5hbWU6ICJ0aW1lIiwKICAgICAgdHlwZTogInRpbWVncmlkIiwKICAgICAgYXV0b0hlaWdodDogITAsCiAgICAgIGhhbmRsZXJzOiBbImNsaWNrIiwgImNyZWF0aW9uIiwgIm1vdmUiLCAicmVzaXplIl0sCiAgICAgIHNob3c6ICEwCiAgICB9XTsKCiAgICBlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZSwgdCwgbiwgeSwgUykgewogICAgICB2YXIgXywKICAgICAgICAgIEMsCiAgICAgICAgICB2LAogICAgICAgICAgRSwKICAgICAgICAgIHcsCiAgICAgICAgICBQLAogICAgICAgICAgYiwKICAgICAgICAgIEQsCiAgICAgICAgICBGLAogICAgICAgICAgeCwKICAgICAgICAgIFgsCiAgICAgICAgICBNLAogICAgICAgICAgTywKICAgICAgICAgIFQsCiAgICAgICAgICBIID0gW10sCiAgICAgICAgICBMID0gW10sCiAgICAgICAgICBCID0geS50YXNrVmlldywKICAgICAgICAgIEEgPSB5LnNjaGVkdWxlVmlldywKICAgICAgICAgIFYgPSB7CiAgICAgICAgbWlsZXN0b25lOiBsLmlzQXJyYXkoQikgPyBsLmluQXJyYXkoIm1pbGVzdG9uZSIsIEIpID49IDAgOiBCLAogICAgICAgIHRhc2s6IGwuaXNBcnJheShCKSA/IGwuaW5BcnJheSgidGFzayIsIEIpID49IDAgOiBCLAogICAgICAgIGFsbGRheTogbC5pc0FycmF5KEEpID8gbC5pbkFycmF5KCJhbGxkYXkiLCBBKSA+PSAwIDogQSwKICAgICAgICB0aW1lOiBsLmlzQXJyYXkoQSkgPyBsLmluQXJyYXkoInRpbWUiLCBBKSA+PSAwIDogQQogICAgICB9OwoKICAgICAgcmV0dXJuIGwuZm9yRWFjaChJLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gZS5uYW1lOwogICAgICAgIGUgPSBsLmV4dGVuZCh7fSwgZSksIEgucHVzaChlKSwgZS5zaG93ID0gVlt0XSwgZS5zaG93ICYmIChMLmxlbmd0aCAmJiBMLnB1c2goewogICAgICAgICAgaXNTcGxpdHRlcjogITAKICAgICAgICB9KSwgTC5wdXNoKGwuZXh0ZW5kKHt9LCBlKSkpOwogICAgICB9KSwgTC5sZW5ndGggJiYgKChGID0gTFtMLmxlbmd0aCAtIDFdKS5hdXRvSGVpZ2h0ID0gITAsIEYubWF4SGVpZ2h0ID0gbnVsbCwgRi5zaG93RXhwYW5kYWJsZUJ1dHRvbiA9ICExLCBsLmZvckVhY2goSCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZS5uYW1lICE9PSBGLm5hbWUgfHwgKGUuc2hvd0V4cGFuZGFibGVCdXR0b24gPSAhMSwgITEpOwogICAgICB9KSksIGwuZXh0ZW5kKHkud2VlaywgewogICAgICAgIHBhbmVsczogSAogICAgICB9KSwgKF8gPSBuZXcgdShudWxsLCB5LndlZWssIHQsIEgsIFMpKS5oYW5kbGVyID0gewogICAgICAgIGNsaWNrOiB7fSwKICAgICAgICBkYXluYW1lOiB7fSwKICAgICAgICBjcmVhdGlvbjoge30sCiAgICAgICAgbW92ZToge30sCiAgICAgICAgcmVzaXplOiB7fQogICAgICB9LCBDID0gaS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgXy5jb250YWluZXIsIG8uY2xhc3NuYW1lKCJkYXluYW1lLWxheW91dCIpKSwgdiA9IG5ldyBkKHksIEMsIGUudGhlbWUpLCBfLmhhbmRsZXIuZGF5bmFtZS5kYXRlID0gbmV3IGcobiwgdiwgZSksIF8uYWRkQ2hpbGQodiksIChFID0gaS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgXy5jb250YWluZXIsIG8uY2xhc3NuYW1lKCJ2bGF5b3V0LWFyZWEiKSkpLnN0eWxlLmhlaWdodCA9IGkuZ2V0U2l6ZShfLmNvbnRhaW5lcilbMV0gLSB2LmNvbnRhaW5lci5vZmZzZXRIZWlnaHQgKyAicHgiLCB3ID0gbmV3IHIoewogICAgICAgIHBhbmVsczogTCwKICAgICAgICBwYW5lbEhlaWdodHM6IHkud2Vlay5wYW5lbEhlaWdodHMgfHwgW10KICAgICAgfSwgRSwgZS50aGVtZSksIF8udkxheW91dCA9IHcsIGwuZm9yRWFjaChILCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBvLAogICAgICAgICAgICBpID0gdC5uYW1lLAogICAgICAgICAgICBhID0gdC5oYW5kbGVyczsKICAgICAgICB0LnNob3cgJiYgKCJkYXlncmlkIiA9PT0gdC50eXBlID8gKChvID0gbmV3IGgoaSwgeSwgdy5nZXRQYW5lbEJ5TmFtZSh0Lm5hbWUpLmNvbnRhaW5lciwgZS50aGVtZSkpLm9uKCJhZnRlclJlbmRlciIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB3LmdldFBhbmVsQnlOYW1lKGkpLnNldEhlaWdodChudWxsLCBlLmhlaWdodCk7CiAgICAgICAgfSksIF8uYWRkQ2hpbGQobyksIGwuZm9yRWFjaChhLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgeS5pc1JlYWRPbmx5ICYmICJjbGljayIgIT09IHQgfHwgKF8uaGFuZGxlclt0XVtpXSA9IG5ldyBrW3RdKG4sIG8sIGUsIHkpLCBvLmFkZEhhbmRsZXIodCwgXy5oYW5kbGVyW3RdW2ldLCB3LmdldFBhbmVsQnlOYW1lKGkpKSk7CiAgICAgICAgfSkpIDogInRpbWVncmlkIiA9PT0gdC50eXBlICYmIChvID0gbmV3IHAoaSwgeSwgdy5nZXRQYW5lbEJ5TmFtZShpKS5jb250YWluZXIsIFMpLCBfLmFkZENoaWxkKG8pLCBsLmZvckVhY2goYSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHkuaXNSZWFkT25seSAmJiAiY2xpY2siICE9PSB0IHx8IChfLmhhbmRsZXJbdF1baV0gPSBuZXcgUlt0XShuLCBvLCBlLCB5KSk7CiAgICAgICAgfSksIG8ub24oImNsaWNrVGltZXpvbmVzQ29sbGFwc2VkQnRuIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGUgPSAhXy5zdGF0ZS50aW1lem9uZXNDb2xsYXBzZWQ7CiAgICAgICAgICBfLnNldFN0YXRlKHsKICAgICAgICAgICAgdGltZXpvbmVzQ29sbGFwc2VkOiBlCiAgICAgICAgICB9KSwgcy5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgXy5pbnZva2UoImNsaWNrVGltZXpvbmVzQ29sbGFwc2VCdG4iLCBlKSB8fCBfLnJlbmRlcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkpKTsKICAgICAgfSksIHcub24oInJlc2l6ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBzLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgXy5yZW5kZXIoKTsKICAgICAgICB9KTsKICAgICAgfSksIHkudXNlQ3JlYXRpb25Qb3B1cCAmJiAoUCA9IG5ldyBtKHQsIGUuY2FsZW5kYXJzLCB5LnVzYWdlU3RhdGlzdGljcyksIGIgPSBmdW5jdGlvbiBiKGUpIHsKICAgICAgICBsLmV4dGVuZChlLCB7CiAgICAgICAgICB1c2VDcmVhdGlvblBvcHVwOiAhMAogICAgICAgIH0pLCBlLmlzQWxsRGF5ID8gXy5oYW5kbGVyLmNyZWF0aW9uLmFsbGRheS5maXJlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGUpIDogXy5oYW5kbGVyLmNyZWF0aW9uLnRpbWUuZmlyZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCBlKTsKICAgICAgfSwgUC5vbigiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCBiKSksIEQgPSBmdW5jdGlvbiBEKGUpIHsKICAgICAgICBQICYmIFAuc2V0Q2FsZW5kYXJzKGUpOwogICAgICB9LCBlLm9uKCJzZXRDYWxlbmRhcnMiLCBEKSwgeS51c2VEZXRhaWxQb3B1cCAmJiAoeCA9IG5ldyBmKHQsIGUuY2FsZW5kYXJzKSwgWCA9IGZ1bmN0aW9uIFgodCkgewogICAgICAgIHZhciBuID0gdC5zY2hlZHVsZS5jYWxlbmRhcklkOwogICAgICAgIHQuY2FsZW5kYXIgPSBhLmZpbmQoZS5jYWxlbmRhcnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZS5pZCA9PT0gbjsKICAgICAgICB9KSwgeS5pc1JlYWRPbmx5ICYmICh0LnNjaGVkdWxlID0gbC5leHRlbmQoe30sIHQuc2NoZWR1bGUsIHsKICAgICAgICAgIGlzUmVhZE9ubHk6ICEwCiAgICAgICAgfSkpLCB4LnJlbmRlcih0KTsKICAgICAgfSwgTSA9IGZ1bmN0aW9uIE0oZSkgewogICAgICAgIGUuaXNBbGxEYXkgPyBfLmhhbmRsZXIuY3JlYXRpb24uYWxsZGF5LmZpcmUoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgZSkgOiBfLmhhbmRsZXIuY3JlYXRpb24udGltZS5maXJlKCJiZWZvcmVEZWxldGVTY2hlZHVsZSIsIGUpOwogICAgICB9LCBUID0gZnVuY3Rpb24gVChlKSB7CiAgICAgICAgZS5pc0FsbERheSA/IF8uaGFuZGxlci5tb3ZlLmFsbGRheS5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGUpIDogXy5oYW5kbGVyLm1vdmUudGltZS5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGUpOwogICAgICB9LCBsLmZvckVhY2goXy5oYW5kbGVyLmNsaWNrLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGUub24oImNsaWNrU2NoZWR1bGUiLCBYKTsKICAgICAgfSksIHkudXNlQ3JlYXRpb25Qb3B1cCA/IChPID0gZnVuY3Rpb24gTyh0KSB7CiAgICAgICAgdmFyIG4gPSBlLmNhbGVuZGFyczsKICAgICAgICB0LmlzRWRpdE1vZGUgPSAhMCwgUC5zZXRDYWxlbmRhcnMobiksIFAucmVuZGVyKHQpOwogICAgICB9LCBQLm9uKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIFQpLCB4Lm9uKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIE8pKSA6IHgub24oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgVCksIHgub24oImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgTSkpLCBfLm9uKCJhZnRlclJlbmRlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB3LnJlZnJlc2goKTsKICAgICAgfSksIF8uY29udHJvbGxlciA9IGUuV2VlaywgXy5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBsLmZvckVhY2goXy5oYW5kbGVyLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUub2ZmKCksIGUuZGVzdHJveSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIHkudXNlQ3JlYXRpb25Qb3B1cCAmJiAoUC5vZmYoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgYiksIFAuZGVzdHJveSgpKSwgeS51c2VEZXRhaWxQb3B1cCAmJiAoeC5vZmYoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgTSksIHguZGVzdHJveSgpKSwgXy5vZmYoKTsKICAgICAgfSwgewogICAgICAgIHZpZXc6IF8sCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgICAgIHZhciBlID0gXy5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsCiAgICAgICAgICAgICAgdCA9IGkuZ2V0QkNSZWN0KHYuY29udGFpbmVyKS5oZWlnaHQ7CgogICAgICAgICAgdy5jb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gZSAtIHQgKyAicHgiLCB3LnJlZnJlc2goKTsKICAgICAgICB9LAogICAgICAgIHNjcm9sbFRvTm93OiBmdW5jdGlvbiBzY3JvbGxUb05vdygpIHsKICAgICAgICAgIF8uY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlLnNjcm9sbFRvTm93ICYmIGUuc2Nyb2xsVG9Ob3coKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb3BlbkNyZWF0aW9uUG9wdXA6IGZ1bmN0aW9uIG9wZW5DcmVhdGlvblBvcHVwKGUpIHsKICAgICAgICAgIFAgJiYgKGUuaXNBbGxEYXkgPyBfLmhhbmRsZXIuY3JlYXRpb24uYWxsZGF5Lmludm9rZUNyZWF0aW9uQ2xpY2soYy5jcmVhdGUoZSkpIDogXy5oYW5kbGVyLmNyZWF0aW9uLnRpbWUuaW52b2tlQ3JlYXRpb25DbGljayhjLmNyZWF0ZShlKSkpOwogICAgICAgIH0sCiAgICAgICAgc2hvd0NyZWF0aW9uUG9wdXA6IGZ1bmN0aW9uIHNob3dDcmVhdGlvblBvcHVwKHQpIHsKICAgICAgICAgIFAgJiYgKFAuc2V0Q2FsZW5kYXJzKGUuY2FsZW5kYXJzKSwgUC5yZW5kZXIodCkpOwogICAgICAgIH0KICAgICAgfTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oNSksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oOCk7CgogICAgZnVuY3Rpb24gcyhlLCB0LCBuKSB7CiAgICAgIHIuY2FsbCh0aGlzLCB0KSwgdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIGluZGV4OiAwLAogICAgICAgIG5hbWU6ICIwIiwKICAgICAgICBtaW5IZWlnaHQ6IDAsCiAgICAgICAgbWF4SGVpZ2h0OiBudWxsLAogICAgICAgIGhlaWdodDogbnVsbCwKICAgICAgICBpc1NwbGl0dGVyOiAhMSwKICAgICAgICBhdXRvSGVpZ2h0OiAhMSwKICAgICAgICBjbGFzc05hbWU6ICIiCiAgICAgIH0sIGUpLCB0aGlzLmluZGV4ID0gdGhpcy5vcHRpb25zLmluZGV4LCB0aGlzLm5hbWUgPSB0aGlzLm9wdGlvbnMubmFtZSB8fCBTdHJpbmcodGhpcy5pbmRleCksIHRoaXMuaXNIZWlnaHRGb3JjZWRTZXQgPSAhMSwgdGhpcy50aGVtZSA9IG4sIHRoaXMuX2luaXRQYW5lbCh0aGlzLm9wdGlvbnMsIHQpOwogICAgfQoKICAgIGwuaW5oZXJpdChzLCByKSwgcy5wcm90b3R5cGUuaXNTcGxpdHRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pc1NwbGl0dGVyOwogICAgfSwgcy5wcm90b3R5cGUuc2V0TWF4SGVpZ2h0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5vcHRpb25zLmF1dG9IZWlnaHQgfHwgKHRoaXMub3B0aW9ucy5tYXhIZWlnaHQgPSBlKTsKICAgIH0sIHMucHJvdG90eXBlLnNldEhlaWdodEZvcmNlZFNldCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuaXNIZWlnaHRGb3JjZWRTZXQgPSBlOwogICAgfSwgcy5wcm90b3R5cGUuZ2V0SGVpZ2h0Rm9yY2VkU2V0ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5pc0hlaWdodEZvcmNlZFNldDsKICAgIH0sIHMucHJvdG90eXBlLnNldEhlaWdodCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsID0gdGhpcy5vcHRpb25zLm1heEhlaWdodCwKICAgICAgICAgIG8gPSB0aGlzLm9wdGlvbnMubWluSGVpZ2h0LAogICAgICAgICAgaSA9IHRoaXMub3B0aW9ucy5hdXRvSGVpZ2h0OwogICAgICBlID0gZSB8fCB0aGlzLmNvbnRhaW5lciwgKG4gfHwgIXRoaXMuaXNIZWlnaHRGb3JjZWRTZXQgfHwgaSkgJiYgKG4gPyB0aGlzLmlzSGVpZ2h0Rm9yY2VkU2V0ID0gITAgOiBsICYmICh0ID0gTWF0aC5taW4odCwgbCkpLCB0ID0gTWF0aC5tYXgobywgdCksIGUuc3R5bGUuaGVpZ2h0ID0gdCArICJweCIpOwogICAgfSwgcy5wcm90b3R5cGUuZ2V0UmVzaXplSW5mb0J5R3Jvd3RoID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmdldEhlaWdodCgpLAogICAgICAgICAgbiA9IHQgKyBlLAogICAgICAgICAgbCA9IE1hdGgubWF4KDAsIG4sIHRoaXMub3B0aW9ucy5taW5IZWlnaHQpOwogICAgICByZXR1cm4gW2wsIHQgLSBsXTsKICAgIH0sIHMucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGEuZ2V0U2l6ZSh0aGlzLmNvbnRhaW5lcilbMV07CiAgICB9LCBzLnByb3RvdHlwZS5hZGRDbGFzcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGEuYWRkQ2xhc3ModGhpcy5jb250YWluZXIsIGUpOwogICAgfSwgcy5wcm90b3R5cGUucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbiAoZSkgewogICAgICBhLnJlbW92ZUNsYXNzKHRoaXMuY29udGFpbmVyLCBlKTsKICAgIH0sIHMucHJvdG90eXBlLl9pbml0UGFuZWwgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbjsKICAgICAgaWYgKGEuc2V0RGF0YSh0LCAicGFuZWxJbmRleCIsIGUuaW5kZXgpLCBlLmlzU3BsaXR0ZXIpIHJldHVybiBhLmFkZENsYXNzKHQsIG8uY2xhc3NuYW1lKCJzcGxpdHRlciIpKSwgdm9pZCB0aGlzLmFwcGx5VGhlbWUoKTsKICAgICAgZS5jbGFzc05hbWUgJiYgYS5hZGRDbGFzcyh0LCBlLmNsYXNzTmFtZSksIGUuYXV0b0hlaWdodCA/IGEuc2V0RGF0YSh0LCAiYXV0b0hlaWdodCIsICEwKSA6IChuID0gaS5saW1pdChlLmhlaWdodCB8fCAwLCBbZS5taW5IZWlnaHRdLCBbZS5tYXhIZWlnaHQgfHwgZS5oZWlnaHRdKSwgZS5oZWlnaHQgPSBuLCB0aGlzLnNldEhlaWdodCh0LCBuKSk7CiAgICB9LCBzLnByb3RvdHlwZS5hcHBseVRoZW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuY29udGFpbmVyLnN0eWxlLAogICAgICAgICAgdCA9IHRoaXMudGhlbWU7CiAgICAgIHQgJiYgKGUuYm9yZGVyVG9wID0gdC53ZWVrLnZwYW5lbFNwbGl0dGVyLmJvcmRlciB8fCB0LmNvbW1vbi5ib3JkZXIsIGUuYm9yZGVyQm90dG9tID0gdC53ZWVrLnZwYW5lbFNwbGl0dGVyLmJvcmRlciB8fCB0LmNvbW1vbi5ib3JkZXIsIGUuaGVpZ2h0ID0gdC53ZWVrLnZwYW5lbFNwbGl0dGVyLmhlaWdodCk7CiAgICB9LCBlLmV4cG9ydHMgPSBzOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDQpLkRhdGUsCiAgICAgICAgcyA9IG4oOCk7CgogICAgZnVuY3Rpb24gYyhlLCB0LCBuLCBjLCB1KSB7CiAgICAgIHZhciBkOwogICAgICBuID0gaS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgbiksIHMuY2FsbCh0aGlzLCBuKSwgaS5hZGRDbGFzcyhuLCBvLmNsYXNzbmFtZSgid2Vlay1jb250YWluZXIiKSksIGQgPSB0aGlzLl9nZXRSZW5kZXJEYXRlUmFuZ2UobmV3IHIoKSksIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBzY2hlZHVsZUZpbHRlcjogW2Z1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gQm9vbGVhbihlLmlzVmlzaWJsZSk7CiAgICAgICAgfV0sCiAgICAgICAgcmVuZGVyU3RhcnREYXRlOiBhLmZvcm1hdChkLnN0YXJ0LCAiWVlZWS1NTS1ERCIpLAogICAgICAgIHJlbmRlckVuZERhdGU6IGEuZm9ybWF0KGQuZW5kLCAiWVlZWS1NTS1ERCIpLAogICAgICAgIG5hcnJvd1dlZWtlbmQ6ICExLAogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAwLAogICAgICAgIHdvcmt3ZWVrOiAhMSwKICAgICAgICBzaG93VGltZXpvbmVDb2xsYXBzZUJ1dHRvbjogITEsCiAgICAgICAgdGltZXpvbmVzQ29sbGFwc2VkOiAhMSwKICAgICAgICBob3VyU3RhcnQ6IDAsCiAgICAgICAgaG91ckVuZDogMjQKICAgICAgfSwgdCksIHRoaXMuY29udHJvbGxlciA9IGUsIHRoaXMucGFuZWxzID0gYywgdGhpcy5zdGF0ZSA9IHsKICAgICAgICB0aW1lem9uZXNDb2xsYXBzZWQ6IHRoaXMub3B0aW9ucy50aW1lem9uZXNDb2xsYXBzZWQKICAgICAgfSwgImRheSIgPT09IHUgJiYgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLndvcmt3ZWVrID0gITE7CiAgICAgIH0odGhpcy5vcHRpb25zKTsKICAgIH0KCiAgICBsLmluaGVyaXQoYywgcyksIGMucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICB0LAogICAgICAgICAgbiwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgcywKICAgICAgICAgIGMgPSB0aGlzLAogICAgICAgICAgdSA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIGQgPSB1LnNjaGVkdWxlRmlsdGVyLAogICAgICAgICAgaCA9IHUubmFycm93V2Vla2VuZCwKICAgICAgICAgIHAgPSB1LnN0YXJ0RGF5T2ZXZWVrLAogICAgICAgICAgbSA9IHUud29ya3dlZWssCiAgICAgICAgICBmID0gdGhpcy5jb250cm9sbGVyLnRoZW1lIHx8IHt9LAogICAgICAgICAgZyA9IHRoaXMuc3RhdGU7CiAgICAgIGUgPSBuZXcgcih1LnJlbmRlclN0YXJ0RGF0ZSksIHQgPSBuZXcgcih1LnJlbmRlckVuZERhdGUpLCBzID0gYS5yYW5nZShhLnN0YXJ0KGUpLCBhLmVuZCh0KSwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSksIHUud29ya3dlZWsgJiYgYS5jb21wYXJlKGUsIHQpICYmIChlID0gKHMgPSBsLmZpbHRlcihzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAhYS5pc1dlZWtlbmQoZS5nZXREYXkoKSk7CiAgICAgIH0pKVswXSwgdCA9IHNbcy5sZW5ndGggLSAxXSksIG4gPSB0aGlzLmNvbnRyb2xsZXIuZmluZEJ5RGF0ZVJhbmdlKGEuc3RhcnQoZSksIGEuZW5kKHQpLCB0aGlzLnBhbmVscywgZCwgdGhpcy5vcHRpb25zKSwgaSA9IGEuZ2V0R3JpZExlZnRBbmRXaWR0aChzLmxlbmd0aCwgaCwgcCwgbSksIG8gPSB7CiAgICAgICAgc2NoZWR1bGVzSW5EYXRlUmFuZ2U6IG4sCiAgICAgICAgcmVuZGVyU3RhcnREYXRlOiBlLAogICAgICAgIHJlbmRlckVuZERhdGU6IHQsCiAgICAgICAgZ3JpZHM6IGksCiAgICAgICAgcmFuZ2U6IHMsCiAgICAgICAgdGhlbWU6IGYsCiAgICAgICAgc3RhdGU6IGcKICAgICAgfSwgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4gPSBsLnBpY2soZS5vcHRpb25zLCAidmlld05hbWUiKTsKICAgICAgICBlLnJlbmRlcihvKSwgbiAmJiAodCA9IG8uc2NoZWR1bGVzSW5EYXRlUmFuZ2Vbbl0sIGwuaXNBcnJheSh0KSA/IGMuX2ludm9rZUFmdGVyUmVuZGVyU2NoZWR1bGUodCkgOiBsLmZvckVhY2godCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGMuX2ludm9rZUFmdGVyUmVuZGVyU2NoZWR1bGUoZSk7CiAgICAgICAgfSkpOwogICAgICB9KSwgdGhpcy5maXJlKCJhZnRlclJlbmRlciIpOwogICAgfSwgYy5wcm90b3R5cGUuX2ludm9rZUFmdGVyUmVuZGVyU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXM7CiAgICAgIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUgJiYgdC5maXJlKCJhZnRlclJlbmRlclNjaGVkdWxlIiwgewogICAgICAgICAgICAgIHNjaGVkdWxlOiBlLm1vZGVsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwgYy5wcm90b3R5cGUudmlld05hbWUgPSAid2VlayIsIGMucHJvdG90eXBlLl9nZXRSZW5kZXJEYXRlUmFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGEuc3RhcnQoZSksCiAgICAgICAgICBuID0gbmV3IHIoTnVtYmVyKHQpKSwKICAgICAgICAgIGwgPSBuZXcgcihOdW1iZXIodCkpOwogICAgICByZXR1cm4gbi5zZXREYXRlKG4uZ2V0RGF0ZSgpIC0gMyksIGwuc2V0RGF0ZShsLmdldERhdGUoKSArIDMpLCB7CiAgICAgICAgc3RhcnQ6IG4sCiAgICAgICAgZW5kOiBsCiAgICAgIH07CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihjKSwgZS5leHBvcnRzID0gYzsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBuKDEpLAogICAgICAgIGMgPSBuKDgpLAogICAgICAgIHUgPSBuKDY3KTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgdCA9IHMuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIHQsIG8uY2xhc3NuYW1lKCJkYXluYW1lLWNvbnRhaW5lciIpKSwgdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIGRheW5hbWVzOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLAogICAgICAgIHRpbWV6b25lczogZS50aW1lem9uZXMKICAgICAgfSwgZS53ZWVrKSwgdGhpcy50aGVtZSA9IG4sIGMuY2FsbCh0aGlzLCB0KSwgdGhpcy5hcHBseVRoZW1lKCk7CiAgICB9CgogICAgbC5pbmhlcml0KGQsIGMpLCBkLnByb3RvdHlwZS5fZ2V0QmFzZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zLmRheW5hbWVzLAogICAgICAgICAgaSA9IHRoaXMudGhlbWUsCiAgICAgICAgICBzID0gbmV3IHIoKS50b0xvY2FsVGltZSgpOwogICAgICByZXR1cm4gbC5tYXAoYS5yYW5nZShhLnN0YXJ0KGUpLCBhLmVuZCh0KSwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSksIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIGwgPSBlLmdldERheSgpLAogICAgICAgICAgICByID0gYS5pc1NhbWVEYXRlKGUsIHMpLAogICAgICAgICAgICBjID0gZSA8IHMgJiYgIXI7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRheTogbCwKICAgICAgICAgIGRheU5hbWU6IG9bbF0sCiAgICAgICAgICBpc1RvZGF5OiByLAogICAgICAgICAgZGF0ZTogZS5nZXREYXRlKCksCiAgICAgICAgICBsZWZ0OiBuW3RdID8gblt0XS5sZWZ0IDogMCwKICAgICAgICAgIHdpZHRoOiBuW3RdID8gblt0XS53aWR0aCA6IDAsCiAgICAgICAgICByZW5kZXJEYXRlOiBhLmZvcm1hdChlLCAiWVlZWS1NTS1ERCIpLAogICAgICAgICAgY29sb3I6IHRoaXMuX2dldERheU5hbWVDb2xvcihpLCBsLCByLCBjKQogICAgICAgIH07CiAgICAgIH0sIHRoaXMpOwogICAgfSwgZC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9nZXRCYXNlVmlld01vZGVsKGUucmVuZGVyU3RhcnREYXRlLCBlLnJlbmRlckVuZERhdGUsIGUuZ3JpZHMpLAogICAgICAgICAgbiA9IGUuc3RhdGUudGltZXpvbmVzQ29sbGFwc2VkLAogICAgICAgICAgbyA9IHRoaXMuX2dldFN0eWxlcyh0aGlzLnRoZW1lLCBuKSwKICAgICAgICAgIGkgPSBsLmV4dGVuZCh7fSwgewogICAgICAgIGRheU5hbWVzOiB0LAogICAgICAgIHN0eWxlczogbwogICAgICB9KTsKCiAgICAgIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IHUoaSk7CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0RGF5TmFtZUNvbG9yID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwpIHsKICAgICAgdmFyIG8gPSAiIjsKICAgICAgcmV0dXJuIGUgJiYgKG8gPSAwID09PSB0ID8gZS5jb21tb24uaG9saWRheS5jb2xvciA6IGwgPyBlLndlZWsucGFzdERheS5jb2xvciB8fCBlLmNvbW1vbi5kYXluYW1lLmNvbG9yIDogNiA9PT0gdCA/IGUuY29tbW9uLnNhdHVyZGF5LmNvbG9yIDogbiA/IGUud2Vlay50b2RheS5jb2xvciB8fCBlLmNvbW1vbi50b2RheS5jb2xvciA6IGUuY29tbW9uLmRheW5hbWUuY29sb3IpLCBvOwogICAgfSwgZC5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCA9IHt9LAogICAgICAgICAgbyA9IHRoaXMub3B0aW9ucy50aW1lem9uZXMubGVuZ3RoLAogICAgICAgICAgYSA9IHQ7CiAgICAgIHJldHVybiBlICYmIChsLmJvcmRlclRvcCA9IGUud2Vlay5kYXluYW1lLmJvcmRlclRvcCB8fCBlLmNvbW1vbi5ib3JkZXIsIGwuYm9yZGVyQm90dG9tID0gZS53ZWVrLmRheW5hbWUuYm9yZGVyQm90dG9tIHx8IGUuY29tbW9uLmJvcmRlciwgbC5ib3JkZXJMZWZ0ID0gZS53ZWVrLmRheW5hbWUuYm9yZGVyTGVmdCB8fCBlLmNvbW1vbi5ib3JkZXIsIGwucGFkZGluZ0xlZnQgPSBlLndlZWsuZGF5bmFtZS5wYWRkaW5nTGVmdCwgbC5iYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsuZGF5bmFtZS5iYWNrZ3JvdW5kQ29sb3IsIGwuaGVpZ2h0ID0gZS53ZWVrLmRheW5hbWUuaGVpZ2h0LCBsLnRleHRBbGlnbiA9IGUud2Vlay5kYXluYW1lLnRleHRBbGlnbiwgbC5tYXJnaW5MZWZ0ID0gZS53ZWVrLmRheWdyaWRMZWZ0LndpZHRoLCAhYSAmJiBvID4gMSAmJiAobiA9IGkucGFyc2VVbml0KGwubWFyZ2luTGVmdCksIGwubWFyZ2luTGVmdCA9IG5bMF0gKiBvICsgblsxXSkpLCBsOwogICAgfSwgZC5wcm90b3R5cGUuYXBwbHlUaGVtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLl9nZXRTdHlsZXModGhpcy50aGVtZSksCiAgICAgICAgICB0ID0gdGhpcy5jb250YWluZXIuc3R5bGU7CgogICAgICByZXR1cm4gdC5ib3JkZXJUb3AgPSBlLmJvcmRlclRvcCwgdC5ib3JkZXJCb3R0b20gPSBlLmJvcmRlckJvdHRvbSwgdC5oZWlnaHQgPSBlLmhlaWdodCwgdC5iYWNrZ3JvdW5kQ29sb3IgPSBlLmJhY2tncm91bmRDb2xvciwgdC50ZXh0QWxpZ24gPSBlLnRleHRBbGlnbiwgdDsKICAgIH0sIGUuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJkYXluYW1lICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc1RvZGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICIgKyB1KChoKG4sICJob2xpZGF5IikgfHwgdCAmJiBoKHQsICJob2xpZGF5IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJkYXkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJob2xpZGF5IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA3NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogOTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICciXG4gICAgIGRhdGEtZGF0ZT0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInJlbmRlckRhdGUiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAicmVuZGVyRGF0ZSIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJyZW5kZXJEYXRlIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIlxuICAgICBzdHlsZT0iJyArIHUoKGgobiwgImNvbW1vbi13aWR0aCIpIHx8IHQgJiYgaCh0LCAiY29tbW9uLXdpZHRoIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJ3aWR0aCIpIDogdCwgewogICAgICAgICAgbmFtZTogImNvbW1vbi13aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiO2xlZnQ6IiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImxlZnQiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJsZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgbGluZS1oZWlnaHQ6ICIgKyB1KGQoKGkgPSAoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzdHlsZXMiKSkgJiYgaChpLCAiaGVpZ2h0IiksIHQpKSArICI7IGJvcmRlci1sZWZ0OiAiICsgdShkKChpID0gKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic3R5bGVzIikpICYmIGgoaSwgImJvcmRlckxlZnQiKSwgdCkpICsgIjsgcGFkZGluZy1sZWZ0OiAiICsgdShkKChpID0gKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic3R5bGVzIikpICYmIGgoaSwgInBhZGRpbmdMZWZ0IiksIHQpKSArICc7Ij5cbiAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZGF5bmFtZS1kYXRlLWFyZWEiIHN0eWxlPSJjb2xvcjogJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImNvbG9yIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImNvbG9yIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA2NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogNzMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnOyI+XG4gICAgICAgICcgKyAobnVsbCAhPSAoaSA9IChoKG4sICJ3ZWVrRGF5bmFtZS10bXBsIikgfHwgdCAmJiBoKHQsICJ3ZWVrRGF5bmFtZS10bXBsIikgfHwgcykuY2FsbChyLCB0LCB7CiAgICAgICAgICBuYW1lOiAid2Vla0RheW5hbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgPC9zcGFuPlxuPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDQ5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ0b2RheSI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGMobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYyh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkYXluYW1lLWxlZnRtYXJnaW4iIHN0eWxlPSJtYXJnaW4tbGVmdDogJyArIHMoZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYyhvLCAicm9vdCIpKSAmJiBjKGksICJzdHlsZXMiKSkgJiYgYyhpLCAibWFyZ2luTGVmdCIpLCB0KSkgKyAnOyI+XG4nICsgKG51bGwgIT0gKGkgPSBjKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBjKHQsICJkYXlOYW1lcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj4iOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oNSksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oMSksCiAgICAgICAgcyA9IG4oNCkuRGF0ZSwKICAgICAgICBjID0gbig4KSwKICAgICAgICB1ID0gbig2OSksCiAgICAgICAgZCA9IG4oNzEpLAogICAgICAgIGggPSBuKDExKSwKICAgICAgICBwID0gTWF0aC5tYXgsCiAgICAgICAgbSA9IE1hdGgubWluOwoKICAgIGZ1bmN0aW9uIGYoZSwgdCwgbiwgaSkgewogICAgICBuID0gci5hcHBlbmRIVE1MRWxlbWVudCgiZGl2Iiwgbiwgby5jbGFzc25hbWUoImRheWdyaWQtbGF5b3V0IikpLCBjLmNhbGwodGhpcywgbiksIGUgPSBlIHx8ICJkYXlncmlkIiwgdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIHZpZXdOYW1lOiBlLAogICAgICAgIGRheW5hbWVzOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLAogICAgICAgIHJlbmRlclN0YXJ0RGF0ZTogIiIsCiAgICAgICAgcmVuZGVyRW5kRGF0ZTogIiIsCiAgICAgICAgY29udGFpbmVyQm90dG9tR3V0dGVyOiAxOCwKICAgICAgICBzY2hlZHVsZUhlaWdodDogcGFyc2VJbnQoaS53ZWVrLmRheUdyaWRTY2hlZHVsZS5oZWlnaHQsIDEwKSwKICAgICAgICBzY2hlZHVsZUd1dHRlcjogcGFyc2VJbnQoaS53ZWVrLmRheUdyaWRTY2hlZHVsZS5tYXJnaW5Ub3AsIDEwKSwKICAgICAgICBzY2hlZHVsZUNvbnRhaW5lclRvcDogMSwKICAgICAgICB0aW1lem9uZXM6IHQudGltZXpvbmVzLAogICAgICAgIGlzUmVhZE9ubHk6IHQuaXNSZWFkT25seSwKICAgICAgICBnZXRWaWV3TW9kZWxGdW5jOiBmdW5jdGlvbiBnZXRWaWV3TW9kZWxGdW5jKHQpIHsKICAgICAgICAgIHJldHVybiB0LnNjaGVkdWxlc0luRGF0ZVJhbmdlW2VdOwogICAgICAgIH0sCiAgICAgICAgc2V0Vmlld01vZGVsRnVuYzogZnVuY3Rpb24gc2V0Vmlld01vZGVsRnVuYyh0LCBuKSB7CiAgICAgICAgICB0LnNjaGVkdWxlc0luRGF0ZVJhbmdlW2VdID0gbjsKICAgICAgICB9CiAgICAgIH0sIHQud2VlayksIHRoaXMuaGFuZGxlciA9IHt9LCB0aGlzLnZQYW5lbCA9IG51bGwsIHRoaXMuc3RhdGUuY29sbGFwc2VkID0gITA7CiAgICB9CgogICAgZnVuY3Rpb24gZyhlLCB0LCBuKSB7CiAgICAgIHJldHVybiAwID09PSBlIHx8IDYgPT09IGUgPyBuLndlZWtlbmRCYWNrZ3JvdW5kQ29sb3IgOiB0ID8gbi50b2RheUJhY2tncm91bmRDb2xvciA6IG4uYmFja2dyb3VuZENvbG9yOwogICAgfQoKICAgIGZ1bmN0aW9uIHkoZSwgdCkgewogICAgICB2YXIgbjsKICAgICAgcmV0dXJuIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGUubmFtZSA9PT0gdCAmJiAobiA9IGUpOwogICAgICB9KSwgbjsKICAgIH0KCiAgICBsLmluaGVyaXQoZiwgYyksIGYucHJvdG90eXBlLmdldEJhc2VWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBvID0gbi5kYXluYW1lcywKICAgICAgICAgIGkgPSBlLnJhbmdlLAogICAgICAgICAgciA9IGUuZ3JpZHMsCiAgICAgICAgICBjID0gbi5nZXRWaWV3TW9kZWxGdW5jKGUpLAogICAgICAgICAgdSA9IHt9LAogICAgICAgICAgZCA9IHkobi5wYW5lbHMsIG4udmlld05hbWUpLAogICAgICAgICAgaCA9IHRoaXMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LAogICAgICAgICAgZiA9IHRoaXMuc3RhdGUuY29sbGFwc2VkLAogICAgICAgICAgUyA9ICEhdGhpcy52UGFuZWwgJiYgdGhpcy52UGFuZWwuZ2V0SGVpZ2h0Rm9yY2VkU2V0KCksCiAgICAgICAgICBfID0gZS5zdGF0ZS50aW1lem9uZXNDb2xsYXBzZWQsCiAgICAgICAgICBDID0gdGhpcy5fZ2V0U3R5bGVzKGUudGhlbWUsIF8pLAogICAgICAgICAgdiA9IG5ldyBzKCkudG9Mb2NhbFRpbWUoKTsKCiAgICAgIHJldHVybiBkLnNob3dFeHBhbmRhYmxlQnV0dG9uICYmIChTIHx8IChoID0gZiA/IHAoaCwgZC5tYXhIZWlnaHQpIDogbShoLCBkLm1heEV4cGFuZGFibGVIZWlnaHQpKSwgdCA9IE1hdGguZmxvb3IoaCAvIChuLnNjaGVkdWxlSGVpZ2h0ICsgbi5zY2hlZHVsZUd1dHRlcikpLCBmICYmICh1ID0gdGhpcy5wYXJlbnQuY29udHJvbGxlci5nZXRFeGNlZWREYXRlKHQsIGMsIGUucmFuZ2UpLCBjID0gdGhpcy5wYXJlbnQuY29udHJvbGxlci5leGNsdWRlRXhjZWVkU2NoZWR1bGVzKGMsIHQpLCBuLnNldFZpZXdNb2RlbEZ1bmMoZSwgYykpKSwgewogICAgICAgIHZpZXdOYW1lOiBuLnZpZXdOYW1lLAogICAgICAgIHJhbmdlOiBpLAogICAgICAgIGdyaWRzOiByLAogICAgICAgIGRheXM6IGwubWFwKGUucmFuZ2UsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgbCA9IHQuZ2V0RGF5KCksCiAgICAgICAgICAgICAgaSA9IGEuZm9ybWF0KHQsICJZWVlZTU1ERCIpLAogICAgICAgICAgICAgIHMgPSBhLmlzU2FtZURhdGUodiwgdCk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkYXk6IGwsCiAgICAgICAgICAgIGRheU5hbWU6IG9bbF0sCiAgICAgICAgICAgIGlzVG9kYXk6IHMsCiAgICAgICAgICAgIGRhdGU6IHQuZ2V0RGF0ZSgpLAogICAgICAgICAgICByZW5kZXJEYXRlOiBhLmZvcm1hdCh0LCAiWVlZWS1NTS1ERCIpLAogICAgICAgICAgICBoaWRkZW5TY2hlZHVsZXM6IHVbaV0gfHwgMCwKICAgICAgICAgICAgd2lkdGg6IHJbbl0gPyByW25dLndpZHRoIDogMCwKICAgICAgICAgICAgbGVmdDogcltuXSA/IHJbbl0ubGVmdCA6IDAsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogZS5yYW5nZS5sZW5ndGggPiAxID8gZyhsLCBzLCBDKSA6IEMuYmFja2dyb3VuZENvbG9yCiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgIGV4Y2VlZERhdGU6IHUsCiAgICAgICAgc2hvd0V4cGFuZGFibGVCdXR0b246IGQuc2hvd0V4cGFuZGFibGVCdXR0b24sCiAgICAgICAgY29sbGFwc2VkOiBmLAogICAgICAgIGNvbGxhcHNlQnRuSW5kZXg6IHRoaXMuc3RhdGUuY2xpY2tlZEV4cGFuZEJ0bkluZGV4LAogICAgICAgIHN0eWxlczogQwogICAgICB9OwogICAgfSwgZi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbCA9IHRoaXMuY29udGFpbmVyLAogICAgICAgICAgaSA9IHRoaXMuZ2V0QmFzZVZpZXdNb2RlbChlKSwKICAgICAgICAgIGEgPSB0aGlzLm9wdGlvbnMuc2NoZWR1bGVDb250YWluZXJUb3A7CiAgICAgIGwuaW5uZXJIVE1MID0gZChpKSwgdGhpcy5jaGlsZHJlbi5jbGVhcigpLCB0ID0gbmV3IHUobiwgci5maW5kKG8uY2xhc3NuYW1lKCIuY29udGFpbmVyIiksIGwpKSwgdGhpcy5hZGRDaGlsZCh0KSwgdC5vbigiYWZ0ZXJSZW5kZXIiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGkuaGVpZ2h0ID0gZS5taW5IZWlnaHQgKyBhOwogICAgICB9KSwgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5yZW5kZXIoZSk7CiAgICAgIH0sIHRoaXMpLCB0aGlzLmZpcmUoImFmdGVyUmVuZGVyIiwgaSk7CiAgICB9LCBmLnByb3RvdHlwZS5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHt9LCBmLnByb3RvdHlwZS5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwgPSB0aGlzOwogICAgICB0aGlzLmhhbmRsZXJbZV0gPSB0LCB0aGlzLnZQYW5lbCA9IG4sICJjbGljayIgPT09IGUgJiYgKHQub24oImV4cGFuZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBsLnNldFN0YXRlKHsKICAgICAgICAgIGNvbGxhcHNlZDogITEKICAgICAgICB9KTsKICAgICAgfSwgdGhpcyksIHQub24oImNvbGxhcHNlIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGwuc2V0U3RhdGUoewogICAgICAgICAgY29sbGFwc2VkOiAhMAogICAgICAgIH0pOwogICAgICB9LCB0aGlzKSk7CiAgICB9LCBmLnByb3RvdHlwZS5fZXhwYW5kID0gZnVuY3Rpb24gKCkgewogICAgICBoLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gdGhpcy52UGFuZWwsCiAgICAgICAgICAgIHQgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgIG4gPSB5KHQucGFuZWxzLCB0LnZpZXdOYW1lKTsKICAgICAgICBlLnNldE1heEhlaWdodChuLm1heEV4cGFuZGFibGVIZWlnaHQpLCBlLnNldEhlaWdodEZvcmNlZFNldCghMSksIGUuc2V0SGVpZ2h0KG51bGwsIG4ubWF4RXhwYW5kYWJsZUhlaWdodCksIHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50LnJlbmRlcigpOwogICAgICB9LCB0aGlzKTsKICAgIH0sIGYucHJvdG90eXBlLl9jb2xsYXBzZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IHRoaXMudlBhbmVsLAogICAgICAgICAgICB0ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBuID0geSh0LnBhbmVscywgdC52aWV3TmFtZSk7CiAgICAgICAgZS5zZXRNYXhIZWlnaHQobi5tYXhIZWlnaHQpLCBlLnNldEhlaWdodEZvcmNlZFNldCghMSksIGUuc2V0SGVpZ2h0KG51bGwsIG4ubWluSGVpZ2h0KSwgdGhpcy5wYXJlbnQgJiYgdGhpcy5wYXJlbnQucmVuZGVyKCk7CiAgICAgIH0sIHRoaXMpOwogICAgfSwgZi5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuc3RhdGUuY29sbGFwc2VkOwogICAgICBjLnByb3RvdHlwZS5zZXRTdGF0ZS5jYWxsKHRoaXMsIGUpLCB0aGlzLnN0YXRlLmNvbGxhcHNlZCAhPT0gdCAmJiAodGhpcy5zdGF0ZS5jb2xsYXBzZWQgPyB0aGlzLl9jb2xsYXBzZSgpIDogdGhpcy5fZXhwYW5kKCkpOwogICAgfSwgZi5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCA9IHt9LAogICAgICAgICAgbyA9IHRoaXMub3B0aW9ucy50aW1lem9uZXMubGVuZ3RoLAogICAgICAgICAgYSA9IHQ7CiAgICAgIHJldHVybiBlICYmIChsLmJvcmRlclJpZ2h0ID0gZS53ZWVrLmRheWdyaWQuYm9yZGVyUmlnaHQgfHwgZS5jb21tb24uYm9yZGVyLCBsLnRvZGF5QmFja2dyb3VuZENvbG9yID0gZS53ZWVrLnRvZGF5LmJhY2tncm91bmRDb2xvciwgbC53ZWVrZW5kQmFja2dyb3VuZENvbG9yID0gZS53ZWVrLndlZWtlbmQuYmFja2dyb3VuZENvbG9yLCBsLmJhY2tncm91bmRDb2xvciA9IGUud2Vlay5kYXlncmlkLmJhY2tncm91bmRDb2xvciwgbC5sZWZ0V2lkdGggPSBlLndlZWsuZGF5Z3JpZExlZnQud2lkdGgsIGwubGVmdEJhY2tncm91bmRDb2xvciA9IGUud2Vlay5kYXlncmlkTGVmdC5iYWNrZ3JvdW5kQ29sb3IsIGwubGVmdFBhZGRpbmdSaWdodCA9IGUud2Vlay5kYXlncmlkTGVmdC5wYWRkaW5nUmlnaHQsIGwubGVmdEJvcmRlclJpZ2h0ID0gZS53ZWVrLmRheWdyaWRMZWZ0LmJvcmRlclJpZ2h0LCAhYSAmJiBvID4gMSAmJiAobiA9IGkucGFyc2VVbml0KGwubGVmdFdpZHRoKSwgbC5sZWZ0V2lkdGggPSBuWzBdICogbyArIG5bMV0pKSwgbDsKICAgIH0sIGUuZXhwb3J0cyA9IGY7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMzApLAogICAgICAgIGkgPSBuKDcwKSwKICAgICAgICBhID0gTWF0aC5tYXg7CgogICAgZnVuY3Rpb24gcihlLCB0KSB7CiAgICAgIG8uY2FsbCh0aGlzLCBlLCB0KSwgdGhpcy5jb2xsYXBzZWQgPSAhMDsKICAgIH0KCiAgICBsLmluaGVyaXQociwgbyksIHIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuY29udGFpbmVyOwogICAgICB0ID0gdGhpcy5nZXRCYXNlVmlld01vZGVsKGUpLCBuLmlubmVySFRNTCA9IGkodCksIHRoaXMuZmlyZSgiYWZ0ZXJSZW5kZXIiLCB0KTsKICAgIH0sIHIucHJvdG90eXBlLl9nZXRNYXhTY2hlZHVsZUluRGF5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIGEuYXBwbHkobnVsbCwgbC5tYXAoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgbC5tYXAoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmxlbmd0aDsKICAgICAgICB9KSk7CiAgICAgIH0pKTsKICAgIH0sIHIucHJvdG90eXBlLl9nZXRNaW5IZWlnaHQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMub3B0aW9uczsKICAgICAgcmV0dXJuIGUgKiB0LnNjaGVkdWxlSGVpZ2h0ICsgKGUgLSAxKSAqIHQuc2NoZWR1bGVHdXR0ZXI7CiAgICB9LCByLnByb3RvdHlwZS5nZXRCYXNlVmlld01vZGVsID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgaSA9IG4uZ2V0Vmlld01vZGVsRnVuYyhlKSwKICAgICAgICAgIGEgPSB0aGlzLl9nZXRNYXhTY2hlZHVsZUluRGF5KGkpLAogICAgICAgICAgciA9IHRoaXMuX2dldFN0eWxlcyhlLnRoZW1lKTsKCiAgICAgIHJldHVybiB0ID0gby5wcm90b3R5cGUuZ2V0QmFzZVZpZXdNb2RlbC5jYWxsKHRoaXMsIGUpLCB0ID0gbC5leHRlbmQoewogICAgICAgIG1pbkhlaWdodDogdGhpcy5fZ2V0TWluSGVpZ2h0KGEpLAogICAgICAgIG1hdHJpY2VzOiBpLAogICAgICAgIHNjaGVkdWxlQ29udGFpbmVyVG9wOiB0aGlzLm9wdGlvbnMuc2NoZWR1bGVDb250YWluZXJUb3AsCiAgICAgICAgbWF4U2NoZWR1bGVJbkRheTogYSwKICAgICAgICBpc1JlYWRPbmx5OiBuLmlzUmVhZE9ubHksCiAgICAgICAgc3R5bGVzOiByCiAgICAgIH0sIHQpOwogICAgfSwgci5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0ge307CiAgICAgIHJldHVybiBlICYmICh0LmJvcmRlclJhZGl1cyA9IGUud2Vlay5kYXlHcmlkU2NoZWR1bGUuYm9yZGVyUmFkaXVzKSwgdDsKICAgIH0sIGUuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaTsKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IChlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9KShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNywKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiAiXG4gICAgIiArIChudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiAiXG4gICAgIiArIChudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKTsKICAgICAgfSwKICAgICAgNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICdcbiAgICA8ZGl2IGRhdGEtaWQ9IicgKyBjKChkKG4sICJzdGFtcCIpIHx8IHQgJiYgZCh0LCAic3RhbXAiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic3RhbXAiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgICAgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZS1ibG9ja1xuICAgICAgICAgICAgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZExlZnQiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRSaWdodCIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDczCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgc3R5bGU9InRvcDonICsgYygoZChuLCAibXVsdGlwbHkiKSB8fCB0ICYmIGQodCwgIm11bHRpcGx5IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJ0b3AiKSA6IHQsIChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlQmxvY2tIZWlnaHQiKSwgewogICAgICAgICAgbmFtZTogIm11bHRpcGx5IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA2MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgInB4O1xuICAgICAgICAgICAgICAgIGxlZnQ6IiArIGMoKGQobiwgImdyaWQtbGVmdCIpIHx8IHQgJiYgZCh0LCAiZ3JpZC1sZWZ0IikgfHwgcykuY2FsbChyLCB0LCAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJkYXRlcyIpLCB7CiAgICAgICAgICBuYW1lOiAiZ3JpZC1sZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiA1MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgIiU7XG4gICAgICAgICAgICAgICAgd2lkdGg6IiArIGMoKGQobiwgImdyaWQtd2lkdGgiKSB8fCB0ICYmIGQodCwgImdyaWQtd2lkdGgiKSB8fCBzKS5jYWxsKHIsIHQsIChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImRhdGVzIiksIHsKICAgICAgICAgIG5hbWU6ICJncmlkLXdpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyUiPlxuICAgICAgICA8ZGl2IGRhdGEtc2NoZWR1bGUtaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlkIikgOiBpLCB0KSkgKyAnIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjYWxlbmRhcklkIikgOiBpLCB0KSkgKyAnIiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDEwNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlICIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDksIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTIzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6JyArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiIgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImJvcmRlclJhZGl1cyIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDEzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgIiArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY3VzdG9tU3R5bGUiKSA6IGksIHQpKSArICciPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpdGxlIiB0aXRsZT0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAidGl0bGUiKSA6IGksIHQpKSArICciPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJzY2hlZHVsZS10bXBsIikgfHwgdCAmJiBkKHQsICJzY2hlZHVsZS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInNjaGVkdWxlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiA4NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDExMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKHIsIChkKG4sICJvciIpIHx8IHQgJiYgZCh0LCAib3IiKSB8fCBzKS5jYWxsKHIsIChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImlzUmVhZE9ubHkiKSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzUmVhZE9ubHkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDIyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDE5MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LWV4Y2VlZC1sZWZ0IjsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAzMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNDYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAid2Vla2RheS1leGNlZWQtcmlnaHQiOwogICAgICB9LAogICAgICA5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAid2Vla2RheS1zY2hlZHVsZS1mb2N1c2VkICI7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBjb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJiZ0NvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAxNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgcigiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBzKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHModCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gYS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogODkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1yZXNpemUtaGFuZGxlIGhhbmRsZS15IiBzdHlsZT0ibGluZS1oZWlnaHQ6JyArIHIoZS5sYW1iZGEoKGkgPSBvICYmIHMobywgInJvb3QiKSkgJiYgcyhpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgJ3B4OyI+Jm5ic3A7PC9zcGFuPic7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZXMgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiY29sbGFwc2VkIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImNvbGxhcHNlZCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xsYXBzZWQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICcic3R5bGU9InRvcDonICsgYyhlLmxhbWJkYSgoaSA9IG8gJiYgdShvLCAicm9vdCIpKSAmJiB1KGksICJzY2hlZHVsZUNvbnRhaW5lclRvcCIpLCB0KSkgKyAncHg7Ij5cbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgIm1hdHJpY2VzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1ncmlkLWxpbmUiXG4gICAgICAgICAgICAgICAgc3R5bGU9ImxlZnQ6JyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAzNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyB3aWR0aDoiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJ3aWR0aCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJ3aWR0aCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ3aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDU0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IGJhY2tncm91bmQtY29sb3I6ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImJhY2tncm91bmRDb2xvciIpIHx8IChudWxsICE9IHQgPyB1KHQsICJiYWNrZ3JvdW5kQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiYmFja2dyb3VuZENvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogOTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiO1xuIiArIChudWxsICE9IChpID0gdShuLCAidW5sZXNzIikuY2FsbChyLCBvICYmIHUobywgImxhc3QiKSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgICI+PC9kaXY+XG4nOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBib3JkZXItcmlnaHQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAiYm9yZGVyUmlnaHQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSBhKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAiZGF5cyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE3LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNywKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSBhKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgImNvbGxhcHNlZCIpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDYsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDksIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICA2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gYShuLCAiaWYiKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJoaWRkZW5TY2hlZHVsZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWV4Y2VlZC1pbi13ZWVrIiBzdHlsZT0iei1pbmRleDogMTsgcmlnaHQ6JyArIGMoKHUobiwgImdldFJpZ2h0IikgfHwgdCAmJiB1KHQsICJnZXRSaWdodCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibGVmdCIpIDogdCwgbnVsbCAhPSB0ID8gdSh0LCAid2lkdGgiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJnZXRSaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDk2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMTE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnJTsiIGRhdGEtaW5kZXg9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImtleSIpIHx8IG8gJiYgdShvLCAia2V5IikpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJrZXkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAodShuLCAid2Vla0dyaWRGb290ZXJFeGNlZWQtdG1wbCIpIHx8IHQgJiYgdSh0LCAid2Vla0dyaWRGb290ZXJFeGNlZWQtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiaGlkZGVuU2NoZWR1bGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAid2Vla0dyaWRGb290ZXJFeGNlZWQtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDE0NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDE5MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4iOwogICAgICB9LAogICAgICA5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGEobiwgImZpIikgfHwgdCAmJiBhKHQsICJmaSIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbyAmJiBhKG8sICJrZXkiKSwgIj09PSIsIChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgImNvbGxhcHNlQnRuSW5kZXgiKSwgewogICAgICAgICAgbmFtZTogImZpIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDEwOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1jb2xsYXBzZS1idG4iIHN0eWxlPSJ6LWluZGV4OiAxOyByaWdodDonICsgYygodShuLCAiZ2V0UmlnaHQiKSB8fCB0ICYmIHUodCwgImdldFJpZ2h0IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJsZWZ0IikgOiB0LCBudWxsICE9IHQgPyB1KHQsICJ3aWR0aCIpIDogdCwgewogICAgICAgICAgbmFtZTogImdldFJpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogOTQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICclOyI+JyArIChudWxsICE9IChpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiY29sbGFwc2VCdG5UaXRsZS10bXBsIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImNvbGxhcHNlQnRuVGl0bGUtdG1wbCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xsYXBzZUJ0blRpdGxlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidmlld05hbWUiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAidmlld05hbWUiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidmlld05hbWUiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICItbGVmdCAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdsZWZ0IiBzdHlsZT0iYm9yZGVyLXJpZ2h0OiAnICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibGVmdEJvcmRlclJpZ2h0IikgOiBpLCB0KSkgKyAiOyB3aWR0aDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxlZnRXaWR0aCIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxlZnRCYWNrZ3JvdW5kQ29sb3IiKSA6IGksIHQpKSArICI7IHBhZGRpbmctcmlnaHQ6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJsZWZ0UGFkZGluZ1JpZ2h0IikgOiBpLCB0KSkgKyAnOyI+XG4gICAgJyArIChudWxsICE9IChpID0gKGgobiwgImRheUdyaWRUaXRsZS10bXBsIikgfHwgdCAmJiBoKHQsICJkYXlHcmlkVGl0bGUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAidmlld05hbWUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJkYXlHcmlkVGl0bGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMzYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnXG48L2Rpdj5cbjxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidmlld05hbWUiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAidmlld05hbWUiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidmlld05hbWUiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICItcmlnaHQgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncmlnaHQiPlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRhaW5lciI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZ3JpZCI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJkYXlzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInNob3dFeHBhbmRhYmxlQnV0dG9uIiksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDUpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDYpLAogICAgICAgIHMgPSBuKDMpLAogICAgICAgIGMgPSBuKDQpLAogICAgICAgIHUgPSBuKDExKSwKICAgICAgICBkID0gbig4KSwKICAgICAgICBoID0gbig3MyksCiAgICAgICAgcCA9IG4oNzUpLAogICAgICAgIG0gPSBuKDc2KSwKICAgICAgICBmID0gbig3NyksCiAgICAgICAgZyA9IG4oNzgpLAogICAgICAgIHkgPSBjLkRhdGU7CgogICAgZnVuY3Rpb24gUyhlLCB0LCBuLCBvKSB7CiAgICAgIHZhciBhLAogICAgICAgICAgciwKICAgICAgICAgIGMgPSBlLmhvdXJTdGFydCwKICAgICAgICAgIHUgPSBlLmhvdXJFbmQsCiAgICAgICAgICBkID0gbmV3IHkoZS5yZW5kZXJFbmREYXRlKSwKICAgICAgICAgIGggPSBwYXJzZUludChuIC8gNjAsIDEwKSwKICAgICAgICAgIHAgPSBNYXRoLmFicyhuICUgNjApLAogICAgICAgICAgbSA9IG5ldyB5KCkudG9Mb2NhbFRpbWUoKSwKICAgICAgICAgIGYgPSBtLmdldE1pbnV0ZXMoKSwKICAgICAgICAgIGcgPSBsLnJhbmdlKDAsIDI0KSwKICAgICAgICAgIFMgPSBudWxsOwogICAgICByZXR1cm4gKGggPCAwIHx8IC0wID09PSBoKSAmJiBwID4gMCAmJiAoaCAtPSAxKSwgaS5zaGlmdEFycmF5KGcsIGgpLCBpLnRha2VBcnJheShnLCBjLCB1KSwgYSA9IGkuc2hpZnRIb3VycyhtLmdldEhvdXJzKCksIGgpICUgMjQsIHIgPSBsLmluQXJyYXkoYSwgZyksIHQgJiYgKGYgPCAyMCA/IFMgPSBhIDogZiA+IDQwICYmIChTID0gYSArIDEpLCBsLmlzTnVtYmVyKFMpICYmIChTICU9IDI0KSksIGwubWFwKGcsIGZ1bmN0aW9uIChlLCBuKSB7CiAgICAgICAgdmFyIGwsIGk7CiAgICAgICAgcmV0dXJuIHQgJiYgbiA8PSByIHx8IGQgPCBtICYmICFzLmlzU2FtZURhdGUoZCwgbSkgPyAobCA9IG8ucGFzdFRpbWVDb2xvciwgaSA9IG8ucGFzdFRpbWVGb250V2VpZ2h0KSA6IChsID0gby5mdXR1cmVUaW1lQ29sb3IsIGkgPSBvLmZ1dHVyZVRpbWVGb250V2VpZ2h0KSwgewogICAgICAgICAgaG91cjogZSwKICAgICAgICAgIG1pbnV0ZXM6IHAsCiAgICAgICAgICBoaWRkZW46IFMgPT09IGUgfHwgMCA9PT0gbiwKICAgICAgICAgIGNvbG9yOiBsIHx8ICIiLAogICAgICAgICAgZm9udFdlaWdodDogaSB8fCAiIgogICAgICAgIH07CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIF8oZSwgdCwgbiwgaSkgewogICAgICB2YXIgciA9IGEuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIG4sIG8uY2xhc3NuYW1lKCJ0aW1lZ3JpZC1jb250YWluZXIiKSksCiAgICAgICAgICBzID0gYS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2Iiwgbiwgby5jbGFzc25hbWUoInRpbWVncmlkLXN0aWNreS1jb250YWluZXIiKSk7CiAgICAgIG4uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiLCBlID0gZSB8fCAidGltZSIsIGQuY2FsbCh0aGlzLCByKSwgbC5icm93c2VyLnNhZmFyaSB8fCAodGhpcy5fYXV0b1Njcm9sbCA9IG5ldyBwKHIpKSwgdGhpcy5zdGlja3lDb250YWluZXIgPSBzLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgdmlld05hbWU6IGUsCiAgICAgICAgcmVuZGVyU3RhcnREYXRlOiAiIiwKICAgICAgICByZW5kZXJFbmREYXRlOiAiIiwKICAgICAgICBob3VyU3RhcnQ6ICJkYXkiID09PSBpID8gOCA6IDAsCiAgICAgICAgaG91ckVuZDogImRheSIgPT09IGkgPyAxOCA6IDI0LAogICAgICAgIHRpbWV6b25lczogdC50aW1lem9uZXMsCiAgICAgICAgaXNSZWFkT25seTogdC5pc1JlYWRPbmx5LAogICAgICAgIHNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uOiAhMSwKICAgICAgICBjYWxlbmRhclZpZXdOYW1lOiBpCiAgICAgIH0sIHQud2VlayksIHRoaXMub3B0aW9ucy50aW1lem9uZXMubGVuZ3RoIDwgMSAmJiAodGhpcy5vcHRpb25zLnRpbWV6b25lcyA9IFt7CiAgICAgICAgdGltZXpvbmVPZmZzZXQ6IGMuZ2V0T2Zmc2V0KCkKICAgICAgfV0pLCB0aGlzLmludGVydmFsSUQgPSAwLCB0aGlzLnRpbWVySUQgPSAwLCB0aGlzLnJBbmltYXRpb25GcmFtZUlEID0gMCwgdGhpcy5fc2Nyb2xsZWQgPSAhMSwgdGhpcy5fY2FjaGVQYXJlbnRWaWV3TW9kZWwgPSBudWxsLCB0aGlzLl9jYWNoZUhvdXJzTGFiZWxzID0gbnVsbCwgdGhpcy5hdHRhY2hFdmVudCgpOwogICAgfQoKICAgIGwuaW5oZXJpdChfLCBkKSwgXy5wcm90b3R5cGUudmlld05hbWUgPSAidGltZWdyaWQiLCBfLnByb3RvdHlwZS5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSUQpLCBjbGVhclRpbWVvdXQodGhpcy50aW1lcklEKSwgdS5jYW5jZWxBbmltRnJhbWUodGhpcy5yQW5pbWF0aW9uRnJhbWVJRCksIHRoaXMuX2F1dG9TY3JvbGwgJiYgdGhpcy5fYXV0b1Njcm9sbC5kZXN0cm95KCksIHIub2ZmKHRoaXMuc3RpY2t5Q29udGFpbmVyLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrU3RpY2t5Q29udGFpbmVyLCB0aGlzKSwgdGhpcy5fYXV0b1Njcm9sbCA9IHRoaXMuaG91cm1hcmtlcnMgPSB0aGlzLmludGVydmFsSUQgPSB0aGlzLnRpbWVySUQgPSB0aGlzLnJBbmltYXRpb25GcmFtZUlEID0gdGhpcy5fY2FjaGVQYXJlbnRWaWV3TW9kZWwgPSB0aGlzLnN0aWNreUNvbnRhaW5lciA9IG51bGw7CiAgICB9LCBfLnByb3RvdHlwZS5fZ2V0VG9wUGVyY2VudEJ5VGltZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIG8gPSBzLnJhdyhlIHx8IG5ldyB5KCkpLAogICAgICAgICAgYSA9IGwucmFuZ2Uobi5ob3VyU3RhcnQsIG4uaG91ckVuZCkubGVuZ3RoICogcy5NSUxMSVNFQ09ORFNfUEVSX0hPVVIsCiAgICAgICAgICByID0gcy5taWxsaXNlY29uZHNGcm9tKCJob3VyIiwgby5oKSArIHMubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIG8ubSkgKyBzLm1pbGxpc2Vjb25kc0Zyb20oInNlY29uZHMiLCBvLnMpICsgby5tczsKICAgICAgcmV0dXJuIHQgPSBpLnJhdGlvKGEsIDEwMCwgciksIHQgLT0gaS5yYXRpbyhhLCAxMDAsIHMubWlsbGlzZWNvbmRzRnJvbSgiaG91ciIsIG4uaG91clN0YXJ0KSksIGkubGltaXQodCwgWzBdLCBbMTAwXSk7CiAgICB9LCBfLnByb3RvdHlwZS5fZ2V0SG91cm1hcmtlclZpZXdNb2RlbCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvID0gLTEsCiAgICAgICAgICBpID0gLTEsCiAgICAgICAgICBhID0gW10sCiAgICAgICAgICByID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgdSA9IGMuZ2V0T2Zmc2V0KCksCiAgICAgICAgICBkID0gci50aW1lem9uZXM7CiAgICAgIHJldHVybiBsLmZvckVhY2gobiwgZnVuY3Rpb24gKG4sIGwpIHsKICAgICAgICBzLmlzU2FtZURhdGUoZSwgbikgJiYgKG8gPSB0W2xdID8gdFtsXS5sZWZ0IDogMCwgaSA9IHRbbF0gPyB0W2xdLndpZHRoIDogMCk7CiAgICAgIH0pLCBsLmZvckVhY2goZCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgbCA9IHQudGltZXpvbmVPZmZzZXQgKyB1LAogICAgICAgICAgICBvID0gbmV3IHkoZSk7CiAgICAgICAgby5zZXRNaW51dGVzKG8uZ2V0TWludXRlcygpICsgbCksIG4gPSBzLmdldERhdGVEaWZmZXJlbmNlKG8sIGUpLCBhLnB1c2goewogICAgICAgICAgaG91cm1hcmtlcjogbywKICAgICAgICAgIGRhdGVEaWZmZXJlbmNlU2lnbjogbiA8IDAgPyAiLSIgOiAiKyIsCiAgICAgICAgICBkYXRlRGlmZmVyZW5jZTogTWF0aC5hYnMobikKICAgICAgICB9KTsKICAgICAgfSksIHsKICAgICAgICBjdXJyZW50SG91cnM6IGUuZ2V0SG91cnMoKSwKICAgICAgICBob3VybWFya2VyVG9wOiB0aGlzLl9nZXRUb3BQZXJjZW50QnlUaW1lKGUpLAogICAgICAgIGhvdXJtYXJrZXJUaW16b25lczogYSwKICAgICAgICB0b2RheW1hcmtlckxlZnQ6IG8sCiAgICAgICAgdG9kYXltYXJrZXJXaWR0aDogaSwKICAgICAgICB0b2RheW1hcmtlclJpZ2h0OiBvICsgaQogICAgICB9OwogICAgfSwgXy5wcm90b3R5cGUuX2dldFRpbWV6b25lVmlld01vZGVsID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBpID0gYy5nZXRPZmZzZXQoKSwKICAgICAgICAgIGEgPSBvLnRpbWV6b25lcywKICAgICAgICAgIHIgPSBhLmxlbmd0aCwKICAgICAgICAgIHUgPSBbXSwKICAgICAgICAgIGQgPSB0LAogICAgICAgICAgaCA9IGQgPyAxMDAgOiAxMDAgLyByLAogICAgICAgICAgcCA9IG5ldyB5KCkudG9Mb2NhbFRpbWUoKSwKICAgICAgICAgIG0gPSBuLmRpc3BsYXlUaW1lem9uZUxhYmVsQmFja2dyb3VuZENvbG9yOwogICAgICByZXR1cm4gbC5mb3JFYWNoKGEsIGZ1bmN0aW9uICh0LCBsKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGcgPSBuZXcgeShwKTsKICAgICAgICByID0gdC50aW1lem9uZU9mZnNldCArIGksIGMgPSBTKG8sIGUgPj0gMCwgciwgbiksIGcuc2V0TWludXRlcyhnLmdldE1pbnV0ZXMoKSArIHIpLCBmID0gcy5nZXREYXRlRGlmZmVyZW5jZShnLCBwKSwgbCA+IDAgJiYgKG0gPSBuLmFkZGl0aW9uYWxUaW1lem9uZUJhY2tncm91bmRDb2xvciksIHUucHVzaCh7CiAgICAgICAgICB0aW1lU2xvdHM6IGMsCiAgICAgICAgICBkaXNwbGF5TGFiZWw6IHQuZGlzcGxheUxhYmVsLAogICAgICAgICAgdGltZXpvbmVPZmZzZXQ6IHQudGltZXpvbmVPZmZzZXQsCiAgICAgICAgICB0b29sdGlwOiB0LnRvb2x0aXAgfHwgIiIsCiAgICAgICAgICB3aWR0aDogaCwKICAgICAgICAgIGxlZnQ6IGQgPyAwIDogKGEubGVuZ3RoIC0gbCAtIDEpICogaCwKICAgICAgICAgIGlzUHJpbWFyeTogMCA9PT0gbCwKICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbSB8fCAiIiwKICAgICAgICAgIGhpZGRlbjogMCAhPT0gbCAmJiBkLAogICAgICAgICAgaG91cm1hcmtlcjogZywKICAgICAgICAgIGRhdGVEaWZmZXJlbmNlU2lnbjogZiA8IDAgPyAiLSIgOiAiKyIsCiAgICAgICAgICBkYXRlRGlmZmVyZW5jZTogTWF0aC5hYnMoZikKICAgICAgICB9KTsKICAgICAgfSksIHU7CiAgICB9LCBfLnByb3RvdHlwZS5fZ2V0QmFzZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS5ncmlkcywKICAgICAgICAgIG4gPSBlLnJhbmdlLAogICAgICAgICAgbyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIGkgPSB0aGlzLl9nZXRIb3VybWFya2VyVmlld01vZGVsKG5ldyB5KCkudG9Mb2NhbFRpbWUoKSwgdCwgbiksCiAgICAgICAgICBhID0gbC5waWNrKGUsICJzdGF0ZSIsICJ0aW1lem9uZXNDb2xsYXBzZWQiKSwKICAgICAgICAgIHIgPSB0aGlzLl9nZXRTdHlsZXMoZS50aGVtZSwgYSk7CgogICAgICByZXR1cm4gbC5leHRlbmQoaSwgewogICAgICAgIHRpbWV6b25lczogdGhpcy5fZ2V0VGltZXpvbmVWaWV3TW9kZWwoaS50b2RheW1hcmtlckxlZnQsIGEsIHIpLAogICAgICAgIGhvdXJzTGFiZWxzOiBTKG8sIGkudG9kYXltYXJrZXJMZWZ0ID49IDAsIDAsIHIpLAogICAgICAgIHN0eWxlczogciwKICAgICAgICBzaG93VGltZXpvbmVDb2xsYXBzZUJ1dHRvbjogbC5waWNrKG8sICJzaG93VGltZXpvbmVDb2xsYXBzZUJ1dHRvbiIpLAogICAgICAgIHRpbWV6b25lc0NvbGxhcHNlZDogYSwKICAgICAgICBpc0RheVZpZXc6ICJkYXkiID09PSBvLmNhbGVuZGFyVmlld05hbWUsCiAgICAgICAgaXNXZWVrVmlldzogIndlZWsiID09PSBvLmNhbGVuZGFyVmlld05hbWUsCiAgICAgICAgaXNNb250aFZpZXc6ICJtb250aCIgPT09IG8uY2FsZW5kYXJWaWV3TmFtZSwKICAgICAgICBob3VyU3RhcnQ6IG8uaG91clN0YXJ0LAogICAgICAgIGhvdXJFbmQ6IG8uaG91ckVuZAogICAgICB9KTsKICAgIH0sIF8ucHJvdG90eXBlLl9yZW5kZXJDaGlsZHJlbiA9IGZ1bmN0aW9uIChlLCB0LCBuLCBpKSB7CiAgICAgIHZhciByLAogICAgICAgICAgYywKICAgICAgICAgIHUsCiAgICAgICAgICBkLAogICAgICAgICAgcCA9IHRoaXMsCiAgICAgICAgICBtID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgZiA9IHMuZm9ybWF0KG5ldyB5KCksICJZWVlZTU1ERCIpLAogICAgICAgICAgZyA9IDA7CiAgICAgIG4uaW5uZXJIVE1MID0gIiIsIHRoaXMuY2hpbGRyZW4uY2xlYXIoKSwgZCA9IGEuZ2V0U2l6ZShuLnBhcmVudEVsZW1lbnQpWzFdLCBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUsIGwpIHsKICAgICAgICB1ID0gbCA9PT0gZiwgciA9IHsKICAgICAgICAgIGluZGV4OiBnLAogICAgICAgICAgbGVmdDogdFtnXSA/IHRbZ10ubGVmdCA6IDAsCiAgICAgICAgICB3aWR0aDogdFtnXSA/IHRbZ10ud2lkdGggOiAwLAogICAgICAgICAgeW1kOiBsLAogICAgICAgICAgaXNUb2RheTogdSwKICAgICAgICAgIGlzUGVuZGluZzogbS5pc1BlbmRpbmcsCiAgICAgICAgICBpc0ZvY3VzZWQ6IG0uaXNGb2N1c2VkLAogICAgICAgICAgaXNSZWFkT25seTogbS5pc1JlYWRPbmx5LAogICAgICAgICAgaG91clN0YXJ0OiBtLmhvdXJTdGFydCwKICAgICAgICAgIGhvdXJFbmQ6IG0uaG91ckVuZCwKICAgICAgICAgIGNhbGVuZGFyVmlld05hbWU6IG0uY2FsZW5kYXJWaWV3TmFtZQogICAgICAgIH0sIChjID0gbmV3IGgociwgYS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2Iiwgbiwgby5jbGFzc25hbWUoInRpbWUtZGF0ZSIpKSwgaSkpLnJlbmRlcihsLCBlLCBkKSwgcC5hZGRDaGlsZChjKSwgZyArPSAxOwogICAgICB9KTsKICAgIH0sIF8ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbiA9IGUuc2NoZWR1bGVzSW5EYXRlUmFuZ2VbdC52aWV3TmFtZV0sCiAgICAgICAgICBpID0gdGhpcy5jb250YWluZXIsCiAgICAgICAgICByID0gZS5ncmlkcywKICAgICAgICAgIHMgPSB0aGlzLl9nZXRCYXNlVmlld01vZGVsKGUpLAogICAgICAgICAgYyA9IGwua2V5cyhuKS5sZW5ndGg7CgogICAgICB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbCA9IGUsIHRoaXMuX2NhY2hlSG91cnNMYWJlbHMgPSBzLmhvdXJzTGFiZWxzLCBjICYmIChzLnNob3dIb3VyTWFya2VyID0gcy50b2RheW1hcmtlckxlZnQgPj0gMCwgaS5pbm5lckhUTUwgPSBtKHMpLCB0aGlzLnJlbmRlclN0aWNreUNvbnRhaW5lcihzKSwgdGhpcy5fcmVuZGVyQ2hpbGRyZW4obiwgciwgYS5maW5kKG8uY2xhc3NuYW1lKCIudGltZWdyaWQtc2NoZWR1bGVzLWNvbnRhaW5lciIpLCBpKSwgZS50aGVtZSksIHRoaXMuX2hvdXJMYWJlbHMgPSBhLmZpbmQoInVsIiwgaSksIHRoaXMuaG91cm1hcmtlcnMgPSBhLmZpbmQoby5jbGFzc25hbWUoIi50aW1lZ3JpZC1ob3VybWFya2VyIiksIGksICEwKSwgdGhpcy5fc2Nyb2xsZWQgfHwgKHRoaXMuX3Njcm9sbGVkID0gITAsIHRoaXMuc2Nyb2xsVG9Ob3coKSkpOwogICAgfSwgXy5wcm90b3R5cGUucmVuZGVyU3RpY2t5Q29udGFpbmVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLnN0aWNreUNvbnRhaW5lcjsKICAgICAgdC5pbm5lckhUTUwgPSBmKGUpLCB0LnN0eWxlLmRpc3BsYXkgPSBlLnRpbWV6b25lcy5sZW5ndGggPiAxID8gImJsb2NrIiA6ICJub25lIiwgdC5zdHlsZS53aWR0aCA9IGUuc3R5bGVzLmxlZnRXaWR0aCwgdC5zdHlsZS5oZWlnaHQgPSBlLnN0eWxlcy5kaXNwbGF5VGltZXpvbmVMYWJlbEhlaWdodCwgdC5zdHlsZS5ib3JkZXJCb3R0b20gPSBlLnN0eWxlcy5sZWZ0Qm9yZGVyUmlnaHQ7CiAgICB9LCBfLnByb3RvdHlwZS5yZWZyZXNoSG91cm1hcmtlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICB0ID0gdGhpcy5ob3VybWFya2VycywKICAgICAgICAgIG4gPSB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbCwKICAgICAgICAgIGkgPSB0aGlzLl9jYWNoZUhvdXJzTGFiZWxzLAogICAgICAgICAgciA9IHRoaXMuckFuaW1hdGlvbkZyYW1lSUQ7CiAgICAgIHQgJiYgbiAmJiAhciAmJiAoZSA9IHRoaXMuX2dldEJhc2VWaWV3TW9kZWwobiksIHRoaXMuckFuaW1hdGlvbkZyYW1lSUQgPSB1LnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciByID0gITE7CiAgICAgICAgbC5mb3JFYWNoKGksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5oaWRkZW4gPT09IGUuaG91cnNMYWJlbHNbbl0uaGlkZGVuIHx8IChyID0gITAsICExKTsKICAgICAgICB9KSwgciA/IHRoaXMucmVuZGVyKG4pIDogbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IGEuZmluZChvLmNsYXNzbmFtZSgiLnRpbWVncmlkLXRvZGF5bWFya2VyIiksIHQpLAogICAgICAgICAgICAgIGwgPSBhLmZpbmQoby5jbGFzc25hbWUoIi50aW1lZ3JpZC1ob3VybWFya2VyLXRpbWUiKSwgdCksCiAgICAgICAgICAgICAgaSA9IGEuY2xvc2VzdCh0LCBvLmNsYXNzbmFtZSgiLnRpbWVncmlkLXRpbWV6b25lIikpLAogICAgICAgICAgICAgIHIgPSBpID8gYS5nZXREYXRhKGksICJ0aW1lem9uZUluZGV4IikgOiAwOwogICAgICAgICAgdC5zdHlsZS50b3AgPSBlLmhvdXJtYXJrZXJUb3AgKyAiJSIsIG4gJiYgKG4uc3R5bGUuZGlzcGxheSA9IGUudG9kYXltYXJrZXJMZWZ0ID49IDAgPyAiYmxvY2siIDogIm5vbmUiKSwgbCAmJiAobC5pbm5lckhUTUwgPSBnKGUuaG91cm1hcmtlclRpbXpvbmVzW3JdKSk7CiAgICAgICAgfSksIHRoaXMuckFuaW1hdGlvbkZyYW1lSUQgPSBudWxsOwogICAgICB9LCB0aGlzKSk7CiAgICB9LCBfLnByb3RvdHlwZS5hdHRhY2hFdmVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSUQpLCBjbGVhclRpbWVvdXQodGhpcy50aW1lcklEKSwgdGhpcy5pbnRlcnZhbElEID0gdGhpcy50aW1lcklEID0gdGhpcy5yQW5pbWF0aW9uRnJhbWVJRCA9IG51bGwsIHRoaXMudGltZXJJRCA9IHNldFRpbWVvdXQobC5iaW5kKHRoaXMub25UaWNrLCB0aGlzKSwgMWUzICogKDYwIC0gbmV3IHkoKS5nZXRTZWNvbmRzKCkpKSwgci5vbih0aGlzLnN0aWNreUNvbnRhaW5lciwgImNsaWNrIiwgdGhpcy5fb25DbGlja1N0aWNreUNvbnRhaW5lciwgdGhpcyk7CiAgICB9LCBfLnByb3RvdHlwZS5zY3JvbGxUb05vdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBfbywKICAgICAgICAgIGkgPSB0aGlzLmNvbnRhaW5lcjsKCiAgICAgIHRoaXMuaG91cm1hcmtlcnMgJiYgdGhpcy5ob3VybWFya2Vycy5sZW5ndGggJiYgKGUgPSB0aGlzLmhvdXJtYXJrZXJzWzBdLm9mZnNldFRvcCwgdCA9IHRoaXMuZ2V0Vmlld0JvdW5kKCksIG4gPSBlLCBsID0gdC5oZWlnaHQgLyA0LCAxMCwgX28gPSBmdW5jdGlvbiBvKCkgewogICAgICAgIG4gPiBlIC0gbCA/IChuIC09IDEwLCBpLnNjcm9sbFRvcCA9IG4sIHUucmVxdWVzdEFuaW1GcmFtZShfbykpIDogaS5zY3JvbGxUb3AgPSBlIC0gbDsKICAgICAgfSwgdS5yZXF1ZXN0QW5pbUZyYW1lKF9vKSk7CiAgICB9LCBfLnByb3RvdHlwZS5vblRpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMudGltZXJJRCAmJiAoY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJRCksIHRoaXMudGltZXJJRCA9IG51bGwpLCB0aGlzLmludGVydmFsSUQgfHwgKHRoaXMuaW50ZXJ2YWxJRCA9IHNldEludGVydmFsKGwuYmluZCh0aGlzLm9uVGljaywgdGhpcyksIDZlNCkpLCB0aGlzLnJlZnJlc2hIb3VybWFya2VyKCk7CiAgICB9LCBfLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0ge30sCiAgICAgICAgICBvID0gdGhpcy5vcHRpb25zLnRpbWV6b25lcy5sZW5ndGgsCiAgICAgICAgICBhID0gdDsKICAgICAgcmV0dXJuIGUgJiYgKGwuYm9yZGVyQm90dG9tID0gZS53ZWVrLnRpbWVncmlkSG9yaXpvbnRhbExpbmUuYm9yZGVyQm90dG9tIHx8IGUuY29tbW9uLmJvcmRlciwgbC5oYWxmSG91ckJvcmRlckJvdHRvbSA9IGUud2Vlay50aW1lZ3JpZEhhbGZIb3VyLmJvcmRlckJvdHRvbSB8fCBlLmNvbW1vbi5ib3JkZXIsIGwudG9kYXlCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsudG9kYXkuYmFja2dyb3VuZENvbG9yLCBsLndlZWtlbmRCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsud2Vla2VuZC5iYWNrZ3JvdW5kQ29sb3IsIGwuYmFja2dyb3VuZENvbG9yID0gZS53ZWVrLmRheWdyaWQuYmFja2dyb3VuZENvbG9yLCBsLmxlZnRXaWR0aCA9IGUud2Vlay50aW1lZ3JpZExlZnQud2lkdGgsIGwubGVmdEJhY2tncm91bmRDb2xvciA9IGUud2Vlay50aW1lZ3JpZExlZnQuYmFja2dyb3VuZENvbG9yLCBsLmxlZnRCb3JkZXJSaWdodCA9IGUud2Vlay50aW1lZ3JpZExlZnQuYm9yZGVyUmlnaHQgfHwgZS5jb21tb24uYm9yZGVyLCBsLmxlZnRGb250U2l6ZSA9IGUud2Vlay50aW1lZ3JpZExlZnQuZm9udFNpemUsIGwudGltZXpvbmVXaWR0aCA9IGUud2Vlay50aW1lZ3JpZExlZnQud2lkdGgsIGwuYWRkaXRpb25hbFRpbWV6b25lQmFja2dyb3VuZENvbG9yID0gZS53ZWVrLnRpbWVncmlkTGVmdEFkZGl0aW9uYWxUaW1lem9uZS5iYWNrZ3JvdW5kQ29sb3IgfHwgbC5sZWZ0QmFja2dyb3VuZENvbG9yLCBsLmRpc3BsYXlUaW1lem9uZUxhYmVsSGVpZ2h0ID0gZS53ZWVrLnRpbWVncmlkTGVmdFRpbWV6b25lTGFiZWwuaGVpZ2h0LCBsLmRpc3BsYXlUaW1lem9uZUxhYmVsQmFja2dyb3VuZENvbG9yID0gImluaGVyaXQiID09PSBlLndlZWsudGltZWdyaWRMZWZ0LmJhY2tncm91bmRDb2xvciA/ICJ3aGl0ZSIgOiBlLndlZWsudGltZWdyaWRMZWZ0LmJhY2tncm91bmRDb2xvciwgbC5vbmVIb3VySGVpZ2h0ID0gZS53ZWVrLnRpbWVncmlkT25lSG91ci5oZWlnaHQsIGwuaGFsZkhvdXJIZWlnaHQgPSBlLndlZWsudGltZWdyaWRIYWxmSG91ci5oZWlnaHQsIGwucXVhdGVySG91ckhlaWdodCA9IHBhcnNlSW50KGwuaGFsZkhvdXJIZWlnaHQsIDEwKSAvIDIgKyAicHgiLCBsLmN1cnJlbnRUaW1lQ29sb3IgPSBlLndlZWsuY3VycmVudFRpbWUuY29sb3IsIGwuY3VycmVudFRpbWVGb250U2l6ZSA9IGUud2Vlay5jdXJyZW50VGltZS5mb250U2l6ZSwgbC5jdXJyZW50VGltZUZvbnRXZWlnaHQgPSBlLndlZWsuY3VycmVudFRpbWUuZm9udFdlaWdodCwgbC5wYXN0VGltZUNvbG9yID0gZS53ZWVrLnBhc3RUaW1lLmNvbG9yLCBsLnBhc3RUaW1lRm9udFdlaWdodCA9IGUud2Vlay5wYXN0VGltZS5mb250V2VpZ2h0LCBsLmZ1dHVyZVRpbWVDb2xvciA9IGUud2Vlay5mdXR1cmVUaW1lLmNvbG9yLCBsLmZ1dHVyZVRpbWVGb250V2VpZ2h0ID0gZS53ZWVrLmZ1dHVyZVRpbWUuZm9udFdlaWdodCwgbC5jdXJyZW50VGltZUxlZnRCb3JkZXJUb3AgPSBlLndlZWsuY3VycmVudFRpbWVMaW5lUGFzdC5ib3JkZXIsIGwuY3VycmVudFRpbWVCdWxsZXRCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsuY3VycmVudFRpbWVMaW5lQnVsbGV0LmJhY2tncm91bmRDb2xvciwgbC5jdXJyZW50VGltZVRvZGF5Qm9yZGVyVG9wID0gZS53ZWVrLmN1cnJlbnRUaW1lTGluZVRvZGF5LmJvcmRlciwgbC5jdXJyZW50VGltZVJpZ2h0Qm9yZGVyVG9wID0gZS53ZWVrLmN1cnJlbnRUaW1lTGluZUZ1dHVyZS5ib3JkZXIsICFhICYmIG8gPiAxICYmIChuID0gaS5wYXJzZVVuaXQobC5sZWZ0V2lkdGgpLCBsLmxlZnRXaWR0aCA9IG5bMF0gKiBvICsgblsxXSkpLCBsOwogICAgfSwgXy5wcm90b3R5cGUuX29uQ2xpY2tTdGlja3lDb250YWluZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHIuZ2V0RXZlbnRUYXJnZXQoZSk7CiAgICAgIGEuY2xvc2VzdCh0LCBvLmNsYXNzbmFtZSgiLnRpbWVncmlkLXRpbWV6b25lLWNsb3NlLWJ0biIpKSAmJiB0aGlzLmZpcmUoImNsaWNrVGltZXpvbmVzQ29sbGFwc2VkQnRuIik7CiAgICB9LCBlLmV4cG9ydHMgPSBfOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDgpLAogICAgICAgIHMgPSBuKDc0KSwKICAgICAgICBjID0gbC5mb3JFYWNoQXJyYXksCiAgICAgICAgdSA9IGkuTUlMTElTRUNPTkRTX1NDSEVEVUxFX01JTl9EVVJBVElPTjsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgci5jYWxsKHRoaXMsIHQpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgaW5kZXg6IDAsCiAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgeW1kOiAiIiwKICAgICAgICBpc1RvZGF5OiAhMSwKICAgICAgICBwZW5kaW5nOiAhMSwKICAgICAgICBob3VyU3RhcnQ6IDAsCiAgICAgICAgaG91ckVuZDogMjQsCiAgICAgICAgZGVmYXVsdE1hcmdpbkJvdHRvbTogMiwKICAgICAgICBtaW5IZWlnaHQ6IDE4LjUsCiAgICAgICAgaXNSZWFkT25seTogITEKICAgICAgfSwgZSksIHRoaXMudGltZVRtcGwgPSBzLCB0aGlzLnRoZW1lID0gbiwgdC5zdHlsZS53aWR0aCA9IGUud2lkdGggKyAiJSIsIHQuc3R5bGUubGVmdCA9IGUubGVmdCArICIlIiwgdGhpcy5vcHRpb25zLmlzVG9kYXkgJiYgYS5hZGRDbGFzcyh0aGlzLmNvbnRhaW5lciwgby5jbGFzc25hbWUoInRvZGF5IikpLCB0aGlzLmFwcGx5VGhlbWUoKTsKICAgIH0KCiAgICBsLmluaGVyaXQoZCwgciksIGQucHJvdG90eXBlLl9wYXJzZURhdGVHcm91cCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gcGFyc2VJbnQoZS5zdWJzdHIoMCwgNCksIDEwKSwKICAgICAgICAgIG4gPSBwYXJzZUludChlLnN1YnN0cig0LCAyKSwgMTApLAogICAgICAgICAgbCA9IHBhcnNlSW50KGUuc3Vic3RyKDYsIDIpLCAxMCksCiAgICAgICAgICBvID0gaS5zdGFydCgpOwogICAgICByZXR1cm4gby5zZXRGdWxsWWVhcih0LCBuIC0gMSwgbCksIGkuc3RhcnQobyk7CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0U2NoZWR1bGVWaWV3Qm91bmRYID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0gbmV3IERhdGUodC50b2RheVN0YXJ0Ll9kYXRlKS5nZXRIb3VycygpLAogICAgICAgICAgbyA9IG5ldyBEYXRlKGUubW9kZWwuc3RhcnQuX2RhdGUpLmdldEhvdXJzKCksCiAgICAgICAgICBpID0gdC5iYXNlV2lkdGggKiAoZS5leHRyYVNwYWNlICsgMSk7CiAgICAgIHJldHVybiBlLmhhc0NvbGxpZGUgfHwgKGkgPSBudWxsKSwgbiA9IDEwICogKG8gLSBsKSArIDEsIHsKICAgICAgICBsZWZ0OiAiZGF5IiA9PT0gdGhpcy5vcHRpb25zLmNhbGVuZGFyVmlld05hbWUgPyBuIDogdC5iYXNlTGVmdFt0LmNvbHVtbkluZGV4XSwKICAgICAgICB3aWR0aDogaQogICAgICB9OwogICAgfSwgZC5wcm90b3R5cGUuX2dldFNjaGVkdWxlVmlld0JvdW5kWSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBhLAogICAgICAgICAgciA9IHQuYmFzZU1TLAogICAgICAgICAgcyA9IHQuYmFzZUhlaWdodCwKICAgICAgICAgIGMgPSAhMSwKICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgIGggPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLnZhbHVlT2YoKS5nb2luZ0R1cmF0aW9uKSwKICAgICAgICAgIHAgPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLnZhbHVlT2YoKS5jb21pbmdEdXJhdGlvbiksCiAgICAgICAgICBtID0gZS52YWx1ZU9mKCkuc3RhcnQgLSBoIC0gdC50b2RheVN0YXJ0LAogICAgICAgICAgZiA9IHRoaXMub3B0aW9ucy5jYWxlbmRhclZpZXdOYW1lLAogICAgICAgICAgZyA9IHMgKiBtIC8gciwKICAgICAgICAgIHkgPSBlLmR1cmF0aW9uKCk7CiAgICAgIHJldHVybiBuID0gcyAqICgoeSA9IHkgPiB1ID8geSA6IHUpICsgaCArIHApIC8gciwgbCA9IHMgKiBoIC8gciwgbyA9IHMgKiB5IC8gciwgYSA9IHMgKiBwIC8gciwgbSA8IDAgJiYgKGcgPSAwLCBuICs9IHMgKiBtIC8gciwgYyA9ICEwKSwgbiArIGcgPiBzICYmIChuID0gcyAtIGcsIGQgPSAhMCksIHsKICAgICAgICB0b3A6IGcsCiAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChuLCB0aGlzLm9wdGlvbnMubWluSGVpZ2h0KSAtIHRoaXMub3B0aW9ucy5kZWZhdWx0TWFyZ2luQm90dG9tLAogICAgICAgIG1vZGVsRHVyYXRpb25IZWlnaHQ6IG8sCiAgICAgICAgZ29pbmdEdXJhdGlvbkhlaWdodDogbCwKICAgICAgICBjb21pbmdEdXJhdGlvbkhlaWdodDogYSwKICAgICAgICBoYXNHb2luZ0R1cmF0aW9uOiBoID4gMCwKICAgICAgICBoYXNDb21pbmdEdXJhdGlvbjogcCA+IDAsCiAgICAgICAgY3JvcHBlZFN0YXJ0OiBjLAogICAgICAgIGNyb3BwZWRFbmQ6IGQsCiAgICAgICAgY2FsZW5kYXJWaWV3TmFtZTogZiwKICAgICAgICBpc0RheVZpZXc6ICJkYXkiID09PSBmLAogICAgICAgIGlzV2Vla1ZpZXc6ICJ3ZWVrIiA9PT0gZiwKICAgICAgICBpc01vbnRoVmlldzogIm1vbnRoIiA9PT0gZiwKICAgICAgICBob3VyU3RhcnQ6IHRoaXMub3B0aW9ucy5ob3VyU3RhcnQsCiAgICAgICAgaG91ckVuZDogdGhpcy5vcHRpb25zLmhvdXJFbmQKICAgICAgfTsKICAgIH0sIGQucHJvdG90eXBlLmdldFNjaGVkdWxlVmlld0JvdW5kID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLl9nZXRTY2hlZHVsZVZpZXdCb3VuZFgoZSwgdCksCiAgICAgICAgICBvID0gdGhpcy5fZ2V0U2NoZWR1bGVWaWV3Qm91bmRZKGUsIHQpLAogICAgICAgICAgaSA9IGUubW9kZWwsCiAgICAgICAgICBhID0gbC5waWNrKGksICJpc1JlYWRPbmx5IikgfHwgITEsCiAgICAgICAgICByID0gaS5pc0ZvY3VzZWQgPyAiI2ZmZmZmZiIgOiBpLmJvcmRlckNvbG9yOwoKICAgICAgcmV0dXJuIHIgPT09IGkuYmdDb2xvciAmJiAociA9IG51bGwpLCBsLmV4dGVuZCh7CiAgICAgICAgaXNSZWFkT25seTogYSwKICAgICAgICB0cmF2ZWxCb3JkZXJDb2xvcjogcgogICAgICB9LCBuLCBvKTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXRCYXNlVmlld01vZGVsID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBhLAogICAgICAgICAgciA9IHRoaXMsCiAgICAgICAgICBzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgdSA9IHMuaG91clN0YXJ0LAogICAgICAgICAgZCA9IHMuaG91ckVuZCwKICAgICAgICAgIGggPSBzLmlzUmVhZE9ubHk7CiAgICAgIG4gPSBuIHx8IHRoaXMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LCAobyA9IHRoaXMuX3BhcnNlRGF0ZUdyb3VwKGUpKS5zZXRIb3Vycyh1KSwgYSA9IGkubWlsbGlzZWNvbmRzRnJvbSgiaG91ciIsIGQgLSB1KSwgYyh0LCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LCBpLCBzLCB1OwoKICAgICAgICBmb3IgKHQgPSBNYXRoLm1heC5hcHBseShudWxsLCBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGUubGVuZ3RoOwogICAgICAgIH0pKSwgaSA9IDEwMCAvIHQsIHMgPSBbXSwgdSA9IDA7IHUgPCB0OyB1ICs9IDEpIHsKICAgICAgICAgIHNbdV0gPSBpICogdTsKICAgICAgICB9CgogICAgICAgIGMoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGMoZSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgIGUgJiYgKGMgPSByLmdldFNjaGVkdWxlVmlld0JvdW5kKGUsIHsKICAgICAgICAgICAgICB0b2RheVN0YXJ0OiBvLAogICAgICAgICAgICAgIGJhc2VNUzogYSwKICAgICAgICAgICAgICBiYXNlTGVmdDogcywKICAgICAgICAgICAgICBiYXNlV2lkdGg6IGksCiAgICAgICAgICAgICAgYmFzZUhlaWdodDogbiwKICAgICAgICAgICAgICBjb2x1bW5JbmRleDogdCwKICAgICAgICAgICAgICBpc1JlYWRPbmx5OiBoCiAgICAgICAgICAgIH0pLCBsLmV4dGVuZChlLCBjKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBkLnByb3RvdHlwZS5nZXREYXRlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fcGFyc2VEYXRlR3JvdXAodGhpcy5vcHRpb25zLnltZCk7CiAgICB9LCBkLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB0aGlzLl9nZXRCYXNlVmlld01vZGVsKGUsIHQsIG4pLCB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSB0aGlzLnRpbWVUbXBsKHsKICAgICAgICBtYXRyaWNlczogdCwKICAgICAgICBzdHlsZXM6IHRoaXMuX2dldFN0eWxlcyh0aGlzLnRoZW1lKSwKICAgICAgICBpc1JlYWRPbmx5OiB0aGlzLm9wdGlvbnMuaXNSZWFkT25seSwKICAgICAgICBjYWxlbmRhclZpZXdOYW1lOiB0aGlzLm9wdGlvbnMuY2FsZW5kYXJWaWV3TmFtZQogICAgICB9KTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXRTdHlsZXMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHt9LAogICAgICAgICAgbiA9IHRoaXMub3B0aW9uczsKICAgICAgcmV0dXJuIGUgJiYgKHQuYm9yZGVyUmlnaHQgPSBlLndlZWsudGltZWdyaWQuYm9yZGVyUmlnaHQgfHwgZS5jb21tb24uYm9yZGVyLCB0Lm1hcmdpblJpZ2h0ID0gZS53ZWVrLnRpbWVncmlkLnBhZGRpbmdSaWdodCwgdC5ib3JkZXJSYWRpdXMgPSBlLndlZWsudGltZWdyaWRTY2hlZHVsZS5ib3JkZXJSYWRpdXMsIHQucGFkZGluZ0xlZnQgPSBlLndlZWsudGltZWdyaWRTY2hlZHVsZS5wYWRkaW5nTGVmdCwgdC5iYWNrZ3JvdW5kQ29sb3IgPSBuLmlzVG9kYXkgPyBlLndlZWsudG9kYXkuYmFja2dyb3VuZENvbG9yIDogImluaGVyaXQiKSwgdDsKICAgIH0sIGQucHJvdG90eXBlLmFwcGx5VGhlbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5jb250YWluZXIuc3R5bGUsCiAgICAgICAgICB0ID0gdGhpcy5fZ2V0U3R5bGVzKHRoaXMudGhlbWUpOwoKICAgICAgZS5ib3JkZXJSaWdodCA9IHQuYm9yZGVyUmlnaHQsIGUuYmFja2dyb3VuZENvbG9yID0gdC5iYWNrZ3JvdW5kQ29sb3I7CiAgICB9LCBlLmV4cG9ydHMgPSBkOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICJwYWRkaW5nLXRvcDo1MHB4IjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImVhY2giKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICA0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaTsKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IChlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9KShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MywKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICA2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2sgIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc1BlbmRpbmciKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDU1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICBkYXRhLWlkPSInICsgdSgoaChuLCAic3RhbXAiKSB8fCB0ICYmIGgodCwgInN0YW1wIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInN0YW1wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAxNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICciIHN0eWxlPSInICsgdSgoaChuLCAidGltZS1zY2hlZHVsZUJsb2NrIikgfHwgdCAmJiBoKHQsICJ0aW1lLXNjaGVkdWxlQmxvY2siKSB8fCBzKS5jYWxsKHIsIHQsIG51bGwgIT0gdCA/IGgodCwgImlzRGF5VmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogInRpbWUtc2NoZWR1bGVCbG9jayIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gKGgobiwgImZpIikgfHwgdCAmJiBoKHQsICJmaSIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibGVmdCIpIDogdCwgIiE9PSIsIDAsIHsKICAgICAgICAgIG5hbWU6ICJmaSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNEYXlWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDExLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgxMywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgICAgICB3aWR0aDogMTAycHggIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICBkaXNwbGF5OmlubGluZS1mbGV4O1xuICAgICAgICAgICAgICAgIHotaW5kZXg6OTk7XG4gICAgICAgICAgICAiPlxuICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogNXB4O2hlaWdodDogNXB4O2JhY2tncm91bmQ6ICNGRjNGM0YgMCUgMCUgbm8tcmVwZWF0IHBhZGRpbmctYm94O1xuICAgICAgICBib3JkZXItcmFkaXVzOjUwJTtwb3NpdGlvbjpyZWxhdGl2ZTtyaWdodDogNXB4O3RvcDogNXB4Ij5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgZGF0YS1zY2hlZHVsZS1pZD0iJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciXG4gICAgICAgICAgICBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ0aW1lLXNjaGVkdWxlICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDE2LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMTEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgICAgIHN0eWxlPSJcbiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7XG4gICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMHB4IDFweCA1cHggIzAwMDAwMDI5O1xuJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDIwLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc1dlZWtWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM5LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgICAgICAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpdGxlLWF2YXRhciIgc3R5bGU9IlxuJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzV2Vla1ZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjQsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPicgKyB1KChoKG4sICJ0aXRsZUF2YXRhci10bXBsIikgfHwgdCAmJiBoKHQsICJ0aXRsZUF2YXRhci10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAidGl0bGUiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJ0aXRsZUF2YXRhci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgIjwvZGl2PlxuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImhhc0dvaW5nRHVyYXRpb24iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjYsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUtY29udGVudCAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtc2NoZWR1bGUtY29udGVudC10aW1lIiBzdHlsZT0iXG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNEYXlWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgzMywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MSwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaGFzQ29taW5nRHVyYXRpb24iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMzYsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA5NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPlxuICAgICAgICAgICAgICAgICcgKyAobnVsbCAhPSAoaSA9IChoKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGgodCwgInRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MywKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPVwiZm9udDogMTBweCAnU2Vnb2UgVUkgU2VtaWJvbGQnOyBsZXR0ZXItc3BhY2luZzogMHB4OyBjb2xvcjpcbiAgICAgICAgICAgICAgICAgICAgIzVCNUI1QiAhaW1wb3J0YW50O3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZVwiPiIgKyB1KChoKG4sICJkaXNwbGF5UGhvbmUtdG1wbCIpIHx8IHQgJiYgaCh0LCAiZGlzcGxheVBob25lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZGlzcGxheVBob25lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjUsCiAgICAgICAgICAgICAgY29sdW1uOiA2NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NSwKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiPC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4iICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaGFzQ29taW5nRHVyYXRpb24iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMzgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY3LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzgsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgIDwvZGl2PlxuICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJ1bmxlc3MiKS5jYWxsKHIsIChoKG4sICJvciIpIHx8IHQgJiYgaCh0LCAib3IiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImNyb3BwZWRFbmQiKSA6IHQsIChoKG4sICJvciIpIHx8IHQgJiYgaCh0LCAib3IiKSB8fCBzKS5jYWxsKHIsIChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgImlzUmVhZE9ubHkiKSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzUmVhZE9ubHkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MCwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCB7CiAgICAgICAgICBuYW1lOiAib3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogODAsCiAgICAgICAgICAgICAgY29sdW1uOiAxOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MCwKICAgICAgICAgICAgICBjb2x1bW46IDcyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MCwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA3OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogOTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAidGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLXBlbmRpbmciOwogICAgICB9LAogICAgICA5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAicGFkZGluZ0xlZnQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwNXB4ICFpbXBvcnRhbnQ7XG4iOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAiaXNXZWVrVmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDE0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBoZWlnaHQ6IDQycHggIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICAiOwogICAgICB9LAogICAgICAxNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogNzAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiA4NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ0aW1lLXNjaGVkdWxlLWZvY3VzZWQgIjsKICAgICAgfSwKICAgICAgMTg6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyBib3JkZXItY29sb3I6IiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiY29sb3IiKSA6IGksIHQpKSArICI7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyODM4NzcgMCUgMCUgbm8tcmVwZWF0IHBhZGRpbmctYm94O1xuIjsKICAgICAgfSwKICAgICAgMjA6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBjb2xvcjojMjgzODc3OyBib3JkZXI6IDFweCBzb2xpZCAjRkYzRjNGO1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGIDAlIDAlIG5vLXJlcGVhdCBwYWRkaW5nLWJveDtcbiI7CiAgICAgIH0sCiAgICAgIDIyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4XG4iOwogICAgICB9LAogICAgICAyNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDZweDtcbiAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDZweDtcbiAgICAgICAgICAgICAgICAiOwogICAgICB9LAogICAgICAyNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUtY29udGVudCAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1zY2hlZHVsZS1jb250ZW50LXRyYXZlbC10aW1lIiBzdHlsZT0iaGVpZ2h0OiAnICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJnb2luZ0R1cmF0aW9uSGVpZ2h0IikgfHwgKG51bGwgIT0gdCA/IHUodCwgImdvaW5nRHVyYXRpb25IZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiZ29pbmdEdXJhdGlvbkhlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDEyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDE0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJweDtcbiIgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQpID8gdShpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDI3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgyOSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggZGFzaGVkICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgInRyYXZlbEJvcmRlckNvbG9yIikgfHwgKG51bGwgIT0gdCA/IHUodCwgInRyYXZlbEJvcmRlckNvbG9yIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRyYXZlbEJvcmRlckNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUzLAogICAgICAgICAgICAgIGNvbHVtbjogNDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAiZ29pbmdEdXJhdGlvbi10bXBsIikgfHwgdCAmJiB1KHQsICJnb2luZ0R1cmF0aW9uLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZ29pbmdEdXJhdGlvbi10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUzLAogICAgICAgICAgICAgIGNvbHVtbjogNjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA5NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDI3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBib3JkZXItY29sb3I6IiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiY29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMzE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGhlaWdodDogMTA1cHg7XG4gICAgICAgICAgICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7XG4iOwogICAgICB9LAogICAgICAzMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAiaXNXZWVrVmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDM0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBoZWlnaHQ6IDQycHg7XG4gICAgICAgICAgICAgICAgIjsKICAgICAgfSwKICAgICAgMzY6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICJib3JkZXItYm90dG9tOiAxcHggZGFzaGVkICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAidHJhdmVsQm9yZGVyQ29sb3IiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAidHJhdmVsQm9yZGVyQ29sb3IiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAidHJhdmVsQm9yZGVyQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA2NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDg4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIjsiOwogICAgICB9LAogICAgICAzODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUtY29udGVudCAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1zY2hlZHVsZS1jb250ZW50LXRyYXZlbC10aW1lIiBzdHlsZT0iXG4nICsgKG51bGwgIT0gKGkgPSB1KG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiaXNEYXlWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDM5LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgzMywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MywKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSB1KG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgIm1vZGVsIikgOiB0KSA/IHUoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0MSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oNDMsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc7Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAiY29taW5nRHVyYXRpb24tdG1wbCIpIHx8IHQgJiYgdSh0LCAiY29taW5nRHVyYXRpb24tdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJjb21pbmdEdXJhdGlvbi10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc2LAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzYsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMzk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGhlaWdodDogMTA1cHg7XG4iOwogICAgICB9LAogICAgICA0MTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9LAogICAgICA0MzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0idGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLXdyYXAiIHN0eWxlPSJtYXJnaW4tcmlnaHQ6ICcgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHIodCwgInN0eWxlcyIpIDogdCkgPyByKGksICJtYXJnaW5SaWdodCIpIDogaSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IHIobiwgImlmIikuY2FsbChhLCBudWxsICE9IHQgPyByKHQsICJpc0RheVZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+XG4nICsgKG51bGwgIT0gKGkgPSByKG4sICJlYWNoIikuY2FsbChhLCBudWxsICE9IHQgPyByKHQsICJtYXRyaWNlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDg1LAogICAgICAgICAgICAgIGNvbHVtbjogMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+IjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsID0gbigwKSwKICAgICAgICAgIG8gPSBuKDYpLAogICAgICAgICAgaSA9IG4oMSksCiAgICAgICAgICBhID0gbigzMSk7CgogICAgICBmdW5jdGlvbiByKGUpIHsKICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGUsIHRoaXMuX2RpcmVjdGlvbiA9IHIuRElSRUNUSU9OLklOU0lERSwgdGhpcy5fb2Zmc2V0ID0gMCwgdGhpcy5faW50ZXJ2YWxJRCA9IDAsIG8ub24oZSwgewogICAgICAgICAgbW91c2Vkb3duOiB0aGlzLl9vbk1vdXNlRG93bgogICAgICAgIH0sIHRoaXMpOwogICAgICB9CgogICAgICByLkRJUkVDVElPTiA9IHsKICAgICAgICBJTlNJREU6IDAsCiAgICAgICAgVE9QOiAxLAogICAgICAgIFJJR0hUOiAyLAogICAgICAgIEJPVFRPTTogMywKICAgICAgICBMRUZUOiA0CiAgICAgIH0sIHIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgby5vZmYodGhpcy5jb250YWluZXIsIHsKICAgICAgICAgIG1vdXNlZG93bjogdGhpcy5fb25Nb3VzZURvd24sCiAgICAgICAgICBtb3VzZW1vdmU6IHRoaXMuX29uTW91c2VNb3ZlLAogICAgICAgICAgbW91c2V1cDogdGhpcy5fb25Nb3VzZVVwCiAgICAgICAgfSwgdGhpcyksIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsSUQpLCB0aGlzLl9pbnRlcnZhbElEID0gdGhpcy5fZGlyZWN0aW9uID0gdGhpcy5jb250YWluZXIgPSBudWxsOwogICAgICB9LCByLnByb3RvdHlwZS5fZ2V0RWRnZVBvc2l0aW9ucyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvcDogZS50b3AsCiAgICAgICAgICByaWdodDogZS5sZWZ0ICsgZS53aWR0aCwKICAgICAgICAgIGJvdHRvbTogZS5ib3R0b20sCiAgICAgICAgICBsZWZ0OiBlLmxlZnQKICAgICAgICB9OwogICAgICB9LCByLnByb3RvdHlwZS5nZXRSZWFsU2l6ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGwgPSBpLmdldENvbXB1dGVkU3R5bGUoZSk7CiAgICAgICAgcmV0dXJuIHQgPSBwYXJzZUZsb2F0KGwuZ2V0UHJvcGVydHlWYWx1ZSgiYm9yZGVyLXRvcC13aWR0aCIpKSArIHBhcnNlRmxvYXQobC5nZXRQcm9wZXJ0eVZhbHVlKCJib3JkZXItYm90dG9tLXdpZHRoIikpLCBuID0gcGFyc2VGbG9hdChsLmdldFByb3BlcnR5VmFsdWUoInBhZGRpbmctdG9wIikpICsgcGFyc2VGbG9hdChsLmdldFByb3BlcnR5VmFsdWUoInBhZGRpbmctYm90dG9tIikpLCBbZS5jbGllbnRXaWR0aCArIHQgKyBuLCBlLmNsaWVudEhlaWdodCArIHQgKyBuXTsKICAgICAgfSwgci5wcm90b3R5cGUuaGFzU2Nyb2xsYmFyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuZ2V0UmVhbFNpemUoZSk7CiAgICAgICAgcmV0dXJuIFtlLm9mZnNldFdpZHRoID4gTWF0aC5jZWlsKHRbMF0pLCBlLm9mZnNldEhlaWdodCA+IE1hdGguY2VpbCh0WzFdKV07CiAgICAgIH0sIHIucHJvdG90eXBlLmlzT25TY3JvbGxiYXIgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciBuID0gdGhpcy5nZXRSZWFsU2l6ZShlKSwKICAgICAgICAgICAgbCA9IG8uZ2V0TW91c2VQb3NpdGlvbih0LCBlKTsKICAgICAgICByZXR1cm4gblswXSAtIDIgPCBsWzBdIHx8IG5bMV0gLSAyIDwgbFsxXTsKICAgICAgfSwgci5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAwID09PSBvLmdldE1vdXNlQnV0dG9uKGUpICYmIChsLmJyb3dzZXIubXNpZSAmJiB0aGlzLmlzT25TY3JvbGxiYXIodGhpcy5jb250YWluZXIsIGUpIHx8ICh3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl9pbnRlcnZhbElEKSwgdGhpcy5faW50ZXJ2YWxJRCA9IHdpbmRvdy5zZXRJbnRlcnZhbChsLmJpbmQodGhpcy5fb25UaWNrLCB0aGlzKSwgMzApLCBvLm9uKHQsIHsKICAgICAgICAgIG1vdXNlbW92ZTogdGhpcy5fb25Nb3VzZU1vdmUsCiAgICAgICAgICBtb3VzZXVwOiB0aGlzLl9vbk1vdXNlVXAKICAgICAgICB9LCB0aGlzKSkpOwogICAgICB9LCByLnByb3RvdHlwZS5fb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5fZ2V0RWRnZVBvc2l0aW9ucyh0aGlzLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSksCiAgICAgICAgICAgIG4gPSBhLm4oby5nZXRNb3VzZVBvc2l0aW9uKGUpKTsKCiAgICAgICAgaWYgKG4ueSA+PSB0LnRvcCAmJiBuLnkgPD0gdC5ib3R0b20gJiYgbi54ID49IHQubGVmdCAmJiBuLnggPD0gdC5yaWdodCkgdGhpcy5fZGlyZWN0aW9uID0gci5ESVJFQ1RJT04uSU5TSURFO2Vsc2UgewogICAgICAgICAgaWYgKG4ueSA8IHQudG9wKSByZXR1cm4gdGhpcy5fZGlyZWN0aW9uID0gci5ESVJFQ1RJT04uVE9QLCB2b2lkICh0aGlzLl9vZmZzZXQgPSB0LnRvcCAtIG4ueSk7CiAgICAgICAgICBpZiAobi55ID4gdC5ib3R0b20pIHJldHVybiB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5CT1RUT00sIHZvaWQgKHRoaXMuX29mZnNldCA9IG4ueSAtIHQuYm90dG9tKTsKICAgICAgICAgIGlmIChuLnggPCB0LmxlZnQpIHJldHVybiB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5MRUZULCB2b2lkICh0aGlzLl9vZmZzZXQgPSB0LmxlZnQgLSBuLngpOwogICAgICAgICAgdGhpcy5fZGlyZWN0aW9uID0gci5ESVJFQ1RJT04uUklHSFQsIHRoaXMuX29mZnNldCA9IG4ueCAtIHQucmlnaHQ7CiAgICAgICAgfQogICAgICB9LCByLnByb3RvdHlwZS5fb25Nb3VzZVVwID0gZnVuY3Rpb24gKCkgewogICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsSUQpLCB0aGlzLl9pbnRlcnZhbElEID0gMCwgdGhpcy5fZGlyZWN0aW9uID0gci5ESVJFQ1RJT04uSU5TSURFLCB0aGlzLl9vZmZzZXQgPSAwLCBvLm9mZih0LCB7CiAgICAgICAgICBtb3VzZW1vdmU6IHRoaXMuX29uTW91c2VNb3ZlLAogICAgICAgICAgbW91c2V1cDogdGhpcy5fb25Nb3VzZVVwCiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vblRpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHQsCiAgICAgICAgICAgIG4gPSB0aGlzLl9kaXJlY3Rpb247CiAgICAgICAgaWYgKG4pIHN3aXRjaCAoZSA9IHRoaXMuY29udGFpbmVyLCB0ID0gTWF0aC5taW4odGhpcy5fb2Zmc2V0LCAxNSksIG4pIHsKICAgICAgICAgIGNhc2Ugci5ESVJFQ1RJT04uVE9QOgogICAgICAgICAgICBlLnNjcm9sbFRvcCAtPSB0OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIHIuRElSRUNUSU9OLlJJR0hUOgogICAgICAgICAgICBlLnNjcm9sbExlZnQgKz0gdDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSByLkRJUkVDVElPTi5CT1RUT006CiAgICAgICAgICAgIGUuc2Nyb2xsVG9wICs9IHQ7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGUuc2Nyb2xsTGVmdCAtPSB0OwogICAgICAgIH0KICAgICAgfSwgZS5leHBvcnRzID0gcjsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBjID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2PlxuICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGZsZXg7Zm9udC1zaXplOiAnICsgcihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImxlZnRGb250U2l6ZSIpIDogaSwgdCkpICsgJyI+XG4nICsgKG51bGwgIT0gKGkgPSB1KG4sICJlYWNoIikuY2FsbChzLCBudWxsICE9IHQgPyB1KHQsICJ0aW1lem9uZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzwvZGl2PlxuICAgIDxkaXYgY2xhc3M9IicgKyByKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGMpID8gYS5jYWxsKHMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1yaWdodCI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyByKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGMpID8gYS5jYWxsKHMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1oLWdyaWQiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyI+XG4nICsgKG51bGwgIT0gKGkgPSB1KG4sICJlYWNoIikuY2FsbChzLCBudWxsICE9IHQgPyB1KHQsICJob3Vyc0xhYmVscyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImVhY2giKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJ0aW1lU2xvdHMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgc3R5bGU9ImRpc3BsYXk6YmxvY2s7IHdpZHRoOjEwJSI+XG4gICAgICAgICAgICA8ZGl2IHN0eWxlPSJoZWlnaHQ6MjBweCI+XG4gICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OiAxMDAlOyBjb2xvcjogIzk1OTU5NTsgZm9udC13ZWlnaHQ6ICcgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImZvbnRXZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiZm9udFdlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJmb250V2VpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnOyBmb250OiAxMHB4O1xuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nLWxlZnQ6NXB4O1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDphdXRvO21hcmdpbi1yaWdodDphdXRvO1xuICAgICAgICAgICAgICAgICAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNERkRGREY7dGV4dC1hbGlnbjpsZWZ0Ij5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyI+JyArIChudWxsICE9IChpID0gKHUobiwgInRpbWVncmlkRGlzcGxheVByaW1hcnlUaW1lLXRtcGwiKSB8fCB0ICYmIHUodCwgInRpbWVncmlkRGlzcGxheVByaW1hcnlUaW1lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lZ3JpZERpc3BsYXlQcmltYXJ5VGltZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNTMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA5NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImJvcmRlci10b3A6IDFweCBzb2xpZCAjRUFFQUVBO2JvcmRlci1sZWZ0OiAxcHggc29saWQgI0RGREZERjtjdXJzb3I6cG9pbnRlciI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAyOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDQyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXNjaGVkdWxlcy1jb250YWluZXIiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtZ3JpZGxpbmUiIHN0eWxlPSJ3aWR0aDoxMCU7XG4gICAgICAgICAgICBoZWlnaHQ6NzV2aDtcbiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI0RGREZERjtcbiAgICAgICAgIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOSwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogNDIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtZ3JpZGxpbmUtaGFsZiJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogJyArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoYWxmSG91ckhlaWdodCIpLCB0KSkgKyAiOyBib3JkZXItYm90dG9tOiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImhhbGZIb3VyQm9yZGVyQm90dG9tIiksIHQpKSArICc7Ij5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1sZWZ0IiBzdHlsZT0id2lkdGg6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJsZWZ0V2lkdGgiKSA6IGksIHQpKSArICI7IGZvbnQtc2l6ZTogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxlZnRGb250U2l6ZSIpIDogaSwgdCkpICsgJzsiPlxuJyArIChudWxsICE9IChpID0gaChuLCAiZWFjaCIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAidGltZXpvbmVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDg4LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9kaXY+XG48ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXJpZ2h0IiBzdHlsZT0ibWFyZ2luLWxlZnQ6ICcgKyB1KGQoKGkgPSAoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzdHlsZXMiKSkgJiYgaChpLCAibGVmdFdpZHRoIiksIHQpKSArICc7Ij5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MSwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWgtZ3JpZCI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJob3Vyc0xhYmVscyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MiwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwNCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXNjaGVkdWxlcyI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDUsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1zY2hlZHVsZXMtY29udGFpbmVyIj48L2Rpdj5cbiAgICA8L2Rpdj5cblxuJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgInNob3dIb3VyTWFya2VyIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDI1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDgsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyMSwKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdGltZXpvbmUiIGRhdGEtdGltZXpvbmUtaW5kZXg9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJpbmRleCIpIHx8IG8gJiYgZChvLCAiaW5kZXgiKSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImluZGV4IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogNzAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA4MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciXG4gICAgICAgIHN0eWxlPSInICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiaGlkZGVuIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDksIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiA0OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgd2lkdGg6ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJ3aWR0aCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJ3aWR0aCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ3aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogOTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgbGVmdDogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImxlZnQiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAibGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJsZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMTAyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMTEwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IGJvcmRlci1yaWdodDogIiArIHUoZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAibGVmdEJvcmRlclJpZ2h0IiksIHQpKSArICI7IGJhY2tncm91bmQtY29sb3I6ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJiYWNrZ3JvdW5kQ29sb3IiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiYmFja2dyb3VuZENvbG9yIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImJhY2tncm91bmRDb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDE3OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDE5OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7Ij5cbicgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJpc1ByaW1hcnkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDE3LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NiwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICA5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gImRpc3BsYXk6bm9uZTsiOwogICAgICB9LAogICAgICAxMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAobnVsbCAhPSAoaSA9IHIobiwgImVhY2giKS5jYWxsKGEsIG51bGwgIT0gdCA/IHIodCwgInRpbWVTbG90cyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gcihuLCAiaWYiKS5jYWxsKGEsIChpID0gbyAmJiByKG8sICJyb290IikpICYmIHIoaSwgInNob3dIb3VyTWFya2VyIiksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYzLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MCwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpOwogICAgICB9LAogICAgICAxMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OCwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWhvdXIiXG4gICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OiAnICsgYyhlLmxhbWJkYSgoaSA9IChpID0gbyAmJiB1KG8sICJyb290IikpICYmIHUoaSwgInN0eWxlcyIpKSAmJiB1KGksICJvbmVIb3VySGVpZ2h0IiksIHQpKSArICI7IGNvbG9yOiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJjb2xvciIpIHx8IChudWxsICE9IHQgPyB1KHQsICJjb2xvciIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDY2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiOyBmb250LXdlaWdodDogIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiZm9udFdlaWdodCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJmb250V2VpZ2h0IikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImZvbnRXZWlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiA5MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDEwNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7Ij5cbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPSInICsgKG51bGwgIT0gKGkgPSB1KG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiaGlkZGVuIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAodShuLCAidGltZWdyaWREaXNwbGF5UHJpbWF5VGltZS10bXBsIikgfHwgdCAmJiB1KHQsICJ0aW1lZ3JpZERpc3BsYXlQcmltYXlUaW1lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lZ3JpZERpc3BsYXlQcmltYXlUaW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjAsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDEwMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMTM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiZGlzcGxheTpub25lIjsKICAgICAgfSwKICAgICAgMTU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlciJcbiAgICAgICAgICAgIHN0eWxlPSJ0b3A6JyArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJob3VybWFya2VyVG9wIiksIHQpKSArICIlOyBtYXJnaW4tdG9wOiBjYWxjKDZweCAtICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJIZWlnaHQiKSwgdCkpICsgIik7IGhlaWdodDogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoYWxmSG91ckhlaWdodCIpLCB0KSkgKyAnOyI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NiwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY2LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlci10aW1lIlxuICAgICAgICAgICAgICAgIHN0eWxlPSJjb2xvcjogJyArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJjdXJyZW50VGltZUNvbG9yIiksIHQpKSArICI7IGZvbnQtc2l6ZTogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJjdXJyZW50VGltZUZvbnRTaXplIiksIHQpKSArICI7IGZvbnQtd2VpZ2h0OiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImN1cnJlbnRUaW1lRm9udFdlaWdodCIpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgICAgICAnICsgKG51bGwgIT0gKGkgPSAoZChuLCAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIikgfHwgdCAmJiBkKHQsICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDUxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDE3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICByID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIChudWxsICE9IChpID0gcihuLCAiZWFjaCIpLmNhbGwoYSwgbnVsbCAhPSB0ID8gcih0LCAidGltZVNsb3RzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcyLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NywKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSByKG4sICJpZiIpLmNhbGwoYSwgKGkgPSBvICYmIHIobywgInJvb3QiKSkgJiYgcihpLCAic2hvd0hvdXJNYXJrZXIiKSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyMCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzgsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDg1LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDE4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MywKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDczLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91ciJcbiAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKGUubGFtYmRhKChpID0gKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAic3R5bGVzIikpICYmIHUoaSwgIm9uZUhvdXJIZWlnaHQiKSwgdCkpICsgIjsgY29sb3I6ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImNvbG9yIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImNvbG9yIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc0LAogICAgICAgICAgICAgIGNvbHVtbjogNjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzQsCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7IGZvbnQtd2VpZ2h0OiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJmb250V2VpZ2h0IikgfHwgKG51bGwgIT0gdCA/IHUodCwgImZvbnRXZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiZm9udFdlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NCwKICAgICAgICAgICAgICBjb2x1bW46IDkwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc0LAogICAgICAgICAgICAgIGNvbHVtbjogMTA0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9IicgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJoaWRkZW4iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc1LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzUsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJ0aW1lZ3JpZERpc3BsYXlUaW1lLXRtcGwiKSB8fCB0ICYmIHUodCwgInRpbWVncmlkRGlzcGxheVRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogInRpbWVncmlkRGlzcGxheVRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NSwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc1LAogICAgICAgICAgICAgIGNvbHVtbjogOTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDIwOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzksCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWhvdXJtYXJrZXIiXG4gICAgICAgICAgICBzdHlsZT0idG9wOicgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAiaG91cm1hcmtlclRvcCIpLCB0KSkgKyAiJTsgbWFyZ2luLXRvcDogY2FsYyg2cHggLSAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImhhbGZIb3VySGVpZ2h0IiksIHQpKSArICIpOyBoZWlnaHQ6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJIZWlnaHQiKSwgdCkpICsgJzsiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogODEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWhvdXJtYXJrZXItdGltZSJcbiAgICAgICAgICAgICAgICBzdHlsZT0iY29sb3I6ICcgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiY3VycmVudFRpbWVDb2xvciIpLCB0KSkgKyAiOyBmb250LXNpemU6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiY3VycmVudFRpbWVGb250U2l6ZSIpLCB0KSkgKyAnOyI+XG4gICAgICAgICAgICAgICAgJyArIChudWxsICE9IChpID0gKGQobiwgInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCIpIHx8IHQgJiYgZCh0LCAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIikgfHwgcykuY2FsbChyLCB0LCB7CiAgICAgICAgICBuYW1lOiAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgzLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODMsCiAgICAgICAgICAgICAgY29sdW1uOiA1MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MywKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDkzLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtZ3JpZGxpbmUiIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAib25lSG91ckhlaWdodCIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChyLCBvICYmIGQobywgImxhc3QiKSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDk0LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOTYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5OCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDk4LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtZ3JpZGxpbmUtaGFsZiJcbiAgICAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OiAnICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImhhbGZIb3VySGVpZ2h0IiksIHQpKSArICI7IGJvcmRlci1ib3R0b206ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJCb3JkZXJCb3R0b20iKSwgdCkpICsgJzsiPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgMjM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICBib3JkZXItYm90dG9tOiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgImJvcmRlckJvdHRvbSIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMjU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTA5LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTA5LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlciIgc3R5bGU9InRvcDonICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiaG91cm1hcmtlclRvcCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJob3VybWFya2VyVG9wIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImhvdXJtYXJrZXJUb3AiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTA5LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTA5LAogICAgICAgICAgICAgIGNvbHVtbjogNzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnJSI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyLWxpbmUtbGVmdCJcbiAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDonICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidG9kYXltYXJrZXJMZWZ0IikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvZGF5bWFya2VyTGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0b2RheW1hcmtlckxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTExLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTExLAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYm9yZGVyLXRvcDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImN1cnJlbnRUaW1lTGVmdEJvcmRlclRvcCIpIDogaSwgdCkpICsgJzsiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEyLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEyLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdG9kYXltYXJrZXIiXG4gICAgICAgICAgICBzdHlsZT0ibGVmdDonICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidG9kYXltYXJrZXJMZWZ0IikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvZGF5bWFya2VyTGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0b2RheW1hcmtlckxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEzLAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYmFja2dyb3VuZC1jb2xvcjogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImN1cnJlbnRUaW1lQnVsbGV0QmFja2dyb3VuZENvbG9yIikgOiBpLCB0KSkgKyAnOyAiPnRvZGF5XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTE1LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTE1LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlci1saW5lLXRvZGF5IlxuICAgICAgICAgICAgc3R5bGU9ImxlZnQ6JyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInRvZGF5bWFya2VyTGVmdCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ0b2RheW1hcmtlckxlZnQiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidG9kYXltYXJrZXJMZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExNiwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExNiwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IHdpZHRoOiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidG9kYXltYXJrZXJXaWR0aCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ0b2RheW1hcmtlcldpZHRoIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRvZGF5bWFya2VyV2lkdGgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTE2LAogICAgICAgICAgICAgIGNvbHVtbjogNTMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTE2LAogICAgICAgICAgICAgIGNvbHVtbjogNzMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYm9yZGVyLXRvcDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImN1cnJlbnRUaW1lVG9kYXlCb3JkZXJUb3AiKSA6IGksIHQpKSArICc7Ij5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyLWxpbmUtcmlnaHQiXG4gICAgICAgICAgICBzdHlsZT0ibGVmdDonICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidG9kYXltYXJrZXJSaWdodCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ0b2RheW1hcmtlclJpZ2h0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRvZGF5bWFya2VyUmlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTE5LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTE5LAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYm9yZGVyLXRvcDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImN1cnJlbnRUaW1lUmlnaHRCb3JkZXJUb3AiKSA6IGksIHQpKSArICc7Ij48L2Rpdj5cbiAgICA8L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSBhKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgImlzRGF5VmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXRpbWV6b25lLWxhYmVsLWNvbnRhaW5lciIgc3R5bGU9IicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJoaWRkZW4iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDY4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiYmFja2dyb3VuZC1jb2xvcjogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImJhY2tncm91bmRDb2xvciIpIHx8IChudWxsICE9IHQgPyBoKHQsICJiYWNrZ3JvdW5kQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiYmFja2dyb3VuZENvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDEzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7IGhlaWdodDogMTAwJTsgd2lkdGg6ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ3aWR0aCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ3aWR0aCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ3aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgbGVmdDogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImxlZnQiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJsZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxODAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE4OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBmb250LXNpemU6ICIgKyB1KGQoKGkgPSAoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzdHlsZXMiKSkgJiYgaChpLCAibGVmdEZvbnRTaXplIiksIHQpKSArICI7IGJvcmRlci1yaWdodDogIiArIHUoZCgoaSA9IChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInN0eWxlcyIpKSAmJiBoKGksICJsZWZ0Qm9yZGVyUmlnaHQiKSwgdCkpICsgJzsiPlxuICAgIDxkaXYgdGl0bGU9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0b29sdGlwIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvb2x0aXAiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidG9vbHRpcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMzYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDUwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXRpbWV6b25lLWxhYmVsLWNlbGwiIGRhdGEtdGltZXpvbmU9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJkaXNwbGF5TGFiZWwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiZGlzcGxheUxhYmVsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImRpc3BsYXlMYWJlbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogOTUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDExMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciIHN0eWxlPSJoZWlnaHQ6IDEwMCU7IHdpZHRoOiAxMDAlOyI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgKGgobiwgImFuZCIpIHx8IHQgJiYgaCh0LCAiYW5kIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc1ByaW1hcnkiKSA6IHQsIChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uIiksIHsKICAgICAgICAgIG5hbWU6ICJhbmQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDE0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdGltZXpvbmUtbGFiZWwiPicgKyAobnVsbCAhPSAoaSA9IChoKG4sICJ0aW1lem9uZURpc3BsYXlMYWJlbC10bXBsIikgfHwgdCAmJiBoKHQsICJ0aW1lem9uZURpc3BsYXlMYWJlbC10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJ0aW1lem9uZU9mZnNldCIpIDogdCwgbnVsbCAhPSB0ID8gaCh0LCAiZGlzcGxheUxhYmVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidGltZXpvbmVEaXNwbGF5TGFiZWwtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDU5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTE4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gImRpc3BsYXk6bm9uZTsiOwogICAgICB9LAogICAgICA0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdGltZXpvbmUtY2xvc2UtYnRuIiBzdHlsZT0iYm9yZGVyOiAxcHggc29saWQgI2RkZDsgdG9wOjJweDsgYm90dG9tOiAycHg7IHdpZHRoOiAxMHB4OyBib3JkZXItbGVmdDogbm9uZTsiPlxuICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjogIzc3NzsgaGVpZ2h0OiBjYWxjKCcgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiZGlzcGxheVRpbWV6b25lTGFiZWxIZWlnaHQiKSwgdCkpICsgIiAtIDZweCk7IGxpbmUtaGVpZ2h0OiBjYWxjKCIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiZGlzcGxheVRpbWV6b25lTGFiZWxIZWlnaHQiKSwgdCkpICsgJyAtIDZweCk7Ij5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAidGltZXpvbmVzQ29sbGFwc2VkIiksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oNywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDUyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4nOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA5OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJpYy1hcnJvdy1yaWdodCI7CiAgICAgIH0sCiAgICAgIDc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAiaWMtYXJyb3ctbGVmdCI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHIgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IHIobiwgImVhY2giKS5jYWxsKGEsIChyKG4sICJyZXZlcnNlIikgfHwgdCAmJiByKHQsICJyZXZlcnNlIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKGEsIG51bGwgIT0gdCA/IHIodCwgInRpbWV6b25lcyIpIDogdCwgewogICAgICAgICAgbmFtZTogInJldmVyc2UiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gKG51bGwgIT0gKGkgPSAoYShuLCAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIikgfHwgdCAmJiBhKHQsICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCBuKSB7CiAgICBlLmV4cG9ydHMgPSB0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDE2NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJoaWRlIjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgciA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgcyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSInICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAzMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDQ1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiA2NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgJ2Ryb3Bkb3duLW1lbnUtaXRlbSIgZGF0YS1jYWxlbmRhci1pZD0iJyArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgImlkIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImlkIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogImlkIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTIyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgJyI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IHIpID09PSBzID8gaS5jYWxsKGEsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA1MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJpY29uICIgKyBjKF90eXBlb2YoaSA9IG51bGwgIT0gKGkgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiByKSA9PT0gcyA/IGkuY2FsbChhLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDU2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnY2FsZW5kYXItZG90IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgImJnQ29sb3IiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiYmdDb2xvciIpIDogdCkpID8gaSA6IHIpID09PSBzID8gaS5jYWxsKGEsIHsKICAgICAgICAgIG5hbWU6ICJiZ0NvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMTA5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMTIwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgJyI+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKF90eXBlb2YoaSA9IG51bGwgIT0gKGkgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiByKSA9PT0gcyA/IGkuY2FsbChhLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnY29udGVudCI+JyArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgIm5hbWUiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAibmFtZSIpIDogdCkpID8gaSA6IHIpID09PSBzID8gaS5jYWxsKGEsIHsKICAgICAgICAgIG5hbWU6ICJuYW1lIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICI8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvbGk+XG4iOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAicHVibGljIjsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgY2hlY2tlZCI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJzdGF0ZSIpIHx8IChudWxsICE9IHQgPyBhKHQsICJzdGF0ZSIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJzdGF0ZSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDk5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogMTA4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpOwogICAgICB9LAogICAgICAxMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHIobiwgInBvcHVwU3RhdGVCdXN5LXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gcih0LCAicG9wdXBTdGF0ZUJ1c3ktdG1wbCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cFN0YXRlQnVzeS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogMTE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogMTQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHIobiwgInBvcHVwVXBkYXRlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gcih0LCAicG9wdXBVcGRhdGUtdG1wbCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cFVwZGF0ZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTYzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiOwogICAgICB9LAogICAgICAxNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHIobiwgInBvcHVwU2F2ZS10bXBsIikgfHwgKG51bGwgIT0gdCA/IHIodCwgInBvcHVwU2F2ZS10bXBsIikgOiB0KSkgPyBhIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGEuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogInBvcHVwU2F2ZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTkzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMjEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cCI+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtY29udGFpbmVyIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDQ4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJkcm9wZG93biAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJjbG9zZSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDkxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAic2VjdGlvbi1jYWxlbmRhciIgKyAobnVsbCAhPSAoaSA9IGgobiwgInVubGVzcyIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgImNhbGVuZGFycyIpIDogdCkgPyBoKGksICJsZW5ndGgiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDE3OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiYnV0dG9uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImRyb3Bkb3duLWJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zZWN0aW9uLWl0ZW0iPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NhbGVuZGFyLWRvdCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNlbGVjdGVkQ2FsIikgOiB0KSA/IGgoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICciPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogNDAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtY2FsZW5kYXIiIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDY2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA4MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzZWxlY3RlZENhbCIpIDogdCkgPyBoKGksICJuYW1lIikgOiBpLCB0KSkgKyAnPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2Ryb3Bkb3duLWFycm93Ij48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDx1bCBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZHJvcGRvd24tbWVudSIgc3R5bGU9InotaW5kZXg6ICcgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ6SW5kZXgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiekluZGV4IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInpJbmRleCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJjYWxlbmRhcnMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICAgICAgPC91bD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtc2VjdGlvbiI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tdGl0bGUiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLXRpdGxlIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPGlucHV0IGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NjaGVkdWxlLXRpdGxlIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogNjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiA3OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50IiBwbGFjZWhvbGRlcj0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInRpdGxlUGxhY2Vob2xkZXItdG1wbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ0aXRsZVBsYWNlaG9sZGVyLXRtcGwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidGl0bGVQbGFjZWhvbGRlci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTI1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyIgdmFsdWU9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0aXRsZSIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ0aXRsZSIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0aXRsZSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDEzNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDE0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8YnV0dG9uIGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NjaGVkdWxlLXByaXZhdGUiIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDc3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA4NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDk4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInNlY3Rpb24tcHJpdmF0ZSIgKyAobnVsbCAhPSAoaSA9IGgobiwgInVubGVzcyIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNQcml2YXRlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDExMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE2NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLXByaXZhdGUiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI3LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjcsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zZWN0aW9uIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1sb2NhdGlvbiI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOSwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtbG9jYXRpb24iPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtbG9jYXRpb24iIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA2NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDgxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiIHBsYWNlaG9sZGVyPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAibG9jYXRpb25QbGFjZWhvbGRlci10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImxvY2F0aW9uUGxhY2Vob2xkZXItdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJsb2NhdGlvblBsYWNlaG9sZGVyLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIiB2YWx1ZT0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImxvY2F0aW9uIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImxvY2F0aW9uIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxvY2F0aW9uIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMTQwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMTUyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMywKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMzLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtc2VjdGlvbiI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tc3RhcnQtZGF0ZSI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNSwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM1LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzUsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNSwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLWRhdGUiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtc3RhcnQtZGF0ZSIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDY5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogODMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCIgcGxhY2Vob2xkZXI9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJzdGFydERhdGVQbGFjZWhvbGRlci10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInN0YXJ0RGF0ZVBsYWNlaG9sZGVyLXRtcGwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAic3RhcnREYXRlUGxhY2Vob2xkZXItdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDEwNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDEzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPlxuICAgICAgICAgICAgICAgIDxkaXYgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNywKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM3LAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc3RhcnRwaWNrZXItY29udGFpbmVyIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IC0xcHg7IHBvc2l0aW9uOiByZWxhdGl2ZSI+PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzksCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzOSwKICAgICAgICAgICAgICBjb2x1bW46IDM5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tZGF0ZS1kYXNoIj4tPC9zcGFuPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQwLAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDAsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1zZWN0aW9uLWl0ZW0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQwLAogICAgICAgICAgICAgIGNvbHVtbjogNTcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDAsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWVuZC1kYXRlIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQxLAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDEsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MSwKICAgICAgICAgICAgICBjb2x1bW46IDQ4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQxLAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtZGF0ZSI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS1lbmQtZGF0ZSIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDY3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogODEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCIgcGxhY2Vob2xkZXI9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJlbmREYXRlUGxhY2Vob2xkZXItdG1wbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJlbmREYXRlUGxhY2Vob2xkZXItdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJlbmREYXRlUGxhY2Vob2xkZXItdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDEwMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDEzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPlxuICAgICAgICAgICAgICAgIDxkaXYgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MywKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQzLAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZW5kcGlja2VyLWNvbnRhaW5lciIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAtMXB4OyBwb3NpdGlvbjogcmVsYXRpdmUiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tYWxsZGF5Ij5cbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NiwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtYWxsZGF5IiB0eXBlPSJjaGVja2JveCIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NiwKICAgICAgICAgICAgICBjb2x1bW46IDgxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogOTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY2hlY2tib3gtc3F1YXJlIicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc0FsbERheSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NiwKICAgICAgICAgICAgICBjb2x1bW46IDExMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NiwKICAgICAgICAgICAgICBjb2x1bW46IDE0MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLWNoZWNrYm94Ij48L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0OCwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ4LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInBvcHVwSXNBbGxEYXktdG1wbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJwb3B1cElzQWxsRGF5LXRtcGwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBJc0FsbERheS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ4LAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDgsCiAgICAgICAgICAgICAgY29sdW1uOiA3NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAnPC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUxLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJkcm9wZG93biAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImNsb3NlICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDkxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUxLAogICAgICAgICAgICAgIGNvbHVtbjogMTA1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tc3RhdGUiPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJidXR0b24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJkcm9wZG93bi1idXR0b24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zZWN0aW9uLWl0ZW0iPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUzLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1zdGF0ZSI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDQwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NjaGVkdWxlLXN0YXRlIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogNjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA3NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAic3RhdGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogODYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkcm9wZG93bi1hcnJvdyI+PC9zcGFuPlxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8dWwgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZHJvcGRvd24tbWVudSIgc3R5bGU9InotaW5kZXg6ICcgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ6SW5kZXgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiekluZGV4IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInpJbmRleCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDY4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj5cbiAgICAgICAgICAgICAgICA8bGkgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OCwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU4LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OCwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU4LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZHJvcGRvd24tbWVudS1pdGVtIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDQ4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbm9uZSI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjAsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9IF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJwb3B1cFN0YXRlQnVzeS10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInBvcHVwU3RhdGVCdXN5LXRtcGwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBTdGF0ZUJ1c3ktdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDUyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogNzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiIpICsgJzwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1zZWN0aW9uLWl0ZW0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkcm9wZG93bi1tZW51LWl0ZW0iPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjMsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MywKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYzLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdub25lIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NCwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInBvcHVwU3RhdGVGcmVlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAicG9wdXBTdGF0ZUZyZWUtdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cFN0YXRlRnJlZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjQsCiAgICAgICAgICAgICAgY29sdW1uOiA3NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAnPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJidXR0b24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1jbG9zZSI+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogOTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtY2xvc2UiPjwvc3Bhbj48L2J1dHRvbj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWJ1dHRvbi1zYXZlIj48YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiA3MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiA5MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDEwNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJjb25maXJtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDExMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDEyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zYXZlIj48c3Bhbj4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNFZGl0TW9kZSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTUsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTQ1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMjIwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzwvc3Bhbj48L2J1dHRvbj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWFycm93IiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcxLAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzEsCiAgICAgICAgICAgICAgY29sdW1uOiA2MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1hcnJvdyAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzEsCiAgICAgICAgICAgICAgY29sdW1uOiA3MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDg3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2Fycm93LWJvdHRvbSI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MiwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcyLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtYXJyb3ctYm9yZGVyIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MywKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDczLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtYXJyb3ctZmlsbCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG4nOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDQ1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogNTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGV0YWlsLWl0ZW0iPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDkxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTA1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtbG9jYXRpb24tYiI+PC9zcGFuPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDE1OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDE3MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAicG9wdXBEZXRhaWxMb2NhdGlvbi10bXBsIikgfHwgdCAmJiB1KHQsICJwb3B1cERldGFpbExvY2F0aW9uLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgInNjaGVkdWxlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBEZXRhaWxMb2NhdGlvbi10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTgyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMjIxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2Rpdj4iOwogICAgICB9LAogICAgICAzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDUxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNjUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGV0YWlsLWl0ZW0iPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDk3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMTExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtcmVwZWF0LWIiPjwvc3Bhbj48c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gKHUobiwgInBvcHVwRGV0YWlsUmVwZWF0LXRtcGwiKSB8fCB0ICYmIHUodCwgInBvcHVwRGV0YWlsUmVwZWF0LXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgInNjaGVkdWxlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBEZXRhaWxSZXBlYXQtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDE4NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDIyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+PC9kaXY+IjsKICAgICAgfSwKICAgICAgNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDQ2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtZGV0YWlsLWl0ZW0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1kZXRhaWwtaXRlbS1pbmRlbnQiPjxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtdXNlci1iIj48L3NwYW4+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE5NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDIwOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSAoZChuLCAicG9wdXBEZXRhaWxVc2VyLXRtcGwiKSB8fCB0ICYmIGQodCwgInBvcHVwRGV0YWlsVXNlci10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJzY2hlZHVsZSIpIDogdCwgewogICAgICAgICAgbmFtZTogInBvcHVwRGV0YWlsVXNlci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjUzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2Rpdj4iOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDQyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogNTYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGV0YWlsLWl0ZW0iPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDg4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTAyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtc3RhdGUtYiI+PC9zcGFuPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAicG9wdXBEZXRhaWxTdGF0ZS10bXBsIikgfHwgdCAmJiB1KHQsICJwb3B1cERldGFpbFN0YXRlLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgInNjaGVkdWxlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBEZXRhaWxTdGF0ZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTc2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMjEyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2Rpdj4iOwogICAgICB9LAogICAgICA5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWRldGFpbC1pdGVtIj48c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA2NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDgwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDk5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NhbGVuZGFyLWRvdCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICcgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgInNjaGVkdWxlIikgOiB0KSA/IGQoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICciPjwvc3Bhbj48c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxODAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxOTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAiY2FsZW5kYXIiKSA6IHQpID8gZChpLCAibmFtZSIpIDogaSwgdCkpICsgIjwvc3Bhbj48L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogNTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtZGV0YWlsLWl0ZW0gIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiA3MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDg3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWRldGFpbC1pdGVtLXNlcGFyYXRlIj48c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gKHUobiwgInBvcHVwRGV0YWlsQm9keS10bXBsIikgfHwgdCAmJiB1KHQsICJwb3B1cERldGFpbEJvZHktdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAic2NoZWR1bGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERldGFpbEJvZHktdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDE1MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDE4NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+PC9kaXY+IjsKICAgICAgfSwKICAgICAgMTM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfSwKICAgICAgMTU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWJ1dHRvbiI+XG4gICAgICA8YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWVkaXQiPjxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogNzkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA5MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1lZGl0Ij48L3NwYW4+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDEyMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDEzNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSBfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAicG9wdXBFZGl0LXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAicG9wdXBFZGl0LXRtcGwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBFZGl0LXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiIpICsgJzwvc3Bhbj48L2J1dHRvbj5cbiAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtdmVydGljYWwtbGluZSI+PC9kaXY+XG4gICAgICA8YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWRlbGV0ZSI+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogNzYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiA4MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDk1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLWRlbGV0ZSI+PC9zcGFuPjxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgInBvcHVwRGVsZXRlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAicG9wdXBEZWxldGUtdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERlbGV0ZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMTQ5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMTcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiKSArICI8L3NwYW4+PC9idXR0b24+XG4gICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cCAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA0NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1kZXRhaWwiPlxuICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAyOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1jb250YWluZXIiPlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1oZWFkZXIiPlxuICAgICAgPGRpdj5cbiAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInNjaGVkdWxlLXByaXZhdGUgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA1MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1wcml2YXRlIj48L3NwYW4+XG4gICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDIxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS10aXRsZSI+JyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAidGl0bGUiKSA6IGksIHQpKSArICc8L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLWRldGFpbC1kYXRlICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDY0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9IChoKG4sICJwb3B1cERldGFpbERhdGUtdG1wbCIpIHx8IHQgJiYgaCh0LCAicG9wdXBEZXRhaWxEYXRlLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJpc0FsbERheSIpIDogaSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgInN0YXJ0IikgOiBpLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAiZW5kIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBEZXRhaWxEYXRlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDczCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWRldGFpbCI+XG4gICAgICAgICcgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAibG9jYXRpb24iKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMjQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgInJlY3VycmVuY2VSdWxlIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDI0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJhdHRlbmRlZXMiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjczCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgInN0YXRlIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDcsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDIzMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJjYWxlbmRhciIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg5LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAiYm9keSIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMjA2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgIDwvZGl2PlxuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJpc1JlYWRPbmx5IikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgxNSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI3LAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICA8L2Rpdj5cbiAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogMTQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiAyOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC10b3AtbGluZSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICciPjwvZGl2PlxuICA8ZGl2IGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWFycm93IiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA1OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1hcnJvdyAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2Fycm93LWxlZnQiPlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMxLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtYXJyb3ctYm9yZGVyIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMyLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1hcnJvdy1maWxsIj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKTsKCiAgICBmdW5jdGlvbiBhKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMuZGF5TmFtZVZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgZS5vbih7CiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyk7CiAgICB9CgogICAgYS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZGF5TmFtZVZpZXcgPSB0aGlzLmJhc2VDb250cm9sbGVyID0gdGhpcy5kcmFnSGFuZGxlciA9IG51bGw7CiAgICB9LCBhLnByb3RvdHlwZS5jaGVja0V4cGVjdENvbmRpdGlvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiAhIWkuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLmRheW5hbWUtZGF0ZS1hcmVhIikpOwogICAgfSwgYS5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUudGFyZ2V0LAogICAgICAgICAgbiA9IHRoaXMuY2hlY2tFeHBlY3RDb25kaXRpb24odCksCiAgICAgICAgICBsID0gaS5jbG9zZXN0KHQsIG8uY2xhc3NuYW1lKCIuZGF5bmFtZSIpKTsKICAgICAgbiAmJiBsICYmIHRoaXMuZmlyZSgiY2xpY2tEYXluYW1lIiwgewogICAgICAgIGRhdGU6IGkuZ2V0RGF0YShsLCAiZGF0ZSIpCiAgICAgIH0pOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4oYSksIGUuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oMzQpOwoKICAgIGZ1bmN0aW9uIHIoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy52aWV3ID0gdCwgdGhpcy5jb250cm9sbGVyID0gbiwgZS5vbih7CiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyk7CiAgICB9CgogICAgci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMudmlldyA9IHRoaXMuY29udHJvbGxlciA9IHRoaXMuZHJhZ0hhbmRsZXIgPSBudWxsOwogICAgfSwgci5wcm90b3R5cGUuY2hlY2tFeHBlY3RDb25kaXRpb24gPSBhLnByb3RvdHlwZS5jaGVja0V4cGVjdGVkQ29uZGl0aW9uLCByLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMsCiAgICAgICAgICBsID0gZS50YXJnZXQsCiAgICAgICAgICBhID0gdGhpcy5jaGVja0V4cGVjdENvbmRpdGlvbihsKSwKICAgICAgICAgIHIgPSB0aGlzLmNvbnRyb2xsZXIuc2NoZWR1bGVzLAogICAgICAgICAgcyA9IGkuY2xvc2VzdChsLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktY29sbGFwc2UtYnRuIikpLAogICAgICAgICAgYyA9IGkuY2xvc2VzdChsLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktZXhjZWVkLWluLXdlZWsiKSk7CgogICAgICBpZiAodGhpcy52aWV3LmNvbnRhaW5lci5jb250YWlucyhsKSkgewogICAgICAgIGlmICghcykgcmV0dXJuIGMgPyAodGhpcy52aWV3LnNldFN0YXRlKHsKICAgICAgICAgIGNsaWNrZWRFeHBhbmRCdG5JbmRleDogcGFyc2VJbnQoaS5nZXREYXRhKGMsICJpbmRleCIpLCAxMCkKICAgICAgICB9KSwgdm9pZCBuLmZpcmUoImV4cGFuZCIpKSA6IHZvaWQgKGEgJiYgaS5jbG9zZXN0KGwsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZSIpKSAmJiAodCA9IGkuY2xvc2VzdChsLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSksIHIuZG9XaGVuSGFzKGkuZ2V0RGF0YSh0LCAiaWQiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIG4uZmlyZSgiY2xpY2tTY2hlZHVsZSIsIHsKICAgICAgICAgICAgc2NoZWR1bGU6IHQsCiAgICAgICAgICAgIGV2ZW50OiBlLm9yaWdpbkV2ZW50CiAgICAgICAgICB9KTsKICAgICAgICB9KSkpOwogICAgICAgIG4uZmlyZSgiY29sbGFwc2UiKTsKICAgICAgfQogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4ociksIGUuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oMiksCiAgICAgICAgICBpID0gbigzKSwKICAgICAgICAgIGEgPSBuKDEpLAogICAgICAgICAgciA9IG4oMTEpOwoKICAgICAgZnVuY3Rpb24gcyhlKSB7CiAgICAgICAgdGhpcy5kYXlncmlkTW92ZSA9IGUsIHRoaXMuc2NoZWR1bGVDb250YWluZXIgPSBudWxsLCB0aGlzLl9kcmFnU3RhcnRYSW5kZXggPSBudWxsLCB0aGlzLmd1aWRlRWxlbWVudCA9IG51bGwsIHRoaXMuZWxlbWVudHMgPSBudWxsLCBlLm9uKHsKICAgICAgICAgIGRyYWdzdGFydDogdGhpcy5fb25EcmFnU3RhcnQsCiAgICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICBkcmFnZW5kOiB0aGlzLl9jbGVhckd1aWRlRWxlbWVudCwKICAgICAgICAgIGNsaWNrOiB0aGlzLl9jbGVhckd1aWRlRWxlbWVudAogICAgICAgIH0sIHRoaXMpOwogICAgICB9CgogICAgICBzLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50KCksIHRoaXMuZGF5Z3JpZE1vdmUub2ZmKHRoaXMpLCB0aGlzLmRheWdyaWRNb3ZlID0gdGhpcy5zY2hlZHVsZUNvbnRhaW5lciA9IHRoaXMuX2RyYWdTdGFydFhJbmRleCA9IHRoaXMuZWxlbWVudHMgPSB0aGlzLmd1aWRlRWxlbWVudCA9IG51bGw7CiAgICAgIH0sIHMucHJvdG90eXBlLl9jbGVhckd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9zaG93T3JpZ2luU2NoZWR1bGVCbG9ja3MoKSwgYS5yZW1vdmUodGhpcy5ndWlkZUVsZW1lbnQpLCBsLmJyb3dzZXIubXNpZSB8fCBhLnJlbW92ZUNsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoImRyYWdnaW5nIikpLCB0aGlzLl9kcmFnU3RhcnRYSW5kZXggPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLmd1aWRlRWxlbWVudCA9IG51bGw7CiAgICAgIH0sIHMucHJvdG90eXBlLl9oaWRlT3JpZ2luU2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIiksCiAgICAgICAgICAgIG4gPSBhLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLWJsb2NrIiksIHRoaXMuZGF5Z3JpZE1vdmUudmlldy5jb250YWluZXIsICEwKTsKICAgICAgICB0aGlzLmVsZW1lbnRzID0gbC5maWx0ZXIobiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBhLmdldERhdGEodCwgImlkIikgPT09IGU7CiAgICAgICAgfSksIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgYS5hZGRDbGFzcyhlLCB0KTsKICAgICAgICB9KTsKICAgICAgfSwgcy5wcm90b3R5cGUuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLWRyYWdnaW5nLWRpbSIpOwogICAgICAgIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgYS5yZW1vdmVDbGFzcyh0LCBlKTsKICAgICAgICB9KTsKICAgICAgfSwgcy5wcm90b3R5cGUuX2hpZ2hsaWdodFNjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgbiA9IGEuZmluZChvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUiKSwgdCwgITApOwogICAgICAgIGwuZm9yRWFjaChuLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdC5zdHlsZS5tYXJnaW4gPSAiMCIsIGUuaXNGb2N1c2VkIHx8ICh0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGUuZHJhZ0JnQ29sb3IsIHQuc3R5bGUuYm9yZGVyTGVmdENvbG9yID0gZS5ib3JkZXJDb2xvciwgdC5zdHlsZS5jb2xvciA9ICIjZmZmZmZmIik7CiAgICAgICAgfSk7CiAgICAgIH0sIHMucHJvdG90eXBlLnJlZnJlc2hHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICAgIHZhciBpID0gdGhpcy5ndWlkZUVsZW1lbnQ7CiAgICAgICAgci5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGkuc3R5bGUubGVmdCA9IGUgKyAiJSIsIGkuc3R5bGUud2lkdGggPSB0ICsgIiUiLCBuID8gYS5hZGRDbGFzcyhpLCBvLmNsYXNzbmFtZSgid2Vla2RheS1leGNlZWQtbGVmdCIpKSA6IGEucmVtb3ZlQ2xhc3MoaSwgby5jbGFzc25hbWUoIndlZWtkYXktZXhjZWVkLWxlZnQiKSksIGwgPyBhLmFkZENsYXNzKGksIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LWV4Y2VlZC1yaWdodCIpKSA6IGEucmVtb3ZlQ2xhc3MoaSwgby5jbGFzc25hbWUoIndlZWtkYXktZXhjZWVkLXJpZ2h0IikpOwogICAgICAgIH0pOwogICAgICB9LCBzLnByb3RvdHlwZS5fZ2V0U2NoZWR1bGVCbG9ja0RhdGFGdW5jID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IGUubW9kZWwsCiAgICAgICAgICAgIG4gPSBlLmRhdGVzSW5SYW5nZSwKICAgICAgICAgICAgbCA9IGUucmFuZ2UsCiAgICAgICAgICAgIG8gPSAxMDAgLyBuLAogICAgICAgICAgICBhID0gaS5zdGFydCh0LnN0YXJ0KSwKICAgICAgICAgICAgciA9IGkuZW5kKHQuZW5kKSwKICAgICAgICAgICAgcyA9IGkuc3RhcnQobFswXSksCiAgICAgICAgICAgIGMgPSBpLmVuZChsW2wubGVuZ3RoIC0gMV0pLAogICAgICAgICAgICB1ID0gTWF0aC5jZWlsKChhLmdldFRpbWUoKSAtIHMuZ2V0VGltZSgpKSAvIGkuTUlMTElTRUNPTkRTX1BFUl9EQVkpIHx8IDAsCiAgICAgICAgICAgIGQgPSBNYXRoLmNlaWwoKHIuZ2V0VGltZSgpIC0gYy5nZXRUaW1lKCkpIC8gaS5NSUxMSVNFQ09ORFNfUEVSX0RBWSkgfHwgMDsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGJhc2VXaWR0aFBlcmNlbnQ6IG8sCiAgICAgICAgICAgIGZyb21MZWZ0OiB1ICsgZSwKICAgICAgICAgICAgZnJvbVJpZ2h0OiBkICsgZQogICAgICAgICAgfTsKICAgICAgICB9OwogICAgICB9LCBzLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBpID0gdGhpcy5kYXlncmlkTW92ZS52aWV3LmNvbnRhaW5lciwKICAgICAgICAgICAgciA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gZS5zY2hlZHVsZUJsb2NrRWxlbWVudC5jbG9uZU5vZGUoITApOwogICAgICAgIGwuYnJvd3Nlci5tc2llIHx8IGEuYWRkQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgiZHJhZ2dpbmciKSksIHRoaXMuX2hpZGVPcmlnaW5TY2hlZHVsZUJsb2NrcyhTdHJpbmcoZS5tb2RlbC5jaWQoKSkpLCBuID0gYS5maW5kKG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZXMiKSwgaSksIGEuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIHIsIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXNjaGVkdWxlLWNvdmVyIikpLCBuLmFwcGVuZENoaWxkKHIpLCB0aGlzLl9kcmFnU3RhcnRYSW5kZXggPSBlLnhJbmRleCwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZ2V0U2NoZWR1bGVCbG9ja0RhdGFGdW5jKGUpLCB0aGlzLl9oaWdobGlnaHRTY2hlZHVsZUJsb2NrcyhlLm1vZGVsLCByKTsKICAgICAgfSwgcy5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIGMgPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICAgIHUgPSB0aGlzLl9kcmFnU3RhcnRYSW5kZXgsCiAgICAgICAgICAgIGQgPSBlLmRhdGVzSW5SYW5nZSwKICAgICAgICAgICAgaCA9IGUuZ3JpZHM7CiAgICAgICAgYyAmJiAobiA9ICh0ID0gYyhlLnhJbmRleCAtIHUpKS5mcm9tTGVmdCA8IDAsIGwgPSB0LmZyb21SaWdodCA+IDAsIGkgPSBNYXRoLm1heCgwLCB0LmZyb21MZWZ0KSwgbyA9IC0xICogdC5mcm9tTGVmdCArIChkICsgdC5mcm9tUmlnaHQpLCBhID0gbiA/IG8gKyB0LmZyb21MZWZ0IDogbywgYSA9IGwgPyBhIC0gdC5mcm9tUmlnaHQgOiBhLCByID0gaFtpXSA/IGhbaV0ubGVmdCA6IDAsIHMgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICAgICAgZm9yICh2YXIgbCA9IDAsIG8gPSAwLCBpID0gbi5sZW5ndGg7IG8gPCB0OyBvICs9IDEpIHsKICAgICAgICAgICAgKGUgPSAoZSArIG8pICUgaSkgPCBpICYmIChsICs9IG5bZV0gPyBuW2VdLndpZHRoIDogMCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgfShpLCBhLCBoKSwgdGhpcy5yZWZyZXNoR3VpZGVFbGVtZW50KHIsIHMsIG4sIGwpKTsKICAgICAgfSwgZS5leHBvcnRzID0gczsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oNSksCiAgICAgICAgciA9IG4oMSksCiAgICAgICAgcyA9IG4oNiksCiAgICAgICAgYyA9IG4oMTcpLAogICAgICAgIHUgPSBuKDg2KSwKICAgICAgICBkID0gbig0KS5EYXRlLAogICAgICAgIGggPSAzMDA7CgogICAgZnVuY3Rpb24gcChlLCB0LCBuLCBsKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLnZpZXcgPSB0LCB0aGlzLmNvbnRyb2xsZXIgPSBuLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsLCB0aGlzLmd1aWRlID0gbmV3IHUodGhpcyksIHRoaXMuX3JlcXVlc3RPbkNsaWNrID0gITEsIHRoaXMuX2Rpc2FibGVEYmxDbGljayA9IGwuZGlzYWJsZURibENsaWNrLCB0aGlzLl9kaXNhYmxlQ2xpY2sgPSBsLmRpc2FibGVDbGljaywgZS5vbigiZHJhZ1N0YXJ0IiwgdGhpcy5fb25EcmFnU3RhcnQsIHRoaXMpLCBlLm9uKCJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpLCB0aGlzLl9kaXNhYmxlRGJsQ2xpY2sgPyBoID0gMCA6IHMub24odC5jb250YWluZXIsICJkYmxjbGljayIsIHRoaXMuX29uRGJsQ2xpY2ssIHRoaXMpOwogICAgfQoKICAgIHAucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy52aWV3ICYmIHRoaXMudmlldy5jb250YWluZXIgJiYgcy5vZmYodGhpcy52aWV3LmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLnZpZXcgPSB0aGlzLmNvbnRyb2xsZXIgPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsOwogICAgfSwgcC5wcm90b3R5cGUuY2hlY2tFeHBlY3RlZENvbmRpdGlvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGkgPSByLmdldENsYXNzKGUpLnRyaW0oKTsKICAgICAgcmV0dXJuICFyLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LWV4Y2VlZC1pbi13ZWVrIikpICYmICFyLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LWNvbGxhcHNlLWJ0biIpKSAmJiAhci5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpLCAhMCkgJiYgISghKG4gPSByLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlcyIpKSkgJiYgaSAhPT0gby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGVzIikpICYmIChlID0gbiA/IG4ucGFyZW50Tm9kZSA6IGUucGFyZW50Tm9kZSwgISghKHQgPSAoaSA9IHIuZ2V0Q2xhc3MoZSkpLm1hdGNoKG8uZGF5Z3JpZC5nZXRWaWV3SURSZWdFeHApKSB8fCB0Lmxlbmd0aCA8IDIpICYmIGwucGljayh0aGlzLnZpZXcuY2hpbGRyZW4uaXRlbXMsIHRbMV0pKTsKICAgIH0sIHAucHJvdG90eXBlLl9jcmVhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwgPSBlLnJhbmdlLAogICAgICAgICAgbyA9IGUuZHJhZ1N0YXJ0WEluZGV4LAogICAgICAgICAgYSA9IGUueEluZGV4OwogICAgICBhIDwgbyAmJiAobyA9IGEgKyBvLCBvIC09IGEgPSBvIC0gYSksIHQgPSBuZXcgZChsW29dKSwgbiA9IGkuZW5kKGxbYV0pLCB0aGlzLmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgewogICAgICAgIGNhdGVnb3J5OiB0aGlzLnZpZXcub3B0aW9ucy52aWV3TmFtZSwKICAgICAgICBpc0FsbERheTogITAsCiAgICAgICAgc3RhcnQ6IHQsCiAgICAgICAgZW5kOiBuLAogICAgICAgIGd1aWRlOiB0aGlzLmd1aWRlLAogICAgICAgIHRyaWdnZXJFdmVudE5hbWU6IGUudHJpZ2dlckV2ZW50CiAgICAgIH0pOwogICAgfSwgcC5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IGUudGFyZ2V0OwogICAgICB0aGlzLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24obCkgJiYgKHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHQgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhKHRoaXMudmlldywgZS5vcmlnaW5FdmVudCksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHQsIG4gPSB0KGUub3JpZ2luRXZlbnQpLCB0aGlzLmZpcmUoImRyYWdzdGFydCIsIG4pKTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmM7CiAgICAgIG4gJiYgKHQgPSBuKGUub3JpZ2luRXZlbnQpLCB0aGlzLmZpcmUoImRyYWciLCB0KSk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0gdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jOwogICAgICBsICYmICh0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgbiA9IGwoZS5vcmlnaW5FdmVudCksIHRoaXMuX2NyZWF0ZVNjaGVkdWxlKG4pLCB0aGlzLmZpcmUodCB8fCAiZHJhZ2VuZCIsIG4pLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsKTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IHRoaXM7CiAgICAgIHRoaXMuY2hlY2tFeHBlY3RlZENvbmRpdGlvbihlLnRhcmdldCkgJiYgIXRoaXMuX2Rpc2FibGVDbGljayAmJiAodCA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEodGhpcy52aWV3LCBlLm9yaWdpbkV2ZW50KSwgbiA9IHQoZS5vcmlnaW5FdmVudCksIHRoaXMuX3JlcXVlc3RPbkNsaWNrID0gITAsIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGwuX3JlcXVlc3RPbkNsaWNrICYmIChsLmZpcmUoImNsaWNrIiwgbiksIGwuX2NyZWF0ZVNjaGVkdWxlKG4pKSwgbC5fcmVxdWVzdE9uQ2xpY2sgPSAhMTsKICAgICAgfSwgaCkpOwogICAgfSwgcC5wcm90b3R5cGUuX29uRGJsQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdDsKICAgICAgdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGUudGFyZ2V0KSAmJiAodCA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEodGhpcy52aWV3LCBlKShlKSwgdGhpcy5maXJlKCJjbGljayIsIHQpLCB0aGlzLl9jcmVhdGVTY2hlZHVsZSh0KSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMSk7CiAgICB9LCBwLnByb3RvdHlwZS5pbnZva2VDcmVhdGlvbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhRnJvbURhdGUodGhpcy52aWV3LCBlLnN0YXJ0KTsKCiAgICAgIHRoaXMuZmlyZSgiY2xpY2siLCB0KSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUodCk7CiAgICB9LCBhLm1peGluKGMsIHApLCBsLkN1c3RvbUV2ZW50cy5taXhpbihwKSwgZS5leHBvcnRzID0gcDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigyKSwKICAgICAgICBvID0gbigxKSwKICAgICAgICBpID0gbigxMSk7CgogICAgZnVuY3Rpb24gYShlKSB7CiAgICAgIHRoaXMuY3JlYXRpb24gPSBlLCB0aGlzLnNjaGVkdWxlQ29udGFpbmVyID0gbnVsbCwgdGhpcy5ndWlkZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgdGhpcy5pbml0aWFsaXplR3VpZGVFbGVtZW50KCksIHRoaXMuYXBwbHlUaGVtZShlLmNvbnRyb2xsZXIudGhlbWUpLCBlLm9uKHsKICAgICAgICBkcmFnc3RhcnQ6IHRoaXMuX2NyZWF0ZUd1aWRlRWxlbWVudCwKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgY2xpY2s6IHRoaXMuX2NyZWF0ZUd1aWRlRWxlbWVudAogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICBhLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmNsZWFyR3VpZGVFbGVtZW50KCksIHRoaXMuY3JlYXRpb24ub2ZmKHRoaXMpLCB0aGlzLmNyZWF0aW9uID0gdGhpcy5zY2hlZHVsZUNvbnRhaW5lciA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbDsKICAgIH0sIGEucHJvdG90eXBlLmluaXRpYWxpemVHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG8uYWRkQ2xhc3ModGhpcy5ndWlkZUVsZW1lbnQsIGwuY2xhc3NuYW1lKCJkYXlncmlkLWd1aWRlLWNyZWF0aW9uLWJsb2NrIikpOwogICAgfSwgYS5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQoZSwgITApOwogICAgfSwgYS5wcm90b3R5cGUuX2dldEd1aWRlV2lkdGggPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICBmb3IgKHZhciBsID0gMCwgbyA9IGU7IG8gPD0gdDsgbyArPSAxKSB7CiAgICAgICAgbCArPSBuW29dID8gbltvXS53aWR0aCA6IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBsOwogICAgfSwgYS5wcm90b3R5cGUuX3JlZnJlc2hHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBvID0gdGhpcy5ndWlkZUVsZW1lbnQsCiAgICAgICAgICBhID0gZSwKICAgICAgICAgIHIgPSBhLmRyYWdTdGFydFhJbmRleCA8IGEueEluZGV4ID8gYS5kcmFnU3RhcnRYSW5kZXggOiBhLnhJbmRleCwKICAgICAgICAgIHMgPSBhLmRyYWdTdGFydFhJbmRleCA8IGEueEluZGV4ID8gYS54SW5kZXggOiBhLmRyYWdTdGFydFhJbmRleDsKCiAgICAgIGZ1bmN0aW9uIGMoKSB7CiAgICAgICAgby5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIiwgby5zdHlsZS5sZWZ0ID0gbiArICIlIiwgby5zdHlsZS53aWR0aCA9IGwgKyAiJSI7CiAgICAgIH0KCiAgICAgIG4gPSBhLmdyaWRzW3JdID8gYS5ncmlkc1tyXS5sZWZ0IDogMCwgbCA9IHRoaXMuX2dldEd1aWRlV2lkdGgociwgcywgYS5ncmlkcyksIHQgPyBpLnJlcXVlc3RBbmltRnJhbWUoYykgOiBjKCk7CiAgICB9LCBhLnByb3RvdHlwZS5jbGVhckd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmd1aWRlRWxlbWVudDsKICAgICAgby5yZW1vdmUoZSksIGUuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZS5zdHlsZS5sZWZ0ID0gIiIsIGUuc3R5bGUud2lkdGggPSAiIjsKICAgIH0sIGEucHJvdG90eXBlLl9jcmVhdGVHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuY3JlYXRpb24udmlldy5jb250YWluZXI7CiAgICAgIG8uZmluZChsLmNsYXNzbmFtZSgiLndlZWtkYXktZ3JpZCIpLCB0KS5hcHBlbmRDaGlsZCh0aGlzLmd1aWRlRWxlbWVudCksIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQoZSk7CiAgICB9LCBhLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudChlKTsKICAgIH0sIGEucHJvdG90eXBlLmFwcGx5VGhlbWUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ3VpZGVFbGVtZW50LnN0eWxlOwogICAgICB0LmJhY2tncm91bmRDb2xvciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYmFja2dyb3VuZENvbG9yLCB0LmJvcmRlciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYm9yZGVyOwogICAgfSwgZS5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig1KSwKICAgICAgICBzID0gbigxNyksCiAgICAgICAgYyA9IG4oODgpLAogICAgICAgIHUgPSBuKDQpLkRhdGU7CgogICAgZnVuY3Rpb24gZChlLCB0LCBuKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLnZpZXcgPSB0LCB0aGlzLmNvbnRyb2xsZXIgPSBuLCB0aGlzLl9kcmFnU3RhcnQgPSBudWxsLCBlLm9uKHsKICAgICAgICBkcmFnU3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0CiAgICAgIH0sIHRoaXMpLCB0aGlzLmd1aWRlID0gbmV3IGModGhpcyk7CiAgICB9CgogICAgZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmRyYWdIYW5kbGVyID0gdGhpcy52aWV3ID0gdGhpcy5jb250cm9sbGVyID0gdGhpcy5ndWlkZSA9IHRoaXMuX2RyYWdTdGFydCA9IG51bGw7CiAgICB9LCBkLnByb3RvdHlwZS5jaGVja0V4cGVjdGVkQ29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gYS5nZXRDbGFzcyhlKTsKICAgICAgcmV0dXJuICEhfm4uaW5kZXhPZihvLmNsYXNzbmFtZSgid2Vla2RheS1yZXNpemUtaGFuZGxlIikpICYmICEhKGUgPSBhLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5IikpKSAmJiAhKCEodCA9IChuID0gYS5nZXRDbGFzcyhlKSkubWF0Y2goby5kYXlncmlkLmdldFZpZXdJRFJlZ0V4cCkpIHx8IHQubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudmlldy5jaGlsZHJlbi5pdGVtcywgdFsxXSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBpLAogICAgICAgICAgciwKICAgICAgICAgIHMsCiAgICAgICAgICBjID0gZS50YXJnZXQsCiAgICAgICAgICB1ID0gdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGMpLAogICAgICAgICAgZCA9IHRoaXMuY29udHJvbGxlcjsKICAgICAgdSAmJiAodCA9IGEuY2xvc2VzdChjLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSksIG4gPSBhLmdldERhdGEodCwgImlkIiksIChpID0gZC5zY2hlZHVsZXMuaXRlbXNbbl0pICYmIChyID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0aGlzLnZpZXcsIGUub3JpZ2luRXZlbnQpLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSByLCBzID0gdGhpcy5fZHJhZ1N0YXJ0ID0gcihlLm9yaWdpbkV2ZW50KSwgbC5leHRlbmQocywgewogICAgICAgIHNjaGVkdWxlQmxvY2tFbGVtZW50OiB0LAogICAgICAgIG1vZGVsOiBpCiAgICAgIH0pLCB0aGlzLmRyYWdIYW5kbGVyLm9uKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kLAogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpLCB0aGlzLmZpcmUoImRyYWdzdGFydCIsIHMpKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmM7CiAgICAgIHQgJiYgdGhpcy5maXJlKCJkcmFnIiwgdChlLm9yaWdpbkV2ZW50KSk7CiAgICB9LCBkLnByb3RvdHlwZS5fdXBkYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBlLnRhcmdldE1vZGVsLAogICAgICAgICAgbCA9IGUueEluZGV4IC0gZS5kcmFnU3RhcnRYSW5kZXgsCiAgICAgICAgICBvID0gbmV3IHUobi5lbmQpOwogICAgICBvID0gby5hZGREYXRlKGwpLCBvID0gbmV3IHUoci5tYXhEYXRlKGkuZW5kKG4uc3RhcnQpLCBvKSksIHQgPSByLmdldFNjaGVkdWxlQ2hhbmdlcyhuLCBbImVuZCJdLCB7CiAgICAgICAgZW5kOiBvCiAgICAgIH0pLCB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiBuLAogICAgICAgIGNoYW5nZXM6IHQsCiAgICAgICAgc3RhcnQ6IG4uZ2V0U3RhcnRzKCksCiAgICAgICAgZW5kOiBvCiAgICAgIH0pOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvLAogICAgICAgICAgaSA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgIGEgPSB0aGlzLl9kcmFnU3RhcnQ7CiAgICAgIGkgJiYgYSAmJiAodGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIG8gPSBpKGUub3JpZ2luRXZlbnQpLCBsLmV4dGVuZChvLCB7CiAgICAgICAgdGFyZ2V0TW9kZWw6IGEubW9kZWwKICAgICAgfSksIG4gfHwgdGhpcy5fdXBkYXRlU2NoZWR1bGUobyksIHRoaXMuZmlyZSh0IHx8ICJkcmFnZW5kIiwgbyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX2RyYWdTdGFydCA9IG51bGwpOwogICAgfSwgZC5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9vbkRyYWdFbmQoZSwgImNsaWNrIiwgITApOwogICAgfSwgci5taXhpbihzLCBkKSwgbC5DdXN0b21FdmVudHMubWl4aW4oZCksIGUuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oMiksCiAgICAgICAgICBpID0gbigxKSwKICAgICAgICAgIGEgPSBuKDMpLAogICAgICAgICAgciA9IG4oMTEpOwoKICAgICAgZnVuY3Rpb24gcyhlKSB7CiAgICAgICAgdGhpcy5yZXNpemVIYW5kbGVyID0gZSwgdGhpcy5zY2hlZHVsZUNvbnRhaW5lciA9IG51bGwsIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwsIHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbCwgdGhpcy5zY2hlZHVsZUJsb2NrRWxlbWVudCA9IG51bGwsIGUub24oewogICAgICAgICAgZHJhZ3N0YXJ0OiB0aGlzLl9vbkRyYWdTdGFydCwKICAgICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIGRyYWdlbmQ6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50LAogICAgICAgICAgY2xpY2s6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50CiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHMucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy5yZXNpemVIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5yZXNpemVIYW5kbGVyID0gdGhpcy5zY2hlZHVsZUNvbnRhaW5lciA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gdGhpcy5zY2hlZHVsZUJsb2NrRWxlbWVudCA9IG51bGw7CiAgICAgIH0sIHMucHJvdG90eXBlLl9jbGVhckd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpLnJlbW92ZSh0aGlzLmd1aWRlRWxlbWVudCksIGwuYnJvd3Nlci5tc2llIHx8IGkucmVtb3ZlQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgicmVzaXppbmcteCIpKSwgdGhpcy5zY2hlZHVsZUJsb2NrRWxlbWVudCAmJiBpLnJlbW92ZUNsYXNzKHRoaXMuc2NoZWR1bGVCbG9ja0VsZW1lbnQsIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLWRyYWdnaW5nLWRpbSIpKSwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gbnVsbDsKICAgICAgfSwgcy5wcm90b3R5cGUucmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmd1aWRlRWxlbWVudDsKICAgICAgICByLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgdC5zdHlsZS53aWR0aCA9IGUgKyAiJSI7CiAgICAgICAgfSk7CiAgICAgIH0sIHMucHJvdG90eXBlLmdldEd1aWRlRWxlbWVudFdpZHRoRnVuYyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBlLm1vZGVsLAogICAgICAgICAgICBuID0gdGhpcy5yZXNpemVIYW5kbGVyLnZpZXcub3B0aW9ucywKICAgICAgICAgICAgbCA9IE1hdGguY2VpbCgodC5zdGFydCAtIG4ucmVuZGVyU3RhcnREYXRlKSAvIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpIHx8IDAsCiAgICAgICAgICAgIG8gPSBlLmdyaWRzOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHQgPSAwLAogICAgICAgICAgICAgIG4gPSAwLAogICAgICAgICAgICAgIGkgPSBvLmxlbmd0aDsKCiAgICAgICAgICBmb3IgKHQgKz0gb1tsXSA/IG9bbF0ud2lkdGggOiAwOyBuIDwgaTsgbiArPSAxKSB7CiAgICAgICAgICAgIG4gPiBsICYmIG4gPD0gZSAmJiAodCArPSBvW25dID8gb1tuXS53aWR0aCA6IDApOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH07CiAgICAgIH0sIHMucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGEgPSB0aGlzLnJlc2l6ZUhhbmRsZXIudmlldy5jb250YWluZXIsCiAgICAgICAgICAgIHIgPSB0aGlzLnNjaGVkdWxlQmxvY2tFbGVtZW50ID0gZS5zY2hlZHVsZUJsb2NrRWxlbWVudCwKICAgICAgICAgICAgcyA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gci5jbG9uZU5vZGUoITApOwogICAgICAgIGwuYnJvd3Nlci5tc2llIHx8IGkuYWRkQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgicmVzaXppbmcteCIpKSwgbiA9IGkuZmluZChvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGVzIiksIGEpLCBpLmFkZENsYXNzKHMsIG8uY2xhc3NuYW1lKCJkYXlncmlkLWd1aWRlLW1vdmUiKSksIGkuYWRkQ2xhc3Mociwgby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIikpLCBuLmFwcGVuZENoaWxkKHMpLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLmdldEd1aWRlRWxlbWVudFdpZHRoRnVuYyhlKTsKICAgICAgfSwgcy5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmM7CiAgICAgICAgdCAmJiB0aGlzLnJlZnJlc2hHdWlkZUVsZW1lbnQodChlLnhJbmRleCkpOwogICAgICB9LCBlLmV4cG9ydHMgPSBzOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKTsKCiAgICBmdW5jdGlvbiBhKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudGltZUdyaWRWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIGUub24oewogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpOwogICAgfQoKICAgIGEucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLnRpbWVHcmlkVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLmRyYWdIYW5kbGVyID0gbnVsbDsKICAgIH0sIGEucHJvdG90eXBlLmNoZWNrRXhwZWN0Q29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgIHJldHVybiAhISh0ID0gaS5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlIikpKSAmJiAhKCEobiA9IGkuZ2V0Q2xhc3ModCkubWF0Y2goby50aW1lLmdldFZpZXdJRFJlZ0V4cCkpIHx8IG4ubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudGltZUdyaWRWaWV3LmNoaWxkcmVuLml0ZW1zLCBOdW1iZXIoblsxXSkpOwogICAgfSwgYS5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICBuID0gZS50YXJnZXQsCiAgICAgICAgICBsID0gdGhpcy5jaGVja0V4cGVjdENvbmRpdGlvbihuKSwKICAgICAgICAgIGEgPSBpLmNsb3Nlc3Qobiwgby5jbGFzc25hbWUoIi50aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siKSksCiAgICAgICAgICByID0gdGhpcy5iYXNlQ29udHJvbGxlci5zY2hlZHVsZXM7CiAgICAgIGwgJiYgYSAmJiByLmRvV2hlbkhhcyhpLmdldERhdGEoYSwgImlkIiksIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdC5maXJlKCJjbGlja1NjaGVkdWxlIiwgewogICAgICAgICAgc2NoZWR1bGU6IG4sCiAgICAgICAgICBldmVudDogZS5vcmlnaW5FdmVudAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKGEpLCBlLmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDE1KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbigxKSwKICAgICAgICBzID0gbig2KSwKICAgICAgICBjID0gbig1KSwKICAgICAgICB1ID0gbig5MSksCiAgICAgICAgZCA9IG4oNCkuRGF0ZSwKICAgICAgICBoID0gbigxOCksCiAgICAgICAgcCA9IDMwMDsKCiAgICBmdW5jdGlvbiBtKGUsIHQsIG4sIGwpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudGltZUdyaWRWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIHRoaXMuZ3VpZGUgPSBuZXcgdSh0aGlzKSwgdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwsIHRoaXMuX2RyYWdTdGFydCA9IG51bGwsIHRoaXMuX3JlcXVlc3RPbkNsaWNrID0gITEsIHRoaXMuX2Rpc2FibGVEYmxDbGljayA9IGwuZGlzYWJsZURibENsaWNrLCB0aGlzLl9kaXNhYmxlQ2xpY2sgPSBsLmRpc2FibGVDbGljaywgZS5vbigiZHJhZ1N0YXJ0IiwgdGhpcy5fb25EcmFnU3RhcnQsIHRoaXMpLCBlLm9uKCJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpLCB0aGlzLl9kaXNhYmxlRGJsQ2xpY2sgPyBwID0gMCA6IHMub24odC5jb250YWluZXIsICJkYmxjbGljayIsIHRoaXMuX29uRGJsQ2xpY2ssIHRoaXMpOwogICAgfQoKICAgIG0ucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy50aW1lR3JpZFZpZXc7CiAgICAgIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgZSAmJiBlLmNvbnRhaW5lciAmJiBzLm9mZihlLmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLnRpbWVHcmlkVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZHJhZ1N0YXJ0ID0gdGhpcy5ndWlkZSA9IG51bGw7CiAgICB9LCBtLnByb3RvdHlwZS5jaGVja0V4cGVjdGVkQ29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gci5nZXRDbGFzcyhlKTsKICAgICAgcmV0dXJuIG4gPT09IG8uY2xhc3NuYW1lKCJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2std3JhcCIpICYmIChlID0gZS5wYXJlbnROb2RlLCBuID0gci5nZXRDbGFzcyhlKSksICEoISh0ID0gbi5tYXRjaChvLnRpbWUuZ2V0Vmlld0lEUmVnRXhwKSkgfHwgdC5sZW5ndGggPCAyKSAmJiBsLnBpY2sodGhpcy50aW1lR3JpZFZpZXcuY2hpbGRyZW4uaXRlbXMsIHRbMV0pOwogICAgfSwgbS5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwsCiAgICAgICAgICBvLAogICAgICAgICAgaSA9IGUudGFyZ2V0LAogICAgICAgICAgYSA9IHRoaXMuY2hlY2tFeHBlY3RlZENvbmRpdGlvbihpKTsKICAgICAgYSAmJiAobCA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhKGEpLCBvID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbChlLm9yaWdpbkV2ZW50KSwgbiAmJiBuKG8pLCB0aGlzLmRyYWdIYW5kbGVyLm9uKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCB0aGlzLmZpcmUodCB8fCAidGltZUNyZWF0aW9uRHJhZ3N0YXJ0IiwgbykpOwogICAgfSwgbS5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbyA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmM7CiAgICAgIG8gJiYgKGwgPSBvKGUub3JpZ2luRXZlbnQpLCBuICYmIG4obCksIHRoaXMuZmlyZSh0IHx8ICJ0aW1lQ3JlYXRpb25EcmFnIiwgbCkpOwogICAgfSwgbS5wcm90b3R5cGUuX2NyZWF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpLAogICAgICAgICAgciA9IGUucmVsYXRlZFZpZXcsCiAgICAgICAgICBzID0gZS5jcmVhdGVSYW5nZSwKICAgICAgICAgIHUgPSBlLm5lYXJlc3RHcmlkVGltZVksCiAgICAgICAgICBoID0gZS5uZWFyZXN0R3JpZEVuZFRpbWVZID8gZS5uZWFyZXN0R3JpZEVuZFRpbWVZIDogbmV3IGQodSkuYWRkTWludXRlcygzMCk7CiAgICAgIHMgfHwgKHMgPSBbdSwgaF0pLCB0ID0gbmV3IGQoci5nZXREYXRlKCkpLCBuID0gYS5zdGFydCh0KSwgbCA9IGEuZ2V0U3RhcnRPZk5leHREYXkodCksIG8gPSBjLmxpbWl0RGF0ZShzWzBdLCBuLCBsKSwgaSA9IGMubGltaXREYXRlKHNbMV0sIG4sIGwpLCB0aGlzLmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgewogICAgICAgIGlzQWxsRGF5OiAhMSwKICAgICAgICBzdGFydDogbmV3IGQobyksCiAgICAgICAgZW5kOiBuZXcgZChpKSwKICAgICAgICBndWlkZTogdGhpcy5ndWlkZSwKICAgICAgICB0cmlnZ2VyRXZlbnROYW1lOiBlLnRyaWdnZXJFdmVudAogICAgICB9KTsKICAgIH0sIG0ucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgICBuID0gdGhpcy5fZHJhZ1N0YXJ0OwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5fb25EcmFnKGUsICJ0aW1lQ3JlYXRpb25EcmFnZW5kIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbCA9IFtuLm5lYXJlc3RHcmlkVGltZVksIGUubmVhcmVzdEdyaWRUaW1lWV0uc29ydChpLmNvbXBhcmUubnVtLmFzYyk7CiAgICAgICAgbFsxXS5hZGRNaW51dGVzKDMwKSwgZS5jcmVhdGVSYW5nZSA9IGwsIHQuX2NyZWF0ZVNjaGVkdWxlKGUpOwogICAgICB9KSwgdGhpcy5fZHJhZ1N0YXJ0ID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGw7CiAgICB9LCBtLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBvID0gdGhpczsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksICh0ID0gdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGUudGFyZ2V0KSkgJiYgIXRoaXMuX2Rpc2FibGVDbGljayAmJiAobiA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEodCksIGwgPSBuKGUub3JpZ2luRXZlbnQpLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICEwLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBvLl9yZXF1ZXN0T25DbGljayAmJiAoby5maXJlKCJ0aW1lQ3JlYXRpb25DbGljayIsIGwpLCBvLl9jcmVhdGVTY2hlZHVsZShsKSksIG8uX3JlcXVlc3RPbkNsaWNrID0gITE7CiAgICAgIH0sIHApLCB0aGlzLl9kcmFnU3RhcnQgPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gbnVsbCk7CiAgICB9LCBtLnByb3RvdHlwZS5fb25EYmxDbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LCBuOwogICAgICAodCA9IHRoaXMuY2hlY2tFeHBlY3RlZENvbmRpdGlvbihlLnRhcmdldCkpICYmIChuID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0KShlKSwgdGhpcy5maXJlKCJ0aW1lQ3JlYXRpb25DbGljayIsIG4pLCB0aGlzLl9jcmVhdGVTY2hlZHVsZShuKSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMSk7CiAgICB9LCBtLnByb3RvdHlwZS5pbnZva2VDcmVhdGlvbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbyA9IHRoaXMudGltZUdyaWRWaWV3Lm9wdGlvbnMsCiAgICAgICAgICBpID0gYS5yYW5nZShvLnJlbmRlclN0YXJ0RGF0ZSwgby5yZW5kZXJFbmREYXRlLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwKICAgICAgICAgIHIgPSBvLmhvdXJTdGFydCwKICAgICAgICAgIHMgPSBlLnN0YXJ0OwogICAgICBsLmZvckVhY2goaSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBhLmlzU2FtZURhdGUoZSwgcykgJiYgKG4gPSB0aGlzLnRpbWVHcmlkVmlldy5jaGlsZHJlbi50b0FycmF5KClbdF0pOwogICAgICB9LCB0aGlzKSwgbiB8fCAobiA9IHRoaXMudGltZUdyaWRWaWV3LmNoaWxkcmVuLnRvQXJyYXkoKVswXSksIHQgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhRnJvbURhdGUobiwgZS5zdGFydCwgZS5lbmQsIHIpLCB0aGlzLmZpcmUoInRpbWVDcmVhdGlvbkNsaWNrIiwgdCksIHRoaXMuX2NyZWF0ZVNjaGVkdWxlKHQpOwogICAgfSwgaC5taXhpbihtKSwgbC5DdXN0b21FdmVudHMubWl4aW4obSksIGUuZXhwb3J0cyA9IG07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDUpLAogICAgICAgICAgbyA9IG4oMyksCiAgICAgICAgICBpID0gbigyKSwKICAgICAgICAgIGEgPSBuKDEpLAogICAgICAgICAgciA9IG4oMTEpLAogICAgICAgICAgcyA9IG4oNSkucmF0aW8sCiAgICAgICAgICBjID0gbig0KS5EYXRlLAogICAgICAgICAgdSA9IDYwICogby5NSUxMSVNFQ09ORFNfUEVSX01JTlVURVM7CgogICAgICBmdW5jdGlvbiBkKGUpIHsKICAgICAgICB0aGlzLmd1aWRlRWxlbWVudCA9IHQuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIHRoaXMuZ3VpZGVUaW1lRWxlbWVudCA9IGEuYXBwZW5kSFRNTEVsZW1lbnQoInNwYW4iLCB0aGlzLmd1aWRlRWxlbWVudCwgaS5jbGFzc25hbWUoInRpbWUtZ3VpZGUtY3JlYXRpb24tbGFiZWwiKSksIGEuYWRkQ2xhc3ModGhpcy5ndWlkZUVsZW1lbnQsIGkuY2xhc3NuYW1lKCJ0aW1lLWd1aWRlLWNyZWF0aW9uIikpLCB0aGlzLnRpbWVDcmVhdGlvbiA9IGUsIHRoaXMuX3N0eWxlVW5pdCA9IG51bGwsIHRoaXMuX3N0eWxlU3RhcnQgPSBudWxsLCB0aGlzLl9zdHlsZUZ1bmMgPSBudWxsLCBlLm9uKHsKICAgICAgICAgIHRpbWVDcmVhdGlvbkRyYWdzdGFydDogdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50LAogICAgICAgICAgdGltZUNyZWF0aW9uRHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgICAgdGltZUNyZWF0aW9uQ2xpY2s6IHRoaXMuX2NyZWF0ZUd1aWRlRWxlbWVudAogICAgICAgIH0sIHRoaXMpLCB0aGlzLmFwcGx5VGhlbWUoZS5iYXNlQ29udHJvbGxlci50aGVtZSk7CiAgICAgIH0KCiAgICAgIGQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jbGVhckd1aWRlRWxlbWVudCgpLCB0aGlzLnRpbWVDcmVhdGlvbi5vZmYodGhpcyksIHRoaXMudGltZUNyZWF0aW9uID0gdGhpcy5fc3R5bGVVbml0ID0gdGhpcy5fc3R5bGVTdGFydCA9IHRoaXMuX3N0eWxlRnVuYyA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gdGhpcy5ndWlkZVRpbWVFbGVtZW50ID0gbnVsbDsKICAgICAgfSwgZC5wcm90b3R5cGUuY2xlYXJHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLmd1aWRlRWxlbWVudCwKICAgICAgICAgICAgdCA9IHRoaXMuZ3VpZGVUaW1lRWxlbWVudDsKICAgICAgICBhLnJlbW92ZShlKSwgci5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGUuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgZS5zdHlsZS50b3AgPSAiIiwgZS5zdHlsZS5oZWlnaHQgPSAiIiwgdC5pbm5lckhUTUwgPSAiIjsKICAgICAgICB9KTsKICAgICAgfSwgZC5wcm90b3R5cGUuX3JlZnJlc2hHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgcikgewogICAgICAgIHZhciBzID0gdGhpcy5ndWlkZUVsZW1lbnQsCiAgICAgICAgICAgIGMgPSB0aGlzLmd1aWRlVGltZUVsZW1lbnQ7CiAgICAgICAgcy5zdHlsZS50b3AgPSBlICsgInB4Iiwgcy5zdHlsZS5oZWlnaHQgPSB0ICsgInB4Iiwgcy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIiwgYy5pbm5lckhUTUwgPSBvLmZvcm1hdChuLCAiSEg6bW0iKSArICIgLSAiICsgby5mb3JtYXQobCwgIkhIOm1tIiksIHIgPyBhLnJlbW92ZUNsYXNzKGMsIGkuY2xhc3NuYW1lKCJ0aW1lLWd1aWRlLWJvdHRvbSIpKSA6IGEuYWRkQ2xhc3MoYywgaS5jbGFzc25hbWUoInRpbWUtZ3VpZGUtYm90dG9tIikpOwogICAgICB9LCBkLnByb3RvdHlwZS5fZ2V0VW5pdERhdGEgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gZS5vcHRpb25zLAogICAgICAgICAgICBuID0gZS5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsCiAgICAgICAgICAgIGwgPSB0LmhvdXJFbmQgLSB0LmhvdXJTdGFydCwKICAgICAgICAgICAgaSA9IG8ucGFyc2UodC55bWQpLAogICAgICAgICAgICBhID0gby5nZXRTdGFydE9mTmV4dERheShpKTsKICAgICAgICByZXR1cm4gaS5zZXRIb3VycygwLCAwLCAwLCAwKSwgaS5zZXRIb3Vycyh0LmhvdXJTdGFydCksIFtuLCBsLCBpLCBhLCBuIC8gbF07CiAgICAgIH0sIGQucHJvdG90eXBlLl9saW1pdFN0eWxlRGF0YSA9IGZ1bmN0aW9uIChlLCB0LCBuLCBvKSB7CiAgICAgICAgdmFyIGkgPSB0aGlzLl9zdHlsZVVuaXQ7CiAgICAgICAgcmV0dXJuIFtlID0gbC5saW1pdChlLCBbMF0sIFtpWzBdXSksIHQgPSBsLmxpbWl0KGUgKyB0LCBbMF0sIFtpWzBdXSkgLSBlLCBuID0gbC5saW1pdERhdGUobiwgaVsyXSwgaVszXSksIG8gPSBsLmxpbWl0RGF0ZShvLCBpWzJdLCBpWzNdKV07CiAgICAgIH0sIGQucHJvdG90eXBlLl9nZXRTdHlsZURhdGFGdW5jID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgICB2YXIgaSA9IG4sCiAgICAgICAgICAgIGEgPSBvLmVuZChuKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBvID0gbi5uZWFyZXN0R3JpZFksCiAgICAgICAgICAgICAgciA9IG4ubmVhcmVzdEdyaWRUaW1lWSwKICAgICAgICAgICAgICB1ID0gbi5uZWFyZXN0R3JpZEVuZFRpbWVZIHx8IG5ldyBjKHIpLmFkZE1pbnV0ZXMoMzApOwogICAgICAgICAgcmV0dXJuIFtsLmxpbWl0KHModCwgZSwgbyksIFswXSwgW2VdKSwgbC5saW1pdERhdGUociwgaSwgYSksIGwubGltaXREYXRlKHUsIGksIGEpXTsKICAgICAgICB9OwogICAgICB9LCBkLnByb3RvdHlwZS5fY3JlYXRlR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgbCwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcywKICAgICAgICAgICAgZCwKICAgICAgICAgICAgaCA9IGUucmVsYXRlZFZpZXcsCiAgICAgICAgICAgIHAgPSBvLm1pbGxpc2Vjb25kc0Zyb20oImhvdXIiLCBlLmhvdXJTdGFydCkgfHwgMDsKICAgICAgICB0ID0gdGhpcy5fc3R5bGVVbml0ID0gdGhpcy5fZ2V0VW5pdERhdGEoaCksIG4gPSB0aGlzLl9zdHlsZUZ1bmMgPSB0aGlzLl9nZXRTdHlsZURhdGFGdW5jLmFwcGx5KHRoaXMsIHQpLCBsID0gdGhpcy5fc3R5bGVTdGFydCA9IG4oZSksIHMgPSBuZXcgYyhsWzFdKS5hZGRNaW51dGVzKG8ubWludXRlc0Zyb21Ib3VycyhwKSksIGQgPSBuZXcgYyhsWzJdKS5hZGRNaW51dGVzKG8ubWludXRlc0Zyb21Ib3VycyhwKSksIGEgPSBsWzBdLCByID0gdFs0XSAqIChkIC0gcykgLyB1LCBpID0gdGhpcy5fbGltaXRTdHlsZURhdGEoYSwgciwgcywgZCksIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQuYXBwbHkodGhpcywgaSksIGguY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZ3VpZGVFbGVtZW50KTsKICAgICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIG8gPSB0aGlzLl9zdHlsZUZ1bmMsCiAgICAgICAgICAgIGkgPSB0aGlzLl9zdHlsZVVuaXQsCiAgICAgICAgICAgIGEgPSB0aGlzLl9zdHlsZVN0YXJ0LAogICAgICAgICAgICBzID0gdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudC5iaW5kKHRoaXMpOwoKICAgICAgICBvICYmIGkgJiYgYSAmJiAodCA9IGlbNF0gLyAyLCAobiA9IG8oZSkpWzBdID4gYVswXSA/IGwgPSB0aGlzLl9saW1pdFN0eWxlRGF0YShhWzBdLCBuWzBdIC0gYVswXSArIHQsIGFbMV0sIG5ldyBjKG5bMV0pLmFkZE1pbnV0ZXMoMzApKSA6IChsID0gdGhpcy5fbGltaXRTdHlsZURhdGEoblswXSwgYVswXSAtIG5bMF0gKyB0LCBuWzFdLCBuZXcgYyhhWzFdKS5hZGRNaW51dGVzKDMwKSkpLnB1c2goITApLCByLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcy5hcHBseShudWxsLCBsKTsKICAgICAgICB9KSk7CiAgICAgIH0sIGQucHJvdG90eXBlLmFwcGx5VGhlbWUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5ndWlkZUVsZW1lbnQuc3R5bGUsCiAgICAgICAgICAgIG4gPSB0aGlzLmd1aWRlVGltZUVsZW1lbnQuc3R5bGU7CiAgICAgICAgdC5iYWNrZ3JvdW5kQ29sb3IgPSBlLmNvbW1vbi5jcmVhdGlvbkd1aWRlLmJhY2tncm91bmRDb2xvciwgdC5ib3JkZXIgPSBlLmNvbW1vbi5jcmVhdGlvbkd1aWRlLmJvcmRlciwgbi5jb2xvciA9IGUud2Vlay5jcmVhdGlvbkd1aWRlLmNvbG9yLCBuLmZvbnRTaXplID0gZS53ZWVrLmNyZWF0aW9uR3VpZGUuZm9udFNpemUsIG4uZm9udFdlaWdodCA9IGUud2Vlay5jcmVhdGlvbkd1aWRlLmZvbnRXZWlnaHQ7CiAgICAgIH0sIGUuZXhwb3J0cyA9IGQ7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDYpLAogICAgICAgIHMgPSBuKDQpLkRhdGUsCiAgICAgICAgYyA9IG4oMTgpLAogICAgICAgIHUgPSBuKDkzKTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudGltZUdyaWRWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsLCB0aGlzLl9kcmFnU3RhcnQgPSBudWxsLCB0aGlzLl9ndWlkZSA9IG5ldyB1KHRoaXMpLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyksIGUub24oIm1vdXNlZG93biIsIHRoaXMuX29uTW91c2VEb3duLCB0aGlzKTsKICAgIH0KCiAgICBkLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmRyYWdIYW5kbGVyID0gdGhpcy50aW1lR3JpZFZpZXcgPSB0aGlzLmJhc2VDb250cm9sbGVyID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX2RyYWdTdGFydCA9IHRoaXMuX2d1aWRlID0gbnVsbDsKICAgIH0sIGQucHJvdG90eXBlLmNoZWNrRXhwZWN0Q29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuICEhYS5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIudGltZS1zY2hlZHVsZSIpKSAmJiB0aGlzLl9nZXRUaW1lVmlldyhlKTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXRUaW1lVmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IGEuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZSIpKTsKICAgICAgcmV0dXJuICEhbiAmJiAhKCEodCA9IGEuZ2V0Q2xhc3MobikubWF0Y2goby50aW1lLmdldFZpZXdJRFJlZ0V4cCkpIHx8IHQubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudGltZUdyaWRWaWV3LmNoaWxkcmVuLml0ZW1zLCBOdW1iZXIodFsxXSkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLnRhcmdldCwKICAgICAgICAgIG4gPSB0aGlzLmNoZWNrRXhwZWN0Q29uZGl0aW9uKHQpLAogICAgICAgICAgaSA9IGEuY2xvc2VzdCh0LCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKTsKICAgICAgbiAmJiBpICYmIGwuYnJvd3Nlci5maXJlZm94ICYmIHIucHJldmVudERlZmF1bHQoZS5vcmlnaW5FdmVudCk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgaSwKICAgICAgICAgIHIgPSBlLnRhcmdldCwKICAgICAgICAgIHMgPSB0aGlzLmNoZWNrRXhwZWN0Q29uZGl0aW9uKHIpLAogICAgICAgICAgYyA9IGEuY2xvc2VzdChyLCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKSwKICAgICAgICAgIHUgPSB0aGlzLmJhc2VDb250cm9sbGVyOwogICAgICBzICYmIGMgJiYgKGwgPSBhLmdldERhdGEoYywgImlkIiksIChpID0gdS5zY2hlZHVsZXMuaXRlbXNbbF0pLmlzUmVhZE9ubHkgfHwgKHQgPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YShzKSwgbiA9IHRoaXMuX2RyYWdTdGFydCA9IHQoZS5vcmlnaW5FdmVudCwgewogICAgICAgIHRhcmdldE1vZGVsSUQ6IGwsCiAgICAgICAgbW9kZWw6IGkKICAgICAgfSksIHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIHRoaXMuZmlyZSgidGltZU1vdmVEcmFnc3RhcnQiLCBuKSkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbyA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICBpID0gdGhpcy5fZ2V0VGltZVZpZXcoZS50YXJnZXQpLAogICAgICAgICAgYSA9IHRoaXMuX2RyYWdTdGFydDsKCiAgICAgIGkgJiYgbyAmJiBhICYmIChsID0gbyhlLm9yaWdpbkV2ZW50LCB7CiAgICAgICAgY3VycmVudFZpZXc6IGksCiAgICAgICAgdGFyZ2V0TW9kZWxJRDogYS50YXJnZXRNb2RlbElECiAgICAgIH0pLCBuICYmIG4obCksIHRoaXMuZmlyZSh0IHx8ICJ0aW1lTW92ZURyYWciLCBsKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fdXBkYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpcy5iYXNlQ29udHJvbGxlciwKICAgICAgICAgIG8gPSBlLnRhcmdldE1vZGVsSUQsCiAgICAgICAgICBhID0gZS5uZWFyZXN0UmFuZ2UsCiAgICAgICAgICByID0gYVsxXSAtIGFbMF0sCiAgICAgICAgICBjID0gMCwKICAgICAgICAgIHUgPSBsLnNjaGVkdWxlcy5pdGVtc1tvXSwKICAgICAgICAgIGQgPSBlLnJlbGF0ZWRWaWV3LAogICAgICAgICAgaCA9IGUuY3VycmVudFZpZXc7CiAgICAgIHUgJiYgaCAmJiAociAtPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCAzMCksIHQgPSBuZXcgcyh1LmdldFN0YXJ0cygpKS5hZGRNaWxsaXNlY29uZHMociksIG4gPSBuZXcgcyh1LmdldEVuZHMoKSkuYWRkTWlsbGlzZWNvbmRzKHIpLCBoICYmIChjID0gaC5nZXREYXRlKCkgLSBkLmdldERhdGUoKSksIHQuYWRkTWlsbGlzZWNvbmRzKGMpLCBuLmFkZE1pbGxpc2Vjb25kcyhjKSwgdGhpcy5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIHsKICAgICAgICBzY2hlZHVsZTogdSwKICAgICAgICBjaGFuZ2VzOiB7CiAgICAgICAgICBzdGFydDogdCwKICAgICAgICAgIGVuZDogbgogICAgICAgIH0sCiAgICAgICAgc3RhcnQ6IHQsCiAgICAgICAgZW5kOiBuCiAgICAgIH0pKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jLAogICAgICAgICAgbCA9IHRoaXMuX2dldFRpbWVWaWV3KGUudGFyZ2V0KSwKICAgICAgICAgIG8gPSB0aGlzLl9kcmFnU3RhcnQ7CgogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgbiAmJiBvICYmICgodCA9IG4oZS5vcmlnaW5FdmVudCwgewogICAgICAgIGN1cnJlbnRWaWV3OiBsLAogICAgICAgIHRhcmdldE1vZGVsSUQ6IG8udGFyZ2V0TW9kZWxJRAogICAgICB9KSkucmFuZ2UgPSBbby50aW1lWSwgbmV3IHModC50aW1lWSkuYWRkTWludXRlcygzMCldLCB0Lm5lYXJlc3RSYW5nZSA9IFtvLm5lYXJlc3RHcmlkVGltZVksIG5ldyBzKHQubmVhcmVzdEdyaWRUaW1lWSkuYWRkTWludXRlcygzMCldLCB0aGlzLl91cGRhdGVTY2hlZHVsZSh0KSwgdGhpcy5maXJlKCJ0aW1lTW92ZURyYWdlbmQiLCB0KSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICBsID0gdGhpcy5fZHJhZ1N0YXJ0OwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgbiAmJiBsICYmICh0ID0gbihlLm9yaWdpbkV2ZW50LCB7CiAgICAgICAgdGFyZ2V0TW9kZWxJRDogbC50YXJnZXRNb2RlbElECiAgICAgIH0pLCB0aGlzLmZpcmUoInRpbWVNb3ZlQ2xpY2siLCB0KSk7CiAgICB9LCBjLm1peGluKGQpLCBsLkN1c3RvbUV2ZW50cy5taXhpbihkKSwgZS5leHBvcnRzID0gZDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDEpLAogICAgICAgICAgYSA9IG4oMTEpLAogICAgICAgICAgciA9IG4oNSkucmF0aW8sCiAgICAgICAgICBzID0gbigxNiksCiAgICAgICAgICBjID0gbig5NCksCiAgICAgICAgICB1ID0gbig0KS5EYXRlLAogICAgICAgICAgZCA9IG4oMTQpLAogICAgICAgICAgaCA9IG4oMyksCiAgICAgICAgICBwID0gbig1KSwKICAgICAgICAgIG0gPSBoLk1JTExJU0VDT05EU19TQ0hFRFVMRV9NSU5fRFVSQVRJT047CgogICAgICBmdW5jdGlvbiBmKGUpIHsKICAgICAgICB0aGlzLl9ndWlkZUxheWVyID0gbnVsbCwgdGhpcy5fbW9kZWwgPSBudWxsLCB0aGlzLl92aWV3TW9kZWwgPSBudWxsLCB0aGlzLl9sYXN0RHJhZyA9IG51bGwsIHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbCwgdGhpcy50aW1lTW92ZSA9IGUsIHRoaXMuX2NvbnRhaW5lciA9IG51bGwsIHRoaXMuX2dldFRvcEZ1bmMgPSBudWxsLCB0aGlzLl9zdGFydEdyaWRZID0gMCwgdGhpcy5fc3RhcnRUb3BQaXhlbCA9IDAsIGUub24oewogICAgICAgICAgdGltZU1vdmVEcmFnc3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0LAogICAgICAgICAgdGltZU1vdmVEcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICB0aW1lTW92ZURyYWdlbmQ6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50LAogICAgICAgICAgdGltZU1vdmVDbGljazogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQoKICAgICAgZi5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jbGVhckd1aWRlRWxlbWVudCgpLCB0aGlzLnRpbWVNb3ZlLm9mZih0aGlzKSwgdGhpcy5fZ3VpZGVMYXllciAmJiB0aGlzLl9ndWlkZUxheWVyLmRlc3Ryb3koKSwgdGhpcy5ndWlkZUVsZW1lbnQgPSB0aGlzLnRpbWVNb3ZlID0gdGhpcy5fY29udGFpbmVyID0gdGhpcy5fZ3VpZGVMYXllciA9IHRoaXMuX2xhc3REcmFnID0gdGhpcy5fZ2V0VG9wRnVuYyA9IHRoaXMuX3N0YXJ0R3JpZFkgPSB0aGlzLl9zdGFydFRvcFBpeGVsID0gdGhpcy5fdmlld01vZGVsID0gbnVsbDsKICAgICAgfSwgZi5wcm90b3R5cGUuX2NsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGwuYnJvd3Nlci5tc2llIHx8IGkucmVtb3ZlQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgiZHJhZ2dpbmciKSksIHRoaXMuX2d1aWRlTGF5ZXIgJiYgdGhpcy5fZ3VpZGVMYXllci5kZXN0cm95KCksIHRoaXMuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcygpLCB0aGlzLmd1aWRlRWxlbWVudCA9IHRoaXMuX2dldFRvcEZ1bmMgPSB0aGlzLl9ndWlkZUxheWVyID0gdGhpcy5fbW9kZWwgPSB0aGlzLl9sYXN0RHJhZyA9IHRoaXMuX3N0YXJ0R3JpZFkgPSB0aGlzLl9zdGFydFRvcFBpeGVsID0gdGhpcy5fdmlld01vZGVsID0gbnVsbDsKICAgICAgfSwgZi5wcm90b3R5cGUuX2hpZGVPcmlnaW5TY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IG8uY2xhc3NuYW1lKCJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIik7CiAgICAgICAgdGhpcy5ndWlkZUVsZW1lbnQgJiYgaS5hZGRDbGFzcyh0aGlzLmd1aWRlRWxlbWVudCwgZSk7CiAgICAgIH0sIGYucHJvdG90eXBlLl9zaG93T3JpZ2luU2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBvLmNsYXNzbmFtZSgidGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLWRyYWdnaW5nLWRpbSIpOwogICAgICAgIHRoaXMuZ3VpZGVFbGVtZW50ICYmIGkucmVtb3ZlQ2xhc3ModGhpcy5ndWlkZUVsZW1lbnQsIGUpOwogICAgICB9LCBmLnByb3RvdHlwZS5fcmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgICAgdmFyIG8gPSB0aGlzOwogICAgICAgIGEucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvLl9ndWlkZUxheWVyICYmIChvLl9ndWlkZUxheWVyLnNldFBvc2l0aW9uKDAsIGUpLCBvLl9ndWlkZUxheWVyLnNldENvbnRlbnQoYyhsLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGVsOiB0CiAgICAgICAgICB9LCBuKSkpKTsKICAgICAgICB9KTsKICAgICAgfSwgZi5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcyA9IGkuY2xvc2VzdChlLnRhcmdldCwgby5jbGFzc25hbWUoIi50aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siKSk7CiAgICAgICAgcyAmJiAodGhpcy5fc3RhcnRUb3BQaXhlbCA9IHBhcnNlRmxvYXQocy5zdHlsZS50b3ApLCB0aGlzLl9zdGFydEdyaWRZID0gZS5uZWFyZXN0R3JpZFksIHRoaXMuZ3VpZGVFbGVtZW50ID0gcywgdGhpcy5fY29udGFpbmVyID0gZS5yZWxhdGVkVmlldy5jb250YWluZXIsIHRoaXMuX21vZGVsID0gbC5leHRlbmQoZC5jcmVhdGUoZS5tb2RlbCksIGUubW9kZWwpLCBuID0gKG4gPSB0aGlzLl9tb2RlbC5kdXJhdGlvbigpKSA+IG0gPyBuIDogbSwgdCA9IChhID0gaC5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgdGhpcy5fbW9kZWwuZ29pbmdEdXJhdGlvbikpICsgbiArIChyID0gaC5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgdGhpcy5fbW9kZWwuY29taW5nRHVyYXRpb24pKSwgdGhpcy5fbGFzdERyYWcgPSBlLCB0aGlzLl92aWV3TW9kZWwgPSB7CiAgICAgICAgICBoYXNHb2luZ0R1cmF0aW9uOiBhID4gMCwKICAgICAgICAgIGhhc0NvbWluZ0R1cmF0aW9uOiByID4gMCwKICAgICAgICAgIGdvaW5nRHVyYXRpb25IZWlnaHQ6IHAucmF0aW8odCwgYSwgMTAwKSwKICAgICAgICAgIG1vZGVsRHVyYXRpb25IZWlnaHQ6IHAucmF0aW8odCwgbiwgMTAwKSwKICAgICAgICAgIGNvbWluZ0R1cmF0aW9uSGVpZ2h0OiBwLnJhdGlvKHQsIHIsIDEwMCkKICAgICAgICB9LCB0aGlzLl9yZXNldEd1aWRlTGF5ZXIoKSwgdGhpcy5faGlkZU9yaWdpblNjaGVkdWxlQmxvY2tzKCkpOwogICAgICB9LCBmLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgcyA9IGUuY3VycmVudFZpZXcsCiAgICAgICAgICAgIGMgPSBzLm9wdGlvbnMsCiAgICAgICAgICAgIGQgPSBzLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgICAgcCA9IHBhcnNlRmxvYXQodGhpcy5ndWlkZUVsZW1lbnQuc3R5bGUuaGVpZ2h0KSwKICAgICAgICAgICAgbSA9IGMuaG91ckVuZCAtIGMuaG91clN0YXJ0LAogICAgICAgICAgICBmID0gZS5uZWFyZXN0R3JpZFkgLSB0aGlzLl9zdGFydEdyaWRZLAogICAgICAgICAgICBnID0gcihtLCBkLCBmKSwKICAgICAgICAgICAgeSA9IGUubmVhcmVzdEdyaWRZIC0gdGhpcy5fbGFzdERyYWcubmVhcmVzdEdyaWRZOwogICAgICAgIGwuYnJvd3Nlci5tc2llIHx8IGkuYWRkQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgiZHJhZ2dpbmciKSksIHRoaXMuX2NvbnRhaW5lciAhPT0gcy5jb250YWluZXIgJiYgKHRoaXMuX2NvbnRhaW5lciA9IHMuY29udGFpbmVyLCB0aGlzLl9yZXNldEd1aWRlTGF5ZXIoKSksIGEgPSB0aGlzLl9zdGFydFRvcFBpeGVsICsgZywgbiA9IGQgLSBwLCBhID0gTWF0aC5tYXgoYSwgMCksIGEgPSBNYXRoLm1pbihhLCBuKSwgdGhpcy5fbW9kZWwuc3RhcnQgPSBuZXcgdSh0aGlzLl9tb2RlbC5nZXRTdGFydHMoKSkuYWRkTWludXRlcyhoLm1pbnV0ZXNGcm9tSG91cnMoeSkpLCB0aGlzLl9tb2RlbC5lbmQgPSBuZXcgdSh0aGlzLl9tb2RlbC5nZXRFbmRzKCkpLmFkZE1pbnV0ZXMoaC5taW51dGVzRnJvbUhvdXJzKHkpKSwgdGhpcy5fbGFzdERyYWcgPSBlLCB0aGlzLl9yZWZyZXNoR3VpZGVFbGVtZW50KGEsIHRoaXMuX21vZGVsLCB0aGlzLl92aWV3TW9kZWwpOwogICAgICB9LCBmLnByb3RvdHlwZS5fcmVzZXRHdWlkZUxheWVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2d1aWRlTGF5ZXIgJiYgKHRoaXMuX2d1aWRlTGF5ZXIuZGVzdHJveSgpLCB0aGlzLl9ndWlkZUxheWVyID0gbnVsbCksIHRoaXMuX2d1aWRlTGF5ZXIgPSBuZXcgcyhudWxsLCB0aGlzLl9jb250YWluZXIpLCB0aGlzLl9ndWlkZUxheWVyLnNldFNpemUodGhpcy5fY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoLCB0aGlzLmd1aWRlRWxlbWVudC5zdHlsZS5oZWlnaHQpLCB0aGlzLl9ndWlkZUxheWVyLnNldFBvc2l0aW9uKDAsIHRoaXMuZ3VpZGVFbGVtZW50LnN0eWxlLnRvcCksIHRoaXMuX2d1aWRlTGF5ZXIuc2V0Q29udGVudChjKGwuZXh0ZW5kKHsKICAgICAgICAgIG1vZGVsOiB0aGlzLl9tb2RlbAogICAgICAgIH0sIHRoaXMuX3ZpZXdNb2RlbCkpKSwgdGhpcy5fZ3VpZGVMYXllci5zaG93KCk7CiAgICAgIH0sIGUuZXhwb3J0cyA9IGY7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUtY29udGVudCAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtc2NoZWR1bGUtY29udGVudC10cmF2ZWwtdGltZSIgc3R5bGU9ImJvcmRlci1jb2xvcjonICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjsgYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCAiICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgaGVpZ2h0OiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJnb2luZ0R1cmF0aW9uSGVpZ2h0IikgfHwgKG51bGwgIT0gdCA/IGQodCwgImdvaW5nRHVyYXRpb25IZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiZ29pbmdEdXJhdGlvbkhlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjAzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAyMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnJTsiPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJnb2luZ0R1cmF0aW9uLXRtcGwiKSB8fCB0ICYmIGQodCwgImdvaW5nRHVyYXRpb24tdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJnb2luZ0R1cmF0aW9uLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDIzMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjYwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAidGltZS1zY2hlZHVsZS1jb250ZW50ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLXNjaGVkdWxlLWNvbnRlbnQtdHJhdmVsLXRpbWUiIHN0eWxlPSJib3JkZXItY29sb3I6JyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci10b3A6IDFweCBkYXNoZWQgIiArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGhlaWdodDogIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiY29taW5nRHVyYXRpb25IZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiY29taW5nRHVyYXRpb25IZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29taW5nRHVyYXRpb25IZWlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMjQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnJTsiPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJjb21pbmdEdXJhdGlvbi10bXBsIikgfHwgdCAmJiBkKHQsICJjb21pbmdEdXJhdGlvbi10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImNvbWluZ0R1cmF0aW9uLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyNTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4iOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAndGltZS1yZXNpemUtaGFuZGxlIGhhbmRsZS14Ij4mbmJzcDs8L2Rpdj4nOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siIGRhdGEtaWQ9IicgKyB1KChoKG4sICJzdGFtcCIpIHx8IHQgJiYgaCh0LCAic3RhbXAiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic3RhbXAiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA3NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyIgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7Ij5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ0aW1lLXNjaGVkdWxlICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jay1mb2N1c2VkIiBzdHlsZT0iY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6JyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiZHJhZ0JnQ29sb3IiKSA6IGksIHQpKSArICc7Ij5cbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJoYXNHb2luZ0R1cmF0aW9uIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLXNjaGVkdWxlLWNvbnRlbnQiIHN0eWxlPSJoZWlnaHQ6ICcgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJtb2RlbER1cmF0aW9uSGVpZ2h0IikgfHwgKG51bGwgIT0gdCA/IGgodCwgIm1vZGVsRHVyYXRpb25IZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAibW9kZWxEdXJhdGlvbkhlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogNzYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDk5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IGJvcmRlci1jb2xvcjoiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgJzsiPlxuICAgICAgICAgICAgICAgICcgKyAobnVsbCAhPSAoaSA9IChoKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGgodCwgInRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgICAgIDwvZGl2PlxuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImhhc0NvbWluZ0R1cmF0aW9uIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgIDwvZGl2PlxuICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgInVubGVzcyIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiY3JvcHBlZEVuZCIpIDogdCwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTA0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJ1xuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLWNvdmVyIj48L2Rpdj5cbjwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDQpLkRhdGUsCiAgICAgICAgcyA9IG4oNSksCiAgICAgICAgYyA9IG4oMTgpLAogICAgICAgIHUgPSBuKDk2KTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudGltZUdyaWRWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsLCB0aGlzLl9kcmFnU3RhcnQgPSBudWxsLCB0aGlzLl9ndWlkZSA9IG5ldyB1KHRoaXMpLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyk7CiAgICB9CgogICAgZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMudGltZUdyaWRWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9kcmFnU3RhcnQgPSB0aGlzLl9ndWlkZSA9IG51bGw7CiAgICB9LCBkLnByb3RvdHlwZS5jaGVja0V4cGVjdENvbmRpdGlvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LCBuOwogICAgICByZXR1cm4gISFhLmhhc0NsYXNzKGUsIG8uY2xhc3NuYW1lKCJ0aW1lLXJlc2l6ZS1oYW5kbGUiKSkgJiYgISEodCA9IGEuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZSIpKSkgJiYgISghKG4gPSBhLmdldENsYXNzKHQpLm1hdGNoKG8udGltZS5nZXRWaWV3SURSZWdFeHApKSB8fCBuLmxlbmd0aCA8IDIpICYmIGwucGljayh0aGlzLnRpbWVHcmlkVmlldy5jaGlsZHJlbi5pdGVtcywgTnVtYmVyKG5bMV0pKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBpID0gZS50YXJnZXQsCiAgICAgICAgICByID0gdGhpcy5jaGVja0V4cGVjdENvbmRpdGlvbihpKSwKICAgICAgICAgIHMgPSBhLmNsb3Nlc3QoaSwgby5jbGFzc25hbWUoIi50aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siKSksCiAgICAgICAgICBjID0gdGhpcy5iYXNlQ29udHJvbGxlcjsKICAgICAgciAmJiBzICYmICh0ID0gYS5nZXREYXRhKHMsICJpZCIpLCBuID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEociksIGwgPSB0aGlzLl9kcmFnU3RhcnQgPSBuKGUub3JpZ2luRXZlbnQsIHsKICAgICAgICB0YXJnZXRNb2RlbElEOiB0LAogICAgICAgIHNjaGVkdWxlOiBjLnNjaGVkdWxlcy5pdGVtc1t0XQogICAgICB9KSwgdGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgdGhpcy5maXJlKCJ0aW1lUmVzaXplRHJhZ3N0YXJ0IiwgbCkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbyA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICBpID0gdGhpcy5fZHJhZ1N0YXJ0OwogICAgICBvICYmIGkgJiYgKGwgPSBvKGUub3JpZ2luRXZlbnQsIHsKICAgICAgICB0YXJnZXRNb2RlbElEOiBpLnRhcmdldE1vZGVsSUQKICAgICAgfSksIG4gJiYgbihsKSwgdGhpcy5maXJlKHQgfHwgInRpbWVSZXNpemVEcmFnIiwgbCkpOwogICAgfSwgZC5wcm90b3R5cGUuX3VwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBhID0gdGhpcy5iYXNlQ29udHJvbGxlciwKICAgICAgICAgIGMgPSBlLnRhcmdldE1vZGVsSUQsCiAgICAgICAgICB1ID0gZS5uZWFyZXN0UmFuZ2UsCiAgICAgICAgICBkID0gdVsxXSAtIHVbMF0sCiAgICAgICAgICBoID0gYS5zY2hlZHVsZXMuaXRlbXNbY10sCiAgICAgICAgICBwID0gZS5yZWxhdGVkVmlldzsKICAgICAgaCAmJiAoZCAtPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCAzMCksIGwgPSBuZXcgcihwLmdldERhdGUoKSksIHQgPSBpLmVuZChsKSwgKG4gPSBuZXcgcihoLmdldEVuZHMoKSkuYWRkTWlsbGlzZWNvbmRzKGQpKSA+IHQgJiYgKG4gPSBuZXcgcih0KSksIG4uZ2V0VGltZSgpIC0gaC5nZXRTdGFydHMoKS5nZXRUaW1lKCkgPCBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCAzMCkgJiYgKG4gPSBuZXcgcihoLmdldFN0YXJ0cygpKS5hZGRNaW51dGVzKDMwKSksIG8gPSBzLmdldFNjaGVkdWxlQ2hhbmdlcyhoLCBbImVuZCJdLCB7CiAgICAgICAgZW5kOiBuCiAgICAgIH0pLCB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiBoLAogICAgICAgIGNoYW5nZXM6IG8sCiAgICAgICAgc3RhcnQ6IGguZ2V0U3RhcnRzKCksCiAgICAgICAgZW5kOiBuCiAgICAgIH0pKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jLAogICAgICAgICAgbCA9IHRoaXMuX2RyYWdTdGFydDsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIG4gJiYgbCAmJiAoKHQgPSBuKGUub3JpZ2luRXZlbnQsIHsKICAgICAgICB0YXJnZXRNb2RlbElEOiBsLnRhcmdldE1vZGVsSUQKICAgICAgfSkpLnJhbmdlID0gW2wudGltZVksIG5ldyByKHQudGltZVkpLmFkZE1pbnV0ZXMoMzApXSwgdC5uZWFyZXN0UmFuZ2UgPSBbbC5uZWFyZXN0R3JpZFRpbWVZLCB0Lm5lYXJlc3RHcmlkVGltZVkuYWRkTWludXRlcygzMCldLCB0aGlzLl91cGRhdGVTY2hlZHVsZSh0KSwgdGhpcy5maXJlKCJ0aW1lUmVzaXplRHJhZ2VuZCIsIHQpLCB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbCk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIHRoaXMuZmlyZSgidGltZVJlc2l6ZUNsaWNrIik7CiAgICB9LCBjLm1peGluKGQpLCBsLkN1c3RvbUV2ZW50cy5taXhpbihkKSwgZS5leHBvcnRzID0gZDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDEpLAogICAgICAgICAgYSA9IG4oMTEpLAogICAgICAgICAgciA9IG4oNSkucmF0aW8sCiAgICAgICAgICBzID0gbigzKTsKCiAgICAgIGZ1bmN0aW9uIGMoZSkgewogICAgICAgIHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbCwgdGhpcy50aW1lUmVzaXplID0gZSwgdGhpcy5fZ2V0VG9wRnVuYyA9IG51bGwsIHRoaXMuX29yaWdpblNjaGVkdWxlRWxlbWVudCA9IG51bGwsIHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSAwLCB0aGlzLl9zdGFydEhlaWdodFBpeGVsID0gMCwgdGhpcy5fc3RhcnRHcmlkWSA9IDAsIHRoaXMuX3NjaGVkdWxlID0gbnVsbCwgZS5vbih7CiAgICAgICAgICB0aW1lUmVzaXplRHJhZ3N0YXJ0OiB0aGlzLl9vbkRyYWdTdGFydCwKICAgICAgICAgIHRpbWVSZXNpemVEcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICB0aW1lUmVzaXplRHJhZ2VuZDogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQsCiAgICAgICAgICB0aW1lUmVzaXplQ2xpY2s6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50CiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIGMucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy50aW1lUmVzaXplLm9mZih0aGlzKSwgdGhpcy5ndWlkZUVsZW1lbnQgPSB0aGlzLnRpbWVSZXNpemUgPSB0aGlzLl9nZXRUb3BGdW5jID0gdGhpcy5fb3JpZ2luU2NoZWR1bGVFbGVtZW50ID0gdGhpcy5fc3RhcnRIZWlnaHRQaXhlbCA9IHRoaXMuX3N0YXJ0R3JpZFkgPSB0aGlzLl9zdGFydFRvcFBpeGVsID0gbnVsbDsKICAgICAgfSwgYy5wcm90b3R5cGUuX2NsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gdGhpcy5ndWlkZUVsZW1lbnQsCiAgICAgICAgICAgIG4gPSB0aGlzLl9vcmlnaW5TY2hlZHVsZUVsZW1lbnQ7CiAgICAgICAgbC5icm93c2VyLm1zaWUgfHwgaS5yZW1vdmVDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZyIpKSwgbiAmJiAobi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIiksIGkucmVtb3ZlKGUpLCB0aGlzLmd1aWRlRWxlbWVudCA9IHRoaXMuX2dldFRvcEZ1bmMgPSB0aGlzLl9vcmlnaW5TY2hlZHVsZUVsZW1lbnQgPSB0aGlzLl9zdGFydEhlaWdodFBpeGVsID0gdGhpcy5fc3RhcnRHcmlkWSA9IHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSBudWxsOwogICAgICB9LCBjLnByb3RvdHlwZS5fcmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwsCiAgICAgICAgICAgIHIgPSB0aGlzLmd1aWRlRWxlbWVudDsKICAgICAgICByICYmIChsID0gaS5maW5kKG8uY2xhc3NuYW1lKCIudGltZS1zY2hlZHVsZS1jb250ZW50LXRpbWUiKSwgciksIGEucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByLnN0eWxlLmhlaWdodCA9IGUgKyAicHgiLCByLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCBsICYmIChsLnN0eWxlLmhlaWdodCA9IG4gKyAicHgiLCBsLnN0eWxlLm1pbkhlaWdodCA9IHQgKyAicHgiKTsKICAgICAgICB9KSk7CiAgICAgIH0sIGMucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGEgPSBpLmNsb3Nlc3QoZS50YXJnZXQsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrIikpLAogICAgICAgICAgICByID0gZS5zY2hlZHVsZTsKICAgICAgICBsLmJyb3dzZXIubXNpZSB8fCBpLmFkZENsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoInJlc2l6aW5nIikpLCBhICYmIHIgJiYgKHRoaXMuX3N0YXJ0R3JpZFkgPSBlLm5lYXJlc3RHcmlkWSwgdGhpcy5fc3RhcnRIZWlnaHRQaXhlbCA9IHBhcnNlRmxvYXQoYS5zdHlsZS5oZWlnaHQpLCB0aGlzLl9zdGFydFRvcFBpeGVsID0gcGFyc2VGbG9hdChhLnN0eWxlLnRvcCksIHRoaXMuX29yaWdpblNjaGVkdWxlRWxlbWVudCA9IGEsIHRoaXMuX3NjaGVkdWxlID0gciwgbiA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gYS5jbG9uZU5vZGUoITApLCBpLmFkZENsYXNzKG4sIG8uY2xhc3NuYW1lKCJ0aW1lLWd1aWRlLXJlc2l6ZSIpKSwgYS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiLCBlLnJlbGF0ZWRWaWV3LmNvbnRhaW5lci5hcHBlbmRDaGlsZChuKSk7CiAgICAgIH0sIGMucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuLAogICAgICAgICAgICBsLAogICAgICAgICAgICBvLAogICAgICAgICAgICBpLAogICAgICAgICAgICBhID0gZS5yZWxhdGVkVmlldywKICAgICAgICAgICAgYyA9IGEub3B0aW9ucywKICAgICAgICAgICAgdSA9IGEuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LAogICAgICAgICAgICBkID0gYy5ob3VyRW5kIC0gYy5ob3VyU3RhcnQsCiAgICAgICAgICAgIGggPSB0aGlzLmd1aWRlRWxlbWVudCwKICAgICAgICAgICAgcCA9IHBhcnNlRmxvYXQoaC5zdHlsZS50b3ApLAogICAgICAgICAgICBtID0gZS5uZWFyZXN0R3JpZFkgLSB0aGlzLl9zdGFydEdyaWRZLAogICAgICAgICAgICBmID0gcihkLCB1LCBtKSwKICAgICAgICAgICAgZyA9IHRoaXMuX3NjaGVkdWxlLmdvaW5nRHVyYXRpb24sCiAgICAgICAgICAgIHkgPSB0aGlzLl9zY2hlZHVsZS5kdXJhdGlvbigpIC8gcy5NSUxMSVNFQ09ORFNfUEVSX01JTlVURVMsCiAgICAgICAgICAgIFMgPSB0aGlzLl9zY2hlZHVsZS5jb21pbmdEdXJhdGlvbiwKICAgICAgICAgICAgXyA9IDYwICogZDsKCiAgICAgICAgaSA9IHRoaXMuX3N0YXJ0SGVpZ2h0UGl4ZWwgKyBmLCBsID0gcCArIHIoZCwgdSwgLjUpLCBuID0gbCAtPSB0aGlzLl9zdGFydFRvcFBpeGVsLCBsICs9IHIoXywgdSwgZykgKyByKF8sIHUsIFMpLCBvID0gdSAtIHAsIGkgPSBNYXRoLm1heChpLCBsKSwgaSA9IE1hdGgubWluKGksIG8pLCB0ID0gcihfLCB1LCB5KSArIGYsIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQoaSwgbiwgdCk7CiAgICAgIH0sIGUuZXhwb3J0cyA9IGM7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDE1KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbigxKSwKICAgICAgICBzID0gbig1KSwKICAgICAgICBjID0gbig5OCksCiAgICAgICAgdSA9IG4oMTAzKSwKICAgICAgICBkID0gbigxMDQpLAogICAgICAgIGggPSBuKDEwNyksCiAgICAgICAgcCA9IG4oMTA5KSwKICAgICAgICBtID0gbigxMTIpLAogICAgICAgIGYgPSBuKDMyKSwKICAgICAgICBnID0gbigzMyksCiAgICAgICAgeSA9IG4oMTQpOwoKICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCBuLCBTKSB7CiAgICAgIHZhciBfLCBDLCB2LCBFLCB3LCBQLCBrLCBSLCBJLCBiLCBELCBGLCB4LCBYLCBNLCBPOwoKICAgICAgcmV0dXJuIF8gPSByLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCB0LCBvLmNsYXNzbmFtZSgibW9udGgiKSksIEMgPSBuZXcgYyhTLCBfLCBlLk1vbnRoKSwgdiA9IG5ldyBtKFMubW9udGgsIHQsIGUudGhlbWUpLCB3ID0gbmV3IHUobiwgQywgZSksIFMuaXNSZWFkT25seSB8fCAoUCA9IG5ldyBkKG4sIEMsIGUsIFMpLCBrID0gbmV3IGgobiwgQywgZSksIFIgPSBuZXcgcChuLCBDLCBlKSksIEkgPSBmdW5jdGlvbiBJKCkgewogICAgICAgIHYgJiYgdi5oaWRlKCk7CiAgICAgIH0sIGIgPSBmdW5jdGlvbiBiKCkgewogICAgICAgIHYgJiYgdi5yZWZyZXNoKCk7CiAgICAgIH0sIHcub24oImNsaWNrTW9yZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LmRhdGUsCiAgICAgICAgICAgIG8gPSB0LnRhcmdldCwKICAgICAgICAgICAgciA9IGwucGljayhlLmZpbmRCeURhdGVSYW5nZShhLnN0YXJ0KG4pLCBhLmVuZChuKSksIHQueW1kKTsKICAgICAgICByLml0ZW1zID0gbC5maWx0ZXIoci5pdGVtcywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBTLm1vbnRoLnNjaGVkdWxlRmlsdGVyKGUubW9kZWwpOwogICAgICAgIH0pLCByICYmIHIubGVuZ3RoICYmICh2LnJlbmRlcihmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICAgICAgcmV0dXJuIG4uZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdCA9IGUubW9kZWw7CiAgICAgICAgICAgIGUuaGFzTXVsdGlEYXRlcyA9IGEuaGFzTXVsdGlEYXRlcyh0LnN0YXJ0LCB0LmVuZCk7CiAgICAgICAgICB9KSwgewogICAgICAgICAgICB0YXJnZXQ6IHQsCiAgICAgICAgICAgIGRhdGU6IGEuZm9ybWF0KGUsICJZWVlZLk1NLkREIiksCiAgICAgICAgICAgIGRheW5hbWU6IGxbZS5nZXREYXkoKV0sCiAgICAgICAgICAgIHNjaGVkdWxlczogbi5zb3J0KGkuY29tcGFyZS5zY2hlZHVsZS5hc2MpCiAgICAgICAgICB9OwogICAgICAgIH0obiwgbywgciwgQy5vcHRpb25zLmRheW5hbWVzKSksIHIuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgZSAmJiBDLmZpcmUoImFmdGVyUmVuZGVyU2NoZWR1bGUiLCB7CiAgICAgICAgICAgIHNjaGVkdWxlOiBlLm1vZGVsCiAgICAgICAgICB9KTsKICAgICAgICB9KSwgQy5maXJlKCJjbGlja01vcmUiLCB7CiAgICAgICAgICBkYXRlOiB0LmRhdGUsCiAgICAgICAgICB0YXJnZXQ6IHYuZ2V0TW9yZVZpZXdFbGVtZW50KCkKICAgICAgICB9KSk7CiAgICAgIH0pLCBTLnVzZUNyZWF0aW9uUG9wdXAgJiYgKEUgPSBuZXcgZih0LCBlLmNhbGVuZGFycywgUy51c2FnZVN0YXRpc3RpY3MpLCBEID0gZnVuY3Rpb24gRChlKSB7CiAgICAgICAgUC5maXJlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGwuZXh0ZW5kKGUsIHsKICAgICAgICAgIHVzZUNyZWF0aW9uUG9wdXA6ICEwCiAgICAgICAgfSkpOwogICAgICB9LCBFLm9uKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIEQpKSwgUy51c2VEZXRhaWxQb3B1cCAmJiAoeCA9IG5ldyBnKHQsIGUuY2FsZW5kYXJzKSwgWCA9IGZ1bmN0aW9uIFgodCkgewogICAgICAgIHZhciBuID0gdC5zY2hlZHVsZS5jYWxlbmRhcklkOwogICAgICAgIHQuY2FsZW5kYXIgPSBzLmZpbmQoZS5jYWxlbmRhcnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZS5pZCA9PT0gbjsKICAgICAgICB9KSwgUy5pc1JlYWRPbmx5ICYmICh0LnNjaGVkdWxlID0gbC5leHRlbmQoe30sIHQuc2NoZWR1bGUsIHsKICAgICAgICAgIGlzUmVhZE9ubHk6ICEwCiAgICAgICAgfSkpLCB4LnJlbmRlcih0KTsKICAgICAgfSwgTSA9IGZ1bmN0aW9uIE0oZSkgewogICAgICAgIFAgJiYgUC5maXJlKCJiZWZvcmVEZWxldGVTY2hlZHVsZSIsIGUpOwogICAgICB9LCBPID0gZnVuY3Rpb24gTyhlKSB7CiAgICAgICAgUi5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGUpOwogICAgICB9LCB3Lm9uKCJjbGlja1NjaGVkdWxlIiwgWCksIHgub24oImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgTSksIFMudXNlQ3JlYXRpb25Qb3B1cCA/IChGID0gZnVuY3Rpb24gRih0KSB7CiAgICAgICAgRS5zZXRDYWxlbmRhcnMoZS5jYWxlbmRhcnMpLCBFLnJlbmRlcih0KTsKICAgICAgfSwgRS5vbigiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBPKSwgeC5vbigiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBGKSkgOiB4Lm9uKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIE8pKSwgZS5vbigiY2xlYXJTY2hlZHVsZXMiLCBJKSwgZS5vbigidXBkYXRlU2NoZWR1bGUiLCBiKSwgUiAmJiBSLm9uKCJtb250aE1vdmVTdGFydF9mcm9tX21vcmVsYXllciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2LmhpZGUoKTsKICAgICAgfSksIEMuaGFuZGxlciA9IHsKICAgICAgICBjbGljazogewogICAgICAgICAgZGVmYXVsdDogdwogICAgICAgIH0KICAgICAgfSwgUy5pc1JlYWRPbmx5IHx8IChDLmhhbmRsZXIgPSBsLmV4dGVuZChDLmhhbmRsZXIsIHsKICAgICAgICBjcmVhdGlvbjogewogICAgICAgICAgZGVmYXVsdDogUAogICAgICAgIH0sCiAgICAgICAgcmVzaXplOiB7CiAgICAgICAgICBkZWZhdWx0OiBrCiAgICAgICAgfSwKICAgICAgICBtb3ZlOiB7CiAgICAgICAgICBkZWZhdWx0OiBSCiAgICAgICAgfQogICAgICB9KSksIEMuX2JlZm9yZURlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdi5kZXN0cm95KCksIGUub2ZmKCJjbGVhclNjaGVkdWxlcyIsIEkpLCBlLm9mZigidXBkYXRlU2NoZWR1bGUiLCBiKSwgbC5mb3JFYWNoKEMuaGFuZGxlciwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlLm9mZigpLCBlLmRlc3Ryb3koKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBTLnVzZUNyZWF0aW9uUG9wdXAgJiYgUy51c2VEZXRhaWxQb3B1cCAmJiBFLm9mZigiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBiKSwgUy51c2VDcmVhdGlvblBvcHVwICYmIChQICYmIFAub2ZmKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIHZvaWQgMCksIEUub2ZmKCJzYXZlU2NoZWR1bGUiLCBEKSwgRS5kZXN0cm95KCkpLCBTLnVzZURldGFpbFBvcHVwICYmICh3Lm9mZigiY2xpY2tTY2hlZHVsZSIsIFgpLCB4Lm9mZigiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBiKSwgeC5vZmYoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgTSksIHguZGVzdHJveSgpKTsKICAgICAgfSwgQy5jb250cm9sbGVyID0gZS5Nb250aCwgewogICAgICAgIHZpZXc6IEMsCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgICAgIEMudkxheW91dC5yZWZyZXNoKCk7CiAgICAgICAgfSwKICAgICAgICBvcGVuQ3JlYXRpb25Qb3B1cDogZnVuY3Rpb24gb3BlbkNyZWF0aW9uUG9wdXAoZSkgewogICAgICAgICAgRSAmJiBQICYmIFAuaW52b2tlQ3JlYXRpb25DbGljayh5LmNyZWF0ZShlKSk7CiAgICAgICAgfSwKICAgICAgICBzaG93Q3JlYXRpb25Qb3B1cDogZnVuY3Rpb24gc2hvd0NyZWF0aW9uUG9wdXAodCkgewogICAgICAgICAgRSAmJiAoRS5zZXRDYWxlbmRhcnMoZS5jYWxlbmRhcnMpLCBFLnJlbmRlcih0KSk7CiAgICAgICAgfSwKICAgICAgICBoaWRlTW9yZVZpZXc6IGZ1bmN0aW9uIGhpZGVNb3JlVmlldygpIHsKICAgICAgICAgIHYgJiYgdi5oaWRlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBuKDk5KSwKICAgICAgICBjID0gbig4KSwKICAgICAgICB1ID0gbigyOSksCiAgICAgICAgZCA9IG4oMTAwKSwKICAgICAgICBoID0gTWF0aC5taW47CgogICAgZnVuY3Rpb24gcChlLCB0LCBuKSB7CiAgICAgIHZhciBvLAogICAgICAgICAgYSA9IG4gPyBuLnRoZW1lIDogbnVsbDsKICAgICAgbyA9IChlID0gZSB8fCB7fSkgPyBlLm1vbnRoIDoge30sIGMuY2FsbCh0aGlzLCB0KSwgdGhpcy5jb250cm9sbGVyID0gbiwgdGhpcy52TGF5b3V0ID0gbmV3IHUoewogICAgICAgIHBhbmVsczogW3sKICAgICAgICAgIGhlaWdodDogcGFyc2VJbnQobi50aGVtZS5tb250aC5kYXluYW1lLmhlaWdodCwgMTApIHx8IDQyCiAgICAgICAgfSwgewogICAgICAgICAgYXV0b0hlaWdodDogITAKICAgICAgICB9XQogICAgICB9LCB0LCBhKSwgdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIHNjaGVkdWxlRmlsdGVyOiBmdW5jdGlvbiBzY2hlZHVsZUZpbHRlcihlKSB7CiAgICAgICAgICByZXR1cm4gQm9vbGVhbihlLmlzVmlzaWJsZSk7CiAgICAgICAgfSwKICAgICAgICBzdGFydERheU9mV2VlazogMCwKICAgICAgICByZW5kZXJNb250aDogIjIwMTgtMDEiLAogICAgICAgIGRheW5hbWVzOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLAogICAgICAgIG5hcnJvd1dlZWtlbmQ6ICExLAogICAgICAgIHZpc2libGVXZWVrc0NvdW50OiBudWxsLAogICAgICAgIGlzQWx3YXlzNldlZWs6ICEwLAogICAgICAgIGlzUmVhZE9ubHk6IGUuaXNSZWFkT25seSwKICAgICAgICBncmlkOiB7CiAgICAgICAgICBoZWFkZXI6IHsKICAgICAgICAgICAgaGVpZ2h0OiAzNAogICAgICAgICAgfSwKICAgICAgICAgIGZvb3RlcjogewogICAgICAgICAgICBoZWlnaHQ6IDMKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIG8pLCB0aGlzLm9wdGlvbnMuZ3JpZC5oZWFkZXIgPSBsLmV4dGVuZCh7CiAgICAgICAgaGVpZ2h0OiAzNAogICAgICB9LCBsLnBpY2sobywgImdyaWQiLCAiaGVhZGVyIikpLCB0aGlzLm9wdGlvbnMuZ3JpZC5mb290ZXIgPSBsLmV4dGVuZCh7CiAgICAgICAgaGVpZ2h0OiAzCiAgICAgIH0sIGwucGljayhvLCAiZ3JpZCIsICJmb290ZXIiKSksIHRoaXMuZ3JpZHMgPSBpLmdldEdyaWRMZWZ0QW5kV2lkdGgodGhpcy5vcHRpb25zLmRheW5hbWVzLmxlbmd0aCwgdGhpcy5vcHRpb25zLm5hcnJvd1dlZWtlbmQsIHRoaXMub3B0aW9ucy5zdGFydERheU9mV2Vlayk7CiAgICB9CgogICAgbC5pbmhlcml0KHAsIGMpLCBwLnByb3RvdHlwZS52aWV3TmFtZSA9ICJtb250aCIsIHAucHJvdG90eXBlLl9nZXRNb250aENhbGVuZGFyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gbmV3IHIoZSksCiAgICAgICAgICBsID0gdGhpcy5vcHRpb25zLnN0YXJ0RGF5T2ZXZWVrIHx8IDAsCiAgICAgICAgICBvID0gaCh0aGlzLm9wdGlvbnMudmlzaWJsZVdlZWtzQ291bnQgfHwgMCwgNiksCiAgICAgICAgICBhID0gdGhpcy5vcHRpb25zLndvcmt3ZWVrIHx8ICExOwogICAgICByZXR1cm4gdCA9IHRoaXMub3B0aW9ucy52aXNpYmxlV2Vla3NDb3VudCA/IHsKICAgICAgICBzdGFydERheU9mV2VlazogbCwKICAgICAgICBpc0Fsd2F5czZXZWVrOiAhMSwKICAgICAgICB2aXNpYmxlV2Vla3NDb3VudDogbywKICAgICAgICB3b3Jrd2VlazogYQogICAgICB9IDogewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiBsLAogICAgICAgIGlzQWx3YXlzNldlZWs6IHRoaXMub3B0aW9ucy5pc0Fsd2F5czZXZWVrLAogICAgICAgIHdvcmt3ZWVrOiBhCiAgICAgIH0sIGkuYXJyMmRDYWxlbmRhcihuLCB0KTsKICAgIH0sIHAucHJvdG90eXBlLl9yZW5kZXJDaGlsZHJlbiA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBpID0gdGhpcywKICAgICAgICAgIHMgPSAxMDAgLyB0Lmxlbmd0aCwKICAgICAgICAgIGMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICB1ID0gYy5yZW5kZXJNb250aCwKICAgICAgICAgIGggPSBjLm5hcnJvd1dlZWtlbmQsCiAgICAgICAgICBwID0gYy5zdGFydERheU9mV2VlaywKICAgICAgICAgIG0gPSBjLnZpc2libGVXZWVrc0NvdW50LAogICAgICAgICAgZiA9IGMudmlzaWJsZVNjaGVkdWxlQ291bnQsCiAgICAgICAgICBnID0gYy5ncmlkLAogICAgICAgICAgeSA9IGMuaXNSZWFkT25seTsKICAgICAgZS5pbm5lckhUTUwgPSAiIiwgdGhpcy5jaGlsZHJlbi5jbGVhcigpLCBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbCwKICAgICAgICAgICAgYywKICAgICAgICAgICAgUyA9IG5ldyByKHRbMF0pLAogICAgICAgICAgICBfID0gbmV3IHIodFt0Lmxlbmd0aCAtIDFdKTsKCiAgICAgICAgbCA9IGEuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIGUsIG8uY2xhc3NuYW1lKCJtb250aC13ZWVrLWl0ZW0iKSksIGMgPSBuZXcgZCh7CiAgICAgICAgICByZW5kZXJNb250aDogdSwKICAgICAgICAgIGhlaWdodFBlcmNlbnQ6IHMsCiAgICAgICAgICByZW5kZXJTdGFydERhdGU6IFMsCiAgICAgICAgICByZW5kZXJFbmREYXRlOiBfLAogICAgICAgICAgbmFycm93V2Vla2VuZDogaCwKICAgICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiBwLAogICAgICAgICAgdmlzaWJsZVdlZWtzQ291bnQ6IG0sCiAgICAgICAgICB2aXNpYmxlU2NoZWR1bGVDb3VudDogZiwKICAgICAgICAgIGdyaWQ6IGcsCiAgICAgICAgICBzY2hlZHVsZUhlaWdodDogcGFyc2VJbnQobi5tb250aC5zY2hlZHVsZS5oZWlnaHQsIDEwKSwKICAgICAgICAgIHNjaGVkdWxlR3V0dGVyOiBwYXJzZUludChuLm1vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCwgMTApLAogICAgICAgICAgaXNSZWFkT25seTogeQogICAgICAgIH0sIGwpLCBpLmFkZENoaWxkKGMpOwogICAgICB9KTsKICAgIH0sIHAucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICB0LAogICAgICAgICAgbiwKICAgICAgICAgIG8gPSB0aGlzLAogICAgICAgICAgYSA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIHIgPSB0aGlzLnZMYXlvdXQsCiAgICAgICAgICBjID0gdGhpcy5jb250cm9sbGVyLAogICAgICAgICAgdSA9IGEuZGF5bmFtZXMsCiAgICAgICAgICBkID0gYS53b3Jrd2VlaywKICAgICAgICAgIGggPSB0aGlzLl9nZXRNb250aENhbGVuZGFyKGEucmVuZGVyTW9udGgpLAogICAgICAgICAgcCA9IGEuc2NoZWR1bGVGaWx0ZXIsCiAgICAgICAgICBtID0gYyA/IGMudGhlbWUgOiBudWxsLAogICAgICAgICAgZiA9IHRoaXMuX2dldFN0eWxlcyhtKTsKCiAgICAgIGUgPSB0aGlzLmdyaWRzID0gaS5nZXRHcmlkTGVmdEFuZFdpZHRoKGEuZGF5bmFtZXMubGVuZ3RoLCBhLm5hcnJvd1dlZWtlbmQsIGEuc3RhcnREYXlPZldlZWspLCB0ID0gbC5tYXAobC5yYW5nZShhLnN0YXJ0RGF5T2ZXZWVrLCA3KS5jb25jYXQobC5yYW5nZSg3KSkuc2xpY2UoMCwgNyksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRheTogdCwKICAgICAgICAgIGxhYmVsOiB1W3RdLAogICAgICAgICAgd2lkdGg6IGVbbl0gPyBlW25dLndpZHRoIDogMCwKICAgICAgICAgIGxlZnQ6IGVbbl0gPyBlW25dLmxlZnQgOiAwLAogICAgICAgICAgY29sb3I6IHRoaXMuX2dldERheU5hbWVDb2xvcihtLCB0KQogICAgICAgIH07CiAgICAgIH0sIHRoaXMpLCBkICYmIChlID0gdGhpcy5ncmlkcyA9IGkuZ2V0R3JpZExlZnRBbmRXaWR0aCg1LCBhLm5hcnJvd1dlZWtlbmQsIGEuc3RhcnREYXlPZldlZWssIGQpLCB0ID0gbC5maWx0ZXIodCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gIWkuaXNXZWVrZW5kKGUuZGF5KTsKICAgICAgfSksIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHQud2lkdGggPSBlW25dID8gZVtuXS53aWR0aCA6IDAsIHQubGVmdCA9IGVbbl0gPyBlW25dLmxlZnQgOiAwOwogICAgICB9KSksIG4gPSB7CiAgICAgICAgZGF5bmFtZXM6IHQsCiAgICAgICAgc3R5bGVzOiBmCiAgICAgIH0sIHIucGFuZWxzWzBdLmNvbnRhaW5lci5pbm5lckhUTUwgPSBzKG4pLCB0aGlzLl9yZW5kZXJDaGlsZHJlbihyLnBhbmVsc1sxXS5jb250YWluZXIsIGgsIG0pLCBuLnBhbmVsSGVpZ2h0ID0gci5wYW5lbHNbMV0uZ2V0SGVpZ2h0KCksIHRoaXMuY2hpbGRyZW4uZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBsID0gaS5zdGFydCh0Lm9wdGlvbnMucmVuZGVyU3RhcnREYXRlKSwKICAgICAgICAgICAgYSA9IGkuc3RhcnQodC5vcHRpb25zLnJlbmRlckVuZERhdGUpLAogICAgICAgICAgICByID0gYy5maW5kQnlEYXRlUmFuZ2UoaS5zdGFydChsKSwgaS5lbmQoYSksIHApLAogICAgICAgICAgICBzID0gewogICAgICAgICAgZXZlbnRzSW5EYXRlUmFuZ2U6IHIsCiAgICAgICAgICByYW5nZTogaS5yYW5nZShpLnN0YXJ0KGwpLCBpLmVuZChhKSwgaS5NSUxMSVNFQ09ORFNfUEVSX0RBWSkuc2xpY2UoMCwgZS5sZW5ndGgpLAogICAgICAgICAgZ3JpZHM6IGUsCiAgICAgICAgICBwYW5lbEhlaWdodDogbi5wYW5lbEhlaWdodCwKICAgICAgICAgIHRoZW1lOiBtCiAgICAgICAgfTsKICAgICAgICB0LnJlbmRlcihzKSwgby5faW52b2tlQWZ0ZXJSZW5kZXJTY2hlZHVsZShyKTsKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5faW52b2tlQWZ0ZXJSZW5kZXJTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpczsKICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBsLmZvckVhY2hBcnJheShlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgZSAmJiAhZS5oaWRkZW4gJiYgdC5maXJlKCJhZnRlclJlbmRlclNjaGVkdWxlIiwgewogICAgICAgICAgICAgIHNjaGVkdWxlOiBlLm1vZGVsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwgcC5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHt9OwogICAgICByZXR1cm4gZSAmJiAodCA9IGUubW9udGguZGF5bmFtZSwgbi5ib3JkZXJUb3AgPSB0LmJvcmRlclRvcCB8fCBlLmNvbW1vbi5ib3JkZXIsIG4uYm9yZGVyTGVmdCA9IHQuYm9yZGVyTGVmdCB8fCBlLmNvbW1vbi5ib3JkZXIsIG4uaGVpZ2h0ID0gdC5oZWlnaHQsIG4ucGFkZGluZ0xlZnQgPSB0LnBhZGRpbmdMZWZ0LCBuLnBhZGRpbmdSaWdodCA9IHQucGFkZGluZ1JpZ2h0LCBuLmZvbnRTaXplID0gdC5mb250U2l6ZSwgbi5iYWNrZ3JvdW5kQ29sb3IgPSB0LmJhY2tncm91bmRDb2xvciwgbi5mb250V2VpZ2h0ID0gdC5mb250V2VpZ2h0LCBuLnRleHRBbGlnbiA9IHQudGV4dEFsaWduKSwgbjsKICAgIH0sIHAucHJvdG90eXBlLl9nZXREYXlOYW1lQ29sb3IgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9ICIiOwogICAgICByZXR1cm4gZSAmJiAobiA9IDAgPT09IHQgPyBlLmNvbW1vbi5ob2xpZGF5LmNvbG9yIDogNiA9PT0gdCA/IGUuY29tbW9uLnNhdHVyZGF5LmNvbG9yIDogZS5jb21tb24uZGF5bmFtZS5jb2xvciksIG47CiAgICB9LCBlLmV4cG9ydHMgPSBwOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1kYXluYW1lLWl0ZW0iXG4gICAgICAgICBzdHlsZT0icG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJ3aWR0aCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJ3aWR0aCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ3aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7XG4gICAgICAgICAgICAgICAgbGVmdDogIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDIyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlO1xuICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJwYWRkaW5nTGVmdCIpLCB0KSkgKyAiO1xuICAgICAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAicGFkZGluZ1JpZ2h0IiksIHQpKSArICI7XG4gICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGVpZ2h0IiksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKHIsIG8gJiYgZChvLCAibGFzdCIpLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICAgICAgICAgICI+XG4gICAgICAgIDxzcGFuIGNsYXNzPSInICsgYygoZChuLCAiaG9saWRheSIpIHx8IHQgJiYgZCh0LCAiaG9saWRheSIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiZGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaG9saWRheSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDIxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMzYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICciIHN0eWxlPSJjb2xvcjogJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiA1MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPlxuICAgICAgICAgICAgJyArIChudWxsICE9IChpID0gKGQobiwgIm1vbnRoRGF5bmFtZS10bXBsIikgfHwgdCAmJiBkKHQsICJtb250aERheW5hbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogIm1vbnRoRGF5bmFtZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgPC9zcGFuPlxuICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBib3JkZXItcmlnaHQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAiYm9yZGVyTGVmdCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgYyA9IGUubGFtYmRhLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtZGF5bmFtZSJcbiAgICBzdHlsZT0iYm9yZGVyLXRvcDogJyArIHMoYyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImJvcmRlclRvcCIpIDogaSwgdCkpICsgIjsgaGVpZ2h0OiAiICsgcyhjKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAiaGVpZ2h0IikgOiBpLCB0KSkgKyAiOyBmb250LXNpemU6ICIgKyBzKGMobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgInN0eWxlcyIpIDogdCkgPyB1KGksICJmb250U2l6ZSIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjogIiArIHMoYyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImJhY2tncm91bmRDb2xvciIpIDogaSwgdCkpICsgIjsgdGV4dC1hbGlnbjogIiArIHMoYyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgInRleHRBbGlnbiIpIDogaSwgdCkpICsgIjsgZm9udC13ZWlnaHQ6ICIgKyBzKGMobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgInN0eWxlcyIpIDogdCkgPyB1KGksICJmb250V2VpZ2h0IikgOiBpLCB0KSkgKyAnOyI+XG4nICsgKG51bGwgIT0gKGkgPSB1KG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJkYXluYW1lcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig4KSwKICAgICAgICBzID0gbigzMCksCiAgICAgICAgYyA9IG4oMTAxKSwKICAgICAgICB1ID0gbigxMDIpLAogICAgICAgIGQgPSBNYXRoLmZsb29yLAogICAgICAgIGggPSBNYXRoLm1pbjsKCiAgICBmdW5jdGlvbiBwKGUsIHQpIHsKICAgICAgcy5jYWxsKHRoaXMsIGUsIHQpLCB0LnN0eWxlLmhlaWdodCA9IGUuaGVpZ2h0UGVyY2VudCArICIlIjsKICAgIH0KCiAgICBsLmluaGVyaXQocCwgcyksIHAucHJvdG90eXBlLmdldFZpZXdCb3VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHIucHJvdG90eXBlLmdldFZpZXdCb3VuZC5jYWxsKHRoaXMpOwogICAgfSwgcC5wcm90b3R5cGUuX2dldFJlbmRlckxpbWl0SW5kZXggPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBvID0gZSB8fCB0aGlzLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgIGkgPSBsLnBpY2sobiwgImdyaWQiLCAiaGVhZGVyIiwgImhlaWdodCIpIHx8IDAsCiAgICAgICAgICBhID0gbC5waWNrKG4sICJncmlkIiwgImZvb3RlciIsICJoZWlnaHQiKSB8fCAwLAogICAgICAgICAgciA9IG4udmlzaWJsZVNjaGVkdWxlQ291bnQgfHwgMDsKICAgICAgcmV0dXJuIHQgPSBkKChvIC09IGkgKyBhKSAvIChuLnNjaGVkdWxlSGVpZ2h0ICsgbi5zY2hlZHVsZUd1dHRlcikpLCByIHx8IChyID0gdCksIGgodCwgcik7CiAgICB9LCBwLnByb3RvdHlwZS5nZXRCYXNlVmlld01vZGVsID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbyA9IGwucGljayhuLCAiZ3JpZCIsICJoZWFkZXIiLCAiaGVpZ2h0IikgfHwgMCwKICAgICAgICAgIGkgPSBsLnBpY2sobiwgImdyaWQiLCAiZm9vdGVyIiwgImhlaWdodCIpIHx8IDAsCiAgICAgICAgICBhID0gdGhpcy5fZ2V0UmVuZGVyTGltaXRJbmRleCgpICsgMSwKICAgICAgICAgIHIgPSB0aGlzLmdldEV4Y2VlZERhdGUoYSwgZS5ldmVudHNJbkRhdGVSYW5nZSwgZS5yYW5nZSksCiAgICAgICAgICBjID0gdGhpcy5fZ2V0U3R5bGVzKGUudGhlbWUpOwoKICAgICAgcmV0dXJuIGUgPSBsLmV4dGVuZCh7CiAgICAgICAgZXhjZWVkRGF0ZTogcgogICAgICB9LCBlKSwgdCA9IHMucHJvdG90eXBlLmdldEJhc2VWaWV3TW9kZWwuY2FsbCh0aGlzLCBlKSwgdCA9IGwuZXh0ZW5kKHsKICAgICAgICBtYXRyaWNlczogZS5ldmVudHNJbkRhdGVSYW5nZSwKICAgICAgICBncmlkSGVhZGVySGVpZ2h0OiBvLAogICAgICAgIGdyaWRGb290ZXJIZWlnaHQ6IGksCiAgICAgICAgcmVuZGVyTGltaXRJZHg6IGEsCiAgICAgICAgaXNSZWFkT25seTogbi5pc1JlYWRPbmx5LAogICAgICAgIHN0eWxlczogYwogICAgICB9LCB0KTsKICAgIH0sIHAucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIHIsCiAgICAgICAgICBkLAogICAgICAgICAgaCwKICAgICAgICAgIHAgPSB0aGlzLmNvbnRhaW5lciwKICAgICAgICAgIG0gPSB0aGlzLmdldEJhc2VWaWV3TW9kZWwoZSk7CiAgICAgIHRoaXMub3B0aW9ucy52aXNpYmxlV2Vla3NDb3VudCB8fCAobiA9IG0uZGF0ZXMsIHIgPSB0aGlzLm9wdGlvbnMucmVuZGVyTW9udGgsIGQgPSBlLnRoZW1lLCBoID0gci5nZXRNb250aCgpICsgMSwgbC5mb3JFYWNoKG4sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBlLm1vbnRoICE9PSBoOwogICAgICAgIGUuaXNPdGhlck1vbnRoID0gdCwgdCAmJiAoZS5jb2xvciA9IHMucHJvdG90eXBlLl9nZXREYXlOYW1lQ29sb3IoZCwgZS5kYXksIGUuaXNUb2RheSwgdCkpOwogICAgICB9KSksIHAuaW5uZXJIVE1MID0gYyhtKSwgKHQgPSBhLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlcyIpLCBwKSkgJiYgKHQuaW5uZXJIVE1MID0gdShtKSwgaS5zZXRBdXRvRWxsaXBzaXMoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLXRpdGxlIiksIHAsICEwKSk7CiAgICB9LCBwLnByb3RvdHlwZS5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHt9LCBwLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB7fTsKICAgICAgcmV0dXJuIGUgJiYgKHQuYm9yZGVyVG9wID0gZS5jb21tb24uYm9yZGVyLCB0LmJvcmRlckxlZnQgPSBlLmNvbW1vbi5ib3JkZXIsIHQuZm9udFNpemUgPSBlLm1vbnRoLmRheS5mb250U2l6ZSwgdC5ib3JkZXJSYWRpdXMgPSBlLm1vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cywgdC5tYXJnaW5MZWZ0ID0gZS5tb250aC5zY2hlZHVsZS5tYXJnaW5MZWZ0LCB0Lm1hcmdpblJpZ2h0ID0gZS5tb250aC5zY2hlZHVsZS5tYXJnaW5SaWdodCwgdC5zY2hlZHVsZUJ1bGxldFRvcCA9IHRoaXMub3B0aW9ucy5zY2hlZHVsZUhlaWdodCAvIDMpLCB0OwogICAgfSwgZS5leHBvcnRzID0gcDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LWdyaWQtbGluZSAiICsgdSgoZChuLCAiaG9saWRheSIpIHx8IHQgJiYgZCh0LCAiaG9saWRheSIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiZGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaG9saWRheSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAobnVsbCAhPSAoaSA9IChkKG4sICJmaSIpIHx8IHQgJiYgZCh0LCAiZmkiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImRhdGUiKSA6IHQsICIhPT0iLCAxLCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA2MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiaXNUb2RheSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTE5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJpc090aGVyTW9udGgiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE2MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMjEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgc3R5bGU9IndpZHRoOicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJ3aWR0aCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJ3aWR0aCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ3aWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IGxlZnQ6IiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImxlZnQiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAibGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJsZWZ0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNDYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYmFja2dyb3VuZC1jb2xvcjogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImJhY2tncm91bmRDb2xvciIpIHx8IChudWxsICE9IHQgPyBkKHQsICJiYWNrZ3JvdW5kQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiYmFja2dyb3VuZENvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA2NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogODYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiOyBmb250LXNpemU6ICIgKyB1KGUubGFtYmRhKChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImZvbnRTaXplIiksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKHIsIG8gJiYgZChvLCAibGFzdCIpLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg4LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWdyaWQtaGVhZGVyIj5cbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjogJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImNvbG9yIikgfHwgKG51bGwgIT0gdCA/IGQodCwgImNvbG9yIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7Ij4nICsgKG51bGwgIT0gKGkgPSAoZChuLCAibW9udGhHcmlkSGVhZGVyLXRtcGwiKSB8fCB0ICYmIGQodCwgIm1vbnRoR3JpZEhlYWRlci10bXBsIikgfHwgcykuY2FsbChyLCB0LCB7CiAgICAgICAgICBuYW1lOiAibW9udGhHcmlkSGVhZGVyLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJoaWRkZW5TY2hlZHVsZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTAsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTcsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZ3JpZC1mb290ZXIiPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiAnICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAzMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJtb250aEdyaWRGb290ZXItdG1wbCIpIHx8IHQgJiYgZCh0LCAibW9udGhHcmlkRm9vdGVyLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJtb250aEdyaWRGb290ZXItdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImhpZGRlblNjaGVkdWxlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA5OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJuZWFyLW1vbnRoLWRheSI7CiAgICAgIH0sCiAgICAgIDQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTM1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAidG9kYXkiOwogICAgICB9LAogICAgICA2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE4MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTk2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgImV4dHJhLWRhdGUiOwogICAgICB9LAogICAgICA4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICBib3JkZXItcmlnaHQ6IiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJib3JkZXJMZWZ0IiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAxMDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1leGNlZWQtaW4tbW9udGgiIGRhdGEteW1kPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJ5bWQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAieW1kIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInltZCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAodShuLCAibW9udGhHcmlkSGVhZGVyRXhjZWVkLXRtcGwiKSB8fCB0ICYmIHUodCwgIm1vbnRoR3JpZEhlYWRlckV4Y2VlZC10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJoaWRkZW5TY2hlZHVsZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJtb250aEdyaWRIZWFkZXJFeGNlZWQtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDg3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMTM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiI7CiAgICAgIH0sCiAgICAgIDEyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWV4Y2VlZC1pbi1tb250aCIgZGF0YS15bWQ9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgInltZCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJ5bWQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAieW1kIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJtb250aEdyaWRGb290ZXJFeGNlZWQtdG1wbCIpIHx8IHQgJiYgdSh0LCAibW9udGhHcmlkRm9vdGVyRXhjZWVkLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImhpZGRlblNjaGVkdWxlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogIm1vbnRoR3JpZEZvb3RlckV4Y2VlZC10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogODcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWJvcmRlciJcbiAgICBzdHlsZT0iXG4gICAgYm9yZGVyLXRvcDogJyArIGMoZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgInN0eWxlcyIpIDogdCkgPyB1KGksICJib3JkZXJUb3AiKSA6IGksIHQpKSArICc7XG4iPjwvZGl2PlxuPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWdyaWQiPlxuJyArIChudWxsICE9IChpID0gdShuLCAiZWFjaCIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiZGF0ZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzwvZGl2PlxuPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGVzIj48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuICJcbiIgKyAobnVsbCAhPSAoaSA9IChlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9KShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OSwKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpOwogICAgICB9LAogICAgICAzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaTsKICAgICAgICByZXR1cm4gIlxuIiArIChudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzgsCiAgICAgICAgICAgICAgY29sdW1uOiA5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpOwogICAgICB9LAogICAgICA0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiXG4iICsgKG51bGwgIT0gKGkgPSAoYShuLCAiZmkiKSB8fCB0ICYmIGEodCwgImZpIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJ0b3AiKSA6IHQsICI8IiwgKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAicmVuZGVyTGltaXRJZHgiKSwgewogICAgICAgICAgbmFtZTogImZpIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NywKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGRhdGEtaWQ9IicgKyBjKCh1KG4sICJzdGFtcCIpIHx8IHQgJiYgdSh0LCAic3RhbXAiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic3RhbXAiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgICAgIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUtYmxvY2tcbiAgICAgICAgICAgICAgICAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUtYmxvY2stIiArIGMoKHUobiwgInN0YW1wIikgfHwgdCAmJiB1KHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNTMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDY4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiXG4gICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSB1KG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiZXhjZWVkTGVmdCIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg2LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAgICAgIiArIChudWxsICE9IChpID0gdShuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImV4Y2VlZFJpZ2h0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA3MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciXG4gICAgICAgICBzdHlsZT0iJyArIGMoKHUobiwgIm1vbnRoLXNjaGVkdWxlQmxvY2siKSB8fCB0ICYmIHUodCwgIm1vbnRoLXNjaGVkdWxlQmxvY2siKSB8fCBzKS5jYWxsKHIsIHQsIChpID0gbyAmJiB1KG8sICJyb290IikpICYmIHUoaSwgImRhdGVzIiksIChpID0gbyAmJiB1KG8sICJyb290IikpICYmIHUoaSwgInNjaGVkdWxlQmxvY2tIZWlnaHQiKSwgKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAiZ3JpZEhlYWRlckhlaWdodCIpLCB7CiAgICAgICAgICBuYW1lOiAibW9udGgtc2NoZWR1bGVCbG9jayIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTA1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiO1xuICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IiArIGMoZS5sYW1iZGEoKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAic2NoZWR1bGVCbG9ja0d1dHRlciIpLCB0KSkgKyAncHgiPlxuJyArIChudWxsICE9IChpID0gKHUobiwgImZpIikgfHwgdCAmJiB1KHQsICJmaSIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgIm1vZGVsIikgOiB0KSA/IHUoaSwgImlzQWxsRGF5IikgOiBpLCAifHwiLCBudWxsICE9IHQgPyB1KHQsICJoYXNNdWx0aURhdGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEwLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgyMywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc1LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAzMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAid2Vla2RheS1leGNlZWQtbGVmdCI7CiAgICAgIH0sCiAgICAgIDg6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogNDYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAid2Vla2RheS1leGNlZWQtcmlnaHQiOwogICAgICB9LAogICAgICAxMDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmxhbWJkYSwKICAgICAgICAgICAgcyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgYyA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICB1ID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgIDxkaXYgZGF0YS1zY2hlZHVsZS1pZD0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTA2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKGMsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTIzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OicgKyBzKHIoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBsaW5lLWhlaWdodDoiICsgcyhyKChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgYm9yZGVyLXJhZGl1czogIiArIHMocigoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJib3JkZXJSYWRpdXMiKSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwoYywgbnVsbCAhPSB0ID8gZCh0LCAiZXhjZWVkTGVmdCIpIDogdCwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRSaWdodCIpIDogdCwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKGMsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTcsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDE5LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgICAgICAgICAiICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogdSkgPyBhLmNhbGwoYywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDM5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiXG4gICAgICAgICAgICAgICAgICBkYXRhLXRpdGxlPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJyI+JyArIChudWxsICE9IChpID0gKGQobiwgImFsbGRheS10bXBsIikgfHwgdCAmJiBkKHQsICJhbGxkYXktdG1wbCIpIHx8IHUpLmNhbGwoYywgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJhbGxkYXktdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOSwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogNzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuICAgICAgICAgICAgIiArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChjLCAoZChuLCAib3IiKSB8fCB0ICYmIGQodCwgIm9yIikgfHwgdSkuY2FsbChjLCAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJpc1JlYWRPbmx5IiksIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc1JlYWRPbmx5IikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAib3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAyMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxOTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMTE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE0NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LXNjaGVkdWxlLWZvY3VzZWQgIjsKICAgICAgfSwKICAgICAgMTM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgIm1hcmdpbkxlZnQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDE1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAibWFyZ2luUmlnaHQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDE3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAxOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBjb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJiZ0NvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgcigiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBzKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHModCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gYS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogODkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1yZXNpemUtaGFuZGxlIGhhbmRsZS15IiBzdHlsZT0ibGluZS1oZWlnaHQ6ICcgKyByKGUubGFtYmRhKChpID0gbyAmJiBzKG8sICJyb290IikpICYmIHMoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICdweDsiPiZuYnNwOzwvc3Bhbj4nOwogICAgICB9LAogICAgICAyMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IChhKG4sICJmaSIpIHx8IHQgJiYgYSh0LCAiZmkiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJjYXRlZ29yeSIpIDogaSwgIj09PSIsICJ0aW1lIiwgewogICAgICAgICAgbmFtZTogImZpIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMzMsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMzLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICAyNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmxhbWJkYSwKICAgICAgICAgICAgcyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgYyA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICB1ID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICAgICAgPGRpdiBkYXRhLXNjaGVkdWxlLWlkPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpZCIpIDogaSwgdCkpICsgJyIgZGF0YS1jYWxlbmRhci1pZD0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY2FsZW5kYXJJZCIpIDogaSwgdCkpICsgJyIgY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHUpID8gYS5jYWxsKGMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM0LAogICAgICAgICAgICAgIGNvbHVtbjogMTAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM0LAogICAgICAgICAgICAgIGNvbHVtbjogMTE0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUgIiArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogdSkgPyBhLmNhbGwoYywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aW1lIlxuICAgICAgICAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OicgKyBzKHIoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBsaW5lLWhlaWdodDoiICsgcyhyKChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgIiArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY3VzdG9tU3R5bGUiKSA6IGksIHQpKSArICciPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogdSkgPyBhLmNhbGwoYywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzYsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtYnVsbGV0IlxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9InRvcDogJyArIHMocigoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJzY2hlZHVsZUJ1bGxldFRvcCIpLCB0KSkgKyAicHg7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwoYywgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMjcsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM4LAogICAgICAgICAgICAgIGNvbHVtbjogMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxuICAgICAgICAgICAgICAgICAgICA+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogdSkgPyBhLmNhbGwoYywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0iXG4nICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwoYywgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMzEsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10aXRsZT0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAidGl0bGUiKSA6IGksIHQpKSArICciPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGQodCwgInRpbWUtdG1wbCIpIHx8IHUpLmNhbGwoYywgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDI1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZmZmZlxuIjsKICAgICAgfSwKICAgICAgMjc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICJcbiI7CiAgICAgIH0sCiAgICAgIDI5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiY29sb3IiKSA6IGksIHQpKSArICJcbiI7CiAgICAgIH0sCiAgICAgIDMxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IzMzMztcbiI7CiAgICAgIH0sCiAgICAgIDMzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubGFtYmRhLAogICAgICAgICAgICBzID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBjID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHUgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgZGF0YS1zY2hlZHVsZS1pZD0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDExNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlICIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChjLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDExLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDEzMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NywKICAgICAgICAgICAgICBjb2x1bW46IDIwMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6JyArIHMocigoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiIgKyBzKHIoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgcyhyKChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImJvcmRlclJhZGl1cyIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRMZWZ0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MSwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKGMsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZFJpZ2h0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NCwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwoYywgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oNDAsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY1LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAgICAgICAgICAgICAiICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcxLAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGl0bGU9IicgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgInRpdGxlIikgOiBpLCB0KSkgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAoZChuLCAic2NoZWR1bGUtdG1wbCIpIHx8IHQgJiYgZCh0LCAic2NoZWR1bGUtdG1wbCIpIHx8IHUpLmNhbGwoYywgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzY2hlZHVsZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcyLAogICAgICAgICAgICAgIGNvbHVtbjogNjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzIsCiAgICAgICAgICAgICAgY29sdW1uOiA5MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAzNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgIm1hcmdpbkxlZnQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDM2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgIm1hcmdpblJpZ2h0IiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAzODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDQwOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJiZ0NvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gYShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgIm1hdHJpY2VzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oMSk7CgogICAgZnVuY3Rpb24gcihlLCB0LCBuKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLm1vbnRoVmlldyA9IHQsIHRoaXMuYmFzZUNvbnRyb2xsZXIgPSBuLCBlLm9uKHsKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5tb250aFZpZXcgPSB0aGlzLmJhc2VDb250cm9sbGVyID0gdGhpcy5kcmFnSGFuZGxlciA9IG51bGw7CiAgICB9LCByLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMsCiAgICAgICAgICBsID0gdGhpcy5iYXNlQ29udHJvbGxlci5zY2hlZHVsZXMsCiAgICAgICAgICByID0gYS5jbG9zZXN0KGUudGFyZ2V0LCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSkgfHwgYS5jbG9zZXN0KGUudGFyZ2V0LCBvLmNsYXNzbmFtZSgiLm1vbnRoLW1vcmUtc2NoZWR1bGUiKSk7CiAgICAgICh0ID0gYS5jbG9zZXN0KGUudGFyZ2V0LCBvLmNsYXNzbmFtZSgiLndlZWtkYXktZXhjZWVkLWluLW1vbnRoIikpKSAmJiBuLmZpcmUoImNsaWNrTW9yZSIsIHsKICAgICAgICBkYXRlOiBpLnBhcnNlKGEuZ2V0RGF0YSh0LCAieW1kIikpLAogICAgICAgIHRhcmdldDogdCwKICAgICAgICB5bWQ6IGEuZ2V0RGF0YSh0LCAieW1kIikKICAgICAgfSksIHIgJiYgbC5kb1doZW5IYXMoYS5nZXREYXRhKHIsICJpZCIpLCBmdW5jdGlvbiAodCkgewogICAgICAgIG4uZmlyZSgiY2xpY2tTY2hlZHVsZSIsIHsKICAgICAgICAgIHNjaGVkdWxlOiB0LAogICAgICAgICAgZXZlbnQ6IGUub3JpZ2luRXZlbnQKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihyKSwgZS5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbigxNSksCiAgICAgICAgciA9IG4oMSksCiAgICAgICAgcyA9IG4oNiksCiAgICAgICAgYyA9IG4oMTkpLAogICAgICAgIHUgPSBuKDEwNSksCiAgICAgICAgZCA9IG4oNCkuRGF0ZSwKICAgICAgICBoID0gMzAwOwoKICAgIGZ1bmN0aW9uIHAoZSwgdCwgbiwgbCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy5tb250aFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSBudWxsLCB0aGlzLl9jYWNoZSA9IG51bGwsIHRoaXMuZ3VpZGUgPSBuZXcgdSh0aGlzKSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMSwgdGhpcy5fZGlzYWJsZURibENsaWNrID0gbC5kaXNhYmxlRGJsQ2xpY2ssIHRoaXMuX2Rpc2FibGVDbGljayA9IGwuZGlzYWJsZUNsaWNrLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyksIGUub24oImNsaWNrIiwgdGhpcy5fb25DbGljaywgdGhpcyksIHRoaXMuX2Rpc2FibGVEYmxDbGljayA/IGggPSAwIDogcy5vbih0LmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyk7CiAgICB9CgogICAgZnVuY3Rpb24gbShlKSB7CiAgICAgIHJldHVybiByLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LWdyaWQiKSkgJiYgIXIuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktZXhjZWVkLWluLW1vbnRoIikpOwogICAgfQoKICAgIHAucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmd1aWRlLmRlc3Ryb3koKSwgdGhpcy5tb250aFZpZXcgJiYgdGhpcy5tb250aFZpZXcuY29udGFpbmVyICYmIHMub2ZmKHRoaXMubW9udGhWaWV3LmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLm1vbnRoVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IHRoaXMuX2NhY2hlID0gdGhpcy5ndWlkZSA9IG51bGw7CiAgICB9LCBwLnByb3RvdHlwZS5fY3JlYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgewogICAgICAgIGlzQWxsRGF5OiBlLmlzQWxsRGF5LAogICAgICAgIHN0YXJ0OiBlLnN0YXJ0LAogICAgICAgIGVuZDogZS5lbmQsCiAgICAgICAgZ3VpZGU6IHRoaXMuZ3VpZGUuZ3VpZGUsCiAgICAgICAgdHJpZ2dlckV2ZW50TmFtZTogZS50cmlnZ2VyRXZlbnQKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdDsKICAgICAgbShlLnRhcmdldCkgJiYgKHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gYyh0aGlzLm1vbnRoVmlldyksIHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSwgdGhpcy5fY2FjaGUgPSB7CiAgICAgICAgc3RhcnQ6IG5ldyBkKHQuZGF0ZSkKICAgICAgfSwgdGhpcy5maXJlKCJtb250aENyZWF0aW9uRHJhZ3N0YXJ0IiwgdCkpOwogICAgfSwgcC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICB0aGlzLmdldFNjaGVkdWxlRGF0YSAmJiAodCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhKGUub3JpZ2luRXZlbnQpKSAmJiB0aGlzLmZpcmUoIm1vbnRoQ3JlYXRpb25EcmFnIiwgdCk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IHRoaXMuX2NhY2hlOwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgJiYgKCh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpICYmIChsLmVuZCA9IG5ldyBkKHQuZGF0ZSksIGwuaXNBbGxEYXkgPSAhMCwgbiA9IFtsLnN0YXJ0LCBsLmVuZF0uc29ydChhLmNvbXBhcmUubnVtLmFzYyksIGwuc3RhcnQgPSBuZXcgZChuWzBdKSwgbC5lbmQgPSBpLmVuZChuWzFdKSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUobCkpLCB0aGlzLmZpcmUoIm1vbnRoQ3JlYXRpb25EcmFnZW5kIiwgdCksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gdGhpcy5fY2FjaGUgPSBudWxsKTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkRibENsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgIG0oZS50YXJnZXQpICYmICh0ID0gYyh0aGlzLm1vbnRoVmlldykoZSksIHRoaXMuZmlyZSgibW9udGhDcmVhdGlvbkNsaWNrIiwgdCksIG4gPSB0aGlzLl9hZGp1c3RTdGFydEFuZEVuZFRpbWUobmV3IGQodC5kYXRlKSwgbmV3IGQodC5kYXRlKSksIHRoaXMuX2NyZWF0ZVNjaGVkdWxlKHsKICAgICAgICBzdGFydDogbi5zdGFydCwKICAgICAgICBlbmQ6IG4uZW5kLAogICAgICAgIGlzQWxsRGF5OiAhMSwKICAgICAgICB0cmlnZ2VyRXZlbnQ6IHQudHJpZ2dlckV2ZW50CiAgICAgIH0pLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICExKTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IHRoaXM7CiAgICAgIG0oZS50YXJnZXQpICYmICF0aGlzLl9kaXNhYmxlQ2xpY2sgJiYgKHQgPSBjKHRoaXMubW9udGhWaWV3KShlLm9yaWdpbkV2ZW50KSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMCwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgbC5fcmVxdWVzdE9uQ2xpY2sgJiYgKGwuZmlyZSgibW9udGhDcmVhdGlvbkNsaWNrIiwgdCksIG4gPSBsLl9hZGp1c3RTdGFydEFuZEVuZFRpbWUobmV3IGQodC5kYXRlKSwgbmV3IGQodC5kYXRlKSksIGwuX2NyZWF0ZVNjaGVkdWxlKHsKICAgICAgICAgIHN0YXJ0OiBuLnN0YXJ0LAogICAgICAgICAgZW5kOiBuLmVuZCwKICAgICAgICAgIGlzQWxsRGF5OiAhMSwKICAgICAgICAgIHRyaWdnZXJFdmVudDogdC50cmlnZ2VyRXZlbnQKICAgICAgICB9KSksIGwuX3JlcXVlc3RPbkNsaWNrID0gITE7CiAgICAgIH0sIGgpKTsKICAgIH0sIHAucHJvdG90eXBlLl9hZGp1c3RTdGFydEFuZEVuZFRpbWUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IG5ldyBkKCksCiAgICAgICAgICBsID0gbi5nZXRIb3VycygpLAogICAgICAgICAgbyA9IG4uZ2V0TWludXRlcygpOwogICAgICByZXR1cm4gbyA9IG8gPD0gMzAgPyAwIDogMzAsIGUuc2V0SG91cnMobCwgbywgMCwgMCksIHQuc2V0SG91cnMobCArIDEsIG8sIDAsIDApLCB7CiAgICAgICAgc3RhcnQ6IGUsCiAgICAgICAgZW5kOiB0CiAgICAgIH07CiAgICB9LCBwLnByb3RvdHlwZS5pbnZva2VDcmVhdGlvbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB7CiAgICAgICAgbW9kZWw6IGUKICAgICAgfTsKICAgICAgdGhpcy5maXJlKCJtb250aENyZWF0aW9uQ2xpY2siLCB0KSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUoewogICAgICAgIHN0YXJ0OiBlLnN0YXJ0LAogICAgICAgIGVuZDogZS5lbmQsCiAgICAgICAgaXNBbGxEYXk6IGUuaXNBbGxEYXksCiAgICAgICAgdHJpZ2dlckV2ZW50OiAibWFudWFsIgogICAgICB9KTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKHApLCBlLmV4cG9ydHMgPSBwOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDM1KTsKCiAgICBmdW5jdGlvbiBvKGUpIHsKICAgICAgdGhpcy5tb250aENyZWF0aW9uID0gZSwgdGhpcy5ndWlkZSA9IG51bGwsIGUub24oewogICAgICAgIG1vbnRoQ3JlYXRpb25EcmFnc3RhcnQ6IHRoaXMuX2NyZWF0ZUd1aWRlRWxlbWVudCwKICAgICAgICBtb250aENyZWF0aW9uRHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIG1vbnRoQ3JlYXRpb25EcmFnZW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgbW9udGhDcmVhdGlvbkNsaWNrOiB0aGlzLl9jcmVhdGVHdWlkZUVsZW1lbnQKICAgICAgfSwgdGhpcyk7CiAgICB9CgogICAgby5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5tb250aENyZWF0aW9uLm9mZih0aGlzKSwgdGhpcy5ndWlkZSAmJiB0aGlzLmd1aWRlLmRlc3Ryb3koKSwgdGhpcy5ndWlkZSA9IHRoaXMubW9udGhDcmVhdGlvbiA9IG51bGw7CiAgICB9LCBvLnByb3RvdHlwZS5fY3JlYXRlR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5ndWlkZSA9IG5ldyBsKHsKICAgICAgICBpc0NyZWF0aW9uTW9kZTogITAsCiAgICAgICAgaGVpZ2h0OiAiMTAwJSIsCiAgICAgICAgdG9wOiAwCiAgICAgIH0sIHRoaXMubW9udGhDcmVhdGlvbi5tb250aFZpZXcpLCB0aGlzLmd1aWRlLnN0YXJ0KGUpOwogICAgfSwgby5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZ3VpZGUudXBkYXRlKGUueCwgZS55KTsKICAgIH0sIG8ucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZ3VpZGUgPSBudWxsOwogICAgfSwgZS5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyByKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGMobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYyh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtY3JlYXRpb24tZ3VpZGUiIHN0eWxlPSJib3JkZXI6ICcgKyByKHMobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGModCwgInN0eWxlcyIpIDogdCkgPyBjKGksICJib3JkZXIiKSA6IGksIHQpKSArICI7IGJhY2tncm91bmQtY29sb3I6ICIgKyByKHMobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGModCwgInN0eWxlcyIpIDogdCkgPyBjKGksICJiYWNrZ3JvdW5kQ29sb3IiKSA6IGksIHQpKSArICc7Ij48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUiXG4gICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJzY2hlZHVsZUhlaWdodCIpIDogaSwgdCkpICsgIjsgbGluZS1oZWlnaHQ6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJzY2hlZHVsZUhlaWdodCIpIDogaSwgdCkpICsgIjsgbWFyZ2luLXRvcDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlR3V0dGVyIikgOiBpLCB0KSkgKyAiOyBib3JkZXItcmFkaXVzOiIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJib3JkZXJSYWRpdXMiKSA6IGksIHQpKSArICI7IG1hcmdpbi1sZWZ0OiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibWFyZ2luTGVmdCIpIDogaSwgdCkpICsgIjsgbWFyZ2luLXJpZ2h0OiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibWFyZ2luUmlnaHQiKSA6IGksIHQpKSArICI7XG4gICAgICAgICAgICBjb2xvcjoiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7Ym9yZGVyLWNvbG9yOiIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJib3JkZXJDb2xvciIpIHx8IChudWxsICE9IHQgPyBoKHQsICJib3JkZXJDb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJib3JkZXJDb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDU2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIjtiYWNrZ3JvdW5kLWNvbG9yOiIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJiZ0NvbG9yIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImJnQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiYmdDb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiPlxuJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzQWxsRGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDQsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDYsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1yZXNpemUtaGFuZGxlIGhhbmRsZS15IiBzdHlsZT0ibGluZS1oZWlnaHQ6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJzY2hlZHVsZUhlaWdodCIpIDogaSwgdCkpICsgJzsiPiZuYnNwOzwvZGl2PlxuICAgIDwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSAoYShuLCAiYWxsZGF5LXRtcGwiKSB8fCB0ICYmIGEodCwgImFsbGRheS10bXBsIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB0LCB7CiAgICAgICAgICBuYW1lOiAiYWxsZGF5LXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIjsKICAgICAgfSwKICAgICAgNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSAoYShuLCAidGltZS10bXBsIikgfHwgdCAmJiBhKHQsICJ0aW1lLXRtcGwiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDM2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1ndWlkZS1ibG9jayIgc3R5bGU9InRvcDonICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJ0b3AiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAidG9wIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRvcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIjtoZWlnaHQ6IiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiaGVpZ2h0IikgfHwgKG51bGwgIT0gdCA/IHUodCwgImhlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJoZWlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA4MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7ZGlzcGxheTpub25lIj5cbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJpc0NyZWF0aW9uTW9kZSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDE5KSwKICAgICAgICBzID0gbigxMDgpLAogICAgICAgIGMgPSBuKDQpLkRhdGUsCiAgICAgICAgdSA9IG4oNSk7CgogICAgZnVuY3Rpb24gZChlLCB0LCBuKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLm1vbnRoVmlldyA9IHQsIHRoaXMuYmFzZUNvbnRyb2xsZXIgPSBuLCB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IG51bGwsIHRoaXMuX2NhY2hlID0gbnVsbCwgdGhpcy5ndWlkZSA9IG5ldyBzKHRoaXMpLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyk7CiAgICB9CgogICAgZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLm1vbnRoVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSBudWxsOwogICAgfSwgZC5wcm90b3R5cGUuX3VwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBpLmVuZChuZXcgYyhlLmVuZCkpLAogICAgICAgICAgbiA9IGUuc2NoZWR1bGUsCiAgICAgICAgICBsID0gdS5nZXRTY2hlZHVsZUNoYW5nZXMobiwgWyJlbmQiXSwgewogICAgICAgIGVuZDogdAogICAgICB9KTsKICAgICAgdGhpcy5maXJlKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIHsKICAgICAgICBzY2hlZHVsZTogbiwKICAgICAgICBjaGFuZ2VzOiBsLAogICAgICAgIHN0YXJ0OiBuZXcgYyhuLmdldFN0YXJ0cygpKSwKICAgICAgICBlbmQ6IHQKICAgICAgfSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgaSA9IGUudGFyZ2V0OwogICAgICBhLmhhc0NsYXNzKGksIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUiKSkgJiYgKGkgPSBhLmNsb3Nlc3QoaSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLWJsb2NrIikpKSAmJiAodCA9IGEuZ2V0RGF0YShpLCAiaWQiKSwgbiA9IHRoaXMuYmFzZUNvbnRyb2xsZXIuc2NoZWR1bGVzLml0ZW1zW3RdLCB0aGlzLmRyYWdIYW5kbGVyLm9uKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IHIodGhpcy5tb250aFZpZXcpLCAobCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhKGUub3JpZ2luRXZlbnQpKS50YXJnZXQgPSBpLCBsLm1vZGVsID0gbiwgdGhpcy5fY2FjaGUgPSB7CiAgICAgICAgc2NoZWR1bGU6IG4sCiAgICAgICAgdGFyZ2V0OiBpLAogICAgICAgIHN0YXJ0OiBuZXcgYyhsLmRhdGUpCiAgICAgIH0sIHRoaXMuZmlyZSgibW9udGhSZXNpemVEcmFnc3RhcnQiLCBsKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHRoaXMuZ2V0U2NoZWR1bGVEYXRhICYmICh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpICYmIHRoaXMuZmlyZSgibW9udGhSZXNpemVEcmFnIiwgdCk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8gPSB0aGlzLl9jYWNoZTsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYoewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhICYmICgodCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhKGUub3JpZ2luRXZlbnQpKSAmJiAobiA9IG5ldyBjKG8uc2NoZWR1bGUuZ2V0U3RhcnRzKCkpLCBsID0gbmV3IGModC5kYXRlKSwgby5lbmQgPSBsLCBuIDw9IG8uZW5kICYmIHRoaXMuX3VwZGF0ZVNjaGVkdWxlKG8pKSwgdGhpcy5maXJlKCJtb250aFJlc2l6ZURyYWdlbmQiLCB0KSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSB0aGlzLl9jYWNoZSA9IG51bGwpOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4oZCksIGUuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oMiksCiAgICAgICAgICBpID0gbigxKSwKICAgICAgICAgIGEgPSBuKDM1KTsKCiAgICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICAgIHRoaXMubW9udGhSZXNpemUgPSBlLCB0aGlzLmVsZW1lbnRzID0gbnVsbCwgdGhpcy5ndWlkZSA9IG51bGwsIGUub24oewogICAgICAgICAgbW9udGhSZXNpemVEcmFnc3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0LAogICAgICAgICAgbW9udGhSZXNpemVEcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICBtb250aFJlc2l6ZURyYWdlbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICAgIH0sIHRoaXMpOwogICAgICB9CgogICAgICByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMubW9udGhSZXNpemUub2ZmKHRoaXMpLCB0aGlzLmd1aWRlLmRlc3Ryb3koKSwgdGhpcy5ndWlkZSA9IHRoaXMubW9udGhSZXNpemUgPSBudWxsOwogICAgICB9LCByLnByb3RvdHlwZS5faGlkZVNjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLmVsZW1lbnRzID0gaS5maW5kKG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jay0iICsgZSksIHRoaXMubW9udGhSZXNpemUubW9udGhWaWV3LmNvbnRhaW5lciwgITApLCBsLmZvckVhY2godGhpcy5lbGVtZW50cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICB9KTsKICAgICAgfSwgci5wcm90b3R5cGUuX3Nob3dTY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBsLmZvckVhY2godGhpcy5lbGVtZW50cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGUuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgfSk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5ndWlkZSA9IG5ldyBhKHsKICAgICAgICAgIGlzUmVzaXplTW9kZTogITAKICAgICAgICB9LCB0aGlzLm1vbnRoUmVzaXplLm1vbnRoVmlldyksIHRoaXMuZ3VpZGUuc3RhcnQoZSksIHRoaXMuX2hpZGVTY2hlZHVsZUJsb2NrcyhlLm1vZGVsLmNpZCgpKSwgbC5icm93c2VyLm1zaWUgfHwgaS5hZGRDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZy14IikpOwogICAgICB9LCByLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLmd1aWRlLnVwZGF0ZShlLngsIGUueSk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fc2hvd1NjaGVkdWxlQmxvY2tzKCksIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmVsZW1lbnRzID0gdGhpcy5ndWlkZSA9IG51bGwsIGwuYnJvd3Nlci5tc2llIHx8IGkucmVtb3ZlQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgicmVzaXppbmcteCIpKTsKICAgICAgfSwgZS5leHBvcnRzID0gcjsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oMTkpLAogICAgICAgIHMgPSBuKDExMCksCiAgICAgICAgYyA9IG4oNCkuRGF0ZTsKCiAgICBmdW5jdGlvbiB1KGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMubW9udGhWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gbnVsbCwgdGhpcy5fY2FjaGUgPSBudWxsLCB0aGlzLmd1aWRlID0gbmV3IHModGhpcyksIGUub24oImRyYWdTdGFydCIsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKTsKICAgIH0KCiAgICB1LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMubW9udGhWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IG51bGw7CiAgICB9LCB1LnByb3RvdHlwZS51cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS5tb2RlbCwKICAgICAgICAgIG4gPSB0LmR1cmF0aW9uKCksCiAgICAgICAgICBsID0gYS5yYXcodC5zdGFydCksCiAgICAgICAgICBvID0gbmV3IGMoZS5lbmQpLAogICAgICAgICAgaSA9IG5ldyBjKG8pOwogICAgICBpLnNldEhvdXJzKGwuaCwgbC5tLCBsLnMsIGwubXMpLCB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiB0LAogICAgICAgIGNoYW5nZXM6IHsKICAgICAgICAgIHN0YXJ0OiBpLAogICAgICAgICAgZW5kOiBuZXcgYyhpKS5hZGRNaWxsaXNlY29uZHMobikKICAgICAgICB9LAogICAgICAgIHN0YXJ0OiBpLAogICAgICAgIGVuZDogbmV3IGMoaSkuYWRkTWlsbGlzZWNvbmRzKG4pCiAgICAgIH0pOwogICAgfSwgdS5wcm90b3R5cGUuZ2V0TW9udGhTY2hlZHVsZUJsb2NrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKTsKICAgICAgcmV0dXJuIGkuY2xvc2VzdChlLCB0KTsKICAgIH0sIHUucHJvdG90eXBlLmdldE1vcmVMYXllclNjaGVkdWxlQmxvY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IG8uY2xhc3NuYW1lKCIubW9udGgtbW9yZS1zY2hlZHVsZSIpOwogICAgICByZXR1cm4gaS5jbG9zZXN0KGUsIHQpOwogICAgfSwgdS5wcm90b3R5cGUuaGFzUGVybWlzc2lvblRvSGFuZGxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gbnVsbDsKICAgICAgcmV0dXJuIGkuaGFzQ2xhc3MoZSwgby5jbGFzc25hbWUoIndlZWtkYXktcmVzaXplLWhhbmRsZSIpKSA/IG51bGwgOiAoKHQgPSB0aGlzLmdldE1vbnRoU2NoZWR1bGVCbG9jayhlKSkgPyBuID0gaS5nZXREYXRhKHQsICJpZCIpIDogKHQgPSB0aGlzLmdldE1vcmVMYXllclNjaGVkdWxlQmxvY2soZSkpICYmIChuID0gaS5nZXREYXRhKHQsICJpZCIpLCB0aGlzLmZpcmUoIm1vbnRoTW92ZVN0YXJ0X2Zyb21fbW9yZWxheWVyIikpLCBuKTsKICAgIH0sIHUucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IGUudGFyZ2V0LAogICAgICAgICAgbCA9IHRoaXMuaGFzUGVybWlzc2lvblRvSGFuZGxlKG4pLAogICAgICAgICAgbyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIuc2NoZWR1bGVzLml0ZW1zW2xdOwogICAgICBsICYmIG8gJiYgIW8uaXNSZWFkT25seSAmJiAhby5pc1BlbmRpbmcgJiYgKHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gcih0aGlzLm1vbnRoVmlldyksICh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpLm9yaWdpbkV2ZW50ID0gZS5vcmlnaW5FdmVudCwgdC50YXJnZXQgPSB0aGlzLmdldE1vbnRoU2NoZWR1bGVCbG9jayhuKSwgdC5tb2RlbCA9IG8sIHRoaXMuX2NhY2hlID0gewogICAgICAgIG1vZGVsOiBvLAogICAgICAgIHRhcmdldDogbiwKICAgICAgICBzdGFydDogbmV3IGMoTnVtYmVyKHQuZGF0ZSkpCiAgICAgIH0sIHRoaXMuZmlyZSgibW9udGhNb3ZlRHJhZ3N0YXJ0IiwgdCkpOwogICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICB0aGlzLmdldFNjaGVkdWxlRGF0YSAmJiAodCA9IGwuZXh0ZW5kKHsKICAgICAgICBvcmlnaW5FdmVudDogZS5vcmlnaW5FdmVudAogICAgICB9LCB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSkpICYmIHRoaXMuZmlyZSgibW9udGhNb3ZlRHJhZyIsIHQpOwogICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuX2NhY2hlOwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgJiYgKCh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpICYmIChuLmVuZCA9IG5ldyBjKHQuZGF0ZSksIHRoaXMudXBkYXRlU2NoZWR1bGUobikpLCB0aGlzLmZpcmUoIm1vbnRoTW92ZURyYWdlbmQiLCB0KSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSB0aGlzLl9jYWNoZSA9IG51bGwpOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4odSksIGUuZXhwb3J0cyA9IHU7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oMiksCiAgICAgICAgICBpID0gbigxKSwKICAgICAgICAgIGEgPSBuKDYpLAogICAgICAgICAgciA9IG4oMTYpLAogICAgICAgICAgcyA9IG4oMTExKSwKICAgICAgICAgIGMgPSBuKDE0KTsKCiAgICAgIGZ1bmN0aW9uIHUoZSkgewogICAgICAgIHRoaXMubW9udGhNb3ZlID0gZSwgdGhpcy5lbGVtZW50cyA9IG51bGwsIHRoaXMubGF5ZXIgPSBudWxsLCBlLm9uKHsKICAgICAgICAgIG1vbnRoTW92ZURyYWdzdGFydDogdGhpcy5fb25EcmFnU3RhcnQsCiAgICAgICAgICBtb250aE1vdmVEcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICBtb250aE1vdmVEcmFnZW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQoKICAgICAgdS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLm1vbnRoTW92ZS5vZmYodGhpcyksIHRoaXMuX2NsZWFyR3JpZEJnQ29sb3IoKSwgdGhpcy5sYXllciAmJiB0aGlzLmxheWVyLmRlc3Ryb3koKSwgdGhpcy5lbGVtZW50ICYmIGkucmVtb3ZlKHRoaXMuZWxlbWVudCksIHRoaXMubW9udGhNb3ZlID0gdGhpcy5lbGVtZW50cyA9IHRoaXMubGF5ZXIgPSBudWxsOwogICAgICB9LCB1LnByb3RvdHlwZS5faGlkZU9yaWdpblNjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLWRyYWdnaW5nLWRpbSIpOwogICAgICAgIHRoaXMuZWxlbWVudHMgPSBpLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLSIgKyBlKSwgdGhpcy5tb250aE1vdmUubW9udGhWaWV3LmNvbnRhaW5lciwgITApLCBsLmZvckVhY2godGhpcy5lbGVtZW50cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGkuYWRkQ2xhc3MoZSwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0sIHUucHJvdG90eXBlLl9zaG93T3JpZ2luU2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBvLmNsYXNzbmFtZSgid2Vla2RheS1zY2hlZHVsZS1ibG9jay1kcmFnZ2luZy1kaW0iKTsKICAgICAgICBsLmZvckVhY2godGhpcy5lbGVtZW50cywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkucmVtb3ZlQ2xhc3ModCwgZSk7CiAgICAgICAgfSk7CiAgICAgIH0sIHUucHJvdG90eXBlLl9jbGVhckdyaWRCZ0NvbG9yID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gby5jbGFzc25hbWUoIi53ZWVrZGF5LWZpbGxlZCIpLAogICAgICAgICAgICB0ID0gby5jbGFzc25hbWUoIndlZWtkYXktZmlsbGVkIiksCiAgICAgICAgICAgIG4gPSBpLmZpbmQoZSwgdGhpcy5tb250aE1vdmUubW9udGhWaWV3LmNvbnRhaW5lcik7CiAgICAgICAgbiAmJiBpLnJlbW92ZUNsYXNzKG4sIHQpOwogICAgICB9LCB1LnByb3RvdHlwZS5fdXBkYXRlR3JpZEJnQ29sb3IgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gaS5maW5kKG8uY2xhc3NuYW1lKCIud2Vla2RheS1ncmlkLWxpbmUiKSwgdGhpcy5tb250aE1vdmUubW9udGhWaWV3LmNvbnRhaW5lciwgITApLAogICAgICAgICAgICBuID0gby5jbGFzc25hbWUoIndlZWtkYXktZmlsbGVkIiksCiAgICAgICAgICAgIGwgPSBlLnggKyBlLnNpemVYICogZS55OwogICAgICAgIHRoaXMuX2NsZWFyR3JpZEJnQ29sb3IoKSwgdCAmJiB0W2xdICYmIGkuYWRkQ2xhc3ModFtsXSwgbik7CiAgICAgIH0sIHUucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4gPSB0aGlzLm1vbnRoTW92ZS5tb250aFZpZXcsCiAgICAgICAgICAgIHUgPSBuLmNoaWxkcmVuLnNpbmdsZSgpLAogICAgICAgICAgICBkID0gdS5vcHRpb25zLAogICAgICAgICAgICBoID0gMTAwIC8gdS5nZXRSZW5kZXJEYXRlUmFuZ2UoKS5sZW5ndGgsCiAgICAgICAgICAgIHAgPSBkLnNjaGVkdWxlR3V0dGVyICsgZC5zY2hlZHVsZUhlaWdodCwKICAgICAgICAgICAgbSA9IG4uY29udGFpbmVyLAogICAgICAgICAgICBmID0gYS5nZXRNb3VzZVBvc2l0aW9uKGUub3JpZ2luRXZlbnQsIG0pLAogICAgICAgICAgICBnID0gZS5tb2RlbCwKICAgICAgICAgICAgeSA9IG5ldyByKG51bGwsIG0pOwogICAgICAgIHRoaXMuX2hpZGVPcmlnaW5TY2hlZHVsZUJsb2NrcyhnLmNpZCgpKSwgdGhpcy5sYXllciA9IHksIHkuc2V0U2l6ZShoICsgIiUiLCBwKSwgeS5zZXRQb3NpdGlvbihmWzBdLCBmWzFdKSwgeS5zZXRDb250ZW50KHMoewogICAgICAgICAgbW9kZWw6IGwuZXh0ZW5kKGMuY3JlYXRlKGcpLCBnKSwKICAgICAgICAgIHN0eWxlczogewogICAgICAgICAgICBzY2hlZHVsZUhlaWdodDogZC5zY2hlZHVsZUhlaWdodCwKICAgICAgICAgICAgc2NoZWR1bGVCdWxsZXRUb3A6IGQuc2NoZWR1bGVIZWlnaHQgLyAzLAogICAgICAgICAgICBib3JkZXJSYWRpdXM6IG4uY29udHJvbGxlci50aGVtZS5tb250aC5zY2hlZHVsZS5ib3JkZXJSYWRpdXMKICAgICAgICAgIH0KICAgICAgICB9KSksIHkuc2hvdygpLCBsLmJyb3dzZXIubXNpZSB8fCBpLmFkZENsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoImRyYWdnaW5nIikpOwogICAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMubW9udGhNb3ZlLm1vbnRoVmlldy5jb250YWluZXIsCiAgICAgICAgICAgIG4gPSBhLmdldE1vdXNlUG9zaXRpb24oZS5vcmlnaW5FdmVudCwgdCk7CiAgICAgICAgdGhpcy5fdXBkYXRlR3JpZEJnQ29sb3IoZSksIHRoaXMubGF5ZXIgJiYgdGhpcy5sYXllci5zZXRQb3NpdGlvbihuWzBdLCBuWzFdKTsKICAgICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9zaG93T3JpZ2luU2NoZWR1bGVCbG9ja3MoKSwgbC5icm93c2VyLm1zaWUgfHwgaS5yZW1vdmVDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJkcmFnZ2luZyIpKSwgdGhpcy5fY2xlYXJHcmlkQmdDb2xvcigpLCB0aGlzLmxheWVyLmRlc3Ryb3koKSwgdGhpcy5sYXllciA9IG51bGw7CiAgICAgIH0sIGUuZXhwb3J0cyA9IHU7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgIGJvcmRlci1sZWZ0OjNweCBzb2xpZCAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiAgICAgICAgICAgICI7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUtYnVsbGV0ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogNTUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA2OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLWJ1bGxldC1mb2N1c2VkIiBzdHlsZT0idG9wOiAnICsgYyhlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgInNjaGVkdWxlQnVsbGV0VG9wIikgOiBpLCB0KSkgKyAncHg7Ij48L3NwYW4+XG4nOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZS1mb2N1c2VkIic7CiAgICAgIH0sCiAgICAgIDc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSAoYShuLCAiYWxsZGF5LXRtcGwiKSB8fCB0ICYmIGEodCwgImFsbGRheS10bXBsIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImFsbGRheS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSAoYShuLCAidGltZS10bXBsIikgfHwgdCAmJiBhKHQsICJ0aW1lLXRtcGwiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidGltZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLWd1aWRlICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDUyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLWd1aWRlLWZvY3VzZWQiXG4gICAgIHN0eWxlPSJ0b3A6IC01MCU7XG4gICAgICAgICAgICBsZWZ0OiAtNTAlO1xuICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjtcbiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6JyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiZHJhZ0JnQ29sb3IiKSA6IGksIHQpKSArICI7XG4gICAgICAgICAgICBoZWlnaHQ6IiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlSGVpZ2h0IikgOiBpLCB0KSkgKyAicHg7XG4gICAgICAgICAgICBsaW5lLWhlaWdodDoiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAic2NoZWR1bGVIZWlnaHQiKSA6IGksIHQpKSArICJweDtcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJib3JkZXJSYWRpdXMiKSA6IGksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzQWxsRGF5IikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPlxuJyArIChudWxsICE9IChpID0gaChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNBbGxEYXkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLW1vdmUtZ3VpZGUgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA2MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlLXRpdGxlICIgKyAobnVsbCAhPSAoaSA9IGgobiwgInVubGVzcyIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzQWxsRGF5IikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMTY2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIj5cbiIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNBbGxEYXkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTcsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgIDwvZGl2PlxuPC9kaXY+XG48ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLWd1aWRlLWNvdmVyIiBzdHlsZT0iaGVpZ2h0OicgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJzY2hlZHVsZUhlaWdodCIpIDogaSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiYm9yZGVyUmFkaXVzIikgOiBpLCB0KSkgKyAnOyI+PC9kaXY+XG4nOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oNiksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oOCksCiAgICAgICAgcyA9IG4oMTYpLAogICAgICAgIGMgPSBuKDUpLAogICAgICAgIHUgPSBuKDExMyk7CgogICAgZnVuY3Rpb24gZChlLCB0LCBuKSB7CiAgICAgIHIuY2FsbCh0aGlzLCB0KSwgdGhpcy5sYXllciA9IG5ldyBzKG51bGwsIHQpLCB0aGlzLl92aWV3TW9kZWwgPSBudWxsLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgbW9yZUxheWVyU2l6ZTogewogICAgICAgICAgd2lkdGg6IG51bGwsCiAgICAgICAgICBoZWlnaHQ6IG51bGwKICAgICAgICB9LAogICAgICAgIHNjaGVkdWxlSGVpZ2h0OiBwYXJzZUludChuLm1vbnRoLnNjaGVkdWxlLmhlaWdodCwgMTApIHx8IDE4LAogICAgICAgIHNjaGVkdWxlR3V0dGVyOiBwYXJzZUludChuLm1vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCwgMTApIHx8IDIsCiAgICAgICAgc2NoZWR1bGVCdWxsZXRUb3A6IChwYXJzZUludChuLm1vbnRoLnNjaGVkdWxlLmhlaWdodCwgMTApIHx8IDE4KSAvIDMsCiAgICAgICAgYm9yZGVyUmFkaXVzOiBuLm1vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cwogICAgICB9LCBlKSwgdGhpcy50aGVtZSA9IG4sIGkub24odCwgImNsaWNrIiwgdGhpcy5fb25DbGljaywgdGhpcyk7CiAgICB9CgogICAgbC5pbmhlcml0KGQsIHIpLCBkLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gaS5nZXRFdmVudFRhcmdldChlKSwKICAgICAgICAgIG4gPSBvLmNsYXNzbmFtZSgibW9udGgtbW9yZS1jbG9zZSIpOwogICAgICAoYS5oYXNDbGFzcyh0LCBuKSB8fCBhLmNsb3Nlc3QodCwgIi4iICsgbikpICYmIHRoaXMuaGlkZSgpOwogICAgfSwgZC5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBpLmdldEV2ZW50VGFyZ2V0KGUpOwogICAgICBhLmNsb3Nlc3QodCwgby5jbGFzc25hbWUoIi5tb250aC1tb3JlIikpIHx8IHRoaXMuaGlkZSgpOwogICAgfSwgZC5wcm90b3R5cGUuX2dldFJlbmRlclBvc2l0aW9uID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSBpLmdldE1vdXNlUG9zaXRpb24oewogICAgICAgIGNsaWVudFg6IGEuZ2V0UG9zaXRpb24oZSlbMF0sCiAgICAgICAgY2xpZW50WTogYS5nZXRQb3NpdGlvbih0KVsxXQogICAgICB9LCB0aGlzLmNvbnRhaW5lciksCiAgICAgICAgICBsID0gYS5nZXRTaXplKHRoaXMuY29udGFpbmVyKSwKICAgICAgICAgIG8gPSBuWzBdIC0gNSwKICAgICAgICAgIHIgPSBuWzFdIC0gNTsKICAgICAgcmV0dXJuIFtvID0gYy5yYXRpbyhsWzBdLCAxMDAsIG8pLCByID0gYy5yYXRpbyhsWzFdLCAxMDAsIHIpXTsKICAgIH0sIGQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMubGF5ZXIuZGVzdHJveSgpLCB0aGlzLmxheWVyID0gbnVsbCwgaS5vZmYodGhpcy5jb250YWluZXIsICJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpLCBpLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpLCByLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7CiAgICB9LCBkLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICByLAogICAgICAgICAgcywKICAgICAgICAgIGMgPSBhLmNsb3Nlc3QoZS50YXJnZXQsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1ncmlkLWxpbmUiKSksCiAgICAgICAgICBkID0gYS5jbG9zZXN0KGMsIG8uY2xhc3NuYW1lKCIubW9udGgtd2Vlay1pdGVtIikpLAogICAgICAgICAgaCA9IHRoaXMubGF5ZXIsCiAgICAgICAgICBwID0gdGhpcywKICAgICAgICAgIG0gPSB0aGlzLl9nZXRSZW5kZXJQb3NpdGlvbihjLCBkKSwKICAgICAgICAgIGYgPSBhLmdldFNpemUoZClbMV0gKyAxMCwKICAgICAgICAgIGcgPSBjLm9mZnNldFdpZHRoICsgMTAsCiAgICAgICAgICB5ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgUyA9IHkubW9yZUxheWVyU2l6ZSwKICAgICAgICAgIF8gPSB0aGlzLl9nZXRTdHlsZXModGhpcy50aGVtZSksCiAgICAgICAgICBDID0gIiIsCiAgICAgICAgICB2ID0gYS5nZXRTaXplKHRoaXMuY29udGFpbmVyKSwKICAgICAgICAgIEUgPSBtWzBdLAogICAgICAgICAgdyA9IG1bMV07CgogICAgICB0aGlzLl92aWV3TW9kZWwgPSBsLmV4dGVuZChlLCB7CiAgICAgICAgc2NoZWR1bGVHdXR0ZXI6IHkuc2NoZWR1bGVHdXR0ZXIsCiAgICAgICAgc2NoZWR1bGVIZWlnaHQ6IHkuc2NoZWR1bGVIZWlnaHQsCiAgICAgICAgc2NoZWR1bGVCdWxsZXRUb3A6IHkuc2NoZWR1bGVCdWxsZXRUb3AsCiAgICAgICAgYm9yZGVyUmFkaXVzOiB5LmJvcmRlclJhZGl1cywKICAgICAgICBzdHlsZXM6IF8KICAgICAgfSksIGcgPSBNYXRoLm1heChnLCAyODApLCBDID0gcGFyc2VJbnQoXy50aXRsZUhlaWdodCwgMTApLCBDICs9IHBhcnNlSW50KF8udGl0bGVNYXJnaW5Cb3R0b20sIDEwKSwgZS5zY2hlZHVsZXMubGVuZ3RoIDw9IDEwID8gQyArPSAoeS5zY2hlZHVsZUd1dHRlciArIHkuc2NoZWR1bGVIZWlnaHQpICogZS5zY2hlZHVsZXMubGVuZ3RoIDogQyArPSAxMCAqICh5LnNjaGVkdWxlR3V0dGVyICsgeS5zY2hlZHVsZUhlaWdodCksIEMgKz0gcGFyc2VJbnQoXy5wYWRkaW5nQm90dG9tLCAxMCksIEMgKz0gNSwgUy53aWR0aCAmJiAoZyA9IFMud2lkdGgpLCBTLmhlaWdodCAmJiAoQyA9IFMuaGVpZ2h0KSwgKGlzTmFOKEMpIHx8IEMgPCBmKSAmJiAoQyA9IGYpLCBoLnNldENvbnRlbnQodShlKSksIHQgPSBFICogdlswXSAvIDEwMCwgbiA9IHcgKiB2WzFdIC8gMTAwLCByID0gdCArIGcgPj0gdlswXSwgcyA9IG4gKyBDID49IHZbMV0sIEUgKz0gIiUiLCB3ICs9ICIlIiwgciAmJiBzID8gaC5zZXRMVFJCKHsKICAgICAgICByaWdodDogMCwKICAgICAgICBib3R0b206IDAKICAgICAgfSkgOiAhciAmJiBzID8gaC5zZXRMVFJCKHsKICAgICAgICBsZWZ0OiBFLAogICAgICAgIGJvdHRvbTogMAogICAgICB9KSA6IHIgJiYgIXMgPyBoLnNldExUUkIoewogICAgICAgIHJpZ2h0OiAwLAogICAgICAgIHRvcDogdwogICAgICB9KSA6IGguc2V0UG9zaXRpb24oRSwgdyksIGguc2V0U2l6ZShnLCBDKSwgaC5zaG93KCksIGwuZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICAgIGkub24oZG9jdW1lbnQuYm9keSwgIm1vdXNlZG93biIsIHAuX29uTW91c2VEb3duLCBwKTsKICAgICAgfSkoKTsKICAgIH0sIGQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMubGF5ZXIuaGlkZSgpLCBpLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpOwogICAgfSwgZC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fdmlld01vZGVsICYmIHRoaXMubGF5ZXIuc2V0Q29udGVudCh1KHRoaXMuX3ZpZXdNb2RlbCkpOwogICAgfSwgZC5wcm90b3R5cGUuZ2V0TW9yZVZpZXdFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gYS5maW5kKG8uY2xhc3NuYW1lKCIubW9udGgtbW9yZSIpLCB0aGlzLmxheWVyLmNvbnRhaW5lcik7CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB7fSwKICAgICAgICAgIG4gPSAiIjsKICAgICAgcmV0dXJuIGUgJiYgKHQuYm9yZGVyID0gZS5tb250aC5tb3JlVmlldy5ib3JkZXIgfHwgZS5jb21tb24uYm9yZGVyLCB0LmJveFNoYWRvdyA9IGUubW9udGgubW9yZVZpZXcuYm94U2hhZG93LCB0LmJhY2tncm91bmRDb2xvciA9IGUubW9udGgubW9yZVZpZXcuYmFja2dyb3VuZENvbG9yIHx8IGUuY29tbW9uLmJhY2tncm91bmRDb2xvciwgdC5wYWRkaW5nQm90dG9tID0gZS5tb250aC5tb3JlVmlldy5wYWRkaW5nQm90dG9tLCB0LnRpdGxlSGVpZ2h0ID0gZS5tb250aC5tb3JlVmlld1RpdGxlLmhlaWdodCwgdC50aXRsZU1hcmdpbkJvdHRvbSA9IGUubW9udGgubW9yZVZpZXdUaXRsZS5tYXJnaW5Cb3R0b20sIHQudGl0bGVCYWNrZ3JvdW5kQ29sb3IgPSBlLm1vbnRoLm1vcmVWaWV3VGl0bGUuYmFja2dyb3VuZENvbG9yLCB0LnRpdGxlQm9yZGVyQm90dG9tID0gZS5tb250aC5tb3JlVmlld1RpdGxlLmJvcmRlckJvdHRvbSwgdC50aXRsZVBhZGRpbmcgPSBlLm1vbnRoLm1vcmVWaWV3VGl0bGUucGFkZGluZywgdC5saXN0UGFkZGluZyA9IGUubW9udGgubW9yZVZpZXdMaXN0LnBhZGRpbmcsIG4gPSAiY2FsYygxMDAlIiwgcGFyc2VJbnQodC50aXRsZUhlaWdodCwgMTApICYmIChuICs9ICIgLSAiICsgdC50aXRsZUhlaWdodCksIHBhcnNlSW50KHQudGl0bGVNYXJnaW5Cb3R0b20sIDEwKSAmJiAobiArPSAiIC0gIiArIHQudGl0bGVNYXJnaW5Cb3R0b20pLCBuICs9ICIpIiwgdC5saXN0SGVpZ2h0ID0gbiksIHQ7CiAgICB9LCBlLmV4cG9ydHMgPSBkOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IChhKG4sICJmaSIpIHx8IHQgJiYgYSh0LCAiZmkiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJpc0FsbERheSIpIDogaSwgInx8IiwgbnVsbCAhPSB0ID8gYSh0LCAiaGFzTXVsdGlEYXRlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImZpIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NSwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBkYXRhLWlkPSInICsgYygoZChuLCAic3RhbXAiKSB8fCB0ICYmIGQodCwgInN0YW1wIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInN0YW1wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgICAgICAgICAgICBkYXRhLXNjaGVkdWxlLWlkPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpZCIpIDogaSwgdCkpICsgJyIgZGF0YS1jYWxlbmRhci1pZD0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY2FsZW5kYXJJZCIpIDogaSwgdCkpICsgJyJcbiAgICAgICAgICAgICAgICBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLW1vcmUtc2NoZWR1bGUgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLW1vcmUtYWxsZGF5ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogODkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OiAnICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgbGluZS1oZWlnaHQ6ICIgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBtYXJnaW4tdG9wOiAiICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlR3V0dGVyIiksIHQpKSArICJweDsgYm9yZGVyLXJhZGl1czogIiArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJib3JkZXJSYWRpdXMiKSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAgICAgICAgICIgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImN1c3RvbVN0eWxlIikgOiBpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgICAgICAgICAgJyArIChudWxsICE9IChpID0gKGQobiwgImFsbGRheS10bXBsIikgfHwgdCAmJiBkKHQsICJhbGxkYXktdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJhbGxkYXktdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItbGVmdDozcHggc29saWQgIiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJiZ0NvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItbGVmdDozcHggc29saWQgIiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGEobiwgImZpIikgfHwgdCAmJiBhKHQsICJmaSIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImNhdGVnb3J5IikgOiBpLCAiPT09IiwgInRpbWUiLCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDE3LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1pZD0iJyArIGMoKGgobiwgInN0YW1wIikgfHwgdCAmJiBoKHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICciXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtc2NoZWR1bGUtaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlkIikgOiBpLCB0KSkgKyAnIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJjYWxlbmRhcklkIikgOiBpLCB0KSkgKyAnIlxuICAgICAgICAgICAgICAgICAgICBjbGFzcz0iJyArIGMoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBkID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJtb250aC1tb3JlLXNjaGVkdWxlICIgKyBjKF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gZCA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZSAiICsgYyhfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGQgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDEwNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpbWUiXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKHUoKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBsaW5lLWhlaWdodDogIiArIGModSgoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IG1hcmdpbi10b3A6ICIgKyBjKHUoKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic2NoZWR1bGVHdXR0ZXIiKSwgdCkpICsgInB4OyIgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImN1c3RvbVN0eWxlIikgOiBpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gZCA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS1idWxsZXQiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0idG9wOiAnICsgYyh1KChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInNjaGVkdWxlQnVsbGV0VG9wIiksIHQpKSArICJweDtcbiIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDksIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDExLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM0LAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgYyhfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGQgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzUsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNSwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0iJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDE1LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQxLAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10aXRsZT0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAidGl0bGUiKSA6IGksIHQpKSArICciPicgKyAobnVsbCAhPSAoaSA9IChoKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGgodCwgInRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmXG4iOwogICAgICB9LAogICAgICAxMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDoiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICI7CiAgICAgIH0sCiAgICAgIDEzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJjb2xvciIpIDogaSwgdCkpICsgIlxuIjsKICAgICAgfSwKICAgICAgMTU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjojMzMzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICI7CiAgICAgIH0sCiAgICAgIDE3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgZGF0YS1pZD0iJyArIGMoKGQobiwgInN0YW1wIikgfHwgdCAmJiBkKHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICciXG4gICAgICAgICAgICAgICAgICAgIGRhdGEtc2NoZWR1bGUtaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlkIikgOiBpLCB0KSkgKyAnIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjYWxlbmRhcklkIikgOiBpLCB0KSkgKyAnIlxuICAgICAgICAgICAgICAgICAgICBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLW1vcmUtc2NoZWR1bGUgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiA2MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogOTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OicgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBsaW5lLWhlaWdodDoiICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgYm9yZGVyLXJhZGl1czogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJib3JkZXJSYWRpdXMiKSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiZXhjZWVkTGVmdCIpIDogdCwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjAsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ5LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiAzMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRSaWdodCIpIDogdCwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjQsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDI2LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgICAgICAgICAgICAgIiArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY3VzdG9tU3R5bGUiKSA6IGksIHQpKSArICciPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjEsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MSwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRpdGxlPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJyI+JyArIChudWxsICE9IChpID0gKGQobiwgInNjaGVkdWxlLXRtcGwiKSB8fCB0ICYmIGQodCwgInNjaGVkdWxlLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic2NoZWR1bGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDY1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogOTAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMTg6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDExNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDEyOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LXNjaGVkdWxlLWZvY3VzZWQgIjsKICAgICAgfSwKICAgICAgMjA6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJtYXJnaW5MZWZ0IiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJtYXJnaW5SaWdodCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMjQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYmdDb2xvciIpIDogaSwgdCkpICsgIjsgYm9yZGVyLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtbW9yZSIgc3R5bGU9InBhZGRpbmctYm90dG9tOiAnICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAicGFkZGluZ0JvdHRvbSIpIDogaSwgdCkpICsgIjsgYm9yZGVyOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiYm9yZGVyIikgOiBpLCB0KSkgKyAiOyBib3gtc2hhZG93OiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiYm94U2hhZG93IikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiYmFja2dyb3VuZENvbG9yIikgOiBpLCB0KSkgKyAnOyI+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtbW9yZS10aXRsZSJcbiAgICAgICAgc3R5bGU9ImhlaWdodDogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInRpdGxlSGVpZ2h0IikgOiBpLCB0KSkgKyAiOyBtYXJnaW4tYm90dG9tOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAidGl0bGVNYXJnaW5Cb3R0b20iKSA6IGksIHQpKSArICI7IGJhY2tncm91bmQtY29sb3I6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJ0aXRsZUJhY2tncm91bmRDb2xvciIpIDogaSwgdCkpICsgIjsgYm9yZGVyLWJvdHRvbTogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInRpdGxlQm9yZGVyQm90dG9tIikgOiBpLCB0KSkgKyAiOyBwYWRkaW5nOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAidGl0bGVQYWRkaW5nIikgOiBpLCB0KSkgKyAnOyI+XG4gICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDIxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1tb3JlLXRpdGxlLWRhdGUiPicgKyAobnVsbCAhPSAoaSA9IChoKG4sICJtb250aE1vcmVUaXRsZURhdGUtdG1wbCIpIHx8IHQgJiYgaCh0LCAibW9udGhNb3JlVGl0bGVEYXRlLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImRhdGUiKSA6IHQsIG51bGwgIT0gdCA/IGgodCwgImRheW5hbWUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJtb250aE1vcmVUaXRsZURhdGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDEwMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L3NwYW4+XG4gICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtbW9yZS1jbG9zZSI+JyArIChudWxsICE9IChpID0gX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIm1vbnRoTW9yZUNsb3NlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibW9udGhNb3JlQ2xvc2UtdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJtb250aE1vcmVDbG9zZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA2OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogOTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiIpICsgJzwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLW1vcmUtbGlzdCIgc3R5bGU9InBhZGRpbmc6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJsaXN0UGFkZGluZyIpIDogaSwgdCkpICsgIjsgaGVpZ2h0OiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibGlzdEhlaWdodCIpIDogaSwgdCkpICsgJzsiPlxuJyArIChudWxsICE9IChpID0gaChuLCAiZWFjaCIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgPC9kaXY+XG48L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikge30sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIwKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbig1KSwKICAgICAgICByID0gbigyKSwKICAgICAgICBzID0gTWF0aC5tYXgsCiAgICAgICAgYyA9IHsKICAgICAgc3RhbXA6IGZ1bmN0aW9uIHN0YW1wKGUpIHsKICAgICAgICByZXR1cm4gbC5zdGFtcChlKTsKICAgICAgfSwKICAgICAgZXF1YWw6IGZ1bmN0aW9uIGVxdWFsKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSA9PT0gdDsKICAgICAgfSwKICAgICAgb3I6IGZ1bmN0aW9uIG9yKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSB8fCB0OwogICAgICB9LAogICAgICBhbmQ6IGZ1bmN0aW9uIGFuZChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgJiYgdDsKICAgICAgfSwKICAgICAgZmk6IGZ1bmN0aW9uIGZpKGUsIHQsIG4sIGwpIHsKICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgIGNhc2UgIj09IjoKICAgICAgICAgICAgcmV0dXJuIGUgPT0gbiA/IGwuZm4odGhpcykgOiBsLmludmVyc2UodGhpcyk7CgogICAgICAgICAgY2FzZSAiPT09IjoKICAgICAgICAgICAgcmV0dXJuIGUgPT09IG4gPyBsLmZuKHRoaXMpIDogbC5pbnZlcnNlKHRoaXMpOwoKICAgICAgICAgIGNhc2UgIiE9PSI6CiAgICAgICAgICAgIHJldHVybiBlICE9PSBuID8gbC5mbih0aGlzKSA6IGwuaW52ZXJzZSh0aGlzKTsKCiAgICAgICAgICBjYXNlICI8IjoKICAgICAgICAgICAgcmV0dXJuIGUgPCBuID8gbC5mbih0aGlzKSA6IGwuaW52ZXJzZSh0aGlzKTsKCiAgICAgICAgICBjYXNlICJ8fCI6CiAgICAgICAgICAgIHJldHVybiBlIHx8IG4gPyBsLmZuKHRoaXMpIDogbC5pbnZlcnNlKHRoaXMpOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IG1hdGNoIG9wZXJhdGlvbiIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGhtbTogZnVuY3Rpb24gaGhtbShlKSB7CiAgICAgICAgcmV0dXJuIGkuZm9ybWF0KGUsICJISDptbSIpOwogICAgICB9LAogICAgICAiY29tbW9uLXdpZHRoIjogZnVuY3Rpb24gY29tbW9uV2lkdGgoZSkgewogICAgICAgIHJldHVybiB1KGUsICIlIiwgIndpZHRoIik7CiAgICAgIH0sCiAgICAgICJncmlkLWxlZnQiOiBmdW5jdGlvbiBncmlkTGVmdChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICByZXR1cm4gdFtlLmxlZnRdID8gdFtlLmxlZnRdLmxlZnQgOiAwOwogICAgICAgIH0oZSwgdCk7CiAgICAgIH0sCiAgICAgICJncmlkLXdpZHRoIjogZnVuY3Rpb24gZ3JpZFdpZHRoKGUsIHQpIHsKICAgICAgICByZXR1cm4gZChlLCB0KTsKICAgICAgfSwKICAgICAgInRpbWUtc2NoZWR1bGVCbG9jayI6IGZ1bmN0aW9uIHRpbWVTY2hlZHVsZUJsb2NrKGUsIHQpIHsKICAgICAgICB2YXIgbiA9IHUoZS50b3AsICJweCIsICJ0b3AiKSwKICAgICAgICAgICAgbCA9IHUoZS5sZWZ0LCB0ID8gIiUiIDogInB4IiwgImxlZnQiKSwKICAgICAgICAgICAgbyA9IHUoZS53aWR0aCwgIiUiLCAid2lkdGgiKSwKICAgICAgICAgICAgaSA9IHUoZS5oZWlnaHQsICJweCIsICJoZWlnaHQiKSwKICAgICAgICAgICAgYSA9IG5ldyBEYXRlKGUubW9kZWwuc3RhcnQuX2RhdGUpLmdldEhvdXJzKCkgPiBlLmhvdXJTdGFydCA/ICIiIDogImRpc3BsYXk6bm9uZSI7CiAgICAgICAgcmV0dXJuIHQgPyBbbCwgYV0uam9pbigiOyIpIDogW24sIGwsIG8sIGksIGFdLmpvaW4oIjsiKTsKICAgICAgfSwKICAgICAgIm1vbnRoLXNjaGVkdWxlQmxvY2siOiBmdW5jdGlvbiBtb250aFNjaGVkdWxlQmxvY2soZSwgdCwgbiwgbCkgewogICAgICAgIHJldHVybiBbdSgoZS50b3AgLSAxKSAqIG4gKyBsLCAicHgiLCAidG9wIiksIHUodFtlLmxlZnRdID8gdFtlLmxlZnRdLmxlZnQgOiAwLCAiJSIsICJsZWZ0IiksIHUoZChlLCB0KSwgIiUiLCAid2lkdGgiKSwgdShlLmhlaWdodCwgInB4IiwgImhlaWdodCIpXS5qb2luKCI7Iik7CiAgICAgIH0sCiAgICAgIGhvbGlkYXk6IGZ1bmN0aW9uIGhvbGlkYXkoZSkgewogICAgICAgIHZhciB0ID0gIiI7CiAgICAgICAgcmV0dXJuIDAgPT09IGUgJiYgKHQgPSByLmNsYXNzbmFtZSgiaG9saWRheS1zdW4iKSksIDYgPT09IGUgJiYgKHQgPSByLmNsYXNzbmFtZSgiaG9saWRheS1zYXQiKSksIHQ7CiAgICAgIH0sCiAgICAgIGFkZDogZnVuY3Rpb24gYWRkKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSArIHQ7CiAgICAgIH0sCiAgICAgIG11bHRpcGx5OiBmdW5jdGlvbiBtdWx0aXBseShlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgKiB0OwogICAgICB9LAogICAgICBkaXZpZGU6IGZ1bmN0aW9uIGRpdmlkZShlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgLyB0OwogICAgICB9LAogICAgICBzdWJ0cmFjdDogZnVuY3Rpb24gc3VidHJhY3QoZSwgdCkgewogICAgICAgIHJldHVybiBlIC0gdDsKICAgICAgfSwKICAgICAgZ2V0UmlnaHQ6IGZ1bmN0aW9uIGdldFJpZ2h0KGUsIHQpIHsKICAgICAgICByZXR1cm4gcygwLCAxMDAgLSAoZSArIHQpKTsKICAgICAgfSwKICAgICAgQ1NTX1BSRUZJWDogZnVuY3Rpb24gQ1NTX1BSRUZJWCgpIHsKICAgICAgICByZXR1cm4gci5jc3NQcmVmaXg7CiAgICAgIH0sCiAgICAgIHJldmVyc2U6IGZ1bmN0aW9uIHJldmVyc2UoZSkgewogICAgICAgIHJldHVybiBlLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgICB9LAogICAgICAibWlsZXN0b25lLXRtcGwiOiBmdW5jdGlvbiBtaWxlc3RvbmVUbXBsKGUpIHsKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgci5jbGFzc25hbWUoImljb24iKSArICIgIiArIHIuY2xhc3NuYW1lKCJpYy1taWxlc3RvbmUiKSArICciPjwvc3Bhbj48c3BhbiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArIGUuYmdDb2xvciArICciPicgKyBhLnN0cmlwVGFncyhlLnRpdGxlKSArICI8L3NwYW4+IjsKICAgICAgfSwKICAgICAgIm1pbGVzdG9uZVRpdGxlLXRtcGwiOiBmdW5jdGlvbiBtaWxlc3RvbmVUaXRsZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHIuY2xhc3NuYW1lKCJsZWZ0LWNvbnRlbnQiKSArICciPk1pbGVzdG9uZTwvc3Bhbj4nOwogICAgICB9LAogICAgICAidGFzay10bXBsIjogZnVuY3Rpb24gdGFza1RtcGwoZSkgewogICAgICAgIHJldHVybiAiIyIgKyBlLnRpdGxlOwogICAgICB9LAogICAgICAidGFza1RpdGxlLXRtcGwiOiBmdW5jdGlvbiB0YXNrVGl0bGVUbXBsKCkgewogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByLmNsYXNzbmFtZSgibGVmdC1jb250ZW50IikgKyAnIj5UYXNrPC9zcGFuPic7CiAgICAgIH0sCiAgICAgICJhbGxkYXlUaXRsZS10bXBsIjogZnVuY3Rpb24gYWxsZGF5VGl0bGVUbXBsKCkgewogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByLmNsYXNzbmFtZSgibGVmdC1jb250ZW50IikgKyAnIj5BbGwgRGF5PC9zcGFuPic7CiAgICAgIH0sCiAgICAgICJhbGxkYXktdG1wbCI6IGZ1bmN0aW9uIGFsbGRheVRtcGwoZSkgewogICAgICAgIHJldHVybiBhLnN0cmlwVGFncyhlLnRpdGxlKTsKICAgICAgfSwKICAgICAgInRpbWUtdG1wbCI6IGZ1bmN0aW9uIHRpbWVUbXBsKGUpIHsKICAgICAgICByZXR1cm4gYS5zdHJpcFRhZ3MoZS50aXRsZSk7CiAgICAgIH0sCiAgICAgICJnb2luZ0R1cmF0aW9uLXRtcGwiOiBmdW5jdGlvbiBnb2luZ0R1cmF0aW9uVG1wbChlKSB7CiAgICAgICAgdmFyIHQgPSBlLmdvaW5nRHVyYXRpb24sCiAgICAgICAgICAgIG4gPSBwYXJzZUludCh0IC8gNjAsIDEwKSwKICAgICAgICAgICAgbCA9IHQgJSA2MDsKICAgICAgICByZXR1cm4gIkdvaW5nVGltZSAiICsgaS5sZWFkaW5nWmVybyhuLCAyKSArICI6IiArIGkubGVhZGluZ1plcm8obCwgMik7CiAgICAgIH0sCiAgICAgICJjb21pbmdEdXJhdGlvbi10bXBsIjogZnVuY3Rpb24gY29taW5nRHVyYXRpb25UbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IGUuZ29pbmdEdXJhdGlvbiwKICAgICAgICAgICAgbiA9IHBhcnNlSW50KHQgLyA2MCwgMTApLAogICAgICAgICAgICBsID0gdCAlIDYwOwogICAgICAgIHJldHVybiAiQ29taW5nVGltZSAiICsgaS5sZWFkaW5nWmVybyhuLCAyKSArICI6IiArIGkubGVhZGluZ1plcm8obCwgMik7CiAgICAgIH0sCiAgICAgICJkaXNwbGF5UGhvbmUtdG1wbCI6IGZ1bmN0aW9uIGRpc3BsYXlQaG9uZVRtcGwoZSkgewogICAgICAgIHJldHVybiBlLnJhdy5waG9uZV9udW1iZXIgfHwgIiI7CiAgICAgIH0sCiAgICAgICJtb250aE1vcmVUaXRsZURhdGUtdG1wbCI6IGZ1bmN0aW9uIG1vbnRoTW9yZVRpdGxlRGF0ZVRtcGwoZSwgdCkgewogICAgICAgIHZhciBuID0gci5jbGFzc25hbWUoIm1vbnRoLW1vcmUtdGl0bGUtZGF5IiksCiAgICAgICAgICAgIG8gPSByLmNsYXNzbmFtZSgibW9udGgtbW9yZS10aXRsZS1kYXktbGFiZWwiKTsKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgbiArICciPicgKyBsLnBpY2soZS5zcGxpdCgiLiIpLCAyKSArICc8L3NwYW4+IDxzcGFuIGNsYXNzPSInICsgbyArICciPicgKyB0ICsgIjwvc3Bhbj4iOwogICAgICB9LAogICAgICAibW9udGhNb3JlQ2xvc2UtdG1wbCI6IGZ1bmN0aW9uIG1vbnRoTW9yZUNsb3NlVG1wbCgpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0sCiAgICAgICJtb250aEdyaWRIZWFkZXItdG1wbCI6IGZ1bmN0aW9uIG1vbnRoR3JpZEhlYWRlclRtcGwoZSkgewogICAgICAgIHZhciB0ID0gcGFyc2VJbnQoZS5kYXRlLnNwbGl0KCItIilbMl0sIDEwKSwKICAgICAgICAgICAgbiA9IFtdOwogICAgICAgIHJldHVybiBuLnB1c2goci5jbGFzc25hbWUoIndlZWtkYXktZ3JpZC1kYXRlIikpLCBlLmlzVG9kYXkgJiYgbi5wdXNoKHIuY2xhc3NuYW1lKCJ3ZWVrZGF5LWdyaWQtZGF0ZS1kZWNvcmF0b3IiKSksICc8c3BhbiBjbGFzcz0iJyArIG4uam9pbigiICIpICsgJyI+JyArIHQgKyAiPC9zcGFuPiI7CiAgICAgIH0sCiAgICAgICJtb250aEdyaWRIZWFkZXJFeGNlZWQtdG1wbCI6IGZ1bmN0aW9uIG1vbnRoR3JpZEhlYWRlckV4Y2VlZFRtcGwoZSkgewogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByLmNsYXNzbmFtZSgid2Vla2RheS1ncmlkLW1vcmUtc2NoZWR1bGVzIikgKyAnIj4nICsgZSArICIgbW9yZTwvc3Bhbj4iOwogICAgICB9LAogICAgICAibW9udGhHcmlkRm9vdGVyLXRtcGwiOiBmdW5jdGlvbiBtb250aEdyaWRGb290ZXJUbXBsKCkgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfSwKICAgICAgIm1vbnRoR3JpZEZvb3RlckV4Y2VlZC10bXBsIjogZnVuY3Rpb24gbW9udGhHcmlkRm9vdGVyRXhjZWVkVG1wbChlKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9LAogICAgICAibW9udGhEYXluYW1lLXRtcGwiOiBmdW5jdGlvbiBtb250aERheW5hbWVUbXBsKGUpIHsKICAgICAgICByZXR1cm4gZS5sYWJlbDsKICAgICAgfSwKICAgICAgIndlZWtEYXluYW1lLXRtcGwiOiBmdW5jdGlvbiB3ZWVrRGF5bmFtZVRtcGwoZSkgewogICAgICAgIHZhciB0ID0gci5jbGFzc25hbWUoImRheW5hbWUtZGF0ZSIpLAogICAgICAgICAgICBuID0gci5jbGFzc25hbWUoImRheW5hbWUtbmFtZSIpOwogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyB0ICsgJyI+JyArIGUuZGF0ZSArICc8L3NwYW4+Jm5ic3A7Jm5ic3A7PHNwYW4gY2xhc3M9IicgKyBuICsgJyI+JyArIGUuZGF5TmFtZSArICI8L3NwYW4+IjsKICAgICAgfSwKICAgICAgIndlZWtHcmlkRm9vdGVyRXhjZWVkLXRtcGwiOiBmdW5jdGlvbiB3ZWVrR3JpZEZvb3RlckV4Y2VlZFRtcGwoZSkgewogICAgICAgIHJldHVybiAiKyIgKyBlOwogICAgICB9LAogICAgICAiZGF5R3JpZFRpdGxlLXRtcGwiOiBmdW5jdGlvbiBkYXlHcmlkVGl0bGVUbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IG8uaGVscGVyc1tlICsgIlRpdGxlLXRtcGwiXTsKICAgICAgICByZXR1cm4gdCA/IHQoZSkgOiBlOwogICAgICB9LAogICAgICAic2NoZWR1bGUtdG1wbCI6IGZ1bmN0aW9uIHNjaGVkdWxlVG1wbChlKSB7CiAgICAgICAgdmFyIHQgPSBvLmhlbHBlcnNbZS5jYXRlZ29yeSArICItdG1wbCJdOwogICAgICAgIHJldHVybiB0ID8gdChlKSA6ICIiOwogICAgICB9LAogICAgICAiY29sbGFwc2VCdG5UaXRsZS10bXBsIjogZnVuY3Rpb24gY29sbGFwc2VCdG5UaXRsZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHIuY2xhc3NuYW1lKCJpY29uIikgKyAiICIgKyByLmNsYXNzbmFtZSgiaWMtYXJyb3ctc29saWQtdG9wIikgKyAnIj48L3NwYW4+JzsKICAgICAgfSwKICAgICAgInRpbWV6b25lRGlzcGxheUxhYmVsLXRtcGwiOiBmdW5jdGlvbiB0aW1lem9uZURpc3BsYXlMYWJlbFRtcGwoZSwgdCkgewogICAgICAgIHZhciBuLCBvLCBhOwogICAgICAgIHJldHVybiBsLmlzVW5kZWZpbmVkKHQpICYmIChuID0gZSA8IDAgPyAiLSIgOiAiKyIsIG8gPSBNYXRoLmFicyhwYXJzZUludChlIC8gNjAsIDEwKSksIGEgPSBNYXRoLmFicyhlICUgNjApLCB0ID0gbiArIGkubGVhZGluZ1plcm8obywgMikgKyAiOiIgKyBpLmxlYWRpbmdaZXJvKGEsIDIpKSwgdDsKICAgICAgfSwKICAgICAgInRpbWVncmlkRGlzcGxheVByaW1heVRpbWUtdG1wbCI6IGZ1bmN0aW9uIHRpbWVncmlkRGlzcGxheVByaW1heVRpbWVUbXBsKGUpIHsKICAgICAgICByZXR1cm4gby5oZWxwZXJzWyJ0aW1lZ3JpZERpc3BsYXlQcmltYXJ5VGltZS10bXBsIl0oZSk7CiAgICAgIH0sCiAgICAgICJ0aW1lZ3JpZERpc3BsYXlQcmltYXJ5VGltZS10bXBsIjogZnVuY3Rpb24gdGltZWdyaWREaXNwbGF5UHJpbWFyeVRpbWVUbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IGUuaG91ciwKICAgICAgICAgICAgbiA9IHQgPj0gMTIgPyAicG0iIDogImFtIjsKICAgICAgICByZXR1cm4gdCA+IDEyICYmICh0IC09IDEyKSwgdCArICIgIiArIG47CiAgICAgIH0sCiAgICAgICJ0aW1lZ3JpZERpc3BsYXlUaW1lLXRtcGwiOiBmdW5jdGlvbiB0aW1lZ3JpZERpc3BsYXlUaW1lVG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGkubGVhZGluZ1plcm8oZS5ob3VyLCAyKSArICI6IiArIGkubGVhZGluZ1plcm8oZS5taW51dGVzLCAyKTsKICAgICAgfSwKICAgICAgInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCI6IGZ1bmN0aW9uIHRpbWVncmlkQ3VycmVudFRpbWVUbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IFtdOwogICAgICAgIHJldHVybiBlLmRhdGVEaWZmZXJlbmNlICYmIHQucHVzaCgiWyIgKyBlLmRhdGVEaWZmZXJlbmNlU2lnbiArIGUuZGF0ZURpZmZlcmVuY2UgKyAiXTxicj4iKSwgdC5wdXNoKGkuZm9ybWF0KGUuaG91cm1hcmtlciwgIkhIOm1tIikpLCB0LmpvaW4oIiIpOwogICAgICB9LAogICAgICAicG9wdXBJc0FsbERheS10bXBsIjogZnVuY3Rpb24gcG9wdXBJc0FsbERheVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJBbGwgZGF5IjsKICAgICAgfSwKICAgICAgInBvcHVwU3RhdGVGcmVlLXRtcGwiOiBmdW5jdGlvbiBwb3B1cFN0YXRlRnJlZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJGcmVlIjsKICAgICAgfSwKICAgICAgInBvcHVwU3RhdGVCdXN5LXRtcGwiOiBmdW5jdGlvbiBwb3B1cFN0YXRlQnVzeVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJCdXN5IjsKICAgICAgfSwKICAgICAgInRpdGxlUGxhY2Vob2xkZXItdG1wbCI6IGZ1bmN0aW9uIHRpdGxlUGxhY2Vob2xkZXJUbXBsKCkgewogICAgICAgIHJldHVybiAiU3ViamVjdCI7CiAgICAgIH0sCiAgICAgICJsb2NhdGlvblBsYWNlaG9sZGVyLXRtcGwiOiBmdW5jdGlvbiBsb2NhdGlvblBsYWNlaG9sZGVyVG1wbCgpIHsKICAgICAgICByZXR1cm4gIkxvY2F0aW9uIjsKICAgICAgfSwKICAgICAgInN0YXJ0RGF0ZVBsYWNlaG9sZGVyLXRtcGwiOiBmdW5jdGlvbiBzdGFydERhdGVQbGFjZWhvbGRlclRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJTdGFydCBkYXRlIjsKICAgICAgfSwKICAgICAgImVuZERhdGVQbGFjZWhvbGRlci10bXBsIjogZnVuY3Rpb24gZW5kRGF0ZVBsYWNlaG9sZGVyVG1wbCgpIHsKICAgICAgICByZXR1cm4gIkVuZCBkYXRlIjsKICAgICAgfSwKICAgICAgInBvcHVwU2F2ZS10bXBsIjogZnVuY3Rpb24gcG9wdXBTYXZlVG1wbCgpIHsKICAgICAgICByZXR1cm4gIlNhdmUiOwogICAgICB9LAogICAgICAicG9wdXBVcGRhdGUtdG1wbCI6IGZ1bmN0aW9uIHBvcHVwVXBkYXRlVG1wbCgpIHsKICAgICAgICByZXR1cm4gIlVwZGF0ZSI7CiAgICAgIH0sCiAgICAgICJwb3B1cERldGFpbERhdGUtdG1wbCI6IGZ1bmN0aW9uIHBvcHVwRGV0YWlsRGF0ZVRtcGwoZSwgdCwgbikgewogICAgICAgIHZhciBsID0gaS5pc1NhbWVEYXRlKHQsIG4pLAogICAgICAgICAgICBvID0gKGwgPyAiIiA6ICJZWVlZLk1NLkREICIpICsgImhoOm1tIHR0IjsKICAgICAgICByZXR1cm4gZSA/IGkuZm9ybWF0KHQsICJZWVlZLk1NLkREIikgKyAobCA/ICIiIDogIiAtICIgKyBpLmZvcm1hdChuLCAiWVlZWS5NTS5ERCIpKSA6IGkuZm9ybWF0KHQsICJZWVlZLk1NLkREIGhoOm1tIHR0IikgKyAiIC0gIiArIGkuZm9ybWF0KG4sIG8pOwogICAgICB9LAogICAgICAicG9wdXBEZXRhaWxMb2NhdGlvbi10bXBsIjogZnVuY3Rpb24gcG9wdXBEZXRhaWxMb2NhdGlvblRtcGwoZSkgewogICAgICAgIHJldHVybiBlLmxvY2F0aW9uOwogICAgICB9LAogICAgICAicG9wdXBEZXRhaWxVc2VyLXRtcGwiOiBmdW5jdGlvbiBwb3B1cERldGFpbFVzZXJUbXBsKGUpIHsKICAgICAgICByZXR1cm4gKGUuYXR0ZW5kZWVzIHx8IFtdKS5qb2luKCIsICIpOwogICAgICB9LAogICAgICAicG9wdXBEZXRhaWxTdGF0ZS10bXBsIjogZnVuY3Rpb24gcG9wdXBEZXRhaWxTdGF0ZVRtcGwoZSkgewogICAgICAgIHJldHVybiBlLnN0YXRlIHx8ICJCdXN5IjsKICAgICAgfSwKICAgICAgInBvcHVwRGV0YWlsUmVwZWF0LXRtcGwiOiBmdW5jdGlvbiBwb3B1cERldGFpbFJlcGVhdFRtcGwoZSkgewogICAgICAgIHJldHVybiBlLnJlY3VycmVuY2VSdWxlOwogICAgICB9LAogICAgICAicG9wdXBEZXRhaWxCb2R5LXRtcGwiOiBmdW5jdGlvbiBwb3B1cERldGFpbEJvZHlUbXBsKGUpIHsKICAgICAgICByZXR1cm4gZS5ib2R5OwogICAgICB9LAogICAgICAicG9wdXBFZGl0LXRtcGwiOiBmdW5jdGlvbiBwb3B1cEVkaXRUbXBsKCkgewogICAgICAgIHJldHVybiAiRWRpdCI7CiAgICAgIH0sCiAgICAgICJwb3B1cERlbGV0ZS10bXBsIjogZnVuY3Rpb24gcG9wdXBEZWxldGVUbXBsKCkgewogICAgICAgIHJldHVybiAiRGVsZXRlIjsKICAgICAgfSwKICAgICAgInRpdGxlQXZhdGFyLXRtcGwiOiBmdW5jdGlvbiB0aXRsZUF2YXRhclRtcGwoZSkgewogICAgICAgIHJldHVybiBlLnNwbGl0KCIgIikuc2xpY2UoMCwgMSkubWFwKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZS5jaGFyQXQoMCk7CiAgICAgICAgfSkuam9pbigiIikudG9VcHBlckNhc2UoKTsKICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiB1KGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIG4gPSBuIHx8ICIiLCBsLmlzTnVtYmVyKGUpID8gbiArICI6IiArIGUgKyB0IDogbiArICI6YXV0byI7CiAgICB9CgogICAgZnVuY3Rpb24gZChlLCB0KSB7CiAgICAgIGZvciAodmFyIG4sIGwgPSAwLCBvID0gMCwgaSA9IHQubGVuZ3RoOyBvIDwgZS53aWR0aDsgbyArPSAxKSB7CiAgICAgICAgbiA9IChlLmxlZnQgKyBvKSAlIGksIChuICs9IHBhcnNlSW50KChlLmxlZnQgKyBvKSAvIGksIDEwKSkgPCBpICYmIChsICs9IHRbbl0gPyB0W25dLndpZHRoIDogMCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBsOwogICAgfQoKICAgIG8ucmVnaXN0ZXJIZWxwZXIoYyk7CiAgfV0pOwp9KTs="},null]}