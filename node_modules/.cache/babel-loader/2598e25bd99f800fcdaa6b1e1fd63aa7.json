{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue","mtime":1661252053823},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvaG9tZS92aW1hbGVzaC9DRU5TRS9jaGF0Ym90LXBvcnRhbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgeyBidXMgfSBmcm9tICJAL3BvcnRhbC9tYWluIjsKaW1wb3J0IENvdW50cmllcyBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0NvdW50cmllcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IGZpbmdlcnByaW50IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvZmluZ2VycHJpbnQiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCB7IHN0cmluZ1R5cGVBbm5vdGF0aW9uIH0gZnJvbSAiQGJhYmVsL3R5cGVzIjsKaW1wb3J0IHsgc3RyaW5naWZ5IH0gZnJvbSAicXVlcnlzdHJpbmciOwppbXBvcnQgeyBTb2NrZXQgfSBmcm9tICJwaG9lbml4LXNvY2tldCI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwppbXBvcnQgVnVlUGhvbmVOdW1iZXJJbnB1dCBmcm9tICJ2dWUtcGhvbmUtbnVtYmVyLWlucHV0IjsKaW1wb3J0ICJ2dWUtcGhvbmUtbnVtYmVyLWlucHV0L2Rpc3QvdnVlLXBob25lLW51bWJlci1pbnB1dC5jc3MiOwppbXBvcnQgUGFzc3dvcmRWYWxpZGF0b3IgZnJvbSAiLi4vUGFnZXMvUGFzc3dvcmRWYWxpZGF0b3IudnVlIjsKaW1wb3J0IHBhZ2VfZ3VpZGUgZnJvbSAiQC9wb3J0YWwvbWl4aW5zL3BhZ2VfZ3VpZGUuanMiOwppbXBvcnQgcGF0aCBmcm9tICJwYXRoIjsKZXhwb3J0IGRlZmF1bHQgewogIGJlZm9yZVJvdXRlRW50ZXI6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlRW50ZXIodG8sIGZyb20sIG5leHQpIHsKICAgIGNvbnNvbGUubG9nKCdXZWxjb21lIHRvIHRoZSBzd2FtcCEnKTsKICAgIG5leHQoKTsKICB9LAogIG1peGluczogW3BhZ2VfZ3VpZGVdLAogIHByb3BzOiBbInRpdGxlIl0sCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0LAogICAgVnVlUGhvbmVOdW1iZXJJbnB1dDogVnVlUGhvbmVOdW1iZXJJbnB1dCwKICAgIFBhc3N3b3JkVmFsaWRhdG9yOiBQYXNzd29yZFZhbGlkYXRvcgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzX29wZW46IHRydWUsCiAgICAgIGludGVudF9kYXRhOiBudWxsLAogICAgICBjYWxsZGF0YTogIiIsCiAgICAgIG5ld19wYXNzd29yZDogIiIsCiAgICAgIG9sZF9wYXNzd29yZDogIiIsCiAgICAgIGNvbmZpcm1fcGFzc3dvcmQ6ICIiLAogICAgICBjb3JyZWN0X3Bhc3N3b3JkOiBmYWxzZSwKICAgICAgY29tcGFueV9uYW1lOiBudWxsLAogICAgICBjb21wYW55X2lkX3NlbGVjdGVkOiBudWxsLAogICAgICBjb21wYW5pZXM6IFtdLAogICAgICBjb3VudHJ5X2xpc3Q6IG51bGwsCiAgICAgIGNvbXBhbnlfaWQ6IFtdLAogICAgICB1c2VyX2NvbXBhbnk6IG51bGwsCiAgICAgIHRpY2tldHNfYmFyX2FjY2VzczogZmFsc2UsCiAgICAgIGludml0ZV9jb21wYW55X2VtYWlsOiBudWxsLAogICAgICBpbnZpdGVfY29tcGFueV9uYW1lOiBudWxsLAogICAgICBvbGRfZmlsZV9uYW1lOiBudWxsLAogICAgICBmaWxlX2xhYmVsOiAiQ2hvb3NlIGZpbGUiLAogICAgICBpc3N1ZTogIiIsCiAgICAgIGlzc3VlX2Rlc2NyaXB0aW9uOiAiIiwKICAgICAgaW1nX2ZpbGU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBwaG90b19pbWdfdXJsOiAiIiwKICAgICAgZXhpc3RpbmdfZmlsZV9uYW1lOiBudWxsLAogICAgICB1c2VyX2NvdW50cnlfbmFtZTogewogICAgICAgIGNvZGU6ICIiLAogICAgICAgIG5hbWU6ICIiCiAgICAgIH0sCiAgICAgIHVzZXJfcGhvbmVfbnVtYmVyOiB0aGlzLiRzZXNzaW9uLmhhcygiUGhvbmVOdW1iZXIiKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJQaG9uZU51bWJlciIpIDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnBob25lX25vIDogIiIsCiAgICAgIHVzZXJfZmlyc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJGaXJzdE5hbWUiKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VyRmlyc3ROYW1lIikgOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZmlyc3RfbmFtZSA6ICIiLAogICAgICB1c2VyX2xhc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJMYXN0TmFtZSIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJMYXN0TmFtZSIpIDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxhc3RfbmFtZSA6ICIiLAogICAgICBjb21wYW55X3NlbGVjdGVkOiB0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueU5hbWUiKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpIDogIlNlbGVjdCBBIENvbXBhbnkiLAogICAgICB1c2VyX2NvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSA6ICIiLAogICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsIDogIiIsCiAgICAgIHVzZXJfY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQgOiAiIiwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA6ICIiLAogICAgICB1c2VyX3R5cGU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yZWdpc3RyYXRpb25fdHlwZSA6ICIiLAogICAgICBwaG9uZV9udW1iZXJfdmFsaWRpdHk6IC9cK1swLTldezksMTR9JC8sCiAgICAgIHJlZ19wd2Q6IC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXGQpKD89LipbI0AkISUqPyZdKVtBLVphLXpcZCNAJCElKj8mXXs4LH0vLAogICAgICByZWdfZW1haWw6IC9eKFswLTlhLXpBLVpdKFstLlx3XSpbMC05YS16QS1aXSkqQChbMC05YS16QS1aXVstXHddKlswLTlhLXpBLVpdXC4pK1thLXpBLVpdezIsOX0pJC8sCiAgICAgIG5vdGlmaWNhdGlvbnM6IFtdLAogICAgICB0b19zaG93X25vdGlmaWNhdGlvbnM6IGZhbHNlLAogICAgICBzb2NrZXQ6IG51bGwsCiAgICAgIHNjaGVkdWxlcl9jaGFubmVsOiBudWxsLAogICAgICB0cmFpbmluZ19jaGFubmVsOiBudWxsLAogICAgICBwaG9uZU51bWJlcjogbnVsbCwKICAgICAgdG91cl9ndWlkZV9pY29uOiByZXF1aXJlKCJAL3BvcnRhbC9hc3NldHMvaW1nL2luZm9faWNvbi5zdmciKSwKICAgICAgZGlzYWJsZV9uYXZiYXI6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZhbGlkT2xkUGFzc3dvcmQ6IGZ1bmN0aW9uIHZhbGlkT2xkUGFzc3dvcmQoKSB7CiAgICAgIGlmICh0aGlzLnJlZ19wd2QudGVzdCh0aGlzLm9sZF9wYXNzd29yZCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMudGx0KCdpbnZhbGlkX3Bhc3N3b3JkJykpOwogICAgICB9CiAgICB9LAogICAgdmFsaWRQYXNzd29yZDogZnVuY3Rpb24gdmFsaWRQYXNzd29yZCgpIHsKICAgICAgaWYgKHRoaXMucmVnX3B3ZC50ZXN0KHRoaXMubmV3X3Bhc3N3b3JkKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIi5jb25jYXQodGhpcy50bHQoJ2ludmFsaWRfcGFzc3dvcmQnKSk7CiAgICAgIH0KICAgIH0sCiAgICB2YWxpZENvbmZpcm1QYXNzd29yZDogZnVuY3Rpb24gdmFsaWRDb25maXJtUGFzc3dvcmQoKSB7CiAgICAgIGlmICh0aGlzLmNvbmZpcm1fcGFzc3dvcmQgPT0gdGhpcy5uZXdfcGFzc3dvcmQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMudGx0KCdwYXNzX25vX21hdGNoJykpOwogICAgICB9CiAgICB9LAogICAgLy8gdmFsaWRQaG9uZU51bWJlcigpIHsKICAgIC8vICAgaWYgKAogICAgLy8gICAgIHRoaXMucGhvbmVfbnVtYmVyX3ZhbGlkaXR5LnRlc3QoCiAgICAvLyAgICAgICB0aGlzLnVzZXJfcGhvbmVfbnVtYmVyLnJlcGxhY2UoL1xzKy9nLCAiIikKICAgIC8vICAgICApCiAgICAvLyAgICkgewogICAgLy8gICAgIHJldHVybiB0cnVlOwogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyIGluIHRoZSBmb3JtYXQ6ICtDb3VudHJ5Q29kZSBOdW1iZXIiOwogICAgLy8gICB9CiAgICAvLyB9LAogICAgdW5zZWVuX25vdGlmaWNhdGlvbnM6IGZ1bmN0aW9uIHVuc2Vlbl9ub3RpZmljYXRpb25zKCkgewogICAgICB2YXIgY291bnQgPSAwOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIXRoaXMubm90aWZpY2F0aW9uc1tpXS5pc19jbGVhcikgewogICAgICAgICAgY291bnQrKzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBjb3VudDsKICAgIH0KICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuY291bnRyeV9saXN0ID0gQ291bnRyaWVzOwoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygicGhvdG9faW1nX3VybCIpKSB7CiAgICAgIHRoaXMucGhvdG9faW1nX3VybCA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJwaG90b19pbWdfdXJsIikgOiAiIjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucGhvdG9faW1nX3VybCA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5waG90b19pbWdfdXJsIDogIiI7CiAgICB9CgogICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKSAmJiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikpIHsKICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlID0gdGhpcy4kc2Vzc2lvbi5nZXQoImNvdW50cnlfbmFtZSIpOwogICAgICB2YXIgc2VsZWN0X2NvdW50cnkgPSB0aGlzLmNvdW50cnlfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGNvdW50cnkpIHsKICAgICAgICByZXR1cm4gY291bnRyeS5jb2RlID09IF90aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGU7CiAgICAgIH0pOwogICAgICB0aGlzLnVzZXJfY291bnRyeV9uYW1lLm5hbWUgPSBzZWxlY3RfY291bnRyeVswXS5uYW1lOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlID0gdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZSA6ICIiOwoKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb3VudHJ5X25hbWUgPT0gbnVsbCkgewogICAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZSA9ICIiOwogICAgICB9CgogICAgICBpZiAodGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgX3NlbGVjdF9jb3VudHJ5ID0gdGhpcy5jb3VudHJ5X2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChjb3VudHJ5KSB7CiAgICAgICAgICByZXR1cm4gY291bnRyeS5jb2RlID09IF90aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGU7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUubmFtZSA9IF9zZWxlY3RfY291bnRyeVswXSA9PT0gdW5kZWZpbmVkID8gIiIgOiBfc2VsZWN0X2NvdW50cnlbMF0ubmFtZTsKICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueV9zZWxlY3RlZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUgOiAiIjsKICAgIH0KCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNvbXBhbnlfbGlzdF91cmwoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzLmNvbXBhbmllcyA9IHJlc3BvbnNlLmRhdGEuZGF0YVswXTsKICAgICAgICBfdGhpcy5jb21wYW55X2lkID0gcmVzcG9uc2UuZGF0YS5kYXRhWzFdOwogICAgICB9KTsKICAgIH0KCiAgICBpZiAodGhpcy51c2VyX2ZpcnN0X25hbWUgPT0gbnVsbCB8fCB0aGlzLnVzZXJfZmlyc3RfbmFtZSA9PSAiIikgewogICAgICB0aGlzLnVzZXJfZmlyc3RfbmFtZSA9ICJGaXJzdCI7CiAgICAgIHRoaXMudXNlcl9sYXN0X25hbWUgPSAiTGFzdCI7CiAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJVc2VyRmlyc3ROYW1lIiwgdGhpcy51c2VyX2ZpcnN0X25hbWUpOwogICAgICB0aGlzLiRzZXNzaW9uLnNldCgiVXNlckxhc3ROYW1lIiwgdGhpcy51c2VyX2xhc3RfbmFtZSk7CiAgICB9CgogICAgdmFyIG1lbnVzID0gdGhpcy4kc2Vzc2lvbi5oYXMoIkNoYXRib3RNZW51IikgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKSA6IFtdOwogICAgdmFyIHRpY2tldF9hY2Nlc3MgPSBtZW51cy5maWx0ZXIoZnVuY3Rpb24gKG1lbnUpIHsKICAgICAgcmV0dXJuIG1lbnUubWFpbl9tZW51Lm5hbWUgPT0gIlRpY2tldHMiOwogICAgfSk7CgogICAgaWYgKHRpY2tldF9hY2Nlc3MubGVuZ3RoID09IDApIHsKICAgICAgdGhpcy50aWNrZXRzX2Jhcl9hY2Nlc3MgPSBmYWxzZTsKICAgIH0gZWxzZSBpZiAodGlja2V0X2FjY2Vzcy5sZW5ndGggPT0gMSkgewogICAgICB0aGlzLnRpY2tldHNfYmFyX2FjY2VzcyA9IHRydWU7CiAgICB9CgogICAgdmFyIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gZmFsc2U7CgogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBtZW51cy5sZW5ndGg7IGkgPCBuOyBpICs9IDEpIHsKICAgICAgZm9yICh2YXIgaiA9IDAsIGwgPSBtZW51c1tpXS5zdWJfbWVudV9saXN0Lmxlbmd0aDsgaiA8IGw7IGogKz0gMSkgewogICAgICAgIGlmIChtZW51c1tpXS5zdWJfbWVudV9saXN0W2pdLm5hbWUgPT0gIlNjaGVkdWxlciIpIHsKICAgICAgICAgIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHRoaXMuc29ja2V0ID0gbmV3IFNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX1BVU0hfTk9USUZJQ0FUSU9OU19XRUJTT0NLRVRfRU5EUE9JTlQsIHsKICAgICAgcGFyYW1zOiB7CiAgICAgICAgbm90aWZpY2F0aW9uX3Rlc3Q6IHRydWUKICAgICAgfQogICAgfSk7CiAgICB0aGlzLnNvY2tldC5jb25uZWN0KCk7CgogICAgaWYgKEJvb2xlYW4obm90aWZpY2F0aW9uc19hY2Nlc3MpKSB7CiAgICAgIHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zID0gdHJ1ZTsgLy9Ob3RpZmljYXRpb24KCiAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwgPSB0aGlzLnNvY2tldC5jaGFubmVsKCJub3RpZmljYXRpb25fY2hhbm5lbDoiICsgdGhpcy51c2VyX2NvbXBhbnlfaWQpOwogICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmpvaW4oKTsKICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vbigic2hvd19ub3RpZmljYXRpb25zIiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmlzX3Jlc3BvbnNlKSB7CiAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9uID0gcmVzcG9uc2UuZGF0YS5sZW5ndGg7IF9pIDwgX247IF9pKyspIHsKICAgICAgICAgICAgX3RoaXMubm90aWZpY2F0aW9ucy5wdXNoKHJlc3BvbnNlLmRhdGFbX2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF90aGlzLnNjaGVkdWxlcl9jaGFubmVsLm9mZigic2hvd19ub3RpZmljYXRpb25zIik7CiAgICAgIH0pOwogICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLm9uKCJuZXdfbm90aWZpY2F0aW9uIiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMuc2hvd19ub3RpZmljYXRpb25zKHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICBfdGhpcy5ub3RpZmljYXRpb25zLnVuc2hpZnQocmVzcG9uc2UuZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLnB1c2goInNob3dfbm90aWZpY2F0aW9ucyIsIHsKICAgICAgICBuZWVkX25vdGlmaWNhdGlvbnM6IHRydWUsCiAgICAgICAgZW1haWxfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICB9KTsKICAgIH0KCiAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwgPSB0aGlzLnNvY2tldC5jaGFubmVsKCJ0cmFpbmluZ19ub3RpZmljYXRpb25fY2hhbm5lbDoiICsgdGhpcy51c2VyX2NvbXBhbnlfaWQpOwogICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmpvaW4oKTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5vbigic2hvd19ub3RpZmljYXRpb25zIiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGlmIChyZXNwb25zZS5pc19yZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHZhciBfaTIgPSAwLCBfbjIgPSByZXNwb25zZS5kYXRhLmxlbmd0aDsgX2kyIDwgX24yOyBfaTIrKykgewogICAgICAgICAgX3RoaXMubm90aWZpY2F0aW9ucy5wdXNoKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICBkYXRlOiBtb21lbnQocmVzcG9uc2UuZGF0YVtfaTJdLkluaXRpYXRlZE9uLCBbIllZWVktTU0tREQiXSkuZm9ybWF0KCJEbyBNTU0gWVlZWSIpCiAgICAgICAgICB9LCByZXNwb25zZS5kYXRhW19pMl0pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIF90aGlzLnRyYWluaW5nX2NoYW5uZWwub2ZmKCJzaG93X25vdGlmaWNhdGlvbnMiKTsKICAgIH0pOwogICAgdGhpcy50cmFpbmluZ19jaGFubmVsLm9uKCJuZXdfbm90aWZpY2F0aW9uIiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIF90aGlzLnNob3dfbm90aWZpY2F0aW9ucyhyZXNwb25zZS5kYXRhKTsKCiAgICAgIF90aGlzLm5vdGlmaWNhdGlvbnMudW5zaGlmdChfb2JqZWN0U3ByZWFkKHsKICAgICAgICBkYXRlOiBtb21lbnQocmVzcG9uc2UuZGF0YS5Jbml0aWF0ZWRPbiwgWyJZWVlZLU1NLUREIl0pLmZvcm1hdCgiRG8gTU1NIFlZWVkiKQogICAgICB9LCByZXNwb25zZS5kYXRhKSk7CiAgICB9KTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAgIG5lZWRfbm90aWZpY2F0aW9uczogdHJ1ZSwKICAgICAgZW1haWxfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgfSk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgYnVzLiRvbigiTGF5b3V0SGVscERhdGEiLCBmdW5jdGlvbiAoZGF0YVBnKSB7CiAgICAgIF90aGlzMi5jYWxsZGF0YSA9IGRhdGFQZzsKICAgIH0pOyAvLyBidXMuJG9uKCdUYWJzTGF5b3V0SW5mbycsKGRhdGFGb3J0YWJzKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFGb3J0YWJzLCJkYXRhIG9mIHRhYiBwYW5lIik7CiAgICAvLyAgICAgICAgIHRoaXMuY2FsbGRhdGEgPSBkYXRhRm9ydGFiczsKICAgIC8vIH0pCgogICAgYnVzLiRvbigic2VuZCBjb21wYW55IGF0dHJpYnV0ZXMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGJ1cy4kZW1pdCgiY29tcGFueSBuYW1lIGFuZCBjb21wYW55IGlkIiwgX3RoaXMyLmNvbXBhbnlfbmFtZSwgX3RoaXMyLmNvbXBhbnlfaWRfc2VsZWN0ZWQpOwogICAgfSk7IC8vIHJlZnJlc2hQb3BvdmVyKCk7CgogICAgdGhpcy4kcm9vdC4kb24oInNpZ25fb3V0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpczIuc2lnbm91dF9hcGkoKTsKICAgIH0pOwogICAgJCgiLmRyb3Bkb3duLXRvZ2dsZSIpLmRyb3Bkb3duKCk7CgogICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJTZXR0aW5nVG9wbmF2YmFyRGlzYWJsZSIpID09IHRydWUpIHsKICAgICAgdGhpcy5kaXNhYmxlX25hdmJhciA9IHRydWU7CiAgICB9CgogICAgdGhpcy4kcm9vdC4kb24oIkRhc2hib2FyZFNpZGViYXJEaXNhYmxlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHsKICAgICAgICBfdGhpczIuZGlzYWJsZV9uYXZiYXIgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzMi5kaXNhYmxlX25hdmJhciA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKICB9LAogIC8vU2VlIHRvbQogIG1ldGhvZHM6IHsKICAgIGxpc3Rlbl9kYXRhOiBmdW5jdGlvbiBsaXN0ZW5fZGF0YSgpIHsKICAgICAgdGhpcy5jYWxsZGF0YSA9IHRoaXMuJHJvdXRlLnBhdGg7IC8vdGhpcy5jb21wX25hbWUgPSB0aGlzLiRyb3V0ZS5uYW1lOwogICAgICAvLyBFbWl0dGluZyBhIGN1c3RvbS1ldmVudCB2aWEgdGhlIEV2ZW50IEJ1cwoKICAgICAgYnVzLiRlbWl0KCJFbWl0dGluZ19kYXRhIiwgdGhpcy5jYWxsZGF0YSk7CiAgICB9LAogICAgY2hlY2tfcGFzc3dvcmQ6IGZ1bmN0aW9uIGNoZWNrX3Bhc3N3b3JkKGNvcnJlY3RQYXNzd29yZCkgewogICAgICB0aGlzLmNvcnJlY3RfcGFzc3dvcmQgPSBjb3JyZWN0UGFzc3dvcmQ7CiAgICB9LAogICAgZWRpdEltYWdlOiBmdW5jdGlvbiBlZGl0SW1hZ2UoZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBpbWFnZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW1hZ2UpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMzLnByZXZpZXdJbWFnZSA9IGUudGFyZ2V0LnJlc3VsdDsKCiAgICAgICAgaWYgKF90aGlzMy5waG90b19pbWdfdXJsKSB7CiAgICAgICAgICBfdGhpczMuZXhpc3RpbmdfZmlsZV9uYW1lID0gX3RoaXMzLnBob3RvX2ltZ191cmwuc3BsaXQoIi8iKVs0XTsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmVkaXRfcHJvZmlsZV91cmwoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHVwbG9hZF9waG90bzogIlRydWUiLAogICAgICAgICAgcHJvZmlsZV9pbWFnZTogX3RoaXMzLnByZXZpZXdJbWFnZS5zcGxpdCgiYmFzZTY0LCIpWzFdLAogICAgICAgICAgZmlsZV9uYW1lOiBpbWFnZS5uYW1lLAogICAgICAgICAgZXhpc3RpbmdfZmlsZV9uYW1lOiBfdGhpczMuZXhpc3RpbmdfZmlsZV9uYW1lCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5QSE9UT19VUExPQUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiIi5jb25jYXQoX3RoaXMzLnRsdCgncGhvdG9fdXBsb2FkZWRfc3VjY2Vzc2Z1bGx5JykpKTsKCiAgICAgICAgICAgIF90aGlzMy4kc2Vzc2lvbi5zZXQoInBob3RvX2ltZ191cmwiLCByZXNwb25zZS5kYXRhLkltYWdlVXJsKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgIH0sIDUwMDApOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKCIiLmNvbmNhdChfdGhpczMudGx0KCd0b2FzdGVyX2ZpbGVfbmFtZV9hbHJlYWR5X2V4aXN0cycpKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9LAogICAgY3JlYXRlSW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNC5ibG9nLmltZ19maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICByYWlzZV90aWNrZXQ6IGZ1bmN0aW9uIHJhaXNlX3RpY2tldCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09ICJUaWNrZXRzIikgewogICAgICAgICQoIiN0aWNrZXRtb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogIlRpY2tldHMiLAogICAgICAgICAgcHJvcHM6IHRydWUsCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgcmFpc2VfdGlja2V0OiAiVHJ1ZSIKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNsZWFyX2ZpZWxkczogZnVuY3Rpb24gY2xlYXJfZmllbGRzKCkgewogICAgICB0aGlzLmltZ19maWxlID0gIiI7CiAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICIiLmNvbmNhdCh0aGlzLnRsdCgnY2hvb3NlX2ZpbGUnKSk7CiAgICAgIHRoaXMuaXNzdWUgPSAiIjsKICAgICAgdGhpcy5pc3N1ZV9kZXNjcmlwdGlvbiA9ICIiOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgfSwKICAgIGVtYWlsX2NsYXNzOiBmdW5jdGlvbiBlbWFpbF9jbGFzcygpIHsKICAgICAgaWYgKHRoaXMucmVnX2VtYWlsLnRlc3QodGhpcy5pbnZpdGVfY29tcGFueV9lbWFpbCkpIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMudGx0KCdpc192YWxpZCcpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiIuY29uY2F0KHRoaXMudGx0KCdpc19pbnZhbGlkJykpOwogICAgICB9CiAgICB9LAogICAgZWRpdF9wcm9maWxlX2FwaTogZnVuY3Rpb24gZWRpdF9wcm9maWxlX2FwaSgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKCFCb29sZWFuKHRoaXMucGhvbmVOdW1iZXIpKSB7CiAgICAgICAgdG9hc3RyLndhcm5pbmcoIiIuY29uY2F0KHRoaXMudGx0KCdlbnRlcl92YWxpZF9waG9uZV9udW1iZXInKSkpOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBob25lTnVtYmVyLmlzVmFsaWQgIT0gdHJ1ZSkgewogICAgICAgIHRvYXN0ci53YXJuaW5nKCIiLmNvbmNhdCh0aGlzLnRsdCgnZW50ZXJfdmFsaWRfcGhvbmVfbnVtYmVyJykpKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUgIT0gbnVsbCAmJiB0aGlzLnVzZXJfZmlyc3RfbmFtZSAhPSAiIiAmJiB0aGlzLnVzZXJfZmlyc3RfbmFtZSAhPSAiRiIgJiYgdGhpcy51c2VyX2xhc3RfbmFtZSAhPSAiIiAmJiB0aGlzLnVzZXJfbGFzdF9uYW1lICE9ICJMIiAvL3RoaXMudmFsaWRQaG9uZU51bWJlciA9PT0gdHJ1ZQogICAgICApIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmVkaXRfcHJvZmlsZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZmlyc3RfbmFtZTogdGhpcy51c2VyX2ZpcnN0X25hbWUsCiAgICAgICAgICAgIGxhc3RfbmFtZTogdGhpcy51c2VyX2xhc3RfbmFtZSwKICAgICAgICAgICAgY291bnRyeV9uYW1lOiB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUsCiAgICAgICAgICAgIHBob25lX251bWJlcjogdGhpcy5waG9uZU51bWJlci5mb3JtYXR0ZWROdW1iZXIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuUFJPRklMRV9VUERBVEVELk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgLy8gU3dhbCh7CiAgICAgICAgICAgICAgLy8gICAgIHRpdGxlOiAiVXBkYXRlZCBTdWNjZXNzZnVsbHkhISIsCiAgICAgICAgICAgICAgLy8gICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAvLyAgICAgdGV4dDogIllvdXIgcHJvZmlsZSBoYXMgYmVlbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4iLAogICAgICAgICAgICAgIC8vICAgICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIiIuY29uY2F0KF90aGlzNS50bHQoJ3Byb2ZpbGVfdXBkYXRlZF9zdWNjZXNzZnVsbHknKSkpOwoKICAgICAgICAgICAgICBfdGhpczUuJHNlc3Npb24uc2V0KCJVc2VyRmlyc3ROYW1lIiwgX3RoaXM1LnVzZXJfZmlyc3RfbmFtZSk7CgogICAgICAgICAgICAgIF90aGlzNS4kc2Vzc2lvbi5zZXQoIlVzZXJMYXN0TmFtZSIsIF90aGlzNS51c2VyX2xhc3RfbmFtZSk7CgogICAgICAgICAgICAgIF90aGlzNS4kc2Vzc2lvbi5zZXQoImNvdW50cnlfbmFtZSIsIF90aGlzNS51c2VyX2NvdW50cnlfbmFtZS5jb2RlKTsKCiAgICAgICAgICAgICAgX3RoaXM1LiRzZXNzaW9uLnNldCgiUGhvbmVOdW1iZXIiLCBfdGhpczUucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyKTsKCiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczUuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJCgiI2VkaXRfcHJvZmlsZV9tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiIi5jb25jYXQodGhpcy50bHQoJ2VudGVyX2FsbF9yZXF1aXJlZF9maWVsZHMnKSkpOwogICAgICB9CiAgICB9LAogICAgY29tcGFueV9jaGFuZ2VkOiBmdW5jdGlvbiBjb21wYW55X2NoYW5nZWQoY29tcGFueSkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKGNvbXBhbnkgIT0gdGhpcy5jb21wYW55X3NlbGVjdGVkKSB7CiAgICAgICAgdGhpcy5jb21wYW55X3NlbGVjdGVkID0gY29tcGFueTsKCiAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55TmFtZSIpKSB7CiAgICAgICAgICB0aGlzLiRzZXNzaW9uLnJlbW92ZSgiQ29tcGFueU5hbWUiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJDb21wYW55TmFtZSIsIHRoaXMuY29tcGFueV9zZWxlY3RlZCk7CgogICAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICAgIHRoaXMuJHNlc3Npb24ucmVtb3ZlKCJDb21wYW55SWQiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJDb21wYW55SWQiLCB0aGlzLmNvbXBhbnlfaWRbdGhpcy5jb21wYW5pZXMuaW5kZXhPZih0aGlzLmNvbXBhbnlfc2VsZWN0ZWQpXSk7CiAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgIH0gZWxzZSB7fQogICAgfSwKICAgIHN1Ym1pdF9uZXdfcGFzc3dvcmQ6IGZ1bmN0aW9uIHN1Ym1pdF9uZXdfcGFzc3dvcmQoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICh0aGlzLm9sZF9wYXNzd29yZCAhPSAiIiAmJiB0aGlzLmNvcnJlY3RfcGFzc3dvcmQgPT0gdHJ1ZSAmJiB0aGlzLnZhbGlkQ29uZmlybVBhc3N3b3JkID09IHRydWUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgdGV4dDogIiIuY29uY2F0KHRoaXMudGx0KCd3YWl0X3doaWxlX3dlX3N1Ym1pdF9kZXRhaWxzJykpLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImluZm8iCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm5ld19wYXNzd29yZF91cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBvbGRfcGFzc3dvcmQ6IHRoaXMub2xkX3Bhc3N3b3JkLAogICAgICAgICAgbmV3X3Bhc3N3b3JkOiB0aGlzLm5ld19wYXNzd29yZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBkYXRlOiBkYXRlCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLlBBU1NXT1JEX0lOQ09SUkVDVF8xMDMxLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiIi5jb25jYXQoX3RoaXM2LnRsdCgnaW5jb3JyZWN0X3Bhc3N3b3JkJykpKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLlBBU1NXT1JEX1JFU0VUX1NVQ0NFU1NGVUxfMTAyOC5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiIi5jb25jYXQoX3RoaXM2LnRsdCgncGFzc3dvcmRfdXBkYXRlZF9zdWNjZXNzZnVsbHknKSkpOwogICAgICAgICAgICAkKCIjY2hhbmdlX3Bhc3N3b3JkX21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXM2LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLlBBU1NXT1JEX1NJTUlMQVIuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIiIuY29uY2F0KF90aGlzNi50bHQoJ2Nhbm5vdF9zZXRfb2xkX3Bhc3N3b3JkJykpLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuT0xEX1BBU1NXT1JEX05PVF9NQVRDSC5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiIi5jb25jYXQoX3RoaXM2LnRsdCgnb2xkX3Bhc3Nfbm9fbWF0Y2gnKSksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM2Lm9sZF9wYXNzd29yZCA9ICIiOwogICAgICAgICAgX3RoaXM2Lm5ld19wYXNzd29yZCA9ICIiOwogICAgICAgICAgX3RoaXM2LmNvbmZpcm1fcGFzc3dvcmQgPSAiIjsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIiIuY29uY2F0KHRoaXMudGx0KCdlbnRlcl9hbGxfcmVxdWlyZWRfZmllbGRzJykpKTsKICAgICAgfQogICAgfSwKICAgIHBhc3N3b3JkX3RvZ2dsZTogZnVuY3Rpb24gcGFzc3dvcmRfdG9nZ2xlKGlkKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCiAgICAgIGlmIChwYXNzd29yZC50eXBlID09ICJ0ZXh0IikgewogICAgICAgIHBhc3N3b3JkLnR5cGUgPSAicGFzc3dvcmQiOwogICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkLnR5cGUgPT0gInBhc3N3b3JkIikgewogICAgICAgIHBhc3N3b3JkLnR5cGUgPSAidGV4dCI7CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVfc3VwZXJhZG1pbjogZnVuY3Rpb24gdXBkYXRlX3N1cGVyYWRtaW4oZXZ0KSB7CiAgICAgIGlmIChldnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuY29tcGFueV9uYW1lID0gZXZ0OwogICAgICAgIHRoaXMuY29tcGFueV9pZF9zZWxlY3RlZCA9IHRoaXMuY29tcGFueV9pZFt0aGlzLmNvbXBhbmllcy5pbmRleE9mKGV2dCldOwogICAgICAgIGJ1cy4kZW1pdCgiY29tcGFueSBhdHRyaWJ1dGVzIHVwZGF0ZWQiLCAiVHJ1ZSIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9pbnZpdGU6IGZ1bmN0aW9uIHNlbmRfaW52aXRlKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5pbnZpdGVfY29tcGFueV9uYW1lID09ICIiKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCIiLmNvbmNhdCh0aGlzLnRsdCgnZW50ZXJfYWxsX3JlcXVpcmVkX2ZpZWxkcycpKSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWdfZW1haWwudGVzdCh0aGlzLmludml0ZV9jb21wYW55X2VtYWlsKSA9PSBmYWxzZSkgewogICAgICAgIHRvYXN0ci5lcnJvcigiIi5jb25jYXQodGhpcy50bHQoJ2VudGVyX3ZhbGlkX2VtYWlsJykpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5yZWZlcnJhbHNfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGludml0ZWRfY29tcGFueV9uYW1lOiB0aGlzLmludml0ZV9jb21wYW55X25hbWUsCiAgICAgICAgICBpbnZpdGVkX2NvbXBhbnlfZW1haWw6IHRoaXMuaW52aXRlX2NvbXBhbnlfZW1haWwKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuRU1BSUxfU0VOVF9TVUNDRVNTRlVMTFkuTVNHX0NPREUpIHsKICAgICAgICAgICAgYnVzLiRlbWl0KCJpbnZpdGVfdXBkYXRlIiwgImxvYWRlcl9vbiIpOwogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCIjaW52aXRlX21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIF90aGlzNy5pbnZpdGVfY29tcGFueV9uYW1lID0gIiI7CiAgICAgICAgICBfdGhpczcuaW52aXRlX2NvbXBhbnlfZW1haWwgPSAiIjsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNpZ25vdXRfYXBpOiBmdW5jdGlvbiBzaWdub3V0X2FwaSgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBidXMuJGVtaXQoIkxvZ291dCBoYXMgYmVlbiBjbGlja2VkIiwgIlRydWUiKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbGVhcl9hY2Nlc3NfdG9rZW5fdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM4LmV4ZWN1dGVfc2lnbm91dCgpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM4LmV4ZWN1dGVfc2lnbm91dCgpOwogICAgICB9KTsKICAgIH0sCiAgICBleGVjdXRlX3NpZ25vdXQ6IGZ1bmN0aW9uIGV4ZWN1dGVfc2lnbm91dCgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICB2YXIgaXNfc3VwZXJfYWRtaW4gPSB0aGlzLiRzZXNzaW9uLmdldCgiaXNfc3VwZXJfYWRtaW4iKTsKCiAgICAgIGlmIChpc19zdXBlcl9hZG1pbikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnN1cGVyX2FkbWluX2xvZ291dCgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoInJ0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5VU0VSX0xPR0dFRF9PVVRfMTAzMi5NU0dfQ09ERSB8fCByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5UT0tFTl9JTlZBTElEXzAwMDEuTVNHX0NPREUgfHwgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9DUkVERU5USUFMU18wMDA1Lk1TR19DT0RFKSB7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnN1cGVyX2FkbWluX2JvdF9sb2dvdXQoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM5LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzOS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzOS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHVzZXJuYW1lOiBfdGhpczkuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXM5LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChfdGhpczkudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgICBfdGhpczkuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzOS50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CgogICAgICAgICAgICAgIF90aGlzOS5zb2NrZXQuZGlzY29ubmVjdCgpOwoKICAgICAgICAgICAgICBfdGhpczkuJHNlc3Npb24uZGVzdHJveSgpOwoKICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgIGNsZWFyX2ludGVydmFsOiB0cnVlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKCiAgICAgICAgICAgICAgX3RoaXM5LiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM5LnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgX3RoaXM5LnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczkudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwoKICAgICAgICAgICAgICBfdGhpczkuc29ja2V0LmRpc2Nvbm5lY3QoKTsKCiAgICAgICAgICAgICAgX3RoaXM5LiRzZXNzaW9uLmRlc3Ryb3koKTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIkNsZWFyX1JlZnJlc2hfVG9rZW5fSW50ZXJ2YWwiLCB7CiAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CgogICAgICAgICAgICAgIF90aGlzOS4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnN1cGVyX2FkbWluX2JvdF9sb2dvdXQoKSwgewogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiBfdGhpczkuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueWlkOiBfdGhpczkuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczkuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB1c2VybmFtZTogX3RoaXM5LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzOS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM5LnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgX3RoaXM5LnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczkudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwoKICAgICAgICAgICAgICBfdGhpczkuc29ja2V0LmRpc2Nvbm5lY3QoKTsKCiAgICAgICAgICAgICAgX3RoaXM5LiRzZXNzaW9uLmRlc3Ryb3koKTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIkNsZWFyX1JlZnJlc2hfVG9rZW5fSW50ZXJ2YWwiLCB7CiAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CgogICAgICAgICAgICAgIF90aGlzOS4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzOS50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICAgIF90aGlzOS5zY2hlZHVsZXJfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM5LnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNvY2tldC5kaXNjb25uZWN0KCk7CgogICAgICAgICAgICAgIF90aGlzOS4kc2Vzc2lvbi5kZXN0cm95KCk7CgogICAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJDbGVhcl9SZWZyZXNoX1Rva2VuX0ludGVydmFsIiwgewogICAgICAgICAgICAgICAgY2xlYXJfaW50ZXJ2YWw6IHRydWUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwoKICAgICAgICAgICAgICBfdGhpczkuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXM5LnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICBfdGhpczkuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczkudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwoKICAgICAgICAgIF90aGlzOS5zb2NrZXQuZGlzY29ubmVjdCgpOwoKICAgICAgICAgIF90aGlzOS4kc2Vzc2lvbi5kZXN0cm95KCk7CgogICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CgogICAgICAgICAgX3RoaXM5LiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNpZ25vdXRfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgicnQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLlVTRVJfTE9HR0VEX09VVF8xMDMyLk1TR19DT0RFIHx8IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLlRPS0VOX0lOVkFMSURfMDAwMS5NU0dfQ09ERSB8fCByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0NSRURFTlRJQUxTXzAwMDUuTVNHX0NPREUpIHsKICAgICAgICAgICAgaWYgKF90aGlzOS50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICBfdGhpczkuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXM5LnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKCiAgICAgICAgICAgIF90aGlzOS5zb2NrZXQuZGlzY29ubmVjdCgpOwoKICAgICAgICAgICAgX3RoaXM5LiRzZXNzaW9uLmRlc3Ryb3koKTsKCiAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CgogICAgICAgICAgICBfdGhpczkuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXM5LnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICBfdGhpczkuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczkudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwoKICAgICAgICAgIF90aGlzOS5zb2NrZXQuZGlzY29ubmVjdCgpOwoKICAgICAgICAgIF90aGlzOS4kc2Vzc2lvbi5kZXN0cm95KCk7CgogICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CgogICAgICAgICAgX3RoaXM5LiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy8gdXBkYXRlX25vdGlmaWNhdGlvbnNfbGlzdCgpIHsKICAgIC8vICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAvLyAgICAgbmVlZF9ub3RpZmljYXRpb25zOiB0cnVlLAogICAgLy8gICAgIGVtYWlsX2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgIH0pOwogICAgLy8gfSwKICAgIHNlZW5fYWxsX25vdGlmaWNhdGlvbnM6IGZ1bmN0aW9uIHNlZW5fYWxsX25vdGlmaWNhdGlvbnMoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBsYXN0X2luZGV4ID0gdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aCAtIDE7CgogICAgICBpZiAobGFzdF9pbmRleCA+PSAwKSB7CiAgICAgICAgaWYgKHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwpIHsKICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwucHVzaCgibm90aWZpY2F0aW9uX3NlZW4iLCB7CiAgICAgICAgICAgIHJlcV9pZDogdGhpcy5ub3RpZmljYXRpb25zW2xhc3RfaW5kZXhdLmlkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnRyYWluaW5nX2NoYW5uZWwpIHsKICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fc2VlbiIsIHsKICAgICAgICAgICAgcmVxX2lkOiB0aGlzLm5vdGlmaWNhdGlvbnNbbGFzdF9pbmRleF0uaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyX2FsbF9ub3RpZmljYXRpb25zOiBmdW5jdGlvbiBjbGVhcl9hbGxfbm90aWZpY2F0aW9ucygpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIHZhciByZXFfbGlzdF9jbGVhcmVkID0gW107CiAgICAgIHZhciBub3RpZmljYXRpb25zX3RlbXBfbGlzdCA9IHRoaXMubm90aWZpY2F0aW9uczsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBub3RpZmljYXRpb25zX3RlbXBfbGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChfdHlwZW9mKG5vdGlmaWNhdGlvbnNfdGVtcF9saXN0W2ldKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbnNbaV0uTm90aWZpY2F0aW9uaWQpIHsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXFfbGlzdF9jbGVhcmVkLnB1c2gobm90aWZpY2F0aW9uc190ZW1wX2xpc3RbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ub3RpZmljYXRpb25zID0gbm90aWZpY2F0aW9uc190ZW1wX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHsKICAgICAgICByZXR1cm4gcmVxX2xpc3RfY2xlYXJlZC5pbmNsdWRlcyhub3RpZmljYXRpb24uaWQpID09PSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJfc2luZ2xlX25vdGlmaWNhdGlvbjogZnVuY3Rpb24gY2xlYXJfc2luZ2xlX25vdGlmaWNhdGlvbihyZXFfaWQsIGluZGV4KSB7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgaWYgKHJlcV9pZCAhPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbnNbaW5kZXhdLk5vdGlmaWNhdGlvbmlkKSB7CiAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLnB1c2goIm5vdGlmaWNhdGlvbl9jbGVhcmVkIiwgewogICAgICAgICAgICByZXFfaWQ6IHJlcV9pZAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgcmVxX2lkOiByZXFfaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X25vdGlmaWNhdGlvbnM6IGZ1bmN0aW9uIHNob3dfbm90aWZpY2F0aW9ucyhkYXRhKSB7CiAgICAgIGlmIChkYXRhICE9IDEpIHsKICAgICAgICBpZiAoZGF0YS5Ob3RpZmljYXRpb25pZCkgewogICAgICAgICAgdmFyIGRhdGU7CiAgICAgICAgICB2YXIgbW9udGhOYW1lcyA9IFsiSmFuIiwgIkZlYiIsICJNYXIiLCAiQXByIiwgIk1heSIsICJKdW4iLCAiSnVsIiwgIkF1ZyIsICJTZXAiLCAiT2N0IiwgIk5vdiIsICJEZWMiXTsKICAgICAgICAgIGRhdGUgPSBkYXRhLnZpc2l0X2RhdGUuc3BsaXQoIiAiKVswXS5zcGxpdCgiLSIpWzJdICsgIiAiICsgbW9udGhOYW1lc1tkYXRhLnZpc2l0X2RhdGUuc3BsaXQoIiAiKVswXS5zcGxpdCgiLSIpWzFdIC0gMV0gKyAiICIgKyBkYXRhLnZpc2l0X2RhdGUuc3BsaXQoIiAiKVswXS5zcGxpdCgiLSIpWzBdOwogICAgICAgICAgdmFyIHRpbWU7CiAgICAgICAgICBkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXTsKCiAgICAgICAgICBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA8IDEyKSB7CiAgICAgICAgICAgIHRpbWUgPSBOdW1iZXIoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSkgKyAiOjAwIGFtIjsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA9PSAxMikgewogICAgICAgICAgICB0aW1lID0gIjEyOjAwIHBtIjsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA+IDEyICYmIGRhdGEudmlzaXRfc2xvdC5zcGxpdCgiLSIpWzBdLnNwbGl0KCI6IilbMF0gPCAyNCkgewogICAgICAgICAgICB0aW1lID0gTnVtYmVyKGRhdGEudmlzaXRfc2xvdC5zcGxpdCgiLSIpWzBdLnNwbGl0KCI6IilbMF0pIC0gMTIgKyAiOjAwIHBtIjsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA9PSAyNCkgewogICAgICAgICAgICB0aW1lID0gIjEyOjAwIGFtIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF0YS5Ob3RpZmljYXRpb25pZCA9PSAiQXBwb2ludG1lbnQgRGVsZXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKGRhdGEudmlzaXRvcl9uYW1lICsgIiIuY29uY2F0KHRoaXMudGx0KCdoYXNfY2FuY2VsbGVkX2FwcG9pbnRtZW50X3NjaGVkdWxlX29uJykpICsgZGF0ZSArICIgYXQgIiArIHRpbWUpOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLk5vdGlmaWNhdGlvbmlkID09ICJBcHBvaW50bWVudCBDb25maXJtZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKGRhdGEudmlzaXRvcl9uYW1lICsgIiIuY29uY2F0KHRoaXMudGx0KCdoYXNfY29uZmlybWVkX2FwcG9pbnRtZW50X3NjaGVkdWxlX29uJykpICsgZGF0ZSArICIgYXQgIiArIHRpbWUpOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLk5vdGlmaWNhdGlvbmlkID09ICJBcHBvaW50bWVudCBSZXNjaGVkdWxlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcoZGF0YS52aXNpdG9yX25hbWUgKyAiIi5jb25jYXQodGhpcy50bHQoJ2hhc19yZXNjaGVkdWxlZF9hcHBvaW50bWVudF9vbicpKSArIGRhdGUgKyAiIGF0ICIgKyB0aW1lKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5Ob3RpZmljYXRpb25pZCA9PSAiQXBwb2ludG1lbnQgU2NoZWR1bGVkIikgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhkYXRhLnZpc2l0b3JfbmFtZSArICIiLmNvbmNhdCh0aGlzLnRsdCgnaGFzX2JlZW5fc2NoZWR1bGVkX2FuX2FwcG9pbnRtZW50X29uJykpICsgZGF0ZSArICIgYXQgIiArIHRpbWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5Nb2RlbFR5cGUgPT0gIkludGVudCxEaWFsb2d1ZSIpIHsKICAgICAgICAgIHZhciBkYXRlOwogICAgICAgICAgZGF0ZSA9IG1vbWVudChkYXRhLkluaXRpYXRlZE9uLCBbIllZWVktTU0tREQiXSkuZm9ybWF0KCJEbyBNTU0gWVlZWSIpOwoKICAgICAgICAgIGlmIChkYXRhLlRyYWluaW5nU3RhdHVzID09ICJGYWlsZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiIi5jb25jYXQodGhpcy50bHQoJ3RyYWluaW5nX29mX21vZGVsX29uJyksICIgIikuY29uY2F0KGRhdGUsICIgIikuY29uY2F0KHRoaXMudGx0KCdmYWlsZWRfY29udGFjdF9hZG1pbicpKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIkNvbXBsZXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIiIuY29uY2F0KHRoaXMudGx0KCd0cmFpbmluZ19vZl9uZXdfbW9kZWxfaW5pdGlhdGVkJyksICIgIikuY29uY2F0KGRhdGUsICIgIikuY29uY2F0KHRoaXMudGx0KCdoYXNfYmVlbl9jb21wbGV0ZWRfc3VjY2Vzc2Z1bGx5JykpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiU3RhcnRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmluZm8oIiIuY29uY2F0KHRoaXMudGx0KCduZXdfcmVxX2Zvcl90cmFpbmluZ19pbml0aWF0ZWQnKSwgIiAiKS5jb25jYXQoZGF0ZSwgIi4iKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLk1vZGVsVHlwZSkgewogICAgICAgICAgdmFyIGRhdGU7CiAgICAgICAgICBkYXRlID0gbW9tZW50KGRhdGEuSW5pdGlhdGVkT24sIFsiWVlZWS1NTS1ERCJdKS5mb3JtYXQoIkRvIE1NTSBZWVlZIik7CgogICAgICAgICAgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIkZhaWxlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCIiLmNvbmNhdCh0aGlzLnRsdCgndHJhaW5pbmdfb2YnKSwgIiAiKS5jb25jYXQoZGF0YS5Nb2RlbFR5cGUsICIgIikuY29uY2F0KHRoaXMudGx0KCdtb2RlbF9vbicpLCAiICIpLmNvbmNhdChkYXRlLCAiICIpLmNvbmNhdCh0aGlzLnRsdCgnZmFpbGVkX2NvbnRhY3RfYWRtaW4nKSkpOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLlRyYWluaW5nU3RhdHVzID09ICJDb21wbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCIiLmNvbmNhdCh0aGlzLnRsdCgndHJhaW5pbmdfb2ZfbmV3JyksICIgIikuY29uY2F0KGRhdGEuTW9kZWxUeXBlLCAiICIpLmNvbmNhdCh0aGlzLnRsdCgnbW9kZWxfaW5pdGlhdGVkX29uJyksICIgIikuY29uY2F0KGRhdGUsICIgIikuY29uY2F0KHRoaXMudGx0KCdoYXNfYmVlbl9jb21wbGV0ZWRfc3VjY2Vzc2Z1bGx5JykpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiU3RhcnRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmluZm8oIiIuY29uY2F0KHRoaXMudGx0KCduZXdfcmVxX2Zvcl90cmFpbmluZycpLCAiICIpLmNvbmNhdChkYXRhLk1vZGVsVHlwZSwgIiAiKS5jb25jYXQodGhpcy50bHQoJ21vZGVsX2hhc19iZWVuX2luaXRpYXRlZF9vbicpLCAiICIpLmNvbmNhdChkYXRlLCAiLiIpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdGFydF90b3VyOiBmdW5jdGlvbiBzdGFydF90b3VyKCkgewogICAgICB0aGlzLiRyb290LiRlbWl0KCJzaG93X3RvdXJfZ3VpZGUiLCB0cnVlKTsKICAgIH0sCiAgICBnZW5lcmF0ZV9lbWFpbF93aXphcmQ6IGZ1bmN0aW9uIGdlbmVyYXRlX2VtYWlsX3dpemFyZChtb2RlbFR5cGUsIGluaXRpYXRlZE9uKSB7CiAgICAgIHZhciB1c2VybmFtZSA9ICIiLmNvbmNhdCh0aGlzLnVzZXJfZmlyc3RfbmFtZSwgIiAiKS5jb25jYXQodGhpcy51c2VyX2xhc3RfbmFtZSk7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwoKICAgICAgaWYgKG1vZGVsVHlwZSA9PSAiSW50ZW50LERpYWxvZ3VlIikgewogICAgICAgIGEuaHJlZiA9ICJtYWlsdG86YWRtaW5AY2Vuc2UuYWk/c3ViamVjdD0iLmNvbmNhdCh0aGlzLnRsdCgnY2hhdGJvdF9tb2RlbF90cmFpbmluZ19mYWlsZWRfb24nKSwgIiAiKS5jb25jYXQoaW5pdGlhdGVkT24sICIuJmJvZHk9IikuY29uY2F0KHRoaXMudGx0KCdoaV9jZW5zZV90ZWFtJyksICIsJTBEJTBBLCAiKS5jb25jYXQodGhpcy50bHQoJ2NoYXRib3RfZmFpbGVkX2FkbWluX3dpbGxfbG9vaycpLCAiLiUwRCUwQSIpLmNvbmNhdCh0aGlzLnRsdCgndGhhbmtzJyksICIsJTBEJTBBIikuY29uY2F0KHVzZXJuYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhLmhyZWYgPSAibWFpbHRvOmFkbWluQGNlbnNlLmFpP3N1YmplY3Q9Ii5jb25jYXQobW9kZWxUeXBlLCAiICIpLmNvbmNhdCh0aGlzLnRsdCgnbW9kZWxfdHJhaW5pbmdfZmFpbGVkX29uJyksICIgIikuY29uY2F0KGluaXRpYXRlZE9uLCAiLiZib2R5PSIpLmNvbmNhdCh0aGlzLnRsdCgnaGlfY2Vuc2VfdGVhbScpLCAiLCUwRCUwQSwgIikuY29uY2F0KHRoaXMudGx0KCd0aGUnKSwgIiAiKS5jb25jYXQobW9kZWxUeXBlLCAiICIpLmNvbmNhdCh0aGlzLnRsdCgnY2hhdGJvdF9mYWlsZWRfYWRtaW5fd2lsbF9sb29rJyksICIuJTBEJTBBIikuY29uY2F0KHRoaXMudGx0KCd0aGFua3MnKSwgIiwlMEQlMEEiKS5jb25jYXQodXNlcm5hbWUpOwogICAgICB9CgogICAgICBhLmNsaWNrKCk7CiAgICB9LAogICAgcGFnZV9yZWRpcmVjdDogZnVuY3Rpb24gcGFnZV9yZWRpcmVjdCgpIHsKICAgICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUgIT09ICJEYXNoYm9hcmQiKSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogIkRhc2hib2FyZCIKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJjaGFuZ2Vfc2lkZWJhcl9tYWluX21lbnUiLCAiRGFzaGJvYXJkIik7CiAgICAgIH0KICAgIH0sCiAgICB0b3BuYXZiYXJfZGlzYWJsZTogZnVuY3Rpb24gdG9wbmF2YmFyX2Rpc2FibGUoKSB7CiAgICAgIGlmICh0aGlzLmRpc2FibGVfbmF2YmFyID09PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuICJwb2ludGVyLWV2ZW50czpub25lOyI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}