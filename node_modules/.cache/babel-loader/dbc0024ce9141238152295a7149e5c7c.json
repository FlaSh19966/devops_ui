{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/ConversationalFlow/Entities.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/ConversationalFlow/Entities.vue","mtime":1660042032559},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IFRlbXBsYXRlIGZyb20gJy4uL1RlbXBsYXRlLnZ1ZSc7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBUZW1wbGF0ZTogVGVtcGxhdGUKICB9LAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbF0sCiAgbmFtZTogImVudGl0aWVzX2NvbXBvbmVudCIsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzX2F0X2luX2VudGl0eTogZmFsc2UsCiAgICAgIHZhbGlkYXRpb25fbmVlZGVkOiBmYWxzZSwKICAgICAgdmFsaWRhdGlvbl90eXBlOiBudWxsLAogICAgICBjdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fbmVlZGVkOiBmYWxzZSwKICAgICAgY3VycmVudF9zZWxlY3RlZF92YWxpZGF0aW9uX3R5cGU6IG51bGwsCiAgICAgIHNhdmVfbmV3X2VudGl0aWVzOiAnJywKICAgICAgZW50aXRpZXNfdmFsdWVfdHlwZTogJ3N5bm9ueW1zJywKICAgICAgc3lub255bXNfdmFsdWVfbGlzdDogW3sKICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgc3lub255bXM6IFsiIl0KICAgICAgfV0sCiAgICAgIHBhdHRlcm5fbGlzdDogW3sKICAgICAgICBwYXR0ZXJuOiAnJwogICAgICB9XSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgZW50aXR5X2FscmVhZHlfZXhpc3RzOiBmYWxzZSwKICAgICAgZW50aXR5X2FscmVhZHlfZXhpc3RzX2VkaXQ6IGZhbHNlLAogICAgICBwZW5jaWxfc3ZnOiAnPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBpc1Zpc2libGVTZWFyY2hDbGVhcjogZmFsc2UsCiAgICAgIGZpbGVfbGFiZWxfY3N2OiAiQ2hvb3NlIGZpbGUiLAogICAgICBzcGlubmVyT25GaWxlRG93bmxvYWQ6IGZhbHNlLAogICAgICBlbnRpdHlfbGlzdDogW10sCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgaXNFZGl0RW50aXR5OiBmYWxzZSwKICAgICAgaXNfc2VhcmNoX2FjdGl2ZTogZmFsc2UsCiAgICAgIG9sZF9lbnRpdHlfbmFtZTogJycsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2hpZ2hsaWdodDogJycsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5OiAnJywKICAgICAgY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXg6IDAsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfdHlwZTogJycsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfaWQ6IG51bGwsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfZGVzY3JpcHRpb246ICcnLAogICAgICBjdXJyZW50X3NlbGVjdGVkX3ZhbHVlczogW3sKICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgc3lub255bXM6IFsiIl0KICAgICAgfV0sCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybjogW3sKICAgICAgICBwYXR0ZXJuOiAnJwogICAgICB9XQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgnc2VsZWN0X2NvbXBhbnlfbmFtZV90ZXh0JykpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KCiAgICB0aGlzLmxvYWRfZW50aXR5KCk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiZW50aXRpZXNfY29tcG9uZW50RGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9KTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCdhW2RhdGEtdGFyZ2V0PSIjZW50aXR5bW9kZWwiXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHZtLmlzRWRpdEVudGl0eSA9PSB0cnVlKSB7CiAgICAgICAgdm0udmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICQoIiNlbnRpdHltb2RlbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0KICAgIH0pOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgd2F0Y2g6IHsKICAgIGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5OiBmdW5jdGlvbiBjdXJyZW50X3NlbGVjdGVkX2VudGl0eSh2YWwpIHsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSA9IHZhbC5yZXBsYWNlKC9bXmEtekEtWjAtOV8gXS9nLCAiIik7CiAgICB9LAogICAgc2F2ZV9uZXdfZW50aXRpZXM6IGZ1bmN0aW9uIHNhdmVfbmV3X2VudGl0aWVzKHZhbCkgewogICAgICB0aGlzLnNhdmVfbmV3X2VudGl0aWVzID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0sCiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF9lbnRpdHkoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH0sCiAgYmVmb3JlUm91dGVMZWF2ZTogZnVuY3Rpb24gYmVmb3JlUm91dGVMZWF2ZSh0bywgZnJvbSwgbmV4dCkgewogICAgaWYgKHRoaXMuaXNFZGl0RW50aXR5KSB7CiAgICAgIHRoaXMudmVyaWZ5X2NoYW5nZXMoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHZlcmlmeV9jaGFuZ2VzOiBmdW5jdGlvbiB2ZXJpZnlfY2hhbmdlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2VudGl0eV9zd2FsX2FsZXJ0X21zZzEnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50aXR5X3N3YWxfY2hhbmdlc19pbl9vYmplY3RpdmVfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2VudGl0eV9zd2FsX3NhdmVfYnRuJyksCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoJ2VudGl0eV9zd2FsX2NhbmNlbF9idG4nKQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczIuZWRpdF9lbnRpdHkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLmlzRWRpdEVudGl0eSA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzMi5sb2FkX2VudGl0eSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gcm91dGV0b2Fzc2lzdGFudExheW91dCgpewogICAgLy8gdGhpcy4kcm91dGVyLnB1c2goewogICAgLy8gICAgIG5hbWU6ICJDb252ZXJzYXRpb25hbCBGbG93IiwKICAgIC8vICAgICBwYXJhbXM6e21vZGFsX29wZW5fZW50aXR5X3RhYjogdHJ1ZSAgfQogICAgLy8gICB9KTsKICAgIC8vIH0sCiAgICBjaGVja19jdXJyZW50X2VudGl0eTogZnVuY3Rpb24gY2hlY2tfY3VycmVudF9lbnRpdHkoaW5kZXgpIHsKICAgICAgdmFyIHJldHVybl92YXIgPSAiIjsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHkgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eV9oaWdobGlnaHQpIHsKICAgICAgICByZXR1cm5fdmFyICs9ICJjdXJyZW50LWFjdGl2ZS1lbnRpdHkiOwogICAgICB9CgogICAgICByZXR1cm4gcmV0dXJuX3ZhcjsKICAgIH0sCiAgICBzaG93X2VudGl0aWVzOiBmdW5jdGlvbiBzaG93X2VudGl0aWVzKGluZGV4KSB7CiAgICAgIHRoaXMuaXNFZGl0RW50aXR5ID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXggPSBpbmRleDsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHkuc3Vic3RyaW5nKDAsIDEpID09PSAiQCIpIHsKICAgICAgICB0aGlzLmlzX2F0X2luX2VudGl0eSA9IHRydWU7CiAgICAgICAgdmFyIGxlbiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5sZW5ndGg7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5zdWJzdHJpbmcoMSwgbGVuKTsKICAgICAgICB0aGlzLm9sZF9lbnRpdHlfbmFtZSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5zdWJzdHJpbmcoMSwgbGVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzX2F0X2luX2VudGl0eSA9IGZhbHNlOwogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHk7CiAgICAgICAgdGhpcy5vbGRfZW50aXR5X25hbWUgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pZCA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmlkOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2hpZ2hsaWdodCA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eTsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3R5cGUgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS50eXBlOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl9uZWVkZWQgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS52YWxpZGF0aW9uX25lZWRlZDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbGlkYXRpb25fdHlwZTsgLy8gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlcyA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbHVlczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PSAncGF0dGVybicpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbHVlczsKICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PSAnc3lzdGVtJykgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9kZXNjcmlwdGlvbiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmRlc2NyaXB0aW9uOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXMgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS52YWx1ZXM7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2VudGl0eTogZnVuY3Rpb24gbG9hZF9lbnRpdHkoY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPSBmYWxzZTsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19nZXRfZW50aXR5OiB0cnVlLAogICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgIF90aGlzMy5lbnRpdHlfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5lbnRpdHlfbmFtZXM7CgogICAgICAgICAgaWYgKF90aGlzMy5lbnRpdHlfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KSkgewogICAgICAgICAgICAgIF90aGlzMy5zaG93X2VudGl0aWVzKGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczMuc2hvd19lbnRpdGllcygwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMy5zZXRwYWdpbmF0aW9uKF90aGlzMy5wYWdlX25vKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIGlmICh0aGlzLmlzRWRpdEVudGl0eSkgewogICAgICAgICAgdGhpcy52ZXJpZnlfY2hhbmdlcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlYXJjaF9lbnRpdHkoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfZW50aXR5OiBmdW5jdGlvbiBzZWFyY2hfZW50aXR5KGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX2FkZF9lbnRpdHkoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczQudGx0KCdlbnRpdHlfc2VhcmNoX25vX3Jlc3VsdF9mb3VuZF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczQubG9hZF9lbnRpdHkoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNC5lbnRpdHlfbGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczQucGFnZV9ubyA9IDE7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuVE9LRU5fSU5WQUxJRF8wMDAxX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzNC50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIF90aGlzNC5lbnRpdHlfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5lbnRpdGllc19zZWFyY2g7CgogICAgICAgICAgICAgIGlmIChfdGhpczQuZW50aXR5X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXM0LmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KSkgewogICAgICAgICAgICAgICAgICBfdGhpczQuc2hvd19lbnRpdGllcyhjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczQuc2hvd19lbnRpdGllcygwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzNC5zZXRwYWdpbmF0aW9uKF90aGlzNC5wYWdlX25vKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXM0LnRsdCgnZW50aXR5X3NlYXJjaF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNC5sb2FkX2VudGl0eSgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdHlfc2VhcmNoX2RhdGFfZm9yX3NlYXJjaF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlX3N1Ym1pdDogZnVuY3Rpb24gZmlsZV9zdWJtaXQoKSB7fSwKICAgIGZpbGVpbnB1dF9jc3Y6IGZ1bmN0aW9uIGZpbGVpbnB1dF9jc3YoKSB7fSwKICAgIGRvd25sb2FkX3NhbXBsZV9maWxlOiBmdW5jdGlvbiBkb3dubG9hZF9zYW1wbGVfZmlsZSgpIHsvLyB0aGlzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IHRydWU7CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGU6IGZ1bmN0aW9uIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXRpZXNfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CiAgICAgIHRoaXMuc2F2ZV9uZXdfZW50aXRpZXMgPSAnJywgdGhpcy5lbnRpdGllc192YWx1ZV90eXBlID0gJ3N5bm9ueW1zJywgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0ID0gW3sKICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgc3lub255bXM6IFsiIl0KICAgICAgfV0sIHRoaXMucGF0dGVybl9saXN0ID0gW3sKICAgICAgICBwYXR0ZXJuOiAnJwogICAgICB9XSwgdGhpcy5lbnRpdHlfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICB0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgfSwKICAgIGRvd25sb2FkX2NzdjogZnVuY3Rpb24gZG93bmxvYWRfY3N2KCkge30sCiAgICB0cmFpbl9tb2RlbDogZnVuY3Rpb24gdHJhaW5fbW9kZWwoKSB7fSwKICAgIGRlbGV0ZV9zZWxlY3RlZDogZnVuY3Rpb24gZGVsZXRlX3NlbGVjdGVkKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdHlfbm9fb2JqZWN0aXZlX3NlbGVjdF9tc2cnKSwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBkZWxldGVfZW50aXR5X2xpc3QgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgICAgZGVsZXRlX2VudGl0eV9saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0pOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnZW50aXR5X3N3YWxfYWxlcnRfbXNnMicpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2VudGl0eV9ub19yZXZlcnRfbXNnJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdlbnRpdHlfc3dhbF9kZWxldGVfYnRuJykKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXM1LmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX2FkZF9lbnRpdHkoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM1LmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzNS5jb21wYW55aWQsCiAgICAgICAgICAgICAgZW1haWw6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICAgICAgICBlbnRpdHk6IGRlbGV0ZV9lbnRpdHlfbGlzdAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKQogICAgICAgICAgICAgIF90aGlzNS5iaWdfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuRU5USVRJRVNfREVMRVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczUudGx0KCdlbnRpdHlfb2JqZWN0aXZlX2lzX2RlbGV0ZWRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdGhpczUudGx0KCdlbnRpdHlfc3dhbF9zdWNjZXNzX21zZycpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczUuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXM1LmVudGl0eV9saXN0Lmxlbmd0aCAmJiBfdGhpczUucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM1LnBhZ2Vfbm8gPSBfdGhpczUucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXM1LmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgICAgICAgICAgIF90aGlzNS5sb2FkX2VudGl0eSgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuVVNFRF9FTlRJVElFU19ERUxFVEVEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzNS50bHQoJ2VudGl0eV9tb2RpZnlfZGlhbG9nX25vZGVfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDc1MDAsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdGhpczUudGx0KCdlbnRpdHlfc3dhbF9pbmZvX21zZycpIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAvLyBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgICAgIC8vIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXM1LmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzNS5lbnRpdHlfbGlzdC5sZW5ndGggJiYgX3RoaXM1LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNS5wYWdlX25vID0gX3RoaXM1LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzNS5jaGVja2VkX2xpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICBfdGhpczUubG9hZF9lbnRpdHkoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczUuYXBpX3N0YXR1c19jb2RlLkVOVElUWV9WQUxVRVNfTk9UX0ZPVU5EX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzNS50bHQoJ2VudGl0eV9zd2FsX2ludGVybmFsX3NlcnZlcl9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM1LnRsdCgnZW50aXR5X3N3YWxfaW50ZXJuYWxfc2VydmVyX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIF90aGlzNS5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczUudGx0KCdzb21lX2Vycm9yX29jY3VycmVkX21zZycsICdjb2RlJykpOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc2F2ZV9lbnRpdHk6IGZ1bmN0aW9uIHNhdmVfZW50aXR5KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0c3MpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19uYW1lX2FscmVhZHlfZXhpc3RfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2F2ZV9uZXdfZW50aXRpZXMgPT09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50aXRpZXNfZW50ZXJfbmFtZV9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoQm9vbGVhbih0aGlzLnZhbGlkYXRpb25fbmVlZGVkKSAmJiAhQm9vbGVhbih0aGlzLnZhbGlkYXRpb25fdHlwZSkpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19zZWxlY3RfdmFsaWRhdGlvbl9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiA0NTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5lbnRpdGllc192YWx1ZV90eXBlID09PSAncGF0dGVybicpIHsKICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5wYXR0ZXJuX2xpc3QubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAodGhpcy5wYXR0ZXJuX2xpc3RbaW5kZXhdWydwYXR0ZXJuJ10gPT09ICcnIHx8IHRoaXMucGF0dGVybl9saXN0W2luZGV4XVsncGF0dGVybiddID09PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19wYXR0ZXJuX2Nhbm5vdF9iZV9ibGFua19tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lbnRpdGllc192YWx1ZV90eXBlID09PSAnc3lub255bXMnKSB7CiAgICAgICAgZm9yICh2YXIgX2luZGV4ID0gMDsgX2luZGV4IDwgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0Lmxlbmd0aDsgX2luZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbX2luZGV4XVsndmFsdWUnXSA9PT0gJycgfHwgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0W19pbmRleF1bJ3ZhbHVlJ10gPT09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2VudGl0aWVzX3ZhbHVlX2Nhbm5vdF9iZV9ibGFua19tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuc3lub255bXNfdmFsdWVfbGlzdFtfaW5kZXhdWydzeW5vbnltcyddLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbX2luZGV4XVsnc3lub255bXMnXVtqXSA9PT0gJycgfHwgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0W19pbmRleF1bJ3N5bm9ueW1zJ11bal0gPT09IG51bGwpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19zeW5vbnltc19jYW5ub3RfYmVfYmxhbmtfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgZW50aXR5X2RldGFpbHM6IHsKICAgICAgICAgICJlbnRpdHkiOiAiQCIgKyB0aGlzLnNhdmVfbmV3X2VudGl0aWVzLAogICAgICAgICAgInR5cGUiOiB0aGlzLmVudGl0aWVzX3ZhbHVlX3R5cGUsCiAgICAgICAgICAidmFsaWRhdGlvbl9uZWVkZWQiOiB0aGlzLnZhbGlkYXRpb25fbmVlZGVkLAogICAgICAgICAgInZhbGlkYXRpb25fdHlwZSI6IHRoaXMudmFsaWRhdGlvbl9uZWVkZWQgPT09IHRydWUgPyB0aGlzLnZhbGlkYXRpb25fdHlwZSA6IG51bGwsCiAgICAgICAgICAidmFsdWVzIjogdGhpcy5lbnRpdGllc192YWx1ZV90eXBlID09ICdwYXR0ZXJuJyA/IHRoaXMucGF0dGVybl9saXN0IDogdGhpcy5zeW5vbnltc192YWx1ZV9saXN0CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICBfdGhpczYuYmlnX3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLkVOVElUWV9EQVRBX1NBVkVEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ2VudGl0aWVzX3ZhbHVlX3NhdmVkX21zZycpLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICB0aXRsZTogX3RoaXM2LnRsdCgnZW50aXRpZXNfc3dhbF9zdWNjZXNzX21zZycpLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgJCgiI2VudGl0eW1vZGVsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICBfdGhpczYuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICBfdGhpczYubG9hZF9lbnRpdHkoKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLlJFR0VYX1BBVFRFUk5fVkFMSURBVElPTl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ2VudGl0aWVzX2ludmFsaWRfcGF0dGVybl9tc2cnKSwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczYudGx0KCdlbnRpdGllc19pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM2LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNi50bHQoJ3NvbWVfZXJyb3Jfb2NjdXJyZWRfbXNnJywgJ2NvZGUnKSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZWRpdF9lbnRpdHk6IGZ1bmN0aW9uIGVkaXRfZW50aXR5KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0c19lZGl0KSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50aXRpZXNfZWRpdF9uYW1lX2FscmVhZHlfZXhpc3RfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub2xkX2VudGl0eV9uYW1lID09IHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkpIHsKICAgICAgICB2YXIgZW50aXR5X3RvX3NlbmQgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBlbnRpdHlfdG9fc2VuZCA9IHRoaXMuaXNfYXRfaW5fZW50aXR5ID09IGZhbHNlID8gdGhpcy5vbGRfZW50aXR5X25hbWUgOiAiQCIgKyB0aGlzLm9sZF9lbnRpdHlfbmFtZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgPT09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50aXRpZXNfZWRpdF9lbnRlcl9uYW1lX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChCb29sZWFuKHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWxpZGF0aW9uX25lZWRlZCkgJiYgIUJvb2xlYW4odGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZSkpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19lZGl0X3NlbGVjdF92YWxpZGF0aW9uX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDQ1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PT0gJ3BhdHRlcm4nKSB7CiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuW2luZGV4XVsncGF0dGVybiddID09PSAnJyB8fCB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybltpbmRleF1bJ3BhdHRlcm4nXSA9PT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50aXRpZXNfZWRpdF9wYXR0ZXJuX2Nhbm5vdF9iZV9ibGFua19tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX3R5cGUgPT09ICdzeW5vbnltcycpIHsKICAgICAgICBmb3IgKHZhciBfaW5kZXgyID0gMDsgX2luZGV4MiA8IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXMubGVuZ3RoOyBfaW5kZXgyKyspIHsKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzW19pbmRleDJdWyd2YWx1ZSddID09PSAnJyB8fCB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzW19pbmRleDJdWyd2YWx1ZSddID09PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19lZGl0X3ZhbHVlX2Nhbm5vdF9iZV9ibGFua19tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ10ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ11bal0gPT09ICcnIHx8IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ11bal0gPT09IG51bGwpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRpdGllc19lZGl0X3N5bm9ueW1zX2Nhbm5vdF9iZV9ibGFua19tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX2FkZF9lbnRpdHkoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICBvbGRfZW50aXR5X25hbWU6IGVudGl0eV90b19zZW5kLAogICAgICAgIGVudGl0eTogdGhpcy5pc19hdF9pbl9lbnRpdHkgPT0gZmFsc2UgPyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5IDogIkAiICsgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSwKICAgICAgICBlZGl0X2VudGl0eV9kZXRhaWw6IHsKICAgICAgICAgICJ0eXBlIjogdGhpcy5jdXJyZW50X3NlbGVjdGVkX3R5cGUsCiAgICAgICAgICAiaWQiOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaWQsCiAgICAgICAgICAidmFsaWRhdGlvbl9uZWVkZWQiOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl9uZWVkZWQsCiAgICAgICAgICAidmFsaWRhdGlvbl90eXBlIjogdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fbmVlZGVkID09PSB0cnVlID8gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZSA6IG51bGwsCiAgICAgICAgICAidmFsdWVzIjogdGhpcy5jdXJyZW50X3NlbGVjdGVkX3R5cGUgPT0gJ3BhdHRlcm4nID8gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3BhdHRlcm4gOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzCiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICBfdGhpczcuYmlnX3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLlVTRURfRU5USVRJRVNfRURJVEVEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ2VudGl0aWVzX3N3YWxfZWRpdGVkX21zZycpLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICB0aXRsZTogX3RoaXM3LnRsdCgnZW50aXRpZXNfZWRpdF9zd2FsX3N1Y2Nlc3NfbXNnMScpLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOyAvLyB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgaWYgKF90aGlzNy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgIF90aGlzNy5zZWFyY2hfZW50aXR5KF90aGlzNy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczcubG9hZF9lbnRpdHkoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLkVOVElUSUVTX0VESVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdlbnRpdGllc19lZGl0X21vZGlmeV9pbl9kaWFsb2dfbm9kZV9tc2cnKSwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB0aW1lcjogNzUwMCwKICAgICAgICAgICAgdGl0bGU6IF90aGlzNy50bHQoJ2VudGl0aWVzX2VkaXRfc3dhbF9zdWNjZXNzX21zZzInKSAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAvLyBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCgogICAgICAgICAgfSk7IC8vIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICBpZiAoX3RoaXM3LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXM3LnNlYXJjaF9lbnRpdHkoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzNy5sb2FkX2VudGl0eShfdGhpczcuY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXM3LnRsdCgnZW50aXRpZXNfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczcudGx0KCdzb21lX2Vycm9yX29jY3VycmVkX21zZycsICdjb2RlJykpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlYXJjaF9lbnRpdGllc19uYW1lOiBmdW5jdGlvbiBzZWFyY2hfZW50aXRpZXNfbmFtZSgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fYWRkX2VudGl0eSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfc2VhcmNoX2VudGl0eTogdHJ1ZSwKICAgICAgICBlbnRpdHk6ICJAIiArIHRoaXMuc2F2ZV9uZXdfZW50aXRpZXMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLk5PVF9FWElTVFNfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczguZW50aXR5X2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXRpZXNfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzOC5zYXZlX25ld19lbnRpdGllcyAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXRpZXNfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5BTFJFQURZX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOC5lbnRpdHlfYWxyZWFkeV9leGlzdHMgPSB0cnVlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0aWVzX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZW50ZXJfZW50aXR5X2VkaXQ6IGZ1bmN0aW9uIGVudGVyX2VudGl0eV9lZGl0KCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19zZWFyY2hfZW50aXR5OiB0cnVlLAogICAgICAgIGVudGl0eTogdGhpcy5pc19hdF9pbl9lbnRpdHkgPT0gZmFsc2UgPyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5IDogIkAiICsgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOS5lbnRpdHlfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0eV9lZGl0X2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM5LmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5ICE9ICIiKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9lbnRpdHlfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5BTFJFQURZX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIGlmIChfdGhpczkub2xkX2VudGl0eV9uYW1lID09IF90aGlzOS5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSkgewogICAgICAgICAgICBfdGhpczkuZW50aXR5X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0eV9lZGl0X2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzOS5lbnRpdHlfYWxyZWFkeV9leGlzdHNfZWRpdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9lbnRpdHlfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlZGl0X2VudGl0eV9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X2VudGl0eV9kZXRhaWxzKCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0RW50aXR5KSB7CiAgICAgICAgdGhpcy5pc0VkaXRFbnRpdHkgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNFZGl0RW50aXR5ID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2FkX2VudGl0eSgpOwogICAgICB9CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgaXNfZ2V0X2VudGl0eTogdHJ1ZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxMC50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIF90aGlzMTAuZW50aXR5X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuZW50aXR5X25hbWVzOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5lbnRpdHlfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dfZW50aXRpZXMoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczEwLnNldHBhZ2luYXRpb24oX3RoaXMxMC5wYWdlX25vKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgaWYgKHRoaXMucGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2VubzsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fYWRkX2VudGl0eSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXMxMC5lbnRpdHlfbGlzdCA9IFtdOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5lbnRpdGllc19zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSBfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5UT0tFTl9JTlZBTElEXzAwMDFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgICBfdGhpczEwLmVudGl0eV9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmVudGl0aWVzX3NlYXJjaDsKCiAgICAgICAgICAgICAgICBfdGhpczEwLnNldHBhZ2luYXRpb24oX3RoaXMxMC5wYWdlX25vKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEwLnRsdCgnZW50aXRpZXNfbm9fcmVzdWx0X2ZvdW5kX21zZycpLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTAudGx0KCdlbnRpdGllc19pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2VudGl0eSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTAudGx0KCdlbnRpdGllc19pbnRlcm5hbF9zZXJ2ZXJfbXNnMicpLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2VudGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IDQ7IF9pKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMiA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTIgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHBhZ2Vfbm8gKyAzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTQgPSBwYWdlX25vIC0gNDsgX2k0IDwgdGhpcy50b3RhbF9wYWdlczsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gMzsgX2k1IDw9IHBhZ2Vfbm8gKyAzOyBfaTUrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k1KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIGVudGl0eV9uYW1lX2NoZWNrX3NwZWNpYWxfY2hhcmFjdGVyczogZnVuY3Rpb24gZW50aXR5X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzKGUpIHsKICAgICAgaWYgKC9eW15hLXpBLVowLTlfIF0qJC8udGVzdChlLmtleSkpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfdG9fcGF0dGVybl9saXN0OiBmdW5jdGlvbiBhZGRfdG9fcGF0dGVybl9saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5wYXR0ZXJuX2xpc3QudW5zaGlmdCh7CiAgICAgICAgICBwYXR0ZXJuOiAnJwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLnBhdHRlcm5fbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3BhdHRlcm5fbGlzdF9lZGl0OiBmdW5jdGlvbiBhZGRfdG9fcGF0dGVybl9saXN0X2VkaXQodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybi51bnNoaWZ0KHsKICAgICAgICAgIHBhdHRlcm46ICcnCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfdG9fdmFsdWVzX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b192YWx1ZXNfbGlzdCh0eXBlLCBpbmRleCkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgIHRoaXMuc3lub255bXNfdmFsdWVfbGlzdC51bnNoaWZ0KHsKICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgIHN5bm9ueW1zOiBbIiJdCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuc3lub255bXNfdmFsdWVfbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3ZhbHVlc19saXN0X2VkaXQ6IGZ1bmN0aW9uIGFkZF90b192YWx1ZXNfbGlzdF9lZGl0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlcy51bnNoaWZ0KHsKICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgIHN5bm9ueW1zOiBbIiJdCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF90b19zeW5vbnltc19saXN0OiBmdW5jdGlvbiBhZGRfdG9fc3lub255bXNfbGlzdCh0eXBlLCBpbmRleCwgaW5kZXgxKSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0W2luZGV4XVsnc3lub255bXMnXS51bnNoaWZ0KCIiKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0W2luZGV4XVsnc3lub255bXMnXS5zcGxpY2UoaW5kZXgxLCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF90b19zeW5vbnltc19saXN0X2VkaXQ6IGZ1bmN0aW9uIGFkZF90b19zeW5vbnltc19saXN0X2VkaXQodHlwZSwgaW5kZXgsIGluZGV4MSkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbaW5kZXhdWydzeW5vbnltcyddLnVuc2hpZnQoIiIpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzW2luZGV4XVsnc3lub255bXMnXS5zcGxpY2UoaW5kZXgxLCAxKTsKICAgICAgfQogICAgfSwKICAgIHNlbGVjdGVkX2VudGl0aWVzOiBmdW5jdGlvbiBzZWxlY3RlZF9lbnRpdGllcyhlbnRpdHlfbmFtZSkgewogICAgICBpZiAoZW50aXR5X25hbWUgPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHZhciB0ZW1wID0gW107CiAgICAgICAgICB0ZW1wID0gdGhpcy5lbnRpdHlfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGVudGl0eSkgewogICAgICAgICAgICByZXR1cm4gZW50aXR5LnR5cGUgIT0gJ3N5c3RlbSc7CiAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZW50aXR5OwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjZW50aXR5X2NoZWNrYm94XyIgKyBbaV0pLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgJCgiI3NlbGVjdGFsbCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIHZhciB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGVudGl0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIGVudGl0ZXMuZW50aXR5X25hbWUgPT0gZW50aXR5X25hbWU7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodmFsX2luZGV4Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goZW50aXR5X25hbWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CgogICAgICAgICAgaWYgKHNlbGVjdGFsbC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgICAgc2VsZWN0YWxsLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX3RlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGVudGl0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIGVudGl0ZXMgIT0gZW50aXR5X25hbWU7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IF90ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfTs="},null]}