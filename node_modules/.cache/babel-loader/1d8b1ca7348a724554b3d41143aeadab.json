{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue","mtime":1663910265482},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmxpbmsiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvaG9tZS92aW1hbGVzaC9DRU5TRS9jaGF0Ym90LXBvcnRhbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICIvaG9tZS92aW1hbGVzaC9DRU5TRS9jaGF0Ym90LXBvcnRhbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7IFNvY2tldCwgUHJlc2VuY2UgfSBmcm9tICJwaG9lbml4IjsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBNdWx0aXNlbGVjdCBmcm9tICJ2dWUtbXVsdGlzZWxlY3QiOwppbXBvcnQgVnVlUGhvbmVOdW1iZXJJbnB1dCBmcm9tICJ2dWUtcGhvbmUtbnVtYmVyLWlucHV0IjsKaW1wb3J0IHN3YWwgZnJvbSAnc3dlZXRhbGVydDInOwppbXBvcnQgRW1vamlQaWNrZXIgZnJvbSAidnVlLWVtb2ppLXBpY2tlciI7CmltcG9ydCB7IGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJXaGF0c0FwcENoYXROZXdwYWdlIiwKICBjb21wb25lbnRzOiB7CiAgICBNdWx0aXNlbGVjdDogTXVsdGlzZWxlY3QsCiAgICBWdWVQaG9uZU51bWJlcklucHV0OiBWdWVQaG9uZU51bWJlcklucHV0LAogICAgRW1vamlQaWNrZXI6IEVtb2ppUGlja2VyCiAgfSwKICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHZhciBfcmVmOwoKICAgIHJldHVybiBfcmVmID0gewogICAgICBjdXJyZW50X3BhZ2Vfbm86IDEsCiAgICAgIGxhdGVzdF9wYWdlX25vOiAxLAogICAgICBzaG93X3NwaW5uZXI6IGZhbHNlLAogICAgICBoaXN0b3J5OiBbXSwKICAgICAgY29udGFjdF9saXN0OiBbXSwKICAgICAgb2xkQ3Vyc29yUG9zaXRpb246IG51bGwsCiAgICAgIGlucHV0OiAiIiwKICAgICAgc2VhcmNoOiAiIiwKICAgICAgc2Nyb2xsX3RvcF9jYWxsZWQ6IGZhbHNlLAogICAgICBzaG93RW1vamlQaWNrZXI6IGZhbHNlLAogICAgICBzZWFyY2hlZF9tZXNzYWdlOiBbXSwKICAgICAgcGhvbmVubzogbnVsbCwKICAgICAgY3VzdG9tZXJfbmFtZTogIiIsCiAgICAgIGNoYXRfZGV0YWlsczogW10sCiAgICAgIHNlYXJjaF92YWx1ZTogIiIsCiAgICAgIGlzX3NlYXJjaF9kaXZfb3BlbjogZmFsc2UsCiAgICAgIHNlYXJjaF9tZXNzYWdlX3ZhbHVlOiAiIiwKICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgc2Vzc2lvbl90b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgaW5pdGlhbF9tZXNzYWdlX2xvYWQ6IGZhbHNlLAogICAgICBpc19wcm9maWxlX3NldHVwOiBmYWxzZSwKICAgICAgbWVzc2FnZV9wYWdpbmF0aW9uOiB7CiAgICAgICAgaXNfc2Nyb2xsX3VwOiBmYWxzZSwKICAgICAgICBpc19zY3JvbGxfZG93bjogdHJ1ZSwKICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMCwKICAgICAgICBwYWdlX3JlY29yZF9mZXRjaGVkOiBbXQogICAgICB9LAogICAgICBpc19wYWdpbmF0ZWRfY2FsbDogZmFsc2UsCiAgICAgIGRlZmF1bHRfd2hhdHNhcHBfc3RhdHVzOiAnSGV5IHRoZXJlISBJIGFtIHVzaW5nIHdoYXRzYXBwJywKICAgICAgZWRpdF9zdGF0dXM6IGZhbHNlLAogICAgICBzY3JvbGxfc3Bpbm5lcl9jaGF0OiBmYWxzZSwKICAgICAgc2hvd19zZW5kX21lc3NhZ2U6IGZhbHNlLAogICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogZmFsc2UsCiAgICAgIGlzX3Nob3dfbWVzc2FnZV9kaXNhYmxlZDogdHJ1ZSwKICAgICAgd2hhdHNhcHBfcHJvZmlsZToge30sCiAgICAgIGVkaXRfZW1haWw6IGZhbHNlLAogICAgICBlZGl0X2FkZHJlc3M6IGZhbHNlLAogICAgICBlZGl0X2Rlc2NyaXB0aW9uOiBmYWxzZSwKICAgICAgZWRpdF93ZWJzaXRlOiBmYWxzZSwKICAgICAgdG9nZ2xlTW9kYWw6IGZhbHNlLAogICAgICB0b2dnbGVNb2RhbDI6IGZhbHNlLAogICAgICBzZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkOiBudWxsLAogICAgICBlbWFpbF9hZGRyZXNzOiAnJywKICAgICAgYnVzaW5lc3NfYWRkcmVzczogJycsCiAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgd2Vic2l0ZV91cmw6ICcnLAogICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6IG51bGwsCiAgICAgIGNoYW5uZWw6IG51bGwsCiAgICAgIGNoYXRfc29ja2V0OiBudWxsLAogICAgICBzdXBwb3J0X2NoYW5uZWw6IG51bGwsCiAgICAgIG1lc3NhZ2VfdG9fc2VuZDogbnVsbCwKICAgICAgd2hhdHNhcHBfc3RhdHVzOiAnJywKICAgICAgaW5kZXhfdXBkYXRlOiBudWxsLAogICAgICBzZWNvbmRfd2Vic2l0ZTogZmFsc2UsCiAgICAgIHNlbGVjdGVkX2ZpbGVzOiAnJywKICAgICAgbW91c2VfaG92ZXJfdGV4dDogZmFsc2UsCiAgICAgIHZlcnRpY2FsX3R5cGVzOiBbJ0F1dG9tb3RpdmUnLCAnQmVhdXR5JywgJ1NwYSBhbmQgU2Fsb24nLCAnQ2xvdGhpbmcgYW5kIEFwcGFyZWwnLCAnRWR1Y2F0aW9uJywgJ0VudGVydGFpbm1lbnQnLCAnRXZlbnQgUGxhbm5pbmcgYW5kIFNlcnZpY2UnLCAnRmluYW5jZSBhbmQgQmFua2luZycsICdGb29kIGFuZCBHcm9jZXJ5JywgJ1B1YmxpYyBTZXJ2aWNlJywgJ0hvdGVsIGFuZCBMb2RnaW5nJywgJ01lZGljYWwgYW5kIEhlYWx0aCcsICdOb24tcHJvZml0JywgJ1Byb2Zlc3Npb25hbCBTZXJ2aWNlcycsICdTaG9wcGluZyBhbmQgUmV0YWlsJywgJ1RyYXZlbCBhbmQgVHJhbnNwb3J0YXRpb24nLCAnUmVzdGF1cmFudCcsICdPdGhlciddLAogICAgICBjdXJyZW50X2NvbnRhY3RfbnVtYmVyOiBudWxsCiAgICB9LCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgIndoYXRzYXBwX3Bob25lX251bWJlciIsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImlzX2NvbnRhY3RfbGlzdCIsIGZhbHNlKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJjdXJyZW50X2NvbnRhY3RfaW5kZXgiLCBudWxsKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJzZWFyY2hfaW5fY29udGFjdF9saXN0IiwgJycpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImFsbF9jb250YWN0X2xpc3QiLCBbXSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAic3RhcnRfbmV3X2NvbnZfZGF0YSIsIHsKICAgICAgc3RhcnRfbmV3X2NvbnY6IGZhbHNlLAogICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogdHJ1ZQogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAiYWxsX2NvbnRhY3RfcGFnaW5hdGlvbiIsIHsKICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICBwYWdlX25vOiAxLAogICAgICB0b3RhbF9yZWNvcmRzOiAxMAogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAic2VuZF9hdHRhY2htZW50X2RldGFpbCIsIHsKICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICBtZWRpYV9maWxlOiBudWxsLAogICAgICBzaG93X3ByZXZpZXc6IGZhbHNlLAogICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgIG1lZGlhX3R5cGU6IG51bGwsCiAgICAgIHNlbmRfbWVkaWE6IHRydWUsCiAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgIG1lZGlhX2NhcHRpb246IG51bGwKICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImN1cnJlbnRfZnVsbHNjcmVlbl9pbWFnZV9zcmMiLCBudWxsKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJhZGRfbmV3X2NvbnRhY3QiLCB7CiAgICAgIHBob25lX251bWJlcjogbnVsbCwKICAgICAgaXNfYWRkX2NvbnRhY3Q6IHRydWUsCiAgICAgIGNvbnRhY3RfbmFtZTogbnVsbCwKICAgICAgZm9ybWF0dGVkTnVtYmVyOiBudWxsCiAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJhZGRfbmV3X2NvbnRhY3RfZm9ybWF0dGVkX3Bob25lX251bWJlciIsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImZpbGVfZXh0ZW5zaW9ucyIsIHsKICAgICAgYWxsX2FsbG93ZWRfZmlsZV9leHRlbnNpb25zOiBbImltYWdlL3BuZyIsICJpbWFnZS9qcGVnIiwgImFwcGxpY2F0aW9uL3BkZiIsICJ0ZXh0L3BsYWluIiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsICJhcHBsaWNhdGlvbi9tc3dvcmQiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLCAidGV4dC9jc3YiXSwKICAgICAgaW1hZ2VfZmlsZV9leHRlbnNpb25zOiBbImltYWdlL3BuZyIsICJpbWFnZS9qcGVnIl0sCiAgICAgIGRvY3VtZW50X2ZpbGVfZXh0ZW5zaW9uczogWyJhcHBsaWNhdGlvbi9wZGYiLCAidGV4dC9wbGFpbiIsICJhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQiLCAiYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQiLCAiYXBwbGljYXRpb24vbXN3b3JkIiwgImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50IiwgInRleHQvY3N2Il0KICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgIndoYXRzYXBwX3RlbXBsYXRlcyIsIHsKICAgICAgdGVtcGxhdGVzX2xpc3Q6IFtdLAogICAgICBwYWdpbmF0aW9uX2RhdGE6IHsKICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMAogICAgICB9LAogICAgICBzZWxlY3RlZF90ZW1wbGF0ZTogbnVsbCwKICAgICAgcHJldmlld190ZW1wbGF0ZV9kYXRhOiBudWxsCiAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJjb250YWN0X2NzdiIsIHsKICAgICAgZmlsZV9sYWJlbDogJ0Nob29zZSBGaWxlJywKICAgICAgZmlsZV9jb250ZW50OiBudWxsLAogICAgICBmaWxlX3NlbGVjdGVkOiBmYWxzZQogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAid2hhdHNhcHBfZm9ybWF0X2RpY3QiLCB7CiAgICAgICIqIjogWyc8c3Ryb25nPicsICc8L3N0cm9uZz4nXSwKICAgICAgIl8iOiBbJzxpPicsICc8L2k+J10sCiAgICAgICJ+IjogWyc8cz4nLCAnPC9zPiddLAogICAgICAiYGBgIjogWyc8dHQ+JywgJzwvdHQ+J10KICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgIndoYXRzYXBwX2Zvcm1hdGluZ19saXN0IiwgWyIqIiwgIl8iLCAifiIsICJgYGAiXSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAic2hvd19wcm9maWxlX2RpdiIsIGZhbHNlKSwgX3JlZjsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAvLyB0b3RhbF9wYWdlc19sb2FkZWQoKSB7CiAgICAvLyAgIGlmICgodGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyAqIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlKSA+PSB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzKSB7CiAgICAvLyAgICAgcmV0dXJuIHRydWU7CiAgICAvLyAgIH0KICAgIC8vICAgcmV0dXJuIGZhbHNlOwogICAgLy8gfSwKICAgIG1lc3NhZ2VfdGV4dF9ib3hfcGxhY2Vob2xkZXI6IGZ1bmN0aW9uIG1lc3NhZ2VfdGV4dF9ib3hfcGxhY2Vob2xkZXIoKSB7CiAgICAgIHJldHVybiAiU2VuZCBhIG1lc3NhZ2UgdG8gdXNlciI7CiAgICB9LAogICAgcmV0dXJuVmFsdWVzOiBmdW5jdGlvbiByZXR1cm5WYWx1ZXMoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGVnZW5kOiAnY2FuY2VsX2J0bicKICAgICAgfTsKICAgIH0sCiAgICB0b3RhbF9jb250YWN0X2xvYWRlZDogZnVuY3Rpb24gdG90YWxfY29udGFjdF9sb2FkZWQoKSB7CiAgICAgIGlmICh0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyAqIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSA+PSB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcykgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgdHJhbnNpdGlvbl9kYXRhOiBmdW5jdGlvbiB0cmFuc2l0aW9uX2RhdGEoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY291bnRyeVNlbGVjdG9yTGFiZWw6ICIiLmNvbmNhdCh0aGlzLnRsdCgnY291bnRyeV9jb2RlJykpLAogICAgICAgIHBob25lTnVtYmVyTGFiZWw6ICIiLmNvbmNhdCh0aGlzLnRsdCgncGhvbmVfbnVtYmVyJykpCiAgICAgIH07CiAgICB9CiAgfSwKICBiZWZvcmVSb3V0ZUxlYXZlOiBmdW5jdGlvbiBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKTsKICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpOwogICAgdGhpcy5pc19vcGVuID0gZmFsc2U7CiAgICBuZXh0KCk7CiAgfSwKICBiZWZvcmVSb3V0ZUVudGVyOiBmdW5jdGlvbiBiZWZvcmVSb3V0ZUVudGVyKHRvLCBmcm9tLCBuZXh0KSB7CiAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKTsKICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpOwogICAgbmV4dCgpOwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdGhpcy5nZXRfY29udGFjdF9saXN0KHRydWUpOwogICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCh3aW5kb3cpLmJpbmQoJ21vdXNld2hlZWwnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQub3JpZ2luYWxFdmVudC53aGVlbERlbHRhKQogICAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudC53aGVlbERlbHRhID49IDApIHsKICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX2Rvd24gPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gZmFsc2U7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF9kb3duID0gdHJ1ZTsKICAgICAgICB0aGlzLnNjcm9sbF90b3BfY2FsbGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZtLmlzX3BhZ2luYXRlZF9jYWxsID0gZmFsc2U7CiAgICB9KTsgLy8gdmFyIGxhc3RTY3JvbGxUb3AgPSAwOwogICAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigKICAgIC8vICAgInNjcm9sbCIsCiAgICAvLyAgIGZ1bmN0aW9uIChldikgewogICAgLy8gICAgIGlmIChldi50YXJnZXQuaWQgPT09ICJzY3JvbGxpbmctZGl2LXdoYXRzYXBwIikgewogICAgLy8gICAgICAgY29uc29sZS5sb2coZXYpCiAgICAvLyAgICAgICB2YXIgc3QgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsgLy8gQ3JlZGl0czogImh0dHBzOi8vZ2l0aHViLmNvbS9xZXJlbXkvc28vYmxvYi9tYXN0ZXIvc28uZG9tLmpzI0w0MjYiCiAgICAvLyAgICAgICBpZiAoc3QgPiBsYXN0U2Nyb2xsVG9wKXsKICAgIC8vICAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IGZhbHNlOwogICAgLy8gICAgICAgfSBlbHNlIHsKICAgIC8vICAgICAgICAgY29uc29sZS5sb2coIlNjcm9sbGluZyBVcCIpCiAgICAvLyAgICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSB0cnVlOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgbGFzdFNjcm9sbFRvcCA9IHN0IDw9IDAgPyAwIDogc3Q7CiAgICAvLyAgICAgICAvLyB2bS5zY3JvbGxQb3NpdGlvbiA9IGV2LnRhcmdldFsic2Nyb2xsVG9wIl07CiAgICAvLyAgICAgfQogICAgLy8gICB9LAogICAgLy8gICB0cnVlCiAgICAvLyApOwoKICAgICQoIiNzaG93SW1hZ2VNb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICB2bS5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gbnVsbDsKICAgIH0pOwogICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICB2bS5lbXB0eV91cGxvYWRfY3N2X2NvbnRhY3RzKCk7CiAgICB9KTsgLy8gYXhpb3MucG9zdChhcGlfY2FsbHMuaW5pdGlhbGl6ZV93aGF0c2FwcF90b3BpYygpLCAKICAgIC8vIHsKICAgIC8vICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgLy8gICB3aGF0c2FwcF9waG9uZV9udW1iZXI6ICIxMDAiLAogICAgLy8gICB0ZXN0OiBidG9hKCJ0ZXN0X3BhcmFtYXRlciIpCiAgICAvLyB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAvLyB0aGlzLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgLy8gdGhpcy5saXZlX2NoYXRfdG9rZW4gPSByZXNwb25zZS5kYXRhLnRva2VuOwogICAgLy8gdGhpcy5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgLy8gdGhpcy5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQoCiAgICAvLyAgIHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwKICAgIC8vICAgewogICAgLy8gICAgIHBhcmFtczogewogICAgLy8gICAgICAgd2hhdHNhcHA6ICJ0cnVlIiwKICAgIC8vICAgICAgIGVsaXhpcl90b2tlbiA6IHJlc3BvbnNlLmRhdGEuZWxpeGlyX3Rva2VuLAogICAgLy8gICAgICAgdG9rZW46IHRoaXMuc2Vzc2lvbl90b2tlbiwKICAgIC8vICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgIC8vICAgICB9LAogICAgLy8gICB9CiAgICAvLyApOwoKICAgIHRoaXMuY2hhdF9zb2NrZXQgPSBuZXcgU29ja2V0KHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwgewogICAgICBwYXJhbXM6IHsKICAgICAgICB3aGF0c2FwcDogInRydWUiLAogICAgICAgIGp3dDogdGhpcy4kc2Vzc2lvbi5nZXQoImF0IiksCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmNoYXRfc29ja2V0LmNvbm5lY3QoKTsKICAgIHZhciBjb21wYW55X2lkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICB0aGlzLmNoYW5uZWwgPSB0aGlzLmNoYXRfc29ja2V0LmNoYW5uZWwoIndoYXRzYXBwOiIgKyBjb21wYW55X2lkKTsKICAgIHRoaXMuY2hhbm5lbC5qb2luKCk7CiAgICB0aGlzLmNoYW5uZWwub24oIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgZnVuY3Rpb24gKHJlcykgewogICAgICBjb25zb2xlLmxvZyhyZXMpOwoKICAgICAgaWYgKHJlcy5jb21wYW55X2lkID09PSBjb21wYW55X2lkKSB7CiAgICAgICAgLy8gaWYoIXJlcy5pc19ib3RfY29udmVyc2F0aW9uX3JlYWx0aW1lKXsKICAgICAgICAvLyBjb25zb2xlLmxvZygidXNlciBib3QgY29udmVyc2F0aW9uIikKICAgICAgICB2YXIgY29udGFjdF9pbmRleCA9IF90aGlzLmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtLndoYXRzYXBwX3Bob25lX251bWJlciA9PT0gcmVzLndoYXRzYXBwX3Bob25lX251bWJlcjsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHJlcy5CT1RSZXNwb25zZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIGxldCBsYXRlc3RfbWVzc2FnZTsKICAgICAgICAgIC8vIGlmKHJlcy5pc19ib3RfY29udmVyc2F0aW9uX3JlYWx0aW1lKXsKICAgICAgICAgIC8vICAgbGV0IGlzX3RleHQgPSAgcmVzLkJPVFJlc3BvbnNlLmZpbmQoKGl0ZW0pID0+IGl0ZW0udGV4dCAhPSBudWxsKSwKICAgICAgICAgIC8vICAgaXNfcHJvZHVjdCA9IHJlcy5CT1RSZXNwb25zZS5maW5kKChpdGVtKSA9PiAoaXRlbS50ZXh0ID09IG51bGwgJiYgaXRlbS5wcm9kdWN0cykpOwogICAgICAgICAgLy8gICBpZihCb29sZWFuKGlzX3RleHQpKSB7CiAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSBpc190ZXh0LnRleHQ7CiAgICAgICAgICAvLyAgIH0gZWxzZSBpZihCb29sZWFuKGlzX3Byb2R1Y3QpKSB7CiAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSAiUHJvZHVjdCBib3QgcmVzcG9uc2UiCiAgICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSBudWxsCiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAvLyAgIGxhdGVzdF9tZXNzYWdlID0gcmVzLndoYXRzYXBwX21lc3NhZ2U7CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXMsICJlbHNlIiwgY29udGFjdF9pbmRleCkKICAgICAgICAgIGlmIChjb250YWN0X2luZGV4ICE9IC0xKSB7CiAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gcmVzLndoYXRzYXBwX21lc3NhZ2U7CiAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLm5ld19tZXNzYWdlX2NvdW50ID0gMTsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0ID0gX3RoaXMuYXJyYXlfbW92ZShfdGhpcy5jb250YWN0X2xpc3QsIGNvbnRhY3RfaW5kZXgsIDApOyAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleAogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpcy5jaGVja19jdXJyZW50X251bWJlcihyZXMpKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgICAgaWYgKF90aGlzLmhpc3RvcnkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpcy5oaXN0b3J5LnB1c2goewogICAgICAgICAgICAgICJCT1RSZXNwb25zZSI6IFtdLAogICAgICAgICAgICAgICJVc2VyUXVlcnkiOiByZXMud2hhdHNhcHBfbWVzc2FnZSwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAidXNlcl9xdWVyeV9kYXRlIjogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAiVXNlclF1ZXJ5X0RhdGVUaW1lIjogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGxhdGVzdF9tZXNzYWdlLAogICAgICAgICAgICAgIGlzX3RleHQgPSByZXMuQk9UUmVzcG9uc2UuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS50ZXh0ICE9IG51bGw7CiAgICAgICAgICB9KSwKICAgICAgICAgICAgICBpc19wcm9kdWN0ID0gcmVzLkJPVFJlc3BvbnNlLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGV4dCA9PSBudWxsICYmIGl0ZW0ucHJvZHVjdHM7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoQm9vbGVhbihpc190ZXh0KSkgewogICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9IGlzX3RleHQudGV4dDsKICAgICAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbihpc19wcm9kdWN0KSkgewogICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9ICJQcm9kdWN0IGJvdCByZXNwb25zZSI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbnRhY3RfaW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSBsYXRlc3RfbWVzc2FnZTsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSB0cnVlOwogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0ubmV3X21lc3NhZ2VfY291bnQgPSAxOwogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3QgPSBfdGhpcy5hcnJheV9tb3ZlKF90aGlzLmNvbnRhY3RfbGlzdCwgY29udGFjdF9pbmRleCwgMCk7IC8vIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICB9CgogICAgICAgICAgOwoKICAgICAgICAgIGlmIChfdGhpcy5jaGVja19jdXJyZW50X251bWJlcihyZXMpKSB7CiAgICAgICAgICAgIHZhciBfY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgX2N1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwoKICAgICAgICAgICAgdmFyIF9ib3RfcmVzcG9uc2VfZGF0ZSA9IF9jdXJyZW50X2RhdGU7CgogICAgICAgICAgICBpZiAoX3RoaXMuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBfYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBfYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzWyJib3RfcmVzcG9uc2VfZGF0ZSJdID0gX2JvdF9yZXNwb25zZV9kYXRlOwogICAgICAgICAgICByZXNbImJvdF9yZXNwb25zZV90aW1lIl0gPSBfY3VycmVudF90aW1lc3RhbXA7CiAgICAgICAgICAgIHJlc1sidXNlcl9xdWVyeV9kYXRlIl0gPSBfY3VycmVudF9kYXRlOwogICAgICAgICAgICByZXNbInVzZXJfcXVlcnlfdGltZSJdID0gX2N1cnJlbnRfdGltZXN0YW1wOwoKICAgICAgICAgICAgX3RoaXMuaGlzdG9yeS5wdXNoKHJlcyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5zY3JvbGxfZG93bigpOyAvLyB9IGVsc2UgewogICAgICAgIC8vICAgY29uc29sZS5sb2coInJlYWx0aW1lIGNvbnZlcnNhdGlvbiIpCiAgICAgICAgLy8gfQoKICAgICAgfQogICAgfSk7IC8vIH0pCiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoX3ZhbHVlOiBmdW5jdGlvbiBzZWFyY2hfdmFsdWUobmV3VmFsdWUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZyhuZXdWYWx1ZSkKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpIHsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX3N0cmluZzogbmV3VmFsdWUsCiAgICAgICAgICBpc19nZXRfY29udGFjdHM6IHRydWUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChfdGhpczIuYXBpX3N0YXR1c19jb2RlLkNPTlRBQ1RTX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFIHx8IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczIuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczIuY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczIuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdldF9jb250YWN0X2xpc3QoZmFsc2UpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX21lc3NhZ2VfdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaF9tZXNzYWdlX3ZhbHVlKG5ld1ZhbHVlKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiKSB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX3N0cmluZzogbmV3VmFsdWUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMy5zZWFyY2hlZF9tZXNzYWdlID0gW107CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczMuc2VhcmNoZWRfbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5zZWFyY2hfcmVzdWx0OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczMuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlYXJjaGVkX21lc3NhZ2UgPSBbXTsKICAgICAgfQogICAgfSwKICAgIC8vIHRvZ2dsZU1vZGFsKG5ld1ZhbHVlKXsKICAgIC8vICAgaWYobmV3VmFsdWUpewogICAgLy8gICAgIGNvbnNvbGUubG9nKCJuZXcgdmFsdWUiICwgbmV3VmFsdWUpOwogICAgLy8gICAgIHRvZ2dsZURyb3Bkb3duKCk7CiAgICAvLyAgIH0KICAgIC8vIH0sCiAgICAvLyB0b2dnbGVNb2RhbDogewogICAgLy8gICAgaGFuZGxlcjogZnVuY3Rpb24odmFsLCBvbGRWYWwpIHsKICAgIC8vICAgICAgIGlmKHZhbCl7CiAgICAvLyAgICAgY29uc29sZS5sb2coIm5ldyB2YWx1ZSIgLCB2YWwgLCBvbGRWYWwpOwogICAgLy8gICAgIHRoaXMudG9nZ2xlRHJvcGRvd24oKTsKICAgIC8vICAgfS8vIGNhbGwgaXQgaW4gdGhlIGNvbnRleHQgb2YgeW91ciBjb21wb25lbnQgb2JqZWN0CiAgICAvLyAgICB9LAogICAgLy8gICAgZGVlcDogdHJ1ZQogICAgLy8gfSwKICAgIHNlYXJjaF9pbl9jb250YWN0X2xpc3Q6IGZ1bmN0aW9uIHNlYXJjaF9pbl9jb250YWN0X2xpc3QobmV3VmFsdWUpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAobmV3VmFsdWUgIT0gIiIgJiYgbmV3VmFsdWUubGVuZ3RoID4gMikgewogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNC5hbGxfY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczQuYWxsX2NvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNC5hbGxfY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzNC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2V0X2FsbF9jb250YWN0X2xpc3QoKTsKICAgICAgfQogICAgfSwKICAgICd3aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUnOiB7CiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgICAgaWYgKEJvb2xlYW4obmV3VmFsKSkgewogICAgICAgICAgdmFyIGN1cnJlbnRfdGVtcGxhdGUgPSB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdC5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLnRlbXBsYXRlX2lkID09IG5ld1ZhbDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHRlbXBsYXRlX2lkID0gbmV3VmFsOwogICAgICAgICAgdmFyIHZhcmlhYmxlX2RpY3QgPSBjdXJyZW50X3RlbXBsYXRlLnZhcmlhYmxlX2RpY3Q7CiAgICAgICAgICB2YXIgaXNfcGFyZW50X3RlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiBmYWxzZSwKICAgICAgICAgICAgaXNfcHJldmlldzogdHJ1ZSwKICAgICAgICAgICAgaXNfcGFyZW50X3RlbXBsYXRlOiBpc19wYXJlbnRfdGVtcGxhdGUsCiAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB0ZW1wbGF0ZV9pZCwKICAgICAgICAgICAgdmFyaWFibGVfZGljdDogdmFyaWFibGVfZGljdAogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzNS53aGF0c2FwcF90ZW1wbGF0ZXMucHJldmlld190ZW1wbGF0ZV9kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVVNFUl9MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBfdGhpczUudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM1LnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczUudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnJyksCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczUudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI2QzMycKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczUuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnU2V0dGluZ3MnLAogICAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBoaWdobGlnaHRfdGV4dDogZnVuY3Rpb24gaGlnaGxpZ2h0X3RleHQodXNlclF1ZXJ5KSB7CiAgICAgIHZhciBjbGFzc25hbWUgPSAiIjsKCiAgICAgIGlmICh1c2VyUXVlcnkgPT09IHRoaXMuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCkgewogICAgICAgIGNsYXNzbmFtZSA9ICJhZGQtaGlnaGxpZ2h0IjsKICAgICAgICByZXR1cm4gY2xhc3NuYW1lOwogICAgICB9CgogICAgICByZXR1cm4gY2xhc3NuYW1lOwogICAgfSwKICAgIHJlZnJlc2hQb3BvdmVyOiBmdW5jdGlvbiByZWZyZXNoUG9wb3ZlcigpIHsKICAgICAgaWYgKHRoaXMuaXNfb3BlbiA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuaXNfb3BlbiA9PT0gZmFsc2UpIHsKICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKTsgLy8gJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdzaG93JykKCiAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKHsKICAgICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgICB0aXRsZTogIiIuY29uY2F0KHRoaXMudGx0KCd3aGF0c2FwcF93ZWJ2aWV3X2xlZ2VuZCcpKSwKICAgICAgICAgIGNvbnRlbnQ6ICI8c3BhbiBzdHlsZT0nY29sb3I6IzI1YWYwMjtmb250LXNpemU6IGxhcmdlcjsnPiYjeDI1Q0Y7PC9zcGFuPiA8c3Bhbj4gIi5jb25jYXQodGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfY29udGFjdF9vbl93aGF0c2FwcCcpLCAiIDwvc3Bhbj4gPGJyPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9J2NvbG9yOiNmZjQ3NDc7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+ICIpLmNvbmNhdCh0aGlzLnRsdCgnd2hhdHNhcHBfd2Vidmlld19jb250YWN0X25vdF9vbl93aGF0c2FwcCcpLCAiPC9zcGFuPiA8YnI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0nY29sb3I6I2ZmYzM0Nztmb250LXNpemU6IGxhcmdlcjsnPiYjeDI1Q0Y7PC9zcGFuPiA8c3Bhbj4gIikuY29uY2F0KHRoaXMudGx0KCd3aGF0c2FwcF93ZWJ2aWV3X2NvbnRhY3RfZG9udF9rbm93X29uX3doYXRzYXBwJyksICI8L3NwYW4+IikKICAgICAgICB9KTsKICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ3Nob3cnKTsKICAgICAgICB0aGlzLmlzX29wZW4gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpOwogICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpOwogICAgICAgIHRoaXMuaXNfb3BlbiA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgY2xvc2VNb2RlbDogZnVuY3Rpb24gY2xvc2VNb2RlbChlKSB7CiAgICAgIC8vY29uc29sZS5sb2coZS50YXJnZXQuY2xhc3NMaXN0ICwgIiBjYWxsaW5nIG1vZGFsIikKICAgICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2xlZ2VuZF93aGF0c2FwcCcpKSB7CiAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJyk7CiAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdoaWRlJyk7CiAgICAgICAgdGhpcy5pc19vcGVuID0gZmFsc2U7CiAgICAgIH0gLy8gaWYoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZHJvcGRvd25NZW51QnV0dG9uT25lJykpewogICAgICAvLyB9CgoKICAgICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImJ0biIpICYmICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImJpLXRocmVlLWRvdHMtdmVydGljYWwiKSAmJiAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJjdXN0b21lci1uYW1lIikgJiYgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYnRuIikpIHsKICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMudG9nZ2xlTW9kYWwyLCJiZWZvcmUgY2xvc2luZyBtb2RhbCIpCiAgICAgICAgdmFyIGRyb3Bkb3duUGFyZW50MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudDInKTsKICAgICAgICB2YXIgZHJvcGRvd25NZW51MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnUyJyk7CiAgICAgICAgdmFyIGRyb3Bkb3duTWVudUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b24yJyk7CiAgICAgICAgdmFyIGRyb3Bkb3duUGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGFyZW50Jyk7CiAgICAgICAgdmFyIGRyb3Bkb3duTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnUnKTsKICAgICAgICB2YXIgZHJvcGRvd25NZW51QnV0dG9uT25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbk9uZScpOwoKICAgICAgICBpZiAoZHJvcGRvd25QYXJlbnQyICYmIGRyb3Bkb3duTWVudTIgJiYgZHJvcGRvd25NZW51QnV0dG9uICYmIHRoaXMudG9nZ2xlTW9kYWwyKSB7CiAgICAgICAgICBkcm9wZG93blBhcmVudDIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgZHJvcGRvd25NZW51Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICBkcm9wZG93bk1lbnVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgICAgIGRyb3Bkb3duTWVudTIucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwyID0gZmFsc2U7IC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIgLCAiYWZ0ZXIgY2xvc2luZyBtb2RhbCAtLS0tLS0tLSIpCiAgICAgICAgfQoKICAgICAgICBpZiAoZHJvcGRvd25NZW51ICYmIGRyb3Bkb3duUGFyZW50ICYmIGRyb3Bkb3duTWVudUJ1dHRvbk9uZSAmJiB0aGlzLnRvZ2dsZU1vZGFsKSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCItLS0iICwgImluc2lkZSBkcm9wZG93biIpCiAgICAgICAgICBkcm9wZG93bk1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgZHJvcGRvd25QYXJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJyk7CiAgICAgICAgICBkcm9wZG93bk1lbnUucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcGVuU2VhcmNoRGl2OiBmdW5jdGlvbiBvcGVuU2VhcmNoRGl2KCkgewogICAgICB0aGlzLmlzX3NlYXJjaF9kaXZfb3BlbiA9IHRydWU7CiAgICAgIHZhciBjaGF0X2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0X2RpdicpOwogICAgICBjaGF0X2Rpdi5jbGFzc0xpc3QucmVtb3ZlKCdjb2wtc20tOCcpOwogICAgICBjaGF0X2Rpdi5jbGFzc0xpc3QuYWRkKCdjb2wtc20tNCcpOwogICAgICB2YXIgc2VhcmNoX2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hfZGl2Jyk7CiAgICAgIHNlYXJjaF9kaXYuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgdmFyIGJvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpOwogICAgICBib3RfbXNnLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoInJlc3BvbnNpdmUtd2lkdGgiKTsKICAgICAgfSk7CiAgICAgIHZhciBwcmV2aWV3X2J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNwcmV2aWV3LWJ0biIpOwogICAgICBwcmV2aWV3X2J0bi5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtc20tMTEiKTsKICAgICAgfSk7CiAgICAgIHZhciBib3RfY2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5ib3QtcmVzcCIpOwogICAgICBib3RfY2FyZC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtNyIpOwogICAgICB9KTsKICAgICAgdmFyIGVtb2ppX2ZpbGVzaGFyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbW9qaV9maWxlc2hhcmUnKTsKCiAgICAgIGlmIChlbW9qaV9maWxlc2hhcmUpIHsKICAgICAgICBlbW9qaV9maWxlc2hhcmUuc3R5bGUud2lkdGggPSAiMTklIjsKICAgICAgfQogICAgfSwKICAgIGNsb3NlU2VhcmNoRGl2OiBmdW5jdGlvbiBjbG9zZVNlYXJjaERpdigpIHsKICAgICAgdGhpcy5pc19zZWFyY2hfZGl2X29wZW4gPSBmYWxzZTsKICAgICAgdmFyIGNoYXRfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRfZGl2Jyk7CiAgICAgIGNoYXRfZGl2LmNsYXNzTGlzdC5hZGQoJ2NvbC1zbS04Jyk7CiAgICAgIGNoYXRfZGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbC1zbS00Jyk7CiAgICAgIHZhciBzZWFyY2hfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaF9kaXYnKTsKICAgICAgc2VhcmNoX2Rpdi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICB0aGlzLnNlYXJjaGVkX21lc3NhZ2UgPSBbXTsKICAgICAgdGhpcy5zZWFyY2hfbWVzc2FnZV92YWx1ZSA9ICIiOwogICAgICB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQgPSBudWxsOwogICAgICB2YXIgYm90X21zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNtc2ctZGl2Iik7CiAgICAgIGJvdF9tc2cuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgicmVzcG9uc2l2ZS13aWR0aCIpOwogICAgICB9KTsKICAgICAgdmFyIHByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIik7CiAgICAgIHByZXZpZXdfYnRuLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoImNvbC1zbS0xMSIpOwogICAgICB9KTsKICAgICAgdmFyIGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIik7CiAgICAgIGJvdF9jYXJkLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiLS0tcnVuLS0tIikKICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoImNvbC03Iik7CiAgICAgIH0pOwogICAgICB2YXIgZW1vamlfZmlsZXNoYXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vtb2ppX2ZpbGVzaGFyZScpOwoKICAgICAgaWYgKGVtb2ppX2ZpbGVzaGFyZSkgewogICAgICAgIGVtb2ppX2ZpbGVzaGFyZS5zdHlsZS53aWR0aCA9ICI4JSI7CiAgICAgIH0KICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIHRoaXMuaGlzdG9yeSA9IFtdLCB0aGlzLnBob25lbm8gPSBudWxsOwogICAgICB0aGlzLmN1c3RvbWVyX25hbWUgPSAiIjsKICAgICAgdGhpcy5jaGF0X2RldGFpbHMgPSBbXTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UgPSAxMDsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyA9IDE7CiAgICAgIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSAxMDsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZCA9IFtdOwogICAgICB0aGlzLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gbnVsbDsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBlcl9wYWdlID0gMTA7CiAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vID0gMTsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSAxMDsKICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsID0gewogICAgICAgIG1lZGlhX2ZpbGVfbmFtZTogbnVsbCwKICAgICAgICBtZWRpYV9maWxlOiBudWxsLAogICAgICAgIHNob3dfcHJldmlldzogZmFsc2UsCiAgICAgICAgbWVkaWFfY29udGVudF90eXBlOiBudWxsLAogICAgICAgIG1lZGlhX3R5cGU6IG51bGwsCiAgICAgICAgc2VuZF9tZWRpYTogdHJ1ZSwKICAgICAgICBkb2N1bWVudF9jb250ZW50OiBudWxsLAogICAgICAgIG1lZGlhX2NhcHRpb246IG51bGwKICAgICAgfTsKICAgIH0sCiAgICByZXNldF9jdXJzb3JfcG9zaXRpb246IGZ1bmN0aW9uIHJlc2V0X2N1cnNvcl9wb3NpdGlvbigpIHsKICAgICAgdGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IG51bGw7CiAgICB9LAogICAgdG9nZ2xlRW1vamlQaWNrZXI6IGZ1bmN0aW9uIHRvZ2dsZUVtb2ppUGlja2VyKCkgewogICAgICB0aGlzLnNob3dFbW9qaVBpY2tlciA9ICF0aGlzLnNob3dFbW9qaVBpY2tlcjsKICAgIH0sCiAgICBhcHBlbmRfb25fY2hhdDogZnVuY3Rpb24gYXBwZW5kX29uX2NoYXQoZW1vamksIGlkKSB7CiAgICAgIHZhciB0ZXh0YXJlYSA9IHRoaXMuJHJlZnMudGV4dGFyZWE7CiAgICAgIHZhciBjaGF0X3ZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3doYXRzYXBwX3RleHRfaW5wdXRfYm94JykudmFsdWU7CiAgICAgIHZhciBjdXJzb3JQb3MgPSB0ZXh0YXJlYS5zZWxlY3Rpb25FbmQ7IC8vIHZhciBjdXJzb3JQb3NpdGlvbiA9IHRleHRhcmVhLnNlbGVjdGlvbkVuZAogICAgICAvLyBsZXQgdiA9ICQoIiMiICsgaWQpLnZhbCgpOwoKICAgICAgaWYgKHRoaXMub2xkQ3Vyc29yUG9zaXRpb24pIHsKICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IGNoYXRfdmFsdWUuc3Vic3RyaW5nKDAsIHRoaXMub2xkQ3Vyc29yUG9zaXRpb24pOwogICAgICAgIHZhciB0ZXh0QWZ0ZXIgPSBjaGF0X3ZhbHVlLnN1YnN0cmluZyh0aGlzLm9sZEN1cnNvclBvc2l0aW9uLCBjaGF0X3ZhbHVlLmxlbmd0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRleHRCZWZvcmUgPSBjaGF0X3ZhbHVlLnN1YnN0cmluZygwLCBjdXJzb3JQb3MpOwogICAgICAgIHZhciB0ZXh0QWZ0ZXIgPSBjaGF0X3ZhbHVlLnN1YnN0cmluZyhjdXJzb3JQb3MsIGNoYXRfdmFsdWUubGVuZ3RoKTsKICAgICAgfQoKICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgICF0aGlzLm9sZEN1cnNvclBvc2l0aW9uID8gdGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IGN1cnNvclBvcyArIDIgOiB0aGlzLm9sZEN1cnNvclBvc2l0aW9uID0gdGhpcy5vbGRDdXJzb3JQb3NpdGlvbiArIDI7CiAgICB9LAogICAgZ2V0X2hpc3RvcnlfZGF0YTogZnVuY3Rpb24gZ2V0X2hpc3RvcnlfZGF0YSh3aGF0c2FwcF9ubywgdXNlcl9uYW1lLCBjb250YWN0X2luZGV4LCBjb250YWN0KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2coInJ1bm5uIikKICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuY3VzdG9tZXJfbmFtZSA9IHRoaXMuZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lKGNvbnRhY3QpOyAvLyB0aGlzLmN1c3RvbWVyX25hbWUgPSB1c2VyX25hbWU7CgogICAgICB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB3aGF0c2FwcF9ubzsKICAgICAgdGhpcy5zaG93X3NlbmRfbWVzc2FnZSA9IGZhbHNlOwogICAgICB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IGNvbnRhY3RfaW5kZXg7CiAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSBmYWxzZTsKICAgICAgdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHdoYXRzYXBwX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICBwYWdlX25vOiAxCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczYuc2hvd19zZW5kX21lc3NhZ2UgPSB0cnVlOwogICAgICAgIF90aGlzNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM2LnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSB0cnVlOwogICAgICAgICAgX3RoaXM2Lm5ld19jb252X2NvbnRhY3RfZGF0YSA9IGNvbnRhY3Q7CiAgICAgICAgICBfdGhpczYucGhvbmVubyA9IHdoYXRzYXBwX25vOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczYuaGlzdG9yeSA9IF90aGlzNi5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmRhdGEuY2hhdF9oaXN0b3J5KTsKICAgICAgICAgIF90aGlzNi5waG9uZW5vID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Bob25lX251bWJlciB8fCB3aGF0c2FwcF9ubzsgLy8gY29uc29sZS5sb2codGhpcy5waG9uZW5vLCB0aGlzLmNvbnRhY3RfbGlzdCk7CgogICAgICAgICAgdmFyIGNvbnRhY3RfbGlzdF9pbmRleCA9IF90aGlzNi5jb250YWN0X2xpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLndoYXRzYXBwX3Bob25lX251bWJlciA9PSBfdGhpczYucGhvbmVubzsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChjb250YWN0X2xpc3RfaW5kZXggPj0gMSkgewogICAgICAgICAgICAvLyB0aGlzLmNvbnRhY3RfbGlzdCA9IHRoaXMuYXJyYXlfbW92ZSh0aGlzLmNvbnRhY3RfbGlzdCwgY29udGFjdF9saXN0X2luZGV4LCAwKTsKICAgICAgICAgICAgX3RoaXM2LmN1cnJlbnRfY29udGFjdF9pbmRleCA9IGNvbnRhY3RfbGlzdF9pbmRleDsKICAgICAgICAgICAgX3RoaXM2LmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSBfdGhpczYucGhvbmVubzsgLy8gdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9saXN0X2luZGV4XS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzNi5jdXJyZW50X3BhZ2Vfbm8gPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZTsKICAgICAgICAgIF90aGlzNi5sYXRlc3RfcGFnZV9ubyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlOwogICAgICAgICAgX3RoaXM2Lm1lc3NhZ2VfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09PSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSkgewogICAgICAgICAgICBfdGhpczYudG90YWxfcGFnZXNfbG9hZGVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJlbHNlIikKICAgICAgICAgICAgX3RoaXM2LnRvdGFsX3BhZ2VzX2xvYWRlZCA9IGZhbHNlOwogICAgICAgICAgfSAvLyAgY29uc29sZS5sb2codGhpcy50b3RhbF9wYWdlc19sb2FkZWQpCgoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczYuc2Nyb2xsX2Rvd24oKTsKCiAgICAgICAgICAgIF90aGlzNi5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgICAgICAgIF90aGlzNi5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gZmFsc2U7CgogICAgICAgICAgICBfdGhpczYuY2hhdFNjcm9sbE1lc3NhZ2VzKHRydWUpOwoKICAgICAgICAgICAgX3RoaXM2LnNjcm9sbF90b3BfY2FsbGVkID0gZmFsc2U7CiAgICAgICAgICB9LCA0MDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczYuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gZ2V0X3NlYXJjaGVkX2NoYXRfaW50ZXJtZWRpYXRlX2Z1bmN0aW9uKHRpbWUpewogICAgLy8gICBjb25zb2xlLmxvZyh0aW1lICwgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyKQogICAgLy8gICB0aGlzLmdldF9zZWFyY2hlZF9jaGF0X2RhdGEoIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciAsdGltZSkKICAgIC8vIH0sCiAgICAvLyBoaWdobGlnaHRfdGV4dCgpewogICAgLy8gICAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCA9IHRoaXMuc2VhcmNoZWRfbWVzc2FnZVtpbmRleF0uc2VhcmNoX3RleHQKICAgIC8vICAgICAgICAgICBsZXQgdGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiN0ZXh0IikKICAgIC8vICAgICAgICAgICB0ZXh0LmZvckVhY2goZWxlbT0+ewogICAgLy8gICAgICAgICAgICAgaWYoZWxlbS50ZXh0Q29udGVudC50cmltKCkgPT09IHNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQudHJpbSgpKXsKICAgIC8vICAgICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdhZGRfaGlnaGxpZ2h0JykKICAgIC8vICAgICAgICAgICAgICAgY29uc29sZS5sb2coImdvdGNoYSBpbnNpZGUgaWYiICwgZWxlbS5jbGFzc0xpc3QgLCBzZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkKQogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgIH0pOwogICAgLy8gfSwKICAgIGdldF9zZWFyY2hlZF9jaGF0X2RhdGE6IGZ1bmN0aW9uIGdldF9zZWFyY2hlZF9jaGF0X2RhdGEod2hhdHNhcHBfbm8sIHRpbWUsIGluZGV4KSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2coImluZGV4IixpbmRleCkKICAgICAgLy8gdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOyAvLyB0aGlzLmN1c3RvbWVyX25hbWUgPSB0aGlzLmdldF9jb250YWN0X2Rpc3BsYXlfbmFtZShjb250YWN0KTsKICAgICAgLy8gLy8gdGhpcy5jdXN0b21lcl9uYW1lID0gdXNlcl9uYW1lOwogICAgICAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB3aGF0c2FwcF9ubzsKCiAgICAgIHRoaXMuc2hvd19zZW5kX21lc3NhZ2UgPSBmYWxzZTsgLy8gdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBjb250YWN0X2luZGV4OwogICAgICAvLyB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gZmFsc2U7CiAgICAgIC8vIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgZ2V0X2J5X3doYXRzYXBwX3Bob25lX251bWJlcjogdHJ1ZSwKICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogd2hhdHNhcHBfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgIGlzX2dldF9zZWFyY2g6IHRydWUsCiAgICAgICAgbWVzc2FnZV9kYXRldGltZTogdGltZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coInJhbm5uIik7CiAgICAgICAgX3RoaXM3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIF90aGlzNy5zaG93X3NlbmRfbWVzc2FnZSA9IHRydWU7CgogICAgICAgIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIHJldHVybjsgLy8gICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSB0cnVlOwogICAgICAgICAgLy8gICB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YSA9IGNvbnRhY3Q7CiAgICAgICAgICAvLyB0aGlzLnBob25lbm8gPSB3aGF0c2FwcF9ubzsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5oaXN0b3J5ICwgImJlZm9yZSIpCiAgICAgICAgICAvLyB0aGlzLmhpc3RvcnkgPSAiIjsKICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgX3RoaXM3Lmhpc3RvcnkgPSBfdGhpczcuZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2UocmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRfaGlzdG9yeSk7CiAgICAgICAgICBfdGhpczcuY3VycmVudF9wYWdlX25vID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2U7CiAgICAgICAgICBfdGhpczcubGF0ZXN0X3BhZ2Vfbm8gPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZTsgLy8gY29uc29sZS5sb2codGhpcy5jdXJyZW50X3BhZ2Vfbm8gLCAiY3VycmVudCBzZXQiKQoKICAgICAgICAgIF90aGlzNy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZCA9IFtyZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZV07IC8vIHRoaXMucGhvbmVubyA9IHJlc3BvbnNlLmRhdGEuZGF0YS53aGF0c2FwcF9waG9uZV9udW1iZXIgfHwgd2hhdHNhcHBfbm87CiAgICAgICAgICAvLyAvLyBjb25zb2xlLmxvZyh0aGlzLnBob25lbm8sIHRoaXMuY29udGFjdF9saXN0KTsKICAgICAgICAgIC8vIGxldCBjb250YWN0X2xpc3RfaW5kZXggPSB0aGlzLmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLndoYXRzYXBwX3Bob25lX251bWJlciA9PSB0aGlzLnBob25lbm8pOwogICAgICAgICAgLy8gaWYoY29udGFjdF9saXN0X2luZGV4ID49IDEpewogICAgICAgICAgLy8gICAvLyB0aGlzLmNvbnRhY3RfbGlzdCA9IHRoaXMuYXJyYXlfbW92ZSh0aGlzLmNvbnRhY3RfbGlzdCwgY29udGFjdF9saXN0X2luZGV4LCAwKTsKICAgICAgICAgIC8vICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPWNvbnRhY3RfbGlzdF9pbmRleDsKICAgICAgICAgIC8vICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID0gdGhpcy5waG9uZW5vOwogICAgICAgICAgLy8gICAvLyB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2xpc3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAvLyB9CgogICAgICAgICAgX3RoaXM3Lm1lc3NhZ2VfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICBfdGhpczcuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgICAgX3RoaXM3LmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICAgIF90aGlzNy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKCiAgICAgICAgICBfdGhpczcuY2hhdFNjcm9sbE1lc3NhZ2VzKGZhbHNlKTsKCiAgICAgICAgICBfdGhpczcuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCA9IF90aGlzNy5zZWFyY2hlZF9tZXNzYWdlW2luZGV4XS5zZWFyY2hfdGV4dDsgLy8gIGNvbnNvbGUubG9nKHRoaXMuc2VhcmNoZWRfbWVzc2FnZVtpbmRleF0gLCAiaW5kZXgiICwgaW5kZXgpOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PT0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImlmIikKICAgICAgICAgICAgX3RoaXM3LnRvdGFsX3BhZ2VzX2xvYWRlZCA9IHRydWU7CiAgICAgICAgICAgIF90aGlzNy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX2Rvd24gPSB0cnVlOwogICAgICAgICAgICBfdGhpczcuc2Nyb2xsX3RvcF9jYWxsZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImVsc2UiKQogICAgICAgICAgICBfdGhpczcudG90YWxfcGFnZXNfbG9hZGVkID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzNy5zY3JvbGxfdG9wX2NhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczcuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBsZXQgdGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiN0ZXh0IikKICAgICAgICAgICAgLy8gdGV4dC5mb3JFYWNoKGVsZW09PnsKICAgICAgICAgICAgLy8gICBpZihlbGVtLnRleHRDb250ZW50LnRyaW0oKSA9PT0gdGhpcy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkLnRyaW0oKSl7CiAgICAgICAgICAgIC8vICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2FkZF9oaWdobGlnaHQnKQogICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coImdvdGNoYSBpbnNpZGUgaWYiICwgZWxlbS5jbGFzc0xpc3QgLCB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQpCiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkX21zZyA9IF90aGlzNy5zZWFyY2hlZF9tZXNzYWdlW2luZGV4XS5kYXRlX3RpbWU7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3RlZF9tc2cpOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkX2RpdikgewogICAgICAgICAgICAgIHNlbGVjdGVkX2Rpdi5zY3JvbGxJbnRvVmlldyh7CiAgICAgICAgICAgICAgICBiZWhhdmlvcjogInNtb290aCIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyAgY29uc29sZS5sb2coc2VsZWN0ZWRfZGl2ICwgc2VsZWN0ZWRfbXNnICk7CgogICAgICAgICAgfSwgNDAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIGNvbnNvbGUubG9nKGUsICdlZWVlZScpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9jb250YWN0X2xpc3Q6IGZ1bmN0aW9uIGdldF9jb250YWN0X2xpc3QoZW5hYmxlX2JvdF9yZXNwb25zZXMpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgIGlzX2dldF9jb250YWN0czogdHJ1ZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBlbmFibGVfYm90X3Jlc3BvbnNlX2FsbDogZW5hYmxlX2JvdF9yZXNwb25zZXMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgfHwgX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczguY29udGFjdF9saXN0ID0gW107CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOC5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczguc2hvd19zcGlubmVyID0gZmFsc2U7IC8vIHRoaXMuY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5jb250YWN0czsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczguc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2Nyb2xsX2Rvd246IGZ1bmN0aW9uIHNjcm9sbF9kb3duKCkgewogICAgICAvLyBjb25zb2xlLmxvZygiLS0tLXNjcm9sbGxsIik7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKCiAgICAgICAgaWYgKEJvb2xlYW4oY29udGFpbmVyLnNjcm9sbEhlaWdodCkpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaGVyZSBzY3IiKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIGNvbnRhaW5lci5zY3JvbGxUb3AgLCAgY29udGFpbmVyLnNjcm9sbEhlaWdodCk7CiAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0IC0gNTAwOwogICAgICAgICAgfSwgMTAwKTsgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9LCAxMDApOwogICAgfSwKICAgIHNjcm9sbF90b3A6IGZ1bmN0aW9uIHNjcm9sbF90b3AoKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKCiAgICAgICAgaWYgKEJvb2xlYW4oY29udGFpbmVyLnNjcm9sbEhlaWdodCkpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodCAqIDAuMDE1OwogICAgICAgICAgfSwgMTAwKTsgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9LCAxMDApOwogICAgfSwKICAgIHNjcm9sbF9taWRkbGU6IGZ1bmN0aW9uIHNjcm9sbF9taWRkbGUoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJtaWRkbGUgcnVubmluZyIpCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKCiAgICAgICAgaWYgKEJvb2xlYW4oY29udGFpbmVyLnNjcm9sbEhlaWdodCkpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodCAqIDAuMjU7CiAgICAgICAgICB9LCAxMDApOyAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgc2Nyb2xsX2Rvd25fZWZmZWN0OiBmdW5jdGlvbiBzY3JvbGxfZG93bl9lZmZlY3QoKSB7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsgLy8gY29uc29sZS5sb2coY29udGFpbmVyKTsKCiAgICAgIGlmIChCb29sZWFuKGNvbnRhaW5lcikpIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSAxMDsKICAgICAgICB9LCAwKTsgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBwcm9kdWN0X3ZhcmlhdGlvbjogZnVuY3Rpb24gcHJvZHVjdF92YXJpYXRpb24ocHJvZHVjdHNfbGlzdCkgewogICAgICB2YXIgbmV3X3Byb2R1Y3RfbGlzdCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSBpbiBwcm9kdWN0c19saXN0KSB7CiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBwcm9kdWN0c19saXN0W2ldLnRlbXBsYXRlLmNvbXBvbmVudHM7CiAgICAgICAgdmFyIHRlbXAgPSB7fTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAodmFyIGogaW4gY29tcG9uZW50cykgewogICAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgICAgdGVtcFsiaW1nX3VybCJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzBdLmltYWdlLmxpbms7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChqID09IDEpIHsKICAgICAgICAgICAgICB0ZW1wWyJ0aXRsZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzBdLnRleHQ7CgogICAgICAgICAgICAgIGlmIChjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMubGVuZ3RoID09IDIpIHsKICAgICAgICAgICAgICAgIHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsKICAgICAgICAgICAgICAgIHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICB0ZW1wWyJ2YXJpYXRpb24iXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1sxXS50ZXh0OwogICAgICAgICAgICAgICAgdGVtcFsicHJpY2UiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1syXS50ZXh0OwogICAgICAgICAgICAgIH0gLy8gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAzID8gdGVtcFsidmFyaWF0aW9uIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsgdGVtcFsicHJpY2UiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1sxXS50ZXh0OiBudWxsOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGogPT0gMikgewogICAgICAgICAgICAgIHRlbXBbInVybCJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzBdLnRleHQ7CiAgICAgICAgICAgICAgdGVtcFsidHlwZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLnR5cGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikge30KCiAgICAgICAgbmV3X3Byb2R1Y3RfbGlzdC5wdXNoKHRlbXApOwogICAgICB9CgogICAgICByZXR1cm4gbmV3X3Byb2R1Y3RfbGlzdDsKICAgIH0sCiAgICBjaGVja19pbWFnZV90eXBlOiBmdW5jdGlvbiBjaGVja19pbWFnZV90eXBlKGltYWdlKSB7CiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGltYWdlICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBpbWFnZS5zcmM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB0cmltX2NhcmRfZGVzY3JpcHRpb246IGZ1bmN0aW9uIHRyaW1fY2FyZF9kZXNjcmlwdGlvbih0ZXh0KSB7CiAgICAgIGlmIChCb29sZWFuKHRleHQpKSB7CiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwKSB7CiAgICAgICAgICB2YXIgc3RyaW5nX3RleHQgPSB0ZXh0LnN1YnN0cmluZygwLCA4MCkgKyAiLi4uIjsKICAgICAgICAgIHJldHVybiBzdHJpbmdfdGV4dDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZXh0OwogICAgICB9CiAgICB9LAogICAgbGF0ZXN0X2JvdF90ZXh0OiBmdW5jdGlvbiBsYXRlc3RfYm90X3RleHQodGV4dCkgewogICAgICBpZiAoIUJvb2xlYW4odGV4dCkpIHsKICAgICAgICByZXR1cm4gIkN1c3RvbSBib3QgUmVzcG9uc2UiOwogICAgICB9CgogICAgICBpZiAodGV4dC5sZW5ndGggPiAzNSkgewogICAgICAgIHJldHVybiAiIi5jb25jYXQodGV4dC5zdWJzdHJpbmcoMCwgMzUpLCAiLi4uIik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0ZXh0OwogICAgfSwKICAgIHNlYXJjaF9jb250YWN0X2xpc3Q6IGZ1bmN0aW9uIHNlYXJjaF9jb250YWN0X2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX3ZhbHVlID09ICIiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFjdF9saXN0OwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBuZXdfdmFsID0gdGhpcy5zZWFyY2hfdmFsdWU7CgogICAgICAgIGlmIChuZXdfdmFsICE9IHRoaXMuc2VhcmNoX3ZhbHVlKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlYXJjaF92YWx1ZSk7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF9zdHJpbmc6IHRoaXMuc2VhcmNoX3ZhbHVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczkuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOS5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM5LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RfbGlzdDsKICAgICAgfQogICAgfSwKICAgIGNoYXRTY3JvbGxNZXNzYWdlczogZnVuY3Rpb24gY2hhdFNjcm9sbE1lc3NhZ2VzKHNjcm9sbF9kb3duKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQpOwogICAgICBpZiAodGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLmlzX3NlYXJjaF9kaXZfb3BlbikgewogICAgICAgICAgdmFyIGJvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpOwogICAgICAgICAgYm90X21zZy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgicmVzcG9uc2l2ZS13aWR0aCIpOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgcHJldmlld19idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjcHJldmlldy1idG4iKTsKICAgICAgICAgIHByZXZpZXdfYnRuLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtc20tMTEiKTsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIik7CiAgICAgICAgICBib3RfY2FyZC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgiY29sLTciKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2JvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpOwoKICAgICAgICAgIF9ib3RfbXNnLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJyZXNwb25zaXZlLXdpZHRoIik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB2YXIgX3ByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIik7CgogICAgICAgICAgX3ByZXZpZXdfYnRuLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJjb2wtc20tMTEiKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBfYm90X2NhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuYm90LXJlc3AiKTsKCiAgICAgICAgICBfYm90X2NhcmQuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoImNvbC03Iik7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJtZXNzYWdlLXRhYmxlLXNjcm9sbCIpWzBdLnNjcm9sbFRvcDsKICAgICAgICB2YXIgY29udGFpbmVyX2Rpdl9zY3JvbGxfaGVpZ2h0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgibWVzc2FnZS10YWJsZS1zY3JvbGwiKVswXS5zY3JvbGxIZWlnaHQgLSA0OTM7IC8vIGNvbnNvbGUubG9nKHRoaXMuc2Nyb2xsX3RvcF9jYWxsZWQgLCAidG9wIik7CiAgICAgICAgLy8gICBjb25zb2xlLmxvZyh0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICwgInBhZ2luYXRlZCBjYWxsIHZhciAiKQogICAgICAgIC8vIGNvbnNvbGUubG9nKGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA8IDIwICwgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID09PSB0cnVlICwgIXRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgLCAhdGhpcy50b3RhbF9wYWdlc19sb2FkZWQgLCAiY2hlY2sgZm9yIHVwIikKICAgICAgICAvLyAgY29uc29sZS5sb2coY29udGFpbmVyX2Rpdl9zY3JvbGxfdG9wID4gY29udGFpbmVyX2Rpdl9zY3JvbGxfaGVpZ2h0ICwgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX2Rvd24gPT09IHRydWUgLCAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAsIHRoaXMuY3VycmVudF9wYWdlX25vID4gMSAsICJjaGVjayBmb3IgZG93biIpCgogICAgICAgIGlmIChjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPCAyMCAmJiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPT09IHRydWUgJiYgIXRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgJiYgIXRoaXMudG90YWxfcGFnZXNfbG9hZGVkKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYXBpIGNhbGwgcGFnaW5hdGVkIiwgdGhpcy5jdXJyZW50X3BhZ2Vfbm8pCiAgICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMuY3VycmVudF9wYWdlX25vICsgMQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIF90aGlzMTAuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczEwLmlzX3BhZ2luYXRlZF9jYWxsID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIGlmICghX3RoaXMxMC5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5pbmNsdWRlcyhyZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSkpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdfZGF0YSA9IF90aGlzMTAuZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2UocmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRfaGlzdG9yeSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMC5oaXN0b3J5ID0gbmV3X2RhdGEuY29uY2F0KF90aGlzMTAuaGlzdG9yeSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMC5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5wdXNoKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKTsgLy8gY29uc29sZS5sb2codGhpcy5oaXN0b3J5KTsKCgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09PSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSkgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnRvdGFsX3BhZ2VzX2xvYWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnRvdGFsX3BhZ2VzX2xvYWRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMTAuY3VycmVudF9wYWdlX25vICs9IDE7CgogICAgICAgICAgICAgICAgaWYgKHNjcm9sbF9kb3duID09IHRydWUgfHwgX3R5cGVvZihzY3JvbGxfZG93bikgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2Nyb2xsX21pZGRsZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsvLyB0aGlzLnNjcm9sbF9kb3duX2VmZmVjdCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHt9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxMC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoY29udGFpbmVyX2Rpdl9zY3JvbGxfdG9wID4gY29udGFpbmVyX2Rpdl9zY3JvbGxfaGVpZ2h0ICYmIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF9kb3duID09PSB0cnVlICYmICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICYmIHRoaXMubGF0ZXN0X3BhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMubGF0ZXN0X3BhZ2Vfbm8gLSAxCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgX3RoaXMxMC5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMTAuaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgaWYgKCFfdGhpczEwLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLmluY2x1ZGVzKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSkgewogICAgICAgICAgICAgICAgdmFyIG5ld19kYXRhID0gX3RoaXMxMC5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmRhdGEuY2hhdF9oaXN0b3J5KTsgLy8gdGhpcy5oaXN0b3J5ID0gbmV3X2RhdGEuY29uY2F0KHRoaXMuaGlzdG9yeSk7CgoKICAgICAgICAgICAgICAgIF90aGlzMTAuaGlzdG9yeSA9IF90aGlzMTAuaGlzdG9yeS5jb25jYXQobmV3X2RhdGEpOwoKICAgICAgICAgICAgICAgIF90aGlzMTAubWVzc2FnZV9wYWdpbmF0aW9uLnBhZ2VfcmVjb3JkX2ZldGNoZWQucHVzaChyZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMC5sYXRlc3RfcGFnZV9ubyA9IF90aGlzMTAubGF0ZXN0X3BhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCItLS0iICwgdGhpcy5zY3JvbGxfdG9wX2NhbGxlZCkKICAgICAgICAgICAgICAgICAgLy8gICAgaWYodGhpcy5zY3JvbGxfdG9wX2NhbGxlZCl7CiAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zY3JvbGxfdG9wKCk7CiAgICAgICAgICAgICAgICAgIC8vIH1lbHNlewogICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsX2Rvd24gPT0gdHJ1ZSB8fCBfdHlwZW9mKHNjcm9sbF9kb3duKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZG93biIpCiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zY3JvbGxfZG93bigpOwogICAgICAgICAgICAgICAgICB9IGVsc2Uge30gLy8gdGhpcy5zY3JvbGxfZG93bl9lZmZlY3QoKQogICAgICAgICAgICAgICAgICAvLyB9CgoKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zY3JvbGxfdG9wX2NhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkge30gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczEwLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2hvd19wcm9maWxlX3NldHVwOiBmdW5jdGlvbiBzaG93X3Byb2ZpbGVfc2V0dXAoKSB7CiAgICAgIHRoaXMuaXNfcHJvZmlsZV9zZXR1cCA9ICF0aGlzLmlzX3Byb2ZpbGVfc2V0dXA7CiAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgfSwKICAgIHNob3dfYWxsX2NvbnRhY3RzOiBmdW5jdGlvbiBzaG93X2FsbF9jb250YWN0cygpIHsKICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJyk7CiAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpOwogICAgICB0aGlzLmlzX29wZW4gPSBmYWxzZTsKICAgICAgdGhpcy5pc19wcm9maWxlX3NldHVwID0gIXRoaXMuaXNfcHJvZmlsZV9zZXR1cDsKICAgICAgdGhpcy5pc19jb250YWN0X2xpc3QgPSAhdGhpcy5pc19jb250YWN0X2xpc3Q7CiAgICAgIHRoaXMuZ2V0X2FsbF9jb250YWN0X2xpc3QoKTsKICAgIH0sCiAgICB0b2dnbGVEcm9wZG93bjogZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7CiAgICAgIHZhciBkcm9wZG93blBhcmVudDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQyJyk7CiAgICAgIHZhciBkcm9wZG93bk1lbnUyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudTInKTsKICAgICAgdmFyIGRyb3Bkb3duTWVudUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b24yJyk7CiAgICAgIGRyb3Bkb3duUGFyZW50Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duTWVudTIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICBkcm9wZG93bk1lbnVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgZHJvcGRvd25NZW51Mi5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpOwogICAgICB0aGlzLnRvZ2dsZU1vZGFsMiA9IGZhbHNlOwogICAgICB2YXIgZHJvcGRvd25QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQnKTsKICAgICAgdmFyIGRyb3Bkb3duTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnUnKTsKICAgICAgdmFyIGRyb3Bkb3duTWVudUJ1dHRvbk9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b25PbmUnKTsKCiAgICAgIGlmICh0aGlzLnRvZ2dsZU1vZGFsKSB7CiAgICAgICAgZHJvcGRvd25QYXJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJyk7CiAgICAgICAgZHJvcGRvd25NZW51LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZHJvcGRvd25QYXJlbnQuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnNldEF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJyk7CiAgICAgICAgZHJvcGRvd25NZW51LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7Jyk7CiAgICAgIH0KCiAgICAgIHRoaXMudG9nZ2xlTW9kYWwgPSAhdGhpcy50b2dnbGVNb2RhbDsKICAgIH0sCiAgICB0b2dnbGVUZW1wbGF0ZTogZnVuY3Rpb24gdG9nZ2xlVGVtcGxhdGUoKSB7CiAgICAgIHZhciBkcm9wZG93blBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudCcpOwogICAgICB2YXIgZHJvcGRvd25NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudScpOwogICAgICB2YXIgZHJvcGRvd25NZW51QnV0dG9uT25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbk9uZScpOwogICAgICBkcm9wZG93bk1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICBkcm9wZG93blBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbk9uZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICBkcm9wZG93bk1lbnUucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgdGhpcy50b2dnbGVNb2RhbCA9IGZhbHNlOwogICAgICB2YXIgZHJvcGRvd25QYXJlbnQyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGFyZW50MicpOwogICAgICB2YXIgZHJvcGRvd25NZW51MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnUyJyk7CiAgICAgIHZhciBkcm9wZG93bk1lbnVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uMicpOyAvL2NvbnNvbGUubG9nKHRoaXMudG9nZ2xlTW9kYWwyICwgImRlY2lkaW5nIHZhbHVlIikKCiAgICAgIGlmICh0aGlzLnRvZ2dsZU1vZGFsMikgewogICAgICAgIC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIpCiAgICAgICAgZHJvcGRvd25QYXJlbnQyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICBkcm9wZG93bk1lbnUyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICBkcm9wZG93bk1lbnVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgICBkcm9wZG93bk1lbnUyLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7Jyk7CiAgICAgICAgdGhpcy50b2dnbGVNb2RhbDIgPSBmYWxzZTsgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiwiYWZ0ZXIgZGVjaWRpbmciKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkcm9wZG93blBhcmVudDIuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudTIuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICAgIGRyb3Bkb3duTWVudTIuc2V0QXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgICB0aGlzLnRvZ2dsZU1vZGFsMiA9IHRydWU7IC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIsImFmdGVyIGRlY2lkaW5nIik7CiAgICAgIH0KICAgIH0sCiAgICBmb3JtYXRfaGlzdG9yeV9yZXNwb25zZTogZnVuY3Rpb24gZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2UocmVzcG9uc2UpIHsKICAgICAgdmFyIGNvbl9kYXRlID0gIiI7CgogICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgY29uX2RhdGUgPSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25fZGF0ZSA9PSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZSAmJiBpICE9IDApIHsKICAgICAgICAgIHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbl9kYXRlID0gcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9LAogICAgc2VuZF9tZXNzYWdlX3RvX3VzZXI6IGZ1bmN0aW9uIHNlbmRfbWVzc2FnZV90b191c2VyKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAoQm9vbGVhbih0aGlzLm1lc3NhZ2VfdG9fc2VuZCkgPT09IGZhbHNlICYmIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgdmFyIGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwoKICAgICAgaWYgKHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5jb21wYW55X2lkID0gdGhpcy5jb21wYW55X2lkOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5jb21wYW55X25hbWUgPSB0aGlzLmNvbXBhbnlfbmFtZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwud2hhdHNhcHBfY29udGFjdF9udW1iZXIgPSB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXI7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmRvY3VtZW50X2NvbnRlbnQgPSBudWxsOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jYXB0aW9uID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTEuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBfdGhpczExLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VuZF9hdHRhY2htZW50IikudmFsdWUgPSAnJzsKCiAgICAgICAgICBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfTUVESUFfU0VORF9TVUNDRVNTRlVMTFkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlID0gW107CgogICAgICAgICAgICBpZiAoX3RoaXMxMS5maWxlX2V4dGVuc2lvbnMuZG9jdW1lbnRfZmlsZV9leHRlbnNpb25zLmluY2x1ZGVzKF90aGlzMTEuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUpKSB7CiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlID0gW3sKICAgICAgICAgICAgICAgICJ0ZXh0IjogbnVsbCwKICAgICAgICAgICAgICAgICJyZWNpcGllbnRfaWQiOiBfdGhpczExLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICAgICAiYXR0YWNobWVudCI6IHsKICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IF90aGlzMTEuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUsCiAgICAgICAgICAgICAgICAgIGxpbms6ICJodHRwczovL3N0b3JhZ2UuY2Vuc2UuYWkvIi5jb25jYXQoX3RoaXMxMS5jb21wYW55X2lkLCAiL1doYXRzYXBwTWVkaWEvIikuY29uY2F0KF90aGlzMTEuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIDsKCiAgICAgICAgICAgIGlmIChfdGhpczExLmZpbGVfZXh0ZW5zaW9ucy5pbWFnZV9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoX3RoaXMxMS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZSkpIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2UgPSBbewogICAgICAgICAgICAgICAgInRleHQiOiBudWxsLAogICAgICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IF90aGlzMTEuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICAgICJpbWFnZSI6IHJlc3BvbnNlLmRhdGEuZmlsZV9saW5rCiAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKCiAgICAgICAgICAgIGlmIChfdGhpczExLmhpc3RvcnkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczExLmhpc3RvcnkucHVzaCh7CiAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogYm90X3Jlc3BvbnNlLAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAiVXNlclF1ZXJ5IjogIiIsCiAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV9kYXRlIjogYm90X3Jlc3BvbnNlX2RhdGUsCiAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV90aW1lIjogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAiQ2hhdF9EYXRldGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczExLmNvbnRhY3RfbGlzdFtfdGhpczExLmN1cnJlbnRfY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IF90aGlzMTEubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgICBfdGhpczExLmNvbnRhY3RfbGlzdCA9IF90aGlzMTEuYXJyYXlfbW92ZShfdGhpczExLmNvbnRhY3RfbGlzdCwgX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgICBfdGhpczExLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgICAgICAgIF90aGlzMTEuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsgLy8gdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IGZhbHNlOwoKICAgICAgICAgICAgX3RoaXMxMS5zY3JvbGxfZG93bigpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9NRURJQV9TRU5EX0ZBSUxVUkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdHJ5IGFnYWluIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXMxMS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX3RoaXMxMS50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczExLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnJyksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMTEuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ1NldHRpbmdzJywKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfV0hBVFNBUFBfQ09OVEFDVC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfTlVNQkVSX05PTkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLlRFWFRfSVNfTk9ORS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuTUlTU0lOR19NRURJQV9JTkZPUk1BVElPTi5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gY29uc29sZS5sb2cocmVzcG9uc2UpOwoKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTEuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxMS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMubWVzc2FnZV90b19zZW5kLnRyaW0oKSAhPT0gIiIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBzZW5kX21lc3NhZ2U6IHRydWUsCiAgICAgICAgICB0ZXh0OiB0aGlzLm1lc3NhZ2VfdG9fc2VuZCwKICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTEuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1RFWFRfU0VORF9TVUNDRVNTRlVMTFkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBpZiAoX3RoaXMxMS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252KSB7CiAgICAgICAgICAgICAgX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgICAgICAgIF90aGlzMTEubmV3X2NvbnZfY29udGFjdF9kYXRhLmNoYXRfZGF0ZXRpbWUgPSBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpOwogICAgICAgICAgICAgIF90aGlzMTEubmV3X2NvbnZfY29udGFjdF9kYXRhLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBfdGhpczExLm5ld19jb252X2NvbnRhY3RfZGF0YS5sYXN0X2JvdF9yZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIGRhdGU6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAgIHRpbWU6ICIiLmNvbmNhdChjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENIb3VycygpLCAiOiIpLmNvbmNhdChjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENNaW51dGVzKCkpCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgX3RoaXMxMS5jb250YWN0X2xpc3QudW5zaGlmdChfdGhpczExLm5ld19jb252X2NvbnRhY3RfZGF0YSk7CgogICAgICAgICAgICAgIF90aGlzMTEuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CgogICAgICAgICAgICBpZiAoX3RoaXMxMS5oaXN0b3J5Lm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgICAgICB9KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMxMS5oaXN0b3J5LnB1c2goewogICAgICAgICAgICAgICJCT1RSZXNwb25zZSI6IFt7CiAgICAgICAgICAgICAgICAidGV4dCI6IF90aGlzMTEubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IF90aGlzMTEuY3VycmVudF9jb250YWN0X251bWJlcgogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAiVXNlclF1ZXJ5IjogIiIsCiAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV9kYXRlIjogYm90X3Jlc3BvbnNlX2RhdGUsCiAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV90aW1lIjogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAiQ2hhdF9EYXRldGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczExLnNjcm9sbF9kb3duKCk7CgogICAgICAgICAgICBfdGhpczExLmNvbnRhY3RfbGlzdFtfdGhpczExLmN1cnJlbnRfY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IF90aGlzMTEubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgICBfdGhpczExLmNvbnRhY3RfbGlzdCA9IF90aGlzMTEuYXJyYXlfbW92ZShfdGhpczExLmNvbnRhY3RfbGlzdCwgX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgICBfdGhpczExLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgICAgICAgIF90aGlzMTEuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVVNFUl9MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzMTEudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZF9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA0MDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAnIzMwODVkNicsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzMTEudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnJyksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX3RoaXMxMS50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZycpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI2QzMycKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczExLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICdTZXR0aW5ncycsCiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX1dIQVRTQVBQX0NPTlRBQ1QuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX1dIQVRTQVBQX0NPTlRBQ1QuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9OVU1CRVJfTk9ORS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuVEVYVF9JU19OT05FLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5NSVNTSU5HX01FRElBX0lORk9STUFUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTEuYXBpX2Vycm9yX2NoZWNrcyhlLnJlc3BvbnNlKTsKCiAgICAgICAgICBfdGhpczExLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczExLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSwKICAgIGVkaXRfd2Vic2l0ZV92YWx1ZTogZnVuY3Rpb24gZWRpdF93ZWJzaXRlX3ZhbHVlKGluZGV4KSB7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gaW5kZXg7CiAgICAgIHRoaXMuZWRpdF93ZWJzaXRlID0gdHJ1ZTsKICAgIH0sCiAgICBnZXRfcHJvZmlsZV9kZXRhaWxzOiBmdW5jdGlvbiBnZXRfcHJvZmlsZV9kZXRhaWxzKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuZWRpdF9lbWFpbCA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfYWRkcmVzcyA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfZGVzY3JpcHRpb24gPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3dlYnNpdGUgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3N0YXR1cyA9IGZhbHNlOwogICAgICB0aGlzLmluZGV4X3VwZGF0ZSA9IG51bGw7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3Byb2ZpbGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX2dldDogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTIud2hhdHNhcHBfcHJvZmlsZSA9IHJlc3BvbnNlLmRhdGEuZGF0YS53aGF0c2FwcF9wcm9maWxlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuTk9fREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMi53aGF0c2FwcF9wcm9maWxlID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Byb2ZpbGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTIuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZV9wcm9maWxlX2RldGFpbHM6IGZ1bmN0aW9uIHVwZGF0ZV9wcm9maWxlX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHRoaXMuZWRpdF9lbWFpbCA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfYWRkcmVzcyA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfZGVzY3JpcHRpb24gPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3dlYnNpdGUgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3N0YXR1cyA9IGZhbHNlOwogICAgICB0aGlzLmluZGV4X3VwZGF0ZSA9IG51bGw7CgogICAgICBpZiAodGhpcy53aGF0c2FwcF9wcm9maWxlLndlYnNpdGVzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgdGhpcy5zZWNvbmRfd2Vic2l0ZSA9IHRydWU7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICB3aGF0c2FwcF9wcm9maWxlOiB0aGlzLndoYXRzYXBwX3Byb2ZpbGUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgdmFyIHJlc3AgPSByZXNwb25zZS5kYXRhLnVwZGF0ZV9yZXNwb25zZTsKCiAgICAgICAgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfRURJVF9TVUNDRVNTRlVMLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczEzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfRURJVF9VTlNVQ0NFU1NGVUwuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6IF90aGlzMTMudGx0KCd3aGF0c2FwcF9wcm9maWxlX2VkaXRlZF91bnN1Y2Nlc3MnKSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMTMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICBfdGhpczEzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVfcHJvZmlsZV9pbWFnZTogZnVuY3Rpb24gdXBkYXRlX3Byb2ZpbGVfaW1hZ2UoZSkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB0aGlzLnNlbGVjdGVkX2ZpbGVzID0gZS50YXJnZXQuZmlsZXNbMF07CgogICAgICBpZiAodGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICdpbWFnZS9wbmcnIHx8IHRoaXMuc2VsZWN0ZWRfZmlsZXMudHlwZSA9PSAnaW1hZ2UvanBnJyB8fCB0aGlzLnNlbGVjdGVkX2ZpbGVzLnR5cGUgPT0gJ2ltYWdlL2pwZWcnKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfZmlsZXMuc2l6ZSA+IDUwOTcxNTIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBzaG91bGQgYmUgbGVzcyB0aGFuIDVNQiIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfZmlsZXMgPSAnJzsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBmaWxlX3RvX3VwbG9hZCA9IHRoaXMuc2VsZWN0ZWRfZmlsZXM7CiAgICAgICAgdmFyIHByb2ZpbGVfaW1nID0gewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIHBob3RvOiBmaWxlX3RvX3VwbG9hZCwKICAgICAgICAgIHdhX3Bob25lX251bWJlcjogdGhpcy53aGF0c2FwcF9wcm9maWxlLndoYXRzYXBwX3Bob25lX251bWJlcgogICAgICAgIH07CiAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeShwcm9maWxlX2ltZyk7CiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICAgIH0pOwogICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZkLmFwcGVuZCgncGhvdG8nLCB0aGlzLnNlbGVjdGVkX2ZpbGVzKTsKICAgICAgICBmZC5hcHBlbmQoImpzb24iLCBibG9iKTsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCBmZCwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczE0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdmFyIHJlc3AgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgIGlmIChfdGhpczE0LmFwaV9zdGF0dXNfY29kZS5VUERBVEVEX1dIQVRTQVBQX1BST0ZJTEVfUEhPVE8uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczE0LmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuUEVORElOR19XSEFUU0FQUF9QUk9GSUxFX1BIT1RPX1VQREFUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfUElDVFVSRV9VTkRFUl9SRVNPTFVUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BIT1RPX1VQREFUSU9OX0ZBSUxFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczE0LmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMxNC5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgX3RoaXMxNC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzcGVjaWZpYyBmb3JtYXRlKGpwZyBqcGVnIHBuZykiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVfcHJvZmlsZV9pbWFnZTogZnVuY3Rpb24gcmVtb3ZlX3Byb2ZpbGVfaW1hZ2UoKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfcmVtb3ZlX3Bob3RvOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczE1LmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9QUk9GSUxFX1BIT1RPX1JFTU9WRUQuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTUuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczE1LmFwaV9zdGF0dXNfY29kZS5GQUlMRURfV0hBVFNBUFBfUFJPRklMRV9QSE9UT19SRU1PVkFMLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczE1LmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY29ubmVjdF9lbGl4aXJfc29ja2V0OiBmdW5jdGlvbiBjb25uZWN0X2VsaXhpcl9zb2NrZXQoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6ICIxMDAiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgICAgLy8gdGhpcy5jaGF0X2dyb3VwX25hbWUgPSByZXNwb25zZS5kYXRhLmNoYXRfZ3JvdXBfbmFtZTsKICAgICAgICAvLyB0aGlzLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAgICAgLy8gdGhpcy5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgICAgIF90aGlzMTYuY2hhdF9zb2NrZXQgPSBuZXcgU29ja2V0KHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwgewogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIHdoYXRzYXBwOiAidHJ1ZSIsCiAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5kYXRhLnRva2VuCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMTYuY2hhdF9zb2NrZXQuY29ubmVjdCgpOwoKICAgICAgICBfdGhpczE2LmNoYW5uZWwgPSBfdGhpczE2LmNoYXRfc29ja2V0LmNoYW5uZWwoIndoYXRzYXBwOiIgKyByZXNwb25zZS5kYXRhLndoYXRzYXBwX3RvcGljKTsKCiAgICAgICAgX3RoaXMxNi5jaGFubmVsLmpvaW4oKTsKCiAgICAgICAgX3RoaXMxNi5jaGFubmVsLm9uKCJuZXdfd2hhdHNhcHBfbWVzc2FnZSIsIGZ1bmN0aW9uIChyZXMpIHsvLyBjb25zb2xlLmxvZygibmV3X3doYXRzYXBwX21lc3NhZ2UiLCByZXMpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVuYWJsZV9zZW5kaW5nX21lc3NhZ2VzX2Zvcl91c2VyOiBmdW5jdGlvbiBlbmFibGVfc2VuZGluZ19tZXNzYWdlc19mb3JfdXNlcigpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgdXBkYXRlX2JvdF9yZXNwb25zZTogdHJ1ZSwKICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgIGJvdF9yZXNwb25zZTogZmFsc2UsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfdGhpczE3LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIGlmIChfdGhpczE3LnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPT09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXMxNy5zdGFydF9uZXdfY29udl9kYXRhLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMTcuY29udGFjdF9saXN0W190aGlzMTcuY3VycmVudF9jb250YWN0X2luZGV4XS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWU7CgogICAgICAgICAgICBfdGhpczE3LiRzZXQoX3RoaXMxNy5jb250YWN0X2xpc3QsIF90aGlzMTcuY3VycmVudF9jb250YWN0X2luZGV4LCBfdGhpczE3LmNvbnRhY3RfbGlzdFtfdGhpczE3LmN1cnJlbnRfY29udGFjdF9pbmRleF0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTcuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsvLyB0aGlzLiRyZWZzWyJtZXNzYWdlX3NlbmRpbmdfdGV4dGJveCJdLmZvY3VzKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTcuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzMTcuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczE3LnN0YXJ0X25ld19jb252X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxNy5jb250YWN0X2xpc3RbX3RoaXMxNy5jdXJyZW50X2NvbnRhY3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIF90aGlzMTcuJHNldChfdGhpczE3LmNvbnRhY3RfbGlzdCwgX3RoaXMxNy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIF90aGlzMTcuY29udGFjdF9saXN0W190aGlzMTcuY3VycmVudF9jb250YWN0X2luZGV4XSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgey8vIHRoaXMuJHJlZnNbIm1lc3NhZ2Vfc2VuZGluZ190ZXh0Ym94Il0uZm9jdXMoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNy5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczE3LnRsdCgnZGJfb3BlcmF0aW9uX3Vuc3VjY2VzcycpLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczE3LmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzMTcudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnJyksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzMTcudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzMTcuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICdTZXR0aW5ncycsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZXhwYW5kX3RleHRib3g6IGZ1bmN0aW9uIGV4cGFuZF90ZXh0Ym94KGlkLCBrZXkpIHsKICAgICAgaWYgKGlkICE9ICcjYnVzaW5lc3NfYWRkcmVzcycpIHsKICAgICAgICB0aGlzLmNhbGxzZWFyY2goKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBzY3JvbGxfaGVpZ2h0ID0gZS50YXJnZXQuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSAiIi5jb25jYXQoc2Nyb2xsX2hlaWdodCwgInB4Iik7CiAgICAgICAgICB9KTsKICAgICAgICB9LCAxMCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsc2VhcmNoOiBmdW5jdGlvbiBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgdGhpcy51cGRhdGVfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X251bWJlcjogZnVuY3Rpb24gY2hlY2tfY3VycmVudF9udW1iZXIocmVzKSB7CiAgICAgIHJldHVybiByZXMud2hhdHNhcHBfcGhvbmVfbnVtYmVyID09PSB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPyB0cnVlIDogZmFsc2U7CiAgICB9LAogICAgZm9ybWF0X3VzZXJfcXVlcnlfZGF0ZTogZnVuY3Rpb24gZm9ybWF0X3VzZXJfcXVlcnlfZGF0ZSh1c2VyX3F1ZXJ5X2RhdGUsIGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKHRoaXMuaGlzdG9yeVtpbmRleC0xXSkpCiAgICAgIGlmICh0aGlzLmhpc3RvcnlbaW5kZXggLSAxXS51c2VyX3F1ZXJ5X2RhdGUgPT0gdXNlcl9xdWVyeV9kYXRlKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CgogICAgICByZXR1cm4gdXNlcl9xdWVyeV9kYXRlOwogICAgfSwKICAgIGdldF9hbGxfY29udGFjdF9saXN0OiBmdW5jdGlvbiBnZXRfYWxsX2NvbnRhY3RfbGlzdCgpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE4LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTguYXBpX3N0YXR1c19jb2RlLkNPTlRBQ1RTX05PVF9GT1VORC5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxOC5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTguYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTguYWxsX2NvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICAgIF90aGlzMTguYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczE4LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczE4LmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTguc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vRE9ORQogICAgbmV3X2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gbmV3X2NvbnRhY3RfbGlzdCgpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgdmFyIHNjcm9sbGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWxsLWNvbnRhY3QtbGlzdCcpWzBdLnNjcm9sbFRvcDsKCiAgICAgIGlmIChzY3JvbGxlciA+IDEyMCAmJiAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAmJiAhdGhpcy50b3RhbF9jb250YWN0X2xvYWRlZCkgewogICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICBwYWdlX25vOiB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyArIDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTkuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgX3RoaXMxOS5pc19wYWdpbmF0ZWRfY2FsbCA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxOS5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMTkuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTkuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0cy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgIF90aGlzMTkuYWxsX2NvbnRhY3RfbGlzdCA9IF90aGlzMTkuYWxsX2NvbnRhY3RfbGlzdC5jb25jYXQocmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzKTsKICAgICAgICAgICAgICBfdGhpczE5LmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyArPSAxOwogICAgICAgICAgICAgIF90aGlzMTkuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxOS5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczE5LmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczE5LnNjcm9sbF9zcGlubmVyX2NoYXQgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFycmF5X21vdmU6IGZ1bmN0aW9uIGFycmF5X21vdmUoYXJyLCBvbGRfaW5kZXgsIG5ld19pbmRleCkgewogICAgICBpZiAobmV3X2luZGV4ID49IGFyci5sZW5ndGgpIHsKICAgICAgICB2YXIgayA9IG5ld19pbmRleCAtIGFyci5sZW5ndGggKyAxOwoKICAgICAgICB3aGlsZSAoay0tKSB7CiAgICAgICAgICBhcnIucHVzaCh1bmRlZmluZWQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgYXJyLnNwbGljZShuZXdfaW5kZXgsIDAsIGFyci5zcGxpY2Uob2xkX2luZGV4LCAxKVswXSk7CiAgICAgIHJldHVybiBhcnI7IC8vIGZvciB0ZXN0aW5nCiAgICB9LAogICAgZm9ybWF0VXNlclF1ZXJ5VGltZTogZnVuY3Rpb24gZm9ybWF0VXNlclF1ZXJ5VGltZSh1c2VyX3F1ZXJ5X3RpbWUsIHZhbCkgewogICAgICAvLyBpZiAodmFsID09IHVuZGVmaW5lZCkgewogICAgICAvLyAgIHJldHVybiBuZXcgRGF0ZSh1c2VyX3F1ZXJ5X3RpbWUpLnRvTG9jYWxlVGltZVN0cmluZyhuYXZpZ2F0b3IubGFuZ3VhZ2UsIHsKICAgICAgLy8gICBob3VyOiAnMi1kaWdpdCcsCiAgICAgIC8vICAgbWludXRlOicyLWRpZ2l0JwogICAgICAvLyAgIH0pCiAgICAgIC8vIH1lbHNlewogICAgICByZXR1cm4gbW9tZW50LnV0Yyh1c2VyX3F1ZXJ5X3RpbWUpLmxvY2FsKCkuZm9ybWF0KCJoOm1tIGEiKTsgLy8gcmV0dXJuIHVzZXJfcXVlcnlfdGltZQogICAgfSwKICAgIGlzX2FjdGl2ZV9jaGF0OiBmdW5jdGlvbiBpc19hY3RpdmVfY2hhdChpbmRleCkgewogICAgICBpZiAoaW5kZXggPT09IHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4KSB7CiAgICAgICAgcmV0dXJuICJiYWNrZ3JvdW5kOiAjZjBmOGZmIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnRhY3RfbGlzdFtpbmRleF0uaXNfbmV3X25vdGlmaWNhdGlvbiB8fCBmYWxzZSkgewogICAgICAgIHJldHVybiAiYmFja2dyb3VuZDogIzQ3YTg4NDMzIjsKICAgICAgfQoKICAgICAgcmV0dXJuICJiYWNrZ3JvdW5kOiAjZmZmZmZmIjsKICAgIH0sCiAgICBmb3JtYXRDb250YWN0TGFzdE1lc3NhZ2VEYXRlOiBmdW5jdGlvbiBmb3JtYXRDb250YWN0TGFzdE1lc3NhZ2VEYXRlKGRhdGUsIHRpbWUpIHsKICAgICAgaWYgKG1vbWVudChkYXRlKS5pc1NhbWUoRGF0ZS5ub3coKSwgJ2RheScpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCIiLmNvbmNhdChkYXRlLCAiICIpLmNvbmNhdCh0aW1lLCAiWiIpKS50b0xvY2FsZVRpbWVTdHJpbmcobmF2aWdhdG9yLmxhbmd1YWdlLCB7CiAgICAgICAgICBob3VyOiAnMi1kaWdpdCcsCiAgICAgICAgICBtaW51dGU6ICcyLWRpZ2l0JwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gZGF0ZTsKICAgIH0sCiAgICBmb3JtYXRTZWFyY2hlZERhdGU6IGZ1bmN0aW9uIGZvcm1hdFNlYXJjaGVkRGF0ZShkYXRlKSB7CiAgICAgIHZhciByZXNwb25zZURhdGUgPSBtb21lbnQoZGF0ZSkuZm9ybWF0KCdERC9NTS9ZWVlZJyk7CiAgICAgIHJldHVybiByZXNwb25zZURhdGU7CiAgICB9LAogICAgY2hlY2tfcHJldmlvdXNfbWVzc2FnZV9kYXRlX3NhbWU6IGZ1bmN0aW9uIGNoZWNrX3ByZXZpb3VzX21lc3NhZ2VfZGF0ZV9zYW1lKGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGluZGV4KQogICAgICByZXR1cm4gdHJ1ZTsgLy8gaWYoaW5kZXggPT0gMCkgewogICAgICAvLyAgIHJldHVybiB0cnVlOyAKICAgICAgLy8gfQogICAgICAvLyByZXR1cm4gdGhpcy5oaXN0b3J5W2luZGV4LTFdLmJvdF9yZXNwb25zZV9kYXRlID09IHRoaXMuaGlzdG9yeVtpbmRleF0uYm90X3Jlc3BvbnNlX2RhdGUgPyB0cnVlIDogZmFsc2U7IAogICAgfSwKICAgIHByb2Nlc3NfYXR0YWNobWVudF9maWxlOiBmdW5jdGlvbiBwcm9jZXNzX2F0dGFjaG1lbnRfZmlsZShlKSB7CiAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwoKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbGVfZXh0ZW5zaW9ucy5hbGxfYWxsb3dlZF9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoZmlsZXNbMF0udHlwZSkpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUgPSBmaWxlc1swXS50eXBlOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5kb2N1bWVudF9jb250ZW50ID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlc1swXSk7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IHRydWU7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX3R5cGUgPSB0aGlzLmZpbGVfZXh0ZW5zaW9ucy5pbWFnZV9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoZmlsZXNbMF0udHlwZSkgPyAnaW1hZ2UnIDogJ2RvY3VtZW50JzsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfY2FwdGlvbiA9IHRoaXMubWVzc2FnZV90b19zZW5kOwogICAgICAgIHRoaXMuY3JlYXRlQXR0YWNobWVudChmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsZWFzZSBTZWxlY3QgYSBwcm9wZXIgZG9jdW1lbnQgb3IgaW1hZ2UgaGF2aW5nIHRoZSBjb3JyZWN0IGZpbGV0eXBlIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlQXR0YWNobWVudDogZnVuY3Rpb24gY3JlYXRlQXR0YWNobWVudChmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMyMC5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1nLXByZXZpZXciKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWctcHJldmlldyIpLmlubmVySFRNTCA9ICc8aW1nIGNsYXNzPSJjdXN0b20tZGlzcGxheS1pbWFnZSIgc3R5bGU9Im1heC13aWR0aDo5OCU7aGVpZ2h0OjQ5MHB4OyBwYWRkaW5nOiAxLjVyZW07bWFyZ2luLWxlZnQ6IGF1dG87IG1hcmdpbi1yaWdodDogYXV0bzsiIHNyYz0iJyArIHRoaXMucmVzdWx0ICsgJyIgLz4nOwogICAgICB9KTsKICAgIH0sCiAgICBpc19yZXNwb25zZV9pbWFnZTogZnVuY3Rpb24gaXNfcmVzcG9uc2VfaW1hZ2UoZGF0YSkgewogICAgICBpZiAoZGF0YS50ZW1wbGF0ZSA9PSBudWxsICYmIGRhdGEudGV4dCA9PSBudWxsICYmIEJvb2xlYW4oZGF0YS5pbWFnZSkgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaXNfcmVzcG9uc2VfZG9jdW1lbnQ6IGZ1bmN0aW9uIGlzX3Jlc3BvbnNlX2RvY3VtZW50KGRhdGEpIHsKICAgICAgaWYgKGRhdGEudGVtcGxhdGUgPT0gbnVsbCAmJiBkYXRhLnRleHQgPT0gbnVsbCAmJiBkYXRhLmltYWdlID09IG51bGwgJiYgQm9vbGVhbihkYXRhLmF0dGFjaG1lbnQpICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHNob3dfaW1hZ2VfZnVsbHNjcmVlbjogZnVuY3Rpb24gc2hvd19pbWFnZV9mdWxsc2NyZWVuKGltZ19zcmMpIHsKICAgICAgJCgiI3Nob3dJbWFnZU1vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gaW1nX3NyYzsKICAgIH0sCiAgICBhZGRfbmV3X2NvbnRhY3RfbW9kYWw6IGZ1bmN0aW9uIGFkZF9uZXdfY29udGFjdF9tb2RhbCgpIHsKICAgICAgLy8gY29uc29sZS5sb2coImFkZCBuZXcgY29udGFjdC1hZGRDb250YWN0TW9kYWwiKQogICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICBzYXZlX25ld19jb250YWN0OiBmdW5jdGlvbiBzYXZlX25ld19jb250YWN0KCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5hZGRfbmV3X2NvbnRhY3QuY29udGFjdF9uYW1lID09IG51bGwgfHwgdGhpcy5hZGRfbmV3X2NvbnRhY3QucGhvbmVfbnVtYmVyID09IG51bGwpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiRmlsbCBkZXRhaWxzIiwKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBjb250YWN0IG51bWJlciIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9pZCA9IHRoaXMuY29tcGFueV9pZDsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9uYW1lID0gdGhpcy5jb21wYW55X25hbWU7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB0aGlzLmFkZF9uZXdfY29udGFjdCwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMjEuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczIxLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9DT05UQUNUX0FEREVEX1NVQ0NFU1NGVUxMWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogIkNvbnRhY3QgQWRkZWQgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICBfdGhpczIxLmNsZWFyX2FkZF9jb250YWN0KCk7CgogICAgICAgICAgX3RoaXMyMS5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfQ09OVEFDVF9BTFJFQURZX0VYSVNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgICAgdGV4dDogIlByb3ZpZGVkIG51bWJlciBhbHJlYWR5IGV4aXN0cyBpbiBjb250YWN0cyIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX0NPTlRBQ1RfUVVFUllfRVJST1IuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBfdGhpczIxLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcl9hZGRfY29udGFjdDogZnVuY3Rpb24gY2xlYXJfYWRkX2NvbnRhY3QoKSB7CiAgICAgIHRoaXMuYWRkX25ld19jb250YWN0ID0gewogICAgICAgIHBob25lX251bWJlcjogbnVsbCwKICAgICAgICBpc19hZGRfY29udGFjdDogdHJ1ZSwKICAgICAgICBjb250YWN0X25hbWU6IG51bGwsCiAgICAgICAgZm9ybWF0dGVkTnVtYmVyOiBudWxsCiAgICAgIH07CiAgICB9LAogICAgZG93bmxvYWRfZG9jdW1lbnQ6IGZ1bmN0aW9uIGRvd25sb2FkX2RvY3VtZW50KGF0dGFjaG1lbnQpIHsKICAgICAgLy8gY29uc29sZS5sb2coYXR0YWNobWVudCkKICAgICAgdmFyIGFUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCdpZCcsICdhYmNkZWZnJyk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsICdkb3dubG9hZCcpOwogICAgICBhVGFnLnNldEF0dHJpYnV0ZSgnaHJlZicsIGF0dGFjaG1lbnQubGluayk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCAiX2JsYW5rIik7CiAgICAgIGFUYWcuY2xpY2soKTsgLy8gY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthdHRhY2htZW50LmxpbmtdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9wZGYnIH0pCiAgICAgIC8vIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgICAgLy8gbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKQogICAgICAvLyBsaW5rLmRvd25sb2FkID0gYXR0YWNobWVudC5maWxlbmFtZQogICAgICAvLyBsaW5rLmNsaWNrKCkKICAgICAgLy8gVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpCiAgICAgIC8vIGxpbmsuY2xpY2soKTsKICAgIH0sCiAgICBvcGVuX3NlbmRfdGVtcGxhdGVfdG9fdXNlcjogZnVuY3Rpb24gb3Blbl9zZW5kX3RlbXBsYXRlX3RvX3VzZXIoKSB7CiAgICAgIHRoaXMucmV0cmlldmVfYWxsX3RlbXBsYXRlcygpOwogICAgICAkKCIjc2VuZFRlbXBsYXRlTW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgfSwKICAgIHJldHJpZXZlX2FsbF90ZW1wbGF0ZXM6IGZ1bmN0aW9uIHJldHJpZXZlX2FsbF90ZW1wbGF0ZXMoKSB7CiAgICAgIHZhciBfdGhpczIyID0gdGhpczsKCiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHt9OwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMjIuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczIyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczIyLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdCA9IFtdOwogICAgICAgICAgX3RoaXMyMi53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEudGVtcGxhdGVzOwogICAgICAgICAgX3RoaXMyMi53aGF0c2FwcF90ZW1wbGF0ZXMucGFnaW5hdGlvbl9kYXRhLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICBfdGhpczIyLndoYXRzYXBwX3RlbXBsYXRlcy5wYWdpbmF0aW9uX2RhdGEudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjIuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMjIud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0ID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VuZF90ZW1wbGF0ZV90b19jdXN0b21lcjogZnVuY3Rpb24gc2VuZF90ZW1wbGF0ZV90b19jdXN0b21lcigpIHsKICAgICAgdmFyIF90aGlzMjMgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZV9pZDogdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUsCiAgICAgICAgY29udGFjdHNfbGlzdDogW3RoaXMuY3VycmVudF9jb250YWN0X251bWJlcl0sCiAgICAgICAgcHVibGlzaF90ZW1wbGF0ZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UgLCAicmVzIikKICAgICAgICBpZiAoX3RoaXMyMy5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAnIzMwODVkNicsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczIzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczIzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnJyksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI2QzMycKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczIzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAnU2V0dGluZ3MnLAogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjMuYXBpX3N0YXR1c19jb2RlLlNFTkRJTkdfVEVNUExBVEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiBfdGhpczIzLnRsdCgnc2VuZF90ZW1wbGF0ZV9zZW50X21zZycpLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOyAvLyBjb25zb2xlLmxvZygiLS0tLSIgLCByZXNwb25zZS5kYXRhKQogICAgICAgICAgLy8gY29uc3QgdGVtcGxhdGUgPSAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS50ZW1wbGF0ZV9pZCA9PSB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wbGF0ZS52YXJpYWJsZV9kaWN0LCB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIpOwoKICAgICAgICAgIHZhciBjdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CiAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlID0gW3sKICAgICAgICAgICAgInRleHQiOiBudWxsLAogICAgICAgICAgICAidHlwZSI6ICJ0ZW1wbGF0ZSIsCiAgICAgICAgICAgICJyZWNpcGllbnRfaWQiOiBfdGhpczIzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICJ0ZW1wbGF0ZSI6IF90aGlzMjMud2hhdHNhcHBfdGVtcGxhdGVzLnByZXZpZXdfdGVtcGxhdGVfZGF0YS5ib2R5CiAgICAgICAgICB9XTsKCiAgICAgICAgICBpZiAoX3RoaXMyMy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252KSB7CiAgICAgICAgICAgIF90aGlzMjMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgX3RoaXMyMy5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7IC8vIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZQoKICAgICAgICAgICAgX3RoaXMyMy5uZXdfY29udl9jb250YWN0X2RhdGEubGFzdF9ib3RfcmVzcG9uc2UgPSB7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMyMy5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICBkYXRlOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgdGltZTogIiIuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCksICI6IikuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ01pbnV0ZXMoKSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIF90aGlzMjMuY29udGFjdF9saXN0LnVuc2hpZnQoX3RoaXMyMy5uZXdfY29udl9jb250YWN0X2RhdGEpOwoKICAgICAgICAgICAgX3RoaXMyMy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKGJvdF9yZXNwb25zZSkKCgogICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgIGlmIChfdGhpczIzLmhpc3RvcnkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMjMuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogYm90X3Jlc3BvbnNlLAogICAgICAgICAgICAidXNlcl9xdWVyeV90aW1lIjogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICJVc2VyUXVlcnkiOiAiIiwKICAgICAgICAgICAgImJvdF9yZXNwb25zZV9kYXRlIjogYm90X3Jlc3BvbnNlX2RhdGUsCiAgICAgICAgICAgICJib3RfcmVzcG9uc2VfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAidXNlcl9xdWVyeV9kYXRlIjogY3VycmVudF9kYXRlLAogICAgICAgICAgICAiQ2hhdF9EYXRldGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMjMuc2Nyb2xsX2Rvd24oKTsKCiAgICAgICAgICBfdGhpczIzLmNvbnRhY3RfbGlzdFtfdGhpczIzLmN1cnJlbnRfY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IF90aGlzMjMubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgX3RoaXMyMy5jb250YWN0X2xpc3QgPSBfdGhpczIzLmFycmF5X21vdmUoX3RoaXMyMy5jb250YWN0X2xpc3QsIF90aGlzMjMuY3VycmVudF9jb250YWN0X2luZGV4LCAwKTsKICAgICAgICAgIF90aGlzMjMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgICAgIF90aGlzMjMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgIF90aGlzMjMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPSBmYWxzZTsKICAgICAgICAgIF90aGlzMjMud2hhdHNhcHBfdGVtcGxhdGVzLnNlbGVjdGVkX3RlbXBsYXRlID0gbnVsbDsKICAgICAgICAgICQoIiNzZW5kVGVtcGxhdGVNb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiBfdGhpczIzLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWQnKSwKICAgICAgICAgICAgdGV4dDogX3RoaXMyMy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyMy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfT1BUX09VVF9DT05UQUNUUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMyMy50bHQoJ0FsbF9jb250YWN0c19oYXZlX29wdGVkX291dF9vZl9nZXR0aW5nX3RlbXBsYXRlcycpLAogICAgICAgICAgICB0eXBlOiAiZXJvb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiA0MDAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXRfY29udGFjdF9kaXNwbGF5X25hbWU6IGZ1bmN0aW9uIGdldF9jb250YWN0X2Rpc3BsYXlfbmFtZShjb250YWN0KSB7CiAgICAgIGlmIChjb250YWN0LmNvbnRhY3RfbmFtZSkgcmV0dXJuIGNvbnRhY3QuY29udGFjdF9uYW1lOwogICAgICBpZiAoY29udGFjdC5wcm9maWxlX25hbWUpIHJldHVybiBjb250YWN0LnByb2ZpbGVfbmFtZTsKICAgICAgcmV0dXJuIGNvbnRhY3Qud2hhdHNhcHBfcGhvbmVfbnVtYmVyOwogICAgfSwKICAgIG9wZW5faW1wb3J0X2Zyb21fY3N2X21vZGFsOiBmdW5jdGlvbiBvcGVuX2ltcG9ydF9mcm9tX2Nzdl9tb2RhbCgpIHsKICAgICAgJCgiI2FkZENvbnRhY3RNb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICQoIiNpbXBvcnRDb250YWN0Q1NWTW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgfSwKICAgIGZpbGVfaW5wdXRfY29udGFjdHNfY3N2OiBmdW5jdGlvbiBmaWxlX2lucHV0X2NvbnRhY3RzX2NzdihlKSB7CiAgICAgIGlmIChlLnRhcmdldC5maWxlc1swXS50eXBlID09ICd0ZXh0L2NzdicpIHsKICAgICAgICB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfbGFiZWwgPSBlLnRhcmdldC5maWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9jb250ZW50ID0gZS50YXJnZXQuZmlsZXNbMF07CiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX3NlbGVjdGVkID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiUGxlYXNlIHNlbGVjdCBhIHByb3BlciBkb2N1bWVudCBoYXZpbmcgQ1NWIGZpbGV0eXBlIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZmlsZV9zdWJtaXRfdXBsb2FkX2NvbnRhY3RzOiBmdW5jdGlvbiBmaWxlX3N1Ym1pdF91cGxvYWRfY29udGFjdHMoKSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKCiAgICAgIGlmICgkKCIjaW5wdXRHcm91cFVwbG9hZEZpbGVjc3YiKS52YWwoKSA9PSAnJykgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IGEgQ1NWIGZpbGUiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB1c2VyX2RldGFpbHMgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleQogICAgICB9OwogICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHVzZXJfZGV0YWlscyk7CiAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7CiAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iCiAgICAgIH0pOwogICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgZmQuYXBwZW5kKCJmaWxlIiwgdGhpcy5jb250YWN0X2Nzdi5maWxlX2NvbnRlbnQsIHRoaXMuY29udGFjdF9jc3YuZmlsZV9sYWJlbCk7IC8vIGZkLmFwcGVuZCgianNvbiIsIGJsb2IpOwoKICAgICAgZmQuYXBwZW5kKCJjb21wYW55X2lkIiwgdGhpcy5jb21wYW55X2lkKTsKICAgICAgZmQuYXBwZW5kKCJjb21wYW55X25hbWUiLCB0aGlzLmNvbXBhbnlfbmFtZSk7CiAgICAgIGZkLmFwcGVuZCgiZW1haWwiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwpOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9pbXBvcnRfY29udGFjdHMoKSwgZmQsIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoX3RoaXMyNC5hcGlfc3RhdHVzX2NvZGUuRklMRV9VUExPQUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgIHRleHQ6ICJNdWx0aXBsZSBjb250YWN0cyBhcmUgYmVpbmcgYWRkZWQuIFlvdSB3aWxsIHJlY2VpdmUgYSBtYWlsIHdoZW4gdGhlIHByb2Nlc3NpbmcgaXMgZmluaXNoZWQuIiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICAkKCIjaW1wb3J0Q29udGFjdENTVk1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjQuYXBpX3N0YXR1c19jb2RlLklOQ09SUkVDVF9GSUxFX0ZPUk1BVC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbmNvcnJlY3QgRmlsZSBGb3JtYXQhIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIGRpZmZlcmVudCBjc3YgZmlsZSB3aGljaCBtYXRjaGVzIHRoZSBzYW1wbGUgZmlsZSBzdHJ1Y3R1cmUiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQhIiwKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlbXB0eV91cGxvYWRfY3N2X2NvbnRhY3RzOiBmdW5jdGlvbiBlbXB0eV91cGxvYWRfY3N2X2NvbnRhY3RzKCkgewogICAgICB0aGlzLmNvbnRhY3RfY3N2ID0gewogICAgICAgIGZpbGVfbGFiZWw6ICdDaG9vc2UgRmlsZScsCiAgICAgICAgZmlsZV9jb250ZW50OiBudWxsLAogICAgICAgIGZpbGVfc2VsZWN0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICAgICQoIiNpbnB1dEdyb3VwVXBsb2FkRmlsZWNzdiIpLnZhbCgnJyk7CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlX2NvbnRhY3RfZmlsZTogZnVuY3Rpb24gZG93bmxvYWRfc2FtcGxlX2NvbnRhY3RfZmlsZSgpIHsKICAgICAgdmFyIF90aGlzMjUgPSB0aGlzOwoKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzYW1wbGVfZmlsZTogIndoYXRzYXBwX2NvbnRhY3RzIiwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczI1LnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOyAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKQoKICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJ0ZXN0LmNzdiIpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMyNS5zcGlubmVyT25GaWxlRG93bmxvYWQgPSBmYWxzZTsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczI1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdGV4dGJveF9oZWlnaHQ6IGZ1bmN0aW9uIHRleHRib3hfaGVpZ2h0KGlkLCBrZXkpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmICFldmVudC5zaGlmdEtleSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdGhpcy5zZW5kX21lc3NhZ2VfdG9fdXNlcigpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHNjcm9sbF9oZWlnaHQgPSBlLnRhcmdldC5zY3JvbGxIZWlnaHQ7CgogICAgICAgICAgaWYgKHNjcm9sbF9oZWlnaHQgPiA2MCkgewogICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5vdmVyZmxvdyA9ICdhdXRvJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjbG9zZV9kb2N1bWVudF9wcmV2aWV3OiBmdW5jdGlvbiBjbG9zZV9kb2N1bWVudF9wcmV2aWV3KCkgewogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9OwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VuZF9hdHRhY2htZW50IikudmFsdWUgPSAnJzsKICAgIH0sCiAgICB3aGF0c2FwcF9tZXNzYWdlX2Zvcm1hdGluZzogZnVuY3Rpb24gd2hhdHNhcHBfbWVzc2FnZV9mb3JtYXRpbmcoYSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY250ID0gMDsKICAgICAgICB2YXIgcG9zMSA9IC0xOwoKICAgICAgICB3aGlsZSAoY250IDwgYS5sZW5ndGgpIHsKICAgICAgICAgIHBvczEgPSBhLmluZGV4T2YodGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXSwgcG9zMSArIDEpOwoKICAgICAgICAgIGlmIChwb3MxID09IC0xKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZXBsYWNlX2ZpcnN0X2NoYXIgPSBhLnN1YnN0cmluZygwLCBwb3MxKSArIHRoaXMud2hhdHNhcHBfZm9ybWF0X2RpY3RbdGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXV1bMF0gKyBhLnN1YnN0cmluZyhwb3MxICsgMSk7CiAgICAgICAgICBhID0gcmVwbGFjZV9maXJzdF9jaGFyOwogICAgICAgICAgdmFyIHBvczIgPSBhLmluZGV4T2YodGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXSk7CiAgICAgICAgICB2YXIgcmVwbGFjZV9zZWNvbmRfY2hhciA9IGEuc3Vic3RyaW5nKDAsIHBvczIpICsgdGhpcy53aGF0c2FwcF9mb3JtYXRfZGljdFt0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldXVsxXSArIGEuc3Vic3RyaW5nKHBvczIgKyAxKTsKICAgICAgICAgIGEgPSByZXBsYWNlX3NlY29uZF9jaGFyOwogICAgICAgICAgcG9zMSA9IHBvczI7CiAgICAgICAgICBjbnQgPSBwb3MyOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgZm9ybWF0VXNlclF1ZXJ5OiBmdW5jdGlvbiBmb3JtYXRVc2VyUXVlcnkoVXNlclF1ZXJ5KSB7CiAgICAgIGlmIChVc2VyUXVlcnkgJiYgVXNlclF1ZXJ5LnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIganNvbl9zdGFydCA9IFVzZXJRdWVyeS5pbmRleE9mKCd7JyksCiAgICAgICAgICAgICAganNvbl9lbmQgPSBVc2VyUXVlcnkuaW5kZXhPZignfScpICsgMSwKICAgICAgICAgICAgICBqc29uX2RhdGEgPSBKU09OLnBhcnNlKFVzZXJRdWVyeS5zdWJzdHJpbmcoanNvbl9zdGFydCwganNvbl9lbmQpKTsKICAgICAgICAgIHJldHVybiAiSWQ6ICIuY29uY2F0KGpzb25fZGF0YS5vcmRlcl9pZCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiBVc2VyUXVlcnk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gVXNlclF1ZXJ5OwogICAgfSwKICAgIGdldF9vcmRlcl90ZW1wbGF0ZV9mb3JtYXR0ZWRfdGV4dDogZnVuY3Rpb24gZ2V0X29yZGVyX3RlbXBsYXRlX2Zvcm1hdHRlZF90ZXh0KGN1cnJlbnRfYm90X3Jlc3BvbnNlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGN1cnJlbnRfYm90X3Jlc3BvbnNlKTsKICAgICAgcmV0dXJuIHRoaXMud2hhdHNhcHBfbWVzc2FnZV9mb3JtYXRpbmcoY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PSAnQk9EWSc7CiAgICAgIH0pLnRleHQpOwogICAgfSwKICAgIGNoZWNrX2J1dHRvbl9pbl9vcmRlcl90ZW1wbGF0ZTogZnVuY3Rpb24gY2hlY2tfYnV0dG9uX2luX29yZGVyX3RlbXBsYXRlKGN1cnJlbnRfYm90X3Jlc3BvbnNlKSB7CiAgICAgIHZhciBjaGVja19idXR0b25zID0gY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PSAnQlVUVE9OUyc7CiAgICAgIH0pOwoKICAgICAgaWYgKEJvb2xlYW4oY2hlY2tfYnV0dG9ucykpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGdldF9vcmRlcl90ZW1wbGF0ZV9idXR0b25fdXJsOiBmdW5jdGlvbiBnZXRfb3JkZXJfdGVtcGxhdGVfYnV0dG9uX3VybChjdXJyZW50X2JvdF9yZXNwb25zZSwga2V5KSB7CiAgICAgIHJldHVybiBjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS50eXBlID09ICdCVVRUT05TJzsKICAgICAgfSkuYnV0dG9ucy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PSAnVVJMJzsKICAgICAgfSlba2V5XTsKICAgIH0sCiAgICBjaGVja19oZWlnaHQ6IGZ1bmN0aW9uIGNoZWNrX2hlaWdodChpZCwga2V5KSB7CiAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwoKICAgICAgaWYgKHRleHRhcmVhLnNjcm9sbFRvcCA+IDkwKSB7CiAgICAgICAgdGhpcy5zaG93X3Byb2ZpbGVfZGl2ID0gdHJ1ZTsKICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSAiNTI1cHgiOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICI0ODVweCI7CiAgICAgICAgdGhpcy5zaG93X3Byb2ZpbGVfZGl2ID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICB0aGlzLmNoYW5uZWwubGVhdmUoKTsKICAgIHRoaXMuY2hhdF9zb2NrZXQuZGlzY29ubmVjdCgpOwogIH0KfTs="},null]}