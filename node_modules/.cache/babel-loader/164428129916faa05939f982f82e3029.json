{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue","mtime":1663910265462},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5sYXN0LWluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmltcG9ydCBzd2FsIGZyb20gJ3N3ZWV0YWxlcnQyJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJOZXJUcmFpbmluZ1BhZ2UiLAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwgY2xvc2VfbW9kYWxdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzdWJfZW50aXRpZXM6IHsKICAgICAgICBzdGFydDogMCwKICAgICAgICBlbmQ6IDAsCiAgICAgICAgdmFsdWU6ICIiLAogICAgICAgIGVudGl0eTogIiIKICAgICAgfSwKICAgICAgcGFnZV9ubzogMSwKICAgICAgcGVyX3BhZ2U6IDE1LAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHBhZ2VubzogIiIsCiAgICAgIG51bWJlcl9vZl9yb3dzOiBudWxsLAogICAgICBkcm9wX2Rvd25fc2VsZWN0OiAiIiwKICAgICAgd29yZF9zZWxlY3RlZDogZmFsc2UsCiAgICAgIGhpZ2hsaWdodGVkX3RleHQ6ICIiLAogICAgICBzdGF0ZW1lbnRzOiBbXSwKICAgICAgc2VsZWN0ZWRfc3RhdGVtZW50OiAiIiwKICAgICAgc3RhdGVtZW50X2FycmF5OiBbXSwKICAgICAgbWFzdGVyX3N0YXRlbWVudHNfbGlzdDogW10sCiAgICAgIGN1cnJlbnRfcGFnZTogMSwKICAgICAgZG9uZV9lbnRpdGllczogW10sCiAgICAgIGVudGl0aWVzX2xpc3Q6IFtdLAogICAgICBlbnRpdGllc19saXN0X3N0cmluZzogIiIsCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGNzdl9maWxlOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgd29yZF9pbmZvOiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgYnVmZmVyX3dvcmRfbGlzdDogW10sCiAgICAgIGRlbGV0ZV9uZXJfdGFnczogW10sCiAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIG5vdFRyYWluZWRRdWVzdGlvbnM6IFtdLAogICAgICBpbmZvX2ljb246IHJlcXVpcmUoIkAvcG9ydGFsL2Fzc2V0cy9pbWcvaW5mb19pY29uLnN2ZyIpLAogICAgICBuZXdfc3RhdGVtZW50OiAiIiwKICAgICAgZWRpdF9zdGF0ZW1lbnQ6ICIiLAogICAgICB3YW50X3N0YXR1czogdHJ1ZSwKICAgICAgbmVyX21vZGVsX2lucHJvZ3Jlc3M6IGZhbHNlLAogICAgICBjdXJyZW50X3NlbGVjdGVkOiBudWxsLAogICAgICBzZWFyY2hfbmFtZTogIiIsCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgZGlzYWJsZV9idG5fZXhwaXJlZDogZmFsc2UKICAgIH07CiAgfSwKICBjb21wb25lbnRzOiB7fSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIGF4aW9zCiAgICAvLyAgIC5nZXQoYXBpX2NhbGxzLmdldF9uZXJfdGFnKCksIHsKICAgIC8vICAgICBwYXJhbXM6IHsKICAgIC8vICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgLy8gICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAvLyAgICAgfSwKICAgIC8vICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICB9LAogICAgLy8gICB9KQogICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgLy8gICAgICAgdGhpcy53b3JkX2luZm8gPSByZXNwb25zZS5kYXRhOwogICAgLy8gICAgICAgdGhpcy5idWZmZXJfd29yZF9saXN0ID0gcmVzcG9uc2UuZGF0YTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwoKICAgIHRoaXMuY2hlY2tfbmVyX21vZGVsX3N0YXR1cygpOyAvLyBheGlvcwogICAgLy8gICAucG9zdCgKICAgIC8vICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAvLyAgICAgewogICAgLy8gICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgIGdldF90YWdnZWRfc3RhdGVtZW50czogdHJ1ZSwKICAgIC8vICAgICB9LAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIH0KICAgIC8vICAgKQogICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgLy8gICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJOZXIgVGFnIENvbXBsZXRlZCIpIHsKICAgIC8vICAgICAgICAgLy8gdGhpcy5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5SZXNwb25zZSk7CiAgICAvLyAgICAgICAgIHRoaXMubm90VHJhaW5lZFF1ZXN0aW9ucyA9IHJlc3BvbnNlLmRhdGEuUmVzcG9uc2U7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICAvLyBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQXNzaWduIE5lciBUYWciKSB7CiAgICAvLyAgICAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAvLyB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJObyBEYXRhIEF2YWlsYWJsZSIpIHsKICAgIC8vICAgICAgIC8vICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgIC8vIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgLy8gICAgICAgLy8gICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgLy8gfQogICAgLy8gICAgIH0KICAgIC8vICAgfSkKICAgIC8vICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgKSB7CiAgICAvLyAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiTmVyVHJhaW5pbmdQYWdlRGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQgPSB0cnVlOwogICAgICB9CiAgICB9KTsKICAgICQoJ1tkYXRhLXRvZ2dsZT0icG9wb3ZlciJdJykucG9wb3Zlcih7CiAgICAgIGh0bWw6IHRydWUsCiAgICAgIGNvbnRlbnQ6ICQoIiNwb3BvdmVyX2NvbnRlbnQiKQogICAgfSkub24oInNob3cuYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmFkZENsYXNzKCJkLWJsb2NrIik7CiAgICB9KS5vbigic2hvd24uYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHt9KS5vbigiaGlkZS5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkgewogICAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuYWRkQ2xhc3MoImQtbm9uZSIpOwogICAgfSk7CiAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuY3NzKCJ6SW5kZXgiLCA5OTk5KTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbigic2VuZF9tb2RlbF9zdGF0dXMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PSB0cnVlKSB7CiAgICAgICAgX3RoaXMuY2hlY2tfbmVyX21vZGVsX3N0YXR1cygpOwogICAgICB9CiAgICB9KTsKICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICB1cGxvYWRfbmVyX2ZpbGU6IGZ1bmN0aW9uIHVwbG9hZF9uZXJfZmlsZSgpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICAkKCIjdXBsb2FkX2Nzdl9maWxlIikubW9kYWwoJ3Nob3cnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgYWRkX25lcl9zdGF0ZW1uZW50OiBmdW5jdGlvbiBhZGRfbmVyX3N0YXRlbW5lbnQoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgJCgiI3N0YXRlbWVudG1vZGFsIikubW9kYWwoJ3Nob3cnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgYWRkX25lcl90YWc6IGZ1bmN0aW9uIGFkZF9uZXJfdGFnKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgnc2hvdycpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX25lcl9zdGF0ZW1lbnRzOiBmdW5jdGlvbiBsb2FkX25lcl9zdGF0ZW1lbnRzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5nZXQoYXBpX2NhbGxzLmdldF9uZXJfdGFnKCksIHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbgogICAgICAgIH0sCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMi53b3JkX2luZm8gPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICBfdGhpczIuYnVmZmVyX3dvcmRfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR1NfTk9UX0ZPVU5ELk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbC5maXJlKHsKICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgICB0ZXh0OiAnTm8gbmVyIHRhZ3MgZm91bmQnLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczIud29yZF9pbmZvID0gW107CiAgICAgICAgICBfdGhpczIuYnVmZmVyX3dvcmRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGdldF9hbGxfbmVyX3N0YXRlbWVudHM6IHRydWUsCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2UpOwoKICAgICAgICAgIF90aGlzMi5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgX3RoaXMyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgX3RoaXMyLnNldHBhZ2luYXRpb24oX3RoaXMyLnBhZ2Vfbm8pOwoKICAgICAgICAgIF90aGlzMi5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FTU0lHTi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJywKICAgICAgICAgICAgdGV4dDogJ05vIERhdGEgQXZhaWxhYmxlJywKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMyLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgICAgIF90aGlzMi5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aXRsZTogIkVycm9yIiwKICAgICAgICAgICAgdGV4dDogIkludGVybmFsIHNlcnZlciBlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgdGhpcy5uZXdfc3RhdGVtZW50ID0gIiI7CiAgICAgIHRoaXMuZWRpdF9zdGF0ZW1lbnQgPSAiIjsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkID0gbnVsbDsKICAgICAgdGhpcy5lbnRpdGllc19saXN0X3N0cmluZyA9ICIiOwogICAgfSwKICAgIGFzc2lnbl92YXJpYWJsZTogZnVuY3Rpb24gYXNzaWduX3ZhcmlhYmxlKGluZGV4KSB7CiAgICAgIHRoaXMuZWRpdF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlN0YXRlbWVudDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkID0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XTsKICAgIH0sCiAgICBjaGVja19uZXJfbW9kZWxfc3RhdHVzOiBmdW5jdGlvbiBjaGVja19uZXJfbW9kZWxfc3RhdHVzKCkgewogICAgICB0aGlzLm1vZGVsX3N0YXR1cyA9IHRoaXMuJHNlc3Npb24uZ2V0KCJNb2RlbFN0YXR1cyIpOwoKICAgICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzID09ICJObyBGYWlsdXJlIikgewogICAgICAgIHRoaXMubmVyX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChCb29sZWFuKHRoaXMubW9kZWxfc3RhdHVzLm5lcl9tb2RlbCkgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMubmVyX21vZGVsID09ICJJblByb2dyZXNzIikgewogICAgICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMubmVyX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgc2hvd19tb2RlbF9wcm9ncmVzczogZnVuY3Rpb24gc2hvd19tb2RlbF9wcm9ncmVzcyhpbmRleCkgewogICAgICBpZiAodGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9PSB0cnVlKSB7CiAgICAgICAgaWYgKGluZGV4ID09ICdzdHlsZScpIHsKICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAndGl0bGUnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50bHQoJ25lcl9wYWdlX3RyYWluaW5nX3Byb2dyZXNzX21zZycpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIGFkZF9zdGF0ZW1lbnQ6IGZ1bmN0aW9uIGFkZF9zdGF0ZW1lbnQoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMubmV3X3N0YXRlbWVudC50cmltKCkgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9lbnRlcl9zdGF0ZW1lbnRfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuYWRkX25lcl9zdGF0ZW1lbnQoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgbmV3X3N0YXRlbWVudDogdGhpcy5uZXdfc3RhdGVtZW50CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMy50bHQoJ25lcl9wYWdlX3N0YXRlbWVudF9hZGRlZF9tc2cnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBfdGhpczMuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICAgICAgX3RoaXMzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gdGhpcy5wYWdlX3JlcXVpcmUoMSk7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5BRERfU1RBVEVNRU5UX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMy50bHQoJ25lcl9wYWdlX3dyb25nX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiU3RhdGVtZW50IGFscmVhZHkgZXhpc3RzIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMy50bHQoJ25lcl9wYWdlX3N0YXRlbWVudF9hbHJlYWR5X2V4aXN0c19tc2cnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnYWRkX3N0YXRlbWVudF9idG4nKTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfc3RhdGVtZW50czogZnVuY3Rpb24gZWRpdF9zdGF0ZW1lbnRzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmVkaXRfc3RhdGVtZW50ID09IHRoaXMuY3VycmVudF9zZWxlY3RlZC5TdGF0ZW1lbnQpIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX21vZGlmeV9zdGF0ZW1lbnRfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsgLy8gY29uc29sZS5sb2coInN0YXRlbWVudCBpbmRleCBiZWZvcmUtLS0iLCB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQpOwoKICAgICAgICB2YXIgdmFsaWRfc3RhdGVtZW50ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXJyZW50X3NlbGVjdGVkKTsKICAgICAgICB2YXIga2V5ID0gdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuSXNUYWdDb21wbGV0ZWQgPSAiTk8iOwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5TdGF0ZW1lbnQgPSB0aGlzLmVkaXRfc3RhdGVtZW50OwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5UYWcgPSBbXTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC53b3Jkc19saXN0OwogICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKF9kZWZpbmVQcm9wZXJ0eSh7fSwga2V5LCB2YWxpZF9zdGF0ZW1lbnQpKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczQuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzNC50bHQoJ25lcl9wYWdlX3RhZ19zdWJtaXRfbXNnJyksCiAgICAgICAgICAgICAgLy8gdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDU1MDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczQuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICAgIF90aGlzNC5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIHRoaXMucGFnZV9yZXF1aXJlKDEpOwogICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCItLS0iKTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdlZGl0X2J0bicpOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3RhZ3M6IGZ1bmN0aW9uIGRlbGV0ZV90YWdzKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfcmV2ZXJ0X21zZycpLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9zd2FsX2RlbGV0ZV9tc2cnKQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSB0cnVlOwoKICAgICAgICAgIF90aGlzNS5kZWxldGVfbmVyX3RhZ3MucHVzaChfdGhpczUud29yZF9pbmZvW2luZGV4XSk7CgogICAgICAgICAgX3RoaXM1LndvcmRfaW5mby5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmRlbGV0ZV9uZXJfdGFncygpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBlbWFpbDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgdGFnX25hbWU6IF90aGlzNS5kZWxldGVfbmVyX3RhZ3MKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM1LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhfdGhpczUudGx0KCduZXJfcGFnZV90YWdfcmVtb3ZlZF9tc2cnKSk7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKICAgICAgICAgICAgICBfdGhpczUuZGVsZXRlX25lcl90YWdzID0gW107IC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgICAgICBfdGhpczUubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCA1MDApOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNS50bHQoJ25lcl9wYWdlX3NvbWVfZXJyb3JfbXNnMScpKTsKICAgICAgICAgICAgICBfdGhpczUuZGVsZXRlX25lcl90YWdzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNS50bHQoJ25lcl9wYWdlX3NvbWVfZXJyb3JfbXNnMicpKTsKICAgICAgICAgICAgX3RoaXM1LmRlbGV0ZV9uZXJfdGFncyA9IFtdOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHN0YXJ0X3RhZ2dpbmc6IGZ1bmN0aW9uIHN0YXJ0X3RhZ2dpbmcoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgZ2V0VGFnOiBmYWxzZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX1NUQVRVUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczYudGx0KCduZXJfcGFnZV90YWdzX2FsZXJ0X21zZycpKTsKICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19TVEFUVVMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgX3RoaXM2LmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gfSwgMTUwMCk7CgogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNi50bHQoJ25lcl9wYWdlX3RhZ3NfYWxlcnRfbXNnMScpKTsKICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNi50bHQoJ25lcl9wYWdlX3RhZ3NfYWxlcnRfbXNnMycpKTsKICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkge30gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgdGhpcy5zZWFyY2hfbmVyX3N0YXRtZW50X3BhZ2VfY2hhbmdlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBnZXRfYWxsX25lcl9zdGF0ZW1lbnRzOiB0cnVlLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgICAgICAgICAgIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgX3RoaXM3LnN0YXRlbWVudHMgPSBbXTsKCiAgICAgICAgICAgICAgICBfdGhpczcubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZSk7IC8vIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICAgIC8vIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwoKCiAgICAgICAgICAgICAgICBfdGhpczcuc2V0cGFnaW5hdGlvbihfdGhpczcucGFnZV9ubyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQUxMLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgX3RoaXM3LnN0YXRlbWVudHMgPSBbXTsKCiAgICAgICAgICAgICAgICBfdGhpczcubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZSk7IC8vIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICAgIC8vIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwoKCiAgICAgICAgICAgICAgICBfdGhpczcuc2V0cGFnaW5hdGlvbihfdGhpczcucGFnZV9ubyk7CgogICAgICAgICAgICAgICAgX3RoaXM3Lm5vdFRyYWluZWRRdWVzdGlvbnMgPSByZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2U7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQVNTSUdOLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgICB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKICAgIH0sCiAgICBzZWFyY2hfbmVyX3N0YXRtZW50OiBmdW5jdGlvbiBzZWFyY2hfbmVyX3N0YXRtZW50KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy5wYWdlX25vID0gMTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF90ZXJtOiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlKTsgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwoKCiAgICAgICAgICAgICAgX3RoaXM4LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgIF90aGlzOC5zZXRwYWdpbmF0aW9uKF90aGlzOC5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQUxMLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlKTsgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwoKCiAgICAgICAgICAgICAgX3RoaXM4LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgIF90aGlzOC5zZXRwYWdpbmF0aW9uKF90aGlzOC5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQVNTSUdOLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCduZXJfcGFnZV9ub19uZXJfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX3RoaXM4LnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICBfdGhpczgudG90YWxfcGFnZXMgPSAxOwoKICAgICAgICAgICAgICBfdGhpczguc2V0cGFnaW5hdGlvbihfdGhpczgucGFnZV9ubyk7CgogICAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczguc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIF90aGlzOC50b3RhbF9wYWdlcyA9IDE7CgogICAgICAgICAgICAgIF90aGlzOC5zZXRwYWdpbmF0aW9uKF90aGlzOC5wYWdlX25vKTsKCiAgICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc2VhcmNoX2FsZXJ0X21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfbmVyX3N0YXRtZW50X3BhZ2VfY2hhbmdlOiBmdW5jdGlvbiBzZWFyY2hfbmVyX3N0YXRtZW50X3BhZ2VfY2hhbmdlKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfdGVybTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FMTC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczkubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOyAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CgoKICAgICAgICAgICAgICBfdGhpczkudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCiAgICAgICAgICAgICAgX3RoaXM5LnNldHBhZ2luYXRpb24oX3RoaXM5LnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BU1NJR04uTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczkuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIF90aGlzOS50b3RhbF9wYWdlcyA9IDE7CgogICAgICAgICAgICAgIF90aGlzOS5zZXRwYWdpbmF0aW9uKF90aGlzOS5wYWdlX25vKTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOS5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgICAgICAgX3RoaXM5LnRvdGFsX3BhZ2VzID0gMTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNldHBhZ2luYXRpb24oX3RoaXM5LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9zZWFyY2hfYWxlcnRfbXNnMicpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IDQ7IF9pKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMiA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTIgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHBhZ2Vfbm8gKyAzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTQgPSBwYWdlX25vIC0gNDsgX2k0IDwgdGhpcy50b3RhbF9wYWdlczsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gMzsgX2k1IDw9IHBhZ2Vfbm8gKyAzOyBfaTUrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k1KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIGxvYWRfc3RhdGVtZW50czogZnVuY3Rpb24gbG9hZF9zdGF0ZW1lbnRzKHN0YXRlbWVudHMpIHsKICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0ID0gW107CiAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOyAvLyBjb25zb2xlLmxvZyh0aGlzLnN0YXRlbWVudHMpOwoKICAgICAgZm9yICh2YXIgaSBpbiBzdGF0ZW1lbnRzKSB7CiAgICAgICAgdmFyIGtleSA9IE9iamVjdC5rZXlzKHN0YXRlbWVudHNbaV0pWzBdOwoKICAgICAgICBpZiAoc3RhdGVtZW50c1tpXVtrZXldLklzVGFnQ29tcGxldGVkICE9ICJZRVMiKSB7CiAgICAgICAgICB2YXIga2V5ID0gT2JqZWN0LmtleXMoc3RhdGVtZW50c1tpXSlbMF07CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QucHVzaChzdGF0ZW1lbnRzW2ldW2tleV0pOwogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3QgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ua2V5ID0ga2V5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0YXRlbWVudHNbaV1ba2V5XS5Jc1RhZ0NvbXBsZXRlZCAhPSAiTk8iKSB7CiAgICAgICAgICB2YXIga2V5ID0gT2JqZWN0LmtleXMoc3RhdGVtZW50c1tpXSlbMF07CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QucHVzaChzdGF0ZW1lbnRzW2ldW2tleV0pOwogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3QgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CiAgICAgICAgICB2YXIgZGVzYyA9IFtdOwogICAgICAgICAgdmFyIHZhbHVlczsKICAgICAgICAgIHZhciBpbmRleDsKCiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWcubGVuZ3RoOyBhKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0gIT0gIk8iKSB7CiAgICAgICAgICAgICAgdmFyIGNoZWNrID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZy5pbmRleE9mKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0pOwoKICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5pbmNsdWRlcygiQi0iKSkgewogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImN1cnJlbnQiLCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdKTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJuZXh0IiwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYSArIDFdICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBpZiAoY2hlY2sgPCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmxlbmd0aCAtIDEgJiYgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0uaW5jbHVkZXMoIkktIikpIHsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGE7IC8vIGNvbnNvbGUubG9nKCJpbmRleCIsIGluZGV4KTsKCiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gYTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKQogICAgICAgICAgICAgICAgICAgIH0pOyAvLyAvL2NvbnNvbGUubG9nKGRlc2MpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgICBpbmRleCA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGluZGV4ID0gYTsKICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgIHRleHQ6IHZhbHVlcywKICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMikKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLmluY2x1ZGVzKCJJLSIpKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmluZGV4T2YodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXSk7CiAgICAgICAgICAgICAgICBpbmRleCA9IGE7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYSArIDFdICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0uaW5jbHVkZXMoIkktIikpIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZXMgKyAiICIgKyB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzICsgIiAiICsgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzICsgIiAiICsgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgIHRleHQ6IHZhbHVlcywKICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMikKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgdmFsdWVzID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV1bInNlbGVjdGVkX2xpc3QiXSA9IGRlc2M7CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ua2V5ID0ga2V5OwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgX2k2ID0gMDsgX2k2IDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0Lmxlbmd0aDsgX2k2KyspIHsKICAgICAgICB0aGlzLnN0YXRlbWVudHMucHVzaCh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbX2k2XSk7CiAgICAgIH0KCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7IC8vY29uc29sZS5sb2codGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0ICwgIk1zdGVyIHN0YXRlbWVudHMgbG9hZGVkIikKICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnN0YXRlbWVudHMgLCAiIHN0YXRlbWVudHMgbG9hZGVkIikKICAgIH0sCiAgICBsb2FkX3BvcG92ZXI6IGZ1bmN0aW9uIGxvYWRfcG9wb3Zlcih0YXJnZXQpIHsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJsZWZ0IiwgdGFyZ2V0LmNsaWVudFgpOwogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygidG9wIiwgdGFyZ2V0LmNsaWVudFkgKyB3aW5kb3cucGFnZVlPZmZzZXQpOwogICAgfSwKICAgIHNlbGVjdGVkX3RleHQ6IGZ1bmN0aW9uIHNlbGVjdGVkX3RleHQoaW5kZXgpIHsKICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHsKICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkgIT0gIiIgJiYgd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkuc3BsaXQoIiAiKS5qb2luKCIiKSAhPSAiIikgewogICAgICAgICAgdGhpcy5oaWdobGlnaHRlZF90ZXh0ID0gd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICAgICAgdGhpcy53b3JkX3NlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XS5TdGF0ZW1lbnQ7CiAgICAgICAgICB0aGlzLmxvYWRfcG9wb3ZlcihldmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCA9ICIiOwogICAgICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImRpc3BsYXkiLCAibm9uZSIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsKICAgICAgICBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0OwogICAgICB9CiAgICB9LAogICAgdXBkYXRlX3N0YXRlbWVudHM6IGZ1bmN0aW9uIHVwZGF0ZV9zdGF0ZW1lbnRzKGVudGl0eSkgewogICAgICB2YXIgd29yZHNfbGlzdCA9IGVudGl0eS52YWx1ZS5zcGxpdCgiICIpOwogICAgICB2YXIgdGFncyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnN0YXRlbWVudHMpIHsKICAgICAgICB2YXIgbWFzdGVyX3dvcmRzX2xpc3QgPSB0aGlzLnN0YXRlbWVudHNbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CgogICAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaV0uc2VsZWN0ZWRfbGlzdCA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5zZWxlY3RlZF9saXN0ID0gW107CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgICAgZm9yICh2YXIgaiBpbiBtYXN0ZXJfd29yZHNfbGlzdCkgewogICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnLnB1c2goIiIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5TdGF0ZW1lbnQgPT0gdGhpcy5zZWxlY3RlZF9zdGF0ZW1lbnQpIHsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5Jc1RhZ0NvbXBsZXRlZCA9ICJOTyI7CiAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uc2VsZWN0ZWRfbGlzdC5wdXNoKHsKICAgICAgICAgICAgdGV4dDogZW50aXR5LnZhbHVlLAogICAgICAgICAgICB3b3JkX3R5cGU6IGVudGl0eS5lbnRpdHkKICAgICAgICAgIH0pOwoKICAgICAgICAgIGZvciAodmFyIGogaW4gbWFzdGVyX3dvcmRzX2xpc3QpIHsKICAgICAgICAgICAgaWYgKHdvcmRzX2xpc3QuaW5jbHVkZXMobWFzdGVyX3dvcmRzX2xpc3Rbal0pKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gd29yZHNfbGlzdC5pbmRleE9mKG1hc3Rlcl93b3Jkc19saXN0W2pdKTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5UYWdbal0gPSAiQi0iICsgZW50aXR5LmVudGl0eTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLlRhZ1tqXSA9ICJJLSIgKyBlbnRpdHkuZW50aXR5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLlRhZ1tqXSA9PSAiIikgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLlRhZ1tqXSA9ICJPIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBlbnRpdHk6IGZ1bmN0aW9uIGVudGl0eSh2YWx1ZTEsIHZhbHVlMikgewogICAgICBmb3IgKHZhciBpIGluIGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuW2ldLnN0eWxlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW5baV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiI7CiAgICAgICAgICBldmVudC50YXJnZXQuY2hpbGRyZW5bMF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiI7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9PSAieWVsbG93IikgewogICAgICAgIGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInllbGxvdyI7CiAgICAgICAgdmFyIGZsYWcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHRoaXMuZG9uZV9lbnRpdGllcy5sZW5ndGggIT0gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRvbmVfZW50aXRpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuZG9uZV9lbnRpdGllc1tpXS52YWx1ZSA9PSB2YWx1ZTEpIHsKICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZsYWcgPT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMud29yZF9zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy52YWx1ZSA9IHZhbHVlMTsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50X2FycmF5ID0gdmFsdWUyOwogICAgICAgICAgdmFyIGpvaW50ID0gdGhpcy5zdGF0ZW1lbnRfYXJyYXkuam9pbigpOwogICAgICAgICAgdmFyIGEgPSBqb2ludC5sYXN0SW5kZXhPZih2YWx1ZTEpOwogICAgICAgICAgdmFyIGIgPSB2YWx1ZTEubGVuZ3RoICsgYSAtIDI7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy5zdGFydCA9IGE7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy5lbmQgPSBiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNhdmVfc3RhdGVtZW50OiBmdW5jdGlvbiBzYXZlX3N0YXRlbWVudChpbmRleCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2luZGV4XS5UYWcubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9hZGRfdGFnc19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgICB2YXIgdmFsaWRfc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XTsgLy8gY29uc29sZS5sb2coImJlZm9yZS0tLSIsIHRoaXMuc3RhdGVtZW50c1tpbmRleF0pOwoKICAgICAgICB2YXIga2V5ID0gdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuSXNUYWdDb21wbGV0ZWQgPSAiWUVTIjsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC53b3Jkc19saXN0OwogICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKF9kZWZpbmVQcm9wZXJ0eSh7fSwga2V5LCB2YWxpZF9zdGF0ZW1lbnQpKTsgLy8gY29uc29sZS5sb2coInNpbmd1bGFyIGZpbmFsIixmaW5hbF9zdGF0ZW1lbnRzX2xpc3QpOwoKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoJ25lcl9wYWdlX3RhZ3Nfc3VibWl0X21zZycpLAogICAgICAgICAgICAgIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIC8vIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgICAgIH0pOyAvLyB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKCiAgICAgICAgICAgIF90aGlzMTAubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczEwLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc3VibWl0X25lcl9tb2RlbDogZnVuY3Rpb24gc3VibWl0X25lcl9tb2RlbCgpIHsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICB2YXIgZmluYWxfc3RhdGVtZW50c19saXN0ID0gW107CiAgICAgIHZhciB2YWxpZF9saXN0ID0gdGhpcy5zdGF0ZW1lbnRzLmZpbHRlcihmdW5jdGlvbiAoc3RhdGVtZW50KSB7CiAgICAgICAgcmV0dXJuIHN0YXRlbWVudC5Jc1RhZ0NvbXBsZXRlZCAhPSAiIjsKICAgICAgfSk7CgogICAgICBpZiAodmFsaWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9zdWJtaXRfYWxlcnRfbXNnJykpOwogICAgICB9IGVsc2UgaWYgKHZhbGlkX2xpc3QubGVuZ3RoIDwgNSAmJiB0aGlzLnN0YXRlbWVudHMubGVuZ3RoID4gNSkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9zdWJtaXRfYWxlcnRfbXNnMScpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKHZhciBpIGluIHZhbGlkX2xpc3QpIHsKICAgICAgICAgIHZhciBrZXkgPSB2YWxpZF9saXN0W2ldLmtleTsKICAgICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLmtleTsKICAgICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS53b3Jkc19saXN0OwogICAgICAgICAgZmluYWxfc3RhdGVtZW50c19saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHZhbGlkX2xpc3RbaV0pKTsKICAgICAgICB9IC8vIGNvbnNvbGUubG9nKGZpbmFsX3N0YXRlbWVudHNfbGlzdCk7CgoKICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KSB7CiAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTsKICAgICAgICB9IC8vIGF4aW9zCiAgICAgICAgLy8gICAucG9zdCgKICAgICAgICAvLyAgICAgYXBpX2NhbGxzLnRhZ19zZW50ZW5jZXNfdXJsKCksCiAgICAgICAgLy8gICAgIHsKICAgICAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIC8vICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIC8vICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAvLyAgICAgICBuZXJfdGFnX3N0YXRlbWVudDogZmluYWxfc3RhdGVtZW50c19saXN0LAogICAgICAgIC8vICAgICB9LAogICAgICAgIC8vICAgICB7CiAgICAgICAgLy8gICAgICAgaGVhZGVyczogewogICAgICAgIC8vICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgLy8gICAgICAgfSwKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgKQogICAgICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MoIkFsbCB5b3VyIHRhZ3MgaGF2ZSBiZWVuIHN1Ym1pdHRlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgLy8gICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAvLyAgICAgICB9LCAyMDAwKTsKICAgICAgICAvLyAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgLy8gICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KSB7CiAgICAgICAgLy8gICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCk7CiAgICAgICAgLy8gICAgIH0gZWxzZSBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcykgewogICAgICAgIC8vICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTsKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgfSkKICAgICAgICAvLyAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgLy8gICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgLy8gICB9KTsKCiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVfdGFnOiBmdW5jdGlvbiByZW1vdmVfdGFnKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX25vX3RhZ3NfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3VudGFnX3N0YXRlbWVudF9tc2cnKSwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3dhbF9kZWxldGVfbXNnJykKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzdWx0KTsKICAgICAgICBpZiAocmVzdWx0LmRpc21pc3MpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzMTEuc3RhdGVtZW50c1tpbmRleF0uSXNUYWdDb21wbGV0ZWQgPSAiTk8iOwogICAgICAgIF90aGlzMTEuc3RhdGVtZW50c1tpbmRleF0uVGFnID0gW107CiAgICAgICAgX3RoaXMxMS5zdGF0ZW1lbnRzW2luZGV4XS5zZWxlY3RlZF9saXN0ID0gW107CgogICAgICAgIF90aGlzMTEuJHNldChfdGhpczExLnN0YXRlbWVudHMsIGluZGV4LCBfdGhpczExLnN0YXRlbWVudHNbaW5kZXhdKTsKCiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgIHZhciB2YWxpZF9zdGF0ZW1lbnQgPSBfdGhpczExLnN0YXRlbWVudHNbaW5kZXhdOwogICAgICAgIHZhciBrZXkgPSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQuc2VsZWN0ZWRfbGlzdDsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LndvcmRzX2xpc3Q7CiAgICAgICAgZmluYWxfc3RhdGVtZW50c19saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHZhbGlkX3N0YXRlbWVudCkpOyAvLyBjb25zb2xlLmxvZygic2luZ3VsYXIgZmluYWwiLGZpbmFsX3N0YXRlbWVudHNfbGlzdCk7CgogICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50YWdfc2VudGVuY2VzX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGVtYWlsOiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBuZXJfdGFnX3N0YXRlbWVudDogZmluYWxfc3RhdGVtZW50c19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTEuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczExLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnbmVyX3BhZ2VfdGFnX3JlbW92ZWRfbXNnJyksCiAgICAgICAgICAgICAgLy8gdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVudGl0eV9zZWxlY3RlZDogZnVuY3Rpb24gZW50aXR5X3NlbGVjdGVkKHdvcmQpIHsKICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCAhPSAiIikgewogICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnZhbHVlID0gdGhpcy5oaWdobGlnaHRlZF90ZXh0OwogICAgICB9CgogICAgICB2YXIgcG9wb3Zlcl9pZCA9IGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5pZDsgLy8gdGhpcy53b3JkX3NlbGVjdGVkID0gZmFsc2U7CgogICAgICB0aGlzLnN1Yl9lbnRpdGllcy5lbnRpdHkgPSB0aGlzLmRyb3BfZG93bl9zZWxlY3Q7CiAgICAgIHRoaXMuZG9uZV9lbnRpdGllcy5wdXNoKHRoaXMuc3ViX2VudGl0aWVzKTsKICAgICAgJCgiIyIgKyBwb3BvdmVyX2lkKS5wb3BvdmVyKCJoaWRlIik7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgdGhpcy5kcm9wX2Rvd25fc2VsZWN0ID0gIiI7CiAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCA9ICIiOwogICAgICB0aGlzLnVwZGF0ZV9zdGF0ZW1lbnRzKHRoaXMuc3ViX2VudGl0aWVzKTsKICAgICAgdGhpcy5zdWJfZW50aXRpZXMgPSB7fTsKCiAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7CiAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0OiBmdW5jdGlvbiBmaWxlaW5wdXQoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsgLy9jb25zb2xlLmxvZyhmaWxlcykKCiAgICAgIGlmIChmaWxlc1swXS5zaXplIDwgMTAwMDAwMCkgewogICAgICAgIGlmIChmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJjc3YiKSB8fCBmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJ0eHQiKSB8fCBmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJ4bHMiKSB8fCBmaWxlc1swXS50eXBlLmluY2x1ZGVzKCJ0ZXh0IikpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2codGhpcy5maWxlX2xhYmVsKQogICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICAgIHRoaXMuY3JlYXRlQ1NWKGZpbGVzWzBdKTsgLy9jb25zb2xlLmxvZyh0aGlzLmZpbGVfbGFiZWwpCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX3BhZ2VfZmlsZV9zaXplX2FsZXJ0JykpOwogICAgICB9CgogICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgfSwKICAgIGNyZWF0ZUNTVjogZnVuY3Rpb24gY3JlYXRlQ1NWKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczEyLmNzdl9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIHNlbmRfY3N2OiBmdW5jdGlvbiBzZW5kX2NzdigpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgLy9jb25zb2xlLmxvZygkKCIjaW5wdXRHcm91cEZpbGUwMSIpLnZhbCgpKQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKCQoIiNpbnB1dEdyb3VwRmlsZTAxIikudmFsKCkgPT0gJycpIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfcGFnZV9pbnB1dF9maWVsZF9tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV91cGxvYWRfZmlsZV9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOyAvL2NvbnNvbGUubG9nKHRoaXMuZmlsZV9sYWJlbCkKCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudXBsb2FkX25lcl9maWxlX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBmaWxlX2RhdGE6IHRoaXMuY3N2X2ZpbGUsCiAgICAgICAgICBmaWxlX25hbWU6IHRoaXMuZmlsZV9sYWJlbAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuRVJST1JfVVBMT0FELk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxMy50bHQoJ25lcl9wYWdlX2Vycm9yX3VwbG9hZF9hbGVydCcpKTsKICAgICAgICAgICAgX3RoaXMxMy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgX3RoaXMxMy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID0gIiI7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfU1RBVFVTLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxMy50bHQoJ25lcl9wYWdlX3RhZ3NfYXNzaWduX21zZycpKTsKICAgICAgICAgICAgX3RoaXMxMy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgX3RoaXMxMy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID0gIiI7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfSEVBRElORy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMTMudGx0KCduZXJfcGFnZV9pbnZhbGlkX2hlYWRlcl9tc2cnKSk7CiAgICAgICAgICAgIF90aGlzMTMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgIF90aGlzMTMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5GQUlMRURfVE9fQUREX1RBR1MuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiVW5rbm93biBUYWdzIGZvdW5kISBTdGF0ZW1lbnRzIGhhcyBiZWVuIHVwbG9hZGVkLCBQbGVhc2UgdGFnIHRoZSBzdGF0ZW1lbnRzIG1hbnVhbGx5LiIpCiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTMudGx0KCduZXJfcGFnZV90YWdzX2ZvdW5kX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpczEzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICBfdGhpczEzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgICAgX3RoaXMxMy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIH0sIDI1MDApOyAKCiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLklOQ09SUkVDVF9GSUxFX0ZPUk1BVC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMTMudGx0KCduZXJfcGFnZV9maWxlX2Zvcm1hdF9tc2cnKSk7CiAgICAgICAgICAgIF90aGlzMTMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgIF90aGlzMTMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0ZJTEVfVFlQRS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMTMudGx0KCduZXJfcGFnZV9maWxlX3R5cGVfbXNnJykpOwogICAgICAgICAgICBfdGhpczEzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICBfdGhpczEzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuRklMRV9VUExPQUQuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKF90aGlzMTMudGx0KCduZXJfcGFnZV91cGxvYWRfc3VjY2Vzc19hbGVydF9tc2cnKSk7IC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKCiAgICAgICAgICAgIF90aGlzMTMubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCAyNTAwKTsKCiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgIC8vICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgIC8vICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAvLyAgICAgIkR1ZSB0byBzb21lIGludGVybmFsIHNlcnZlciBlcnJvciwgd2Ugd2VyZSB1bmFibGUgdG8gcHJvY2VzcyB0aGlzIHJlcXVlc3QuIFBsZWFzZSB0cnkgbGF0ZXIuIgogICAgICAgICAgLy8gICApOwogICAgICAgICAgLy8gfQoKCiAgICAgICAgICAkKCIjdXBsb2FkX2Nzdl9maWxlIikubW9kYWwoImhpZGUiKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCd1cGxvYWRfYnRuJyk7CiAgICAgIH0KICAgIH0sCiAgICBjb21tYV90b19saXN0OiBmdW5jdGlvbiBjb21tYV90b19saXN0KCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9uZXJfdGFnX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5lbnRpdGllc19saXN0ID0gdGhpcy5lbnRpdGllc19saXN0X3N0cmluZy5zcGxpdCgiLCIpOwoKICAgICAgaWYgKHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgIT0gIiIpIHsKICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuYWRkX25lcl90YWcoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdGFnbGlzdDogdGhpcy5lbnRpdGllc19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczE0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczE0LmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FERC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoX3RoaXMxNC50bHQoJ25lcl9wYWdlX3RhZ19hZGRlZF9hbGVydF9tc2cnKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTQuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczE0LnRsdCgnbmVyX3BhZ2Vfc29tZV9lcnJvcl9hbGVydDInKSk7CiAgICAgICAgICBfdGhpczE0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczE0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodGhpcy5kZWxldGVfbmVyX3RhZ3MubGVuZ3RoID4gMCkgey8vIGF4aW9zCiAgICAgICAgLy8gICAucG9zdChhcGlfY2FsbHMuZGVsZXRlX25lcl90YWdzKCksIHsKICAgICAgICAvLyAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAvLyAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgLy8gICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgLy8gICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIC8vICAgICB0YWdfbmFtZTogdGhpcy5kZWxldGVfbmVyX3RhZ3MsCiAgICAgICAgLy8gICB9KQogICAgICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgIC8vICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhZyBoYXMgYmVlbiByZW1vdmVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgIC8vICAgICAgIH0sIDI1MDApOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gfSwgMjUwMCk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfbmVyOiBmdW5jdGlvbiBkZWxldGVfbmVyKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCJzdGF0ZW1lbnRzIGxlbmd0aCIsdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aCk7CiAgICAgIHZhciBkZWxldGVfc3RhdGVtZW50X2xpc3QgPSBbXTsKICAgICAgdmFyIHZhbGlkX2xpc3QgPSB0aGlzLnN0YXRlbWVudHMuZmlsdGVyKGZ1bmN0aW9uIChzdGF0ZW1lbnQpIHsKICAgICAgICByZXR1cm4gc3RhdGVtZW50LlN0YXRlbWVudCA9PSBfdGhpczE1LnN0YXRlbWVudHNbaW5kZXhdLlN0YXRlbWVudDsKICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKHZhbGlkX2xpc3QpOwoKICAgICAgZm9yICh2YXIgaSBpbiB2YWxpZF9saXN0KSB7CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX2xpc3RbaV0ua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLndvcmRzX2xpc3Q7CiAgICAgICAgZGVsZXRlX3N0YXRlbWVudF9saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHZhbGlkX2xpc3RbaV0pKTsKICAgICAgfSAvLyBjb25zb2xlLmxvZyhkZWxldGVfc3RhdGVtZW50X2xpc3QpOwoKCiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfc3dhbF9hbGVydF9tc2cnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3N3YWxfcmV2ZXJ0X21zZycpLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfc3dhbF9jb25maXJtX21zZycpCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIF90aGlzMTUuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmRlbGV0ZV9uZXIoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMxNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogX3RoaXMxNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogX3RoaXMxNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgbmVyX3RhZ19zdGF0bWVudDogZGVsZXRlX3N0YXRlbWVudF9saXN0CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczE1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzMTUuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgLy8gdG9hc3RyLnN1Y2Nlc3MoIllvdXIgTkVSIHRhZyBkZWxldGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxNS50bHQoJ25lcl90YWdfZGVsZXRlX21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDU1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzMTUuc3RhdGVtZW50cy5sZW5ndGggPT09IDEgJiYgZGVsZXRlX3N0YXRlbWVudF9saXN0Lmxlbmd0aCA9PT0gMSAmJiBfdGhpczE1LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICBfdGhpczE1LnBhZ2Vfbm8gPSBfdGhpczE1LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxNS5jbGVhcl9maWVsZHMoKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CgoKICAgICAgICAgICAgICBfdGhpczE1LmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gfSwgMTUwMCk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VsZWN0ZWRfc3RhdGVtZW50czogZnVuY3Rpb24gc2VsZWN0ZWRfc3RhdGVtZW50cyhpbmRleCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHZhciByb2xlX2xlbmd0aCA9IHRoaXMuc3RhdGVtZW50cy5sZW5ndGg7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9sZV9sZW5ndGg7IGkrKykgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaCh0aGlzLnN0YXRlbWVudHNbaV0pOwogICAgICAgIH0gLy9jb25zb2xlLmxvZyh0aGlzLmNoZWNrZWRfbGlzdCkKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIGlmICghdGhpcy5jaGVja2VkX2xpc3QuaW5jbHVkZXMoaW5kZXgpKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy5zdGF0ZW1lbnRzW2luZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChyb2xlKSB7CiAgICAgICAgICAgIHJldHVybiByb2xlICE9PSBfdGhpczE2LnN0YXRlbWVudHNbaW5kZXhdOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX25lcl9tdWx0aXBsZTogZnVuY3Rpb24gZGVsZXRlX25lcl9tdWx0aXBsZSgpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zdGF0ZW1lbnRzLCJzdGF0ZW1lbnRzIGluIGRlbGV0ZSBmdW5jdGlvbiIpCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdCwiTWFzdGVyIHN0YXRlbWVudHMgaW4gZGVsZXRlIGZ1bmN0aW9uIikKICAgICAgdmFyIG51bSA9IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsKICAgICAgdmFyIG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdCA9IFtdOwoKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX25vX3N0YXRlbWVudF9hbGVydF9tc2cnKSwKICAgICAgICAgIHRleHQ6ICIiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBkbHRfbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuY2hlY2tlZF9saXN0KSB7CiAgICAgICAgICAvLyB2YXIgdmFsaWRfbGlzdCA9IHRoaXMuc3RhdGVtZW50cy5maWx0ZXIoKHN0YXRlbWVudCkgPT4gewogICAgICAgICAgLy8gcmV0dXJuIHN0YXRlbWVudC5TdGF0ZW1lbnQgPT0gdGhpcy5jaGVja2VkX2xpc3RbaV0uU3RhdGVtZW50OwogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWxpZF9saXN0LCJsaXN0IikKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbGlkX2xpc3RbMF0sImxpc3QiKQogICAgICAgICAgdmFyIGtleSA9IHRoaXMuY2hlY2tlZF9saXN0W2ldLmtleTsKICAgICAgICAgIGRsdF9saXN0LnB1c2goa2V5KTsKICAgICAgICAgIG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5wdXNoKF9kZWZpbmVQcm9wZXJ0eSh7fSwga2V5LCB0aGlzLmNoZWNrZWRfbGlzdFtpXSkpOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX3N3YWxfYWxlcnRfbXNnMicpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9zd2FsX3JldmVydF9tc2cyJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfc3dhbF9jb25maXJtX21zZzInKQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczE3LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmRlbGV0ZV9uZXIoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTcuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxNy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMxNy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczE3LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTcuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0bWVudDogbXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTcuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczE3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxNy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczE3LnRsdCgnbmVyX3RhZ19kZWxldGVfbXNnMicpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiA1NTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAobXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0Lmxlbmd0aCA9PT0gX3RoaXMxNy5zdGF0ZW1lbnRzLmxlbmd0aCAmJiBfdGhpczE3LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTcucGFnZV9ubyA9IF90aGlzMTcucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMxNy5jbGVhcl9maWVsZHMoKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIlJBTk5OTiIpCgoKICAgICAgICAgICAgICAgIF90aGlzMTcubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCAxNTAwKTsKCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzMTcuY2xlYXJfZmllbGRzKCk7CgogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBfdGhpczE3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzMTcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHRyYWluX25lcl9tb2RlbDogZnVuY3Rpb24gdHJhaW5fbmVyX21vZGVsKCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIGlmICh0aGlzLm5vdFRyYWluZWRRdWVzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfc2V0dXBfdHJhbnNsYXRlX21zZycpLAogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3RyYWluaW5nX3RpbWVfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX3RyYWluX2VudGl0eV9tb2RlbF9tc2cnKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl9nb19iYWNrX21zZycpCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgIC8vIGlmICh0aGlzLnN0YXRlbWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIC8vIGF4aW9zCiAgICAgICAgICAgICAgLy8gICAucG9zdChhcGlfY2FsbHMubm90aWZ5X3N1cGVyYWRtaW5fdXJsKCksIHsKICAgICAgICAgICAgICAvLyAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgLy8gICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgLy8gICAgIG5vdGlmeV90eXBlOiAiTmVyTW9kZWwiLAogICAgICAgICAgICAgIC8vICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIC8vICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAvLyAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAvLyAgICAgc3ViamVjdDogIk5vdGlmaWNhdGlvbiB0byB0cmFpbiB0aGUgbmVyIG1vZGVsIiwKICAgICAgICAgICAgICAvLyAgICAgYm9keToKICAgICAgICAgICAgICAvLyAgICAgICB0aGlzLmNvbXBhbnluYW1lICsKICAgICAgICAgICAgICAvLyAgICAgICAiaGFzIHJlcXVlc3RlZCB0byB0cmFpbiB0aGUgbmVyIG1vZGVsIG9mIGVudGl0aWVzLiIsCiAgICAgICAgICAgICAgLy8gICB9KQogICAgICAgICAgICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgLy8gICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEuTXNnKTsKICAgICAgICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJBIG1haWwgaGFzIGJlZW4gc2VudCB0byB5b3VyIGVtYWlsIikgewogICAgICAgICAgICAgIC8vICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIC8vICAgICAgICAgIllvdXIgTmVyICBtb2RlbCBpcyBzdWNjZXNzZnVsbHkgc2NoZWR1bGVkIGZvciBmdXJ0aGVyIHRyYWluaW5nLiIKICAgICAgICAgICAgICAvLyAgICAgICApOwogICAgICAgICAgICAgIC8vICAgICAgIHRoaXMubmV3X3F1ZXN0aW9ucyA9IDA7CiAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRyYWluX25lcl9tb2RlbHMoKSwgewogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBlbWFpbDogX3RoaXMxOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMTguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgICAgY29tcGFueV9kZXRhaWxzOiB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQKICAgICAgICAgICAgICAgIH0gLy8gZXBvY2hzOiAxMDAsCiAgICAgICAgICAgICAgICAvLyBiYXRjaF9zaXplOiA2NAoKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgX3RoaXMxOC53YW50X3N0YXR1cyA9IHRydWU7CgogICAgICAgICAgICAgICAgX3RoaXMxOC4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLCBfdGhpczE4LndhbnRfc3RhdHVzKTsKCiAgICAgICAgICAgICAgICBfdGhpczE4LmNoZWNrX25lcl9tb2RlbF9zdGF0dXMoKTsKCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSAyMDAwMDExMSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMTgudGx0KCduZXJfaW50ZXJuYWxfc2VydmVyX2FsZXJ0MicpKTsKCiAgICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsgLy8gfSBlbHNlIHsKICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiVGhlcmUgYXJlIG5vIHRhZ3MgdG8gdHJhaW4uIFBsZWFzZSBhZGQgc29tZSB0YWdzIGFuZCIpOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX25vX3RhZ3NfdHJhaW5fbXNnJykpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgY2xlYXJfZmllbGRzOiBmdW5jdGlvbiBjbGVhcl9maWVsZHMoKSB7CiAgICAgIHRoaXMud29yZF9pbmZvID0gdGhpcy5idWZmZXJfd29yZF9saXN0OwogICAgICB0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nID0gIiI7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlOiBmdW5jdGlvbiBkb3dubG9hZF9zYW1wbGUoKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5maWxlX2Rvd25sb2FkKCksCiAgICAgICAgcmVzcG9uc2VUeXBlOiAiYmxvYiIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc2FtcGxlX2ZpbGU6ICJuZXIiCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiBfdGhpczE5LnRsdCgnbmVyX2Rvd25sb2FkX3NhbXBsZV9hbGVydCcpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOyAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKQoKICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIF90aGlzMTkuY29tcGFueV9uYW1lICsgIk5lckZpbGUuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogX3RoaXMxOS50bHQoJ25lcl9kb3dubG9hZF9zYW1wbGVfYWxlcnQyJyksCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},null]}