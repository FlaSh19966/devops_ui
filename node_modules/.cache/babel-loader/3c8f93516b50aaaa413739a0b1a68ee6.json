{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue","mtime":1645594423487},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvaG9tZS92aW1hbGVzaC9DRU5TRS9jaGF0Ym90LXBvcnRhbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBUZW1wbGF0ZSBmcm9tICIuLi9UZW1wbGF0ZS52dWUiOwppbXBvcnQgeyBWdWVFZGl0b3IgfSBmcm9tICJ2dWUyLWVkaXRvciI7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgcGFnZV9ndWlkZSBmcm9tICJAL3BvcnRhbC9taXhpbnMvcGFnZV9ndWlkZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBUZW1wbGF0ZTogVGVtcGxhdGUsCiAgICBWdWVFZGl0b3I6IFZ1ZUVkaXRvcgogIH0sCiAgbmFtZTogIk5ld0ludGVudHNQYWdlIiwKICBtaXhpbnM6IFtmcmVlemVfcG9ydGFsLCBwYWdlX2d1aWRlLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWxdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwZW5jaWxfc3ZnOiAnIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUuNTQ2IiBoZWlnaHQ9IjE1LjQ2MSIgdmlld0JveD0iMCAwIDE1LjU0NiAxNS40NjEiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiM5ZTllOWU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03NDcuODg4IC0zNTYuNzY5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik03NTkuNDE2LDM1Ni43NjlhMi4zNTgsMi4zNTgsMCwwLDEsMS43NzcuNjYyYy41MzQuNTEzLDEuMDcyLDEuMDI1LDEuNTY3LDEuNTc1YTIuMywyLjMsMCwwLDEtLjA3MSwzLjMyNWMtMi43MzYsMi43Ni01LjQ5NCw1LjUtOC4yMzgsOC4yNTFhMS4zODEsMS4zODEsMCwwLDEtLjc1OC4yODhjLS43MTkuMTc0LTEuNDI5LjM3OS0yLjE0NC41NzItLjkzMi4yNTEtMS44NjIuNS0yLjc5NS43NTEtLjYuMTU4LS45ODktLjIxMy0uODMyLS44MDdxLjY4OS0yLjU5NSwxLjQwNi01LjE4MmExLjE2NCwxLjE2NCwwLDAsMSwuMjg5LS40ODdxNC4wOTEtNC4xMDcsOC4yLTguMkEyLjI2NSwyLjI2NSwwLDAsMSw3NTkuNDE2LDM1Ni43NjlabS0xLjk4OSwyLjk1Ni02LjU0LDYuNTM4LDMuMDI1LDMuMDI0LDYuNTM4LTYuNTM3Wm00LjAyMywyLjE2NWMuMTE4LS4xMzUuMjI1LS4yNjkuMzQzLS4zOTJhMS4xMzQsMS4xMzQsMCwwLDAsMC0xLjczNGMtLjQ2LS40NjYtLjkyNi0uOTI1LTEuMzg4LTEuMzlhMS4xNjYsMS4xNjYsMCwwLDAtLjg2MS0uMzY4Yy0uNTc4LDAtLjg4MS40LTEuMjE0Ljc2Wm0tMTIuMDg0LDguODYzLDMuMi0uODYzLTIuMzM3LTIuMzMxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTgxMy45NDIsNDIyLjZsLS43ODktLjgsMy44MjEtMy44MTkuNzg0LjhaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTkuNjQ4IC01NS45NDcpIi8+PC9nPjwvc3ZnPicsCiAgICAgIHBvaW50X2NpcmNsZV9zdmc6ICc8c3ZnIGRhdGEtdi04Y2I4ZDlmZT0iIiBkYXRhLXRvb2x0aXA9InRvb2x0aXAiIGRhdGEtcGxhY2VtZW50PSJib3R0b20iIHRpdGxlPSIiIGRhdGEtdG9nZ2xlPSJtb2RhbCIgZGF0YS10YXJnZXQ9IiNjb25maWdhcGltb2RhbDQiIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgdmVyc2lvbj0iMS4xIiBkYXRhLW9yaWdpbmFsLXRpdGxlPSJIZWxwIj48ZyBkYXRhLXYtOGNiOGQ5ZmU9IiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTAyOC40KSI+PHBhdGggZGF0YS12LThjYjhkOWZlPSIiIGQ9Im0yMiAxMmMwIDUuNTIzLTQuNDc3IDEwLTEwIDEwLTUuNTIyOCAwLTEwLTQuNDc3LTEwLTEwIDAtNS41MjI4IDQuNDc3Mi0xMCAxMC0xMCA1LjUyMyAwIDEwIDQuNDc3MiAxMCAxMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMTAyOS40KSIgZmlsbD0iIzI5ODBiOSI+PC9wYXRoPjxwYXRoIGRhdGEtdi04Y2I4ZDlmZT0iIiBkPSJtMjIgMTJjMCA1LjUyMy00LjQ3NyAxMC0xMCAxMC01LjUyMjggMC0xMC00LjQ3Ny0xMC0xMCAwLTUuNTIyOCA0LjQ3NzItMTAgMTAtMTAgNS41MjMgMCAxMCA0LjQ3NzIgMTAgMTB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEwMjguNCkiIGZpbGw9IiMyNzM2NzkiPjwvcGF0aD48L2c+PC9zdmc+JywKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgbmV3X2ludGVudF9saXN0OiBbXSwKICAgICAgb2xkX2ludGVudF9uYW1lOiAiIiwKICAgICAgb2xkX3F1ZXN0aW9uc19saXN0OiBbXSwKICAgICAgb2xkX2ltYWdlX25hbWU6ICIiLAogICAgICBvbGRfdmlkZW9fdXJsOiAiIiwKICAgICAgaW50ZW50bGlzdDogW10sCiAgICAgIGNvbXBhbnluYW1lOiAiIiwKICAgICAgY29tcGFueWlkOiAiIiwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGVkaXQ6ICJGYWxzZSIsCiAgICAgIGFkZF9lZGl0OiAiZmFsc2UiLAogICAgICAvLyBlZGl0X3Jlc3BvbnNlOiAiIiwKICAgICAgb2xkX2ludGVudF9kYXRhOiBbXSwKICAgICAgbmV3X2ludGVudF9kYXRhOiBbXSwKICAgICAgaXNfcmVzcG9uc2U6IGZhbHNlLAogICAgICBpc19lbmRwb2ludDogZmFsc2UsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgc2hvd190YXNrX3ZhbHVlczogZmFsc2UsCiAgICAgIHNhdmVfc2hvd190YXNrX3ZhbHVlczogZmFsc2UsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICBwYWdlbm86ICIiLAogICAgICB2aWV3X2RlZmluZV9hcGlfZW5kcG9pbnRzOiBmYWxzZSwKICAgICAgZGVmaW5lX2FwaV9lbmRwb2ludHM6IGZhbHNlLAogICAgICB2aWV3X3Jlc3BvbnNlX21vZGFsOiB0cnVlLAogICAgICBlZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWw6IHRydWUsCiAgICAgIGltYWdlX3Jlc3BvbnNlOiAiTm8iLAogICAgICB2aWRlb19yZXNwb25zZTogIk5vIiwKICAgICAgdmlkZW9fbGluazogIiIsCiAgICAgIGVtYmRfbGluazogIiIsCiAgICAgIGVtYmRfbGlua19lZGl0OiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbDI6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWwzOiAiQ2hvb3NlIGZpbGUiLAogICAgICBvcHRpb25zOiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ6ICIiLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleDogMCwKICAgICAgLy90aGlzIGlzIGFsc28gdXNlZCB0byBlZGl0IGludGVudCByZXNwb25zZQogICAgICBzZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2U6IFsiIl0sCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodDogIiIsCiAgICAgIHNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9pbWFnZTogIiIsCiAgICAgIG5hbWVfZmlsZTogIiIsCiAgICAgIHRlbXBfZmlsZV9uYW1lOiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3ZpZGVvOiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3NvdXJjZTogIiIsCiAgICAgIHNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnM6IFsiIl0sCiAgICAgIGlzRWRpdEludGVudDogZmFsc2UsCiAgICAgIHVybDogIiIsCiAgICAgIC8vIFRoaXMgVmFyaWFibGVzIGFyZSBmb3IgTkVXIElOVEVOVAogICAgICBuZXdfaW50ZW50czogIiIsCiAgICAgIGFkZF9xdWVzdGlvbnNfbGlzdDogWyIiXSwKICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgLy8gcmVzcG9uc2U6IFsiIl0sCiAgICAgIG11bHRpcGxlX3Jlc3BvbnNlOiBbIiJdLAogICAgICBjdXN0b21Ub29sYmFyOiBbWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwgW3sKICAgICAgICBjb2xvcjogW10KICAgICAgfSwgewogICAgICAgIGJhY2tncm91bmQ6IFtdCiAgICAgIH1dLCBbewogICAgICAgIGxpc3Q6ICJvcmRlcmVkIgogICAgICB9LCB7CiAgICAgICAgbGlzdDogImJ1bGxldCIKICAgICAgfV0sIFsibGluayJdXSwKICAgICAgc2F2ZV91cmw6ICIiLAogICAgICBzYXZlX2FwaV9tZXRob2Q6IG51bGwsCiAgICAgIHNhdmVfanNvbl9yZXF1ZXN0X2RhdGE6ICIiLAogICAgICBzYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgc2F2ZV9lZGl0YWJsZV92YWx1ZXM6ICIiLAogICAgICBzYXZlX3Rhc2tfaW5wdXRfdmFsdWVzOiBbXSwKICAgICAgc2F2ZV9lbmR1c2VyX21zZ190eXBlOiAiQ3VzdG9tIiwKICAgICAgc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGE6ICIiLAogICAgICBzYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyOiAiIiwKICAgICAgc2F2ZV9lbmRfdXNlcl9tZXNzYWdlOiAiIiwKICAgICAgc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlOiBudWxsLAogICAgICBzYXZlX3Jlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2U6ICIiLAogICAgICBzYXZlX3Vuc3VjY2Vzc2Z1bF9tZXNzYWdlOiBudWxsLAogICAgICBpc1Zpc2libGVTZWFyY2hDbGVhcjogZmFsc2UsCiAgICAgIGFwaV9tZXRob2Q6IG51bGwsCiAgICAgIHBvc3RfbWV0aG9kX3JlcXVlc3RfbGlzdDogW10sCiAgICAgIHNob3dfanNvbl9yZXF1ZXN0X2RhdGE6ICIiLAogICAgICBzaG93X2pzb25fcmVzcG9uc2VfZGF0YTogIiIsCiAgICAgIHJlcXVlc3RfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgZWRpdGFibGVfdmFsdWVzOiAiIiwKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgdXR0ZXJhbmNlczogW10sCiAgICAgIGVuZHVzZXJfbXNnX3R5cGU6IG51bGwsCiAgICAgIHJlc3BvbnNlX2tleV90b19lbmR1c2VyOiAiIiwKICAgICAgZW5kX3VzZXJfbWVzc2FnZTogbnVsbCwKICAgICAgcmVzcG9uc2VfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZTogIiIsCiAgICAgIHVuc3VjY2Vzc2Z1bF9tZXNzYWdlOiBudWxsLAogICAgICBmaW5hbHN0ZXA6IGZhbHNlLAogICAgICBhcGlfbGlzdDogW10sCiAgICAgIHJlcXVlc3RfanNvbl9jYXNlXzE6ICJ7XG4gICAgICAgICAgXCJjb21wYW55aWRcIjpcIkNvbXBhbnlJZFwiLFxuICAgICAgICAgIFwiZW1haWxcIjpcImVtYWlsXCIsXG4gICAgICAgICAgXCJyb2xlXCI6XCJyb2xlXCIsXG4gICAgICAgICAgXCJzdWJqZWN0XCI6XCIgXCIsXG4gICAgICAgICAgXCJkZXNjcmlwdGlvblwiOlwiIFwiLFxuICAgICAgICB9IiwKICAgICAgaW5wdXRfZnJvbV91c2VyX2Nhc2VfMTogInN1YmplY3Q7ZGVzY3JpcHRpb24iLAogICAgICByZXF1ZXN0X2pzb25fY2FzZV8yOiAie1xuXHQgICAgICAgIFwidXNlclwiOiB7XG5cdFx0ICAgICAgXCJjb21wYW55aWRcIjogJ2NvbXBhbnlJZCcsXG5cdFx0ICAgICAgXCJlbWFpbFwiOiAnZW1haWwnLFxuXHRcdCAgICAgIFwicm9sZVwiOiAncm9sZScsXG5cdFx0ICAgICAgXCJpbmZvXCI6IHtcblx0XHQgICAgICBcdFwibmlja25hbWVcIjogXCJcIlxuXHRcdCAgICAgIH1cblx0ICAgICAgfSxcblx0ICAgICAgXCJzZWFyY2hwYXJhbWV0ZXJcIjoge1xuXHRcdCAgICAgIFwic3RhdHVzXCI6IFwiXCIsXG5cdFx0ICAgICAgXCJvcmRlcmJ5XCI6IFwiXCIsXG5cdFx0ICAgICAgXCJmcm9tZGF0ZVwiOiBcIjAxLzAxLzIwMThcIixcblx0XHQgICAgICBcImNvdW50XCI6IDEwLFxuXHRcdCAgICAgIFwic2VhcmNodGV4dFwiOiBcIlwiLFxuXHRcdCAgICAgIFwidHlwZW9mdmlzaXRcIjogXCJBTExcIixcblx0XHQgICAgICBcInNvcnRvcmRlclwiOiBcImFwcG9pbnRtZW50XCIsXG5cdFx0ICAgICAgXCJzdGFydGluZGV4XCI6IFwiMVwiLFxuXHRcdCAgICAgIFwiZW5kaW5kZXhcIjogXCIxMFwiLFxuXHRcdCAgICAgIFwidG9kYXRlXCI6IFwiMDgvMDYvMjAxOFwiXG5cdCAgICAgIH1cblxuICAgICAgfSIsCiAgICAgIGlucHV0X2Zyb21fdXNlcl9jYXNlXzI6ICJ1c2VyLGluZm8sbmlja25hbWU7c2VhcmNocGFyYW1ldGVyLGZyb21kYXRlO3NlYXJjaHBhcmFtZXRlcix0b2RhdGUiLAogICAgICByZXF1ZXN0X2pzb25fY2FzZV8zOiAieyBcbiAgICAgICAgICBcImNvbXBhbnlpZFwiOlwiY29tcGFueWlkXCIsXG4gICAgICAgICAgXCJlbWFpbFwiOlwiZW1haWxcIixcbiAgICAgICAgICBcInJvbGVcIjpcInJvbGVcIiBcbiAgICAgIH0iLAogICAgICByZXNwb25zZV9qc29uX2Nhc2VfMTogIntcbiAgICAgICAgICAnbWVzc2FnZSc6J1lvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gc2NoZWR1bGVkJyxcbiAgICAgICAgICAndXNlcm5hbWUnOidDZW5zZScsXG4gICAgICAgICAgJ2VtYWlsJzondXNlckBjZW5zZS5haSdcbiAgICAgIH0iLAogICAgICByZXNwb25zZV9qc29uX2Nhc2VfMTE6ICJ7XG4gICAgICAgICAgJ21lc3NhZ2UnOidBUEkgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICAnY291bnQnOic4J1xuICAgICAgICAgICd1c2VybmFtZSc6J0NlbnNlJyxcbiAgICAgICAgICAnZW1haWwnOid1c2VyQGNlbnNlLmFpJ1xuICAgICAgfSIsCiAgICAgIHRhc2tfaW5wdXRfdmFsdWVzOiBbXSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzOiBmYWxzZSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQ6IGZhbHNlLAogICAgICBlZGl0X3ZpZGVvX3Jlc3BvbnNlOiAiTm8iLAogICAgICBlZGl0X2ltYWdlX3Jlc3BvbnNlOiAiTm8iLAogICAgICBmaWxlX2NvbnRlbnQyOiAiIiwKICAgICAgZmlsZV9jb250ZW50MzogIiIsCiAgICAgIHNwaW5uZXJPbkZpbGVEb3dubG9hZDogZmFsc2UsCiAgICAgIGZpbGVfbGFiZWxfY3N2OiAiQ2hvb3NlIGZpbGUiLAogICAgICBmaWxlX2NvbnRlbnRfY3N2OiAiIiwKICAgICAgZGVmYXVsdF9yZXRhaWxfaW50ZW50czogW10sCiAgICAgIHdhbnRfc3RhdHVzOiB0cnVlLAogICAgICBpbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uOiAnJywKICAgICAgaXNfc2VhcmNoX2FjdGl2ZTogZmFsc2UsCiAgICAgIGRhdGFfaXNfZW1pdDogIiIsCiAgICAgIGRpc2FibGVfYnRuX2V4cGlyZWQ6IGZhbHNlLAogICAgICByZWdfdXJsOiAvaHR0cHM6XC9cL1sod3d3XC4pP2EtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKFstYS16QS1aMC05QDolX1wrLn4jPyZcL1wvPV0qKS9pLAogICAgICBuZXdfaW50ZW50X3F1ZXN0aW9uX2xpc3Q6IFsnJ10KICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIGNvbXBhbnkgbmFtZSBmcm9tIHRoZSBkcm9wZG93biIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KCiAgICBheGlvcy5nZXQoYXBpX2NhbGxzLnNvdXJjZV9saXN0X3VybCgpLCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICBfdGhpcy5vcHRpb25zID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICB9CiAgICB9KTsKICAgIGF4aW9zLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWdzKCksIHsKICAgICAgcGFyYW1zOiB7CiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgfSwKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIF90aGlzLmVudGl0eV9saXN0ID0gcmVzcG9uc2UuZGF0YTsKICAgICAgX3RoaXMucG9zdF9tZXRob2RfcmVxdWVzdF9saXN0ID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgIHRoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7IC8vIGNvbnNvbGUubG9nKCJVdHRlcmFuY2VzIiwgdGhpcy51dHRlcmFuY2VzKTsKICB9LAogIHdhdGNoOiB7CiAgICBlZGl0YWJsZV92YWx1ZXM6IGZ1bmN0aW9uIGVkaXRhYmxlX3ZhbHVlcygpIHsKICAgICAgaWYgKHRoaXMuZWRpdGFibGVfdmFsdWVzICE9ICIiKSB7CiAgICAgICAgdGhpcy5zaG93X3Rhc2tfdmFsdWVzID0gdHJ1ZTsgLy8gIGNvbnNvbGUubG9nKCJIZXJlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3Rhc2tfdmFsdWVzID0gZmFsc2U7IC8vICBjb25zb2xlLmxvZygiTm90IEhlcmUiKTsKICAgICAgfQogICAgfSwKICAgIHNhdmVfZWRpdGFibGVfdmFsdWVzOiBmdW5jdGlvbiBzYXZlX2VkaXRhYmxlX3ZhbHVlcygpIHsKICAgICAgaWYgKHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICB0aGlzLnNhdmVfc2hvd190YXNrX3ZhbHVlcyA9IHRydWU7IC8vICBjb25zb2xlLmxvZygiSGVyZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2F2ZV9zaG93X3Rhc2tfdmFsdWVzID0gZmFsc2U7IC8vICBjb25zb2xlLmxvZygiTm90IEhlcmUiKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9uYW1lOiBmdW5jdGlvbiBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgbmV3X2ludGVudHM6IGZ1bmN0aW9uIG5ld19pbnRlbnRzKHZhbCkgewogICAgICB0aGlzLm5ld19pbnRlbnRzID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0sCiAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudDogZnVuY3Rpb24gY3VycmVudF9zZWxlY3RlZF9pbnRlbnQodmFsKSB7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNoZWNrX3NlbGVjdF9hbGxfaW50ZW50c19jYnhfZGlzYWJsZWQ6IGZ1bmN0aW9uIGNoZWNrX3NlbGVjdF9hbGxfaW50ZW50c19jYnhfZGlzYWJsZWQoKSB7CiAgICAgIGlmICh0aGlzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciB0ZW1wID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQpKSB7CiAgICAgICAgICAgIHRlbXAgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wOwogICAgICB9CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgdGhpcy5wYWdlX2d1aWRlKCk7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMyLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5ld0ludGVudHNQYWdlRGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzMi5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgYm90X3RlbXBsYXRlc19kYXRhID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkJvdFRlbXBsYXRlcyIpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm90X3RlbXBsYXRlc19kYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChib3RfdGVtcGxhdGVzX2RhdGFbaV0uZG9tYWluID09PSAiUmV0YWlsIiAmJiBib3RfdGVtcGxhdGVzX2RhdGFbaV0uaW50ZW50X2RhdGEubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cyA9IGJvdF90ZW1wbGF0ZXNfZGF0YVtpXS5pbnRlbnRfZGF0YS5tYXAoZnVuY3Rpb24gKGFycikgewogICAgICAgICAgcmV0dXJuIGFyci5JbnRlbnQ7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNjb25maWdhcGltb2RhbDQiKS5vbigic2hvd24uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiLTAuNSIpOwogICAgfSk7CiAgICAkKCIjY29uZmlnYXBpbW9kYWw0Iikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICIxIik7CiAgICB9KTsKICAgICQoJ1tkYXRhLXRvZ2dsZT0idG9vbHRpcCJdJykudG9vbHRpcCgpOwogICAgJCgiI2ludGVudG1vZGVsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbDIiKS5vbigic2hvd24uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiLTAuNSIpOwogICAgfSk7CiAgICAkKCIjY29uZmlnYXBpbW9kYWwyIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICIxIik7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbF9qc29uX2VkaXRhYmxlIikub24oInNob3duLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIi0wLjUiKTsKICAgIH0pOwogICAgJCgiI2NvbmZpZ2FwaW1vZGFsX2pzb25fZWRpdGFibGUiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIjEiKTsKICAgIH0pOwogICAgJCgnYVtkYXRhLXRhcmdldD0iI2ludGVudG1vZGVsIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh2bS5pc0VkaXRJbnRlbnQgPT0gdHJ1ZSkgewogICAgICAgIHZtLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgnc2hvdycpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCJzZW5kX21vZGVsX3N0YXR1cyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09IHRydWUpIHsKICAgICAgICBfdGhpczIuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMubW9kYWxfb3Blbl9zd2l0Y2hfdGFiKSB7CiAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgIHRoaXMuJHJvb3QuJGVtaXQoImNoYW5nZV9zaWRlYmFyX21haW5fbWVudSIsICJUcmFpbmluZyBIdWIiKTsKICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIGlmICh0aGlzLmlzRWRpdEludGVudCkgewogICAgICB0aGlzLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgewogICAgICBuZXh0KCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRfdmFyaWFudF9vcGVuX21vZGFsOiBmdW5jdGlvbiBhZGRfdmFyaWFudF9vcGVuX21vZGFsKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIHZlcmlmeV9jaGFuZ2VzOiBmdW5jdGlvbiB2ZXJpZnlfY2hhbmdlcygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgIHRleHQ6ICJJZiB5b3UgaGF2ZSBtYWRlIGFueSBjaGFuZ2VzIHRvIHRoZSBzZWxlY3RlZCBJbnRlbnQgcGxlYXNlIHNhdmUgdGhlbSBmaXJzdCwgZWxzZSB0aGV5IHdpbGwgZGlzY2FyZGVkISIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJTYXZlIiwKICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICJDYW5jZWwiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzMy5lZGl0X2ludGVudCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMzLnNob3dfaW50ZW50cyhfdGhpczMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwoKICAgICAgICAgICAgX3RoaXMzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGtfY2J4X2Nyc3I6IGZ1bmN0aW9uIGNoa19jYnhfY3JzcihpbnRlbnQpIHsKICAgICAgaWYgKGludGVudCA9PSAnYWxsJykgewogICAgICAgIHZhciB0ZW1wID0gImN1cnNvcjogcG9pbnRlcjsiOwoKICAgICAgICBpZiAodGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRlbXAgPSAiY3Vyc29yOiBub3QtYWxsb3dlZDsiOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pbnRlbnRsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQpKSB7CiAgICAgICAgICAgICAgdGVtcCA9ICJjdXJzb3I6IHBvaW50ZXI7IjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRlbXA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyhpbnRlbnQpKSB7CiAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN3aXRjaGluZzogZnVuY3Rpb24gc3dpdGNoaW5nKGVsZW1lbnQpIHsKICAgICAgaWYgKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5jaGVjaygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudW5jaGVjaygpOwogICAgICB9CiAgICB9LAogICAgY2hlY2s6IGZ1bmN0aW9uIGNoZWNrKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG5uIikuY2hlY2tlZCA9IHRydWU7CiAgICAgIHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9IGZhbHNlOyAvLyBjb25zb2xlLmxvZyh0aGlzLnZpZXdfcmVzcG9uc2VfbW9kYWwpOwogICAgfSwKICAgIHVuY2hlY2s6IGZ1bmN0aW9uIHVuY2hlY2soKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyYWRpb0J0bm4iKS5jaGVja2VkID0gZmFsc2U7CiAgICAgIHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9IHRydWU7IC8vIGNvbnNvbGUubG9nKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCk7CiAgICB9LAogICAgY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzOiBmdW5jdGlvbiBjaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXMoKSB7CiAgICAgIHRoaXMubW9kZWxfc3RhdHVzID0gdGhpcy4kc2Vzc2lvbi5nZXQoIk1vZGVsU3RhdHVzIik7CgogICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbih0aGlzLm1vZGVsX3N0YXR1cy5pbnRlbnRfbW9kZWwpID09PSB0cnVlIHx8IEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwpID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzLmludGVudF9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIgfHwgdGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiKSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzOiBmdW5jdGlvbiBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KSB7CiAgICAgIGlmICh0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPT0gdHJ1ZSkgewogICAgICAgIGlmIChpbmRleCA9PSAnc3R5bGUnKSB7CiAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gJ3RpdGxlJykgewogICAgICAgICAgcmV0dXJuICJUcmFpbmluZyBpbiBQcm9ncmVzcyAoVGhpcyBwcm9jZXNzIG1pZ2h0IHRha2UgYXJvdW5kIDMwIG1pbnMgdG8gZmluaXNoKSAiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIC8vIGVkaXRzd2l0Y2hpbmcoZWxlbWVudCkgewogICAgLy8gICAvLyBpZiAodGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPT0gdHJ1ZSkgewogICAgLy8gICAvLyAgIHRoaXMuZWNoZWNrKCk7CiAgICAvLyAgIC8vIH0gZWxzZSB7CiAgICAvLyAgIC8vICAgdGhpcy5ldW5jaGVjaygpOwogICAgLy8gICAvLyB9CiAgICAvLyB9LAogICAgLy8gZWNoZWNrKCkgewogICAgLy8gICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG4iKS5jaGVja2VkID0gdHJ1ZTsKICAgIC8vICAgdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPSBmYWxzZTsKICAgIC8vICAgLy90aGVuIG1ha2luZyBudWxsIHZhbHVlcyB0byBzZXQgZnJlc2ggbmV3IHZhbHVlcwogICAgLy8gICB0aGlzLnVybCA9ICIiOwogICAgLy8gICB0aGlzLmFwaV9tZXRob2QgPSAiIjsKICAgIC8vICAgdGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhID0gIiI7CiAgICAvLyAgIHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID0gIiI7CiAgICAvLyAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSAiIjsKICAgIC8vICAgdGhpcy5lZGl0YWJsZV92YWx1ZXMgPSAiIjsKICAgIC8vICAgdGhpcy5lbmR1c2VyX21zZ190eXBlID0gIiI7CiAgICAvLyAgIHRoaXMuZW5kX3VzZXJfbWVzc2FnZSA9ICIiOwogICAgLy8gICB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPSAiIjsKICAgIC8vICAgdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA9ICIiOwogICAgLy8gICB0aGlzLnJlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPSAiIjsKICAgIC8vICAgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9ICIiOwogICAgLy8gICB0aGlzLnVuc3VjY2Vzc2Z1bF9tZXNzYWdlID0gIiI7CiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsKTsKICAgIC8vIH0sCiAgICAvLyBldW5jaGVjaygpIHsKICAgIC8vICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhZGlvQnRuIikuY2hlY2tlZCA9IGZhbHNlOwogICAgLy8gICB0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCA9IHRydWU7CiAgICAvLyAgIC8vIG1ha2luZyB2YWx1ZXMgbnVsbAogICAgLy8gICB0aGlzLnF1aWxsMi5zZXRUZXh0KCIiKTsKICAgIC8vICAgdGhpcy5zb3VyY2UgPSAiV2ViIjsKICAgIC8vICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgdGhpcy5pbWFnZV91cmwgPSAiIjsKICAgIC8vICAgKHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9ICJObyIpLHZpZGVvX3Jlc3BvbnNlCiAgICAvLyAgIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgLy8gICB0aGlzLmZpbGVfbGFiZWwzID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgdGhpcy5maWxlX2NvbnRlbnQgPSAiIjsKICAgIC8vICAgLy8gY29uc29sZS5sb2codGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwpOwogICAgLy8gfSwKICAgIHRyYWluX21vZGVsOiBmdW5jdGlvbiB0cmFpbl9tb2RlbCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJBcmUgWW91IFN1cmU/IiwKICAgICAgICAgIHRleHQ6ICJZb3Ugd2FudCB0byBUcmFpbiBUaGUgTW9kZWw/IiwKICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIiwKICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudHJhaW5fbW9kZWwoKSwgewogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNC5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczQuY29tcGFueWlkCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNC4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBfdGhpczQud2FudF9zdGF0dXMgPSB0cnVlOwoKICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIndhbnRfbW9kZWxfc3RhdHVzIiwgX3RoaXM0LndhbnRfc3RhdHVzKTsKCiAgICAgICAgICAgICAgX3RoaXM0LmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PT0gNDA0NikgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuZGF0YS5NU0cpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PT0gMTAzNCkgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEuTVNHKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyB0cmFpbl9hbmRfdGVzdF9tb2RlbCgpIHsKICAgIC8vICAgU3dhbCh7CiAgICAvLyAgICAgdGl0bGU6ICJBcmUgWW91IFN1cmU/IiwKICAgIC8vICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gVHJhaW4gJiBUZXN0IFRoZSBNb2RlbD8iLAogICAgLy8gICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAvLyAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgIC8vICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgIC8vICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgLy8gICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBDb25maXJtISIsCiAgICAvLyAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgLy8gICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgIC8vICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgLy8gICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgLy8gICAgICAgYXhpb3MKICAgIC8vICAgICAgICAgLnBvc3QoCiAgICAvLyAgICAgICAgICAgYXBpX2NhbGxzLnRyYWluX2ludGVudF9tb2RlbCgpLAogICAgLy8gICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgICAgICAgdGVzdF9tb2RlbDogdHJ1ZSwKICAgIC8vICAgICAgICAgICB9LAogICAgLy8gICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgICAgICB9LAogICAgLy8gICAgICAgICAgIH0KICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09IDQwNDYpIHsKICAgIC8vICAgICAgICAgICAgIHN3YWwoewogICAgLy8gICAgICAgICAgICAgICB0aXRsZTogIlJlc3VsdHMgd291bGQgYmUgYXZhaWxhYmxlIHNvb24iLAogICAgLy8gICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLk1TRywKICAgIC8vICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgLy8gICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgIC8vICAgICAgICAgICAgICAgICAvLyAkKCcjZmlsZV91cGxvYWQnKS5tb2RhbCgnaGlkZScpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgIC8vICAgICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09PSAxMDM0KSB7CiAgICAvLyAgICAgICAgICAgICBzd2FsKHsKICAgIC8vICAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgIC8vICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5NU0csCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgLy8gICAgICAgICAgICAgICAgIC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAvLyAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAvLyAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgLy8gICAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgICAgc3dhbCh7CiAgICAvLyAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgLy8gJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgIC8vICAgICAgICAgfSkKICAgIC8vICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICAgICAgLy8gY29uc29sZS5sb2coZSk7CiAgICAvLyAgICAgICAgICAgaWYgKAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgICAgICkgewogICAgLy8gICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgICAgU3dhbCh7CiAgICAvLyAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICAgIH0pOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgICAvLyB9LAogICAgY2hlY2tfY3VycmVudF9pbnRlbnQ6IGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnRfaW50ZW50KGluZGV4KSB7CiAgICAgIHZhciByZXR1cm5fdmFyID0gIiI7CgogICAgICBpZiAodGhpcy5pbnRlbnRsaXN0W2luZGV4XS5JbnRlbnQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9oaWdobGlnaHQpIHsKICAgICAgICByZXR1cm5fdmFyICs9ICJjdXJyZW50LWFjdGl2ZS1pbnRlbnQiOwogICAgICB9CgogICAgICBpZiAodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpbmRleF0uSW50ZW50KSkgewogICAgICAgIHJldHVybl92YXIgKz0gIiBkaXNhYmxlZC1pbnRlbnQiOwogICAgICB9CgogICAgICByZXR1cm4gcmV0dXJuX3ZhcjsKICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZTogZnVuY3Rpb24gY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICBsb2FkX2ludGVudDogZnVuY3Rpb24gbG9hZF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICAvLyB0aGlzLmludGVudGxpc3QgPSBbXTsKICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAnJzsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICBfdGhpczUubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgIF90aGlzNS50b3RhbF9wYWdlcyA9IE1hdGguY2VpbChfdGhpczUubnVtYmVyX29mX3Jvd3MgLyBfdGhpczUucGVyX3BhZ2UpOwogICAgICAgICAgX3RoaXM1LmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7CgogICAgICAgICAgaWYgKF90aGlzNS5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKEJvb2xlYW4oY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpKSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RoaXM1LnNldHBhZ2luYXRpb24oX3RoaXM1LnBhZ2Vfbm8pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzaG93X2ludGVudHM6IGZ1bmN0aW9uIHNob3dfaW50ZW50cyhpbmRleCkgewogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICB2YXIgY2xvbmVfc2VsZWN0ZWRfaW50ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmludGVudGxpc3RbaW5kZXhdKSk7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXggPSBpbmRleDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5JbnRlbnQ7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaGlnaGxpZ2h0ID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudDsKICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlF1ZXN0aW9uczsKICAgICAgdGhpcy5uZXdfaW50ZW50X3F1ZXN0aW9uX2xpc3QgPSBfdG9Db25zdW1hYmxlQXJyYXkobmV3IFNldChjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUXVlc3Rpb25zKSk7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudERlc2NyaXB0aW9uOwogICAgICB0aGlzLm9sZF9pbnRlbnRfbmFtZSA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ7CiAgICAgIHRoaXMub2xkX3F1ZXN0aW9uc19saXN0ID0gdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zOwogICAgICB0aGlzLmlzX3Jlc3BvbnNlID0gZmFsc2U7CiAgICAgIHRoaXMuaXNfZW5kcG9pbnQgPSBmYWxzZTsKCiAgICAgIGlmIChjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UgIT0gbnVsbCAmJiBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UgIT0gIiIpIHsKICAgICAgICB0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCA9IHRydWU7CiAgICAgICAgdGhpcy5vbGRfdmlkZW9fdXJsID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlLlZpZGVvVXJsOwogICAgICAgIHRoaXMuaXNfcmVzcG9uc2UgPSB0cnVlOwogICAgICAgIHRoaXMuaXNfZW5kcG9pbnQgPSBmYWxzZTsKICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZS5SZXNwb25zZTsgLy8gdGhpcy5xdWlsbDIucm9vdC5pbm5lckhUTUwgPSB0aGlzLmludGVudGxpc3RbaW5kZXhdLlJlc3BvbnNlLlJlc3BvbnNlOwoKICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9zb3VyY2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UuU291cmNlOwogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX2ltYWdlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlLkltYWdlVXJsOwoKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfaW1hZ2UgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5uYW1lX2ZpbGUgPSB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9pbWFnZS5zcGxpdCgiLyIpOwogICAgICAgICAgdGhpcy50ZW1wX2ZpbGVfbmFtZSA9IHRoaXMubmFtZV9maWxlW3RoaXMubmFtZV9maWxlLmxlbmd0aCAtIDFdOyAvLyBjb25zb2xlLmxvZygic3BsaXR0ZWQiKTsKCiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwzID0gdGhpcy50ZW1wX2ZpbGVfbmFtZTsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWwzOwogICAgICAgICAgdGhpcy5lZGl0X2ltYWdlX3Jlc3BvbnNlID0gIlllcyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSAiIjsKICAgICAgICAgIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9ICJObyI7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwzID0gIkNob29zZSBmaWxlIjsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3ZpZGVvID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlLlZpZGVvVXJsOwoKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfdmlkZW8gIT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfdmlkZW8ubGVuZ3RoICE9IDApIHsKICAgICAgICAgIHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9ICJZZXMiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVkaXRfdmlkZW9fcmVzcG9uc2UgPSAiTm8iOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQgIT0gbnVsbCAmJiBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQgIT0gIiIpIHsKICAgICAgICB0aGlzLmlzX3Jlc3BvbnNlID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc19lbmRwb2ludCA9IHRydWU7CiAgICAgICAgdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPSBmYWxzZTsKICAgICAgICB0aGlzLnV0dGVyYW5jZXMgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuVGFza3MuVXR0ZXJhbmNlczsKICAgICAgICB0aGlzLmFwaV9tZXRob2QgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuTUVUSE9EOwogICAgICAgIHRoaXMuZWRpdGFibGVfdmFsdWVzID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlZhbHVlc1RvRWRpdDsKICAgICAgICB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5pc0VkaXQ7CiAgICAgICAgdGhpcy51cmwgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuVVJMOwogICAgICAgIHRoaXMuc2hvd19qc29uX3JlcXVlc3RfZGF0YSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXF1ZXN0SnNvbjsKICAgICAgICB0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlc3BvbnNlSnNvbjsKICAgICAgICB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuTXNnX3R5cGU7CiAgICAgICAgdGhpcy5lbmRfdXNlcl9tZXNzYWdlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50Lk1lc3NhZ2VUb0VuZFVzZXI7CiAgICAgICAgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXNwb25zZUtleVRvRW5kVXNlcjsKICAgICAgICB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVzcG9uc2VLZXlFZGl0YWJsZTsKICAgICAgICB0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlc3BvbnNlSnNvbjsKICAgICAgICB0aGlzLnJlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVzcG9uc2VLZXlNZXNzYWdlVG9FbmRVc2VyOwogICAgICAgIHRoaXMudW5zdWNjZXNzZnVsX21lc3NhZ2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuVW5TdWNjZXNzZnVsTWVzc2FnZTsKICAgICAgICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy51dHRlcmFuY2VzKSB7CiAgICAgICAgICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICBrZXlfbmFtZTogdGhpcy51dHRlcmFuY2VzW2ldLlJhd1Nsb3ROYW1lLAogICAgICAgICAgICBpbnB1dF90ZXh0OiB0aGlzLnV0dGVyYW5jZXNbaV0uVGV4dAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2F2ZV9yZXFfanNvbjogZnVuY3Rpb24gc2F2ZV9yZXFfanNvbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2F2ZV9qc29uX3JlcXVlc3RfZGF0YSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIHJlcV9qc29uOiBmdW5jdGlvbiByZXFfanNvbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2hvd19qc29uX3JlcXVlc3RfZGF0YSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIHNhdmVfcmVzcF9qc29uOiBmdW5jdGlvbiBzYXZlX3Jlc3BfanNvbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICByZXNwX2pzb246IGZ1bmN0aW9uIHJlc3BfanNvbigpIHsKICAgICAgdHJ5IHsKICAgICAgICBKU09OLnBhcnNlKHRoaXMuc2hvd19qc29uX3Jlc3BvbnNlX2RhdGEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBzYXZlX3B1c2hpbmc6IGZ1bmN0aW9uIHNhdmVfcHVzaGluZygpIHsKICAgICAgaWYgKHRoaXMuc2F2ZV9hcGlfbWV0aG9kID09PSBudWxsKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBNZXRob2QiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICBpZiAodGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyAhPSAiIikgewogICAgICAgICAgdmFyIGVtcHR5X3ZhcnMgPSBbXTsKICAgICAgICAgIHZhciBjc3YgPSB0aGlzLnNhdmVfZWRpdGFibGVfdmFsdWVzLnNwbGl0KCI7Iik7IC8vICBjb25zb2xlLmxvZygidGhpcyBpcyBjc3YiLGNzdik7CgogICAgICAgICAgdmFyIGlucHV0X3ZhbHVlOyAvLyB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIGNzdikgewogICAgICAgICAgICB2YXIgdGVtcF9saXN0ID0gY3N2W2ldLnNwbGl0KCIsIik7IC8vICBjb25zb2xlLmxvZygidGhpcyBpcyB0ZW1wIix0ZW1wX2xpc3QpOwoKICAgICAgICAgICAgaWYgKHRlbXBfbGlzdFt0ZW1wX2xpc3QubGVuZ3RoIC0gMV0gIT0gIiIpIHsKICAgICAgICAgICAgICAvLyAgY29uc29sZS5sb2coImhlcmVlZSIpOwogICAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gdGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXTsKCiAgICAgICAgICAgICAgaWYgKCF0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZXkua2V5X25hbWU7CiAgICAgICAgICAgICAgfSkuaW5jbHVkZXMoaW5wdXRfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIGtleV9uYW1lOiBpbnB1dF92YWx1ZSwKICAgICAgICAgICAgICAgICAgaW5wdXRfdGV4dDogIiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gW107CgogICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgaWYgKGNzdi5pbmNsdWRlcyh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaW5kZXhdWydrZXlfbmFtZSddKSkgewogICAgICAgICAgICAgIHRlbXAucHVzaCh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaW5kZXhdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcyA9IHRlbXA7IC8vIGZvciAodmFyIGkgaW4gdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAvLyAgIGlmICh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgLy8gICAgIGVtcHR5X3ZhcnMucHVzaCh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0pOwogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgey8vIGNvbnNvbGUubG9nKGUpOwogICAgICB9CiAgICB9LAogICAgZWRpdF9wdXNoaW5nOiBmdW5jdGlvbiBlZGl0X3B1c2hpbmcoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHRoaXMuZWRpdGFibGVfdmFsdWVzICE9ICIiKSB7CiAgICAgICAgICB2YXIgZW1wdHlfdmFycyA9IFtdOwogICAgICAgICAgdmFyIGNzdiA9IHRoaXMuZWRpdGFibGVfdmFsdWVzLnNwbGl0KCI7Iik7CiAgICAgICAgICB2YXIgaW5wdXRfdmFsdWU7IC8vIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIGNzdikgewogICAgICAgICAgICB2YXIgdGVtcF9saXN0ID0gY3N2W2ldLnNwbGl0KCIsIik7CgogICAgICAgICAgICBpZiAodGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXSAhPSAiIikgewogICAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gdGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXTsKCiAgICAgICAgICAgICAgaWYgKCF0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5LmtleV9uYW1lOwogICAgICAgICAgICAgIH0pLmluY2x1ZGVzKGlucHV0X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAga2V5X25hbWU6IGlucHV0X3ZhbHVlLAogICAgICAgICAgICAgICAgICBpbnB1dF90ZXh0OiAiIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRlbXAgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgaWYgKGNzdi5pbmNsdWRlcyh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2luZGV4XVsna2V5X25hbWUnXSkpIHsKICAgICAgICAgICAgICB0ZW1wLnB1c2godGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcyA9IHRlbXA7IC8vIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgLy8gICBpZiAodGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ID09ICIiKSB7CiAgICAgICAgICAvLyAgICAgZW1wdHlfdmFycy5wdXNoKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0pOwogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSBbXTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsvLyBjb25zb2xlLmxvZyhlKTsKICAgICAgfQogICAgfSwKICAgIC8vIFRoaXMgaXMgZm9yIGNoZWNraW5nIHdoaWxlIGVudGVyaW5nIGEgaW50ZW50IG5hbWUgaWYgaXQgYWxyZWFkeSBleGlzdHMgb3Igbm90CiAgICBlbnRlcmludGVudGlkOiBmdW5jdGlvbiBlbnRlcmludGVudGlkKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBpbnRlbnRfc2VhcmNoX2tleSA9IHRoaXMubmV3X2ludGVudHM7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfaW50ZW50X3NlYXJjaDogdHJ1ZSwKICAgICAgICBpbnRlbnRfc2VhcmNoX2tleTogdGhpcy5uZXdfaW50ZW50cwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vdCBFeGlzdHMiICYmIF90aGlzNi5uZXdfaW50ZW50cyA9PT0gaW50ZW50X3NlYXJjaF9rZXkpIHsKICAgICAgICAgIF90aGlzNi5pbnRlbnRfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChfdGhpczYubmV3X2ludGVudHMgIT0gIiIpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJBbHJlYWR5IEV4aXN0cyIgJiYgX3RoaXM2Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM2LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZWRpdGluZyBhbmQgZW50ZXJpbmcgYSBpbnRlbnQgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWRfZWRpdDogZnVuY3Rpb24gZW50ZXJpbnRlbnRpZF9lZGl0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfaW50ZW50X3NlYXJjaDogdHJ1ZSwKICAgICAgICBpbnRlbnRfc2VhcmNoX2tleTogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCk7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vdCBFeGlzdHMiKSB7CiAgICAgICAgICBfdGhpczcuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiQWxyZWFkeSBFeGlzdHMiKSB7CiAgICAgICAgICBpZiAoX3RoaXM3Lm9sZF9pbnRlbnRfbmFtZSA9PSBfdGhpczcuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpIHsKICAgICAgICAgICAgX3RoaXM3LmludGVudF9hbHJlYWR5X2V4aXN0c19lZGl0ID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9IG51bGw7IC8vICBjb25zb2xlLmxvZygieW91IG9sZCBvbmx5Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAgY29uc29sZS5sb2coInlvdSBoZXJlIik7CiAgICAgICAgICAgIF90aGlzNy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBpbnRlbnRfbmFtZV9jaGVja19zcGVjaWFsX2NoYXJhY3RlcnM6IGZ1bmN0aW9uIGludGVudF9uYW1lX2NoZWNrX3NwZWNpYWxfY2hhcmFjdGVycyhlKSB7CiAgICAgIGlmICgvXlteYS16QS1aMC05XyBdKiQvLnRlc3QoZS5rZXkpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgZWRpdF9pbnRlbnQ6IGZ1bmN0aW9uIGVkaXRfaW50ZW50KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLm9sZF9pbnRlbnRfbmFtZSA9PSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSB7CiAgICAgICAgdmFyIGludGVudF90b19zZW5kID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB2YXIgaW50ZW50X3RvX3NlbmQgPSB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMub2xkX2ludGVudF9uYW1lOwogICAgICAgIHZhciBpbnRlbnRfdG9fc2VuZCA9IHRoaXMub2xkX2ludGVudF9uYW1lOwogICAgICB9CgogICAgICBpZiAodGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCkgewogICAgICAgIHRvYXN0ci5lcnJvcigiQW4gSW50ZW50IHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzLiIpOwogICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ID09ICIiKSB7CiAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYW4gSW50ZW50IG5hbWUiKTsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYW4gSW50ZW50IG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zW19pXSA9PT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zW19pXSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlF1ZXN0aW9ucyBjYW5ub3QgYmUgYmxhbmsiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlF1ZXN0aW9ucyBjYW5ub3QgYmUgYmxhbmsiLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gJ3NoaXBwaW5nJyAmJiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ICE9ICdtZXNzYWdpbmdfcGxhdGZvcm0nICYmIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gJ2NvbnRhY3RfdXMnICYmIHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgIGlzX2RlZmF1bHRfaW50ZW50OiB0cnVlLAogICAgICAgICAgLy8gb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucywKICAgICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbnNfbGlzdAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOyAvLyB0aGlzLmludGVudHMgPSAiIjsKICAgICAgICAgIC8vIHRoaXMucXVlc3Rpb25fbGlzdCA9IFswXTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGV4dDogIkludGVudCBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVudCB1c2VkIGluIGRpYWxvZyBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdGV4dDogIkludGVudCBoYXMgYmVlbiBlZGl0ZWQsIHRoYXQgaXMgdXNlZCBpbiBkaWFsb2cgbm9kZShzKS4gUGxlYXNlIG1vZGlmeSB0aGlzIGluIGRpYWxvZyBub2RlKHMpIGFsc28iLAogICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRmFpbHVyZSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJFcnJvciIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PT0gIlF1ZXJ5IEV4ZWN1dGVkIFVuU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSAvLyB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX3Jlc3BvbnNlID09PSBmYWxzZSAmJiB0aGlzLmlzX2VuZHBvaW50ID09PSBmYWxzZSkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVkaXRfaW50ZW50OiB0cnVlLAogICAgICAgICAgb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgIGludGVudF9kZXNjcmlwdGlvbjogdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludGVudCBRdWVzdGlvbiBFZGl0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGVkaXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogMzUwMCwKICAgICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIlVzZWQgSW50ZW50IE5hbWUgRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRleHQ6ICJJbnRlbnQgaGFzIGJlZW4gZWRpdGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludGVudCBRdWVzdGlvbiBOb3QgRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogIlRoZXJlIHdhcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgIGlmICh0aGlzLm9sZF9pbWFnZV9uYW1lID09IHRoaXMuZmlsZV9sYWJlbDMpIHsKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbDMgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlW19pMl0gPT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VbX2kyXSA9PSAiPHA+PGJyPjwvcD4iKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJSZXNwb25zZXMgY2Fubm90IGJlIGJsYW5rIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwzID09ICJDaG9vc2UgZmlsZSIpIHsKICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwzID09PSAiQ2hvb3NlIGZpbGUiICYmIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9PSAiTm8iKSB7CiAgICAgICAgICAgIHZhciBkZWxldGVfaW1hZ2U7CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCIpOwoKCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgaXNfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgICAgIG9sZF9pbnRlbnRfbmFtZTogaW50ZW50X3RvX3NlbmQsCiAgICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICAgIGludGVudF9kZXNjcmlwdGlvbjogdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICBmaWxlX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy5lZGl0X3ZpZGVvX3Jlc3BvbnNlID09ICJZZXMiID8gdGhpcy5lbWJkX2xpbmtfZWRpdCA6IFtdLAogICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Vfc291cmNlLAogICAgICAgICAgICAgIHJlc3BvbnNlOiB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvbGRfaW1hZ2VfZGVsZXRlOiB0aGlzLmZpbGVfbGFiZWwzID09PSAiQ2hvb3NlIGZpbGUiICYmIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9PSAiTm8iID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICBvbGRfaW1hZ2VfbmFtZTogdGhpcy5vbGRfaW1hZ2VfbmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOyAvLyB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgICAgICAgIC8vIHRoaXMuaW50ZW50cyA9ICIiOwogICAgICAgICAgICAvLyB0aGlzLnF1ZXN0aW9uX2xpc3QgPSBbMF07CiAgICAgICAgICAgIC8vIHZhciByZXNwb25zZV9hcGkgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGVkaXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVudCB1c2VkIGluIGRpYWxvZyBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgdGV4dDogIkludGVudCBoYXMgYmVlbiBlZGl0ZWQsIHRoYXQgaXMgdXNlZCBpbiBkaWFsb2cgbm9kZShzKS4gUGxlYXNlIG1vZGlmeSB0aGlzIGluIGRpYWxvZyBub2RlKHMpIGFsc28iLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkZhaWx1cmUiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09PSAiRHVwbGljYXRlIGltYWdlIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJUaGlzIGltYWdlIGFscmVhZHkgZXhpc3RzLiBQbGVhc2UgdHJ5IGFub3RoZXIiLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT09ICJRdWVyeSBFeGVjdXRlZCBVblN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IC8vIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICAgIGlzX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICBpbWFnZV9lZGl0OiB0cnVlLAogICAgICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucywKICAgICAgICAgICAgaW50ZW50X2Rlc2NyaXB0aW9uOiB0aGlzLnNlbGVjdGVkX2ludGVudF9kZXNjcmlwdGlvbiwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBvbGRfaW1hZ2VfbmFtZTogdGhpcy5vbGRfaW1hZ2VfbmFtZSwKICAgICAgICAgICAgbmV3X2ltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbDMsCiAgICAgICAgICAgIGltYWdlX2Jsb2I6IHRoaXMuZmlsZV9jb250ZW50MywKICAgICAgICAgICAgb2xkX3F1ZXN0aW9uX2xpc3Q6IHRoaXMub2xkX3F1ZXN0aW9uc19saXN0LAogICAgICAgICAgICByZXNwb25zZTogewogICAgICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsMywKICAgICAgICAgICAgICB2aWRlb19saW5rOiB0aGlzLmVkaXRfdmlkZW9fcmVzcG9uc2UgPT0gIlllcyIgPyB0aGlzLmVtYmRfbGlua19lZGl0IDogW10sCiAgICAgICAgICAgICAgc291cmNlOiB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9zb3VyY2UsCiAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGVkaXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVudCB1c2VkIGluIGRpYWxvZyBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgdGV4dDogIkludGVudCBoYXMgYmVlbiBlZGl0ZWQsIHRoYXQgaXMgdXNlZCBpbiBkaWFsb2cgbm9kZShzKS4gUGxlYXNlIG1vZGlmeSB0aGlzIGluIGRpYWxvZyBub2RlKHMpIGFsc28iLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkZhaWx1cmUiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlRoaXMgaW1hZ2UgYWxyZWFkeSBleGlzdHMuIFBsZWFzZSB0cnkgYW5vdGhlciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09PSAiUXVlcnkgRXhlY3V0ZWQgVW5TdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsgLy8gdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7IC8vIHRoaXMucmVzcG9uc2UgPSAiIjsKICAgICAgICAgIC8vIHRoaXMuc291cmNlID0gIiI7CiAgICAgICAgICAvLyB0aGlzLmludGVudHMgPSAiIjsKICAgICAgICAgIC8vIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgLy8gdGhpcy5maWxlX2NvbnRlbnQyID0gIiI7CiAgICAgICAgICAvLyB0aGlzLnZpZGVvX2xpbmsgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsKSB7CiAgICAgICAgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLmVkaXRhYmxlX3ZhbHVlcyAhPSAiIikgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZyh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgICAgaWYgKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMudXJsID09ICIiIHx8IHRoaXMuYXBpX21ldGhvZCA9PSBudWxsIHx8IHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09IG51bGwgfHwgdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmIHRoaXMuZWRpdGFibGVfdmFsdWVzID09ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy5hcGlfbWV0aG9kID09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgTWV0aG9kIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgUmVxdWVzdCBKU09OIEVkaXRhYmxlOiIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJlcV9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiAiWW91ciBSZXF1ZXN0IEpTT04gaXMgaW52YWxpZC4iLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiAhdGhpcy5pc0VkaXQpIHsvLyB2YXIgY3N2ID0gdGhpcy5lZGl0YWJsZV92YWx1ZXMuc3BsaXQoIjsiKTsKICAgICAgICAgICAgLy8gdmFyIGlucHV0X3ZhbHVlOwogICAgICAgICAgICAvLyB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gY3N2KSB7CiAgICAgICAgICAgIC8vICAgbGV0IHRlbXBfbGlzdCA9IGNzdltpXS5zcGxpdCgiLCIpOwogICAgICAgICAgICAvLyAgIGlucHV0X3ZhbHVlID0gdGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgLy8gICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICAvLyAgICAga2V5X25hbWU6IGlucHV0X3ZhbHVlLAogICAgICAgICAgICAvLyAgICAgaW5wdXRfdGV4dDogIiIsCiAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgIC8vIGxldCBlbXB0eV92YXJzID0gW107CiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAvLyAgIGlmICh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgLy8gICAgIGVtcHR5X3ZhcnMucHVzaCh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQpOwogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gICAvLyAgY29uc29sZS5sb2codGhpcy50YXNrX2lucHV0X3ZhbHVlcyk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYoZW1wdHlfdmFycy5sZW5ndGggIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmZpbmFsc3RlcCA9IHRydWU7IC8vIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSB2YWx1ZXMuIik7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmluYWxzdGVwID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmZpbmFsc3RlcCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgZXhpc3RpbmdfaW50ZW50X2xpc3QgPSB0aGlzLmFwaV9saXN0LmZpbHRlcihmdW5jdGlvbiAoYXBpKSB7CiAgICAgICAgICAgIHJldHVybiBhcGkuaW50ZW50ID09IF90aGlzOC5pbnRlbnRzOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgcG9zdF9tZXRob2RfZGF0YSwgZ2V0X21ldGhvZF9kYXRhOwogICAgICAgICAgcG9zdF9tZXRob2RfZGF0YSA9IHt9OwogICAgICAgICAgZ2V0X21ldGhvZF9kYXRhID0ge307IC8vIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gIlBPU1QiICYmIHRoaXMudGFza19mcm9tID09ICJmcm9tX2VudGl0eSIpIHsKCiAgICAgICAgICBpZiAodGhpcy5hcGlfbWV0aG9kID09ICJQT1NUIikgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICBwb3N0X21ldGhvZF9kYXRhW3RoaXMudGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gewogICAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCAhPSAiIiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVudGl0eTogdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50LAogICAgICAgICAgICAgICAgbm90X2ludGVudDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5hcGlfbWV0aG9kID09ICJHRVQiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgIGdldF9tZXRob2RfZGF0YVt0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmtleV9uYW1lXSA9IHsKICAgICAgICAgICAgICAgIEVudGl0eTogdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgU2xvdDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXhpc3RpbmdfaW50ZW50X2xpc3QubGVuZ3RoID4gMCAmJiAhdGhpcy5pc0VkaXQpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlRoZSBpbnRlbnQgYWxyZWFkeSBleGlzdHMuIFBsZWFzZSB0cnkgd2l0aCBhbm90aGVyIGludGVudCIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU2VsZWN0IEVuZCBVc2VyIE1lc3NhZ2UgdHlwZSIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA1MDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIikgewogICAgICAgICAgICBpZiAodGhpcy5yZXNwX2pzb24oKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgUmVzcG9uc2UgSlNPTiBpcyBpbnZhbGlkLiIsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPT0gIiIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCB2YWx1ZXMiLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMucmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9PSAiIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCB2YWx1ZXMiLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuZW5kX3VzZXJfbWVzc2FnZSA9ICIiOyAvLyBjb25zb2xlLmxvZygiZW5kX3VzZXIgbWVzc2FnZSBudWxsIix0aGlzLmVuZF91c2VyX21lc3NhZ2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpIHsKICAgICAgICAgICAgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9ICIiOwogICAgICAgICAgICB0aGlzLnJlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPSAiIjsgLy8gY29uc29sZS5sb2coInJlc3BvbnNlIGtleSB0byBlbmQgdXNlciBudWxsIix0aGlzLnJlc3BvbnNlX2tleV90b19lbmR1c2VyKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy51bnN1Y2Nlc3NmdWxfbWVzc2FnZSA9PSAiIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoKHRoaXMuZW5kX3VzZXJfbWVzc2FnZSAhPSAiIiB8fCB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIikgJiYgKHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSAhPSBudWxsIHx8IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgJiYgdGhpcy5lbmR1c2VyX21zZ190eXBlICE9IG51bGwgJiYgKHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgIT0gIiIgfHwgdGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSAmJiAodGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSAhPSAiIiB8fCB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uID09ICJTaWx2ZXIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIllvdSdyZSBub3QgYXZhaWwgdG8gdXNlIHRoaXMgc2VydmljZSwgZHVlIHRvIHlvdXIgc3Vic2NyaXB0aW9uIHBsYW4uIEtpbmRseSB1cGdyYWRlIHlvdXIgcGxhbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgdGFza3MgPSB7fTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aCA+IDAgfHwgdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIkZhbHNlIikgewogICAgICAgICAgICAgICAgdmFyIF9heGlvcyRwb3N0OwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IFtdOwogICAgICAgICAgICAgICAgICB0ZW1wLnB1c2goewogICAgICAgICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgICAgICAgIFRleHQ6IHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGFza3NbdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB0ZW1wOwogICAgICAgICAgICAgICAgfSAvLyBjb25zb2xlLmxvZygicmVhY2hlZCBoZXJlIGZpbmFsbHkiKTsKCgogICAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIChfYXhpb3MkcG9zdCA9IHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICAgICAgICAgIGlzX2VuZHBvaW50OiB0cnVlLAogICAgICAgICAgICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICB1cmw6IHRoaXMudXJsLAogICAgICAgICAgICAgICAgICByZXF1ZXN0anNvbjogdGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhLAogICAgICAgICAgICAgICAgICBhcGlfbWV0aG9kOiB0aGlzLmFwaV9tZXRob2QsCiAgICAgICAgICAgICAgICAgIGVuZF91c2VyX21lc3NhZ2U6IHRoaXMuZW5kX3VzZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgbXNnX3R5cGU6IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2VrZXk6IHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIsCiAgICAgICAgICAgICAgICAgIGFwaV9lZGl0OiB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgYXBpX2VkaXRhYmxlX3ZhbHVlOiB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgPyB0aGlzLmVkaXRhYmxlX3ZhbHVlcyA6ICIiLAogICAgICAgICAgICAgICAgICByZXNwb25zZWpzb246IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiID8gdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA6ICIiLAogICAgICAgICAgICAgICAgICByZXNwb25zZV9tc2dfZWRpdGFibGU6IHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbXNnX2VkaXRhYmxlX3ZhbHVlOiB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlIDogIiIsCiAgICAgICAgICAgICAgICAgIHJlcXVlc3RfanNvbl9rZXlfbWFwcGluZzogZ2V0X21ldGhvZF9kYXRhLAogICAgICAgICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YTogcG9zdF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgdW5zdWNjZXNzZnVsX21zZzogdGhpcy51bnN1Y2Nlc3NmdWxfbWVzc2FnZQogICAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAibGljZW5zZV9rZXkiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJlbWFpbCIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInRva2VuIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInRhc2tfZGV0YWlscyIsIHRhc2tzKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAic3Vic2NyaXB0aW9uIiwgIlBsYXRpbnVtIiksIF9heGlvcyRwb3N0KSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJKc29uIGFkZGVkIikgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVudCBBZGRlZCIsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJKc29uIHVwZGF0ZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlbnQgYWRkZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7Ly8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJJbnRlbnQgdXNlZCBpbiBkaWFsb2cgZWRpdGVkIHN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlbnQgaGFzIGJlZW4gZWRpdGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7Ly8gdGhpcy5sb2FkX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiRW5kcG9pbnQgbGltaXQgZXhjZWVkIikgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIExpbWl0IGhhcyBiZWVuIGV4Y2VlZGVkLCBLaW5kbHkgdXBncmFkZSB5b3VyIHBsYW4iLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsvLyBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgIH0pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gLy8gZWxzZSBpZiAoCiAgICAgICAgICAgICAgLy8gICAgIHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJGYWxzZSIgJiYKICAgICAgICAgICAgICAvLyAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwCiAgICAgICAgICAgICAgLy8gICApCgogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIpOwogICAgICAgICAgICBpZiAodGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID09IG51bGwgJiYgdGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIgJiYgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciAhPSAiIiAmJiB0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhICE9ICIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBSZXNwb25zZSBKU09OIEVkaXRhYmxlIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX2ludGVudDogZnVuY3Rpb24gc2F2ZV9pbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5hZGRfZWRpdCA9ICJ0cnVlIjsKCiAgICAgIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cykgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIkFuIEludGVudCB3aXRoIHRoaXMgbmFtZSBhbHJlYWR5IGV4aXN0cyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMubmV3X2ludGVudHMgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYW4gSW50ZW50IG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QubGVuZ3RoOyBfaTMrKykgewogICAgICAgICAgaWYgKHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W19pM10gPT09ICIiIHx8IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W19pM10gPT09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlF1ZXN0aW9ucyBjYW5ub3QgYmUgYmxhbmsiLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuYWRkX2VkaXQgPT0gInRydWUiKSB7CiAgICAgICAgaWYgKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgICAgaWYgKHRoaXMuaW1hZ2VfcmVzcG9uc2UgPT0gIlllcyIgJiYgdGhpcy5maWxlX2NvbnRlbnQyID09ICIiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJVcGxvYWQgYSBJbWFnZSIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOyAvLyAgY29uc29sZS5sb2coImNzZGNzZGZnZSBpbWFnZSIpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZpZGVvX3Jlc3BvbnNlID09ICJZZXMiICYmIHRoaXMuZW1iZF9saW5rID09ICIiKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiVXBsb2FkIGEgVmlkZW8gbGluayIpOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGEgVmlkZW8gbGluayIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOyAvLyAgY29uc29sZS5sb2coImNzZGNzZGZnZSB2aWRlbyIpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IHRoaXMubXVsdGlwbGVfcmVzcG9uc2UubGVuZ3RoOyBfaTQrKykgewogICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZV9yZXNwb25zZVtfaTRdID09ICIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUmVzcG9uc2VzIGNhbm5vdCBiZSBibGFuayIsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwyID09ICJDaG9vc2UgZmlsZSIpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImFwaSBjYWxsIik7CiAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgLy8gJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIGFyZSBzdWJtaXR0aW5nIHlvdXIgZGV0YWlscy4uLiIsCiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICAgICAgaXNfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgICAgICAgLy8gaW50ZW50OiB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgICByZXNwb25zZTogewogICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBudWxsLAogICAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy52aWRlb19yZXNwb25zZSA9PSAiWWVzIiA/IHRoaXMuZW1iZF9saW5rIDogW10sCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMubXVsdGlwbGVfcmVzcG9uc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGFkZGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlRoZXJlIHdhcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCB3aXRoIGltYWdlICIpOwogICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIC8vICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSBhcmUgc3VibWl0dGluZyB5b3VyIGRldGFpbHMuLi4iLAogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgICAgICAgIGlzX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsMiwKICAgICAgICAgICAgICAgIGZpbGVfZGF0YTogdGhpcy5maWxlX2NvbnRlbnQyLAogICAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy52aWRlb19yZXNwb25zZSA9PSAiWWVzIiA/IHRoaXMuZW1iZF9saW5rIDogW10sCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMubXVsdGlwbGVfcmVzcG9uc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGFkZGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiRHVwbGljYXRlIGltYWdlIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJUaGlzIGltYWdlIGFscmVhZHkgZXhpc3RzLiBQbGVhc2Ugc2VsZWN0IGFub3RoZXIgYW5kIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJUaGVyZSB3YXMgYW4gaW50ZXJuYWwgc2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIXRoaXMudmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmIHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAvLyAgY29uc29sZS5sb2codGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cykgewogICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIkFuIEludGVudCB3aXRoIHRoaXMgbmFtZSBhbHJlYWR5IGV4aXN0cy4iKTsKICAgICAgICAgIC8vIH0KCgogICAgICAgICAgaWYgKHRoaXMuc2F2ZV91cmwgPT0gIiIgfHwgdGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gbnVsbCB8fCB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09IG51bGwgfHwgdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyA9PSAiIikgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIpOwogICAgICAgICAgICBpZiAodGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgTWV0aG9kIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBSZXF1ZXN0IEpTT04gRWRpdGFibGU6IiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXZlX3JlcV9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIllvdXIgUmVxdWVzdCBKU09OIGlzIGludmFsaWQuIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgIXRoaXMuaXNFZGl0KSB7Ly8gdmFyIGNzdiA9IHRoaXMuZWRpdGFibGVfdmFsdWVzLnNwbGl0KCI7Iik7CiAgICAgICAgICAgICAgLy8gdmFyIGlucHV0X3ZhbHVlOwogICAgICAgICAgICAgIC8vIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSBbXTsKICAgICAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIGNzdikgewogICAgICAgICAgICAgIC8vICAgbGV0IHRlbXBfbGlzdCA9IGNzdltpXS5zcGxpdCgiLCIpOwogICAgICAgICAgICAgIC8vICAgaW5wdXRfdmFsdWUgPSB0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgIC8vICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAga2V5X25hbWU6IGlucHV0X3ZhbHVlLAogICAgICAgICAgICAgIC8vICAgICBpbnB1dF90ZXh0OiAiIiwKICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgICAgLy8gbGV0IGVtcHR5X3ZhcnMgPSBbXTsKICAgICAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHRoaXMudGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICAvLyAgIGlmICh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgICAvLyAgICAgZW1wdHlfdmFycy5wdXNoKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0pOwogICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgIC8vICAgLy8gIGNvbnNvbGUubG9nKHRoaXMudGFza19pbnB1dF92YWx1ZXMpOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAvLyBpZiAoZW1wdHlfdmFycy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgIHRoaXMuZmluYWxzdGVwID0gdHJ1ZTsgLy8gfSBlbHNlIHsKICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgdmFsdWVzLiIpOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmZpbmFsc3RlcCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5maW5hbHN0ZXAgPT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZXhpc3RpbmdfaW50ZW50X2xpc3QgPSB0aGlzLmFwaV9saXN0LmZpbHRlcihmdW5jdGlvbiAoYXBpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFwaS5pbnRlbnQgPT0gX3RoaXM5LmludGVudHM7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgcG9zdF9tZXRob2RfZGF0YSwgZ2V0X21ldGhvZF9kYXRhOwogICAgICAgICAgICBwb3N0X21ldGhvZF9kYXRhID0ge307CiAgICAgICAgICAgIGdldF9tZXRob2RfZGF0YSA9IHt9OyAvLyBpZiAodGhpcy5hcGlfbWV0aG9kID09ICJQT1NUIiAmJiB0aGlzLnRhc2tfZnJvbSA9PSAiZnJvbV9lbnRpdHkiKSB7CgogICAgICAgICAgICBpZiAodGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gIlBPU1QiKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICAgIHBvc3RfbWV0aG9kX2RhdGFbdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmtleV9uYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgICAgICBmcm9tX2VudGl0eTogdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgIT0gIiIgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVudGl0eTogdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQsCiAgICAgICAgICAgICAgICAgIC8vIGludGVudDogdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgICAgIG5vdF9pbnRlbnQ6IG51bGwKICAgICAgICAgICAgICAgIH07IC8vICBjb25zb2xlLmxvZygicG9zdCBtZXRob2QiLHBvc3RfbWV0aG9kX2RhdGEpOwogICAgICAgICAgICAgIH0gLy8gIGNvbnNvbGUubG9nKCJwb3N0IG1ldGhvZCIscG9zdF9tZXRob2RfZGF0YSk7CgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gIkdFVCIpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgICAgZ2V0X21ldGhvZF9kYXRhW3RoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQsCiAgICAgICAgICAgICAgICAgIFNsb3Q6IG51bGwKICAgICAgICAgICAgICAgIH07IC8vICBjb25zb2xlLmxvZygiZ2V0IG1ldGhvZCIsZ2V0X21ldGhvZF9kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChleGlzdGluZ19pbnRlbnRfbGlzdC5sZW5ndGggPiAwICYmICF0aGlzLmlzRWRpdCkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIlRoZSBpbnRlbnQgYWxyZWFkeSBleGlzdHMuIFBsZWFzZSB0cnkgd2l0aCBhbm90aGVyIGludGVudCIsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIlNlbGVjdCBFbmQgVXNlciBNZXNzYWdlIHR5cGUiLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICgodGhpcy5zYXZlX2VuZF91c2VyX21lc3NhZ2UgIT0gIiIgfHwgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIikgJiYgKHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlICE9IG51bGwgfHwgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpICYmIHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlICE9IG51bGwgJiYgKHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciAhPSAiIiB8fCB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgJiYgKHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEgIT0gIiIgfHwgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcF9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogIllvdXIgUmVzcG9uc2UgSlNPTiBpcyBpbnZhbGlkLiIsCiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9PSAiIikgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9PSAiIikgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIsCiAgICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9lbmRfdXNlcl9tZXNzYWdlID0gIiI7IC8vIGNvbnNvbGUubG9nKCJlbmRfdXNlciBtZXNzYWdlIG51bGwiLHRoaXMuc2F2ZV9lbmRfdXNlcl9tZXNzYWdlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9ICIiOyAvLyBjb25zb2xlLmxvZygicmVzcG9uc2Uga2V5IHRvIGVuZCB1c2VyIG51bGwiLHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlcik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Vuc3VjY2Vzc2Z1bF9tZXNzYWdlID09ICIiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIsCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24gPT0gIlNpbHZlciIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiWW91J3JlIG5vdCBhdmFpbCB0byB1c2UgdGhpcyBzZXJ2aWNlLCBkdWUgdG8geW91ciBzdWJzY3JpcHRpb24gcGxhbi4gS2luZGx5IHVwZ3JhZGUgeW91ciBwbGFuLiIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzOS4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgICAgICB2YXIgdGFza3MgPSB7fTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aCA+IDAgfHwgdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiRmFsc2UiKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfYXhpb3MkcG9zdDI7CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gW107CiAgICAgICAgICAgICAgICAgICAgdGVtcC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgICAgICAgICAgVGV4dDogdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0YXNrc1t0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gdGVtcDsKICAgICAgICAgICAgICAgICAgfSAvLyBjb25zb2xlLmxvZygicmVhY2hlZCBoZXJlIGZpbmFsbHkiKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5uZXdfaW50ZW50cyk7CgoKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIGFyZSBzdWJtaXR0aW5nIHlvdXIgZGV0YWlscy4uLiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIChfYXhpb3MkcG9zdDIgPSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGlzX2VuZHBvaW50OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIC8vIGludGVudDogdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2F2ZV91cmwsCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGpzb246IHRoaXMuc2F2ZV9qc29uX3JlcXVlc3RfZGF0YSwKICAgICAgICAgICAgICAgICAgICBhcGlfbWV0aG9kOiB0aGlzLnNhdmVfYXBpX21ldGhvZCwKICAgICAgICAgICAgICAgICAgICBlbmRfdXNlcl9tZXNzYWdlOiB0aGlzLnNhdmVfZW5kX3VzZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBtc2dfdHlwZTogdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VrZXk6IHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciwKICAgICAgICAgICAgICAgICAgICBhcGlfZWRpdDogdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgICBhcGlfZWRpdGFibGVfdmFsdWU6IHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyA6ICIiLAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlanNvbjogdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIiA/IHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEgOiAiIiwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZV9tc2dfZWRpdGFibGU6IHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlLAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX21zZ19lZGl0YWJsZV92YWx1ZTogdGhpcy5zYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgOiAiIiwKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2pzb25fa2V5X21hcHBpbmc6IGdldF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YTogcG9zdF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgICB1bnN1Y2Nlc3NmdWxfbXNnOiB0aGlzLnNhdmVfdW5zdWNjZXNzZnVsX21lc3NhZ2UKICAgICAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImxpY2Vuc2Vfa2V5IiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5KSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImVtYWlsIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInRva2VuIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJ0YXNrX2RldGFpbHMiLCB0YXNrcyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJzdWJzY3JpcHRpb24iLCAiUGxhdGludW0iKSwgX2F4aW9zJHBvc3QyKSwgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJKc29uIGFkZGVkIikgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVudCBhZGRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJQb3N0IG1ldGhvZCBhcGkgc2F2ZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIiBQT1NUIFJlcXVlc3QgZGV0YWlscyBoYXMgYmVlbiBzYXZlZCBzdWNjZXNzZnVsbHksIHN1cHBvcnQgdGVhbSB3aWxsIGJlIGluIHRvdWNoIHdpdGggeW91IHNob3J0bHkuIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiSnNvbiB1cGRhdGVkIikgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIllvdXIgSW50ZW50IGFkZGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJFbmRwb2ludCBsaW1pdCBleGNlZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIllvdXIgTGltaXQgaGFzIGJlZW4gZXhjZWVkZWQsIEtpbmRseSB1cGdyYWRlIHlvdXIgcGxhbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIGVsc2UgaWYgKAogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIkZhbHNlIiAmJgogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwCiAgICAgICAgICAgICAgICAvLyAgICkKCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9PSBudWxsICYmIHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIgJiYgdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyICE9ICIiICYmIHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEgIT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBSZXNwb25zZSBKU09OIEVkaXRhYmxlIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgICB0aGlzLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VhcmNoX2ludGVudCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9pbnRlbnQ6IGZ1bmN0aW9uIHNlYXJjaF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJlc3VsdHMgRm91bmQiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJObyBSZXN1bHRzIEZvdW5kIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHICE9ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiICYmIHJlc3BvbnNlLmRhdGEuTVNHICE9ICJObyBJbnRlbnRzIEZvdW5kIikgewogICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3QgPSBbXTsKICAgICAgICAgICAgX3RoaXMxMC5wYWdlX25vID0gMTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJ0b2tlbiBpbnZhbGlkIikgewogICAgICAgICAgICAgIF90aGlzMTAubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICBfdGhpczEwLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKF90aGlzMTAubnVtYmVyX29mX3Jvd3MgLyBfdGhpczEwLnBlcl9wYWdlKTsKICAgICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczEwLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIF90aGlzMTAuaW50ZW50bGlzdFtpXS5JbnRlbnQgPSBfdGhpczEwLmludGVudGxpc3RbaV0uSW50ZW50OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSkgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTAuc2V0cGFnaW5hdGlvbihfdGhpczEwLnBhZ2Vfbm8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2ludGVudCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2ludGVudCgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJFbnRlciBwcm9wZXIgZGF0YSBmb3Igc2VhcmNoaW5nIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfc2VsZWN0ZWQ6IGZ1bmN0aW9uIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0ZXh0OiAiTm8gSW50ZW50cyBTZWxlY3RlZCAhIiwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMubmV3X2ludGVudF9saXN0ID0gW107CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaGVja2VkX2xpc3QpIHsKICAgICAgICAgIHRoaXMubmV3X2ludGVudF9saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0pOwogICAgICAgIH0gLy8gY29uc29sZS5sb2codGhpcy5uZXdfaW50ZW50X2xpc3QpOwoKCiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgZGVsZXRlISEiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgICBpbnRlbnRfbGlzdDogX3RoaXMxMS5uZXdfaW50ZW50X2xpc3QsCiAgICAgICAgICAgICAgaXNfZGVsZXRlOiB0cnVlLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxMS5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczExLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTEuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczExLm5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJJTlRFTlRTIERFTEVURUQiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBJbnRlbnQocykgaGF2ZSBiZWVuIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgey8vIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAvLyB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICB9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzMTEuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXMxMS5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczExLnBhZ2Vfbm8gPSBfdGhpczExLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZW50KHMpIHVzZWQgaW4gZGlhbG9nLCBkZWxldGVkIHN1Y2Nlc3NmdWxseS4gSU5URU5UUyBERUxFVEVEIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVudCBoYXMgYmVlbiBkZWxldGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDgwMDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzMTEuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXMxMS5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczExLnBhZ2Vfbm8gPSBfdGhpczExLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm90aGluZyB0byBkZWxldGUhIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIllvdSBoYXZlIG5vdCBzZWxlY3RlZCBhbnkgaW50ZW50IHRvIGJlIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJUcmFpbmVkIGludGVudCBoYXMgYmVlbiBkZWxldGVkLiBQbGVhc2UgVHJhaW4gdGhlIE1vZGVsIEFnYWluIHRvIFNlZSBSZWZsZWN0ZWQgQ2hhbmdlcyIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJUcmFpbmVkIEludGVudCBoYXMgYmVlbiBkZWxldGVkLiBQbGVhc2UgVHJhaW4gdGhlIE1vZGVsIEFnYWluIHRvIFNlZSBSZWZsZWN0ZWQgQ2hhbmdlcyIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF90aGlzMTEubmV3X2ludGVudF9saXN0ID0gW107CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXMxMS5pbnRlbnRsaXN0Lmxlbmd0aCAmJiBfdGhpczExLnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEucGFnZV9ubyA9IF90aGlzMTEucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlbnQocykgdXNlZCBpbiBkaWFsb2csIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5LiBUcmFpbmVkIGludGVudCBoYXMgYmVlbiBkZWxldGVkLiBQbGVhc2UgVHJhaW4gdGhlIE1vZGVsIEFnYWluIHRvIFNlZSBSZWZsZWN0ZWQgQ2hhbmdlcyIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJUcmFpbmVkIEludGVudCBoYXMgYmVlbiBkZWxldGVkLiBQbGVhc2UgVHJhaW4gdGhlIE1vZGVsIEFnYWluIHRvIFNlZSBSZWZsZWN0ZWQgQ2hhbmdlcyBhbmQgdGhpcyBpbnRlbnQgaXMgdXNlZCBpbiBkaWFsb2cgbm9kZShzKSBhbHNvLiBQbGVhc2UgbW9kaWZ5IHRoaXMgaW4gZGlhbG9nIG5vZGUocykiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX3RoaXMxMS5uZXdfaW50ZW50X2xpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczExLmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzMTEucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5wYWdlX25vID0gX3RoaXMxMS5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTEuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgICAgICBfdGhpczExLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczExLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxMS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBhZ2VfcmVxdWlyZTogZnVuY3Rpb24gcGFnZV9yZXF1aXJlKHBhZ2UpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7fSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PSAiIikgewogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxMi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXMxMi5pbnRlbnRsaXN0ID0gW107IC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YVswXSkgewogICAgICAgICAgICAvLyAgIHRoaXMuaW50ZW50bGlzdC5wdXNoKHsKICAgICAgICAgICAgLy8gICAgIGludGVudDogcmVzcG9uc2UuZGF0YVswXVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIiksCiAgICAgICAgICAgIC8vICAgICBlbWFpbDogcmVzcG9uc2UuZGF0YVsxXVtpXSwKICAgICAgICAgICAgLy8gICAgIGNyZWF0ZWQ6IHJlc3BvbnNlLmRhdGFbMl1baV0sCiAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsgLy8gZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gICB0aGlzLmludGVudGxpc3RbaV0uSW50ZW50ID0gdGhpcy5pbnRlbnRsaXN0W2ldLkludGVudC5yZXBsYWNlKAogICAgICAgICAgICAvLyAgICAgYCR7dGhpcy5jb21wYW55aWR9X2AsCiAgICAgICAgICAgIC8vICAgICAiIgogICAgICAgICAgICAvLyAgICk7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgIGlmIChfdGhpczEyLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzMTIuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczEyLnNldHBhZ2luYXRpb24oX3RoaXMxMi5wYWdlX25vKTsgLy8gY29uc29sZS5sb2coInBhZ2UgcmVxdWlyZSBpcyBoZXJlIik7CgogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGlmKHRoaXMuc2VhcmNoX2J5PT0nRW1haWwgQWRkcmVzcycpewogICAgICAgICAgLy8gICB0aGlzLnNlYXJjaGJ5PSdDcmVhdGVkQnknOwogICAgICAgICAgLy8gfQogICAgICAgICAgLy8gZWxzZXsKICAgICAgICAgIC8vICAgdGhpcy5zZWFyY2hieT10aGlzLnNlYXJjaF9ieTsKICAgICAgICAgIC8vIH0KICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBpZiAodGhpcy5wYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYWdlbm8gPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHRoaXMucGFnZW5vOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gUmVzdWx0cyBGb3VuZCIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJObyBSZXN1bHRzIEZvdW5kIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgIT0gIkludGVybmFsIFNlcnZlciBFcnJvciIgJiYgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIEludGVudHMgRm91bmQiKSB7CiAgICAgICAgICAgICAgX3RoaXMxMi5pbnRlbnRsaXN0ID0gW107CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJ0b2tlbiBpbnZhbGlkIikgewogICAgICAgICAgICAgICAgX3RoaXMxMi5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgICAgX3RoaXMxMi50b3RhbF9wYWdlcyA9IE1hdGguY2VpbChfdGhpczEyLm51bWJlcl9vZl9yb3dzIC8gX3RoaXMxMi5wZXJfcGFnZSk7CiAgICAgICAgICAgICAgICBfdGhpczEyLmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMTIuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBfdGhpczEyLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMxMi5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMi5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMi5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTIuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMTIuc2V0cGFnaW5hdGlvbihfdGhpczEyLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMTIubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMi5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2k1ID0gMDsgX2k1IDwgNDsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTYgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2k2IDwgdGhpcy50b3RhbF9wYWdlczsgX2k2KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNiArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTcgPSAwOyBfaTcgPCBwYWdlX25vICsgMzsgX2k3KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNyArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k4ID0gcGFnZV9ubyAtIDQ7IF9pOCA8IHRoaXMudG90YWxfcGFnZXM7IF9pOCsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTggKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k5ID0gcGFnZV9ubyAtIDM7IF9pOSA8PSBwYWdlX25vICsgMzsgX2k5KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pOSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RlZF9pbnRlbnRzOiBmdW5jdGlvbiBzZWxlY3RlZF9pbnRlbnRzKEludGVudCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAoSW50ZW50ID09ICJhbGwiKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuaW50ZW50bGlzdDsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsgLy8gY29uc29sZS5sb2codGhpcy5jaGVja2VkX2xpc3QpOwoKICAgICAgICAgIHRlbXAgPSBbXTsgLy8gdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0Lm1hcCgoYXJyKSA9PiBhcnIuSW50ZW50KTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRlbXApOwogICAgICAgICAgLy8gY29uc29sZS5sb2coKQoKICAgICAgICAgIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuICFfdGhpczEzLmRlZmF1bHRfcmV0YWlsX2ludGVudHMuaW5jbHVkZXMoaXRlbS5JbnRlbnQpOwogICAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0Lm1hcCgoYXJyKSA9PiBhcnIuSW50ZW50KS5maWx0ZXIoKGl0ZW0pID0+ICEodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKGl0ZW0uSW50ZW50KSkpKQogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jaGVja2VkX2xpc3QubWFwKChhcnIpID0+IGFyci5JbnRlbnQpKQogICAgICAgICAgLy8gY29uc29sZS5sb2codGVtcCk7CgogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS5JbnRlbnQ7CiAgICAgICAgICB9KTsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICQoIiNpbnRlbnRfY2hlY2tib3hfIiArIHRoaXMuY2hlY2tlZF9saXN0W2ldKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgdmFsX2luZGV4ID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzLkludGVudCA9PSBJbnRlbnQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodmFsX2luZGV4Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goSW50ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF90ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzICE9IEludGVudDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gX3RlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3Jlc3BvbnNlX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b19yZXNwb25zZV9saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlLmxlbmd0aCk7CiAgICAgIGlmICh0eXBlID09ICJhZGQiICYmICh0aGlzLm11bHRpcGxlX3Jlc3BvbnNlLmxlbmd0aCA9PSAxMCB8fCB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZS5sZW5ndGggPT0gMTApKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiT25seSAxMCBSZXNwb25zZXMgY2FuIGJlIGFkZGVkIHBlciBJbnRlbnQiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5tdWx0aXBsZV9yZXNwb25zZS51bnNoaWZ0KCIiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICAgIHRoaXMubXVsdGlwbGVfcmVzcG9uc2Uuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlLnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Uuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhZGRfdG9fcXVlc3Rpb25zX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b19xdWVzdGlvbnNfbGlzdCh0eXBlLCBpbmRleCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy51bnNoaWZ0KCIiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNoYW5nZV9yZXNwb25zZV90eXBlOiBmdW5jdGlvbiBjaGFuZ2VfcmVzcG9uc2VfdHlwZSgpIHsKICAgICAgaWYgKHRoaXMuZGVmaW5lX2FwaV9lbmRwb2ludHMgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMuZGVmaW5lX2FwaV9lbmRwb2ludHMgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dDogZnVuY3Rpb24gZmlsZWlucHV0KCkgewogICAgICB0aGlzLmZpbGVfbGFiZWwgPSBldmVudC50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgdmFyIGZpbGVfbmFtZSA9IHRoaXMuY29tcGFueW5hbWUgKyAiSW50ZW50RmlsZS5jc3YiOwoKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbCAhPSBmaWxlX25hbWUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OiAiVXNlcnMgbmVlZCB0byBkb3dubG9hZCB0aGUgSW50ZW50IEZpbGUgZnJvbSAnVXBsb2FkIENTViBGaWxlcycgcG9wLXVwLiBDaGFuZ2VzIHRvIHRoaXMgZmlsZSB3aWxsIGJlIGFjY2VwdGVkIGJ5IHRoZSBzeXN0ZW0uIiwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbGVfY29udGVudCA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dDI6IGZ1bmN0aW9uIGZpbGVpbnB1dDIoZXZlbnQpIHsKICAgICAgdmFyIGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB0aGlzLmZpbGVfbGFiZWwyID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHRoaXMuZmlsZV90eXBlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLnR5cGU7IC8vIGNvbnNvbGUubG9nKGZpbGVzKQogICAgICAvLyBjb25zb2xlLmxvZyhldmVudC50YXJnZXQuZmlsZXNbMF0pCgogICAgICBpZiAodGhpcy5maWxlX2xhYmVsMiAhPSB0aGlzLnRlbXBfZmlsZV9uYW1lKSB7CiAgICAgICAgdGhpcy5pbWFnZV9lZGl0ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmlsZV90eXBlID09ICJpbWFnZS9wbmciKSB7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZShmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsZV90eXBlID09ICJpbWFnZS9qcGVnIikgewogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UoZmlsZXMsIHRoaXMuZmlsZV90eXBlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OiAiVXNlcnMgbmVlZCB0byB1cGxvYWQgb25seSBqcGVnL3BuZyBmaWxlcyIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE0LmZpbGVfY29udGVudDIgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGZpbGVpbnB1dDM6IGZ1bmN0aW9uIGZpbGVpbnB1dDMoZXZlbnQpIHsKICAgICAgdmFyIGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB0aGlzLmZpbGVfbGFiZWwzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHRoaXMuZmlsZV90eXBlMyA9IGV2ZW50LnRhcmdldC5maWxlc1swXS50eXBlOyAvLyBjb25zb2xlLmxvZyhmaWxlcykKICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQudGFyZ2V0LmZpbGVzWzBdKQoKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbDMgIT0gdGhpcy50ZW1wX2ZpbGVfbmFtZSkgewogICAgICAgIHRoaXMuaW1hZ2VfZWRpdCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbGVfdHlwZTMgPT0gImltYWdlL3BuZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMyhmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsZV90eXBlMyA9PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMyhmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6ICJVc2VycyBuZWVkIHRvIHVwbG9hZCBvbmx5IGpwZWcvcG5nIGZpbGVzIiwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsMiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVJbWFnZTM6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlMyhmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNS5maWxlX2NvbnRlbnQzID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBlbWJlZGRlZF9jaGFuZ2U6IGZ1bmN0aW9uIGVtYmVkZGVkX2NoYW5nZSgpIHsKICAgICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcL3x2XC98dVwvXHdcL3xlbWJlZFwvfHdhdGNoXD92PXxcJnY9KShbXiNcJlw/XSopLiovOwogICAgICB2YXIgbWF0Y2ggPSB0aGlzLnZpZGVvX2xpbmsubWF0Y2gocmVnRXhwKTsKCiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsyXS5sZW5ndGggPT0gMTEpIHsvLyBjb25zb2xlLmxvZyhtYXRjaFsyXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJlcnJvciI7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1iZF9saW5rID0gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLyIgKyBtYXRjaFsyXTsgLy8gY29uc29sZS5sb2codGhpcy5lbWJkX2xpbmspOwogICAgfSwKICAgIGVtYmVkZGVkX2NoYW5nZV9lZGl0OiBmdW5jdGlvbiBlbWJlZGRlZF9jaGFuZ2VfZWRpdCgpIHsKICAgICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcL3x2XC98dVwvXHdcL3xlbWJlZFwvfHdhdGNoXD92PXxcJnY9KShbXiNcJlw/XSopLiovOwogICAgICB2YXIgbWF0Y2ggPSB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV92aWRlby5tYXRjaChyZWdFeHApOwoKICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdLmxlbmd0aCA9PSAxMSkgey8vIGNvbnNvbGUubG9nKG1hdGNoWzJdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gImVycm9yIjsKICAgICAgfQoKICAgICAgdGhpcy5lbWJkX2xpbmtfZWRpdCA9ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8iICsgbWF0Y2hbMl07IC8vIGNvbnNvbGUubG9nKHRoaXMuZW1iZF9saW5rKTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIC8vIHRoaXMucmVzcG9uc2UgPSAiIjsKICAgICAgdGhpcy5tdWx0aXBsZV9yZXNwb25zZSA9IFsiIl07IC8vIHRoaXMuZWRpdF9yZXNwb25zZSA9ICIiOwogICAgICAvLyB0aGlzLiRlbWl0KAogICAgICAvLyAgICJpbnB1dCIsCiAgICAgIC8vICAgICIiCiAgICAgIC8vICk7CgogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICB0aGlzLnNhdmVfdXJsID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9hcGlfbWV0aG9kID0gbnVsbDsKICAgICAgdGhpcy5zYXZlX2pzb25fcmVxdWVzdF9kYXRhID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPSBudWxsOwogICAgICB0aGlzLnNhdmVfZWRpdGFibGVfdmFsdWVzID0gIiI7CiAgICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwogICAgICB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9ICJDdXN0b20iOwogICAgICB0aGlzLnNhdmVfanNvbl9yZXNwb25zZV9kYXRhID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9ICIiOwogICAgICB0aGlzLnNhdmVfZW5kX3VzZXJfbWVzc2FnZSA9ICIiOwogICAgICB0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9IG51bGw7CiAgICAgIHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gIiI7CiAgICAgIHRoaXMuc2F2ZV91bnN1Y2Nlc3NmdWxfbWVzc2FnZSA9ICIiOwogICAgICB0aGlzLnNvdXJjZSA9ICJXZWIiOwogICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSAiIjsKICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QgPSBbIiJdOwogICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB0aGlzLmltYWdlX3VybCA9ICIiOwogICAgICB0aGlzLmltYWdlX3Jlc3BvbnNlID0gIk5vIjsKICAgICAgdGhpcy52aWRlb19yZXNwb25zZSA9ICJObyI7CiAgICAgIHRoaXMudmlkZW9fbGluayA9ICIiLCB0aGlzLmVtYmRfbGluayA9ICIiOwogICAgICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgdGhpcy5maWxlX2xhYmVsMyA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIHRoaXMuZmlsZV9jb250ZW50ID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiIjsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlQWRkb24wMSIpLnZhbHVlID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZUFkZG9uMDIiKS52YWx1ZSA9ICIiOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG5uIikuY2hlY2tlZCA9IGZhbHNlOwogICAgICB0aGlzLnVuY2hlY2soKTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOyAvLyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCA9IiI7CiAgICB9LAogICAganNvbl9yZXF1ZXN0X2NsYXNzOiBmdW5jdGlvbiBqc29uX3JlcXVlc3RfY2xhc3MoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLmpzb25fcmVxdWVzdF9kYXRhW3RoaXMuaW5kZXhdKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiAiaXMtaW52YWxpZCI7CiAgICAgIH0KCiAgICAgIHJldHVybiAiaXMtdmFsaWQiOwogICAgfSwKICAgIGpzb25fcmVzcG9uc2VfY2xhc3M6IGZ1bmN0aW9uIGpzb25fcmVzcG9uc2VfY2xhc3MoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLmpzb25fcmVzcG9uc2VfZGF0YVt0aGlzLmluZGV4XSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gImlzLWludmFsaWQiOwogICAgICB9CgogICAgICByZXR1cm4gImlzLXZhbGlkIjsKICAgIH0sCiAgICBlZGl0X2ludGVudF9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X2ludGVudF9kZXRhaWxzKCkgewogICAgICAvLyBpZiAodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpKSB7CiAgICAgIC8vICAgU3dhbCh7CiAgICAgIC8vICAgICB0aXRsZTogIk9vcHMiLAogICAgICAvLyAgICAgdGV4dDogIlRoaXMgaXMgYSBEZWZhdWx0IEludGVudCEgSXQgY2Fubm90IGJlIGVkaXRlZCIsCiAgICAgIC8vICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgIC8vICAgICB0aW1lcjogMjAwMCwKICAgICAgLy8gICB9KTsKICAgICAgLy8gICByZXR1cm4gZmFsc2U7CiAgICAgIC8vIH0KICAgICAgaWYgKCF0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0sCiAgICBzaG93X2Jsb2NrOiBmdW5jdGlvbiBzaG93X2Jsb2NrKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PSAidXAiKSB7CiAgICAgICAgdGhpcy5zaG93X29yX2Jsb2NrID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gImRvd24iKSB7CiAgICAgICAgdGhpcy5zaG93X29yX2Jsb2NrID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGZpbGVfc3VibWl0OiBmdW5jdGlvbiBmaWxlX3N1Ym1pdCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICgkKCIjaW5wdXRHcm91cEZpbGVjc3YiKS52YWwoKSA9PSAnJykgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlRoZSBpbnB1dCBmaWVsZCBpcyBlbXB0eSIsCiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFVwbG9hZCBhIENTViBmaWxlIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciB1c2VyX2RldGFpbHMgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkKICAgICAgfTsKICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh1c2VyX2RldGFpbHMpOwogICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtqc29uXSwgewogICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICB9KTsKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWxfY3N2ID09ICJDaG9vc2UgZmlsZSIpIHt9IGVsc2UgewogICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZkLmFwcGVuZCgiZmlsZSIsIHRoaXMuZmlsZV9jb250ZW50X2NzdiwgdGhpcy5jb21wYW55bmFtZSArICJJbnRlbnRGaWxlLmNzdiIpOwogICAgICAgIGZkLmFwcGVuZCgianNvbiIsIGJsb2IpOwogICAgICAgICQoIiNmaWxlX3VwbG9hZCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnVwbG9hZF9maWxlX3VybCgpLCBmZCwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczE2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJmaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlY3N2IikudmFsdWUgPSAiIjsgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgICAgICAgIF90aGlzMTYubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIkluY29ycmVjdCBmaWxlIGZvcm1hdCIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJJbmNvcnJlY3QgZmlsZSBmb3JtYXQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiVXNlcnMgbmVlZCB0byBkb3dubG9hZCB0aGUgU2FtcGxlIEludGVudCBDU1YgRmlsZSBmcm9tICdVcGxvYWQgQ1NWIEZpbGUnIG1vZGVsLiBDaGFuZ2VzIHRvIHRoaXMgZmlsZSB3aWxsIGJlIGFjY2VwdGVkIGJ5IHRoZSBzeXN0ZW0uIiAvLyB0aW1lcjogNDAwMCwKCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlY3N2IikudmFsdWUgPSAiIjsgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgICAgICAgIF90aGlzMTYubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIkZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIkZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGV4dDogIlVzZXJzIG5lZWQgdG8gZG93bmxvYWQgdGhlIFNhbXBsZSBJbnRlbnQgQ1NWIEZpbGUgZnJvbSAnVXBsb2FkIENTViBGaWxlJyBtb2RlbC4gQ2hhbmdlcyB0byB0aGlzIGZpbGUgd2lsbCBiZSBhY2NlcHRlZCBieSB0aGUgc3lzdGVtLiIgLy8gdGltZXI6IDQwMDAsCgogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczE2LmZpbGVfbGFiZWxfY3N2ID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZWNzdiIpLnZhbHVlID0gIiI7IC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKCiAgICAgICAgICAgICAgICBfdGhpczE2LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAvLyAkKCcjZmlsZV91cGxvYWQnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgIF90aGlzMTYuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZWNzdiIpLnZhbHVlID0gIiI7CgogICAgICAgICAgICAgIF90aGlzMTYubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vICQoIiNmaWxlX3VwbG9hZCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGRvd25sb2FkX3NhbXBsZV9maWxlOiBmdW5jdGlvbiBkb3dubG9hZF9zYW1wbGVfZmlsZSgpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5zcGlubmVyT25GaWxlRG93bmxvYWQgPSB0cnVlOwogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuZmlsZV9kb3dubG9hZCgpLAogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHNhbXBsZV9maWxlOiAiaW50ZW50IiwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIF90aGlzMTcuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJOb3QgYWJsZSB0byBkb3dubG9hZCBmaWxlIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7IC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCgogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgX3RoaXMxNy5jb21wYW55bmFtZSArICJJbnRlbnRGaWxlLmNzdiIpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICBfdGhpczE3LnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBmaWxlaW5wdXRfY3N2OiBmdW5jdGlvbiBmaWxlaW5wdXRfY3N2KCkgewogICAgICB0aGlzLmZpbGVfbGFiZWxfY3N2ID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHZhciBmaWxlX25hbWUgPSB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2IjsKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWxfY3N2ICE9IGZpbGVfbmFtZSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgdGV4dDogIlVzZXJzIG5lZWQgdG8gZG93bmxvYWQgdGhlIFNhbXBsZSBJbnRlbnQgQ1NWIEZpbGUgZnJvbSAnVXBsb2FkIENTViBGaWxlJyBtb2RlbC4gQ2hhbmdlcyB0byB0aGlzIGZpbGUgd2lsbCBiZSBhY2NlcHRlZCBieSB0aGUgc3lzdGVtLiIsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZpbGVfbGFiZWxfY3N2ID0gIkNob29zZSBmaWxlIjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGVjc3YiKS52YWx1ZSA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsZV9jb250ZW50X2NzdiA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgfQogICAgfSwKICAgIGRvd25sb2FkX2NzdjogZnVuY3Rpb24gZG93bmxvYWRfY3N2KCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5xdWVzdGlvbl9pbnRlbnRfY3N2KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgYSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgYS5ocmVmID0gcmVzcG9uc2UuZGF0YS5DU1ZfVVJMOwogICAgICAgIGEuZG93bmxvYWQgPSB0cnVlOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgYS5jbGljaygpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},null]}