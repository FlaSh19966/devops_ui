{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/EmailTemplates.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/EmailTemplates.vue","mtime":1645594423491},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5lbnRyaWVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgVnVlRWRpdG9yIH0gZnJvbSAidnVlMi1lZGl0b3IiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBmcmVlemVfcG9ydGFsLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJFbWFpbFRlbXBsYXRlUGFnZSIsCiAgY29tcG9uZW50czogewogICAgVnVlRWRpdG9yOiBWdWVFZGl0b3IsCiAgICBNdWx0aXNlbGVjdDogTXVsdGlzZWxlY3QKICB9LAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBlbmNpbF9zdmc6ICcgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVfbmFtZTogIiIsCiAgICAgIHNhdmVfc21zOiAiIiwKICAgICAgc2F2ZV9lbWFpbDogIiIsCiAgICAgIGlzX3NtczogZmFsc2UsCiAgICAgIGlzX2VtYWlsOiB0cnVlLAogICAgICBzYXZlX3N1YmplY3Q6ICIiLAogICAgICBpc19wdWJsaXNoX2VtYWlsOiB0cnVlLAogICAgICBpc19wdWJsaXNoX3NtczogdHJ1ZSwKICAgICAgaXNfZWRpdF9zbXM6IGZhbHNlLAogICAgICBpc19lZGl0X2VtYWlsOiB0cnVlLAogICAgICB2ZXJpZmljYXRpb25fc3RhdHVzOiBudWxsLAogICAgICB0ZW1wbGF0ZWxpc3Q6IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBjdXN0b21Ub29sYmFyOiBbWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwgW3sKICAgICAgICBhbGlnbjogW10KICAgICAgfV0sIFt7CiAgICAgICAgY29sb3I6IFtdCiAgICAgIH0sIHsKICAgICAgICBiYWNrZ3JvdW5kOiBbXQogICAgICB9XSwgW3sKICAgICAgICBsaXN0OiAib3JkZXJlZCIKICAgICAgfSwgewogICAgICAgIGxpc3Q6ICJidWxsZXQiCiAgICAgIH1dLCBbImxpbmsiXV0sCiAgICAgIHF1aWxsOiAiIiwKICAgICAgcXVpbGxfZWRpdDogIiIsCiAgICAgIHNsb3RfdmFyaWFibGU6IHt9LAogICAgICBjdXJyZW50X3RlbXBsYXRlOiBbXSwKICAgICAgb2xkX3RlbXBsYXRlX25hbWU6ICIiLAogICAgICBpc0VkaXRUZW1wbGF0ZTogZmFsc2UsCiAgICAgIG51bWJlcl9vZl9yb3dzOiBudWxsLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgcGFnZV9ubzogMSwKICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICBpbWFnZV9maWxlOiBudWxsLAogICAgICBpbWFnZV9maWxlXzI6IG51bGwsCiAgICAgIGlzX2ltYWdlX25lZWRlZDogIm5vbmUiLAogICAgICBpc19lZGl0X2ltYWdlX25lZWRlZDogIm5vbmUiLAogICAgICBlbWFpbF9zdWJqZWN0OiAiIiwKICAgICAgcmVnX3VybDogL2h0dHBzOlwvXC9bKHd3d1wuKT9hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn1cLlthLXpdezIsNn1cYihbLWEtekEtWjAtOUA6JV9cKy5+Iz8mXC9cLz1dKikvaSwKICAgICAgaXNfZWRpdF9yZWdfdXJsOiAvaHR0cHM6XC9cL1sod3d3XC4pP2EtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKFstYS16QS1aMC05QDolX1wrLn4jPyZcL1wvPV0qKS9pLAogICAgICBpbWdfcmVkaXJlY3RfdXJsOiAiIiwKICAgICAgZWRpdF9pbWdfcmVkaXJlY3RfdXJsOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgZWRpdGVkX2ZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIHByZXZpZXdfdGVtcGxhdGVfZGF0YTogIiIsCiAgICAgIHRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdDogZmFsc2UsCiAgICAgIGVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0OiBmYWxzZSwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHNlbmRfZW1haWxfYWxsX2N1c3RvbWVyOiB0cnVlLAogICAgICBjdXN0b21lcnNfbGlzdDogW10sCiAgICAgIHNwZWNpZmljX2N1c3RvbWVyX2xpc3Q6IFtdLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZSwKICAgICAgZW1haWxfcmVnOiAvXigoW148PigpW1xdXFwuLDs6XHNAXCJdKyhcLltePD4oKVtcXVxcLiw7OlxzQFwiXSspKil8KFwiLitcIikpQCgoXFtbMC05XXsxLDN9XC5bMC05XXsxLDN9XC5bMC05XXsxLDN9XC5bMC05XXsxLDN9XF0pfCgoW2EtekEtWlwtMC05XStcLikrW2EtekEtWl17Mix9KSkkLwogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBpc19ub3RpZmljYXRpb25fdGVtcGxhdGU6IEJvb2xlYW4KICB9LAogIHdhdGNoOiB7Ly8gaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlKCkgewogICAgLy8gICBjb25zb2xlLmxvZyh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSk7CiAgICAvLyB9LAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZhbGlkVVJMOiBmdW5jdGlvbiB2YWxpZFVSTCgpIHsKICAgICAgaWYgKHRoaXMucmVnX3VybC50ZXN0KHRoaXMuaW1nX3JlZGlyZWN0X3VybCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICB2YWxpZF9lZGl0X1VSTDogZnVuY3Rpb24gdmFsaWRfZWRpdF9VUkwoKSB7CiAgICAgIGlmICh0aGlzLmlzX2VkaXRfcmVnX3VybC50ZXN0KHRoaXMuZWRpdF9pbWdfcmVkaXJlY3RfdXJsKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDMwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIlZhcmlhbnRzRGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQgPSB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMubG9hZF90ZW1wbGF0ZXMoKTsKCiAgICBpZiAodGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUgPT09IGZhbHNlKSB7CiAgICAgIHRoaXMubG9hZF9jdXN0b21lcl9saXN0KCk7CiAgICB9CgogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgdGhpcy5pc19zbXMgPSBmYWxzZTsKICAgICAgdGhpcy5pc19lbWFpbCA9IHRydWU7CgogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmVkaXRvcigpOwoKICAgIGlmICh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSA9PT0gdHJ1ZSkgewogICAgICB0aGlzLmxvYWRfc2xvdF92YXJpYWJsZSgpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgbG9hZF9zbG90X3ZhcmlhYmxlOiBmdW5jdGlvbiBsb2FkX3Nsb3RfdmFyaWFibGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fZGlhbG9nX3RyZWUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19nZXRfc2xvdF92YXJpYWJsZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICBfdGhpczIuc2xvdF92YXJpYWJsZSA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLnNsb3RzX2xpc3QubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gcmVzcG9uc2UuZGF0YS5zbG90c19saXN0W2luZGV4XTsKICAgICAgICAgICAgX3RoaXMyLnNsb3RfdmFyaWFibGVbZWxlbWVudF0gPSAneycgKyBlbGVtZW50ICsgJ30nOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMi5pbnNlcnRfdmFyaWFibGUoJ3F1aWxsJywgX3RoaXMyLnNsb3RfdmFyaWFibGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiA1MDAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMyLmluc2VydF92YXJpYWJsZSgncXVpbGwnLCBfdGhpczIuc2xvdF92YXJpYWJsZSk7CgogICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlZGl0b3I6IGZ1bmN0aW9uIGVkaXRvcigpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnF1aWxsID0gbmV3IFF1aWxsKCIjZWRpdG9yIiwgewogICAgICAgIG1vZHVsZXM6IHsKICAgICAgICAgIHRvb2xiYXI6IFtbImJvbGQiLCAiaXRhbGljIiwgInVuZGVybGluZSJdLCBbImxpbmsiXSwgW3sKICAgICAgICAgICAgYWxpZ246IFtdCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgY29sb3I6IFtdCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IFtdCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgbGlzdDogIm9yZGVyZWQiCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxpc3Q6ICJidWxsZXQiCiAgICAgICAgICB9XV0KICAgICAgICB9LAogICAgICAgIHRoZW1lOiAic25vdyIKICAgICAgfSk7CiAgICAgIHRoaXMucXVpbGwub24oInRleHQtY2hhbmdlIiwgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy4kZW1pdCgiaW5wdXQiLCBfdGhpczMucXVpbGwuZ2V0VGV4dCgpID8gX3RoaXMzLnF1aWxsLnJvb3QuaW5uZXJIVE1MIDogIiIpOwoKICAgICAgICBfdGhpczMuc2F2ZV9lbWFpbCA9IF90aGlzMy5xdWlsbC5nZXRUZXh0KCkgPyBfdGhpczMucXVpbGwucm9vdC5pbm5lckhUTUwgOiAiIjsKICAgICAgfSk7CiAgICB9LAogICAgZWRpdF9lZGl0b3I6IGZ1bmN0aW9uIGVkaXRfZWRpdG9yKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMucXVpbGxfZWRpdCA9IG5ldyBRdWlsbCgiI2VkaXRfZWRpdG9yIiwgewogICAgICAgIG1vZHVsZXM6IHsKICAgICAgICAgIHRvb2xiYXI6IFtbImJvbGQiLCAiaXRhbGljIiwgInVuZGVybGluZSJdLCBbImxpbmsiXSwgW3sKICAgICAgICAgICAgYWxpZ246IFtdCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgY29sb3I6IFtdCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IFtdCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgbGlzdDogIm9yZGVyZWQiCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGxpc3Q6ICJidWxsZXQiCiAgICAgICAgICB9XV0KICAgICAgICB9LAogICAgICAgIHRoZW1lOiAic25vdyIKICAgICAgfSk7CiAgICAgIHRoaXMucXVpbGxfZWRpdC5vbigidGV4dC1jaGFuZ2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0LiRlbWl0KCJpbnB1dCIsIF90aGlzNC5xdWlsbF9lZGl0LmdldFRleHQoKSA/IF90aGlzNC5xdWlsbF9lZGl0LnJvb3QuaW5uZXJIVE1MIDogIiIpOwoKICAgICAgICBfdGhpczQuY3VycmVudF90ZW1wbGF0ZS5lbWFpbCA9IF90aGlzNC5xdWlsbF9lZGl0LmdldFRleHQoKSA/IF90aGlzNC5xdWlsbF9lZGl0LnJvb3QuaW5uZXJIVE1MIDogIiI7CiAgICAgIH0pOwogICAgICB0aGlzLnF1aWxsX2VkaXQucm9vdC5pbm5lckhUTUwgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUuZW1haWw7CiAgICAgIHRoaXMuaW5zZXJ0X3ZhcmlhYmxlKCdxdWlsbF9lZGl0JywgdGhpcy5zbG90X3ZhcmlhYmxlKTsKICAgIH0sCiAgICBpbnNlcnRfdmFyaWFibGU6IGZ1bmN0aW9uIGluc2VydF92YXJpYWJsZSh2YWwsIHNsb3RfdmFyaWFibGUpIHsKICAgICAgaWYgKHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGRyb3BEb3duSXRlbXMgPSB7CiAgICAgICAgICAnTm8gc2xvdCB2YXJpYWJsZSc6ICcnCiAgICAgICAgfTsKICAgICAgICB2YXIgbXlEcm9wRG93biA9IG5ldyBRdWlsbFRvb2xiYXJEcm9wRG93bih7CiAgICAgICAgICBsYWJlbDogIkluc2VydCBWYXJpYWJsZSIsCiAgICAgICAgICByZW1lbWJlclNlbGVjdGlvbjogZmFsc2UsCiAgICAgICAgICBpZDogImRyb3Bkb3duX2lkIgogICAgICAgIH0pOwoKICAgICAgICBpZiAoT2JqZWN0LmVudHJpZXMoc2xvdF92YXJpYWJsZSkubGVuZ3RoID09PSAwICYmIHNsb3RfdmFyaWFibGUuY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgbXlEcm9wRG93bi5zZXRJdGVtcyhkcm9wRG93bkl0ZW1zKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbXlEcm9wRG93bi5zZXRJdGVtcyhzbG90X3ZhcmlhYmxlKTsKICAgICAgICB9CgogICAgICAgIG15RHJvcERvd24ub25TZWxlY3QgPSBmdW5jdGlvbiAobGFiZWwsIHZhbHVlLCBxdWlsbCkgewogICAgICAgICAgdmFyIF9xdWlsbCRzZWxlY3Rpb24kc2F2ZSA9IHF1aWxsLnNlbGVjdGlvbi5zYXZlZFJhbmdlLAogICAgICAgICAgICAgIGluZGV4ID0gX3F1aWxsJHNlbGVjdGlvbiRzYXZlLmluZGV4LAogICAgICAgICAgICAgIGxlbmd0aCA9IF9xdWlsbCRzZWxlY3Rpb24kc2F2ZS5sZW5ndGg7CiAgICAgICAgICBxdWlsbC5kZWxldGVUZXh0KGluZGV4LCBsZW5ndGgpOwogICAgICAgICAgcXVpbGwuaW5zZXJ0VGV4dChpbmRleCwgdmFsdWUpOwogICAgICAgICAgcXVpbGwuc2V0U2VsZWN0aW9uKGluZGV4ICsgdmFsdWUubGVuZ3RoKTsKICAgICAgICB9OwoKICAgICAgICBteURyb3BEb3duLmF0dGFjaCh0aGlzLnF1aWxsKTsKCiAgICAgICAgaWYgKHZhbCA9PT0gJ3F1aWxsX2VkaXQnKSB7CiAgICAgICAgICBteURyb3BEb3duLmF0dGFjaCh0aGlzLnF1aWxsX2VkaXQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZFRhZzogZnVuY3Rpb24gYWRkVGFnKG5ld1RhZykgewogICAgICB2YXIgdGFnX2xpc3QgPSBbXTsKICAgICAgdGFnX2xpc3QgPSBuZXdUYWcuc3BsaXQoIiwiKTsKCiAgICAgIGlmICh0YWdfbGlzdC5sZW5ndGggPiAyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGFkZCB2YWxpZCB0YWciLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICB0aW1lcjogNDUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZW1haWwgPSB0YWdfbGlzdFswXTsKICAgICAgICB2YXIgY3VzdG9tZXJfbmFtZSA9IEJvb2xlYW4odGFnX2xpc3RbMV0pID8gdGFnX2xpc3RbMV0gOiAiICI7CgogICAgICAgIGlmICghdGhpcy5lbWFpbF9yZWcudGVzdChlbWFpbCkpIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwgYWRkcmVzcyIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgIHRpbWVyOiA0NTAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciB0YWcgPSB7CiAgICAgICAgY3VzdG9tZXJfbmFtZTogY3VzdG9tZXJfbmFtZSwKICAgICAgICBlbWFpbDogZW1haWwKICAgICAgfTsKICAgICAgdGhpcy5jdXN0b21lcnNfbGlzdC5wdXNoKHRhZyk7CiAgICAgIHRoaXMuc3BlY2lmaWNfY3VzdG9tZXJfbGlzdC5wdXNoKHRhZyk7CiAgICB9LAogICAgbG9hZF9jdXN0b21lcl9saXN0OiBmdW5jdGlvbiBsb2FkX2N1c3RvbWVyX2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zZW5kX29mZmVyX3RvX2N1c3RvbWVycygpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGdldF9jdXN0b21lcnNfbGlzdDogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgX3RoaXM1LmN1c3RvbWVyc19saXN0ID0gcmVzcG9uc2UuZGF0YS5jdXN0b21lcnNfbGlzdDsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVtYWlsX3ZlcmlmaWNhdGlvbl9zdGF0dXM6IGZ1bmN0aW9uIGVtYWlsX3ZlcmlmaWNhdGlvbl9zdGF0dXMoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc19lbWFpbF92ZXJpZmljYXRpb25fc3RhdHVzOiB0cnVlCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gIiIgJiYgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEgIT0gIkludGVybmFsIHNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgX3RoaXM2LnZlcmlmaWNhdGlvbl9zdGF0dXMgPSByZXNwb25zZS5kYXRhLnZlcmlmaWNhdGlvbl9zdGF0dXM7IC8vIGNvbnNvbGUubG9nKHRoaXMudmVyaWZpY2F0aW9uX3N0YXR1cyk7CgogICAgICAgICAgICBpZiAoX3RoaXM2LnZlcmlmaWNhdGlvbl9zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgLy8gaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHVibGlzaF90ZW1wbGF0ZV9idG4iKS5kaXNhYmxlZCkgewogICAgICAgICAgICAgICQoIiNzZW5kZW1haWwiKS5tb2RhbCgic2hvdyIpOwoKICAgICAgICAgICAgICBfdGhpczYubG9hZF9jdXN0b21lcl9saXN0KCk7IC8vIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiSXQgc2VlbXMgYXMgaWYgeW91ciBTZW5kZXIgRW1haWwgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQgeWV0LCBwbGVhc2UgZ28gdGhlIFNldHRpbmdzIFRhYiBhbmQgY29uZmlndXJlIGl0IHVuZGVyIEVtYWlsIENvbmZpZ3VyYXRpb24uIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAxMzAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczYuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIik7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgdmFsaWRhdGVfdGVtcGxhdGVfbmFtZTogZnVuY3Rpb24gdmFsaWRhdGVfdGVtcGxhdGVfbmFtZSgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfdGVtcGxhdGVfcHJlc2VudDogdHJ1ZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIHRlbXBsYXRlX25hbWU6IHRoaXMudGVtcGxhdGVfbmFtZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJOb3QgRXhpc3RzIikgewogICAgICAgICAgX3RoaXM3LnRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM3LnRlbXBsYXRlX25hbWUgIT0gIiIpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBbHJlYWR5IEV4aXN0cyIpIHsKICAgICAgICAgIF90aGlzNy50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfdGVtcGxhdGVfbmFtZTogZnVuY3Rpb24gdmFsaWRhdGVfZWRpdF90ZW1wbGF0ZV9uYW1lKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX2VtYWlsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc190ZW1wbGF0ZV9wcmVzZW50OiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm90IEV4aXN0cyIpIHsKICAgICAgICAgIF90aGlzOC5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzOC5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUgIT0gIiIpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQWxyZWFkeSBFeGlzdHMiKSB7CiAgICAgICAgICBpZiAoX3RoaXM4Lm9sZF90ZW1wbGF0ZV9uYW1lID09IF90aGlzOC5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUpIHsKICAgICAgICAgICAgX3RoaXM4LmVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM4LmVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gdHJ1ZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBwcmV2aWV3X3RlbXBsYXRlOiBmdW5jdGlvbiBwcmV2aWV3X3RlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfZW1haWwoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX3ByZXZpZXc6IHRydWUsCiAgICAgICAgdGVtcGxhdGVfaWQ6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7IC8vIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAvLyAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAvLyAgIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgICAgIC8vICAgaWYgKHJlc3BvbnNlLmRhdGEgPT09ICJEQiBPUEVSQVRJT04gVU5TVUNDRVNTRlVMIikgewogICAgICAgIC8vICAgICB0aGlzLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgIC8vICAgICByZXR1cm47CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICB0aGlzLnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAvLyAgIGlmICh0aGlzLnRlbXBsYXRlbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gICAgIC8vIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGVsaXN0WzBdOwogICAgICAgIC8vICAgICB0aGlzLnNob3dfdGVtcGxhdGUoMCk7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgLy8gfQogICAgICAgIC8vIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICBfdGhpczkucHJldmlld190ZW1wbGF0ZV9kYXRhID0gcmVzcG9uc2UuZGF0YS5UZW1wbGF0ZTsKICAgICAgICAgICQoIiNwcmV2aWV3X3RlbXBsYXRlX3Zpc2libGUiKS5tb2RhbCgic2hvdyIpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VuZF9lbWFpbF9jb25maXJtX3Byb21wdF90ZXh0OiBmdW5jdGlvbiBzZW5kX2VtYWlsX2NvbmZpcm1fcHJvbXB0X3RleHQoYWxsX2N1c3RvbWVyKSB7CiAgICAgIGlmIChhbGxfY3VzdG9tZXIpIHsKICAgICAgICByZXR1cm4gIllvdSBhcmUgYWJvdXQgdG8gc2VuZCBidWxrIGUtbWFpbHMuIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIllvdSBhcmUgYWJvdXQgdG8gc2VuZCBlLW1haWxzIHRvIHNwZWNpZmljIGN1c3RvbWVycy4iOwogICAgICB9CiAgICB9LAogICAgc2VuZF9lbWFpbDogZnVuY3Rpb24gc2VuZF9lbWFpbCgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLnNlbmRfZW1haWxfYWxsX2N1c3RvbWVyKSB7CiAgICAgICAgaWYgKCFCb29sZWFuKHRoaXMuc3BlY2lmaWNfY3VzdG9tZXJfbGlzdC5sZW5ndGggPiAwKSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugc2VsZWN0IGF0IGxlYXN0IG9uZSBlbWFpbCIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGltZXI6IDUwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy5zZW5kX2VtYWlsX2NvbmZpcm1fcHJvbXB0X3RleHQodGhpcy5zZW5kX2VtYWlsX2FsbF9jdXN0b21lciksCiAgICAgICAgdGV4dDogIlBsZWFzZSBjb25maXJtIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJywKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBDb25maXJtISEiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICQoIiNzZW5kZW1haWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2VuZF9vZmZlcl90b19jdXN0b21lcnMoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczEwLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxMC5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczEwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczEwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiBfdGhpczEwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzZW5kX2VtYWlsOiB0cnVlLAogICAgICAgICAgICBzZW5kX2VtYWlsX2FsbF9jdXN0b21lcjogX3RoaXMxMC5zZW5kX2VtYWlsX2FsbF9jdXN0b21lciwKICAgICAgICAgICAgc3BlY2lmaWNfY3VzdG9tZXJfbGlzdDogX3RoaXMxMC5zZW5kX2VtYWlsX2FsbF9jdXN0b21lciAhPSB0cnVlID8gX3RoaXMxMC5zcGVjaWZpY19jdXN0b21lcl9saXN0IDogW10sCiAgICAgICAgICAgIHRlbXBsYXRlX2lkOiBfdGhpczEwLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxMC4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09PSAiU2VuZGluZyBFbWFpbCIpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuc2F2ZV9zdWJqZWN0ID0gIiI7CiAgICAgICAgICAgICAgICAvLyAkKCIjcHVibGlzaHRlbXBsYXRlbW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICJFbWFpbCBpcyBiZWluZyAgc2VudCBzdWNjZXNzZnVsbHkuIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjogNTAwMCwKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIgogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICQoIiNzZW5kZW1haWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PT0gIlBsZWFzZSB1cGdyYWRlIHlvdXIgcGxhbiB0byBzZW5kIGVtYWlscyIpIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdXBncmFkZSB5b3VyIHBsYW4gdG8gc2VuZCBlbWFpbHMuIiwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAnIzMwODVkNicsCiAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnVXBncmFkZSBOb3cnLAogICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnTGF0ZXInLAogICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMxMC4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1NldHRpbmdzJywKICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdGVkX3RlbXBsYXRlczogZnVuY3Rpb24gc2VsZWN0ZWRfdGVtcGxhdGVzKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGVtcGxhdGVsaXN0KSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy50ZW1wbGF0ZWxpc3RbaV0udGVtcGxhdGVfaWQpOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICQoIiMiICsgW19pXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uICh0ZW1wbGF0ZXNfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlc19pZCAhPSB2YWx1ZTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvYWRfdGVtcGxhdGVzOiBmdW5jdGlvbiBsb2FkX3RlbXBsYXRlcygpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczExLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICBfdGhpczExLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICBfdGhpczExLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKF90aGlzMTEubnVtYmVyX29mX3Jvd3MgLyBfdGhpczExLnBlcl9wYWdlKTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gIkRCIE9QRVJBVElPTiBVTlNVQ0NFU1NGVUwiKSB7CiAgICAgICAgICAgIF90aGlzMTEudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczExLnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKCiAgICAgICAgICBpZiAoX3RoaXMxMS50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyB0aGlzLmN1cnJlbnRfdGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlbGlzdFswXTsKICAgICAgICAgICAgX3RoaXMxMS5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTEuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIF90aGlzMTEuc2V0cGFnaW5hdGlvbihfdGhpczExLnBhZ2Vfbm8pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZpbGVpbnB1dDE6IGZ1bmN0aW9uIGZpbGVpbnB1dDEoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKCiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZShmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhbiBJbWFnZSBvZiB0eXBlIFBORyBvciBKUEVHIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczEyLmltYWdlX2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGZpbGVpbnB1dDI6IGZ1bmN0aW9uIGZpbGVpbnB1dDIoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKCiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2VkaXRlZF9pbWFnZV9uYW1lID0gdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbDsKICAgICAgICB0aGlzLmVkaXRlZF9maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMihmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhbiBJbWFnZSBvZiB0eXBlIFBORyBvciBKUEVHIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2UyOiBmdW5jdGlvbiBjcmVhdGVJbWFnZTIoZmlsZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTMuaW1hZ2VfZmlsZV8yID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBjcmVhdGVfVVVJRDogZnVuY3Rpb24gY3JlYXRlX1VVSUQoKSB7CiAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICB2YXIgdXVpZCA9ICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICB2YXIgciA9IChkdCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgZHQgPSBNYXRoLmZsb29yKGR0IC8gMTYpOwogICAgICAgIHJldHVybiAoYyA9PSAieCIgPyByIDogciAmIDB4MyB8IDB4OCkudG9TdHJpbmcoMTYpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHV1aWQ7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICB9CgogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfZW1haWwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09PSAiREIgT1BFUkFUSU9OIFVOU1VDQ0VTU0ZVTCIpIHsKICAgICAgICAgICAgICBfdGhpczE0LnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMxNC50ZW1wbGF0ZWxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7CgogICAgICAgICAgICBpZiAoX3RoaXMxNC50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzMTQuY3VycmVudF90ZW1wbGF0ZSA9IF90aGlzMTQudGVtcGxhdGVsaXN0WzBdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczE0LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNC5zZXRwYWdpbmF0aW9uKF90aGlzMTQucGFnZV9ubyk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgNDsgX2kyKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMiArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTMgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2kzIDwgdGhpcy50b3RhbF9wYWdlczsgX2kzKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMyArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCBwYWdlX25vICsgMzsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k1ID0gcGFnZV9ubyAtIDQ7IF9pNSA8IHRoaXMudG90YWxfcGFnZXM7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k2ID0gcGFnZV9ubyAtIDM7IF9pNiA8PSBwYWdlX25vICsgMzsgX2k2KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX3RlbXBsYXRlOiBmdW5jdGlvbiBzYXZlX3RlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICBpZiAodGhpcy50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFRlbXBsYXRlIG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlRlbXBsYXRlIG5hbWUgYWxyZWFkeSBleGlzdCwgUGxlYXNlIGVudGVyIGRpZmZlcmVudCBuYW1lIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZW1haWxfc3ViamVjdCA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciB0aGUgc3ViamVjdCBmb3IgZW1haWwiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19zbXMgPT0gdHJ1ZSAmJiB0aGlzLnNhdmVfc21zID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFNtcyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX2VtYWlsID09IHRydWUgJiYgdGhpcy5zYXZlX2VtYWlsID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIEVtYWlsIEJvZHkiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19lbWFpbCA9PSBmYWxzZSAmJiB0aGlzLmlzX3NtcyA9PSBmYWxzZSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgYW4gb3B0aW9uIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfaW1hZ2VfbmVlZGVkID09ICJ5ZXMiICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEZpbGUiKS52YWx1ZSA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBjaG9vc2UgYW4gaW1hZ2UiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19pbWFnZV9uZWVkZWQgPT0gInllcyIgJiYgIXRoaXMudmFsaWRVUkwpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgdmFsaWQgVVJMIGxpbmsiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHV1aWQgPSB0aGlzLmNyZWF0ZV9VVUlEKCk7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gYWRkIHRoaXMgdGVtcGxhdGU/IiwKICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHdhaXQgd2hpbGUgd2UgYXJlIHN1Ym1pdHRpbmcgeW91ciBkZXRhaWxzLi4uIiwKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxNS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxNS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICAgICAgICBpc19ub3RpZmljYXRpb246IF90aGlzMTUuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB1dWlkLAogICAgICAgICAgICAgIHRlbXBsYXRlX25hbWU6IF90aGlzMTUudGVtcGxhdGVfbmFtZSwKICAgICAgICAgICAgICBzYXZlX2VtYWlsOiBfdGhpczE1LmlzX2VtYWlsID09IHRydWUgPyBfdGhpczE1LnNhdmVfZW1haWwgOiBudWxsLAogICAgICAgICAgICAgIHNhdmVfc21zOiBfdGhpczE1LmlzX3NtcyA9PSB0cnVlID8gX3RoaXMxNS5zYXZlX3NtcyA6IG51bGwsCiAgICAgICAgICAgICAgZW1haWxfc3ViamVjdDogX3RoaXMxNS5lbWFpbF9zdWJqZWN0LAogICAgICAgICAgICAgIGVtYWlsX2ltZ19maWxlOiBfdGhpczE1LmlzX2ltYWdlX25lZWRlZCA9PT0gIm5vbmUiID8gbnVsbCA6IF90aGlzMTUuaW1hZ2VfZmlsZSwKICAgICAgICAgICAgICBlbWFpbF9pbWdfbmFtZTogX3RoaXMxNS5maWxlX2xhYmVsLAogICAgICAgICAgICAgIGVtYWlsX2ltZ19saW5rOiBfdGhpczE1LmltZ19yZWRpcmVjdF91cmwKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxNS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiVGVtcGxhdGUgZGF0YSBhZGRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTUuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTUubG9hZF90ZW1wbGF0ZXMoKTsKCiAgICAgICAgICAgICAgICAgICQoIiN0ZW1wbGF0ZW1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkR1cGxpY2F0ZSBpbWFnZSIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiSW1hZ2UgYWxyZWFkeSBmb3VuZC4gUGxlYXNlIHVwbG9hZCBhbm90aGVyIGltYWdlIG9yIHJlbmFtZSBpdC4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMxNS5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgICAgIF90aGlzMTUubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMxNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZWRpdF90ZW1wbGF0ZTogZnVuY3Rpb24gZWRpdF90ZW1wbGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFRlbXBsYXRlIG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9PSB0cnVlKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVGVtcGxhdGUgbmFtZSBhbHJlYWR5IGV4aXN0LCBQbGVhc2UgZW50ZXIgZGlmZmVyZW50IG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50X3RlbXBsYXRlLnN1YmplY3QgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgdGhlIHN1YmplY3QgZm9yIGVtYWlsIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfZWRpdF9zbXMgPT0gdHJ1ZSAmJiAodGhpcy5jdXJyZW50X3RlbXBsYXRlLnNtcyA9PSBudWxsIHx8IHRoaXMuY3VycmVudF90ZW1wbGF0ZS5zbXMgPT0gIiIpKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFNtcyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX2VkaXRfZW1haWwgPT0gdHJ1ZSAmJiAodGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsID09IG51bGwgfHwgdGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsID09ICIiKSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbiBFbWFpbCBCb2R5IiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfZWRpdF9lbWFpbCA9PSBmYWxzZSAmJiB0aGlzLmlzX2VkaXRfc21zID09IGZhbHNlKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBhbiBvcHRpb24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9PSAieWVzIiAmJiAhdGhpcy52YWxpZF9lZGl0X1VSTCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciB2YWxpZCBVUkwgbGluayIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX2VkaXRfaW1hZ2VfbmVlZGVkID09ICJ5ZXMiICYmIHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwgPT0gIkNob29zZSBmaWxlIiAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRGaWxlMiIpLnZhbHVlID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIENob29zZSBhbiBJbWFnZSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSBhcmUgc3VibWl0dGluZyB5b3VyIGRldGFpbHMuLi4iLAogICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICB0ZW1wbGF0ZV9pZDogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX2lkLAogICAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUsCiAgICAgICAgICBlbWFpbF9zdWJqZWN0OiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUuc3ViamVjdCwKICAgICAgICAgIHNhdmVfZW1haWw6IHRoaXMuaXNfZWRpdF9lbWFpbCA9PSB0cnVlID8gdGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsIDogbnVsbCwKICAgICAgICAgIHNhdmVfc21zOiB0aGlzLmlzX2VkaXRfc21zID09IHRydWUgPyB0aGlzLmN1cnJlbnRfdGVtcGxhdGUuc21zIDogbnVsbCwKICAgICAgICAgIGVtYWlsX2ltZ19maWxlOiB0aGlzLmlzX2VkaXRfaW1hZ2VfbmVlZGVkID09PSAibm9uZSIgPyBudWxsIDogdGhpcy5pbWFnZV9maWxlXzIsCiAgICAgICAgICBlbWFpbF9pbWdfbmFtZTogdGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9PT0gIm5vbmUiID8gbnVsbCA6IHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwsCiAgICAgICAgICBlbWFpbF9pbWdfbGluazogdGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9PT0gIm5vbmUiID8gbnVsbCA6IHRoaXMuZWRpdF9pbWdfcmVkaXJlY3RfdXJsLAogICAgICAgICAgaXNfaW1hZ2VfZWRpdDogdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9lZGl0ZWRfaW1hZ2VfbmFtZSA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgIGlzX2ltYWdlX3ByZXNlbnQ6IHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPT09ICJub25lIiA/IGZhbHNlIDogdHJ1ZSwKICAgICAgICAgIG9sZF9pbWFnZTogdGhpcy5vbGRfZWRpdGVkX2ltYWdlX25hbWUgPT0gIkNob29zZSBGaWxlIiA/IG51bGwgOiB0aGlzLm9sZF9lZGl0ZWRfaW1hZ2VfbmFtZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRleHQ6ICJUZW1wbGF0ZSBkYXRhIGVkaXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIF90aGlzMTYubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEZpbGUyIikudmFsdWUgPSAiIjsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMxNi5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3NlbGVjdGVkOiBmdW5jdGlvbiBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIk5vIHRlbXBsYXRlcyBzZWxlY3RlZCEiLAogICAgICAgICAgdGV4dDogIiIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgIHRleHQ6ICIgWW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgdGVtcGxhdGU/IiwKICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczE3LmRlbGV0ZV90ZW1wbGF0ZXMoX3RoaXMxNy5jaGVja2VkX2xpc3QpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3RlbXBsYXRlczogZnVuY3Rpb24gZGVsZXRlX3RlbXBsYXRlcyhjaGVja2VkX2xpc3QpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZGVsZXRlOiB0cnVlLAogICAgICAgIHRlbXBsYXRlX2xpc3Q6IGNoZWNrZWRfbGlzdCwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiRGVsZXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB0ZXh0OiAiVGVtcGxhdGUgZGF0YSBkZWxldGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgX3RoaXMxOC5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgICAgX3RoaXMxOC5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNob3dfdGVtcGxhdGU6IGZ1bmN0aW9uIHNob3dfdGVtcGxhdGUoaW5kZXgpIHsKICAgICAgdGhpcy5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICB0aGlzLmN1cnJlbnRfdGVtcGxhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XSkpOwogICAgICB0aGlzLm9sZF90ZW1wbGF0ZV9uYW1lID0gdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWU7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZV9pbmRleCA9IGluZGV4OwoKICAgICAgaWYgKEJvb2xlYW4odGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX2ltYWdlX25hbWUpID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9ICJ5ZXMiOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPSAibm9uZSI7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0uZW1haWwgIT0gbnVsbCkgewogICAgICAgIHRoaXMuaXNfZWRpdF9lbWFpbCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc19lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0uc21zICE9IG51bGwpIHsKICAgICAgICB0aGlzLmlzX2VkaXRfc21zID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzX2VkaXRfc21zID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChCb29sZWFuKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pbWFnZV9uYW1lKSA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaW1hZ2VfbmFtZTsKICAgICAgICB0aGlzLm9sZF9lZGl0ZWRfaW1hZ2VfbmFtZSA9IHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWw7CiAgICAgICAgdGhpcy5lZGl0X2ltZ19yZWRpcmVjdF91cmwgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUuaW1hZ2VfcmVkaXJlY3RfdXJsOwoKICAgICAgICBpZiAodGhpcy5lZGl0ZWRfZmlsZV9sYWJlbCA9PSAiIikgewogICAgICAgICAgdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIHRoaXMub2xkX2VkaXRlZF9pbWFnZV9uYW1lID0gdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbDsKICAgICAgICB0aGlzLmVkaXRfaW1nX3JlZGlyZWN0X3VybCA9ICIiOwogICAgICB9CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGU6IGZ1bmN0aW9uIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIHRoaXMuc2VuZF9lbWFpbF9hbGxfY3VzdG9tZXIgPSB0cnVlOwogICAgICAgIHRoaXMucXVpbGwuc2V0VGV4dCgiIik7CiAgICAgICAgdGhpcy5jdXN0b21lcnNfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc3BlY2lmaWNfY3VzdG9tZXJfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc2F2ZV9zbXMgPSAiIjsKICAgICAgICB0aGlzLnNhdmVfZW1haWwgPSAiIjsKICAgICAgICB0aGlzLnRlbXBsYXRlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLm9sZF90ZW1wbGF0ZV9uYW1lID0gIiI7CiAgICAgICAgdGhpcy5pc19lbWFpbCA9IHRydWU7CiAgICAgICAgdGhpcy5pc19zbXMgPSBmYWxzZTsKICAgICAgICB0aGlzLnNhdmVfc3ViamVjdCA9ICIiOwogICAgICAgIHRoaXMuaXNfcHVibGlzaF9lbWFpbCA9IHRydWU7CiAgICAgICAgdGhpcy52ZXJpZmljYXRpb25fc3RhdHVzID0gbnVsbDsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIHRoaXMuaW1nX3JlZGlyZWN0X3VybCA9ICIiOwogICAgICAgIHRoaXMuZW1haWxfc3ViamVjdCA9ICIiOwogICAgICAgIHRoaXMuaXNfaW1hZ2VfbmVlZGVkID0gIm5vbmUiOwogICAgICAgIHRoaXMudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgZWRpdF90ZW1wbGF0ZV9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X3RlbXBsYXRlX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5pc0VkaXRUZW1wbGF0ZSkgewogICAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSB0cnVlOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxOS5lZGl0X2VkaXRvcigpOwogICAgICAgIH0sIDEwMDApOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICB0aGlzLmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgdGhpcy5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfY3VycmVudF90ZW1wbGF0ZV9hY3RpdmU6IGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnRfdGVtcGxhdGVfYWN0aXZlKGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUudGFibGUoaW5kZXgsIHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XSwgdGhpcy5jdXJyZW50X3RlbXBsYXRlKTsKICAgICAgaWYgKEJvb2xlYW4odGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdKSA9PT0gdHJ1ZSkgewogICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0udGVtcGxhdGVfbmFtZSA9PT0gdGhpcy5vbGRfdGVtcGxhdGVfbmFtZSA/ICJjdXJyZW50LWFjdGl2ZS10ZW1wbGF0ZSIgOiBudWxsOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}