{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue","mtime":1663910265454},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IFRlbXBsYXRlIGZyb20gIi4uL1RlbXBsYXRlLnZ1ZSI7CmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBUZW1wbGF0ZTogVGVtcGxhdGUsCiAgICBWdWVFZGl0b3I6IFZ1ZUVkaXRvcgogIH0sCiAgbmFtZTogImludGVudHNfY29tcG9uZW50IiwKICBtaXhpbnM6IFtmcmVlemVfcG9ydGFsLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwsIGNsb3NlX21vZGFsXSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGVuY2lsX3N2ZzogJyA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE1LjU0NiIgaGVpZ2h0PSIxNS40NjEiIHZpZXdCb3g9IjAgMCAxNS41NDYgMTUuNDYxIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojOWU5ZTllO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzQ3Ljg4OCAtMzU2Ljc2OSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNzU5LjQxNiwzNTYuNzY5YTIuMzU4LDIuMzU4LDAsMCwxLDEuNzc3LjY2MmMuNTM0LjUxMywxLjA3MiwxLjAyNSwxLjU2NywxLjU3NWEyLjMsMi4zLDAsMCwxLS4wNzEsMy4zMjVjLTIuNzM2LDIuNzYtNS40OTQsNS41LTguMjM4LDguMjUxYTEuMzgxLDEuMzgxLDAsMCwxLS43NTguMjg4Yy0uNzE5LjE3NC0xLjQyOS4zNzktMi4xNDQuNTcyLS45MzIuMjUxLTEuODYyLjUtMi43OTUuNzUxLS42LjE1OC0uOTg5LS4yMTMtLjgzMi0uODA3cS42ODktMi41OTUsMS40MDYtNS4xODJhMS4xNjQsMS4xNjQsMCwwLDEsLjI4OS0uNDg3cTQuMDkxLTQuMTA3LDguMi04LjJBMi4yNjUsMi4yNjUsMCwwLDEsNzU5LjQxNiwzNTYuNzY5Wm0tMS45ODksMi45NTYtNi41NCw2LjUzOCwzLjAyNSwzLjAyNCw2LjUzOC02LjUzN1ptNC4wMjMsMi4xNjVjLjExOC0uMTM1LjIyNS0uMjY5LjM0My0uMzkyYTEuMTM0LDEuMTM0LDAsMCwwLDAtMS43MzRjLS40Ni0uNDY2LS45MjYtLjkyNS0xLjM4OC0xLjM5YTEuMTY2LDEuMTY2LDAsMCwwLS44NjEtLjM2OGMtLjU3OCwwLS44ODEuNC0xLjIxNC43NlptLTEyLjA4NCw4Ljg2MywzLjItLjg2My0yLjMzNy0yLjMzMVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDApIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik04MTMuOTQyLDQyMi42bC0uNzg5LS44LDMuODIxLTMuODE5Ljc4NC44WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU5LjY0OCAtNTUuOTQ3KSIvPjwvZz48L3N2Zz4nLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBuZXdfaW50ZW50X2Rlc2NyaXB0aW9uOiAiIiwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzOiBmYWxzZSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQ6IGZhbHNlLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgbmV3X2ludGVudHM6ICIiLAogICAgICBhZGRfcXVlc3Rpb25zX2xpc3Q6IFsiIl0sCiAgICAgIG9sZF9pbnRlbnRfbmFtZTogIiIsCiAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiBbXSwKICAgICAgaW50ZW50bGlzdDogW10sCiAgICAgIGNvbXBhbnluYW1lOiAiIiwKICAgICAgY29tcGFueWlkOiAiIiwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBpc0VkaXRJbnRlbnQ6IGZhbHNlLAogICAgICBzZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb246ICIiLAogICAgICBpc19zZWFyY2hfYWN0aXZlOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9uczogWyIiXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ6ICIiLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleDogMCwKICAgICAgaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzczogZmFsc2UsCiAgICAgIHNwaW5uZXJPbkZpbGVEb3dubG9hZDogZmFsc2UsCiAgICAgIGZpbGVfbGFiZWxfY3N2OiAiQ2hvb3NlIGZpbGUiCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQoKICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgIHRoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiaW50ZW50c19jb21wb25lbnREaXNhYmxlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgX3RoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgLy8gJCgnZGl2OmlucHV0JykucHJvcCgnY2hlY2tlZCcsdHJ1ZSk7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICAgICQoIiNpbnRlbnRtb2RlbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgfSk7CiAgICAkKCdhW2RhdGEtdGFyZ2V0PSIjaW50ZW50bW9kZWwiXScpLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHZtLmlzRWRpdEludGVudCA9PSB0cnVlKSB7CiAgICAgICAgdm0udmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oInNlbmRfbW9kZWxfc3RhdHVzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGEgPT0gdHJ1ZSkgewogICAgICAgIF90aGlzLmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwogICAgICB9CiAgICB9KTsKICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIG5ld19pbnRlbnRzOiBmdW5jdGlvbiBuZXdfaW50ZW50cyh2YWwpIHsKICAgICAgdGhpcy5uZXdfaW50ZW50cyA9IHZhbC5yZXBsYWNlKC9bXmEtekEtWjAtOV8gXS9nLCAiIik7CiAgICB9LAogICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ6IGZ1bmN0aW9uIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KHZhbCkgewogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHZlcmlmeV9jaGFuZ2VzOiBmdW5jdGlvbiB2ZXJpZnlfY2hhbmdlcygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9zd2FsX2FsZXJ0X21zZzEnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3N3YWxfY2hhbmdlc19pbl9vYmplY3RpdmVfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9zd2FsX3NhdmVfYnRuJyksCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9zd2FsX2NhbmNlbF9idG4nKQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczIuZWRpdF9pbnRlbnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyLnNob3dfaW50ZW50cyhfdGhpczIuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwoKICAgICAgICAgIF90aGlzMi5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIGlmICh0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgICAgdGhpcy52ZXJpZnlfY2hhbmdlcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlYXJjaF9pbnRlbnQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfaW50ZW50OiBmdW5jdGlvbiBzZWFyY2hfaW50ZW50KGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczMudGx0KCdpbnRlbnRfc2VhcmNoX25vX3Jlc3VsdF9mb3VuZF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczMuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczMucGFnZV9ubyA9IDE7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuVE9LRU5fSU5WQUxJRF8wMDAxX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzMy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIF90aGlzMy5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczMuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgX3RoaXMzLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMzLmludGVudGxpc3RbaV0uSW50ZW50OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMy5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIF90aGlzMy5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMzLnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMzLnNldHBhZ2luYXRpb24oX3RoaXMzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnaW50ZW50X3NlYXJjaF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMy5sb2FkX2ludGVudCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnaW50ZW50X3NlYXJjaF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMicpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMy5sb2FkX2ludGVudCgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfc2VhcmNoX2RhdGFfZm9yX3NlYXJjaF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X2ludGVudDogZnVuY3Rpb24gY2hlY2tfY3VycmVudF9pbnRlbnQoaW5kZXgpIHsKICAgICAgdmFyIHJldHVybl92YXIgPSAiIjsKCiAgICAgIGlmICh0aGlzLmludGVudGxpc3RbaW5kZXhdLkludGVudCA9PSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCkgewogICAgICAgIHJldHVybl92YXIgKz0gImN1cnJlbnQtYWN0aXZlLWludGVudCI7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXR1cm5fdmFyOwogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGFkZF90b19xdWVzdGlvbnNfbGlzdDogZnVuY3Rpb24gYWRkX3RvX3F1ZXN0aW9uc19saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2hvd19pbnRlbnRzOiBmdW5jdGlvbiBzaG93X2ludGVudHMoaW5kZXgpIHsKICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgdmFyIGNsb25lX3NlbGVjdGVkX2ludGVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pbnRlbnRsaXN0W2luZGV4XSkpOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5JbnRlbnQ7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5RdWVzdGlvbnM7CiAgICAgIHRoaXMub2xkX3F1ZXN0aW9uX2xpc3QgPSB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnM7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudERlc2NyaXB0aW9uOwogICAgICB0aGlzLm9sZF9pbnRlbnRfbmFtZSA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ7CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZW50ZXJpbmcgYSBpbnRlbnQgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWQ6IGZ1bmN0aW9uIGVudGVyaW50ZW50aWQoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGludGVudF9zZWFyY2hfa2V5ID0gdGhpcy5uZXdfaW50ZW50czsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgIGludGVudF9zZWFyY2hfa2V5OiB0aGlzLm5ld19pbnRlbnRzCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX05BTUVfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUgJiYgX3RoaXM0Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM0LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNC5uZXdfaW50ZW50cyAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczQuYXBpX3N0YXR1c19jb2RlLkRVUExJQ0FURV9JTlRFTlRfNDAxMV9NT0RFTFMuTVNHX0NPREUgJiYgX3RoaXM0Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM0LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZWRpdGluZyBhbmQgZW50ZXJpbmcgYSBvYmplY3RpdmUgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWRfZWRpdDogZnVuY3Rpb24gZW50ZXJpbnRlbnRpZF9lZGl0KCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfaW50ZW50X3NlYXJjaDogdHJ1ZSwKICAgICAgICBpbnRlbnRfc2VhcmNoX2tleTogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczUuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9OQU1FX05PVF9FWElTVFNfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczUuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNS5jdXJyZW50X3NlbGVjdGVkX2ludGVudCAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuRFVQTElDQVRFX0lOVEVOVF80MDExX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzNS5vbGRfaW50ZW50X25hbWUgPT0gX3RoaXM1LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSB7CiAgICAgICAgICAgIF90aGlzNS5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM1LmludGVudF9hbHJlYWR5X2V4aXN0c19lZGl0ID0gdHJ1ZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVkaXRfaW50ZW50X2RldGFpbHM6IGZ1bmN0aW9uIGVkaXRfaW50ZW50X2RldGFpbHMoKSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICB0aGlzLmlzRWRpdEludGVudCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfSwKICAgIGRlbGV0ZV9zZWxlY3RlZDogZnVuY3Rpb24gZGVsZXRlX3NlbGVjdGVkKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9ub19vYmplY3RpdmVfc2VsZWN0X21zZycpLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIG5ld19pbnRlbnRfbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuY2hlY2tlZF9saXN0KSB7CiAgICAgICAgICBuZXdfaW50ZW50X2xpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXSk7CiAgICAgICAgfQoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfc3dhbF9hbGVydF9tc2cyJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X25vX3JldmVydF9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9zd2FsX2RlbGV0ZV9idG4nKQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczYuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgICBpbnRlbnRfbGlzdDogbmV3X2ludGVudF9saXN0LAogICAgICAgICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNi5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczYuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM2LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuSU5URU5UU19ERUxFVEVEX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczYudGx0KCdpbnRlbnRfb2JqZWN0aXZlX2lzX2RlbGV0ZWRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXM2LmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzNi5pbnRlbnRsaXN0Lmxlbmd0aCAmJiBfdGhpczYucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM2LnBhZ2Vfbm8gPSBfdGhpczYucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfVVNFRF9JTl9ESUFMT0dfREVMRVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczYudGx0KCdpbnRlbnRfbW9kaWZ5X2RpYWxvZ19ub2RlX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogODAwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNi5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczYuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXM2LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi5wYWdlX25vID0gX3RoaXM2LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuTk9USElOR19UT19ERUxFVEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczYudGx0KCdpbnRlbnRfbm9fb2JqZWN0aXZlX3NlbGVjdGVkX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfREVMRVRFRF9UUkFJTl9NT0RFTF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ2ludGVudF90cmFpbmVkX29iamV0aXZlX2RlbGV0ZWRfbXNnMScpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNi5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczYuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXM2LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi5wYWdlX25vID0gX3RoaXM2LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuVFJBSU5FRF9JTlRFTlRfQU5EX0lOVEVOVF9VU0VEX0lOX0RJQUxPR19ERUxFVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ2ludGVudF90cmFpbmVkX29iamV0aXZlX2RlbGV0ZWRfbXNnMicpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczYuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXM2LmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzNi5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczYucGFnZV9ubyA9IF90aGlzNi5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ2ludGVudF9kZWxldGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzNi5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgICAgIF90aGlzNi5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczYubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0X2ludGVudDogZnVuY3Rpb24gZWRpdF9pbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMub2xkX2ludGVudF9uYW1lID09IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpIHsKICAgICAgICB2YXIgaW50ZW50X3RvX3NlbmQgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpbnRlbnRfdG9fc2VuZCA9IHRoaXMub2xkX2ludGVudF9uYW1lOwogICAgICB9CgogICAgICBpZiAodGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCkgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnaW50ZW50X2VkaXRfb2JqZWN0aXZlX25hbWVfZXhpc3RfbXNnJykpOwogICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2VkaXRfZW50ZXJfb2JqZWN0aXZlX25hbWVfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnNbaV0gPT09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9uc1tpXSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlF1ZXN0aW9ucyBjYW5ub3QgYmUgYmxhbmsiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9lZGl0X3FzX2JsYW5rX21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBlZGl0X2ludGVudDogdHJ1ZSwKICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbl9saXN0LAogICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX1FVRVNUSU9OX0VESVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdpbnRlbnRfZWRpdGVkX3N1Y2Nlc3NmdWxfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgIHRpdGxlOiBfdGhpczcudGx0KCdpbnRlbnRfZWRpdF9zd2FsX3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKF90aGlzNy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgIF90aGlzNy5zZWFyY2hfaW50ZW50KF90aGlzNy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczcubG9hZF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLlVTRURfSU5URU5UX1FVRVNUSU9OX0VESVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ2ludGVudF9lZGl0X21vZGlmeV9kaWFsb2dfbm9kZV9tc2cnKSwKICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKF90aGlzNy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM3LnNlYXJjaF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczcubG9hZF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfUVVFU1RJT05fTk9UX0VESVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdpbnRlbnRfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdpbnRlbnRfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMicpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdpbnRlbnRfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMycpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzOiBmdW5jdGlvbiBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KSB7CiAgICAgIGlmICh0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPT0gdHJ1ZSkgewogICAgICAgIGlmIChpbmRleCA9PSAnc3R5bGUnKSB7CiAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gJ3RpdGxlJykgewogICAgICAgICAgcmV0dXJuICJUcmFpbmluZyBpbiBQcm9ncmVzcyAoVGhpcyBwcm9jZXNzIG1pZ2h0IHRha2UgYXJvdW5kIDMwIG1pbnMgdG8gZmluaXNoKSAiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1czogZnVuY3Rpb24gY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCkgewogICAgICB0aGlzLm1vZGVsX3N0YXR1cyA9IHRoaXMuJHNlc3Npb24uZ2V0KCJNb2RlbFN0YXR1cyIpOwoKICAgICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzID09ICJObyBGYWlsdXJlIikgewogICAgICAgIHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMuaW50ZW50X21vZGVsKSA9PT0gdHJ1ZSB8fCBCb29sZWFuKHRoaXMubW9kZWxfc3RhdHVzLmRpYWxvZ3VlX21vZGVsKSA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLm1vZGVsX3N0YXR1cy5pbnRlbnRfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiIHx8IHRoaXMubW9kZWxfc3RhdHVzLmRpYWxvZ3VlX21vZGVsID09ICJJblByb2dyZXNzIikgewogICAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgdHJhaW5fbW9kZWw6IGZ1bmN0aW9uIHRyYWluX21vZGVsKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X3RyYWluX21vZGVsX3N3YWxfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF90cmFpbl90aGVfbW9kZWxfbXNnJyksCiAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdpbnRlbnRfdHJhaW5fc3dhbF9jb25maXJtX21zZycpLAogICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50cmFpbl9tb2RlbCgpLCB7CiAgICAgICAgICAgIGVtYWlsOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczguY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzOC5jb21wYW55aWQKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM4LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczgud2FudF9zdGF0dXMgPSB0cnVlOwoKICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJ3YW50X21vZGVsX3N0YXR1cyIsIF90aGlzOC53YW50X3N0YXR1cyk7CgogICAgICAgICAgICBfdGhpczguY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX0FORF9DT1JFX01PREVMX0JFSU5HX1RSQUlORURfUFJFTUlVTV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5UUkFJTklOR19MSU1JVF9FWENFRURfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0cpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczgudGx0KCdpbnRlbnRfdHJhaW5faW50ZXJuYWxfc2VydmVyX21zZycpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdGVkX2ludGVudHM6IGZ1bmN0aW9uIHNlbGVjdGVkX2ludGVudHMoSW50ZW50KSB7CiAgICAgIGlmIChJbnRlbnQgPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRoaXMuaW50ZW50bGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSW50ZW50OwogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjaW50ZW50X2NoZWNrYm94XyIgKyB0aGlzLmNoZWNrZWRfbGlzdFtpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHZhbF9pbmRleCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoaW50ZW50cykgewogICAgICAgICAgICByZXR1cm4gaW50ZW50cy5JbnRlbnQgPT0gSW50ZW50OwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHZhbF9pbmRleC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKEludGVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzICE9IEludGVudDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGludGVudF9uYW1lX2NoZWNrX3NwZWNpYWxfY2hhcmFjdGVyczogZnVuY3Rpb24gaW50ZW50X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzKGUpIHsKICAgICAgaWYgKC9eW15hLXpBLVowLTlfIF0qJC8udGVzdChlLmtleSkpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2ludGVudDogZnVuY3Rpb24gbG9hZF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICAvLyB0aGlzLmludGVudGxpc3QgPSBbXTsKICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM5LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICBfdGhpczkuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhOwoKICAgICAgICAgIGlmIChfdGhpczkuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSkgewogICAgICAgICAgICAgIF90aGlzOS5zaG93X2ludGVudHMoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOS5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF90aGlzOS5zZXRwYWdpbmF0aW9uKF90aGlzOS5wYWdlX25vKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICAgICAgaW50ZW50OiB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMTAuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuZGF0YTsKCiAgICAgICAgICAgIGlmIChfdGhpczEwLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzMTAuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczEwLnNldHBhZ2luYXRpb24oX3RoaXMxMC5wYWdlX25vKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgIGlmICh0aGlzLnBhZ2VubyA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlbm87CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEwLnRsdCgnaW50ZW50X3BhZ2Vfbm9fcmVzdWx0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gW107CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuVE9LRU5fSU5WQUxJRF8wMDAxX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgX3RoaXMxMC50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMTAuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMxMC5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMTAuc2V0cGFnaW5hdGlvbihfdGhpczEwLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoJ2ludGVudF9pbnRlcm5hbF9zZXJ2ZXJfbXNnNCcpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoJ2ludGVudF9pbnRlcm5hbF9zZXJ2ZXJfbXNnNScpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX2ludGVudF91c2VyX2V4YW1wbGU6IGZ1bmN0aW9uIHNhdmVfaW50ZW50X3VzZXJfZXhhbXBsZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X29iamVjdGl2ZV9uYW1lX2V4aXN0X21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDQ1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm5ld19pbnRlbnRzID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2VudGVyX29iamVjdGl2ZV9uYW1lX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W2ldID09PSAiIiB8fCB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdFtpXSA9PT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3R5cGVfdXNlcl9leGFtcGxlX21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMzUwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIFN3YWwoewogICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfc3VibWl0X3lvdXJfZGV0YWlsc19tc2cnKSwKICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgIH0pOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMubmV3X2ludGVudF9kZXNjcmlwdGlvbiwKICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5BRERFRF9TVUNDRVNTRlVMTFlfMDAwMl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X2V4YW1wbGVfc2F2ZWRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgIHRpdGxlOiBfdGhpczExLnRsdCgnaW50ZW50X3N3YWxfc3VjY2Vzc19tc2cnKSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgX3RoaXMxMS5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgIF90aGlzMTEubG9hZF9pbnRlbnQoKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfTk9UX1NBVkVEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzMTEudGx0KCdpbnRlbnRfc2F2ZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3NhdmVfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczExLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3NhdmVfaW50ZXJuYWxfc2VydmVyX21zZzMnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2V0cGFnaW5hdGlvbjogZnVuY3Rpb24gc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7CiAgICAgIHRoaXMucGFnZV9hcnJheSA9IFtdOwoKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCA0OyBfaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaSArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTIgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2kyIDwgdGhpcy50b3RhbF9wYWdlczsgX2kyKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMiArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBwYWdlX25vICsgMzsgX2kzKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMyArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k0ID0gcGFnZV9ubyAtIDQ7IF9pNCA8IHRoaXMudG90YWxfcGFnZXM7IF9pNCsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTQgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k1ID0gcGFnZV9ubyAtIDM7IF9pNSA8PSBwYWdlX25vICsgMzsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSAiIjsKICAgICAgdGhpcy5uZXdfaW50ZW50X2Rlc2NyaXB0aW9uID0gIiI7CiAgICAgIHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgIHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgdGhpcy5pbnRlbnRzID0gdGhpcy5pbnRlbnRsaXN0WzBdOwogICAgICB0aGlzLm5ld19pbnRlbnRzID0gIiI7CiAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0ID0gWyIiXTsKICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZCIpLnN0eWxlLmJvcmRlciA9ICIiOwogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICB9LAogICAgZmlsZV9zdWJtaXQ6IGZ1bmN0aW9uIGZpbGVfc3VibWl0KCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKCQoIiNpbnB1dEdyb3VwRmlsZWNzdiIpLnZhbCgpID09ICcnKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X2lucHV0X2ZpZWxkX2VtcHR5X21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF91cGxvYWRfZmlsZV9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciB1c2VyX2RldGFpbHMgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBpc19mb3JtX2ludGVudHM6IHRydWUKICAgICAgfTsKICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh1c2VyX2RldGFpbHMpOwogICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtqc29uXSwgewogICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIgogICAgICB9KTsKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWxfY3N2ID09ICJDaG9vc2UgZmlsZSIpIHt9IGVsc2UgewogICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZkLmFwcGVuZCgiZmlsZSIsIHRoaXMuZmlsZV9jb250ZW50X2NzdiwgdGhpcy5jb21wYW55bmFtZSArICJPYmplY3RpdmVGaWxlLmNzdiIpOwogICAgICAgIGZkLmFwcGVuZCgianNvbiIsIGJsb2IpOwogICAgICAgICQoIiNmaWxlX3VwbG9hZCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnVwbG9hZF9maWxlX3VybCgpLCBmZCwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuRklMRV9VUExPQURfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczEyLnRsdCgnaW50ZW50X2ZpbGVfdXBsb2FkZWRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLklOQ09SUkVDVF9GSUxFX0ZPUk1BVF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzMTIudGx0KCdpbnRlbnRfaW5jb3JyZWN0X2ZpbGVfZm9ybWF0X21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEyLnRsdCgnaW50ZW50X2Rvd25sb2FkX3NhbXBsZV9maWxlX21zZzEnKSAvLyB0aW1lcjogNDAwMCwKCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9GSUxFX1RZUEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczEyLnRsdCgnaW50ZW50X2ZpbGVfdHlwZV9ub3Rfc3VwcG9ydF9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMi50bHQoJ2ludGVudF9kb3dubG9hZF9zYW1wbGVfZmlsZV9tc2cxJykgLy8gdGltZXI6IDQwMDAsCgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczEyLnRsdCgnaW50ZW50X2Vycm9yX29jY3VycmVkX21zZzEnKSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTIuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlY3N2IikudmFsdWUgPSAiIjsKCiAgICAgICAgICBfdGhpczEyLmxvYWRfaW50ZW50KCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2xvc2VfbW9kYWwoJ3VwbG9hZF9maWxlX2J0bicpOwogICAgICB9CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlX2ZpbGU6IGZ1bmN0aW9uIGRvd25sb2FkX3NhbXBsZV9maWxlKCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0aGlzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5maWxlX2Rvd25sb2FkKCksCiAgICAgICAgcmVzcG9uc2VUeXBlOiAiYmxvYiIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgc2FtcGxlX2ZpbGU6ICJvYmplY3RpdmUiLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIF90aGlzMTMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7IC8vIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAvLyAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfZXJyb3Jfb2NjdXJyZWRfbXNnMicpLAogICAgICAgIC8vICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIC8vICAgICB0aW1lcjogMjUwMCwKICAgICAgICAvLyAgIH0pOwogICAgICAgIC8vIH0gZWxzZSB7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOyAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKQoKICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIF90aGlzMTMuY29tcGFueW5hbWUgKyAiT2JqZWN0aXZlRmlsZS5jc3YiKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICBsaW5rLmNsaWNrKCk7IC8vIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMy5zcGlubmVyT25GaWxlRG93bmxvYWQgPSBmYWxzZTsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiBfdGhpczEzLnRsdCgnaW50ZW50X2Vycm9yX29jY3VycmVkX21zZzMnKSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnc2FtcGxlX2NzdicpOwogICAgfSwKICAgIGZpbGVpbnB1dF9jc3Y6IGZ1bmN0aW9uIGZpbGVpbnB1dF9jc3YoKSB7CiAgICAgIHRoaXMuZmlsZV9sYWJlbF9jc3YgPSBldmVudC50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgdGhpcy5maWxlX2NvbnRlbnRfY3N2ID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgfSwKICAgIGRvd25sb2FkX2NzdjogZnVuY3Rpb24gZG93bmxvYWRfY3N2KCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5xdWVzdGlvbl9pbnRlbnRfY3N2KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzX2Zvcm1faW50ZW50czogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczE0LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgdmFyIGEgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgYS5ocmVmID0gcmVzcG9uc2UuZGF0YS5kYXRhLkNTVl9VUkw7CiAgICAgICAgICBhLmRvd25sb2FkID0gdHJ1ZTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn07"},null]}