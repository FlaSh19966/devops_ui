{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue","mtime":1663910265482},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmxpbmsiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvaG9tZS92aW1hbGVzaC9MZWFybmluZy9kZXZvcHNfdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgU29ja2V0LCBQcmVzZW5jZSB9IGZyb20gInBob2VuaXgiOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gInZ1ZS1waG9uZS1udW1iZXItaW5wdXQiOwppbXBvcnQgc3dhbCBmcm9tICdzd2VldGFsZXJ0Mic7CmltcG9ydCBFbW9qaVBpY2tlciBmcm9tICJ2dWUtZW1vamktcGlja2VyIjsKaW1wb3J0IHsgY2xvc2VfbW9kYWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIldoYXRzQXBwQ2hhdE5ld3BhZ2UiLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdCwKICAgIFZ1ZVBob25lTnVtYmVySW5wdXQ6IFZ1ZVBob25lTnVtYmVySW5wdXQsCiAgICBFbW9qaVBpY2tlcjogRW1vamlQaWNrZXIKICB9LAogIG1peGluczogW2Nsb3NlX21vZGFsXSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgdmFyIF9yZWY7CgogICAgcmV0dXJuIF9yZWYgPSB7CiAgICAgIGN1cnJlbnRfcGFnZV9ubzogMSwKICAgICAgbGF0ZXN0X3BhZ2Vfbm86IDEsCiAgICAgIHNob3dfc3Bpbm5lcjogZmFsc2UsCiAgICAgIGhpc3Rvcnk6IFtdLAogICAgICBjb250YWN0X2xpc3Q6IFtdLAogICAgICBvbGRDdXJzb3JQb3NpdGlvbjogbnVsbCwKICAgICAgaW5wdXQ6ICIiLAogICAgICBzZWFyY2g6ICIiLAogICAgICBzY3JvbGxfdG9wX2NhbGxlZDogZmFsc2UsCiAgICAgIHNob3dFbW9qaVBpY2tlcjogZmFsc2UsCiAgICAgIHNlYXJjaGVkX21lc3NhZ2U6IFtdLAogICAgICBwaG9uZW5vOiBudWxsLAogICAgICBjdXN0b21lcl9uYW1lOiAiIiwKICAgICAgY2hhdF9kZXRhaWxzOiBbXSwKICAgICAgc2VhcmNoX3ZhbHVlOiAiIiwKICAgICAgaXNfc2VhcmNoX2Rpdl9vcGVuOiBmYWxzZSwKICAgICAgc2VhcmNoX21lc3NhZ2VfdmFsdWU6ICIiLAogICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICBzZXNzaW9uX3Rva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICBpbml0aWFsX21lc3NhZ2VfbG9hZDogZmFsc2UsCiAgICAgIGlzX3Byb2ZpbGVfc2V0dXA6IGZhbHNlLAogICAgICBtZXNzYWdlX3BhZ2luYXRpb246IHsKICAgICAgICBpc19zY3JvbGxfdXA6IGZhbHNlLAogICAgICAgIGlzX3Njcm9sbF9kb3duOiB0cnVlLAogICAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgICBwYWdlX25vOiAxLAogICAgICAgIHRvdGFsX3JlY29yZHM6IDEwLAogICAgICAgIHBhZ2VfcmVjb3JkX2ZldGNoZWQ6IFtdCiAgICAgIH0sCiAgICAgIGlzX3BhZ2luYXRlZF9jYWxsOiBmYWxzZSwKICAgICAgZGVmYXVsdF93aGF0c2FwcF9zdGF0dXM6ICdIZXkgdGhlcmUhIEkgYW0gdXNpbmcgd2hhdHNhcHAnLAogICAgICBlZGl0X3N0YXR1czogZmFsc2UsCiAgICAgIHNjcm9sbF9zcGlubmVyX2NoYXQ6IGZhbHNlLAogICAgICBzaG93X3NlbmRfbWVzc2FnZTogZmFsc2UsCiAgICAgIGlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkOiBmYWxzZSwKICAgICAgaXNfc2hvd19tZXNzYWdlX2Rpc2FibGVkOiB0cnVlLAogICAgICB3aGF0c2FwcF9wcm9maWxlOiB7fSwKICAgICAgZWRpdF9lbWFpbDogZmFsc2UsCiAgICAgIGVkaXRfYWRkcmVzczogZmFsc2UsCiAgICAgIGVkaXRfZGVzY3JpcHRpb246IGZhbHNlLAogICAgICBlZGl0X3dlYnNpdGU6IGZhbHNlLAogICAgICB0b2dnbGVNb2RhbDogZmFsc2UsCiAgICAgIHRvZ2dsZU1vZGFsMjogZmFsc2UsCiAgICAgIHNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQ6IG51bGwsCiAgICAgIGVtYWlsX2FkZHJlc3M6ICcnLAogICAgICBidXNpbmVzc19hZGRyZXNzOiAnJywKICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICB3ZWJzaXRlX3VybDogJycsCiAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogbnVsbCwKICAgICAgY2hhbm5lbDogbnVsbCwKICAgICAgY2hhdF9zb2NrZXQ6IG51bGwsCiAgICAgIHN1cHBvcnRfY2hhbm5lbDogbnVsbCwKICAgICAgbWVzc2FnZV90b19zZW5kOiBudWxsLAogICAgICB3aGF0c2FwcF9zdGF0dXM6ICcnLAogICAgICBpbmRleF91cGRhdGU6IG51bGwsCiAgICAgIHNlY29uZF93ZWJzaXRlOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfZmlsZXM6ICcnLAogICAgICBtb3VzZV9ob3Zlcl90ZXh0OiBmYWxzZSwKICAgICAgdmVydGljYWxfdHlwZXM6IFsnQXV0b21vdGl2ZScsICdCZWF1dHknLCAnU3BhIGFuZCBTYWxvbicsICdDbG90aGluZyBhbmQgQXBwYXJlbCcsICdFZHVjYXRpb24nLCAnRW50ZXJ0YWlubWVudCcsICdFdmVudCBQbGFubmluZyBhbmQgU2VydmljZScsICdGaW5hbmNlIGFuZCBCYW5raW5nJywgJ0Zvb2QgYW5kIEdyb2NlcnknLCAnUHVibGljIFNlcnZpY2UnLCAnSG90ZWwgYW5kIExvZGdpbmcnLCAnTWVkaWNhbCBhbmQgSGVhbHRoJywgJ05vbi1wcm9maXQnLCAnUHJvZmVzc2lvbmFsIFNlcnZpY2VzJywgJ1Nob3BwaW5nIGFuZCBSZXRhaWwnLCAnVHJhdmVsIGFuZCBUcmFuc3BvcnRhdGlvbicsICdSZXN0YXVyYW50JywgJ090aGVyJ10sCiAgICAgIGN1cnJlbnRfY29udGFjdF9udW1iZXI6IG51bGwKICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAid2hhdHNhcHBfcGhvbmVfbnVtYmVyIiwgbnVsbCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAiaXNfY29udGFjdF9saXN0IiwgZmFsc2UpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImN1cnJlbnRfY29udGFjdF9pbmRleCIsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgInNlYXJjaF9pbl9jb250YWN0X2xpc3QiLCAnJyksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAiYWxsX2NvbnRhY3RfbGlzdCIsIFtdKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJzdGFydF9uZXdfY29udl9kYXRhIiwgewogICAgICBzdGFydF9uZXdfY29udjogZmFsc2UsCiAgICAgIGlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkOiB0cnVlCiAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJhbGxfY29udGFjdF9wYWdpbmF0aW9uIiwgewogICAgICBwZXJfcGFnZTogMTAsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHRvdGFsX3JlY29yZHM6IDEwCiAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJzZW5kX2F0dGFjaG1lbnRfZGV0YWlsIiwgewogICAgICBtZWRpYV9maWxlX25hbWU6IG51bGwsCiAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgIHNob3dfcHJldmlldzogZmFsc2UsCiAgICAgIG1lZGlhX2NvbnRlbnRfdHlwZTogbnVsbCwKICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgc2VuZF9tZWRpYTogdHJ1ZSwKICAgICAgZG9jdW1lbnRfY29udGVudDogbnVsbCwKICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAiY3VycmVudF9mdWxsc2NyZWVuX2ltYWdlX3NyYyIsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImFkZF9uZXdfY29udGFjdCIsIHsKICAgICAgcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICBpc19hZGRfY29udGFjdDogdHJ1ZSwKICAgICAgY29udGFjdF9uYW1lOiBudWxsLAogICAgICBmb3JtYXR0ZWROdW1iZXI6IG51bGwKICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImFkZF9uZXdfY29udGFjdF9mb3JtYXR0ZWRfcGhvbmVfbnVtYmVyIiwgbnVsbCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAiZmlsZV9leHRlbnNpb25zIiwgewogICAgICBhbGxfYWxsb3dlZF9maWxlX2V4dGVuc2lvbnM6IFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciLCAiYXBwbGljYXRpb24vcGRmIiwgInRleHQvcGxhaW4iLCAiYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsIiwgImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50IiwgImFwcGxpY2F0aW9uL21zd29yZCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCIsICJ0ZXh0L2NzdiJdLAogICAgICBpbWFnZV9maWxlX2V4dGVuc2lvbnM6IFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciXSwKICAgICAgZG9jdW1lbnRfZmlsZV9leHRlbnNpb25zOiBbImFwcGxpY2F0aW9uL3BkZiIsICJ0ZXh0L3BsYWluIiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsICJhcHBsaWNhdGlvbi9tc3dvcmQiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLCAidGV4dC9jc3YiXQogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAid2hhdHNhcHBfdGVtcGxhdGVzIiwgewogICAgICB0ZW1wbGF0ZXNfbGlzdDogW10sCiAgICAgIHBhZ2luYXRpb25fZGF0YTogewogICAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgICBwYWdlX25vOiAxLAogICAgICAgIHRvdGFsX3JlY29yZHM6IDEwCiAgICAgIH0sCiAgICAgIHNlbGVjdGVkX3RlbXBsYXRlOiBudWxsLAogICAgICBwcmV2aWV3X3RlbXBsYXRlX2RhdGE6IG51bGwKICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX3JlZiwgImNvbnRhY3RfY3N2IiwgewogICAgICBmaWxlX2xhYmVsOiAnQ2hvb3NlIEZpbGUnLAogICAgICBmaWxlX2NvbnRlbnQ6IG51bGwsCiAgICAgIGZpbGVfc2VsZWN0ZWQ6IGZhbHNlCiAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJ3aGF0c2FwcF9mb3JtYXRfZGljdCIsIHsKICAgICAgIioiOiBbJzxzdHJvbmc+JywgJzwvc3Ryb25nPiddLAogICAgICAiXyI6IFsnPGk+JywgJzwvaT4nXSwKICAgICAgIn4iOiBbJzxzPicsICc8L3M+J10sCiAgICAgICJgYGAiOiBbJzx0dD4nLCAnPC90dD4nXQogICAgfSksIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAid2hhdHNhcHBfZm9ybWF0aW5nX2xpc3QiLCBbIioiLCAiXyIsICJ+IiwgImBgYCJdKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICJzaG93X3Byb2ZpbGVfZGl2IiwgZmFsc2UpLCBfcmVmOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8vIHRvdGFsX3BhZ2VzX2xvYWRlZCgpIHsKICAgIC8vICAgaWYgKCh0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vICogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UpID49IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMpIHsKICAgIC8vICAgICByZXR1cm4gdHJ1ZTsKICAgIC8vICAgfQogICAgLy8gICByZXR1cm4gZmFsc2U7CiAgICAvLyB9LAogICAgbWVzc2FnZV90ZXh0X2JveF9wbGFjZWhvbGRlcjogZnVuY3Rpb24gbWVzc2FnZV90ZXh0X2JveF9wbGFjZWhvbGRlcigpIHsKICAgICAgcmV0dXJuICJTZW5kIGEgbWVzc2FnZSB0byB1c2VyIjsKICAgIH0sCiAgICByZXR1cm5WYWx1ZXM6IGZ1bmN0aW9uIHJldHVyblZhbHVlcygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBsZWdlbmQ6ICdjYW5jZWxfYnRuJwogICAgICB9OwogICAgfSwKICAgIHRvdGFsX2NvbnRhY3RfbG9hZGVkOiBmdW5jdGlvbiB0b3RhbF9jb250YWN0X2xvYWRlZCgpIHsKICAgICAgaWYgKHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICogdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBlcl9wYWdlID49IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICB0cmFuc2l0aW9uX2RhdGE6IGZ1bmN0aW9uIHRyYW5zaXRpb25fZGF0YSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBjb3VudHJ5U2VsZWN0b3JMYWJlbDogIiIuY29uY2F0KHRoaXMudGx0KCdjb3VudHJ5X2NvZGUnKSksCiAgICAgICAgcGhvbmVOdW1iZXJMYWJlbDogIiIuY29uY2F0KHRoaXMudGx0KCdwaG9uZV9udW1iZXInKSkKICAgICAgfTsKICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpOwogICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdoaWRlJyk7CiAgICB0aGlzLmlzX29wZW4gPSBmYWxzZTsKICAgIG5leHQoKTsKICB9LAogIGJlZm9yZVJvdXRlRW50ZXI6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlRW50ZXIodG8sIGZyb20sIG5leHQpIHsKICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpOwogICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdoaWRlJyk7CiAgICBuZXh0KCk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB0aGlzLmdldF9jb250YWN0X2xpc3QodHJ1ZSk7CiAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKHdpbmRvdykuYmluZCgnbW91c2V3aGVlbCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAvLyBjb25zb2xlLmxvZyhldmVudC5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEpCiAgICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgPj0gMCkgewogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSB0cnVlOwogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX2Rvd24gPSB0cnVlOwogICAgICAgIHRoaXMuc2Nyb2xsX3RvcF9jYWxsZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdm0uaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKICAgIH0pOyAvLyB2YXIgbGFzdFNjcm9sbFRvcCA9IDA7CiAgICAvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKAogICAgLy8gICAic2Nyb2xsIiwKICAgIC8vICAgZnVuY3Rpb24gKGV2KSB7CiAgICAvLyAgICAgaWYgKGV2LnRhcmdldC5pZCA9PT0gInNjcm9sbGluZy1kaXYtd2hhdHNhcHAiKSB7CiAgICAvLyAgICAgICBjb25zb2xlLmxvZyhldikKICAgIC8vICAgICAgIHZhciBzdCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wOyAvLyBDcmVkaXRzOiAiaHR0cHM6Ly9naXRodWIuY29tL3FlcmVteS9zby9ibG9iL21hc3Rlci9zby5kb20uanMjTDQyNiIKICAgIC8vICAgICAgIGlmIChzdCA+IGxhc3RTY3JvbGxUb3ApewogICAgLy8gICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gZmFsc2U7CiAgICAvLyAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICBjb25zb2xlLmxvZygiU2Nyb2xsaW5nIFVwIikKICAgIC8vICAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IHRydWU7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBsYXN0U2Nyb2xsVG9wID0gc3QgPD0gMCA/IDAgOiBzdDsKICAgIC8vICAgICAgIC8vIHZtLnNjcm9sbFBvc2l0aW9uID0gZXYudGFyZ2V0WyJzY3JvbGxUb3AiXTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0sCiAgICAvLyAgIHRydWUKICAgIC8vICk7CgogICAgJCgiI3Nob3dJbWFnZU1vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmN1cnJlbnRfZnVsbHNjcmVlbl9pbWFnZV9zcmMgPSBudWxsOwogICAgfSk7CiAgICAkKCIjaW1wb3J0Q29udGFjdENTVk1vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKTsKICAgIH0pOyAvLyBheGlvcy5wb3N0KGFwaV9jYWxscy5pbml0aWFsaXplX3doYXRzYXBwX3RvcGljKCksIAogICAgLy8gewogICAgLy8gICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAvLyAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogIjEwMCIsCiAgICAvLyAgIHRlc3Q6IGJ0b2EoInRlc3RfcGFyYW1hdGVyIikKICAgIC8vIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSkKICAgIC8vIHRoaXMuY2hhdF9ncm91cF9uYW1lID0gcmVzcG9uc2UuZGF0YS5jaGF0X2dyb3VwX25hbWU7CiAgICAvLyB0aGlzLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAvLyB0aGlzLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAvLyB0aGlzLmNoYXRfc29ja2V0ID0gbmV3IFNvY2tldCgKICAgIC8vICAgcHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULAogICAgLy8gICB7CiAgICAvLyAgICAgcGFyYW1zOiB7CiAgICAvLyAgICAgICB3aGF0c2FwcDogInRydWUiLAogICAgLy8gICAgICAgZWxpeGlyX3Rva2VuIDogcmVzcG9uc2UuZGF0YS5lbGl4aXJfdG9rZW4sCiAgICAvLyAgICAgICB0b2tlbjogdGhpcy5zZXNzaW9uX3Rva2VuLAogICAgLy8gICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgLy8gICAgIH0sCiAgICAvLyAgIH0KICAgIC8vICk7CgogICAgdGhpcy5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULCB7CiAgICAgIHBhcmFtczogewogICAgICAgIHdoYXRzYXBwOiAidHJ1ZSIsCiAgICAgICAgand0OiB0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZQogICAgICB9CiAgICB9KTsKICAgIHRoaXMuY2hhdF9zb2NrZXQuY29ubmVjdCgpOwogICAgdmFyIGNvbXBhbnlfaWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgIHRoaXMuY2hhbm5lbCA9IHRoaXMuY2hhdF9zb2NrZXQuY2hhbm5lbCgid2hhdHNhcHA6IiArIGNvbXBhbnlfaWQpOwogICAgdGhpcy5jaGFubmVsLmpvaW4oKTsKICAgIHRoaXMuY2hhbm5lbC5vbigibmV3X3doYXRzYXBwX21lc3NhZ2UiLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgIGNvbnNvbGUubG9nKHJlcyk7CgogICAgICBpZiAocmVzLmNvbXBhbnlfaWQgPT09IGNvbXBhbnlfaWQpIHsKICAgICAgICAvLyBpZighcmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJ1c2VyIGJvdCBjb252ZXJzYXRpb24iKQogICAgICAgIHZhciBjb250YWN0X2luZGV4ID0gX3RoaXMuY29udGFjdF9saXN0LmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0ud2hhdHNhcHBfcGhvbmVfbnVtYmVyID09PSByZXMud2hhdHNhcHBfcGhvbmVfbnVtYmVyOwogICAgICAgIH0pOwoKICAgICAgICBpZiAocmVzLkJPVFJlc3BvbnNlID09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gbGV0IGxhdGVzdF9tZXNzYWdlOwogICAgICAgICAgLy8gaWYocmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpewogICAgICAgICAgLy8gICBsZXQgaXNfdGV4dCA9ICByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gaXRlbS50ZXh0ICE9IG51bGwpLAogICAgICAgICAgLy8gICBpc19wcm9kdWN0ID0gcmVzLkJPVFJlc3BvbnNlLmZpbmQoKGl0ZW0pID0+IChpdGVtLnRleHQgPT0gbnVsbCAmJiBpdGVtLnByb2R1Y3RzKSk7CiAgICAgICAgICAvLyAgIGlmKEJvb2xlYW4oaXNfdGV4dCkpIHsKICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9IGlzX3RleHQudGV4dDsKICAgICAgICAgIC8vICAgfSBlbHNlIGlmKEJvb2xlYW4oaXNfcHJvZHVjdCkpIHsKICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9ICJQcm9kdWN0IGJvdCByZXNwb25zZSIKICAgICAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9IG51bGwKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgIC8vICAgbGF0ZXN0X21lc3NhZ2UgPSByZXMud2hhdHNhcHBfbWVzc2FnZTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcywgImVsc2UiLCBjb250YWN0X2luZGV4KQogICAgICAgICAgaWYgKGNvbnRhY3RfaW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSByZXMud2hhdHNhcHBfbWVzc2FnZTsKICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSB0cnVlOwogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0ubmV3X21lc3NhZ2VfY291bnQgPSAxOwogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3QgPSBfdGhpcy5hcnJheV9tb3ZlKF90aGlzLmNvbnRhY3RfbGlzdCwgY29udGFjdF9pbmRleCwgMCk7IC8vIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzLmNoZWNrX2N1cnJlbnRfbnVtYmVyKHJlcykpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwogICAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CgogICAgICAgICAgICBpZiAoX3RoaXMuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzLmhpc3RvcnkucHVzaCh7CiAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogW10sCiAgICAgICAgICAgICAgIlVzZXJRdWVyeSI6IHJlcy53aGF0c2FwcF9tZXNzYWdlLAogICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfZGF0ZSI6IGJvdF9yZXNwb25zZV9kYXRlLAogICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X2RhdGUiOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICJVc2VyUXVlcnlfRGF0ZVRpbWUiOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgbGF0ZXN0X21lc3NhZ2UsCiAgICAgICAgICAgICAgaXNfdGV4dCA9IHJlcy5CT1RSZXNwb25zZS5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLnRleHQgIT0gbnVsbDsKICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGlzX3Byb2R1Y3QgPSByZXMuQk9UUmVzcG9uc2UuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS50ZXh0ID09IG51bGwgJiYgaXRlbS5wcm9kdWN0czsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChCb29sZWFuKGlzX3RleHQpKSB7CiAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gaXNfdGV4dC50ZXh0OwogICAgICAgICAgfSBlbHNlIGlmIChCb29sZWFuKGlzX3Byb2R1Y3QpKSB7CiAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gIlByb2R1Y3QgYm90IHJlc3BvbnNlIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoY29udGFjdF9pbmRleCAhPSAtMSkgewogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IGxhdGVzdF9tZXNzYWdlOwogICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0uaXNfbmV3X25vdGlmaWNhdGlvbiA9IHRydWU7CiAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5uZXdfbWVzc2FnZV9jb3VudCA9IDE7CiAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdCA9IF90aGlzLmFycmF5X21vdmUoX3RoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2luZGV4LCAwKTsgLy8gdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgKICAgICAgICAgIH0KCiAgICAgICAgICA7CgogICAgICAgICAgaWYgKF90aGlzLmNoZWNrX2N1cnJlbnRfbnVtYmVyKHJlcykpIHsKICAgICAgICAgICAgdmFyIF9jdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICBfY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CgogICAgICAgICAgICB2YXIgX2JvdF9yZXNwb25zZV9kYXRlID0gX2N1cnJlbnRfZGF0ZTsKCiAgICAgICAgICAgIGlmIChfdGhpcy5oaXN0b3J5Lm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IF9ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF9ib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXNbImJvdF9yZXNwb25zZV9kYXRlIl0gPSBfYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX3RpbWUiXSA9IF9jdXJyZW50X3RpbWVzdGFtcDsKICAgICAgICAgICAgcmVzWyJ1c2VyX3F1ZXJ5X2RhdGUiXSA9IF9jdXJyZW50X2RhdGU7CiAgICAgICAgICAgIHJlc1sidXNlcl9xdWVyeV90aW1lIl0gPSBfY3VycmVudF90aW1lc3RhbXA7CgogICAgICAgICAgICBfdGhpcy5oaXN0b3J5LnB1c2gocmVzKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIF90aGlzLnNjcm9sbF9kb3duKCk7IC8vIH0gZWxzZSB7CiAgICAgICAgLy8gICBjb25zb2xlLmxvZygicmVhbHRpbWUgY29udmVyc2F0aW9uIikKICAgICAgICAvLyB9CgogICAgICB9CiAgICB9KTsgLy8gfSkKICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaF92YWx1ZShuZXdWYWx1ZSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIC8vIGNvbnNvbGUubG9nKG5ld1ZhbHVlKQogICAgICBpZiAobmV3VmFsdWUgIT0gIiIgJiYgbmV3VmFsdWUubGVuZ3RoID4gMikgewogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgIGlzX2dldF9jb250YWN0czogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgfHwgX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMi5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMi5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2V0X2NvbnRhY3RfbGlzdChmYWxzZSk7CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfbWVzc2FnZV92YWx1ZTogZnVuY3Rpb24gc2VhcmNoX21lc3NhZ2VfdmFsdWUobmV3VmFsdWUpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAobmV3VmFsdWUgIT0gIiIpIHsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczMuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMzLnNlYXJjaGVkX21lc3NhZ2UgPSBbXTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMy5zZWFyY2hlZF9tZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5kYXRhLnNlYXJjaF9yZXN1bHQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZSA9IFtdOwogICAgICB9CiAgICB9LAogICAgLy8gdG9nZ2xlTW9kYWwobmV3VmFsdWUpewogICAgLy8gICBpZihuZXdWYWx1ZSl7CiAgICAvLyAgICAgY29uc29sZS5sb2coIm5ldyB2YWx1ZSIgLCBuZXdWYWx1ZSk7CiAgICAvLyAgICAgdG9nZ2xlRHJvcGRvd24oKTsKICAgIC8vICAgfQogICAgLy8gfSwKICAgIC8vIHRvZ2dsZU1vZGFsOiB7CiAgICAvLyAgICBoYW5kbGVyOiBmdW5jdGlvbih2YWwsIG9sZFZhbCkgewogICAgLy8gICAgICAgaWYodmFsKXsKICAgIC8vICAgICBjb25zb2xlLmxvZygibmV3IHZhbHVlIiAsIHZhbCAsIG9sZFZhbCk7CiAgICAvLyAgICAgdGhpcy50b2dnbGVEcm9wZG93bigpOwogICAgLy8gICB9Ly8gY2FsbCBpdCBpbiB0aGUgY29udGV4dCBvZiB5b3VyIGNvbXBvbmVudCBvYmplY3QKICAgIC8vICAgIH0sCiAgICAvLyAgICBkZWVwOiB0cnVlCiAgICAvLyB9LAogICAgc2VhcmNoX2luX2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gc2VhcmNoX2luX2NvbnRhY3RfbGlzdChuZXdWYWx1ZSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmIChuZXdWYWx1ZSAhPSAiIiAmJiBuZXdWYWx1ZS5sZW5ndGggPiAyKSB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF9zdHJpbmc6IG5ld1ZhbHVlLAogICAgICAgICAgaXNfZ2V0X2FsbF9jb250YWN0czogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM0LmFsbF9jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNC5hbGxfY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczQuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM0LmFsbF9jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICB9CiAgICB9LAogICAgJ3doYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSc6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICBpZiAoQm9vbGVhbihuZXdWYWwpKSB7CiAgICAgICAgICB2YXIgY3VycmVudF90ZW1wbGF0ZSA9IHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0LmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGVtcGxhdGVfaWQgPT0gbmV3VmFsOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdGVtcGxhdGVfaWQgPSBuZXdWYWw7CiAgICAgICAgICB2YXIgdmFyaWFibGVfZGljdCA9IGN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfZGljdDsKICAgICAgICAgIHZhciBpc19wYXJlbnRfdGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19ub3RpZmljYXRpb246IGZhbHNlLAogICAgICAgICAgICBpc19wcmV2aWV3OiB0cnVlLAogICAgICAgICAgICBpc19wYXJlbnRfdGVtcGxhdGU6IGlzX3BhcmVudF90ZW1wbGF0ZSwKICAgICAgICAgICAgdGVtcGxhdGVfaWQ6IHRlbXBsYXRlX2lkLAogICAgICAgICAgICB2YXJpYWJsZV9kaWN0OiB2YXJpYWJsZV9kaWN0CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczUuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM1LndoYXRzYXBwX3RlbXBsYXRlcy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IF90aGlzNS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczUudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZF9tc2cnKSwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiA0MDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyMzMDg1ZDYnLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzNS50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2cnKSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzNS50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZycpLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNS4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTZXR0aW5ncycsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGhpZ2hsaWdodF90ZXh0OiBmdW5jdGlvbiBoaWdobGlnaHRfdGV4dCh1c2VyUXVlcnkpIHsKICAgICAgdmFyIGNsYXNzbmFtZSA9ICIiOwoKICAgICAgaWYgKHVzZXJRdWVyeSA9PT0gdGhpcy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkKSB7CiAgICAgICAgY2xhc3NuYW1lID0gImFkZC1oaWdobGlnaHQiOwogICAgICAgIHJldHVybiBjbGFzc25hbWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBjbGFzc25hbWU7CiAgICB9LAogICAgcmVmcmVzaFBvcG92ZXI6IGZ1bmN0aW9uIHJlZnJlc2hQb3BvdmVyKCkgewogICAgICBpZiAodGhpcy5pc19vcGVuID09PSB1bmRlZmluZWQgfHwgdGhpcy5pc19vcGVuID09PSBmYWxzZSkgewogICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpOyAvLyAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ3Nob3cnKQoKICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoewogICAgICAgICAgaHRtbDogdHJ1ZSwKICAgICAgICAgIHRpdGxlOiAiIi5jb25jYXQodGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfbGVnZW5kJykpLAogICAgICAgICAgY29udGVudDogIjxzcGFuIHN0eWxlPSdjb2xvcjojMjVhZjAyO2ZvbnQtc2l6ZTogbGFyZ2VyOyc+JiN4MjVDRjs8L3NwYW4+IDxzcGFuPiAiLmNvbmNhdCh0aGlzLnRsdCgnd2hhdHNhcHBfd2Vidmlld19jb250YWN0X29uX3doYXRzYXBwJyksICIgPC9zcGFuPiA8YnI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0nY29sb3I6I2ZmNDc0Nztmb250LXNpemU6IGxhcmdlcjsnPiYjeDI1Q0Y7PC9zcGFuPiA8c3Bhbj4gIikuY29uY2F0KHRoaXMudGx0KCd3aGF0c2FwcF93ZWJ2aWV3X2NvbnRhY3Rfbm90X29uX3doYXRzYXBwJyksICI8L3NwYW4+IDxicj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSdjb2xvcjojZmZjMzQ3O2ZvbnQtc2l6ZTogbGFyZ2VyOyc+JiN4MjVDRjs8L3NwYW4+IDxzcGFuPiAiKS5jb25jYXQodGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfY29udGFjdF9kb250X2tub3dfb25fd2hhdHNhcHAnKSwgIjwvc3Bhbj4iKQogICAgICAgIH0pOwogICAgICAgICQoJyNwb3BvdmVyJykucG9wb3Zlcignc2hvdycpOwogICAgICAgIHRoaXMuaXNfb3BlbiA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJyk7CiAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdoaWRlJyk7CiAgICAgICAgdGhpcy5pc19vcGVuID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjbG9zZU1vZGVsOiBmdW5jdGlvbiBjbG9zZU1vZGVsKGUpIHsKICAgICAgLy9jb25zb2xlLmxvZyhlLnRhcmdldC5jbGFzc0xpc3QgLCAiIGNhbGxpbmcgbW9kYWwiKQogICAgICBpZiAoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbGVnZW5kX3doYXRzYXBwJykpIHsKICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKTsKICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2hpZGUnKTsKICAgICAgICB0aGlzLmlzX29wZW4gPSBmYWxzZTsKICAgICAgfSAvLyBpZighZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkcm9wZG93bk1lbnVCdXR0b25PbmUnKSl7CiAgICAgIC8vIH0KCgogICAgICBpZiAoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYnRuIikgJiYgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIpICYmICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImN1c3RvbWVyLW5hbWUiKSAmJiAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJidG4iKSkgewogICAgICAgIC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIsImJlZm9yZSBjbG9zaW5nIG1vZGFsIikKICAgICAgICB2YXIgZHJvcGRvd25QYXJlbnQyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGFyZW50MicpOwogICAgICAgIHZhciBkcm9wZG93bk1lbnUyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudTInKTsKICAgICAgICB2YXIgZHJvcGRvd25NZW51QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbjInKTsKICAgICAgICB2YXIgZHJvcGRvd25QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQnKTsKICAgICAgICB2YXIgZHJvcGRvd25NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudScpOwogICAgICAgIHZhciBkcm9wZG93bk1lbnVCdXR0b25PbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uT25lJyk7CgogICAgICAgIGlmIChkcm9wZG93blBhcmVudDIgJiYgZHJvcGRvd25NZW51MiAmJiBkcm9wZG93bk1lbnVCdXR0b24gJiYgdGhpcy50b2dnbGVNb2RhbDIpIHsKICAgICAgICAgIGRyb3Bkb3duUGFyZW50Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICBkcm9wZG93bk1lbnUyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICAgICAgZHJvcGRvd25NZW51Mi5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpOwogICAgICAgICAgdGhpcy50b2dnbGVNb2RhbDIgPSBmYWxzZTsgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiAsICJhZnRlciBjbG9zaW5nIG1vZGFsIC0tLS0tLS0tIikKICAgICAgICB9CgogICAgICAgIGlmIChkcm9wZG93bk1lbnUgJiYgZHJvcGRvd25QYXJlbnQgJiYgZHJvcGRvd25NZW51QnV0dG9uT25lICYmIHRoaXMudG9nZ2xlTW9kYWwpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coIi0tLSIgLCAiaW5zaWRlIGRyb3Bkb3duIikKICAgICAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICBkcm9wZG93blBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICBkcm9wZG93bk1lbnVCdXR0b25PbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgICAgIGRyb3Bkb3duTWVudS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpOwogICAgICAgICAgdGhpcy50b2dnbGVNb2RhbCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5TZWFyY2hEaXY6IGZ1bmN0aW9uIG9wZW5TZWFyY2hEaXYoKSB7CiAgICAgIHRoaXMuaXNfc2VhcmNoX2Rpdl9vcGVuID0gdHJ1ZTsKICAgICAgdmFyIGNoYXRfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRfZGl2Jyk7CiAgICAgIGNoYXRfZGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbC1zbS04Jyk7CiAgICAgIGNoYXRfZGl2LmNsYXNzTGlzdC5hZGQoJ2NvbC1zbS00Jyk7CiAgICAgIHZhciBzZWFyY2hfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaF9kaXYnKTsKICAgICAgc2VhcmNoX2Rpdi5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICB2YXIgYm90X21zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNtc2ctZGl2Iik7CiAgICAgIGJvdF9tc2cuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgicmVzcG9uc2l2ZS13aWR0aCIpOwogICAgICB9KTsKICAgICAgdmFyIHByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIik7CiAgICAgIHByZXZpZXdfYnRuLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoImNvbC1zbS0xMSIpOwogICAgICB9KTsKICAgICAgdmFyIGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIik7CiAgICAgIGJvdF9jYXJkLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoImNvbC03Iik7CiAgICAgIH0pOwogICAgICB2YXIgZW1vamlfZmlsZXNoYXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vtb2ppX2ZpbGVzaGFyZScpOwoKICAgICAgaWYgKGVtb2ppX2ZpbGVzaGFyZSkgewogICAgICAgIGVtb2ppX2ZpbGVzaGFyZS5zdHlsZS53aWR0aCA9ICIxOSUiOwogICAgICB9CiAgICB9LAogICAgY2xvc2VTZWFyY2hEaXY6IGZ1bmN0aW9uIGNsb3NlU2VhcmNoRGl2KCkgewogICAgICB0aGlzLmlzX3NlYXJjaF9kaXZfb3BlbiA9IGZhbHNlOwogICAgICB2YXIgY2hhdF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdF9kaXYnKTsKICAgICAgY2hhdF9kaXYuY2xhc3NMaXN0LmFkZCgnY29sLXNtLTgnKTsKICAgICAgY2hhdF9kaXYuY2xhc3NMaXN0LnJlbW92ZSgnY29sLXNtLTQnKTsKICAgICAgdmFyIHNlYXJjaF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoX2RpdicpOwogICAgICBzZWFyY2hfZGl2LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZSA9IFtdOwogICAgICB0aGlzLnNlYXJjaF9tZXNzYWdlX3ZhbHVlID0gIiI7CiAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCA9IG51bGw7CiAgICAgIHZhciBib3RfbXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI21zZy1kaXYiKTsKICAgICAgYm90X21zZy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJyZXNwb25zaXZlLXdpZHRoIik7CiAgICAgIH0pOwogICAgICB2YXIgcHJldmlld19idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjcHJldmlldy1idG4iKTsKICAgICAgcHJldmlld19idG4uZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgiY29sLXNtLTExIik7CiAgICAgIH0pOwogICAgICB2YXIgYm90X2NhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuYm90LXJlc3AiKTsKICAgICAgYm90X2NhcmQuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCItLS1ydW4tLS0iKQogICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgiY29sLTciKTsKICAgICAgfSk7CiAgICAgIHZhciBlbW9qaV9maWxlc2hhcmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1vamlfZmlsZXNoYXJlJyk7CgogICAgICBpZiAoZW1vamlfZmlsZXNoYXJlKSB7CiAgICAgICAgZW1vamlfZmlsZXNoYXJlLnN0eWxlLndpZHRoID0gIjglIjsKICAgICAgfQogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgdGhpcy5oaXN0b3J5ID0gW10sIHRoaXMucGhvbmVubyA9IG51bGw7CiAgICAgIHRoaXMuY3VzdG9tZXJfbmFtZSA9ICIiOwogICAgICB0aGlzLmNoYXRfZGV0YWlscyA9IFtdOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vID0gMTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkID0gW107CiAgICAgIHRoaXMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBudWxsOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UgPSAxMDsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9OwogICAgfSwKICAgIHJlc2V0X2N1cnNvcl9wb3NpdGlvbjogZnVuY3Rpb24gcmVzZXRfY3Vyc29yX3Bvc2l0aW9uKCkgewogICAgICB0aGlzLm9sZEN1cnNvclBvc2l0aW9uID0gbnVsbDsKICAgIH0sCiAgICB0b2dnbGVFbW9qaVBpY2tlcjogZnVuY3Rpb24gdG9nZ2xlRW1vamlQaWNrZXIoKSB7CiAgICAgIHRoaXMuc2hvd0Vtb2ppUGlja2VyID0gIXRoaXMuc2hvd0Vtb2ppUGlja2VyOwogICAgfSwKICAgIGFwcGVuZF9vbl9jaGF0OiBmdW5jdGlvbiBhcHBlbmRfb25fY2hhdChlbW9qaSwgaWQpIHsKICAgICAgdmFyIHRleHRhcmVhID0gdGhpcy4kcmVmcy50ZXh0YXJlYTsKICAgICAgdmFyIGNoYXRfdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2hhdHNhcHBfdGV4dF9pbnB1dF9ib3gnKS52YWx1ZTsKICAgICAgdmFyIGN1cnNvclBvcyA9IHRleHRhcmVhLnNlbGVjdGlvbkVuZDsgLy8gdmFyIGN1cnNvclBvc2l0aW9uID0gdGV4dGFyZWEuc2VsZWN0aW9uRW5kCiAgICAgIC8vIGxldCB2ID0gJCgiIyIgKyBpZCkudmFsKCk7CgogICAgICBpZiAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbikgewogICAgICAgIHZhciB0ZXh0QmVmb3JlID0gY2hhdF92YWx1ZS5zdWJzdHJpbmcoMCwgdGhpcy5vbGRDdXJzb3JQb3NpdGlvbik7CiAgICAgICAgdmFyIHRleHRBZnRlciA9IGNoYXRfdmFsdWUuc3Vic3RyaW5nKHRoaXMub2xkQ3Vyc29yUG9zaXRpb24sIGNoYXRfdmFsdWUubGVuZ3RoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IGNoYXRfdmFsdWUuc3Vic3RyaW5nKDAsIGN1cnNvclBvcyk7CiAgICAgICAgdmFyIHRleHRBZnRlciA9IGNoYXRfdmFsdWUuc3Vic3RyaW5nKGN1cnNvclBvcywgY2hhdF92YWx1ZS5sZW5ndGgpOwogICAgICB9CgogICAgICB0aGlzLm1lc3NhZ2VfdG9fc2VuZCA9IHRleHRCZWZvcmUgKyBlbW9qaSArIHRleHRBZnRlcjsKICAgICAgIXRoaXMub2xkQ3Vyc29yUG9zaXRpb24gPyB0aGlzLm9sZEN1cnNvclBvc2l0aW9uID0gY3Vyc29yUG9zICsgMiA6IHRoaXMub2xkQ3Vyc29yUG9zaXRpb24gPSB0aGlzLm9sZEN1cnNvclBvc2l0aW9uICsgMjsKICAgIH0sCiAgICBnZXRfaGlzdG9yeV9kYXRhOiBmdW5jdGlvbiBnZXRfaGlzdG9yeV9kYXRhKHdoYXRzYXBwX25vLCB1c2VyX25hbWUsIGNvbnRhY3RfaW5kZXgsIGNvbnRhY3QpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZygicnVubm4iKQogICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5jdXN0b21lcl9uYW1lID0gdGhpcy5nZXRfY29udGFjdF9kaXNwbGF5X25hbWUoY29udGFjdCk7IC8vIHRoaXMuY3VzdG9tZXJfbmFtZSA9IHVzZXJfbmFtZTsKCiAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciA9IHdoYXRzYXBwX25vOwogICAgICB0aGlzLnNob3dfc2VuZF9tZXNzYWdlID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gY29udGFjdF9pbmRleDsKICAgICAgdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0uaXNfbmV3X25vdGlmaWNhdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSBmYWxzZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgZ2V0X2J5X3doYXRzYXBwX3Bob25lX251bWJlcjogdHJ1ZSwKICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogd2hhdHNhcHBfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgIHBhZ2Vfbm86IDEKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNi5zaG93X3NlbmRfbWVzc2FnZSA9IHRydWU7CiAgICAgICAgX3RoaXM2LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczYuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IHRydWU7CiAgICAgICAgICBfdGhpczYubmV3X2NvbnZfY29udGFjdF9kYXRhID0gY29udGFjdDsKICAgICAgICAgIF90aGlzNi5waG9uZW5vID0gd2hhdHNhcHBfbm87CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczYuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzNi5oaXN0b3J5ID0gX3RoaXM2LmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0X2hpc3RvcnkpOwogICAgICAgICAgX3RoaXM2LnBob25lbm8gPSByZXNwb25zZS5kYXRhLmRhdGEud2hhdHNhcHBfcGhvbmVfbnVtYmVyIHx8IHdoYXRzYXBwX25vOyAvLyBjb25zb2xlLmxvZyh0aGlzLnBob25lbm8sIHRoaXMuY29udGFjdF9saXN0KTsKCiAgICAgICAgICB2YXIgY29udGFjdF9saXN0X2luZGV4ID0gX3RoaXM2LmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0ud2hhdHNhcHBfcGhvbmVfbnVtYmVyID09IF90aGlzNi5waG9uZW5vOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGNvbnRhY3RfbGlzdF9pbmRleCA+PSAxKSB7CiAgICAgICAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2xpc3RfaW5kZXgsIDApOwogICAgICAgICAgICBfdGhpczYuY3VycmVudF9jb250YWN0X2luZGV4ID0gY29udGFjdF9saXN0X2luZGV4OwogICAgICAgICAgICBfdGhpczYuY3VycmVudF9jb250YWN0X251bWJlciA9IF90aGlzNi5waG9uZW5vOyAvLyB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2xpc3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM2LmN1cnJlbnRfcGFnZV9ubyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlOwogICAgICAgICAgX3RoaXM2LmxhdGVzdF9wYWdlX25vID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2U7CiAgICAgICAgICBfdGhpczYubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT09IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSB7CiAgICAgICAgICAgIF90aGlzNi50b3RhbF9wYWdlc19sb2FkZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImVsc2UiKQogICAgICAgICAgICBfdGhpczYudG90YWxfcGFnZXNfbG9hZGVkID0gZmFsc2U7CiAgICAgICAgICB9IC8vICBjb25zb2xlLmxvZyh0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCkKCgogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzNi5zY3JvbGxfZG93bigpOwoKICAgICAgICAgICAgX3RoaXM2LmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXM2Lm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKCiAgICAgICAgICAgIF90aGlzNi5jaGF0U2Nyb2xsTWVzc2FnZXModHJ1ZSk7CgogICAgICAgICAgICBfdGhpczYuc2Nyb2xsX3RvcF9jYWxsZWQgPSBmYWxzZTsKICAgICAgICAgIH0sIDQwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyBnZXRfc2VhcmNoZWRfY2hhdF9pbnRlcm1lZGlhdGVfZnVuY3Rpb24odGltZSl7CiAgICAvLyAgIGNvbnNvbGUubG9nKHRpbWUgLCB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIpCiAgICAvLyAgIHRoaXMuZ2V0X3NlYXJjaGVkX2NoYXRfZGF0YSggdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyICx0aW1lKQogICAgLy8gfSwKICAgIC8vIGhpZ2hsaWdodF90ZXh0KCl7CiAgICAvLyAgICAgICAgdGhpcy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkID0gdGhpcy5zZWFyY2hlZF9tZXNzYWdlW2luZGV4XS5zZWFyY2hfdGV4dAogICAgLy8gICAgICAgICAgIGxldCB0ZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3RleHQiKQogICAgLy8gICAgICAgICAgIHRleHQuZm9yRWFjaChlbGVtPT57CiAgICAvLyAgICAgICAgICAgICBpZihlbGVtLnRleHRDb250ZW50LnRyaW0oKSA9PT0gc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZC50cmltKCkpewogICAgLy8gICAgICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2FkZF9oaWdobGlnaHQnKQogICAgLy8gICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ290Y2hhIGluc2lkZSBpZiIgLCBlbGVtLmNsYXNzTGlzdCAsIHNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQpCiAgICAvLyAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgfSk7CiAgICAvLyB9LAogICAgZ2V0X3NlYXJjaGVkX2NoYXRfZGF0YTogZnVuY3Rpb24gZ2V0X3NlYXJjaGVkX2NoYXRfZGF0YSh3aGF0c2FwcF9ubywgdGltZSwgaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZygiaW5kZXgiLGluZGV4KQogICAgICAvLyB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7IC8vIHRoaXMuY3VzdG9tZXJfbmFtZSA9IHRoaXMuZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lKGNvbnRhY3QpOwogICAgICAvLyAvLyB0aGlzLmN1c3RvbWVyX25hbWUgPSB1c2VyX25hbWU7CiAgICAgIC8vIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciA9IHdoYXRzYXBwX25vOwoKICAgICAgdGhpcy5zaG93X3NlbmRfbWVzc2FnZSA9IGZhbHNlOyAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IGNvbnRhY3RfaW5kZXg7CiAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSBmYWxzZTsKICAgICAgLy8gdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB3aGF0c2FwcF9ubywKICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgaXNfZ2V0X3NlYXJjaDogdHJ1ZSwKICAgICAgICBtZXNzYWdlX2RhdGV0aW1lOiB0aW1lCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygicmFubm4iKTsKICAgICAgICBfdGhpczcuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgX3RoaXM3LnNob3dfc2VuZF9tZXNzYWdlID0gdHJ1ZTsKCiAgICAgICAgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgcmV0dXJuOyAvLyAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IHRydWU7CiAgICAgICAgICAvLyAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhID0gY29udGFjdDsKICAgICAgICAgIC8vIHRoaXMucGhvbmVubyA9IHdoYXRzYXBwX25vOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmhpc3RvcnkgLCAiYmVmb3JlIikKICAgICAgICAgIC8vIHRoaXMuaGlzdG9yeSA9ICIiOwogICAgICAgICAgLy8gZGVidWdnZXI7CiAgICAgICAgICBfdGhpczcuaGlzdG9yeSA9IF90aGlzNy5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmRhdGEuY2hhdF9oaXN0b3J5KTsKICAgICAgICAgIF90aGlzNy5jdXJyZW50X3BhZ2Vfbm8gPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZTsKICAgICAgICAgIF90aGlzNy5sYXRlc3RfcGFnZV9ubyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlOyAvLyBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRfcGFnZV9ubyAsICJjdXJyZW50IHNldCIpCgogICAgICAgICAgX3RoaXM3Lm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkID0gW3Jlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlXTsgLy8gdGhpcy5waG9uZW5vID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Bob25lX251bWJlciB8fCB3aGF0c2FwcF9ubzsKICAgICAgICAgIC8vIC8vIGNvbnNvbGUubG9nKHRoaXMucGhvbmVubywgdGhpcy5jb250YWN0X2xpc3QpOwogICAgICAgICAgLy8gbGV0IGNvbnRhY3RfbGlzdF9pbmRleCA9IHRoaXMuY29udGFjdF9saXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW0ud2hhdHNhcHBfcGhvbmVfbnVtYmVyID09IHRoaXMucGhvbmVubyk7CiAgICAgICAgICAvLyBpZihjb250YWN0X2xpc3RfaW5kZXggPj0gMSl7CiAgICAgICAgICAvLyAgIC8vIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2xpc3RfaW5kZXgsIDApOwogICAgICAgICAgLy8gICB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9Y29udGFjdF9saXN0X2luZGV4OwogICAgICAgICAgLy8gICB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB0aGlzLnBob25lbm87CiAgICAgICAgICAvLyAgIC8vIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfbGlzdF9pbmRleF0uaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgIC8vIH0KCiAgICAgICAgICBfdGhpczcubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgIF90aGlzNy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgICBfdGhpczcuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICAgICAgX3RoaXM3Lm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSB0cnVlOwoKICAgICAgICAgIF90aGlzNy5jaGF0U2Nyb2xsTWVzc2FnZXMoZmFsc2UpOwoKICAgICAgICAgIF90aGlzNy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkID0gX3RoaXM3LnNlYXJjaGVkX21lc3NhZ2VbaW5kZXhdLnNlYXJjaF90ZXh0OyAvLyAgY29uc29sZS5sb2codGhpcy5zZWFyY2hlZF9tZXNzYWdlW2luZGV4XSAsICJpbmRleCIgLCBpbmRleCk7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09PSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaWYiKQogICAgICAgICAgICBfdGhpczcudG90YWxfcGFnZXNfbG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXM3Lm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9IHRydWU7CiAgICAgICAgICAgIF90aGlzNy5zY3JvbGxfdG9wX2NhbGxlZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZWxzZSIpCiAgICAgICAgICAgIF90aGlzNy50b3RhbF9wYWdlc19sb2FkZWQgPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXM3LnNjcm9sbF90b3BfY2FsbGVkID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzNy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIGxldCB0ZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3RleHQiKQogICAgICAgICAgICAvLyB0ZXh0LmZvckVhY2goZWxlbT0+ewogICAgICAgICAgICAvLyAgIGlmKGVsZW0udGV4dENvbnRlbnQudHJpbSgpID09PSB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQudHJpbSgpKXsKICAgICAgICAgICAgLy8gICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnYWRkX2hpZ2hsaWdodCcpCiAgICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZygiZ290Y2hhIGluc2lkZSBpZiIgLCBlbGVtLmNsYXNzTGlzdCAsIHRoaXMuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCkKICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRfbXNnID0gX3RoaXM3LnNlYXJjaGVkX21lc3NhZ2VbaW5kZXhdLmRhdGVfdGltZTsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkX2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdGVkX21zZyk7CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRfZGl2KSB7CiAgICAgICAgICAgICAgc2VsZWN0ZWRfZGl2LnNjcm9sbEludG9WaWV3KHsKICAgICAgICAgICAgICAgIGJlaGF2aW9yOiAic21vb3RoIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vICBjb25zb2xlLmxvZyhzZWxlY3RlZF9kaXYgLCBzZWxlY3RlZF9tc2cgKTsKCiAgICAgICAgICB9LCA0MDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczcuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5sb2coZSwgJ2VlZWVlJyk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0X2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gZ2V0X2NvbnRhY3RfbGlzdChlbmFibGVfYm90X3Jlc3BvbnNlcykgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgaXNfZ2V0X2NvbnRhY3RzOiB0cnVlLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGVuYWJsZV9ib3RfcmVzcG9uc2VfYWxsOiBlbmFibGVfYm90X3Jlc3BvbnNlcwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM4LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSB8fCBfdGhpczguYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOC5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM4LmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzOC5zaG93X3NwaW5uZXIgPSBmYWxzZTsgLy8gdGhpcy5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmNvbnRhY3RzOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzOC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzY3JvbGxfZG93bjogZnVuY3Rpb24gc2Nyb2xsX2Rvd24oKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCItLS0tc2Nyb2xsbGwiKTsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tZXNzYWdlLXRhYmxlLXNjcm9sbCIpOwoKICAgICAgICBpZiAoQm9vbGVhbihjb250YWluZXIuc2Nyb2xsSGVpZ2h0KSkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJoZXJlIHNjciIpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggY29udGFpbmVyLnNjcm9sbFRvcCAsICBjb250YWluZXIuc2Nyb2xsSGVpZ2h0KTsKICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQgLSA1MDA7CiAgICAgICAgICB9LCAxMDApOyAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgc2Nyb2xsX3RvcDogZnVuY3Rpb24gc2Nyb2xsX3RvcCgpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tZXNzYWdlLXRhYmxlLXNjcm9sbCIpOwoKICAgICAgICBpZiAoQm9vbGVhbihjb250YWluZXIuc2Nyb2xsSGVpZ2h0KSkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0ICogMC4wMTU7CiAgICAgICAgICB9LCAxMDApOyAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgc2Nyb2xsX21pZGRsZTogZnVuY3Rpb24gc2Nyb2xsX21pZGRsZSgpIHsKICAgICAgLy8gY29uc29sZS5sb2coIm1pZGRsZSBydW5uaW5nIikKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tZXNzYWdlLXRhYmxlLXNjcm9sbCIpOwoKICAgICAgICBpZiAoQm9vbGVhbihjb250YWluZXIuc2Nyb2xsSGVpZ2h0KSkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0ICogMC4yNTsKICAgICAgICAgIH0sIDEwMCk7IC8vIHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwgMTAwKTsKICAgIH0sCiAgICBzY3JvbGxfZG93bl9lZmZlY3Q6IGZ1bmN0aW9uIHNjcm9sbF9kb3duX2VmZmVjdCgpIHsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tZXNzYWdlLXRhYmxlLXNjcm9sbCIpOyAvLyBjb25zb2xlLmxvZyhjb250YWluZXIpOwoKICAgICAgaWYgKEJvb2xlYW4oY29udGFpbmVyKSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IDEwOwogICAgICAgIH0sIDApOyAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIHByb2R1Y3RfdmFyaWF0aW9uOiBmdW5jdGlvbiBwcm9kdWN0X3ZhcmlhdGlvbihwcm9kdWN0c19saXN0KSB7CiAgICAgIHZhciBuZXdfcHJvZHVjdF9saXN0ID0gW107CgogICAgICBmb3IgKHZhciBpIGluIHByb2R1Y3RzX2xpc3QpIHsKICAgICAgICB2YXIgY29tcG9uZW50cyA9IHByb2R1Y3RzX2xpc3RbaV0udGVtcGxhdGUuY29tcG9uZW50czsKICAgICAgICB2YXIgdGVtcCA9IHt9OwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgaiBpbiBjb21wb25lbnRzKSB7CiAgICAgICAgICAgIGlmIChqID09IDApIHsKICAgICAgICAgICAgICB0ZW1wWyJpbWdfdXJsIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMF0uaW1hZ2UubGluazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGogPT0gMSkgewogICAgICAgICAgICAgIHRlbXBbInRpdGxlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMF0udGV4dDsKCiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgdGVtcFsicHJpY2UiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1sxXS50ZXh0OwogICAgICAgICAgICAgICAgdGVtcFsidmFyaWF0aW9uIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMubGVuZ3RoID09IDMpIHsKICAgICAgICAgICAgICAgIHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7CiAgICAgICAgICAgICAgICB0ZW1wWyJwcmljZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzJdLnRleHQ7CiAgICAgICAgICAgICAgfSAvLyBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMubGVuZ3RoID09IDMgPyB0ZW1wWyJ2YXJpYXRpb24iXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1sxXS50ZXh0OyB0ZW1wWyJwcmljZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ6IG51bGw7CgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaiA9PSAyKSB7CiAgICAgICAgICAgICAgdGVtcFsidXJsIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMF0udGV4dDsKICAgICAgICAgICAgICB0ZW1wWyJ0eXBlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMudHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fQoKICAgICAgICBuZXdfcHJvZHVjdF9saXN0LnB1c2godGVtcCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXdfcHJvZHVjdF9saXN0OwogICAgfSwKICAgIGNoZWNrX2ltYWdlX3R5cGU6IGZ1bmN0aW9uIGNoZWNrX2ltYWdlX3R5cGUoaW1hZ2UpIHsKICAgICAgaWYgKHR5cGVvZiBpbWFnZSA9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBpbWFnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaW1hZ2UgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGltYWdlLnNyYzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHRyaW1fY2FyZF9kZXNjcmlwdGlvbjogZnVuY3Rpb24gdHJpbV9jYXJkX2Rlc2NyaXB0aW9uKHRleHQpIHsKICAgICAgaWYgKEJvb2xlYW4odGV4dCkpIHsKICAgICAgICBpZiAodGV4dC5sZW5ndGggPiAxMDApIHsKICAgICAgICAgIHZhciBzdHJpbmdfdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIDgwKSArICIuLi4iOwogICAgICAgICAgcmV0dXJuIHN0cmluZ190ZXh0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICAgIH0KICAgIH0sCiAgICBsYXRlc3RfYm90X3RleHQ6IGZ1bmN0aW9uIGxhdGVzdF9ib3RfdGV4dCh0ZXh0KSB7CiAgICAgIGlmICghQm9vbGVhbih0ZXh0KSkgewogICAgICAgIHJldHVybiAiQ3VzdG9tIGJvdCBSZXNwb25zZSI7CiAgICAgIH0KCiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDM1KSB7CiAgICAgICAgcmV0dXJuICIiLmNvbmNhdCh0ZXh0LnN1YnN0cmluZygwLCAzNSksICIuLi4iKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRleHQ7CiAgICB9LAogICAgc2VhcmNoX2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gc2VhcmNoX2NvbnRhY3RfbGlzdCgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWFyY2hfdmFsdWUgPT0gIiIpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb250YWN0X2xpc3Q7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG5ld192YWwgPSB0aGlzLnNlYXJjaF92YWx1ZTsKCiAgICAgICAgaWYgKG5ld192YWwgIT0gdGhpcy5zZWFyY2hfdmFsdWUpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VhcmNoX3ZhbHVlKTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX3N0cmluZzogdGhpcy5zZWFyY2hfdmFsdWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzOS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczkuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczkuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczkuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczkuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFjdF9saXN0OwogICAgICB9CiAgICB9LAogICAgY2hhdFNjcm9sbE1lc3NhZ2VzOiBmdW5jdGlvbiBjaGF0U2Nyb2xsTWVzc2FnZXMoc2Nyb2xsX2Rvd24pIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCk7CiAgICAgIGlmICh0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHRoaXMuaXNfc2VhcmNoX2Rpdl9vcGVuKSB7CiAgICAgICAgICB2YXIgYm90X21zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNtc2ctZGl2Iik7CiAgICAgICAgICBib3RfbXNnLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJyZXNwb25zaXZlLXdpZHRoIik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBwcmV2aWV3X2J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNwcmV2aWV3LWJ0biIpOwogICAgICAgICAgcHJldmlld19idG4uZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoImNvbC1zbS0xMSIpOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgYm90X2NhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuYm90LXJlc3AiKTsKICAgICAgICAgIGJvdF9jYXJkLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtNyIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBfYm90X21zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNtc2ctZGl2Iik7CgogICAgICAgICAgX2JvdF9tc2cuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoInJlc3BvbnNpdmUtd2lkdGgiKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBfcHJldmlld19idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjcHJldmlldy1idG4iKTsKCiAgICAgICAgICBfcHJldmlld19idG4uZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoImNvbC1zbS0xMSIpOwogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIF9ib3RfY2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5ib3QtcmVzcCIpOwoKICAgICAgICAgIF9ib3RfY2FyZC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgiY29sLTciKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIm1lc3NhZ2UtdGFibGUtc2Nyb2xsIilbMF0uc2Nyb2xsVG9wOwogICAgICAgIHZhciBjb250YWluZXJfZGl2X3Njcm9sbF9oZWlnaHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJtZXNzYWdlLXRhYmxlLXNjcm9sbCIpWzBdLnNjcm9sbEhlaWdodCAtIDQ5MzsgLy8gY29uc29sZS5sb2codGhpcy5zY3JvbGxfdG9wX2NhbGxlZCAsICJ0b3AiKTsKICAgICAgICAvLyAgIGNvbnNvbGUubG9nKHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgLCAicGFnaW5hdGVkIGNhbGwgdmFyICIpCiAgICAgICAgLy8gY29uc29sZS5sb2coY29udGFpbmVyX2Rpdl9zY3JvbGxfdG9wIDwgMjAgLCB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPT09IHRydWUgLCAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAsICF0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCAsICJjaGVjayBmb3IgdXAiKQogICAgICAgIC8vICBjb25zb2xlLmxvZyhjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPiBjb250YWluZXJfZGl2X3Njcm9sbF9oZWlnaHQgLCB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9PT0gdHJ1ZSAsICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICwgdGhpcy5jdXJyZW50X3BhZ2Vfbm8gPiAxICwgImNoZWNrIGZvciBkb3duIikKCiAgICAgICAgaWYgKGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA8IDIwICYmIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9PT0gdHJ1ZSAmJiAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAmJiAhdGhpcy50b3RhbF9wYWdlc19sb2FkZWQpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCBwYWdpbmF0ZWQiLCB0aGlzLmN1cnJlbnRfcGFnZV9ubykKICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5jdXJyZW50X3BhZ2Vfbm8gKyAxCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgX3RoaXMxMC5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMTAuaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgaWYgKCFfdGhpczEwLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLmluY2x1ZGVzKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSkgewogICAgICAgICAgICAgICAgdmFyIG5ld19kYXRhID0gX3RoaXMxMC5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmRhdGEuY2hhdF9oaXN0b3J5KTsKCiAgICAgICAgICAgICAgICBfdGhpczEwLmhpc3RvcnkgPSBuZXdfZGF0YS5jb25jYXQoX3RoaXMxMC5oaXN0b3J5KTsKCiAgICAgICAgICAgICAgICBfdGhpczEwLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLnB1c2gocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2UpOyAvLyBjb25zb2xlLmxvZyh0aGlzLmhpc3RvcnkpOwoKCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT09IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTAudG90YWxfcGFnZXNfbG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTAudG90YWxfcGFnZXNfbG9hZGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMxMC5jdXJyZW50X3BhZ2Vfbm8gKz0gMTsKCiAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsX2Rvd24gPT0gdHJ1ZSB8fCBfdHlwZW9mKHNjcm9sbF9kb3duKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zY3JvbGxfbWlkZGxlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2Ugey8vIHRoaXMuc2Nyb2xsX2Rvd25fZWZmZWN0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkge30gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczEwLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPiBjb250YWluZXJfZGl2X3Njcm9sbF9oZWlnaHQgJiYgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX2Rvd24gPT09IHRydWUgJiYgIXRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgJiYgdGhpcy5sYXRlc3RfcGFnZV9ubyA+IDEpIHsKICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5sYXRlc3RfcGFnZV9ubyAtIDEKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICBfdGhpczEwLnNjcm9sbF9zcGlubmVyX2NoYXQgPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXMxMC5pc19wYWdpbmF0ZWRfY2FsbCA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBpZiAoIV90aGlzMTAubWVzc2FnZV9wYWdpbmF0aW9uLnBhZ2VfcmVjb3JkX2ZldGNoZWQuaW5jbHVkZXMocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2UpKSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3X2RhdGEgPSBfdGhpczEwLmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0X2hpc3RvcnkpOyAvLyB0aGlzLmhpc3RvcnkgPSBuZXdfZGF0YS5jb25jYXQodGhpcy5oaXN0b3J5KTsKCgogICAgICAgICAgICAgICAgX3RoaXMxMC5oaXN0b3J5ID0gX3RoaXMxMC5oaXN0b3J5LmNvbmNhdChuZXdfZGF0YSk7CgogICAgICAgICAgICAgICAgX3RoaXMxMC5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5wdXNoKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKTsKCiAgICAgICAgICAgICAgICBfdGhpczEwLmxhdGVzdF9wYWdlX25vID0gX3RoaXMxMC5sYXRlc3RfcGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLSIgLCB0aGlzLnNjcm9sbF90b3BfY2FsbGVkKQogICAgICAgICAgICAgICAgICAvLyAgICBpZih0aGlzLnNjcm9sbF90b3BfY2FsbGVkKXsKICAgICAgICAgICAgICAgICAgLy8gICB0aGlzLnNjcm9sbF90b3AoKTsKICAgICAgICAgICAgICAgICAgLy8gfWVsc2V7CiAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGxfZG93biA9PSB0cnVlIHx8IF90eXBlb2Yoc2Nyb2xsX2Rvd24pID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkb3duIikKICAgICAgICAgICAgICAgICAgICBfdGhpczEwLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7fSAvLyB0aGlzLnNjcm9sbF9kb3duX2VmZmVjdCgpCiAgICAgICAgICAgICAgICAgIC8vIH0KCgogICAgICAgICAgICAgICAgICBfdGhpczEwLnNjcm9sbF90b3BfY2FsbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7fSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMTAuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzaG93X3Byb2ZpbGVfc2V0dXA6IGZ1bmN0aW9uIHNob3dfcHJvZmlsZV9zZXR1cCgpIHsKICAgICAgdGhpcy5pc19wcm9maWxlX3NldHVwID0gIXRoaXMuaXNfcHJvZmlsZV9zZXR1cDsKICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICB9LAogICAgc2hvd19hbGxfY29udGFjdHM6IGZ1bmN0aW9uIHNob3dfYWxsX2NvbnRhY3RzKCkgewogICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKTsKICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdoaWRlJyk7CiAgICAgIHRoaXMuaXNfb3BlbiA9IGZhbHNlOwogICAgICB0aGlzLmlzX3Byb2ZpbGVfc2V0dXAgPSAhdGhpcy5pc19wcm9maWxlX3NldHVwOwogICAgICB0aGlzLmlzX2NvbnRhY3RfbGlzdCA9ICF0aGlzLmlzX2NvbnRhY3RfbGlzdDsKICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgfSwKICAgIHRvZ2dsZURyb3Bkb3duOiBmdW5jdGlvbiB0b2dnbGVEcm9wZG93bigpIHsKICAgICAgdmFyIGRyb3Bkb3duUGFyZW50MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudDInKTsKICAgICAgdmFyIGRyb3Bkb3duTWVudTIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51MicpOwogICAgICB2YXIgZHJvcGRvd25NZW51QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbjInKTsKICAgICAgZHJvcGRvd25QYXJlbnQyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICBkcm9wZG93bk1lbnUyLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7Jyk7CiAgICAgIHRoaXMudG9nZ2xlTW9kYWwyID0gZmFsc2U7CiAgICAgIHZhciBkcm9wZG93blBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudCcpOwogICAgICB2YXIgZHJvcGRvd25NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudScpOwogICAgICB2YXIgZHJvcGRvd25NZW51QnV0dG9uT25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbk9uZScpOwoKICAgICAgaWYgKHRoaXMudG9nZ2xlTW9kYWwpIHsKICAgICAgICBkcm9wZG93blBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICBkcm9wZG93bk1lbnVCdXR0b25PbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgICBkcm9wZG93bk1lbnUucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkcm9wZG93blBhcmVudC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICBkcm9wZG93bk1lbnVCdXR0b25PbmUuc2V0QXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkJywgJ3RydWUnKTsKICAgICAgICBkcm9wZG93bk1lbnUuc2V0QXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgfQoKICAgICAgdGhpcy50b2dnbGVNb2RhbCA9ICF0aGlzLnRvZ2dsZU1vZGFsOwogICAgfSwKICAgIHRvZ2dsZVRlbXBsYXRlOiBmdW5jdGlvbiB0b2dnbGVUZW1wbGF0ZSgpIHsKICAgICAgdmFyIGRyb3Bkb3duUGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGFyZW50Jyk7CiAgICAgIHZhciBkcm9wZG93bk1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51Jyk7CiAgICAgIHZhciBkcm9wZG93bk1lbnVCdXR0b25PbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uT25lJyk7CiAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duUGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJyk7CiAgICAgIGRyb3Bkb3duTWVudS5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpOwogICAgICB0aGlzLnRvZ2dsZU1vZGFsID0gZmFsc2U7CiAgICAgIHZhciBkcm9wZG93blBhcmVudDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQyJyk7CiAgICAgIHZhciBkcm9wZG93bk1lbnUyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudTInKTsKICAgICAgdmFyIGRyb3Bkb3duTWVudUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b24yJyk7IC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIgLCAiZGVjaWRpbmcgdmFsdWUiKQoKICAgICAgaWYgKHRoaXMudG9nZ2xlTW9kYWwyKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMikKICAgICAgICBkcm9wZG93blBhcmVudDIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudTIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICAgIGRyb3Bkb3duTWVudTIucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKTsKICAgICAgICB0aGlzLnRvZ2dsZU1vZGFsMiA9IGZhbHNlOyAvL2NvbnNvbGUubG9nKHRoaXMudG9nZ2xlTW9kYWwyLCJhZnRlciBkZWNpZGluZyIpOwogICAgICB9IGVsc2UgewogICAgICAgIGRyb3Bkb3duUGFyZW50Mi5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51Mi5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7CiAgICAgICAgZHJvcGRvd25NZW51Mi5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpOwogICAgICAgIHRoaXMudG9nZ2xlTW9kYWwyID0gdHJ1ZTsgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiwiYWZ0ZXIgZGVjaWRpbmciKTsKICAgICAgfQogICAgfSwKICAgIGZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlOiBmdW5jdGlvbiBmb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZSkgewogICAgICB2YXIgY29uX2RhdGUgPSAiIjsKCiAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UpIHsKICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICBjb25fZGF0ZSA9IHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbl9kYXRlID09IHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlICYmIGkgIT0gMCkgewogICAgICAgICAgcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uX2RhdGUgPSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0sCiAgICBzZW5kX21lc3NhZ2VfdG9fdXNlcjogZnVuY3Rpb24gc2VuZF9tZXNzYWdlX3RvX3VzZXIoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmIChCb29sZWFuKHRoaXMubWVzc2FnZV90b19zZW5kKSA9PT0gZmFsc2UgJiYgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwogICAgICB2YXIgY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CgogICAgICBpZiAodGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmNvbXBhbnlfaWQgPSB0aGlzLmNvbXBhbnlfaWQ7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmNvbXBhbnlfbmFtZSA9IHRoaXMuY29tcGFueV9uYW1lOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC53aGF0c2FwcF9jb250YWN0X251bWJlciA9IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlcjsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuZG9jdW1lbnRfY29udGVudCA9IG51bGw7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NhcHRpb24gPSB0aGlzLm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIF90aGlzMTEuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZW5kX2F0dGFjaG1lbnQiKS52YWx1ZSA9ICcnOwoKICAgICAgICAgIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9NRURJQV9TRU5EX1NVQ0NFU1NGVUxMWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHZhciBib3RfcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgICAgIGlmIChfdGhpczExLmZpbGVfZXh0ZW5zaW9ucy5kb2N1bWVudF9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoX3RoaXMxMS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZSkpIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2UgPSBbewogICAgICAgICAgICAgICAgInRleHQiOiBudWxsLAogICAgICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IF90aGlzMTEuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICAgICJhdHRhY2htZW50IjogewogICAgICAgICAgICAgICAgICBmaWxlbmFtZTogX3RoaXMxMS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGVfbmFtZSwKICAgICAgICAgICAgICAgICAgbGluazogImh0dHBzOi8vc3RvcmFnZS5jZW5zZS5haS8iLmNvbmNhdChfdGhpczExLmNvbXBhbnlfaWQsICIvV2hhdHNhcHBNZWRpYS8iKS5jb25jYXQoX3RoaXMxMS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGVfbmFtZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgOwoKICAgICAgICAgICAgaWYgKF90aGlzMTEuZmlsZV9leHRlbnNpb25zLmltYWdlX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcyhfdGhpczExLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfY29udGVudF90eXBlKSkgewogICAgICAgICAgICAgIGJvdF9yZXNwb25zZSA9IFt7CiAgICAgICAgICAgICAgICAidGV4dCI6IG51bGwsCiAgICAgICAgICAgICAgICAicmVjaXBpZW50X2lkIjogX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgImltYWdlIjogcmVzcG9uc2UuZGF0YS5maWxlX2xpbmsKICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgICAgaWYgKF90aGlzMTEuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTEuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgICAiQk9UUmVzcG9uc2UiOiBib3RfcmVzcG9uc2UsCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICJVc2VyUXVlcnkiOiAiIiwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAidXNlcl9xdWVyeV9kYXRlIjogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICJDaGF0X0RhdGV0aW1lIjogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTEuY29udGFjdF9saXN0W190aGlzMTEuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gX3RoaXMxMS5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICAgIF90aGlzMTEuY29udGFjdF9saXN0ID0gX3RoaXMxMS5hcnJheV9tb3ZlKF90aGlzMTEuY29udGFjdF9saXN0LCBfdGhpczExLmN1cnJlbnRfY29udGFjdF9pbmRleCwgMCk7CiAgICAgICAgICAgIF90aGlzMTEubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgICAgICAgX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOyAvLyB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CgogICAgICAgICAgICBfdGhpczExLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX01FRElBX1NFTkRfRkFJTFVSRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB0cnkgYWdhaW4iLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1VTRVJfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczExLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWQnKSwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyMzMDg1ZDYnLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczExLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzMTEudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXMxMS4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICBuYW1lOiAnU2V0dGluZ3MnLAogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9XSEFUU0FQUF9DT05UQUNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9OVU1CRVJfTk9ORS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuVEVYVF9JU19OT05FLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5NSVNTSU5HX01FRElBX0lORk9STUFUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSk7CgoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczExLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CgogICAgICBpZiAodGhpcy5tZXNzYWdlX3RvX3NlbmQudHJpbSgpICE9PSAiIikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIHNlbmRfbWVzc2FnZTogdHJ1ZSwKICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlcgogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVEVYVF9TRU5EX1NVQ0NFU1NGVUxMWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIGlmIChfdGhpczExLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYpIHsKICAgICAgICAgICAgICBfdGhpczExLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgICAgX3RoaXMxMS5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgICAgX3RoaXMxMS5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgIF90aGlzMTEubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgICBjaGF0X2RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICAgdGltZTogIiIuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCksICI6IikuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ01pbnV0ZXMoKSkKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBfdGhpczExLmNvbnRhY3RfbGlzdC51bnNoaWZ0KF90aGlzMTEubmV3X2NvbnZfY29udGFjdF9kYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXMxMS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKCiAgICAgICAgICAgIGlmIChfdGhpczExLmhpc3RvcnkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczExLmhpc3RvcnkucHVzaCh7CiAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogW3sKICAgICAgICAgICAgICAgICJ0ZXh0IjogX3RoaXMxMS5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgICAicmVjaXBpZW50X2lkIjogX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfbnVtYmVyCiAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICJVc2VyUXVlcnkiOiAiIiwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAidXNlcl9xdWVyeV9kYXRlIjogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICJDaGF0X0RhdGV0aW1lIjogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTEuc2Nyb2xsX2Rvd24oKTsKCiAgICAgICAgICAgIF90aGlzMTEuY29udGFjdF9saXN0W190aGlzMTEuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gX3RoaXMxMS5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICAgIF90aGlzMTEuY29udGFjdF9saXN0ID0gX3RoaXMxMS5hcnJheV9tb3ZlKF90aGlzMTEuY29udGFjdF9saXN0LCBfdGhpczExLmN1cnJlbnRfY29udGFjdF9pbmRleCwgMCk7CiAgICAgICAgICAgIF90aGlzMTEubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgICAgICAgX3RoaXMxMS5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXMxMS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX3RoaXMxMS50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczExLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnJyksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMTEuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ1NldHRpbmdzJywKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfV0hBVFNBUFBfQ09OVEFDVC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfV0hBVFNBUFBfQ09OVEFDVC5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX05VTUJFUl9OT05FLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5URVhUX0lTX05PTkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLk1JU1NJTkdfTUVESUFfSU5GT1JNQVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxMS5hcGlfZXJyb3JfY2hlY2tzKGUucmVzcG9uc2UpOwoKICAgICAgICAgIF90aGlzMTEuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB0aGlzLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9LAogICAgZWRpdF93ZWJzaXRlX3ZhbHVlOiBmdW5jdGlvbiBlZGl0X3dlYnNpdGVfdmFsdWUoaW5kZXgpIHsKICAgICAgdGhpcy5pbmRleF91cGRhdGUgPSBpbmRleDsKICAgICAgdGhpcy5lZGl0X3dlYnNpdGUgPSB0cnVlOwogICAgfSwKICAgIGdldF9wcm9maWxlX2RldGFpbHM6IGZ1bmN0aW9uIGdldF9wcm9maWxlX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9hZGRyZXNzID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9kZXNjcmlwdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfd2Vic2l0ZSA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfc3RhdHVzID0gZmFsc2U7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gbnVsbDsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczEyLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMi53aGF0c2FwcF9wcm9maWxlID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Byb2ZpbGU7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczEyLndoYXRzYXBwX3Byb2ZpbGUgPSByZXNwb25zZS5kYXRhLmRhdGEud2hhdHNhcHBfcHJvZmlsZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlX3Byb2ZpbGVfZGV0YWlsczogZnVuY3Rpb24gdXBkYXRlX3Byb2ZpbGVfZGV0YWlscygpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdGhpcy5lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9hZGRyZXNzID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9kZXNjcmlwdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfd2Vic2l0ZSA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfc3RhdHVzID0gZmFsc2U7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gbnVsbDsKCiAgICAgIGlmICh0aGlzLndoYXRzYXBwX3Byb2ZpbGUud2Vic2l0ZXMubGVuZ3RoID09IDIpIHsKICAgICAgICB0aGlzLnNlY29uZF93ZWJzaXRlID0gdHJ1ZTsKICAgICAgfQoKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgIHdoYXRzYXBwX3Byb2ZpbGU6IHRoaXMud2hhdHNhcHBfcHJvZmlsZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB2YXIgcmVzcCA9IHJlc3BvbnNlLmRhdGEudXBkYXRlX3Jlc3BvbnNlOwoKICAgICAgICBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfUFJPRklMRV9FRElUX1NVQ0NFU1NGVUwuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMTMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfUFJPRklMRV9FRElUX1VOU1VDQ0VTU0ZVTC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxMy50bHQoJ3doYXRzYXBwX3Byb2ZpbGVfZWRpdGVkX3Vuc3VjY2VzcycpLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXMxMy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIF90aGlzMTMuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZV9wcm9maWxlX2ltYWdlOiBmdW5jdGlvbiB1cGRhdGVfcHJvZmlsZV9pbWFnZShlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHRoaXMuc2VsZWN0ZWRfZmlsZXMgPSBlLnRhcmdldC5maWxlc1swXTsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ZpbGVzLnR5cGUgPT0gJ2ltYWdlL3BuZycgfHwgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICdpbWFnZS9qcGcnIHx8IHRoaXMuc2VsZWN0ZWRfZmlsZXMudHlwZSA9PSAnaW1hZ2UvanBlZycpIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9maWxlcy5zaXplID4gNTA5NzE1MikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIHNob3VsZCBiZSBsZXNzIHRoYW4gNU1CIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcyA9ICcnOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGZpbGVfdG9fdXBsb2FkID0gdGhpcy5zZWxlY3RlZF9maWxlczsKICAgICAgICB2YXIgcHJvZmlsZV9pbWcgPSB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgcGhvdG86IGZpbGVfdG9fdXBsb2FkLAogICAgICAgICAgd2FfcGhvbmVfbnVtYmVyOiB0aGlzLndoYXRzYXBwX3Byb2ZpbGUud2hhdHNhcHBfcGhvbmVfbnVtYmVyCiAgICAgICAgfTsKICAgICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHByb2ZpbGVfaW1nKTsKICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtqc29uXSwgewogICAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZmQuYXBwZW5kKCdwaG90bycsIHRoaXMuc2VsZWN0ZWRfZmlsZXMpOwogICAgICAgIGZkLmFwcGVuZCgianNvbiIsIGJsb2IpOwogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksIGZkLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTQuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB2YXIgcmVzcCA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLlVQREFURURfV0hBVFNBUFBfUFJPRklMRV9QSE9UTy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMTQuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczE0LmFwaV9zdGF0dXNfY29kZS5QRU5ESU5HX1dIQVRTQVBQX1BST0ZJTEVfUEhPVE9fVVBEQVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfUFJPRklMRV9QSUNUVVJFX1VOREVSX1JFU09MVVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfUEhPVE9fVVBEQVRJT05fRkFJTEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTQuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczE0LmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICBfdGhpczE0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczE0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNwZWNpZmljIGZvcm1hdGUoanBnIGpwZWcgcG5nKSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHJlbW92ZV9wcm9maWxlX2ltYWdlOiBmdW5jdGlvbiByZW1vdmVfcHJvZmlsZV9pbWFnZSgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19yZW1vdmVfcGhvdG86IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTUuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTUuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfUEhPVE9fUkVNT1ZFRC5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxNS5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTUuYXBpX3N0YXR1c19jb2RlLkZBSUxFRF9XSEFUU0FQUF9QUk9GSUxFX1BIT1RPX1JFTU9WQUwuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTUuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjb25uZWN0X2VsaXhpcl9zb2NrZXQ6IGZ1bmN0aW9uIGNvbm5lY3RfZWxpeGlyX3NvY2tldCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW5pdGlhbGl6ZV93aGF0c2FwcF90b3BpYygpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogIjEwMCIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICAvLyB0aGlzLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgICAgIC8vIHRoaXMubGl2ZV9jaGF0X3Rva2VuID0gcmVzcG9uc2UuZGF0YS50b2tlbjsKICAgICAgICAvLyB0aGlzLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAgICAgX3RoaXMxNi5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgd2hhdHNhcHA6ICJ0cnVlIiwKICAgICAgICAgICAgdG9rZW46IHJlc3BvbnNlLmRhdGEudG9rZW4KICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMxNi5jaGF0X3NvY2tldC5jb25uZWN0KCk7CgogICAgICAgIF90aGlzMTYuY2hhbm5lbCA9IF90aGlzMTYuY2hhdF9zb2NrZXQuY2hhbm5lbCgid2hhdHNhcHA6IiArIHJlc3BvbnNlLmRhdGEud2hhdHNhcHBfdG9waWMpOwoKICAgICAgICBfdGhpczE2LmNoYW5uZWwuam9pbigpOwoKICAgICAgICBfdGhpczE2LmNoYW5uZWwub24oIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgZnVuY3Rpb24gKHJlcykgey8vIGNvbnNvbGUubG9nKCJuZXdfd2hhdHNhcHBfbWVzc2FnZSIsIHJlcykKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZW5hYmxlX3NlbmRpbmdfbWVzc2FnZXNfZm9yX3VzZXI6IGZ1bmN0aW9uIGVuYWJsZV9zZW5kaW5nX21lc3NhZ2VzX2Zvcl91c2VyKCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICB1cGRhdGVfYm90X3Jlc3BvbnNlOiB0cnVlLAogICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgYm90X3Jlc3BvbnNlOiBmYWxzZSwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKF90aGlzMTcuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzMTcuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczE3LnN0YXJ0X25ld19jb252X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxNy5jb250YWN0X2xpc3RbX3RoaXMxNy5jdXJyZW50X2NvbnRhY3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIF90aGlzMTcuJHNldChfdGhpczE3LmNvbnRhY3RfbGlzdCwgX3RoaXMxNy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIF90aGlzMTcuY29udGFjdF9saXN0W190aGlzMTcuY3VycmVudF9jb250YWN0X2luZGV4XSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgey8vIHRoaXMuJHJlZnNbIm1lc3NhZ2Vfc2VuZGluZ190ZXh0Ym94Il0uZm9jdXMoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBpZiAoX3RoaXMxNy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID09PSB0cnVlKSB7CiAgICAgICAgICAgIF90aGlzMTcuc3RhcnRfbmV3X2NvbnZfZGF0YS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczE3LmNvbnRhY3RfbGlzdFtfdGhpczE3LmN1cnJlbnRfY29udGFjdF9pbmRleF0uaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwoKICAgICAgICAgICAgX3RoaXMxNy4kc2V0KF90aGlzMTcuY29udGFjdF9saXN0LCBfdGhpczE3LmN1cnJlbnRfY29udGFjdF9pbmRleCwgX3RoaXMxNy5jb250YWN0X2xpc3RbX3RoaXMxNy5jdXJyZW50X2NvbnRhY3RfaW5kZXhdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczE3LiRuZXh0VGljayhmdW5jdGlvbiAoKSB7Ly8gdGhpcy4kcmVmc1sibWVzc2FnZV9zZW5kaW5nX3RleHRib3giXS5mb2N1cygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczE3LmFwaV9zdGF0dXNfY29kZS5VTlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6IF90aGlzMTcudGx0KCdkYl9vcGVyYXRpb25fdW5zdWNjZXNzJyksCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTcuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyMzMDg1ZDYnLAogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX3RoaXMxNy50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2cnKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX3RoaXMxNy50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZycpLAogICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXMxNy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogJ1NldHRpbmdzJywKICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBleHBhbmRfdGV4dGJveDogZnVuY3Rpb24gZXhwYW5kX3RleHRib3goaWQsIGtleSkgewogICAgICBpZiAoaWQgIT0gJyNidXNpbmVzc19hZGRyZXNzJykgewogICAgICAgIHRoaXMuY2FsbHNlYXJjaCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7CiAgICAgICAgICB0ZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHNjcm9sbF9oZWlnaHQgPSBlLnRhcmdldC5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICIiLmNvbmNhdChzY3JvbGxfaGVpZ2h0LCAicHgiKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIDEwKTsKICAgICAgfQogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMyAmJiAhZXZlbnQuc2hpZnRLZXkpIHsKICAgICAgICB0aGlzLnVwZGF0ZV9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2N1cnJlbnRfbnVtYmVyOiBmdW5jdGlvbiBjaGVja19jdXJyZW50X251bWJlcihyZXMpIHsKICAgICAgcmV0dXJuIHJlcy53aGF0c2FwcF9waG9uZV9udW1iZXIgPT09IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciA/IHRydWUgOiBmYWxzZTsKICAgIH0sCiAgICBmb3JtYXRfdXNlcl9xdWVyeV9kYXRlOiBmdW5jdGlvbiBmb3JtYXRfdXNlcl9xdWVyeV9kYXRlKHVzZXJfcXVlcnlfZGF0ZSwgaW5kZXgpIHsKICAgICAgLy8gY29uc29sZS5sb2coT2JqZWN0LmtleXModGhpcy5oaXN0b3J5W2luZGV4LTFdKSkKICAgICAgaWYgKHRoaXMuaGlzdG9yeVtpbmRleCAtIDFdLnVzZXJfcXVlcnlfZGF0ZSA9PSB1c2VyX3F1ZXJ5X2RhdGUpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KCiAgICAgIHJldHVybiB1c2VyX3F1ZXJ5X2RhdGU7CiAgICB9LAogICAgZ2V0X2FsbF9jb250YWN0X2xpc3Q6IGZ1bmN0aW9uIGdldF9hbGxfY29udGFjdF9saXN0KCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTguc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxOC5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczE4LmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxOC5hbGxfY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgX3RoaXMxOC5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTguYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTguY29udGFjdF9saXN0ID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxOC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy9ET05FCiAgICBuZXdfY29udGFjdF9saXN0OiBmdW5jdGlvbiBuZXdfY29udGFjdF9saXN0KCkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CgogICAgICB2YXIgc2Nyb2xsZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhbGwtY29udGFjdC1saXN0JylbMF0uc2Nyb2xsVG9wOwoKICAgICAgaWYgKHNjcm9sbGVyID4gMTIwICYmICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICYmICF0aGlzLnRvdGFsX2NvbnRhY3RfbG9hZGVkKSB7CiAgICAgICAgdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICsgMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxOS5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICBfdGhpczE5LmlzX3BhZ2luYXRlZF9jYWxsID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczE5LmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMxOS5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxOS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgX3RoaXMxOS5hbGxfY29udGFjdF9saXN0ID0gX3RoaXMxOS5hbGxfY29udGFjdF9saXN0LmNvbmNhdChyZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHMpOwogICAgICAgICAgICAgIF90aGlzMTkuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICs9IDE7CiAgICAgICAgICAgICAgX3RoaXMxOS5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczE5LmFwaV9zdGF0dXNfY29kZS5EQVRBX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMTkuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTkuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczE5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXJyYXlfbW92ZTogZnVuY3Rpb24gYXJyYXlfbW92ZShhcnIsIG9sZF9pbmRleCwgbmV3X2luZGV4KSB7CiAgICAgIGlmIChuZXdfaW5kZXggPj0gYXJyLmxlbmd0aCkgewogICAgICAgIHZhciBrID0gbmV3X2luZGV4IC0gYXJyLmxlbmd0aCArIDE7CgogICAgICAgIHdoaWxlIChrLS0pIHsKICAgICAgICAgIGFyci5wdXNoKHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBhcnIuc3BsaWNlKG5ld19pbmRleCwgMCwgYXJyLnNwbGljZShvbGRfaW5kZXgsIDEpWzBdKTsKICAgICAgcmV0dXJuIGFycjsgLy8gZm9yIHRlc3RpbmcKICAgIH0sCiAgICBmb3JtYXRVc2VyUXVlcnlUaW1lOiBmdW5jdGlvbiBmb3JtYXRVc2VyUXVlcnlUaW1lKHVzZXJfcXVlcnlfdGltZSwgdmFsKSB7CiAgICAgIC8vIGlmICh2YWwgPT0gdW5kZWZpbmVkKSB7CiAgICAgIC8vICAgcmV0dXJuIG5ldyBEYXRlKHVzZXJfcXVlcnlfdGltZSkudG9Mb2NhbGVUaW1lU3RyaW5nKG5hdmlnYXRvci5sYW5ndWFnZSwgewogICAgICAvLyAgIGhvdXI6ICcyLWRpZ2l0JywKICAgICAgLy8gICBtaW51dGU6JzItZGlnaXQnCiAgICAgIC8vICAgfSkKICAgICAgLy8gfWVsc2V7CiAgICAgIHJldHVybiBtb21lbnQudXRjKHVzZXJfcXVlcnlfdGltZSkubG9jYWwoKS5mb3JtYXQoImg6bW0gYSIpOyAvLyByZXR1cm4gdXNlcl9xdWVyeV90aW1lCiAgICB9LAogICAgaXNfYWN0aXZlX2NoYXQ6IGZ1bmN0aW9uIGlzX2FjdGl2ZV9jaGF0KGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgpIHsKICAgICAgICByZXR1cm4gImJhY2tncm91bmQ6ICNmMGY4ZmYiOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY29udGFjdF9saXN0W2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uIHx8IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuICJiYWNrZ3JvdW5kOiAjNDdhODg0MzMiOwogICAgICB9CgogICAgICByZXR1cm4gImJhY2tncm91bmQ6ICNmZmZmZmYiOwogICAgfSwKICAgIGZvcm1hdENvbnRhY3RMYXN0TWVzc2FnZURhdGU6IGZ1bmN0aW9uIGZvcm1hdENvbnRhY3RMYXN0TWVzc2FnZURhdGUoZGF0ZSwgdGltZSkgewogICAgICBpZiAobW9tZW50KGRhdGUpLmlzU2FtZShEYXRlLm5vdygpLCAnZGF5JykpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoIiIuY29uY2F0KGRhdGUsICIgIikuY29uY2F0KHRpbWUsICJaIikpLnRvTG9jYWxlVGltZVN0cmluZyhuYXZpZ2F0b3IubGFuZ3VhZ2UsIHsKICAgICAgICAgIGhvdXI6ICcyLWRpZ2l0JywKICAgICAgICAgIG1pbnV0ZTogJzItZGlnaXQnCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRlOwogICAgfSwKICAgIGZvcm1hdFNlYXJjaGVkRGF0ZTogZnVuY3Rpb24gZm9ybWF0U2VhcmNoZWREYXRlKGRhdGUpIHsKICAgICAgdmFyIHJlc3BvbnNlRGF0ZSA9IG1vbWVudChkYXRlKS5mb3JtYXQoJ0REL01NL1lZWVknKTsKICAgICAgcmV0dXJuIHJlc3BvbnNlRGF0ZTsKICAgIH0sCiAgICBjaGVja19wcmV2aW91c19tZXNzYWdlX2RhdGVfc2FtZTogZnVuY3Rpb24gY2hlY2tfcHJldmlvdXNfbWVzc2FnZV9kYXRlX3NhbWUoaW5kZXgpIHsKICAgICAgLy8gY29uc29sZS5sb2coaW5kZXgpCiAgICAgIHJldHVybiB0cnVlOyAvLyBpZihpbmRleCA9PSAwKSB7CiAgICAgIC8vICAgcmV0dXJuIHRydWU7IAogICAgICAvLyB9CiAgICAgIC8vIHJldHVybiB0aGlzLmhpc3RvcnlbaW5kZXgtMV0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gdGhpcy5oaXN0b3J5W2luZGV4XS5ib3RfcmVzcG9uc2VfZGF0ZSA/IHRydWUgOiBmYWxzZTsgCiAgICB9LAogICAgcHJvY2Vzc19hdHRhY2htZW50X2ZpbGU6IGZ1bmN0aW9uIHByb2Nlc3NfYXR0YWNobWVudF9maWxlKGUpIHsKICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CgogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIGxlc3MgdGhhbiAyTUIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmlsZV9leHRlbnNpb25zLmFsbF9hbGxvd2VkX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcyhmaWxlc1swXS50eXBlKSkgewogICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGVfbmFtZSA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZSA9IGZpbGVzWzBdLnR5cGU7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmRvY3VtZW50X2NvbnRlbnQgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGVzWzBdKTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gdHJ1ZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfdHlwZSA9IHRoaXMuZmlsZV9leHRlbnNpb25zLmltYWdlX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcyhmaWxlc1swXS50eXBlKSA/ICdpbWFnZScgOiAnZG9jdW1lbnQnOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jYXB0aW9uID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgdGhpcy5jcmVhdGVBdHRhY2htZW50KGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiUGxlYXNlIFNlbGVjdCBhIHByb3BlciBkb2N1bWVudCBvciBpbWFnZSBoYXZpbmcgdGhlIGNvcnJlY3QgZmlsZXR5cGUiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVBdHRhY2htZW50OiBmdW5jdGlvbiBjcmVhdGVBdHRhY2htZW50KGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMjAgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczIwLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwoKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWctcHJldmlldyIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltZy1wcmV2aWV3IikuaW5uZXJIVE1MID0gJzxpbWcgY2xhc3M9ImN1c3RvbS1kaXNwbGF5LWltYWdlIiBzdHlsZT0ibWF4LXdpZHRoOjk4JTtoZWlnaHQ6NDkwcHg7IHBhZGRpbmc6IDEuNXJlbTttYXJnaW4tbGVmdDogYXV0bzsgbWFyZ2luLXJpZ2h0OiBhdXRvOyIgc3JjPSInICsgdGhpcy5yZXN1bHQgKyAnIiAvPic7CiAgICAgIH0pOwogICAgfSwKICAgIGlzX3Jlc3BvbnNlX2ltYWdlOiBmdW5jdGlvbiBpc19yZXNwb25zZV9pbWFnZShkYXRhKSB7CiAgICAgIGlmIChkYXRhLnRlbXBsYXRlID09IG51bGwgJiYgZGF0YS50ZXh0ID09IG51bGwgJiYgQm9vbGVhbihkYXRhLmltYWdlKSAhPSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBpc19yZXNwb25zZV9kb2N1bWVudDogZnVuY3Rpb24gaXNfcmVzcG9uc2VfZG9jdW1lbnQoZGF0YSkgewogICAgICBpZiAoZGF0YS50ZW1wbGF0ZSA9PSBudWxsICYmIGRhdGEudGV4dCA9PSBudWxsICYmIGRhdGEuaW1hZ2UgPT0gbnVsbCAmJiBCb29sZWFuKGRhdGEuYXR0YWNobWVudCkgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgc2hvd19pbWFnZV9mdWxsc2NyZWVuOiBmdW5jdGlvbiBzaG93X2ltYWdlX2Z1bGxzY3JlZW4oaW1nX3NyYykgewogICAgICAkKCIjc2hvd0ltYWdlTW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgICB0aGlzLmN1cnJlbnRfZnVsbHNjcmVlbl9pbWFnZV9zcmMgPSBpbWdfc3JjOwogICAgfSwKICAgIGFkZF9uZXdfY29udGFjdF9tb2RhbDogZnVuY3Rpb24gYWRkX25ld19jb250YWN0X21vZGFsKCkgewogICAgICAvLyBjb25zb2xlLmxvZygiYWRkIG5ldyBjb250YWN0LWFkZENvbnRhY3RNb2RhbCIpCiAgICAgICQoIiNhZGRDb250YWN0TW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgfSwKICAgIHNhdmVfbmV3X2NvbnRhY3Q6IGZ1bmN0aW9uIHNhdmVfbmV3X2NvbnRhY3QoKSB7CiAgICAgIHZhciBfdGhpczIxID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmFkZF9uZXdfY29udGFjdC5jb250YWN0X25hbWUgPT0gbnVsbCB8fCB0aGlzLmFkZF9uZXdfY29udGFjdC5waG9uZV9udW1iZXIgPT0gbnVsbCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJGaWxsIGRldGFpbHMiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhIHZhbGlkIGNvbnRhY3QgbnVtYmVyIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmFkZF9uZXdfY29udGFjdC5jb21wYW55X2lkID0gdGhpcy5jb21wYW55X2lkOwogICAgICB0aGlzLmFkZF9uZXdfY29udGFjdC5jb21wYW55X25hbWUgPSB0aGlzLmNvbXBhbnlfbmFtZTsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHRoaXMuYWRkX25ld19jb250YWN0LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMjEuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX0NPTlRBQ1RfQURERURfU1VDQ0VTU0ZVTExZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICB0ZXh0OiAiQ29udGFjdCBBZGRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICAgICQoIiNhZGRDb250YWN0TW9kYWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgIF90aGlzMjEuY2xlYXJfYWRkX2NvbnRhY3QoKTsKCiAgICAgICAgICBfdGhpczIxLmdldF9hbGxfY29udGFjdF9saXN0KCk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIxLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9DT05UQUNUX0FMUkVBRFlfRVhJU1QuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgICB0ZXh0OiAiUHJvdmlkZWQgbnVtYmVyIGFscmVhZHkgZXhpc3RzIGluIGNvbnRhY3RzIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfQ09OVEFDVF9RVUVSWV9FUlJPUi5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIF90aGlzMjEuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyX2FkZF9jb250YWN0OiBmdW5jdGlvbiBjbGVhcl9hZGRfY29udGFjdCgpIHsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QgPSB7CiAgICAgICAgcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICAgIGlzX2FkZF9jb250YWN0OiB0cnVlLAogICAgICAgIGNvbnRhY3RfbmFtZTogbnVsbCwKICAgICAgICBmb3JtYXR0ZWROdW1iZXI6IG51bGwKICAgICAgfTsKICAgIH0sCiAgICBkb3dubG9hZF9kb2N1bWVudDogZnVuY3Rpb24gZG93bmxvYWRfZG9jdW1lbnQoYXR0YWNobWVudCkgewogICAgICAvLyBjb25zb2xlLmxvZyhhdHRhY2htZW50KQogICAgICB2YXIgYVRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgYVRhZy5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2FiY2RlZmcnKTsKICAgICAgYVRhZy5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgJ2Rvd25sb2FkJyk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCdocmVmJywgYXR0YWNobWVudC5saW5rKTsKICAgICAgYVRhZy5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsICJfYmxhbmsiKTsKICAgICAgYVRhZy5jbGljaygpOyAvLyBjb25zdCBibG9iID0gbmV3IEJsb2IoW2F0dGFjaG1lbnQubGlua10sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicgfSkKICAgICAgLy8gY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKQogICAgICAvLyBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpCiAgICAgIC8vIGxpbmsuZG93bmxvYWQgPSBhdHRhY2htZW50LmZpbGVuYW1lCiAgICAgIC8vIGxpbmsuY2xpY2soKQogICAgICAvLyBVUkwucmV2b2tlT2JqZWN0VVJMKGxpbmsuaHJlZikKICAgICAgLy8gbGluay5jbGljaygpOwogICAgfSwKICAgIG9wZW5fc2VuZF90ZW1wbGF0ZV90b191c2VyOiBmdW5jdGlvbiBvcGVuX3NlbmRfdGVtcGxhdGVfdG9fdXNlcigpIHsKICAgICAgdGhpcy5yZXRyaWV2ZV9hbGxfdGVtcGxhdGVzKCk7CiAgICAgICQoIiNzZW5kVGVtcGxhdGVNb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICB9LAogICAgcmV0cmlldmVfYWxsX3RlbXBsYXRlczogZnVuY3Rpb24gcmV0cmlldmVfYWxsX3RlbXBsYXRlcygpIHsKICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOwoKICAgICAgdGhpcy5jdXJyZW50X3RlbXBsYXRlID0ge307CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMjIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMjIud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0ID0gW107CiAgICAgICAgICBfdGhpczIyLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXM7CiAgICAgICAgICBfdGhpczIyLndoYXRzYXBwX3RlbXBsYXRlcy5wYWdpbmF0aW9uX2RhdGEubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgIF90aGlzMjIud2hhdHNhcHBfdGVtcGxhdGVzLnBhZ2luYXRpb25fZGF0YS50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyMi5hcGlfc3RhdHVzX2NvZGUuTk9fV0hBVFNBUFBfVEVNUExBVEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyMi53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZW5kX3RlbXBsYXRlX3RvX2N1c3RvbWVyOiBmdW5jdGlvbiBzZW5kX3RlbXBsYXRlX3RvX2N1c3RvbWVyKCkgewogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19ub3RpZmljYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSwKICAgICAgICBjb250YWN0c19saXN0OiBbdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyXSwKICAgICAgICBwdWJsaXNoX3RlbXBsYXRlOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSAsICJyZXMiKQogICAgICAgIGlmIChfdGhpczIzLmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzMjMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnJyksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzMjMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzMjMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICdTZXR0aW5ncycsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyMy5hcGlfc3RhdHVzX2NvZGUuU0VORElOR19URU1QTEFURS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzMjMudGx0KCdzZW5kX3RlbXBsYXRlX3NlbnRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKCItLS0tIiAsIHJlc3BvbnNlLmRhdGEpCiAgICAgICAgICAvLyBjb25zdCB0ZW1wbGF0ZSA9ICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdC5maW5kKChpdGVtKSA9PiBpdGVtLnRlbXBsYXRlX2lkID09IHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnNlbGVjdGVkX3RlbXBsYXRlKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnNlbGVjdGVkX3RlbXBsYXRlKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRlbXBsYXRlLnZhcmlhYmxlX2RpY3QsIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlcik7CgogICAgICAgICAgdmFyIGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgIHZhciBib3RfcmVzcG9uc2UgPSBbewogICAgICAgICAgICAidGV4dCI6IG51bGwsCiAgICAgICAgICAgICJ0eXBlIjogInRlbXBsYXRlIiwKICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IF90aGlzMjMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgInRlbXBsYXRlIjogX3RoaXMyMy53aGF0c2FwcF90ZW1wbGF0ZXMucHJldmlld190ZW1wbGF0ZV9kYXRhLmJvZHkKICAgICAgICAgIH1dOwoKICAgICAgICAgIGlmIChfdGhpczIzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYpIHsKICAgICAgICAgICAgX3RoaXMyMy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgICAgICBfdGhpczIzLm5ld19jb252X2NvbnRhY3RfZGF0YS5jaGF0X2RhdGV0aW1lID0gY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKTsgLy8gdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlCgogICAgICAgICAgICBfdGhpczIzLm5ld19jb252X2NvbnRhY3RfZGF0YS5sYXN0X2JvdF9yZXNwb25zZSA9IHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczIzLm1lc3NhZ2VfdG9fc2VuZCwKICAgICAgICAgICAgICBjaGF0X2RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgIGRhdGU6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICB0aW1lOiAiIi5jb25jYXQoY3VycmVudF90aW1lc3RhbXAuZ2V0VVRDSG91cnMoKSwgIjoiKS5jb25jYXQoY3VycmVudF90aW1lc3RhbXAuZ2V0VVRDTWludXRlcygpKQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgX3RoaXMyMy5jb250YWN0X2xpc3QudW5zaGlmdChfdGhpczIzLm5ld19jb252X2NvbnRhY3RfZGF0YSk7CgogICAgICAgICAgICBfdGhpczIzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSBmYWxzZTsKICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coYm90X3Jlc3BvbnNlKQoKCiAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CgogICAgICAgICAgaWYgKF90aGlzMjMuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICB9KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyMy5oaXN0b3J5LnB1c2goewogICAgICAgICAgICAiQk9UUmVzcG9uc2UiOiBib3RfcmVzcG9uc2UsCiAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgIlVzZXJRdWVyeSI6ICIiLAogICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgImJvdF9yZXNwb25zZV90aW1lIjogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X2RhdGUiOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICJDaGF0X0RhdGV0aW1lIjogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXMyMy5zY3JvbGxfZG93bigpOwoKICAgICAgICAgIF90aGlzMjMuY29udGFjdF9saXN0W190aGlzMjMuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gX3RoaXMyMy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICBfdGhpczIzLmNvbnRhY3RfbGlzdCA9IF90aGlzMjMuYXJyYXlfbW92ZShfdGhpczIzLmNvbnRhY3RfbGlzdCwgX3RoaXMyMy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgX3RoaXMyMy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgX3RoaXMyMy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgICAgX3RoaXMyMy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IGZhbHNlOwogICAgICAgICAgX3RoaXMyMy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUgPSBudWxsOwogICAgICAgICAgJCgiI3NlbmRUZW1wbGF0ZU1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMjMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1VTRVJfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzMjMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICB0ZXh0OiBfdGhpczIzLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9PUFRfT1VUX0NPTlRBQ1RTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczIzLnRsdCgnQWxsX2NvbnRhY3RzX2hhdmVfb3B0ZWRfb3V0X29mX2dldHRpbmdfdGVtcGxhdGVzJyksCiAgICAgICAgICAgIHR5cGU6ICJlcm9vciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9jb250YWN0X2Rpc3BsYXlfbmFtZTogZnVuY3Rpb24gZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lKGNvbnRhY3QpIHsKICAgICAgaWYgKGNvbnRhY3QuY29udGFjdF9uYW1lKSByZXR1cm4gY29udGFjdC5jb250YWN0X25hbWU7CiAgICAgIGlmIChjb250YWN0LnByb2ZpbGVfbmFtZSkgcmV0dXJuIGNvbnRhY3QucHJvZmlsZV9uYW1lOwogICAgICByZXR1cm4gY29udGFjdC53aGF0c2FwcF9waG9uZV9udW1iZXI7CiAgICB9LAogICAgb3Blbl9pbXBvcnRfZnJvbV9jc3ZfbW9kYWw6IGZ1bmN0aW9uIG9wZW5faW1wb3J0X2Zyb21fY3N2X21vZGFsKCkgewogICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICB9LAogICAgZmlsZV9pbnB1dF9jb250YWN0c19jc3Y6IGZ1bmN0aW9uIGZpbGVfaW5wdXRfY29udGFjdHNfY3N2KGUpIHsKICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzWzBdLnR5cGUgPT0gJ3RleHQvY3N2JykgewogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9sYWJlbCA9IGUudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2NvbnRlbnQgPSBlLnRhcmdldC5maWxlc1swXTsKICAgICAgICB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfc2VsZWN0ZWQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJQbGVhc2Ugc2VsZWN0IGEgcHJvcGVyIGRvY3VtZW50IGhhdmluZyBDU1YgZmlsZXR5cGUiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlX3N1Ym1pdF91cGxvYWRfY29udGFjdHM6IGZ1bmN0aW9uIGZpbGVfc3VibWl0X3VwbG9hZF9jb250YWN0cygpIHsKICAgICAgdmFyIF90aGlzMjQgPSB0aGlzOwoKICAgICAgaWYgKCQoIiNpbnB1dEdyb3VwVXBsb2FkRmlsZWNzdiIpLnZhbCgpID09ICcnKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBTZWxlY3QgYSBDU1YgZmlsZSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHVzZXJfZGV0YWlscyA9IHsKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5CiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgfSk7CiAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmZC5hcHBlbmQoImZpbGUiLCB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfY29udGVudCwgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsKTsgLy8gZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CgogICAgICBmZC5hcHBlbmQoImNvbXBhbnlfaWQiLCB0aGlzLmNvbXBhbnlfaWQpOwogICAgICBmZC5hcHBlbmQoImNvbXBhbnlfbmFtZSIsIHRoaXMuY29tcGFueV9uYW1lKTsKICAgICAgZmQuYXBwZW5kKCJlbWFpbCIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCk7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2ltcG9ydF9jb250YWN0cygpLCBmZCwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfdGhpczI0LmFwaV9zdGF0dXNfY29kZS5GSUxFX1VQTE9BRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogIk11bHRpcGxlIGNvbnRhY3RzIGFyZSBiZWluZyBhZGRlZC4gWW91IHdpbGwgcmVjZWl2ZSBhIG1haWwgd2hlbiB0aGUgcHJvY2Vzc2luZyBpcyBmaW5pc2hlZC4iLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICAgICQoIiNpbXBvcnRDb250YWN0Q1NWTW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyNC5hcGlfc3RhdHVzX2NvZGUuSU5DT1JSRUNUX0ZJTEVfRk9STUFULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkluY29ycmVjdCBGaWxlIEZvcm1hdCEiLAogICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHRyeSBhZ2FpbiB3aXRoIGEgZGlmZmVyZW50IGNzdiBmaWxlIHdoaWNoIG1hdGNoZXMgdGhlIHNhbXBsZSBmaWxlIHN0cnVjdHVyZSIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgfSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHM6IGZ1bmN0aW9uIGVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKSB7CiAgICAgIHRoaXMuY29udGFjdF9jc3YgPSB7CiAgICAgICAgZmlsZV9sYWJlbDogJ0Nob29zZSBGaWxlJywKICAgICAgICBmaWxlX2NvbnRlbnQ6IG51bGwsCiAgICAgICAgZmlsZV9zZWxlY3RlZDogZmFsc2UKICAgICAgfTsKICAgICAgJCgiI2lucHV0R3JvdXBVcGxvYWRGaWxlY3N2IikudmFsKCcnKTsKICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGVfY29udGFjdF9maWxlOiBmdW5jdGlvbiBkb3dubG9hZF9zYW1wbGVfY29udGFjdF9maWxlKCkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CgogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuZmlsZV9kb3dubG9hZCgpLAogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHNhbXBsZV9maWxlOiAid2hhdHNhcHBfY29udGFjdHMiLAogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMjUuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJOb3QgYWJsZSB0byBkb3dubG9hZCBmaWxlIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7IC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCgogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgInRlc3QuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczI1LnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB0ZXh0Ym94X2hlaWdodDogZnVuY3Rpb24gdGV4dGJveF9oZWlnaHQoaWQsIGtleSkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0aGlzLnNlbmRfbWVzc2FnZV90b191c2VyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7CiAgICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgc2Nyb2xsX2hlaWdodCA9IGUudGFyZ2V0LnNjcm9sbEhlaWdodDsKCiAgICAgICAgICBpZiAoc2Nyb2xsX2hlaWdodCA+IDYwKSB7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gJ2F1dG8nOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNsb3NlX2RvY3VtZW50X3ByZXZpZXc6IGZ1bmN0aW9uIGNsb3NlX2RvY3VtZW50X3ByZXZpZXcoKSB7CiAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbCA9IHsKICAgICAgICBtZWRpYV9maWxlX25hbWU6IG51bGwsCiAgICAgICAgbWVkaWFfZmlsZTogbnVsbCwKICAgICAgICBzaG93X3ByZXZpZXc6IGZhbHNlLAogICAgICAgIG1lZGlhX2NvbnRlbnRfdHlwZTogbnVsbCwKICAgICAgICBtZWRpYV90eXBlOiBudWxsLAogICAgICAgIHNlbmRfbWVkaWE6IHRydWUsCiAgICAgICAgZG9jdW1lbnRfY29udGVudDogbnVsbCwKICAgICAgICBtZWRpYV9jYXB0aW9uOiBudWxsCiAgICAgIH07CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZW5kX2F0dGFjaG1lbnQiKS52YWx1ZSA9ICcnOwogICAgfSwKICAgIHdoYXRzYXBwX21lc3NhZ2VfZm9ybWF0aW5nOiBmdW5jdGlvbiB3aGF0c2FwcF9tZXNzYWdlX2Zvcm1hdGluZyhhKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjbnQgPSAwOwogICAgICAgIHZhciBwb3MxID0gLTE7CgogICAgICAgIHdoaWxlIChjbnQgPCBhLmxlbmd0aCkgewogICAgICAgICAgcG9zMSA9IGEuaW5kZXhPZih0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldLCBwb3MxICsgMSk7CgogICAgICAgICAgaWYgKHBvczEgPT0gLTEpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlcGxhY2VfZmlyc3RfY2hhciA9IGEuc3Vic3RyaW5nKDAsIHBvczEpICsgdGhpcy53aGF0c2FwcF9mb3JtYXRfZGljdFt0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldXVswXSArIGEuc3Vic3RyaW5nKHBvczEgKyAxKTsKICAgICAgICAgIGEgPSByZXBsYWNlX2ZpcnN0X2NoYXI7CiAgICAgICAgICB2YXIgcG9zMiA9IGEuaW5kZXhPZih0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldKTsKICAgICAgICAgIHZhciByZXBsYWNlX3NlY29uZF9jaGFyID0gYS5zdWJzdHJpbmcoMCwgcG9zMikgKyB0aGlzLndoYXRzYXBwX2Zvcm1hdF9kaWN0W3RoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV1dWzFdICsgYS5zdWJzdHJpbmcocG9zMiArIDEpOwogICAgICAgICAgYSA9IHJlcGxhY2Vfc2Vjb25kX2NoYXI7CiAgICAgICAgICBwb3MxID0gcG9zMjsKICAgICAgICAgIGNudCA9IHBvczI7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBmb3JtYXRVc2VyUXVlcnk6IGZ1bmN0aW9uIGZvcm1hdFVzZXJRdWVyeShVc2VyUXVlcnkpIHsKICAgICAgaWYgKFVzZXJRdWVyeSAmJiBVc2VyUXVlcnkuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBqc29uX3N0YXJ0ID0gVXNlclF1ZXJ5LmluZGV4T2YoJ3snKSwKICAgICAgICAgICAgICBqc29uX2VuZCA9IFVzZXJRdWVyeS5pbmRleE9mKCd9JykgKyAxLAogICAgICAgICAgICAgIGpzb25fZGF0YSA9IEpTT04ucGFyc2UoVXNlclF1ZXJ5LnN1YnN0cmluZyhqc29uX3N0YXJ0LCBqc29uX2VuZCkpOwogICAgICAgICAgcmV0dXJuICJJZDogIi5jb25jYXQoanNvbl9kYXRhLm9yZGVyX2lkKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgcmV0dXJuIFVzZXJRdWVyeTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBVc2VyUXVlcnk7CiAgICB9LAogICAgZ2V0X29yZGVyX3RlbXBsYXRlX2Zvcm1hdHRlZF90ZXh0OiBmdW5jdGlvbiBnZXRfb3JkZXJfdGVtcGxhdGVfZm9ybWF0dGVkX3RleHQoY3VycmVudF9ib3RfcmVzcG9uc2UpIHsKICAgICAgLy8gY29uc29sZS5sb2coY3VycmVudF9ib3RfcmVzcG9uc2UpOwogICAgICByZXR1cm4gdGhpcy53aGF0c2FwcF9tZXNzYWdlX2Zvcm1hdGluZyhjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS50eXBlID09ICdCT0RZJzsKICAgICAgfSkudGV4dCk7CiAgICB9LAogICAgY2hlY2tfYnV0dG9uX2luX29yZGVyX3RlbXBsYXRlOiBmdW5jdGlvbiBjaGVja19idXR0b25faW5fb3JkZXJfdGVtcGxhdGUoY3VycmVudF9ib3RfcmVzcG9uc2UpIHsKICAgICAgdmFyIGNoZWNrX2J1dHRvbnMgPSBjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS50eXBlID09ICdCVVRUT05TJzsKICAgICAgfSk7CgogICAgICBpZiAoQm9vbGVhbihjaGVja19idXR0b25zKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgZ2V0X29yZGVyX3RlbXBsYXRlX2J1dHRvbl91cmw6IGZ1bmN0aW9uIGdldF9vcmRlcl90ZW1wbGF0ZV9idXR0b25fdXJsKGN1cnJlbnRfYm90X3Jlc3BvbnNlLCBrZXkpIHsKICAgICAgcmV0dXJuIGN1cnJlbnRfYm90X3Jlc3BvbnNlLnRlbXBsYXRlLmNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT0gJ0JVVFRPTlMnOwogICAgICB9KS5idXR0b25zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS50eXBlID09ICdVUkwnOwogICAgICB9KVtrZXldOwogICAgfSwKICAgIGNoZWNrX2hlaWdodDogZnVuY3Rpb24gY2hlY2tfaGVpZ2h0KGlkLCBrZXkpIHsKICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7CgogICAgICBpZiAodGV4dGFyZWEuc2Nyb2xsVG9wID4gOTApIHsKICAgICAgICB0aGlzLnNob3dfcHJvZmlsZV9kaXYgPSB0cnVlOwogICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9ICI1MjVweCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gIjQ4NXB4IjsKICAgICAgICB0aGlzLnNob3dfcHJvZmlsZV9kaXYgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuY2hhbm5lbC5sZWF2ZSgpOwogICAgdGhpcy5jaGF0X3NvY2tldC5kaXNjb25uZWN0KCk7CiAgfQp9Ow=="},null]}