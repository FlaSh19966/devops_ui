{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Dashboard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Dashboard.vue","mtime":1663910265458},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBSZXF1ZXN0Q2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9SZXF1ZXN0Q2hhcnQudnVlIjsKaW1wb3J0IEFyZWFDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0FyZWFDaGFydC52dWUiOwppbXBvcnQgQmlsbGluZ0NoYXJ0IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvQmlsbGluZ0NoYXJ0LnZ1ZSI7CmltcG9ydCBzd2FsIGZyb20gJ3N3ZWV0YWxlcnQyJzsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBjdXJyZW5jeSBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0N1cnJlbmN5IjsKaW1wb3J0IExpbmVDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0xpbmVDaGFydCI7CmltcG9ydCB7IGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsgLy9pbXBvcnQgcGFnZV9ndWlkZSBmcm9tICJAL3BvcnRhbC9taXhpbnMvcGFnZWd1aWRlLmpzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICAvL21peGluczogW3BhZ2VfZ3VpZGVdLAogIHByb3BzOiB7fSwKICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sCiAgY29tcG9uZW50czogewogICAgUmVxdWVzdENoYXJ0OiBSZXF1ZXN0Q2hhcnQsCiAgICBBcmVhQ2hhcnQ6IEFyZWFDaGFydCwKICAgIEJpbGxpbmdDaGFydDogQmlsbGluZ0NoYXJ0LAogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0LAogICAgTGluZUNoYXJ0OiBMaW5lQ2hhcnQKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMucmV0YWlsX3dlYl9mcmFtZXdvcmsgPSB0aGlzLiRzZXNzaW9uLmdldCgicmV0YWlsX3dlYl9mcmFtZXdvcmsiKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cnJlbmN5Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHRoaXMuY3VycmVuY3lfbGlzdC5wdXNoKHsKICAgICAgICBkaXNwbGF5X25hbWU6IGN1cnJlbmN5W2ldLmVtb2ppICsgIiAiICsgY3VycmVuY3lbaV0uY3VycmVuY3lfY29kZSArICIgLSAiICsgY3VycmVuY3lbaV0uY3VycmVuY3lfbmFtZSwKICAgICAgICB2YWx1ZTogY3VycmVuY3lbaV0uY3VycmVuY3lfY29kZQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgdGhpcy5jdXJyZW50X3llYXIgPSBjdXJyZW50VGltZS5nZXRGdWxsWWVhcigpOwoKICAgIGlmICh0aGlzLndoYXRzYXBwX3N1YnNjcmlwdGlvbiA9PSB0cnVlKSB7CiAgICAgIHRoaXMuZ2V0X21ldHJpY3NfZGF0YSgpOwogICAgICB0aGlzLmdldF9tZXRyaWNzX3ByaWNlX2RhdGEoKTsKICAgIH0KCiAgICB2YXIgY2hlY2tfZG9tYWluID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmRvbWFpbjsKICAgIHZhciBpc19zZXRfZGVmYXVsdF9sYW5ndWFnZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5pc19zZXRfZGVmYXVsdF9sYW5ndWFnZTsKCiAgICBpZiAoaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2UgPT0gdHJ1ZSkgewogICAgICAkKCIjYm90X2xhbmd1YWdlX3NldHVwIikubW9kYWwoJ3Nob3cnKTsKICAgIH0KCiAgICB0aGlzLiRyb290LiRvbignY2FsbF9kYXNoYm9hcmRfZGV0YWlscycsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgX3RoaXMuZGFzaGJvYXJkX2RldGFpbHMoKTsKCiAgICAgICAgX3RoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duKF90aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpICYmIHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKS5yb2xlICYmIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgnc2VsZWN0X2NvbXBhbnlfbmFtZV9sYWJlbCcpKTsKICAgIH0KCiAgICBpZiAodGhpcy51c2VyX3JvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQgOiAiIjsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUgOiAiIjsKICAgIH0KCiAgICB0aGlzLndoYXRzYXBwX3N1YnNjcmlwdGlvbiA9IHRoaXMuJHNlc3Npb24uZ2V0KCJ3aGF0c2FwcF9zdWJzY3JpcHRpb24iKTsKICAgIHRoaXMuZGFzaGJvYXJkX2RldGFpbHMoKTsgLy8gYXhpb3MKICAgIC8vICAgLnBvc3QoCiAgICAvLyAgICAgYXBpX2NhbGxzLmJpbGxpbmdfdXNhZ2VfdXJsKCksCiAgICAvLyAgICAgewogICAgLy8gICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgLy8gICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAvLyAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICBsb2FkX2RhdGFfYnk6ICJMYXN0IDcgZGF5cyIsCiAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgIH0sCiAgICAvLyAgICAgewogICAgLy8gICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgfQogICAgLy8gICApCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIHRoaXMuU2Vjb25kX2NoYXJ0LmxhYmVscyA9IFtdOwogICAgLy8gICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudCA9IFtdOwogICAgLy8gICAgIHRoaXMuU2Vjb25kX2NoYXJ0Lk1zZ0V4Y2hhbmdlID0gW107CiAgICAvLyAgICAgdGhpcy5TZWNvbmRfY2hhcnQuVGFza0V4ZWN1dGlvbiA9IFtdOwogICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJObyBEYXRhIGF2YWlsYWJsZSIpIHsKICAgIC8vICAgICAgIGJ1cy4kZW1pdCgKICAgIC8vICAgICAgICAgImNoYXJ0IGlzIHVwZGF0ZWQiLAogICAgLy8gICAgICAgICAiVHJ1ZSIsCiAgICAvLyAgICAgICAgIFtdLAogICAgLy8gICAgICAgICBbXSwKICAgIC8vICAgICAgICAgW10sCiAgICAvLyAgICAgICAgIFtdLAogICAgLy8gICAgICAgICB0aGlzLmJhcl9jaGFydDJfZHJvcGRvd25fdmFsdWUKICAgIC8vICAgICAgICk7CiAgICAvLyAgICAgfSBlbHNlIHsKICAgIC8vICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMucHVzaChpKTsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuQ2FsbENvdW50LnB1c2gocmVzcG9uc2UuZGF0YVtpXS5DYWxsQ291bnQpOwogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5Nc2dFeGNoYW5nZS5wdXNoKHJlc3BvbnNlLmRhdGFbaV0uTXNnRXhjaGFuZ2UpOwogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5UYXNrRXhlY3V0aW9uLnB1c2goCiAgICAvLyAgICAgICAgICAgcmVzcG9uc2UuZGF0YVtpXS5UYXNrRXhlY3V0aW9uCiAgICAvLyAgICAgICAgICk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBidXMuJGVtaXQoCiAgICAvLyAgICAgICAgICJiaWxsaW5nIGNoYXJ0IGlzIHVwZGF0ZWQiLAogICAgLy8gICAgICAgICAiVHJ1ZSIsCiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudCwKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuTXNnRXhjaGFuZ2UsCiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LlRhc2tFeGVjdXRpb24sCiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LmxhYmVscywKICAgIC8vICAgICAgICAgdGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlCiAgICAvLyAgICAgICApOwogICAgLy8gICAgIH0KICAgIC8vICAgfSkKICAgIC8vICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICkgewogICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwoKICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmRhc2hib2FyZF9jaGFydF91cmwoKSwgewogICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgbG9hZF9kYXRhX2J5OiAiTW9udGhseSBiaWxsaW5nIGN5Y2xlIiwKICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleQogICAgfSwgewogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLkJJTExJTkdfQ0hBUlQuTVNHX0NPREUpIHsKICAgICAgICBfdGhpczIudXBkYXRlX2NoYXJ0X2RhdGEocmVzcG9uc2UuZGF0YS5kYXRhKTsKICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMyLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZzMnKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICB9CiAgICB9KTsKICB9LAogIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQoKSB7CiAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICBidXMuJG9uKCJjb21wYW55IGF0dHJpYnV0ZXMgdXBkYXRlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09ICJUcnVlIikgewogICAgICAgIGJ1cy4kZW1pdCgic2VuZCBjb21wYW55IGF0dHJpYnV0ZXMiKTsKICAgICAgfQogICAgfSk7CiAgICBidXMuJG9uKCJjb21wYW55IG5hbWUgYW5kIGNvbXBhbnkgaWQiLCBmdW5jdGlvbiAoZGF0YTEsIGRhdGEyKSB7CiAgICAgIF90aGlzMy4kcm91dGVyLmdvKCk7CiAgICB9KTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB2YWxpZEVtYWlsOiBmdW5jdGlvbiB2YWxpZEVtYWlsKCkgewogICAgICBpZiAodGhpcy5jb250YWN0X3VzX2VtYWlsICE9IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5lbWFpbF92YWxpZGl0eS50ZXN0KHRoaXMuY29udGFjdF91c19lbWFpbCkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50bHQoJ3ZhbGlkX2VtYWlsX2FkZHJfbGFiZWwnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBsaW5lX2NoYXJ0X3Byb3BzX21vbnRobHlfdXNhZ2U6IGZ1bmN0aW9uIGxpbmVfY2hhcnRfcHJvcHNfbW9udGhseV91c2FnZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB4QXhpc0xhYmVsOiAnVGltZWxpbmUnLAogICAgICAgIHlBeGlzTGFiZWw6ICdWYWx1ZScsCiAgICAgICAgeEtleTogJ2RhdGUnLAogICAgICAgIHlLZXk6ICd2YWx1ZScsCiAgICAgICAgaW50ZXJ2YWw6ICdkYXknLAogICAgICAgIGRhdGE6IHRoaXMubW9udGhseV91c2FnZV9kYXRhCiAgICAgIH07CiAgICB9LAogICAgbGluZV9jaGFydF9wcm9wc19hcHByb3hfY2hhcmdlOiBmdW5jdGlvbiBsaW5lX2NoYXJ0X3Byb3BzX2FwcHJveF9jaGFyZ2UoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeEF4aXNMYWJlbDogJ1RpbWVsaW5lJywKICAgICAgICB5QXhpc0xhYmVsOiAncHJpY2UgKCQpJywKICAgICAgICB4S2V5OiAnZGF0ZScsCiAgICAgICAgeUtleTogJ3ZhbHVlJywKICAgICAgICBpbnRlcnZhbDogJ2RheScsCiAgICAgICAgZGF0YTogdGhpcy5wcmljaW5nX2RhdGEKICAgICAgfTsKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93OiBmYWxzZSwKICAgICAgYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlOiAiTW9udGhseSBiaWxsaW5nIGN5Y2xlIiwKICAgICAgYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3c6ICJNb250aGx5IGJpbGxpbmcgY3ljbGUiLAogICAgICBiYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlOiAiTGFzdCA3IGRheXMiLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBwZXJtaXNzaW9uX2xpc3Q6IFtdLAogICAgICBBUElfZGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgU3VjY2Vzc2Z1bDogW10sCiAgICAgICAgVG90YWw6IFtdLAogICAgICAgIFVuc3VjY2Vzc2Z1bDogW10sCiAgICAgICAgeEF4aXNMYWJlbDogIiIKICAgICAgfSwKICAgICAgU2Vjb25kX2NoYXJ0OiB7CiAgICAgICAgbGFiZWxzOiBbXSwKICAgICAgICBDYWxsQ291bnQ6IFtdLAogICAgICAgIE1zZ0V4Y2hhbmdlOiBbXSwKICAgICAgICBUYXNrRXhlY3V0aW9uOiBbXQogICAgICB9LAogICAgICBDb25jdXJyZW50X1VzZXJzX0RhdGE6IHsKICAgICAgICBsYWJlbHM6IFtdLAogICAgICAgIGRhdGE6IFtdCiAgICAgIH0sCiAgICAgIGNvbmN1cnJlbnRfdXNlcnNfbW9udGg6ICIiLAogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlIDogIiIsCiAgICAgIGludGVudF9jb3VudDogNTMsCiAgICAgIGludGVudF9jb3VudF9kaXNwbGF5OiAwLAogICAgICBkaXNwbGF5X2xpc3Q6IFtdLAogICAgICBwcmltYXJ5X2l0ZW1fZW50aXRpZXNfbGlzdDogWyJJbnRlbnRzIiwgIlF1ZXN0aW9ucyIsICJSZXNwb25zZXMiLCAiVHJhaW5pbmciXSwKICAgICAgZGFuZ2VyX2l0ZW1fZW50aXRpZXNfbGlzdDogWyJWZXJpZnkgUmVzcG9uc2VzIFVuYW5zd2VyZWQiLCAiVmVyaWZ5IEJvdCBSZXNwb25zZSIsICJQcm9kdWN0cyIsICJTeW5vbnltcyIsICJBY2NvdW50cyJdLAogICAgICBpbmZvX2l0ZW1fZW50aXRpZXNfbGlzdDogW10sCiAgICAgIHN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3Q6IFsiQ2hlY2sgQm90IFJlc3BvbnNlIiwgIkJvdCBDb25maWd1cmF0aW9uIl0sCiAgICAgIGl0ZW1fbGlzdF9vcmRlcjogWyJkYW5nZXJfaXRlbV9lbnRpdGllc19saXN0IiwgInN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3QiLCAicHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3QiXSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgcmV0YWlsX3dlYl9mcmFtZXdvcms6IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpLAogICAgICBjdXJyZW5jeV9jb2RlOiAiIiwKICAgICAgY3VycmVuY3lfbGlzdDogW10sCiAgICAgIGVtYWlsX3ZhbGlkaXR5OiAvXihbMC05YS16QS1aXShbLS5cd10qWzAtOWEtekEtWl0pKkAoWzAtOWEtekEtWl1bLVx3XSpbMC05YS16QS1aXVwuKStbYS16QS1aXXsyLDl9KSQvLAogICAgICBjb250YWN0X3VzX2VtYWlsOiAnJywKICAgICAgbW9udGhseV91c2FnZV9kYXRhOiBbXSwKICAgICAgcHJpY2luZ19kYXRhOiBbXSwKICAgICAgbGluZV9jaGFydF9kcm9wZG93bl92YWx1ZTogJ2FsbCcsCiAgICAgIGxpc3Rfb2ZfeWVhcjogW10sCiAgICAgIHByaWNlX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlOiAnJywKICAgICAgY3VycmVudF95ZWFyOiAnJywKICAgICAgd2hhdHNhcHBfc3Vic2NyaXB0aW9uOiBmYWxzZSwKICAgICAgbm90X2Vub3VnaF9kYXRhOiBmYWxzZSwKICAgICAgaXNfYm90X2xhbmdfc2V0OiBmYWxzZSwKICAgICAgY291bnRyeV9saXN0OiBbewogICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7rwn4e4IEVuZ2xpc2giLAogICAgICAgIHZhbHVlOiAiZW4iLAogICAgICAgIGxhbmc6ICJlbmdsaXNoIgogICAgICB9LCAvLyB7CiAgICAgIC8vICAgZGlzcGxheV9uYW1lOiAi8J+HqvCfh7ggU3BhbmlzaCIsCiAgICAgIC8vICAgdmFsdWU6ICJlcyIsCiAgICAgIC8vICAgbGFuZzogInNwYW5pc2giCiAgICAgIC8vIH0sCiAgICAgIHsKICAgICAgICBkaXNwbGF5X25hbWU6ICLwn4eu8J+HsyBIaW5kaSIsCiAgICAgICAgdmFsdWU6ICJoaSIsCiAgICAgICAgbGFuZzogImhpbmRpIgogICAgICB9LCB7CiAgICAgICAgZGlzcGxheV9uYW1lOiAi8J+HtfCfh7kgUG9ydHVndWVzZSIsCiAgICAgICAgdmFsdWU6ICJwdCIsCiAgICAgICAgbGFuZzogInBvcnR1Z3Vlc2UiCiAgICAgIH1dLAogICAgICBsYW5ndWFnZV9jb2RlOiBudWxsIC8vdG91cl9ndWlkZV9pY29uOiByZXF1aXJlKCJAL3BvcnRhbC9hc3NldHMvaW1nL2luZm9faWNvbi5zdmciKSwKCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgLy8gZ3JhcGhfMl9iYXJfY2hhcnRfZHJvcGRvd24oKSB7CiAgICAvLyAgIHRoaXMuYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIC8vICAgLy8gY29uc29sZS5sb2codGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlKQogICAgLy8gICBheGlvcwogICAgLy8gICAgIC5wb3N0KAogICAgLy8gICAgICAgYXBpX2NhbGxzLmJpbGxpbmdfdXNhZ2VfdXJsKCksCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgICBsb2FkX2RhdGFfYnk6IHRoaXMuYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZSwKICAgIC8vICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgICAgfSwKICAgIC8vICAgICAgIH0KICAgIC8vICAgICApCiAgICAvLyAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMgPSBbXTsKICAgIC8vICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudCA9IFtdOwogICAgLy8gICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuTXNnRXhjaGFuZ2UgPSBbXTsKICAgIC8vICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LlRhc2tFeGVjdXRpb24gPSBbXTsKICAgIC8vICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJObyBEYXRhIGF2YWlsYWJsZSIpIHsKICAgIC8vICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgLy8gICAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LmxhYmVscy5wdXNoKGkpOwogICAgLy8gICAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudC5wdXNoKHJlc3BvbnNlLmRhdGFbaV0uQ2FsbENvdW50KTsKICAgIC8vICAgICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5Nc2dFeGNoYW5nZS5wdXNoKHJlc3BvbnNlLmRhdGFbaV0uTXNnRXhjaGFuZ2UpOwogICAgLy8gICAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LlRhc2tFeGVjdXRpb24ucHVzaCgKICAgIC8vICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGFbaV0uVGFza0V4ZWN1dGlvbgogICAgLy8gICAgICAgICAgICk7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KQogICAgLy8gICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgICAvLyB9LAogICAgYmFyX2NoYXJ0X2Ryb3Bkb3duOiBmdW5jdGlvbiBiYXJfY2hhcnRfZHJvcGRvd24odmFsKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKF90eXBlb2YodmFsKSA9PSAnb2JqZWN0JykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID0gdmFsOwogICAgICB9CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5kYXNoYm9hcmRfY2hhcnRfdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBsb2FkX2RhdGFfYnk6IHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5CSUxMSU5HX0NIQVJULk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczQudXBkYXRlX2NoYXJ0X2RhdGEocmVzcG9uc2UuZGF0YS5kYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlX2NoYXJ0X2RhdGE6IGZ1bmN0aW9uIHVwZGF0ZV9jaGFydF9kYXRhKG1lc3NhZ2UpIHsKICAgICAgdGhpcy5BUElfZGF0YS5sYWJlbHMgPSBbXTsKICAgICAgdGhpcy5BUElfZGF0YS5TdWNjZXNzZnVsID0gW107CiAgICAgIHRoaXMuQVBJX2RhdGEuVG90YWwgPSBbXTsKICAgICAgdGhpcy5BUElfZGF0YS5VbnN1Y2Nlc3NmdWwgPSBbXTsKCiAgICAgIGlmICh0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTW9udGhseSBiaWxsaW5nIGN5Y2xlJykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2JpbGxpbmdfY3ljbGUnKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTGFzdCA3IGRheXMnKSB7CiAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWVfc2hvdyA9IHRoaXMudGx0KCdkYXNoYm9hcmRfbGFzdF9zZXZlbicpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID09ICdMYXN0IDMwIGRheXMnKSB7CiAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWVfc2hvdyA9IHRoaXMudGx0KCdkYXNoYm9hcmRfbGFzdF8zMCcpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID09ICdMYXN0IDMgbW9udGhzJykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3RfM19tb250aCcpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID09ICdMYXN0IDkgbW9udGhzJykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3RfOV9tb250aCcpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3RfMTJfbW9udGgnKTsKICAgICAgfQoKICAgICAgaWYgKG1lc3NhZ2UgPT0gIk5vIERhdGEgYXZhaWxhYmxlIikge30gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiBtZXNzYWdlKSB7CiAgICAgICAgICB0aGlzLkFQSV9kYXRhLmxhYmVscy5wdXNoKGkpOwogICAgICAgICAgdGhpcy5BUElfZGF0YS5TdWNjZXNzZnVsLnB1c2gobWVzc2FnZVtpXS5TdWNjZXNzZnVsKTsKICAgICAgICAgIHRoaXMuQVBJX2RhdGEuVG90YWwucHVzaChtZXNzYWdlW2ldLlRvdGFsKTsKICAgICAgICAgIHRoaXMuQVBJX2RhdGEuVW5zdWNjZXNzZnVsLnB1c2gobWVzc2FnZVtpXS5VbnN1Y2Nlc3NmdWwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdvX3RvX3BhZ2U6IGZ1bmN0aW9uIGdvX3RvX3BhZ2UocGFnZV9uYW1lKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgaWYgKHBhZ2VfbmFtZSA9PSAiVmVyaWZ5IFJlc3BvbnNlcyBVbmFuc3dlcmVkIikgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6ICJWZXJpZnkgQm90IFJlc3BvbnNlIiwKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBtb2RhbF9vcGVuX3N3aXRjaF90YWI6IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9uYW1lID09ICJTeW5vbnltcyIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnZGFzaGJvYXJkX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZGFzaGJvYXJkX3RyYWluX21vZGVsX21zZycpLAogICAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2Rhc2hib2FyZF9zd2FsX2NvbmZpcm1fbXNnJyksCiAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRyYWluX2ludGVudF9uZXJfbW9kZWwoKSwgewogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIHVwZGF0ZV9tb2RlbDogdHJ1ZSwKICAgICAgICAgICAgICB1cGRhdGVfbW9kZWxfc3RhdHVzOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJ3YW50X21vZGVsX3N0YXR1cyIsIHRydWUpOwoKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczUuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNS50bHQoJ2Rhc2hib2FyZF9pbnRlcm5hbF9zZXJ2ZXJfbXNnJykpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNS50bHQoJ3NvbWVfZXJyb3JfcGxlYXNlX3RyeV9hZ2FpbicsICdjb2RlJykpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25hbWUgPT0gIlByb2R1Y3RzIikgewogICAgICAgICQoIiNzdG9yZV9jb25maWciKS5tb2RhbCgnc2hvdycpOwogICAgICAgIHRoaXMubG9hZF9wcm9kdWN0X3NldHRpbmdzKCk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9uYW1lID09ICJBY2NvdW50cyIpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAnU2V0dGluZ3MnLAogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6IHBhZ2VfbmFtZSwKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBtb2RhbF9vcGVuX3N3aXRjaF90YWI6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGludGVudHNfY291bnRfZnVuY3Rpb246IGZ1bmN0aW9uIGludGVudHNfY291bnRfZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIHN0YXJ0VGltZXN0YW1wID0gbnVsbDsKICAgICAgdmFyIGR1cmF0aW9uID0gMjAwMDsKICAgICAgdmFyIGVuZCA9IHRoaXMuaW50ZW50X2NvdW50OwogICAgICB2YXIgc3RhcnQgPSAwOwoKICAgICAgdmFyIHN0ZXAgPSBmdW5jdGlvbiBzdGVwKHRpbWVzdGFtcCkgewogICAgICAgIGlmICghc3RhcnRUaW1lc3RhbXApIHN0YXJ0VGltZXN0YW1wID0gdGltZXN0YW1wOwogICAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgubWluKCh0aW1lc3RhbXAgLSBzdGFydFRpbWVzdGFtcCkgLyBkdXJhdGlvbiwgMSk7CiAgICAgICAgX3RoaXM2LmludGVudF9jb3VudF9kaXNwbGF5ID0gTWF0aC5mbG9vcihwcm9ncmVzcyAqIChlbmQgLSBzdGFydCkgKyBzdGFydCk7CgogICAgICAgIGlmIChwcm9ncmVzcyA8IDEpIHsKICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwKTsKICAgIH0sCiAgICBsaXN0X2dyb3VwX2R5bmFtaWNfY2xhc3M6IGZ1bmN0aW9uIGxpc3RfZ3JvdXBfZHluYW1pY19jbGFzcyhyb3cpIHsKICAgICAgaWYgKHRoaXMucHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAibGlzdC1ncm91cC1pdGVtLXByaW1hcnkiOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZGFuZ2VyX2l0ZW1fZW50aXRpZXNfbGlzdC5pbmNsdWRlcyhyb3cpKSB7CiAgICAgICAgcmV0dXJuICJsaXN0LWdyb3VwLWl0ZW0tZGFuZ2VyIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmluZm9faXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImxpc3QtZ3JvdXAtaXRlbS1pbmZvIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLnN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAibGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MiOwogICAgICB9CiAgICB9LAogICAgbGlzdF9ncm91cF9keW5hbWljX3R5cGU6IGZ1bmN0aW9uIGxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJvdykgewogICAgICAvKioKICAgICAgICAqIEBwYXJhbS0gcm93IGRldGVybWluZXMgd2hpY2ggbGlzdCBncm91IHBpdCBiZWxvbmdzIHRvLgogICAgICAgICogQHJldHVybnMtIHRoZSByZXNwZWN0aXZlIGxpc3QgaXRlbSBjb2xvdXIgcHJlZml4ZWQgd2l0aCBhbHBoYWJldCBmb3IgZWFzeSBzb3J0aW5nIGFzIHBlciBvdXIgcmVxdWlyZW1lbnQKICAgICAgKi8KICAgICAgaWYgKHRoaXMucHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiZC1wcmltYXJ5IjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYS1kYW5nZXIiOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaW5mb19pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYi1pbmZvIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLnN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYy1zdWNjZXNzIjsKICAgICAgfQogICAgfSwKICAgIGRpc3BsYXlfbGlzdF9keW5hbWljX2NsYXNzOiBmdW5jdGlvbiBkaXNwbGF5X2xpc3RfZHluYW1pY19jbGFzcygpIHsKICAgICAgaWYgKHRoaXMuZGlzcGxheV9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gInBhZGRpbmc6IDIwcHggMjVweDsiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAicGFkZGluZzogMTBweCAyNXB4OyI7CiAgICAgIH0KICAgIH0sCiAgICBjb25maWd1cmVfcHJvZHVjdF9zZXR0aW5nczogZnVuY3Rpb24gY29uZmlndXJlX3Byb2R1Y3Rfc2V0dGluZ3MoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMudmFsaWRFbWFpbCAhPSB0cnVlKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZGFzaGJvYXJkX3ZhbGlkX2VtYWlsX3RleHQnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5jdXJyZW5jeV9jb2RlID09ICcnKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZGFzaGJvYXJkX2Jhc2VfY3VycmVuY3lfdGV4dCcpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc19lbWFpbF9yZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIGVtYWlsX3JlcXVpcmVkOiB7CiAgICAgICAgICAgIGNvbnRhY3RfaGVscF9lbWFpbDogdGhpcy5jb250YWN0X3VzX2VtYWlsLAogICAgICAgICAgICBiYXNlX2N1cnJlbmN5OiB0aGlzLmN1cnJlbmN5X2NvZGUsCiAgICAgICAgICAgICJzaG9wX3NldHRpbmdzX3NhdmVkIjogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAkKCIjc3RvcmVfY29uZmlnIikubW9kYWwoJ2hpZGUnKTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSkgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdkYXNoYm9hcmRfY2hhbmdlc19zYXZlZF90ZXh0JyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiA0MDAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXM3LmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgICBfdGhpczcuZGFzaGJvYXJkX2RldGFpbHMoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ2Rhc2hib2FyZF9pbnRlcm5hbF9zZXJ2ZXJfZXJyb3InKSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM3LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM3LnRsdCgnc29tZV9lcnJvcl9vY2N1cnJlZF9tc2cnLCAnY29kZScpKTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGU6IGZ1bmN0aW9uIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICB0aGlzLmNvbnRhY3RfdXNfZW1haWwgPSAnJzsKICAgICAgdGhpcy5lbWFpbF9yZXF1aXJlZCA9IGZhbHNlOwogICAgICB0aGlzLmN1cnJlbmN5X2NvZGUgPSAiIjsKICAgIH0sCiAgICBkYXNoYm9hcmRfZGV0YWlsczogZnVuY3Rpb24gZGFzaGJvYXJkX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5kYXNoYm9hcmRfYm90X2RldGFpbHNfY291bnQoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgcG9ydGFsX2xhbmc6IHRoaXMuJHNlc3Npb24uZ2V0KCJQcmVmZXJyZWRMYW5ndWFnZSIpLAogICAgICAgIGlzX2dldDogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIF90aGlzOC5kaXNwbGF5X2xpc3QgPSBbXTsKICAgICAgICBfdGhpczgucGVybWlzc2lvbl9saXN0ID0gW107CgogICAgICAgIGZvciAodmFyIGkgaW4gX3RoaXM4LiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKSkgewogICAgICAgICAgX3RoaXM4LnBlcm1pc3Npb25fbGlzdC5wdXNoKF90aGlzOC4kc2Vzc2lvbi5nZXQoIkNoYXRib3RNZW51IilbaV0ubWFpbl9tZW51Lm5hbWUpOwoKICAgICAgICAgIGZvciAodmFyIGogaW4gX3RoaXM4LiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKVtpXS5zdWJfbWVudV9saXN0KSB7CiAgICAgICAgICAgIF90aGlzOC5wZXJtaXNzaW9uX2xpc3QucHVzaChfdGhpczguJHNlc3Npb24uZ2V0KCJDaGF0Ym90TWVudSIpW2ldLnN1Yl9tZW51X2xpc3Rbal0ubmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICB2YXIgdmVyaWZ5X2JvdF9yZXNwb25zZSA9IGZhbHNlLAogICAgICAgICAgICAgIHN0b3JlX3NldHRpbmdzID0gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIgbiBpbiBfdGhpczgucGVybWlzc2lvbl9saXN0KSB7CiAgICAgICAgICAgIGlmIChfdGhpczgucGVybWlzc2lvbl9saXN0W25dID09ICJWZXJpZnkgQm90IFJlc3BvbnNlIikgewogICAgICAgICAgICAgIHZlcmlmeV9ib3RfcmVzcG9uc2UgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX3RoaXM4LnBlcm1pc3Npb25fbGlzdFtuXSA9PT0gIlN0b3JlIikgewogICAgICAgICAgICAgIHN0b3JlX3NldHRpbmdzID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEpIHsKICAgICAgICAgICAgdmFyIHB1c2hlZCA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBfdGhpczgucGVybWlzc2lvbl9saXN0KSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PSBfdGhpczgucGVybWlzc2lvbl9saXN0W2pdKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5saXN0X2JlbG9uZyA9IF90aGlzOC5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpOwoKICAgICAgICAgICAgICAgIF90aGlzOC5kaXNwbGF5X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXSk7CgogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh2ZXJpZnlfYm90X3Jlc3BvbnNlID09IHRydWUgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09ICJWZXJpZnkgUmVzcG9uc2VzIFVuYW5zd2VyZWQiKSB7CiAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSBfdGhpczgubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KTsKCiAgICAgICAgICAgICAgICBfdGhpczguZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwoKICAgICAgICAgICAgICAgIHZlcmlmeV9ib3RfcmVzcG9uc2UgPSBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzdG9yZV9zZXR0aW5ncyA9PSB0cnVlICYmIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PSAiUHJvZHVjdHMiKSB7CiAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSBfdGhpczgubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KTsKCiAgICAgICAgICAgICAgICBfdGhpczguZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwoKICAgICAgICAgICAgICAgIHN0b3JlX3NldHRpbmdzID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXB1c2hlZCkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkgPT09ICJUcmFpbmluZyIpIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gX3RoaXM4Lmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSk7CgogICAgICAgICAgICAgICAgX3RoaXM4LmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKTsKCiAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFwdXNoZWQpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09PSAiU3lub255bXMiKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5saXN0X2JlbG9uZyA9IF90aGlzOC5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpOwoKICAgICAgICAgICAgICAgIF90aGlzOC5kaXNwbGF5X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXSk7CgogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghcHVzaGVkKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PT0gIkFjY291bnRzIikgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSBfdGhpczgubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KTsKCiAgICAgICAgICAgICAgICBfdGhpczguZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwoKICAgICAgICAgICAgICAgIHB1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM4LmRpc3BsYXlfbGlzdC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLmxpc3RfYmVsb25nID4gYi5saXN0X2JlbG9uZyA/IDEgOiAtMTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbG9hZF9wcm9kdWN0X3NldHRpbmdzOiBmdW5jdGlvbiBsb2FkX3Byb2R1Y3Rfc2V0dGluZ3MoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgdGhpcy5jb250YWN0X3VzX2VtYWlsID0gJyc7CiAgICAgIHRoaXMuZW1haWxfcmVxdWlyZWQgPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW5jeV9jb2RlID0gIiI7CiAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wcm9kdWN0X3NldHRpbmdzKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzX2dldDogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM5LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgdmFyIHdlYmZyYW1ld29yayA9IF90aGlzOS5yZXRhaWxfd2ViX2ZyYW1ld29yazsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczkuY29udGFjdF91c19lbWFpbCA9IHJlc3BvbnNlLmRhdGEuZGF0YVt3ZWJmcmFtZXdvcmsgKyAnX2RldGFpbHMnXS5jb250YWN0X2hlbHBfZW1haWw7CiAgICAgICAgICBfdGhpczkuZW1haWxfcmVxdWlyZWQgPSByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10ub3JkZXJfcmV0cmlldmFsX29ubHlfZW1haWxfcmVxdWlyZWQ7CiAgICAgICAgICBfdGhpczkuY3VycmVuY3lfY29kZSA9IHJlc3BvbnNlLmRhdGEuZGF0YVt3ZWJmcmFtZXdvcmsgKyAnX2RldGFpbHMnXS5iYXNlX2N1cnJlbmN5OwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM5LnRsdCgnZGFzaGJvYXJkX2ludGVybmFsX3NlcnZlcl9tc2cxJykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzOS5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczkudGx0KCdzb21lX2Vycm9yX29jY3VycmVkX21zZycsICdjb2RlJykpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9tZXRyaWNzX2RhdGE6IGZ1bmN0aW9uIGdldF9tZXRyaWNzX2RhdGEoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX21ldHJpY3MoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBpc19nZXQ6IHRoaXMubGluZV9jaGFydF9kcm9wZG93bl92YWx1ZSwKICAgICAgICBpc19nZXRfY29udmVyc2F0aW9uX21ldHJpY3M6IHRydWUsCiAgICAgICAgeWVhcjogdGhpcy5jdXJyZW50X3llYXIKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuSU5TVUZGSUNJRU5UX1dIQVRTQVBQX01FVFJJQ1NfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMC5ub3RfZW5vdWdoX2RhdGEgPSB0cnVlOwogICAgICAgICAgX3RoaXMxMC5tb250aGx5X3VzYWdlX2RhdGEgPSBbXTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMC5tb250aGx5X3VzYWdlX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGEuZGF0YTsKICAgICAgICAgIF90aGlzMTAubm90X2Vub3VnaF9kYXRhID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9tZXRyaWNzX3ByaWNlX2RhdGE6IGZ1bmN0aW9uIGdldF9tZXRyaWNzX3ByaWNlX2RhdGEoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX21ldHJpY3MoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBpc19nZXQ6ICdwcmljZScsCiAgICAgICAgaXNfZ2V0X2NvbnZlcnNhdGlvbl9tZXRyaWNzOiB0cnVlLAogICAgICAgIHllYXI6IHRoaXMuY3VycmVudF95ZWFyCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLklOU1VGRklDSUVOVF9XSEFUU0FQUF9NRVRSSUNTX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTEucHJpY2luZ19kYXRhID0gW107CiAgICAgICAgICBfdGhpczExLnByaWNpbmdfZGF0YSA9IFtdOwogICAgICAgICAgX3RoaXMxMS5ub3RfZW5vdWdoX2RhdGEgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczExLnByaWNpbmdfZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhOwogICAgICAgICAgX3RoaXMxMS5saXN0X29mX3llYXIgPSByZXNwb25zZS5kYXRhLmRhdGEueWVhcnM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczExLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbGluZV9jaGFydF9kcm9wZG93bjogZnVuY3Rpb24gbGluZV9jaGFydF9kcm9wZG93bigpIHsKICAgICAgdGhpcy5saW5lX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlOwogICAgICB0aGlzLmdldF9tZXRyaWNzX2RhdGEoKTsKICAgIH0sCiAgICBsaW5lX2NoYXJ0X3llYXJfZHJvcGRvd246IGZ1bmN0aW9uIGxpbmVfY2hhcnRfeWVhcl9kcm9wZG93bigpIHsKICAgICAgdGhpcy5jdXJyZW50X3llYXIgPSBldmVudC50YXJnZXQudmFsdWU7CiAgICAgIHRoaXMuZ2V0X21ldHJpY3NfcHJpY2VfZGF0YSgpOwogICAgICB0aGlzLmdldF9tZXRyaWNzX2RhdGEoKTsKICAgIH0sCiAgICBzYXZlX2xhbmd1YWdlX2NoYXRib3Q6IGZ1bmN0aW9uIHNhdmVfbGFuZ3VhZ2VfY2hhdGJvdCgpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMubGFuZ3VhZ2VfY29kZSA9PSBudWxsKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBsYW5ndWFnZSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGxhbmd1YWdlID0gdGhpcy5sYW5ndWFnZV9jb2RlLmxhbmc7CiAgICAgIHZhciBsYW5nX2NvZGUgPSB0aGlzLmxhbmd1YWdlX2NvZGUudmFsdWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9sYW5ndWFnZV9kYXRhKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIGNoYXRib3RfbGFuZ3VhZ2VfY29kZTogbGFuZ19jb2RlLAogICAgICAgIGNoYXRib3RfbGFuZ3VhZ2U6IGxhbmd1YWdlLAogICAgICAgIHNhdmVfY2hhdGJvdF9sYW5ndWFnZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5MQU5HVUFHRV9VUERBVEVELk1TR19DT0RFKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogIkJvdCBMYW5ndWFnZSBVcGRhdGUgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIHVzZXJpbmZvID0gX3RoaXMxMi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpOwoKICAgICAgICAgIHVzZXJpbmZvWyJpc19zZXRfZGVmYXVsdF9sYW5ndWFnZSJdID0gZmFsc2U7CiAgICAgICAgICB1c2VyaW5mb1siY2hhdGJvdF9sYW5ndWFnZSJdID0gbGFuZ3VhZ2U7CiAgICAgICAgICB1c2VyaW5mb1siY2hhdGJvdF9sYW5ndWFnZV9jb2RlIl0gPSBsYW5nX2NvZGU7CgogICAgICAgICAgX3RoaXMxMi4kc2Vzc2lvbi5zZXQoIlVzZXJJbmZvcm1hdGlvbiIsIHVzZXJpbmZvKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5VTlNVQ0NFU1NGVUxfREJfT1BFUkFUSU9OLk1TR19DT0RFKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogIlVuYWJsZSB0byB1cGRhdGUgQm90IExhbmd1YWdlIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnc2F2ZV9sYW5ndWFnZV9jaGF0Ym90X2J0bicpOwogICAgfQogIH0KfTs="},null]}