{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Newtestbot.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Newtestbot.vue","mtime":1645594423491},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDgtYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50MzItYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5jb3B5LXdpdGhpbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmV2ZXJ5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbHRlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWluZGV4IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubGFzdC1pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZS1yaWdodCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJldmVyc2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zZXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb3J0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc3ViYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1sb2NhbGUtc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IGZpbmdlcnByaW50IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvZmluZ2VycHJpbnQiOwppbXBvcnQgeyBidXMgfSBmcm9tICJAL3BvcnRhbC9tYWluIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBTb2NrZXQgfSBmcm9tICJwaG9lbml4LXNvY2tldCI7CmltcG9ydCB7IHNldFRpbWVvdXQsIHNldEludGVydmFsIH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IFJlY29yZGVyIGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvcmVjb3JkZXIiOwppbXBvcnQgU2Nyb2xsYmFyIGZyb20gInNtb290aC1zY3JvbGxiYXIiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IGRlYm91bmNlIGZyb20gInZ1ZS1kZWJvdW5jZS9zcmMvZGVib3VuY2UiOwppbXBvcnQgY291bnRyeV9jb2RlIGZyb20gIi4uL0Rhc2hib2FyZC9jb3VudHJ5X2NvZGVfZGF0YS5qc29uIjsKaW1wb3J0IENvdW50cnlDb2RlcyBmcm9tICIuLi9EYXNoYm9hcmQvQ291bnRyeUNvZGVzLmpzb24iOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImNsb3NlZC1mb3JtLXJlc3BvbnNlLWJvdCIsCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHBvcHVwX21zZzogIllvdSBjYW4gdHlwZSDigJhSZXN0YXJ04oCdICBhdCA8L2JyPmFueSAgdGltZSB0byBnZXQgYmFjazwvYnI+IHRvIHRoZSBNYWluIE1lbnUiLAogICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiB0cnVlLAogICAgICBxdXNfYW5zOiAiYW5zd2VycyIsCiAgICAgIHRvX3NlbmQ6ICIiLAogICAgICBjZW5zZV9lbnF1aXJ5OiBmYWxzZSwKICAgICAgaXNfdHlwaW5nOiBmYWxzZSwKICAgICAgdXNlcl9uYW1lOiAiIiwKICAgICAgc2hvdzogZmFsc2UsCiAgICAgIGNoYXQ6IFtdLAogICAgICBmaW5nZXJwcmludDogbnVsbCwKICAgICAgYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlOiB0aGlzLiRzZXNzaW9uLmdldCgiUmVzcG9uc2VCb3RUb2tlbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlJlc3BvbnNlQm90VG9rZW4iKSA6ICIiLAogICAgICBmaXJzdF9jbGljazogZmFsc2UsCiAgICAgIGxldmVsOiAwLAogICAgICByZWNvZ25pdGlvbjogbnVsbCwKICAgICAganNvbl9kYXRhOiB7CiAgICAgICAgY3JlYXRlX2FwcG9pbnRtZW50OiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDAwMjM3In0sIlVzZXJOYW1lIjoiYWMiLCJJRCI6IlVTMDAwMDAwMDAwMDAwMDAwMTM4IiwiQWNjb3VudCI6IHsiSUQiOiAiQ08wMDAyMyJ9LCJUb2tlbiI6ICJaMXJTR0dtMFhwTVdqdDNnaUFFclBQV1o4NFRRTjlGc0ZNQkxzVSsvTEF1Nnl1YWxNZzZFUDJic3J3WmpMUHdtM2o0RHBQY0djNUxjSXAzTmpnZlVzQT09IiwiU3BlY2lhbHR5IjogeyJJRCI6ICJQRzAwMDAwMDAwMDAwMDAwMDE0MSIsICJOYW1lIjogIkFDIiwgIkNvZGUiOiAiQUMifSwiRG9tYWluIjogImdvZ3JlZW5iaWxscy5jb20ifSwiQXBwb2ludG1lbnQiOiB7IkRhdGUiOiAiMDgvMzAvMjAxOCIsICJJc0pTT05Ob3RlIjogMCwgIlBhdGllbnQiOiB7IkNhc2VJRCI6ICIifX19JywKICAgICAgICB2aXNpdHNfZmluYWxpemVkOiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDExODg2In0sIlVzZXJOYW1lIjogImNoIiwiSUQiOiAiVVMwMDAwMDAwMDAwMDAwMDAxNDMiLCJBY2NvdW50Ijp7IklEIjoiQ08wMDAyMyJ9LCJUb2tlbiI6ImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSklVekkxTmlKOS5leUoxYzJWeUlqb2lZWFprYUhWMElpd2laWGh3SWpveE5USTVORGd5TmpZemZRLnYxYzBIYnVXdVpYWHBKZkRyWFZjMUhQVnVmZmJuR2NMcWtwZzB6bTZBb1EiLCJTcGVjaWFsdHkiOiB7IklEIjogIlBHMDAwMDAwMDAwMDAwMDAwMTQyIiwiQ29kZSI6ICJjaCJ9LCJEb21haW4iOiAiZ3JlZW55b3VyYmlsbHMuY29tIn0sIlNlYXJjaFBhcmFtZXRlcnMiOiB7IlN0YXR1cyI6ICIiLCJPcmRlckJ5IjogIiIsIkZyb21EYXRlIjogIjAxLzAxLzIwMTgiLCJDb3VudCI6ICIxMCIsIlNlYXJjaFRleHQiOiAiIiwiVHlwZU9mVmlzaXQiOiAiQUxMIiwiU29ydE9yZGVyIjogImFwcG9pbnRtZW50IiwiU3RhcnRJbmRleCI6ICIxIiwiRW5kSW5kZXgiOiAiMTAiLCJUb0RhdGUiOiAiMDgvMDYvMjAxOCJ9fScsCiAgICAgICAgYXBwb2ludG1lbnRzX2NvdW50OiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDExODg2In0sIlVzZXJOYW1lIjogImNoIiwiSUQiOiAiVVMwMDAwMDAwMDAwMDAwMDAxNDMiLCJBY2NvdW50Ijp7IklEIjoiQ08wMDAyMyJ9LCJUb2tlbiI6ImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSklVekkxTmlKOS5leUoxYzJWeUlqb2lZWFprYUhWMElpd2laWGh3SWpveE5USTVORGd5TmpZemZRLnYxYzBIYnVXdVpYWHBKZkRyWFZjMUhQVnVmZmJuR2NMcWtwZzB6bTZBb1EiLCJTcGVjaWFsdHkiOiB7IklEIjogIlBHMDAwMDAwMDAwMDAwMDAwMTQyIiwiQ29kZSI6ICJjaCJ9LCJEb21haW4iOiAiZ3JlZW55b3VyYmlsbHMuY29tIn0sIlNlYXJjaFBhcmFtZXRlcnMiOiB7IlN0YXR1cyI6ICIiLCJPcmRlckJ5IjogIiIsIkZyb21EYXRlIjogIjAxLzAxLzIwMTgiLCJDb3VudCI6ICIxMCIsIlNlYXJjaFRleHQiOiAiIiwiVHlwZU9mVmlzaXQiOiAiQUxMIiwiU29ydE9yZGVyIjogImFwcG9pbnRtZW50IiwiU3RhcnRJbmRleCI6ICIxIiwiRW5kSW5kZXgiOiAiMTAiLCJUb0RhdGUiOiAiMDgvMDYvMjAxOCJ9fScsCiAgICAgICAgY3JlYXRlX3RpY2tldDogJ3siQWNjb3VudE5hbWUiOm51bGwsIkNhbGxiYWNrUGhvbmUiOiIiLCJDb21wYW55SUQiOiJDTzAwMDIzIiwiRGVzY3JpcHRpb24iOiJEZSIsIkRvbWFpbk5hbWUiOm51bGwsIkVtYWlsQ0MiOiJhYmhheS53QGNvZGVhcnJheS50ZWNoIiwiRW1haWxEZWZhdWx0IjoibWFuaXNoLnlAY29kZWFycmF5LnRlY2giLCJQcmlvcml0eSI6IjMiLCJQcmlvcml0eUlEIjowLCJSYWlzZWRCeSI6Imxhd3VzZXIiLCJTdGF0dXMiOjAsIlN0YXR1c0NvZGUiOm51bGwsIlN0YXR1c1RleHQiOm51bGwsIlNUeXBlIjoiV1AiLCJTdWJqZWN0IjoiRGUiLCJTdWJUeXBlIjoiU0FNRC1QIiwiVGlja2V0SUQiOjAsIlRpY2tldE51bWJlciI6bnVsbCwiVHlwZSI6MCwiVHlwZVRleHQiOiJXZWJzaXRlIFByb2JsZW0iLCJsaXN0RmlsZXMxIjpbImNocTEucGRmIl19JywKICAgICAgICBnZXRfcmVwb3J0OiAneyJjb21wYW55SWQiOiAiQ08wMDAyMyJ9JwogICAgICB9LAogICAgICBwaG9uZV9udW1iZXI6ICIiLAogICAgICBzdG9wOiB0cnVlLAogICAgICBkZW1vdXJsYmluZDogZmFsc2UsCiAgICAgIHJldmlld3N1cmxiaW5kOiBmYWxzZSwKICAgICAgcmV2aWV3c3VybDogImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3BhQWVXODZlUVo0IiwKICAgICAgZGVtb3VybDogWyJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9LY3JKbTlVeFczcyZpbmRleD0xMyZsaXN0PVBMX2pYbGloOGRna1RFOENyUHBpV2NBOUt4UWVLSFpBbnQmdD0wcyIsICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9xelMycUlOSTZJTSZsaXN0PVBMX2pYbGloOGRna1J1NWRkR1hBR3FaNHVMTGtvSnpDajgmaW5kZXg9MiJdLAogICAgICBjaGF0X3dpZGdldDogewogICAgICAgIGxvZ286ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgICBzdHlsZTogIiIKICAgICAgfSwKICAgICAgc2VsZWN0ZWRfZGF0ZTogIiIsCiAgICAgIHNlbGVjdGVkX3RpbWU6ICIiLAogICAgICByZWFzb25fb2ZfdmlzaXQ6ICIiLAogICAgICBwYXRpZW50X25hbWU6ICIiLAogICAgICB2aXNpdG9yX251bWJlcjogIiIsCiAgICAgIGZ1bGxfdGltZV9zbG90czogW10sCiAgICAgIHRpbWVfc2xvdHM6IFtdLAogICAgICBUT0RBWV9EQVRFOiAiIiwKICAgICAgY2hhbm5lbDogbnVsbCwKICAgICAgY2hhdF9zb2NrZXQ6IG51bGwsCiAgICAgIHZvaWNlX3NvY2tldDogbnVsbCwKICAgICAgbGl2ZV9jaGF0X29uOiBmYWxzZSwKICAgICAgbGl2ZV9jaGF0X3Rva2VuOiBudWxsLAogICAgICBjaGF0X2dyb3VwX25hbWU6IG51bGwsCiAgICAgIHRvX3Njcm9sbDogZmFsc2UsCiAgICAgIGZvcm1fcGF5bG9hZDogbnVsbCwKICAgICAgcmVmcmVzaF90aW1lOiAwLAogICAgICBwaG9uZV9udW1iZXJfdmFsaWRpdHk6IC9bMC05XXsxMCwxMX0kLywKICAgICAgZW1wdHlfc3RyaW5nX3ZhbGlkaXR5OiAvXiQvLAogICAgICAvL2hhcnNoCiAgICAgIGlzZXhjaGFuZ2U6IGZhbHNlLAogICAgICBjdXJyZW5jeWV4Y2hhbmdlX2xpc3Q6IG51bGwsCiAgICAgIHNlbGVjdGVkX2luZGljYXRpb246IFtdLAogICAgICByZXM6IHt9LAogICAgICBpc2Nsb3NlZGJvdG9uOiBmYWxzZSwKICAgICAgaXNmb3Jtb246IGZhbHNlLAogICAgICBmb3JtX25hbWU6IG51bGwsCiAgICAgIGxhc3RjbG9zZWRib3RpbnB1dG5vZGU6IG51bGwsCiAgICAgIGNsb3NlZF9mb3JtX3JlcGx5X2RhdGE6IG51bGwsCiAgICAgIHNlbGVjdGVkbm9kZWlkOiBudWxsLAogICAgICBib3RfbmFtZTogbnVsbCwKICAgICAgYm90X3R5cGU6IG51bGwsCiAgICAgIGlmZmlyc3R0aW1lOiB0cnVlLAogICAgICBpc2VtYWlsOiBmYWxzZSwKICAgICAgaXNfcGhvbmVfbnVtYmVyOiBmYWxzZSwKICAgICAgaXNfdGV4dF9hcmVhOiBmYWxzZSwKICAgICAgY29udmVyc2F0aW9uX2lkOiAiIiwKICAgICAgaXNfcGhvbmVfbnVtYmVyX290cDogZmFsc2UsCiAgICAgIG5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXI6IG51bGwsCiAgICAgIGlzX3Bob25lX251bWJlcl9lcnJfbXNnOiBmYWxzZQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuY29udmVyc2F0aW9uX2lkID0gdGhpcy5nZW5lcmF0ZVVVSUQoKTsKICAgIHRoaXMuJHNlc3Npb24uc3RhcnQoKTsKICAgIHRoaXMuJHNlc3Npb24uc2V0KCJjb252ZXJzYXRpb25faWQiLCB0aGlzLmNvbnZlcnNhdGlvbl9pZCk7IC8vIGNvbnNvbGUubG9nKGNvdW50cnlfY29kZSk7CiAgICAvLyBjb25zb2xlLmxvZyhKU09OLnBhcnNlKGNvdW50cnlfY29kZSkpOwoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIikpIHsvLyB0aGlzLmNoYXQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIik7CiAgICB9CgogICAgaWYgKCF0aGlzLiRzZXNzaW9uLmhhcygiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIpKSB7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLCB7CiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC50aXRsZSA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0VGl0bGU7CiAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9IHJlc3BvbnNlLmRhdGEuSW1hZ2VVcmw7CgogICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIsIF90aGlzLmNoYXRfd2lkZ2V0KTsKCiAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQuc3R5bGUgPSAibWFyZ2luLXRvcDogNXB4O2hlaWdodDozMHB4O3dpZHRoOmF1dG8iOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChfdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSA9PSAiZ29neWIiKSB7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6NjBweCI7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5sb2dvID0gIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIjsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lID09ICJNVCBDYXJlIikgewogICAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9ICIvaW1nL3JvYm9tYXRlX2xvZ28ucG5nIjsKICAgICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LnN0eWxlID0gIm1hcmdpbi10b3A6IDVweDtoZWlnaHQ6NTBweDt3aWR0aDo5NXB4IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9ICIvaW1nL2NlbnNlX2ltYWdlLnBuZyI7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6NjBweCI7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy4kc2Vzc2lvbi5zZXQoIkNoYXRCb3RJbWFnZVBhcmFtZXRlcnMiLCBfdGhpcy5jaGF0X3dpZGdldCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jaGF0X3dpZGdldCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDaGF0Qm90SW1hZ2VQYXJhbWV0ZXJzIik7CiAgICAgIHRoaXMuY2hhdF93aWRnZXQuc3R5bGUgPSAibWFyZ2luLXRvcDogNXB4O2hlaWdodDozMHB4O3dpZHRoOmF1dG8iOwogICAgfQoKICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIlJlc3BvbnNlQm90VG9rZW4iKSkgewogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ib3RfcmVzcG9uc2VfdG9rZW4oKSwgewogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgiUmVzcG9uc2VCb3RUb2tlbiIsIHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICBfdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICBfdGhpcy5yZWZyZXNoX2NoYXRib3QoKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnJlZnJlc2hfY2hhdGJvdCgpOwogICAgfSAvL2hhcnNoCgoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkgPT0gIi5lSnhUY3NzdlNzMU16NnRJemtqTVMwODFORGV4TklRS0tVREZNa3BLQ29xdDlQWEx5OHYxMGxCVTZ5WG41LW9sbHVvYkdSaGE2aHFZNnhxWUtCZ2FXQmtaVzVtYTZobWJtNWdZbVNvQkFHYTlIcDAuWFIzVHV3Llg3N0ZfN0xEdE9McDJWdDlzbkZEU28zMW5UdyIpIHsKICAgICAgdGhpcy5pc2V4Y2hhbmdlID0gdHJ1ZTsKICAgIH0KCiAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ib3RfdXNlcl9kYXRhKCksIHsKICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgdHo6IEludGwuRGF0ZVRpbWVGb3JtYXQoKS5yZXNvbHZlZE9wdGlvbnMoKS50aW1lWm9uZSwKICAgICAgZGF0ZXRpbWU6IGQudG9JU09TdHJpbmcoKSwKICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHt9KTsKCiAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmJvdGRhdGEgPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAnRGFzaGJvYXJkJwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYm90X25hbWUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuYm90ZGF0YS5ib3RfbmFtZTsKICAgICAgdGhpcy5ib3RfdHlwZSA9IHRoaXMuJHJvdXRlLnBhcmFtcy5ib3RkYXRhLmJvdF90eXBlOyAvLyBheGlvcwogICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSx7CiAgICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAvLyAgICAgdWlkOiAiY2xvc2VkX2Zvcm1fdXNlciIsCiAgICAgIC8vICAgICBjaGF0OiBudWxsLAogICAgICAvLyAgICAgbm9kZV9zZWxlY3RlZDogbnVsbCwKICAgICAgLy8gICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lLAogICAgICAvLyAgIH0pCiAgICAgIC8vICAgLnRoZW4ocmVzcG9uc2U9PnsKICAgICAgLy8gICAgIGlmKHJlc3BvbnNlLmRhdGEuZXJyb3I9PXVuZGVmaW5lZCl7CiAgICAgIC8vICAgICAgIHRoaXMuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAvLyAgICAgICB0aGlzLmlzY2xvc2VkYm90b249dHJ1ZTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICBDb3VudHJ5Q29kZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICBpZiAoYS5jb2RlIDwgYi5jb2RlKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CgogICAgICBpZiAoYS5jb2RlID4gYi5jb2RlKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfSk7CiAgICB0aGlzLnNob3cgPSBmYWxzZTsKCiAgICBpZiAodGhpcy4kcm91dGUubmFtZSA9PSAiVHJhaW4gdGhlIEJvdCIpIHsKICAgICAgJCgiLmNoYXQtd3JhcCIpLmNzcygicmlnaHQiLCAiYXV0byIpOwogICAgfQoKICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09ICJEaXJlY3QgUmVzcG9uc2UgQm90IikgewogICAgICAkKCIuY2hhdC13cmFwIikuY3NzKCJtYXJnaW5Ub3AiLCAiNSUiKTsKICAgIH0KCiAgICAkKCdbZGF0YS10b2dnbGU9InBvcG92ZXIiXScpLnBvcG92ZXIoewogICAgICBodG1sOiB0cnVlLAogICAgICBjb250ZW50OiAkKCIjcG9wb3Zlcl9jb250ZW50IikKICAgIH0pLm9uKCJzaG93LmJzLnBvcG92ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ibG9jayIpOwogICAgfSkub24oImhpZGUuYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmFkZENsYXNzKCJkLW5vbmUiKTsKICAgIH0pOwogICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmNzcygiekluZGV4IiwgOTk5OSk7CiAgICBidXMuJG9uKCJMb2dvdXQgaGFzIGJlZW4gY2xpY2tlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09ICJUcnVlIikgewogICAgICAgICQoJ1tkYXRhLXRvZ2dsZT0icG9wb3ZlciJdJykucG9wb3ZlcigiaGlkZSIpOwogICAgICB9CiAgICB9KTsKICAgIHdpbmRvdy5TcGVlY2hSZWNvZ25pdGlvbiA9IHdpbmRvdy53ZWJraXRTcGVlY2hSZWNvZ25pdGlvbiB8fCB3aW5kb3cuU3BlZWNoUmVjb2duaXRpb247CiAgICB3aW5kb3cuQXVkaW9Db250ZXh0ID0gd2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0OwogICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgfHwgbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSB8fCBuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhIHx8IG5hdmlnYXRvci5tc0dldFVzZXJNZWRpYTsKICB9LAogIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQoKSB7CiAgICB0aGlzLnN1Ym1pdF9jdXN0b21fZm9ybSgpOwoKICAgIGlmICh0aGlzLmlzY2xvc2VkYm90b24gJiYgdGhpcy5pc2Zvcm1vbikgewogICAgICB0aGlzLnN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhKCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZW5lcmF0ZVVVSUQ6IGZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHsKICAgICAgLy8gUHVibGljIERvbWFpbi9NSVQKICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgLy9UaW1lc3RhbXAKCiAgICAgIHZhciBkMiA9IHBlcmZvcm1hbmNlICYmIHBlcmZvcm1hbmNlLm5vdyAmJiBwZXJmb3JtYW5jZS5ub3coKSAqIDEwMDAgfHwgMDsgLy9UaW1lIGluIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgb3IgMCBpZiB1bnN1cHBvcnRlZAoKICAgICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAxNjsgLy9yYW5kb20gbnVtYmVyIGJldHdlZW4gMCBhbmQgMTYKCiAgICAgICAgaWYgKGQgPiAwKSB7CiAgICAgICAgICAvL1VzZSB0aW1lc3RhbXAgdW50aWwgZGVwbGV0ZWQKICAgICAgICAgIHIgPSAoZCArIHIpICUgMTYgfCAwOwogICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy9Vc2UgbWljcm9zZWNvbmRzIHNpbmNlIHBhZ2UtbG9hZCBpZiBzdXBwb3J0ZWQKICAgICAgICAgIHIgPSAoZDIgKyByKSAlIDE2IHwgMDsKICAgICAgICAgIGQyID0gTWF0aC5mbG9vcihkMiAvIDE2KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAoYyA9PT0gJ3gnID8gciA6IHIgJiAweDMgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgfSk7CiAgICB9LAogICAgdm9pY2VfY29tbXVuaWNhdGlvbjogZnVuY3Rpb24gdm9pY2VfY29tbXVuaWNhdGlvbigpIHsKICAgICAgaWYgKC9DaHJvbWl1bS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICB0aGlzLmNhbGxfY2xvdWRfYXBpKCk7CiAgICAgIH0gZWxzZSBpZiAod2luZG93LlNwZWVjaFJlY29nbml0aW9uICE9IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucmVjb2duaXRpb24gPSBuZXcgd2luZG93LlNwZWVjaFJlY29nbml0aW9uKCk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QuYWRkKCJ2b2ljZS1vbiIpOwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLm9ucmVzdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBzcGVlY2hUb1RleHQgPSBlLnJlc3VsdHNbMF1bMF0udHJhbnNjcmlwdDsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLm9uZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QucmVtb3ZlKCJ2b2ljZS1vbiIpOyAvL0FnYWluIOKAkyBnaXZlIHRoZSB1c2VyIGZlZWRiYWNrIHRoYXQgeW91IGFyZSBub3QgbGlzdGVuaW5nIGFueW1vcmUuIElmIHlvdSB3aXNoIHRvIGFjaGlldmUgY29udGludW91cyByZWNvZ25pdGlvbiDigJMgeW91IGNhbiB3cml0ZSBhIHNjcmlwdCB0byBzdGFydCB0aGUgcmVjb2duaXplciBhZ2FpbiBoZXJlLgogICAgICAgIH07CgogICAgICAgIHZhciB2bSA9IHRoaXM7CgogICAgICAgIHRoaXMucmVjb2duaXRpb24ub25yZXN1bHQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnQucmVzdWx0cyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgLy9Tb21ldGhpbmcgaXMgd3JvbmfigKYKICAgICAgICAgICAgdGhpcy5yZWNvZ25pdGlvbi5zdG9wKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpID0gZXZlbnQucmVzdWx0SW5kZXg7IGkgPCBldmVudC5yZXN1bHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChldmVudC5yZXN1bHRzW2ldLmlzRmluYWwpIHsKICAgICAgICAgICAgICAvL0ZpbmFsIHJlc3VsdHMKICAgICAgICAgICAgICB2bS50b19zZW5kID0gZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJmaW5hbCByZXN1bHRzOiAiICsgZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0KTsgLy9PZiBjb3Vyc2Ug4oCTIGhlcmUgaXMgdGhlIHBsYWNlIHRvIGRvIHVzZWZ1bCB0aGluZ3Mgd2l0aCB0aGUgcmVzdWx0cy4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvL2kuZS4gaW50ZXJpbS4uLgogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnRlcmltIHJlc3VsdHM6ICIgKyBldmVudC5yZXN1bHRzW2ldWzBdLnRyYW5zY3JpcHQpOyAvL1lvdSBjYW4gdXNlIHRoZXNlIHJlc3VsdHMgdG8gZ2l2ZSB0aGUgdXNlciBuZWFyIHJlYWwgdGltZSBleHBlcmllbmNlLgogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vZW5kIGZvciBsb29wCgogICAgICAgIH07CgogICAgICAgIHRoaXMucmVjb2duaXRpb24uc3RhcnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbGxfY2xvdWRfYXBpKCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsX2Nsb3VkX2FwaTogZnVuY3Rpb24gY2FsbF9jbG91ZF9hcGkoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QuYWRkKCJ2b2ljZS1vbiIpOwogICAgICB2YXIgYXVkaW9Db250ZXh0ID0gbmV3ICh3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQpKCk7CiAgICAgIHZhciBidWZmZXJfbGlzdCwgYnVmZmVyX2kzMjsKICAgICAgdmFyIHJlY29yZGVyID0gbmV3IFJlY29yZGVyKGF1ZGlvQ29udGV4dCwgewogICAgICAgIC8vIEFuIGFycmF5IG9mIDI1NSBOdW1iZXJzCiAgICAgICAgLy8gWW91IGNhbiB1c2UgdGhpcyB0byB2aXN1YWxpemUgdGhlIGF1ZGlvIHN0cmVhbQogICAgICAgIC8vIElmIHlvdSB1c2UgcmVhY3QsIGNoZWNrIG91dCByZWFjdC13YXZlLXN0cmVhbQogICAgICAgIG9uQW5hbHlzZWQ6IGZ1bmN0aW9uIG9uQW5hbHlzZWQoZGF0YSkge30KICAgICAgfSk7CiAgICAgIHZhciB2b2ljZV9jaGFubmVsLAogICAgICAgICAgd2F2X3BhcmFtZXRlcnMsCiAgICAgICAgICByZWNCdWZmZXJzID0gW10sCiAgICAgICAgICByZWNMZW5ndGgsCiAgICAgICAgICBtZXRhX2RhdGE7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGF4aW9zLmdldChhcGlfY2FsbHMudm9pY2VfY2hhbm5lbF9hcGkoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIudm9pY2Vfc29ja2V0ID0gbmV3IFNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBjb21wYW55OiBfdGhpczIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIHZvaWNlX2NoYW5uZWxfbmFtZTogcmVzcG9uc2UuZGF0YS52b2ljZV9jaGFubmVsX25hbWUsCiAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5kYXRhLnRva2VuLAogICAgICAgICAgICBpc192b2ljZTogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBfdGhpczIudm9pY2Vfc29ja2V0LmNvbm5lY3QoKTsKCiAgICAgICAgdm9pY2VfY2hhbm5lbCA9IF90aGlzMi52b2ljZV9zb2NrZXQuY2hhbm5lbCgidm9pY2VfdG9fdGV4dDoiICsgcmVzcG9uc2UuZGF0YS52b2ljZV9jaGFubmVsX25hbWUpOwogICAgICAgIHZvaWNlX2NoYW5uZWwuam9pbigpOwogICAgICB9KTsKICAgICAgdmFyIGJsb2IgPSBudWxsOwogICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgYXVkaW86IHRydWUKICAgICAgfSkudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmVjb3JkZXIuaW5pdChzdHJlYW0pOwogICAgICAgIHN0YXJ0UmVjb3JkaW5nKCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICByZXR1cm4gY29uc29sZS5sb2coIlVoIG9oLi4uIHVuYWJsZSB0byBnZXQgc3RyZWFtLi4uIiwgZXJyKTsKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBzdGFydFJlY29yZGluZygpIHsKICAgICAgICByZWNvcmRlci5zdGFydCgpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgc3RvcFJlY29yZGluZygpOwogICAgICAgIH0sIDQwMDApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzdG9wUmVjb3JkaW5nKCkgewogICAgICAgIHJlY29yZGVyLnN0b3AoKS50aGVuKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgYmxvYiA9IF9yZWYuYmxvYiwKICAgICAgICAgICAgICBidWZmZXIgPSBfcmVmLmJ1ZmZlcjsKICAgICAgICAgIC8vIGJ1ZmZlcl9saXN0ID0gYnVmZmVyWzBdOwogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7CgogICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYnVmZmVyX2xpc3QgPSByZWFkZXIucmVzdWx0OwogICAgICAgICAgICB2YXIgdGVtcCA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcl9saXN0KTsKICAgICAgICAgICAgd2F2X3BhcmFtZXRlcnMgPSB3YXZfZmlsZV9wcm9jZXNzaW5nX3JlYWRfcGFyYW1ldGVycyh0ZW1wKTsKICAgICAgICAgICAgaW5pdF9lbmNvZGVyKGJ1ZmZlcl9saXN0KTsKICAgICAgICAgIH07IC8vIFJlY29yZGVyLmRvd25sb2FkKGJsb2IsICJteS1maWxlIik7CiAgICAgICAgICAvLyBidWZmZXIgaXMgYW4gQXVkaW9CdWZmZXIKCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGluaXRfZW5jb2RlcihkYXRhKSB7CiAgICAgICAgdmFyIGFycmF5QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgICAgICAgdmFyIGVuY0RhdGEgPSBbXTsKICAgICAgICB2YXIgcmVzdWx0ID0gZW5jb2RlRmxhYyhhcnJheUJ1ZmZlciwgZW5jRGF0YSk7IC8vIGNvbnNvbGUubG9nKCJlbmNvZGVkIGRhdGEgYXJyYXk6ICIsIGVuY0RhdGEpOwoKICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJDb252ZXJzaW9uIGZhaWxlZCEhIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWV0YURhdGEgPSByZXN1bHQubWV0YURhdGE7CgogICAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7CiAgICAgICAgICAvL3VzaW5nIGRhdGEtdXRpbC5qcyB1dGlsaXR5IGZ1bmN0aW9uKHMpCiAgICAgICAgICB2YXIgYmxvYl9kb3dubG9hZCA9IGV4cG9ydEZsYWNGaWxlKGVuY0RhdGEsIG1ldGFEYXRhKTsgLy8gdmFyIGRvd25fZmlsZSA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYl9kb3dubG9hZCk7CiAgICAgICAgICAvLyBsZXQgZmlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIC8vIGZpbGUuaHJlZiA9IGRvd25fZmlsZTsKICAgICAgICAgIC8vIGZpbGUuZG93bmxvYWQgPSAib3V0cHV0LmZsYWMiOwogICAgICAgICAgLy8gZmlsZS5jbGljaygpCgogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iX2Rvd25sb2FkKTsKCiAgICAgICAgICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcmVhZGVyX3N0cmluZyA9IHJlYWRlci5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgICAgICAgdm9pY2VfY2hhbm5lbC5wdXNoKCJ2b2ljZV9wYWNrZXRzX3NlbnQiLCB7CiAgICAgICAgICAgICAgc3RyZWFtOiByZWFkZXJfc3RyaW5nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2b2ljZV9jaGFubmVsLm9uKCJ2b2ljZV90b190ZXh0X3JlcGx5IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbWljcm9waG9uZSIpLmNsYXNzTGlzdC5yZW1vdmUoInZvaWNlLW9uIik7CgogICAgICAgICAgICAgIGlmIChkYXRhLnRleHQucmVzdWx0cyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZtLnRvX3NlbmQgPSBkYXRhLnRleHQucmVzdWx0c1swXS5hbHRlcm5hdGl2ZXNbMF0udHJhbnNjcmlwdDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJXZSBjb3VsZCBub3QgcmVjb2duaXplIHlvdXIgdm9pY2UuIFBsZWFzZSB0cnkgYWdhaW4gb3IgdHlwZSBpbi4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZtLmJ1dHRvbl9maWxsKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGVuY29kZUZsYWMoYmluRGF0YSwgcmVjQnVmZmVycykgewogICAgICAgIHZhciB1aThfZGF0YSA9IG5ldyBVaW50OEFycmF5KGJpbkRhdGEpOwogICAgICAgIHZhciBzYW1wbGVfcmF0ZSA9IDAsCiAgICAgICAgICAgIGNoYW5uZWxzID0gMCwKICAgICAgICAgICAgYnBzID0gMCwKICAgICAgICAgICAgdG90YWxfc2FtcGxlcyA9IDAsCiAgICAgICAgICAgIGJsb2NrX2FsaWduLAogICAgICAgICAgICBwb3NpdGlvbiA9IDAsCiAgICAgICAgICAgIHJlY0xlbmd0aCA9IDAsCiAgICAgICAgICAgIG1ldGFfZGF0YTsKICAgICAgICAvKioKICAgICAgICAgKiAgcmVjb3Jkcy9zYXZlcyB0aGUgb3V0cHV0IGRhdGEgb2YgbGliZmxhYy1lbmNvZGUgbWV0aG9kCiAgICAgICAgICovCgogICAgICAgIGZ1bmN0aW9uIHdyaXRlX2NhbGxiYWNrX2ZuKGJ1ZmZlciwgYnl0ZXMsIHNhbXBsZXMsIGN1cnJlbnRfZnJhbWUpIHsKICAgICAgICAgIHJlY0J1ZmZlcnMucHVzaChidWZmZXIpOwogICAgICAgICAgcmVjTGVuZ3RoICs9IGJ5dGVzOyAvLyByZWNMZW5ndGggKz0gYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtZXRhZGF0YV9jYWxsYmFja19mbihkYXRhKSB7CiAgICAgICAgICBtZXRhX2RhdGEgPSBkYXRhOwogICAgICAgIH0gLy8gY2hlY2s6IGlzIGZpbGUgYSBjb21wYXRpYmxlIHdhdi1maWxlPwoKCiAgICAgICAgaWYgKHdhdl9maWxlX3Byb2Nlc3NpbmdfY2hlY2tfd2F2X2Zvcm1hdCh1aThfZGF0YSkgPT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVycm9yOiAiV3JvbmcgV0FWIGZpbGUgZm9ybWF0IiwKICAgICAgICAgICAgc3RhdHVzOiAwCiAgICAgICAgICB9OwogICAgICAgIH0gLy8gZ2V0IFdBVi9QQ00gcGFyYW1ldGVycyBmcm9tIGRhdGEgLyBmaWxlCgoKICAgICAgICB2YXIgd2F2X3BhcmFtZXRlcnMgPSB3YXZfZmlsZV9wcm9jZXNzaW5nX3JlYWRfcGFyYW1ldGVycyh1aThfZGF0YSk7CiAgICAgICAgdmFyIHRvdF9zYW1wbGVzID0gMDsKICAgICAgICB2YXIgY29tcHJlc3Npb25fbGV2ZWwgPSA1OwogICAgICAgIHZhciBmbGFjX29rID0gMTsKICAgICAgICB2YXIgaXNfdmVyaWZ5ID0gdHJ1ZTsKICAgICAgICB2YXIgZmxhY19lbmNvZGVyID0gRmxhYy5jcmVhdGVfbGliZmxhY19lbmNvZGVyKHdhdl9wYXJhbWV0ZXJzLnNhbXBsZV9yYXRlLCB3YXZfcGFyYW1ldGVycy5jaGFubmVscywgd2F2X3BhcmFtZXRlcnMuYnBzLCBjb21wcmVzc2lvbl9sZXZlbCwgdG90X3NhbXBsZXMsIGlzX3ZlcmlmeSk7CgogICAgICAgIGlmIChmbGFjX2VuY29kZXIgIT0gMCkgewogICAgICAgICAgdmFyIGluaXRfc3RhdHVzID0gRmxhYy5pbml0X2VuY29kZXJfc3RyZWFtKGZsYWNfZW5jb2Rlciwgd3JpdGVfY2FsbGJhY2tfZm4sIG1ldGFkYXRhX2NhbGxiYWNrX2ZuLCAwKTsKICAgICAgICAgIGZsYWNfb2sgJj0gaW5pdF9zdGF0dXMgPT0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIG1zZyA9ICJFcnJvciBpbml0aWFsaXppbmcgdGhlIGRlY29kZXIuIjsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVycm9yOiBtc2csCiAgICAgICAgICAgIHN0YXR1czogMQogICAgICAgICAgfTsKICAgICAgICB9IC8vIGNvbnZlcnQgdGhlIFBDTS1EYXRhIHRvIHRoZSBhcHByb3ByaWF0ZSBmb3JtYXQgZm9yIHRoZSBsaWJmbGFjIGxpYnJhcnkgbWV0aG9kcyAoMzItYml0IGFycmF5IG9mIHNhbXBsZXMpCiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBhcnJheSAoMzItYml0KSBhbmQgc3RvcmVzIHRoZSAxNi1iaXQgZGF0YSBvZiB0aGUgd2F2LWZpbGUgYXMgMzItYml0IGRhdGEKCgogICAgICAgIHZhciBidWZmZXJfaTMyID0gd2F2X2ZpbGVfcHJvY2Vzc2luZ19jb252ZXJ0XzE2Yml0ZGF0YV90bzMyYml0ZGF0YSh1aThfZGF0YS5idWZmZXIpOwogICAgICAgIHZhciBmbGFjX3JldHVybiA9IEZsYWMuRkxBQ19fc3RyZWFtX2VuY29kZXJfcHJvY2Vzc19pbnRlcmxlYXZlZChmbGFjX2VuY29kZXIsIGJ1ZmZlcl9pMzIsIGJ1ZmZlcl9pMzIubGVuZ3RoIC8gd2F2X3BhcmFtZXRlcnMuY2hhbm5lbHMpOwoKICAgICAgICBpZiAoZmxhY19yZXR1cm4gIT0gdHJ1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coIkVycm9yOiBGTEFDX19zdHJlYW1fZW5jb2Rlcl9wcm9jZXNzX2ludGVybGVhdmVkIHJldHVybmVkIGZhbHNlLiAiICsgZmxhY19yZXR1cm4pOwogICAgICAgIH0KCiAgICAgICAgZmxhY19vayAmPSBGbGFjLkZMQUNfX3N0cmVhbV9lbmNvZGVyX2ZpbmlzaChmbGFjX2VuY29kZXIpOwogICAgICAgIEZsYWMuRkxBQ19fc3RyZWFtX2VuY29kZXJfZGVsZXRlKGZsYWNfZW5jb2Rlcik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG1ldGFEYXRhOiBtZXRhX2RhdGEsCiAgICAgICAgICBzdGF0dXM6IGZsYWNfb2sKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiB3YXZfZmlsZV9wcm9jZXNzaW5nX2NoZWNrX3dhdl9mb3JtYXQodWk4X2RhdGEpIHsKICAgICAgICAvLyBjaGVjazogaXMgZmlsZSBhIGNvbXBhdGlibGUgd2F2LWZpbGU/CiAgICAgICAgaWYgKHVpOF9kYXRhLmxlbmd0aCA8IDQ0IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdWk4X2RhdGEuc3ViYXJyYXkoMCwgNCkpICE9ICJSSUZGIiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDgsIDE2KSkgIT0gIldBVkVmbXQgIiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDM2LCA0MCkpICE9ICJkYXRhIikgewogICAgICAgICAgY29uc29sZS5sb2coIkVSUk9SOiB3cm9uZyBmb3JtYXQgZm9yIHdhdi1maWxlLiIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqICBjaGVja3MgaWYgdGhlIGdpdmVuIHVpOF9kYXRhICh1aThhcnJheSkgaXMgb2YgYSBmbGFjLWZpbGUKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gZmxhY19maWxlX3Byb2Nlc3NpbmdfY2hlY2tfZmxhY19mb3JtYXQodWk4X2RhdGEpIHsKICAgICAgICAvLyBjaGVjazogaXMgZmlsZSBhIGNvbXBhdGlibGUgZmxhYy1maWxlPwogICAgICAgIGlmICh1aThfZGF0YS5sZW5ndGggPCA0MiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDAsIDQpKSAhPSAiZkxhQyIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFUlJPUjogd3JvbmcgZm9ybWF0IGZvciBmbGFjLWZpbGUuIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyh1aThfZGF0YS5idWZmZXIpOyAvL2NoZWNrIGxhc3QgNyBiaXRzIG9mIDR0aCBieXRlIGZvciBtZXRhLWRhdGEgQkxPQ0sgdHlwZTogbXVzdCBiZSBTVFJFQU1JTkZPICgwKQoKICAgICAgICBpZiAoKHZpZXcuZ2V0VWludDgoNCkgJiAweDdmKSAhPSAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRVJST1I6IHdyb25nIGZvcm1hdCBmb3IgZmxhYy1maWxlLiIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdhdl9maWxlX3Byb2Nlc3NpbmdfcmVhZF9wYXJhbWV0ZXJzKHVpOF9kYXRhKSB7CiAgICAgICAgdmFyIHNhbXBsZV9yYXRlID0gMCwKICAgICAgICAgICAgY2hhbm5lbHMgPSAwLAogICAgICAgICAgICBicHMgPSAwLAogICAgICAgICAgICB0b3RhbF9zYW1wbGVzID0gMCwKICAgICAgICAgICAgYmxvY2tfYWxpZ247IC8vIGdldCBXQVYvUENNIHBhcmFtZXRlcnMgZnJvbSBkYXRhIC8gZmlsZQoKICAgICAgICBzYW1wbGVfcmF0ZSA9ICgodWk4X2RhdGFbMjddIDw8IDggfCB1aThfZGF0YVsyNl0pIDw8IDggfCB1aThfZGF0YVsyNV0pIDw8IDggfCB1aThfZGF0YVsyNF07CiAgICAgICAgY2hhbm5lbHMgPSB1aThfZGF0YVsyMl07CiAgICAgICAgYnBzID0gdWk4X2RhdGFbMzRdOwogICAgICAgIGJsb2NrX2FsaWduID0gdWk4X2RhdGFbMzJdOwogICAgICAgIHRvdGFsX3NhbXBsZXMgPSAoKCh1aThfZGF0YVs0M10gPDwgOCB8IHVpOF9kYXRhWzQyXSkgPDwgOCB8IHVpOF9kYXRhWzQxXSkgPDwgOCB8IHVpOF9kYXRhWzQwXSkgLyBibG9ja19hbGlnbjsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2FtcGxlX3JhdGU6IHNhbXBsZV9yYXRlLAogICAgICAgICAgY2hhbm5lbHM6IGNoYW5uZWxzLAogICAgICAgICAgYnBzOiBicHMsCiAgICAgICAgICB0b3RhbF9zYW1wbGVzOiB0b3RhbF9zYW1wbGVzLAogICAgICAgICAgYmxvY2tfYWxpZ246IGJsb2NrX2FsaWduCiAgICAgICAgfTsKICAgICAgfQogICAgICAvKioKICAgICAgICogIGNvbnZlcnRzIHRoZSBQQ00gZGF0YSBvZiB0aGUgd2F2IGZpbGUgKGVhY2ggc2FtcGxlIHN0b3JlZCBhcyAxNiBiaXQgdmFsdWUpIGludG8KICAgICAgICogIGEgZm9ybWF0IGV4cGVjdGVkIGJ5IHRoZSBsaWJmbGFjLWVuY29kZXIgbWV0aG9kIChlYWNoIHNhbXBsZSBzdG9yZWQgYXMgMzIgYml0IHZhbHVlIGluIGEgMzItYml0IGFycmF5KQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiB3YXZfZmlsZV9wcm9jZXNzaW5nX2NvbnZlcnRfMTZiaXRkYXRhX3RvMzJiaXRkYXRhKGFycmF5YnVmZmVyKSB7CiAgICAgICAgLy8gY29udmVydCB0aGUgUENNLURhdGEgdG8gdGhlIGFwcHJvcHJpYXRlIGZvcm1hdCBmb3IgdGhlIGxpYmZsYWMgbGlicmFyeSBtZXRob2RzICgzMi1iaXQgYXJyYXkgb2Ygc2FtcGxlcykKICAgICAgICAvLyBjcmVhdGVzIGEgbmV3IGFycmF5ICgzMi1iaXQpIGFuZCBzdG9yZXMgdGhlIDE2LWJpdCBkYXRhIG9mIHRoZSB3YXYtZmlsZSBhcyAzMi1iaXQgZGF0YQogICAgICAgIHZhciBhYl9pMTYgPSBuZXcgRGF0YVZpZXcoYXJyYXlidWZmZXIsIDQ0KTsKICAgICAgICB2YXIgYnVmX2xlbmd0aCA9IGFiX2kxNi5ieXRlTGVuZ3RoOwogICAgICAgIHZhciBidWYzMl9sZW5ndGggPSBidWZfbGVuZ3RoIC8gMjsKICAgICAgICB2YXIgYnVmZmVyX2kzMiA9IG5ldyBVaW50MzJBcnJheShidWYzMl9sZW5ndGgpOwogICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcl9pMzIuYnVmZmVyKTsKICAgICAgICB2YXIgaW5kZXggPSAwOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGJ1Zl9sZW5ndGg7IGogKz0gMikgewogICAgICAgICAgdmlldy5zZXRJbnQzMihpbmRleCwgYWJfaTE2LmdldEludDE2KGosIHRydWUpLCB0cnVlKTsKICAgICAgICAgIGluZGV4ICs9IDQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnVmZmVyX2kzMjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwb3J0RmxhY0ZpbGUocmVjQnVmZmVycywgbWV0YURhdGEpIHsKICAgICAgICB2YXIgcmVjTGVuZ3RoID0gZ2V0TGVuZ3RoKHJlY0J1ZmZlcnMpOwoKICAgICAgICBpZiAobWV0YURhdGEpIHsKICAgICAgICAgIGFkZEZMQUNNZXRhRGF0YShyZWNCdWZmZXJzLCBtZXRhRGF0YSk7CiAgICAgICAgfSAvL2NvbnZlcnQgYnVmZmVycyBpbnRvIG9uZSBzaW5nbGUgYnVmZmVyCgoKICAgICAgICB2YXIgc2FtcGxlcyA9IG1lcmdlQnVmZmVycyhyZWNCdWZmZXJzLCByZWNMZW5ndGgpOwogICAgICAgIHZhciB0aGVfYmxvYiA9IG5ldyBCbG9iKFtzYW1wbGVzXSk7CiAgICAgICAgcmV0dXJuIHRoZV9ibG9iOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRMZW5ndGgocmVjQnVmZmVycykgewogICAgICAgIC8vZ2V0IGxlbmd0aAogICAgICAgIHZhciByZWNMZW5ndGggPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gcmVjQnVmZmVycy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgcmVjTGVuZ3RoICs9IHJlY0J1ZmZlcnNbaV0uYnl0ZUxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZWNMZW5ndGg7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZEZMQUNNZXRhRGF0YShjaHVua3MsIG1ldGFkYXRhKSB7CiAgICAgICAgdmFyIG9mZnNldCA9IDQ7CiAgICAgICAgdmFyIGRhdGEgPSBjaHVua3NbMF07IC8vMXN0IGRhdGEgY2h1bmsgc2hvdWxkIGNvbnRhaW4gRkxBQyBpZGVudGlmaWVyICJmTGFDIgoKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPCA0IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZGF0YS5zdWJhcnJheSgwLCA0KSkgIT0gImZMYUMiKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJVbmtub3duIGRhdGEgZm9ybWF0OiBjYW5ub3QgYWRkIGFkZGl0aW9uYWwgRkxBQyBtZXRhIGRhdGEgdG8gaGVhZGVyIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvL2ZpcnN0IGNodW5rIG9ubHkgY29udGFpbnMgdGhlIGZsYWMgaWRlbnRpZmllciBzdHJpbmc/CgoKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT0gNCkgewogICAgICAgICAgZGF0YSA9IGNodW5rc1sxXTsgLy9nZXQgMm5kIGRhdGEgY2h1bmsgd2hpY2ggc2hvdWxkIGNvbnRhaW4gU1RSRUFNSU5GTyBtZXRhLWRhdGEgYmxvY2sgKGFuZCBwcm9iYWJseSBtb3JlKQoKICAgICAgICAgIG9mZnNldCA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhkYXRhLmJ1ZmZlcik7IC8vTk9URSBieSBkZWZhdWx0LCB0aGUgZW5jb2RlciB3cml0ZXMgYSAybmQgbWV0YS1kYXRhIGJsb2NrICh0eXBlIFZPUkJJU19DT01NRU5UKSB3aXRoIGVuY29kZXIvdmVyc2lvbiBpbmZvIC0+IGRvIG5vdCBzZXQgImlzIGxhc3QiIHRvIFRSVUUgZm9yIGZpcnN0IG9uZQogICAgICAgIC8vCS8vIHdyaXRlICJpcyBsYXN0IG1ldGEgZGF0YSBibG9jayIgJiB0eXBlIFNUUkVBTUlORk8gdHlwZSAoMCkgYXMgbGl0dGxlIGVuZGlhbiBjb21iaW5lZCB1aW50MSAmIHVpbnQ3IC0+IHVpbnQ4OgogICAgICAgIC8vCXZhciBpc0xhc3QgPSAxOy8vMSBiaXQKICAgICAgICAvLwl2YXIgc3RyZWFtSW5mb1R5cGUgPSAwOy8vNyBiaXQKICAgICAgICAvLwl2aWV3LnNldFVpbnQ4KDAgKyBvZmZzZXQsIGlzTGFzdCA8PCA3IHwgc3RyZWFtSW5mb1R5cGUsIHRydWUpOy8vOCBiaXQKICAgICAgICAvLyBibG9jay1oZWFkZXI6IFNUUkVBTUlORk8gdHlwZSwgYmxvY2sgbGVuZ3RoIC0+IGFscmVhZHkgc2V0CiAgICAgICAgLy8gYmxvY2stY29udGVudDogbWluX2Jsb2Nrc2l6ZSwgbWluX2Jsb2Nrc2l6ZSAtPiBhbHJlYWR5IHNldAogICAgICAgIC8vIHdyaXRlIG1pbl9mcmFtZXNpemUgYXMgbGl0dGxlIGVuZGlhbiB1aW50MjQ6CgogICAgICAgIHZpZXcuc2V0VWludDgoOCArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSA+PiAxNiwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoOSArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSA+PiA4LCB0cnVlKTsgLy8yNCBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgxMCArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSwgdHJ1ZSk7IC8vMjQgYml0CiAgICAgICAgLy8gd3JpdGUgbWF4X2ZyYW1lc2l6ZSBhcyBsaXR0bGUgZW5kaWFuIHVpbnQyNDoKCiAgICAgICAgdmlldy5zZXRVaW50OCgxMSArIG9mZnNldCwgbWV0YWRhdGEubWF4X2ZyYW1lc2l6ZSA+PiAxNiwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMTIgKyBvZmZzZXQsIG1ldGFkYXRhLm1heF9mcmFtZXNpemUgPj4gOCwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMTMgKyBvZmZzZXQsIG1ldGFkYXRhLm1heF9mcmFtZXNpemUsIHRydWUpOyAvLzI0IGJpdAogICAgICAgIC8vIGJsb2NrLWNvbnRlbnQ6IHNhbXBsZVJhdGUsIGNoYW5uZWxzLCBiaXRzUGVyU2FtcGxlIC0+IGFscmVhZHkgc2V0CiAgICAgICAgLy8gd3JpdGUgdG90YWxfc2FtcGxlcyBhcyBsaXR0bGUgZW5kaWFuIHVpbnQzNjoKICAgICAgICAvL1RPRE8gc2V0IGxhc3QgNCBiaXRzIHRvIGhhbGYgb2YgdGhlIHZhbHVlIGluIGluZGV4IDE3CgogICAgICAgIHZpZXcuc2V0VWludDgoMTggKyBvZmZzZXQsIG1ldGFkYXRhLnRvdGFsX3NhbXBsZXMgPj4gMjQsIHRydWUpOyAvLzM2IGJpdAoKICAgICAgICB2aWV3LnNldFVpbnQ4KDE5ICsgb2Zmc2V0LCBtZXRhZGF0YS50b3RhbF9zYW1wbGVzID4+IDE2LCB0cnVlKTsgLy8zNiBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgyMCArIG9mZnNldCwgbWV0YWRhdGEudG90YWxfc2FtcGxlcyA+PiA4LCB0cnVlKTsgLy8zNiBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgyMSwgbWV0YWRhdGEudG90YWxfc2FtcGxlcywgdHJ1ZSk7IC8vMzYgYml0CgogICAgICAgIHdyaXRlTWQ1KHZpZXcsIDIyICsgb2Zmc2V0LCBtZXRhZGF0YS5tZDVzdW0pOyAvLzE2ICogOCBiaXQKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbWVyZ2VCdWZmZXJzKGNoYW5uZWxCdWZmZXIsIHJlY29yZGluZ0xlbmd0aCkgewogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVWludDhBcnJheShyZWNvcmRpbmdMZW5ndGgpOwogICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgIHZhciBsbmcgPSBjaGFubmVsQnVmZmVyLmxlbmd0aDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsbmc7IGkrKykgewogICAgICAgICAgdmFyIGJ1ZmZlciA9IGNoYW5uZWxCdWZmZXJbaV07CiAgICAgICAgICByZXN1bHQuc2V0KGJ1ZmZlciwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSBidWZmZXIubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gd3JpdGVNZDUodmlldywgb2Zmc2V0LCBzdHIpIHsKICAgICAgICB2YXIgaW5kZXg7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aCAvIDI7ICsraSkgewogICAgICAgICAgaW5kZXggPSBpICogMjsKICAgICAgICAgIHZpZXcuc2V0VWludDgoaSArIG9mZnNldCwgcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhpbmRleCwgaW5kZXggKyAyKSwgMTYpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdGFydF92aWRlb19jYWxsOiBmdW5jdGlvbiBzdGFydF92aWRlb19jYWxsKCkge30sCiAgICByZWZyZXNoX2NoYXRib3Q6IGZ1bmN0aW9uIHJlZnJlc2hfY2hhdGJvdCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsgLy8gZGVidWdnZXI7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgY2hhdDogIiIsCiAgICAgICAgZGF0YTogIiIsCiAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgcmVmcmVzaGVkX29yX2Nsb3NlZDogdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBfdGhpczMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXMzLmlmZmlyc3R0aW1lKSB7CiAgICAgICAgICBfdGhpczMuaWZmaXJzdHRpbWUgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHVpZDogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IG51bGwsCiAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IG51bGwsCiAgICAgICAgICAgIGJvdF9uYW1lOiBfdGhpczMuYm90X25hbWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogX3RoaXMzLmNvbnZlcnNhdGlvbl9pZAogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmVycm9yID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdnYXlhJyk7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgICAgICAgICAgICBfdGhpczMuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICAgICAgICBfdGhpczMuaXNjbG9zZWRib3RvbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09ICJzdXBwb3J0IikgewogICAgICAgICAgX3RoaXMzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICJJcyB0aGVyZSBhbnl0aGluZyBlbHNlIEkgY2FuIGhlbHAgeW91IHdpdGg/IiwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IF90aGlzMy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzMy5jb21wYW55aWQgPT0gIkN1c3RvbWVySGFwcGluZXNzOTUxODUiIHx8IF90aGlzMy5jb21wYW55aWQgPT0gIjN4NWl2ZTk5NTM0IiB8fCBfdGhpczMuY29tcGFueWlkID09ICJGb3JlaWdueGNoYW5nZTE3NDkxIiB8fCBfdGhpczMuY29tcGFueWlkID09ICJjbGluaWNhbHRyaWFsczgxMzUyIikgewogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICAgIGNoYXQ6ICIvd2VsY29tZV9tZXNzYWdlIiwKICAgICAgICAgICAgdG9rZW46IF90aGlzMy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgIHVzZXJuYW1lOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgIHJvbGU6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczMucHVzaF9tc2cocmVzcG9uc2UsIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvbXB0X3VybCgpLCB7CiAgICAgICAgICB1aWQ6ICJjZW5zZSIsCiAgICAgICAgICAvL3RoaXMuZmluZ2VycHJpbnQKICAgICAgICAgIGNvbXBhbnlpZDogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGNoYXQ6ICIiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJOTyBDTE9TRUQgRk9STSBCT1QiKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmV4dHJhcyAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEuZXh0cmFzWzBdLlR5cGUgPT0gIlRBQkxFIikgewogICAgICAgICAgICAgIF90aGlzMy5jcmVhdGVfY2hhdChyZXNwb25zZS5kYXRhLCAiaXN0YWJsZSIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmV0dXJuID09ICJQUk9NUFRTIikgewogICAgICAgICAgICAgIF90aGlzMy5jcmVhdGVfY2hhdChyZXNwb25zZS5kYXRhLCAiaXNwcm9tcHQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7fSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvd25sb2FkX3BkZjogZnVuY3Rpb24gZG93bmxvYWRfcGRmKHVybCwgZmlsZV9uYW1lKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIGZpbGVfbmFtZSk7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgIGxpbmsuY2xpY2soKTsKICAgIH0sCiAgICBzY3JvbGxfZGl2OiBmdW5jdGlvbiBzY3JvbGxfZGl2KCkgewogICAgICB2YXIgZG9jID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmJ1eS1wcm9kdWN0cyIpOwoKICAgICAgaWYgKGV2ZW50LmRlbHRhWCA+IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0ICs9IDEwOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmRlbHRhWCA8IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0IC09IDEwOwogICAgICB9CiAgICB9LAogICAgY2FsbF9zdXBwb3J0OiBmdW5jdGlvbiBjYWxsX3N1cHBvcnQodHlwZSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmICh0eXBlID09ICJZZXMiKSB7CiAgICAgICAgdmFyIF9heGlvcyRwb3N0OwoKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIChfYXhpb3MkcG9zdCA9IHsKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIGNoYXQ6ICIvY2FsbF9zdXBwb3J0IgogICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInRva2VuIiwgdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJyb2xlIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkKSwgX2F4aW9zJHBvc3QpKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICBfdGhpczQuY2hhdC5wdXNoKHsKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3AuZGF0YS5yZXNwb25zZXNbMF0udGV4dCwKICAgICAgICAgICAgdGltZTogX3RoaXM0LmdlbmVyYXRlX3RpbWUoKQogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXM0LiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXM0LmNoYXQpOwoKICAgICAgICAgIF90aGlzNC51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gIk5vIikgewogICAgICAgIHRoaXMuY2hhdC5wdXNoKHRoaXMuY2hhdFswXSk7CiAgICAgICAgdGhpcy5jaGF0LnB1c2godGhpcy5jaGF0WzFdKTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7IC8vIHRoaXMucmVmcmVzaF9jaGF0Ym90KCJzdXBwb3J0Iik7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZTogZnVuY3Rpb24gcGFyc2Uoc3RyaW5nKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC97ey4qP319L2csIGZ1bmN0aW9uIChtYXRjaCkgewogICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7CiAgICAgICAgdmFyIGRkID0gdG9kYXkuZ2V0RGF0ZSgpOwogICAgICAgIHZhciBtbSA9IHRvZGF5LmdldE1vbnRoKCkgKyAxOwogICAgICAgIHZhciB5eXl5ID0gdG9kYXkuZ2V0RnVsbFllYXIoKTsKCiAgICAgICAgaWYgKGRkIDwgMTApIHsKICAgICAgICAgIGRkID0gIjAiICsgZGQ7CiAgICAgICAgfQoKICAgICAgICBpZiAobW0gPCAxMCkgewogICAgICAgICAgbW0gPSAiMCIgKyBtbTsKICAgICAgICB9CgogICAgICAgIHRvZGF5ID0gZGQgKyAiLSIgKyBtbSArICItIiArIHl5eXk7CiAgICAgICAgdmFyIGV4cHJlc3Npb24gPSBtYXRjaC5zbGljZSgyLCAtMik7CiAgICAgICAgX3RoaXM1LiRkYXRhW2V4cHJlc3Npb25dID0gdG9kYXk7CiAgICAgICAgcmV0dXJuIF90aGlzNS4kZGF0YVtleHByZXNzaW9uXTsKICAgICAgfSk7CiAgICB9LAogICAgZ2VuZXJhdGVfdGltZTogZnVuY3Rpb24gZ2VuZXJhdGVfdGltZSgpIHsKICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICB2YXIgaCwgbSwgdHlwZTsKCiAgICAgIGlmIChkLmdldEhvdXJzKCkgPiAxMikgewogICAgICAgIGggPSBkLmdldEhvdXJzKCkgJSAxMjsKICAgICAgICB0eXBlID0gIiBwbSI7CiAgICAgIH0gZWxzZSBpZiAoZC5nZXRIb3VycygpIDwgMTIpIHsKICAgICAgICBoID0gZC5nZXRIb3VycygpOwogICAgICAgIHR5cGUgPSAiIGFtIjsKICAgICAgfSBlbHNlIGlmIChkLmdldEhvdXJzKCkgPT0gMTIpIHsKICAgICAgICBoID0gZC5nZXRIb3VycygpOwogICAgICAgIHR5cGUgPSAiIHBtIjsKICAgICAgfQoKICAgICAgbSA9IGQuZ2V0TWludXRlcygpOwoKICAgICAgaWYgKG0gPCAxMCkgewogICAgICAgIG0gPSAwICsgU3RyaW5nKG0pOwogICAgICB9CgogICAgICByZXR1cm4gaCArICI6IiArIG0gKyB0eXBlOwogICAgfSwKICAgIGNhbGxfYXBpOiBmdW5jdGlvbiBjYWxsX2FwaSgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICh0aGlzLnBob25lX251bWJlcl92YWxpZGl0eS50ZXN0KHRoaXMucGhvbmVfbnVtYmVyKSkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNhbGxfc3VwcG9ydF91cmwoKSwgewogICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgcGhvbmVudW1iZXI6IHRoaXMucGhvbmVfbnVtYmVyLAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJDYWxsIGluY29taW5nISIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIldlIHdpbGwgZ2V0IGluIHRvdWNoIHdpdGggeW91IHNvb24uIFRoYW5rcyIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIEVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyIik7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X3BvcHVwOiBmdW5jdGlvbiBzaG93X3BvcHVwKCkgewogICAgICB0aGlzLnNob3cgPSBmYWxzZTsKICAgICAgdGhpcy5zdG9wID0gZmFsc2U7CiAgICB9LAogICAgc3ViX2xlYWZfbm9kZV9jYWxsOiBmdW5jdGlvbiBzdWJfbGVhZl9ub2RlX2NhbGwodHlwZSkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBkaXZjbGljayA9IGV2ZW50LnRhcmdldC5pbm5lclRleHQ7CgogICAgICBpZiAoZGl2Y2xpY2sgPT0gIldhdGNoIERlbW8gVmlkZW8iKSB7CiAgICAgICAgdGhpcy5kZW1vdXJsYmluZCA9IHRydWU7CiAgICAgICAgdGhpcy5yZXZpZXdzdXJsYmluZCA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKGRpdmNsaWNrID09ICJVc2VyIFJldmlld3MvVGVzdGltb25pYWxzIikgewogICAgICAgIHRoaXMucmV2aWV3c3VybGJpbmQgPSB0cnVlOwogICAgICAgIHRoaXMuZGVtb3VybGJpbmQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKGRpdmNsaWNrID09ICJXYXRjaCBEZW1vIFZpZGVvIiB8fCBkaXZjbGljayA9PSAiVXNlciBSZXZpZXdzL1Rlc3RpbW9uaWFscyIpIHsKICAgICAgICB0aGlzLnNob3cgPSAhdGhpcy5zaG93OwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0sIDEwMDApOwogICAgICB9IGVsc2UgaWYgKGRpdmNsaWNrID09ICJCdXkgVHV0b3JpYWwiKSB7CiAgICAgICAgdGhpcy5jZW5zZV9lbnF1aXJ5ID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICBjaGF0OiAiL3BlcnNvbmFsX2RldGFpbHMiLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6ICIiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1swXS50ZXh0LAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICB0aW1lOiBfdGhpczYuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzNi5jaGF0LnB1c2gobXNnKTsKCiAgICAgICAgICBfdGhpczYudXBkYXRlX3Njcm9sbGJhcigpOwoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9LCAxMDAwKTsKCiAgICAgICAgICBfdGhpczYuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczYuY2hhdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB0aWNrZXRfbnVtYmVyOiBmdW5jdGlvbiB0aWNrZXRfbnVtYmVyKCkgewogICAgICB2YXIgcmFuZG9tX251bSA9IE1hdGguZmxvb3IoMTAwMDAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwMDAwKTsKICAgICAgdmFyIGNvbXBhbnkgPSB0aGlzLmNvbXBhbnluYW1lLnNsaWNlKDAsIDEpLnRvVXBwZXJDYXNlKCk7CiAgICAgIHJldHVybiBjb21wYW55ICsgIl8iICsgcmFuZG9tX251bTsKICAgIH0sCiAgICBzZW5kX21lc3NhZ2U6IGZ1bmN0aW9uIHNlbmRfbWVzc2FnZSh0eXBlLCBtZXNzYWdlLCB0b19iZV9kaXNwbGF5ZWQpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAvL2hhcnNoCiAgICAgIC8vIGRlYnVnZ2VyOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICB0eXBlID0gImlzX3Byb21wdCI7CiAgICAgICAgdG9fYmVfZGlzcGxheWVkID0gdGhpcy50b19zZW5kOwogICAgICAgIHRoaXMudG9fc2VuZCA9IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXS52YWx1ZS5zcGxpdCgieyIpWzBdICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXMpOwogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbiA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc2Nsb3NlZGJvdG9uICYmIHR5cGUgIT0gJ2lzX2J1dHRvbicpIHsKICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgIHRoaXMuc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEoKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJpc19idXR0b24iKSB7CiAgICAgICAgJCgiI3Jlc3BvbnNlX2JvdF90ZXh0IikucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CgogICAgICAgIGlmIChtZXNzYWdlLnZhbHVlID09ICJpc2Rpc2FibGVkIiAmJiB0aGlzLmNvbXBhbnlpZCA9PSAiY2xpbmljYWx0cmlhbHM4MTM1MiIgJiYgbWVzc2FnZS50aXRsZSA9PSAiTm8iKSB7fSBlbHNlIGlmICh0aGlzLmlzY2xvc2VkYm90b24pIHsKICAgICAgICAgIHRoaXMuc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEodHlwZSwgbWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBpbmRleCA9IHRvX2JlX2Rpc3BsYXllZDsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHNlbnQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgICBjaGF0OiBtZXNzYWdlLnZhbHVlLAogICAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChfdGhpczcuY2hhdFtpbmRleF0ucmVtb3ZhYmxlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczcuY2hhdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczcucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gImlzX3Byb21wdCIpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IHRvX2JlX2Rpc3BsYXllZCwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgZGVsaXZlcmVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgIC8vIGhvc3Q6IHRoaXMudXNlcl9kYXRhLmhvc3QsCiAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIGNoYXQ6IHRoaXMudG9fc2VuZAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwoKICAgICAgICAgIF90aGlzNy5leDEoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgPT0gIlJlc3RhcnQiIHx8IHRoaXMudG9fc2VuZCA9PSAicmVzdGFydCIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wcm9tcHRfdXJsKCksIHsKICAgICAgICAgIHVpZDogImNlbnNlIiwKICAgICAgICAgIC8vdGhpcy5maW5nZXJwcmludAogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBjaGF0OiAiIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcuY2hhdC5wdXNoKHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICAgIF90aGlzNy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwoKICAgICAgICAgIF90aGlzNy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzNy5jaGF0KTsKCiAgICAgICAgICBfdGhpczcuZmlyc3RfY2xpY2sgPSB0cnVlOwogICAgICAgICAgX3RoaXM3LmxldmVsID0gcmVzcG9uc2UuZGF0YS5sZXZlbDsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkge30pOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY2Vuc2VfZW5xdWlyeSA9PSB0cnVlICYmIHRoaXMudG9fc2VuZCAhPSAiIiAmJiB0aGlzLnRvX3NlbmQgIT0gbnVsbCAmJiAhL15ccyokLy50ZXN0KHRoaXMudG9fc2VuZCkpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIHZhciBzZW5kX21zZyA9IHsKICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgfTsKICAgICAgICB0aGlzLmNoYXQucHVzaChzZW5kX21zZyk7CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIpOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgIGNoYXQ6ICIvcGVyc29uYWxfZGV0YWlscyIsCiAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgICBDb21wYW55aWQ6ICJDTzAwMDIzIiwKICAgICAgICAgIGRhdGE6ICIiLAogICAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiAiIiwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzWzBdLnRleHQsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IF90aGlzNy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgIH07CgogICAgICAgICAgX3RoaXM3LmNoYXQucHVzaChtc2cpOwoKICAgICAgICAgIF90aGlzNy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzNy5jaGF0KTsKCiAgICAgICAgICBfdGhpczcucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzNy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5saXZlX2NoYXRfb24pIHsKICAgICAgICBpZiAodGhpcy51c2VyX25hbWUgPT0gIiIpIHsKICAgICAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJuZXdfbmFtZSIsIHsKICAgICAgICAgICAgbmFtZTogdGhpcy50b19zZW5kCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudXNlcl9uYW1lID0gdGhpcy50b19zZW5kOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaCgibmV3X2NoYXRfbWVzc2FnZSIsIHsKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy50b19zZW5kCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgIT0gIiIgJiYgdGhpcy50b19zZW5kICE9IG51bGwgJiYgdGhpcy5jZW5zZV9lbnF1aXJ5ICE9IHRydWUpIHsKICAgICAgICB2YXIgX2F4aW9zJHBvc3QyOwoKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAic2VuZGVyIik7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3QyID0gewogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgY2hhdDogdGhpcy50b19zZW5kCiAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInRva2VuIiwgdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAicm9sZSIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInJlZnJlc2hlZF9vcl9jbG9zZWQiLCB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfYXhpb3MkcG9zdDIpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnJlc3BvbnNlX2hhbmRsaW5nKHJlc3BvbnNlKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM3LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMudG9fc2VuZCA9ICIiOwogICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICB9LAogICAgaW5pdGlhdGVfc3VwcG9ydF9jaGF0OiBmdW5jdGlvbiBpbml0aWF0ZV9zdXBwb3J0X2NoYXQoKSB7CiAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6ICJTb3JyeSBJIGFtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iLAogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiAiV291bGQgeW91IGxpa2UgdG8gdGFsayB3aXRoIHN1cHBvcnQgdGVhbT8iLAogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIHNob3dfYnV0dG9uczogdHJ1ZSwKICAgICAgICBzdXBwb3J0X2J1dHRvbnM6IHRydWUsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfSk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBkaXNjb25uZWN0X3N1cHBvcnRfY2hhdDogZnVuY3Rpb24gZGlzY29ubmVjdF9zdXBwb3J0X2NoYXQoKSB7CiAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJzdG9wcGVkX2NoYXQiLCB7CiAgICAgICAgbmFtZTogdGhpcy51c2VyX25hbWUsCiAgICAgICAgbWVzc2FnZTogIiBoYXMgZW5kZWQgdGhlIGNvbnZlcnNhdGlvbi4iCiAgICAgIH0pOwogICAgICB0aGlzLmNoYW5uZWwubGVhdmUoKTsKICAgICAgdGhpcy5jaGF0X3NvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgIHRoaXMubGl2ZV9jaGF0X29uID0gZmFsc2U7CiAgICB9LAogICAgY2hhdF9yZXNwb25zZV9lcnJvcjogZnVuY3Rpb24gY2hhdF9yZXNwb25zZV9lcnJvcigpIHsKICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogIlNvcnJ5IEknbSBub3QgZ2V0dGluZyB5b3VyIHF1ZXN0aW9uIiwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9KTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBzZW5kX3JlcXVlc3RfanNvbjogZnVuY3Rpb24gc2VuZF9yZXF1ZXN0X2pzb24obWVzc2FnZSkgewogICAgICB2YXIgX2F4aW9zJHBvc3QzLAogICAgICAgICAgX3RoaXM4ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgKF9heGlvcyRwb3N0MyA9IHsKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJ0b2tlbiIsIHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgInJvbGUiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgImNoYXQiLCAiIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJzb3VyY2UiLCAiV2ViIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJkYXRhIiwgdGhpcy5qc29uX2RhdGFbbWVzc2FnZS5yZXNwb25zZXNbMF0uaW50ZW50XSksIF9heGlvcyRwb3N0MykpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBfdGhpczguY2hhdC5wdXNoKHsKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgcmVjZWl2ZWQ6IHJlc3AuZGF0YS5yZXNwb25zZXMubGVuZ3RoID09IDAgPyAiU29ycnkgSSdtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iIDogcmVzcC5kYXRhLnJlc3BvbnNlc1swXS50ZXh0LAogICAgICAgICAgdGltZTogX3RoaXM4LmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGltYWdlOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLmltZyA9PSAiIiA/IG51bGwgOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLmltZwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczguJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczguY2hhdCk7CgogICAgICAgIF90aGlzOC51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICB9KTsKICAgIH0sCiAgICByZXNwb25zZV9oYW5kbGluZzogZnVuY3Rpb24gcmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UsIHR5cGUpIHsKICAgICAgdmFyIGkgPSAwOwogICAgICB2YXIgZGVsYXkgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0Lmxlbmd0aCA+IDEwID8gMjAwMCA6IDUwMDsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaGFuZGxlX3Jlc3BvbnNlKCk7CiAgICAgIH0sIGRlbGF5KTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZV9yZXNwb25zZSgpIHsKICAgICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCB8fCByZXNwb25zZS5kYXRhLnJlc3BvbnNlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB2bS5jaGF0X3Jlc3BvbnNlX2Vycm9yKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnJlcXVlc3RfanNvbiAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmVxdWVzdF9qc29uID09IHRydWUpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gbnVsbCkgewogICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LAogICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgICAgaW1hZ2U6IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmltZywKICAgICAgICAgICAgICAgIHZpZGVvOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZtLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdm0uY2hhdCk7CiAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmludGVudCA9PSAiZ29neWI0NTBfY3JlYXRlX3RpY2tldCIpIHsKICAgICAgICAgICAgICB2YXIgX2F4aW9zJHBvc3Q0OwoKICAgICAgICAgICAgICB2YXIgbmFtZTsKCiAgICAgICAgICAgICAgaWYgKHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZmlyc3RfbmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lICsgIiAiICsgdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5sYXN0X25hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS4kc2Vzc2lvbi5oYXMoIlVzZXJGaXJzdE5hbWUiKSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHZtLiRzZXNzaW9uLmdldCgiVXNlckZpcnN0TmFtZSIpICsgIiAiICsgdm0uJHNlc3Npb24uZ2V0KCJVc2VyTGFzdE5hbWUiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgdXNlcm5hbWU6IG5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdm0uY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHZtLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgICAgICAgICAgZW1haWw6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHRpY2tldF9pc3N1ZTogIiIsCiAgICAgICAgICAgICAgICB0aWNrZXRfbnVtYmVyOiB2bS50aWNrZXRfbnVtYmVyKCksCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIiIsCiAgICAgICAgICAgICAgICBmaWxlX2NvbnRlbnQ6IG51bGwsCiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgICBpc0VkaXQ6IGZhbHNlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBwYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7CiAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3Q0ID0gewogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdm0uYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAidG9rZW4iLCB2bS5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAicm9sZSIsIHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdm0ucmVmcmVzaGVkX29yX2Nsb3NlZCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJjaGF0IiwgIiIpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAic291cmNlIiwgIldlYiIpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAiZGF0YSIsIHBheWxvYWQpLCBfYXhpb3MkcG9zdDQpKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcC5kYXRhLnJlc3BvbnNlcy5sZW5ndGggPT0gMCA/ICJTb3JyeSBJJ20gbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbiIgOiByZXNwLmRhdGEucmVzcG9uc2VzW2ldLnRleHQsCiAgICAgICAgICAgICAgICAgIHRpbWU6IHZtLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgICAgICAgICAgaW1hZ2U6IHJlc3AuZGF0YS5yZXNwb25zZXNbaV0uaW1nLAogICAgICAgICAgICAgICAgICB2aWRlbzogcmVzcC5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbyAhPSBudWxsID8gcmVzcC5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbyA6IG51bGwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdm0uJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB2bS5jaGF0KTsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ID09ICJjcmVhdGVfYXBwb2ludG1lbnQiKSB7CiAgICAgICAgICAgICAgdmFyIHRvZGF5X2RhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxlX2FwcG9pbnRtZW50X3VybCgpLCB7CiAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdm0uY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHZtLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIERhdGU6IHRvZGF5X2RhdGUuZ2V0RnVsbFllYXIoKSArICItIiArICh0b2RheV9kYXRlLmdldE1vbnRoKCkgPCA5ID8gIjAiICsgKHRvZGF5X2RhdGUuZ2V0TW9udGgoKSArIDEpIDogdG9kYXlfZGF0ZS5nZXRNb250aCgpICsgMSkgKyAiLSIgKyB0b2RheV9kYXRlLmdldERhdGUoKSAvL01vbnRoIG9iamVjdCBkb2N1bWVudCBpdAogICAgICAgICAgICAgICAgLy8gRGF0ZTogc3RhcnRfdGltZSwKCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsvLyB0aGlzLnRpbWVfc2xvdHMgPSB0aGlzLmZ1bGxfdGltZV9zbG90czsKICAgICAgICAgICAgICAgIC8vIGlmIChyZXNwb25zZS5kYXRhLlNsb3QgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAvLyAgIGlmIChyZXNwb25zZS5kYXRhLlNsb3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgLy8gICAgIGxldCBpbmRleDsKICAgICAgICAgICAgICAgIC8vICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuU2xvdCkgewogICAgICAgICAgICAgICAgLy8gICAgICAgaW5kZXggPSB0aGlzLnRpbWVfc2xvdHMuaW5kZXhPZihyZXNwb25zZS5kYXRhLlNsb3RbaV0pOwogICAgICAgICAgICAgICAgLy8gICAgICAgaWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudGltZV9zbG90cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgLy8gICAgICAgfQogICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdm0uc2VuZF9yZXF1ZXN0X2pzb24ocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmV0dXJuX2ludGVudCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmV0dXJuX2ludGVudCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBfYXhpb3MkcG9zdDU7CgogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIChfYXhpb3MkcG9zdDUgPSB7CiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHZtLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgICAgICB1c2VybmFtZTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAidG9rZW4iLCB2bS5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAicm9sZSIsIHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDUsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdm0ucmVmcmVzaGVkX29yX2Nsb3NlZCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDUsICJjaGF0IiwgIi8iICsgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50KSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NSwgInNvdXJjZSIsICJXZWIiKSwgX2F4aW9zJHBvc3Q1KSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICB2bS5oYW5kbGVfcmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodm0uY29tcGFueWlkID09ICIzeDVpdmU5OTUzNCIgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbnRlbnQgPT0gImNvbmZ1c2lvbiIpIHsKICAgICAgICAgICAgdm0uY29uZnVzaW9uX21lc3NhZ2UoIi9uZWVkX2hlbHAiKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uYnV0dG9ucyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdm0ubG9hZF9idXR0b25zKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLCBpKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvL0NIYW5nZSAgdGhlIGNvbmRpdGlvbiBoZXJlCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5jdXN0b20udHlwZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tLnR5cGUgPT0gIm11bHRpc2VsZWN0X2Ryb3Bkb3duIikgewogICAgICAgICAgICAgIHZtLm11bHRpc2VsZWN0X2xvYWQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0sIGkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmN1c3RvbS50eXBlICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5jdXN0b20udHlwZSA9PSAidGFibGUiKSB7CiAgICAgICAgICAgICAgdm0ubG9hZF90YWJsZShyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXSwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy90aGlzIG9uZSBmb3IgZm9yZWlnbnhjaGFuZ2UKICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LnRvTG93ZXJDYXNlKCkgPT0gInNvcnJ5IGkgYW0gbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbiIgfHwgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC50b0xvd2VyQ2FzZSgpID09ICJpcyB0aGVyZSBhbnl0aGluZyBpIGNhbiBoZWxwIHlvdSB3aXRoPyIpKSB7CiAgICAgICAgICAgICAgaWYgKHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkgPT0gIi5lSnhUY3NzdlNzMU16NnRJemtqTVMwODFORGV4TklRS0tVREZNa3BLQ29xdDlQWEx5OHYxMGxCVTZ5WG41LW9sbHVvYkdSaGE2aHFZNnhxWUtCZ2FXQmtaVzVtYTZobWJtNWdZbVNvQkFHYTlIcDAuWFIzVHV3Llg3N0ZfN0xEdE9McDJWdDlzbkZEU28zMW5UdyIgfHwgdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSA9PSAiLmVKeFRjaTR0THNuUFRTM3lTQ3dveU14TExTNjJORFcwTUlXSktzQ0ZNMHBLQ29xdDlQWEx5OHYxa2pPS0VfVVNVX1dOREF3dGRRM01kUTJORkF3TnJZREl4RnpQeE1UUzB0SklDUUJqWnh1eC5YU2hxOHcuUGdvNWNtS3dNUUZuWVVzc2Nwb2p3RXFEWFF3IikgewogICAgICAgICAgICAgICAgdm0uaW5pdGlhdGVfc3VwcG9ydF9jaGF0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJTb3JyeSBJIGFtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWU6IGkgPT0gcmVzcG9uc2UuZGF0YS5yZXNwb25zZXMubGVuZ3RoIC0gMSA/IHZtLmdlbmVyYXRlX3RpbWUoKSA6IG51bGwKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9ICJTb3JyeSB3ZSBhcmUgbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbi4iOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmluZyA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LmluY2x1ZGVzKCIucGRmIikpIHsKICAgICAgICAgICAgICAgIHZtLmRpc3BsYXlfcGRmX2NoYXQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiAhcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC5pbmNsdWRlcygiRG93bmxvYWQgeW91ciBtYW5pZmVzdCBoZXJlIikpIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQ7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1zZy5pbWFnZSA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmltZzsKICAgICAgICAgICAgICAgIG1zZy52aWRlb3MgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbyA9PSBudWxsID8gW10gOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbzsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaChtc2cpOwoKICAgICAgICAgICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdm0udG9fc2Nyb2xsID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPiAwLjUgJiYgJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC42KSB7CiAgICAgICAgICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogMC45ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDAuNzUgKiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSAtICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIHZtLnRvX3Njcm9sbCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbnRlbnQgPT0gImNoYXRfc3VwcG9ydCIpIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gIkkgYW0gY29ubmVjdGluZyB5b3UgdG8gb25lIG9mIG91ciBzdXBwb3J0IGFnZW50cy4gUGxlYXNlIHdhaXQgZm9yIGEgd2hpbGUuIjsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2gobXNnKTsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJXaGF0J3MgeW91ciBuYW1lPyIsCiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgICAgIGF4aW9zLmdldChhcGlfY2FsbHMuY2hhdF9ncm91cF9hcGkoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgdm0uY2hhdF9ncm91cF9uYW1lID0gcmVzcG9uc2UuZGF0YS5jaGF0X2dyb3VwX25hbWU7CiAgICAgICAgICAgICAgICAgIHZtLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAgICAgICAgICAgICAgIHZtLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHZtLmNoYXRfc29ja2V0ID0gbmV3IFNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbnk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgY2hhdF9ncm91cF9uYW1lOiB2bS5jaGF0X2dyb3VwX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogdm0ubGl2ZV9jaGF0X3Rva2VuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhdF9zb2NrZXQuY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsID0gdm0uY2hhdF9zb2NrZXQuY2hhbm5lbCgiY3VzdG9tZXJzX2dyb3VwczoiICsgdm0uY2hhdF9ncm91cF9uYW1lKTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5qb2luKCk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYW5uZWwucHVzaCgiY3VzdG9tZXJfbmVlZHNfc3VwcG9ydF9hZ2VudCIpOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsLm9uKCJuZXdfY2hhdF9tZXNzYWdlIiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc2VuZGVyICE9ICJjdXN0b21lciIpIHsKICAgICAgICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlcy5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsLm9uKCJzdG9wcGVkX2NoYXQiLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJTdXBwb3J0IGFnZW50ICIgKyByZXMubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IF90aGlzOS5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB2bS5saXZlX2NoYXRfb24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigic3RhcnRlZF90eXBpbmciLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uaXNfdHlwaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigic3RvcHBlZF90eXBpbmciLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uaXNfdHlwaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCAhPSB1bmRlZmluZWQgJiYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQuaW5jbHVkZXMoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSIpIHx8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQuaW5jbHVkZXMoLy5wZGYvKSkpIHsKICAgICAgICAgICAgICAgIHZtLmRpc3BsYXlfcGRmX2NoYXQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucHJvZHVjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdm0uZGlzcGxheV9wcm9kdWN0c19jaGF0KHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSA8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgaSArPSAxOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICBkZWxheSA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICAgICAgICBoYW5kbGVfcmVzcG9uc2UoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBkZWxheSk7CiAgICAgIH0KICAgIH0sCiAgICBwdXNoX21zZzogZnVuY3Rpb24gcHVzaF9tc2cocmVzcG9uc2VzLCByZXNwb25zZSkgewogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2YXIgZGVsYXkgPSByZXNwb25zZVtpbmRleF0udGV4dC5sZW5ndGggPiAxMCA/IDIwMDAgOiA1MDA7CiAgICAgIHB1c2hfY2hhdChyZXNwb25zZVtpbmRleF0sIGRlbGF5KTsKICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKCiAgICAgIGZ1bmN0aW9uIHB1c2hfY2hhdChtc2csIHRpbWVfZGVsYXkpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgICAgICAgIGlmIChyZXNwb25zZXMuZGF0YS5yZXNwb25zZXNbaW5kZXhdLmJ1dHRvbnMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZtLmxvYWRfYnV0dG9ucyhyZXNwb25zZXMuZGF0YS5yZXNwb25zZXNbaW5kZXhdLCAiaXNfYnV0dG9uIiwgIndlbGNvbWVfbWVzc2FnZSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgcmVjZWl2ZWQ6IG1zZy50ZXh0LAogICAgICAgICAgICAgIHRpbWU6IGluZGV4ID09IHJlc3BvbnNlLmxlbmd0aCAtIDEgPyB2bS5nZW5lcmF0ZV90aW1lKCkgOiB1bmRlZmluZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiLnRpbWUiKS5sYXN0KCkuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCIudGltZSIpLmxhc3QoKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsKCiAgICAgICAgICAgIGlmIChpbmRleCA8IHJlc3BvbnNlLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICBpbmRleCArPSAxOwogICAgICAgICAgICAgIGRlbGF5ID0gcmVzcG9uc2VbaW5kZXhdLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICAgICAgICAgIHB1c2hfY2hhdChyZXNwb25zZVtpbmRleF0sIGRlbGF5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMScpOwogICAgICAgICAgICAgIHZtLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9LCB0aW1lX2RlbGF5KTsKICAgICAgfQogICAgfSwKICAgIGNvbmZ1c2lvbl9tZXNzYWdlOiBmdW5jdGlvbiBjb25mdXNpb25fbWVzc2FnZShtc2dfc3RyaW5nKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgIGNoYXQ6IG1zZ19zdHJpbmcsCiAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICB1c2VyX2lkOiAiIiwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIGRhdGE6ICIiLAogICAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMC5yZXNwb25zZV9oYW5kbGluZyhyZXNwb25zZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpeF9hcHBvaW50bWVudDogZnVuY3Rpb24gZml4X2FwcG9pbnRtZW50KCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfSwKICAgIGRpc3BsYXlfcHJvZHVjdHNfY2hhdDogZnVuY3Rpb24gZGlzcGxheV9wcm9kdWN0c19jaGF0KG1lc3NhZ2UpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwogICAgICBtc2cuaXNwcm9kdWN0ID0gdHJ1ZTsKICAgICAgbXNnLmVsZW1lbnRzID0gbWVzc2FnZTsKICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBkaXNwbGF5X3BkZl9jaGF0OiBmdW5jdGlvbiBkaXNwbGF5X3BkZl9jaGF0KG1lc3NhZ2UpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwoKICAgICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSAiKSkgewogICAgICAgIHZhciB0ZW1wID0gbWVzc2FnZS5zcGxpdCgiRG93bmxvYWQgeW91ciBtYW5pZmVzdCBoZXJlICIpOwogICAgICAgIG1zZy51cmwgPSB0ZW1wWzFdOwogICAgICAgIG1zZy5yZWNlaXZpbmcgPSBmYWxzZTsKICAgICAgICBtc2cuZmlsZV9uYW1lID0gbWVzc2FnZS5zcGxpdCgvXi4qW1xcXC9dLylbMV07CiAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHVybCA9IG1lc3NhZ2UubWF0Y2goLygoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OltcLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05XC5cLV0rfCg/Ond3d1wufFtcLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTlcLlwtXSspKCg/OlwvW1wrfiVcL1wuXHdcLV9dKik/XD8/KD86W1wtXCs9JjslQFwuXHdfXSopIz8oPzpbXC5cIVwvXFxcd10qKSk/KS9nKVswXTsKICAgICAgICBtc2cudXJsID0gdXJsOwogICAgICAgIG1zZy5yZWNlaXZpbmcgPSBmYWxzZTsKICAgICAgICBtc2cuZmlsZV9uYW1lID0gdXJsLnNwbGl0KC9eLipbXFxcL10vKVsxXTsKICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlX3BheW1lbnQ6IGZ1bmN0aW9uIGdlbmVyYXRlX3BheW1lbnQocHJpY2UsIG5hbWUpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgIGFtb3VudDogcHJpY2UgKiAxMDAsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgY3VycmVuY3k6ICJJTlIiLAogICAgICAgIGRlc2NyaXB0aW9uOiAiSW5zdGlsbCBJbnRlbGxpZ2VuY2UiLAogICAgICAgIGltYWdlOiAiL2ltZy9jZW5zZV9pbWFnZS5wbmciLAogICAgICAgIC8vIENPTVBBTlkgTE9HTwogICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBjb250YWN0ID0gJCgnI2NvbnRhY3RbdHlwZT0idGVsIl0nKS52YWx1ZTsKICAgICAgICAgIHZhciBlbWFpbCA9ICQoJyNlbWFpbFt0eXBlPSJlbWFpbCJdJykudmFsdWU7CiAgICAgICAgICB2bS5wYXltZW50aWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwoKICAgICAgICAgIGlmICh0cmFuc2Zlcl9hY2NvdW50ICE9IG51bGwpIHsKICAgICAgICAgICAgdm0udHJhbnNmZXJfcGF5bWVudCh0cmFuc2Zlcl9hY2NvdW50LCBwcmljZSAqIDEwMCwgIklOUiIsIG5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcHJlZmlsbDogewogICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAvLyBwYXNzIGN1c3RvbWVyIG5hbWUKICAgICAgICAgIGVtYWlsOiAiIiwKICAgICAgICAgIC8vIGN1c3RvbWVyIGVtYWlsCiAgICAgICAgICBjb250YWN0OiAiIiAvL2N1c3RvbWVyIHBob25lIG5vLgoKICAgICAgICB9LAogICAgICAgIG5vdGVzOiB7CiAgICAgICAgICBhZGRyZXNzOiAiYWRkcmVzcyIgLy9jdXN0b21lciBhZGRyZXNzCgogICAgICAgIH0sCiAgICAgICAgdGhlbWU6IHsKICAgICAgICAgIGNvbG9yOiAiIzI4Mzc3NyIgLy8gc2NyZWVuIGNvbG9yCgogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHJ6cDEgPSBuZXcgUmF6b3JwYXkob3B0aW9ucyk7CiAgICAgIHJ6cDEub3BlbigpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfSwKICAgIHRyYW5zZmVyX3BheW1lbnQ6IGZ1bmN0aW9uIHRyYW5zZmVyX3BheW1lbnQoYWNjb3VudCwgYW1vdW50LCBjdXJyZW5jeSwgbmFtZSkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KCJodHRwczovL2FwaS5yYXpvcnBheS5jb20vMS90cmFuc2ZlcnMiLCB7CiAgICAgICAgYXV0aDogewogICAgICAgICAgcnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQ6ICJsbHhFS2JnQUJIOEx4NFhBcGV4OWNHemoiCiAgICAgICAgfSwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3kKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gaWYodGhpcy51c2VyX2RhdGEuYXBpX2tleSE9JycpIHsKICAgICAgICBfdGhpczExLnNob3BpZnlfb3JkZXJfY3JlYXRlKG5hbWUpOyAvLyB9CgogICAgICB9KTsKICAgIH0sCiAgICBzaG9waWZ5X29yZGVyX2NyZWF0ZTogZnVuY3Rpb24gc2hvcGlmeV9vcmRlcl9jcmVhdGUobmFtZSkge30sCiAgICBjbGlja19wcm9tcHQ6IGZ1bmN0aW9uIGNsaWNrX3Byb21wdCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHRoaXMubGl2ZV9jaGF0X29uID0gZmFsc2U7CiAgICAgIHZhciBkaXZjbGlja3BvcHVwID0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dDsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICB9LCA1MDApOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgaWYgKHR5cGUgIT0gImNvbGxhcHNpYmxlIikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb21wdF91cmwoKSwgewogICAgICAgICAgdWlkOiAiY2Vuc2UiLAogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBjaGF0OiBldmVudC50YXJnZXQuaW5uZXJUZXh0LAogICAgICAgICAgbGV2ZWw6IGV2ZW50LnRhcmdldC5hdHRyaWJ1dGVzLnZhbHVlLm5vZGVWYWx1ZQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2xsYXBzaWJsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgIF90aGlzMTIuY3JlYXRlX2NoYXQocmVzcG9uc2UuZGF0YSwgImlzcHJvbXB0Iik7CgogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuZXh0cmFzICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLmV4dHJhc1swXS5UeXBlID09ICJUQUJMRSIpIHsKICAgICAgICAgICAgX3RoaXMxMi5jcmVhdGVfY2hhdChyZXNwb25zZS5kYXRhLCAiaXN0YWJsZSIpOwoKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gIk9vcHMhIFNvbWV0aGluZyB3ZW50IHdyb25nISIpIHsKICAgICAgICAgICAgICBfdGhpczEyLmNyZWF0ZV9jaGF0KHJlc3BvbnNlLmRhdGEsICJpc3Byb21wdCIpOwoKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmchIikgewogICAgICAgICAgICAgIF90aGlzMTIuY2hhdC5wdXNoKHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICAgICAgICBfdGhpczEyLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXMxMi5jaGF0KTsKCiAgICAgICAgICAgICAgX3RoaXMxMi51cGRhdGVfc2Nyb2xsYmFyKCk7CgogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gImNvbGxhcHNpYmxlIikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb21wdF91cmwoKSwgewogICAgICAgICAgdWlkOiAiY2Vuc2UiLAogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBjaGF0OiAiIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEyLmNoYXQucHVzaChyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgICBfdGhpczEyLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CgogICAgICAgICAgX3RoaXMxMi4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzMTIuY2hhdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBidXR0b25fZmlsbDogZnVuY3Rpb24gYnV0dG9uX2ZpbGwoKSB7CiAgICAgIGlmICh0aGlzLmlzZXhjaGFuZ2UpIHsKICAgICAgICBpZiAodGhpcy50b19zZW5kID09ICIiKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiM4YThhOGE2MyI7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgIT0gIiIpIHsKICAgICAgICAgIGlmICh0aGlzLmxpdmVfY2hhdF9vbikgewogICAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaCgic3RhcnRlZF90eXBpbmciKTsKICAgICAgICAgICAgdGhpcy5zdG9wX3R5cGluZyh0aGlzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiNmZGNmMzgiOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdGhpcy5pc2V4Y2hhbmdlKSB7CiAgICAgICAgaWYgKHRoaXMudG9fc2VuZCA9PSAiIikgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbmRfYnV0dG9uIikuc3R5bGUuZmlsbCA9ICIjOGE4YThhNjMiOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy50b19zZW5kICE9ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy5saXZlX2NoYXRfb24pIHsKICAgICAgICAgICAgdGhpcy5jaGFubmVsLnB1c2goInN0YXJ0ZWRfdHlwaW5nIik7CiAgICAgICAgICAgIHRoaXMuc3RvcF90eXBpbmcodGhpcyk7CiAgICAgICAgICB9CgogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbmRfYnV0dG9uIikuc3R5bGUuZmlsbCA9ICIjMjczNjc5IjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdG9wX3R5cGluZzogZGVib3VuY2UoZnVuY3Rpb24gKHZtKSB7CiAgICAgIHZtLmNoYW5uZWwucHVzaCgic3RvcHBlZF90eXBpbmciKTsKICAgIH0sIDUwMDApLAogICAgc2Nyb2xsX2Rvd246IGZ1bmN0aW9uIHNjcm9sbF9kb3duKCkgewogICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWJvZHkiKS5zY3JvbGxUb3AgLSAkKCIuY2hhdC1oaXMiKS5sYXN0KCkuaGVpZ2h0KCkgPD0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLmNsaWVudEhlaWdodCkgewogICAgICAgIHRoaXMudG9fc2Nyb2xsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b19zY3JvbGwgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgbG9hZF9idXR0b25zOiBmdW5jdGlvbiBsb2FkX2J1dHRvbnMobWVzc2FnZSwgaW5kZXgsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgIGJ1dHRvbl9wcmVmaXg6IG1lc3NhZ2UucHJlZml4LAogICAgICAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogbWVzc2FnZS50ZXh0LAogICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICB9OwoKICAgICAgaWYgKG1lc3NhZ2UuYnV0dG9ucy5sZW5ndGggPT0gMykgewogICAgICAgIGlmIChtZXNzYWdlLmJ1dHRvbnNbMF0udGl0bGUgPT0gIkV4Y2hhbmdlIFJhdGUiICYmIG1lc3NhZ2UuYnV0dG9uc1sxXS50aXRsZSA9PSAiVHJhY2sgTXkgUGFyY2VsIiAmJiBtZXNzYWdlLmJ1dHRvbnNbMl0udGl0bGUgPT0gIkNhbGwgSGVscGRlc2siKSB7CiAgICAgICAgICBtc2cucmVtb3ZhYmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobWVzc2FnZS50ZXh0ID09ICJXb3VsZCB5b3UgbGlrZSB0byBzaGFyZSB5b3VyIG5hbWUgYW5kIG51bWJlcj8iICYmIHRoaXMuaXNleGNoYW5nZSkgewogICAgICAgICQoIiNyZXNwb25zZV9ib3RfdGV4dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgaW4gbWVzc2FnZS5idXR0b25zKSB7CiAgICAgICAgaWYgKG1zZy5idXR0b25fcHJlZml4ICE9IG51bGwpIHsKICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udGl0bGUsCiAgICAgICAgICAgIHZhbHVlOiBtc2cuYnV0dG9uX3ByZWZpeCArIG1lc3NhZ2UuYnV0dG9uc1tpXS52YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udGl0bGUsCiAgICAgICAgICAgIHZhbHVlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udmFsdWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1zZy5idXR0b25zX2xpc3RbaV0udGl0bGUgPT0gIk5vIiAmJiBtZXNzYWdlLnRleHQgIT0gIkNhbiBJIGhlbHAgeW91IHdpdGggYW55dGhpbmcgZWxzZT8iICYmIHRoaXMuY29tcGFueWlkID09ICJjbGluaWNhbHRyaWFsczgxMzUyIikgewogICAgICAgICAgbXNnLmJ1dHRvbnNfbGlzdFtpXS52YWx1ZSA9ICJpc2Rpc2FibGVkIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTMuY2hhdC5wdXNoKG1zZyk7CgogICAgICAgIGlmIChpbmRleCA9PSAiaXNfYnV0dG9uIiB8fCBpbmRleCA9PSAwKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsVG9wIikgKyA1MAogICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMxMy50b19zY3JvbGwgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMxMy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzMTMuY2hhdCk7CiAgICAgIH0sIDI1MDApOwogICAgfSwKICAgIG11bHRpc2VsZWN0X2xvYWQ6IGZ1bmN0aW9uIG11bHRpc2VsZWN0X2xvYWQobWVzc2FnZSwgaW5kZXgpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICBtdWx0aXNlbGVjdF92YWx1ZXM6IG1lc3NhZ2UuY3VzdG9tLnZhbHVlcywKICAgICAgICBwbGFjZWhvbGRlcjogbWVzc2FnZS5jdXN0b20ucGxhY2Vob2xkZXIsCiAgICAgICAgaXNfbXVsdGlzZWxlY3Q6IHRydWUsCiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLnRleHQsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfTsKICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgIH0sCiAgICBsb2FkX3RhYmxlOiBmdW5jdGlvbiBsb2FkX3RhYmxlKG1lc3NhZ2UsIGluZGV4KSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgY29sX2xpc3Q6IE9iamVjdC5rZXlzKG1lc3NhZ2UuY3VzdG9tLnZhbHVlc1swXSksCiAgICAgICAgdGFibGVfdmFsdWU6IG1lc3NhZ2UuY3VzdG9tLnZhbHVlcywKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2UudGV4dCwKICAgICAgICBpc190YWJsZTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE0LmNoYXQucHVzaChtc2cpOwoKICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuY2hpbGRyZW4oKS5sYXN0KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogMC43ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbFRvcCIpICsgMTAwCiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgIF90aGlzMTQudG9fc2Nyb2xsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIDI1MDApOwogICAgfSwKICAgIGNyZWF0ZV9jaGF0OiBmdW5jdGlvbiBjcmVhdGVfY2hhdChtZXNzYWdlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciBjdXJyZW5jeV9saXN0ID0gW107CgogICAgICBpZiAodHlwZSA9PSAiaXN0YWJsZSIpIHsKICAgICAgICBheGlvcy5nZXQoImh0dHBzOi8vYXBpLmV4Y2hhbmdlcmF0ZXNhcGkuaW8vbGF0ZXN0IiwgewogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIGJhc2U6ICJBVUQiCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gbWVzc2FnZS5leHRyYXNbMF0uVEFCTEUpIHsKICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZXh0cmFzWzBdLlRBQkxFW2ldLlBST1AgPT0gIlRSIikgewogICAgICAgICAgICAgIGN1cnJlbmN5X2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICBjdXJyZW5jeV90aXRsZTogbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uVEQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeV92YWx1ZTogcGFyc2VGbG9hdChNYXRoLnJvdW5kKHJlc3BvbnNlLmRhdGEucmF0ZXNbbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV1bIlREXzEiXV0gKiAxMDApIC8gMTAwKS50b0ZpeGVkKDQpLAogICAgICAgICAgICAgICAgdHlwZTogIlRSIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZXh0cmFzWzBdLlRBQkxFW2ldLlBST1AgPT0gIlRIRUFEIiAmJiAhX3RoaXMxNS5pc2V4Y2hhbmdlKSB7CiAgICAgICAgICAgICAgY3VycmVuY3lfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIGNvdW50cnlfbmFtZTogbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uVEQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeV9uYW1lOiBtZXNzYWdlLmV4dHJhc1swXS5UQUJMRVtpXS5URF8xLAogICAgICAgICAgICAgICAgdHlwZTogIlRIRUFEIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vLwoKCiAgICAgICAgICBfdGhpczE1LmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdCA9IGN1cnJlbmN5X2xpc3Q7IC8vLwoKICAgICAgICAgIF90aGlzMTUuY2hhdC5wdXNoKHsKICAgICAgICAgICAgaXNfdGFibGU6IHRydWUsCiAgICAgICAgICAgIHRhYmxlX3RpdGxlOiBfdGhpczE1LnBhcnNlKG1lc3NhZ2UudGl0bGUpLAogICAgICAgICAgICB0YWJsZV9saXN0OiBjdXJyZW5jeV9saXN0CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczE1LnVwZGF0ZV9zY3JvbGxiYXIoKTsKCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiaXNwcm9tcHQiKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UubGV2ZWwgPiAwKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtZXNzYWdlKTsKICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgICAgdGhpcy5sZXZlbCA9IG1lc3NhZ2UubGV2ZWw7CiAgICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1lc3NhZ2UpOwogICAgICAgICAgdGhpcy5maXJzdF9jbGljayA9IHRydWU7CiAgICAgICAgICB0aGlzLmxldmVsID0gbWVzc2FnZS5sZXZlbDsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jaGF0LnB1c2gobWVzc2FnZSk7CiAgICAgIH0KCiAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgfSwKICAgIHN1Ym1pdF9jdXN0b21fZm9ybTogZnVuY3Rpb24gc3VibWl0X2N1c3RvbV9mb3JtKCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2RldGFpbHNfZm9ybSIpICE9IG51bGwpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNkZXRhaWxzX2Zvcm0iKTsKICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInN1Ym1pdCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gYWN0dWFsIGxvZ2ljLCBlLmcuIHZhbGlkYXRlIHRoZSBmb3JtCgogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2RldGFpbHNfZm9ybSIpLnNlcmlhbGl6ZUFycmF5KCk7CgogICAgICAgICAgaWYgKF90aGlzMTYuZm9ybV9wYXlsb2FkID09IG51bGwpIHsKICAgICAgICAgICAgdmFyIF9heGlvcyRwb3N0NjsKCiAgICAgICAgICAgIF90aGlzMTYuZm9ybV9wYXlsb2FkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgICAgX3RoaXMxNi5mb3JtX3BheWxvYWRbcXVlcnlTdHJpbmdbaV0ubmFtZV0gPSBxdWVyeVN0cmluZ1tpXS52YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuYm90X3VzZXJfZGF0YSgpLCAoX2F4aW9zJHBvc3Q2ID0gewogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZGF0YTogX3RoaXMxNi5mb3JtX3BheWxvYWQsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTYuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICAgIHVzZXJuYW1lOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgc291cmNlOiAiV2ViIgogICAgICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q2LCAidG9rZW4iLCBfdGhpczE2LmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDYsICJyb2xlIiwgX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfYXhpb3MkcG9zdDYpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJCb3QgVXNlciBEYXRhIFNhdmVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgICQoIiNkZXRhaWxzX2Zvcm0gOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICQoIiNkZXRhaWxzX2Zvcm0gOmJ1dHRvbiIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgX3RoaXMxNi51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwoKICAgICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgICAgICAgICBjaGF0OiAiL2RldGFpbHNfZm9ybSIsCiAgICAgICAgICAgICAgICAgIHRva2VuOiBfdGhpczE2LmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgICAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIERldGFpbHM6IEpTT04uc3RyaW5naWZ5KF90aGlzMTYuZm9ybV9wYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgcm9sZTogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTYucmVzcG9uc2VfaGFuZGxpbmcocmVzcCk7CgogICAgICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlX3Njcm9sbGJhcjogZnVuY3Rpb24gdXBkYXRlX3Njcm9sbGJhcih0eXBlLCBpc3Jlc3BvbnNlLCBpc3dlbGNvbWUsIGRlbGF5X3ZhbHVlKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHZhciBzY3JvbGxfZGVsYXkgPSBpc3dlbGNvbWUgPT0gImlzX3dlbGNvbWUiID8gZGVsYXlfdmFsdWUgOiAyMDAwOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgaWYgKGlzcmVzcG9uc2UgPT0gInJlc3BvbnNlIikgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0sIHNjcm9sbF9kZWxheSk7CiAgICAgIH0gZWxzZSBpZiAoaXNyZXNwb25zZSA9PSAic2VuZGVyIikgewogICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgfSwgNzUwKTsKICAgICAgfQoKICAgICAgaWYgKGlzcmVzcG9uc2UgIT0gInNlbmRlciIpIHsKICAgICAgICBpZiAodHlwZSA9PSAidXB0b19lbmQiKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxUb3AiKSA8ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKSkgewogICAgICAgICAgICAgIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjc1ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICAgIF90aGlzMTcudG9fc2Nyb2xsID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC41KSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICB9LCBzY3JvbGxfZGVsYXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBzY3JvbGxfZGVsYXkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbFRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWJvZHkiKS5zY3JvbGxIZWlnaHQgLSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hhdC1ib2R5IikubGFzdENoaWxkLnNjcm9sbEhlaWdodDsKICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIEZYUGF5bWVudE1vZGU6IGZ1bmN0aW9uIEZYUGF5bWVudE1vZGUoKSB7CiAgICAgIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9wYXltZW50X21vZGUiOwogICAgICB0aGlzLnNlbmRfbWVzc2FnZSgiaXNfcHJvbXB0IiwgIi9Gb3JlaWdueGNoYW5nZTE3NDkxX3BheW1lbnRfbW9kZSIsICJQYXltZW50Iik7CiAgICB9LAogICAgRlhUcmFja2luZ1BhcmNlbDogZnVuY3Rpb24gRlhUcmFja2luZ1BhcmNlbCgpIHsKICAgICAgdGhpcy50b19zZW5kID0gIi9Gb3JlaWdueGNoYW5nZTE3NDkxX3RyYWNraW5nX3BhcmNlbCI7CiAgICAgIHRoaXMuc2VuZF9tZXNzYWdlKCJpc19wcm9tcHQiLCAiL0ZvcmVpZ254Y2hhbmdlMTc0OTFfdHJhY2tpbmdfcGFyY2VsIiwgIlRyYWNrIE15IFBhcmNlbCIpOwogICAgfSwKICAgIC8vIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb24oKSB7CiAgICAvLyAgIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRlIjsKICAgIC8vICAgdGhpcy5zZW5kX21lc3NhZ2UoCiAgICAvLyAgICAgImlzX3Byb21wdCIsCiAgICAvLyAgICAgIi9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGUiLAogICAgLy8gICAgICJFeGNoYW5nZSBSYXRlIgogICAgLy8gICApOwogICAgLy8gfSwKICAgIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb246IGZ1bmN0aW9uIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb24oKSB7CiAgICAgIC8vIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRlIjsKICAgICAgdGhpcy50b19zZW5kID0gJy9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGV7IkJVWV9PUl9TRUxMIjogIkJVWSJ9JzsKICAgICAgdGhpcy5zZW5kX21lc3NhZ2UoImlzX3Byb21wdCIsICcvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRleyJCVVlfT1JfU0VMTCI6ICJCVVkifScsICJFeGNoYW5nZSBSYXRlIik7CiAgICB9LAogICAgZXgxOiBmdW5jdGlvbiBleDEoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjEiKSAhPSBudWxsKSB7CiAgICAgICAgICAkKCIjbDEiKS52YWwoMSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczE4LmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjY291bnRyeSIpLmFwcGVuZCgiPG9wdGlvbiB2YWx1ZT1cIiIuY29uY2F0KF90aGlzMTguY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3ZhbHVlLCAiXCI+IikuY29uY2F0KF90aGlzMTguY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3RpdGxlLCAiPC9vcHRpb24+IikpOwogICAgICAgICAgfQoKICAgICAgICAgICQoIiNyMSIpLnRleHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZSk7IC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMSIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAvLyAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIxIikuaW5uZXJUZXh0OwogICAgICAgICAgLy8gICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgIC8vICAgeCA9IHggLyBjb247CiAgICAgICAgICAvLyAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAvLyAgICQoIiNsMSIpLnZhbCh4KTsKICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLnZhbHVlOwogICAgICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgICAgeCA9IHggKiBjb247CiAgICAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAgICQoIiNyMSIpLnRleHQoeCk7CiAgICAgICAgICB9KTsKICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCJjaGFuZ2UiLCAiI2NvdW50cnkiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb3VudHJ5IikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLnZhbHVlOwogICAgICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgICAgeCA9IHggKiBjb247CiAgICAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAgICQoIiNyMSIpLnRleHQoeCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgYWRkZHJvcGRvd252YWx1ZTogZnVuY3Rpb24gYWRkZHJvcGRvd252YWx1ZSgpIHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnRvX3NlbmQgPSAiIjsKICAgICAgICB0aGlzLnJlcyA9IHt9OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udGl0bGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnRvX3NlbmQgKyAiLCAiICsgdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnRpdGxlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnJlc1t0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udmFsdWUuc3BsaXQoJyInKVsxXV0gPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMucmVzW3RoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS52YWx1ZS5zcGxpdCgnIicpWzFdXSA9IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS52YWx1ZS5zcGxpdCgnIicpWzNdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5yZXNbdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbMV1dID0gdGhpcy5yZXNbdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbMV1dICsgIiwiICsgdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbM107CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b19zZW5kID0gIiI7CiAgICAgICAgdGhpcy5yZXMgPSBbXTsKICAgICAgfQoKICAgICAgdGhpcy5idXR0b25fZmlsbCgpOwogICAgfSwKICAgIGNsb3NlZF9ib3RfY2hhdDogZnVuY3Rpb24gY2xvc2VkX2JvdF9jaGF0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgLy8gZGVidWdnZXI7CiAgICAgIC8vIGNvbnNvbGUubG9nKG1lc3NhZ2UpOwogICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOyAvLyBsYXN0Y2xvc2VkYm90aW5wdXRub2RlCgogICAgICBpZiAobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLm5vZGVfdHlwZSA9PSAiaGVhZGVyIiAmJiBtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0ubm9kZV90eXBlICE9IG51bGwgJiYgIXRoaXMuZW1wdHlfc3RyaW5nX3ZhbGlkaXR5LnRlc3QobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLm5vZGVfdHlwZSkpIHsKICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLnRpdGxlID09ICJEaXNwbGF5IE1lc3NhZ2UiKSB7CiAgICAgICAgICBtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0udGl0bGUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbbWVzc2FnZS5ub2Rlcy5sZW5ndGggLSAxXS50aXRsZSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgdGltZTogbnVsbAogICAgICAgIH0pOwogICAgICB9IC8vIGNvbnNvbGUubG9nKG1lc3NhZ2Uubm9kZXMubGVuZ3RoKTsKCgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMTsgaSArPSAxKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cobWVzc2FnZS5ub2Rlcyk7CiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJidXR0b24iICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgfTsKCiAgICAgICAgICB3aGlsZSAobWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiYnV0dG9uIikgewogICAgICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICB0aXRsZTogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmJ1dHRvbiwKICAgICAgICAgICAgICAgIHZhbHVlOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGF5bG9hZCwKICAgICAgICAgICAgICAgIGlkOiBtZXNzYWdlLm5vZGVzW2ldLm5vZGVfaWQsCiAgICAgICAgICAgICAgICBub2RlOiBtZXNzYWdlLm5vZGVzW2ldCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgLy8gICB0aXRsZTogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmJ1dHRvbnMsCiAgICAgICAgICAgIC8vICAgdmFsdWU6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wYXlsb2FkLAogICAgICAgICAgICAvLyB9KTsKCgogICAgICAgICAgICBpKys7CiAgICAgICAgICB9CgogICAgICAgICAgaS0tOwogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJ0ZXh0X2JveCIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZQogICAgICAgICAgfSk7IC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKCiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsgLy8gY29uc29sZS5sb2coJzInKTsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAidGV4dF9hcmVhIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAvLyByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPHRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjQiIGNvbHM9IjE1MCJzdHlsZT0icGFkZGluZy1sZWZ0OjEycHg7cmVzaXplOm5vbmU7b3ZlcmZsb3cteTphdXRvO21pbi1oZWlnaHQ6MzBweCIgcGxhY2Vob2xkZXI9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIgKyAnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nICsgaSArICciPjwvdGV4dGFyZWE+JywKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gImNsb3NlZF9ib3Rfbm9kZV8iICsgaTsgLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgIC8vICAgICB0aXRsZTogJ1N1Ym1pdCcsCiAgICAgICAgICAvLyAgICAgdmFsdWU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gICB9KTsKCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgICAgdGhpcy5pc190ZXh0X2FyZWEgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImVtYWlsIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuaXNlbWFpbCA9IHRydWU7IC8vIGlmKG1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IGZhbHNlKXsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwKICAgICAgICAgIC8vIH0pOwogICAgICAgICAgLy8gdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyAgaWYoIW1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsKXsKCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsgLy8gIH0KICAgICAgICAgIC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJlbWFpbCIgcGxhY2Vob2xkZXI9IicrbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKICAgICAgICAgIC8vIC8vIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAvLyAvLyAgICAgdGl0bGU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICAgIHZhbHVlOiAnU3VibWl0JywKICAgICAgICAgIC8vIC8vICAgfSk7CiAgICAgICAgICAvLyB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInBob25lX251bWJlciIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmlzX3Bob25lX251bWJlciA9IHRydWU7IC8vIGlmKG1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IGZhbHNlKXsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwKICAgICAgICAgIC8vIH0pOwogICAgICAgICAgLy8gdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAvLyB9CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXgiPiA8c2VsZWN0IG5hbWU9ImNvdW50cnljb2RlIiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjZweCAhaW1wb3J0YW50O3BhZGRpbmctcmlnaHQ6NnB4ICFpbXBvcnRhbnQ7IHdpZHRoOjQwJTtoZWlnaHQ6NTBweCAhaW1wb3J0YW50OyIgID4nIC8vIHJlY2VpdmVkOiAnJywKCiAgICAgICAgICB9OyAvLyB2YXIgZHJvcGRvd24gPSBbXTsKCiAgICAgICAgICB2YXIgZGF0YSA9IENvdW50cnlDb2RlczsKICAgICAgICAgIHZhciBvcHRpb24gPSB2b2lkIDA7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGRhdGEubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIC8vIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAvLyBvcHRpb24udGV4dCA9IGRhdGFbaV0uY291bnRyeV9jb2RlOwogICAgICAgICAgICAvLyBvcHRpb24udmFsdWUgPSBkYXRhW2ldLmNhbGxpbmdfY29kZTsKICAgICAgICAgICAgLy8gLy8gZHJvcGRvd24uYWRkKG9wdGlvbik7CiAgICAgICAgICAgIC8vIG1zZy5yZWNlaXZlZD1tc2cucmVjZWl2ZWQgKyBvcHRpb247CiAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8b3B0aW9uIHZhbHVlPSAnICsgZGF0YVtfaV0uZGlhbF9jb2RlICsgJz4nICsgZGF0YVtfaV0uY29kZSArICIoIiArIGRhdGFbX2ldLmRpYWxfY29kZSArICIpIiArICc8L29wdGlvbj4nOwogICAgICAgICAgfQoKICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8L3NlbGVjdD4nOwogICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjEycHggIWltcG9ydGFudDsgaGVpZ2h0OjUwcHggIWltcG9ydGFudDsiIGF1dG9jb21wbGV0ZT0ib2ZmIiBuYW1lPSJwaG9uZW51bWJlciIgaWQ9ICJwaG9uZW51bWJlciIgbmFtZT0iY2xvc2VkX2JvdF9ub2RlXycgKyBpICsgJyI+ICA8L2Rpdj4nOyAvLyBjb25zb2xlLmxvZyhtc2cpOwoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7IC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgIC8vIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSwKICAgICAgICAgIC8vIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gdGltZTogbnVsbAogICAgICAgICAgLy8gfSk7CgogICAgICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciA9ICJwaG9uZW51bWJlciI7IC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJlbWFpbCIgcGxhY2Vob2xkZXI9IicrbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKICAgICAgICAgIC8vIC8vIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAvLyAvLyAgICAgdGl0bGU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICAgIHZhbHVlOiAnU3VibWl0JywKICAgICAgICAgIC8vIC8vICAgfSk7CiAgICAgICAgICAvLyB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImh5cGVybGluayIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPGEgaHJlZj0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5oeXBlcmxpbmsgKyAnIiB0YXJnZXQ9Il9ibGFuayI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5oeXBlcmxpbmsgKyAnPC9hPicKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInJhZGlvX2J1dHRvbnMiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICcnCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwKICAgICAgICAgIH0pOyAvLyBtc2cucmVjZWl2ZWQgPSBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZTsKCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLm5vZGVfaWQgKyAnIiB2YWx1ZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zW2pdLnRpdGxlICsgJyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zW2pdLnRpdGxlICsgJzxicj4nOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiY2hlY2tfYm94IiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnJwogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICB9KTsKCiAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlcy5sZW5ndGg7IF9qKyspIHsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfal0udGl0bGUgKyAnIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfal0udGl0bGUgKyAnPGJyPic7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJkcm9wZG93biIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxzZWxlY3QgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCArICciIGNsYXNzPSJmb3JtLWNvbnRyb2wiID48b3B0aW9uIHZhbHVlIGRpc2FibGVkPSJkaXNhYmxlZCI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlICsgJzwvb3B0aW9uPicgLy8gcmVjZWl2ZWQ6ICcnLAoKICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgX2oyID0gMDsgX2oyIDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmRyb3Bkb3duLmxlbmd0aDsgX2oyKyspIHsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxvcHRpb24+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5kcm9wZG93bltfajJdLnRpdGxlICsgJzwvb3B0aW9uPic7CiAgICAgICAgICB9CgogICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImltYWdlIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8aW1nIHdpZHRoPSIyMTBweCIgaGVpZ2h0PSIxNDBweCIgc3JjPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmltYWdlICsgJyI+JwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAidmlkZW8iICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxpZnJhbWUgd2lkdGg9IjIxMHB4IiBoZWlnaHQ9IjE0MHB4IiBzcmM9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmlkZW8gKyAnIjwvaWZyYW1lPicKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gIm1lc3NhZ2UiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJycKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgZm9ybSA9ICc8Zm9ybSBpZD0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uZm9ybV9uYW1lLnJlcGxhY2UoJyAnLCAnXycpICsgJyI+JzsKCiAgICAgICAgICB3aGlsZSAobWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgICAgLy8gZm9ybT1mb3JtKyc8YnI+JwogICAgICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInRleHRfYm94IikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJyIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9InBhZGRpbmctbGVmdDoxMHB4ICFpbXBvcnRhbnQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnBsYWNlaG9sZGVyICsgJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJyArIGkgKyAnIj4nOwogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvZGl2Pic7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImRyb3Bkb3duIikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8c2VsZWN0IG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIGNsYXNzPSJmb3JtLWNvbnRyb2wiID4nOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfajMgPSAwOyBfajMgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZHJvcGRvd24ubGVuZ3RoOyBfajMrKykgewogICAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPG9wdGlvbj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmRyb3Bkb3duW19qM10udGl0bGUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiY2hlY2tfYm94IikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKCiAgICAgICAgICAgICAgZm9yICh2YXIgX2o0ID0gMDsgX2o0IDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlcy5sZW5ndGg7IF9qNCsrKSB7CiAgICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfajRdLnRpdGxlICsgJyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC52YWx1ZXNbX2o0XS50aXRsZSArICc8YnI+JzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvZGl2Pic7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInJhZGlvX2J1dHRvbnMiKSB7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6NDUwO2ZvbnQtc2l6ZToxNXB4OyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJzwvcD4nOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfajUgPSAwOyBfajUgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucmFkaW9fYnV0dG9ucy5sZW5ndGg7IF9qNSsrKSB7CiAgICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnJhZGlvX2J1dHRvbnNbX2o1XS50aXRsZSArICciPicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucmFkaW9fYnV0dG9uc1tfajVdLnRpdGxlICsgJzxicj4nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSAvLyBmb3JtPWZvcm0rJzxicj4nCgoKICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQoKICAgICAgICAgIGktLTsKICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5Ij5TdWJtaXQ8L2J1dHRvbj48L2Zvcm0+JzsKICAgICAgICAgIHRoaXMuaXNmb3Jtb24gPSB0cnVlOwogICAgICAgICAgdGhpcy5mb3JtX25hbWUgPSBtZXNzYWdlLm5vZGVzW2ldLmZvcm1fbmFtZS5yZXBsYWNlKCcgJywgJ18nKTsKICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IGZvcm07CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgICAgdGhpcy5zdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIHJlY2VpdmVkOiBudWxsCiAgICAgICAgfSk7CgogICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICdtZXNzYWdlJyAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICdpbWFnZScgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSAhPSAndmlkZW8nICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgIT0gJ2J1dHRvbicgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSAhPSAnaHlwZXJsaW5rJykgewogICAgICAgICAgdGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlID0gdGhpcy5jaGF0Lmxlbmd0aCAtIDE7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkbm9kZWlkID0gbWVzc2FnZS5ub2Rlc1tpXTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICdidXR0b24nKSB7CiAgICAgICAgICB0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgPSB0aGlzLmNoYXQubGVuZ3RoIC0gMjsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRub2RlaWQgPSBtZXNzYWdlLm5vZGVzW2ldOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0uaXNfbGVhZikgewogICAgICAgICAgdGhpcy5pc2Nsb3NlZGJvdG9uID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdm0gPSBfdGhpczE5OwogICAgICAgIHZtLnRvX3Njcm9sbCA9IHRydWU7CgogICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuY2hpbGRyZW4oKS5sYXN0KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0gZWxzZSBpZiAoJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpID4gMC41ICYmICQoIi5yZWNlaXZlciIpLmxhc3QoKS5wYXJlbnQoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNikgewogICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICBzY3JvbGxUb3A6IDAuOSAqICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjc1ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9CgogICAgICAgIGlmICgkKCIuY2hhdC1ib2R5Iikuc2Nyb2xsVG9wKCkgPT0gMCkgewogICAgICAgICAgX3RoaXMxOS50b19zY3JvbGwgPSBmYWxzZTsKICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpKQoKCiAgICAgICAgaWYgKHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgIT0gbnVsbCkgewogICAgICAgICAgJCgnW25hbWU9JyArIHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdm0uYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCk7CiAgICAgICAgfQogICAgICB9LCAxMDAwKTsKICAgIH0sCiAgICBzdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YTogZnVuY3Rpb24gc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEodHlwZSwgbWVzc2FnZSkgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CgogICAgICAvLyBkZWJ1Z2dlcjsKICAgICAgLy8gY29uc29sZS5sb2codHlwZSwgJ0hlbGxvIEhhcnNoJyk7CiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkpICE9IG51bGwgJiYgdHlwZSA9PSAnaXNfYnV0dG9uJyAmJiBtZXNzYWdlLnRpdGxlID09ICJTdWJtaXQiKSB7CiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlICsgMSkpOwogICAgICAgIHZhciBxdWVyeVN0cmluZyA9ICQoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSArICIgOmlucHV0Iikuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgaWYgKHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0gPSBxdWVyeVN0cmluZ1tpXS52YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YS5xdWVyeVN0cmluZ1tpXS5uYW1lLnB1c2gocXVlcnlTdHJpbmdbaV0udmFsdWUpOwogICAgICAgICAgICA7CiAgICAgICAgICB9CgogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSwKICAgICAgICAgICAgbm9kZV9zZWxlY3RlZDogdGhpcy5zZWxlY3RlZG5vZGVpZCwKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ2lzX2J1dHRvbicpIHsKICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGNoYXQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICAvLyBub2RlX3NlbGVjdGVkOiB7bm9kZV9pZDogbWVzc2FnZS5pZH0sCiAgICAgICAgICBub2RlX3NlbGVjdGVkOiBtZXNzYWdlLm5vZGUsCiAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiAhdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlciAmJiB0aGlzLmlzX3RleHRfYXJlYSkgewogICAgICAgIHRoaXMuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7IC8vICQoJ1tuYW1lPScrdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKyddJykuYXR0cigiZGlzYWJsZWQiLCAnZGlzYWJsZWQnKQogICAgICAgIC8vIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciA9IG51bGw7CgogICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSArIDEpKTsKICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkgKyAiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CgogICAgICAgIGlmICh0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPT0gbnVsbCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhW3F1ZXJ5U3RyaW5nW2ldLm5hbWVdID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0ucHVzaChxdWVyeVN0cmluZ1tpXS52YWx1ZSk7CiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICBkZWxpdmVyZWQ6IHRydWUsCiAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgfSk7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgY2hhdDogdGhpcy50b19zZW5kLAogICAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwoKICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlcikgewogICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjIiArIHRoaXMuZm9ybV9uYW1lKSAhPSBudWxsKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiMiICsgdGhpcy5mb3JtX25hbWUpOwogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJzdWJtaXQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiIyIgKyBfdGhpczIwLmZvcm1fbmFtZSkuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgICAgIGlmIChfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CgogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YVtxdWVyeVN0cmluZ1tpXS5uYW1lXSA9IFtdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhW3F1ZXJ5U3RyaW5nW2ldLm5hbWVdLnB1c2gocXVlcnlTdHJpbmdbaV0udmFsdWUpOwoKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMyMC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdWlkOiBfdGhpczIwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBjaGF0OiBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEsCiAgICAgICAgICAgICAgICBub2RlX3NlbGVjdGVkOiBfdGhpczIwLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiBfdGhpczIwLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgICAgICAgIGJvdF9uYW1lOiBfdGhpczIwLmJvdF9uYW1lCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICQoIiMiICsgX3RoaXMyMC5mb3JtX25hbWUgKyAiIDppbnB1dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7IC8vIGNvbnNvbGUubG9nKCIjIit0aGlzLmZvcm1fbmFtZSsiOmlucHV0Iik7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gdW5kZWZpbmVkICYmIHRoaXMuaXNlbWFpbCkgewogICAgICAgIC8vIGFsZXJ0KHRoaXMudG9fc2VuZCk7CiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSkgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlICsgMSkpOwogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgdmFyIHggPSB0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxOyAvLyBpZih0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGE9PW51bGwpewoKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSB7fTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHVpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0ZWRub2RlaWQsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQsCiAgICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICB2YXIgZXJyb3JfdmFyaWFibGUgPSBudWxsOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCByZXNwb25zZS5kYXRhLm5vZGVzLmxlbmd0aCAtIDE7IF9pMiArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kyXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kyXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGVycm9yX3ZhcmlhYmxlID0gX2kyOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTJdLnVpX2VsZW1lbnQuZXJyb3JfbXNnLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXJyb3JfdmFyaWFibGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgX3RoaXMyMC5pc2VtYWlsID0gZmFsc2U7CgogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5pc19waG9uZV9udW1iZXIpIHsKICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpKSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAodGhpcy5pc19waG9uZV9udW1iZXJfb3RwID09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGR0cyA9IHRoaXMudG9fc2VuZDsKICAgICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUpOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNfcGhvbmVfbnVtYmVyX2Vycl9tc2cpIHsKICAgICAgICAgICAgICB2YXIgeCA9ICQoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSArICIgOmlucHV0Iikuc2VyaWFsaXplQXJyYXkoKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiaWYgbG9vcCIpOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImVsc2UgbG9vcCIpOwogICAgICAgICAgICAgIHZhciB4ID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zb2xlLmxvZyh4KTsKICAgICAgICAgICAgdmFyIGR0cyA9IHhbMF0udmFsdWUgKyB4WzFdLnZhbHVlOwogICAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgc2VudDogZHRzLAogICAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gdGhpcy5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsKICAgICAgICAgIC8vIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiKyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUrMSkpOwogICAgICAgICAgLy8gdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiKyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUtMSkrIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgLy8gaWYodGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhPT1udWxsKXsKCgogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IHt9OwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IGR0cywKICAgICAgICAgICAgbm9kZV9zZWxlY3RlZDogdGhpcy5zZWxlY3RlZG5vZGVpZCwKICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY2hhdCk7CiAgICAgICAgICAgIF90aGlzMjAudG9fc2VuZCA9ICIiOwogICAgICAgICAgICB2YXIgZXJyb3JfdmFyaWFibGUgPSBudWxsOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCByZXNwb25zZS5kYXRhLm5vZGVzLmxlbmd0aCAtIDE7IF9pMyArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlID09ICJwaG9uZV9udW1iZXIiICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuaXNfcGhvbmVfbnVtYmVyX2Vycl9tc2cgPSB0cnVlOwogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIGVycm9yX3ZhcmlhYmxlID0gX2kzOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7IC8vICB0aGlzLnNlbGVjdGVkbm9kZWlkID0gcmVzcG9uc2UuZGF0YS5ub2RlczsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiAnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4Ij4gPHNlbGVjdCBuYW1lPSJjb3VudHJ5Y29kZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9InBhZGRpbmctbGVmdDo2cHggIWltcG9ydGFudDtwYWRkaW5nLXJpZ2h0OjZweCAhaW1wb3J0YW50OyB3aWR0aDo0MCU7aGVpZ2h0OjUwcHggIWltcG9ydGFudDsiICA+JyAvLyByZWNlaXZlZDogJycsCgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJyZWFjaGVkIGhlcmUiKTsgLy8gdmFyIGRyb3Bkb3duID0gW107CgogICAgICAgICAgICAgICAgX3RoaXMyMC5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsKCiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IENvdW50cnlDb2RlczsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSB2b2lkIDA7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgZGF0YS5sZW5ndGg7IF9pNCsrKSB7CiAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgICAvLyBvcHRpb24udGV4dCA9IGRhdGFbaV0uY291bnRyeV9jb2RlOwogICAgICAgICAgICAgICAgICAvLyBvcHRpb24udmFsdWUgPSBkYXRhW2ldLmNhbGxpbmdfY29kZTsKICAgICAgICAgICAgICAgICAgLy8gLy8gZHJvcGRvd24uYWRkKG9wdGlvbik7CiAgICAgICAgICAgICAgICAgIC8vIG1zZy5yZWNlaXZlZD1tc2cucmVjZWl2ZWQgKyBvcHRpb247CiAgICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8b3B0aW9uIHZhbHVlPSAnICsgZGF0YVtfaTRdLmRpYWxfY29kZSArICc+JyArIGRhdGFbX2k0XS5jb2RlICsgIigiICsgZGF0YVtfaTRdLmRpYWxfY29kZSArICIpIiArICc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8L3NlbGVjdD4nOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjEycHggIWltcG9ydGFudDsgaGVpZ2h0OjUwcHggIWltcG9ydGFudDsiIGF1dG9jb21wbGV0ZT0ib2ZmIiBuYW1lPSJwaG9uZW51bWJlciIgaWQ9ICJwaG9uZW51bWJlciIgbmFtZT0iY2xvc2VkX2JvdF9ub2RlXycgKyBfaTMgKyAnIj4gIDwvZGl2Pic7IC8vIGNvbnNvbGUubG9nKG1zZyk7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jaGF0LnB1c2gobXNnKTsgLy8gdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgLy8gcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgLy8gcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICAgICAgLy8gY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAvLyB0aW1lOiBudWxsCiAgICAgICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7CgoKICAgICAgICAgICAgICAgIF90aGlzMjAucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMjAubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyBfdGhpczIwLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLm9mZigna2V5dXAnLCB2bS5hcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczIwLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgPSAicGhvbmVudW1iZXIiOwogICAgICAgICAgICAgICAgdmFyIHZtID0gX3RoaXMyMDsKICAgICAgICAgICAgICAgIF90aGlzMjAubGFzdGNsb3NlZGJvdGlucHV0bm9kZSA9IF90aGlzMjAuY2hhdC5sZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfdGhpczIwLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUpOwogICAgICAgICAgICAgICAgdmFyIGxlbiA9ICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gaWYodm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciAhPSBudWxsKXsKICAgICAgICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZygkKCdbbmFtZT0nK3ZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIrJ10nKSkKICAgICAgICAgICAgICAgICAgLy8gICBpZigkKCdbbmFtZT0nK3ZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIrJ10nKS5sZW5ndGg+MSl7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpW2xlbl0pCiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVtsZW5dLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdm0uYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCk7IC8vIH1lbHNlIHsKCiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVswXS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHZtLmFwcGVuZF9tZXNzYWdlX3RvX2NoYXRib3gpOyAvLyB9CiAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICAgICAgX3RoaXMyMC5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC52YWxpZGF0ZSA9PSAib3RwIiAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgICBfdGhpczIwLnNlbGVjdGVkbm9kZWlkID0gcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdOwogICAgICAgICAgICAgICAgZXJyb3JfdmFyaWFibGUgPSBfaTM7CiAgICAgICAgICAgICAgICBfdGhpczIwLmlzX3Bob25lX251bWJlcl9vdHAgPSB0cnVlOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQub3RwX3F1ZXN0aW9uX2xhYmVsLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC52YWxpZGF0ZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQudmFsaWRhdGUgPT0gIm90cCIgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIF90aGlzMjAuc2VsZWN0ZWRub2RlaWQgPSByZXNwb25zZS5kYXRhLm5vZGVzW19pM107CiAgICAgICAgICAgICAgICBlcnJvcl92YXJpYWJsZSA9IF9pMzsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LmluY29ycmVjdF9vdHBfbXNnLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczIwLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygicmVhY2hlZCBoZXJlMiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXJyb3JfdmFyaWFibGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CgogICAgICAgICAgICAgIF90aGlzMjAuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKCiAgICAgICAgICAgICAgX3RoaXMyMC5pc19waG9uZV9udW1iZXIgPSBmYWxzZTsgLy8gfSwgMSk7CgogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsgLy8gfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiAhdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlciAmJiAhdGhpcy5pc190ZXh0X2FyZWEpIHsKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgIH0pOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CgogICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRkYXRhOiBmdW5jdGlvbiBnZXRkYXRhKCkgewogICAgICBpZiAoIXRoaXMuaXNmb3Jtb24gJiYgIXRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgIHRoaXMudG9fc2VuZCA9ICcnOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXJ5U3RyaW5nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMudG9fc2VuZCA9IHF1ZXJ5U3RyaW5nW2ldLnZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy50b19zZW5kID0gdGhpcy50b19zZW5kICsgIiwiICsgcXVlcnlTdHJpbmdbaV0udmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICB9LAogICAgYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveDogZnVuY3Rpb24gYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCgpIHsKICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyLCB0aGlzLmlzX3Bob25lX251bWJlcik7CiAgICAgIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpKTsKCiAgICAgIGlmICh0aGlzLmlzX3RleHRfYXJlYSkgewogICAgICAgIHRoaXMudG9fc2VuZCA9ICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpWzBdLnZhbHVlOwogICAgICAgIHRoaXMuYnV0dG9uX2ZpbGwoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgdmFyIGxlbiA9ICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLmxlbmd0aDsKICAgICAgICB0aGlzLnRvX3NlbmQgPSAkKCdbbmFtZT0nICsgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVtsZW4gLSAxXS52YWx1ZTsKICAgICAgfQogICAgfSwKICAgIGRpc2FibGVfbmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcjogZnVuY3Rpb24gZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCkgewogICAgICAvLyBjb25zb2xlLmxvZygiV2UgYXJlIGhlcmUgZGlzYWJsZWQgZnVuY3Rpb24iKQogICAgICAkKCdbbmFtZT0nICsgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKS5hdHRyKCJkaXNhYmxlZCIsICdkaXNhYmxlZCcpOyAvLyAkKCdbbmFtZT0nK3RoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpLnJlbW92ZSgpOwoKICAgICAgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gbnVsbDsKCiAgICAgIGlmICh0aGlzLmlzX3Bob25lX251bWJlcikgewogICAgICAgICQoJ1tuYW1lPWNvdW50cnljb2RlXScpLmF0dHIoImRpc2FibGVkIiwgJ2Rpc2FibGVkJyk7IC8vICQoJ1tuYW1lPWNvdW50cnljb2RlXScpLnJlbW92ZSgpOwogICAgICB9CiAgICB9LAogICAgZ29fdG9fZGVzaWduX2JvdHNfcGFnZTogZnVuY3Rpb24gZ29fdG9fZGVzaWduX2JvdHNfcGFnZSgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9ib3QvZGVzaWduYm90Jyk7CiAgICB9IC8vc2VsbCBmdW5jdGlvbiBmb3IgZm9yZWlnbiBleGNoYW5nZQogICAgLy8gZXgyKCkgewogICAgLy8gICBzZXRUaW1lb3V0KCgpID0+IHsKICAgIC8vICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIyIikgIT0gbnVsbCkgewogICAgLy8gICAgICAgJCgiI2wyIikudmFsKDEpOwogICAgLy8gICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdC5sZW5ndGg7IGkrKykgewogICAgLy8gICAgICAgICAkKCIjY291bnRyeTIiKS5hcHBlbmQoCiAgICAvLyAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7dGhpcy5jdXJyZW5jeWV4Y2hhbmdlX2xpc3RbaV0uY3VycmVuY3lfdmFsdWV9Ij4ke3RoaXMuY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3RpdGxlfTwvb3B0aW9uPmAKICAgIC8vICAgICAgICAgKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgICQoIiNyMiIpLnZhbChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZSk7CiAgICAvLyAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjIiKS5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uKCkgewogICAgLy8gICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMiIpLnZhbHVlOwogICAgLy8gICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHggPSB4IC8gY29uOwogICAgLy8gICAgICAgICB4ID0geC50b0ZpeGVkKDQpOwogICAgLy8gICAgICAgICAkKCIjbDIiKS52YWwoeCk7CiAgICAvLyAgICAgICB9KTsKICAgIC8vICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMiIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZTsKICAgIC8vICAgICAgICAgeCA9IHggKiBjb247CiAgICAvLyAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAvLyAgICAgICAgICQoIiNyMiIpLnZhbCh4KTsKICAgIC8vICAgICAgIH0pOwogICAgLy8gICAgICAgJChkb2N1bWVudCkub24oImNoYW5nZSIsICIjY291bnRyeTIiLCBmdW5jdGlvbigpIHsKICAgIC8vICAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpewogICAgLy8gICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMiIpLnZhbHVlOwogICAgLy8gICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHggPSB4ICogY29uOwogICAgLy8gICAgICAgICB4ID0geC50b0ZpeGVkKDQpOwogICAgLy8gICAgICAgICAkKCIjcjIiKS52YWwoeCk7CiAgICAvLyAgICAgICB9KTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0sIDMwMDApOwogICAgLy8gfQoKICB9Cn07"},null]}