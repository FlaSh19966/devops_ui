{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/PortalUserChatHistory.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/PortalUserChatHistory.vue","mtime":1663910265466},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIi9ob21lL3ZpbWFsZXNoL0NFTlNFL2NoYXRib3QtcG9ydGFsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IHsgQ29udGVudExvYWRlciB9IGZyb20gInZ1ZS1jb250ZW50LWxvYWRlciI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdCwKICAgIENvbnRlbnRMb2FkZXI6IENvbnRlbnRMb2FkZXIKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBudW1iZXJfb2Zfcm93czogIiIsCiAgICAgIHRvdGFsX3BhZ2VzOiAwLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHVzZXJfbGlzdDogW10sCiAgICAgIHVzZXJfcmVwbHk6IFtdLAogICAgICBib3RfcmVwbHk6IFtdLAogICAgICBjaGF0RGV0YWlsczogW10sCiAgICAgIGFjdGlvbl9zdGF0czogW10sCiAgICAgIHVzZXJfYWN0aW9uX3N0YXRzOiBbXSwKICAgICAgY3VycmVudF91c2VyOiAiIiwKICAgICAgdGltZXN0YW1wOiAiIiwKICAgICAgc2VuZGVyX2lkOiBbXSwKICAgICAgc2VsZWN0ZWQ6ICJnZW5lcmFsX2NoYXRfaGlzdG9yeSIsCiAgICAgIHNlbGVjdGVkX2RhdGU6ICIiLAogICAgICBzZWxlY3RlZF9pbmRleDogbnVsbCwKICAgICAgY2hhdF9kYXRlczogW10sCiAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBpc3NlYXJjaDogZmFsc2UsCiAgICAgIHNlYXJjaHN0cmluZzogIiIsCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIHZpZXdfY29tcG9uZW50X25hbWU6ICJwb3J0YWxfdXNlciIsCiAgICAgIC8vIGZpbmdlcnByaW50cmVnZXg6L15bMC05XXsxMH0kLywKICAgICAgZmluZ2VycHJpbnRyZWdleDogL15bMC05LStcL1xzXXs5LH0kLywKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHNob3dfbG9hZGVyOiBmYWxzZSwKICAgICAgaXNfcG9ydGFsX3VzZXI6IHRydWUsCiAgICAgIGNvbnRhY3RfaGVscF9lbWFpbDogbnVsbCwKICAgICAgcmV0YWlsX3dlYl9mcmFtZXdvcms6IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpLAogICAgICBmaWx0ZXJfY2hhdF9oaXN0b3J5OiB0aGlzLiRzZXNzaW9uLmdldCgiZmlsdGVyX2NoYXRfaGlzdG9yeSIpCiAgICB9OwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yayA9IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oInNlYXJjaF9wb3J0YWxfdXNlcl9jaGF0X2hpc3RvcnkiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBfdGhpcy5zZWFyY2hzdHJpbmcgPSBkYXRhOwoKICAgICAgX3RoaXMuc2VhcmNoX2NoYXQoKTsgLy8gdGhpcy5zZWFyY2hfcXVlc3Rpb24oKTsKCiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCJsb2FkX3BvcnRhbF91c2VyX2NoYXRfaGlzdG9yeSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIF90aGlzLmxvYWRfcG9ydGFsX3VzZXJfY2hhdF9oaXN0b3J5KCk7CiAgICB9KTsKICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICB0aGlzLiRyb290LiRvZmYoInNlYXJjaF9wb3J0YWxfdXNlcl9jaGF0X2hpc3RvcnkiKTsKICAgIHRoaXMuJHJvb3QuJG9mZigibG9hZF9wb3J0YWxfdXNlcl9jaGF0X2hpc3RvcnkiKTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRfcHJvZHVjdF9zZXR0aW5ncygpOwogICAgdGhpcy5sb2FkX3BvcnRhbF91c2VyX2NoYXRfaGlzdG9yeSgpOwogIH0sCiAgbWV0aG9kczogewogICAgZm9ybWF0X2RhdGVfaW5fbG9jYWxfdGltZXpvbmU6IGZ1bmN0aW9uIGZvcm1hdF9kYXRlX2luX2xvY2FsX3RpbWV6b25lKGRhdGUpIHsKICAgICAgdmFyIHRlc3REYXRlVXRjID0gbW9tZW50LnV0YyhkYXRlKTsKICAgICAgdmFyIGxvY2FsRGF0ZSA9IG1vbWVudCh0ZXN0RGF0ZVV0YykubG9jYWwoKS50b0RhdGUoKTsgLy8gbm90ZTogZG8gbm90IGZvcm1hdCB0aW1lIGJlbG93IHRvIHNob3cgaG91ciBhbmQgbWludXRlIGJlY2F1c2UgIlZpZXcgQ2hhdCBIaXN0b3J5IiBzaG93IGFsbCBtZXNzYWdlIG9mIHRoYXQgZGF0ZSBub3Qgc3BlY2lmaWMgaG91ci1taW51dGUgdGltZS4KCiAgICAgIGxvY2FsRGF0ZSA9IG1vbWVudChsb2NhbERhdGUpLmZvcm1hdCgiZGRkIE1NTSBEIFlZWVkiKTsKICAgICAgcmV0dXJuIGxvY2FsRGF0ZS50b1N0cmluZygpOwogICAgfSwKICAgIG1lc3NhZ2luZ19wbGF0Zm9ybV9mb3JtYXRpbmc6IGZ1bmN0aW9uIG1lc3NhZ2luZ19wbGF0Zm9ybV9mb3JtYXRpbmcobWVzc2FnZSkgewogICAgICByZXR1cm4gIlBsZWFzZSBmZWVsIGZyZWUgdG8gcmVhY2hvdXQgdG8gdXMgYXQgOiIgKyBtZXNzYWdlOwogICAgfSwKICAgIG1lc3NhZ2luZ19wbGF0Zm9ybV9mb3JtYXRpbmdfbnVtYmVyOiBmdW5jdGlvbiBtZXNzYWdpbmdfcGxhdGZvcm1fZm9ybWF0aW5nX251bWJlcihtZXNzYWdlKSB7CiAgICAgIGlmIChtZXNzYWdlICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gIiBvciBjYWxsIHVzIGF0IDoiICsgbWVzc2FnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBjb25mdXNpb25fbWVzc2FnZV9mb3JtYXRpbmc6IGZ1bmN0aW9uIGNvbmZ1c2lvbl9tZXNzYWdlX2Zvcm1hdGluZyhtZXNzYWdlKSB7CiAgICAgIHJldHVybiBtZXNzYWdlLnNwbGl0KCJ7ZW1haWx9Iikuam9pbih0aGlzLmNvbnRhY3RfaGVscF9lbWFpbCk7CiAgICB9LAogICAgbG9hZF9wcm9kdWN0X3NldHRpbmdzOiBmdW5jdGlvbiBsb2FkX3Byb2R1Y3Rfc2V0dGluZ3MoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb2R1Y3Rfc2V0dGluZ3MoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgd2ViZnJhbWV3b3JrID0gX3RoaXMyLnJldGFpbF93ZWJfZnJhbWV3b3JrOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBpZiAod2ViZnJhbWV3b3JrKSB7CiAgICAgICAgICAgIF90aGlzMi5jb250YWN0X2hlbHBfZW1haWwgPSByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgIl9kZXRhaWxzIl0uY29udGFjdF9oZWxwX2VtYWlsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyLmNvbnRhY3RfaGVscF9lbWFpbCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kZXRhaWxzLmNvbnRhY3RfaGVscF9lbWFpbDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMi5zaG93X2xvYWRlciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrX2ltYWdlX3R5cGU6IGZ1bmN0aW9uIGNoZWNrX2ltYWdlX3R5cGUoaW1hZ2UpIHsKICAgICAgaWYgKHR5cGVvZiBpbWFnZSA9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBpbWFnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaW1hZ2UgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGltYWdlLnNyYzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvYWRfcG9ydGFsX3VzZXJfY2hhdF9oaXN0b3J5OiBmdW5jdGlvbiBsb2FkX3BvcnRhbF91c2VyX2NoYXRfaGlzdG9yeSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNlYXJjaHN0cmluZyA9ICIiOwogICAgICB0aGlzLmFjdGlvbl9zdGF0cyA9IFtdOwogICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzID0gW107CiAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5hY3Rpb25fc3RhdHNfdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5DT01QQU5ZX0FDVElPTl9TVEFUUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMy5hY3Rpb25fc3RhdHMgPSByZXNwb25zZS5kYXRhLmRhdGEuYWN0aW9uX3N0YXRzOwoKICAgICAgICAgIF90aGlzMy5hY3Rpb25fc3RhdHMucHVzaCh7CiAgICAgICAgICAgIEhpdHM6IDEsCiAgICAgICAgICAgIE5hbWU6ICJnZW5lcmFsX2NoYXRfaGlzdG9yeSIKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczMuc2hvd19sb2FkZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmdlbmVyYWxfY2hhdF9oaXN0b3J5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzc2hvdzogdHJ1ZSwKICAgICAgICBpc19wb3J0YWxfdXNlcjogdHJ1ZSwKICAgICAgICBhY3Rpb246ICJnZW5lcmFsX2NoYXRfaGlzdG9yeSIsCiAgICAgICAgZmlsdGVyX2NoYXRfaGlzdG9yeTogdGhpcy4kc2Vzc2lvbi5nZXQoImZpbHRlcl9jaGF0X2hpc3RvcnkiKSwKICAgICAgICBwYWdlbm86IHRoaXMucGFnZV9ubywKICAgICAgICBwZXJwYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICBfdGhpczMudXNlcl9hY3Rpb25fc3RhdHMgPSBbXTsKCiAgICAgICAgaWYgKF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygKICAgICAgICAgICAgLy8gICB0aGlzLmZpbmdlcnByaW50cmVnZXgudGVzdChyZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyKQogICAgICAgICAgICAvLyApOwogICAgICAgICAgICBpZiAoX3RoaXMzLmZpbmdlcnByaW50cmVnZXgudGVzdChyZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIpKSB7CiAgICAgICAgICAgICAgX3RoaXMzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgdXNlcmVtYWlsOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uRW1haWwsCiAgICAgICAgICAgICAgICB1c2VycGhvbmVudW1iZXI6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICB1c2VyaWQ6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAgIGRhdGU6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5EYXRlCiAgICAgICAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKHRoaXMudXNlcl9hY3Rpb25fc3RhdHMsIHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0pOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczMudXNlcl9hY3Rpb25fc3RhdHMucHVzaCh7CiAgICAgICAgICAgICAgICB1c2VyZW1haWw6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAgIHVzZXJwaG9uZW51bWJlcjogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLlBob25lTnVtYmVyLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5Vc2VyTmFtZSwKICAgICAgICAgICAgICAgIHVzZXJpZDogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAgICAgZGF0ZTogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLkRhdGUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAvLyAgICAgdXNlcmVtYWlsIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgLy8gICAgIHVzZXJwaG9uZW51bWJlciA6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uUGhvbmVOdW1iZXIsCiAgICAgICAgICAgIC8vICAgICB1c2VybmFtZSA6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuTk9fREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgIF90aGlzMy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgX3RoaXMzLnNldHBhZ2luYXRpb24oX3RoaXMzLnBhZ2Vfbm8pOyAvLyBjb25zb2xlLmxvZyh0aGlzLnVzZXJfYWN0aW9uX3N0YXRzKTsKCiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZTogZnVuY3Rpb24gcGFnZV9yZXF1aXJlKHBhZ2Vfbm8pIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWxlY3RlZCAhPSAiZ2VuZXJhbF9jaGF0X2hpc3RvcnkiKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy50b3RhbF9wYWdlcywgcGFnZV9ubyk7CiAgICAgICAgaWYgKHBhZ2Vfbm8gPT0gMCB8fCBwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7fSBlbHNlIHsKICAgICAgICAgIC8vIHRoaXMucGFnZV9ubyA9IHBhZ2Vfbm87CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmFjdGlvbl91c2FnZV9zdGF0c191cmwoKSwgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgLy8gYWN0aW9uOiB0aGlzLmFjdGlvbl9zdGF0c1tpbmRleF0uTmFtZSwKICAgICAgICAgICAgYWN0aW9uOiB0aGlzLnNlbGVjdGVkLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgey8vIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIC8vIHRoaXMudXNlcl9saXN0ID0gW107CiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YVswXSkgewogICAgICAgICAgICAvLyAgIHRoaXMuaW50ZW50bGlzdC5wdXNoKHsKICAgICAgICAgICAgLy8gICAgIGludGVudDogcmVzcG9uc2UuZGF0YVswXVtpXSwKICAgICAgICAgICAgLy8gICAgIGVtYWlsOiByZXNwb25zZS5kYXRhWzFdW2ldLAogICAgICAgICAgICAvLyAgICAgY3JlYXRlZDogcmVzcG9uc2UuZGF0YVsyXVtpXQogICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocGFnZV9ubyA9PSAwIHx8IHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgICAgaWYgKHBhZ2Vfbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZV9ubzsKICAgICAgICAgIH0gLy8gdGhpcy5wYWdlX25vID0gcGFnZV9ubzsKCgogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZ2VuZXJhbF9jaGF0X2hpc3RvcnkoKSwgX2RlZmluZVByb3BlcnR5KHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzc2hvdzogdHJ1ZSwKICAgICAgICAgICAgaXNfcG9ydGFsX3VzZXI6IHRydWUsCiAgICAgICAgICAgIGFjdGlvbjogdGhpcy5zZWxlY3RlZCwKICAgICAgICAgICAgZmlsdGVyX2NoYXRfaGlzdG9yeTogdGhpcy4kc2Vzc2lvbi5nZXQoImZpbHRlcl9jaGF0X2hpc3RvcnkiKSwKICAgICAgICAgICAgcGFnZW5vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcnBhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoCiAgICAgICAgICB9LCAiaXNfcG9ydGFsX3VzZXIiLCB0cnVlKSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczQudXNlcl9hY3Rpb25fc3RhdHMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzNC5maW5nZXJwcmludHJlZ2V4LnRlc3QocmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyKSkgewogICAgICAgICAgICAgICAgX3RoaXM0LnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgICB1c2VyZW1haWw6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5FbWFpbCwKICAgICAgICAgICAgICAgICAgdXNlcnBob25lbnVtYmVyOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uUGhvbmVOdW1iZXIsCiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICAgIHVzZXJpZDogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAgICAgICBkYXRlOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uRGF0ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzNC51c2VyX2FjdGlvbl9zdGF0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgdXNlcmVtYWlsOiByZXNwb25zZS5kYXRhLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIsCiAgICAgICAgICAgICAgICAgIHVzZXJwaG9uZW51bWJlcjogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLlBob25lTnVtYmVyLAogICAgICAgICAgICAgICAgICB1c2VybmFtZTogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLlVzZXJOYW1lLAogICAgICAgICAgICAgICAgICB1c2VyaWQ6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAgICAgZGF0ZTogcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5W2ldLkRhdGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gLy8gdGhpcy51c2VyX2FjdGlvbl9zdGF0cy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgdXNlcmVtYWlsIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAvLyAgICAgdXNlcnBob25lbnVtYmVyIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgICAgICAgICAgICAvLyAgICAgdXNlcm5hbWUgOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLlVzZXJOYW1lLAogICAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXM0LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICBfdGhpczQuc2V0cGFnaW5hdGlvbihfdGhpczQucGFnZV9ubyk7CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3M6IGZ1bmN0aW9uIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgc2V0cGFnaW5hdGlvbjogZnVuY3Rpb24gc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7CiAgICAgIHRoaXMucGFnZV9hcnJheSA9IFtdOwoKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCA0OyBfaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaSArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTIgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2kyIDwgdGhpcy50b3RhbF9wYWdlczsgX2kyKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMiArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBwYWdlX25vICsgMzsgX2kzKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMyArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k0ID0gcGFnZV9ubyAtIDQ7IF9pNCA8IHRoaXMudG90YWxfcGFnZXM7IF9pNCsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTQgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k1ID0gcGFnZV9ubyAtIDM7IF9pNSA8PSBwYWdlX25vICsgMzsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgLy8gdmlld19hY3Rpb24oKSB7CiAgICAvLyAgIHZhciBhY3Rpb25fbmFtZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIC8vICAgdGhpcy5zZWxlY3RlZCA9IGFjdGlvbl9uYW1lOwogICAgLy8gICB0aGlzLnNlYXJjaHN0cmluZyA9ICIiOwogICAgLy8gICBpZiAoYWN0aW9uX25hbWUgIT0gImdlbmVyYWxfY2hhdF9oaXN0b3J5IikgewogICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIC8vICAgICBheGlvcwogICAgLy8gICAgICAgLnBvc3QoCiAgICAvLyAgICAgICAgIGFwaV9jYWxscy5hY3Rpb25fdXNhZ2Vfc3RhdHNfdXJsKCksCiAgICAvLyAgICAgICAgIHsKICAgIC8vICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgICBhY3Rpb246IGFjdGlvbl9uYW1lLAogICAgLy8gICAgICAgICAgIHBhZ2Vfbm86IDEsCiAgICAvLyAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAvLyAgICAgICAgIH0sCiAgICAvLyAgICAgICAgIHsKICAgIC8vICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgICAgICB9LAogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICApCiAgICAvLyAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEubnVtYmVyX29mX3Jvd3M7CiAgICAvLyAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgLy8gICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzID0gW107CiAgICAvLyAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS51c2VycykgewogICAgLy8gICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnVzZXJzW2ldLmFjdGlvbl9oaXRzICE9IDApIHsKICAgIC8vICAgICAgICAgICAgIGxldCBhY3Rpb25faGlzdG9yeSA9IFtdOwogICAgLy8gICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLnVzZXJzW2ldLmFjdGlvbl9oaXRzKSB7CiAgICAvLyAgICAgICAgICAgICAgIGFjdGlvbl9oaXN0b3J5LnB1c2gocmVzcG9uc2UuZGF0YS51c2Vyc1tpXS5hY3Rpb25faGl0c1tqXSk7CiAgICAvLyAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgLy8gICAgICAgICAgICAgICB1c2VybmFtZTogcmVzcG9uc2UuZGF0YS51c2Vyc1tpXS51c2VybmFtZSwKICAgIC8vICAgICAgICAgICAgICAgYWN0aW9uX2xpc3Q6IGFjdGlvbl9oaXN0b3J5LAogICAgLy8gICAgICAgICAgICAgICBzZW5kZXJfaWQ6IHJlc3BvbnNlLmRhdGEudXNlcnNbaV0uc2VuZGVyX2lkLAogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9KQogICAgLy8gICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICAgIGlmICgKICAgIC8vICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICAgICAgKSB7CiAgICAvLyAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgfSk7CiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgLy8gICAgIGF4aW9zCiAgICAvLyAgICAgICAucG9zdCgKICAgIC8vICAgICAgICAgYXBpX2NhbGxzLmdlbmVyYWxfY2hhdF9oaXN0b3J5KCksCiAgICAvLyAgICAgICAgIHsKICAgIC8vICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgICBpc3Nob3c6IHRydWUsCiAgICAvLyAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25fbmFtZSwKICAgIC8vICAgICAgICAgICBwYWdlbm86IHRoaXMucGFnZV9ubywKICAgIC8vICAgICAgICAgICBwZXJwYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgLy8gICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgLy8gICAgICAgICB9LAogICAgLy8gICAgICAgICB7CiAgICAvLyAgICAgICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgKQogICAgLy8gICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAgIHRoaXMudXNlcl9hY3Rpb25fc3RhdHMgPSBbXTsKICAgIC8vICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5Lmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cy5wdXNoKHsKICAgIC8vICAgICAgICAgICAgIHVzZXJlbWFpbDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgIC8vICAgICAgICAgICAgIHVzZXJwaG9uZW51bWJlcjogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgIC8vICAgICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLlVzZXJOYW1lLAogICAgLy8gICAgICAgICAgIH0pOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9KQogICAgLy8gICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICAgIGlmICgKICAgIC8vICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICAgICAgKSB7CiAgICAvLyAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgfSk7CiAgICAvLyAgIH0KICAgIC8vIH0sCiAgICBzY3JvbGxfZGl2OiBmdW5jdGlvbiBzY3JvbGxfZGl2KCkgewogICAgICB2YXIgZG9jID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmJ1eS1wcm9kdWN0cyIpOwoKICAgICAgaWYgKGV2ZW50LmRlbHRhWCA+IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0ICs9IDEwOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmRlbHRhWCA8IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0IC09IDEwOwogICAgICB9CiAgICB9LAogICAgc2Nyb2xsX2NhcmRfZGl2OiBmdW5jdGlvbiBzY3JvbGxfY2FyZF9kaXYoKSB7CiAgICAgIHZhciBkb2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWFpbi1jYXJkLWNvbnRhaW5lciIpOwoKICAgICAgaWYgKGV2ZW50LmRlbHRhWCA+IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0ICs9IDEwOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmRlbHRhWCA8IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0IC09IDEwOwogICAgICB9CiAgICB9LAogICAgY2hlY2tpbnRlbnQ6IGZ1bmN0aW9uIGNoZWNraW50ZW50KGluZGV4KSB7CiAgICAgIGlmICh0aGlzLmNoYXREZXRhaWxzW2luZGV4IC0gMV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKHRoaXMuY2hhdERldGFpbHNbaW5kZXggLSAxXS5CT1RSZXNwb25zZVswXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmICh0aGlzLmNoYXREZXRhaWxzW2luZGV4IC0gMV0uQk9UUmVzcG9uc2VbMF0uaW50ZW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBjaGF0X2RhdGU6IGZ1bmN0aW9uIGNoYXRfZGF0ZShpbmRleCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHRoaXMuY2hhdERldGFpbHMgPSBbXTsKICAgICAgdGhpcy5zZW5kZXJfaWQgPSB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS51c2VyaWQ7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZ2VuZXJhbF9jaGF0X2hpc3RvcnkoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgdXNlcm5hbWU6IHRoaXMuc2VuZGVyX2lkLAogICAgICAgIGlzc2hvd2RhdGVzOiB0cnVlLAogICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgIGlzX3BvcnRhbF91c2VyOiB0cnVlLAogICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hzdHJpbmcKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczUuY2hhdF9kYXRlcyA9IHJlc3BvbnNlLmRhdGEuZGF0YS5EYXRlczsKICAgICAgICAgIF90aGlzNS5zZWxlY3RlZF9kYXRlID0gcmVzcG9uc2UuZGF0YS5kYXRhLkRhdGVzW3Jlc3BvbnNlLmRhdGEuZGF0YS5EYXRlcy5sZW5ndGggLSAxXTsKCiAgICAgICAgICBfdGhpczUuY2hhdF9kYXRlcy5yZXZlcnNlKCk7IC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRfaW5kZXgpOwoKCiAgICAgICAgICBfdGhpczUuc2VsZWN0ZWRfaW5kZXggPSBpbmRleDsKCiAgICAgICAgICBfdGhpczUuY2hhdF9jb252ZXJzYXRpb24oaW5kZXgpOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2hhdF9jb252ZXJzYXRpb246IGZ1bmN0aW9uIGNoYXRfY29udmVyc2F0aW9uKGluZGV4LCBjaGF0X2luZGV4KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2coaW5kZXgsIGNoYXRfaW5kZXgpOwogICAgICBpZiAodGhpcy5zZWxlY3RlZCAhPSAiZ2VuZXJhbF9jaGF0X2hpc3RvcnkiKSB7CiAgICAgICAgdGhpcy5zZW5kZXJfaWQgPSB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS51c2VyaWQ7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNvbnZlcnNhdGlvbl9zdGF0c191cmwoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc2VuZGVyX2lkOiB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS5zZW5kZXJfaWQsCiAgICAgICAgICBhY3Rpb25fdGltZXN0YW1wOiB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS5hY3Rpb25fbGlzdFtjaGF0X2luZGV4XS50aW1lc3RhbXAKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIF90aGlzNi51c2VyX3JlcGx5ID0gW107CiAgICAgICAgICBfdGhpczYuYm90X3JlcGx5ID0gW107CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICBfdGhpczYuY3VycmVudF91c2VyID0gcmVzcG9uc2UuZGF0YS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy51c2VybmFtZTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnMpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnNbaV0udXNlciAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIF90aGlzNi51c2VyX3JlcGx5LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnNbaV0udXNlcik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnNbaV0uYm90ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgX3RoaXM2LmJvdF9yZXBseS5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS51c2VyX2NvbnZlcnNhdGlvbnMuaW50ZXJhY3Rpb25zW2ldLmJvdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkKCIjY29udmVyc2F0aW9uX21vZGVsMSA6aW5wdXQiKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNi50bHQoInBvcnRhbF91c2VyX25vX2NoYXRzX21zZyIpKTsKICAgICAgICAgICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfQoKICAgICAgICAgICQoIiNjb252ZXJzYXRpb25fbW9kZWwxIDppbnB1dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jaGF0RGV0YWlscyA9IFtdOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5nZW5lcmFsX2NoYXRfaGlzdG9yeSgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICB1c2VybmFtZTogdGhpcy5zZW5kZXJfaWQsCiAgICAgICAgICBpc3Nob3djaGF0ZGV0YWlsczogdHJ1ZSwKICAgICAgICAgIGRhdGU6IHRoaXMuc2VsZWN0ZWRfZGF0ZSwKICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgICAgaXNfcG9ydGFsX3VzZXI6IHRydWUsCiAgICAgICAgICBzZWFyY2hzdHJpbmc6IHRoaXMuc2VhcmNoc3RyaW5nCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdGVkX2luZGV4LCB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzKTsKICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIF90aGlzNi51c2VyX3JlcGx5ID0gW107CiAgICAgICAgICBfdGhpczYuYm90X3JlcGx5ID0gW107CgogICAgICAgICAgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNi5jdXJyZW50X3VzZXIgPSBfdGhpczYudXNlcl9hY3Rpb25fc3RhdHNbX3RoaXM2LnNlbGVjdGVkX2luZGV4XS51c2VyZW1haWw7CiAgICAgICAgICAgIF90aGlzNi5jaGF0RGV0YWlscyA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0RGV0YWlsczsKICAgICAgICAgICAgdmFyIG9mZmVyc19pbmRleCA9IG51bGw7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzNi5jaGF0RGV0YWlscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgX3RoaXM2LmNoYXREZXRhaWxzW2ldLkJPVFJlc3BvbnNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM2LmNoYXREZXRhaWxzW2ldLkJPVFJlc3BvbnNlW2pdLnNob3BpZnlfZmV0Y2hfY3VzdG9tZXJfaWQgPT0gdHJ1ZSAmJiBfdGhpczYuY2hhdERldGFpbHNbaV0uQk9UUmVzcG9uc2Vbal0udGV4dCA9PSBudWxsICYmIF90aGlzNi5jaGF0RGV0YWlsc1tpXS5Vc2VyUXVlcnkgPT09ICJQcm9tb3Rpb25hbCBvZmZlcnMiKSB7CiAgICAgICAgICAgICAgICAgIG9mZmVyc19pbmRleCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAob2ZmZXJzX2luZGV4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBfdGhpczYuY2hhdERldGFpbHNbb2ZmZXJzX2luZGV4XTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9mZmVyc19pbmRleCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBuZXdfYXJyID0gX3RoaXM2LmNoYXREZXRhaWxzLmZpbHRlcihmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNi5jaGF0RGV0YWlscyA9IG5ld19hcnI7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuTk9fREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIC8vICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEgOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgIC8vICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEgOmJ1dHRvbiIpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgLy8gfSwgNTAwKTsKCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwcm9kdWN0X3ZhcmlhdGlvbjogZnVuY3Rpb24gcHJvZHVjdF92YXJpYXRpb24ocHJvZHVjdHNfbGlzdCkgewogICAgICBmb3IgKHZhciBpIGluIHByb2R1Y3RzX2xpc3QpIHsKICAgICAgICBwcm9kdWN0c19saXN0W2ldLm9yZGVyX3F0eSA9IDE7CiAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5idXlfcXR5ID0gMTsKCiAgICAgICAgaWYgKHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9ucyAmJiBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5pZCA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5pZDsKICAgICAgICAgIHByb2R1Y3RzX2xpc3RbaV0uaW1nX3VybCA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5pbWdfdXJsID09PSBudWxsID8gcHJvZHVjdHNfbGlzdFtpXS5pbWdfdXJsIDogcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLmltZ191cmwgfHwgcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLmltYWdlOwogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5wZXJtYWxpbmsgPSBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnNbMF0ucGVybWFsaW5rOwogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS52YXJpYW50X3RpdGxlID0gcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLnZhcmlhbnRfdGl0bGU7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLnN0b2NrX3F1YW50aXR5ID0gcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLnN0b2NrX3F1YW50aXR5OwogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5zdG9ja19zdGF0dXMgPSBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnNbMF0uc3RvY2tfc3RhdHVzOwogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5wcmljZSA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5wcmljZTsKICAgICAgICAgIHByb2R1Y3RzX2xpc3RbaV0ucmVndWxhcl9wcmljZSA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5yZWd1bGFyX3ByaWNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHByb2R1Y3RzX2xpc3Q7CiAgICB9LAogICAgc2VhcmNoX2NoYXQ6IGZ1bmN0aW9uIHNlYXJjaF9jaGF0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaHN0cmluZyAhPSAiIikgewogICAgICAgIHZhciBfYXhpb3MkcG9zdDI7CgogICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICAgIHRoaXMuaXNzZWFyY2ggPSB0cnVlLCB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZ2VuZXJhbF9jaGF0X2hpc3RvcnkoKSwgKF9heGlvcyRwb3N0MiA9IHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGlzc2hvdzogdHJ1ZSwKICAgICAgICAgIGlzX3BvcnRhbF91c2VyOiB0cnVlLAogICAgICAgICAgYWN0aW9uOiAiZ2VuZXJhbF9jaGF0X2hpc3RvcnkiLAogICAgICAgICAgcGFnZW5vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICBwZXJwYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgaXNzZWFyY2g6IHRoaXMuaXNzZWFyY2gKICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAiaXNfcG9ydGFsX3VzZXIiLCB0cnVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInNlYXJjaHN0cmluZyIsIHRoaXMuc2VhcmNoc3RyaW5nKSwgX2F4aW9zJHBvc3QyKSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBfdGhpczcudXNlcl9hY3Rpb25fc3RhdHMgPSBbXTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIFJlc3VsdHMgRm91bmQiICYmIHJlc3BvbnNlLmRhdGEuTVNHICE9ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRIaXN0b3J5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgX3RoaXM3LnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0SGlzdG9yeVtpXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczcudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgIF90aGlzNy5zZXRwYWdpbmF0aW9uKF90aGlzNy5wYWdlX25vKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJlc3VsdHMgRm91bmQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczcudGx0KCJwb3J0YWxfdXNlcl9ub19yZXN1bHRfZm91bmRfbXNnIikpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM3LnRsdCgicG9ydGFsX3VzZXJfaW50ZXJuYWxfc2VydmVyX21zZzEiKSk7CgogICAgICAgICAgICBfdGhpczcubG9hZF9wb3J0YWxfdXNlcl9jaGF0X2hpc3RvcnkoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczcudGx0KCJwb3J0YWxfdXNlcl9pbnRlcm5hbF9zZXJ2ZXJfbXNnMiIpKTsKCiAgICAgICAgICAgIF90aGlzNy5sb2FkX3BvcnRhbF91c2VyX2NoYXRfaGlzdG9yeSgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgicG9ydGFsX3VzZXJfZGF0YV9mb3Jfc2VhcmNoX21zZyIpKTsKICAgICAgfQogICAgfSwKICAgIGNsb3NlX21vZGFsOiBmdW5jdGlvbiBjbG9zZV9tb2RhbCgpIHsKICAgICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEiKS5tb2RhbCgiaGlkZSIpOwogICAgfSwKICAgIGNoZWNrX2JvdF9vZmZlcnM6IGZ1bmN0aW9uIGNoZWNrX2JvdF9vZmZlcnMoYm90X3JlcG9uc2UpIHsKICAgICAgdmFyIHJlc3VsdF9ib3QgPSBib3RfcmVwb25zZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gQm9vbGVhbihpdGVtLm9mZmVycykgPT09IHRydWU7CiAgICAgIH0pOwoKICAgICAgaWYgKHJlc3VsdF9ib3QubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiAiZGlzcGxheSA6YmxvY2siOwogICAgICB9CgogICAgICByZXR1cm4gImRpc3BsYXkgOiBmbGV4IjsKICAgIH0sCiAgICB0cmltX2NhcmRfZGVzY3JpcHRpb246IGZ1bmN0aW9uIHRyaW1fY2FyZF9kZXNjcmlwdGlvbih0ZXh0KSB7CiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDEwMCkgewogICAgICAgIHZhciBzdHJpbmdfdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIDgwKSArICIuLi4iOwogICAgICAgIHJldHVybiBzdHJpbmdfdGV4dDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRleHQ7CiAgICB9CiAgfQp9Ow=="},null]}