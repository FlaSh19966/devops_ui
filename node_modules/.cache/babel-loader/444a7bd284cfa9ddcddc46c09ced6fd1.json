{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue","mtime":1645594423479},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgY291bnRyaWVzIGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvQ291bnRyaWVzIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IHsgYnVzIH0gZnJvbSAiQC9wb3J0YWwvbWFpbiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IEFyZWFDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0FyZWFDaGFydC52dWUiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsgLy8gaW1wb3J0IHsgU3RyaXBlQ2hlY2tvdXQgfSBmcm9tICJAdnVlLXN0cmlwZS92dWUtc3RyaXBlIjsKCmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IHsgdXBkYXRlX3NpZGViYXJfbWVudSwgdXBkYXRlX3Jlc3RyaWN0aW9uX2xpc3QgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJpbGxpbmciLAogIGNvbXBvbmVudHM6IHsKICAgIEFyZWFDaGFydDogQXJlYUNoYXJ0LAogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0IC8vIFN0cmlwZUNoZWNrb3V0LAoKICB9LAogIG1peGluczogW3VwZGF0ZV9zaWRlYmFyX21lbnUsIHVwZGF0ZV9yZXN0cmljdGlvbl9saXN0XSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcmF6b3JwYXlfc3Vic2NyaXB0aW9uX3BsYW5zOiBbXSwKICAgICAgc2VsZWN0X3N1YnNjcmlwdGlvbl9wbGFuOiBbIlNpbHZlciIsICJHb2xkIiwgIlBsYW50aW51bSIsICJFbnRlcnByaXNlIl0sCiAgICAgIHNlbGVjdGVkX3N1YnNjcmlwdGlvbjogIiIsCiAgICAgIHN1YnNjcmlwdGlvbl9pZDogIiIsCiAgICAgIHBsYW5faWQ6ICIiLAogICAgICBjdXN0b21lcl9pZDogIiIsCiAgICAgIHBsYW5fcGVyaW9kOiBbIk1vbnRobHkiLCAiWWVhcmx5Il0sCiAgICAgIHNlbGVjdGVkX3BlcmlvZDogIiIsCiAgICAgIG9yZGVyX2lkOiAiIiwKICAgICAgYW1vdW50OiAiIiwKICAgICAgcGF5X3N1Y2Nlc3NfZGF0YToge30sCiAgICAgIHN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZTogZmFsc2UsCiAgICAgIGNvdW50cnlfbGlzdDogY291bnRyaWVzLAogICAgICBwYXltZW50aWQ6ICIiLAogICAgICBiYXJDaGFydDogIiIsCiAgICAgIGJhY2tncm91bmRDb2xvcjogWyIjZTY3ZTIyIiwgIiMxNmEwODUiLCAiIzI5ODBiOSJdLAogICAgICBsYWJlbHM6IFsiRXhjaGFuZ2Ugb2YgTWVzc2FnZXMiLCAiRXhlY3V0aW9uIG9mIFRhc2tzIiwgIkF1ZGlvL1ZpZGVvIEludGVyYWN0aW9uIiwgIlN0b3JhZ2UiXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY291bnRyeV9uYW1lOiAiIiwKICAgICAgcGF5bWVudF9jdXJyZW5jeTogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3RvcF91cDogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjogIiIsCiAgICAgIElOUjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDogWzUwLCAxMDAsIDIwMCwgNTAwXSwKICAgICAgY29tbW9uX2N1cnJlbmN5OiBbXSwKICAgICAgY3VycmVuY3lfYW1vdW50OiBudWxsLAogICAgICB0b3BfdXBfYW1vdW50OiBudWxsLAogICAgICBwaWVjaGFydF9kYXRhOiBbXSwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgY29uY3VycmVudF91c2Vyc19tb250aDogIiIsCiAgICAgIENvbmN1cnJlbnRfVXNlcnNfRGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgZGF0YTogW10KICAgICAgfSwKICAgICAgbW9udGhzOiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1ZyIsICJTZXB0IiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sCiAgICAgIGludm9pY2VfZGV0YWlsczogW10sCiAgICAgIGludm9pY2VfZGV0YWlsc19jb3B5OiBbXSwKICAgICAgdG90YWxfeWVhcjogW10sCiAgICAgIHllYXJfc2VsZWN0ZWQ6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICAvL2hhcnNoCiAgICAgIGNvbW1vbl9jdXJyZW5jeTI6IFtdLAogICAgICBJTlIyOiBbMzUwMCwgNzAwMCwgMTQwMDAsIDM1MDAwXSwKICAgICAgVVNEMjogWzEwMCwgMzAwLCA1MDBdLAogICAgICByZXRhaWxfc2hvcGlmeV9jb21wYW55OiBmYWxzZSwKICAgICAgcmV0YWlsX3Nob3BpZnlfc3Vic2NyaXB0aW9uX3BsYW5zOiBbLy8gewogICAgICAvLyAgIG5hbWU6ICJGcmVlIiwKICAgICAgLy8gICBpc19jaGFyZ2VhYmxlOiBmYWxzZSwKICAgICAgLy8gfSwKICAgICAgewogICAgICAgIG5hbWU6ICJTdGFydGVyIiwKICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgIG1vbnRobHlfY2hhcmdlOiAyOSwKICAgICAgICBhbm51YWxfY2hhcmdlOiB7CiAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiAyNC4xNywKICAgICAgICAgIGFjdHVhbF9jaGFyZ2U6IDI5MAogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIG5hbWU6ICJQcmVtaXVtIiwKICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgIG1vbnRobHlfY2hhcmdlOiA5OSwKICAgICAgICBhbm51YWxfY2hhcmdlOiB7CiAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiA4Mi41LAogICAgICAgICAgYWN0dWFsX2NoYXJnZTogOTkwCiAgICAgICAgfQogICAgICB9XSwKICAgICAgcmV0YWlsX25vbl9zaG9waWZ5X3N1YnNjcmlwdGlvbl9wbGFuczogWy8vIHsKICAgICAgLy8gICBuYW1lOiAiRnJlZSIsCiAgICAgIC8vICAgaXNfY2hhcmdlYWJsZTogZmFsc2UsCiAgICAgIC8vIH0sCiAgICAgIHsKICAgICAgICBuYW1lOiAiU3RhcnRlciIsCiAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICBtb250aGx5X2NoYXJnZTogMjkKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJQcmVtaXVtIiwKICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgIG1vbnRobHlfY2hhcmdlOiA5OQogICAgICB9XSwKICAgICAgcmV0YWlsX3BsYW5fY3VycmVudDogbnVsbCwKICAgICAgcGF5bWVudF90eXBlczogWyJBbm51YWwiLCAiTW9udGhseSJdLAogICAgICByZXRhaWxfcGF5bWVudF90eXBlOiBudWxsLAogICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zOiBudWxsLAogICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHM6IHt9LAogICAgICBzdHJpcGVfYWRkb25fcGxhbnM6IFtdLAogICAgICBzaG93X3N1YnNjcmlwdGlvbjogZmFsc2UsCiAgICAgIHNlbGVjdGVkX2FkZG9uX3BsYW46IG51bGwsCiAgICAgIGhpZGVfYnV0dG9uOiAnRnJlZScsCiAgICAgIGNyZWRpdHNfYmFsYW5jZTogbnVsbAogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuY291bnRyeV9saXN0ID0gY291bnRyaWVzOwoKICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpICYmIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIGNvbXBhbnkgbmFtZSBmcm9tIHRoZSBkcm9wZG93biIpOwogICAgfQoKICAgIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZSA9PSAiIiAmJiAhdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpKSB7fSBlbHNlIHsKICAgICAgLy8gICBheGlvcwogICAgICAvLyAgICAgLnBvc3QoCiAgICAgIC8vICAgICAgIGFwaV9jYWxscy5waWVjaGFydF91cmwoKSwKICAgICAgLy8gICAgICAgewogICAgICAvLyAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAvLyAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgIC8vICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgLy8gICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgLy8gICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAvLyAgICAgICB9LAogICAgICAvLyAgICAgICB7CiAgICAgIC8vICAgICAgICAgaGVhZGVyczogewogICAgICAvLyAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgIC8vICAgICAgICAgfSwKICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgKQogICAgICAvLyAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgIC8vICAgICAgIHRoaXMucGllY2hhcnRfZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuVGFza1VzYWdlKSwKICAgICAgLy8gICAgICAgICB0aGlzLnBpZWNoYXJ0X2RhdGEucHVzaChyZXNwb25zZS5kYXRhLkV4Y2hhbmdlT2ZNc2cpLAogICAgICAvLyAgICAgICAgIHRoaXMucGllY2hhcnRfZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuQ2FsbFVzYWdlKTsKICAgICAgLy8gICAgICAgdGhpcy5waWVjaGFydF9kYXRhLnB1c2gocmVzcG9uc2UuZGF0YS5TdG9yYWdlX2Nvc3QpOwogICAgICAvLyAgICAgICBpZiAoCiAgICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5UYXNrVXNhZ2UgPiAwIHx8CiAgICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5FeGNoYW5nZU9mTXNnID4gMCB8fAogICAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuQ2FsbFVzYWdlID4gMCB8fAogICAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuU3RvcmFnZV9jb3N0ID4gMAogICAgICAvLyAgICAgICApIHsKICAgICAgLy8gICAgICAgICB0aGlzLmJhckNoYXJ0Lm9wdGlvbnMubGVnZW5kLmRpc3BsYXkgPSB0cnVlOwogICAgICAvLyAgICAgICB9CiAgICAgIC8vICAgICAgIHRoaXMuYmFyQ2hhcnQudXBkYXRlKCk7CiAgICAgIC8vICAgICB9KQogICAgICAvLyAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgIC8vICAgICAgIGlmICgKICAgICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgLy8gICAgICAgKSB7CiAgICAgIC8vICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgLy8gICAgICAgfQogICAgICAvLyAgICAgfSk7CiAgICAgIC8vICAgYXhpb3MKICAgICAgLy8gICAgIC5wb3N0KAogICAgICAvLyAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19jaGFyZ2VfdXJsKCksCiAgICAgIC8vICAgICAgIHsKICAgICAgLy8gICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgLy8gICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAvLyAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgIC8vICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgIC8vICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgLy8gICAgICAgfSwKICAgICAgLy8gICAgICAgewogICAgICAvLyAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgLy8gICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAvLyAgICAgICAgIH0sCiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgICkKICAgICAgLy8gICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAvLyAgICAgICB0aGlzLnBheW1lbnRfY3VycmVuY3kgPSByZXNwb25zZS5kYXRhLmN1cnJlbmN5X3R5cGU7CiAgICAgIC8vICAgICAgIHRoaXMudG9nZ2xlX2NoYW5nZSh0aGlzLnBheW1lbnRfY3VycmVuY3kpOwogICAgICAvLyAgICAgICB0aGlzLmNvbmN1cnJlbnRfdXNlcnNfbW9udGggPSByZXNwb25zZS5kYXRhLk1vbnRoOwogICAgICAvLyAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgIC8vICAgICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTsKICAgICAgLy8gICAgICAgdmFyIG1vbnRoID0gZGF0ZS5nZXRNb250aCgpOwogICAgICAvLyAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuRGF0YSkgewogICAgICAvLyAgICAgICAgIHZhciByZXNwb25zZV9kYXRlID0gaS5zcGxpdCgiLSIpOwogICAgICAvLyAgICAgICAgIGlmICgKICAgICAgLy8gICAgICAgICAgIE51bWJlcihyZXNwb25zZV9kYXRlWzBdKSA+IGRheSAmJgogICAgICAvLyAgICAgICAgICAgcmVzcG9uc2VfZGF0ZVsxXSA9PSB0aGlzLm1vbnRoc1ttb250aF0KICAgICAgLy8gICAgICAgICApIHsKICAgICAgLy8gICAgICAgICB9IGVsc2UgewogICAgICAvLyAgICAgICAgICAgdGhpcy5Db25jdXJyZW50X1VzZXJzX0RhdGEubGFiZWxzLnB1c2goaSk7CiAgICAgIC8vICAgICAgICAgICB0aGlzLkNvbmN1cnJlbnRfVXNlcnNfRGF0YS5kYXRhLnB1c2gocmVzcG9uc2UuZGF0YS5EYXRhW2ldKTsKICAgICAgLy8gICAgICAgICB9CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgICAgYnVzLiRlbWl0KCJCaWxsaW5nIGNoYXJ0IHVwZGF0ZWQiLCAiVHJ1ZSIpOwogICAgICAvLyAgICAgfSkKICAgICAgLy8gICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAvLyAgICAgICBpZiAoCiAgICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgIC8vICAgICAgICkgewogICAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgIH0pOwogICAgICBheGlvcy5nZXQoYXBpX2NhbGxzLmJpbGxpbmdfaW52b2ljZSgpLCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMudG90YWxfeWVhciA9IHJlc3BvbnNlLmRhdGEuWWVhckxpc3Q7CiAgICAgICAgX3RoaXMueWVhcl9zZWxlY3RlZCA9IF90aGlzLnRvdGFsX3llYXJbMF07CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5iaWxsaW5nX2ludm9pY2UoKSwgewogICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGRvd25sb2FkX2ZpbGU6IGZhbHNlLAogICAgICAgIHllYXI6IHRoaXMueWVhcl9zZWxlY3RlZAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMuaW52b2ljZV9kZXRhaWxzID0gcmVzcG9uc2UuZGF0YS5CdWNrZXRfbGlzdDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpcy5pbnZvaWNlX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIF90aGlzLmludm9pY2VfZGV0YWlsc19jb3B5W2ldID0gX3RoaXMuaW52b2ljZV9kZXRhaWxzW2ldLnNsaWNlKDgpOwogICAgICAgIH0gLy8gY29uc29sZS5sb2codGhpcy5pbnZvaWNlX2RldGFpbHNfY29weSk7CgogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgaXNfc2hvcGlmeSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpOwoKICAgIGlmIChCb29sZWFuKGlzX3Nob3BpZnkpICYmIGlzX3Nob3BpZnkgPT09ICJzaG9waWZ5IikgewogICAgICB0aGlzLnJldGFpbF9zaG9waWZ5X2NvbXBhbnkgPSB0cnVlOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIHRoaXMuZ2V0X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCk7IC8vIEdldCBwbGFucyBmcm9tIHJhem9ycGF5IGRhc2hib2FyZAoKICAgIHRoaXMuZ2V0X2FkZG9uX2RldGFpbHMoKTsgLy8gR2V0IEFkZCBPbnMgZnJvbSBjZW5zZSBkYgoKICAgIHRoaXMuZ2V0X2N1cnJlbnRfc3Vic2NyaXB0aW9uKCk7IC8vIEdldCBjdXJyZW50IHBsYW4gZGV0YWlscyBmcm9tIGNlbnNlX2RiCgogICAgdGhpcy5nZXRfY3VycmVudF9zdWJzY3JpcHRpb25fZGV0YWlscygpOyAvLyBnZXQgc3Vic2NyaXB0aW9uIGRldGFpbHMgZnJvbSBjZW5zZV9kYgoKICAgIHRoaXMuY2hlY2tfYWRkb25zX2JhbGFuY2UoKTsKCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZSA9PSAiIiAmJiAhdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpKSB7CiAgICAgICQoIiNjb3VudHJ5bW9kYWwiKS5tb2RhbCh7CiAgICAgICAgYmFja2Ryb3A6ICJzdGF0aWMiCiAgICAgIH0pLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghX3RoaXMyLiRzZXNzaW9uLmhhcygiY291bnRyeV9uYW1lIikpIHsKICAgICAgICAgICQoIiNjb3VudHJ5bW9kYWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgIF90aGlzMi4kcm91dGVyLnB1c2goIi9ib3QvZGFzaGJvYXJkIik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gLy8gdmFyIENIQVJUID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxpbmVDaGFydCIpLmdldENvbnRleHQoIjJkIik7CiAgICAvLyBDaGFydC5kZWZhdWx0cy5zY2FsZS50aWNrcy5iZWdpbkF0WmVybyA9IHRydWU7CiAgICAvLyB0aGlzLmJhckNoYXJ0ID0gbmV3IENoYXJ0KENIQVJULCB7CiAgICAvLyAgIHR5cGU6ICJwaWUiLAogICAgLy8gICBkYXRhOiB7CiAgICAvLyAgICAgbGFiZWxzOiB0aGlzLmxhYmVscywKICAgIC8vICAgICBkYXRhc2V0czogWwogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBsYWJlbDogIlBvaW50cyIsCiAgICAvLyAgICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3IsCiAgICAvLyAgICAgICAgIGRhdGE6IHRoaXMucGllY2hhcnRfZGF0YSwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgXSwKICAgIC8vICAgfSwKICAgIC8vICAgb3B0aW9uczogewogICAgLy8gICAgIHJlc3BvbnNpdmU6IHRydWUsCiAgICAvLyAgICAgbGVnZW5kOiB7CiAgICAvLyAgICAgICBkaXNwbGF5OiBmYWxzZSwKICAgIC8vICAgICAgIHBvc2l0aW9uOiAicmlnaHQiLAogICAgLy8gICAgICAgbGFiZWxzOiB7CiAgICAvLyAgICAgICAgIGJveFdpZHRoOiA2MCwKICAgIC8vICAgICAgICAgZm9udEZhbWlseTogIkZpcmEgU2FucyxzYW5zLXNlcmlmIiwKICAgIC8vICAgICAgICAgZm9udFNpemU6IDE0LAogICAgLy8gICAgICAgICBwYWRkaW5nOiAzMCwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgfSwKICAgIC8vICAgICBwbHVnaW5zOiB7CiAgICAvLyAgICAgICBkaXNwbGF5OiB0cnVlLAogICAgLy8gICAgIH0sCiAgICAvLyAgIH0sCiAgICAvLyB9KTsKCiAgfSwKICBjb21wdXRlZDogewogICAgY2hlY2tfcmV0YWlsX3BheW1lbnRfdHlwZV9kaXNhYmxlZDogZnVuY3Rpb24gY2hlY2tfcmV0YWlsX3BheW1lbnRfdHlwZV9kaXNhYmxlZCgpIHsKICAgICAgaWYgKEJvb2xlYW4odGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50KSAmJiB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHJldGFpbF9wYXltZW50X3BsYWNlaG9sZGVyOiBmdW5jdGlvbiByZXRhaWxfcGF5bWVudF9wbGFjZWhvbGRlcigpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tfcmV0YWlsX3BheW1lbnRfdHlwZV9kaXNhYmxlZCkgewogICAgICAgIHJldHVybiAiTm8gQmlsbGluZyBDeWNsZSBOZWVkZWQgZm9yIEZyZWUgUGxhbiI7CiAgICAgIH0KCiAgICAgIHJldHVybiAiUGljayBPbmUiOwogICAgfSwKICAgIGN1cnJlbnRfcmV0YWlsX3BsYW5fY2hhcmdlczogZnVuY3Rpb24gY3VycmVudF9yZXRhaWxfcGxhbl9jaGFyZ2VzKCkgewogICAgICAvLyBpZih0aGlzLnJldGFpbF9zaG9waWZ5X2NvbXBhbnkpIHsKICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50KSA/IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlID8gIiQiLmNvbmNhdCh0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubW9udGhseV9jaGFyZ2UsICIvbW9udGggIG9yICQiKS5jb25jYXQodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmFubnVhbF9jaGFyZ2UucGVyX21vbnRoX2VmZmVjdGl2ZSwgIi9tb250aCBiaWxsZWQgYXQgJCIpLmNvbmNhdCh0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuYW5udWFsX2NoYXJnZS5hY3R1YWxfY2hhcmdlLCAiIG9uY2UgcGVyIHllYXIiKSA6IG51bGwgOiBudWxsOyAvLyB9IGVsc2UgewogICAgICAvLyAgIHJldHVybiBCb29sZWFuKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCkKICAgICAgLy8gICA/IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlCiAgICAgIC8vICAgICA/IGAkJHt0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubW9udGhseV9jaGFyZ2V9L21vbnRoYAogICAgICAvLyAgICAgOiBudWxsCiAgICAgIC8vICAgOiBudWxsOwogICAgICAvLyB9CiAgICB9LAogICAgY2hlY2tfcmV0YWlsX3Nob3BpZnlfZm9ybV92YWxpZGF0aW9uczogZnVuY3Rpb24gY2hlY2tfcmV0YWlsX3Nob3BpZnlfZm9ybV92YWxpZGF0aW9ucygpIHsKICAgICAgaWYgKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCAhPT0gbnVsbCAmJiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgIT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQgIT09IG51bGwgJiYgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlID09IG51bGwgJiYgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG5hbWVXaXRoTGFuZzogZnVuY3Rpb24gbmFtZVdpdGhMYW5nKF9yZWYpIHsKICAgICAgdmFyIG5hbWUgPSBfcmVmLm5hbWUsCiAgICAgICAgICB0eXBlID0gX3JlZi50eXBlOwogICAgICByZXR1cm4gIiIuY29uY2F0KG5hbWUsICIgXHUyMDE0IFsiKS5jb25jYXQodHlwZSwgIl0iKTsKICAgIH0sCiAgICBzaG93X3N3YWxfbm90aWZpY2F0aW9uOiBmdW5jdGlvbiBzaG93X3N3YWxfbm90aWZpY2F0aW9uKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdBcmUgWW91IFN1cmU/JywKICAgICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gdW5zdWJzY3JpYmUgdGhpcyBwbGFuPyBpdCB3aWxsIHJldmVydCB5b3UgdG8gZnJlZSBwbGFuIiwKICAgICAgICBpY29uOiAnd2FybmluZycsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnWWVzJwogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgIF90aGlzMy51cGRhdGVfc3Vic2NyaXB0aW9uX3BsYW5fZnJlZSgpOwoKICAgICAgICAgIFN3YWwuZmlyZSgnVW5zdWJjcmliZWQhJywgJ1N1YnNjcmlwdGlvbiBDYW5jZWxlZCBTdWNjZXNzZnVsbHknLCAnc3VjY2VzcycpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0X3N1YnNjcmlwdGlvbl92YWxpZF90aWxsOiBmdW5jdGlvbiBnZXRfc3Vic2NyaXB0aW9uX3ZhbGlkX3RpbGwoc3ViX2RhdGUpIHsKICAgICAgcmV0dXJuIG1vbWVudC51dGMoc3ViX2RhdGUpLmZvcm1hdCgiRG8gTU1NTSBZWVlZIik7CiAgICB9LAogICAgdXBkYXRlX3N1YnNjcmlwdGlvbl9wbGFuX2ZyZWU6IGZ1bmN0aW9uIHVwZGF0ZV9zdWJzY3JpcHRpb25fcGxhbl9mcmVlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICB1bnN1YnNjcmliZV9wbGFuOiB0cnVlLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgdmFyIG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLlVzZXJNZW51OwoKICAgICAgICAgIF90aGlzNC51cGRhdGVfc2lkZWJhcl9tZW51KG1lc3NhZ2UpOwoKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2lkZUJhck1lbnVVcGRhdGVkIiwgdHJ1ZSk7IC8vICBjb25zb2xlLmxvZygidXBkYXRlIHN1Y2Nlc3NmdWxseSIpCgoKICAgICAgICAgIF90aGlzNC51cGRhdGVfcmVzdHJpY3Rpb25fbGlzdChyZXNwb25zZS5kYXRhLlJlc3RyaWN0aW9uTGlzdCk7CgogICAgICAgICAgX3RoaXM0LmdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0X2N1cnJlbnRfc3Vic2NyaXB0aW9uX2RldGFpbHM6IGZ1bmN0aW9uIGdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGdldF9hY3RpdmVfcGxhbjogdHJ1ZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBfdGhpczUuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzID0gcmVzcG9uc2UuZGF0YS5EYXRhLmN1cnJlbnRfc3Vic2NyaXB0aW9uOwogICAgICAgICAgX3RoaXM1LmhpZGVfYnV0dG9uID0gcmVzcG9uc2UuZGF0YS5EYXRhLmN1cnJlbnRfc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogICAgICAgICAgX3RoaXM1LnNob3dfc3Vic2NyaXB0aW9uID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM1LnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnNfZGV0YWlscyA9IFtdOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCwgUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRfY3VycmVudF9zdWJzY3JpcHRpb246IGZ1bmN0aW9uIGdldF9jdXJyZW50X3N1YnNjcmlwdGlvbigpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBpc19nZXQ6IHRydWUKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiQ1VSUkVOVCBQTEFOIERFVEFJTFMiLHJlc3BvbnNlKTsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICBfdGhpczYuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gdHJ1ZTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIk5vIEFjdGl2ZSBTdWJzY3JpcHRpb24gcGxhbiBmb3VuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJDdXJyZW50IFN1YnNjcmlwdGlvbiBQbGFuIikgewogICAgICAgICAgX3RoaXM2LnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9IHJlc3BvbnNlLmRhdGEuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogICAgICAgICAgX3RoaXM2LnNlbGVjdGVkX3BlcmlvZCA9IHJlc3BvbnNlLmRhdGEuc3Vic2NyaXB0aW9uLnBlcmlvZDsKICAgICAgICAgIF90aGlzNi5jdXN0b21lcl9pZCA9IHJlc3BvbnNlLmRhdGEuY3VzdG9tZXJfaWQ7CiAgICAgICAgICBfdGhpczYuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gQWN0aXZlIFN1YnNjcmlwdGlvbiBwbGFuIGZvdW5kIikgewogICAgICAgICAgX3RoaXM2LmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5jdXN0b21lcl9pZDsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIk5vIEFjdGl2ZSBTdWJzY3JpcHRpb24gcGxhbiBmb3VuZCIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXM2LnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjaGVja19hZGRvbnNfYmFsYW5jZTogZnVuY3Rpb24gY2hlY2tfYWRkb25zX2JhbGFuY2UoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGVja19hZGRvbnNfYmFsYW5jZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNoZWNrX2JhbGFuY2U6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChCb29sZWFuKHJlc3BvbnNlLmRhdGEuY3JlZGl0cy5zbXNfY291bnQpID09IHRydWUpIHsKICAgICAgICAgIHZhciBzbXNfY291bnQgPSByZXNwb25zZS5kYXRhLmNyZWRpdHMuc21zX2NvdW50OwogICAgICAgICAgX3RoaXM3LmNyZWRpdHNfYmFsYW5jZSA9ICJZb3VyIGN1cnJlbnQgU01TIGNyZWRpdHMgYXJlIDxzdHJvbmc+IGZvciBVUyByZWdpb24gOiIgKyBzbXNfY291bnQudXMgKyAiIHwgZm9yIE5vbi1VUyByZWdpb246ICIgKyBzbXNfY291bnQubm9uX3VzICsgIjwvc3Ryb25nPiI7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXRfYWRkb25fZGV0YWlsczogZnVuY3Rpb24gZ2V0X2FkZG9uX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgZ2V0X2FkZF9vbnM6IHRydWUKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT09ICJObyBhZGQtb25zIGZvdW5kIGluIGRhdGFiYXNlIikgewogICAgICAgICAgX3RoaXM4LnN0cmlwZV9hZGRvbl9wbGFucyA9IFtdOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbihyZXNwb25zZS5kYXRhLkRhdGEpICE9IGZhbHNlKSB7CiAgICAgICAgICB2YXIgdGVtcCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5EYXRhKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OwogICAgICAgICAgICAgICAgb2JqWyduYW1lJ10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uVHlwZTsKICAgICAgICAgICAgICAgIG9ialsnUHJpY2UnXSA9IHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5QcmljZTsKICAgICAgICAgICAgICAgIG9ialsnU2VydmljZSddID0gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLlNlcnZpY2U7CgogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5UeXBlID09ICdTbXNBZGRPbicpIHsKICAgICAgICAgICAgICAgICAgb2JqWyd0eXBlJ10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9uc1tqXS50eXBlOwogICAgICAgICAgICAgICAgICBvYmpbJ3Ntc19jb3VudCddID0gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLk9wdGlvbnNbal0uY291bnQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcC5wdXNoKG9iaik7IC8vIGFkZCBjb25kaXRpb24gZm9yIGVtYWlsIGFkZCBvbiBhbHNvIGxpa2UgYWJvdmUgaW4gZnV0dXJlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM4LnN0cmlwZV9hZGRvbl9wbGFucyA9IHRlbXA7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0X3N1YnNjcmlwdGlvbl9kZXRhaWxzOiBmdW5jdGlvbiBnZXRfc3Vic2NyaXB0aW9uX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGdldF9wbGFuczogdHJ1ZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiICYmIHJlc3BvbnNlLmRhdGEuRGF0YS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIF90aGlzOS5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zID0gcmVzcG9uc2UuZGF0YS5EYXRhLmRhdGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzOS5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zID0gW107CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgY2FuY2VsX3N1YnNjcmlwdGlvbjogZnVuY3Rpb24gY2FuY2VsX3N1YnNjcmlwdGlvbigpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAgICAgICBpc19jYW5jZWw6IHRydWUsCiAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiB0aGlzLnN1YnNjcmlwdGlvbl9pZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiU3Vic2NyaXB0aW9uIGNhbmNlbGxlZCIpIHsKICAgICAgICAgIF90aGlzMTAuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNyZWF0ZV9jdXN0b21lcjogZnVuY3Rpb24gY3JlYXRlX2N1c3RvbWVyKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWxlY3RlZF9zdWJzY3JpcHRpb24gPT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9wZXJpb2QgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgIHRleHQ6ICJTZWxlY3QgU3Vic2NyaXB0aW9uIHBsYW4gYW5kIFBlcmlvZCIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGVyaW9kID0gdGhpcy5zZWxlY3RlZF9wZXJpb2QudG9Mb3dlckNhc2UoKTsKCiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zdWJzY3JpcHRpb25fcGxhbnMpIHsKICAgICAgICBpZiAocGVyaW9kID09IHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zW2ldLnBlcmlvZCkgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfc3Vic2NyaXB0aW9uID09IHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zW2ldLml0ZW0ubmFtZSkgewogICAgICAgICAgICB0aGlzLnBsYW5faWQgPSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pZDsgLy8gY29uc29sZS5sb2coIlBMQU4gTkFNRToiLCB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pdGVtLm5hbWUpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiUExBTiBJRDoiLCB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFuX2lkID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsYW4gTm90IEZvdW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGNvbnRhY3QgQ2Vuc2UgQWRtaW4iLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1c3RvbWVyX2lkID09ICIiKSB7CiAgICAgICAgdmFyIGN1c3RfZGF0YSA9IHsKICAgICAgICAgIG5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb250YWN0OiAiIiwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBub3RlczogewogICAgICAgICAgICBFeHRyYTogIkRldGFpbHMgcmVsYXRlZCB0byBjdXN0b21lciIKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNyZWF0ZV9jdXN0b21lcl9pZDogdHJ1ZSwKICAgICAgICAgIGRhdGE6IGN1c3RfZGF0YQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkN1c3RvbWVyIGNyZWF0ZWQiKSB7CiAgICAgICAgICAgIHZhciBjdXN0b21lcl9kZXRhaWwgPSByZXNwb25zZS5kYXRhLkN1c3RvbWVyX0RldGFpbDsKICAgICAgICAgICAgX3RoaXMxMS5jdXN0b21lcl9pZCA9IHJlc3BvbnNlLmRhdGEuQ3VzdG9tZXJfRGV0YWlsLmlkOyAvLyBjb25zb2xlLmxvZygiY3VzdG9tZXIgaWQiLHRoaXMuY3VzdG9tZXJfaWQpOwoKICAgICAgICAgICAgX3RoaXMxMS5jcmVhdGVfc3Vic2NyaXB0aW9uKF90aGlzMTEucGxhbl9pZCwgX3RoaXMxMS5jdXN0b21lcl9pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiRXJyb3Igb2NjdXJyZWQgd2hpbGUgY3JlYXRpbmcgQ3VzdG9tZXIgSUQsIFBsZWFzZSByZS10cnkiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNyZWF0ZV9zdWJzY3JpcHRpb24odGhpcy5wbGFuX2lkLCB0aGlzLmN1c3RvbWVyX2lkKTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZV9zdWJzY3JpcHRpb246IGZ1bmN0aW9uIGNyZWF0ZV9zdWJzY3JpcHRpb24ocGxhbl9pZCwgY3VzdG9tZXJfaWQpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdmFyIHN1Yl9kYXRhID0gewogICAgICAgIHBsYW5faWQ6IHBsYW5faWQsCiAgICAgICAgY3VzdG9tZXJfaWQ6IGN1c3RvbWVyX2lkCiAgICAgIH07CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLCB7CiAgICAgICAgY3JlYXRlX3N1YnNjcmlwdGlvbjogdHJ1ZSwKICAgICAgICBkYXRhOiBzdWJfZGF0YQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiU3Vic2NyaXB0aW9uIGNyZWF0ZWQiKSB7CiAgICAgICAgICBfdGhpczEyLnN1YnNjcmlwdGlvbl9pZCA9IHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uX0RldGFpbC5pZDsgLy8gY29uc29sZS5sb2coIlN1YnNjcmlwdGlvbiBpZCIsIHJlc3BvbnNlKTsKCiAgICAgICAgICBfdGhpczEyLnN0YXJ0X3BheW1lbnQoX3RoaXMxMi5zdWJzY3JpcHRpb25faWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiAiRXJyb3Igb2NjdXJyZWQgd2hpbGUgY3JlYXRpbmcgU3Vic2NyaXB0aW9uLCBQbGVhc2UgcmUtdHJ5IiwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzdGFydF9wYXltZW50OiBmdW5jdGlvbiBzdGFydF9wYXltZW50KHN1YnNjcmlwdGlvbl9pZCkgewogICAgICB2YXIgdm0gPSB0aGlzOyAvLyBzdGFydF9wYXltZW50KCl7CiAgICAgIC8vICAgdmFyIHZtID0gdGhpczsKICAgICAgLy8gICB2YXIgZGF0YSA9IHsKICAgICAgLy8gICAgIG9yZGVyX2Ftb3VudDogNTAwMDAsCiAgICAgIC8vICAgICBvcmRlcl9jdXJyZW5jeTogJ0lOUicsCiAgICAgIC8vICAgICBvcmRlcl9yZWNlaXB0OiAnb3JkZXJfcmNwdGlkXzExJywKICAgICAgLy8gICAgIHBheW1lbnRfY2FwdHVyZTogMSwKICAgICAgLy8gICAgIG5vdGVzOiB7J1NoaXBwaW5nIGFkZHJlc3MnOiAnQm9tbWFuYWhhbGxpLCBCYW5nYWxvcmUnfQogICAgICAvLyAgIH0KICAgICAgLy8gICBheGlvcy4KICAgICAgLy8gICAgIHBvc3QoCiAgICAgIC8vICAgICAgIGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwKICAgICAgLy8gICAgICAgewogICAgICAvLyAgICAgICAgIGdlbmVyYXRlX29yZGVyX2lkOiB0cnVlLAogICAgICAvLyAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgLy8gICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgLy8gICAgICAgaWYocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk9yZGVyIElEIGNyZWF0ZWQiKXsKICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbCk7CiAgICAgIC8vICAgICAgICAgdm0ub3JkZXJfaWQgPSByZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbC5pZDsKICAgICAgLy8gICAgICAgICB2bS5hbW91bnQgPSByZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbC5hbW91bnQ7CiAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coInJlYWNoZWQiKTsKCiAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgIGtleTogcHJvY2Vzcy5lbnYuVlVFX0FQUF9SQVpPUlBBWV9LRVksCiAgICAgICAgLy8gRW50ZXIgdGhlIEtleSBJRCBnZW5lcmF0ZWQgZnJvbSB0aGUgRGFzaGJvYXJkCiAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiBzdWJzY3JpcHRpb25faWQsCiAgICAgICAgLy8gWW91IGRvbnQgbmVlZCBhbW91bnQvY3VycmVuY3kvb3JkZXJfaWQgd2hlbiBzdWJtaXR0aW5nIHN1YnNjcmlwdGlvbiBpZAogICAgICAgIC8vICJhbW91bnQiOiB0aGlzLmFtb3VudCwgLy8gQW1vdW50IGlzIGluIGN1cnJlbmN5IHN1YnVuaXRzLiBEZWZhdWx0IGN1cnJlbmN5IGlzIElOUi4gSGVuY2UsIDUwMDAwIHJlZmVycyB0byA1MDAwMCBwYWlzZQogICAgICAgIC8vICJjdXJyZW5jeSI6ICJJTlIiLAogICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgZGVzY3JpcHRpb246ICJUZXN0IFRyYW5zYWN0aW9uIiwKICAgICAgICBpbWFnZTogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9jZW5zZV9sb2dvLnBuZyIpLAogICAgICAgIC8vICJvcmRlcl9pZCI6IHRoaXMub3JkZXJfaWQsIC8vVGhpcyBpcyBhIHNhbXBsZSBPcmRlciBJRC4gUGFzcyB0aGUgYGlkYCBvYnRhaW5lZCBpbiB0aGUgcmVzcG9uc2Ugb2YgU3RlcCAxCiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihyZXNwb25zZSkgewogICAgICAgICAgLy8gY29uc29sZS5sb2coIkZJTkFMIFBBWSIsIHJlc3BvbnNlKTsKICAgICAgICAgIHZhciByYXpvcnBheV9wYXltZW50X2lkID0gcmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZDsgLy8gdmFyIHJhem9ycGF5X29yZGVyX2lkID0gcmVzcG9uc2UucmF6b3JwYXlfb3JkZXJfaWQ7CgogICAgICAgICAgdmFyIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZCA9IHJlc3BvbnNlLnJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZDsKICAgICAgICAgIHZhciByYXpvcnBheV9zaWduYXR1cmUgPSByZXNwb25zZS5yYXpvcnBheV9zaWduYXR1cmU7CiAgICAgICAgICB2bS5wYXlfc3VjY2Vzc19kYXRhID0ge307CiAgICAgICAgICB2bS5wYXlfc3VjY2Vzc19kYXRhID0gewogICAgICAgICAgICByYXpvcnBheV9wYXltZW50X2lkOiByYXpvcnBheV9wYXltZW50X2lkLAogICAgICAgICAgICAvLyByYXpvcnBheV9vcmRlcl9pZDogcmF6b3JwYXlfb3JkZXJfaWQsCiAgICAgICAgICAgIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZDogcmF6b3JwYXlfc3Vic2NyaXB0aW9uX2lkLAogICAgICAgICAgICByYXpvcnBheV9zaWduYXR1cmU6IHJhem9ycGF5X3NpZ25hdHVyZSwKICAgICAgICAgICAgcmF6b3JwYXlfY3VzdG9tZXJfaWQ6IHZtLmN1c3RvbWVyX2lkLAogICAgICAgICAgICAvLyBvcmRlcl9pZDogdGhpcy5vcmRlcl9pZCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3N0YXR1czogImFjdGl2ZSIsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZDogdm0uc3Vic2NyaXB0aW9uX2lkLAogICAgICAgICAgICBwbGFuX2lkOiB2bS5wbGFuX2lkLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZTogdm0uc2VsZWN0ZWRfc3Vic2NyaXB0aW9uLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fcGVyaW9kOiB2bS5zZWxlY3RlZF9wZXJpb2QKICAgICAgICAgIH07IC8vIGNvbnNvbGUubG9nKCJQQVlNRU5UIFNVQ0NFU1MgREFUQSIsdm0ucGF5X3N1Y2Nlc3NfZGF0YSk7CgogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHZtLnBheV9zdWNjZXNzX2RhdGEpLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgIHZtLmFkZF9kZXRhaWxzX3RvX3NlcnZlcih2bS5wYXlfc3VjY2Vzc19kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7Ly8gY29uc29sZS5sb2coIlRyYW5zYWN0aW9uIGRpZCBub3Qgc3VjY2VlZCIpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLy8gInByZWZpbGwiOiB7CiAgICAgICAgLy8gICAgICJuYW1lIjogIkdhdXJhdiBLdW1hciIsCiAgICAgICAgLy8gICAgICJlbWFpbCI6ICJnYXVyYXYua3VtYXJAZXhhbXBsZS5jb20iLAogICAgICAgIC8vICAgICAiY29udGFjdCI6ICIrOTE5ODc2NTQzMjEwIgogICAgICAgIC8vIH0sCiAgICAgICAgbm90ZXM6IHsKICAgICAgICAgIGFkZHJlc3M6ICJSYXpvcnBheSBDb3Jwb3JhdGUgT2ZmaWNlIgogICAgICAgIH0sCiAgICAgICAgdGhlbWU6IHsKICAgICAgICAgIGNvbG9yOiAiIzMzOTljYyIKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciByenAxID0gbmV3IFJhem9ycGF5KG9wdGlvbnMpOwogICAgICByenAxLm9uKCJwYXltZW50LmZhaWxlZCIsIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJlcnJvciIsIHJlc3BvbnNlKTsKICAgICAgICBhbGVydChyZXNwb25zZS5lcnJvci5jb2RlKTsKICAgICAgICBhbGVydChyZXNwb25zZS5lcnJvci5kZXNjcmlwdGlvbik7CiAgICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3Iuc291cmNlKTsKICAgICAgICBhbGVydChyZXNwb25zZS5lcnJvci5zdGVwKTsKICAgICAgICBhbGVydChyZXNwb25zZS5lcnJvci5yZWFzb24pOwogICAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLm1ldGFkYXRhLm9yZGVyX2lkKTsKICAgICAgICBhbGVydChyZXNwb25zZS5lcnJvci5tZXRhZGF0YS5wYXltZW50X2lkKTsKICAgICAgfSk7CiAgICAgIHJ6cDEub3BlbigpOyAvLyB9CiAgICAgIC8vIH0pCiAgICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgIC8vICAgICBpZiAoCiAgICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgIC8vICAgICApIHsKICAgICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICB9KTsKICAgIH0sCiAgICBhZGRfZGV0YWlsc190b19zZXJ2ZXI6IGZ1bmN0aW9uIGFkZF9kZXRhaWxzX3RvX3NlcnZlcihkYXRhKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICB2ZXJpZnlfc3Vic2NyaXB0aW9uOiB0cnVlLAogICAgICAgICAgZGF0YTogZGF0YQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIlN1YnNjcmlwdGlvbiB2ZXJpZmljYXRpb24gc3VjY2VzcyIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzZnVsbHkgU3ViY3JpcHRpb24gUmVnaXN0ZXJlZCIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpczEzLnBheV9zdWNjZXNzX2RhdGEgPSB7fTsKICAgICAgICAgICAgX3RoaXMxMy5zdWJzY3JpcHRpb25fYnRuX2Rpc2FibGUgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6ICJFcnJvciBvY2N1cnJlZCB3aGlsZSBnZXR0aW5nIFN1YnNjcmlwdGlvbiB2ZXJpZmljYXRpb24gc3RhdHVzLCBQbGVhc2UgcmUtdHJ5IiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXMxMy5wYXlfc3VjY2Vzc19kYXRhID0ge307CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczEzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlX2NoYW5nZTogZnVuY3Rpb24gdG9nZ2xlX2NoYW5nZSh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT0gIklOUiIpIHsKICAgICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeSA9IHRoaXMuSU5SOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29tbW9uX2N1cnJlbmN5ID0gdGhpcy5VU0Q7CiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZSA9PSAiSU5SIikgewogICAgICAgIHRoaXMuY29tbW9uX2N1cnJlbmN5MiA9IHRoaXMuSU5SMjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeTIgPSB0aGlzLlVTRDI7CiAgICAgIH0KICAgIH0sCiAgICBkb3dubG9hZF9pbnZvaWNlOiBmdW5jdGlvbiBkb3dubG9hZF9pbnZvaWNlKG51bSkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5iaWxsaW5nX2ludm9pY2UoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZG93bmxvYWRfZmlsZTogdHJ1ZSwKICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5pbnZvaWNlX2RldGFpbHNbbnVtXQogICAgICAgIH0sCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIikgewogICAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiRHVlIHRvIHNvbWUgaW50ZXJuYWwgZXJyb3IsIG5vdCBhYmxlIHRvIGRvd25sb2FkIHRoZSBmaWxlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMTQuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJBc2hpc2giICsgIi5wZGYiKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNhbGxfcGF5bWVudDogZnVuY3Rpb24gY2FsbF9wYXltZW50KHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOyAvLyBjb25zb2xlLmxvZyhkKTsKCiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZhciBvcHRpb25zID0ge307CgogICAgICBpZiAodHlwZSA9PSAiY291bnRyeV9zZWxlY3RlZCIpIHsKICAgICAgICBpZiAodGhpcy5jb3VudHJ5X25hbWUuY29kZSA9PSAiIikgewogICAgICAgICAgYWxlcnQoIllvdSBuZWVkIHRvIHNlbGVjdCBjb3VudHJ5Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmVkaXRfcHJvZmlsZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZmlyc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmZpcnN0X25hbWUsCiAgICAgICAgICAgIGxhc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxhc3RfbmFtZSwKICAgICAgICAgICAgY291bnRyeV9uYW1lOiB0aGlzLmNvdW50cnlfbmFtZS5jb2RlLAogICAgICAgICAgICBwaG9uZV9udW1iZXI6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5waG9uZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJQcm9maWxlIFVwZGF0ZWQiKSB7CiAgICAgICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgICAgICAvLyAgIHRpdGxlOiAiVXBkYXRlZCBTdWNjZXNzZnVsbHkhISIsCiAgICAgICAgICAgICAgLy8gICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgLy8gICB0ZXh0OiAiWW91ciBwcm9maWxlIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LiIsCiAgICAgICAgICAgICAgLy8gICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIik7CgogICAgICAgICAgICAgIF90aGlzMTUuJHNlc3Npb24uc2V0KCJjb3VudHJ5X25hbWUiLCBfdGhpczE1LmNvdW50cnlfbmFtZS5jb2RlKTsKCiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczE1LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJCgiI2NvdW50cnltb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczE1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlubmVyVGV4dCA9PSAiUGF5IikgewogICAgICAgIGlmICh0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9PSAiIikgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGFuIGFtb3VudCB0byBiZSBwYWlkLiIpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwLnNsaWNlKDIsIC0xMCk7CiAgICAgICAgICB0aGlzLmN1cnJlbmN5X2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwICogMTE4OwogICAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXA7CgogICAgICAgICAgaWYgKHRoaXMucGF5bWVudF9jdXJyZW5jeSA9PSAiSU5SIikgewogICAgICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgLz0gNzA7CiAgICAgICAgICB9CgogICAgICAgICAgcGF5X2Ftb3VudCh0aGlzLmN1cnJlbmN5X2Ftb3VudCwgdGhpcy5wYXltZW50X2N1cnJlbmN5LCAiVG9wIFVwIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAuc2xpY2UoMik7CiAgICAgICAgICB0aGlzLmN1cnJlbmN5X2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwICogMTAwOwogICAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXA7CiAgICAgICAgICBwYXlfYW1vdW50KHRoaXMuY3VycmVuY3lfYW1vdW50LCB0aGlzLnBheW1lbnRfY3VycmVuY3ksICJUb3AgVXAiKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlubmVyVGV4dCA9PSAiU3Vic2NyaWJlIikgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKCiAgICAgICAgaWYgKHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uID09ICIiKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYW4gYW1vdW50IHRvIGJlIHBhaWQuIik7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMiwgLTEwKTsKICAgICAgICAgIHRoaXMuY3VycmVuY3lfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gKiAxMTg7CiAgICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjsKCiAgICAgICAgICBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgICAgIHRoaXMudG9wX3VwX2Ftb3VudCAvPSA3MDsKICAgICAgICAgIH0KCiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5iaWxsaW5nX3N1YnNjcmlwdGlvbl91cmwoKSwgewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIFBsYW5BbW91bnQ6IHRoaXMudG9wX3VwX2Ftb3VudAogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICBwYXlfYW1vdW50KHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQsICIiLCAiU3Vic2NyaWJlIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5FcnJvcikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLkVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMik7CiAgICAgICAgICB0aGlzLmN1cnJlbmN5X2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uICogMTAwOwogICAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb247CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5iaWxsaW5nX3N1YnNjcmlwdGlvbl91cmwoKSwgewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIFBsYW5BbW91bnQ6IHRoaXMuY3VycmVuY3lfYW1vdW50CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczE1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICBwYXlfYW1vdW50KHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQsICIiLCAiU3Vic2NyaWJlIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5FcnJvcikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLkVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXlfYW1vdW50KGFtb3VudCwgY3VycmVuY3lfdHlwZSwgcGF5bWVudF90eXBlKSB7CiAgICAgICAgaWYgKHBheW1lbnRfdHlwZSA9PSAiU3Vic2NyaWJlIikgewogICAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ6IGFtb3VudCwKICAgICAgICAgICAgLy9UaGlzIGlzIGFjdHVhbGx5IHN1YnNjcmlwdGlvbiBJRAogICAgICAgICAgICAvLyBzdWJzY3JpcHRpb25fY2FyZF9jaGFuZ2U6IDEsCiAgICAgICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiSW5zdGlsbCBJbnRlbGxpZ2VuY2UiLAogICAgICAgICAgICBpbWFnZTogIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIiwKICAgICAgICAgICAgLy8gQ09NUEFOWSBMT0dPCiAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkKTsKICAgICAgICAgICAgICAvLyB2YXIgY29udGFjdCA9ICQoJyNjb250YWN0W3R5cGU9InRlbCJdJykudmFsdWU7CiAgICAgICAgICAgICAgLy8gdmFyIGVtYWlsID0gJCgnI2VtYWlsW3R5cGU9ImVtYWlsIl0nKS52YWx1ZTsKICAgICAgICAgICAgICB2bS5wYXltZW50aWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwogICAgICAgICAgICAgIHZtLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiA9ICIiOwogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmVmaWxsOiB7CiAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgLy8gcGFzcyBjdXN0b21lciBuYW1lCiAgICAgICAgICAgICAgZW1haWw6ICIiLAogICAgICAgICAgICAgIC8vIGN1c3RvbWVyIGVtYWlsCiAgICAgICAgICAgICAgY29udGFjdDogIiIgLy9jdXN0b21lciBwaG9uZSBuby4KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vdGVzOiB7CiAgICAgICAgICAgICAgYWRkcmVzczogImFkZHJlc3MiIC8vY3VzdG9tZXIgYWRkcmVzcwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGhlbWU6IHsKICAgICAgICAgICAgICBjb2xvcjogIiMyODM3NzciIC8vIHNjcmVlbiBjb2xvcgoKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGxvYWRfY2hlY2tvdXQoKTsKICAgICAgICB9IGVsc2UgaWYgKHBheW1lbnRfdHlwZSA9PSAiUGF5IikgewogICAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgICAgICBhbW91bnQ6IGFtb3VudCwKICAgICAgICAgICAgLy8gRXhhbXBsZTogMjAwMCBwYWlzZSA9IElOUiAyMAogICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3lfdHlwZSwKICAgICAgICAgICAgbmFtZTogIkNlbnNlIEFJIiwKICAgICAgICAgICAgZGVzY3JpcHRpb246ICJJbnN0aWxsIEludGVsbGlnZW5jZSIsCiAgICAgICAgICAgIGltYWdlOiAiL2ltZy9jZW5zZV9pbWFnZS5wbmciLAogICAgICAgICAgICAvLyBDT01QQU5ZIExPR08KICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQpOwogICAgICAgICAgICAgIHZhciBjb250YWN0ID0gJCgnI2NvbnRhY3RbdHlwZT0idGVsIl0nKS52YWx1ZTsKICAgICAgICAgICAgICB2YXIgZW1haWwgPSAkKCcjZW1haWxbdHlwZT0iZW1haWwiXScpLnZhbHVlOwogICAgICAgICAgICAgIHZtLnBheW1lbnRpZCA9IHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQ7CiAgICAgICAgICAgICAgdm0udmFsdWVfY3VycmVuY3lfdG9wX3VwID0gIiI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByZWZpbGw6IHsKICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAvLyBwYXNzIGN1c3RvbWVyIG5hbWUKICAgICAgICAgICAgICBlbWFpbDogIiIsCiAgICAgICAgICAgICAgLy8gY3VzdG9tZXIgZW1haWwKICAgICAgICAgICAgICBjb250YWN0OiAiIiAvL2N1c3RvbWVyIHBob25lIG5vLgoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbm90ZXM6IHsKICAgICAgICAgICAgICBhZGRyZXNzOiAiYWRkcmVzcyIgLy9jdXN0b21lciBhZGRyZXNzCgogICAgICAgICAgICB9LAogICAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICAgIGNvbG9yOiAiIzI4Mzc3NyIgLy8gc2NyZWVuIGNvbG9yCgogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgbG9hZF9jaGVja291dCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gbG9hZF9jaGVja291dCgpIHsKICAgICAgICB2YXIgcnpwMSA9IG5ldyBSYXpvcnBheShvcHRpb25zKTsKICAgICAgICByenAxLm9wZW4oKTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfcmV0YWlsX3BsYW46IGZ1bmN0aW9uIGNoZWNrX3JldGFpbF9wbGFuKHZhbHVlLCBpZCkgewogICAgICB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPSBudWxsOwogICAgfSwKICAgIHN1YnNjcmliZV9yZXRhaWxfcGxhbjogZnVuY3Rpb24gc3Vic2NyaWJlX3JldGFpbF9wbGFuKCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICAvLyBsZXQgc3Vic2NyaXB0aW9uX2RhdGEgPSB7CiAgICAgIC8vICAgc3Vic2NyaXB0aW9uX3BsYW46IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCwKICAgICAgLy8gICBiaWxsaW5nX2N5Y2xlOiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUsCiAgICAgIC8vIH07CiAgICAgIGlmICh0aGlzLmNoZWNrX3JldGFpbF9zaG9waWZ5X2Zvcm1fdmFsaWRhdGlvbnMpIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc3Vic2NyaWJlX3Nob3BpZnlfYmlsbGluZygpLCB7CiAgICAgICAgICBzdWJzY3JpcHRpb25fcGxhbjogdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LAogICAgICAgICAgYmlsbGluZ19jeWNsZTogdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBpc19wYWlkX3BsYW46IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgaWYgKF90aGlzMTYucmV0YWlsX3BheW1lbnRfdHlwZSA9PSAiQW5udWFsIikgewogICAgICAgICAgICAgIGlmIChCb29sZWFuKHJlc3BvbnNlLmRhdGEuZGF0YSkgJiYgQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGEuZGF0YS5hcHBTdWJzY3JpcHRpb25DcmVhdGUpKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSByZWRpcmVjdCBZb3UgdG8gdGhlIFNob3BpZnkgTWVyY2hhbnQgVUkhIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEuYXBwU3Vic2NyaXB0aW9uQ3JlYXRlLmNvbmZpcm1hdGlvblVybDsKICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczE2LnJldGFpbF9wYXltZW50X3R5cGUgPT0gIk1vbnRobHkiKSB7CiAgICAgICAgICAgICAgaWYgKEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5kYXRhLmNvbmZpcm1hdGlvbl91cmwpKSB7CiAgICAgICAgICAgICAgICAvLyBTd2FsKHsKICAgICAgICAgICAgICAgIC8vICAgdGl0bGU6ICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSByZWRpcmVjdCBZb3UgdG8gdGhlIFNob3BpZnkgTWVyY2hhbnQgVUkhIiwKICAgICAgICAgICAgICAgIC8vICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAvLyAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIC8vICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAvLyAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLmRhdGEuY29uZmlybWF0aW9uX3VybDsKICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczE2LnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiVGhhbmsgWW91IGZvciBzdWJzY3JpYmluZyB0byBvdXIgRnJlZSBQbGFuISIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczE2LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJQbGVhc2Ugc2VsY3QgYWxsIHRoZSByZXF1aXJlZCB2YWx1ZXMgYmVmb3JlIHByb2NlZWRpbmchIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfc3RyaXBlX2NoZWNrb3V0OiBmdW5jdGlvbiBzdWJtaXRfc3RyaXBlX2NoZWNrb3V0KCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ICE9PSBudWxsICYmIHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSAhPT0gbnVsbCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucyk7CiAgICAgICAgdmFyIGNob3Nlbl9wbGFuX2RhdGEgPSB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPT09ICJNb250aGx5IiA/IHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5hbW91bnQgLyAxMDAgPT09IF90aGlzMTcucmV0YWlsX3BsYW5fY3VycmVudC5tb250aGx5X2NoYXJnZTsKICAgICAgICB9KSA6IHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5hbW91bnQgLyAxMDAgPT09IF90aGlzMTcucmV0YWlsX3BsYW5fY3VycmVudC5hbm51YWxfY2hhcmdlLmFjdHVhbF9jaGFyZ2U7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgICAgZ2VuZXJhdGVfbmV3X3JlcXVlc3Q6IHRydWUsCiAgICAgICAgICBjaG9zZW5fcGxhbl9kYXRhOiBjaG9zZW5fcGxhbl9kYXRhLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICByZXF1ZXN0X3R5cGU6ICJQbGFuIiwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLkRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYWxsIGdpdmVuIGZpZWxkIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc3VibWl0X3N0cmlwZV9hZGRvbl9jaGVja291dDogZnVuY3Rpb24gc3VibWl0X3N0cmlwZV9hZGRvbl9jaGVja291dCgpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgdmFyIGNob3Nlbl9wbGFuX2RhdGEgPSB7CiAgICAgICAgInBsYW5fbmFtZSI6IHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbi5uYW1lLAogICAgICAgICJvcHRpb24iOiB0aGlzLnNlbGVjdGVkX2FkZG9uX3BsYW4udHlwZSwKICAgICAgICAicHJpY2UiOiB0aGlzLnNlbGVjdGVkX2FkZG9uX3BsYW4uUHJpY2UKICAgICAgfTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICBnZW5lcmF0ZV9uZXdfcmVxdWVzdDogdHJ1ZSwKICAgICAgICBjaG9zZW5fcGxhbl9kYXRhOiBjaG9zZW5fcGxhbl9kYXRhLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICByZXF1ZXN0X3R5cGU6ICJBZGRPbiIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UuZGF0YS5EYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwoKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},null]}