{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Campaigns/WhatsappBroadcast.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Campaigns/WhatsappBroadcast.vue","mtime":1663910265454},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwgY2xvc2VfbW9kYWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IFZ1ZVBob25lTnVtYmVySW5wdXQgZnJvbSAidnVlLXBob25lLW51bWJlci1pbnB1dCI7CmltcG9ydCAidnVlLXBob25lLW51bWJlci1pbnB1dC9kaXN0L3Z1ZS1waG9uZS1udW1iZXItaW5wdXQuY3NzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJXaGF0c2FwcEJyb2FkY2FzdFBhZ2UiLAogIGNvbXBvbmVudHM6IHsKICAgIFZ1ZUVkaXRvcjogVnVlRWRpdG9yLAogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0LAogICAgVnVlUGhvbmVOdW1iZXJJbnB1dDogVnVlUGhvbmVOdW1iZXJJbnB1dAogIH0sCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGJyb2FkY2FzdF9saXN0OiBbXSwKICAgICAgc2VhcmNoX3RlbXBsYXRlX25hbWU6ICcnLAogICAgICBzZWxlY3RfdGVtcGxhdGVfbGlzdDogW10sCiAgICAgIHBlbmNpbF9zdmc6ICcgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgbmFtZTogIiIsCiAgICAgIHRlbXBsYXRlbGlzdDogW10sCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGN1cnJlbnRfYnJvYWRjYXN0OiB7fSwKICAgICAgb2xkX2Jyb2FkY2FzdF9uYW1lOiAiIiwKICAgICAgY3VycmVudF9icm9hZGNhc3RfaGlnaGxpZ2h0X25hbWU6ICIiLAogICAgICBpc0VkaXRCcm9hZGNhc3Q6IGZhbHNlLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdDogZmFsc2UsCiAgICAgIGVkaXRfYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdDogZmFsc2UsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICBjb250YWN0c19saXN0OiBbXSwKICAgICAgc2VsZWN0X2N1c3RvbWVyX2xpc3Q6IFtdLAogICAgICBjb250YWN0c19saXN0X3BhZ2luYXRpb246IDEsCiAgICAgIGNvbnRhY3RzX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb246IDEsCiAgICAgIHRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbjogMSwKICAgICAgdGVtcGxhdGVfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbjogMSwKICAgICAgY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uX2NvdW50OiAwLAogICAgICBjb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50OiAwLAogICAgICB0ZW1wbGF0ZV9saXN0X3BhZ2luYXRpb25fY291bnQ6IDAsCiAgICAgIHRlbXBsYXRlX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb25fY291bnQ6IDAsCiAgICAgIHNlYXJjaF9jdXN0b21lcjogIiIsCiAgICAgIGRpc2FibGVfYnRuX2V4cGlyZWQ6IGZhbHNlLAogICAgICBpc1Zpc2libGVTZWFyY2hDbGVhcjogZmFsc2UsCiAgICAgIHNlYXJjaF9uYW1lOiAiIgogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBpc19ub3RpZmljYXRpb25fdGVtcGxhdGU6IEJvb2xlYW4KICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMuZ2V0X2RhdGEoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDIwMDApOwogICAgdGhpcy5nZXRfZGF0YSgpOyAvLyAgIGlmICh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSA9PT0gZmFsc2UpIHsKCiAgICB0aGlzLmxvYWRfY3VzdG9tZXJfbGlzdCgpOwogICAgdGhpcy5nZXRfdGVtcGxhdGVfZGF0YSgpOyAvLyAgIH0KCiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKCiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICAgIHZhciBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNsaXN0X2lkIik7CiAgICBlbC5vbndoZWVsID0gdGhpcy5oYW5kbGVXaGVlbDsKICAgIHZhciBlbDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdGVtcGxhdGVfbGlzdF9pZCIpOwogICAgZWwxLm9ud2hlZWwgPSB0aGlzLmhhbmRsZVdoZWVsX3RlbXBsYXRlOwogIH0sCiAgbWV0aG9kczogewogICAgbmFtZVdpdGhOdW1iZXI6IGZ1bmN0aW9uIG5hbWVXaXRoTnVtYmVyKF9yZWYpIHsKICAgICAgdmFyIHByb2ZpbGVfbmFtZSA9IF9yZWYucHJvZmlsZV9uYW1lLAogICAgICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyID0gX3JlZi53aGF0c2FwcF9waG9uZV9udW1iZXI7CiAgICAgIHJldHVybiAiIi5jb25jYXQocHJvZmlsZV9uYW1lLCAiIDogIikuY29uY2F0KHdoYXRzYXBwX3Bob25lX251bWJlcik7CiAgICB9LAogICAgaGFuZGxlV2hlZWw6IGZ1bmN0aW9uIGhhbmRsZVdoZWVsKGV2ZW50LCBkYXRhLCBmdW5jKSB7CiAgICAgIGlmIChldmVudC5kZWx0YVkgPiAwKSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX2N1c3RvbWVyICE9ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uIDwgdGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50KSB7CiAgICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiArPSAxOwogICAgICAgICAgICB0aGlzLnNlYXJjaF9jdXN0b21lcl9saXN0KHRoaXMuc2VhcmNoX2N1c3RvbWVyLCAnc2Nyb2xsJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbiA8IHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uX2NvdW50KSB7CiAgICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbiArPSAxOwogICAgICAgICAgdGhpcy5sb2FkX2N1c3RvbWVyX2xpc3QoJ3Njcm9sbCcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGhhbmRsZVdoZWVsX3RlbXBsYXRlOiBmdW5jdGlvbiBoYW5kbGVXaGVlbF90ZW1wbGF0ZShldmVudCwgZGF0YSwgZnVuYykgewogICAgICBpZiAoZXZlbnQuZGVsdGFZID4gMCkgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF90ZW1wbGF0ZV9uYW1lICE9ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uIDwgdGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50KSB7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiArPSAxOwogICAgICAgICAgICB0aGlzLnNlYXJjaF90ZW1wbGF0ZSh0aGlzLnNlYXJjaF90ZW1wbGF0ZV9uYW1lLCAnc2Nyb2xsJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbiA8IHRoaXMudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uX2NvdW50KSB7CiAgICAgICAgICB0aGlzLnRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbiArPSAxOwogICAgICAgICAgdGhpcy5nZXRfdGVtcGxhdGVfZGF0YSgnc2Nyb2xsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2xlYXJfc2VhcmNoX25hbWU6IGZ1bmN0aW9uIGNsZWFyX3NlYXJjaF9uYW1lKCkgewogICAgICB0aGlzLnNlYXJjaF9uYW1lID0gIiI7CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9icm9hZGNhc3RzKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBzZWFyY2hfa2V5OiB0aGlzLnNlYXJjaF9uYW1lCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBfdGhpczIuYnJvYWRjYXN0X2xpc3QgPSBbXTsKCiAgICAgICAgICBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMi5icm9hZGNhc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5icm9hZGNhc3RzOwoKICAgICAgICAgICAgaWYgKF90aGlzMi5icm9hZGNhc3RfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnNob3dfYnJvYWRjYXN0KDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczIubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgX3RoaXMyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICBfdGhpczIuc2V0cGFnaW5hdGlvbigxKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMi5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLmlzRWRpdEJyb2FkY2FzdCA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZV9VVUlEOiBmdW5jdGlvbiBjcmVhdGVfVVVJRCgpIHsKICAgICAgdmFyIGR0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciB1dWlkID0gInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCIucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgewogICAgICAgIHZhciByID0gKGR0ICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDsKICAgICAgICBkdCA9IE1hdGguZmxvb3IoZHQgLyAxNik7CiAgICAgICAgcmV0dXJuIChjID09ICJ4IiA/IHIgOiByICYgMHgzIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgIH0pOwogICAgICByZXR1cm4gdXVpZDsKICAgIH0sCiAgICBzYXZlX3RlbXBsYXRlOiBmdW5jdGlvbiBzYXZlX3RlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLm5hbWUgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJCcm9hZGNhc3QgbmFtZSBjYW5ub3QgYmUgYmxhbmsuIiksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2VsZWN0X2N1c3RvbWVyX2xpc3QubGVuZ3RoIDwgMikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoIk1pbmltdW0gdHdvIGNvbnRhY3RzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIGJyb2FkY2FzdC4iKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5icm9hZGNhc3RfbmFtZV9hbHJlYWR5X2V4aXN0ID09IHRydWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICBicm9hZGNhc3Q6IHsKICAgICAgICAgIGlkOiB0aGlzLmNyZWF0ZV9VVUlEKCksCiAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsCiAgICAgICAgICBjb250YWN0czogdGhpcy5zZWxlY3RfY3VzdG9tZXJfbGlzdAogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAkKCIjYWRkYnJvYWRjYXN0bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgiQnJvYWRjYXN0IGRhdGEgYWRkZWQgc3VjY2Vzc2Z1bGx5IiksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgX3RoaXMzLmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgICBfdGhpczMuZ2V0X2RhdGEoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5JTlNVRkZJQ0lFTlRfV0hBVFNBUFBfQlJPQURDQVNUX0lORk9STUFUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzMy50bHQoIk1pbmltdW0gdHdvIGNvbnRhY3RzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIGJyb2FkY2FzdCIpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzMy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2xvc2VfbW9kYWwoInJlc19uX2ludF9zYXZlIik7CiAgICB9LAogICAgZWRpdF90ZW1wbGF0ZV9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X3RlbXBsYXRlX2RldGFpbHMoKSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRCcm9hZGNhc3QpIHsKICAgICAgICB0aGlzLmlzRWRpdEJyb2FkY2FzdCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgICB0aGlzLmdldF9kYXRhKCk7CiAgICAgICAgdGhpcy5lZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfYnJvYWRjYXN0OiBmdW5jdGlvbiBlZGl0X2Jyb2FkY2FzdCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiQnJvYWRjYXN0IG5hbWUgY2Fubm90IGJlIGJsYW5rIiksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9icm9hZGNhc3QuY29udGFjdHMubGVuZ3RoIDwgMikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoIk1pbmltdW0gdHdvIGNvbnRhY3RzIHJlcXVpcmVkIGZvciBhIGJyb2FkY2FzdC4iKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5lZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9icm9hZGNhc3RzKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgIGJyb2FkY2FzdDogewogICAgICAgICAgaWQ6IHRoaXMuY3VycmVudF9icm9hZGNhc3QuaWQsCiAgICAgICAgICBuYW1lOiB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0Lm5hbWUsCiAgICAgICAgICBjb250YWN0czogdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5jb250YWN0cwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFKSB7CiAgICAgICAgICAkKCIjYWRkYnJvYWRjYXN0bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogX3RoaXM0LnRsdCgiQnJvYWRjYXN0IGRhdGEgZWRpdGVkIHN1Y2Nlc3NmdWxseSIpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIF90aGlzNC5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgX3RoaXM0LmdldF9kYXRhKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczQuYXBpX3N0YXR1c19jb2RlLklOU1VGRklDSUVOVF9XSEFUU0FQUF9CUk9BRENBU1RfSU5GT1JNQVRJT04uTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczQudGx0KCJNaW5pbXVtIHR3byBjb250YWN0cyByZXF1aXJlZCBmb3IgYSBicm9hZGNhc3QiKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczQuaXNFZGl0QnJvYWRjYXN0ID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRfY3VzdG9tZXJfbGlzdDogZnVuY3Rpb24gbG9hZF9jdXN0b21lcl9saXN0KHR5cGUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBpZiAodHlwZSAhPT0gJ3Njcm9sbCcpIHsKICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbiA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGdldF9jb250YWN0c19saXN0OiB0cnVlLAogICAgICAgIHBlcl9wYWdlOiA1LAogICAgICAgIHBhZ2Vfbm86IHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmICh0eXBlICE9PSAnc2Nyb2xsJykgewogICAgICAgICAgX3RoaXM1LmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzX2xpc3QpIHsKICAgICAgICAgICAgX3RoaXM1LmNvbnRhY3RzX2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHNfbGlzdFtpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM1LmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbl9jb3VudCA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczUuYXBpX3N0YXR1c19jb2RlLk5PX0NPTlRBQ1RTX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczUuY29udGFjdHNfbGlzdCA9IFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXM1LnRsdCgic29tZV9lcnJvcl9tc2ciKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZWFyY2hfY3VzdG9tZXJfbGlzdDogZnVuY3Rpb24gc2VhcmNoX2N1c3RvbWVyX2xpc3QocXVlcnksIHR5cGUpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBpZiAocXVlcnkgIT0gIiIpIHsKICAgICAgICBpZiAodHlwZSAhPT0gJ3Njcm9sbCcpIHsKICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiA9IDE7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGdldF9jb250YWN0c19saXN0OiB0cnVlLAogICAgICAgICAgc2VhcmNoX2tleTogcXVlcnksCiAgICAgICAgICBwZXJfcGFnZTogNSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMuY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbgogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmICh0eXBlICE9PSAnc2Nyb2xsJykgewogICAgICAgICAgICBfdGhpczYuY29udGFjdHNfbGlzdCA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHNfbGlzdCkgewogICAgICAgICAgICAgIF90aGlzNi5jb250YWN0c19saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzX2xpc3RbaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczYuY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbl9jb3VudCA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuTk9fQ09OVEFDVFNfREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM2LmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkX2N1c3RvbWVyX2xpc3QoKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfYnJvYWRjYXN0OiBmdW5jdGlvbiBzZW5kX2Jyb2FkY2FzdCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0X3RlbXBsYXRlX2xpc3QubGVuZ3RoICE9IDApIHsKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2VsZWN0X3RlbXBsYXRlX2xpc3QpIHsKICAgICAgICAgIGxpc3QucHVzaCh0aGlzLnNlbGVjdF90ZW1wbGF0ZV9saXN0W2ldLnRlbXBsYXRlX2lkKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdGVtcGxhdGUiKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICBwdWJsaXNoX3RlbXBsYXRlOiB0cnVlLAogICAgICAgICAgc2VuZF90bzogJ2Jyb2FkY2FzdCcsCiAgICAgICAgICBicm9hZGNhc3RfaWRzOiBbdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5pZF0sCiAgICAgICAgICB0ZW1wbGF0ZV9pZDogbGlzdAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfQ09OVEFDVF9MSVNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9NRURJQV9TRU5EX0ZBSUxVUkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1VTRVJfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczcudGx0KCJ0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCIpLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoInRpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZyIpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzNy50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2ciKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczcudGx0KCJlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2ciKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM3LiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXR0aW5ncyIsCiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuU0VORElOR19URU1QTEFURS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczcudGx0KCJzZW5kX3RlbXBsYXRlX3NlbnRfbXNnIiksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgJCgiI3NlbmR0ZW1wbGF0ZSIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCJzZW5kX2Jyb2FkY2FzdCIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICB2YWxpZGF0ZV9icm9hZGNhc3RfbmFtZTogZnVuY3Rpb24gdmFsaWRhdGVfYnJvYWRjYXN0X25hbWUoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGlzX3VuaXF1ZTogdHJ1ZSwKICAgICAgICBicm9hZGNhc3RfbmFtZTogdGhpcy5uYW1lCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5TVEFUVVNfU1VDQ0VTUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczguYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM4Lm5hbWUgIT0gIiIpIHsvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAvLyAiMXB4IHNvbGlkIGdyZWVuIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BTFJFQURZX0VYSVNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOC5icm9hZGNhc3RfbmFtZV9hbHJlYWR5X2V4aXN0ID0gdHJ1ZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfYnJvYWRjYXN0X25hbWU6IGZ1bmN0aW9uIHZhbGlkYXRlX2VkaXRfYnJvYWRjYXN0X25hbWUoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfdW5pcXVlOiB0cnVlLAogICAgICAgIGJyb2FkY2FzdF9uYW1lOiB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0Lm5hbWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfdGhpczkuYXBpX3N0YXR1c19jb2RlLlNUQVRVU19TVUNDRVNTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzOS5lZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChfdGhpczkuY3VycmVudF9icm9hZGNhc3QubmFtZSAhPSAiIikgey8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAvLyAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FMUkVBRFlfRVhJU1QuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzOS5vbGRfYnJvYWRjYXN0X25hbWUgPT0gX3RoaXM5LmN1cnJlbnRfYnJvYWRjYXN0Lm5hbWUpIHsKICAgICAgICAgICAgX3RoaXM5LmVkaXRfYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzOS5lZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VsZWN0ZWRfYnJvYWRjYXN0OiBmdW5jdGlvbiBzZWxlY3RlZF9icm9hZGNhc3QodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09ICJhbGwiKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5icm9hZGNhc3RfbGlzdCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMuYnJvYWRjYXN0X2xpc3RbaV0uaWQpOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICQoIiMiICsgW19pXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICByZXR1cm4gaWQgIT0gdmFsdWU7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfYnJvYWRjYXN0OiBmdW5jdGlvbiBkZWxldGVfYnJvYWRjYXN0KCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoIDwgMSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoIlNlbGVjdCBhdGxlYXN0IG9uZSB0ZW1wbGF0ZSB0byBkZWxldGUuIiksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9icm9hZGNhc3RzKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICBicm9hZGNhc3RfaWRzOiB0aGlzLmNoZWNrZWRfbGlzdAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxMC5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICBfdGhpczEwLmdldF9kYXRhKCk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTAuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoIkJyb2FkY2FzdCBEZWxldGVkIFN1Y2Nlc3NmdWxseSIpLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9PUEVSQVRJT04uTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTAuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoInF1ZXJ5X2V4ZWN1dGVkX21zZyIpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMxMC5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczEwLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXRfdGVtcGxhdGVfZGF0YTogZnVuY3Rpb24gZ2V0X3RlbXBsYXRlX2RhdGEodHlwZSkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAodHlwZSAhPT0gJ3Njcm9sbCcpIHsKICAgICAgICB0aGlzLnRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbiA9IDE7CiAgICAgIH0KCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICBwYWdlX25vOiA1LAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbgogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHR5cGUgIT09ICdzY3JvbGwnKSB7CiAgICAgICAgICBfdGhpczExLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlcykgewogICAgICAgICAgICBfdGhpczExLnRlbXBsYXRlbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXNbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTEudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uX2NvdW50ID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczExLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9kYXRhOiBmdW5jdGlvbiBnZXRfZGF0YSgpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdCA9IHt9OyAvLyBHZXQgU2F2ZWQgVGVtcGxhdGVzCgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczEyLmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgICBfdGhpczEyLmJyb2FkY2FzdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmJyb2FkY2FzdHM7CiAgICAgICAgICBfdGhpczEyLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICBfdGhpczEyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgaWYgKF90aGlzMTIuYnJvYWRjYXN0X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBfdGhpczEyLnNob3dfYnJvYWRjYXN0KDApOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTIuc2V0cGFnaW5hdGlvbihfdGhpczEyLnBhZ2Vfbm8pOwoKICAgICAgICAgIF90aGlzMTIuaXNFZGl0QnJvYWRjYXN0ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczEyLmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VhcmNoX3RlbXBsYXRlOiBmdW5jdGlvbiBzZWFyY2hfdGVtcGxhdGUocXVlcnksIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgaWYgKHF1ZXJ5ICE9ICIiKSB7CiAgICAgICAgaWYgKHR5cGUgIT09ICdzY3JvbGwnKSB7CiAgICAgICAgICB0aGlzLnRlbXBsYXRlX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gPSAxOwogICAgICAgIH0KCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMudGVtcGxhdGVfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgIHNlYXJjaF9rZXk6IHF1ZXJ5CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmICh0eXBlICE9PSAnc2Nyb2xsJykgewogICAgICAgICAgICBfdGhpczEzLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlcykgewogICAgICAgICAgICAgIF90aGlzMTMudGVtcGxhdGVsaXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTMudGVtcGxhdGVfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbl9jb3VudCA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5OT19XSEFUU0FQUF9URU1QTEFURS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMTMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdldF90ZW1wbGF0ZV9kYXRhKCk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX3JlcXVpcmU6IGZ1bmN0aW9uIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkge30gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczE0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczE0LmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgICAgICAgX3RoaXMxNC5icm9hZGNhc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5icm9hZGNhc3RzOwogICAgICAgICAgICAgIF90aGlzMTQubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgICBfdGhpczE0LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgIGlmIChfdGhpczE0LmJyb2FkY2FzdF9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIF90aGlzMTQuc2hvd19icm9hZGNhc3QoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczE0LnNldHBhZ2luYXRpb24oX3RoaXMxNC5wYWdlX25vKTsKCiAgICAgICAgICAgICAgX3RoaXMxNC5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxNC5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTQuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMTQuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgX3RoaXMxNC5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChfdGhpczE0LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxNC5icm9hZGNhc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5icm9hZGNhc3RzOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxNC5icm9hZGNhc3RfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczE0LnNob3dfYnJvYWRjYXN0KDApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxNC5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIF90aGlzMTQudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgX3RoaXMxNC5zZXRwYWdpbmF0aW9uKDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczE0LmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCA0OyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMyA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTMgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IHBhZ2Vfbm8gKyAzOyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gNDsgX2k1IDwgdGhpcy50b3RhbF9wYWdlczsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTYgPSBwYWdlX25vIC0gMzsgX2k2IDw9IHBhZ2Vfbm8gKyAzOyBfaTYrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k2KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIHNob3dfYnJvYWRjYXN0OiBmdW5jdGlvbiBzaG93X2Jyb2FkY2FzdChpbmRleCkgewogICAgICB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmJyb2FkY2FzdF9saXN0W2luZGV4XSkpOwogICAgICB0aGlzLm9sZF9icm9hZGNhc3RfbmFtZSA9IHRoaXMuY3VycmVudF9icm9hZGNhc3QubmFtZTsKICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdF9oaWdobGlnaHRfbmFtZSA9IHRoaXMuY3VycmVudF9icm9hZGNhc3QubmFtZTsKICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdF9pbmRleCA9IGluZGV4OwogICAgICB0aGlzLmlzRWRpdEJyb2FkY2FzdCA9IGZhbHNlOwogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICB0aGlzLnNlbGVjdF9jdXN0b21lcl9saXN0ID0gW107CiAgICAgICAgdGhpcy5uYW1lID0gIiI7CiAgICAgICAgdGhpcy5vbGRfYnJvYWRjYXN0X25hbWUgPSAiIjsKICAgICAgICB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0ID0ge307CiAgICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdF9oaWdobGlnaHRfbmFtZSA9ICIiOwogICAgICAgIHRoaXMuYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2N1cnJlbnRfdGVtcGxhdGVfYWN0aXZlOiBmdW5jdGlvbiBjaGVja19jdXJyZW50X3RlbXBsYXRlX2FjdGl2ZShpbmRleCkgewogICAgICAvLyBjb25zb2xlLnRhYmxlKGluZGV4LCB0aGlzLmJyb2FkY2FzdF9saXN0W2luZGV4XSwgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdCk7CiAgICAgIGlmIChCb29sZWFuKHRoaXMuYnJvYWRjYXN0X2xpc3RbaW5kZXhdKSA9PT0gdHJ1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmJyb2FkY2FzdF9saXN0W2luZGV4XS5uYW1lID09PSB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0X2hpZ2hsaWdodF9uYW1lID8gImN1cnJlbnQtYWN0aXZlLXRlbXBsYXRlIiA6IG51bGw7CiAgICAgIH0KICAgIH0KICB9Cn07"},null]}