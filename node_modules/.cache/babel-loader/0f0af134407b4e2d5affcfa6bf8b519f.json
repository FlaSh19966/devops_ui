{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappChat.vue","mtime":1659334208864},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubGluayI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBTb2NrZXQsIFByZXNlbmNlIH0gZnJvbSAicGhvZW5peCI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IFZ1ZVBob25lTnVtYmVySW5wdXQgZnJvbSAidnVlLXBob25lLW51bWJlci1pbnB1dCI7CmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJXaGF0c0FwcENoYXQiLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdCwKICAgIFZ1ZVBob25lTnVtYmVySW5wdXQ6IFZ1ZVBob25lTnVtYmVySW5wdXQKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93X3NwaW5uZXI6IGZhbHNlLAogICAgICBoaXN0b3J5OiBbXSwKICAgICAgY29udGFjdF9saXN0OiBbXSwKICAgICAgcGhvbmVubzogbnVsbCwKICAgICAgY3VzdG9tZXJfbmFtZTogIiIsCiAgICAgIGNoYXRfZGV0YWlsczogW10sCiAgICAgIHNlYXJjaF92YWx1ZTogIiIsCiAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHNlc3Npb25fdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgIGluaXRpYWxfbWVzc2FnZV9sb2FkOiBmYWxzZSwKICAgICAgaXNfcHJvZmlsZV9zZXR1cDogZmFsc2UsCiAgICAgIG1lc3NhZ2VfcGFnaW5hdGlvbjogewogICAgICAgIGlzX3Njcm9sbF91cDogZmFsc2UsCiAgICAgICAgcGVyX3BhZ2U6IDUsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMCwKICAgICAgICBwYWdlX3JlY29yZF9mZXRjaGVkOiBbXQogICAgICB9LAogICAgICBpc19wYWdpbmF0ZWRfY2FsbDogZmFsc2UsCiAgICAgIGRlZmF1bHRfd2hhdHNhcHBfc3RhdHVzOiAiSGV5IHRoZXJlISBJIGFtIHVzaW5nIHdoYXRzYXBwIiwKICAgICAgZWRpdF9zdGF0dXM6IGZhbHNlLAogICAgICBzY3JvbGxfc3Bpbm5lcl9jaGF0OiBmYWxzZSwKICAgICAgc2hvd19zZW5kX21lc3NhZ2U6IGZhbHNlLAogICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogZmFsc2UsCiAgICAgIGlzX3Nob3dfbWVzc2FnZV9kaXNhYmxlZDogdHJ1ZSwKICAgICAgd2hhdHNhcHBfcHJvZmlsZTogIiIsCiAgICAgIGVkaXRfZW1haWw6IGZhbHNlLAogICAgICBlZGl0X2FkZHJlc3M6IGZhbHNlLAogICAgICBlZGl0X2Rlc2NyaXB0aW9uOiBmYWxzZSwKICAgICAgZWRpdF93ZWJzaXRlOiBmYWxzZSwKICAgICAgZW1haWxfYWRkcmVzczogIiIsCiAgICAgIGJ1c2luZXNzX2FkZHJlc3M6ICIiLAogICAgICBkZXNjcmlwdGlvbjogIiIsCiAgICAgIHdlYnNpdGVfdXJsOiAiIiwKICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICBjaGFubmVsOiBudWxsLAogICAgICBjaGF0X3NvY2tldDogbnVsbCwKICAgICAgc3VwcG9ydF9jaGFubmVsOiBudWxsLAogICAgICBtZXNzYWdlX3RvX3NlbmQ6IG51bGwsCiAgICAgIHdoYXRzYXBwX3N0YXR1czogIiIsCiAgICAgIGluZGV4X3VwZGF0ZTogbnVsbCwKICAgICAgc2Vjb25kX3dlYnNpdGU6IGZhbHNlLAogICAgICBzZWxlY3RlZF9maWxlczogIiIsCiAgICAgIG1vdXNlX2hvdmVyX3RleHQ6IGZhbHNlLAogICAgICB2ZXJ0aWNhbF90eXBlczogWyJBdXRvbW90aXZlIiwgIkJlYXV0eSIsICJTcGEgYW5kIFNhbG9uIiwgIkNsb3RoaW5nIGFuZCBBcHBhcmVsIiwgIkVkdWNhdGlvbiIsICJFbnRlcnRhaW5tZW50IiwgIkV2ZW50IFBsYW5uaW5nIGFuZCBTZXJ2aWNlIiwgIkZpbmFuY2UgYW5kIEJhbmtpbmciLCAiRm9vZCBhbmQgR3JvY2VyeSIsICJQdWJsaWMgU2VydmljZSIsICJIb3RlbCBhbmQgTG9kZ2luZyIsICJNZWRpY2FsIGFuZCBIZWFsdGgiLCAiTm9uLXByb2ZpdCIsICJQcm9mZXNzaW9uYWwgU2VydmljZXMiLCAiU2hvcHBpbmcgYW5kIFJldGFpbCIsICJUcmF2ZWwgYW5kIFRyYW5zcG9ydGF0aW9uIiwgIlJlc3RhdXJhbnQiLCAiT3RoZXIiXSwKICAgICAgY3VycmVudF9jb250YWN0X251bWJlcjogbnVsbCwKICAgICAgaXNfY29udGFjdF9saXN0OiBmYWxzZSwKICAgICAgY3VycmVudF9jb250YWN0X2luZGV4OiBudWxsLAogICAgICBzZWFyY2hfaW5fY29udGFjdF9saXN0OiAiIiwKICAgICAgYWxsX2NvbnRhY3RfbGlzdDogW10sCiAgICAgIHN0YXJ0X25ld19jb252X2RhdGE6IHsKICAgICAgICBzdGFydF9uZXdfY29udjogZmFsc2UsCiAgICAgICAgaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIGFsbF9jb250YWN0X3BhZ2luYXRpb246IHsKICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMAogICAgICB9LAogICAgICBzZW5kX2F0dGFjaG1lbnRfZGV0YWlsOiB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9LAogICAgICBjdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjOiBudWxsLAogICAgICBhZGRfbmV3X2NvbnRhY3Q6IHsKICAgICAgICBwaG9uZV9udW1iZXI6IG51bGwsCiAgICAgICAgaXNfYWRkX2NvbnRhY3Q6IHRydWUsCiAgICAgICAgY29udGFjdF9uYW1lOiBudWxsLAogICAgICAgIGZvcm1hdHRlZE51bWJlcjogbnVsbAogICAgICB9LAogICAgICBhZGRfbmV3X2NvbnRhY3RfZm9ybWF0dGVkX3Bob25lX251bWJlcjogbnVsbCwKICAgICAgZmlsZV9leHRlbnNpb25zOiB7CiAgICAgICAgYWxsX2FsbG93ZWRfZmlsZV9leHRlbnNpb25zOiBbImltYWdlL3BuZyIsICJpbWFnZS9qcGVnIiwgImFwcGxpY2F0aW9uL3BkZiIsICJ0ZXh0L3BsYWluIiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsICJhcHBsaWNhdGlvbi9tc3dvcmQiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLCAidGV4dC9jc3YiXSwKICAgICAgICBpbWFnZV9maWxlX2V4dGVuc2lvbnM6IFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciXSwKICAgICAgICBkb2N1bWVudF9maWxlX2V4dGVuc2lvbnM6IFsiYXBwbGljYXRpb24vcGRmIiwgInRleHQvcGxhaW4iLCAiYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsIiwgImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50IiwgImFwcGxpY2F0aW9uL21zd29yZCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCIsICJ0ZXh0L2NzdiJdCiAgICAgIH0sCiAgICAgIHdoYXRzYXBwX3RlbXBsYXRlczogewogICAgICAgIHRlbXBsYXRlc19saXN0OiBbXSwKICAgICAgICBwYWdpbmF0aW9uX2RhdGE6IHsKICAgICAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgICAgIHBhZ2Vfbm86IDEsCiAgICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMAogICAgICAgIH0sCiAgICAgICAgc2VsZWN0ZWRfdGVtcGxhdGU6IG51bGwsCiAgICAgICAgcHJldmlld190ZW1wbGF0ZV9kYXRhOiBudWxsCiAgICAgIH0sCiAgICAgIGNvbnRhY3RfY3N2OiB7CiAgICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBGaWxlIiwKICAgICAgICBmaWxlX2NvbnRlbnQ6IG51bGwsCiAgICAgICAgZmlsZV9zZWxlY3RlZDogZmFsc2UKICAgICAgfSwKICAgICAgd2hhdHNhcHBfZm9ybWF0X2RpY3Q6IHsKICAgICAgICAiKiI6IFsiPHN0cm9uZz4iLCAiPC9zdHJvbmc+Il0sCiAgICAgICAgXzogWyI8aT4iLCAiPC9pPiJdLAogICAgICAgICJ+IjogWyI8cz4iLCAiPC9zPiJdLAogICAgICAgICJgYGAiOiBbIjx0dD4iLCAiPC90dD4iXQogICAgICB9LAogICAgICB3aGF0c2FwcF9mb3JtYXRpbmdfbGlzdDogWyIqIiwgIl8iLCAifiIsICJgYGAiXQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB0b3RhbF9wYWdlc19sb2FkZWQ6IGZ1bmN0aW9uIHRvdGFsX3BhZ2VzX2xvYWRlZCgpIHsKICAgICAgaWYgKHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBhZ2Vfbm8gKiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSA+PSB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBtZXNzYWdlX3RleHRfYm94X3BsYWNlaG9sZGVyOiBmdW5jdGlvbiBtZXNzYWdlX3RleHRfYm94X3BsYWNlaG9sZGVyKCkgewogICAgICByZXR1cm4gIlNlbmQgYSBtZXNzYWdlIHRvIHVzZXIiOwogICAgfSwKICAgIHRvdGFsX2NvbnRhY3RfbG9hZGVkOiBmdW5jdGlvbiB0b3RhbF9jb250YWN0X2xvYWRlZCgpIHsKICAgICAgaWYgKHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICogdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBlcl9wYWdlID49IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuZ2V0X2NvbnRhY3RfbGlzdCh0cnVlKTsKICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgdmFyIHZtID0gdGhpczsKICAgICQod2luZG93KS5iaW5kKCJtb3VzZXdoZWVsIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgPj0gMCkgewogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKICAgICAgfQogICAgfSk7IC8vIHZhciBsYXN0U2Nyb2xsVG9wID0gMDsKICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAvLyAgICJzY3JvbGwiLAogICAgLy8gICBmdW5jdGlvbiAoZXYpIHsKICAgIC8vICAgICBpZiAoZXYudGFyZ2V0LmlkID09PSAic2Nyb2xsaW5nLWRpdi13aGF0c2FwcCIpIHsKICAgIC8vICAgICAgIGNvbnNvbGUubG9nKGV2KQogICAgLy8gICAgICAgdmFyIHN0ID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7IC8vIENyZWRpdHM6ICJodHRwczovL2dpdGh1Yi5jb20vcWVyZW15L3NvL2Jsb2IvbWFzdGVyL3NvLmRvbS5qcyNMNDI2IgogICAgLy8gICAgICAgaWYgKHN0ID4gbGFzdFNjcm9sbFRvcCl7CiAgICAvLyAgICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKICAgIC8vICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCJTY3JvbGxpbmcgVXAiKQogICAgLy8gICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGxhc3RTY3JvbGxUb3AgPSBzdCA8PSAwID8gMCA6IHN0OwogICAgLy8gICAgICAgLy8gdm0uc2Nyb2xsUG9zaXRpb24gPSBldi50YXJnZXRbInNjcm9sbFRvcCJdOwogICAgLy8gICAgIH0KICAgIC8vICAgfSwKICAgIC8vICAgdHJ1ZQogICAgLy8gKTsKCiAgICAkKCIjc2hvd0ltYWdlTW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdm0uY3VycmVudF9mdWxsc2NyZWVuX2ltYWdlX3NyYyA9IG51bGw7CiAgICB9KTsKICAgICQoIiNpbXBvcnRDb250YWN0Q1NWTW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdm0uZW1wdHlfdXBsb2FkX2Nzdl9jb250YWN0cygpOwogICAgfSk7CiAgICAkKCdbZGF0YS10b2dnbGU9InBvcG92ZXIiXScpLnBvcG92ZXIoewogICAgICBodG1sOiB0cnVlLAogICAgICB0aXRsZTogIkxlZ2VuZCBmb3IgQ29udGFjdHMiLAogICAgICBjb250ZW50OiAiPHNwYW4gc3R5bGU9J2NvbG9yOiMyNWFmMDI7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+ICBUaGlzIGNvbnRhY3QgaXMgb24gd2hhdHNhcHA8L3NwYW4+IDxicj5cbiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0nY29sb3I6I2ZmNDc0Nztmb250LXNpemU6IGxhcmdlcjsnPiYjeDI1Q0Y7PC9zcGFuPiA8c3Bhbj4gVGhpcyBjb250YWN0IGlzIG5vdCBvbiB3aGF0c2FwcDwvc3Bhbj4gPGJyPlxuICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSdjb2xvcjojZmZjMzQ3O2ZvbnQtc2l6ZTogbGFyZ2VyOyc+JiN4MjVDRjs8L3NwYW4+IDxzcGFuPiBXZSBkb24ndCBrbm93IHlldCB3aGV0aGVyIHRoaXMgY29udGFjdCBpcyBvbiB3aGF0c2FwcDwvc3Bhbj4iCiAgICB9KTsKICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSwgewogICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogIjEwMCIsCiAgICAgIHRlc3Q6IGJ0b2EoInRlc3RfcGFyYW1hdGVyIikKICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKQogICAgICAvLyB0aGlzLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgICAvLyB0aGlzLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAgIC8vIHRoaXMubGl2ZV9jaGF0X29uID0gdHJ1ZTsKICAgICAgX3RoaXMuY2hhdF9zb2NrZXQgPSBuZXcgU29ja2V0KHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwgewogICAgICAgIHBhcmFtczogewogICAgICAgICAgd2hhdHNhcHA6ICJ0cnVlIiwKICAgICAgICAgIGVsaXhpcl90b2tlbjogcmVzcG9uc2UuZGF0YS5lbGl4aXJfdG9rZW4sCiAgICAgICAgICB0b2tlbjogX3RoaXMuc2Vzc2lvbl90b2tlbiwKICAgICAgICAgIHVzZXJuYW1lOiBfdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIF90aGlzLmNoYXRfc29ja2V0LmNvbm5lY3QoKTsKCiAgICAgIF90aGlzLmNoYW5uZWwgPSBfdGhpcy5jaGF0X3NvY2tldC5jaGFubmVsKCJ3aGF0c2FwcDoiICsgX3RoaXMuY29tcGFueV9pZCk7CgogICAgICBfdGhpcy5jaGFubmVsLmpvaW4oKTsKCiAgICAgIF90aGlzLmNoYW5uZWwub24oIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuY29tcGFueV9pZCA9PT0gX3RoaXMuY29tcGFueV9pZCkgewogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzKQogICAgICAgICAgLy8gaWYoIXJlcy5pc19ib3RfY29udmVyc2F0aW9uX3JlYWx0aW1lKXsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJ1c2VyIGJvdCBjb252ZXJzYXRpb24iKQogICAgICAgICAgdmFyIGNvbnRhY3RfaW5kZXggPSBfdGhpcy5jb250YWN0X2xpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLndoYXRzYXBwX3Bob25lX251bWJlciA9PT0gcmVzLndoYXRzYXBwX3Bob25lX251bWJlcjsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghcmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpIHsKICAgICAgICAgICAgLy8gbGV0IGxhdGVzdF9tZXNzYWdlOwogICAgICAgICAgICAvLyBpZihyZXMuaXNfYm90X2NvbnZlcnNhdGlvbl9yZWFsdGltZSl7CiAgICAgICAgICAgIC8vICAgbGV0IGlzX3RleHQgPSAgcmVzLkJPVFJlc3BvbnNlLmZpbmQoKGl0ZW0pID0+IGl0ZW0udGV4dCAhPSBudWxsKSwKICAgICAgICAgICAgLy8gICBpc19wcm9kdWN0ID0gcmVzLkJPVFJlc3BvbnNlLmZpbmQoKGl0ZW0pID0+IChpdGVtLnRleHQgPT0gbnVsbCAmJiBpdGVtLnByb2R1Y3RzKSk7CiAgICAgICAgICAgIC8vICAgaWYoQm9vbGVhbihpc190ZXh0KSkgewogICAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSBpc190ZXh0LnRleHQ7CiAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmKEJvb2xlYW4oaXNfcHJvZHVjdCkpIHsKICAgICAgICAgICAgLy8gICAgIGxhdGVzdF9tZXNzYWdlID0gIlByb2R1Y3QgYm90IHJlc3BvbnNlIgogICAgICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9IG51bGwKICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzLCAiZWxzZSIsIGNvbnRhY3RfaW5kZXgpCiAgICAgICAgICAgIGlmIChjb250YWN0X2luZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSByZXMud2hhdHNhcHBfbWVzc2FnZTsKICAgICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0uaXNfbmV3X25vdGlmaWNhdGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLm5ld19tZXNzYWdlX2NvdW50ID0gMTsKICAgICAgICAgICAgICBfdGhpcy5jb250YWN0X2xpc3QgPSBfdGhpcy5hcnJheV9tb3ZlKF90aGlzLmNvbnRhY3RfbGlzdCwgY29udGFjdF9pbmRleCwgMCk7IC8vIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfdGhpcy5jaGVja19jdXJyZW50X251bWJlcihyZXMpKSB7CiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CiAgICAgICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5oaXN0b3J5LnB1c2goewogICAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogW10sCiAgICAgICAgICAgICAgICAiVXNlclF1ZXJ5IjogcmVzLndoYXRzYXBwX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgICJVc2VyUXVlcnlfRGF0ZVRpbWUiOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBsYXRlc3RfbWVzc2FnZSwKICAgICAgICAgICAgICAgIGlzX3RleHQgPSByZXMuQk9UUmVzcG9uc2UuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLnRleHQgIT0gbnVsbDsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBpc19wcm9kdWN0ID0gcmVzLkJPVFJlc3BvbnNlLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS50ZXh0ID09IG51bGwgJiYgaXRlbS5wcm9kdWN0czsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoQm9vbGVhbihpc190ZXh0KSkgewogICAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gaXNfdGV4dC50ZXh0OwogICAgICAgICAgICB9IGVsc2UgaWYgKEJvb2xlYW4oaXNfcHJvZHVjdCkpIHsKICAgICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9ICJQcm9kdWN0IGJvdCByZXNwb25zZSI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbGF0ZXN0X21lc3NhZ2UgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29udGFjdF9pbmRleCAhPSAtMSkgewogICAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gbGF0ZXN0X21lc3NhZ2U7CiAgICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSB0cnVlOwogICAgICAgICAgICAgIF90aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5uZXdfbWVzc2FnZV9jb3VudCA9IDE7CiAgICAgICAgICAgICAgX3RoaXMuY29udGFjdF9saXN0ID0gX3RoaXMuYXJyYXlfbW92ZShfdGhpcy5jb250YWN0X2xpc3QsIGNvbnRhY3RfaW5kZXgsIDApOyAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleAogICAgICAgICAgICB9CgogICAgICAgICAgICA7CgogICAgICAgICAgICBpZiAoX3RoaXMuY2hlY2tfY3VycmVudF9udW1iZXIocmVzKSkgewogICAgICAgICAgICAgIHZhciBfY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgICBfY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CgogICAgICAgICAgICAgIHZhciBfYm90X3Jlc3BvbnNlX2RhdGUgPSBfY3VycmVudF9kYXRlOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IF9ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgICB9KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX2RhdGUiXSA9IF9ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgICByZXNbImJvdF9yZXNwb25zZV90aW1lIl0gPSBfY3VycmVudF90aW1lc3RhbXA7CiAgICAgICAgICAgICAgcmVzWyJ1c2VyX3F1ZXJ5X2RhdGUiXSA9IF9jdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgcmVzWyJ1c2VyX3F1ZXJ5X3RpbWUiXSA9IF9jdXJyZW50X3RpbWVzdGFtcDsKCiAgICAgICAgICAgICAgX3RoaXMuaGlzdG9yeS5wdXNoKHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5zY3JvbGxfZG93bigpOyAvLyB9IGVsc2UgewogICAgICAgICAgLy8gICBjb25zb2xlLmxvZygicmVhbHRpbWUgY29udmVyc2F0aW9uIikKICAgICAgICAgIC8vIH0KCiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF92YWx1ZTogZnVuY3Rpb24gc2VhcmNoX3ZhbHVlKG5ld1ZhbHVlKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgIGlzX2dldF9jb250YWN0czogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vIGNvbnRhY3RzIGZvdW5kIiB8fCByZXNwb25zZS5kYXRhID09ICJEYXRhIG5vdCBmb3VuZCIpIHsKICAgICAgICAgICAgX3RoaXMyLmNvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyLmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2V0X2NvbnRhY3RfbGlzdChmYWxzZSk7CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfaW5fY29udGFjdF9saXN0OiBmdW5jdGlvbiBzZWFyY2hfaW5fY29udGFjdF9saXN0KG5ld1ZhbHVlKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJObyBjb250YWN0cyBmb3VuZCIpIHsKICAgICAgICAgICAgX3RoaXMzLmFsbF9jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMy5hbGxfY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5jb250YWN0czsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICB9CiAgICB9LAogICAgIndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSI6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgICBpZiAoQm9vbGVhbihuZXdWYWwpKSB7CiAgICAgICAgICB2YXIgY3VycmVudF90ZW1wbGF0ZSA9IHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0LmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGVtcGxhdGVfaWQgPT0gbmV3VmFsOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdGVtcGxhdGVfaWQgPSBuZXdWYWw7CiAgICAgICAgICB2YXIgdmFyaWFibGVfZGljdCA9IGN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfZGljdDsKICAgICAgICAgIHZhciBpc19wYXJlbnRfdGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19ub3RpZmljYXRpb246IGZhbHNlLAogICAgICAgICAgICBpc19wcmV2aWV3OiB0cnVlLAogICAgICAgICAgICBpc19wYXJlbnRfdGVtcGxhdGU6IGlzX3BhcmVudF90ZW1wbGF0ZSwKICAgICAgICAgICAgdGVtcGxhdGVfaWQ6IHRlbXBsYXRlX2lkLAogICAgICAgICAgICB2YXJpYWJsZV9kaWN0OiB2YXJpYWJsZV9kaWN0CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgX3RoaXM0LndoYXRzYXBwX3RlbXBsYXRlcy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEgPSByZXNwb25zZS5kYXRhLmJvZHk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIHRoaXMuaGlzdG9yeSA9IFtdLCB0aGlzLnBob25lbm8gPSBudWxsOwogICAgICB0aGlzLmN1c3RvbWVyX25hbWUgPSAiIjsKICAgICAgdGhpcy5jaGF0X2RldGFpbHMgPSBbXTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UgPSA1OwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vID0gMTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkID0gW107CiAgICAgIHRoaXMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBudWxsOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UgPSAxMDsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9OwogICAgfSwKICAgIGdldF9oaXN0b3J5X2RhdGE6IGZ1bmN0aW9uIGdldF9oaXN0b3J5X2RhdGEod2hhdHNhcHBfbm8sIHVzZXJfbmFtZSwgY29udGFjdF9pbmRleCwgY29udGFjdCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICB0aGlzLmN1c3RvbWVyX25hbWUgPSB0aGlzLmdldF9jb250YWN0X2Rpc3BsYXlfbmFtZShjb250YWN0KTsgLy8gdGhpcy5jdXN0b21lcl9uYW1lID0gdXNlcl9uYW1lOwoKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID0gd2hhdHNhcHBfbm87CiAgICAgIHRoaXMuc2hvd19zZW5kX21lc3NhZ2UgPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBjb250YWN0X2luZGV4OwogICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogd2hhdHNhcHBfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgIHBhZ2Vfbm86IDEKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNS5zaG93X3NlbmRfbWVzc2FnZSA9IHRydWU7CiAgICAgICAgX3RoaXM1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiRGF0YSBub3QgZm91bmQiKSB7CiAgICAgICAgICAgIF90aGlzNS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXM1Lm5ld19jb252X2NvbnRhY3RfZGF0YSA9IGNvbnRhY3Q7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczUuaGlzdG9yeSA9IF90aGlzNS5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmNoYXRfaGlzdG9yeSk7CiAgICAgICAgICAgIF90aGlzNS5waG9uZW5vID0gcmVzcG9uc2UuZGF0YS53aGF0c2FwcF9waG9uZV9udW1iZXIgfHwgd2hhdHNhcHBfbm87IC8vIGNvbnNvbGUubG9nKHRoaXMucGhvbmVubywgdGhpcy5jb250YWN0X2xpc3QpOwoKICAgICAgICAgICAgdmFyIGNvbnRhY3RfbGlzdF9pbmRleCA9IF90aGlzNS5jb250YWN0X2xpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ud2hhdHNhcHBfcGhvbmVfbnVtYmVyID09IF90aGlzNS5waG9uZW5vOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChjb250YWN0X2xpc3RfaW5kZXggPj0gMSkgewogICAgICAgICAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2xpc3RfaW5kZXgsIDApOwogICAgICAgICAgICAgIF90aGlzNS5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBjb250YWN0X2xpc3RfaW5kZXg7CiAgICAgICAgICAgICAgX3RoaXM1LmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSBfdGhpczUucGhvbmVubzsgLy8gdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9saXN0X2luZGV4XS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczUubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnRvdGFsX2NoYXRfaGlzdG9yeTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNjcm9sbF9kb3duKCk7CgogICAgICAgICAgICAgIF90aGlzNS5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgICAgICAgICAgX3RoaXM1Lm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSB0cnVlOwoKICAgICAgICAgICAgICBfdGhpczUuY2hhdFNjcm9sbE1lc3NhZ2VzKHRydWUpOwogICAgICAgICAgICB9LCA0MDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczUuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0X2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gZ2V0X2NvbnRhY3RfbGlzdChlbmFibGVfYm90X3Jlc3BvbnNlcykgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgaXNfZ2V0X2NvbnRhY3RzOiB0cnVlLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGVuYWJsZV9ib3RfcmVzcG9uc2VfYWxsOiBlbmFibGVfYm90X3Jlc3BvbnNlcwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vIGNvbnRhY3RzIGZvdW5kIiB8fCByZXNwb25zZS5kYXRhID09ICJEYXRhIG5vdCBmb3VuZCIpIHsKICAgICAgICAgIF90aGlzNi5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM2LmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgfQoKICAgICAgICBfdGhpczYuc2hvd19zcGlubmVyID0gZmFsc2U7IC8vIHRoaXMuY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5jb250YWN0czsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczYuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2Nyb2xsX2Rvd246IGZ1bmN0aW9uIHNjcm9sbF9kb3duKCkgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm1lc3NhZ2UtdGFibGUtc2Nyb2xsIik7IC8vIGNvbnNvbGUubG9nKGNvbnRhaW5lcik7CgogICAgICBpZiAoQm9vbGVhbihjb250YWluZXIpKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodDsKICAgICAgICB9LCAxMDApOyAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIHNjcm9sbF9kb3duX2VmZmVjdDogZnVuY3Rpb24gc2Nyb2xsX2Rvd25fZWZmZWN0KCkgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm1lc3NhZ2UtdGFibGUtc2Nyb2xsIik7IC8vIGNvbnNvbGUubG9nKGNvbnRhaW5lcik7CgogICAgICBpZiAoQm9vbGVhbihjb250YWluZXIpKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gMTA7CiAgICAgICAgfSwgMCk7IC8vIHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgcHJvZHVjdF92YXJpYXRpb246IGZ1bmN0aW9uIHByb2R1Y3RfdmFyaWF0aW9uKHByb2R1Y3RzX2xpc3QpIHsKICAgICAgdmFyIG5ld19wcm9kdWN0X2xpc3QgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgaW4gcHJvZHVjdHNfbGlzdCkgewogICAgICAgIHZhciBjb21wb25lbnRzID0gcHJvZHVjdHNfbGlzdFtpXS50ZW1wbGF0ZS5jb21wb25lbnRzOwogICAgICAgIHZhciB0ZW1wID0ge307CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKHZhciBqIGluIGNvbXBvbmVudHMpIHsKICAgICAgICAgICAgaWYgKGogPT0gMCkgewogICAgICAgICAgICAgIHRlbXBbImltZ191cmwiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS5pbWFnZS5saW5rOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaiA9PSAxKSB7CiAgICAgICAgICAgICAgdGVtcFsidGl0bGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS50ZXh0OwoKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICB0ZW1wWyJwcmljZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7CiAgICAgICAgICAgICAgICB0ZW1wWyJ2YXJpYXRpb24iXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1sxXS50ZXh0OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgdGVtcFsidmFyaWF0aW9uIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsKICAgICAgICAgICAgICAgIHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMl0udGV4dDsKICAgICAgICAgICAgICB9IC8vIGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy5sZW5ndGggPT0gMyA/IHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7IHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDogbnVsbDsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChqID09IDIpIHsKICAgICAgICAgICAgICB0ZW1wWyJ1cmwiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS50ZXh0OwogICAgICAgICAgICAgIHRlbXBbInR5cGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy50eXBlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGRlYnVnZ2VyOwogICAgICAgIH0KCiAgICAgICAgbmV3X3Byb2R1Y3RfbGlzdC5wdXNoKHRlbXApOwogICAgICB9CgogICAgICByZXR1cm4gbmV3X3Byb2R1Y3RfbGlzdDsKICAgIH0sCiAgICBjaGVja19pbWFnZV90eXBlOiBmdW5jdGlvbiBjaGVja19pbWFnZV90eXBlKGltYWdlKSB7CiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGltYWdlICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBpbWFnZS5zcmM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB0cmltX2NhcmRfZGVzY3JpcHRpb246IGZ1bmN0aW9uIHRyaW1fY2FyZF9kZXNjcmlwdGlvbih0ZXh0KSB7CiAgICAgIGlmIChCb29sZWFuKHRleHQpKSB7CiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwKSB7CiAgICAgICAgICB2YXIgc3RyaW5nX3RleHQgPSB0ZXh0LnN1YnN0cmluZygwLCA4MCkgKyAiLi4uIjsKICAgICAgICAgIHJldHVybiBzdHJpbmdfdGV4dDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZXh0OwogICAgICB9CiAgICB9LAogICAgbGF0ZXN0X2JvdF90ZXh0OiBmdW5jdGlvbiBsYXRlc3RfYm90X3RleHQodGV4dCkgewogICAgICBpZiAoIUJvb2xlYW4odGV4dCkpIHsKICAgICAgICByZXR1cm4gIkN1c3RvbSBib3QgUmVzcG9uc2UiOwogICAgICB9CgogICAgICBpZiAodGV4dC5sZW5ndGggPiAzNSkgewogICAgICAgIHJldHVybiAiIi5jb25jYXQodGV4dC5zdWJzdHJpbmcoMCwgMzUpLCAiLi4uIik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0ZXh0OwogICAgfSwKICAgIHNlYXJjaF9jb250YWN0X2xpc3Q6IGZ1bmN0aW9uIHNlYXJjaF9jb250YWN0X2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX3ZhbHVlID09ICIiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFjdF9saXN0OwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBuZXdfdmFsID0gdGhpcy5zZWFyY2hfdmFsdWU7CgogICAgICAgIGlmIChuZXdfdmFsICE9IHRoaXMuc2VhcmNoX3ZhbHVlKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlYXJjaF92YWx1ZSk7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF9zdHJpbmc6IHRoaXMuc2VhcmNoX3ZhbHVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczcuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzNy5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RfbGlzdDsKICAgICAgfQogICAgfSwKICAgIGNoYXRTY3JvbGxNZXNzYWdlczogZnVuY3Rpb24gY2hhdFNjcm9sbE1lc3NhZ2VzKHNjcm9sbF9kb3duKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCk7CiAgICAgIGlmICh0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIm1lc3NhZ2UtdGFibGUtc2Nyb2xsIilbMF0uc2Nyb2xsVG9wOwoKICAgICAgICBpZiAoY29udGFpbmVyX2Rpdl9zY3JvbGxfdG9wIDwgNTAgJiYgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID09PSB0cnVlICYmICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICYmICF0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCkgewogICAgICAgICAgLy8gY29uc29sZS5sb2coImFwaSBjYWxsIHBhZ2luYXRlZCIpCiAgICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vICsgMQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIF90aGlzOC5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzOC5pc19wYWdpbmF0ZWRfY2FsbCA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKCFfdGhpczgubWVzc2FnZV9wYWdpbmF0aW9uLnBhZ2VfcmVjb3JkX2ZldGNoZWQuaW5jbHVkZXMocmVzcG9uc2UuZGF0YS5wYWdlX25vKSkgewogICAgICAgICAgICAgIHZhciBuZXdfZGF0YSA9IF90aGlzOC5mb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZS5kYXRhLmNoYXRfaGlzdG9yeSk7CgogICAgICAgICAgICAgIF90aGlzOC5oaXN0b3J5ID0gbmV3X2RhdGEuY29uY2F0KF90aGlzOC5oaXN0b3J5KTsKCiAgICAgICAgICAgICAgX3RoaXM4Lm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLnB1c2gocmVzcG9uc2UuZGF0YS5wYWdlX25vKTsgLy8gY29uc29sZS5sb2codGhpcy5oaXN0b3J5KTsKCgogICAgICAgICAgICAgIF90aGlzOC5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyArPSAxOwoKICAgICAgICAgICAgICBpZiAoc2Nyb2xsX2Rvd24gPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsvLyB0aGlzLnNjcm9sbF9kb3duX2VmZmVjdCgpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNob3dfcHJvZmlsZV9zZXR1cDogZnVuY3Rpb24gc2hvd19wcm9maWxlX3NldHVwKCkgewogICAgICB0aGlzLmlzX3Byb2ZpbGVfc2V0dXAgPSAhdGhpcy5pc19wcm9maWxlX3NldHVwOwogICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgIH0sCiAgICBzaG93X2FsbF9jb250YWN0czogZnVuY3Rpb24gc2hvd19hbGxfY29udGFjdHMoKSB7CiAgICAgIHRoaXMuaXNfcHJvZmlsZV9zZXR1cCA9ICF0aGlzLmlzX3Byb2ZpbGVfc2V0dXA7CiAgICAgIHRoaXMuaXNfY29udGFjdF9saXN0ID0gIXRoaXMuaXNfY29udGFjdF9saXN0OwogICAgICB0aGlzLmdldF9hbGxfY29udGFjdF9saXN0KCk7CiAgICB9LAogICAgZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2U6IGZ1bmN0aW9uIGZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlKSB7CiAgICAgIHZhciBjb25fZGF0ZSA9ICIiOwoKICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZSkgewogICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgIGNvbl9kYXRlID0gcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29uX2RhdGUgPT0gcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGUgJiYgaSAhPSAwKSB7CiAgICAgICAgICByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25fZGF0ZSA9IHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgfSwKICAgIHNlbmRfbWVzc2FnZV90b191c2VyOiBmdW5jdGlvbiBzZW5kX21lc3NhZ2VfdG9fdXNlcigpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAoQm9vbGVhbih0aGlzLm1lc3NhZ2VfdG9fc2VuZCkgPT09IGZhbHNlICYmIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgdmFyIGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwoKICAgICAgaWYgKHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5jb21wYW55X2lkID0gdGhpcy5jb21wYW55X2lkOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5jb21wYW55X25hbWUgPSB0aGlzLmNvbXBhbnlfbmFtZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwud2hhdHNhcHBfY29udGFjdF9udW1iZXIgPSB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXI7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmRvY3VtZW50X2NvbnRlbnQgPSBudWxsOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jYXB0aW9uID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzOS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiV2hhdHNhcHAgbWVkaWEgc2VudCBzdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIHZhciBib3RfcmVzcG9uc2UgPSBbXTsKCiAgICAgICAgICAgIGlmIChfdGhpczkuZmlsZV9leHRlbnNpb25zLmltYWdlX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcyhfdGhpczkuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUpKSB7CiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlID0gW3sKICAgICAgICAgICAgICAgIHRleHQ6IG51bGwsCiAgICAgICAgICAgICAgICByZWNpcGllbnRfaWQ6IF90aGlzOS5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgaW1hZ2U6IHsKICAgICAgICAgICAgICAgICAgY2FwdGlvbjogX3RoaXM5Lm1lc3NhZ2VfdG9fc2VuZCwKICAgICAgICAgICAgICAgICAgbGluazogcmVzcG9uc2UuZGF0YS5maWxlX2xpbmsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzOS5maWxlX2V4dGVuc2lvbnMuZG9jdW1lbnRfZmlsZV9leHRlbnNpb25zLmluY2x1ZGVzKF90aGlzOS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZSkpIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2UgPSBbewogICAgICAgICAgICAgICAgdGV4dDogbnVsbCwKICAgICAgICAgICAgICAgIHJlY2lwaWVudF9pZDogX3RoaXM5LmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICAgICBpbWFnZTogImh0dHBzOi8vc3RvcmFnZS5jZW5zZS5haS8iLmNvbmNhdChfdGhpczkuY29tcGFueV9pZCwgIi9XaGF0c2FwcE1lZGlhLyIpLmNvbmNhdChfdGhpczkuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUpCiAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKCiAgICAgICAgICAgIGlmIChfdGhpczkuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzOS5oaXN0b3J5LnB1c2goewogICAgICAgICAgICAgIEJPVFJlc3BvbnNlOiBib3RfcmVzcG9uc2UsCiAgICAgICAgICAgICAgdXNlcl9xdWVyeV90aW1lOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICBVc2VyUXVlcnk6ICIiLAogICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfdGltZTogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgdXNlcl9xdWVyeV9kYXRlOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgQ2hhdF9EYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzOS5zY3JvbGxfZG93bigpOwoKICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdFtfdGhpczkuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gX3RoaXM5Lm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdCA9IF90aGlzOS5hcnJheV9tb3ZlKF90aGlzOS5jb250YWN0X2xpc3QsIF90aGlzOS5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgICBfdGhpczkubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgICAgICAgX3RoaXM5LmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgIF90aGlzOS5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJUaWVyIHNwZWNpZmljIHVzZXIgbGltaXQgcmVhY2hlZCIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzOS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiV2hhdHNhcHAgbWVkaWEgc2VuZCBmYWlsdXJlIikgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdHJ5IGFnYWluIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIpIHsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogX3RoaXM5LnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZyIpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzOS50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZyIpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczkuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgbmFtZTogIlNldHRpbmdzIiwKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKCgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgc2VuZF9tZXNzYWdlOiB0cnVlLAogICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLAogICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIldoYXRzYXBwIG1lc3NhZ2Ugc2VudCBzdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBpZiAoX3RoaXM5LnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYpIHsKICAgICAgICAgICAgX3RoaXM5LmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgIF90aGlzOS5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgIF90aGlzOS5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICBfdGhpczkubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgIHRleHQ6IF90aGlzOS5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICBkYXRlOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgdGltZTogIiIuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCksICI6IikuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ01pbnV0ZXMoKSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIF90aGlzOS5jb250YWN0X2xpc3QudW5zaGlmdChfdGhpczkubmV3X2NvbnZfY29udGFjdF9kYXRhKTsKCiAgICAgICAgICAgIF90aGlzOS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgIGlmIChfdGhpczkuaGlzdG9yeS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgICB9KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXM5Lmhpc3RvcnkucHVzaCh7CiAgICAgICAgICAgIEJPVFJlc3BvbnNlOiBbewogICAgICAgICAgICAgIHRleHQ6IF90aGlzOS5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgcmVjaXBpZW50X2lkOiBfdGhpczkuY3VycmVudF9jb250YWN0X251bWJlcgogICAgICAgICAgICB9XSwKICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAiVXNlclF1ZXJ5IjogIiIsCiAgICAgICAgICAgICJib3RfcmVzcG9uc2VfZGF0ZSI6IGJvdF9yZXNwb25zZV9kYXRlLAogICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgIkNoYXRfRGF0ZXRpbWUiOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczkuc2Nyb2xsX2Rvd24oKTsKCiAgICAgICAgICBfdGhpczkuY29udGFjdF9saXN0W190aGlzOS5jdXJyZW50X2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSBfdGhpczkubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgX3RoaXM5LmNvbnRhY3RfbGlzdCA9IF90aGlzOS5hcnJheV9tb3ZlKF90aGlzOS5jb250YWN0X2xpc3QsIF90aGlzOS5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgX3RoaXM5Lm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgICAgICBfdGhpczkuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAiVGllciBzcGVjaWZpYyB1c2VyIGxpbWl0IHJlYWNoZWQiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzOS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF90aGlzOS50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2ciKSwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX3RoaXM5LnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnIiksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczkuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczkuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogIk9vcHMiLAogICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZWRpdF93ZWJzaXRlX3ZhbHVlOiBmdW5jdGlvbiBlZGl0X3dlYnNpdGVfdmFsdWUoaW5kZXgpIHsKICAgICAgdGhpcy5pbmRleF91cGRhdGUgPSBpbmRleDsKICAgICAgdGhpcy5lZGl0X3dlYnNpdGUgPSB0cnVlOwogICAgfSwKICAgIGdldF9wcm9maWxlX2RldGFpbHM6IGZ1bmN0aW9uIGdldF9wcm9maWxlX2RldGFpbHMoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9hZGRyZXNzID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9kZXNjcmlwdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfd2Vic2l0ZSA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfc3RhdHVzID0gZmFsc2U7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gbnVsbDsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczEwLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIF90aGlzMTAud2hhdHNhcHBfcHJvZmlsZSA9IHJlc3BvbnNlLmRhdGEud2hhdHNhcHBfcHJvZmlsZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczEwLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVfcHJvZmlsZV9kZXRhaWxzOiBmdW5jdGlvbiB1cGRhdGVfcHJvZmlsZV9kZXRhaWxzKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICB0aGlzLmVkaXRfZW1haWwgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X2FkZHJlc3MgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X2Rlc2NyaXB0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF93ZWJzaXRlID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9zdGF0dXMgPSBmYWxzZTsKICAgICAgdGhpcy5pbmRleF91cGRhdGUgPSBudWxsOwoKICAgICAgaWYgKHRoaXMud2hhdHNhcHBfcHJvZmlsZS53ZWJzaXRlcy5sZW5ndGggPT0gMikgewogICAgICAgIHRoaXMuc2Vjb25kX3dlYnNpdGUgPSB0cnVlOwogICAgICB9CgogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3Byb2ZpbGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgd2hhdHNhcHBfcHJvZmlsZTogdGhpcy53aGF0c2FwcF9wcm9maWxlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczExLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIHZhciByZXNwID0gcmVzcG9uc2UuZGF0YS51cGRhdGVfcmVzcG9uc2U7CgogICAgICAgIGlmIChyZXNwID09ICJlZGl0IHN1Y2Nlc3NmdWwiKSB7CiAgICAgICAgICBfdGhpczExLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50cmUgdmFsaWQgZGF0YSIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczExLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczExLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlX3Byb2ZpbGVfaW1hZ2U6IGZ1bmN0aW9uIHVwZGF0ZV9wcm9maWxlX2ltYWdlKGUpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcyA9IGUudGFyZ2V0LmZpbGVzWzBdOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfZmlsZXMudHlwZSA9PSAiaW1hZ2UvcG5nIiB8fCB0aGlzLnNlbGVjdGVkX2ZpbGVzLnR5cGUgPT0gImltYWdlL2pwZyIgfHwgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ZpbGVzLnNpemUgPiA1MDk3MTUyKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNpemUgc2hvdWxkIGJlIGxlc3MgdGhhbiA1TUIiLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ZpbGVzID0gIiI7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZmlsZV90b191cGxvYWQgPSB0aGlzLnNlbGVjdGVkX2ZpbGVzOwogICAgICAgIHZhciBwcm9maWxlX2ltZyA9IHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBwaG90bzogZmlsZV90b191cGxvYWQsCiAgICAgICAgICB3YV9waG9uZV9udW1iZXI6IHRoaXMud2hhdHNhcHBfcHJvZmlsZS53aGF0c2FwcF9waG9uZV9udW1iZXIKICAgICAgICB9OwogICAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkocHJvZmlsZV9pbWcpOwogICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7CiAgICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICB9KTsKICAgICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBmZC5hcHBlbmQoInBob3RvIiwgdGhpcy5zZWxlY3RlZF9maWxlcyk7CiAgICAgICAgZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3Byb2ZpbGUoKSwgZmQsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHZhciByZXNwID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgICBpZiAocmVzcCA9PSAiUGhvdG8gdXBkYXRpbmcgc3VjY2Vzc2Z1bCIpIHsKICAgICAgICAgICAgX3RoaXMxMi5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3AgPT0gIlBob3RvIHVwZGF0aW5nIHVuc3VjY2Vzc2Z1bCIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQsIHBsZWFzZSB0cnkgYWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwID09ICJQbGVhc2UgdXBsb2FkIEpQRyBpbWFnZSBvZiByZXNvbHV0aW9uIGdyZWF0ZXIgdGhhbiAxOTIgcGl4ZWwgKiAxOTIgcGl4ZWwiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdXBsb2FkIEpQRyBpbWFnZSBvZiByZXNvbHV0aW9uIGdyZWF0ZXIgdGhhbiAxOTIgcGl4ZWwgKiAxOTIgcGl4ZWwiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3AgPT0gIkNhbm5vdCB1cGRhdGUgcGhvdG8geWV0IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZCwgcGxlYXNlIHRyeSBhZ2FpbiEiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3AgPT0gIkNhbm5vdCB1cGRhdGUgcGhvdG8geWV0IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiWW91IGNhbm5vdCB1cGRhdGUgdGhlIHByb2ZpbGUgcGljdHVyZSB5ZXQsIHBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTIuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxMi5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgX3RoaXMxMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzcGVjaWZpYyBmb3JtYXRlKGpwZyBqcGVnIHBuZykiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZW1vdmVfcHJvZmlsZV9pbWFnZTogZnVuY3Rpb24gcmVtb3ZlX3Byb2ZpbGVfaW1hZ2UoKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfcmVtb3ZlX3Bob3RvOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczEzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gIlBob3RvIHJlbW92ZWQiKSB7CiAgICAgICAgICBfdGhpczEzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09PSAiUGhvdG8gcmVtb3ZhbCB1bnN1Y2Nlc3NmdWwiKSB7CiAgICAgICAgICBfdGhpczEzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY29ubmVjdF9lbGl4aXJfc29ja2V0OiBmdW5jdGlvbiBjb25uZWN0X2VsaXhpcl9zb2NrZXQoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6ICIxMDAiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgICAgLy8gdGhpcy5jaGF0X2dyb3VwX25hbWUgPSByZXNwb25zZS5kYXRhLmNoYXRfZ3JvdXBfbmFtZTsKICAgICAgICAvLyB0aGlzLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAgICAgLy8gdGhpcy5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgICAgIF90aGlzMTQuY2hhdF9zb2NrZXQgPSBuZXcgU29ja2V0KHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwgewogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIHdoYXRzYXBwOiAidHJ1ZSIsCiAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5kYXRhLnRva2VuCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMTQuY2hhdF9zb2NrZXQuY29ubmVjdCgpOwoKICAgICAgICBfdGhpczE0LmNoYW5uZWwgPSBfdGhpczE0LmNoYXRfc29ja2V0LmNoYW5uZWwoIndoYXRzYXBwOiIgKyByZXNwb25zZS5kYXRhLndoYXRzYXBwX3RvcGljKTsKCiAgICAgICAgX3RoaXMxNC5jaGFubmVsLmpvaW4oKTsKCiAgICAgICAgX3RoaXMxNC5jaGFubmVsLm9uKCJuZXdfd2hhdHNhcHBfbWVzc2FnZSIsIGZ1bmN0aW9uIChyZXMpIHsvLyBjb25zb2xlLmxvZygibmV3X3doYXRzYXBwX21lc3NhZ2UiLCByZXMpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVuYWJsZV9zZW5kaW5nX21lc3NhZ2VzX2Zvcl91c2VyOiBmdW5jdGlvbiBlbmFibGVfc2VuZGluZ19tZXNzYWdlc19mb3JfdXNlcigpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgdXBkYXRlX2JvdF9yZXNwb25zZTogdHJ1ZSwKICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgIGJvdF9yZXNwb25zZTogZmFsc2UsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgaWYgKF90aGlzMTUuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczE1LnN0YXJ0X25ld19jb252X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxNS5jb250YWN0X2xpc3RbX3RoaXMxNS5jdXJyZW50X2NvbnRhY3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIF90aGlzMTUuJHNldChfdGhpczE1LmNvbnRhY3RfbGlzdCwgX3RoaXMxNS5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIF90aGlzMTUuY29udGFjdF9saXN0W190aGlzMTUuY3VycmVudF9jb250YWN0X2luZGV4XSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgey8vIHRoaXMuJHJlZnNbIm1lc3NhZ2Vfc2VuZGluZ190ZXh0Ym94Il0uZm9jdXMoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICJGYWlsdXJlIikge30gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICJFcnJvciIpIHt9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczE1LnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZyIpLAogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczE1LnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnIiksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczE1LiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiU2V0dGluZ3MiLAogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGV4cGFuZF90ZXh0Ym94OiBmdW5jdGlvbiBleHBhbmRfdGV4dGJveChpZCwga2V5KSB7CiAgICAgIGlmIChpZCAhPSAiI2J1c2luZXNzX2FkZHJlc3MiKSB7CiAgICAgICAgdGhpcy5jYWxsc2VhcmNoKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTsKICAgICAgICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgc2Nyb2xsX2hlaWdodCA9IGUudGFyZ2V0LnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gIiIuY29uY2F0KHNjcm9sbF9oZWlnaHQsICJweCIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTApOwogICAgICB9CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmICFldmVudC5zaGlmdEtleSkgewogICAgICAgIHRoaXMudXBkYXRlX3Byb2ZpbGVfZGV0YWlscygpOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfY3VycmVudF9udW1iZXI6IGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnRfbnVtYmVyKHJlcykgewogICAgICByZXR1cm4gcmVzLndoYXRzYXBwX3Bob25lX251bWJlciA9PT0gdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID8gdHJ1ZSA6IGZhbHNlOwogICAgfSwKICAgIGZvcm1hdF91c2VyX3F1ZXJ5X2RhdGU6IGZ1bmN0aW9uIGZvcm1hdF91c2VyX3F1ZXJ5X2RhdGUodXNlcl9xdWVyeV9kYXRlLCBpbmRleCkgewogICAgICAvLyBjb25zb2xlLmxvZyhPYmplY3Qua2V5cyh0aGlzLmhpc3RvcnlbaW5kZXgtMV0pKQogICAgICBpZiAodGhpcy5oaXN0b3J5W2luZGV4IC0gMV0udXNlcl9xdWVyeV9kYXRlID09IHVzZXJfcXVlcnlfZGF0ZSkgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQoKICAgICAgcmV0dXJuIHVzZXJfcXVlcnlfZGF0ZTsKICAgIH0sCiAgICBnZXRfYWxsX2NvbnRhY3RfbGlzdDogZnVuY3Rpb24gZ2V0X2FsbF9jb250YWN0X2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB7CiAgICAgICAgaXNfZ2V0X2FsbF9jb250YWN0czogdHJ1ZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICBfdGhpczE2LmFsbF9jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmNvbnRhY3RzOwogICAgICAgIF90aGlzMTYuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS50b3RhbF9jb250YWN0czsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE2LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBuZXdfY29udGFjdF9saXN0OiBmdW5jdGlvbiBuZXdfY29udGFjdF9saXN0KCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICB2YXIgc2Nyb2xsZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJhbGwtY29udGFjdC1saXN0IilbMF0uc2Nyb2xsVG9wOwoKICAgICAgaWYgKHNjcm9sbGVyID4gMTIwICYmICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICYmICF0aGlzLnRvdGFsX2NvbnRhY3RfbG9hZGVkKSB7CiAgICAgICAgdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHsKICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICsgMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxNy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICBfdGhpczE3LmlzX3BhZ2luYXRlZF9jYWxsID0gZmFsc2U7CiAgICAgICAgICBfdGhpczE3LmFsbF9jb250YWN0X2xpc3QgPSBfdGhpczE3LmFsbF9jb250YWN0X2xpc3QuY29uY2F0KHJlc3BvbnNlLmRhdGEuY29udGFjdHMpOwogICAgICAgICAgX3RoaXMxNy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gKz0gMTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxNy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhcnJheV9tb3ZlOiBmdW5jdGlvbiBhcnJheV9tb3ZlKGFyciwgb2xkX2luZGV4LCBuZXdfaW5kZXgpIHsKICAgICAgaWYgKG5ld19pbmRleCA+PSBhcnIubGVuZ3RoKSB7CiAgICAgICAgdmFyIGsgPSBuZXdfaW5kZXggLSBhcnIubGVuZ3RoICsgMTsKCiAgICAgICAgd2hpbGUgKGstLSkgewogICAgICAgICAgYXJyLnB1c2godW5kZWZpbmVkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGFyci5zcGxpY2UobmV3X2luZGV4LCAwLCBhcnIuc3BsaWNlKG9sZF9pbmRleCwgMSlbMF0pOwogICAgICByZXR1cm4gYXJyOyAvLyBmb3IgdGVzdGluZwogICAgfSwKICAgIGZvcm1hdFVzZXJRdWVyeVRpbWU6IGZ1bmN0aW9uIGZvcm1hdFVzZXJRdWVyeVRpbWUodXNlcl9xdWVyeV90aW1lKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZSh1c2VyX3F1ZXJ5X3RpbWUpLnRvTG9jYWxlVGltZVN0cmluZyhuYXZpZ2F0b3IubGFuZ3VhZ2UsIHsKICAgICAgICBob3VyOiAiMi1kaWdpdCIsCiAgICAgICAgbWludXRlOiAiMi1kaWdpdCIKICAgICAgfSk7IC8vIHJldHVybiB1c2VyX3F1ZXJ5X3RpbWUKICAgIH0sCiAgICBpc19hY3RpdmVfY2hhdDogZnVuY3Rpb24gaXNfYWN0aXZlX2NoYXQoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09PSB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCkgewogICAgICAgIHJldHVybiAiYmFja2dyb3VuZDogI2YwZjhmZiI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb250YWN0X2xpc3RbaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gfHwgZmFsc2UpIHsKICAgICAgICByZXR1cm4gImJhY2tncm91bmQ6ICM0N2E4ODQzMyI7CiAgICAgIH0KCiAgICAgIHJldHVybiAiYmFja2dyb3VuZDogI2ZmZmZmZiI7CiAgICB9LAogICAgZm9ybWF0Q29udGFjdExhc3RNZXNzYWdlRGF0ZTogZnVuY3Rpb24gZm9ybWF0Q29udGFjdExhc3RNZXNzYWdlRGF0ZShkYXRlLCB0aW1lKSB7CiAgICAgIGlmIChtb21lbnQoZGF0ZSkuaXNTYW1lKERhdGUubm93KCksICJkYXkiKSkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZSgiIi5jb25jYXQoZGF0ZSwgIiAiKS5jb25jYXQodGltZSwgIloiKSkudG9Mb2NhbGVUaW1lU3RyaW5nKG5hdmlnYXRvci5sYW5ndWFnZSwgewogICAgICAgICAgaG91cjogIjItZGlnaXQiLAogICAgICAgICAgbWludXRlOiAiMi1kaWdpdCIKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRhdGU7CiAgICB9LAogICAgY2hlY2tfcHJldmlvdXNfbWVzc2FnZV9kYXRlX3NhbWU6IGZ1bmN0aW9uIGNoZWNrX3ByZXZpb3VzX21lc3NhZ2VfZGF0ZV9zYW1lKGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGluZGV4KQogICAgICByZXR1cm4gdHJ1ZTsgLy8gaWYoaW5kZXggPT0gMCkgewogICAgICAvLyAgIHJldHVybiB0cnVlOwogICAgICAvLyB9CiAgICAgIC8vIHJldHVybiB0aGlzLmhpc3RvcnlbaW5kZXgtMV0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gdGhpcy5oaXN0b3J5W2luZGV4XS5ib3RfcmVzcG9uc2VfZGF0ZSA/IHRydWUgOiBmYWxzZTsKICAgIH0sCiAgICBwcm9jZXNzX2F0dGFjaG1lbnRfZmlsZTogZnVuY3Rpb24gcHJvY2Vzc19hdHRhY2htZW50X2ZpbGUoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKCiAgICAgIGlmIChmaWxlc1swXS5zaXplID4gMjA5NzE1MikgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNpemUgbGVzcyB0aGFuIDJNQiIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5maWxlX2V4dGVuc2lvbnMuYWxsX2FsbG93ZWRfZmlsZV9leHRlbnNpb25zLmluY2x1ZGVzKGZpbGVzWzBdLnR5cGUpKSB7CiAgICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHJldHVybjsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfZmlsZV9uYW1lID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfY29udGVudF90eXBlID0gZmlsZXNbMF0udHlwZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuZG9jdW1lbnRfY29udGVudCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZXNbMF0pOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPSB0cnVlOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV90eXBlID0gdGhpcy5maWxlX2V4dGVuc2lvbnMuaW1hZ2VfZmlsZV9leHRlbnNpb25zLmluY2x1ZGVzKGZpbGVzWzBdLnR5cGUpID8gImltYWdlIiA6ICJkb2N1bWVudCI7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NhcHRpb24gPSB0aGlzLm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICB0aGlzLmNyZWF0ZUF0dGFjaG1lbnQoZmlsZXNbMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGl0bGU6ICJQbGVhc2UgU2VsZWN0IGEgcHJvcGVyIGRvY3VtZW50IG9yIGltYWdlIGhhdmluZyB0aGUgY29ycmVjdCBmaWxldHlwZSIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUF0dGFjaG1lbnQ6IGZ1bmN0aW9uIGNyZWF0ZUF0dGFjaG1lbnQoZmlsZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTguc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgcmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltZy1wcmV2aWV3Iikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1nLXByZXZpZXciKS5pbm5lckhUTUwgPSAnPGltZyBjbGFzcz0iY3VzdG9tLWRpc3BsYXktaW1hZ2UiIHN0eWxlPSJtYXgtd2lkdGg6MTAwJTtoZWlnaHQ6NTAwcHg7IHBhZGRpbmc6IDFyZW07bWFyZ2luLWxlZnQ6IGF1dG87IG1hcmdpbi1yaWdodDogYXV0bzsiIHNyYz0iJyArIHRoaXMucmVzdWx0ICsgJyIgLz4nOwogICAgICB9KTsKICAgIH0sCiAgICBpc19yZXNwb25zZV9pbWFnZTogZnVuY3Rpb24gaXNfcmVzcG9uc2VfaW1hZ2UoZGF0YSkgewogICAgICBpZiAoZGF0YS50ZW1wbGF0ZSA9PSBudWxsICYmIGRhdGEudGV4dCA9PSBudWxsICYmIEJvb2xlYW4oZGF0YS5pbWFnZSkgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaXNfcmVzcG9uc2VfZG9jdW1lbnQ6IGZ1bmN0aW9uIGlzX3Jlc3BvbnNlX2RvY3VtZW50KGRhdGEpIHsKICAgICAgaWYgKGRhdGEudGVtcGxhdGUgPT0gbnVsbCAmJiBkYXRhLnRleHQgPT0gbnVsbCAmJiBkYXRhLmltYWdlID09IG51bGwgJiYgQm9vbGVhbihkYXRhLmF0dGFjaG1lbnQpICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHNob3dfaW1hZ2VfZnVsbHNjcmVlbjogZnVuY3Rpb24gc2hvd19pbWFnZV9mdWxsc2NyZWVuKGltZ19zcmMpIHsKICAgICAgJCgiI3Nob3dJbWFnZU1vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gaW1nX3NyYzsKICAgIH0sCiAgICBhZGRfbmV3X2NvbnRhY3RfbW9kYWw6IGZ1bmN0aW9uIGFkZF9uZXdfY29udGFjdF9tb2RhbCgpIHsKICAgICAgLy8gY29uc29sZS5sb2coImFkZCBuZXcgY29udGFjdC1hZGRDb250YWN0TW9kYWwiKQogICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICBzYXZlX25ld19jb250YWN0OiBmdW5jdGlvbiBzYXZlX25ld19jb250YWN0KCkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CgogICAgICB0aGlzLmFkZF9uZXdfY29udGFjdC5jb21wYW55X2lkID0gdGhpcy5jb21wYW55X2lkOwogICAgICB0aGlzLmFkZF9uZXdfY29udGFjdC5jb21wYW55X25hbWUgPSB0aGlzLmNvbXBhbnlfbmFtZTsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHRoaXMuYWRkX25ld19jb250YWN0LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxOS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAiV2hhdHNhcHAgQ29udGFjdCBBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogIkNvbnRhY3QgQWRkZWQgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICBfdGhpczE5LmNsZWFyX2FkZF9jb250YWN0KCk7CgogICAgICAgICAgX3RoaXMxOS5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJQcm92aWRlZCBudW1iZXIgYWxyZWFkeSBleGlzdHMgaW4gY29udGFjdHMiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICAgIHRleHQ6ICJDb250YWN0IEFscmVhZHkgRXhpc3RzIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBfdGhpczE5LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcl9hZGRfY29udGFjdDogZnVuY3Rpb24gY2xlYXJfYWRkX2NvbnRhY3QoKSB7CiAgICAgIHRoaXMuYWRkX25ld19jb250YWN0ID0gewogICAgICAgIHBob25lX251bWJlcjogbnVsbCwKICAgICAgICBpc19hZGRfY29udGFjdDogdHJ1ZSwKICAgICAgICBjb250YWN0X25hbWU6IG51bGwsCiAgICAgICAgZm9ybWF0dGVkTnVtYmVyOiBudWxsCiAgICAgIH07CiAgICB9LAogICAgZG93bmxvYWRfZG9jdW1lbnQ6IGZ1bmN0aW9uIGRvd25sb2FkX2RvY3VtZW50KGF0dGFjaG1lbnQpIHsKICAgICAgLy8gY29uc29sZS5sb2coYXR0YWNobWVudCkKICAgICAgdmFyIGFUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJpZCIsICJhYmNkZWZnIik7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJkb3dubG9hZCIpOwogICAgICBhVGFnLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGF0dGFjaG1lbnQubGluayk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJ0YXJnZXQiLCAiX2JsYW5rIik7CiAgICAgIGFUYWcuY2xpY2soKTsgLy8gY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthdHRhY2htZW50LmxpbmtdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9wZGYnIH0pCiAgICAgIC8vIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgICAgLy8gbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKQogICAgICAvLyBsaW5rLmRvd25sb2FkID0gYXR0YWNobWVudC5maWxlbmFtZQogICAgICAvLyBsaW5rLmNsaWNrKCkKICAgICAgLy8gVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpCiAgICAgIC8vIGxpbmsuY2xpY2soKTsKICAgIH0sCiAgICBvcGVuX3NlbmRfdGVtcGxhdGVfdG9fdXNlcjogZnVuY3Rpb24gb3Blbl9zZW5kX3RlbXBsYXRlX3RvX3VzZXIoKSB7CiAgICAgIHRoaXMucmV0cmlldmVfYWxsX3RlbXBsYXRlcygpOwogICAgICAkKCIjc2VuZFRlbXBsYXRlTW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgfSwKICAgIHJldHJpZXZlX2FsbF90ZW1wbGF0ZXM6IGZ1bmN0aW9uIHJldHJpZXZlX2FsbF90ZW1wbGF0ZXMoKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKCiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHt9OwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMjAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgIF90aGlzMjAud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0ID0gW107CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk5vIFdoYXRzYXBwIFRlbXBsYXRlIGluIGRhdGFiYXNlIikgewogICAgICAgICAgICBfdGhpczIwLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdCA9IFtdOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEudGVtcGxhdGVzICE9IG51bGwpIHsKICAgICAgICAgICAgX3RoaXMyMC53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSByZXNwb25zZS5kYXRhLnRlbXBsYXRlczsKICAgICAgICAgICAgX3RoaXMyMC53aGF0c2FwcF90ZW1wbGF0ZXMucGFnaW5hdGlvbl9kYXRhLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlX2NvdW50OwogICAgICAgICAgICBfdGhpczIwLndoYXRzYXBwX3RlbXBsYXRlcy5wYWdpbmF0aW9uX2RhdGEudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwoX3RoaXMyMC5udW1iZXJfb2Zfcm93cyAvIF90aGlzMjAucGVyX3BhZ2UpOyAvLyBpZiAodGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyAgIHRoaXMuc2hvd190ZW1wbGF0ZSgwKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJlZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZW5kX3RlbXBsYXRlX3RvX2N1c3RvbWVyOiBmdW5jdGlvbiBzZW5kX3RlbXBsYXRlX3RvX2N1c3RvbWVyKCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19ub3RpZmljYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSwKICAgICAgICBjb250YWN0c19saXN0OiBbdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyXSwKICAgICAgICBwdWJsaXNoX3RlbXBsYXRlOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJTZWxlY3RlZCB0ZW1wbGF0ZSBub3QgZm91bmQgaW4gZGIiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbnN1ZmZpY2llbnQgY3JlZGl0cyIsCiAgICAgICAgICAgIHRleHQ6ICJZb3UgaGF2ZSBubyBjcmVkaXRzIGxlZnQgdG8gc2VuZCB0ZW1wbGF0ZSB0byBOb24tVVMgcmVnaW9uLCBZb3UgY2FuIHB1cmNoYXNlIENlbnNlIEFkZCBPbnMgdG8gY29udGludWUgc2VuZGluZyB0ZW1wbGF0ZSIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAiVGllciBzcGVjaWZpYyB1c2VyIGxpbWl0IHJlYWNoZWQiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzMjEudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICB0ZXh0OiBfdGhpczIxLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIk5vIGNyZWRpdHMgbGVmdCBmb3IgdGVtcGxhdGUgdG8gbm9uIHVzIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiSW5zdWZmaWNpZW50IGNyZWRpdHMiLAogICAgICAgICAgICB0ZXh0OiAiWW91IGhhdmUgbm8gY3JlZGl0cyBsZWZ0IHRvIHNlbmQgdGVtcGxhdGUgdG8gTm9uLVVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gInRlbXBsYXRlIGlzIGJlaW5nIHNlbnQiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJUZW1wbGF0ZSBpcyBiZWluZyBzZW50IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsgLy8gY29uc3QgdGVtcGxhdGUgPSAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS50ZW1wbGF0ZV9pZCA9PSB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wbGF0ZS52YXJpYWJsZV9kaWN0LCB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIpOwoKICAgICAgICAgIHZhciBjdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CiAgICAgICAgICB2YXIgYm90X3Jlc3BvbnNlID0gW3sKICAgICAgICAgICAgInRleHQiOiBudWxsLAogICAgICAgICAgICAidHlwZSI6ICJ0ZW1wbGF0ZSIsCiAgICAgICAgICAgICJyZWNpcGllbnRfaWQiOiBfdGhpczIxLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICJ0ZW1wbGF0ZSI6IF90aGlzMjEud2hhdHNhcHBfdGVtcGxhdGVzLnByZXZpZXdfdGVtcGxhdGVfZGF0YQogICAgICAgICAgfV07CgogICAgICAgICAgaWYgKF90aGlzMjEuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udikgewogICAgICAgICAgICBfdGhpczIxLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgIF90aGlzMjEubmV3X2NvbnZfY29udGFjdF9kYXRhLmNoYXRfZGF0ZXRpbWUgPSBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpOyAvLyB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWUKCiAgICAgICAgICAgIF90aGlzMjEubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMjEubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICAgIGNoYXRfZGF0ZXRpbWU6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgIHRpbWU6ICIiLmNvbmNhdChjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENIb3VycygpLCAiOiIpLmNvbmNhdChjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENNaW51dGVzKCkpCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIlNlbGVjdGVkIHRlbXBsYXRlIG5vdCBmb3VuZCBpbiBkYiIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkluc3VmZmljaWVudCBjcmVkaXRzIiwKICAgICAgICAgICAgdGV4dDogIllvdSBoYXZlIG5vIGNyZWRpdHMgbGVmdCB0byBzZW5kIHRlbXBsYXRlIHRvIE5vbi1VUyByZWdpb24sIFlvdSBjYW4gcHVyY2hhc2UgQ2Vuc2UgQWRkIE9ucyB0byBjb250aW51ZSBzZW5kaW5nIHRlbXBsYXRlIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJObyBjcmVkaXRzIGxlZnQgZm9yIHRlbXBsYXRlIHRvIG5vbiB1cyIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkluc3VmZmljaWVudCBjcmVkaXRzIiwKICAgICAgICAgICAgdGV4dDogIllvdSBoYXZlIG5vIGNyZWRpdHMgbGVmdCB0byBzZW5kIHRlbXBsYXRlIHRvIE5vbi1VUyByZWdpb24sIFlvdSBjYW4gcHVyY2hhc2UgQ2Vuc2UgQWRkIE9ucyB0byBjb250aW51ZSBzZW5kaW5nIHRlbXBsYXRlIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJ0ZW1wbGF0ZSBpcyBiZWluZyBzZW50IikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiVGVtcGxhdGUgaXMgYmVpbmcgc2VudCIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7IC8vIGNvbnN0IHRlbXBsYXRlID0gIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0LmZpbmQoKGl0ZW0pID0+IGl0ZW0udGVtcGxhdGVfaWQgPT0gdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2codGVtcGxhdGUudmFyaWFibGVfZGljdCwgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyKTsKCiAgICAgICAgICB2YXIgY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICAgICAgdmFyIGJvdF9yZXNwb25zZSA9IFt7CiAgICAgICAgICAgIHRleHQ6IG51bGwsCiAgICAgICAgICAgIHR5cGU6ICJ0ZW1wbGF0ZSIsCiAgICAgICAgICAgIHJlY2lwaWVudF9pZDogX3RoaXMyMS5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICB0ZW1wbGF0ZTogX3RoaXMyMS53aGF0c2FwcF90ZW1wbGF0ZXMucHJldmlld190ZW1wbGF0ZV9kYXRhCiAgICAgICAgICB9XTsKCiAgICAgICAgICBpZiAoX3RoaXMyMS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252KSB7CiAgICAgICAgICAgIF90aGlzMjEuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgX3RoaXMyMS5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7IC8vIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZQoKICAgICAgICAgICAgX3RoaXMyMS5uZXdfY29udl9jb250YWN0X2RhdGEubGFzdF9ib3RfcmVzcG9uc2UgPSB7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMyMS5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICBkYXRlOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgdGltZTogIiIuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCksICI6IikuY29uY2F0KGN1cnJlbnRfdGltZXN0YW1wLmdldFVUQ01pbnV0ZXMoKSkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIF90aGlzMjEuY29udGFjdF9saXN0LnVuc2hpZnQoX3RoaXMyMS5uZXdfY29udl9jb250YWN0X2RhdGEpOwoKICAgICAgICAgICAgX3RoaXMyMS5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKGJvdF9yZXNwb25zZSkKCgogICAgICAgICAgdmFyIGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwoKICAgICAgICAgIGlmIChfdGhpczIxLmhpc3RvcnkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlOwogICAgICAgICAgfSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMjEuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgQk9UUmVzcG9uc2U6IGJvdF9yZXNwb25zZSwKICAgICAgICAgICAgdXNlcl9xdWVyeV90aW1lOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgVXNlclF1ZXJ5OiAiIiwKICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2RhdGU6IGJvdF9yZXNwb25zZV9kYXRlLAogICAgICAgICAgICBib3RfcmVzcG9uc2VfdGltZTogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgIHVzZXJfcXVlcnlfZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICBDaGF0X0RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczIxLnNjcm9sbF9kb3duKCk7CgogICAgICAgICAgX3RoaXMyMS5jb250YWN0X2xpc3RbX3RoaXMyMS5jdXJyZW50X2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSBfdGhpczIxLm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICAgIF90aGlzMjEuY29udGFjdF9saXN0ID0gX3RoaXMyMS5hcnJheV9tb3ZlKF90aGlzMjEuY29udGFjdF9saXN0LCBfdGhpczIxLmN1cnJlbnRfY29udGFjdF9pbmRleCwgMCk7CiAgICAgICAgICBfdGhpczIxLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGw7CiAgICAgICAgICBfdGhpczIxLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICBfdGhpczIxLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICBfdGhpczIxLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSA9IG51bGw7CiAgICAgICAgICAkKCIjc2VuZFRlbXBsYXRlTW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJObyBjcmVkaXRzIGxlZnQgdG8gc2VuZCB0ZW1wbGF0ZSIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkluc3VmZmljaWVudCBjcmVkaXRzIiwKICAgICAgICAgICAgdGV4dDogIllvdSBoYXZlIG5vIGNyZWRpdHMgbGVmdCB0byBzZW5kIHRlbXBsYXRlIHRvIFVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczIxLnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZyIpLAogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBfdGhpczIxLnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnIiksCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczIxLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiU2V0dGluZ3MiLAogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VyZWQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIxLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lOiBmdW5jdGlvbiBnZXRfY29udGFjdF9kaXNwbGF5X25hbWUoY29udGFjdCkgewogICAgICBpZiAoY29udGFjdC5jb250YWN0X25hbWUpIHJldHVybiBjb250YWN0LmNvbnRhY3RfbmFtZTsKICAgICAgaWYgKGNvbnRhY3QucHJvZmlsZV9uYW1lKSByZXR1cm4gY29udGFjdC5wcm9maWxlX25hbWU7CiAgICAgIHJldHVybiBjb250YWN0LndoYXRzYXBwX3Bob25lX251bWJlcjsKICAgIH0sCiAgICBvcGVuX2ltcG9ydF9mcm9tX2Nzdl9tb2RhbDogZnVuY3Rpb24gb3Blbl9pbXBvcnRfZnJvbV9jc3ZfbW9kYWwoKSB7CiAgICAgICQoIiNhZGRDb250YWN0TW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAkKCIjaW1wb3J0Q29udGFjdENTVk1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICBmaWxlX2lucHV0X2NvbnRhY3RzX2NzdjogZnVuY3Rpb24gZmlsZV9pbnB1dF9jb250YWN0c19jc3YoZSkgewogICAgICBpZiAoZS50YXJnZXQuZmlsZXNbMF0udHlwZSA9PSAidGV4dC9jc3YiKSB7CiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsID0gZS50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfY29udGVudCA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9zZWxlY3RlZCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYSBwcm9wZXIgZG9jdW1lbnQgaGF2aW5nIENTViBmaWxldHlwZSIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGZpbGVfc3VibWl0X3VwbG9hZF9jb250YWN0czogZnVuY3Rpb24gZmlsZV9zdWJtaXRfdXBsb2FkX2NvbnRhY3RzKCkgewogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7CgogICAgICBpZiAoJCgiI2lucHV0R3JvdXBVcGxvYWRGaWxlY3N2IikudmFsKCkgPT0gIiIpIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhIENTViBmaWxlIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdXNlcl9kZXRhaWxzID0gewogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5CiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgfSk7CiAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmZC5hcHBlbmQoImZpbGUiLCB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfY29udGVudCwgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsKTsgLy8gZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CgogICAgICBmZC5hcHBlbmQoImNvbXBhbnlpZCIsIHRoaXMuY29tcGFueV9pZCk7CiAgICAgIGZkLmFwcGVuZCgiY29tcGFueW5hbWUiLCB0aGlzLmNvbXBhbnlfbmFtZSk7CiAgICAgIGZkLmFwcGVuZCgiZW1haWwiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwpOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9pbXBvcnRfY29udGFjdHMoKSwgZmQsIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgIHRleHQ6ICJNdWx0aXBsZSBjb250YWN0cyBhcmUgYmVpbmcgYWRkZWQuIFlvdSB3aWxsIHJlY2VpdmUgYSBtYWlsIHdoZW4gdGhlIHByb2Nlc3NpbmcgaXMgZmluaXNoZWQuIiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIkZhaWx1cmUiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbmNvcnJlY3QgRmlsZSBGb3JtYXQhIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIGRpZmZlcmVudCBjc3YgZmlsZSB3aGljaCBtYXRjaGVzIHRoZSBzYW1wbGUgZmlsZSBzdHJ1Y3R1cmUiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIkVycm9yIikgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQhIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgfSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHM6IGZ1bmN0aW9uIGVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKSB7CiAgICAgIHRoaXMuY29udGFjdF9jc3YgPSB7CiAgICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBGaWxlIiwKICAgICAgICBmaWxlX2NvbnRlbnQ6IG51bGwsCiAgICAgICAgZmlsZV9zZWxlY3RlZDogZmFsc2UKICAgICAgfTsKICAgICAgJCgiI2lucHV0R3JvdXBVcGxvYWRGaWxlY3N2IikudmFsKCIiKTsKICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGVfY29udGFjdF9maWxlOiBmdW5jdGlvbiBkb3dubG9hZF9zYW1wbGVfY29udGFjdF9maWxlKCkgewogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CgogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuZmlsZV9kb3dubG9hZCgpLAogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHNhbXBsZV9maWxlOiAid2hhdHNhcHBfY29udGFjdHMiLAogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMjMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJOb3QgYWJsZSB0byBkb3dubG9hZCBmaWxlIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7IC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCgogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgInRlc3QuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczIzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMjMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB0ZXh0Ym94X2hlaWdodDogZnVuY3Rpb24gdGV4dGJveF9oZWlnaHQoaWQsIGtleSkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0aGlzLnNlbmRfbWVzc2FnZV90b191c2VyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7CiAgICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgc2Nyb2xsX2hlaWdodCA9IGUudGFyZ2V0LnNjcm9sbEhlaWdodDsKCiAgICAgICAgICBpZiAoc2Nyb2xsX2hlaWdodCA+IDYwKSB7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gImF1dG8iOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNsb3NlX2RvY3VtZW50X3ByZXZpZXc6IGZ1bmN0aW9uIGNsb3NlX2RvY3VtZW50X3ByZXZpZXcoKSB7CiAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbCA9IHsKICAgICAgICBtZWRpYV9maWxlX25hbWU6IG51bGwsCiAgICAgICAgbWVkaWFfZmlsZTogbnVsbCwKICAgICAgICBzaG93X3ByZXZpZXc6IGZhbHNlLAogICAgICAgIG1lZGlhX2NvbnRlbnRfdHlwZTogbnVsbCwKICAgICAgICBtZWRpYV90eXBlOiBudWxsLAogICAgICAgIHNlbmRfbWVkaWE6IHRydWUsCiAgICAgICAgZG9jdW1lbnRfY29udGVudDogbnVsbCwKICAgICAgICBtZWRpYV9jYXB0aW9uOiBudWxsCiAgICAgIH07CiAgICB9LAogICAgd2hhdHNhcHBfbWVzc2FnZV9mb3JtYXRpbmc6IGZ1bmN0aW9uIHdoYXRzYXBwX21lc3NhZ2VfZm9ybWF0aW5nKGEpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNudCA9IDA7CiAgICAgICAgdmFyIHBvczEgPSAtMTsKCiAgICAgICAgd2hpbGUgKGNudCA8IGEubGVuZ3RoKSB7CiAgICAgICAgICBwb3MxID0gYS5pbmRleE9mKHRoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV0sIHBvczEgKyAxKTsKCiAgICAgICAgICBpZiAocG9zMSA9PSAtMSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVwbGFjZV9maXJzdF9jaGFyID0gYS5zdWJzdHJpbmcoMCwgcG9zMSkgKyB0aGlzLndoYXRzYXBwX2Zvcm1hdF9kaWN0W3RoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV1dWzBdICsgYS5zdWJzdHJpbmcocG9zMSArIDEpOwogICAgICAgICAgYSA9IHJlcGxhY2VfZmlyc3RfY2hhcjsKICAgICAgICAgIHZhciBwb3MyID0gYS5pbmRleE9mKHRoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV0pOwogICAgICAgICAgdmFyIHJlcGxhY2Vfc2Vjb25kX2NoYXIgPSBhLnN1YnN0cmluZygwLCBwb3MyKSArIHRoaXMud2hhdHNhcHBfZm9ybWF0X2RpY3RbdGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXV1bMV0gKyBhLnN1YnN0cmluZyhwb3MyICsgMSk7CiAgICAgICAgICBhID0gcmVwbGFjZV9zZWNvbmRfY2hhcjsKICAgICAgICAgIHBvczEgPSBwb3MyOwogICAgICAgICAgY250ID0gcG9zMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfSwKICAgIGZvcm1hdFVzZXJRdWVyeTogZnVuY3Rpb24gZm9ybWF0VXNlclF1ZXJ5KFVzZXJRdWVyeSkgewogICAgICBpZiAoVXNlclF1ZXJ5LnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIganNvbl9zdGFydCA9IFVzZXJRdWVyeS5pbmRleE9mKCd7JyksCiAgICAgICAgICAgICAganNvbl9lbmQgPSBVc2VyUXVlcnkuaW5kZXhPZignfScpICsgMSwKICAgICAgICAgICAgICBqc29uX2RhdGEgPSBKU09OLnBhcnNlKFVzZXJRdWVyeS5zdWJzdHJpbmcoanNvbl9zdGFydCwganNvbl9lbmQpKTsKICAgICAgICAgIHJldHVybiAiSWQ6ICIuY29uY2F0KGpzb25fZGF0YS5vcmRlcl9pZCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiBVc2VyUXVlcnk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gVXNlclF1ZXJ5OwogICAgfSwKICAgIGdldF9vcmRlcl90ZW1wbGF0ZV9mb3JtYXR0ZWRfdGV4dDogZnVuY3Rpb24gZ2V0X29yZGVyX3RlbXBsYXRlX2Zvcm1hdHRlZF90ZXh0KGN1cnJlbnRfYm90X3Jlc3BvbnNlKSB7CiAgICAgIHJldHVybiB0aGlzLndoYXRzYXBwX21lc3NhZ2VfZm9ybWF0aW5nKGN1cnJlbnRfYm90X3Jlc3BvbnNlLnRlbXBsYXRlLmNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT0gJ0JPRFknOwogICAgICB9KS50ZXh0KTsKICAgIH0sCiAgICBjaGVja19idXR0b25faW5fb3JkZXJfdGVtcGxhdGU6IGZ1bmN0aW9uIGNoZWNrX2J1dHRvbl9pbl9vcmRlcl90ZW1wbGF0ZShjdXJyZW50X2JvdF9yZXNwb25zZSkgewogICAgICB2YXIgY2hlY2tfYnV0dG9ucyA9IGN1cnJlbnRfYm90X3Jlc3BvbnNlLnRlbXBsYXRlLmNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT0gJ0JVVFRPTlMnOwogICAgICB9KTsKCiAgICAgIGlmIChCb29sZWFuKGNoZWNrX2J1dHRvbnMpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBnZXRfb3JkZXJfdGVtcGxhdGVfYnV0dG9uX3VybDogZnVuY3Rpb24gZ2V0X29yZGVyX3RlbXBsYXRlX2J1dHRvbl91cmwoY3VycmVudF9ib3RfcmVzcG9uc2UsIGtleSkgewogICAgICByZXR1cm4gY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PSAnQlVUVE9OUyc7CiAgICAgIH0pLmJ1dHRvbnMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT0gJ1VSTCc7CiAgICAgIH0pW2tleV07CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5jaGFubmVsLmxlYXZlKCk7CiAgICB0aGlzLmNoYXRfc29ja2V0LmRpc2Nvbm5lY3QoKTsKICB9Cn07"},null]}