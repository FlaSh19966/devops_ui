{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Newtestbot.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Newtestbot.vue","mtime":1660042032575},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDgtYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50MzItYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5jb3B5LXdpdGhpbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmV2ZXJ5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbHRlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWluZGV4IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubGFzdC1pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZS1yaWdodCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJldmVyc2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zZXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb3J0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc3ViYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1sb2NhbGUtc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBmaW5nZXJwcmludCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL2ZpbmdlcnByaW50IjsKaW1wb3J0IHsgYnVzIH0gZnJvbSAiQC9wb3J0YWwvbWFpbiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgU29ja2V0IH0gZnJvbSAicGhvZW5peC1zb2NrZXQiOwppbXBvcnQgeyBzZXRUaW1lb3V0LCBzZXRJbnRlcnZhbCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBSZWNvcmRlciBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL3JlY29yZGVyIjsKaW1wb3J0IFNjcm9sbGJhciBmcm9tICJzbW9vdGgtc2Nyb2xsYmFyIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBkZWJvdW5jZSBmcm9tICJ2dWUtZGVib3VuY2Uvc3JjL2RlYm91bmNlIjsKaW1wb3J0IGNvdW50cnlfY29kZSBmcm9tICIuLi9EYXNoYm9hcmQvY291bnRyeV9jb2RlX2RhdGEuanNvbiI7CmltcG9ydCBDb3VudHJ5Q29kZXMgZnJvbSAiLi4vRGFzaGJvYXJkL0NvdW50cnlDb2Rlcy5qc29uIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJjbG9zZWQtZm9ybS1yZXNwb25zZS1ib3QiLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdAogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICBwb3B1cF9tc2c6ICJZb3UgY2FuIHR5cGUg4oCYUmVzdGFydOKAnSAgYXQgPC9icj5hbnkgIHRpbWUgdG8gZ2V0IGJhY2s8L2JyPiB0byB0aGUgTWFpbiBNZW51IiwKICAgICAgcmVmcmVzaGVkX29yX2Nsb3NlZDogdHJ1ZSwKICAgICAgcXVzX2FuczogImFuc3dlcnMiLAogICAgICB0b19zZW5kOiAiIiwKICAgICAgY2Vuc2VfZW5xdWlyeTogZmFsc2UsCiAgICAgIGlzX3R5cGluZzogZmFsc2UsCiAgICAgIHVzZXJfbmFtZTogIiIsCiAgICAgIHNob3c6IGZhbHNlLAogICAgICBjaGF0OiBbXSwKICAgICAgZmluZ2VycHJpbnQ6IG51bGwsCiAgICAgIGJvdF9yZXNwb25zZV90b2tlbl92YWx1ZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlJlc3BvbnNlQm90VG9rZW4iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJSZXNwb25zZUJvdFRva2VuIikgOiAiIiwKICAgICAgZmlyc3RfY2xpY2s6IGZhbHNlLAogICAgICBsZXZlbDogMCwKICAgICAgcmVjb2duaXRpb246IG51bGwsCiAgICAgIGpzb25fZGF0YTogewogICAgICAgIGNyZWF0ZV9hcHBvaW50bWVudDogJ3siVXNlciI6IHsiUGh5c2ljaWFuIjogeyJJRCI6ICJEVDAwMDAwMDAwMDAwMDAwMDIzNyJ9LCJVc2VyTmFtZSI6ImFjIiwiSUQiOiJVUzAwMDAwMDAwMDAwMDAwMDEzOCIsIkFjY291bnQiOiB7IklEIjogIkNPMDAwMjMifSwiVG9rZW4iOiAiWjFyU0dHbTBYcE1XanQzZ2lBRXJQUFdaODRUUU45RnNGTUJMc1UrL0xBdTZ5dWFsTWc2RVAyYnNyd1pqTFB3bTNqNERwUGNHYzVMY0lwM05qZ2ZVc0E9PSIsIlNwZWNpYWx0eSI6IHsiSUQiOiAiUEcwMDAwMDAwMDAwMDAwMDAxNDEiLCAiTmFtZSI6ICJBQyIsICJDb2RlIjogIkFDIn0sIkRvbWFpbiI6ICJnb2dyZWVuYmlsbHMuY29tIn0sIkFwcG9pbnRtZW50IjogeyJEYXRlIjogIjA4LzMwLzIwMTgiLCAiSXNKU09OTm90ZSI6IDAsICJQYXRpZW50IjogeyJDYXNlSUQiOiAiIn19fScsCiAgICAgICAgdmlzaXRzX2ZpbmFsaXplZDogJ3siVXNlciI6IHsiUGh5c2ljaWFuIjogeyJJRCI6ICJEVDAwMDAwMDAwMDAwMDAxMTg4NiJ9LCJVc2VyTmFtZSI6ICJjaCIsIklEIjogIlVTMDAwMDAwMDAwMDAwMDAwMTQzIiwiQWNjb3VudCI6eyJJRCI6IkNPMDAwMjMifSwiVG9rZW4iOiJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpJVXpJMU5pSjkuZXlKMWMyVnlJam9pWVhaa2FIVjBJaXdpWlhod0lqb3hOVEk1TkRneU5qWXpmUS52MWMwSGJ1V3VaWFhwSmZEclhWYzFIUFZ1ZmZibkdjTHFrcGcwem02QW9RIiwiU3BlY2lhbHR5IjogeyJJRCI6ICJQRzAwMDAwMDAwMDAwMDAwMDE0MiIsIkNvZGUiOiAiY2gifSwiRG9tYWluIjogImdyZWVueW91cmJpbGxzLmNvbSJ9LCJTZWFyY2hQYXJhbWV0ZXJzIjogeyJTdGF0dXMiOiAiIiwiT3JkZXJCeSI6ICIiLCJGcm9tRGF0ZSI6ICIwMS8wMS8yMDE4IiwiQ291bnQiOiAiMTAiLCJTZWFyY2hUZXh0IjogIiIsIlR5cGVPZlZpc2l0IjogIkFMTCIsIlNvcnRPcmRlciI6ICJhcHBvaW50bWVudCIsIlN0YXJ0SW5kZXgiOiAiMSIsIkVuZEluZGV4IjogIjEwIiwiVG9EYXRlIjogIjA4LzA2LzIwMTgifX0nLAogICAgICAgIGFwcG9pbnRtZW50c19jb3VudDogJ3siVXNlciI6IHsiUGh5c2ljaWFuIjogeyJJRCI6ICJEVDAwMDAwMDAwMDAwMDAxMTg4NiJ9LCJVc2VyTmFtZSI6ICJjaCIsIklEIjogIlVTMDAwMDAwMDAwMDAwMDAwMTQzIiwiQWNjb3VudCI6eyJJRCI6IkNPMDAwMjMifSwiVG9rZW4iOiJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpJVXpJMU5pSjkuZXlKMWMyVnlJam9pWVhaa2FIVjBJaXdpWlhod0lqb3hOVEk1TkRneU5qWXpmUS52MWMwSGJ1V3VaWFhwSmZEclhWYzFIUFZ1ZmZibkdjTHFrcGcwem02QW9RIiwiU3BlY2lhbHR5IjogeyJJRCI6ICJQRzAwMDAwMDAwMDAwMDAwMDE0MiIsIkNvZGUiOiAiY2gifSwiRG9tYWluIjogImdyZWVueW91cmJpbGxzLmNvbSJ9LCJTZWFyY2hQYXJhbWV0ZXJzIjogeyJTdGF0dXMiOiAiIiwiT3JkZXJCeSI6ICIiLCJGcm9tRGF0ZSI6ICIwMS8wMS8yMDE4IiwiQ291bnQiOiAiMTAiLCJTZWFyY2hUZXh0IjogIiIsIlR5cGVPZlZpc2l0IjogIkFMTCIsIlNvcnRPcmRlciI6ICJhcHBvaW50bWVudCIsIlN0YXJ0SW5kZXgiOiAiMSIsIkVuZEluZGV4IjogIjEwIiwiVG9EYXRlIjogIjA4LzA2LzIwMTgifX0nLAogICAgICAgIGNyZWF0ZV90aWNrZXQ6ICd7IkFjY291bnROYW1lIjpudWxsLCJDYWxsYmFja1Bob25lIjoiIiwiQ29tcGFueUlEIjoiQ08wMDAyMyIsIkRlc2NyaXB0aW9uIjoiRGUiLCJEb21haW5OYW1lIjpudWxsLCJFbWFpbENDIjoiYWJoYXkud0Bjb2RlYXJyYXkudGVjaCIsIkVtYWlsRGVmYXVsdCI6Im1hbmlzaC55QGNvZGVhcnJheS50ZWNoIiwiUHJpb3JpdHkiOiIzIiwiUHJpb3JpdHlJRCI6MCwiUmFpc2VkQnkiOiJsYXd1c2VyIiwiU3RhdHVzIjowLCJTdGF0dXNDb2RlIjpudWxsLCJTdGF0dXNUZXh0IjpudWxsLCJTVHlwZSI6IldQIiwiU3ViamVjdCI6IkRlIiwiU3ViVHlwZSI6IlNBTUQtUCIsIlRpY2tldElEIjowLCJUaWNrZXROdW1iZXIiOm51bGwsIlR5cGUiOjAsIlR5cGVUZXh0IjoiV2Vic2l0ZSBQcm9ibGVtIiwibGlzdEZpbGVzMSI6WyJjaHExLnBkZiJdfScsCiAgICAgICAgZ2V0X3JlcG9ydDogJ3siY29tcGFueUlkIjogIkNPMDAwMjMifScKICAgICAgfSwKICAgICAgcGhvbmVfbnVtYmVyOiAiIiwKICAgICAgc3RvcDogdHJ1ZSwKICAgICAgZGVtb3VybGJpbmQ6IGZhbHNlLAogICAgICByZXZpZXdzdXJsYmluZDogZmFsc2UsCiAgICAgIHJldmlld3N1cmw6ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9wYUFlVzg2ZVFaNCIsCiAgICAgIGRlbW91cmw6IFsiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/S2NySm05VXhXM3MmaW5kZXg9MTMmbGlzdD1QTF9qWGxpaDhkZ2tURThDclBwaVdjQTlLeFFlS0haQW50JnQ9MHMiLCAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvdmlkZW9zZXJpZXM/cXpTMnFJTkk2SU0mbGlzdD1QTF9qWGxpaDhkZ2tSdTVkZEdYQUdxWjR1TExrb0p6Q2o4JmluZGV4PTIiXSwKICAgICAgY2hhdF93aWRnZXQ6IHsKICAgICAgICBsb2dvOiAiIiwKICAgICAgICB0aXRsZTogIiIsCiAgICAgICAgc3R5bGU6ICIiCiAgICAgIH0sCiAgICAgIHNlbGVjdGVkX2RhdGU6ICIiLAogICAgICBzZWxlY3RlZF90aW1lOiAiIiwKICAgICAgcmVhc29uX29mX3Zpc2l0OiAiIiwKICAgICAgcGF0aWVudF9uYW1lOiAiIiwKICAgICAgdmlzaXRvcl9udW1iZXI6ICIiLAogICAgICBmdWxsX3RpbWVfc2xvdHM6IFtdLAogICAgICB0aW1lX3Nsb3RzOiBbXSwKICAgICAgVE9EQVlfREFURTogIiIsCiAgICAgIGNoYW5uZWw6IG51bGwsCiAgICAgIGNoYXRfc29ja2V0OiBudWxsLAogICAgICB2b2ljZV9zb2NrZXQ6IG51bGwsCiAgICAgIGxpdmVfY2hhdF9vbjogZmFsc2UsCiAgICAgIGxpdmVfY2hhdF90b2tlbjogbnVsbCwKICAgICAgY2hhdF9ncm91cF9uYW1lOiBudWxsLAogICAgICB0b19zY3JvbGw6IGZhbHNlLAogICAgICBmb3JtX3BheWxvYWQ6IG51bGwsCiAgICAgIHJlZnJlc2hfdGltZTogMCwKICAgICAgcGhvbmVfbnVtYmVyX3ZhbGlkaXR5OiAvWzAtOV17MTAsMTF9JC8sCiAgICAgIGVtcHR5X3N0cmluZ192YWxpZGl0eTogL14kLywKICAgICAgLy9oYXJzaAogICAgICBpc2V4Y2hhbmdlOiBmYWxzZSwKICAgICAgY3VycmVuY3lleGNoYW5nZV9saXN0OiBudWxsLAogICAgICBzZWxlY3RlZF9pbmRpY2F0aW9uOiBbXSwKICAgICAgcmVzOiB7fSwKICAgICAgaXNjbG9zZWRib3RvbjogZmFsc2UsCiAgICAgIGlzZm9ybW9uOiBmYWxzZSwKICAgICAgZm9ybV9uYW1lOiBudWxsLAogICAgICBsYXN0Y2xvc2VkYm90aW5wdXRub2RlOiBudWxsLAogICAgICBjbG9zZWRfZm9ybV9yZXBseV9kYXRhOiBudWxsLAogICAgICBzZWxlY3RlZG5vZGVpZDogbnVsbCwKICAgICAgYm90X25hbWU6IG51bGwsCiAgICAgIGJvdF90eXBlOiBudWxsLAogICAgICBpZmZpcnN0dGltZTogdHJ1ZSwKICAgICAgaXNlbWFpbDogZmFsc2UsCiAgICAgIGlzX3Bob25lX251bWJlcjogZmFsc2UsCiAgICAgIGlzX3RleHRfYXJlYTogZmFsc2UsCiAgICAgIGNvbnZlcnNhdGlvbl9pZDogIiIsCiAgICAgIGlzX3Bob25lX251bWJlcl9vdHA6IGZhbHNlLAogICAgICBuYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyOiBudWxsLAogICAgICBpc19waG9uZV9udW1iZXJfZXJyX21zZzogZmFsc2UKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB0aGlzLmNvbnZlcnNhdGlvbl9pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICB0aGlzLiRzZXNzaW9uLnN0YXJ0KCk7CiAgICB0aGlzLiRzZXNzaW9uLnNldCgiY29udmVyc2F0aW9uX2lkIiwgdGhpcy5jb252ZXJzYXRpb25faWQpOyAvLyBjb25zb2xlLmxvZyhjb3VudHJ5X2NvZGUpOwogICAgLy8gY29uc29sZS5sb2coSlNPTi5wYXJzZShjb3VudHJ5X2NvZGUpKTsKCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5oYXMoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIpKSB7Ly8gdGhpcy5jaGF0ID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIpOwogICAgfQoKICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIkNoYXRCb3RJbWFnZVBhcmFtZXRlcnMiKSkgewogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aWRnZXRfc2V0dGluZ191cmwoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC50aXRsZSA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0VGl0bGU7CiAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9IHJlc3BvbnNlLmRhdGEuSW1hZ2VVcmw7CgogICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIsIF90aGlzLmNoYXRfd2lkZ2V0KTsKCiAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQuc3R5bGUgPSAibWFyZ2luLXRvcDogNXB4O2hlaWdodDozMHB4O3dpZHRoOmF1dG8iOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChfdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSA9PSAiZ29neWIiKSB7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6NjBweCI7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5sb2dvID0gIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIjsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lID09ICJNVCBDYXJlIikgewogICAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9ICIvaW1nL3JvYm9tYXRlX2xvZ28ucG5nIjsKICAgICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LnN0eWxlID0gIm1hcmdpbi10b3A6IDVweDtoZWlnaHQ6NTBweDt3aWR0aDo5NXB4IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQubG9nbyA9ICIvaW1nL2NlbnNlX2ltYWdlLnBuZyI7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6NjBweCI7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy4kc2Vzc2lvbi5zZXQoIkNoYXRCb3RJbWFnZVBhcmFtZXRlcnMiLCBfdGhpcy5jaGF0X3dpZGdldCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jaGF0X3dpZGdldCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDaGF0Qm90SW1hZ2VQYXJhbWV0ZXJzIik7CiAgICAgIHRoaXMuY2hhdF93aWRnZXQuc3R5bGUgPSAibWFyZ2luLXRvcDogNXB4O2hlaWdodDozMHB4O3dpZHRoOmF1dG8iOwogICAgfQoKICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoIlJlc3BvbnNlQm90VG9rZW4iKSkgewogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ib3RfcmVzcG9uc2VfdG9rZW4oKSwgewogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgiUmVzcG9uc2VCb3RUb2tlbiIsIHJlc3BvbnNlLmRhdGEuZGF0YSk7CgogICAgICAgIF90aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKCiAgICAgICAgX3RoaXMucmVmcmVzaF9jaGF0Ym90KCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZWZyZXNoX2NoYXRib3QoKTsKICAgIH0gLy9oYXJzaAoKCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5ID09ICIuZUp4VGNzc3ZTczFNejZ0SXprak1TMDgxTkRleE5JUUtLVURGTWtwS0NvcXQ5UFhMeTh2MTBsQlU2eVhuNS1vbGx1b2JHUmhhNmhxWTZ4cVlLQmdhV0JrWlc1bWE2aG1ibTVnWW1Tb0JBR2E5SHAwLlhSM1R1dy5YNzdGXzdMRHRPTHAyVnQ5c25GRFNvMzFuVHciKSB7CiAgICAgIHRoaXMuaXNleGNoYW5nZSA9IHRydWU7CiAgICB9CgogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgYXhpb3MucG9zdChhcGlfY2FsbHMuYm90X3VzZXJfZGF0YSgpLCB7CiAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgIHR6OiBJbnRsLkRhdGVUaW1lRm9ybWF0KCkucmVzb2x2ZWRPcHRpb25zKCkudGltZVpvbmUsCiAgICAgIGRhdGV0aW1lOiBkLnRvSVNPU3RyaW5nKCksCiAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUKICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7fSk7CgogICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5ib3RkYXRhID09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgbmFtZTogJ0Rhc2hib2FyZCcKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvdF9uYW1lID0gdGhpcy4kcm91dGUucGFyYW1zLmJvdGRhdGEuYm90X25hbWU7CiAgICAgIHRoaXMuYm90X3R5cGUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuYm90ZGF0YS5ib3RfdHlwZTsgLy8gYXhpb3MKICAgICAgLy8gICAucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksewogICAgICAvLyAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgLy8gICAgIHVpZDogImNsb3NlZF9mb3JtX3VzZXIiLAogICAgICAvLyAgICAgY2hhdDogbnVsbCwKICAgICAgLy8gICAgIG5vZGVfc2VsZWN0ZWQ6IG51bGwsCiAgICAgIC8vICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZSwKICAgICAgLy8gICB9KQogICAgICAvLyAgIC50aGVuKHJlc3BvbnNlPT57CiAgICAgIC8vICAgICBpZihyZXNwb25zZS5kYXRhLmVycm9yPT11bmRlZmluZWQpewogICAgICAvLyAgICAgICB0aGlzLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgLy8gICAgICAgdGhpcy5pc2Nsb3NlZGJvdG9uPXRydWU7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgQ291bnRyeUNvZGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKGEuY29kZSA8IGIuY29kZSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQoKICAgICAgaWYgKGEuY29kZSA+IGIuY29kZSkgewogICAgICAgIHJldHVybiAxOwogICAgICB9CgogICAgICByZXR1cm4gMDsKICAgIH0pOwogICAgdGhpcy5zaG93ID0gZmFsc2U7CgogICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUgPT0gIlRyYWluIHRoZSBCb3QiKSB7CiAgICAgICQoIi5jaGF0LXdyYXAiKS5jc3MoInJpZ2h0IiwgImF1dG8iKTsKICAgIH0KCiAgICBpZiAodGhpcy4kcm91dGUubmFtZSA9PSAiRGlyZWN0IFJlc3BvbnNlIEJvdCIpIHsKICAgICAgJCgiLmNoYXQtd3JhcCIpLmNzcygibWFyZ2luVG9wIiwgIjUlIik7CiAgICB9CgogICAgJCgnW2RhdGEtdG9nZ2xlPSJwb3BvdmVyIl0nKS5wb3BvdmVyKHsKICAgICAgaHRtbDogdHJ1ZSwKICAgICAgY29udGVudDogJCgiI3BvcG92ZXJfY29udGVudCIpCiAgICB9KS5vbigic2hvdy5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkgewogICAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuYWRkQ2xhc3MoImQtYmxvY2siKTsKICAgIH0pLm9uKCJoaWRlLmJzLnBvcG92ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ub25lIik7CiAgICB9KTsKICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5jc3MoInpJbmRleCIsIDk5OTkpOwogICAgYnVzLiRvbigiTG9nb3V0IGhhcyBiZWVuIGNsaWNrZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PSAiVHJ1ZSIpIHsKICAgICAgICAkKCdbZGF0YS10b2dnbGU9InBvcG92ZXIiXScpLnBvcG92ZXIoImhpZGUiKTsKICAgICAgfQogICAgfSk7CiAgICB3aW5kb3cuU3BlZWNoUmVjb2duaXRpb24gPSB3aW5kb3cud2Via2l0U3BlZWNoUmVjb2duaXRpb24gfHwgd2luZG93LlNwZWVjaFJlY29nbml0aW9uOwogICAgd2luZG93LkF1ZGlvQ29udGV4dCA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDsKICAgIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgPSBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhIHx8IG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEgfHwgbmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYSB8fCBuYXZpZ2F0b3IubXNHZXRVc2VyTWVkaWE7CiAgfSwKICB1cGRhdGVkOiBmdW5jdGlvbiB1cGRhdGVkKCkgewogICAgdGhpcy5zdWJtaXRfY3VzdG9tX2Zvcm0oKTsKCiAgICBpZiAodGhpcy5pc2Nsb3NlZGJvdG9uICYmIHRoaXMuaXNmb3Jtb24pIHsKICAgICAgdGhpcy5zdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YSgpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZ2VuZXJhdGVVVUlEOiBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CiAgICAgIC8vIFB1YmxpYyBEb21haW4vTUlUCiAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IC8vVGltZXN0YW1wCgogICAgICB2YXIgZDIgPSBwZXJmb3JtYW5jZSAmJiBwZXJmb3JtYW5jZS5ub3cgJiYgcGVyZm9ybWFuY2Uubm93KCkgKiAxMDAwIHx8IDA7IC8vVGltZSBpbiBtaWNyb3NlY29uZHMgc2luY2UgcGFnZS1sb2FkIG9yIDAgaWYgdW5zdXBwb3J0ZWQKCiAgICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTY7IC8vcmFuZG9tIG51bWJlciBiZXR3ZWVuIDAgYW5kIDE2CgogICAgICAgIGlmIChkID4gMCkgewogICAgICAgICAgLy9Vc2UgdGltZXN0YW1wIHVudGlsIGRlcGxldGVkCiAgICAgICAgICByID0gKGQgKyByKSAlIDE2IHwgMDsKICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGQgLyAxNik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vVXNlIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgaWYgc3VwcG9ydGVkCiAgICAgICAgICByID0gKGQyICsgcikgJSAxNiB8IDA7CiAgICAgICAgICBkMiA9IE1hdGguZmxvb3IoZDIgLyAxNik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKGMgPT09ICd4JyA/IHIgOiByICYgMHgzIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgIH0pOwogICAgfSwKICAgIHZvaWNlX2NvbW11bmljYXRpb246IGZ1bmN0aW9uIHZvaWNlX2NvbW11bmljYXRpb24oKSB7CiAgICAgIGlmICgvQ2hyb21pdW0vaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7CiAgICAgICAgdGhpcy5jYWxsX2Nsb3VkX2FwaSgpOwogICAgICB9IGVsc2UgaWYgKHdpbmRvdy5TcGVlY2hSZWNvZ25pdGlvbiAhPSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnJlY29nbml0aW9uID0gbmV3IHdpbmRvdy5TcGVlY2hSZWNvZ25pdGlvbigpOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNtaWNyb3Bob25lIikuY2xhc3NMaXN0LmFkZCgidm9pY2Utb24iKTsKCiAgICAgICAgdGhpcy5yZWNvZ25pdGlvbi5vbnJlc3VsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgc3BlZWNoVG9UZXh0ID0gZS5yZXN1bHRzWzBdWzBdLnRyYW5zY3JpcHQ7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5yZWNvZ25pdGlvbi5vbmVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNtaWNyb3Bob25lIikuY2xhc3NMaXN0LnJlbW92ZSgidm9pY2Utb24iKTsgLy9BZ2FpbiDigJMgZ2l2ZSB0aGUgdXNlciBmZWVkYmFjayB0aGF0IHlvdSBhcmUgbm90IGxpc3RlbmluZyBhbnltb3JlLiBJZiB5b3Ugd2lzaCB0byBhY2hpZXZlIGNvbnRpbnVvdXMgcmVjb2duaXRpb24g4oCTIHlvdSBjYW4gd3JpdGUgYSBzY3JpcHQgdG8gc3RhcnQgdGhlIHJlY29nbml6ZXIgYWdhaW4gaGVyZS4KICAgICAgICB9OwoKICAgICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLm9ucmVzdWx0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50LnJlc3VsdHMgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIC8vU29tZXRoaW5nIGlzIHdyb25n4oCmCiAgICAgICAgICAgIHRoaXMucmVjb2duaXRpb24uc3RvcCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IGV2ZW50LnJlc3VsdEluZGV4OyBpIDwgZXZlbnQucmVzdWx0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAoZXZlbnQucmVzdWx0c1tpXS5pc0ZpbmFsKSB7CiAgICAgICAgICAgICAgLy9GaW5hbCByZXN1bHRzCiAgICAgICAgICAgICAgdm0udG9fc2VuZCA9IGV2ZW50LnJlc3VsdHNbaV1bMF0udHJhbnNjcmlwdDsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmluYWwgcmVzdWx0czogIiArIGV2ZW50LnJlc3VsdHNbaV1bMF0udHJhbnNjcmlwdCk7IC8vT2YgY291cnNlIOKAkyBoZXJlIGlzIHRoZSBwbGFjZSB0byBkbyB1c2VmdWwgdGhpbmdzIHdpdGggdGhlIHJlc3VsdHMuCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy9pLmUuIGludGVyaW0uLi4KICAgICAgICAgICAgICBjb25zb2xlLmxvZygiaW50ZXJpbSByZXN1bHRzOiAiICsgZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0KTsgLy9Zb3UgY2FuIHVzZSB0aGVzZSByZXN1bHRzIHRvIGdpdmUgdGhlIHVzZXIgbmVhciByZWFsIHRpbWUgZXhwZXJpZW5jZS4KICAgICAgICAgICAgfQogICAgICAgICAgfSAvL2VuZCBmb3IgbG9vcAoKICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLnN0YXJ0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYWxsX2Nsb3VkX2FwaSgpOwogICAgICB9CiAgICB9LAogICAgY2FsbF9jbG91ZF9hcGk6IGZ1bmN0aW9uIGNhbGxfY2xvdWRfYXBpKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNtaWNyb3Bob25lIikuY2xhc3NMaXN0LmFkZCgidm9pY2Utb24iKTsKICAgICAgdmFyIGF1ZGlvQ29udGV4dCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgICB2YXIgYnVmZmVyX2xpc3QsIGJ1ZmZlcl9pMzI7CiAgICAgIHZhciByZWNvcmRlciA9IG5ldyBSZWNvcmRlcihhdWRpb0NvbnRleHQsIHsKICAgICAgICAvLyBBbiBhcnJheSBvZiAyNTUgTnVtYmVycwogICAgICAgIC8vIFlvdSBjYW4gdXNlIHRoaXMgdG8gdmlzdWFsaXplIHRoZSBhdWRpbyBzdHJlYW0KICAgICAgICAvLyBJZiB5b3UgdXNlIHJlYWN0LCBjaGVjayBvdXQgcmVhY3Qtd2F2ZS1zdHJlYW0KICAgICAgICBvbkFuYWx5c2VkOiBmdW5jdGlvbiBvbkFuYWx5c2VkKGRhdGEpIHt9CiAgICAgIH0pOwogICAgICB2YXIgdm9pY2VfY2hhbm5lbCwKICAgICAgICAgIHdhdl9wYXJhbWV0ZXJzLAogICAgICAgICAgcmVjQnVmZmVycyA9IFtdLAogICAgICAgICAgcmVjTGVuZ3RoLAogICAgICAgICAgbWV0YV9kYXRhOwogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBheGlvcy5nZXQoYXBpX2NhbGxzLnZvaWNlX2NoYW5uZWxfYXBpKCkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnZvaWNlX3NvY2tldCA9IG5ldyBTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgY29tcGFueTogX3RoaXMyLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICB2b2ljZV9jaGFubmVsX25hbWU6IHJlc3BvbnNlLmRhdGEudm9pY2VfY2hhbm5lbF9uYW1lLAogICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuZGF0YS50b2tlbiwKICAgICAgICAgICAgaXNfdm9pY2U6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMyLnZvaWNlX3NvY2tldC5jb25uZWN0KCk7CgogICAgICAgIHZvaWNlX2NoYW5uZWwgPSBfdGhpczIudm9pY2Vfc29ja2V0LmNoYW5uZWwoInZvaWNlX3RvX3RleHQ6IiArIHJlc3BvbnNlLmRhdGEudm9pY2VfY2hhbm5lbF9uYW1lKTsKICAgICAgICB2b2ljZV9jaGFubmVsLmpvaW4oKTsKICAgICAgfSk7CiAgICAgIHZhciBibG9iID0gbnVsbDsKICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoewogICAgICAgIGF1ZGlvOiB0cnVlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJlY29yZGVyLmluaXQoc3RyZWFtKTsKICAgICAgICBzdGFydFJlY29yZGluZygpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKCJVaCBvaC4uLiB1bmFibGUgdG8gZ2V0IHN0cmVhbS4uLiIsIGVycik7CiAgICAgIH0pOwoKICAgICAgZnVuY3Rpb24gc3RhcnRSZWNvcmRpbmcoKSB7CiAgICAgICAgcmVjb3JkZXIuc3RhcnQoKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHN0b3BSZWNvcmRpbmcoKTsKICAgICAgICB9LCA0MDAwKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc3RvcFJlY29yZGluZygpIHsKICAgICAgICByZWNvcmRlci5zdG9wKCkudGhlbihmdW5jdGlvbiAoX3JlZikgewogICAgICAgICAgdmFyIGJsb2IgPSBfcmVmLmJsb2IsCiAgICAgICAgICAgICAgYnVmZmVyID0gX3JlZi5idWZmZXI7CiAgICAgICAgICAvLyBidWZmZXJfbGlzdCA9IGJ1ZmZlclswXTsKICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGJsb2IpOwoKICAgICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGJ1ZmZlcl9saXN0ID0gcmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAgdmFyIHRlbXAgPSBuZXcgVWludDhBcnJheShidWZmZXJfbGlzdCk7CiAgICAgICAgICAgIHdhdl9wYXJhbWV0ZXJzID0gd2F2X2ZpbGVfcHJvY2Vzc2luZ19yZWFkX3BhcmFtZXRlcnModGVtcCk7CiAgICAgICAgICAgIGluaXRfZW5jb2RlcihidWZmZXJfbGlzdCk7CiAgICAgICAgICB9OyAvLyBSZWNvcmRlci5kb3dubG9hZChibG9iLCAibXktZmlsZSIpOwogICAgICAgICAgLy8gYnVmZmVyIGlzIGFuIEF1ZGlvQnVmZmVyCgogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpbml0X2VuY29kZXIoZGF0YSkgewogICAgICAgIHZhciBhcnJheUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgICAgIHZhciBlbmNEYXRhID0gW107CiAgICAgICAgdmFyIHJlc3VsdCA9IGVuY29kZUZsYWMoYXJyYXlCdWZmZXIsIGVuY0RhdGEpOyAvLyBjb25zb2xlLmxvZygiZW5jb2RlZCBkYXRhIGFycmF5OiAiLCBlbmNEYXRhKTsKCiAgICAgICAgaWYgKHJlc3VsdC5lcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcigiQ29udmVyc2lvbiBmYWlsZWQhISIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1ldGFEYXRhID0gcmVzdWx0Lm1ldGFEYXRhOwoKICAgICAgICBpZiAoIXJlc3VsdC5lcnJvcikgewogICAgICAgICAgLy91c2luZyBkYXRhLXV0aWwuanMgdXRpbGl0eSBmdW5jdGlvbihzKQogICAgICAgICAgdmFyIGJsb2JfZG93bmxvYWQgPSBleHBvcnRGbGFjRmlsZShlbmNEYXRhLCBtZXRhRGF0YSk7IC8vIHZhciBkb3duX2ZpbGUgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2JfZG93bmxvYWQpOwogICAgICAgICAgLy8gbGV0IGZpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAvLyBmaWxlLmhyZWYgPSBkb3duX2ZpbGU7CiAgICAgICAgICAvLyBmaWxlLmRvd25sb2FkID0gIm91dHB1dC5mbGFjIjsKICAgICAgICAgIC8vIGZpbGUuY2xpY2soKQoKICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYl9kb3dubG9hZCk7CgogICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJlYWRlcl9zdHJpbmcgPSByZWFkZXIucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgICAgICAgIHZvaWNlX2NoYW5uZWwucHVzaCgidm9pY2VfcGFja2V0c19zZW50IiwgewogICAgICAgICAgICAgIHN0cmVhbTogcmVhZGVyX3N0cmluZwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdm9pY2VfY2hhbm5lbC5vbigidm9pY2VfdG9fdGV4dF9yZXBseSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QucmVtb3ZlKCJ2b2ljZS1vbiIpOwoKICAgICAgICAgICAgICBpZiAoZGF0YS50ZXh0LnJlc3VsdHMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2bS50b19zZW5kID0gZGF0YS50ZXh0LnJlc3VsdHNbMF0uYWx0ZXJuYXRpdmVzWzBdLnRyYW5zY3JpcHQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiV2UgY291bGQgbm90IHJlY29nbml6ZSB5b3VyIHZvaWNlLiBQbGVhc2UgdHJ5IGFnYWluIG9yIHR5cGUgaW4uIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2bS5idXR0b25fZmlsbCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBlbmNvZGVGbGFjKGJpbkRhdGEsIHJlY0J1ZmZlcnMpIHsKICAgICAgICB2YXIgdWk4X2RhdGEgPSBuZXcgVWludDhBcnJheShiaW5EYXRhKTsKICAgICAgICB2YXIgc2FtcGxlX3JhdGUgPSAwLAogICAgICAgICAgICBjaGFubmVscyA9IDAsCiAgICAgICAgICAgIGJwcyA9IDAsCiAgICAgICAgICAgIHRvdGFsX3NhbXBsZXMgPSAwLAogICAgICAgICAgICBibG9ja19hbGlnbiwKICAgICAgICAgICAgcG9zaXRpb24gPSAwLAogICAgICAgICAgICByZWNMZW5ndGggPSAwLAogICAgICAgICAgICBtZXRhX2RhdGE7CiAgICAgICAgLyoqCiAgICAgICAgICogIHJlY29yZHMvc2F2ZXMgdGhlIG91dHB1dCBkYXRhIG9mIGxpYmZsYWMtZW5jb2RlIG1ldGhvZAogICAgICAgICAqLwoKICAgICAgICBmdW5jdGlvbiB3cml0ZV9jYWxsYmFja19mbihidWZmZXIsIGJ5dGVzLCBzYW1wbGVzLCBjdXJyZW50X2ZyYW1lKSB7CiAgICAgICAgICByZWNCdWZmZXJzLnB1c2goYnVmZmVyKTsKICAgICAgICAgIHJlY0xlbmd0aCArPSBieXRlczsgLy8gcmVjTGVuZ3RoICs9IGJ1ZmZlci5ieXRlTGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWV0YWRhdGFfY2FsbGJhY2tfZm4oZGF0YSkgewogICAgICAgICAgbWV0YV9kYXRhID0gZGF0YTsKICAgICAgICB9IC8vIGNoZWNrOiBpcyBmaWxlIGEgY29tcGF0aWJsZSB3YXYtZmlsZT8KCgogICAgICAgIGlmICh3YXZfZmlsZV9wcm9jZXNzaW5nX2NoZWNrX3dhdl9mb3JtYXQodWk4X2RhdGEpID09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBlcnJvcjogIldyb25nIFdBViBmaWxlIGZvcm1hdCIsCiAgICAgICAgICAgIHN0YXR1czogMAogICAgICAgICAgfTsKICAgICAgICB9IC8vIGdldCBXQVYvUENNIHBhcmFtZXRlcnMgZnJvbSBkYXRhIC8gZmlsZQoKCiAgICAgICAgdmFyIHdhdl9wYXJhbWV0ZXJzID0gd2F2X2ZpbGVfcHJvY2Vzc2luZ19yZWFkX3BhcmFtZXRlcnModWk4X2RhdGEpOwogICAgICAgIHZhciB0b3Rfc2FtcGxlcyA9IDA7CiAgICAgICAgdmFyIGNvbXByZXNzaW9uX2xldmVsID0gNTsKICAgICAgICB2YXIgZmxhY19vayA9IDE7CiAgICAgICAgdmFyIGlzX3ZlcmlmeSA9IHRydWU7CiAgICAgICAgdmFyIGZsYWNfZW5jb2RlciA9IEZsYWMuY3JlYXRlX2xpYmZsYWNfZW5jb2Rlcih3YXZfcGFyYW1ldGVycy5zYW1wbGVfcmF0ZSwgd2F2X3BhcmFtZXRlcnMuY2hhbm5lbHMsIHdhdl9wYXJhbWV0ZXJzLmJwcywgY29tcHJlc3Npb25fbGV2ZWwsIHRvdF9zYW1wbGVzLCBpc192ZXJpZnkpOwoKICAgICAgICBpZiAoZmxhY19lbmNvZGVyICE9IDApIHsKICAgICAgICAgIHZhciBpbml0X3N0YXR1cyA9IEZsYWMuaW5pdF9lbmNvZGVyX3N0cmVhbShmbGFjX2VuY29kZXIsIHdyaXRlX2NhbGxiYWNrX2ZuLCBtZXRhZGF0YV9jYWxsYmFja19mbiwgMCk7CiAgICAgICAgICBmbGFjX29rICY9IGluaXRfc3RhdHVzID09IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBtc2cgPSAiRXJyb3IgaW5pdGlhbGl6aW5nIHRoZSBkZWNvZGVyLiI7CiAgICAgICAgICBjb25zb2xlLmVycm9yKG1zZyk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBlcnJvcjogbXNnLAogICAgICAgICAgICBzdGF0dXM6IDEKICAgICAgICAgIH07CiAgICAgICAgfSAvLyBjb252ZXJ0IHRoZSBQQ00tRGF0YSB0byB0aGUgYXBwcm9wcmlhdGUgZm9ybWF0IGZvciB0aGUgbGliZmxhYyBsaWJyYXJ5IG1ldGhvZHMgKDMyLWJpdCBhcnJheSBvZiBzYW1wbGVzKQogICAgICAgIC8vIGNyZWF0ZXMgYSBuZXcgYXJyYXkgKDMyLWJpdCkgYW5kIHN0b3JlcyB0aGUgMTYtYml0IGRhdGEgb2YgdGhlIHdhdi1maWxlIGFzIDMyLWJpdCBkYXRhCgoKICAgICAgICB2YXIgYnVmZmVyX2kzMiA9IHdhdl9maWxlX3Byb2Nlc3NpbmdfY29udmVydF8xNmJpdGRhdGFfdG8zMmJpdGRhdGEodWk4X2RhdGEuYnVmZmVyKTsKICAgICAgICB2YXIgZmxhY19yZXR1cm4gPSBGbGFjLkZMQUNfX3N0cmVhbV9lbmNvZGVyX3Byb2Nlc3NfaW50ZXJsZWF2ZWQoZmxhY19lbmNvZGVyLCBidWZmZXJfaTMyLCBidWZmZXJfaTMyLmxlbmd0aCAvIHdhdl9wYXJhbWV0ZXJzLmNoYW5uZWxzKTsKCiAgICAgICAgaWYgKGZsYWNfcmV0dXJuICE9IHRydWUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvcjogRkxBQ19fc3RyZWFtX2VuY29kZXJfcHJvY2Vzc19pbnRlcmxlYXZlZCByZXR1cm5lZCBmYWxzZS4gIiArIGZsYWNfcmV0dXJuKTsKICAgICAgICB9CgogICAgICAgIGZsYWNfb2sgJj0gRmxhYy5GTEFDX19zdHJlYW1fZW5jb2Rlcl9maW5pc2goZmxhY19lbmNvZGVyKTsKICAgICAgICBGbGFjLkZMQUNfX3N0cmVhbV9lbmNvZGVyX2RlbGV0ZShmbGFjX2VuY29kZXIpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBtZXRhRGF0YTogbWV0YV9kYXRhLAogICAgICAgICAgc3RhdHVzOiBmbGFjX29rCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gd2F2X2ZpbGVfcHJvY2Vzc2luZ19jaGVja193YXZfZm9ybWF0KHVpOF9kYXRhKSB7CiAgICAgICAgLy8gY2hlY2s6IGlzIGZpbGUgYSBjb21wYXRpYmxlIHdhdi1maWxlPwogICAgICAgIGlmICh1aThfZGF0YS5sZW5ndGggPCA0NCB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDAsIDQpKSAhPSAiUklGRiIgfHwgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1aThfZGF0YS5zdWJhcnJheSg4LCAxNikpICE9ICJXQVZFZm10ICIgfHwgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1aThfZGF0YS5zdWJhcnJheSgzNiwgNDApKSAhPSAiZGF0YSIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFUlJPUjogd3JvbmcgZm9ybWF0IGZvciB3YXYtZmlsZS4iKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIC8qKgogICAgICAgKiAgY2hlY2tzIGlmIHRoZSBnaXZlbiB1aThfZGF0YSAodWk4YXJyYXkpIGlzIG9mIGEgZmxhYy1maWxlCiAgICAgICAqLwoKCiAgICAgIGZ1bmN0aW9uIGZsYWNfZmlsZV9wcm9jZXNzaW5nX2NoZWNrX2ZsYWNfZm9ybWF0KHVpOF9kYXRhKSB7CiAgICAgICAgLy8gY2hlY2s6IGlzIGZpbGUgYSBjb21wYXRpYmxlIGZsYWMtZmlsZT8KICAgICAgICBpZiAodWk4X2RhdGEubGVuZ3RoIDwgNDIgfHwgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1aThfZGF0YS5zdWJhcnJheSgwLCA0KSkgIT0gImZMYUMiKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRVJST1I6IHdyb25nIGZvcm1hdCBmb3IgZmxhYy1maWxlLiIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcodWk4X2RhdGEuYnVmZmVyKTsgLy9jaGVjayBsYXN0IDcgYml0cyBvZiA0dGggYnl0ZSBmb3IgbWV0YS1kYXRhIEJMT0NLIHR5cGU6IG11c3QgYmUgU1RSRUFNSU5GTyAoMCkKCiAgICAgICAgaWYgKCh2aWV3LmdldFVpbnQ4KDQpICYgMHg3ZikgIT0gMCkgewogICAgICAgICAgY29uc29sZS5sb2coIkVSUk9SOiB3cm9uZyBmb3JtYXQgZm9yIGZsYWMtZmlsZS4iKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBmdW5jdGlvbiB3YXZfZmlsZV9wcm9jZXNzaW5nX3JlYWRfcGFyYW1ldGVycyh1aThfZGF0YSkgewogICAgICAgIHZhciBzYW1wbGVfcmF0ZSA9IDAsCiAgICAgICAgICAgIGNoYW5uZWxzID0gMCwKICAgICAgICAgICAgYnBzID0gMCwKICAgICAgICAgICAgdG90YWxfc2FtcGxlcyA9IDAsCiAgICAgICAgICAgIGJsb2NrX2FsaWduOyAvLyBnZXQgV0FWL1BDTSBwYXJhbWV0ZXJzIGZyb20gZGF0YSAvIGZpbGUKCiAgICAgICAgc2FtcGxlX3JhdGUgPSAoKHVpOF9kYXRhWzI3XSA8PCA4IHwgdWk4X2RhdGFbMjZdKSA8PCA4IHwgdWk4X2RhdGFbMjVdKSA8PCA4IHwgdWk4X2RhdGFbMjRdOwogICAgICAgIGNoYW5uZWxzID0gdWk4X2RhdGFbMjJdOwogICAgICAgIGJwcyA9IHVpOF9kYXRhWzM0XTsKICAgICAgICBibG9ja19hbGlnbiA9IHVpOF9kYXRhWzMyXTsKICAgICAgICB0b3RhbF9zYW1wbGVzID0gKCgodWk4X2RhdGFbNDNdIDw8IDggfCB1aThfZGF0YVs0Ml0pIDw8IDggfCB1aThfZGF0YVs0MV0pIDw8IDggfCB1aThfZGF0YVs0MF0pIC8gYmxvY2tfYWxpZ247CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNhbXBsZV9yYXRlOiBzYW1wbGVfcmF0ZSwKICAgICAgICAgIGNoYW5uZWxzOiBjaGFubmVscywKICAgICAgICAgIGJwczogYnBzLAogICAgICAgICAgdG90YWxfc2FtcGxlczogdG90YWxfc2FtcGxlcywKICAgICAgICAgIGJsb2NrX2FsaWduOiBibG9ja19hbGlnbgogICAgICAgIH07CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqICBjb252ZXJ0cyB0aGUgUENNIGRhdGEgb2YgdGhlIHdhdiBmaWxlIChlYWNoIHNhbXBsZSBzdG9yZWQgYXMgMTYgYml0IHZhbHVlKSBpbnRvCiAgICAgICAqICBhIGZvcm1hdCBleHBlY3RlZCBieSB0aGUgbGliZmxhYy1lbmNvZGVyIG1ldGhvZCAoZWFjaCBzYW1wbGUgc3RvcmVkIGFzIDMyIGJpdCB2YWx1ZSBpbiBhIDMyLWJpdCBhcnJheSkKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gd2F2X2ZpbGVfcHJvY2Vzc2luZ19jb252ZXJ0XzE2Yml0ZGF0YV90bzMyYml0ZGF0YShhcnJheWJ1ZmZlcikgewogICAgICAgIC8vIGNvbnZlcnQgdGhlIFBDTS1EYXRhIHRvIHRoZSBhcHByb3ByaWF0ZSBmb3JtYXQgZm9yIHRoZSBsaWJmbGFjIGxpYnJhcnkgbWV0aG9kcyAoMzItYml0IGFycmF5IG9mIHNhbXBsZXMpCiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBhcnJheSAoMzItYml0KSBhbmQgc3RvcmVzIHRoZSAxNi1iaXQgZGF0YSBvZiB0aGUgd2F2LWZpbGUgYXMgMzItYml0IGRhdGEKICAgICAgICB2YXIgYWJfaTE2ID0gbmV3IERhdGFWaWV3KGFycmF5YnVmZmVyLCA0NCk7CiAgICAgICAgdmFyIGJ1Zl9sZW5ndGggPSBhYl9pMTYuYnl0ZUxlbmd0aDsKICAgICAgICB2YXIgYnVmMzJfbGVuZ3RoID0gYnVmX2xlbmd0aCAvIDI7CiAgICAgICAgdmFyIGJ1ZmZlcl9pMzIgPSBuZXcgVWludDMyQXJyYXkoYnVmMzJfbGVuZ3RoKTsKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXJfaTMyLmJ1ZmZlcik7CiAgICAgICAgdmFyIGluZGV4ID0gMDsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBidWZfbGVuZ3RoOyBqICs9IDIpIHsKICAgICAgICAgIHZpZXcuc2V0SW50MzIoaW5kZXgsIGFiX2kxNi5nZXRJbnQxNihqLCB0cnVlKSwgdHJ1ZSk7CiAgICAgICAgICBpbmRleCArPSA0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJ1ZmZlcl9pMzI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGV4cG9ydEZsYWNGaWxlKHJlY0J1ZmZlcnMsIG1ldGFEYXRhKSB7CiAgICAgICAgdmFyIHJlY0xlbmd0aCA9IGdldExlbmd0aChyZWNCdWZmZXJzKTsKCiAgICAgICAgaWYgKG1ldGFEYXRhKSB7CiAgICAgICAgICBhZGRGTEFDTWV0YURhdGEocmVjQnVmZmVycywgbWV0YURhdGEpOwogICAgICAgIH0gLy9jb252ZXJ0IGJ1ZmZlcnMgaW50byBvbmUgc2luZ2xlIGJ1ZmZlcgoKCiAgICAgICAgdmFyIHNhbXBsZXMgPSBtZXJnZUJ1ZmZlcnMocmVjQnVmZmVycywgcmVjTGVuZ3RoKTsKICAgICAgICB2YXIgdGhlX2Jsb2IgPSBuZXcgQmxvYihbc2FtcGxlc10pOwogICAgICAgIHJldHVybiB0aGVfYmxvYjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0TGVuZ3RoKHJlY0J1ZmZlcnMpIHsKICAgICAgICAvL2dldCBsZW5ndGgKICAgICAgICB2YXIgcmVjTGVuZ3RoID0gMDsKCiAgICAgICAgZm9yICh2YXIgaSA9IHJlY0J1ZmZlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgIHJlY0xlbmd0aCArPSByZWNCdWZmZXJzW2ldLmJ5dGVMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVjTGVuZ3RoOwogICAgICB9CgogICAgICBmdW5jdGlvbiBhZGRGTEFDTWV0YURhdGEoY2h1bmtzLCBtZXRhZGF0YSkgewogICAgICAgIHZhciBvZmZzZXQgPSA0OwogICAgICAgIHZhciBkYXRhID0gY2h1bmtzWzBdOyAvLzFzdCBkYXRhIGNodW5rIHNob3VsZCBjb250YWluIEZMQUMgaWRlbnRpZmllciAiZkxhQyIKCiAgICAgICAgaWYgKGRhdGEubGVuZ3RoIDwgNCB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGRhdGEuc3ViYXJyYXkoMCwgNCkpICE9ICJmTGFDIikgewogICAgICAgICAgY29uc29sZS5lcnJvcigiVW5rbm93biBkYXRhIGZvcm1hdDogY2Fubm90IGFkZCBhZGRpdGlvbmFsIEZMQUMgbWV0YSBkYXRhIHRvIGhlYWRlciIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy9maXJzdCBjaHVuayBvbmx5IGNvbnRhaW5zIHRoZSBmbGFjIGlkZW50aWZpZXIgc3RyaW5nPwoKCiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09IDQpIHsKICAgICAgICAgIGRhdGEgPSBjaHVua3NbMV07IC8vZ2V0IDJuZCBkYXRhIGNodW5rIHdoaWNoIHNob3VsZCBjb250YWluIFNUUkVBTUlORk8gbWV0YS1kYXRhIGJsb2NrIChhbmQgcHJvYmFibHkgbW9yZSkKCiAgICAgICAgICBvZmZzZXQgPSAwOwogICAgICAgIH0KCiAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoZGF0YS5idWZmZXIpOyAvL05PVEUgYnkgZGVmYXVsdCwgdGhlIGVuY29kZXIgd3JpdGVzIGEgMm5kIG1ldGEtZGF0YSBibG9jayAodHlwZSBWT1JCSVNfQ09NTUVOVCkgd2l0aCBlbmNvZGVyL3ZlcnNpb24gaW5mbyAtPiBkbyBub3Qgc2V0ICJpcyBsYXN0IiB0byBUUlVFIGZvciBmaXJzdCBvbmUKICAgICAgICAvLwkvLyB3cml0ZSAiaXMgbGFzdCBtZXRhIGRhdGEgYmxvY2siICYgdHlwZSBTVFJFQU1JTkZPIHR5cGUgKDApIGFzIGxpdHRsZSBlbmRpYW4gY29tYmluZWQgdWludDEgJiB1aW50NyAtPiB1aW50ODoKICAgICAgICAvLwl2YXIgaXNMYXN0ID0gMTsvLzEgYml0CiAgICAgICAgLy8JdmFyIHN0cmVhbUluZm9UeXBlID0gMDsvLzcgYml0CiAgICAgICAgLy8Jdmlldy5zZXRVaW50OCgwICsgb2Zmc2V0LCBpc0xhc3QgPDwgNyB8IHN0cmVhbUluZm9UeXBlLCB0cnVlKTsvLzggYml0CiAgICAgICAgLy8gYmxvY2staGVhZGVyOiBTVFJFQU1JTkZPIHR5cGUsIGJsb2NrIGxlbmd0aCAtPiBhbHJlYWR5IHNldAogICAgICAgIC8vIGJsb2NrLWNvbnRlbnQ6IG1pbl9ibG9ja3NpemUsIG1pbl9ibG9ja3NpemUgLT4gYWxyZWFkeSBzZXQKICAgICAgICAvLyB3cml0ZSBtaW5fZnJhbWVzaXplIGFzIGxpdHRsZSBlbmRpYW4gdWludDI0OgoKICAgICAgICB2aWV3LnNldFVpbnQ4KDggKyBvZmZzZXQsIG1ldGFkYXRhLm1pbl9mcmFtZXNpemUgPj4gMTYsIHRydWUpOyAvLzI0IGJpdAoKICAgICAgICB2aWV3LnNldFVpbnQ4KDkgKyBvZmZzZXQsIG1ldGFkYXRhLm1pbl9mcmFtZXNpemUgPj4gOCwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMTAgKyBvZmZzZXQsIG1ldGFkYXRhLm1pbl9mcmFtZXNpemUsIHRydWUpOyAvLzI0IGJpdAogICAgICAgIC8vIHdyaXRlIG1heF9mcmFtZXNpemUgYXMgbGl0dGxlIGVuZGlhbiB1aW50MjQ6CgogICAgICAgIHZpZXcuc2V0VWludDgoMTEgKyBvZmZzZXQsIG1ldGFkYXRhLm1heF9mcmFtZXNpemUgPj4gMTYsIHRydWUpOyAvLzI0IGJpdAoKICAgICAgICB2aWV3LnNldFVpbnQ4KDEyICsgb2Zmc2V0LCBtZXRhZGF0YS5tYXhfZnJhbWVzaXplID4+IDgsIHRydWUpOyAvLzI0IGJpdAoKICAgICAgICB2aWV3LnNldFVpbnQ4KDEzICsgb2Zmc2V0LCBtZXRhZGF0YS5tYXhfZnJhbWVzaXplLCB0cnVlKTsgLy8yNCBiaXQKICAgICAgICAvLyBibG9jay1jb250ZW50OiBzYW1wbGVSYXRlLCBjaGFubmVscywgYml0c1BlclNhbXBsZSAtPiBhbHJlYWR5IHNldAogICAgICAgIC8vIHdyaXRlIHRvdGFsX3NhbXBsZXMgYXMgbGl0dGxlIGVuZGlhbiB1aW50MzY6CiAgICAgICAgLy9UT0RPIHNldCBsYXN0IDQgYml0cyB0byBoYWxmIG9mIHRoZSB2YWx1ZSBpbiBpbmRleCAxNwoKICAgICAgICB2aWV3LnNldFVpbnQ4KDE4ICsgb2Zmc2V0LCBtZXRhZGF0YS50b3RhbF9zYW1wbGVzID4+IDI0LCB0cnVlKTsgLy8zNiBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgxOSArIG9mZnNldCwgbWV0YWRhdGEudG90YWxfc2FtcGxlcyA+PiAxNiwgdHJ1ZSk7IC8vMzYgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMjAgKyBvZmZzZXQsIG1ldGFkYXRhLnRvdGFsX3NhbXBsZXMgPj4gOCwgdHJ1ZSk7IC8vMzYgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMjEsIG1ldGFkYXRhLnRvdGFsX3NhbXBsZXMsIHRydWUpOyAvLzM2IGJpdAoKICAgICAgICB3cml0ZU1kNSh2aWV3LCAyMiArIG9mZnNldCwgbWV0YWRhdGEubWQ1c3VtKTsgLy8xNiAqIDggYml0CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1lcmdlQnVmZmVycyhjaGFubmVsQnVmZmVyLCByZWNvcmRpbmdMZW5ndGgpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkocmVjb3JkaW5nTGVuZ3RoKTsKICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKICAgICAgICB2YXIgbG5nID0gY2hhbm5lbEJ1ZmZlci5sZW5ndGg7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbG5nOyBpKyspIHsKICAgICAgICAgIHZhciBidWZmZXIgPSBjaGFubmVsQnVmZmVyW2ldOwogICAgICAgICAgcmVzdWx0LnNldChidWZmZXIsIG9mZnNldCk7CiAgICAgICAgICBvZmZzZXQgKz0gYnVmZmVyLmxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdyaXRlTWQ1KHZpZXcsIG9mZnNldCwgc3RyKSB7CiAgICAgICAgdmFyIGluZGV4OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggLyAyOyArK2kpIHsKICAgICAgICAgIGluZGV4ID0gaSAqIDI7CiAgICAgICAgICB2aWV3LnNldFVpbnQ4KGkgKyBvZmZzZXQsIHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoaW5kZXgsIGluZGV4ICsgMiksIDE2KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3RhcnRfdmlkZW9fY2FsbDogZnVuY3Rpb24gc3RhcnRfdmlkZW9fY2FsbCgpIHt9LAogICAgcmVmcmVzaF9jaGF0Ym90OiBmdW5jdGlvbiByZWZyZXNoX2NoYXRib3QodHlwZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7IC8vIGRlYnVnZ2VyOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgIGNoYXQ6ICIiLAogICAgICAgIGRhdGE6ICIiLAogICAgICAgIHVzZXJfaWQ6ICIiLAogICAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgX3RoaXMzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMy5pZmZpcnN0dGltZSkgewogICAgICAgICAgX3RoaXMzLmlmZmlyc3R0aW1lID0gZmFsc2U7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB1aWQ6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBjaGF0OiBudWxsLAogICAgICAgICAgICBub2RlX3NlbGVjdGVkOiBudWxsLAogICAgICAgICAgICBib3RfbmFtZTogX3RoaXMzLmJvdF9uYW1lLAogICAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IF90aGlzMy5jb252ZXJzYXRpb25faWQKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEuZXJyb3IpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5lcnJvciA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZ2F5YScpOwogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCiAgICAgICAgICAgICAgX3RoaXMzLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXMzLmlzY2xvc2VkYm90b24gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZSA9PSAic3VwcG9ydCIpIHsKICAgICAgICAgIF90aGlzMy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmVkOiAiSXMgdGhlcmUgYW55dGhpbmcgZWxzZSBJIGNhbiBoZWxwIHlvdSB3aXRoPyIsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBfdGhpczMuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChfdGhpczMuY29tcGFueWlkID09ICJDdXN0b21lckhhcHBpbmVzczk1MTg1IiB8fCBfdGhpczMuY29tcGFueWlkID09ICIzeDVpdmU5OTUzNCIgfHwgX3RoaXMzLmNvbXBhbnlpZCA9PSAiRm9yZWlnbnhjaGFuZ2UxNzQ5MSIgfHwgX3RoaXMzLmNvbXBhbnlpZCA9PSAiY2xpbmljYWx0cmlhbHM4MTM1MiIpIHsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgICBjaGF0OiAiL3dlbGNvbWVfbWVzc2FnZSIsCiAgICAgICAgICAgIHRva2VuOiBfdGhpczMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICB1c2VybmFtZTogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICAgIHVzZXJfaWQ6ICIiLAogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGRhdGE6ICIiLAogICAgICAgICAgICByb2xlOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiBmYWxzZQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMzLnB1c2hfbXNnKHJlc3BvbnNlLCByZXNwb25zZS5kYXRhLnJlc3BvbnNlcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb21wdF91cmwoKSwgewogICAgICAgICAgdWlkOiAiY2Vuc2UiLAogICAgICAgICAgLy90aGlzLmZpbmdlcnByaW50CiAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgY2hhdDogIiIKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gIk5PIENMT1NFRCBGT1JNIEJPVCIpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZXh0cmFzICE9IG51bGwgJiYgcmVzcG9uc2UuZGF0YS5leHRyYXNbMF0uVHlwZSA9PSAiVEFCTEUiKSB7CiAgICAgICAgICAgICAgX3RoaXMzLmNyZWF0ZV9jaGF0KHJlc3BvbnNlLmRhdGEsICJpc3RhYmxlIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXR1cm4gPT0gIlBST01QVFMiKSB7CiAgICAgICAgICAgICAgX3RoaXMzLmNyZWF0ZV9jaGF0KHJlc3BvbnNlLmRhdGEsICJpc3Byb21wdCIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHt9KTsKICAgICAgfSk7CiAgICB9LAogICAgZG93bmxvYWRfcGRmOiBmdW5jdGlvbiBkb3dubG9hZF9wZGYodXJsLCBmaWxlX25hbWUpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgZmlsZV9uYW1lKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgbGluay5jbGljaygpOwogICAgfSwKICAgIHNjcm9sbF9kaXY6IGZ1bmN0aW9uIHNjcm9sbF9kaXYoKSB7CiAgICAgIHZhciBkb2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYnV5LXByb2R1Y3RzIik7CgogICAgICBpZiAoZXZlbnQuZGVsdGFYID4gZXZlbnQuZGVsdGFZKSB7CiAgICAgICAgZG9jLnNjcm9sbExlZnQgKz0gMTA7CiAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFYIDwgZXZlbnQuZGVsdGFZKSB7CiAgICAgICAgZG9jLnNjcm9sbExlZnQgLT0gMTA7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsX3N1cHBvcnQ6IGZ1bmN0aW9uIGNhbGxfc3VwcG9ydCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKHR5cGUgPT0gIlllcyIpIHsKICAgICAgICB2YXIgX2F4aW9zJHBvc3Q7CgogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgKF9heGlvcyRwb3N0ID0gewogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgY2hhdDogIi9jYWxsX3N1cHBvcnQiCiAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAidG9rZW4iLCB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInJvbGUiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInJlZnJlc2hlZF9vcl9jbG9zZWQiLCB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfYXhpb3MkcG9zdCkpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgIF90aGlzNC5jaGF0LnB1c2goewogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICByZWNlaXZlZDogcmVzcC5kYXRhLnJlc3BvbnNlc1swXS50ZXh0LAogICAgICAgICAgICB0aW1lOiBfdGhpczQuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczQuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczQuY2hhdCk7CgogICAgICAgICAgX3RoaXM0LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiTm8iKSB7CiAgICAgICAgdGhpcy5jaGF0LnB1c2godGhpcy5jaGF0WzBdKTsKICAgICAgICB0aGlzLmNoYXQucHVzaCh0aGlzLmNoYXRbMV0pOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsgLy8gdGhpcy5yZWZyZXNoX2NoYXRib3QoInN1cHBvcnQiKTsKICAgICAgfQogICAgfSwKICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShzdHJpbmcpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL3t7Lio/fX0vZywgZnVuY3Rpb24gKG1hdGNoKSB7CiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgZGQgPSB0b2RheS5nZXREYXRlKCk7CiAgICAgICAgdmFyIG1tID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7CiAgICAgICAgdmFyIHl5eXkgPSB0b2RheS5nZXRGdWxsWWVhcigpOwoKICAgICAgICBpZiAoZGQgPCAxMCkgewogICAgICAgICAgZGQgPSAiMCIgKyBkZDsKICAgICAgICB9CgogICAgICAgIGlmIChtbSA8IDEwKSB7CiAgICAgICAgICBtbSA9ICIwIiArIG1tOwogICAgICAgIH0KCiAgICAgICAgdG9kYXkgPSBkZCArICItIiArIG1tICsgIi0iICsgeXl5eTsKICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IG1hdGNoLnNsaWNlKDIsIC0yKTsKICAgICAgICBfdGhpczUuJGRhdGFbZXhwcmVzc2lvbl0gPSB0b2RheTsKICAgICAgICByZXR1cm4gX3RoaXM1LiRkYXRhW2V4cHJlc3Npb25dOwogICAgICB9KTsKICAgIH0sCiAgICBnZW5lcmF0ZV90aW1lOiBmdW5jdGlvbiBnZW5lcmF0ZV90aW1lKCkgewogICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgIHZhciBoLCBtLCB0eXBlOwoKICAgICAgaWYgKGQuZ2V0SG91cnMoKSA+IDEyKSB7CiAgICAgICAgaCA9IGQuZ2V0SG91cnMoKSAlIDEyOwogICAgICAgIHR5cGUgPSAiIHBtIjsKICAgICAgfSBlbHNlIGlmIChkLmdldEhvdXJzKCkgPCAxMikgewogICAgICAgIGggPSBkLmdldEhvdXJzKCk7CiAgICAgICAgdHlwZSA9ICIgYW0iOwogICAgICB9IGVsc2UgaWYgKGQuZ2V0SG91cnMoKSA9PSAxMikgewogICAgICAgIGggPSBkLmdldEhvdXJzKCk7CiAgICAgICAgdHlwZSA9ICIgcG0iOwogICAgICB9CgogICAgICBtID0gZC5nZXRNaW51dGVzKCk7CgogICAgICBpZiAobSA8IDEwKSB7CiAgICAgICAgbSA9IDAgKyBTdHJpbmcobSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoICsgIjoiICsgbSArIHR5cGU7CiAgICB9LAogICAgY2FsbF9hcGk6IGZ1bmN0aW9uIGNhbGxfYXBpKCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKHRoaXMucGhvbmVfbnVtYmVyX3ZhbGlkaXR5LnRlc3QodGhpcy5waG9uZV9udW1iZXIpKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2FsbF9zdXBwb3J0X3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIHBob25lbnVtYmVyOiB0aGlzLnBob25lX251bWJlciwKICAgICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAiQ2FsbCBpbmNvbWluZyEiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJXZSB3aWxsIGdldCBpbiB0b3VjaCB3aXRoIHlvdSBzb29uLiBUaGFua3MiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBFbnRlciBhIHZhbGlkIHBob25lIG51bWJlciIpOwogICAgICB9CiAgICB9LAogICAgc2hvd19wb3B1cDogZnVuY3Rpb24gc2hvd19wb3B1cCgpIHsKICAgICAgdGhpcy5zaG93ID0gZmFsc2U7CiAgICAgIHRoaXMuc3RvcCA9IGZhbHNlOwogICAgfSwKICAgIHN1Yl9sZWFmX25vZGVfY2FsbDogZnVuY3Rpb24gc3ViX2xlYWZfbm9kZV9jYWxsKHR5cGUpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgZGl2Y2xpY2sgPSBldmVudC50YXJnZXQuaW5uZXJUZXh0OwoKICAgICAgaWYgKGRpdmNsaWNrID09ICJXYXRjaCBEZW1vIFZpZGVvIikgewogICAgICAgIHRoaXMuZGVtb3VybGJpbmQgPSB0cnVlOwogICAgICAgIHRoaXMucmV2aWV3c3VybGJpbmQgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChkaXZjbGljayA9PSAiVXNlciBSZXZpZXdzL1Rlc3RpbW9uaWFscyIpIHsKICAgICAgICB0aGlzLnJldmlld3N1cmxiaW5kID0gdHJ1ZTsKICAgICAgICB0aGlzLmRlbW91cmxiaW5kID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChkaXZjbGljayA9PSAiV2F0Y2ggRGVtbyBWaWRlbyIgfHwgZGl2Y2xpY2sgPT0gIlVzZXIgUmV2aWV3cy9UZXN0aW1vbmlhbHMiKSB7CiAgICAgICAgdGhpcy5zaG93ID0gIXRoaXMuc2hvdzsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICB9LCAxMDAwKTsKICAgICAgfSBlbHNlIGlmIChkaXZjbGljayA9PSAiQnV5IFR1dG9yaWFsIikgewogICAgICAgIHRoaXMuY2Vuc2VfZW5xdWlyeSA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgY2hhdDogIi9wZXJzb25hbF9kZXRhaWxzIiwKICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiAiIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbMF0udGV4dCwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogX3RoaXM2LmdlbmVyYXRlX3RpbWUoKQogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpczYuY2hhdC5wdXNoKG1zZyk7CgogICAgICAgICAgX3RoaXM2LnVwZGF0ZV9zY3JvbGxiYXIoKTsKCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfSwgMTAwMCk7CgogICAgICAgICAgX3RoaXM2LiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXM2LmNoYXQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdGlja2V0X251bWJlcjogZnVuY3Rpb24gdGlja2V0X251bWJlcigpIHsKICAgICAgdmFyIHJhbmRvbV9udW0gPSBNYXRoLmZsb29yKDEwMDAwMDAgKyBNYXRoLnJhbmRvbSgpICogOTAwMDAwMCk7CiAgICAgIHZhciBjb21wYW55ID0gdGhpcy5jb21wYW55bmFtZS5zbGljZSgwLCAxKS50b1VwcGVyQ2FzZSgpOwogICAgICByZXR1cm4gY29tcGFueSArICJfIiArIHJhbmRvbV9udW07CiAgICB9LAogICAgc2VuZF9tZXNzYWdlOiBmdW5jdGlvbiBzZW5kX21lc3NhZ2UodHlwZSwgbWVzc2FnZSwgdG9fYmVfZGlzcGxheWVkKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgLy9oYXJzaAogICAgICAvLyBkZWJ1Z2dlcjsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2luZGljYXRpb25bMF0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdHlwZSA9ICJpc19wcm9tcHQiOwogICAgICAgIHRvX2JlX2Rpc3BsYXllZCA9IHRoaXMudG9fc2VuZDsKICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnNlbGVjdGVkX2luZGljYXRpb25bMF0udmFsdWUuc3BsaXQoInsiKVswXSArIEpTT04uc3RyaW5naWZ5KHRoaXMucmVzKTsKICAgICAgICB0aGlzLnNlbGVjdGVkX2luZGljYXRpb24gPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNjbG9zZWRib3RvbiAmJiB0eXBlICE9ICdpc19idXR0b24nKSB7CiAgICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLnN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiaXNfYnV0dG9uIikgewogICAgICAgICQoIiNyZXNwb25zZV9ib3RfdGV4dCIpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwoKICAgICAgICBpZiAobWVzc2FnZS52YWx1ZSA9PSAiaXNkaXNhYmxlZCIgJiYgdGhpcy5jb21wYW55aWQgPT0gImNsaW5pY2FsdHJpYWxzODEzNTIiICYmIG1lc3NhZ2UudGl0bGUgPT0gIk5vIikge30gZWxzZSBpZiAodGhpcy5pc2Nsb3NlZGJvdG9uKSB7CiAgICAgICAgICB0aGlzLnN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhKHR5cGUsIG1lc3NhZ2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaW5kZXggPSB0b19iZV9kaXNwbGF5ZWQ7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICBzZW50OiBtZXNzYWdlLnRpdGxlLAogICAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgICAgZHJvcGRvd246ICIiCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAic2VuZGVyIik7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgICAgY2hhdDogbWVzc2FnZS52YWx1ZSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgICAgcmVmcmVzaGVkX29yX2Nsb3NlZDogdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAoX3RoaXM3LmNoYXRbaW5kZXhdLnJlbW92YWJsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM3LmNoYXQuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXM3LnJlc3BvbnNlX2hhbmRsaW5nKHJlc3BvbnNlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJpc19wcm9tcHQiKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICBzZW50OiB0b19iZV9kaXNwbGF5ZWQsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAic2VuZGVyIik7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICAvLyBob3N0OiB0aGlzLnVzZXJfZGF0YS5ob3N0LAogICAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnJlc3BvbnNlX2hhbmRsaW5nKHJlc3BvbnNlKTsKCiAgICAgICAgICBfdGhpczcuZXgxKCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy50b19zZW5kID09ICJSZXN0YXJ0IiB8fCB0aGlzLnRvX3NlbmQgPT0gInJlc3RhcnQiKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvbXB0X3VybCgpLCB7CiAgICAgICAgICB1aWQ6ICJjZW5zZSIsCiAgICAgICAgICAvL3RoaXMuZmluZ2VycHJpbnQKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGNoYXQ6ICIiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNy5jaGF0LnB1c2gocmVzcG9uc2UuZGF0YSk7CgogICAgICAgICAgX3RoaXM3LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CgogICAgICAgICAgX3RoaXM3LiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXM3LmNoYXQpOwoKICAgICAgICAgIF90aGlzNy5maXJzdF9jbGljayA9IHRydWU7CiAgICAgICAgICBfdGhpczcubGV2ZWwgPSByZXNwb25zZS5kYXRhLmxldmVsOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7fSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jZW5zZV9lbnF1aXJ5ID09IHRydWUgJiYgdGhpcy50b19zZW5kICE9ICIiICYmIHRoaXMudG9fc2VuZCAhPSBudWxsICYmICEvXlxzKiQvLnRlc3QodGhpcy50b19zZW5kKSkgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgdmFyIHNlbmRfbXNnID0gewogICAgICAgICAgc2VudDogdGhpcy50b19zZW5kLAogICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICB9OwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHNlbmRfbXNnKTsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIik7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgY2hhdDogIi9wZXJzb25hbF9kZXRhaWxzIiwKICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICB1c2VyX2lkOiAiIiwKICAgICAgICAgIGNvbXBhbnlfaWQ6ICJDTzAwMDIzIiwKICAgICAgICAgIGRhdGE6ICIiLAogICAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiAiIiwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzWzBdLnRleHQsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IF90aGlzNy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgIH07CgogICAgICAgICAgX3RoaXM3LmNoYXQucHVzaChtc2cpOwoKICAgICAgICAgIF90aGlzNy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzNy5jaGF0KTsKCiAgICAgICAgICBfdGhpczcucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzNy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5saXZlX2NoYXRfb24pIHsKICAgICAgICBpZiAodGhpcy51c2VyX25hbWUgPT0gIiIpIHsKICAgICAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJuZXdfbmFtZSIsIHsKICAgICAgICAgICAgbmFtZTogdGhpcy50b19zZW5kCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudXNlcl9uYW1lID0gdGhpcy50b19zZW5kOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaCgibmV3X2NoYXRfbWVzc2FnZSIsIHsKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy50b19zZW5kCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgIT0gIiIgJiYgdGhpcy50b19zZW5kICE9IG51bGwgJiYgdGhpcy5jZW5zZV9lbnF1aXJ5ICE9IHRydWUpIHsKICAgICAgICB2YXIgX2F4aW9zJHBvc3QyOwoKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAic2VuZGVyIik7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3QyID0gewogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgY2hhdDogdGhpcy50b19zZW5kCiAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInRva2VuIiwgdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAicm9sZSIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInJlZnJlc2hlZF9vcl9jbG9zZWQiLCB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfYXhpb3MkcG9zdDIpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnJlc3BvbnNlX2hhbmRsaW5nKHJlc3BvbnNlKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM3LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMudG9fc2VuZCA9ICIiOwogICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICB9LAogICAgaW5pdGlhdGVfc3VwcG9ydF9jaGF0OiBmdW5jdGlvbiBpbml0aWF0ZV9zdXBwb3J0X2NoYXQoKSB7CiAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6ICJTb3JyeSBJIGFtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iLAogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiAiV291bGQgeW91IGxpa2UgdG8gdGFsayB3aXRoIHN1cHBvcnQgdGVhbT8iLAogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIHNob3dfYnV0dG9uczogdHJ1ZSwKICAgICAgICBzdXBwb3J0X2J1dHRvbnM6IHRydWUsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfSk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBkaXNjb25uZWN0X3N1cHBvcnRfY2hhdDogZnVuY3Rpb24gZGlzY29ubmVjdF9zdXBwb3J0X2NoYXQoKSB7CiAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJzdG9wcGVkX2NoYXQiLCB7CiAgICAgICAgbmFtZTogdGhpcy51c2VyX25hbWUsCiAgICAgICAgbWVzc2FnZTogIiBoYXMgZW5kZWQgdGhlIGNvbnZlcnNhdGlvbi4iCiAgICAgIH0pOwogICAgICB0aGlzLmNoYW5uZWwubGVhdmUoKTsKICAgICAgdGhpcy5jaGF0X3NvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgIHRoaXMubGl2ZV9jaGF0X29uID0gZmFsc2U7CiAgICB9LAogICAgY2hhdF9yZXNwb25zZV9lcnJvcjogZnVuY3Rpb24gY2hhdF9yZXNwb25zZV9lcnJvcigpIHsKICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogIlNvcnJ5IEknbSBub3QgZ2V0dGluZyB5b3VyIHF1ZXN0aW9uIiwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9KTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBzZW5kX3JlcXVlc3RfanNvbjogZnVuY3Rpb24gc2VuZF9yZXF1ZXN0X2pzb24obWVzc2FnZSkgewogICAgICB2YXIgX2F4aW9zJHBvc3QzLAogICAgICAgICAgX3RoaXM4ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgKF9heGlvcyRwb3N0MyA9IHsKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJ0b2tlbiIsIHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgInJvbGUiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgImNoYXQiLCAiIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJzb3VyY2UiLCAiV2ViIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDMsICJkYXRhIiwgdGhpcy5qc29uX2RhdGFbbWVzc2FnZS5yZXNwb25zZXNbMF0uaW50ZW50XSksIF9heGlvcyRwb3N0MykpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBfdGhpczguY2hhdC5wdXNoKHsKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgcmVjZWl2ZWQ6IHJlc3AuZGF0YS5yZXNwb25zZXMubGVuZ3RoID09IDAgPyAiU29ycnkgSSdtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iIDogcmVzcC5kYXRhLnJlc3BvbnNlc1swXS50ZXh0LAogICAgICAgICAgdGltZTogX3RoaXM4LmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGltYWdlOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLmltZyA9PSAiIiA/IG51bGwgOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLmltZwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczguJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczguY2hhdCk7CgogICAgICAgIF90aGlzOC51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICB9KTsKICAgIH0sCiAgICByZXNwb25zZV9oYW5kbGluZzogZnVuY3Rpb24gcmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UsIHR5cGUpIHsKICAgICAgdmFyIGkgPSAwOwogICAgICB2YXIgZGVsYXkgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0Lmxlbmd0aCA+IDEwID8gMjAwMCA6IDUwMDsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaGFuZGxlX3Jlc3BvbnNlKCk7CiAgICAgIH0sIGRlbGF5KTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZV9yZXNwb25zZSgpIHsKICAgICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCB8fCByZXNwb25zZS5kYXRhLnJlc3BvbnNlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB2bS5jaGF0X3Jlc3BvbnNlX2Vycm9yKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnJlcXVlc3RfanNvbiAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmVxdWVzdF9qc29uID09IHRydWUpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gbnVsbCkgewogICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LAogICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgICAgaW1hZ2U6IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmltZywKICAgICAgICAgICAgICAgIHZpZGVvOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZtLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdm0uY2hhdCk7CiAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmludGVudCA9PSAiZ29neWI0NTBfY3JlYXRlX3RpY2tldCIpIHsKICAgICAgICAgICAgICB2YXIgX2F4aW9zJHBvc3Q0OwoKICAgICAgICAgICAgICB2YXIgbmFtZTsKCiAgICAgICAgICAgICAgaWYgKHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZmlyc3RfbmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lICsgIiAiICsgdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5sYXN0X25hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS4kc2Vzc2lvbi5oYXMoIlVzZXJGaXJzdE5hbWUiKSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHZtLiRzZXNzaW9uLmdldCgiVXNlckZpcnN0TmFtZSIpICsgIiAiICsgdm0uJHNlc3Npb24uZ2V0KCJVc2VyTGFzdE5hbWUiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgdXNlcm5hbWU6IG5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHZtLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdm0uY29tcGFueWlkLAogICAgICAgICAgICAgICAgdXNlcl9yb2xlOiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICAgICAgICBlbWFpbDogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgdGlja2V0X2lzc3VlOiAiIiwKICAgICAgICAgICAgICAgIHRpY2tldF9udW1iZXI6IHZtLnRpY2tldF9udW1iZXIoKSwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgIGZpbGVfY29udGVudDogbnVsbCwKICAgICAgICAgICAgICAgIGZpbGVfbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgIGlzRWRpdDogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTsKICAgICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIChfYXhpb3MkcG9zdDQgPSB7CiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB2bS5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgICAgICB1c2VybmFtZTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJ0b2tlbiIsIHZtLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJyb2xlIiwgdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgInJlZnJlc2hlZF9vcl9jbG9zZWQiLCB2bS5yZWZyZXNoZWRfb3JfY2xvc2VkKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgImNoYXQiLCAiIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJzb3VyY2UiLCAiV2ViIiksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDQsICJkYXRhIiwgcGF5bG9hZCksIF9heGlvcyRwb3N0NCkpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwLmRhdGEucmVzcG9uc2VzLmxlbmd0aCA9PSAwID8gIlNvcnJ5IEknbSBub3QgZ2V0dGluZyB5b3VyIHF1ZXN0aW9uIiA6IHJlc3AuZGF0YS5yZXNwb25zZXNbaV0udGV4dCwKICAgICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgICAgICBpbWFnZTogcmVzcC5kYXRhLnJlc3BvbnNlc1tpXS5pbWcsCiAgICAgICAgICAgICAgICAgIHZpZGVvOiByZXNwLmRhdGEucmVzcG9uc2VzW2ldLnZpZGVvICE9IG51bGwgPyByZXNwLmRhdGEucmVzcG9uc2VzW2ldLnZpZGVvIDogbnVsbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2bS4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHZtLmNoYXQpOwogICAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbnRlbnQgPT0gImNyZWF0ZV9hcHBvaW50bWVudCIpIHsKICAgICAgICAgICAgICB2YXIgdG9kYXlfZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfYXBwb2ludG1lbnRfdXJsKCksIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdm0uY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB2bS5jb21wYW55aWQsCiAgICAgICAgICAgICAgICBEYXRlOiB0b2RheV9kYXRlLmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAodG9kYXlfZGF0ZS5nZXRNb250aCgpIDwgOSA/ICIwIiArICh0b2RheV9kYXRlLmdldE1vbnRoKCkgKyAxKSA6IHRvZGF5X2RhdGUuZ2V0TW9udGgoKSArIDEpICsgIi0iICsgdG9kYXlfZGF0ZS5nZXREYXRlKCkgLy9Nb250aCBvYmplY3QgZG9jdW1lbnQgaXQKICAgICAgICAgICAgICAgIC8vIERhdGU6IHN0YXJ0X3RpbWUsCgogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7Ly8gdGhpcy50aW1lX3Nsb3RzID0gdGhpcy5mdWxsX3RpbWVfc2xvdHM7CiAgICAgICAgICAgICAgICAvLyBpZiAocmVzcG9uc2UuZGF0YS5TbG90ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgLy8gICBpZiAocmVzcG9uc2UuZGF0YS5TbG90Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIC8vICAgICBsZXQgaW5kZXg7CiAgICAgICAgICAgICAgICAvLyAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLlNsb3QpIHsKICAgICAgICAgICAgICAgIC8vICAgICAgIGluZGV4ID0gdGhpcy50aW1lX3Nsb3RzLmluZGV4T2YocmVzcG9uc2UuZGF0YS5TbG90W2ldKTsKICAgICAgICAgICAgICAgIC8vICAgICAgIGlmIChpbmRleCAhPSAtMSkgewogICAgICAgICAgICAgICAgLy8gICAgICAgICB0aGlzLnRpbWVfc2xvdHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgIC8vICAgICAgIH0KICAgICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgey8vIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZtLnNlbmRfcmVxdWVzdF9qc29uKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnJldHVybl9pbnRlbnQgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnJldHVybl9pbnRlbnQgPT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgX2F4aW9zJHBvc3Q1OwoKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3Q1ID0gewogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB2bS5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgICAgdXNlcm5hbWU6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NSwgInRva2VuIiwgdm0uYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NSwgInJvbGUiLCB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAicmVmcmVzaGVkX29yX2Nsb3NlZCIsIHZtLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAiY2hhdCIsICIvIiArIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmludGVudCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDUsICJzb3VyY2UiLCAiV2ViIiksIF9heGlvcyRwb3N0NSkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgdm0uaGFuZGxlX3Jlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHZtLmNvbXBhbnlpZCA9PSAiM3g1aXZlOTk1MzQiICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmludGVudCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ID09ICJjb25mdXNpb24iKSB7CiAgICAgICAgICAgIHZtLmNvbmZ1c2lvbl9tZXNzYWdlKCIvbmVlZF9oZWxwIik7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmJ1dHRvbnMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZtLmxvYWRfYnV0dG9ucyhyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXSwgaSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmN1c3RvbSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy9DSGFuZ2UgIHRoZSBjb25kaXRpb24gaGVyZQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tLnR5cGUgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmN1c3RvbS50eXBlID09ICJtdWx0aXNlbGVjdF9kcm9wZG93biIpIHsKICAgICAgICAgICAgICB2bS5tdWx0aXNlbGVjdF9sb2FkKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLCBpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5jdXN0b20udHlwZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tLnR5cGUgPT0gInRhYmxlIikgewogICAgICAgICAgICAgIHZtLmxvYWRfdGFibGUocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0sIGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vdGhpcyBvbmUgZm9yIGZvcmVpZ254Y2hhbmdlCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC50b0xvd2VyQ2FzZSgpID09ICJzb3JyeSBpIGFtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iIHx8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQudG9Mb3dlckNhc2UoKSA9PSAiaXMgdGhlcmUgYW55dGhpbmcgaSBjYW4gaGVscCB5b3Ugd2l0aD8iKSkgewogICAgICAgICAgICAgIGlmICh2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5ID09ICIuZUp4VGNzc3ZTczFNejZ0SXprak1TMDgxTkRleE5JUUtLVURGTWtwS0NvcXQ5UFhMeTh2MTBsQlU2eVhuNS1vbGx1b2JHUmhhNmhxWTZ4cVlLQmdhV0JrWlc1bWE2aG1ibTVnWW1Tb0JBR2E5SHAwLlhSM1R1dy5YNzdGXzdMRHRPTHAyVnQ5c25GRFNvMzFuVHciIHx8IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkgPT0gIi5lSnhUY2k0dExzblBUUzN5U0N3b3lNeExMUzYyTkRXME1JV0pLc0NGTTBwS0NvcXQ5UFhMeTh2MWtqT0tFX1VTVV9XTkRBd3RkUTNNZFEyTkZBd05yWURJeEZ6UHhNVFMwdEpJQ1FCalp4dXguWFNocTh3LlBnbzVjbUt3TVFGbllVc3NjcG9qd0VxRFhRdyIpIHsKICAgICAgICAgICAgICAgIHZtLmluaXRpYXRlX3N1cHBvcnRfY2hhdCgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiAiU29ycnkgSSBhbSBub3QgZ2V0dGluZyB5b3VyIHF1ZXN0aW9uIiwKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IHZtLmdlbmVyYXRlX3RpbWUoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICB0aW1lOiBpID09IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzLmxlbmd0aCAtIDEgPyB2bS5nZW5lcmF0ZV90aW1lKCkgOiBudWxsCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2ZWQgPSAiU29ycnkgd2UgYXJlIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24uIjsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZpbmcgPSB0cnVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC5pbmNsdWRlcygiLnBkZiIpKSB7CiAgICAgICAgICAgICAgICB2bS5kaXNwbGF5X3BkZl9jaGF0KHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCAhPSB1bmRlZmluZWQgJiYgIXJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQuaW5jbHVkZXMoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSIpKSB7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2ZWQgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0OwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBtc2cuaW1hZ2UgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbWc7CiAgICAgICAgICAgICAgICBtc2cudmlkZW9zID0gcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udmlkZW8gPT0gbnVsbCA/IFtdIDogcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udmlkZW87CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2gobXNnKTsKCiAgICAgICAgICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZtLnRvX3Njcm9sbCA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuY2hpbGRyZW4oKS5sYXN0KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpID4gMC41ICYmICQoIi5yZWNlaXZlciIpLmxhc3QoKS5wYXJlbnQoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNikgewogICAgICAgICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDAuOSAqICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjc1ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgLSAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikgIT0gMCkgewogICAgICAgICAgICAgICAgICB2bS50b19zY3JvbGwgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ID09ICJjaGF0X3N1cHBvcnQiKSB7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9ICJJIGFtIGNvbm5lY3RpbmcgeW91IHRvIG9uZSBvZiBvdXIgc3VwcG9ydCBhZ2VudHMuIFBsZWFzZSB3YWl0IGZvciBhIHdoaWxlLiI7CiAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgICAgdm0uY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiAiV2hhdCdzIHlvdXIgbmFtZT8iLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgICBheGlvcy5nZXQoYXBpX2NhbGxzLmNoYXRfZ3JvdXBfYXBpKCkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIHZtLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgICAgICAgICAgICAgICB2bS5saXZlX2NoYXRfdG9rZW4gPSByZXNwb25zZS5kYXRhLnRva2VuOwogICAgICAgICAgICAgICAgICB2bS5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICB2bS5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULCB7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICBjb21wYW55OiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgIGNoYXRfZ3JvdXBfbmFtZTogdm0uY2hhdF9ncm91cF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgdG9rZW46IHZtLmxpdmVfY2hhdF90b2tlbgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYXRfc29ja2V0LmNvbm5lY3QoKTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbCA9IHZtLmNoYXRfc29ja2V0LmNoYW5uZWwoImN1c3RvbWVyc19ncm91cHM6IiArIHZtLmNoYXRfZ3JvdXBfbmFtZSk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYW5uZWwuam9pbigpOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsLnB1c2goImN1c3RvbWVyX25lZWRzX3N1cHBvcnRfYWdlbnQiKTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigibmV3X2NoYXRfbWVzc2FnZSIsIGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnNlbmRlciAhPSAiY3VzdG9tZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXMubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigic3RvcHBlZF9jaGF0IiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiAiU3VwcG9ydCBhZ2VudCAiICsgcmVzLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBfdGhpczkuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdm0ubGl2ZV9jaGF0X29uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYW5uZWwub24oInN0YXJ0ZWRfdHlwaW5nIiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIHZtLmlzX3R5cGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYW5uZWwub24oInN0b3BwZWRfdHlwaW5nIiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIHZtLmlzX3R5cGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LmluY2x1ZGVzKCJEb3dubG9hZCB5b3VyIG1hbmlmZXN0IGhlcmUiKSB8fCByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LmluY2x1ZGVzKC8ucGRmLykpKSB7CiAgICAgICAgICAgICAgICB2bS5kaXNwbGF5X3BkZl9jaGF0KHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnByb2R1Y3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHZtLmRpc3BsYXlfcHJvZHVjdHNfY2hhdChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgaWYgKGkgPCByZXNwb25zZS5kYXRhLnJlc3BvbnNlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIGkgKz0gMTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgZGVsYXkgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0Lmxlbmd0aCA+IDEwID8gMjAwMCA6IDUwMDsKICAgICAgICAgICAgaGFuZGxlX3Jlc3BvbnNlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZGVsYXkpOwogICAgICB9CiAgICB9LAogICAgcHVzaF9tc2c6IGZ1bmN0aW9uIHB1c2hfbXNnKHJlc3BvbnNlcywgcmVzcG9uc2UpIHsKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIGRlbGF5ID0gcmVzcG9uc2VbaW5kZXhdLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICBwdXNoX2NoYXQocmVzcG9uc2VbaW5kZXhdLCBkZWxheSk7CiAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CgogICAgICBmdW5jdGlvbiBwdXNoX2NoYXQobXNnLCB0aW1lX2RlbGF5KSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCiAgICAgICAgICBpZiAocmVzcG9uc2VzLmRhdGEucmVzcG9uc2VzW2luZGV4XS5idXR0b25zICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2bS5sb2FkX2J1dHRvbnMocmVzcG9uc2VzLmRhdGEucmVzcG9uc2VzW2luZGV4XSwgImlzX2J1dHRvbiIsICJ3ZWxjb21lX21lc3NhZ2UiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgIHJlY2VpdmVkOiBtc2cudGV4dCwKICAgICAgICAgICAgICB0aW1lOiBpbmRleCA9PSByZXNwb25zZS5sZW5ndGggLSAxID8gdm0uZ2VuZXJhdGVfdGltZSgpIDogdW5kZWZpbmVkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgICQoIi50aW1lIikubGFzdCgpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgiLnRpbWUiKS5sYXN0KCkuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7CgogICAgICAgICAgICBpZiAoaW5kZXggPCByZXNwb25zZS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgaW5kZXggKz0gMTsKICAgICAgICAgICAgICBkZWxheSA9IHJlc3BvbnNlW2luZGV4XS50ZXh0Lmxlbmd0aCA+IDEwID8gMjAwMCA6IDUwMDsKICAgICAgICAgICAgICBwdXNoX2NoYXQocmVzcG9uc2VbaW5kZXhdLCBkZWxheSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzEnKTsKICAgICAgICAgICAgICB2bS5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfSwgdGltZV9kZWxheSk7CiAgICAgIH0KICAgIH0sCiAgICBjb25mdXNpb25fbWVzc2FnZTogZnVuY3Rpb24gY29uZnVzaW9uX21lc3NhZ2UobXNnX3N0cmluZykgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICBjaGF0OiBtc2dfc3RyaW5nLAogICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBkYXRhOiAiIiwKICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiBmYWxzZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTAucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwogICAgICB9KTsKICAgIH0sCiAgICBmaXhfYXBwb2ludG1lbnQ6IGZ1bmN0aW9uIGZpeF9hcHBvaW50bWVudCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0sCiAgICBkaXNwbGF5X3Byb2R1Y3RzX2NoYXQ6IGZ1bmN0aW9uIGRpc3BsYXlfcHJvZHVjdHNfY2hhdChtZXNzYWdlKSB7CiAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfTsKICAgICAgbXNnLmlzcHJvZHVjdCA9IHRydWU7CiAgICAgIG1zZy5lbGVtZW50cyA9IG1lc3NhZ2U7CiAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICB9LAogICAgZGlzcGxheV9wZGZfY2hhdDogZnVuY3Rpb24gZGlzcGxheV9wZGZfY2hhdChtZXNzYWdlKSB7CiAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfTsKCiAgICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCJEb3dubG9hZCB5b3VyIG1hbmlmZXN0IGhlcmUgIikpIHsKICAgICAgICB2YXIgdGVtcCA9IG1lc3NhZ2Uuc3BsaXQoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSAiKTsKICAgICAgICBtc2cudXJsID0gdGVtcFsxXTsKICAgICAgICBtc2cucmVjZWl2aW5nID0gZmFsc2U7CiAgICAgICAgbXNnLmZpbGVfbmFtZSA9IG1lc3NhZ2Uuc3BsaXQoL14uKltcXFwvXS8pWzFdOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB1cmwgPSBtZXNzYWdlLm1hdGNoKC8oKChbQS1aYS16XXszLDl9Oig/OlwvXC8pPykoPzpbXC07OiY9XCtcJCxcd10rQCk/W0EtWmEtejAtOVwuXC1dK3woPzp3d3dcLnxbXC07OiY9XCtcJCxcd10rQClbQS1aYS16MC05XC5cLV0rKSgoPzpcL1tcK34lXC9cLlx3XC1fXSopP1w/Pyg/OltcLVwrPSY7JUBcLlx3X10qKSM/KD86W1wuXCFcL1xcXHddKikpPykvZylbMF07CiAgICAgICAgbXNnLnVybCA9IHVybDsKICAgICAgICBtc2cucmVjZWl2aW5nID0gZmFsc2U7CiAgICAgICAgbXNnLmZpbGVfbmFtZSA9IHVybC5zcGxpdCgvXi4qW1xcXC9dLylbMV07CiAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgIH0KICAgIH0sCiAgICBnZW5lcmF0ZV9wYXltZW50OiBmdW5jdGlvbiBnZW5lcmF0ZV9wYXltZW50KHByaWNlLCBuYW1lKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgIGtleTogInJ6cF90ZXN0X1NuRFRhUG5uY2ZsaUR0IiwKICAgICAgICBhbW91bnQ6IHByaWNlICogMTAwLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBuYW1lOiAiQ2Vuc2UgQUkiLAogICAgICAgIGN1cnJlbmN5OiAiSU5SIiwKICAgICAgICBkZXNjcmlwdGlvbjogIkluc3RpbGwgSW50ZWxsaWdlbmNlIiwKICAgICAgICBpbWFnZTogIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIiwKICAgICAgICAvLyBDT01QQU5ZIExPR08KICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgY29udGFjdCA9ICQoJyNjb250YWN0W3R5cGU9InRlbCJdJykudmFsdWU7CiAgICAgICAgICB2YXIgZW1haWwgPSAkKCcjZW1haWxbdHlwZT0iZW1haWwiXScpLnZhbHVlOwogICAgICAgICAgdm0ucGF5bWVudGlkID0gcmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZDsKCiAgICAgICAgICBpZiAodHJhbnNmZXJfYWNjb3VudCAhPSBudWxsKSB7CiAgICAgICAgICAgIHZtLnRyYW5zZmVyX3BheW1lbnQodHJhbnNmZXJfYWNjb3VudCwgcHJpY2UgKiAxMDAsICJJTlIiLCBuYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHByZWZpbGw6IHsKICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgLy8gcGFzcyBjdXN0b21lciBuYW1lCiAgICAgICAgICBlbWFpbDogIiIsCiAgICAgICAgICAvLyBjdXN0b21lciBlbWFpbAogICAgICAgICAgY29udGFjdDogIiIgLy9jdXN0b21lciBwaG9uZSBuby4KCiAgICAgICAgfSwKICAgICAgICBub3RlczogewogICAgICAgICAgYWRkcmVzczogImFkZHJlc3MiIC8vY3VzdG9tZXIgYWRkcmVzcwoKICAgICAgICB9LAogICAgICAgIHRoZW1lOiB7CiAgICAgICAgICBjb2xvcjogIiMyODM3NzciIC8vIHNjcmVlbiBjb2xvcgoKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciByenAxID0gbmV3IFJhem9ycGF5KG9wdGlvbnMpOwogICAgICByenAxLm9wZW4oKTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0sCiAgICB0cmFuc2Zlcl9wYXltZW50OiBmdW5jdGlvbiB0cmFuc2Zlcl9wYXltZW50KGFjY291bnQsIGFtb3VudCwgY3VycmVuY3ksIG5hbWUpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdCgiaHR0cHM6Ly9hcGkucmF6b3JwYXkuY29tLzEvdHJhbnNmZXJzIiwgewogICAgICAgIGF1dGg6IHsKICAgICAgICAgIHJ6cF90ZXN0X1NuRFRhUG5uY2ZsaUR0OiAibGx4RUtiZ0FCSDhMeDRYQXBleDljR3pqIgogICAgICAgIH0sCiAgICAgICAgZGF0YTogewogICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgIGFtb3VudDogYW1vdW50LAogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5CiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGlmKHRoaXMudXNlcl9kYXRhLmFwaV9rZXkhPScnKSB7CiAgICAgICAgX3RoaXMxMS5zaG9waWZ5X29yZGVyX2NyZWF0ZShuYW1lKTsgLy8gfQoKICAgICAgfSk7CiAgICB9LAogICAgc2hvcGlmeV9vcmRlcl9jcmVhdGU6IGZ1bmN0aW9uIHNob3BpZnlfb3JkZXJfY3JlYXRlKG5hbWUpIHt9LAogICAgY2xpY2tfcHJvbXB0OiBmdW5jdGlvbiBjbGlja19wcm9tcHQodHlwZSkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB0aGlzLmxpdmVfY2hhdF9vbiA9IGZhbHNlOwogICAgICB2YXIgZGl2Y2xpY2twb3B1cCA9IGV2ZW50LnRhcmdldC5pbm5lclRleHQ7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgfSwgNTAwKTsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCiAgICAgIGlmICh0eXBlICE9ICJjb2xsYXBzaWJsZSIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wcm9tcHRfdXJsKCksIHsKICAgICAgICAgIHVpZDogImNlbnNlIiwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGNoYXQ6IGV2ZW50LnRhcmdldC5pbm5lclRleHQsCiAgICAgICAgICBsZXZlbDogZXZlbnQudGFyZ2V0LmF0dHJpYnV0ZXMudmFsdWUubm9kZVZhbHVlCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvbGxhcHNpYmxlID09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXMxMi5jcmVhdGVfY2hhdChyZXNwb25zZS5kYXRhLCAiaXNwcm9tcHQiKTsKCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5leHRyYXMgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEuZXh0cmFzWzBdLlR5cGUgPT0gIlRBQkxFIikgewogICAgICAgICAgICBfdGhpczEyLmNyZWF0ZV9jaGF0KHJlc3BvbnNlLmRhdGEsICJpc3RhYmxlIik7CgogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAiT29wcyEgU29tZXRoaW5nIHdlbnQgd3JvbmchIikgewogICAgICAgICAgICAgIF90aGlzMTIuY3JlYXRlX2NoYXQocmVzcG9uc2UuZGF0YSwgImlzcHJvbXB0Iik7CgogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJPb3BzISBTb21ldGhpbmcgd2VudCB3cm9uZyEiKSB7CiAgICAgICAgICAgICAgX3RoaXMxMi5jaGF0LnB1c2gocmVzcG9uc2UuZGF0YSk7CgogICAgICAgICAgICAgIF90aGlzMTIuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczEyLmNoYXQpOwoKICAgICAgICAgICAgICBfdGhpczEyLnVwZGF0ZV9zY3JvbGxiYXIoKTsKCiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiY29sbGFwc2libGUiKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvbXB0X3VybCgpLCB7CiAgICAgICAgICB1aWQ6ICJjZW5zZSIsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBjaGF0OiAiIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEyLmNoYXQucHVzaChyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgICBfdGhpczEyLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CgogICAgICAgICAgX3RoaXMxMi4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzMTIuY2hhdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBidXR0b25fZmlsbDogZnVuY3Rpb24gYnV0dG9uX2ZpbGwoKSB7CiAgICAgIGlmICh0aGlzLmlzZXhjaGFuZ2UpIHsKICAgICAgICBpZiAodGhpcy50b19zZW5kID09ICIiKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiM4YThhOGE2MyI7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgIT0gIiIpIHsKICAgICAgICAgIGlmICh0aGlzLmxpdmVfY2hhdF9vbikgewogICAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaCgic3RhcnRlZF90eXBpbmciKTsKICAgICAgICAgICAgdGhpcy5zdG9wX3R5cGluZyh0aGlzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiNmZGNmMzgiOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdGhpcy5pc2V4Y2hhbmdlKSB7CiAgICAgICAgaWYgKHRoaXMudG9fc2VuZCA9PSAiIikgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbmRfYnV0dG9uIikuc3R5bGUuZmlsbCA9ICIjOGE4YThhNjMiOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy50b19zZW5kICE9ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy5saXZlX2NoYXRfb24pIHsKICAgICAgICAgICAgdGhpcy5jaGFubmVsLnB1c2goInN0YXJ0ZWRfdHlwaW5nIik7CiAgICAgICAgICAgIHRoaXMuc3RvcF90eXBpbmcodGhpcyk7CiAgICAgICAgICB9CgogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbmRfYnV0dG9uIikuc3R5bGUuZmlsbCA9ICIjMjczNjc5IjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdG9wX3R5cGluZzogZGVib3VuY2UoZnVuY3Rpb24gKHZtKSB7CiAgICAgIHZtLmNoYW5uZWwucHVzaCgic3RvcHBlZF90eXBpbmciKTsKICAgIH0sIDUwMDApLAogICAgc2Nyb2xsX2Rvd246IGZ1bmN0aW9uIHNjcm9sbF9kb3duKCkgewogICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWJvZHkiKS5zY3JvbGxUb3AgLSAkKCIuY2hhdC1oaXMiKS5sYXN0KCkuaGVpZ2h0KCkgPD0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLmNsaWVudEhlaWdodCkgewogICAgICAgIHRoaXMudG9fc2Nyb2xsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b19zY3JvbGwgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgbG9hZF9idXR0b25zOiBmdW5jdGlvbiBsb2FkX2J1dHRvbnMobWVzc2FnZSwgaW5kZXgsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgIGJ1dHRvbl9wcmVmaXg6IG1lc3NhZ2UucHJlZml4LAogICAgICAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogbWVzc2FnZS50ZXh0LAogICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICB9OwoKICAgICAgaWYgKG1lc3NhZ2UuYnV0dG9ucy5sZW5ndGggPT0gMykgewogICAgICAgIGlmIChtZXNzYWdlLmJ1dHRvbnNbMF0udGl0bGUgPT0gIkV4Y2hhbmdlIFJhdGUiICYmIG1lc3NhZ2UuYnV0dG9uc1sxXS50aXRsZSA9PSAiVHJhY2sgTXkgUGFyY2VsIiAmJiBtZXNzYWdlLmJ1dHRvbnNbMl0udGl0bGUgPT0gIkNhbGwgSGVscGRlc2siKSB7CiAgICAgICAgICBtc2cucmVtb3ZhYmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobWVzc2FnZS50ZXh0ID09ICJXb3VsZCB5b3UgbGlrZSB0byBzaGFyZSB5b3VyIG5hbWUgYW5kIG51bWJlcj8iICYmIHRoaXMuaXNleGNoYW5nZSkgewogICAgICAgICQoIiNyZXNwb25zZV9ib3RfdGV4dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgaW4gbWVzc2FnZS5idXR0b25zKSB7CiAgICAgICAgaWYgKG1zZy5idXR0b25fcHJlZml4ICE9IG51bGwpIHsKICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udGl0bGUsCiAgICAgICAgICAgIHZhbHVlOiBtc2cuYnV0dG9uX3ByZWZpeCArIG1lc3NhZ2UuYnV0dG9uc1tpXS52YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udGl0bGUsCiAgICAgICAgICAgIHZhbHVlOiBtZXNzYWdlLmJ1dHRvbnNbaV0udmFsdWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1zZy5idXR0b25zX2xpc3RbaV0udGl0bGUgPT0gIk5vIiAmJiBtZXNzYWdlLnRleHQgIT0gIkNhbiBJIGhlbHAgeW91IHdpdGggYW55dGhpbmcgZWxzZT8iICYmIHRoaXMuY29tcGFueWlkID09ICJjbGluaWNhbHRyaWFsczgxMzUyIikgewogICAgICAgICAgbXNnLmJ1dHRvbnNfbGlzdFtpXS52YWx1ZSA9ICJpc2Rpc2FibGVkIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTMuY2hhdC5wdXNoKG1zZyk7CgogICAgICAgIGlmIChpbmRleCA9PSAiaXNfYnV0dG9uIiB8fCBpbmRleCA9PSAwKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsVG9wIikgKyA1MAogICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMxMy50b19zY3JvbGwgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMxMy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzMTMuY2hhdCk7CiAgICAgIH0sIDI1MDApOwogICAgfSwKICAgIG11bHRpc2VsZWN0X2xvYWQ6IGZ1bmN0aW9uIG11bHRpc2VsZWN0X2xvYWQobWVzc2FnZSwgaW5kZXgpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICBtdWx0aXNlbGVjdF92YWx1ZXM6IG1lc3NhZ2UuY3VzdG9tLnZhbHVlcywKICAgICAgICBwbGFjZWhvbGRlcjogbWVzc2FnZS5jdXN0b20ucGxhY2Vob2xkZXIsCiAgICAgICAgaXNfbXVsdGlzZWxlY3Q6IHRydWUsCiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLnRleHQsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgfTsKICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgIH0sCiAgICBsb2FkX3RhYmxlOiBmdW5jdGlvbiBsb2FkX3RhYmxlKG1lc3NhZ2UsIGluZGV4KSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgY29sX2xpc3Q6IE9iamVjdC5rZXlzKG1lc3NhZ2UuY3VzdG9tLnZhbHVlc1swXSksCiAgICAgICAgdGFibGVfdmFsdWU6IG1lc3NhZ2UuY3VzdG9tLnZhbHVlcywKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2UudGV4dCwKICAgICAgICBpc190YWJsZTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE0LmNoYXQucHVzaChtc2cpOwoKICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuY2hpbGRyZW4oKS5sYXN0KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogMC43ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbFRvcCIpICsgMTAwCiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgIF90aGlzMTQudG9fc2Nyb2xsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sIDI1MDApOwogICAgfSwKICAgIGNyZWF0ZV9jaGF0OiBmdW5jdGlvbiBjcmVhdGVfY2hhdChtZXNzYWdlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciBjdXJyZW5jeV9saXN0ID0gW107CgogICAgICBpZiAodHlwZSA9PSAiaXN0YWJsZSIpIHsKICAgICAgICBheGlvcy5nZXQoImh0dHBzOi8vYXBpLmV4Y2hhbmdlcmF0ZXNhcGkuaW8vbGF0ZXN0IiwgewogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIGJhc2U6ICJBVUQiCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gbWVzc2FnZS5leHRyYXNbMF0uVEFCTEUpIHsKICAgICAgICAgICAgaWYgKG1lc3NhZ2UuZXh0cmFzWzBdLlRBQkxFW2ldLlBST1AgPT0gIlRSIikgewogICAgICAgICAgICAgIGN1cnJlbmN5X2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICBjdXJyZW5jeV90aXRsZTogbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uVEQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeV92YWx1ZTogcGFyc2VGbG9hdChNYXRoLnJvdW5kKHJlc3BvbnNlLmRhdGEucmF0ZXNbbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV1bIlREXzEiXV0gKiAxMDApIC8gMTAwKS50b0ZpeGVkKDQpLAogICAgICAgICAgICAgICAgdHlwZTogIlRSIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZXh0cmFzWzBdLlRBQkxFW2ldLlBST1AgPT0gIlRIRUFEIiAmJiAhX3RoaXMxNS5pc2V4Y2hhbmdlKSB7CiAgICAgICAgICAgICAgY3VycmVuY3lfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIGNvdW50cnlfbmFtZTogbWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uVEQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeV9uYW1lOiBtZXNzYWdlLmV4dHJhc1swXS5UQUJMRVtpXS5URF8xLAogICAgICAgICAgICAgICAgdHlwZTogIlRIRUFEIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vLwoKCiAgICAgICAgICBfdGhpczE1LmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdCA9IGN1cnJlbmN5X2xpc3Q7IC8vLwoKICAgICAgICAgIF90aGlzMTUuY2hhdC5wdXNoKHsKICAgICAgICAgICAgaXNfdGFibGU6IHRydWUsCiAgICAgICAgICAgIHRhYmxlX3RpdGxlOiBfdGhpczE1LnBhcnNlKG1lc3NhZ2UudGl0bGUpLAogICAgICAgICAgICB0YWJsZV9saXN0OiBjdXJyZW5jeV9saXN0CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczE1LnVwZGF0ZV9zY3JvbGxiYXIoKTsKCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiaXNwcm9tcHQiKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UubGV2ZWwgPiAwKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtZXNzYWdlKTsKICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgICAgdGhpcy5sZXZlbCA9IG1lc3NhZ2UubGV2ZWw7CiAgICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1lc3NhZ2UpOwogICAgICAgICAgdGhpcy5maXJzdF9jbGljayA9IHRydWU7CiAgICAgICAgICB0aGlzLmxldmVsID0gbWVzc2FnZS5sZXZlbDsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jaGF0LnB1c2gobWVzc2FnZSk7CiAgICAgIH0KCiAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgfSwKICAgIHN1Ym1pdF9jdXN0b21fZm9ybTogZnVuY3Rpb24gc3VibWl0X2N1c3RvbV9mb3JtKCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2RldGFpbHNfZm9ybSIpICE9IG51bGwpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNkZXRhaWxzX2Zvcm0iKTsKICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInN1Ym1pdCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gYWN0dWFsIGxvZ2ljLCBlLmcuIHZhbGlkYXRlIHRoZSBmb3JtCgogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2RldGFpbHNfZm9ybSIpLnNlcmlhbGl6ZUFycmF5KCk7CgogICAgICAgICAgaWYgKF90aGlzMTYuZm9ybV9wYXlsb2FkID09IG51bGwpIHsKICAgICAgICAgICAgdmFyIF9heGlvcyRwb3N0NjsKCiAgICAgICAgICAgIF90aGlzMTYuZm9ybV9wYXlsb2FkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgICAgX3RoaXMxNi5mb3JtX3BheWxvYWRbcXVlcnlTdHJpbmdbaV0ubmFtZV0gPSBxdWVyeVN0cmluZ1tpXS52YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuYm90X3VzZXJfZGF0YSgpLCAoX2F4aW9zJHBvc3Q2ID0gewogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZGF0YTogX3RoaXMxNi5mb3JtX3BheWxvYWQsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTYuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICAgIHVzZXJuYW1lOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgc291cmNlOiAiV2ViIgogICAgICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q2LCAidG9rZW4iLCBfdGhpczE2LmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDYsICJyb2xlIiwgX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfYXhpb3MkcG9zdDYpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJCb3QgVXNlciBEYXRhIFNhdmVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgICQoIiNkZXRhaWxzX2Zvcm0gOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICQoIiNkZXRhaWxzX2Zvcm0gOmJ1dHRvbiIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgX3RoaXMxNi51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwoKICAgICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgICAgICAgICBjaGF0OiAiL2RldGFpbHNfZm9ybSIsCiAgICAgICAgICAgICAgICAgIHRva2VuOiBfdGhpczE2LmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgICAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIERldGFpbHM6IEpTT04uc3RyaW5naWZ5KF90aGlzMTYuZm9ybV9wYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgcm9sZTogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTYucmVzcG9uc2VfaGFuZGxpbmcocmVzcCk7CgogICAgICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlX3Njcm9sbGJhcjogZnVuY3Rpb24gdXBkYXRlX3Njcm9sbGJhcih0eXBlLCBpc3Jlc3BvbnNlLCBpc3dlbGNvbWUsIGRlbGF5X3ZhbHVlKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHZhciBzY3JvbGxfZGVsYXkgPSBpc3dlbGNvbWUgPT0gImlzX3dlbGNvbWUiID8gZGVsYXlfdmFsdWUgOiAyMDAwOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgaWYgKGlzcmVzcG9uc2UgPT0gInJlc3BvbnNlIikgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0sIHNjcm9sbF9kZWxheSk7CiAgICAgIH0gZWxzZSBpZiAoaXNyZXNwb25zZSA9PSAic2VuZGVyIikgewogICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgfSwgNzUwKTsKICAgICAgfQoKICAgICAgaWYgKGlzcmVzcG9uc2UgIT0gInNlbmRlciIpIHsKICAgICAgICBpZiAodHlwZSA9PSAidXB0b19lbmQiKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxUb3AiKSA8ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKSkgewogICAgICAgICAgICAgIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPiAwLjUpIHsKICAgICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjc1ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICAgIF90aGlzMTcudG9fc2Nyb2xsID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC41KSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICB9LCBzY3JvbGxfZGVsYXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBzY3JvbGxfZGVsYXkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbFRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWJvZHkiKS5zY3JvbGxIZWlnaHQgLSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hhdC1ib2R5IikubGFzdENoaWxkLnNjcm9sbEhlaWdodDsKICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIEZYUGF5bWVudE1vZGU6IGZ1bmN0aW9uIEZYUGF5bWVudE1vZGUoKSB7CiAgICAgIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9wYXltZW50X21vZGUiOwogICAgICB0aGlzLnNlbmRfbWVzc2FnZSgiaXNfcHJvbXB0IiwgIi9Gb3JlaWdueGNoYW5nZTE3NDkxX3BheW1lbnRfbW9kZSIsICJQYXltZW50Iik7CiAgICB9LAogICAgRlhUcmFja2luZ1BhcmNlbDogZnVuY3Rpb24gRlhUcmFja2luZ1BhcmNlbCgpIHsKICAgICAgdGhpcy50b19zZW5kID0gIi9Gb3JlaWdueGNoYW5nZTE3NDkxX3RyYWNraW5nX3BhcmNlbCI7CiAgICAgIHRoaXMuc2VuZF9tZXNzYWdlKCJpc19wcm9tcHQiLCAiL0ZvcmVpZ254Y2hhbmdlMTc0OTFfdHJhY2tpbmdfcGFyY2VsIiwgIlRyYWNrIE15IFBhcmNlbCIpOwogICAgfSwKICAgIC8vIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb24oKSB7CiAgICAvLyAgIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRlIjsKICAgIC8vICAgdGhpcy5zZW5kX21lc3NhZ2UoCiAgICAvLyAgICAgImlzX3Byb21wdCIsCiAgICAvLyAgICAgIi9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGUiLAogICAgLy8gICAgICJFeGNoYW5nZSBSYXRlIgogICAgLy8gICApOwogICAgLy8gfSwKICAgIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb246IGZ1bmN0aW9uIEZvcmVpZ25FeGNoYW5nZUNvbnZlcnNpb24oKSB7CiAgICAgIC8vIHRoaXMudG9fc2VuZCA9ICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRlIjsKICAgICAgdGhpcy50b19zZW5kID0gJy9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGV7IkJVWV9PUl9TRUxMIjogIkJVWSJ9JzsKICAgICAgdGhpcy5zZW5kX21lc3NhZ2UoImlzX3Byb21wdCIsICcvRm9yZWlnbnhjaGFuZ2UxNzQ5MV9leGNoYW5nZV9yYXRleyJCVVlfT1JfU0VMTCI6ICJCVVkifScsICJFeGNoYW5nZSBSYXRlIik7CiAgICB9LAogICAgZXgxOiBmdW5jdGlvbiBleDEoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjEiKSAhPSBudWxsKSB7CiAgICAgICAgICAkKCIjbDEiKS52YWwoMSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczE4LmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjY291bnRyeSIpLmFwcGVuZCgiPG9wdGlvbiB2YWx1ZT1cIiIuY29uY2F0KF90aGlzMTguY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3ZhbHVlLCAiXCI+IikuY29uY2F0KF90aGlzMTguY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3RpdGxlLCAiPC9vcHRpb24+IikpOwogICAgICAgICAgfQoKICAgICAgICAgICQoIiNyMSIpLnRleHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZSk7IC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMSIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAvLyAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIxIikuaW5uZXJUZXh0OwogICAgICAgICAgLy8gICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgIC8vICAgeCA9IHggLyBjb247CiAgICAgICAgICAvLyAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAvLyAgICQoIiNsMSIpLnZhbCh4KTsKICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLnZhbHVlOwogICAgICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgICAgeCA9IHggKiBjb247CiAgICAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAgICQoIiNyMSIpLnRleHQoeCk7CiAgICAgICAgICB9KTsKICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCJjaGFuZ2UiLCAiI2NvdW50cnkiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb3VudHJ5IikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMSIpLnZhbHVlOwogICAgICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS52YWx1ZTsKICAgICAgICAgICAgeCA9IHggKiBjb247CiAgICAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAgICAgICAgICQoIiNyMSIpLnRleHQoeCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgYWRkZHJvcGRvd252YWx1ZTogZnVuY3Rpb24gYWRkZHJvcGRvd252YWx1ZSgpIHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnRvX3NlbmQgPSAiIjsKICAgICAgICB0aGlzLnJlcyA9IHt9OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udGl0bGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnRvX3NlbmQgKyAiLCAiICsgdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnRpdGxlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnJlc1t0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udmFsdWUuc3BsaXQoJyInKVsxXV0gPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMucmVzW3RoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS52YWx1ZS5zcGxpdCgnIicpWzFdXSA9IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS52YWx1ZS5zcGxpdCgnIicpWzNdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5yZXNbdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbMV1dID0gdGhpcy5yZXNbdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbMV1dICsgIiwiICsgdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbM107CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b19zZW5kID0gIiI7CiAgICAgICAgdGhpcy5yZXMgPSBbXTsKICAgICAgfQoKICAgICAgdGhpcy5idXR0b25fZmlsbCgpOwogICAgfSwKICAgIGNsb3NlZF9ib3RfY2hhdDogZnVuY3Rpb24gY2xvc2VkX2JvdF9jaGF0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgLy8gZGVidWdnZXI7CiAgICAgIC8vIGNvbnNvbGUubG9nKG1lc3NhZ2UpOwogICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOyAvLyBsYXN0Y2xvc2VkYm90aW5wdXRub2RlCgogICAgICBpZiAobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLm5vZGVfdHlwZSA9PSAiaGVhZGVyIiAmJiBtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0ubm9kZV90eXBlICE9IG51bGwgJiYgIXRoaXMuZW1wdHlfc3RyaW5nX3ZhbGlkaXR5LnRlc3QobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLm5vZGVfdHlwZSkpIHsKICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLnRpdGxlID09ICJEaXNwbGF5IE1lc3NhZ2UiKSB7CiAgICAgICAgICBtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0udGl0bGUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbbWVzc2FnZS5ub2Rlcy5sZW5ndGggLSAxXS50aXRsZSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgdGltZTogbnVsbAogICAgICAgIH0pOwogICAgICB9IC8vIGNvbnNvbGUubG9nKG1lc3NhZ2Uubm9kZXMubGVuZ3RoKTsKCgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMTsgaSArPSAxKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cobWVzc2FnZS5ub2Rlcyk7CiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJidXR0b24iICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgfTsKCiAgICAgICAgICB3aGlsZSAobWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiYnV0dG9uIikgewogICAgICAgICAgICAgIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICB0aXRsZTogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmJ1dHRvbiwKICAgICAgICAgICAgICAgIHZhbHVlOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGF5bG9hZCwKICAgICAgICAgICAgICAgIGlkOiBtZXNzYWdlLm5vZGVzW2ldLm5vZGVfaWQsCiAgICAgICAgICAgICAgICBub2RlOiBtZXNzYWdlLm5vZGVzW2ldCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgLy8gICB0aXRsZTogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmJ1dHRvbnMsCiAgICAgICAgICAgIC8vICAgdmFsdWU6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wYXlsb2FkLAogICAgICAgICAgICAvLyB9KTsKCgogICAgICAgICAgICBpKys7CiAgICAgICAgICB9CgogICAgICAgICAgaS0tOwogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJ0ZXh0X2JveCIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZQogICAgICAgICAgfSk7IC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKCiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsgLy8gY29uc29sZS5sb2coJzInKTsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAidGV4dF9hcmVhIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAvLyByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPHRleHRhcmVhIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjQiIGNvbHM9IjE1MCJzdHlsZT0icGFkZGluZy1sZWZ0OjEycHg7cmVzaXplOm5vbmU7b3ZlcmZsb3cteTphdXRvO21pbi1oZWlnaHQ6MzBweCIgcGxhY2Vob2xkZXI9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIgKyAnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nICsgaSArICciPjwvdGV4dGFyZWE+JywKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gImNsb3NlZF9ib3Rfbm9kZV8iICsgaTsgLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgIC8vICAgICB0aXRsZTogJ1N1Ym1pdCcsCiAgICAgICAgICAvLyAgICAgdmFsdWU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gICB9KTsKCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgICAgdGhpcy5pc190ZXh0X2FyZWEgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImVtYWlsIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuaXNlbWFpbCA9IHRydWU7IC8vIGlmKG1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IGZhbHNlKXsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwKICAgICAgICAgIC8vIH0pOwogICAgICAgICAgLy8gdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyAgaWYoIW1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsKXsKCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsgLy8gIH0KICAgICAgICAgIC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJlbWFpbCIgcGxhY2Vob2xkZXI9IicrbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKICAgICAgICAgIC8vIC8vIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAvLyAvLyAgICAgdGl0bGU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICAgIHZhbHVlOiAnU3VibWl0JywKICAgICAgICAgIC8vIC8vICAgfSk7CiAgICAgICAgICAvLyB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInBob25lX251bWJlciIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmlzX3Bob25lX251bWJlciA9IHRydWU7IC8vIGlmKG1lc3NhZ2Uubm9kZXNbaV0udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IGZhbHNlKXsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwKICAgICAgICAgIC8vIH0pOwogICAgICAgICAgLy8gdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAvLyB9CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXgiPiA8c2VsZWN0IG5hbWU9ImNvdW50cnljb2RlIiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjZweCAhaW1wb3J0YW50O3BhZGRpbmctcmlnaHQ6NnB4ICFpbXBvcnRhbnQ7IHdpZHRoOjQwJTtoZWlnaHQ6NTBweCAhaW1wb3J0YW50OyIgID4nIC8vIHJlY2VpdmVkOiAnJywKCiAgICAgICAgICB9OyAvLyB2YXIgZHJvcGRvd24gPSBbXTsKCiAgICAgICAgICB2YXIgZGF0YSA9IENvdW50cnlDb2RlczsKICAgICAgICAgIHZhciBvcHRpb24gPSB2b2lkIDA7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGRhdGEubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIC8vIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAvLyBvcHRpb24udGV4dCA9IGRhdGFbaV0uY291bnRyeV9jb2RlOwogICAgICAgICAgICAvLyBvcHRpb24udmFsdWUgPSBkYXRhW2ldLmNhbGxpbmdfY29kZTsKICAgICAgICAgICAgLy8gLy8gZHJvcGRvd24uYWRkKG9wdGlvbik7CiAgICAgICAgICAgIC8vIG1zZy5yZWNlaXZlZD1tc2cucmVjZWl2ZWQgKyBvcHRpb247CiAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8b3B0aW9uIHZhbHVlPSAnICsgZGF0YVtfaV0uZGlhbF9jb2RlICsgJz4nICsgZGF0YVtfaV0uY29kZSArICIoIiArIGRhdGFbX2ldLmRpYWxfY29kZSArICIpIiArICc8L29wdGlvbj4nOwogICAgICAgICAgfQoKICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8L3NlbGVjdD4nOwogICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjEycHggIWltcG9ydGFudDsgaGVpZ2h0OjUwcHggIWltcG9ydGFudDsiIGF1dG9jb21wbGV0ZT0ib2ZmIiBuYW1lPSJwaG9uZW51bWJlciIgaWQ9ICJwaG9uZW51bWJlciIgbmFtZT0iY2xvc2VkX2JvdF9ub2RlXycgKyBpICsgJyI+ICA8L2Rpdj4nOyAvLyBjb25zb2xlLmxvZyhtc2cpOwoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7IC8vIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIC8vIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgIC8vIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSwKICAgICAgICAgIC8vIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gdGltZTogbnVsbAogICAgICAgICAgLy8gfSk7CgogICAgICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciA9ICJwaG9uZW51bWJlciI7IC8vIHZhciBtc2cgPSB7CiAgICAgICAgICAvLyAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgLy8gICBidXR0b25zX2xpc3Q6IFtdLAogICAgICAgICAgLy8gICBidXR0b25fcHJlZml4OiBudWxsLAogICAgICAgICAgLy8gICBjdXN0b21fYnV0dG9uczogdHJ1ZSwKICAgICAgICAgIC8vICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZlZDogJzxpbnB1dCB0eXBlPSJlbWFpbCIgcGxhY2Vob2xkZXI9IicrbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UrJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJytpKyciPicsCiAgICAgICAgICAvLyAgIHRpbWU6IG51bGwsCiAgICAgICAgICAvLyAgIHJlbW92YWJsZTogdHlwZSA9PSAid2VsY29tZV9tZXNzYWdlIiA/IGZhbHNlIDogdHJ1ZQogICAgICAgICAgLy8gfTsKICAgICAgICAgIC8vIC8vIG1zZy5idXR0b25zX2xpc3QucHVzaCh7CiAgICAgICAgICAvLyAvLyAgICAgdGl0bGU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICAgIHZhbHVlOiAnU3VibWl0JywKICAgICAgICAgIC8vIC8vICAgfSk7CiAgICAgICAgICAvLyB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImh5cGVybGluayIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPGEgaHJlZj0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5oeXBlcmxpbmsgKyAnIiB0YXJnZXQ9Il9ibGFuayI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5oeXBlcmxpbmsgKyAnPC9hPicKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInJhZGlvX2J1dHRvbnMiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICcnCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwKICAgICAgICAgIH0pOyAvLyBtc2cucmVjZWl2ZWQgPSBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZTsKCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLm5vZGVfaWQgKyAnIiB2YWx1ZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zW2pdLnRpdGxlICsgJyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zW2pdLnRpdGxlICsgJzxicj4nOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiY2hlY2tfYm94IiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnJwogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICB9KTsKCiAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlcy5sZW5ndGg7IF9qKyspIHsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfal0udGl0bGUgKyAnIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfal0udGl0bGUgKyAnPGJyPic7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJkcm9wZG93biIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxzZWxlY3QgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCArICciIGNsYXNzPSJmb3JtLWNvbnRyb2wiID48b3B0aW9uIHZhbHVlIGRpc2FibGVkPSJkaXNhYmxlZCI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlICsgJzwvb3B0aW9uPicgLy8gcmVjZWl2ZWQ6ICcnLAoKICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgX2oyID0gMDsgX2oyIDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmRyb3Bkb3duLmxlbmd0aDsgX2oyKyspIHsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxvcHRpb24+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5kcm9wZG93bltfajJdLnRpdGxlICsgJzwvb3B0aW9uPic7CiAgICAgICAgICB9CgogICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImltYWdlIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8aW1nIHdpZHRoPSIyMTBweCIgaGVpZ2h0PSIxNDBweCIgc3JjPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmltYWdlICsgJyI+JwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAidmlkZW8iICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxpZnJhbWUgd2lkdGg9IjIxMHB4IiBoZWlnaHQ9IjE0MHB4IiBzcmM9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmlkZW8gKyAnIjwvaWZyYW1lPicKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gIm1lc3NhZ2UiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJycKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgZm9ybSA9ICc8Zm9ybSBpZD0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uZm9ybV9uYW1lLnJlcGxhY2UoJyAnLCAnXycpICsgJyI+JzsKCiAgICAgICAgICB3aGlsZSAobWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgICAgLy8gZm9ybT1mb3JtKyc8YnI+JwogICAgICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInRleHRfYm94IikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJyIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9InBhZGRpbmctbGVmdDoxMHB4ICFpbXBvcnRhbnQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnBsYWNlaG9sZGVyICsgJyJuYW1lPSJjbG9zZWRfYm90X25vZGVfJyArIGkgKyAnIj4nOwogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvZGl2Pic7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImRyb3Bkb3duIikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8c2VsZWN0IG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIGNsYXNzPSJmb3JtLWNvbnRyb2wiID4nOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfajMgPSAwOyBfajMgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZHJvcGRvd24ubGVuZ3RoOyBfajMrKykgewogICAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPG9wdGlvbj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmRyb3Bkb3duW19qM10udGl0bGUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiY2hlY2tfYm94IikgewogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206MHB4O2ZvbnQtd2VpZ2h0OjQ1MDtmb250LXNpemU6MTVweDsiPicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICc8L3A+JzsKCiAgICAgICAgICAgICAgZm9yICh2YXIgX2o0ID0gMDsgX2o0IDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlcy5sZW5ndGg7IF9qNCsrKSB7CiAgICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfajRdLnRpdGxlICsgJyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC52YWx1ZXNbX2o0XS50aXRsZSArICc8YnI+JzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzwvZGl2Pic7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInJhZGlvX2J1dHRvbnMiKSB7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6NDUwO2ZvbnQtc2l6ZToxNXB4OyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJzwvcD4nOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfajUgPSAwOyBfajUgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucmFkaW9fYnV0dG9ucy5sZW5ndGg7IF9qNSsrKSB7CiAgICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLmhlYWRlciArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnJhZGlvX2J1dHRvbnNbX2o1XS50aXRsZSArICciPicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucmFkaW9fYnV0dG9uc1tfajVdLnRpdGxlICsgJzxicj4nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSAvLyBmb3JtPWZvcm0rJzxicj4nCgoKICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQoKICAgICAgICAgIGktLTsKICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5Ij5TdWJtaXQ8L2J1dHRvbj48L2Zvcm0+JzsKICAgICAgICAgIHRoaXMuaXNmb3Jtb24gPSB0cnVlOwogICAgICAgICAgdGhpcy5mb3JtX25hbWUgPSBtZXNzYWdlLm5vZGVzW2ldLmZvcm1fbmFtZS5yZXBsYWNlKCcgJywgJ18nKTsKICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IGZvcm07CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgICAgdGhpcy5zdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIHJlY2VpdmVkOiBudWxsCiAgICAgICAgfSk7CgogICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICdtZXNzYWdlJyAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICdpbWFnZScgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSAhPSAndmlkZW8nICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgIT0gJ2J1dHRvbicgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSAhPSAnaHlwZXJsaW5rJykgewogICAgICAgICAgdGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlID0gdGhpcy5jaGF0Lmxlbmd0aCAtIDE7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkbm9kZWlkID0gbWVzc2FnZS5ub2Rlc1tpXTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICdidXR0b24nKSB7CiAgICAgICAgICB0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgPSB0aGlzLmNoYXQubGVuZ3RoIC0gMjsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRub2RlaWQgPSBtZXNzYWdlLm5vZGVzW2ldOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0uaXNfbGVhZikgewogICAgICAgICAgdGhpcy5pc2Nsb3NlZGJvdG9uID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdm0gPSBfdGhpczE5OwogICAgICAgIHZtLnRvX3Njcm9sbCA9IHRydWU7CgogICAgICAgIGlmICgkKCIuY2hhdC1ib2R5IikuY2hpbGRyZW4oKS5sYXN0KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0gZWxzZSBpZiAoJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpID4gMC41ICYmICQoIi5yZWNlaXZlciIpLmxhc3QoKS5wYXJlbnQoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNikgewogICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICBzY3JvbGxUb3A6IDAuOSAqICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjc1ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9CgogICAgICAgIGlmICgkKCIuY2hhdC1ib2R5Iikuc2Nyb2xsVG9wKCkgPT0gMCkgewogICAgICAgICAgX3RoaXMxOS50b19zY3JvbGwgPSBmYWxzZTsKICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpKQoKCiAgICAgICAgaWYgKHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgIT0gbnVsbCkgewogICAgICAgICAgJCgnW25hbWU9JyArIHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdm0uYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCk7CiAgICAgICAgfQogICAgICB9LCAxMDAwKTsKICAgIH0sCiAgICBzdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YTogZnVuY3Rpb24gc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEodHlwZSwgbWVzc2FnZSkgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CgogICAgICAvLyBkZWJ1Z2dlcjsKICAgICAgLy8gY29uc29sZS5sb2codHlwZSwgJ0hlbGxvIEhhcnNoJyk7CiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkpICE9IG51bGwgJiYgdHlwZSA9PSAnaXNfYnV0dG9uJyAmJiBtZXNzYWdlLnRpdGxlID09ICJTdWJtaXQiKSB7CiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlICsgMSkpOwogICAgICAgIHZhciBxdWVyeVN0cmluZyA9ICQoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSArICIgOmlucHV0Iikuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgaWYgKHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0gPSBxdWVyeVN0cmluZ1tpXS52YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YS5xdWVyeVN0cmluZ1tpXS5uYW1lLnB1c2gocXVlcnlTdHJpbmdbaV0udmFsdWUpOwogICAgICAgICAgICA7CiAgICAgICAgICB9CgogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSwKICAgICAgICAgICAgbm9kZV9zZWxlY3RlZDogdGhpcy5zZWxlY3RlZG5vZGVpZCwKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ2lzX2J1dHRvbicpIHsKICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGNoYXQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICAvLyBub2RlX3NlbGVjdGVkOiB7bm9kZV9pZDogbWVzc2FnZS5pZH0sCiAgICAgICAgICBub2RlX3NlbGVjdGVkOiBtZXNzYWdlLm5vZGUsCiAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiAhdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlciAmJiB0aGlzLmlzX3RleHRfYXJlYSkgewogICAgICAgIHRoaXMuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7IC8vICQoJ1tuYW1lPScrdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKyddJykuYXR0cigiZGlzYWJsZWQiLCAnZGlzYWJsZWQnKQogICAgICAgIC8vIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciA9IG51bGw7CgogICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSArIDEpKTsKICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkgKyAiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CgogICAgICAgIGlmICh0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPT0gbnVsbCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhW3F1ZXJ5U3RyaW5nW2ldLm5hbWVdID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0ucHVzaChxdWVyeVN0cmluZ1tpXS52YWx1ZSk7CiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICBkZWxpdmVyZWQ6IHRydWUsCiAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgfSk7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgY2hhdDogdGhpcy50b19zZW5kLAogICAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwoKICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlcikgewogICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjIiArIHRoaXMuZm9ybV9uYW1lKSAhPSBudWxsKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiMiICsgdGhpcy5mb3JtX25hbWUpOwogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJzdWJtaXQiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiIyIgKyBfdGhpczIwLmZvcm1fbmFtZSkuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgICAgIGlmIChfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CgogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YVtxdWVyeVN0cmluZ1tpXS5uYW1lXSA9IFtdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhW3F1ZXJ5U3RyaW5nW2ldLm5hbWVdLnB1c2gocXVlcnlTdHJpbmdbaV0udmFsdWUpOwoKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMyMC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdWlkOiBfdGhpczIwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBjaGF0OiBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEsCiAgICAgICAgICAgICAgICBub2RlX3NlbGVjdGVkOiBfdGhpczIwLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiBfdGhpczIwLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgICAgICAgIGJvdF9uYW1lOiBfdGhpczIwLmJvdF9uYW1lCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICQoIiMiICsgX3RoaXMyMC5mb3JtX25hbWUgKyAiIDppbnB1dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7IC8vIGNvbnNvbGUubG9nKCIjIit0aGlzLmZvcm1fbmFtZSsiOmlucHV0Iik7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gdW5kZWZpbmVkICYmIHRoaXMuaXNlbWFpbCkgewogICAgICAgIC8vIGFsZXJ0KHRoaXMudG9fc2VuZCk7CiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSkgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlICsgMSkpOwogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgdmFyIHggPSB0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxOyAvLyBpZih0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGE9PW51bGwpewoKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSB7fTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHVpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0ZWRub2RlaWQsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQsCiAgICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICB2YXIgZXJyb3JfdmFyaWFibGUgPSBudWxsOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCByZXNwb25zZS5kYXRhLm5vZGVzLmxlbmd0aCAtIDE7IF9pMiArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kyXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kyXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGVycm9yX3ZhcmlhYmxlID0gX2kyOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTJdLnVpX2VsZW1lbnQuZXJyb3JfbXNnLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXJyb3JfdmFyaWFibGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgX3RoaXMyMC5pc2VtYWlsID0gZmFsc2U7CgogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5pc19waG9uZV9udW1iZXIpIHsKICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpKSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAodGhpcy5pc19waG9uZV9udW1iZXJfb3RwID09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGR0cyA9IHRoaXMudG9fc2VuZDsKICAgICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUpOwoKICAgICAgICAgICAgaWYgKHRoaXMuaXNfcGhvbmVfbnVtYmVyX2Vycl9tc2cpIHsKICAgICAgICAgICAgICB2YXIgeCA9ICQoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSArICIgOmlucHV0Iikuc2VyaWFsaXplQXJyYXkoKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiaWYgbG9vcCIpOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImVsc2UgbG9vcCIpOwogICAgICAgICAgICAgIHZhciB4ID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zb2xlLmxvZyh4KTsKICAgICAgICAgICAgdmFyIGR0cyA9IHhbMF0udmFsdWUgKyB4WzFdLnZhbHVlOwogICAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgc2VudDogZHRzLAogICAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gdGhpcy5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsKICAgICAgICAgIC8vIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiKyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUrMSkpOwogICAgICAgICAgLy8gdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiKyh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUtMSkrIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgLy8gaWYodGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhPT1udWxsKXsKCgogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IHt9OwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IGR0cywKICAgICAgICAgICAgbm9kZV9zZWxlY3RlZDogdGhpcy5zZWxlY3RlZG5vZGVpZCwKICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY2hhdCk7CiAgICAgICAgICAgIF90aGlzMjAudG9fc2VuZCA9ICIiOwogICAgICAgICAgICB2YXIgZXJyb3JfdmFyaWFibGUgPSBudWxsOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCByZXNwb25zZS5kYXRhLm5vZGVzLmxlbmd0aCAtIDE7IF9pMyArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlID09ICJwaG9uZV9udW1iZXIiICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuaXNfcGhvbmVfbnVtYmVyX2Vycl9tc2cgPSB0cnVlOwogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIGVycm9yX3ZhcmlhYmxlID0gX2kzOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7IC8vICB0aGlzLnNlbGVjdGVkbm9kZWlkID0gcmVzcG9uc2UuZGF0YS5ub2RlczsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LmVycm9yX21zZywKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiAnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4Ij4gPHNlbGVjdCBuYW1lPSJjb3VudHJ5Y29kZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9InBhZGRpbmctbGVmdDo2cHggIWltcG9ydGFudDtwYWRkaW5nLXJpZ2h0OjZweCAhaW1wb3J0YW50OyB3aWR0aDo0MCU7aGVpZ2h0OjUwcHggIWltcG9ydGFudDsiICA+JyAvLyByZWNlaXZlZDogJycsCgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJyZWFjaGVkIGhlcmUiKTsgLy8gdmFyIGRyb3Bkb3duID0gW107CgogICAgICAgICAgICAgICAgX3RoaXMyMC5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsKCiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IENvdW50cnlDb2RlczsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSB2b2lkIDA7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgZGF0YS5sZW5ndGg7IF9pNCsrKSB7CiAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgICAvLyBvcHRpb24udGV4dCA9IGRhdGFbaV0uY291bnRyeV9jb2RlOwogICAgICAgICAgICAgICAgICAvLyBvcHRpb24udmFsdWUgPSBkYXRhW2ldLmNhbGxpbmdfY29kZTsKICAgICAgICAgICAgICAgICAgLy8gLy8gZHJvcGRvd24uYWRkKG9wdGlvbik7CiAgICAgICAgICAgICAgICAgIC8vIG1zZy5yZWNlaXZlZD1tc2cucmVjZWl2ZWQgKyBvcHRpb247CiAgICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8b3B0aW9uIHZhbHVlPSAnICsgZGF0YVtfaTRdLmRpYWxfY29kZSArICc+JyArIGRhdGFbX2k0XS5jb2RlICsgIigiICsgZGF0YVtfaTRdLmRpYWxfY29kZSArICIpIiArICc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IG1zZy5yZWNlaXZlZCArICc8L3NlbGVjdD4nOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjEycHggIWltcG9ydGFudDsgaGVpZ2h0OjUwcHggIWltcG9ydGFudDsiIGF1dG9jb21wbGV0ZT0ib2ZmIiBuYW1lPSJwaG9uZW51bWJlciIgaWQ9ICJwaG9uZW51bWJlciIgbmFtZT0iY2xvc2VkX2JvdF9ub2RlXycgKyBfaTMgKyAnIj4gIDwvZGl2Pic7IC8vIGNvbnNvbGUubG9nKG1zZyk7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jaGF0LnB1c2gobXNnKTsgLy8gdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgLy8gcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgLy8gcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICAgICAgLy8gY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAvLyB0aW1lOiBudWxsCiAgICAgICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7CgoKICAgICAgICAgICAgICAgIF90aGlzMjAucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMjAubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyBfdGhpczIwLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLm9mZigna2V5dXAnLCB2bS5hcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczIwLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgPSAicGhvbmVudW1iZXIiOwogICAgICAgICAgICAgICAgdmFyIHZtID0gX3RoaXMyMDsKICAgICAgICAgICAgICAgIF90aGlzMjAubGFzdGNsb3NlZGJvdGlucHV0bm9kZSA9IF90aGlzMjAuY2hhdC5sZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfdGhpczIwLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUpOwogICAgICAgICAgICAgICAgdmFyIGxlbiA9ICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gaWYodm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciAhPSBudWxsKXsKICAgICAgICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZygkKCdbbmFtZT0nK3ZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIrJ10nKSkKICAgICAgICAgICAgICAgICAgLy8gICBpZigkKCdbbmFtZT0nK3ZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIrJ10nKS5sZW5ndGg+MSl7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpW2xlbl0pCiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVtsZW5dLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdm0uYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCk7IC8vIH1lbHNlIHsKCiAgICAgICAgICAgICAgICAgICQoJ1tuYW1lPScgKyB2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVswXS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHZtLmFwcGVuZF9tZXNzYWdlX3RvX2NoYXRib3gpOyAvLyB9CiAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICAgICAgX3RoaXMyMC5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC52YWxpZGF0ZSA9PSAib3RwIiAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgICBfdGhpczIwLnNlbGVjdGVkbm9kZWlkID0gcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdOwogICAgICAgICAgICAgICAgZXJyb3JfdmFyaWFibGUgPSBfaTM7CiAgICAgICAgICAgICAgICBfdGhpczIwLmlzX3Bob25lX251bWJlcl9vdHAgPSB0cnVlOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQub3RwX3F1ZXN0aW9uX2xhYmVsLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC52YWxpZGF0ZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQudmFsaWRhdGUgPT0gIm90cCIgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIF90aGlzMjAuc2VsZWN0ZWRub2RlaWQgPSByZXNwb25zZS5kYXRhLm5vZGVzW19pM107CiAgICAgICAgICAgICAgICBlcnJvcl92YXJpYWJsZSA9IF9pMzsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LmluY29ycmVjdF9vdHBfbXNnLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczIwLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygicmVhY2hlZCBoZXJlMiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXJyb3JfdmFyaWFibGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CgogICAgICAgICAgICAgIF90aGlzMjAuZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCk7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKCiAgICAgICAgICAgICAgX3RoaXMyMC5pc19waG9uZV9udW1iZXIgPSBmYWxzZTsgLy8gfSwgMSk7CgogICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsgLy8gfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiAhdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc2VtYWlsICYmICF0aGlzLmlzX3Bob25lX251bWJlciAmJiAhdGhpcy5pc190ZXh0X2FyZWEpIHsKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgIH0pOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CgogICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRkYXRhOiBmdW5jdGlvbiBnZXRkYXRhKCkgewogICAgICBpZiAoIXRoaXMuaXNmb3Jtb24gJiYgIXRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgIHRoaXMudG9fc2VuZCA9ICcnOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXJ5U3RyaW5nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMudG9fc2VuZCA9IHF1ZXJ5U3RyaW5nW2ldLnZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy50b19zZW5kID0gdGhpcy50b19zZW5kICsgIiwiICsgcXVlcnlTdHJpbmdbaV0udmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICB9LAogICAgYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveDogZnVuY3Rpb24gYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCgpIHsKICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyLCB0aGlzLmlzX3Bob25lX251bWJlcik7CiAgICAgIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpKTsKCiAgICAgIGlmICh0aGlzLmlzX3RleHRfYXJlYSkgewogICAgICAgIHRoaXMudG9fc2VuZCA9ICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpWzBdLnZhbHVlOwogICAgICAgIHRoaXMuYnV0dG9uX2ZpbGwoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgdmFyIGxlbiA9ICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLmxlbmd0aDsKICAgICAgICB0aGlzLnRvX3NlbmQgPSAkKCdbbmFtZT0nICsgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKVtsZW4gLSAxXS52YWx1ZTsKICAgICAgfQogICAgfSwKICAgIGRpc2FibGVfbmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcjogZnVuY3Rpb24gZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKCkgewogICAgICAvLyBjb25zb2xlLmxvZygiV2UgYXJlIGhlcmUgZGlzYWJsZWQgZnVuY3Rpb24iKQogICAgICAkKCdbbmFtZT0nICsgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICsgJ10nKS5hdHRyKCJkaXNhYmxlZCIsICdkaXNhYmxlZCcpOyAvLyAkKCdbbmFtZT0nK3RoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpLnJlbW92ZSgpOwoKICAgICAgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gbnVsbDsKCiAgICAgIGlmICh0aGlzLmlzX3Bob25lX251bWJlcikgewogICAgICAgICQoJ1tuYW1lPWNvdW50cnljb2RlXScpLmF0dHIoImRpc2FibGVkIiwgJ2Rpc2FibGVkJyk7IC8vICQoJ1tuYW1lPWNvdW50cnljb2RlXScpLnJlbW92ZSgpOwogICAgICB9CiAgICB9LAogICAgZ29fdG9fZGVzaWduX2JvdHNfcGFnZTogZnVuY3Rpb24gZ29fdG9fZGVzaWduX2JvdHNfcGFnZSgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9ib3QvZGVzaWduYm90Jyk7CiAgICB9IC8vc2VsbCBmdW5jdGlvbiBmb3IgZm9yZWlnbiBleGNoYW5nZQogICAgLy8gZXgyKCkgewogICAgLy8gICBzZXRUaW1lb3V0KCgpID0+IHsKICAgIC8vICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIyIikgIT0gbnVsbCkgewogICAgLy8gICAgICAgJCgiI2wyIikudmFsKDEpOwogICAgLy8gICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdC5sZW5ndGg7IGkrKykgewogICAgLy8gICAgICAgICAkKCIjY291bnRyeTIiKS5hcHBlbmQoCiAgICAvLyAgICAgICAgICAgYDxvcHRpb24gdmFsdWU9IiR7dGhpcy5jdXJyZW5jeWV4Y2hhbmdlX2xpc3RbaV0uY3VycmVuY3lfdmFsdWV9Ij4ke3RoaXMuY3VycmVuY3lleGNoYW5nZV9saXN0W2ldLmN1cnJlbmN5X3RpdGxlfTwvb3B0aW9uPmAKICAgIC8vICAgICAgICAgKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgICQoIiNyMiIpLnZhbChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZSk7CiAgICAvLyAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjIiKS5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uKCkgewogICAgLy8gICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMiIpLnZhbHVlOwogICAgLy8gICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHggPSB4IC8gY29uOwogICAgLy8gICAgICAgICB4ID0geC50b0ZpeGVkKDQpOwogICAgLy8gICAgICAgICAkKCIjbDIiKS52YWwoeCk7CiAgICAvLyAgICAgICB9KTsKICAgIC8vICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMiIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZTsKICAgIC8vICAgICAgICAgeCA9IHggKiBjb247CiAgICAvLyAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAvLyAgICAgICAgICQoIiNyMiIpLnZhbCh4KTsKICAgIC8vICAgICAgIH0pOwogICAgLy8gICAgICAgJChkb2N1bWVudCkub24oImNoYW5nZSIsICIjY291bnRyeTIiLCBmdW5jdGlvbigpIHsKICAgIC8vICAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpewogICAgLy8gICAgICAgICB2YXIgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsMiIpLnZhbHVlOwogICAgLy8gICAgICAgICB2YXIgY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHggPSB4ICogY29uOwogICAgLy8gICAgICAgICB4ID0geC50b0ZpeGVkKDQpOwogICAgLy8gICAgICAgICAkKCIjcjIiKS52YWwoeCk7CiAgICAvLyAgICAgICB9KTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0sIDMwMDApOwogICAgLy8gfQoKICB9Cn07"},null]}