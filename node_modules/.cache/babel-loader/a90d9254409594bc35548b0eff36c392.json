{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotDesign.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotDesign.vue","mtime":1660042032555},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgcm9sZV9uYW1lczogIiIsCiAgICAgIC8vLy8vLy8vLy8vLwogICAgICBib3RfbmFtZXM6ICIiLAogICAgICBkZWxldGVfbGlzdDogW10sCiAgICAgIHJvbGVfbmFtZTogW10sCiAgICAgIC8vLy8vLy8vLy8KICAgICAgYm90X25hbWU6IFtdLAogICAgICB1c2VyX3R5cGVfbGlzdDogW10sCiAgICAgIHVzZXJfdHlwZTogbnVsbCwKICAgICAgLy8vLy8vLy8vLwogICAgICBib3RfdHlwZTogIkNsb3NlZCBCb3QiLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTAsCiAgICAgIHRvdGFsX3BhZ2VzOiAwLAogICAgICBhZGRfZWRpdDogInRydWUiLAogICAgICBvbGRfcm9sZV9uYW1lOiAiIiwKICAgICAgLy9oYXJzaAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBlbXB0eV9zdHJpbmdfdmFsaWRpdHk6IC9eJC8KICAgIH07CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIGF4aW9zLmdldChhcGlfY2FsbHMuc2hvd19jbG9zZWRfZm9ybV91cmwoKSwgewogICAgICBwYXJhbXM6IHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgIH0sCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICBfdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5Cb3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgX3RoaXMuYm90X25hbWUucHVzaCh7CiAgICAgICAgICBuYW1lOiByZXNwb25zZS5kYXRhLkJvdHNbaV0uYm90X25hbWUsCiAgICAgICAgICB0eXBlOiAiQ2xvc2VkIEJvdCIsCiAgICAgICAgICBpZDogcmVzcG9uc2UuZGF0YS5Cb3RzW2ldLmJvdF9pZCwKICAgICAgICAgIHZlcnNpb246IHJlc3BvbnNlLmRhdGEuQm90c1tpXS5ib3RfdmVyc2lvbgogICAgICAgIH0pOwogICAgICB9CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICBfdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgfQogICAgfSk7IC8vIGF4aW9zCiAgICAvLyAgIC5nZXQoCiAgICAvLyAgICAgYXBpX2NhbGxzLm9wZW5fYm90KCksCiAgICAvLyAgICAgewogICAgLy8gICAgICAgcGFyYW1zOiB7CiAgICAvLyAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgICAvLyBib3RfbmFtZTogdGhpcy4kcm91dGUucGFyYW1zLmJvdGRhdGEuYm90X25hbWUsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIH0sCiAgICAvLyAgICAgewogICAgLy8gICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgfQogICAgLy8gICApCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgIC8vICAgICAvLyBmb3IobGV0IGk9MDtpPHJlc3BvbnNlLmRhdGEuQm90cy5sZW5ndGg7aSsrKXsKICAgIC8vICAgICAvLyAgIHRoaXMuYm90X25hbWUucHVzaCh7CiAgICAvLyAgICAgLy8gICAgIG5hbWU6cmVzcG9uc2UuZGF0YS5Cb3RzW2ldLAogICAgLy8gICAgIC8vICAgICB0eXBlOidDbG9zZWQgQm90JywKICAgIC8vICAgICAvLyAgIH0pOwogICAgLy8gICAgIC8vIH0KICAgIC8vICAgICAvLyB0aGlzLmxldmVscz1yZXNwb25zZS5kYXRhLkJvdC5zdHJ1Y3R1cmU7CiAgICAvLyAgICAgLy8gdGhpcy5tYXhpZCA9IHRoaXMubGV2ZWxzLmxlbmd0aAogICAgLy8gICB9KQogICAgLy8gICAuY2F0Y2goKGUpID0+IHsKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgKSB7CiAgICAvLyAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgICAvLyBheGlvcwogICAgLy8gLmdldChhcGlfY2FsbHMub3Blbl9ib3QoKSx7CiAgICAvLyAgIHBhcmFtczogewogICAgLy8gICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgIH0KICAgIC8vIH0sIHsKICAgIC8vICAgaGVhZGVyczogewogICAgLy8gICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICB9LAogICAgLy8gfSkKICAgIC8vIC50aGVuKHJlc3BvbnNlPT57CiAgICAvLyAgIGZvcihsZXQgaT0wO2k8cmVzcG9uc2UuZGF0YS5Cb3RzLmxlbmd0aDtpKyspewogICAgLy8gICAgIHRoaXMuYm90X25hbWUucHVzaCh7CiAgICAvLyAgICAgICBuYW1lOnJlc3BvbnNlLmRhdGEuQm90c1tpXSwKICAgIC8vICAgICAgIHR5cGU6J09wZW4gQm90JywKICAgIC8vICAgICB9KTsKICAgIC8vICAgfQogICAgLy8gfSkKICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgICAvLyBheGlvcwogICAgLy8gICAucG9zdChhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLCB7CiAgICAvLyAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgLy8gICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICBwYWdlX25vOiAxLAogICAgLy8gICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgLy8gICAgIGlzU2hvdzogdHJ1ZQogICAgLy8gICB9LCB7CiAgICAvLyAgIGhlYWRlcnM6IHsKICAgIC8vICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgfSwKICAgIC8vIH0pCiAgICAvLyAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCImJnJlc3BvbnNlLmRhdGEhPW51bGwpIHsKICAgIC8vICAgICAgIHRoaXMub3JnYW5pemVfcm9sZXMocmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KQogICAgLy8gLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICBpZiAoCiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICApIHsKICAgIC8vICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGNoZWNrX2xpc3RfYXJyYXk6IGZ1bmN0aW9uIGNoZWNrX2xpc3RfYXJyYXkoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09ICJhbGwiKSB7CiAgICAgICAgdmFyIHJvbGVfbGVuZ3RoID0gdGhpcy5yb2xlX25hbWUubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvbGVfbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goaSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tlZF9saXN0LmluY2x1ZGVzKGluZGV4KSkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKGluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3Quc3BsaWNlKHRoaXMuY2hlY2tlZF9saXN0LmluZGV4T2YoaW5kZXgpLCAxKTsgLy8gdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIocm9sZXMgPT4gewogICAgICAgICAgLy8gICByZXR1cm4gcm9sZS5yb2xlICE9PSBpbmRleDsKICAgICAgICAgIC8vIH0pOwogICAgICAgICAgLy8gdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGVkaXRfcm9sZTogZnVuY3Rpb24gZWRpdF9yb2xlKGluZGV4KSB7CiAgICAgIHRoaXMub2xkX3JvbGVfbmFtZSA9IHRoaXMucm9sZV9uYW1lW2luZGV4XTsKICAgICAgdGhpcy5yb2xlX25hbWVzID0gdGhpcy5yb2xlX25hbWVbaW5kZXhdOwogICAgICB0aGlzLnVzZXJfdHlwZSA9IHRoaXMudXNlcl90eXBlX2xpc3RbaW5kZXhdOwogICAgICB0aGlzLmFkZF9lZGl0ID0gImZhbHNlIjsKICAgIH0sCiAgICBkZWxldGVfcm9sZTogZnVuY3Rpb24gZGVsZXRlX3JvbGUoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2godGhpcy5yb2xlX25hbWVbaW5kZXhdKTsKICAgICAgdGhpcy5yb2xlX25hbWVzID0gdGhpcy5yb2xlX25hbWVbaW5kZXhdLCB0aGlzLnVzZXJfdHlwZSA9IHRoaXMudXNlcl90eXBlX2xpc3RbaW5kZXhdOwogICAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIllvdSB3b24ndCBiZSBhYmxlIHRvIHJldmVydCB0aGlzISIsCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgZGVsZXRlISEiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIF90aGlzMi5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMyLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMyLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgdG9rZW46IF90aGlzMi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZGVsZXRlX3JvbGVzOiBbewogICAgICAgICAgICAgIFJvbGU6IF90aGlzMi5yb2xlX25hbWVzLAogICAgICAgICAgICAgIFVzZXJUeXBlOiBfdGhpczIudXNlcl90eXBlCiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBpc0RlbGV0ZTogdHJ1ZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczIuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMi5yb2xlX25hbWVzID0gIiI7CiAgICAgICAgICAgIF90aGlzMi51c2VyX3R5cGUgPSBudWxsOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlVzZXIgUm9sZXMgRGVsZXRlZCIpIHsKICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgdGl0bGU6ICJEZWxldGVkISIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBib3RzIGhhdmUgYmVlbiBkZWxldGVkLiIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXMyLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJVU0VSIEVYSVNUIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJUaGVyZSBpcyBhbHJlYWR5IGEgdXNlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBSb2xlIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBkZWxldGVfYm90OiBmdW5jdGlvbiBkZWxldGVfYm90KGluZGV4KSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5kZWxldGVfbGlzdCA9IFtdOwogICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2goewogICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5uYW1lLAogICAgICAgIGJvdF9pZDogdGhpcy5ib3RfbmFtZVtpbmRleF0uaWQKICAgICAgfSk7CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IHRydWU7IC8vIGNvbnNvbGUubG9nKHRoaXMuZGVsZXRlX2xpc3QpOwoKICAgICAgICAgIGF4aW9zLmRlbGV0ZShhcGlfY2FsbHMuZGVsZXRlX2Nsb3NlZF9mb3JtX3VybCgpLCB7CiAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGJvdHM6IF90aGlzMy5kZWxldGVfbGlzdAogICAgICAgICAgICB9LAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiRGVsZXRlZCEiLAogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgYm90cyBoYXZlIGJlZW4gZGVsZXRlZC4iLAogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIF90aGlzMy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlBhcnRpYWwiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4iLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRmFpbHVyZSIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX211bHRpcGxlX3JvbGU6IGZ1bmN0aW9uIGRlbGV0ZV9tdWx0aXBsZV9yb2xlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgdmFyIGxlbiA9IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdFtpXTsKICAgICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2goewogICAgICAgICAgUm9sZTogdGhpcy5yb2xlX25hbWVbaW5kZXhdLAogICAgICAgICAgVXNlclR5cGU6IHRoaXMudXNlcl90eXBlX2xpc3RbaW5kZXhdCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5tYWluX3JvbGVfdXJsKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZW1haWw6IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBkZWxldGVfcm9sZXM6IF90aGlzNC5kZWxldGVfbGlzdCwKICAgICAgICAgICAgaXNEZWxldGU6IHRydWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM0LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJTdWNjZXNzIikgewogICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICB0aXRsZTogIkRlbGV0ZWQhIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIGJvdHMgaGF2ZSBiZWVuIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczQuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJQYXJ0aWFsIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgaW50ZW50cyBhbHJlYWR5IGV4aXN0cy4iLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRmFpbGVkIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogIlRoZSBpbnRlbnRzIGFscmVhZHkgZXhpc3RzLiIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX211bHRpcGxlX2JvdDogZnVuY3Rpb24gZGVsZXRlX211bHRpcGxlX2JvdCgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgICB2YXIgbGVuID0gdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdFtpXTsKICAgICAgICAgIHRoaXMuZGVsZXRlX2xpc3QucHVzaCh7CiAgICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5uYW1lLAogICAgICAgICAgICBib3RfaWQ6IHRoaXMuYm90X25hbWVbaW5kZXhdLmlkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgICAgdGV4dDogIllvdSB3b24ndCBiZSBhYmxlIHRvIHJldmVydCB0aGlzISIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIGRlbGV0ZSEhIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gdHJ1ZTsgLy8gY29uc29sZS5sb2codGhpcy5kZWxldGVfbGlzdCk7CgogICAgICAgICAgICBheGlvcy5kZWxldGUoYXBpX2NhbGxzLmRlbGV0ZV9jbG9zZWRfZm9ybV91cmwoKSwgewogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgZW1haWw6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgdG9rZW46IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIGJvdHM6IF90aGlzNS5kZWxldGVfbGlzdAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAiRGVsZXRlZCEiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBib3RzIGhhdmUgYmVlbiBkZWxldGVkLiIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNS4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJQYXJ0aWFsIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgYm90IGNvdWxkIG5vdCBiZSBkZWxldGVkIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkZhaWx1cmUiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiQm90IGNvdWxkIG5vdCBiZSBkZWxldGVkIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIkJvdCBjb3VsZCBub3QgYmUgZGVsZXRlZCIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiTm8gYm90IHNlbGVjdGVkIHRvIGRlbGV0ZSAiKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9ib3Q6IGZ1bmN0aW9uIGFkZF9ib3QoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5lbXB0eV9zdHJpbmdfdmFsaWRpdHkudGVzdCh0aGlzLmJvdF9uYW1lcykpIHsKICAgICAgICAvL3RvYXN0ZXIKICAgICAgICB0b2FzdHIuZXJyb3IoIkVudGVyIEJvdCBOYW1lIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5ib3RfdHlwZSA9PSBudWxsKSB7CiAgICAgICAgLy90b2FzdGVyCiAgICAgICAgdG9hc3RyLmVycm9yKCJTZWxlY3QgQm90IFR5cGUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc2FtZV9uYW1lID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib3RfbmFtZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHRoaXMuYm90X25hbWVbaV0ubmFtZSA9PSB0aGlzLmJvdF9uYW1lcykgewogICAgICAgICAgICBzYW1lX25hbWUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNhbWVfbmFtZSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJCb3Qgd2l0aCBzYW1lIG5hbWUgYWxyZWFkeSBleGlzdCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJvdF90eXBlID0gIkNsb3NlZCBCb3QiOwoKICAgICAgICAgIGlmICh0aGlzLmJvdF90eXBlID09ICJPcGVuIEJvdCIpIHsKICAgICAgICAgICAgJCgiI2JvdG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgIG5hbWU6ICJPcGVuQm90IiwKICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgIGJvdGRhdGE6IHsKICAgICAgICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWVzLAogICAgICAgICAgICAgICAgICBib3RfdHlwZTogdGhpcy5ib3RfdHlwZSwKICAgICAgICAgICAgICAgICAgaXNfZWRpdDogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJvdF90eXBlID09ICJDbG9zZWQgQm90IikgewogICAgICAgICAgICAkKCIjYm90bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogIldvcmtmbG93IiwKICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgIGJvdGRhdGE6IHsKICAgICAgICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWVzLAogICAgICAgICAgICAgICAgICBib3RfdHlwZTogdGhpcy5ib3RfdHlwZSwKICAgICAgICAgICAgICAgICAgaXNfZWRpdDogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gLy8gdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIC8vICAgbmFtZTogcm91dGVfbmFtZSwKICAgICAgICAvLyAgIHByb3BzOiB0cnVlCiAgICAgICAgLy8gfSk7CgogICAgICB9CiAgICB9LAogICAgcGFnZV9jaGFuZ2U6IGZ1bmN0aW9uIHBhZ2VfY2hhbmdlKHBhZ2VubykgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmIChwYWdlbm8gPT0gMCB8fCBwYWdlbm8gPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZW5vOwogICAgICAgICAgfQoKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIgJiYgcmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXM2Lm9yZ2FuaXplX3JvbGVzKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZW5vOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgcGFnZV9ubzogcGFnZW5vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hfbmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gInRva2VuIGludmFsaWQiICYmIHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzNi5vcmdhbml6ZV9yb2xlcyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcmdhbml6ZV9yb2xlczogZnVuY3Rpb24gb3JnYW5pemVfcm9sZXMocm9sZXNfbGlzdCkgewogICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcm9sZXNfbGlzdC5udW1iZXJfb2Zfcm93czsKICAgICAgdGhpcy5yb2xlX25hbWUgPSBbXTsKICAgICAgdGhpcy51c2VyX3R5cGVfbGlzdCA9IFtdOwogICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcm9sZXNfbGlzdC5QYWdlQ291bnQ7CiAgICAgIHZhciBwb3J0YWxfbGVuID0gcm9sZXNfbGlzdC5Qb3J0YWwubGVuZ3RoOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwb3J0YWxfbGVuOyBpKyspIHsKICAgICAgICB0aGlzLnVzZXJfdHlwZV9saXN0LnB1c2goIlBvcnRhbCBVc2VyIik7CiAgICAgICAgdGhpcy5yb2xlX25hbWUucHVzaChyb2xlc19saXN0LlBvcnRhbFtpXSk7CiAgICAgIH0KCiAgICAgIHZhciBib3RfbGVuID0gcm9sZXNfbGlzdC5Cb3QubGVuZ3RoOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib3RfbGVuOyBpKyspIHsKICAgICAgICB0aGlzLnVzZXJfdHlwZV9saXN0LnB1c2goIkJvdCBVc2VyIik7CiAgICAgICAgdGhpcy5yb2xlX25hbWUucHVzaChyb2xlc19saXN0LkJvdFtpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3M6IGZ1bmN0aW9uIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgdGhpcy5zZWFyY2hfcHJvZHVjdCgpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX3Byb2R1Y3Q6IGZ1bmN0aW9uIHNlYXJjaF9wcm9kdWN0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICBzZWFyY2hzdHJpbmc6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIgJiYgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEuTVNHICE9ICJObyBSb2xlcyBBZGRlZCBZZXQiKSB7CiAgICAgICAgICAgIF90aGlzNy5wYWdlX25vID0gMTsKCiAgICAgICAgICAgIF90aGlzNy5vcmdhbml6ZV9yb2xlcyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJvbGVzIEFkZGVkIFlldCIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJObyByb2xlIGZvdW5kIik7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzNy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXM3LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJFbnRlciBwcm9wZXIgZGF0YSBmb3Igc2VhcmNoaW5nIik7CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IDQ7IF9pKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMiA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTIgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHBhZ2Vfbm8gKyAzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTQgPSBwYWdlX25vIC0gNDsgX2k0IDwgdGhpcy50b3RhbF9wYWdlczsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gMzsgX2k1IDw9IHBhZ2Vfbm8gKyAzOyBfaTUrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k1KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICByb3V0ZV90b19wcmV2aWV3OiBmdW5jdGlvbiByb3V0ZV90b19wcmV2aWV3KGluZGV4KSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAiVGVzdCBDbG9zZWQgQm90IiwKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIGJvdGRhdGE6IHsKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWVbaW5kZXhdLm5hbWUsCiAgICAgICAgICAgIGJvdF90eXBlOiB0aGlzLmJvdF9uYW1lW2luZGV4XS50eXBlLAogICAgICAgICAgICBib3RfaWQ6IHRoaXMuYm90X25hbWVbaW5kZXhdLmlkCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlZGl0X2JvdDogZnVuY3Rpb24gZWRpdF9ib3QoaW5kZXgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICJXb3JrZmxvdyIsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBib3RkYXRhOiB7CiAgICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5uYW1lLAogICAgICAgICAgICBib3RfdHlwZTogdGhpcy5ib3RfbmFtZVtpbmRleF0udHlwZSwKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgYm90X2lkOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5pZCwKICAgICAgICAgICAgYm90X3ZlcnNpb246IHRoaXMuYm90X25hbWVbaW5kZXhdLnZlcnNpb24KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyX2FsbDogZnVuY3Rpb24gY2xlYXJfYWxsKCkgewogICAgICB0aGlzLmJvdF9uYW1lcyA9IG51bGw7CiAgICB9LAogICAgc2V0X2FjdGl2ZTogZnVuY3Rpb24gc2V0X2FjdGl2ZShpbmRleCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmJvdF9uYW1lLnN0YXR1cyA9PSAiYWN0aXZlIikgey8vIFN3YWwuZmlyZSgKICAgICAgICAvLyAgICJZb3VyIGJvdHMgaXMgYWxyZWFkeSBhY3RpdmUhISIsCiAgICAgICAgLy8gICAiWW91ciBib3RzIGlzIGFscmVhZHkgYWN0aXZlLiIsCiAgICAgICAgLy8gICAic3VjY2VzcyIKICAgICAgICAvLyApOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgICAgdGV4dDogIlN1Ym1pdCB0byBBY3RpdmF0ZSB0aGUgQm90ISIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIGRlbGV0ZSEhIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5vcGVuX2JvdF9hc3NpZ25tZW50KCksIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdGF0dXM6ICIiLAogICAgICAgICAgICAgIGV0YTogIiIsCiAgICAgICAgICAgICAgZXRhX2NoYW5nZV9yZWFzb246ICIiLAogICAgICAgICAgICAgIGFzc2lnbmVkX3RvOiAiIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczguJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHt9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7IC8vIGF4aW9zCiAgICAgICAgICAgIC8vIC5wb3N0KGFwaV9jYWxscy5vcGVuX2JvdF9hc3NpZ25tZW50KCksewogICAgICAgICAgICAvLyAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAvLyAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgLy8gICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAvLyAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIC8vICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIC8vICAgc3RhdHVzOicnLAogICAgICAgICAgICAvLyAgIGV0YTogJycsCiAgICAgICAgICAgIC8vICAgZXRhX2NoYW5nZV9yZWFzb246JycsCiAgICAgICAgICAgIC8vICAgcHJvZ3Jlc3NfdXBkYXRlOicnLAogICAgICAgICAgICAvLyB9LCB7CiAgICAgICAgICAgIC8vICAgaGVhZGVyczogewogICAgICAgICAgICAvLyAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIC8vICAgfSwKICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgLy8gLnRoZW4ocmVzcG9uc2U9PnsKICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgLy8gICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAvLyAgIGlmICgKICAgICAgICAgICAgLy8gICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgLy8gICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgLy8gICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgLy8gICApIHsKICAgICAgICAgICAgLy8gICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KfTs="},null]}