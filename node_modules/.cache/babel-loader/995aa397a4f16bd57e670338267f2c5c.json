{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue","mtime":1643027096160},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgVGVtcGxhdGUgZnJvbSAiLi4vVGVtcGxhdGUudnVlIjsKaW1wb3J0IHsgVnVlRWRpdG9yIH0gZnJvbSAidnVlMi1lZGl0b3IiOwppbXBvcnQgeyBmcmVlemVfcG9ydGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIFRlbXBsYXRlOiBUZW1wbGF0ZSwKICAgIFZ1ZUVkaXRvcjogVnVlRWRpdG9yCiAgfSwKICBuYW1lOiAiaW50ZW50cy1jb21wb25lbnQiLAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWxdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwZW5jaWxfc3ZnOiAnIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUuNTQ2IiBoZWlnaHQ9IjE1LjQ2MSIgdmlld0JveD0iMCAwIDE1LjU0NiAxNS40NjEiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiM5ZTllOWU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03NDcuODg4IC0zNTYuNzY5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik03NTkuNDE2LDM1Ni43NjlhMi4zNTgsMi4zNTgsMCwwLDEsMS43NzcuNjYyYy41MzQuNTEzLDEuMDcyLDEuMDI1LDEuNTY3LDEuNTc1YTIuMywyLjMsMCwwLDEtLjA3MSwzLjMyNWMtMi43MzYsMi43Ni01LjQ5NCw1LjUtOC4yMzgsOC4yNTFhMS4zODEsMS4zODEsMCwwLDEtLjc1OC4yODhjLS43MTkuMTc0LTEuNDI5LjM3OS0yLjE0NC41NzItLjkzMi4yNTEtMS44NjIuNS0yLjc5NS43NTEtLjYuMTU4LS45ODktLjIxMy0uODMyLS44MDdxLjY4OS0yLjU5NSwxLjQwNi01LjE4MmExLjE2NCwxLjE2NCwwLDAsMSwuMjg5LS40ODdxNC4wOTEtNC4xMDcsOC4yLTguMkEyLjI2NSwyLjI2NSwwLDAsMSw3NTkuNDE2LDM1Ni43NjlabS0xLjk4OSwyLjk1Ni02LjU0LDYuNTM4LDMuMDI1LDMuMDI0LDYuNTM4LTYuNTM3Wm00LjAyMywyLjE2NWMuMTE4LS4xMzUuMjI1LS4yNjkuMzQzLS4zOTJhMS4xMzQsMS4xMzQsMCwwLDAsMC0xLjczNGMtLjQ2LS40NjYtLjkyNi0uOTI1LTEuMzg4LTEuMzlhMS4xNjYsMS4xNjYsMCwwLDAtLjg2MS0uMzY4Yy0uNTc4LDAtLjg4MS40LTEuMjE0Ljc2Wm0tMTIuMDg0LDguODYzLDMuMi0uODYzLTIuMzM3LTIuMzMxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTgxMy45NDIsNDIyLjZsLS43ODktLjgsMy44MjEtMy44MTkuNzg0LjhaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTkuNjQ4IC01NS45NDcpIi8+PC9nPjwvc3ZnPicsCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIG5ld19pbnRlbnRfZGVzY3JpcHRpb246ICIiLAogICAgICBpbnRlbnRfYWxyZWFkeV9leGlzdHM6IGZhbHNlLAogICAgICBpbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdDogZmFsc2UsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBuZXdfaW50ZW50czogIiIsCiAgICAgIGFkZF9xdWVzdGlvbnNfbGlzdDogWyIiXSwKICAgICAgb2xkX2ludGVudF9uYW1lOiAiIiwKICAgICAgb2xkX3F1ZXN0aW9uX2xpc3Q6IFtdLAogICAgICBpbnRlbnRsaXN0OiBbXSwKICAgICAgY29tcGFueW5hbWU6ICIiLAogICAgICBjb21wYW55aWQ6ICIiLAogICAgICBzZWFyY2hfbmFtZTogIiIsCiAgICAgIGlzRWRpdEludGVudDogZmFsc2UsCiAgICAgIHNlbGVjdGVkX2ludGVudF9kZXNjcmlwdGlvbjogIiIsCiAgICAgIGlzX3NlYXJjaF9hY3RpdmU6IGZhbHNlLAogICAgICBzZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zOiBbIiJdLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudDogIiIsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4OiAwLAogICAgICBpbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzOiBmYWxzZQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KCiAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICB0aGlzLmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdGhpcy5mcmVlemVfcG9ydGFsKCk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgJCgiI2ludGVudG1vZGVsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICB9KTsKICAgICQoJ2FbZGF0YS10YXJnZXQ9IiNpbnRlbnRtb2RlbCJdJykub24oImNsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAodm0uaXNFZGl0SW50ZW50ID09IHRydWUpIHsKICAgICAgICB2bS52ZXJpZnlfY2hhbmdlcygpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoInNob3ciKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbigic2VuZF9tb2RlbF9zdGF0dXMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PSB0cnVlKSB7CiAgICAgICAgX3RoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF9uYW1lOiBmdW5jdGlvbiBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgbmV3X2ludGVudHM6IGZ1bmN0aW9uIG5ld19pbnRlbnRzKHZhbCkgewogICAgICB0aGlzLm5ld19pbnRlbnRzID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0sCiAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudDogZnVuY3Rpb24gY3VycmVudF9zZWxlY3RlZF9pbnRlbnQodmFsKSB7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgdmVyaWZ5X2NoYW5nZXM6IGZ1bmN0aW9uIHZlcmlmeV9jaGFuZ2VzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIklmIHlvdSBoYXZlIG1hZGUgYW55IGNoYW5nZXMgdG8gdGhlIHNlbGVjdGVkIG9iamVjdGl2ZSBwbGVhc2Ugc2F2ZSB0aGVtIGZpcnN0LCBlbHNlIHRoZXkgd2lsbCBkaXNjYXJkZWQhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiU2F2ZSIsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIkNhbmNlbCIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXMyLmVkaXRfaW50ZW50KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMi5zaG93X2ludGVudHMoX3RoaXMyLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKCiAgICAgICAgICBfdGhpczIuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjYWxsc2VhcmNoOiBmdW5jdGlvbiBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICBpZiAodGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICAgIHRoaXMudmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zZWFyY2hfaW50ZW50KCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VhcmNoX2ludGVudDogZnVuY3Rpb24gc2VhcmNoX2ludGVudChjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJlc3VsdHMgRm91bmQiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJObyBSZXN1bHRzIEZvdW5kIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHICE9ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiICYmIHJlc3BvbnNlLmRhdGEuTVNHICE9ICJObyBJbnRlbnRzIEZvdW5kIikgewogICAgICAgICAgICBfdGhpczMuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczMucGFnZV9ubyA9IDE7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIpIHsKICAgICAgICAgICAgICBfdGhpczMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICBfdGhpczMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwoX3RoaXMzLm51bWJlcl9vZl9yb3dzIC8gX3RoaXMzLnBlcl9wYWdlKTsKICAgICAgICAgICAgICBfdGhpczMuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuUmVzcG9uc2VMaXN0OwoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMy5pbnRlbnRsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBfdGhpczMuaW50ZW50bGlzdFtpXS5JbnRlbnQgPSBfdGhpczMuaW50ZW50bGlzdFtpXS5JbnRlbnQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMzLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSkgewogICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd19pbnRlbnRzKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMy5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczMuc2V0cGFnaW5hdGlvbihfdGhpczMucGFnZV9ubyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMy5sb2FkX2ludGVudCgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJFbnRlciBwcm9wZXIgZGF0YSBmb3Igc2VhcmNoaW5nIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X2ludGVudDogZnVuY3Rpb24gY2hlY2tfY3VycmVudF9pbnRlbnQoaW5kZXgpIHsKICAgICAgdmFyIHJldHVybl92YXIgPSAiIjsKCiAgICAgIGlmICh0aGlzLmludGVudGxpc3RbaW5kZXhdLkludGVudCA9PSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCkgewogICAgICAgIHJldHVybl92YXIgKz0gImN1cnJlbnQtYWN0aXZlLWludGVudCI7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXR1cm5fdmFyOwogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGFkZF90b19xdWVzdGlvbnNfbGlzdDogZnVuY3Rpb24gYWRkX3RvX3F1ZXN0aW9uc19saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2hvd19pbnRlbnRzOiBmdW5jdGlvbiBzaG93X2ludGVudHMoaW5kZXgpIHsKICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgdmFyIGNsb25lX3NlbGVjdGVkX2ludGVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5pbnRlbnRsaXN0W2luZGV4XSkpOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5JbnRlbnQ7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5RdWVzdGlvbnM7CiAgICAgIHRoaXMub2xkX3F1ZXN0aW9uX2xpc3QgPSB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnM7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudERlc2NyaXB0aW9uOwogICAgICB0aGlzLm9sZF9pbnRlbnRfbmFtZSA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ7CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZW50ZXJpbmcgYSBpbnRlbnQgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWQ6IGZ1bmN0aW9uIGVudGVyaW50ZW50aWQoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGludGVudF9zZWFyY2hfa2V5ID0gdGhpcy5uZXdfaW50ZW50czsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgIGludGVudF9zZWFyY2hfa2V5OiB0aGlzLm5ld19pbnRlbnRzCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm90IEV4aXN0cyIgJiYgX3RoaXM0Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM0LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNC5uZXdfaW50ZW50cyAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkFscmVhZHkgRXhpc3RzIiAmJiBfdGhpczQubmV3X2ludGVudHMgPT09IGludGVudF9zZWFyY2hfa2V5KSB7CiAgICAgICAgICBfdGhpczQuaW50ZW50X2FscmVhZHlfZXhpc3RzID0gdHJ1ZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyBUaGlzIGlzIGZvciBjaGVja2luZyB3aGlsZSBlZGl0aW5nIGFuZCBlbnRlcmluZyBhIG9iamVjdGl2ZSBuYW1lIGlmIGl0IGFscmVhZHkgZXhpc3RzIG9yIG5vdAogICAgZW50ZXJpbnRlbnRpZF9lZGl0OiBmdW5jdGlvbiBlbnRlcmludGVudGlkX2VkaXQoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgIGludGVudF9zZWFyY2hfa2V5OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm90IEV4aXN0cyIpIHsKICAgICAgICAgIF90aGlzNS5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM1LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ICE9ICIiKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJBbHJlYWR5IEV4aXN0cyIpIHsKICAgICAgICAgIGlmIChfdGhpczUub2xkX2ludGVudF9uYW1lID09IF90aGlzNS5jdXJyZW50X3NlbGVjdGVkX2ludGVudCkgewogICAgICAgICAgICBfdGhpczUuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzNS5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlZGl0X2ludGVudF9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X2ludGVudF9kZXRhaWxzKCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0sCiAgICBkZWxldGVfc2VsZWN0ZWQ6IGZ1bmN0aW9uIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRleHQ6ICJObyBPYmplY3RpdmVzIFNlbGVjdGVkICEiLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIG5ld19pbnRlbnRfbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuY2hlY2tlZF9saXN0KSB7CiAgICAgICAgICBuZXdfaW50ZW50X2xpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXSk7CiAgICAgICAgfQoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgICAgaW50ZW50X2xpc3Q6IG5ld19pbnRlbnRfbGlzdCwKICAgICAgICAgICAgICBpc19kZWxldGU6IHRydWUsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczYuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM2LmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogX3RoaXM2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiBfdGhpczYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNi4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIklOVEVOVFMgREVMRVRFRCIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIG9iamVjdGl2ZShzKSBoYXZlIGJlZW4gZGVsZXRlZC4iLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNi5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczYuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXM2LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi5wYWdlX25vID0gX3RoaXM2LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZW50KHMpIHVzZWQgaW4gZGlhbG9nLCBkZWxldGVkIHN1Y2Nlc3NmdWxseS4gSU5URU5UUyBERUxFVEVEIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIk9iamVjdGl2ZSBoYXMgYmVlbiBkZWxldGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDgwMDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczYuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXM2LmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzNi5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczYucGFnZV9ubyA9IF90aGlzNi5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vdGhpbmcgdG8gZGVsZXRlISIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3UgaGF2ZSBub3Qgc2VsZWN0ZWQgYW55IG9iamVjdGl2ZSB0byBiZSBkZWxldGVkLiIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlRyYWluZWQgaW50ZW50IGhhcyBiZWVuIGRlbGV0ZWQuIFBsZWFzZSBUcmFpbiB0aGUgTW9kZWwgQWdhaW4gdG8gU2VlIFJlZmxlY3RlZCBDaGFuZ2VzIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlRyYWluZWQgb2JqZWN0aXZlIGhhcyBiZWVuIGRlbGV0ZWQuIFBsZWFzZSBUcmFpbiB0aGUgTW9kZWwgQWdhaW4gdG8gU2VlIFJlZmxlY3RlZCBDaGFuZ2VzIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczYuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXM2LmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzNi5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczYucGFnZV9ubyA9IF90aGlzNi5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVudChzKSB1c2VkIGluIGRpYWxvZywgZGVsZXRlZCBzdWNjZXNzZnVsbHkuIFRyYWluZWQgaW50ZW50IGhhcyBiZWVuIGRlbGV0ZWQuIFBsZWFzZSBUcmFpbiB0aGUgTW9kZWwgQWdhaW4gdG8gU2VlIFJlZmxlY3RlZCBDaGFuZ2VzIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlRyYWluZWQgb2JqZWN0aXZlIGhhcyBiZWVuIGRlbGV0ZWQuIFBsZWFzZSBUcmFpbiB0aGUgTW9kZWwgQWdhaW4gdG8gU2VlIFJlZmxlY3RlZCBDaGFuZ2VzIGFuZCB0aGlzIG9iamVjdGl2ZSBpcyB1c2VkIGluIGRpYWxvZyBub2RlKHMpIGFsc28uIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNi5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczYuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXM2LnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNi5wYWdlX25vID0gX3RoaXM2LnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICB9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM2LmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgX3RoaXM2LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzNi5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfaW50ZW50OiBmdW5jdGlvbiBlZGl0X2ludGVudCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5vbGRfaW50ZW50X25hbWUgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCkgewogICAgICAgIHZhciBpbnRlbnRfdG9fc2VuZCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGludGVudF90b19zZW5kID0gdGhpcy5vbGRfaW50ZW50X25hbWU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0c19lZGl0KSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJBbiBvYmplY3RpdmUgd2l0aCB0aGlzIG5hbWUgYWxyZWFkeSBleGlzdHMuIik7CiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYW4gb2JqZWN0aXZlIG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zW2ldID09PSAiIiB8fCB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnNbaV0gPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJRdWVzdGlvbnMgY2Fubm90IGJlIGJsYW5rIik7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJRdWVzdGlvbnMgY2Fubm90IGJlIGJsYW5rIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgZWRpdF9pbnRlbnQ6IHRydWUsCiAgICAgICAgb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25fbGlzdCwKICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgaW50ZW50X2Rlc2NyaXB0aW9uOiB0aGlzLnNlbGVjdGVkX2ludGVudF9kZXNjcmlwdGlvbiwKICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJJbnRlbnQgUXVlc3Rpb24gRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiAiSW50ZW50IGVkaXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoX3RoaXM3LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXM3LnNlYXJjaF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzNy5sb2FkX2ludGVudChfdGhpczcuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIlVzZWQgSW50ZW50IE5hbWUgRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6ICJJbnRlbnQgaGFzIGJlZW4gZWRpdGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKF90aGlzNy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM3LnNlYXJjaF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczcubG9hZF9pbnRlbnQoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50ZW50IFF1ZXN0aW9uIE5vdCBFZGl0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6ICJUaGVyZSB3YXMgYW4gaW50ZXJuYWwgc2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6ICJUaGVyZSB3YXMgYW4gaW50ZXJuYWwgc2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6ICJUaGVyZSB3YXMgYW4gaW50ZXJuYWwgc2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNob3dfbW9kZWxfcHJvZ3Jlc3M6IGZ1bmN0aW9uIHNob3dfbW9kZWxfcHJvZ3Jlc3MoaW5kZXgpIHsKICAgICAgaWYgKHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9PSB0cnVlKSB7CiAgICAgICAgaWYgKGluZGV4ID09ICdzdHlsZScpIHsKICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAndGl0bGUnKSB7CiAgICAgICAgICByZXR1cm4gIlRyYWluaW5nIGluIFByb2dyZXNzIChUaGlzIHByb2Nlc3MgbWlnaHQgdGFrZSBhcm91bmQgMzAgbWlucyB0byBmaW5pc2gpICI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzOiBmdW5jdGlvbiBjaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXMoKSB7CiAgICAgIHRoaXMubW9kZWxfc3RhdHVzID0gdGhpcy4kc2Vzc2lvbi5nZXQoIk1vZGVsU3RhdHVzIik7CgogICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbih0aGlzLm1vZGVsX3N0YXR1cy5pbnRlbnRfbW9kZWwpID09PSB0cnVlIHx8IEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwpID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzLmludGVudF9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIgfHwgdGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiKSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICB0cmFpbl9tb2RlbDogZnVuY3Rpb24gdHJhaW5fbW9kZWwoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgU3dhbCh7CiAgICAgICAgdGl0bGU6ICJBcmUgWW91IFN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gVHJhaW4gVGhlIE1vZGVsPyIsCiAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIiwKICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudHJhaW5fbW9kZWwoKSwgewogICAgICAgICAgICBlbWFpbDogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM4LmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczguY29tcGFueWlkCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzOC4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXM4LndhbnRfc3RhdHVzID0gdHJ1ZTsKCiAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLCBfdGhpczgud2FudF9zdGF0dXMpOwoKICAgICAgICAgICAgX3RoaXM4LmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHX0NPREUgPT09IDQwNDYpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLk1TRyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PT0gMTAzNCkgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLk1TRyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdGVkX2ludGVudHM6IGZ1bmN0aW9uIHNlbGVjdGVkX2ludGVudHMoSW50ZW50KSB7CiAgICAgIGlmIChJbnRlbnQgPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRoaXMuaW50ZW50bGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSW50ZW50OwogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjaW50ZW50X2NoZWNrYm94XyIgKyB0aGlzLmNoZWNrZWRfbGlzdFtpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHZhbF9pbmRleCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoaW50ZW50cykgewogICAgICAgICAgICByZXR1cm4gaW50ZW50cy5JbnRlbnQgPT0gSW50ZW50OwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHZhbF9pbmRleC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKEludGVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzICE9IEludGVudDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGludGVudF9uYW1lX2NoZWNrX3NwZWNpYWxfY2hhcmFjdGVyczogZnVuY3Rpb24gaW50ZW50X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzKGUpIHsKICAgICAgaWYgKC9eW15hLXpBLVowLTlfIF0qJC8udGVzdChlLmtleSkpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2ludGVudDogZnVuY3Rpb24gbG9hZF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICAvLyB0aGlzLmludGVudGxpc3QgPSBbXTsKICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgIF90aGlzOS5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgX3RoaXM5LnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKF90aGlzOS5udW1iZXJfb2Zfcm93cyAvIF90aGlzOS5wZXJfcGFnZSk7CiAgICAgICAgICBfdGhpczkuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKCiAgICAgICAgICBpZiAoX3RoaXM5LmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICBfdGhpczkuc2hvd19pbnRlbnRzKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczkuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfdGhpczkuc2V0cGFnaW5hdGlvbihfdGhpczkucGFnZV9ubyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZTogZnVuY3Rpb24gcGFnZV9yZXF1aXJlKHBhZ2UpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7fSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PSAiIikgewogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLCB7CiAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczEwLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3QgPSBbXTsKICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwoKICAgICAgICAgICAgaWYgKF90aGlzMTAuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgX3RoaXMxMC5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTAuc2V0cGFnaW5hdGlvbihfdGhpczEwLnBhZ2Vfbm8pOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgaWYgKHRoaXMucGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2VubzsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gUmVzdWx0cyBGb3VuZCIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJObyBSZXN1bHRzIEZvdW5kIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgIT0gIkludGVybmFsIFNlcnZlciBFcnJvciIgJiYgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIEludGVudHMgRm91bmQiKSB7CiAgICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gW107CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJ0b2tlbiBpbnZhbGlkIikgewogICAgICAgICAgICAgICAgX3RoaXMxMC5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgICAgX3RoaXMxMC50b3RhbF9wYWdlcyA9IE1hdGguY2VpbChfdGhpczEwLm51bWJlcl9vZl9yb3dzIC8gX3RoaXMxMC5wZXJfcGFnZSk7CiAgICAgICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMTAuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMxMC5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIF90aGlzMTAuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMTAuc2V0cGFnaW5hdGlvbihfdGhpczEwLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMTAubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMC5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX2ludGVudF91c2VyX2V4YW1wbGU6IGZ1bmN0aW9uIHNhdmVfaW50ZW50X3VzZXJfZXhhbXBsZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiQW4gT2JqZWN0aXZlIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiA0NTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5uZXdfaW50ZW50cyA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbiBPYmplY3RpdmUgbmFtZSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5hZGRfcXVlc3Rpb25zX2xpc3RbaV0gPT09ICIiIHx8IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W2ldID09PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdHlwZSBhIHVzZXIgZXhhbXBsZSIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAzNTAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgU3dhbCh7CiAgICAgICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIGFyZSBzdWJtaXR0aW5nIHlvdXIgZGV0YWlscy4uLiIsCiAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICB9KTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgaW50ZW50X2Rlc2NyaXB0aW9uOiB0aGlzLm5ld19pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50ZW50IFNhdmVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiAiVXNlciBleGFtcGxlIHNhdmVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgIF90aGlzMTEuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICBfdGhpczExLmxvYWRfaW50ZW50KCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50ZW50IE5vdCBTYXZlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogIlRoZXJlIHdhcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogIlRoZXJlIHdhcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczExLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiAiVGhlcmUgd2FzIGFuIGludGVybmFsIHNlcnZlciBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IDQ7IF9pKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMiA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTIgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHBhZ2Vfbm8gKyAzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTQgPSBwYWdlX25vIC0gNDsgX2k0IDwgdGhpcy50b3RhbF9wYWdlczsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gMzsgX2k1IDw9IHBhZ2Vfbm8gKyAzOyBfaTUrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k1KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgdGhpcy5uZXdfaW50ZW50cyA9ICIiOwogICAgICB0aGlzLm5ld19pbnRlbnRfZGVzY3JpcHRpb24gPSAiIjsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSAiIjsKICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QgPSBbIiJdOwogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIiI7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgIH0KICB9Cn07"},null]}