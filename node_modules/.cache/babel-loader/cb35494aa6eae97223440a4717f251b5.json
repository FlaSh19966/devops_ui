{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue","mtime":1663910265482},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnZhbHVlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IHNpZGViYXJpdGVtcyBmcm9tICIuLi9MYXlvdXQvU2lkZUJhckl0ZW0iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7IGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJwZXJtaXNzaW9ucyIsCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0CiAgfSwKICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHVzZXI6IFtdLAogICAgICByb2xlczogW10sCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgc2VsZWN0ZWRfcm9sZTogIiIsCiAgICAgIHNlbGVjdGVkX3Blcm1pc3Npb25zOiBbXSwKICAgICAgcm9sZV9saXN0OiBbXSwKICAgICAgY29tcGxldGVfcm9sZV9saXN0OiBbXSwKICAgICAgcGVybWlzc2lvbnNfbGlzdDogW10sCiAgICAgIHBvcnRhbF9wZXJtaXNzaW9uc19saXN0OiBbXSwKICAgICAgYm90X3Blcm1pc3Npb25zX2xpc3Q6IFtdLAogICAgICBpbnRlbnRsaXN0OiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICB1c2VyX3R5cGU6ICJQb3J0YWwiLAogICAgICBtZW51X2xpc3RfZnJvbV9hcGk6IG51bGwsCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpIDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKSA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHVzZXJfcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgIC8vaGFyc2gKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgcG9ydGFsX3JvbGVzOiBbXSwKICAgICAgYm90X3JvbGVzOiBbXSwKICAgICAgaXNTaG93X3BvcnRhbF9yb2xlczogdHJ1ZSwKICAgICAgaXNTaG93X2JvdF9yb2xlczogZmFsc2UsCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgc2VsZWN0X3JvbGVfbmFtZV9kaXNhYmxlOiBmYWxzZSwKICAgICAgZmlsdGVyX3VzZXJfdHlwZTogIlBvcnRhbCIsCiAgICAgIHVzZXJfdHlwZV9jaGFuZ2U6IHRydWUKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgcGVybWlzc2lvbnNfdGl0bGU6IGZ1bmN0aW9uIHBlcm1pc3Npb25zX3RpdGxlKCkgewogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsKICAgICAgICByZXR1cm4gdGhpcy50bHQoJ3BvcnRhbF9tZW51X2xhYmVsJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsKICAgICAgICByZXR1cm4gdGhpcy50bHQoJ2JvdF9pbnRlbnRfbGFiZWwnKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX3BvcnRhbF9ib3Rfcm9sZV9sZW5ndGg6IGZ1bmN0aW9uIGNoZWNrX3BvcnRhbF9ib3Rfcm9sZV9sZW5ndGgoKSB7CiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIiAmJiB0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIgJiYgdGhpcy5wb3J0YWxfcm9sZXMubGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIgJiYgdGhpcy5ib3Rfcm9sZXMubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiICYmIHRoaXMuYm90X3JvbGVzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygiZW1wbHR5IGJvdCIpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5sb2FkX3Blcm1pc3Npb24oKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgdm0gPSB0aGlzOyAvLyAvL2NvbnNvbGUubG9nKHRoaXMucGFnZV9ubyk7CgogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgJCgiI2ludGVudG1vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmNsZWFyX2ZpZWxkcygpOyAvLyB2bS51c2VyX3R5cGUgPSAiUG9ydGFsIjsKCiAgICAgIHZtLnVzZXJfdHlwZV9jaGFuZ2UgPSB0cnVlOwogICAgICB2bS5zZWxlY3Rfcm9sZV9uYW1lX2Rpc2FibGUgPSBmYWxzZTsKICAgIH0pOwogICAgJCgic2VsZWN0IC5mb3JtLWNvbnRyb2wiKS5vbigiY2xpY2siLCBmdW5jdGlvbiAoKSB7fSk7CiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoX25hbWU6IGZ1bmN0aW9uIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgZmlsdGVyX3VzZXJfdHlwZTogZnVuY3Rpb24gZmlsdGVyX3VzZXJfdHlwZSgpIHsKICAgICAgaWYgKHRoaXMuZmlsdGVyX3VzZXJfdHlwZSA9PSAiUG9ydGFsIikgewogICAgICAgIHRoaXMuaXNTaG93X3BvcnRhbF9yb2xlcyA9IHRydWU7CiAgICAgICAgdGhpcy5pc1Nob3dfYm90X3JvbGVzID0gZmFsc2U7CiAgICAgICAgdGhpcy51c2VyX3R5cGUgPSAiUG9ydGFsIjsKICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsdGVyX3VzZXJfdHlwZSA9PSAiQm90IikgewogICAgICAgIHRoaXMuaXNTaG93X2JvdF9yb2xlcyA9IHRydWU7CiAgICAgICAgdGhpcy5pc1Nob3dfcG9ydGFsX3JvbGVzID0gZmFsc2U7CiAgICAgICAgdGhpcy51c2VyX3R5cGUgPSAiQm90IjsKICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBjbGVhcl9zZWFyY2hfbmFtZTogZnVuY3Rpb24gY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICByZW1vdmVfc2VsZWN0ZWRfcGVybWlzc2lvbjogZnVuY3Rpb24gcmVtb3ZlX3NlbGVjdGVkX3Blcm1pc3Npb24ocmVtb3ZlZE9wdGlvbiwgaWQpIHsKICAgICAgaWYgKHJlbW92ZWRPcHRpb24uc3ViX21lbnUgPT0gIkRhc2hib2FyZCIpIHsKICAgICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgncGVybWlzc2lvbl9jYW5ub3RfcmVtb3ZlX3NlbGVjdF9tc2cnKSk7CiAgICAgICAgdGhpcy5hZGRfc2VsZWN0ZWRfcGVybWlzc2lvbihyZW1vdmVkT3B0aW9uLnN1Yl9tZW51KTsKICAgICAgfQogICAgfSwKICAgIGFkZF9zZWxlY3RlZF9wZXJtaXNzaW9uOiBmdW5jdGlvbiBhZGRfc2VsZWN0ZWRfcGVybWlzc2lvbihyZW1vdmVkT3B0aW9uKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMudW5zaGlmdCh7CiAgICAgICAgc3ViX21lbnU6IHJlbW92ZWRPcHRpb24KICAgICAgfSk7CiAgICB9LAogICAgbG9hZF9wZXJtaXNzaW9uOiBmdW5jdGlvbiBsb2FkX3Blcm1pc3Npb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIHRoaXMucm9sZXMgPSBbXTsKICAgICAgdGhpcy5wb3J0YWxfcm9sZXMgPSBbXTsKICAgICAgdGhpcy5ib3Rfcm9sZXMgPSBbXTsKICAgICAgdGhpcy5wZXJtaXNzaW9uc19saXN0ID0gW107CiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsKICAgICAgdGhpcy5pbnRlbnRsaXN0ID0gW107CiAgICAgIHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QgPSBbXTsKICAgICAgdGhpcy5wb3J0YWxfcGVybWlzc2lvbnNfbGlzdCA9IFtdOwogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICBpZiAoIXRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSAmJiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgncGVybWlzc2lvbl9zZWxlY3RfY29tcGFueV9uYW1lX21zZycpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CgogICAgICBpZiAodGhpcy5jb21wYW55bmFtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucm9sZV91cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCItLT5sb2FkIHBlcm1pc3Npb25zIikKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICBfdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgIF90aGlzLnVwZGF0ZV9saXN0KHJlc3BvbnNlLmRhdGEuZGF0YSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdub19kYXRhX3RleHQnKSwKICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNEcm9wZG93bjogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLmRhdGFbMF0uQm90Lmxlbmd0aCwiLS0+cGVybWlzc2lvbiB1cmwiKQogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMuY29tcGxldGVfcm9sZV9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YVswXS5Qb3J0YWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5kYXRhWzBdLlBvcnRhbC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgX3RoaXMucG9ydGFsX3JvbGVzLnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhWzBdLlBvcnRhbFtpXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhWzBdLkJvdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHJlc3BvbnNlLmRhdGEuZGF0YVswXS5Cb3QubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5ib3Rfcm9sZXMucHVzaChyZXNwb25zZS5kYXRhLmRhdGFbMF0uQm90W19pXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdub19kYXRhX3RleHQnKSwKICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNHZXRNZW51OiB0cnVlCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgICB2YXIgajsKCiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMubWVudV9saXN0X2Zyb21fYXBpID0gcmVzcG9uc2UuZGF0YS5kYXRhLk1lbnU7CiAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLmRhdGEuTWVudTsgLy8gLy9jb25zb2xlLmxvZyhtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdmFyIG1lbnUgPSB7fTsKICAgICAgICAgICAgICB2YXIgbWFpbl9tZW51X2xpc3QgPSBtZXNzYWdlLmZpbHRlcihmdW5jdGlvbiAoYXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyLklzTWFzdGVyTWVudSA9PSB0cnVlICYmIGFyci5FbmFibGVkID09IHRydWU7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIG1haW5fbWVudV9saXN0X2ZpbHRlcmVkID0gW107CiAgICAgICAgICAgICAgdmFyIHN1Yl9tZW51X2xpc3QgPSBtZXNzYWdlLmZpbHRlcihmdW5jdGlvbiAoYXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyLkhhc1N1Yk1lbnVzID09IGZhbHNlICYmIGFyci5FbmFibGVkID09IHRydWUgJiYgYXJyLklzU3ViTWVudSA9PSB0cnVlOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpLCBuKSB7CiAgICAgICAgICAgICAgICB2YXIgbWVudUZpbHRlciA9IHNpZGViYXJpdGVtcy5maWx0ZXIoZnVuY3Rpb24gKHNpZGViYXIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZGViYXIubmFtZSA9PT0gbWFpbl9tZW51X2xpc3RbaV0uTWVudUl0ZW0gJiYgQm9vbGVhbihzaWRlYmFyLnN2Z19odG1sKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChtZW51RmlsdGVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgbWFpbl9tZW51X2xpc3RfZmlsdGVyZWQucHVzaChtZW51RmlsdGVyWzBdKTsKICAgICAgICAgICAgICAgICAgbWVudVttZW51RmlsdGVyWzBdLm5hbWVdID0gewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBtZW51RmlsdGVyWzBdLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgbWVudV9saXN0OiBbXQogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgaWYgKG1haW5fbWVudV9saXN0W2ldLkhhc1N1Yk1lbnVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgbWVudVttZW51RmlsdGVyWzBdLm5hbWVdLm1lbnVfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHN1Yl9tZW51OiBtZW51RmlsdGVyWzBdLm5hbWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gbWFpbl9tZW51X2xpc3QubGVuZ3RoOyBpIDwgbjsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBfbG9vcChpLCBuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwLCBfbiA9IHN1Yl9tZW51X2xpc3QubGVuZ3RoOyBfaTIgPCBfbjsgX2kyICs9IDEpIHsKICAgICAgICAgICAgICAgICAgZm9yIChqIGluIHNpZGViYXJpdGVtcykgewogICAgICAgICAgICAgICAgICAgIGlmIChzaWRlYmFyaXRlbXNbal0ubmFtZSA9PT0gc3ViX21lbnVfbGlzdFtfaTJdLk1lbnVJdGVtICYmIEJvb2xlYW4oc2lkZWJhcml0ZW1zW2pdLnBhZ2VfcGF0aCAmJiBzaWRlYmFyaXRlbXNbal0ubWFzdGVyX21lbnUgPT09IHN1Yl9tZW51X2xpc3RbX2kyXS5NYXN0ZXJNZW51KSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhzaWRlYmFyaXRlbXNbal0ubmFtZSkKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wX3ZhciA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lCiAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgIG1lbnVbc3ViX21lbnVfbGlzdFtfaTJdLk1hc3Rlck1lbnVdLm1lbnVfbGlzdC5wdXNoKHRlbXBfdmFyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7Ly8gLy9jb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWVudSA9IE9iamVjdC52YWx1ZXMobWVudSk7IC8vIC8vY29uc29sZS5sb2cobWVudSk7CiAgICAgICAgICAgICAgLy8gbWVudSA9IFtdOwogICAgICAgICAgICAgIC8vIHZhciB0aXRsZSA9IFtdOwogICAgICAgICAgICAgIC8vIHZhciBzdWJtZW51cyA9IFtdOwogICAgICAgICAgICAgIC8vIGZvciAobGV0IGkgPSAwLCBuID0gcmVzcG9uc2UuZGF0YS5NZW51Lmxlbmd0aDsgaSA8IG47IGkgKz0gMSkgewogICAgICAgICAgICAgIC8vICAgaWYgKAogICAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSGFzU3ViTWVudXMgPT0gZmFsc2UgJiYKICAgICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLklzTWFzdGVyTWVudQogICAgICAgICAgICAgIC8vICAgKSB7CiAgICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7CiAgICAgICAgICAgICAgLy8gICAgICAgaWYgKHNpZGViYXJpdGVtc1tqXS5uYW1lID09PSByZXNwb25zZS5kYXRhLk1lbnVbaV0uTWVudUl0ZW0pIHsKICAgICAgICAgICAgICAvLyAgICAgICAgIHRpdGxlID0gc2lkZWJhcml0ZW1zW2pdLm5hbWU7CiAgICAgICAgICAgICAgLy8gICAgICAgICBzdWJtZW51cy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lLAogICAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NZW51W2ldLkVuYWJsZWQpIHsKICAgICAgICAgICAgICAvLyAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBzdWJfbWVudTogc2lkZWJhcml0ZW1zW2pdLm5hbWUsCiAgICAgICAgICAgICAgLy8gICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vICAgICAgICAgfQogICAgICAgICAgICAgIC8vICAgICAgIH0KICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLkhhc1N1Yk1lbnVzID09IHRydWUgJiYKICAgICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLklzTWFzdGVyTWVudQogICAgICAgICAgICAgIC8vICAgKSB7CiAgICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7CiAgICAgICAgICAgICAgLy8gICAgICAgaWYgKHNpZGViYXJpdGVtc1tqXS5uYW1lID09PSByZXNwb25zZS5kYXRhLk1lbnVbaV0uTWVudUl0ZW0pIHsKICAgICAgICAgICAgICAvLyAgICAgICAgIHRpdGxlID0gc2lkZWJhcml0ZW1zW2pdLm5hbWU7CiAgICAgICAgICAgICAgLy8gICAgICAgfQogICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgLy8gICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSGFzU3ViTWVudXMgPT0gZmFsc2UgJiYKICAgICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLklzU3ViTWVudQogICAgICAgICAgICAgIC8vICAgKSB7CiAgICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7CiAgICAgICAgICAgICAgLy8gICAgICAgaWYgKHNpZGViYXJpdGVtc1tqXS5uYW1lID09PSByZXNwb25zZS5kYXRhLk1lbnVbaV0uTWVudUl0ZW0pIHsKICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1lbnVbaV0uRW5hYmxlZCkgewogICAgICAgICAgICAgIC8vICAgICAgICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnB1c2goewogICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZSwKICAgICAgICAgICAgICAvLyAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gICAgICAgICB9CiAgICAgICAgICAgICAgLy8gICAgICAgICBzdWJtZW51cy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lLAogICAgICAgICAgICAgIC8vICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gICAgICAgfQogICAgICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gICBpZiAoaSA9PT0gbiAtIDEpIHsKICAgICAgICAgICAgICAvLyAgICAgbWVudS5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgLy8gICAgICAgbWVudV9saXN0OiBzdWJtZW51cywKICAgICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgICAgLy8gICAgIHRpdGxlID0gW107CiAgICAgICAgICAgICAgLy8gICAgIHN1Ym1lbnVzID0gW107CiAgICAgICAgICAgICAgLy8gICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIC8vICAgICBpIDwgbiAtIDEgJiYKICAgICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2kgKyAxXS5IYXNTdWJNZW51cyA9PSB0cnVlICYmCiAgICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuTWVudVtpICsgMV0uSXNNYXN0ZXJNZW51CiAgICAgICAgICAgICAgLy8gICApIHsKICAgICAgICAgICAgICAvLyAgICAgbWVudS5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgLy8gICAgICAgbWVudV9saXN0OiBzdWJtZW51cywKICAgICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgICAgLy8gICAgIHRpdGxlID0gW107CiAgICAgICAgICAgICAgLy8gICAgIHN1Ym1lbnVzID0gW107CiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIC8vIC8vY29uc29sZS5sb2cobWVudSk7CgogICAgICAgICAgICAgIF90aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0ID0gbWVudTsKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpcy50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwKICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJwb3J0YWwgcGVybWlzc2lvbnMgdXJsIikKCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZ2V0X3Rhc2tfbGlzdCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc0dldE1lbnU6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJnZXQgdGFzayBsaXN0IikKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhKSB7CiAgICAgICAgICAgIF90aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0LnB1c2goewogICAgICAgICAgICAgIHBlcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLmRhdGFbaV0sCiAgICAgICAgICAgICAgdG9fYmVfZGlzcGxheWVkOiByZXNwb25zZS5kYXRhLmRhdGFbaV0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgX3RoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QubGVuZ3RoOyBfaTMrKykgewogICAgICAgICAgICBfdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdFtfaTNdLnRvX2JlX2Rpc3BsYXllZCA9IF90aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0W19pM10udG9fYmVfZGlzcGxheWVkLnJlcGxhY2UoL18vZywgIiAiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KCIgIikubWFwKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgfSkuam9pbigiICIpOwogICAgICAgICAgICBfdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdFtfaTNdLnRvX2JlX2Rpc3BsYXllZCA9IF90aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0W19pM10udG9fYmVfZGlzcGxheWVkLnJlcGxhY2UoL0Zvcm0vZywgIiIpOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzLnVwZGF0ZV9ib3Rfcm9sZXMoKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogX3RoaXMudGx0KCdub19kYXRhX3RleHQnKSwKICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIC8vY29uc29sZS5sb2coZSk7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMuZmlsdGVyX3VzZXJfdHlwZSA9PSAiUG9ydGFsIikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNTaG93OiB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSAsICJwb3J0YWwgcGVybWlzc2lvbnMgdXJsIikKICAgICAgICAgICAgX3RoaXMucm9sZXMgPSBbXTsKICAgICAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhOwoKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7CiAgICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gbGlzdFtpXS5NZW51LmZpbHRlcihmdW5jdGlvbiAobWVudWxpc3QpIHsKICAgICAgICAgICAgICAgIGlmIChtZW51bGlzdC5FbmFibGVkICYmICFtZW51bGlzdC5IYXNTdWJNZW51cykgewogICAgICAgICAgICAgICAgICByZXR1cm4gbWVudWxpc3QuTWVudUl0ZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIHBlcm1fbGlzdCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHBlcm1pc3Npb25zKSB7CiAgICAgICAgICAgICAgICBwZXJtX2xpc3QucHVzaChwZXJtaXNzaW9uc1tqXS5NZW51SXRlbSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogbGlzdFtpXS5Sb2xlLAogICAgICAgICAgICAgICAgdXNlcjogbGlzdFtpXS5Vc2VyVHlwZSwKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICBfdGhpcy5zZXRwYWdpbmF0aW9uKDEpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2hvd19pbnRlbnRfdXJsKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGdldF9pbnRlbnRzOiB0cnVlLAogICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIgogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIC8vIC8vY29uc29sZS5sb2cocmVzcG9uc2UgLCAicG9ydGFsIHBlcm1pc3Npb25zIHVybCIpCiAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJzaG93IGludGVudCB1cmwiKQogICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEpIHsKICAgICAgICAgICAgX3RoaXMuaW50ZW50bGlzdC5wdXNoKHsKICAgICAgICAgICAgICAvLyBwZXJtaXNzaW9uczogcmVzcG9uc2UuZGF0YVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIiksCiAgICAgICAgICAgICAgLy8gdG9fYmVfZGlzcGxheWVkOiByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwKICAgICAgICAgICAgICBwZXJtaXNzaW9uczogcmVzcG9uc2UuZGF0YS5kYXRhW2ldLAogICAgICAgICAgICAgIHRvX2JlX2Rpc3BsYXllZDogcmVzcG9uc2UuZGF0YS5kYXRhW2ldCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpcy50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwKICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICB0ZXh0OiBfdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzdmdfZW5hYmxlOiBmdW5jdGlvbiBzdmdfZW5hYmxlKHZhbHVlKSB7CiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zZWxlY3RlZF9yb2xlKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfcm9sZVtpXS5zdWJfbWVudSA9PSB2YWx1ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gImRpc3BsYXk6bm9uZSI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfcm9sZXM6IGZ1bmN0aW9uIHNlbGVjdGVkX3JvbGVzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLnJvbGVzOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHZhbF9pbmRleCA9IHRoaXMuY2hlY2tlZF9saXN0LmluZGV4T2YodGhpcy5yb2xlc1tpbmRleF0pOwogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLnJvbGVzW2luZGV4XTsKCiAgICAgICAgICBpZiAodmFsX2luZGV4ID09IC0xKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGVtcCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChyb2xlcykgewogICAgICAgICAgICByZXR1cm4gcm9sZS5yb2xlICE9PSBpbmRleDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHJvbGVfbW9kYWw6IGZ1bmN0aW9uIHJvbGVfbW9kYWwodHlwZSkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBkZWJ1Z2dlcjsKICAgICAgLy8gaWYodHlwZSA9PSAndG9nZ2xlJyl7CgogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT09IG51bGwpIHsvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgZWl0aGVyIG9mIHRoZSBVc2VyIFR5cGVzIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yb2xlX2xpc3QgPSB0aGlzLmNvbXBsZXRlX3JvbGVfbGlzdFt0aGlzLnVzZXJfdHlwZV07CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgewogICAgICAgIGlmICh0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aGlzLnJvbGVfbGlzdCA9IHRoaXMuY29tcGxldGVfcm9sZV9saXN0WyJQb3J0YWwiXTsKICAgICAgICAgIHRoaXMucGVybWlzc2lvbnNfbGlzdCA9IHRoaXMucG9ydGFsX3Blcm1pc3Npb25zX2xpc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgncGVybWlzc2lvbl9ub19yb2xlc19wb3J0YWxfdHlwZV9tc2cnKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiKSB7CiAgICAgICAgaWYgKHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMucm9sZV9saXN0ID0gdGhpcy5jb21wbGV0ZV9yb2xlX2xpc3RbIkJvdCJdOwogICAgICAgICAgdGhpcy5wZXJtaXNzaW9uc19saXN0ID0gW3sKICAgICAgICAgICAgVHlwZTogIkFjdGlvbnMiLAogICAgICAgICAgICBEZXRhaWxzOiB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIFR5cGU6ICJJbnRlbnRzIiwKICAgICAgICAgICAgRGV0YWlsczogdGhpcy5pbnRlbnRsaXN0CiAgICAgICAgICB9XTsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSAiIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3Blcm1pc3Npb25fbm9fcm9sZXNfYm90X3R5cGVfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgIHRpbWVyOiA2MDAwCiAgICAgICAgICB9KTsgLy8gdG9hc3RyLndhcm5pbmcoIk5vIFJvbGVzIEFkZGVkIGZvciBCb3QgVXNlciBUeXBlLiBQbGVhc2UgQWRkIGEgUm9sZSBmcm9tIHRoZSAnUm9sZXMnIFBhZ2UgdG8gY29udGludWUgYWRkaW5nIFBlcm1pc3Npb25zLiIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHR5cGUgPT0gIm9wZW4iKSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZF9yb2xlID0gIiI7CiAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucyA9IFtdOwogICAgICAgIHRoaXMudXNlcl90eXBlX2NoYW5nZSA9IGZhbHNlOyAvLyBpZiAodGhpcy5wb3J0YWxfcm9sZXMubGVuZ3RoID4gMCB8fCB0aGlzLmJvdF9yb2xlcy5sZW5ndGggPiAwKSB7CgogICAgICAgIGlmICh0aGlzLmJvdF9yb2xlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAvLyB0aGlzLmNsZWFyX2ZpZWxkcygpCiAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgICAgIH0gZWxzZSB7Ly8gdG9hc3RyLmVycm9yKAogICAgICAgICAgLy8gICAiUGxlYXNlIEFkZCBhIFJvbGUgZnJvbSB0aGUgJ1JvbGVzJyBQYWdlIHRvIGNvbnRpbnVlIGFkZGluZyBQZXJtaXNzaW9ucyIKICAgICAgICAgIC8vICk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3NlbGVjdGVkOiBmdW5jdGlvbiBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciByb2xlbGlzdCA9IFtdLAogICAgICAgICAgcmVzdHJpY3Rpb25saXN0ID0gW107CgogICAgICBmb3IgKHZhciBpIGluIHRoaXMucm9sZXMpIHsKICAgICAgICByb2xlbGlzdC5wdXNoKHRoaXMucm9sZXNbaW5kZXhdLnJvbGUpOwogICAgICAgIHJlc3RyaWN0aW9ubGlzdC5wdXNoKHRoaXMucm9sZXNbaW5kZXhdLnBlcm1pc3Npb25zKTsKICAgICAgfQoKICAgICAgdGhpcy5kZWxldGVfcW5zX2FwaShyb2xlbGlzdCwgcmVzdHJpY3Rpb25saXN0KTsKICAgIH0sCiAgICBkZWxldGVfcm9sZTogZnVuY3Rpb24gZGVsZXRlX3JvbGUoaW5kZXgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0sCiAgICBlZGl0X21vZGFsOiBmdW5jdGlvbiBlZGl0X21vZGFsKGluZGV4KSB7CiAgICAgIHRoaXMudXNlcl90eXBlX2NoYW5nZSA9IGZhbHNlOwogICAgICB0aGlzLnNlbGVjdF9yb2xlX25hbWVfZGlzYWJsZSA9IHRydWU7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNwb3J0YWxfYm94IikuZGlzYWJsZWQgPSB0cnVlOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjYm90X2JveCIpLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5zZWxlY3RlZF9yb2xlID0gdGhpcy5yb2xlc1tpbmRleF0udXNlcl9yb2xlOyAvLyAvL2NvbnNvbGUubG9nKHRoaXMucm9sZXNbaW5kZXhdLnVzZXJfcm9sZSk7CgogICAgICB0aGlzLnVzZXJfdHlwZSA9IHRoaXMucm9sZXNbaW5kZXhdLnVzZXIucmVwbGFjZSgiIFVzZXIiLCAiIik7CiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsKCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiQm90IikgewogICAgICAgIC8vIHRoaXMucGVybWlzc2lvbnNfbGlzdCA9IHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3Q7CiAgICAgICAgdGhpcy5wZXJtaXNzaW9uc19saXN0ID0gW3sKICAgICAgICAgIFR5cGU6ICJBY3Rpb25zIiwKICAgICAgICAgIERldGFpbHM6IHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QKICAgICAgICB9LCB7CiAgICAgICAgICBUeXBlOiAiSW50ZW50cyIsCiAgICAgICAgICBEZXRhaWxzOiB0aGlzLmludGVudGxpc3QKICAgICAgICB9XTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgewogICAgICAgIHRoaXMucGVybWlzc2lvbnNfbGlzdCA9IHRoaXMucG9ydGFsX3Blcm1pc3Npb25zX2xpc3Q7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGogaW4gdGhpcy5yb2xlc1tpbmRleF0ucGVybWlzc2lvbnMpIHsKICAgICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMucHVzaCh7CiAgICAgICAgICAgIHBlcm1pc3Npb25zOiB0aGlzLnJvbGVzW2luZGV4XS5vcmlnaW5hbF9wZXJtaXNzaW9uc1tqXSwKICAgICAgICAgICAgdG9fYmVfZGlzcGxheWVkOiB0aGlzLnJvbGVzW2luZGV4XS5wZXJtaXNzaW9uc1tqXQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucy5wdXNoKHsKICAgICAgICAgICAgc3ViX21lbnU6IHRoaXMucm9sZXNbaW5kZXhdLnBlcm1pc3Npb25zW2pdCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucm9sZV9saXN0ID0gdGhpcy5jb21wbGV0ZV9yb2xlX2xpc3RbdGhpcy51c2VyX3R5cGVdOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZTogZnVuY3Rpb24gcGFnZV9yZXF1aXJlKHBhZ2UpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKSB7CiAgICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7IC8vIHRoaXMucGFnZV9ubyA9IHBhZ2U7CgogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwgewogICAgICAgICAgICAgIHJvbGU6IHRoaXMudXNlcl9yb2xlLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaXNTaG93OiB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMsCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSAsICJwb3J0YWwgcGVybSIpCiAgICAgICAgICAgICAgICBfdGhpczIubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgICBfdGhpczIudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgICAgX3RoaXMyLnNldHBhZ2luYXRpb24oX3RoaXMyLnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJvbGVQZXJtaXNzaW9uRGF0YTsKICAgICAgICAgICAgICAgIF90aGlzMi5yb2xlcyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gbGlzdCkgewogICAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKGZ1bmN0aW9uIChtZW51bGlzdCkgewogICAgICAgICAgICAgICAgICAgIGlmIChtZW51bGlzdC5FbmFibGVkICYmICFtZW51bGlzdC5IYXNTdWJNZW51cykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbnVsaXN0Lk1lbnVJdGVtOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHZhciBwZXJtX2xpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsKICAgICAgICAgICAgICAgICAgICBwZXJtX2xpc3QucHVzaChwZXJtaXNzaW9uc1tqXS5NZW51SXRlbSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIF90aGlzMi5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IGxpc3RbaV0uUm9sZSwKICAgICAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLAogICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwoKICAgICAgICAgICAgICAgIF90aGlzMi5zZXRwYWdpbmF0aW9uKF90aGlzMi5wYWdlX25vKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMi50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMyLnRsdCgnbm9fZGF0YV90ZXh0JyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbHRlcl91c2VyX3R5cGUgPT0gIkJvdCIpIHsKICAgICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmFkZF9lZGl0X2JvdF9yb2xlKCksIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGlzU2hvdzogdGhpcy5pc1Nob3dfYm90X3JvbGVzLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIF90aGlzMi50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgICBfdGhpczIuc2V0cGFnaW5hdGlvbihfdGhpczIucGFnZV9ubyk7CgogICAgICAgICAgICAgICAgX3RoaXMyLnJvbGVzID0gW107CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhKSB7CiAgICAgICAgICAgICAgICAgIC8vIGxldCBib3RSb2xlcyA9IHRoaXMuYm90X3JvbGVzLm1hcCgoeyByb2xlIH0pID0+IHsKICAgICAgICAgICAgICAgICAgLy8gICByZXR1cm4gcm9sZTsKICAgICAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgICAgIC8vIGlmIChib3RSb2xlcy5pbmNsdWRlcyhpKSkgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLmJvdF9yb2xlcy5pbmNsdWRlcyhpKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzMi5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHVzZXI6ICJCb3QgVXNlciIsCiAgICAgICAgICAgICAgICAgICAgICB1c2VyX3JvbGU6ICIiLmNvbmNhdChpKSwKICAgICAgICAgICAgICAgICAgICAgIGlucHV0X2VuYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhW2ldLm1hcChmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMucmVwbGFjZSgvXy9nLCAiICIpLnRvTG93ZXJDYXNlKCkuc3BsaXQoIiAiKS5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCIgIik7CiAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Blcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhW2ldCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczIudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgICAgX3RoaXMyLnNldHBhZ2luYXRpb24oX3RoaXMyLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMyLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczIudGx0KCdub19kYXRhX3RleHQnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucG9ydGFsX3Blcm1pc3Npb25zX3VybCgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKCJwZXJtaXNzaW9uIiAsIHJlc3BvbnNlKQogICAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB2YXIgbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5Sb2xlUGVybWlzc2lvbkRhdGE7CiAgICAgICAgICAgICAgX3RoaXMyLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIF90aGlzMi50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgX3RoaXMyLnNldHBhZ2luYXRpb24oX3RoaXMyLnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICBfdGhpczIucm9sZXMgPSBbXTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKGZ1bmN0aW9uIChtZW51bGlzdCkgewogICAgICAgICAgICAgICAgICBpZiAobWVudWxpc3QuRW5hYmxlZCAmJiAhbWVudWxpc3QuSGFzU3ViTWVudXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVudWxpc3QuTWVudUl0ZW07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIHBlcm1fbGlzdCA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsKICAgICAgICAgICAgICAgICAgcGVybV9saXN0LnB1c2gocGVybWlzc2lvbnNbal0uTWVudUl0ZW0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMi5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgdXNlcl9yb2xlOiBsaXN0W2ldLlJvbGUsCiAgICAgICAgICAgICAgICAgIHVzZXI6IGxpc3RbaV0uVXNlclR5cGUsCiAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczIudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczIuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMi50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy8gZWxzZSBpZihyZXNwb25zZS5kYXRhLk1TRz09J05vIFJlc3VsdHMgRm91bmQnKXsKICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIk5vIHJvbGUgZm91bmQiKTsKICAgICAgICAgICAgLy8gICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgLy8gICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgIC8vICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBlbHNlIGlmKHJlc3BvbnNlLmRhdGEuTVNHPT0nSW50cm5hbCBTZXJ2ZXIgRXJyb3InKXsKICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIkludHJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgIC8vICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIC8vICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAvLyAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNhdmVfcm9sZTogZnVuY3Rpb24gc2F2ZV9yb2xlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX3JvbGUgPT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucy5sZW5ndGggPT0gMCkge30gZWxzZSBpZiAodGhpcy5zZWxlY3RlZF9yb2xlID09ICJBZG1pbiIpIHsKICAgICAgICB0aGlzLmNsZWFyX2ZpZWxkcygpOwogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJQb3J0YWwiKSB7CiAgICAgICAgdmFyIHNlbGVjdGVkX21lbnUgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zKSB7CiAgICAgICAgICBzZWxlY3RlZF9tZW51LnB1c2godGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9uc1tpXS5zdWJfbWVudSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMubWVudV9saXN0X2Zyb21fYXBpKSB7CiAgICAgICAgICBpZiAoc2VsZWN0ZWRfbWVudS5pbmNsdWRlcyh0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaVtpXS5NZW51SXRlbSkpIHRoaXMubWVudV9saXN0X2Zyb21fYXBpW2ldLkVuYWJsZWQgPSB0cnVlO2Vsc2UgdGhpcy5tZW51X2xpc3RfZnJvbV9hcGlbaV0uRW5hYmxlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucG9ydGFsX3Blcm1pc3Npb25zX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc0VkaXQ6IHRydWUsCiAgICAgICAgICByb2xlX25hbWU6IHRoaXMuc2VsZWN0ZWRfcm9sZSwKICAgICAgICAgIHVzZXJfdHlwZTogdGhpcy51c2VyX3R5cGUgKyAiIFVzZXIiLAogICAgICAgICAgbWVudTogdGhpcy5tZW51X2xpc3RfZnJvbV9hcGkKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMy50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5VU0VSX1JPTEVfRURJVEVEX1NVQ0NFU1NGVUxMWV8yMDAyLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKF90aGlzMy50bHQoJ3Blcm1pc3Npb25fdXBkYXRlZF9mb3JfbG9naW5fbXNnMScpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgIF90aGlzMy5sb2FkX3Blcm1pc3Npb24oKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdzYXZlX3Blcm1pc3Npb25zJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRfbWVudSA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMpIHsKICAgICAgICAgIHNlbGVjdGVkX21lbnUucHVzaCh0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zW2ldLnBlcm1pc3Npb25zKTsKICAgICAgICB9CgogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmFkZF9lZGl0X2JvdF9yb2xlKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGJvdF9yb2xlX25hbWU6IHRoaXMuc2VsZWN0ZWRfcm9sZSwKICAgICAgICAgIHBlcm1pc3Npb25fbGlzdDogc2VsZWN0ZWRfbWVudQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoX3RoaXMzLnRsdCgncGVybWlzc2lvbl91cGRhdGVkX2Zvcl9sb2dpbl9tc2cyJykpOwoKICAgICAgICAgICAgX3RoaXMzLmxvYWRfcGVybWlzc2lvbigpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMy50bHQoJ3Blcm1pc3Npb25faW50ZXJuYWxfc2VydmVyX21zZycpKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnbm9fZGF0YV90ZXh0JyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiI2ludGVudG1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdzYXZlX3Blcm1pc3Npb25zJyk7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0X3Jlc3RyaWN0aW9uczogZnVuY3Rpb24gZWRpdF9yZXN0cmljdGlvbnMoaW5kZXgpIHsKICAgICAgaWYgKHRoaXMucm9sZXNbaW5kZXhdLnVzZXIgIT0gIiIpIHsKICAgICAgICB0aGlzLnJvbGVzW2luZGV4XS5pbnB1dF9lbmFibGUgPSAhdGhpcy5yb2xlc1tpbmRleF0uaW5wdXRfZW5hYmxlOwogICAgICB9CgogICAgICB0aGlzLmVkaXQgPSB0cnVlOwogICAgfSwKICAgIHVwZGF0ZV9saXN0OiBmdW5jdGlvbiB1cGRhdGVfbGlzdChyZXNwb25zZSkgewogICAgICAvLyB0aGlzLnJvbGVzID0gW107CiAgICAgIHZhciBpbnB1dDsgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSwncmVzcG9uc2VzJyk7CiAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKQoKICAgICAgaWYgKHJlc3BvbnNlLnJlc3RyaWN0aW9ubGlzdFswXSAhPSBudWxsKSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5yZXN0cmljdGlvbmxpc3QpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN0cmljdGlvbmxpc3RbaV0gPT0gIiIpIHsKICAgICAgICAgICAgaW5wdXQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW5wdXQgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goewogICAgICAgICAgICB1c2VyOiByZXNwb25zZS5yZXN0cmljdGlvbmxpc3RbaV0sCiAgICAgICAgICAgIHJvbGU6IHJlc3BvbnNlLnJvbGVsaXN0W2ldLAogICAgICAgICAgICBpbnB1dF9lbmFibGU6IGlucHV0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVfYm90X3JvbGVzOiBmdW5jdGlvbiB1cGRhdGVfYm90X3JvbGVzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmZpbHRlcl91c2VyX3R5cGUgPT0gIkJvdCIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5hZGRfZWRpdF9ib3Rfcm9sZSgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc1Nob3c6IHRoaXMuaXNTaG93X2JvdF9yb2xlcywKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM0LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwoKICAgICAgICAgICAgX3RoaXM0LnNldHBhZ2luYXRpb24oX3RoaXM0LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhKSB7CiAgICAgICAgICAgICAgLy8gbGV0IGJvdFJvbGVzID0gdGhpcy5ib3Rfcm9sZXMubWFwKCh7IHJvbGUgfSkgPT4gewogICAgICAgICAgICAgIC8vICAgcmV0dXJuIHJvbGU7CiAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgLy8gaWYgKGJvdFJvbGVzLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzNC5ib3Rfcm9sZXMuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgICAgICAgIF90aGlzNC5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgdXNlcjogIkJvdCBVc2VyIiwKICAgICAgICAgICAgICAgICAgdXNlcl9yb2xlOiAiIi5jb25jYXQoaSksCiAgICAgICAgICAgICAgICAgIGlucHV0X2VuYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0ubWFwKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnJlcGxhY2UoL18vZywgIiAiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KCIgIikubWFwKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Blcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhW2ldCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzNC50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgIF90aGlzNC5zZXRwYWdpbmF0aW9uKF90aGlzNC5wYWdlX25vKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM0LnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczQudGx0KCdub19kYXRhX3RleHQnKSwKICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBfdGhpczQubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICBfdGhpczQudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgX3RoaXM0LnNldHBhZ2luYXRpb24oX3RoaXM0LnBhZ2Vfbm8pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9maWVsZHM6IGZ1bmN0aW9uIGNsZWFyX2ZpZWxkcygpIHsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3BvcnRhbF9ib3giKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjYm90X2JveCIpLmRpc2FibGVkID0gZmFsc2U7CiAgICAgIHRoaXMuc2VsZWN0ZWRfcm9sZSA9ICIiOwogICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zID0gW107CiAgICAgICQoIiNpbnRlbnRtb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgdGhpcy5zZWFyY2hfcHJvZHVjdCgpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX3Byb2R1Y3Q6IGZ1bmN0aW9uIHNlYXJjaF9wcm9kdWN0KCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICBrZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhOwogICAgICAgICAgICBfdGhpczUubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIF90aGlzNS50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgX3RoaXM1LnBhZ2Vfbm8gPSAxOwoKICAgICAgICAgICAgX3RoaXM1LnNldHBhZ2luYXRpb24oX3RoaXM1LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgX3RoaXM1LnJvbGVzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsKICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKGZ1bmN0aW9uIChtZW51bGlzdCkgewogICAgICAgICAgICAgICAgaWYgKG1lbnVsaXN0LkVuYWJsZWQgJiYgIW1lbnVsaXN0Lkhhc1N1Yk1lbnVzKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107CgogICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsKICAgICAgICAgICAgICAgIHBlcm1fbGlzdC5wdXNoKHBlcm1pc3Npb25zW2pdLk1lbnVJdGVtKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzNS5yb2xlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogbGlzdFtpXS5Sb2xlLAogICAgICAgICAgICAgICAgdXNlcjogbGlzdFtpXS5Vc2VyVHlwZSwKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzNS50bHQoInBlcm1pc3Npb25fbm9fcm9sZV9mb3VuZF9tc2ciKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXM1LmxvYWRfcGVybWlzc2lvbigpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXM1LnRsdCgicGVybWlzc2lvbl9pbnRlcm5hbF9zZXJ2ZXJfbXNnMiIpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczUubG9hZF9wZXJtaXNzaW9uKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczUubG9hZF9wZXJtaXNzaW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdwZXJtaXNzaW9uX2RhdGFfZm9yX3NlYXJjaF9tc2cnKSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgNDsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2k1IDwgdGhpcy50b3RhbF9wYWdlczsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCBwYWdlX25vICsgMzsgX2k2KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNiArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k3ID0gcGFnZV9ubyAtIDQ7IF9pNyA8IHRoaXMudG90YWxfcGFnZXM7IF9pNysrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTcgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k4ID0gcGFnZV9ubyAtIDM7IF9pOCA8PSBwYWdlX25vICsgMzsgX2k4KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pOCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}