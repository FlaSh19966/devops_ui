{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue","mtime":1663910265462},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5sYXN0LWluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgeyBmcmVlemVfcG9ydGFsLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwsIGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKaW1wb3J0IHN3YWwgZnJvbSAnc3dlZXRhbGVydDInOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk5lclRyYWluaW5nUGFnZSIsCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHN1Yl9lbnRpdGllczogewogICAgICAgIHN0YXJ0OiAwLAogICAgICAgIGVuZDogMCwKICAgICAgICB2YWx1ZTogIiIsCiAgICAgICAgZW50aXR5OiAiIgogICAgICB9LAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgcGFnZW5vOiAiIiwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGRyb3BfZG93bl9zZWxlY3Q6ICIiLAogICAgICB3b3JkX3NlbGVjdGVkOiBmYWxzZSwKICAgICAgaGlnaGxpZ2h0ZWRfdGV4dDogIiIsCiAgICAgIHN0YXRlbWVudHM6IFtdLAogICAgICBzZWxlY3RlZF9zdGF0ZW1lbnQ6ICIiLAogICAgICBzdGF0ZW1lbnRfYXJyYXk6IFtdLAogICAgICBtYXN0ZXJfc3RhdGVtZW50c19saXN0OiBbXSwKICAgICAgY3VycmVudF9wYWdlOiAxLAogICAgICBkb25lX2VudGl0aWVzOiBbXSwKICAgICAgZW50aXRpZXNfbGlzdDogW10sCiAgICAgIGVudGl0aWVzX2xpc3Rfc3RyaW5nOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgY3N2X2ZpbGU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICB3b3JkX2luZm86IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBidWZmZXJfd29yZF9saXN0OiBbXSwKICAgICAgZGVsZXRlX25lcl90YWdzOiBbXSwKICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgbm90VHJhaW5lZFF1ZXN0aW9uczogW10sCiAgICAgIGluZm9faWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9pbmZvX2ljb24uc3ZnIiksCiAgICAgIG5ld19zdGF0ZW1lbnQ6ICIiLAogICAgICBlZGl0X3N0YXRlbWVudDogIiIsCiAgICAgIHdhbnRfc3RhdHVzOiB0cnVlLAogICAgICBuZXJfbW9kZWxfaW5wcm9ncmVzczogZmFsc2UsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWQ6IG51bGwsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXBvbmVudHM6IHt9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gYXhpb3MKICAgIC8vICAgLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWcoKSwgewogICAgLy8gICAgIHBhcmFtczogewogICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgIC8vICAgICB9LAogICAgLy8gICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgIH0sCiAgICAvLyAgIH0pCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAvLyAgICAgICB0aGlzLndvcmRfaW5mbyA9IHJlc3BvbnNlLmRhdGE7CiAgICAvLyAgICAgICB0aGlzLmJ1ZmZlcl93b3JkX2xpc3QgPSByZXNwb25zZS5kYXRhOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CgogICAgdGhpcy5jaGVja19uZXJfbW9kZWxfc3RhdHVzKCk7IC8vIGF4aW9zCiAgICAvLyAgIC5wb3N0KAogICAgLy8gICAgIGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgZ2V0X3RhZ2dlZF9zdGF0ZW1lbnRzOiB0cnVlLAogICAgLy8gICAgIH0sCiAgICAvLyAgICAgewogICAgLy8gICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgfQogICAgLy8gICApCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAvLyAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5lciBUYWcgQ29tcGxldGVkIikgewogICAgLy8gICAgICAgICAvLyB0aGlzLmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLlJlc3BvbnNlKTsKICAgIC8vICAgICAgICAgdGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5SZXNwb25zZTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIC8vIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBc3NpZ24gTmVyIFRhZyIpIHsKICAgIC8vICAgICAgIC8vICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgIC8vIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIERhdGEgQXZhaWxhYmxlIikgewogICAgLy8gICAgICAgLy8gICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgLy8gfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAvLyAgICAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAvLyB9CiAgICAvLyAgICAgfQogICAgLy8gICB9KQogICAgLy8gICAuY2F0Y2goKGUpID0+IHsKICAgIC8vICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICApIHsKICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5mcmVlemVfcG9ydGFsKCk7CiAgICB9LCAxMDAwKTsKICAgIHRoaXMuJHJvb3QuJG9uKCJOZXJUcmFpbmluZ1BhZ2VEaXNhYmxlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgX3RoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgJCgnW2RhdGEtdG9nZ2xlPSJwb3BvdmVyIl0nKS5wb3BvdmVyKHsKICAgICAgaHRtbDogdHJ1ZSwKICAgICAgY29udGVudDogJCgiI3BvcG92ZXJfY29udGVudCIpCiAgICB9KS5vbigic2hvdy5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkgewogICAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuYWRkQ2xhc3MoImQtYmxvY2siKTsKICAgIH0pLm9uKCJzaG93bi5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkge30pLm9uKCJoaWRlLmJzLnBvcG92ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ub25lIik7CiAgICB9KTsKICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5jc3MoInpJbmRleCIsIDk5OTkpOwogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCJzZW5kX21vZGVsX3N0YXR1cyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09IHRydWUpIHsKICAgICAgICBfdGhpcy5jaGVja19uZXJfbW9kZWxfc3RhdHVzKCk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF9uYW1lOiBmdW5jdGlvbiBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHVwbG9hZF9uZXJfZmlsZTogZnVuY3Rpb24gdXBsb2FkX25lcl9maWxlKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgICQoIiN1cGxvYWRfY3N2X2ZpbGUiKS5tb2RhbCgnc2hvdycpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfbmVyX3N0YXRlbW5lbnQ6IGZ1bmN0aW9uIGFkZF9uZXJfc3RhdGVtbmVudCgpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICAkKCIjc3RhdGVtZW50bW9kYWwiKS5tb2RhbCgnc2hvdycpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfbmVyX3RhZzogZnVuY3Rpb24gYWRkX25lcl90YWcoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgJCgiI2V4YW1wbGVNb2RhbENlbnRlciIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRfbmVyX3N0YXRlbWVudHM6IGZ1bmN0aW9uIGxvYWRfbmVyX3N0YXRlbWVudHMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWcoKSwgewogICAgICAgIHBhcmFtczogewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczIuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLndvcmRfaW5mbyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIF90aGlzMi5idWZmZXJfd29yZF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHU19OT1RfRk9VTkQuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICAgIHRleHQ6ICdObyBuZXIgdGFncyBmb3VuZCcsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzMi53b3JkX2luZm8gPSBbXTsKICAgICAgICAgIF90aGlzMi5idWZmZXJfd29yZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgZ2V0X2FsbF9uZXJfc3RhdGVtZW50czogdHJ1ZSwKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczIubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZSk7CgogICAgICAgICAgX3RoaXMyLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICBfdGhpczIudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICBfdGhpczIuc2V0cGFnaW5hdGlvbihfdGhpczIucGFnZV9ubyk7CgogICAgICAgICAgX3RoaXMyLm5vdFRyYWluZWRRdWVzdGlvbnMgPSByZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2U7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQVNTSUdOLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgc3dhbC5maXJlKHsKICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgICB0ZXh0OiAnTm8gRGF0YSBBdmFpbGFibGUnLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczIubWFzdGVyX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgICAgX3RoaXMyLnN0YXRlbWVudHMgPSBbXTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpdGxlOiAiRXJyb3IiLAogICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgc2VydmVyIGVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGU6IGZ1bmN0aW9uIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICB0aGlzLm5ld19zdGF0ZW1lbnQgPSAiIjsKICAgICAgdGhpcy5lZGl0X3N0YXRlbWVudCA9ICIiOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQgPSBudWxsOwogICAgICB0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nID0gIiI7CiAgICB9LAogICAgYXNzaWduX3ZhcmlhYmxlOiBmdW5jdGlvbiBhc3NpZ25fdmFyaWFibGUoaW5kZXgpIHsKICAgICAgdGhpcy5lZGl0X3N0YXRlbWVudCA9IHRoaXMuc3RhdGVtZW50c1tpbmRleF0uU3RhdGVtZW50OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOwogICAgfSwKICAgIGNoZWNrX25lcl9tb2RlbF9zdGF0dXM6IGZ1bmN0aW9uIGNoZWNrX25lcl9tb2RlbF9zdGF0dXMoKSB7CiAgICAgIHRoaXMubW9kZWxfc3RhdHVzID0gdGhpcy4kc2Vzc2lvbi5nZXQoIk1vZGVsU3RhdHVzIik7CgogICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKSB7CiAgICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMubmVyX21vZGVsKSA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLm1vZGVsX3N0YXR1cy5uZXJfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiKSB7CiAgICAgICAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzOiBmdW5jdGlvbiBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KSB7CiAgICAgIGlmICh0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID09IHRydWUpIHsKICAgICAgICBpZiAoaW5kZXggPT0gJ3N0eWxlJykgewogICAgICAgICAgcmV0dXJuICJjdXJzb3I6IG5vdC1hbGxvd2VkIjsKICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09ICd0aXRsZScpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnRsdCgnbmVyX3BhZ2VfdHJhaW5pbmdfcHJvZ3Jlc3NfbXNnJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAogICAgYWRkX3N0YXRlbWVudDogZnVuY3Rpb24gYWRkX3N0YXRlbWVudCgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5uZXdfc3RhdGVtZW50LnRyaW0oKSA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX2VudGVyX3N0YXRlbWVudF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5hZGRfbmVyX3N0YXRlbWVudCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBuZXdfc3RhdGVtZW50OiB0aGlzLm5ld19zdGF0ZW1lbnQKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnbmVyX3BhZ2Vfc3RhdGVtZW50X2FkZGVkX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIF90aGlzMy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgICBfdGhpczMubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczMuYXBpX3N0YXR1c19jb2RlLkFERF9TVEFURU1FTlRfRVJST1IuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnbmVyX3BhZ2Vfd3JvbmdfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJTdGF0ZW1lbnQgYWxyZWFkeSBleGlzdHMiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMzLnRsdCgnbmVyX3BhZ2Vfc3RhdGVtZW50X2FscmVhZHlfZXhpc3RzX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdhZGRfc3RhdGVtZW50X2J0bicpOwogICAgICB9CiAgICB9LAogICAgZWRpdF9zdGF0ZW1lbnRzOiBmdW5jdGlvbiBlZGl0X3N0YXRlbWVudHMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuZWRpdF9zdGF0ZW1lbnQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkLlN0YXRlbWVudCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2VfbW9kaWZ5X3N0YXRlbWVudF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOyAvLyBjb25zb2xlLmxvZygic3RhdGVtZW50IGluZGV4IGJlZm9yZS0tLSIsIHRoaXMuY3VycmVudF9zZWxlY3RlZCk7CgogICAgICAgIHZhciB2YWxpZF9zdGF0ZW1lbnQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQpOwogICAgICAgIHZhciBrZXkgPSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5Jc1RhZ0NvbXBsZXRlZCA9ICJOTyI7CiAgICAgICAgdmFsaWRfc3RhdGVtZW50LlN0YXRlbWVudCA9IHRoaXMuZWRpdF9zdGF0ZW1lbnQ7CiAgICAgICAgdmFsaWRfc3RhdGVtZW50LlRhZyA9IFtdOwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQuc2VsZWN0ZWRfbGlzdDsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LndvcmRzX2xpc3Q7CiAgICAgICAgZmluYWxfc3RhdGVtZW50c19saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHZhbGlkX3N0YXRlbWVudCkpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50YWdfc2VudGVuY2VzX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBuZXJfdGFnX3N0YXRlbWVudDogZmluYWxfc3RhdGVtZW50c19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXM0LnRsdCgnbmVyX3BhZ2VfdGFnX3N1Ym1pdF9tc2cnKSwKICAgICAgICAgICAgICAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAvLyBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogNTUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNC5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgX3RoaXM0LmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gdGhpcy5wYWdlX3JlcXVpcmUoMSk7CiAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coIi0tLSIpOwogICAgICAgIHRoaXMuY2xvc2VfbW9kYWwoJ2VkaXRfYnRuJyk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfdGFnczogZnVuY3Rpb24gZGVsZXRlX3RhZ3MoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3dhbF9hbGVydF9tc2cnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3dhbF9yZXZlcnRfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfZGVsZXRlX21zZycpCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IHRydWU7CgogICAgICAgICAgX3RoaXM1LmRlbGV0ZV9uZXJfdGFncy5wdXNoKF90aGlzNS53b3JkX2luZm9baW5kZXhdKTsKCiAgICAgICAgICBfdGhpczUud29yZF9pbmZvLnNwbGljZShpbmRleCwgMSk7CgogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZGVsZXRlX25lcl90YWdzKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICB0YWdfbmFtZTogX3RoaXM1LmRlbGV0ZV9uZXJfdGFncwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKF90aGlzNS50bHQoJ25lcl9wYWdlX3RhZ19yZW1vdmVkX21zZycpKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgogICAgICAgICAgICAgIF90aGlzNS5kZWxldGVfbmVyX3RhZ3MgPSBbXTsgLy8gdGhpcy4kcm91dGVyLmdvKCk7CgogICAgICAgICAgICAgIF90aGlzNS5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIH0sIDUwMCk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM1LnRsdCgnbmVyX3BhZ2Vfc29tZV9lcnJvcl9tc2cxJykpOwogICAgICAgICAgICAgIF90aGlzNS5kZWxldGVfbmVyX3RhZ3MgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM1LnRsdCgnbmVyX3BhZ2Vfc29tZV9lcnJvcl9tc2cyJykpOwogICAgICAgICAgICBfdGhpczUuZGVsZXRlX25lcl90YWdzID0gW107CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc3RhcnRfdGFnZ2luZzogZnVuY3Rpb24gc3RhcnRfdGFnZ2luZygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBnZXRUYWc6IGZhbHNlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczYuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfU1RBVFVTLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNi50bHQoJ25lcl9wYWdlX3RhZ3NfYWxlcnRfbXNnJykpOwogICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX1NUQVRVUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICBfdGhpczYubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCAxNTAwKTsKCiAgICAgICAgfSBlbHNlIGlmIChfdGhpczYuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM2LnRsdCgnbmVyX3BhZ2VfdGFnc19hbGVydF9tc2cxJykpOwogICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM2LnRsdCgnbmVyX3BhZ2VfdGFnc19hbGVydF9tc2czJykpOwogICAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBwYWdlX3JlcXVpcmU6IGZ1bmN0aW9uIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7fSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICB0aGlzLnNlYXJjaF9uZXJfc3RhdG1lbnRfcGFnZV9jaGFuZ2UoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGdldF9hbGxfbmVyX3N0YXRlbWVudHM6IHRydWUsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBfdGhpczcuc3RhdGVtZW50cyA9IFtdOwoKICAgICAgICAgICAgICAgIF90aGlzNy5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlKTsgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgICAgLy8gdGhpcy50b3RhbF9wYWdlcyA9IE1hdGguY2VpbCh0aGlzLm51bWJlcl9vZl9yb3dzIC8gdGhpcy5wZXJfcGFnZSk7CgoKICAgICAgICAgICAgICAgIF90aGlzNy5zZXRwYWdpbmF0aW9uKF90aGlzNy5wYWdlX25vKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BTEwuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBfdGhpczcuc3RhdGVtZW50cyA9IFtdOwoKICAgICAgICAgICAgICAgIF90aGlzNy5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlKTsgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgICAgLy8gdGhpcy50b3RhbF9wYWdlcyA9IE1hdGguY2VpbCh0aGlzLm51bWJlcl9vZl9yb3dzIC8gdGhpcy5wZXJfcGFnZSk7CgoKICAgICAgICAgICAgICAgIF90aGlzNy5zZXRwYWdpbmF0aW9uKF90aGlzNy5wYWdlX25vKTsKCiAgICAgICAgICAgICAgICBfdGhpczcubm90VHJhaW5lZFF1ZXN0aW9ucyA9IHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BU1NJR04uTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzNy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2xlYXJfc2VhcmNoX25hbWU6IGZ1bmN0aW9uIGNsZWFyX3NlYXJjaF9uYW1lKCkgewogICAgICB0aGlzLnNlYXJjaF9uYW1lID0gIiI7CiAgICAgIHRoaXMucGFnZV9yZXF1aXJlKDEpOwogICAgfSwKICAgIHNlYXJjaF9uZXJfc3RhdG1lbnQ6IGZ1bmN0aW9uIHNlYXJjaF9uZXJfc3RhdG1lbnQoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX3Rlcm06IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2UpOyAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CgoKICAgICAgICAgICAgICBfdGhpczgudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgX3RoaXM4LnNldHBhZ2luYXRpb24oX3RoaXM4LnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BTEwuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2UpOyAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CgoKICAgICAgICAgICAgICBfdGhpczgudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgX3RoaXM4LnNldHBhZ2luYXRpb24oX3RoaXM4LnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BU1NJR04uTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ25lcl9wYWdlX25vX25lcl9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfdGhpczguc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIF90aGlzOC50b3RhbF9wYWdlcyA9IDE7CgogICAgICAgICAgICAgIF90aGlzOC5zZXRwYWdpbmF0aW9uKF90aGlzOC5wYWdlX25vKTsKCiAgICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOC5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgICAgICAgX3RoaXM4LnRvdGFsX3BhZ2VzID0gMTsKCiAgICAgICAgICAgICAgX3RoaXM4LnNldHBhZ2luYXRpb24oX3RoaXM4LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9zZWFyY2hfYWxlcnRfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9uZXJfc3RhdG1lbnRfcGFnZV9jaGFuZ2U6IGZ1bmN0aW9uIHNlYXJjaF9uZXJfc3RhdG1lbnRfcGFnZV9jaGFuZ2UoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF90ZXJtOiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfdGhpczkuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQUxMLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOS5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5SZXNwb25zZSk7IC8vIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKCgogICAgICAgICAgICAgIF90aGlzOS50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwoKICAgICAgICAgICAgICBfdGhpczkuc2V0cGFnaW5hdGlvbihfdGhpczkucGFnZV9ubyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FTU0lHTi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzOS5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgICAgICAgX3RoaXM5LnRvdGFsX3BhZ2VzID0gMTsKCiAgICAgICAgICAgICAgX3RoaXM5LnNldHBhZ2luYXRpb24oX3RoaXM5LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXM5LnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICBfdGhpczkudG90YWxfcGFnZXMgPSAxOwoKICAgICAgICAgICAgICBfdGhpczkuc2V0cGFnaW5hdGlvbihfdGhpczkucGFnZV9ubyk7CgogICAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3NlYXJjaF9hbGVydF9tc2cyJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgNDsgX2krKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2kyID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IF9pMiA8IHRoaXMudG90YWxfcGFnZXM7IF9pMisrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTIgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgcGFnZV9ubyArIDM7IF9pMysrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTMgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNCA9IHBhZ2Vfbm8gLSA0OyBfaTQgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNSA9IHBhZ2Vfbm8gLSAzOyBfaTUgPD0gcGFnZV9ubyArIDM7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3M6IGZ1bmN0aW9uIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgbG9hZF9zdGF0ZW1lbnRzOiBmdW5jdGlvbiBsb2FkX3N0YXRlbWVudHMoc3RhdGVtZW50cykgewogICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gW107IC8vIGNvbnNvbGUubG9nKHRoaXMuc3RhdGVtZW50cyk7CgogICAgICBmb3IgKHZhciBpIGluIHN0YXRlbWVudHMpIHsKICAgICAgICB2YXIga2V5ID0gT2JqZWN0LmtleXMoc3RhdGVtZW50c1tpXSlbMF07CgogICAgICAgIGlmIChzdGF0ZW1lbnRzW2ldW2tleV0uSXNUYWdDb21wbGV0ZWQgIT0gIllFUyIpIHsKICAgICAgICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZW1lbnRzW2ldKVswXTsKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdC5wdXNoKHN0YXRlbWVudHNbaV1ba2V5XSk7CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdCA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5TdGF0ZW1lbnQuc3BsaXQoIiAiKTsKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5rZXkgPSBrZXk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RhdGVtZW50c1tpXVtrZXldLklzVGFnQ29tcGxldGVkICE9ICJOTyIpIHsKICAgICAgICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZW1lbnRzW2ldKVswXTsKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdC5wdXNoKHN0YXRlbWVudHNbaV1ba2V5XSk7CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdCA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5TdGF0ZW1lbnQuc3BsaXQoIiAiKTsKICAgICAgICAgIHZhciBkZXNjID0gW107CiAgICAgICAgICB2YXIgdmFsdWVzOwogICAgICAgICAgdmFyIGluZGV4OwoKICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZy5sZW5ndGg7IGErKykgewogICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXSAhPSAiTyIpIHsKICAgICAgICAgICAgICB2YXIgY2hlY2sgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmluZGV4T2YodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXSk7CgogICAgICAgICAgICAgIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLmluY2x1ZGVzKCJCLSIpKSB7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiY3VycmVudCIsIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0pOwogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIm5leHQiLCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmIChjaGVjayA8IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWcubGVuZ3RoIC0gMSAmJiB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXS5pbmNsdWRlcygiSS0iKSkgewogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gYTsgLy8gY29uc29sZS5sb2coImluZGV4IiwgaW5kZXgpOwoKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgd29yZF90eXBlOiB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLnNsaWNlKDIpCiAgICAgICAgICAgICAgICAgICAgfSk7IC8vIC8vY29uc29sZS5sb2coZGVzYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uaW5jbHVkZXMoIkktIikpIHsKICAgICAgICAgICAgICAgIHZhciBjaGVjayA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWcuaW5kZXhPZih0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdKTsKICAgICAgICAgICAgICAgIGluZGV4ID0gYTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXS5pbmNsdWRlcygiSS0iKSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHZhbHVlcyArICIgIiArIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZXMgKyAiICIgKyB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB2YWx1ZXMgKyAiICIgKyB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXVsic2VsZWN0ZWRfbGlzdCJdID0gZGVzYzsKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5rZXkgPSBrZXk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QubGVuZ3RoOyBfaTYrKykgewogICAgICAgIHRoaXMuc3RhdGVtZW50cy5wdXNoKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtfaTZdKTsKICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsgLy9jb25zb2xlLmxvZyh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QgLCAiTXN0ZXIgc3RhdGVtZW50cyBsb2FkZWQiKQogICAgICAvL2NvbnNvbGUubG9nKHRoaXMuc3RhdGVtZW50cyAsICIgc3RhdGVtZW50cyBsb2FkZWQiKQogICAgfSwKICAgIGxvYWRfcG9wb3ZlcjogZnVuY3Rpb24gbG9hZF9wb3BvdmVyKHRhcmdldCkgewogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKTsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImxlZnQiLCB0YXJnZXQuY2xpZW50WCk7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJ0b3AiLCB0YXJnZXQuY2xpZW50WSArIHdpbmRvdy5wYWdlWU9mZnNldCk7CiAgICB9LAogICAgc2VsZWN0ZWRfdGV4dDogZnVuY3Rpb24gc2VsZWN0ZWRfdGV4dChpbmRleCkgewogICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikgewogICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKSAhPSAiIiAmJiB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKS5zcGxpdCgiICIpLmpvaW4oIiIpICE9ICIiKSB7CiAgICAgICAgICB0aGlzLmhpZ2hsaWdodGVkX3RleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKS50cmltKCk7CiAgICAgICAgICB0aGlzLndvcmRfc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlN0YXRlbWVudDsKICAgICAgICAgIHRoaXMubG9hZF9wb3BvdmVyKGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5oaWdobGlnaHRlZF90ZXh0ID0gIiI7CiAgICAgICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICAgIGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpLnRleHQ7CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVfc3RhdGVtZW50czogZnVuY3Rpb24gdXBkYXRlX3N0YXRlbWVudHMoZW50aXR5KSB7CiAgICAgIHZhciB3b3Jkc19saXN0ID0gZW50aXR5LnZhbHVlLnNwbGl0KCIgIik7CiAgICAgIHZhciB0YWdzID0gW107CgogICAgICBmb3IgKHZhciBpIGluIHRoaXMuc3RhdGVtZW50cykgewogICAgICAgIHZhciBtYXN0ZXJfd29yZHNfbGlzdCA9IHRoaXMuc3RhdGVtZW50c1tpXS5TdGF0ZW1lbnQuc3BsaXQoIiAiKTsKCiAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5zZWxlY3RlZF9saXN0ID09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLnNlbGVjdGVkX2xpc3QgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaV0uVGFnLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICBmb3IgKHZhciBqIGluIG1hc3Rlcl93b3Jkc19saXN0KSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5UYWcucHVzaCgiIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLlN0YXRlbWVudCA9PSB0aGlzLnNlbGVjdGVkX3N0YXRlbWVudCkgewogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLklzVGFnQ29tcGxldGVkID0gIk5PIjsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5zZWxlY3RlZF9saXN0LnB1c2goewogICAgICAgICAgICB0ZXh0OiBlbnRpdHkudmFsdWUsCiAgICAgICAgICAgIHdvcmRfdHlwZTogZW50aXR5LmVudGl0eQogICAgICAgICAgfSk7CgogICAgICAgICAgZm9yICh2YXIgaiBpbiBtYXN0ZXJfd29yZHNfbGlzdCkgewogICAgICAgICAgICBpZiAod29yZHNfbGlzdC5pbmNsdWRlcyhtYXN0ZXJfd29yZHNfbGlzdFtqXSkpIHsKICAgICAgICAgICAgICB2YXIgaW5kZXggPSB3b3Jkc19saXN0LmluZGV4T2YobWFzdGVyX3dvcmRzX2xpc3Rbal0pOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLlRhZ1tqXSA9ICJCLSIgKyBlbnRpdHkuZW50aXR5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID0gIkktIiArIGVudGl0eS5lbnRpdHk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID09ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID0gIk8iOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGVudGl0eTogZnVuY3Rpb24gZW50aXR5KHZhbHVlMSwgdmFsdWUyKSB7CiAgICAgIGZvciAodmFyIGkgaW4gZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW4pIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW5baV0uc3R5bGUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5jaGlsZHJlbltpXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIjsKICAgICAgICAgIGV2ZW50LnRhcmdldC5jaGlsZHJlblswXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID09ICJ5ZWxsb3ciKSB7CiAgICAgICAgZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAieWVsbG93IjsKICAgICAgICB2YXIgZmxhZyA9IGZhbHNlOwoKICAgICAgICBpZiAodGhpcy5kb25lX2VudGl0aWVzLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZG9uZV9lbnRpdGllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodGhpcy5kb25lX2VudGl0aWVzW2ldLnZhbHVlID09IHZhbHVlMSkgewogICAgICAgICAgICAgIGZsYWcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZmxhZyA9PSBmYWxzZSkgewogICAgICAgICAgdGhpcy53b3JkX3NlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnZhbHVlID0gdmFsdWUxOwogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRfYXJyYXkgPSB2YWx1ZTI7CiAgICAgICAgICB2YXIgam9pbnQgPSB0aGlzLnN0YXRlbWVudF9hcnJheS5qb2luKCk7CiAgICAgICAgICB2YXIgYSA9IGpvaW50Lmxhc3RJbmRleE9mKHZhbHVlMSk7CiAgICAgICAgICB2YXIgYiA9IHZhbHVlMS5sZW5ndGggKyBhIC0gMjsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnN0YXJ0ID0gYTsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLmVuZCA9IGI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2F2ZV9zdGF0ZW1lbnQ6IGZ1bmN0aW9uIHNhdmVfc3RhdGVtZW50KGluZGV4KSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX2FkZF90YWdzX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgIHZhciB2YWxpZF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOyAvLyBjb25zb2xlLmxvZygiYmVmb3JlLS0tIiwgdGhpcy5zdGF0ZW1lbnRzW2luZGV4XSk7CgogICAgICAgIHZhciBrZXkgPSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5Jc1RhZ0NvbXBsZXRlZCA9ICJZRVMiOwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQuc2VsZWN0ZWRfbGlzdDsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LndvcmRzX2xpc3Q7CiAgICAgICAgZmluYWxfc3RhdGVtZW50c19saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHZhbGlkX3N0YXRlbWVudCkpOyAvLyBjb25zb2xlLmxvZygic2luZ3VsYXIgZmluYWwiLGZpbmFsX3N0YXRlbWVudHNfbGlzdCk7CgogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50YWdfc2VudGVuY2VzX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBuZXJfdGFnX3N0YXRlbWVudDogZmluYWxfc3RhdGVtZW50c19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEwLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEwLnRsdCgnbmVyX3BhZ2VfdGFnc19zdWJtaXRfbXNnJyksCiAgICAgICAgICAgICAgLy8gdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7IC8vIHRoaXMucGFnZV9yZXF1aXJlKDEpOwoKICAgICAgICAgICAgX3RoaXMxMC5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfbmVyX21vZGVsOiBmdW5jdGlvbiBzdWJtaXRfbmVyX21vZGVsKCkgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgdmFyIHZhbGlkX2xpc3QgPSB0aGlzLnN0YXRlbWVudHMuZmlsdGVyKGZ1bmN0aW9uIChzdGF0ZW1lbnQpIHsKICAgICAgICByZXR1cm4gc3RhdGVtZW50LklzVGFnQ29tcGxldGVkICE9ICIiOwogICAgICB9KTsKCiAgICAgIGlmICh2YWxpZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ25lcl9wYWdlX3N1Ym1pdF9hbGVydF9tc2cnKSk7CiAgICAgIH0gZWxzZSBpZiAodmFsaWRfbGlzdC5sZW5ndGggPCA1ICYmIHRoaXMuc3RhdGVtZW50cy5sZW5ndGggPiA1KSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ25lcl9wYWdlX3N1Ym1pdF9hbGVydF9tc2cxJykpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIGkgaW4gdmFsaWRfbGlzdCkgewogICAgICAgICAgdmFyIGtleSA9IHZhbGlkX2xpc3RbaV0ua2V5OwogICAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0ua2V5OwogICAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0uc2VsZWN0ZWRfbGlzdDsKICAgICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLndvcmRzX2xpc3Q7CiAgICAgICAgICBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QucHVzaChfZGVmaW5lUHJvcGVydHkoe30sIGtleSwgdmFsaWRfbGlzdFtpXSkpOwogICAgICAgIH0gLy8gY29uc29sZS5sb2coZmluYWxfc3RhdGVtZW50c19saXN0KTsKCgogICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpOwogICAgICAgIH0gZWxzZSBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcykgewogICAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgIH0gLy8gYXhpb3MKICAgICAgICAvLyAgIC5wb3N0KAogICAgICAgIC8vICAgICBhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwKICAgICAgICAvLyAgICAgewogICAgICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIC8vICAgICAgIG5lcl90YWdfc3RhdGVtZW50OiBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QsCiAgICAgICAgLy8gICAgIH0sCiAgICAgICAgLy8gICAgIHsKICAgICAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAvLyAgICAgICB9LAogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICApCiAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuc3VjY2VzcygiQWxsIHlvdXIgdGFncyBoYXZlIGJlZW4gc3VibWl0dGVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgIC8vICAgICAgIH0sIDIwMDApOwogICAgICAgIC8vICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICAvLyAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICAvLyAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7CiAgICAgICAgLy8gICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICB9KQogICAgICAgIC8vICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAvLyAgIH0pOwoKICAgICAgfQogICAgfSwKICAgIHJlbW92ZV90YWc6IGZ1bmN0aW9uIHJlbW92ZV90YWcoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpbmRleF0uVGFnLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfbm9fdGFnc19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3dhbF9tc2cnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2VfdW50YWdfc3RhdGVtZW50X21zZycpLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9zd2FsX2RlbGV0ZV9tc2cnKQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgIGlmIChyZXN1bHQuZGlzbWlzcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMxMS5zdGF0ZW1lbnRzW2luZGV4XS5Jc1RhZ0NvbXBsZXRlZCA9ICJOTyI7CiAgICAgICAgX3RoaXMxMS5zdGF0ZW1lbnRzW2luZGV4XS5UYWcgPSBbXTsKICAgICAgICBfdGhpczExLnN0YXRlbWVudHNbaW5kZXhdLnNlbGVjdGVkX2xpc3QgPSBbXTsKCiAgICAgICAgX3RoaXMxMS4kc2V0KF90aGlzMTEuc3RhdGVtZW50cywgaW5kZXgsIF90aGlzMTEuc3RhdGVtZW50c1tpbmRleF0pOwoKICAgICAgICB2YXIgZmluYWxfc3RhdGVtZW50c19saXN0ID0gW107CiAgICAgICAgdmFyIHZhbGlkX3N0YXRlbWVudCA9IF90aGlzMTEuc3RhdGVtZW50c1tpbmRleF07CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQud29yZHNfbGlzdDsKICAgICAgICBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QucHVzaChfZGVmaW5lUHJvcGVydHkoe30sIGtleSwgdmFsaWRfc3RhdGVtZW50KSk7IC8vIGNvbnNvbGUubG9nKCJzaW5ndWxhciBmaW5hbCIsZmluYWxfc3RhdGVtZW50c19saXN0KTsKCiAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRhZ19zZW50ZW5jZXNfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgZW1haWw6IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIG5lcl90YWdfc3RhdGVtZW50OiBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxMS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEudGx0KCduZXJfcGFnZV90YWdfcmVtb3ZlZF9tc2cnKSwKICAgICAgICAgICAgICAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAvLyBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZW50aXR5X3NlbGVjdGVkOiBmdW5jdGlvbiBlbnRpdHlfc2VsZWN0ZWQod29yZCkgewogICAgICBpZiAodGhpcy5oaWdobGlnaHRlZF90ZXh0ICE9ICIiKSB7CiAgICAgICAgdGhpcy5zdWJfZW50aXRpZXMudmFsdWUgPSB0aGlzLmhpZ2hsaWdodGVkX3RleHQ7CiAgICAgIH0KCiAgICAgIHZhciBwb3BvdmVyX2lkID0gZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmlkOyAvLyB0aGlzLndvcmRfc2VsZWN0ZWQgPSBmYWxzZTsKCiAgICAgIHRoaXMuc3ViX2VudGl0aWVzLmVudGl0eSA9IHRoaXMuZHJvcF9kb3duX3NlbGVjdDsKICAgICAgdGhpcy5kb25lX2VudGl0aWVzLnB1c2godGhpcy5zdWJfZW50aXRpZXMpOwogICAgICAkKCIjIiArIHBvcG92ZXJfaWQpLnBvcG92ZXIoImhpZGUiKTsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImRpc3BsYXkiLCAibm9uZSIpOwogICAgICB0aGlzLmRyb3BfZG93bl9zZWxlY3QgPSAiIjsKICAgICAgdGhpcy5oaWdobGlnaHRlZF90ZXh0ID0gIiI7CiAgICAgIHRoaXMudXBkYXRlX3N0YXRlbWVudHModGhpcy5zdWJfZW50aXRpZXMpOwogICAgICB0aGlzLnN1Yl9lbnRpdGllcyA9IHt9OwoKICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSkgewogICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpOwogICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQ6IGZ1bmN0aW9uIGZpbGVpbnB1dChlKSB7CiAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOyAvL2NvbnNvbGUubG9nKGZpbGVzKQoKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPCAxMDAwMDAwKSB7CiAgICAgICAgaWYgKGZpbGVzWzBdLm5hbWUuaW5jbHVkZXMoImNzdiIpIHx8IGZpbGVzWzBdLm5hbWUuaW5jbHVkZXMoInR4dCIpIHx8IGZpbGVzWzBdLm5hbWUuaW5jbHVkZXMoInhscyIpIHx8IGZpbGVzWzBdLnR5cGUuaW5jbHVkZXMoInRleHQiKSkgewogICAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmZpbGVfbGFiZWwpCiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSBmaWxlc1swXS5uYW1lOwogICAgICAgICAgdGhpcy5jcmVhdGVDU1YoZmlsZXNbMF0pOyAvL2NvbnNvbGUubG9nKHRoaXMuZmlsZV9sYWJlbCkKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9maWxlX3NpemVfYWxlcnQnKSk7CiAgICAgIH0KCiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICB9LAogICAgY3JlYXRlQ1NWOiBmdW5jdGlvbiBjcmVhdGVDU1YoZmlsZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTIuY3N2X2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCIpWzFdOwogICAgICB9OwoKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgc2VuZF9jc3Y6IGZ1bmN0aW9uIHNlbmRfY3N2KCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICAvL2NvbnNvbGUubG9nKCQoIiNpbnB1dEdyb3VwRmlsZTAxIikudmFsKCkpCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAoJCgiI2lucHV0R3JvdXBGaWxlMDEiKS52YWwoKSA9PSAnJykgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9wYWdlX2lucHV0X2ZpZWxkX21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3VwbG9hZF9maWxlX21zZycpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7IC8vY29uc29sZS5sb2codGhpcy5maWxlX2xhYmVsKQoKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy51cGxvYWRfbmVyX2ZpbGVfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGZpbGVfZGF0YTogdGhpcy5jc3ZfZmlsZSwKICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczEzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5FUlJPUl9VUExPQUQuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczEzLnRsdCgnbmVyX3BhZ2VfZXJyb3JfdXBsb2FkX2FsZXJ0JykpOwogICAgICAgICAgICBfdGhpczEzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICBfdGhpczEzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19TVEFUVVMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczEzLnRsdCgnbmVyX3BhZ2VfdGFnc19hc3NpZ25fbXNnJykpOwogICAgICAgICAgICBfdGhpczEzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICBfdGhpczEzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9IRUFESU5HLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxMy50bHQoJ25lcl9wYWdlX2ludmFsaWRfaGVhZGVyX21zZycpKTsKICAgICAgICAgICAgX3RoaXMxMy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgX3RoaXMxMy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID0gIiI7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLkZBSUxFRF9UT19BRERfVEFHUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJVbmtub3duIFRhZ3MgZm91bmQhIFN0YXRlbWVudHMgaGFzIGJlZW4gdXBsb2FkZWQsIFBsZWFzZSB0YWcgdGhlIHN0YXRlbWVudHMgbWFudWFsbHkuIikKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMy50bHQoJ25lcl9wYWdlX3RhZ3NfZm91bmRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzMTMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgIF90aGlzMTMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CgogICAgICAgICAgICBfdGhpczEzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsgLy8gfSwgMjUwMCk7IAoKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuSU5DT1JSRUNUX0ZJTEVfRk9STUFULk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxMy50bHQoJ25lcl9wYWdlX2ZpbGVfZm9ybWF0X21zZycpKTsKICAgICAgICAgICAgX3RoaXMxMy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgX3RoaXMxMy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID0gIiI7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfRklMRV9UWVBFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxMy50bHQoJ25lcl9wYWdlX2ZpbGVfdHlwZV9tc2cnKSk7CiAgICAgICAgICAgIF90aGlzMTMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgIF90aGlzMTMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEzLmFwaV9zdGF0dXNfY29kZS5GSUxFX1VQTE9BRC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoX3RoaXMxMy50bHQoJ25lcl9wYWdlX3VwbG9hZF9zdWNjZXNzX2FsZXJ0X21zZycpKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwoKICAgICAgICAgICAgX3RoaXMxMy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIH0sIDI1MDApOwoKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgLy8gICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgLy8gICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgIC8vICAgICAiRHVlIHRvIHNvbWUgaW50ZXJuYWwgc2VydmVyIGVycm9yLCB3ZSB3ZXJlIHVuYWJsZSB0byBwcm9jZXNzIHRoaXMgcmVxdWVzdC4gUGxlYXNlIHRyeSBsYXRlci4iCiAgICAgICAgICAvLyAgICk7CiAgICAgICAgICAvLyB9CgoKICAgICAgICAgICQoIiN1cGxvYWRfY3N2X2ZpbGUiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczEzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczEzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2xvc2VfbW9kYWwoJ3VwbG9hZF9idG4nKTsKICAgICAgfQogICAgfSwKICAgIGNvbW1hX3RvX2xpc3Q6IGZ1bmN0aW9uIGNvbW1hX3RvX2xpc3QoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5lbnRpdGllc19saXN0X3N0cmluZyA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX25lcl90YWdfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmVudGl0aWVzX2xpc3QgPSB0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nLnNwbGl0KCIsIik7CgogICAgICBpZiAodGhpcy5lbnRpdGllc19saXN0X3N0cmluZyAhPSAiIikgewogICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5hZGRfbmVyX3RhZygpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0YWdsaXN0OiB0aGlzLmVudGl0aWVzX2xpc3QKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQURELk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhfdGhpczE0LnRsdCgnbmVyX3BhZ2VfdGFnX2FkZGVkX2FsZXJ0X21zZycpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNC5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczE0LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMTQudGx0KCduZXJfcGFnZV9zb21lX2Vycm9yX2FsZXJ0MicpKTsKICAgICAgICAgIF90aGlzMTQuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmRlbGV0ZV9uZXJfdGFncy5sZW5ndGggPiAwKSB7Ly8gYXhpb3MKICAgICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5kZWxldGVfbmVyX3RhZ3MoKSwgewogICAgICAgIC8vICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAvLyAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAvLyAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgLy8gICAgIHRhZ19uYW1lOiB0aGlzLmRlbGV0ZV9uZXJfdGFncywKICAgICAgICAvLyAgIH0pCiAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFnIGhhcyBiZWVuIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5LiIpOwogICAgICAgIC8vICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgLy8gICAgICAgfSwgMjUwMCk7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCAyNTAwKTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9uZXI6IGZ1bmN0aW9uIGRlbGV0ZV9uZXIoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2coInN0YXRlbWVudHMgbGVuZ3RoIix0aGlzLnN0YXRlbWVudHMubGVuZ3RoKTsKICAgICAgdmFyIGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdCA9IFtdOwogICAgICB2YXIgdmFsaWRfbGlzdCA9IHRoaXMuc3RhdGVtZW50cy5maWx0ZXIoZnVuY3Rpb24gKHN0YXRlbWVudCkgewogICAgICAgIHJldHVybiBzdGF0ZW1lbnQuU3RhdGVtZW50ID09IF90aGlzMTUuc3RhdGVtZW50c1tpbmRleF0uU3RhdGVtZW50OwogICAgICB9KTsgLy8gY29uc29sZS5sb2codmFsaWRfbGlzdCk7CgogICAgICBmb3IgKHZhciBpIGluIHZhbGlkX2xpc3QpIHsKICAgICAgICB2YXIga2V5ID0gdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0ua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0ud29yZHNfbGlzdDsKICAgICAgICBkZWxldGVfc3RhdGVtZW50X2xpc3QucHVzaChfZGVmaW5lUHJvcGVydHkoe30sIGtleSwgdmFsaWRfbGlzdFtpXSkpOwogICAgICB9IC8vIGNvbnNvbGUubG9nKGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdCk7CgoKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9zd2FsX2FsZXJ0X21zZycpLAogICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfc3dhbF9yZXZlcnRfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl9zd2FsX2NvbmZpcm1fbXNnJykKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXMxNS5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZGVsZXRlX25lcigpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzMTUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBuZXJfdGFnX3N0YXRtZW50OiBkZWxldGVfc3RhdGVtZW50X2xpc3QKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxNS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXMxNS5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAvLyB0b2FzdHIuc3VjY2VzcygiWW91ciBORVIgdGFnIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczE1LnRsdCgnbmVyX3RhZ19kZWxldGVfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNTUwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxNS5zdGF0ZW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBkZWxldGVfc3RhdGVtZW50X2xpc3QubGVuZ3RoID09PSAxICYmIF90aGlzMTUucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgIF90aGlzMTUucGFnZV9ubyA9IF90aGlzMTUucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczE1LmNsZWFyX2ZpZWxkcygpOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKCgogICAgICAgICAgICAgIF90aGlzMTUubG9hZF9uZXJfc3RhdGVtZW50cygpOyAvLyB9LCAxNTAwKTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczE1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZWxlY3RlZF9zdGF0ZW1lbnRzOiBmdW5jdGlvbiBzZWxlY3RlZF9zdGF0ZW1lbnRzKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdmFyIHJvbGVfbGVuZ3RoID0gdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb2xlX2xlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMuc3RhdGVtZW50c1tpXSk7CiAgICAgICAgfSAvL2NvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0KQoKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgaWYgKCF0aGlzLmNoZWNrZWRfbGlzdC5pbmNsdWRlcyhpbmRleCkpIHsKICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaCh0aGlzLnN0YXRlbWVudHNbaW5kZXhdKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKHJvbGUpIHsKICAgICAgICAgICAgcmV0dXJuIHJvbGUgIT09IF90aGlzMTYuc3RhdGVtZW50c1tpbmRleF07CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfbmVyX211bHRpcGxlOiBmdW5jdGlvbiBkZWxldGVfbmVyX211bHRpcGxlKCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnN0YXRlbWVudHMsInN0YXRlbWVudHMgaW4gZGVsZXRlIGZ1bmN0aW9uIikKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0LCJNYXN0ZXIgc3RhdGVtZW50cyBpbiBkZWxldGUgZnVuY3Rpb24iKQogICAgICB2YXIgbnVtID0gdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOwogICAgICB2YXIgbXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0ID0gW107CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfbm9fc3RhdGVtZW50X2FsZXJ0X21zZycpLAogICAgICAgICAgdGV4dDogIiIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGRsdF9saXN0ID0gW107CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaGVja2VkX2xpc3QpIHsKICAgICAgICAgIC8vIHZhciB2YWxpZF9saXN0ID0gdGhpcy5zdGF0ZW1lbnRzLmZpbHRlcigoc3RhdGVtZW50KSA9PiB7CiAgICAgICAgICAvLyByZXR1cm4gc3RhdGVtZW50LlN0YXRlbWVudCA9PSB0aGlzLmNoZWNrZWRfbGlzdFtpXS5TdGF0ZW1lbnQ7CiAgICAgICAgICAvLyB9KTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbGlkX2xpc3QsImxpc3QiKQogICAgICAgICAgLy8gY29uc29sZS5sb2codmFsaWRfbGlzdFswXSwibGlzdCIpCiAgICAgICAgICB2YXIga2V5ID0gdGhpcy5jaGVja2VkX2xpc3RbaV0ua2V5OwogICAgICAgICAgZGx0X2xpc3QucHVzaChrZXkpOwogICAgICAgICAgbXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0LnB1c2goX2RlZmluZVByb3BlcnR5KHt9LCBrZXksIHRoaXMuY2hlY2tlZF9saXN0W2ldKSk7CiAgICAgICAgfQoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfc3dhbF9hbGVydF9tc2cyJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3N3YWxfcmV2ZXJ0X21zZzInKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl9zd2FsX2NvbmZpcm1fbXNnMicpCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzMTcuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZGVsZXRlX25lcigpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxNy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE3LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE3LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IF90aGlzMTcuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMxNy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBuZXJfdGFnX3N0YXRtZW50OiBtdWx0aXBsZV9kZWxldGVfc3RhdGVtZW50X2xpc3QKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxNy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzMTcuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChfdGhpczE3LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTcudGx0KCduZXJfdGFnX2RlbGV0ZV9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDU1MDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChtdWx0aXBsZV9kZWxldGVfc3RhdGVtZW50X2xpc3QubGVuZ3RoID09PSBfdGhpczE3LnN0YXRlbWVudHMubGVuZ3RoICYmIF90aGlzMTcucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxNy5wYWdlX25vID0gX3RoaXMxNy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczE3LmNsZWFyX2ZpZWxkcygpOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiUkFOTk5OIikKCgogICAgICAgICAgICAgICAgX3RoaXMxNy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7IC8vIH0sIDE1MDApOwoKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXMxNy5jbGVhcl9maWVsZHMoKTsKCiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIF90aGlzMTcuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMxNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdHJhaW5fbmVyX21vZGVsOiBmdW5jdGlvbiB0cmFpbl9uZXJfbW9kZWwoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgaWYgKHRoaXMubm90VHJhaW5lZFF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9zZXR1cF90cmFuc2xhdGVfbXNnJyksCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfdHJhaW5pbmdfdGltZV9tc2cnKSwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfdHJhaW5fZW50aXR5X21vZGVsX21zZycpLAogICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX2dvX2JhY2tfbXNnJykKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgLy8gaWYgKHRoaXMuc3RhdGVtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgLy8gYXhpb3MKICAgICAgICAgICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5ub3RpZnlfc3VwZXJhZG1pbl91cmwoKSwgewogICAgICAgICAgICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAvLyAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAvLyAgICAgbm90aWZ5X3R5cGU6ICJOZXJNb2RlbCIsCiAgICAgICAgICAgICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgLy8gICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIC8vICAgICBzdWJqZWN0OiAiTm90aWZpY2F0aW9uIHRvIHRyYWluIHRoZSBuZXIgbW9kZWwiLAogICAgICAgICAgICAgIC8vICAgICBib2R5OgogICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuY29tcGFueW5hbWUgKwogICAgICAgICAgICAgIC8vICAgICAgICJoYXMgcmVxdWVzdGVkIHRvIHRyYWluIHRoZSBuZXIgbW9kZWwgb2YgZW50aXRpZXMuIiwKICAgICAgICAgICAgICAvLyAgIH0pCiAgICAgICAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAvLyAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5Nc2cpOwogICAgICAgICAgICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkEgbWFpbCBoYXMgYmVlbiBzZW50IHRvIHlvdXIgZW1haWwiKSB7CiAgICAgICAgICAgICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MoCiAgICAgICAgICAgICAgLy8gICAgICAgICAiWW91ciBOZXIgIG1vZGVsIGlzIHN1Y2Nlc3NmdWxseSBzY2hlZHVsZWQgZm9yIGZ1cnRoZXIgdHJhaW5pbmcuIgogICAgICAgICAgICAgIC8vICAgICAgICk7CiAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy5uZXdfcXVlc3Rpb25zID0gMDsKICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudHJhaW5fbmVyX21vZGVscygpLCB7CiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzMTguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGVtYWlsOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMxOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IF90aGlzMTguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBjb21wYW55X2RldGFpbHM6IHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczE4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZAogICAgICAgICAgICAgICAgfSAvLyBlcG9jaHM6IDEwMCwKICAgICAgICAgICAgICAgIC8vIGJhdGNoX3NpemU6IDY0CgogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBfdGhpczE4LndhbnRfc3RhdHVzID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfdGhpczE4LiRyb290LiRlbWl0KCJ3YW50X21vZGVsX3N0YXR1cyIsIF90aGlzMTgud2FudF9zdGF0dXMpOwoKICAgICAgICAgICAgICAgIF90aGlzMTguY2hlY2tfbmVyX21vZGVsX3N0YXR1cygpOwoKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IDIwMDAwMTExKSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0cpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXMxOC50bHQoJ25lcl9pbnRlcm5hbF9zZXJ2ZXJfYWxlcnQyJykpOwoKICAgICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgICBfdGhpczE4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOyAvLyB9IGVsc2UgewogICAgICAgICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJUaGVyZSBhcmUgbm8gdGFncyB0byB0cmFpbi4gUGxlYXNlIGFkZCBzb21lIHRhZ3MgYW5kIik7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfbm9fdGFnc190cmFpbl9tc2cnKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9maWVsZHM6IGZ1bmN0aW9uIGNsZWFyX2ZpZWxkcygpIHsKICAgICAgdGhpcy53b3JkX2luZm8gPSB0aGlzLmJ1ZmZlcl93b3JkX2xpc3Q7CiAgICAgIHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgPSAiIjsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGU6IGZ1bmN0aW9uIGRvd25sb2FkX3NhbXBsZSgpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jb21wYW55bmFtZSk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBzYW1wbGVfZmlsZTogIm5lciIKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJOb3QgYWJsZSB0byBkb3dubG9hZCBmaWxlIikgewogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzMTkudGx0KCduZXJfZG93bmxvYWRfc2FtcGxlX2FsZXJ0JyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7IC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCgogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgX3RoaXMxOS5jb21wYW55X25hbWUgKyAiTmVyRmlsZS5jc3YiKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiBfdGhpczE5LnRsdCgnbmVyX2Rvd25sb2FkX3NhbXBsZV9hbGVydDInKSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn07"},null]}