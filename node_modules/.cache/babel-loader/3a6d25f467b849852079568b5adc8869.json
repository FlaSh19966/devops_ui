{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue","mtime":1645594423479},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IHN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBNdWx0aXNlbGVjdCBmcm9tICJ2dWUtbXVsdGlzZWxlY3QiOwppbXBvcnQgUmVzcG9uc2VCb3QgZnJvbSAiLi4vRGF0YSBJbnB1dHMvUmVzcG9uc2VCb3QiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCBFbW9qaVBpY2tlciBmcm9tICd2dWUtZW1vamktcGlja2VyJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJCb3RDb25maWd1cmF0aW9uIiwKICBjb21wb25lbnRzOiB7CiAgICBNdWx0aXNlbGVjdDogTXVsdGlzZWxlY3QsCiAgICBSZXNwb25zZUJvdDogUmVzcG9uc2VCb3QsCiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZSwKICAgIEVtb2ppUGlja2VyOiBFbW9qaVBpY2tlcgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlucHV0OiAnJywKICAgICAgc2VhcmNoOiAnJywKICAgICAgYmlnX3NwaW5uZXI6IGZhbHNlLAogICAgICBib3RfZ3JlZXRpbmdzOiBbXSwKICAgICAgYm90X2JhY2tncm91bmRfdHlwZTogIm5vbmUiLAogICAgICByZXNldF9pY29uX3BhdGg6IHJlcXVpcmUoIkAvcG9ydGFsL2Fzc2V0cy9pbWcvcmVzZXRfaWNvbi5zdmciKSwKICAgICAgaXNfUHJlbWl1bTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZTogW3sKICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lIiwKICAgICAgICB2YWx1ZTogIiMyNzM2NzkiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuYm90X3RoZW1lIiwKICAgICAgICB2YWx1ZTogIiMyNzM2NzkiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSIsCiAgICAgICAgdmFsdWU6ICIjMjczNjc5IgogICAgICB9LCB7CiAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IiLAogICAgICAgIHZhbHVlOiAiIzI3MzY3OSIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciIsCiAgICAgICAgdmFsdWU6ICIjMjczNjc5IgogICAgICB9LCAvLyB7CiAgICAgIC8vICAgbmFtZTogImJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UiLAogICAgICAvLyAgIHZhbHVlOiAidHJ1ZSIsCiAgICAgIC8vIH0sCiAgICAgIHsKICAgICAgICBuYW1lOiAiYm90X2J1dHRvbnNfYWxpZ25tZW50IiwKICAgICAgICB2YWx1ZTogewogICAgICAgICAgbmFtZTogIkNlbnRlciIsCiAgICAgICAgICB2YWx1ZTogImNlbnRlciIKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nIiwKICAgICAgICB2YWx1ZTogIjMiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyIsCiAgICAgICAgdmFsdWU6ICI1IgogICAgICB9LCB7CiAgICAgICAgbmFtZTogImJvdF9oZWFkZXJfYmFja2dyb3VuZCIsCiAgICAgICAgdmFsdWU6ICIjZmZmZmZmIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogImJvdF9oZWFkZXJfYWxpZ25tZW50IiwKICAgICAgICB2YWx1ZTogewogICAgICAgICAgbmFtZTogIkNlbnRlciIsCiAgICAgICAgICB2YWx1ZTogImNlbnRlciIKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X2FsaWdubWVudCIsCiAgICAgICAgdmFsdWU6IHsKICAgICAgICAgIG5hbWU6ICJSaWdodCIsCiAgICAgICAgICB2YWx1ZTogInJpZ2h0IgogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIG5hbWU6ICJib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiIsCiAgICAgICAgdmFsdWU6IDMwCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X3ZlcnRpY2FsX3Bvc2l0aW9uIiwKICAgICAgICB2YWx1ZTogMTIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJib3RfZm9udF9zdHlsZSIsCiAgICAgICAgdmFsdWU6IHsKICAgICAgICAgIG5hbWU6ICJSb2JvdG8iLAogICAgICAgICAgdmFsdWU6ICJSb2JvdG8iCiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgbmFtZTogImJvdF9mb250X2NvbG9yX3NlbmRlciIsCiAgICAgICAgdmFsdWU6ICIjZmZmZmZmIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogImJvdF9mb250X2NvbG9yX3JlY2VpdmVyIiwKICAgICAgICB2YWx1ZTogIiMwMDAwMDAiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiYm90X2ZvbnRfY29sb3JfYnV0dG9ucyIsCiAgICAgICAgdmFsdWU6ICIjZmZmZmZmIgogICAgICB9XSwKICAgICAgaXNfYmdfaW1hZ2VfY2hhbmdlZDogZmFsc2UsCiAgICAgIGJvdF9oZWFkZXJfYmFja2dyb3VuZDogIiIsCiAgICAgIGJvdF9oZWFkZXJfYWxpZ25tZW50OiBudWxsLAogICAgICBib3RfZm9udF9zdHlsZTogJycsCiAgICAgIGJvdF9mb250X2NvbG9yX3NlbmRlcjogJycsCiAgICAgIGJvdF9mb250X2NvbG9yX3JlY2VpdmVyOiAnJywKICAgICAgYm90X2ZvbnRfY29sb3JfYnV0dG9uczogJycsCiAgICAgIGJvdF9mb250X29wdGlvbnM6IFt7CiAgICAgICAgbmFtZTogIkFyaWFsIiwKICAgICAgICB2YWx1ZTogImFyaWFsLHNhbnMtc2VyaWYiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiUm9ib3RvIiwKICAgICAgICB2YWx1ZTogIlJvYm90byIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJPcGVuIFNhbnMiLAogICAgICAgIHZhbHVlOiAiT3BlbiBTYW5zIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogIlRpbWVzIE5ldyBSb21hbiIsCiAgICAgICAgdmFsdWU6ICJUaW1lcyBOZXcgUm9tYW4iCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiR2VvcmdpYSIsCiAgICAgICAgdmFsdWU6ICJHZW9yZ2lhIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogIk1pY3Jvc29mdCBKaGVuZ0hlaSIsCiAgICAgICAgdmFsdWU6ICInTWljcm9zb2Z0IEpoZW5nSGVpJywgU2Fucy1zZXJpZiIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJNZXJyaXdlYXRoZXIiLAogICAgICAgIHZhbHVlOiAiJ01lcnJpd2VhdGhlcicsIFNhbnMtc2VyaWYiCiAgICAgIH1dLAogICAgICBib3RfaG9yaXpvbnRhbF9wb3NpdGlvbjogMzAsCiAgICAgIGJvdF92ZXJ0aWNhbF9wb3NpdGlvbjogMTIsCiAgICAgIGJvdF9hbGlnbm1lbnQ6IHsKICAgICAgICB2YWx1ZTogInJpZ2h0IiwKICAgICAgICBuYW1lOiAiUmlnaHQiCiAgICAgIH0sCiAgICAgIGJvdF9hbGlnbm1lbnRfb3B0aW9uczogW3sKICAgICAgICBuYW1lOiAiTGVmdCIsCiAgICAgICAgdmFsdWU6ICJsZWZ0IgogICAgICB9LCB7CiAgICAgICAgdmFsdWU6ICJyaWdodCIsCiAgICAgICAgbmFtZTogIlJpZ2h0IgogICAgICB9XSwKICAgICAgYm90X2hlYWRlcl9hbGlnbm1lbnRfb3B0aW9uczogW3sKICAgICAgICBuYW1lOiAiQ2VudGVyIiwKICAgICAgICB2YWx1ZTogImNlbnRlciIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJMZWZ0IiwKICAgICAgICB2YWx1ZTogImxlZnQiCiAgICAgIH0sIHsKICAgICAgICB2YWx1ZTogInJpZ2h0IiwKICAgICAgICBuYW1lOiAiUmlnaHQiCiAgICAgIH1dLAogICAgICBib3RfYnV0dG9uc19hbGlnbm1lbnRfb3B0aW9uczogW3sKICAgICAgICBuYW1lOiAiQ2VudGVyIiwKICAgICAgICB2YWx1ZTogImNlbnRlciIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJMZWZ0IiwKICAgICAgICB2YWx1ZTogImZsZXgtc3RhcnQiCiAgICAgIH0sIHsKICAgICAgICB2YWx1ZTogImZsZXgtZW5kIiwKICAgICAgICBuYW1lOiAiUmlnaHQiCiAgICAgIH1dLAogICAgICBib3RfYnV0dG9uc19hbGlnbm1lbnQ6IHt9LAogICAgICBpbWFnZV9maWxlXzI6IG51bGwsCiAgICAgIGltYWdlX2ZpbGVfMzogbnVsbCwKICAgICAgd2lkZ2V0X2J1dHRvbnNfZGV0YWlsczogW10sCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWxfMjogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbF8zOiAiQ2hvb3NlIGZpbGUiLAogICAgICBib3Rfc3R5bGluZzogewogICAgICAgIGJvdF90aGVtZTogIiIsCiAgICAgICAgYnV0dG9uX2JvcmRlcl90aGVtZTogIiIsCiAgICAgICAgdXNlcl9tc2dfZm9udF9jb2xvcjogIiIsCiAgICAgICAgYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3I6ICIiLAogICAgICAgIGJ1dHRvbl90aGVtZTogIiIsCiAgICAgICAgaG9yaXpvbnRhbF9zcGFjaW5nOiAiIiwKICAgICAgICB2ZXJ0aWNhbF9zcGFjaW5nOiAiIiwKICAgICAgICBpc19wb3dlcmVkX2J5X2NlbnNlOiB0cnVlLAogICAgICAgIGJvdF9vcGVuX2J5X2RlZmF1bHQ6IGZhbHNlLAogICAgICAgIGJvdF9zaG93bl9vbl93ZWJzaXRlOiBmYWxzZSwKICAgICAgICBzaG93X2JvdF9oaXN0b3J5OiB0cnVlCiAgICAgIH0sCiAgICAgIGludGVudGxpc3Q6IFtdLAogICAgICBjb21wYW55aWQ6IG51bGwsCiAgICAgIGNvbXBhbnluYW1lOiBudWxsLAogICAgICBsb2FkX2JvdF9wcmV2aWV3OiBmYWxzZSwKICAgICAgZHJhZ19idXR0b25zOiBmYWxzZSwKICAgICAgZHJhZ19ncmVldGluZ3M6IGZhbHNlLAogICAgICBkZWZhdWx0X3JldGFpbF9ncmVldGluZ3M6IFsiL29yZGVyX3JldHVybiIsICJvcmRlcl9yZXR1cm4iXSwKICAgICAgdmVyaWZ5X2JvdF9zZXR0aW5nczogW10sCiAgICAgIHZlcmlmeV9jaGVjazogZmFsc2UsCiAgICAgIGdyZWV0aW5nc19rZXk6IDAsCiAgICAgIGJ1dHRvbnNfa2V5OiAwCiAgICB9OwogIH0sCiAgcHJvcHM6IHsKICAgIGZyb21fc2V0dXA6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBib3RfYmFja2dyb3VuZF90eXBlOiBmdW5jdGlvbiBib3RfYmFja2dyb3VuZF90eXBlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIGlmIChuZXdWYWwgPT09ICJub25lIikgewogICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zID0gIkNob29zZSBGaWxlIjsKICAgICAgICB0aGlzLmltYWdlX2ZpbGVfMyA9IG51bGw7CiAgICAgICAgdGhpcy5pc19iZ19pbWFnZV9jaGFuZ2VkID0gdHJ1ZTsgLy8gdGhpcy5vbGRfaW1hZ2VfbmFtZV8zID0gbnVsbDsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDMiKS52YWx1ZSA9ICIiOwogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWU7CiAgICB9CgogICAgdGhpcy5nZXRfaW50ZW50cygpOwogICAgdGhpcy5nZXRfd2lkZ2V0X3NldHRpbmdzKCk7CiAgfSwKICBjb21wdXRlZDogewogICAgYm90X2FsaWdubWVudF90ZXh0OiBmdW5jdGlvbiBib3RfYWxpZ25tZW50X3RleHQoKSB7CiAgICAgIHJldHVybiB0aGlzLmJvdF9hbGlnbm1lbnQubmFtZTsKICAgIH0sCiAgICBzZXR1cF9jc3M6IGZ1bmN0aW9uIHNldHVwX2NzcygpIHsKICAgICAgaWYgKHRoaXMuZnJvbV9zZXR1cCA9PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICItLWRhc2gtY29udC1tYXJnaW4iOiAiMHB4IiwKICAgICAgICAgICItLWRhc2gtY29udC1wYWRkaW5nIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtbWFyZ2luIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1ib3JkZXIiOiAibm9uZSIsCiAgICAgICAgICAiLS1jYXJkLWJvZHktcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1oZWFkZXItcGFkZGluZyI6ICIyMHB4IDBweCIKICAgICAgICB9OwogICAgICB9CiAgICB9LAogICAgZHJhZ09wdGlvbnNHcmVldGluZ3M6IGZ1bmN0aW9uIGRyYWdPcHRpb25zR3JlZXRpbmdzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGFuaW1hdGlvbjogMjAwLAogICAgICAgIGdyb3VwOiAiZGVzY3JpcHRpb24iLAogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgICBnaG9zdENsYXNzOiAiZ2hvc3QiLAogICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAyMDAsCiAgICAgICAgZm9yY2VGYWxsYmFjazogdHJ1ZQogICAgICB9OwogICAgfSwKICAgIGRyYWdPcHRpb25zQnV0dG9uczogZnVuY3Rpb24gZHJhZ09wdGlvbnNCdXR0b25zKCkgewogICAgICByZXR1cm4gewogICAgICAgIGFuaW1hdGlvbjogMjAwLAogICAgICAgIGdyb3VwOiAiZGVzY3JpcHRpb24iLAogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgICBnaG9zdENsYXNzOiAiZ2hvc3QiLAogICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAyMDAsCiAgICAgICAgZm9yY2VGYWxsYmFjazogdHJ1ZQogICAgICB9OwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgJCgiI3ByZXZpZXdfYm90X3Zpc2libGUiKS5vbigic2hvdy5icy5tb2RhbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMubG9hZF9ib3RfcHJldmlldyA9IHRydWU7CiAgICB9KTsKICAgICQoIiNwcmV2aWV3X2JvdF92aXNpYmxlIikub24oImhpZGUuYnMubW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmxvYWRfYm90X3ByZXZpZXcgPSBmYWxzZTsKICAgIH0pOwogICAgdGhpcy4kcm9vdC4kZW1pdCgiY2hhbmdlX3NpZGViYXJfbWFpbl9tZW51IiwgIlNpbXVsYXRlIEludGVyYWN0aW9uIik7CiAgfSwKICBiZWZvcmVSb3V0ZUxlYXZlOiBmdW5jdGlvbiBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICB2YXIgY2hlY2sgPSBmYWxzZTsKCiAgICBpZiAodGhpcy52ZXJpZnlfY2hlY2spIHsKICAgICAgaWYgKCh0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQmdJbWFnZU5hbWUgPT0gdGhpcy5maWxlX2xhYmVsXzMgfHwgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJnSW1hZ2VOYW1lID09ICIiKSAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90Rm9udC5Gb250Q29sb3JCdXR0b25zID09IHRoaXMuYm90X2ZvbnRfY29sb3JfYnV0dG9ucyAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90Rm9udC5Gb250Q29sb3JSZWNlaXZlciA9PSB0aGlzLmJvdF9mb250X2NvbG9yX3JlY2VpdmVyICYmIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RGb250LkZvbnRDb2xvclNlbmRlciA9PSB0aGlzLmJvdF9mb250X2NvbG9yX3NlbmRlciAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90Rm9udC5Gb250U3R5bGUgPT0gdGhpcy5ib3RfZm9udF9zdHlsZSAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90SW1hZ2VOYW1lID09IHRoaXMuZmlsZV9sYWJlbF8yICYmIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RPcGVuQnlEZWZhdWx0ID09IHRoaXMuYm90X3N0eWxpbmcuYm90X29wZW5fYnlfZGVmYXVsdCAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90U2hvd25PbldlYnNpdGUgPT0gdGhpcy5ib3Rfc3R5bGluZy5ib3Rfc2hvd25fb25fd2Vic2l0ZSAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuSXNQb3dlcmVkQnlDZW5zZSA9PSB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdFN0eWxpbmcudmFsdWUgPT0gdGhpcy5ib3RfYnV0dG9uc19hbGlnbm1lbnQudmFsdWUgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdFRoZW1lID09IHRoaXMuYm90X3N0eWxpbmcuYm90X3RoZW1lICYmIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Vc2VyTWVzc2FnZUZvbnRDb2xvciA9PSB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdFJlc3BvbnNlRm9udENvbG9yID09IHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3IgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJ1dHRvbkJvcmRlclRoZW1lID09IHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQnV0dG9uU3R5bGluZy5ob3Jpem9udGFsID09IHRoaXMuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nICYmIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5CdXR0b25TdHlsaW5nLnZlcnRpY2FsID09IHRoaXMuYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQnV0dG9uVGhlbWUgPT0gdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fdGhlbWUgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkhlYWRlclN0eWxpbmcudmFsdWUgPT0gdGhpcy5ib3RfaGVhZGVyX2FsaWdubWVudC52YWx1ZSAmJiB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuSGVhZGVyVGhlbWUgPT0gdGhpcy5ib3RfaGVhZGVyX2JhY2tncm91bmQgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkltYWdlTmFtZSA9PSB0aGlzLmZpbGVfbGFiZWwgJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLldpZGdldFBvc2l0aW9uLnZlcnRpY2FsID09IHRoaXMuYm90X3ZlcnRpY2FsX3Bvc2l0aW9uICYmIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5XaWRnZXRQb3NpdGlvbi5ob3Jpem9udGFsID09IHRoaXMuYm90X2hvcml6b250YWxfcG9zaXRpb24gJiYgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLlNob3dCb3RIaXN0b3J5ID09IHRoaXMuYm90X3N0eWxpbmcuc2hvd19ib3RfaGlzdG9yeSkgewogICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2hlY2sgPSB0cnVlOwogICAgICB9CiAgICB9CgogICAgaWYgKGNoZWNrKSB7CiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIklmIHlvdSBoYXZlIG1hZGUgYW55IGNoYW5nZXMgaW4gdGhlIEJvdCBDb25maWd1cmF0aW9uIHNldHRpbmdzIHBsZWFzZSBzYXZlIHRoZW0gZmlyc3QsIGVsc2UgdGhleSB3aWxsIGRpc2NhcmRlZCEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJTYXZlIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAiQ2FuY2VsIgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczIudXBsb2FkX2ltYWdlKCk7CgogICAgICAgICAgX3RoaXMyLnN1Ym1pdF9ncmVldGluZ3MoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBuZXh0KCk7CiAgICB9CiAgfSwKICBkaXJlY3RpdmVzOiB7CiAgICBmb2N1czogewogICAgICBpbnNlcnRlZDogZnVuY3Rpb24gaW5zZXJ0ZWQoZWwpIHsKICAgICAgICBlbC5mb2N1cygpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBncmVldGluZ19lbW9qaV9vZmY6IGZ1bmN0aW9uIGdyZWV0aW5nX2Vtb2ppX29mZihpZCkgewogICAgICAkKCIjZW1vamlfIi5jb25jYXQoaWQpKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaScpOwogICAgfSwKICAgIGdyZWV0aW5nX2Vtb2ppX29uOiBmdW5jdGlvbiBncmVldGluZ19lbW9qaV9vbihpZCkgewogICAgICAkKCIjZW1vamlfIi5jb25jYXQoaWQpKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaScpOwogICAgfSwKICAgIGJ1dHRvbl9lbW9qaV9vZmY6IGZ1bmN0aW9uIGJ1dHRvbl9lbW9qaV9vZmYoaWQpIHsKICAgICAgJCgiI2Vtb2ppX3RpdGxlXyIuY29uY2F0KGlkKSkudG9nZ2xlQ2xhc3MoJ3Zpc2libGVfZW1vamlfYnRuX3RpdGxlJyk7CiAgICB9LAogICAgYnV0dG9uX2Vtb2ppX29uOiBmdW5jdGlvbiBidXR0b25fZW1vamlfb24oaWQpIHsKICAgICAgJCgiI2Vtb2ppX3RpdGxlXyIuY29uY2F0KGlkKSkudG9nZ2xlQ2xhc3MoJ3Zpc2libGVfZW1vamlfYnRuX3RpdGxlJyk7CiAgICB9LAogICAgYXBwZW5kOiBmdW5jdGlvbiBhcHBlbmQoZW1vamksIGlkKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYm90X2dyZWV0aW5nc1tpXS5pZCA9PT0gaWQpIHsKICAgICAgICAgIHZhciBjdXJzb3JQb3MgPSAkKCcjJyArIGlkKS5wcm9wKCJzZWxlY3Rpb25TdGFydCIpOwogICAgICAgICAgdmFyIHYgPSAkKCcjJyArIGlkKS52YWwoKTsKICAgICAgICAgIHZhciB0ZXh0QmVmb3JlID0gdi5zdWJzdHJpbmcoMCwgY3Vyc29yUG9zKTsKICAgICAgICAgIHZhciB0ZXh0QWZ0ZXIgPSB2LnN1YnN0cmluZyhjdXJzb3JQb3MsIHYubGVuZ3RoKTsKICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1tpXS50ZXh0ID0gdGV4dEJlZm9yZSArIGVtb2ppICsgdGV4dEFmdGVyOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFwcGVuZF9vbl90aXRsZTogZnVuY3Rpb24gYXBwZW5kX29uX3RpdGxlKGVtb2ppLCBpZCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0uaWQgPT09IGlkKSB7CiAgICAgICAgICB2YXIgY3Vyc29yUG9zID0gJCgnIycgKyBpZCkucHJvcCgic2VsZWN0aW9uU3RhcnQiKTsKICAgICAgICAgIHZhciB2ID0gJCgnIycgKyBpZCkudmFsKCk7CiAgICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IHYuc3Vic3RyaW5nKDAsIGN1cnNvclBvcyk7CiAgICAgICAgICB2YXIgdGV4dEFmdGVyID0gdi5zdWJzdHJpbmcoY3Vyc29yUG9zLCB2Lmxlbmd0aCk7CiAgICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0udGl0bGUgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2V0X2ludGVudHM6IGZ1bmN0aW9uIGdldF9pbnRlbnRzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNob3dfaW50ZW50X3VybCgpLCB7CiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIgogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgIF90aGlzMy5pbnRlbnRsaXN0LnB1c2gocmVzcG9uc2UuZGF0YVtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWRkX2JvdF9ncmVldGluZ3M6IGZ1bmN0aW9uIGFkZF9ib3RfZ3JlZXRpbmdzKCkgewogICAgICB2YXIgbmV4dF9pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5wdXNoKHsKICAgICAgICB0ZXh0OiBudWxsLAogICAgICAgIGlkOiBuZXh0X2lkLAogICAgICAgIHZpc2libGU6IHRydWUKICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX2dyZWV0aW5nOiBmdW5jdGlvbiBkZWxldGVfZ3JlZXRpbmcoaW5kZXgpIHsKICAgICAgaWYgKHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggPT09IDEgJiYgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmxlbmd0aCA+IDApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJBdGxlYXN0IG9uZSBHcmVldGluZyBpcyByZXF1aXJlZCB0byBhZGQgYnV0dG9ucyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRlbXBfaW5kZXggPSBudWxsOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmlkID09IGluZGV4KSB7CiAgICAgICAgICB0ZW1wX2luZGV4ID0gaTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5zcGxpY2UodGVtcF9pbmRleCwgMSk7CiAgICB9LAogICAgZ2V0X3dpZGdldF9zZXR0aW5nczogZnVuY3Rpb24gZ2V0X3dpZGdldF9zZXR0aW5ncygpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB0aGlzLmJvdF9ncmVldGluZ3MgPSBbXTsKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7IC8vIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscyA9IFtdOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2lkZ2V0X3NldHRpbmdfdXJsKCksIHsKICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc1Nob3c6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNC5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIF90aGlzNC50aXRsZSA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0VGl0bGU7CiAgICAgICAgX3RoaXM0Lm9sZF93aWRnZXRfdGl0bGUgPSBfdGhpczQudGl0bGU7CiAgICAgICAgX3RoaXM0LmZpbGVfbGFiZWwgPSByZXNwb25zZS5kYXRhLkltYWdlTmFtZTsKICAgICAgICBfdGhpczQuZmlsZV9sYWJlbF8yID0gcmVzcG9uc2UuZGF0YS5Cb3RJbWFnZU5hbWU7CiAgICAgICAgX3RoaXM0LmZpbGVfbGFiZWxfMyA9IHJlc3BvbnNlLmRhdGEuQmdJbWFnZU5hbWU7CiAgICAgICAgX3RoaXM0LmJvdF9zdHlsaW5nLmJvdF90aGVtZSA9IHJlc3BvbnNlLmRhdGEuQm90VGhlbWUubGVuZ3RoIDwgNiA/IChyZXNwb25zZS5kYXRhLkJvdFRoZW1lICsgcmVzcG9uc2UuZGF0YS5Cb3RUaGVtZS5zbGljZSgxLCByZXNwb25zZS5kYXRhLkJvdFRoZW1lLmxlbmd0aCkpLnN1YnN0cigwLCA3KSA6IHJlc3BvbnNlLmRhdGEuQm90VGhlbWU7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lICE9IG51bGwpIHsKICAgICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0gcmVzcG9uc2UuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZS5sZW5ndGggPCA2ID8gKHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUgKyByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lLnNsaWNlKDEsIHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUubGVuZ3RoKSkuc3Vic3RyKDAsIDcpIDogcmVzcG9uc2UuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM0LmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgPSBfdGhpczQuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PT0gImJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUiOwogICAgICAgICAgfSlbMF0udmFsdWU7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciAhPSBudWxsKSB7CiAgICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcudXNlcl9tc2dfZm9udF9jb2xvciA9IHJlc3BvbnNlLmRhdGEuVXNlck1lc3NhZ2VGb250Q29sb3IubGVuZ3RoIDwgNiA/IChyZXNwb25zZS5kYXRhLlVzZXJNZXNzYWdlRm9udENvbG9yICsgcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvci5zbGljZSgxLCByZXNwb25zZS5kYXRhLlVzZXJNZXNzYWdlRm9udENvbG9yLmxlbmd0aCkpLnN1YnN0cigwLCA3KSA6IHJlc3BvbnNlLmRhdGEuVXNlck1lc3NhZ2VGb250Q29sb3I7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yID0gX3RoaXM0LmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT09ICJib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yIjsKICAgICAgICAgIH0pWzBdLnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3IgIT0gbnVsbCkgewogICAgICAgICAgX3RoaXM0LmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yID0gcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvci5sZW5ndGggPCA2ID8gKHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3IgKyByZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yLnNsaWNlKDEsIHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3IubGVuZ3RoKSkuc3Vic3RyKDAsIDcpIDogcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM0LmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yID0gX3RoaXM0LmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT09ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciI7CiAgICAgICAgICB9KVswXS52YWx1ZTsKICAgICAgICB9CgogICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy5idXR0b25fdGhlbWUgPSByZXNwb25zZS5kYXRhLkJ1dHRvblRoZW1lLmxlbmd0aCA8IDYgPyAocmVzcG9uc2UuZGF0YS5CdXR0b25UaGVtZSArIHJlc3BvbnNlLmRhdGEuQnV0dG9uVGhlbWUuc2xpY2UoMSwgcmVzcG9uc2UuZGF0YS5CdXR0b25UaGVtZS5sZW5ndGgpKS5zdWJzdHIoMCwgNykgOiByZXNwb25zZS5kYXRhLkJ1dHRvblRoZW1lOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Cb3RHcmVldGluZ3MubGVuZ3RoID4gMCkgewogICAgICAgICAgX3RoaXM0LmJvdF9ncmVldGluZ3MgPSByZXNwb25zZS5kYXRhLkJvdEdyZWV0aW5nczsKICAgICAgICAgIF90aGlzNC53aWRnZXRfYnV0dG9uc19kZXRhaWxzID0gX3RoaXM0LmJvdF9ncmVldGluZ3NbX3RoaXM0LmJvdF9ncmVldGluZ3MubGVuZ3RoIC0gMV0uYnV0dG9uczsKCiAgICAgICAgICBfdGhpczQuYm90X2dyZWV0aW5ncy5tYXAoZnVuY3Rpb24gKGN2LCBpbmQsIGFycikgewogICAgICAgICAgICBkZWxldGUgX3RoaXM0LmJvdF9ncmVldGluZ3NbaW5kXS5idXR0b25zOwogICAgICAgICAgICBfdGhpczQuYm90X2dyZWV0aW5nc1tpbmRdLmlkID0gX3RoaXM0LmdlbmVyYXRlVVVJRCgpOwogICAgICAgICAgICBfdGhpczQuYm90X2dyZWV0aW5nc1tpbmRdLnZpc2libGUgPSBfdGhpczQuYm90X2dyZWV0aW5nc1tpbmRdLnZpc2libGUgIT09IHVuZGVmaW5lZCA/IF90aGlzNC5ib3RfZ3JlZXRpbmdzW2luZF0udmlzaWJsZSA6IHRydWU7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoX3RoaXM0LndpZGdldF9idXR0b25zX2RldGFpbHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIF90aGlzNC53aWRnZXRfYnV0dG9uc19kZXRhaWxzID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczQud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBfdGhpczQud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS5pZCA9IF90aGlzNC5nZW5lcmF0ZVVVSUQoKTsgLy8gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzWwogICAgICAgICAgICAvLyAgIGkKICAgICAgICAgICAgLy8gXS52YWx1ZSA9IHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS52YWx1ZS5yZXBsYWNlKAogICAgICAgICAgICAvLyAgIHRoaXMuY29tcGFueWlkICsgIl8iLAogICAgICAgICAgICAvLyAgICIiCiAgICAgICAgICAgIC8vICk7CgogICAgICAgICAgICBfdGhpczQud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS52YWx1ZSA9IF90aGlzNC53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlOwogICAgICAgICAgICBfdGhpczQud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS52YWx1ZSA9IF90aGlzNC53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlLnJlcGxhY2UoIi8iLCAiIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfdGhpczQuYm90X2ZvbnRfc3R5bGUgPSByZXNwb25zZS5kYXRhLkJvdEZvbnQuRm9udFN0eWxlOwogICAgICAgIF90aGlzNC5ib3RfZm9udF9jb2xvcl9zZW5kZXIgPSByZXNwb25zZS5kYXRhLkJvdEZvbnQuRm9udENvbG9yU2VuZGVyOwogICAgICAgIF90aGlzNC5ib3RfZm9udF9jb2xvcl9yZWNlaXZlciA9IHJlc3BvbnNlLmRhdGEuQm90Rm9udC5Gb250Q29sb3JSZWNlaXZlcjsKICAgICAgICBfdGhpczQuYm90X2ZvbnRfY29sb3JfYnV0dG9ucyA9IHJlc3BvbnNlLmRhdGEuQm90Rm9udC5Gb250Q29sb3JCdXR0b25zOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nKSB7CiAgICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nID0gcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLmhvcml6b250YWw7CiAgICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyA9IHJlc3BvbnNlLmRhdGEuQnV0dG9uU3R5bGluZy52ZXJ0aWNhbDsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLldpZGdldFBvc2l0aW9uKSB7CiAgICAgICAgICBfdGhpczQuYm90X2FsaWdubWVudCA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0UG9zaXRpb24uYWxpZ247CiAgICAgICAgICBfdGhpczQuYm90X3ZlcnRpY2FsX3Bvc2l0aW9uID0gcmVzcG9uc2UuZGF0YS5XaWRnZXRQb3NpdGlvbi52ZXJ0aWNhbDsKICAgICAgICAgIF90aGlzNC5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0UG9zaXRpb24uaG9yaXpvbnRhbDsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLkJvdFN0eWxpbmcpIHsKICAgICAgICAgIF90aGlzNC5ib3RfYnV0dG9uc19hbGlnbm1lbnQgPSByZXNwb25zZS5kYXRhLkJvdFN0eWxpbmc7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5IZWFkZXJTdHlsaW5nKSB7CiAgICAgICAgICBfdGhpczQuYm90X2hlYWRlcl9hbGlnbm1lbnQgPSByZXNwb25zZS5kYXRhLkhlYWRlclN0eWxpbmc7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5IZWFkZXJUaGVtZSkgewogICAgICAgICAgX3RoaXM0LmJvdF9oZWFkZXJfYmFja2dyb3VuZCA9IHJlc3BvbnNlLmRhdGEuSGVhZGVyVGhlbWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RoaXM0LmZpbGVfbGFiZWxfMyAhPSAiIikgewogICAgICAgICAgX3RoaXM0LmJvdF9iYWNrZ3JvdW5kX3R5cGUgPSAiaW1hZ2UiOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM0Lm9sZF9pbWFnZV9uYW1lID0gX3RoaXM0LmZpbGVfbGFiZWw7CgogICAgICAgIGlmIChfdGhpczQuZmlsZV9sYWJlbCA9PSAiIikgewogICAgICAgICAgX3RoaXM0LmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM0Lm9sZF9pbWFnZV9uYW1lXzIgPSBfdGhpczQuZmlsZV9sYWJlbF8yOwoKICAgICAgICBpZiAoX3RoaXM0LmZpbGVfbGFiZWxfMiA9PSAiIiB8fCBfdGhpczQuZmlsZV9sYWJlbF8yID09IHVuZGVmaW5lZCkgewogICAgICAgICAgX3RoaXM0LmZpbGVfbGFiZWxfMiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgfQoKICAgICAgICBfdGhpczQub2xkX2ltYWdlX25hbWVfMyA9IF90aGlzNC5maWxlX2xhYmVsXzM7CgogICAgICAgIGlmIChfdGhpczQuZmlsZV9sYWJlbF8zID09ICIiIHx8IF90aGlzNC5maWxlX2xhYmVsXzMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfdGhpczQuZmlsZV9sYWJlbF8zID0gIkNob29zZSBmaWxlIjsKICAgICAgICB9CgogICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy5ib3Rfb3Blbl9ieV9kZWZhdWx0ID0gcmVzcG9uc2UuZGF0YS5Cb3RPcGVuQnlEZWZhdWx0OwogICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy5pc19wb3dlcmVkX2J5X2NlbnNlID0gcmVzcG9uc2UuZGF0YS5Jc1Bvd2VyZWRCeUNlbnNlID09PSB1bmRlZmluZWQgPyBfdGhpczQuYm90X3N0eWxpbmcuaXNfcG93ZXJlZF9ieV9jZW5zZSA6IHJlc3BvbnNlLmRhdGEuSXNQb3dlcmVkQnlDZW5zZTsKICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcuYm90X3Nob3duX29uX3dlYnNpdGUgPSByZXNwb25zZS5kYXRhLkJvdFNob3duT25XZWJzaXRlID09IG51bGwgfHwgcmVzcG9uc2UuZGF0YS5Cb3RTaG93bk9uV2Vic2l0ZSA9PSB1bmRlZmluZWQgPyB0cnVlIDogcmVzcG9uc2UuZGF0YS5Cb3RTaG93bk9uV2Vic2l0ZTsKICAgICAgICB2YXIgY2hhdF9wYXJhbXMgPSB7CiAgICAgICAgICBsb2dvOiByZXNwb25zZS5kYXRhLkltYWdlVXJsLAogICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEuV2lkZ2V0VGl0bGUsCiAgICAgICAgICBidXR0b25fdGhlbWU6IHJlc3BvbnNlLmRhdGEuQnV0dG9uVGhlbWUsCiAgICAgICAgICBib3RfdGhlbWU6IHJlc3BvbnNlLmRhdGEuQm90VGhlbWUsCiAgICAgICAgICBidXR0b25fYm9yZGVyX3RoZW1lOiByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lLAogICAgICAgICAgdXNlcl9tc2dfZm9udF9jb2xvcjogcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciwKICAgICAgICAgIGJvdF9yZXNwb25zZV9mb250X2NvbG9yOiByZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yLAogICAgICAgICAgYm90X2ljb246IHJlc3BvbnNlLmRhdGEuQm90SW1hZ2VVcmwsCiAgICAgICAgICBib3RfYmFja2dyb3VuZF9pbWFnZTogcmVzcG9uc2UuZGF0YS5CZ0ltYWdlVXJsLAogICAgICAgICAgYnV0dG9uX2hvcml6b250YWxfc3BhY2luZzogcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLmhvcml6b250YWwsCiAgICAgICAgICBidXR0b25fdmVydGljYWxfc3BhY2luZzogcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLnZlcnRpY2FsLAogICAgICAgICAgYnV0dG9uX2FsaWdubWVudDogcmVzcG9uc2UuZGF0YS5Cb3RTdHlsaW5nLAogICAgICAgICAgaXNfcG93ZXJlZF9ieV9jZW5zZTogcmVzcG9uc2UuZGF0YS5Jc1Bvd2VyZWRCeUNlbnNlCiAgICAgICAgfTsKCiAgICAgICAgX3RoaXM0LiRzZXNzaW9uLnNldCgiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIsIGNoYXRfcGFyYW1zKTsKCiAgICAgICAgX3RoaXM0LmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgPSByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lID09PSBudWxsID8gX3RoaXM0LmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgOiByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lOwogICAgICAgIF90aGlzNC5ib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yID0gcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciA9PT0gbnVsbCA/IF90aGlzNC5ib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yIDogcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvcjsKICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3IgPSByZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yID09PSBudWxsID8gX3RoaXM0LmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yIDogcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvcjsKICAgICAgICBfdGhpczQuYm90X3N0eWxpbmcuc2hvd19ib3RfaGlzdG9yeSA9IHJlc3BvbnNlLmRhdGEuU2hvd0JvdEhpc3RvcnkgPT09IHVuZGVmaW5lZCA/IHRydWUgOiByZXNwb25zZS5kYXRhLlNob3dCb3RIaXN0b3J5OwogICAgICAgIF90aGlzNC52ZXJpZnlfYm90X3NldHRpbmdzID0gcmVzcG9uc2UuZGF0YTsgLy8gdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEdyZWV0aW5nc1t0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoIC0gMV0uYnV0dG9ucyA9IHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsczsKCiAgICAgICAgX3RoaXM0LnZlcmlmeV9jaGVjayA9IHRydWU7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM0LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgX3RoaXM0LnZlcmlmeV9jaGVjayA9IGZhbHNlOwogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHJlc2V0X3RvX2RlZmF1bHQ6IGZ1bmN0aW9uIHJlc2V0X3RvX2RlZmF1bHQodmFsdWUpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLm5hbWUgPT09IHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5idXR0b25fdGhlbWUiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLnZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImJvdF9zdHlsaW5nLmJvdF90aGVtZSIpIHsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfdGhlbWUgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbaV0udmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAiYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSIpIHsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLnZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudXNlcl9tc2dfZm9udF9jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVtpXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciIpIHsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVtpXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmciKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLnZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmciKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVtpXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXNbdmFsdWVdID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLnZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZF9idXR0b25zX2Zvcl93aWRnZXQ6IGZ1bmN0aW9uIGFkZF9idXR0b25zX2Zvcl93aWRnZXQoKSB7CiAgICAgIGlmICh0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiQXRsZWFzdCBvbmUgZ3JlZXRpbmcgaXMgcmVxdWlyZWQgdG8gYWRkIGJ1dHRvbiIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRlbXBfaWQgPSB0aGlzLmdlbmVyYXRlVVVJRCgpOwogICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMucHVzaCh7CiAgICAgICAgdGl0bGU6IG51bGwsCiAgICAgICAgdmFsdWU6IHRoaXMuaW50ZW50bGlzdFswXSwKICAgICAgICBpZDogdGVtcF9pZCwKICAgICAgICB2aXNpYmxlOiB0cnVlCiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZV93aWRnZXRfYnV0dG9uOiBmdW5jdGlvbiBkZWxldGVfd2lkZ2V0X2J1dHRvbihidXR0b25fZGV0KSB7CiAgICAgIGlmIChidXR0b25fZGV0LmRpc2FibGVkID09PSB0cnVlKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVGhpcyBpcyBhIERlZmF1bHQgQnV0dG9uLiBZb3UgY2Fubm90IERlbGV0ZSBpdCEiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZW1wX2luZGV4ID0gbnVsbDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0uaWQgPT0gYnV0dG9uX2RldC5pZCkgewogICAgICAgICAgICB0ZW1wX2luZGV4ID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5zcGxpY2UodGVtcF9pbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQ6IGZ1bmN0aW9uIGZpbGVpbnB1dChlKSB7CiAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwoKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgYW4gSW1hZ2Ugb2YgdHlwZSBQTkcgb3IgSlBFRyIpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0MjogZnVuY3Rpb24gZmlsZWlucHV0MihlKSB7CiAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwoKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMiA9IHRoaXMuZmlsZV9sYWJlbF8yOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbF8yID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMihmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IGFuIEltYWdlIG9mIHR5cGUgUE5HIG9yIEpQRUciKTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dDM6IGZ1bmN0aW9uIGZpbGVpbnB1dDMoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHJldHVybjsKCiAgICAgIGlmIChmaWxlc1swXS5zaXplID4gMjA5NzE1MikgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNpemUgbGVzcyB0aGFuIDJNQiIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL3BuZyIgfHwgZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL2pwZWciKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzX2JnX2ltYWdlX2NoYW5nZWQpIHsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMyA9IHRoaXMuZmlsZV9sYWJlbF8zOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzMgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UzKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgYW4gSW1hZ2Ugb2YgdHlwZSBQTkcgb3IgSlBFRyIpOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNS5pbWFnZV9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBjcmVhdGVJbWFnZTI6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlMihmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczYuaW1hZ2VfZmlsZV8yID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBjcmVhdGVJbWFnZTM6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlMyhmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczcuaW1hZ2VfZmlsZV8zID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICB1cGxvYWRfaW1hZ2U6IGZ1bmN0aW9uIHVwbG9hZF9pbWFnZSgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5ib3RfdmVydGljYWxfcG9zaXRpb24gPiAxNTApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJZb3UgY2FuIG5vdCBzZWxlY3QgdmVydGljYWwgcG9zaXRpb24gZnJvbSBib3R0b20gZ3JlYXRlciB0aGFuIDE1MCBwaXhlbCIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiA+IDMyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiWW91IGNhbiBub3Qgc2VsZWN0IGhvcml6b250YWwgcG9zaXRpb24gZ3JlYXRlciB0aGFuIDMyIHBpeGVsIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmJvdF9oZWFkZXJfYWxpZ25tZW50ID09PSBudWxsKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBIZWFkZXIgQWxpZ25tZW50IiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJvdF9idXR0b25zX2FsaWdubWVudCA9PT0gbnVsbCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBTZWxlY3QgQnV0dG9ucyBBbGlnbm1lbnQiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgQSBGaWxlIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5maWxlX2xhYmVsICE9IHRoaXMub2xkX2ltYWdlX25hbWUgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIFNlbGVjdCBBIEZpbGUiKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVfbGFiZWwgIT0gdGhpcy5vbGRfaW1hZ2VfbmFtZSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID09ICIiKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IEEgRmlsZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgd2lkZ2V0X3RpdGxlOiB0aGlzLnRpdGxlLAogICAgICAgICAgaXNJbWFnZUVkaXQ6IHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgaXNCb3RJbWFnZUVkaXQ6IHRoaXMuZmlsZV9sYWJlbF8yICE9IHRoaXMub2xkX2ltYWdlX25hbWVfMiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgIGltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbCwKICAgICAgICAgIHdpZGdldF9pbWFnZTogdGhpcy5pbWFnZV9maWxlLAogICAgICAgICAgb2xkX2ltYWdlX25hbWU6IHRoaXMub2xkX2ltYWdlX25hbWUgPT0gIkNob29zZSBGaWxlIiA/IG51bGwgOiB0aGlzLm9sZF9pbWFnZV9uYW1lLAogICAgICAgICAgaXNFZGl0OiB0cnVlLAogICAgICAgICAgYm90X2ltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbF8yLAogICAgICAgICAgb2xkX2JvdF9pbWFnZV9uYW1lOiB0aGlzLm9sZF9pbWFnZV9uYW1lXzIgPT0gIkNob29zZSBGaWxlIiA/IG51bGwgOiB0aGlzLm9sZF9pbWFnZV9uYW1lXzIsCiAgICAgICAgICBib3RfaW1hZ2U6IHRoaXMuaW1hZ2VfZmlsZV8yLAogICAgICAgICAgb2xkX2JnX2ltYWdlX25hbWU6IHRoaXMub2xkX2ltYWdlX25hbWVfMyA9PSAiQ2hvb3NlIEZpbGUiICYmICF0aGlzLmlzX2JnX2ltYWdlX2NoYW5nZWQgPyBudWxsIDogdGhpcy5vbGRfaW1hZ2VfbmFtZV8zLAogICAgICAgICAgYmdfaW1hZ2U6IHRoaXMuYm90X2JhY2tncm91bmRfdHlwZSA9PT0gIm5vbmUiID8gIk5vX2ltYWdlIiA6IHRoaXMuaW1hZ2VfZmlsZV8zLAogICAgICAgICAgYmdfaW1hZ2VfbmFtZTogdGhpcy5maWxlX2xhYmVsXzMsCiAgICAgICAgICBpc0JnSW1hZ2VFZGl0OiB0aGlzLmZpbGVfbGFiZWxfMyAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lXzMgfHwgdGhpcy5ib3RfYmFja2dyb3VuZF90eXBlID09PSAibm9uZSIgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICBoZWFkZXJfdGhlbWU6IHRoaXMuYm90X2hlYWRlcl9iYWNrZ3JvdW5kLAogICAgICAgICAgaGVhZGVyX2N1c3RvbV9zdHlsZTogdGhpcy5ib3RfaGVhZGVyX2FsaWdubWVudCwKICAgICAgICAgIGJvdF90aGVtZTogdGhpcy5ib3Rfc3R5bGluZy5ib3RfdGhlbWUsCiAgICAgICAgICBidXR0b25fYm9yZGVyX3RoZW1lOiB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUsCiAgICAgICAgICB1c2VyX21zZ19mb250X2NvbG9yOiB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IsCiAgICAgICAgICBib3RfcmVzcG9uc2VfZm9udF9jb2xvcjogdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciwKICAgICAgICAgIGJ1dHRvbl90aGVtZTogdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fdGhlbWUsCiAgICAgICAgICBib3RfY3VzdG9tX3N0eWxlOiB0aGlzLmJvdF9idXR0b25zX2FsaWdubWVudCwKICAgICAgICAgIGJvdF9mb250OiB7CiAgICAgICAgICAgIEZvbnRTdHlsZTogdGhpcy5ib3RfZm9udF9zdHlsZSwKICAgICAgICAgICAgRm9udENvbG9yU2VuZGVyOiB0aGlzLmJvdF9mb250X2NvbG9yX3NlbmRlciwKICAgICAgICAgICAgRm9udENvbG9yUmVjZWl2ZXI6IHRoaXMuYm90X2ZvbnRfY29sb3JfcmVjZWl2ZXIsCiAgICAgICAgICAgIEZvbnRDb2xvckJ1dHRvbnM6IHRoaXMuYm90X2ZvbnRfY29sb3JfYnV0dG9ucwogICAgICAgICAgfSwKICAgICAgICAgIGJvdF9wb3NpdGlvbjogewogICAgICAgICAgICBhbGlnbjogdGhpcy5ib3RfYWxpZ25tZW50LAogICAgICAgICAgICB2ZXJ0aWNhbDogdGhpcy5ib3RfdmVydGljYWxfcG9zaXRpb24sCiAgICAgICAgICAgIGhvcml6b250YWw6IHRoaXMuYm90X2hvcml6b250YWxfcG9zaXRpb24KICAgICAgICAgIH0sCiAgICAgICAgICBidXR0b25fY3VzdG9tX3N0eWxlOiB7CiAgICAgICAgICAgIHZlcnRpY2FsOiB0aGlzLmJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmcsCiAgICAgICAgICAgIGhvcml6b250YWw6IHRoaXMuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nCiAgICAgICAgICB9LAogICAgICAgICAgYm90X29wZW5fYnlfZGVmYXVsdDogdGhpcy5ib3Rfc3R5bGluZy5ib3Rfb3Blbl9ieV9kZWZhdWx0LAogICAgICAgICAgYm90X3Nob3duX29uX3dlYnNpdGU6IHRoaXMuYm90X3N0eWxpbmcuYm90X3Nob3duX29uX3dlYnNpdGUsCiAgICAgICAgICBpc19wb3dlcmVkX2J5X2NlbnNlOiB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UsCiAgICAgICAgICBzaG93X2JvdF9oaXN0b3J5OiB0aGlzLmJvdF9zdHlsaW5nLnNob3dfYm90X2hpc3RvcnkKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzOC5iaWdfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzOC5nZXRfd2lkZ2V0X3NldHRpbmdzKCk7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkR1cGxpY2F0ZSBpbWFnZSIpIHsKICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKAogICAgICAgICAgICAvLyAgICJJbWFnZSBhbHJlYWR5IGZvdW5kLiBQbGVhc2UgdXBsb2FkIGFub3RoZXIgaW1hZ2Ugb3IgcmVuYW1lIGl0LiIKICAgICAgICAgICAgLy8gKTsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJXaWRnZXQgU2V0dGluZ3MgYWRkZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBTZXR0aW5ncyBoYXZlIGJlZW4gVXBkYXRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczguZ2V0X3dpZGdldF9zZXR0aW5ncygpOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfZ3JlZXRpbmdzOiBmdW5jdGlvbiBzdWJtaXRfZ3JlZXRpbmdzKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGZvciAodmFyIGRhdGEgPSAwOyBkYXRhIDwgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmxlbmd0aDsgZGF0YSsrKSB7CiAgICAgICAgaWYgKHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tkYXRhXS50aXRsZS5sZW5ndGggPiAyMCkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJUaXRsZSBvZiBidXR0b24gc2hvdWxkIG5vdCBiZSBtb3JlIHRoYW4gMjAgY2hhcmFjdGVyIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgdGltZXI6IDUwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGludGVudF92YWxzID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmZpbHRlcihmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbC52YWx1ZSA9PT0gbnVsbCB8fCB2YWwudGl0bGUgPT09IG51bGw7CiAgICAgIH0pOwoKICAgICAgaWYgKGludGVudF92YWxzLmxlbmd0aCA+IDApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IEludGVudCBmb3IgYSBidXR0b24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgd2lkZ2V0X2RldGFpbHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscykpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWRnZXRfZGV0YWlscy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlID0KICAgICAgICAvLyAgICIvIiArIHRoaXMuY29tcGFueWlkICsgIl8iICsgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWUgPSAiLyIgKyB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZTsgLy8gaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfZ3JlZXRpbmdzLmluY2x1ZGVzKHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlKSkgewogICAgICAgIC8vICAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWUgPSAiLyIgKyAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAvLyAgIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlID0KICAgICAgICAvLyAgICAgIi8iICsgdGhpcy5jb21wYW55aWQgKyAiXyIgKyB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZTsKICAgICAgICAvLyB9CiAgICAgIH0KCiAgICAgIGlmICh3aWRnZXRfZGV0YWlscy5sZW5ndGggPiAwKSB7CiAgICAgICAgaWYgKHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICBkZWxldGUgdGhpcy5ib3RfZ3JlZXRpbmdzW19pXS5idXR0b25zOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1t0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoIC0gMV0uYnV0dG9ucyA9IHdpZGdldF9kZXRhaWxzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MucHVzaCh7CiAgICAgICAgICAgIGJ1dHRvbnM6IHdpZGdldF9kZXRhaWxzCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aWRnZXRfc2V0dGluZ191cmwoKSwgewogICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGVkaXRfZ3JlZXRpbmdzOiB0cnVlLAogICAgICAgIGJvdF9ncmVldGluZ3M6IHRoaXMuYm90X2dyZWV0aW5ncwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM5LmJpZ19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJXaWRnZXQgU2V0dGluZ3MgYWRkZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJZb3VyIFNldHRpbmdzIGhhdmUgYmVlbiBVcGRhdGVkIFN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczkuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzOS5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CgogICAgICAgIF90aGlzOS5nZXRfd2lkZ2V0X3NldHRpbmdzKCk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2VuZXJhdGVVVUlEOiBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CiAgICAgIC8vIFB1YmxpYyBEb21haW4vTUlUCiAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IC8vVGltZXN0YW1wCgogICAgICB2YXIgZDIgPSBwZXJmb3JtYW5jZSAmJiBwZXJmb3JtYW5jZS5ub3cgJiYgcGVyZm9ybWFuY2Uubm93KCkgKiAxMDAwIHx8IDA7IC8vVGltZSBpbiBtaWNyb3NlY29uZHMgc2luY2UgcGFnZS1sb2FkIG9yIDAgaWYgdW5zdXBwb3J0ZWQKCiAgICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTY7IC8vcmFuZG9tIG51bWJlciBiZXR3ZWVuIDAgYW5kIDE2CgogICAgICAgIGlmIChkID4gMCkgewogICAgICAgICAgLy9Vc2UgdGltZXN0YW1wIHVudGlsIGRlcGxldGVkCiAgICAgICAgICByID0gKGQgKyByKSAlIDE2IHwgMDsKICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGQgLyAxNik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vVXNlIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgaWYgc3VwcG9ydGVkCiAgICAgICAgICByID0gKGQyICsgcikgJSAxNiB8IDA7CiAgICAgICAgICBkMiA9IE1hdGguZmxvb3IoZDIgLyAxNik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKGMgPT09ICJ4IiA/IHIgOiByICYgMHgzIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrX2FjdGl2ZV9idG5fZm9yX2dyZWV0aW5nOiBmdW5jdGlvbiBjaGVja19hY3RpdmVfYnRuX2Zvcl9ncmVldGluZyhpZCkgewogICAgICB2YXIgYnRuX2dyZWV0aW5nc19zdGF0dXMgPSB0aGlzLmdldF9idG5fZ3JlZXRpbmdfdmlzaWJsZV9zdGF0dXMoKTsKCiAgICAgIGlmIChidG5fZ3JlZXRpbmdzX3N0YXR1c1swXSA9PT0gdHJ1ZSAmJiBidG5fZ3JlZXRpbmdzX3N0YXR1c1sxXSA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLm9uZV9ncmVldGluZ19zd2FsKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3NbdGhpcy5ib3RfZ3JlZXRpbmdzLmZpbmRJbmRleChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICByZXR1cm4gaS5pZCA9PT0gaWQ7CiAgICAgICAgICB9KV0udmlzaWJsZSA9IHRydWU7CiAgICAgICAgICB0aGlzLmdyZWV0aW5nc19rZXkgKz0gMTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19vbmVfZ3JlZXRpbmdfZW5hYmxlZDogZnVuY3Rpb24gY2hlY2tfb25lX2dyZWV0aW5nX2VuYWJsZWQoaWQpIHsKICAgICAgdmFyIGJ0bl9ncmVldGluZ3Nfc3RhdHVzID0gdGhpcy5nZXRfYnRuX2dyZWV0aW5nX3Zpc2libGVfc3RhdHVzKCk7CgogICAgICBpZiAoYnRuX2dyZWV0aW5nc19zdGF0dXNbMF0gPT09IHRydWUgJiYgYnRuX2dyZWV0aW5nc19zdGF0dXNbMV0gPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5vbmVfZ3JlZXRpbmdfc3dhbCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW3RoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5maW5kSW5kZXgoZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgcmV0dXJuIGkuaWQgPT09IGlkOwogICAgICAgICAgfSldLnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYnV0dG9uc19rZXkgKz0gMTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZXRfYnRuX2dyZWV0aW5nX3Zpc2libGVfc3RhdHVzOiBmdW5jdGlvbiBnZXRfYnRuX2dyZWV0aW5nX3Zpc2libGVfc3RhdHVzKCkgewogICAgICByZXR1cm4gW3RoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS52aXNpYmxlOwogICAgICB9KS5pbmNsdWRlcyh0cnVlKSwgdGhpcy5ib3RfZ3JlZXRpbmdzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnZpc2libGU7CiAgICAgIH0pLmluY2x1ZGVzKHRydWUpXTsKICAgIH0sCiAgICBvbmVfZ3JlZXRpbmdfc3dhbDogZnVuY3Rpb24gb25lX2dyZWV0aW5nX3N3YWwoKSB7CiAgICAgIHN3YWwoewogICAgICAgIHRleHQ6ICJBdGxlYXN0IG9uZSBncmVldGluZyBpcyByZXF1aXJlZCBmb3IgYSBidXR0b24gdG8gYmUgdmlzaWJsZSEhIiwKICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIHRpbWVyOiA1NTAwCiAgICAgIH0pOwogICAgfQogIH0KfTs="},null]}