{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue","mtime":1663910265466},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvaG9tZS92aW1hbGVzaC9DRU5TRS9jaGF0Ym90LXBvcnRhbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBUZW1wbGF0ZSBmcm9tICIuLi9UZW1wbGF0ZS52dWUiOwppbXBvcnQgeyBWdWVFZGl0b3IgfSBmcm9tICJ2dWUyLWVkaXRvciI7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgcGFnZV9ndWlkZSBmcm9tICJAL3BvcnRhbC9taXhpbnMvcGFnZV9ndWlkZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBUZW1wbGF0ZTogVGVtcGxhdGUsCiAgICBWdWVFZGl0b3I6IFZ1ZUVkaXRvcgogIH0sCiAgbmFtZTogIk5ld0ludGVudHNQYWdlIiwKICBtaXhpbnM6IFtmcmVlemVfcG9ydGFsLCBwYWdlX2d1aWRlLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWxdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwZW5jaWxfc3ZnOiAnIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUuNTQ2IiBoZWlnaHQ9IjE1LjQ2MSIgdmlld0JveD0iMCAwIDE1LjU0NiAxNS40NjEiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiM5ZTllOWU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03NDcuODg4IC0zNTYuNzY5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik03NTkuNDE2LDM1Ni43NjlhMi4zNTgsMi4zNTgsMCwwLDEsMS43NzcuNjYyYy41MzQuNTEzLDEuMDcyLDEuMDI1LDEuNTY3LDEuNTc1YTIuMywyLjMsMCwwLDEtLjA3MSwzLjMyNWMtMi43MzYsMi43Ni01LjQ5NCw1LjUtOC4yMzgsOC4yNTFhMS4zODEsMS4zODEsMCwwLDEtLjc1OC4yODhjLS43MTkuMTc0LTEuNDI5LjM3OS0yLjE0NC41NzItLjkzMi4yNTEtMS44NjIuNS0yLjc5NS43NTEtLjYuMTU4LS45ODktLjIxMy0uODMyLS44MDdxLjY4OS0yLjU5NSwxLjQwNi01LjE4MmExLjE2NCwxLjE2NCwwLDAsMSwuMjg5LS40ODdxNC4wOTEtNC4xMDcsOC4yLTguMkEyLjI2NSwyLjI2NSwwLDAsMSw3NTkuNDE2LDM1Ni43NjlabS0xLjk4OSwyLjk1Ni02LjU0LDYuNTM4LDMuMDI1LDMuMDI0LDYuNTM4LTYuNTM3Wm00LjAyMywyLjE2NWMuMTE4LS4xMzUuMjI1LS4yNjkuMzQzLS4zOTJhMS4xMzQsMS4xMzQsMCwwLDAsMC0xLjczNGMtLjQ2LS40NjYtLjkyNi0uOTI1LTEuMzg4LTEuMzlhMS4xNjYsMS4xNjYsMCwwLDAtLjg2MS0uMzY4Yy0uNTc4LDAtLjg4MS40LTEuMjE0Ljc2Wm0tMTIuMDg0LDguODYzLDMuMi0uODYzLTIuMzM3LTIuMzMxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTgxMy45NDIsNDIyLjZsLS43ODktLjgsMy44MjEtMy44MTkuNzg0LjhaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTkuNjQ4IC01NS45NDcpIi8+PC9nPjwvc3ZnPicsCiAgICAgIHBvaW50X2NpcmNsZV9zdmc6ICc8c3ZnIGRhdGEtdi04Y2I4ZDlmZT0iIiBkYXRhLXRvb2x0aXA9InRvb2x0aXAiIGRhdGEtcGxhY2VtZW50PSJib3R0b20iIHRpdGxlPSIiIGRhdGEtdG9nZ2xlPSJtb2RhbCIgZGF0YS10YXJnZXQ9IiNjb25maWdhcGltb2RhbDQiIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgdmVyc2lvbj0iMS4xIiBkYXRhLW9yaWdpbmFsLXRpdGxlPSJIZWxwIj48ZyBkYXRhLXYtOGNiOGQ5ZmU9IiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTAyOC40KSI+PHBhdGggZGF0YS12LThjYjhkOWZlPSIiIGQ9Im0yMiAxMmMwIDUuNTIzLTQuNDc3IDEwLTEwIDEwLTUuNTIyOCAwLTEwLTQuNDc3LTEwLTEwIDAtNS41MjI4IDQuNDc3Mi0xMCAxMC0xMCA1LjUyMyAwIDEwIDQuNDc3MiAxMCAxMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMTAyOS40KSIgZmlsbD0iIzI5ODBiOSI+PC9wYXRoPjxwYXRoIGRhdGEtdi04Y2I4ZDlmZT0iIiBkPSJtMjIgMTJjMCA1LjUyMy00LjQ3NyAxMC0xMCAxMC01LjUyMjggMC0xMC00LjQ3Ny0xMC0xMCAwLTUuNTIyOCA0LjQ3NzItMTAgMTAtMTAgNS41MjMgMCAxMCA0LjQ3NzIgMTAgMTB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDEwMjguNCkiIGZpbGw9IiMyNzM2NzkiPjwvcGF0aD48L2c+PC9zdmc+JywKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgbmV3X2ludGVudF9saXN0OiBbXSwKICAgICAgb2xkX2ludGVudF9uYW1lOiAiIiwKICAgICAgb2xkX3F1ZXN0aW9uc19saXN0OiBbXSwKICAgICAgb2xkX2ltYWdlX25hbWU6ICIiLAogICAgICBvbGRfdmlkZW9fdXJsOiAiIiwKICAgICAgaW50ZW50bGlzdDogW10sCiAgICAgIGNvbXBhbnluYW1lOiAiIiwKICAgICAgY29tcGFueWlkOiAiIiwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGVkaXQ6ICJGYWxzZSIsCiAgICAgIGFkZF9lZGl0OiAiZmFsc2UiLAogICAgICAvLyBlZGl0X3Jlc3BvbnNlOiAiIiwKICAgICAgb2xkX2ludGVudF9kYXRhOiBbXSwKICAgICAgbmV3X2ludGVudF9kYXRhOiBbXSwKICAgICAgaXNfcmVzcG9uc2U6IGZhbHNlLAogICAgICBpc19lbmRwb2ludDogZmFsc2UsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgc2hvd190YXNrX3ZhbHVlczogZmFsc2UsCiAgICAgIHNhdmVfc2hvd190YXNrX3ZhbHVlczogZmFsc2UsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICBwYWdlbm86ICIiLAogICAgICB2aWV3X2RlZmluZV9hcGlfZW5kcG9pbnRzOiBmYWxzZSwKICAgICAgZGVmaW5lX2FwaV9lbmRwb2ludHM6IGZhbHNlLAogICAgICB2aWV3X3Jlc3BvbnNlX21vZGFsOiB0cnVlLAogICAgICBlZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWw6IHRydWUsCiAgICAgIGltYWdlX3Jlc3BvbnNlOiAiTm8iLAogICAgICB2aWRlb19yZXNwb25zZTogIk5vIiwKICAgICAgdmlkZW9fbGluazogIiIsCiAgICAgIGVtYmRfbGluazogIiIsCiAgICAgIGVtYmRfbGlua19lZGl0OiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbDI6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWwzOiAiQ2hvb3NlIGZpbGUiLAogICAgICBvcHRpb25zOiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ6ICIiLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleDogMCwKICAgICAgLy90aGlzIGlzIGFsc28gdXNlZCB0byBlZGl0IGludGVudCByZXNwb25zZQogICAgICBzZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2U6IFsiIl0sCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodDogIiIsCiAgICAgIHNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9pbWFnZTogIiIsCiAgICAgIG5hbWVfZmlsZTogIiIsCiAgICAgIHRlbXBfZmlsZV9uYW1lOiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3ZpZGVvOiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3NvdXJjZTogIiIsCiAgICAgIHNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnM6IFsiIl0sCiAgICAgIGlzRWRpdEludGVudDogZmFsc2UsCiAgICAgIHVybDogIiIsCiAgICAgIC8vIFRoaXMgVmFyaWFibGVzIGFyZSBmb3IgTkVXIElOVEVOVAogICAgICBuZXdfaW50ZW50czogIiIsCiAgICAgIGFkZF9xdWVzdGlvbnNfbGlzdDogWyIiXSwKICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgLy8gcmVzcG9uc2U6IFsiIl0sCiAgICAgIG11bHRpcGxlX3Jlc3BvbnNlOiBbIiJdLAogICAgICBjdXN0b21Ub29sYmFyOiBbWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwgW3sKICAgICAgICBjb2xvcjogW10KICAgICAgfSwgewogICAgICAgIGJhY2tncm91bmQ6IFtdCiAgICAgIH1dLCBbewogICAgICAgIGxpc3Q6ICJvcmRlcmVkIgogICAgICB9LCB7CiAgICAgICAgbGlzdDogImJ1bGxldCIKICAgICAgfV0sIFsibGluayJdXSwKICAgICAgc2F2ZV91cmw6ICIiLAogICAgICBzYXZlX2FwaV9tZXRob2Q6IG51bGwsCiAgICAgIHNhdmVfanNvbl9yZXF1ZXN0X2RhdGE6ICIiLAogICAgICBzYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgc2F2ZV9lZGl0YWJsZV92YWx1ZXM6ICIiLAogICAgICBzYXZlX3Rhc2tfaW5wdXRfdmFsdWVzOiBbXSwKICAgICAgc2F2ZV9lbmR1c2VyX21zZ190eXBlOiAiQ3VzdG9tIiwKICAgICAgc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGE6ICIiLAogICAgICBzYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyOiAiIiwKICAgICAgc2F2ZV9lbmRfdXNlcl9tZXNzYWdlOiAiIiwKICAgICAgc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlOiBudWxsLAogICAgICBzYXZlX3Jlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2U6ICIiLAogICAgICBzYXZlX3Vuc3VjY2Vzc2Z1bF9tZXNzYWdlOiBudWxsLAogICAgICBpc1Zpc2libGVTZWFyY2hDbGVhcjogZmFsc2UsCiAgICAgIGFwaV9tZXRob2Q6IG51bGwsCiAgICAgIHBvc3RfbWV0aG9kX3JlcXVlc3RfbGlzdDogW10sCiAgICAgIHNob3dfanNvbl9yZXF1ZXN0X2RhdGE6ICIiLAogICAgICBzaG93X2pzb25fcmVzcG9uc2VfZGF0YTogIiIsCiAgICAgIHJlcXVlc3RfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgZWRpdGFibGVfdmFsdWVzOiAiIiwKICAgICAgaXNFZGl0OiBmYWxzZSwKICAgICAgdXR0ZXJhbmNlczogW10sCiAgICAgIGVuZHVzZXJfbXNnX3R5cGU6IG51bGwsCiAgICAgIHJlc3BvbnNlX2tleV90b19lbmR1c2VyOiAiIiwKICAgICAgZW5kX3VzZXJfbWVzc2FnZTogbnVsbCwKICAgICAgcmVzcG9uc2VfanNvbl9lZGl0YWJsZTogbnVsbCwKICAgICAgcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZTogIiIsCiAgICAgIHVuc3VjY2Vzc2Z1bF9tZXNzYWdlOiBudWxsLAogICAgICBmaW5hbHN0ZXA6IGZhbHNlLAogICAgICBhcGlfbGlzdDogW10sCiAgICAgIHJlcXVlc3RfanNvbl9jYXNlXzE6ICJ7XG4gICAgICAgICAgXCJjb21wYW55aWRcIjpcIkNvbXBhbnlJZFwiLFxuICAgICAgICAgIFwiZW1haWxcIjpcImVtYWlsXCIsXG4gICAgICAgICAgXCJyb2xlXCI6XCJyb2xlXCIsXG4gICAgICAgICAgXCJzdWJqZWN0XCI6XCIgXCIsXG4gICAgICAgICAgXCJkZXNjcmlwdGlvblwiOlwiIFwiLFxuICAgICAgICB9IiwKICAgICAgaW5wdXRfZnJvbV91c2VyX2Nhc2VfMTogInN1YmplY3Q7ZGVzY3JpcHRpb24iLAogICAgICByZXF1ZXN0X2pzb25fY2FzZV8yOiAie1xuXHQgICAgICAgIFwidXNlclwiOiB7XG5cdFx0ICAgICAgXCJjb21wYW55aWRcIjogJ2NvbXBhbnlJZCcsXG5cdFx0ICAgICAgXCJlbWFpbFwiOiAnZW1haWwnLFxuXHRcdCAgICAgIFwicm9sZVwiOiAncm9sZScsXG5cdFx0ICAgICAgXCJpbmZvXCI6IHtcblx0XHQgICAgICBcdFwibmlja25hbWVcIjogXCJcIlxuXHRcdCAgICAgIH1cblx0ICAgICAgfSxcblx0ICAgICAgXCJzZWFyY2hwYXJhbWV0ZXJcIjoge1xuXHRcdCAgICAgIFwic3RhdHVzXCI6IFwiXCIsXG5cdFx0ICAgICAgXCJvcmRlcmJ5XCI6IFwiXCIsXG5cdFx0ICAgICAgXCJmcm9tZGF0ZVwiOiBcIjAxLzAxLzIwMThcIixcblx0XHQgICAgICBcImNvdW50XCI6IDEwLFxuXHRcdCAgICAgIFwic2VhcmNodGV4dFwiOiBcIlwiLFxuXHRcdCAgICAgIFwidHlwZW9mdmlzaXRcIjogXCJBTExcIixcblx0XHQgICAgICBcInNvcnRvcmRlclwiOiBcImFwcG9pbnRtZW50XCIsXG5cdFx0ICAgICAgXCJzdGFydGluZGV4XCI6IFwiMVwiLFxuXHRcdCAgICAgIFwiZW5kaW5kZXhcIjogXCIxMFwiLFxuXHRcdCAgICAgIFwidG9kYXRlXCI6IFwiMDgvMDYvMjAxOFwiXG5cdCAgICAgIH1cblxuICAgICAgfSIsCiAgICAgIGlucHV0X2Zyb21fdXNlcl9jYXNlXzI6ICJ1c2VyLGluZm8sbmlja25hbWU7c2VhcmNocGFyYW1ldGVyLGZyb21kYXRlO3NlYXJjaHBhcmFtZXRlcix0b2RhdGUiLAogICAgICByZXF1ZXN0X2pzb25fY2FzZV8zOiAieyBcbiAgICAgICAgICBcImNvbXBhbnlpZFwiOlwiY29tcGFueWlkXCIsXG4gICAgICAgICAgXCJlbWFpbFwiOlwiZW1haWxcIixcbiAgICAgICAgICBcInJvbGVcIjpcInJvbGVcIiBcbiAgICAgIH0iLAogICAgICByZXNwb25zZV9qc29uX2Nhc2VfMTogIntcbiAgICAgICAgICAnbWVzc2FnZSc6J1lvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gc2NoZWR1bGVkJyxcbiAgICAgICAgICAndXNlcm5hbWUnOidDZW5zZScsXG4gICAgICAgICAgJ2VtYWlsJzondXNlckBjZW5zZS5haSdcbiAgICAgIH0iLAogICAgICByZXNwb25zZV9qc29uX2Nhc2VfMTE6ICJ7XG4gICAgICAgICAgJ21lc3NhZ2UnOidBUEkgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICAnY291bnQnOic4J1xuICAgICAgICAgICd1c2VybmFtZSc6J0NlbnNlJyxcbiAgICAgICAgICAnZW1haWwnOid1c2VyQGNlbnNlLmFpJ1xuICAgICAgfSIsCiAgICAgIHRhc2tfaW5wdXRfdmFsdWVzOiBbXSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzOiBmYWxzZSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQ6IGZhbHNlLAogICAgICBlZGl0X3ZpZGVvX3Jlc3BvbnNlOiAiTm8iLAogICAgICBlZGl0X2ltYWdlX3Jlc3BvbnNlOiAiTm8iLAogICAgICBmaWxlX2NvbnRlbnQyOiAiIiwKICAgICAgZmlsZV9jb250ZW50MzogIiIsCiAgICAgIHNwaW5uZXJPbkZpbGVEb3dubG9hZDogZmFsc2UsCiAgICAgIGZpbGVfbGFiZWxfY3N2OiAiQ2hvb3NlIGZpbGUiLAogICAgICBmaWxlX2NvbnRlbnRfY3N2OiAiIiwKICAgICAgZGVmYXVsdF9yZXRhaWxfaW50ZW50czogW10sCiAgICAgIHdhbnRfc3RhdHVzOiB0cnVlLAogICAgICBpbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uOiAnJywKICAgICAgaXNfc2VhcmNoX2FjdGl2ZTogZmFsc2UsCiAgICAgIGRhdGFfaXNfZW1pdDogIiIsCiAgICAgIGRpc2FibGVfYnRuX2V4cGlyZWQ6IGZhbHNlLAogICAgICByZWdfdXJsOiAvaHR0cHM6XC9cL1sod3d3XC4pP2EtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKFstYS16QS1aMC05QDolX1wrLn4jPyZcL1wvPV0qKS9pLAogICAgICBuZXdfaW50ZW50X3F1ZXN0aW9uX2xpc3Q6IFsnJ10KICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc2VsZWN0X2NvbXBhbnlfbXNnJykpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KCiAgICBheGlvcy5nZXQoYXBpX2NhbGxzLnNvdXJjZV9saXN0X3VybCgpLCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICBpZiAoX3RoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgIF90aGlzLm9wdGlvbnMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgIH0gZWxzZSBpZiAoX3RoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3IiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICB9CiAgICB9KTsKICAgIGF4aW9zLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWdzKCksIHsKICAgICAgcGFyYW1zOiB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgX3RoaXMuZW50aXR5X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgIF90aGlzLnBvc3RfbWV0aG9kX3JlcXVlc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgIF90aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgIHRoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7IC8vIGNvbnNvbGUubG9nKCJVdHRlcmFuY2VzIiwgdGhpcy51dHRlcmFuY2VzKTsKICB9LAogIHdhdGNoOiB7CiAgICBlZGl0YWJsZV92YWx1ZXM6IGZ1bmN0aW9uIGVkaXRhYmxlX3ZhbHVlcygpIHsKICAgICAgaWYgKHRoaXMuZWRpdGFibGVfdmFsdWVzICE9ICIiKSB7CiAgICAgICAgdGhpcy5zaG93X3Rhc2tfdmFsdWVzID0gdHJ1ZTsgLy8gIGNvbnNvbGUubG9nKCJIZXJlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3Rhc2tfdmFsdWVzID0gZmFsc2U7IC8vICBjb25zb2xlLmxvZygiTm90IEhlcmUiKTsKICAgICAgfQogICAgfSwKICAgIHNhdmVfZWRpdGFibGVfdmFsdWVzOiBmdW5jdGlvbiBzYXZlX2VkaXRhYmxlX3ZhbHVlcygpIHsKICAgICAgaWYgKHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICB0aGlzLnNhdmVfc2hvd190YXNrX3ZhbHVlcyA9IHRydWU7IC8vICBjb25zb2xlLmxvZygiSGVyZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2F2ZV9zaG93X3Rhc2tfdmFsdWVzID0gZmFsc2U7IC8vICBjb25zb2xlLmxvZygiTm90IEhlcmUiKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9uYW1lOiBmdW5jdGlvbiBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgbmV3X2ludGVudHM6IGZ1bmN0aW9uIG5ld19pbnRlbnRzKHZhbCkgewogICAgICB0aGlzLm5ld19pbnRlbnRzID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0sCiAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudDogZnVuY3Rpb24gY3VycmVudF9zZWxlY3RlZF9pbnRlbnQodmFsKSB7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNoZWNrX3NlbGVjdF9hbGxfaW50ZW50c19jYnhfZGlzYWJsZWQ6IGZ1bmN0aW9uIGNoZWNrX3NlbGVjdF9hbGxfaW50ZW50c19jYnhfZGlzYWJsZWQoKSB7CiAgICAgIGlmICh0aGlzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciB0ZW1wID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQpKSB7CiAgICAgICAgICAgIHRlbXAgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0ZW1wOwogICAgICB9CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgdGhpcy5wYWdlX2d1aWRlKCk7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMyLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5ld0ludGVudHNQYWdlRGlzYWJsZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzMi5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgYm90X3RlbXBsYXRlc19kYXRhID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkJvdFRlbXBsYXRlcyIpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm90X3RlbXBsYXRlc19kYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChib3RfdGVtcGxhdGVzX2RhdGFbaV0uZG9tYWluID09PSAiUmV0YWlsIiAmJiBib3RfdGVtcGxhdGVzX2RhdGFbaV0uaW50ZW50X2RhdGEubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cyA9IGJvdF90ZW1wbGF0ZXNfZGF0YVtpXS5pbnRlbnRfZGF0YS5tYXAoZnVuY3Rpb24gKGFycikgewogICAgICAgICAgcmV0dXJuIGFyci5JbnRlbnQ7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNjb25maWdhcGltb2RhbDQiKS5vbigic2hvd24uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiLTAuNSIpOwogICAgfSk7CiAgICAkKCIjY29uZmlnYXBpbW9kYWw0Iikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICIxIik7CiAgICB9KTsKICAgICQoJ1tkYXRhLXRvZ2dsZT0idG9vbHRpcCJdJykudG9vbHRpcCgpOwogICAgJCgiI2ludGVudG1vZGVsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbDIiKS5vbigic2hvd24uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiLTAuNSIpOwogICAgfSk7CiAgICAkKCIjY29uZmlnYXBpbW9kYWwyIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICIxIik7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbF9qc29uX2VkaXRhYmxlIikub24oInNob3duLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIi0wLjUiKTsKICAgIH0pOwogICAgJCgiI2NvbmZpZ2FwaW1vZGFsX2pzb25fZWRpdGFibGUiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIjEiKTsKICAgIH0pOwogICAgJCgnYVtkYXRhLXRhcmdldD0iI2ludGVudG1vZGVsIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh2bS5pc0VkaXRJbnRlbnQgPT0gdHJ1ZSkgewogICAgICAgIHZtLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgnc2hvdycpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCJzZW5kX21vZGVsX3N0YXR1cyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09IHRydWUpIHsKICAgICAgICBfdGhpczIuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmICh0aGlzLiRyb3V0ZS5wYXJhbXMubW9kYWxfb3Blbl9zd2l0Y2hfdGFiKSB7CiAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgIHRoaXMuJHJvb3QuJGVtaXQoImNoYW5nZV9zaWRlYmFyX21haW5fbWVudSIsICJUcmFpbmluZyBIdWIiKTsKICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIGlmICh0aGlzLmlzRWRpdEludGVudCkgewogICAgICB0aGlzLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgewogICAgICBuZXh0KCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRfdmFyaWFudF9vcGVuX21vZGFsOiBmdW5jdGlvbiBhZGRfdmFyaWFudF9vcGVuX21vZGFsKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIHZlcmlmeV9jaGFuZ2VzOiBmdW5jdGlvbiB2ZXJpZnlfY2hhbmdlcygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV92ZXJpZnlfY2hhbmdlc19tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd2ZXJpZnlfY2hhbmdlc19hbGVydF9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3ZlcmlmeV9jaGFuZ2VzX3NhdmVfbXNnJyksCiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfdmVyaWZ5X2NoYW5nZXNfY2FuY2VsX21zZycpCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzMy5lZGl0X2ludGVudCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMzLnNob3dfaW50ZW50cyhfdGhpczMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwoKICAgICAgICAgICAgX3RoaXMzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGtfY2J4X2Nyc3I6IGZ1bmN0aW9uIGNoa19jYnhfY3JzcihpbnRlbnQpIHsKICAgICAgaWYgKGludGVudCA9PSAnYWxsJykgewogICAgICAgIHZhciB0ZW1wID0gImN1cnNvcjogcG9pbnRlcjsiOwoKICAgICAgICBpZiAodGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRlbXAgPSAiY3Vyc29yOiBub3QtYWxsb3dlZDsiOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pbnRlbnRsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQpKSB7CiAgICAgICAgICAgICAgdGVtcCA9ICJjdXJzb3I6IHBvaW50ZXI7IjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRlbXA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyhpbnRlbnQpKSB7CiAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN3aXRjaGluZzogZnVuY3Rpb24gc3dpdGNoaW5nKGVsZW1lbnQpIHsKICAgICAgaWYgKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5jaGVjaygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudW5jaGVjaygpOwogICAgICB9CiAgICB9LAogICAgY2hlY2s6IGZ1bmN0aW9uIGNoZWNrKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG5uIikuY2hlY2tlZCA9IHRydWU7CiAgICAgIHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9IGZhbHNlOyAvLyBjb25zb2xlLmxvZyh0aGlzLnZpZXdfcmVzcG9uc2VfbW9kYWwpOwogICAgfSwKICAgIHVuY2hlY2s6IGZ1bmN0aW9uIHVuY2hlY2soKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyYWRpb0J0bm4iKS5jaGVja2VkID0gZmFsc2U7CiAgICAgIHRoaXMudmlld19yZXNwb25zZV9tb2RhbCA9IHRydWU7IC8vIGNvbnNvbGUubG9nKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCk7CiAgICB9LAogICAgY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzOiBmdW5jdGlvbiBjaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXMoKSB7CiAgICAgIHRoaXMubW9kZWxfc3RhdHVzID0gdGhpcy4kc2Vzc2lvbi5nZXQoIk1vZGVsU3RhdHVzIik7CgogICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbih0aGlzLm1vZGVsX3N0YXR1cy5pbnRlbnRfbW9kZWwpID09PSB0cnVlIHx8IEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwpID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzLmludGVudF9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIgfHwgdGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiKSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzOiBmdW5jdGlvbiBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KSB7CiAgICAgIGlmICh0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPT0gdHJ1ZSkgewogICAgICAgIGlmIChpbmRleCA9PSAnc3R5bGUnKSB7CiAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gJ3RpdGxlJykgewogICAgICAgICAgcmV0dXJuIHRoaXMudGx0KCd0cmFpbl9tb2RlbF9wcm9ncmVzc19tc2cnKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCiAgICAvLyBlZGl0c3dpdGNoaW5nKGVsZW1lbnQpIHsKICAgIC8vICAgLy8gaWYgKHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsID09IHRydWUpIHsKICAgIC8vICAgLy8gICB0aGlzLmVjaGVjaygpOwogICAgLy8gICAvLyB9IGVsc2UgewogICAgLy8gICAvLyAgIHRoaXMuZXVuY2hlY2soKTsKICAgIC8vICAgLy8gfQogICAgLy8gfSwKICAgIC8vIGVjaGVjaygpIHsKICAgIC8vICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhZGlvQnRuIikuY2hlY2tlZCA9IHRydWU7CiAgICAvLyAgIHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsID0gZmFsc2U7CiAgICAvLyAgIC8vdGhlbiBtYWtpbmcgbnVsbCB2YWx1ZXMgdG8gc2V0IGZyZXNoIG5ldyB2YWx1ZXMKICAgIC8vICAgdGhpcy51cmwgPSAiIjsKICAgIC8vICAgdGhpcy5hcGlfbWV0aG9kID0gIiI7CiAgICAvLyAgIHRoaXMuc2hvd19qc29uX3JlcXVlc3RfZGF0YSA9ICIiOwogICAgLy8gICB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9ICIiOwogICAgLy8gICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gIiI7CiAgICAvLyAgIHRoaXMuZWRpdGFibGVfdmFsdWVzID0gIiI7CiAgICAvLyAgIHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9ICIiOwogICAgLy8gICB0aGlzLmVuZF91c2VyX21lc3NhZ2UgPSAiIjsKICAgIC8vICAgdGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID0gIiI7CiAgICAvLyAgIHRoaXMuc2hvd19qc29uX3Jlc3BvbnNlX2RhdGEgPSAiIjsKICAgIC8vICAgdGhpcy5yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gIiI7CiAgICAvLyAgIHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPSAiIjsKICAgIC8vICAgdGhpcy51bnN1Y2Nlc3NmdWxfbWVzc2FnZSA9ICIiOwogICAgLy8gICAvLyBjb25zb2xlLmxvZyh0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCk7CiAgICAvLyB9LAogICAgLy8gZXVuY2hlY2soKSB7CiAgICAvLyAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyYWRpb0J0biIpLmNoZWNrZWQgPSBmYWxzZTsKICAgIC8vICAgdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPSB0cnVlOwogICAgLy8gICAvLyBtYWtpbmcgdmFsdWVzIG51bGwKICAgIC8vICAgdGhpcy5xdWlsbDIuc2V0VGV4dCgiIik7CiAgICAvLyAgIHRoaXMuc291cmNlID0gIldlYiI7CiAgICAvLyAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAvLyAgIHRoaXMuaW1hZ2VfdXJsID0gIiI7CiAgICAvLyAgICh0aGlzLmVkaXRfdmlkZW9fcmVzcG9uc2UgPSAiTm8iKSx2aWRlb19yZXNwb25zZQogICAgLy8gICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgdGhpcy5maWxlX2xhYmVsMyA9ICJDaG9vc2UgZmlsZSI7CiAgICAvLyAgIHRoaXMuZmlsZV9jb250ZW50ID0gIiI7CiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsKTsKICAgIC8vIH0sCiAgICB0cmFpbl9tb2RlbDogZnVuY3Rpb24gdHJhaW5fbW9kZWwoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgndHJhaW5fbW9kZWxfc3dhbF9tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd0cmFpbl9tb2RlbF9zd2FsX2FsZXJ0X21zZycpLAogICAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ3RyYWluX21vZGVsX3N3YWxfY29uZmlybV9tc2cnKSwKICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBfdGhpczQuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudHJhaW5fbW9kZWwoKSwgewogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNC5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczQuY29tcGFueWlkCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNC4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBfdGhpczQud2FudF9zdGF0dXMgPSB0cnVlOwoKICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIndhbnRfbW9kZWxfc3RhdHVzIiwgX3RoaXM0LndhbnRfc3RhdHVzKTsKCiAgICAgICAgICAgICAgX3RoaXM0LmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSAyMDAwMDE1MSkgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IDIwMDAwMTQxKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRyk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgndHJhaW5fbW9kZWxfaW50ZXJuYWxfc2VydmVyX21zZycpKTsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgLy8gdHJhaW5fYW5kX3Rlc3RfbW9kZWwoKSB7CiAgICAvLyAgIFN3YWwoewogICAgLy8gICAgIHRpdGxlOiAiQXJlIFlvdSBTdXJlPyIsCiAgICAvLyAgICAgdGV4dDogIllvdSB3YW50IHRvIFRyYWluICYgVGVzdCBUaGUgTW9kZWw/IiwKICAgIC8vICAgICB0eXBlOiAicXVlc3Rpb24iLAogICAgLy8gICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAvLyAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAvLyAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgIC8vICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEiLAogICAgLy8gICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgIC8vICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAvLyAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgLy8gICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgIC8vICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIC8vICAgICAgIGF4aW9zCiAgICAvLyAgICAgICAgIC5wb3N0KAogICAgLy8gICAgICAgICAgIGFwaV9jYWxscy50cmFpbl9pbnRlbnRfbW9kZWwoKSwKICAgIC8vICAgICAgICAgICB7CiAgICAvLyAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgLy8gICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgLy8gICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgICAgICAgIHRlc3RfbW9kZWw6IHRydWUsCiAgICAvLyAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgICB7CiAgICAvLyAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICkKICAgIC8vICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PSA0MDQ2KSB7CiAgICAvLyAgICAgICAgICAgICBzd2FsKHsKICAgIC8vICAgICAgICAgICAgICAgdGl0bGU6ICJSZXN1bHRzIHdvdWxkIGJlIGF2YWlsYWJsZSBzb29uIiwKICAgIC8vICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5NU0csCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgIC8vICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgLy8gICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAvLyAgICAgICAgICAgICAgICAgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgIC8vICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgIC8vICAgICAgICAgICAgICAgICAvLyB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAvLyAgICAgICAgICAgICAgIH0KICAgIC8vICAgICAgICAgICAgIH0pOwogICAgLy8gICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PT0gMTAzNCkgewogICAgLy8gICAgICAgICAgICAgc3dhbCh7CiAgICAvLyAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAvLyAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEuTVNHLAogICAgLy8gICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgLy8gICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgIC8vICAgICAgICAgICAgICAgICAvLyAkKCcjZmlsZV91cGxvYWQnKS5tb2RhbCgnaGlkZScpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgIC8vICAgICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfSBlbHNlIHsKICAgIC8vICAgICAgICAgICAgIHN3YWwoewogICAgLy8gICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgLy8gICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgLy8gICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgICAgICAgICAgIC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAvLyAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAvLyAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgIC8vICQoIiNmaWxlX3VwbG9hZCIpLm1vZGFsKCJoaWRlIik7CiAgICAvLyAgICAgICAgIH0pCiAgICAvLyAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpOwogICAgLy8gICAgICAgICAgIGlmICgKICAgIC8vICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICAgICAgICApIHsKICAgIC8vICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICAgICAgfSBlbHNlIHsKICAgIC8vICAgICAgICAgICAgIFN3YWwoewogICAgLy8gICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgLy8gICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgLy8gICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgICAgICAgICAgIC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAvLyAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAvLyAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgICB9KTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwogICAgLy8gfSwKICAgIGNoZWNrX2N1cnJlbnRfaW50ZW50OiBmdW5jdGlvbiBjaGVja19jdXJyZW50X2ludGVudChpbmRleCkgewogICAgICB2YXIgcmV0dXJuX3ZhciA9ICIiOwoKICAgICAgaWYgKHRoaXMuaW50ZW50bGlzdFtpbmRleF0uSW50ZW50ID09IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaGlnaGxpZ2h0KSB7CiAgICAgICAgcmV0dXJuX3ZhciArPSAiY3VycmVudC1hY3RpdmUtaW50ZW50IjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyh0aGlzLmludGVudGxpc3RbaW5kZXhdLkludGVudCkpIHsKICAgICAgICByZXR1cm5fdmFyICs9ICIgZGlzYWJsZWQtaW50ZW50IjsKICAgICAgfQoKICAgICAgcmV0dXJuIHJldHVybl92YXI7CiAgICB9LAogICAgY2xlYXJfc2VhcmNoX25hbWU6IGZ1bmN0aW9uIGNsZWFyX3NlYXJjaF9uYW1lKCkgewogICAgICB0aGlzLnNlYXJjaF9uYW1lID0gIiI7CiAgICB9LAogICAgbG9hZF9pbnRlbnQ6IGZ1bmN0aW9uIGxvYWRfaW50ZW50KGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgLy8gdGhpcy5pbnRlbnRsaXN0ID0gW107CiAgICAgIHRoaXMuaXNfc2VhcmNoX2FjdGl2ZSA9IGZhbHNlOwogICAgICB0aGlzLnNlYXJjaF9uYW1lID0gJyc7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczUubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgIF90aGlzNS50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgX3RoaXM1LmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7CgogICAgICAgICAgaWYgKF90aGlzNS5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKEJvb2xlYW4oY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpKSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM1LnNldHBhZ2luYXRpb24oX3RoaXM1LnBhZ2Vfbm8pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzaG93X2ludGVudHM6IGZ1bmN0aW9uIHNob3dfaW50ZW50cyhpbmRleCkgewogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICB2YXIgY2xvbmVfc2VsZWN0ZWRfaW50ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmludGVudGxpc3RbaW5kZXhdKSk7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXggPSBpbmRleDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5JbnRlbnQ7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaGlnaGxpZ2h0ID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudDsKICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlF1ZXN0aW9uczsKICAgICAgdGhpcy5uZXdfaW50ZW50X3F1ZXN0aW9uX2xpc3QgPSBfdG9Db25zdW1hYmxlQXJyYXkobmV3IFNldChjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUXVlc3Rpb25zKSk7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudERlc2NyaXB0aW9uOwogICAgICB0aGlzLm9sZF9pbnRlbnRfbmFtZSA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ7CiAgICAgIHRoaXMub2xkX3F1ZXN0aW9uc19saXN0ID0gdGhpcy5pbnRlbnRsaXN0W2luZGV4XS5RdWVzdGlvbnM7CiAgICAgIHRoaXMuaXNfcmVzcG9uc2UgPSBmYWxzZTsKICAgICAgdGhpcy5pc19lbmRwb2ludCA9IGZhbHNlOwoKICAgICAgaWYgKGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZSAhPSBudWxsICYmIGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZSAhPSAiIikgewogICAgICAgIHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsID0gdHJ1ZTsKICAgICAgICB0aGlzLm9sZF92aWRlb191cmwgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UuVmlkZW9Vcmw7CiAgICAgICAgdGhpcy5pc19yZXNwb25zZSA9IHRydWU7CiAgICAgICAgdGhpcy5pc19lbmRwb2ludCA9IGZhbHNlOwogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlLlJlc3BvbnNlOyAvLyB0aGlzLnF1aWxsMi5yb290LmlubmVySFRNTCA9IHRoaXMuaW50ZW50bGlzdFtpbmRleF0uUmVzcG9uc2UuUmVzcG9uc2U7CgogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3NvdXJjZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZS5Tb3VyY2U7CiAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfaW1hZ2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UuSW1hZ2VVcmw7CgogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9pbWFnZSAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLm5hbWVfZmlsZSA9IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX2ltYWdlLnNwbGl0KCIvIik7CiAgICAgICAgICB0aGlzLnRlbXBfZmlsZV9uYW1lID0gdGhpcy5uYW1lX2ZpbGVbdGhpcy5uYW1lX2ZpbGUubGVuZ3RoIC0gMV07IC8vIGNvbnNvbGUubG9nKCJzcGxpdHRlZCIpOwoKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbDMgPSB0aGlzLnRlbXBfZmlsZV9uYW1lOwogICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZSA9IHRoaXMuZmlsZV9sYWJlbDM7CiAgICAgICAgICB0aGlzLmVkaXRfaW1hZ2VfcmVzcG9uc2UgPSAiWWVzIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZSA9ICIiOwogICAgICAgICAgdGhpcy5lZGl0X2ltYWdlX3Jlc3BvbnNlID0gIk5vIjsKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbDMgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfdmlkZW8gPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UuVmlkZW9Vcmw7CgogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV92aWRlbyAhPSAiIiB8fCB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV92aWRlby5sZW5ndGggIT0gMCkgewogICAgICAgICAgdGhpcy5lZGl0X3ZpZGVvX3Jlc3BvbnNlID0gIlllcyI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9ICJObyI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludCAhPSBudWxsICYmIGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludCAhPSAiIikgewogICAgICAgIHRoaXMuaXNfcmVzcG9uc2UgPSBmYWxzZTsKICAgICAgICB0aGlzLmlzX2VuZHBvaW50ID0gdHJ1ZTsKICAgICAgICB0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCA9IGZhbHNlOwogICAgICAgIHRoaXMudXR0ZXJhbmNlcyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5UYXNrcy5VdHRlcmFuY2VzOwogICAgICAgIHRoaXMuYXBpX21ldGhvZCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5NRVRIT0Q7CiAgICAgICAgdGhpcy5lZGl0YWJsZV92YWx1ZXMgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuVmFsdWVzVG9FZGl0OwogICAgICAgIHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LmlzRWRpdDsKICAgICAgICB0aGlzLnVybCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5VUkw7CiAgICAgICAgdGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlcXVlc3RKc29uOwogICAgICAgIHRoaXMuc2hvd19qc29uX3Jlc3BvbnNlX2RhdGEgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVzcG9uc2VKc29uOwogICAgICAgIHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5Nc2dfdHlwZTsKICAgICAgICB0aGlzLmVuZF91c2VyX21lc3NhZ2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuTWVzc2FnZVRvRW5kVXNlcjsKICAgICAgICB0aGlzLnJlc3BvbnNlX2tleV90b19lbmR1c2VyID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlc3BvbnNlS2V5VG9FbmRVc2VyOwogICAgICAgIHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXNwb25zZUtleUVkaXRhYmxlOwogICAgICAgIHRoaXMuc2hvd19qc29uX3Jlc3BvbnNlX2RhdGEgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVzcG9uc2VKc29uOwogICAgICAgIHRoaXMucmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXNwb25zZUtleU1lc3NhZ2VUb0VuZFVzZXI7CiAgICAgICAgdGhpcy51bnN1Y2Nlc3NmdWxfbWVzc2FnZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5VblN1Y2Nlc3NmdWxNZXNzYWdlOwogICAgICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnV0dGVyYW5jZXMpIHsKICAgICAgICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMucHVzaCh7CiAgICAgICAgICAgIGtleV9uYW1lOiB0aGlzLnV0dGVyYW5jZXNbaV0uUmF3U2xvdE5hbWUsCiAgICAgICAgICAgIGlucHV0X3RleHQ6IHRoaXMudXR0ZXJhbmNlc1tpXS5UZXh0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX3JlcV9qc29uOiBmdW5jdGlvbiBzYXZlX3JlcV9qc29uKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5zYXZlX2pzb25fcmVxdWVzdF9kYXRhKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgcmVxX2pzb246IGZ1bmN0aW9uIHJlcV9qc29uKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgc2F2ZV9yZXNwX2pzb246IGZ1bmN0aW9uIHNhdmVfcmVzcF9qc29uKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5zYXZlX2pzb25fcmVzcG9uc2VfZGF0YSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIHJlc3BfanNvbjogZnVuY3Rpb24gcmVzcF9qc29uKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIHNhdmVfcHVzaGluZzogZnVuY3Rpb24gc2F2ZV9wdXNoaW5nKCkgewogICAgICBpZiAodGhpcy5zYXZlX2FwaV9tZXRob2QgPT09IG51bGwpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugc2VsZWN0IE1ldGhvZCIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGlmICh0aGlzLnNhdmVfZWRpdGFibGVfdmFsdWVzICE9ICIiKSB7CiAgICAgICAgICB2YXIgZW1wdHlfdmFycyA9IFtdOwogICAgICAgICAgdmFyIGNzdiA9IHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMuc3BsaXQoIjsiKTsgLy8gIGNvbnNvbGUubG9nKCJ0aGlzIGlzIGNzdiIsY3N2KTsKCiAgICAgICAgICB2YXIgaW5wdXRfdmFsdWU7IC8vIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gY3N2KSB7CiAgICAgICAgICAgIHZhciB0ZW1wX2xpc3QgPSBjc3ZbaV0uc3BsaXQoIiwiKTsgLy8gIGNvbnNvbGUubG9nKCJ0aGlzIGlzIHRlbXAiLHRlbXBfbGlzdCk7CgogICAgICAgICAgICBpZiAodGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXSAhPSAiIikgewogICAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZygiaGVyZWVlIik7CiAgICAgICAgICAgICAgaW5wdXRfdmFsdWUgPSB0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICBpZiAoIXRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGtleS5rZXlfbmFtZTsKICAgICAgICAgICAgICB9KS5pbmNsdWRlcyhpbnB1dF92YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAga2V5X25hbWU6IGlucHV0X3ZhbHVlLAogICAgICAgICAgICAgICAgICBpbnB1dF90ZXh0OiAiIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRlbXAgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBpZiAoY3N2LmluY2x1ZGVzKHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpbmRleF1bJ2tleV9uYW1lJ10pKSB7CiAgICAgICAgICAgICAgdGVtcC5wdXNoKHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzID0gdGVtcDsgLy8gZm9yICh2YXIgaSBpbiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgIC8vICAgaWYgKHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ID09ICIiKSB7CiAgICAgICAgICAvLyAgICAgZW1wdHlfdmFycy5wdXNoKHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXSk7CiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzID0gW107CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0X3B1c2hpbmc6IGZ1bmN0aW9uIGVkaXRfcHVzaGluZygpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAodGhpcy5lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICAgIHZhciBlbXB0eV92YXJzID0gW107CiAgICAgICAgICB2YXIgY3N2ID0gdGhpcy5lZGl0YWJsZV92YWx1ZXMuc3BsaXQoIjsiKTsKICAgICAgICAgIHZhciBpbnB1dF92YWx1ZTsgLy8gdGhpcy50YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gY3N2KSB7CiAgICAgICAgICAgIHZhciB0ZW1wX2xpc3QgPSBjc3ZbaV0uc3BsaXQoIiwiKTsKCiAgICAgICAgICAgIGlmICh0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdICE9ICIiKSB7CiAgICAgICAgICAgICAgaW5wdXRfdmFsdWUgPSB0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICBpZiAoIXRoaXMudGFza19pbnB1dF92YWx1ZXMubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZXkua2V5X25hbWU7CiAgICAgICAgICAgICAgfSkuaW5jbHVkZXMoaW5wdXRfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICAgICAgICBrZXlfbmFtZTogaW5wdXRfdmFsdWUsCiAgICAgICAgICAgICAgICAgIGlucHV0X3RleHQ6ICIiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdGVtcCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICBpZiAoY3N2LmluY2x1ZGVzKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaW5kZXhdWydrZXlfbmFtZSddKSkgewogICAgICAgICAgICAgIHRlbXAucHVzaCh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gdGVtcDsgLy8gZm9yICh2YXIgaSBpbiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAvLyAgIGlmICh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgIC8vICAgICBlbXB0eV92YXJzLnB1c2godGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXSk7CiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgey8vIGNvbnNvbGUubG9nKGUpOwogICAgICB9CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZW50ZXJpbmcgYSBpbnRlbnQgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWQ6IGZ1bmN0aW9uIGVudGVyaW50ZW50aWQoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIGludGVudF9zZWFyY2hfa2V5ID0gdGhpcy5uZXdfaW50ZW50czsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgIGludGVudF9zZWFyY2hfa2V5OiB0aGlzLm5ld19pbnRlbnRzCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX05BTUVfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUgJiYgX3RoaXM2Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM2LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNi5uZXdfaW50ZW50cyAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczYuYXBpX3N0YXR1c19jb2RlLkRVUExJQ0FURV9JTlRFTlRfNDAxMV9NT0RFTFMuTVNHX0NPREUgJiYgX3RoaXM2Lm5ld19pbnRlbnRzID09PSBpbnRlbnRfc2VhcmNoX2tleSkgewogICAgICAgICAgX3RoaXM2LmludGVudF9hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gVGhpcyBpcyBmb3IgY2hlY2tpbmcgd2hpbGUgZWRpdGluZyBhbmQgZW50ZXJpbmcgYSBpbnRlbnQgbmFtZSBpZiBpdCBhbHJlYWR5IGV4aXN0cyBvciBub3QKICAgIGVudGVyaW50ZW50aWRfZWRpdDogZnVuY3Rpb24gZW50ZXJpbnRlbnRpZF9lZGl0KCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfaW50ZW50X3NlYXJjaDogdHJ1ZSwKICAgICAgICBpbnRlbnRfc2VhcmNoX2tleTogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCk7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9OQU1FX05PVF9FWElTVFNfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczcuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzNy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuRFVQTElDQVRFX0lOVEVOVF80MDExX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzNy5vbGRfaW50ZW50X25hbWUgPT0gX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSB7CiAgICAgICAgICAgIF90aGlzNy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOyAvLyAgY29uc29sZS5sb2coInlvdSBvbGQgb25seSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKCJ5b3UgaGVyZSIpOwogICAgICAgICAgICBfdGhpczcuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaW50ZW50X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzOiBmdW5jdGlvbiBpbnRlbnRfbmFtZV9jaGVja19zcGVjaWFsX2NoYXJhY3RlcnMoZSkgewogICAgICBpZiAoL15bXmEtekEtWjAtOV8gXSokLy50ZXN0KGUua2V5KSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfaW50ZW50OiBmdW5jdGlvbiBlZGl0X2ludGVudCgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5vbGRfaW50ZW50X25hbWUgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCkgewogICAgICAgIHZhciBpbnRlbnRfdG9fc2VuZCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gdmFyIGludGVudF90b19zZW5kID0gdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm9sZF9pbnRlbnRfbmFtZTsKICAgICAgICB2YXIgaW50ZW50X3RvX3NlbmQgPSB0aGlzLm9sZF9pbnRlbnRfbmFtZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQpIHsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2VkaXRfaW50ZW50X25hbWVfZXhpc3RfbXNnJykpOwogICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ID09ICIiKSB7CiAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYW4gSW50ZW50IG5hbWUiKTsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlZGl0X2ludGVudF9lbnRlcl9uYW1lX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zW19pXSA9PT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zW19pXSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlF1ZXN0aW9ucyBjYW5ub3QgYmUgYmxhbmsiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2VkaXRfaW50ZW50X3F1ZXN0aW9uX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gJ3NoaXBwaW5nJyAmJiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ICE9ICdtZXNzYWdpbmdfcGxhdGZvcm0nICYmIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gJ2NvbnRhY3RfdXMnICYmIHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgIGlzX2RlZmF1bHRfaW50ZW50OiB0cnVlLAogICAgICAgICAgLy8gb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucywKICAgICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbnNfbGlzdAogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOyAvLyB0aGlzLmludGVudHMgPSAiIjsKICAgICAgICAgIC8vIHRoaXMucXVlc3Rpb25fbGlzdCA9IFswXTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2VudGVyX25hbWVfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUllfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9lbnRlcl9uYW1lX21zZycpLAogICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfSU5fRElBTE9HX0VESVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9lbnRlcl9uYW1lX21zZzEnKSwKICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX0ZBSUxVUkVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzEnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkVycm9yIikgewogICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgIC8vICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgLy8gICAgIHRleHQ6IHRoaXMudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzInKSwKICAgICAgICAgIC8vICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAvLyAgIGlmKHRoaXMuaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSl7CiAgICAgICAgICAvLyAgICAgICB0aGlzLnNlYXJjaF9pbnRlbnQodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAvLyAgIH1lbHNlewogICAgICAgICAgLy8gICAgIHRoaXMubG9hZF9pbnRlbnQodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0gCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnMycpLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2cnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gLy8gdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19yZXNwb25zZSA9PT0gZmFsc2UgJiYgdGhpcy5pc19lbmRwb2ludCA9PT0gZmFsc2UpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlZGl0X2ludGVudDogdHJ1ZSwKICAgICAgICAgIG9sZF9pbnRlbnRfbmFtZTogaW50ZW50X3RvX3NlbmQsCiAgICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgb2xkX3F1ZXN0aW9uX2xpc3Q6IHRoaXMub2xkX3F1ZXN0aW9uc19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJJbnRlbnQgUXVlc3Rpb24gRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfZWRpdF9zdWNjZXNzX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogMzUwMCwKICAgICAgICAgICAgICB0aXRsZTogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfc3VjY2Vzc19hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJVc2VkIEludGVudCBOYW1lIEVkaXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9lZGl0ZWRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNzUwMAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJJbnRlbnQgUXVlc3Rpb24gTm90IEVkaXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZzEnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2czJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwpIHsKICAgICAgICBpZiAodGhpcy5vbGRfaW1hZ2VfbmFtZSA9PSB0aGlzLmZpbGVfbGFiZWwzKSB7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwzID0gIkNob29zZSBmaWxlIjsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZVtfaTJdID09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlW19pMl0gPT0gIjxwPjxicj48L3A+IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF9pbnRlbnRfcmVzcG9uc2VfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsMyA9PSAiQ2hvb3NlIGZpbGUiKSB7CiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsMyA9PT0gIkNob29zZSBmaWxlIiAmJiB0aGlzLmVkaXRfaW1hZ2VfcmVzcG9uc2UgPT0gIk5vIikgewogICAgICAgICAgICB2YXIgZGVsZXRlX2ltYWdlOwogICAgICAgICAgfSAvLyBjb25zb2xlLmxvZygiYXBpIGNhbGwiKTsKCgogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICAgIGlzX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgIHJlc3BvbnNlOiB7CiAgICAgICAgICAgICAgZmlsZV9uYW1lOiBudWxsLAogICAgICAgICAgICAgIHZpZGVvX2xpbms6IHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9PSAiWWVzIiA/IHRoaXMuZW1iZF9saW5rX2VkaXQgOiBbXSwKICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3NvdXJjZSwKICAgICAgICAgICAgICByZXNwb25zZTogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb2xkX2ltYWdlX2RlbGV0ZTogdGhpcy5maWxlX2xhYmVsMyA9PT0gIkNob29zZSBmaWxlIiAmJiB0aGlzLmVkaXRfaW1hZ2VfcmVzcG9uc2UgPT0gIk5vIiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgb2xkX2ltYWdlX25hbWU6IHRoaXMub2xkX2ltYWdlX25hbWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsgLy8gdGhpcy5yZXNwb25zZSA9ICIiOwogICAgICAgICAgICAvLyB0aGlzLmludGVudHMgPSAiIjsKICAgICAgICAgICAgLy8gdGhpcy5xdWVzdGlvbl9saXN0ID0gWzBdOwogICAgICAgICAgICAvLyB2YXIgcmVzcG9uc2VfYXBpID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2c0JyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfZWRpdF9zdWNjZXNzX21zZzEnKSwKICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVOVF9JTl9ESUFMT0dfRURJVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2VkaXRlZF9hbGVydF9tc2cxJyksCiAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNzUwMAogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5TVEFUVVNfRkFJTFVSRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnNScpLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRXJyb3IiKSB7CiAgICAgICAgICAgIC8vICAgU3dhbCh7CiAgICAgICAgICAgIC8vICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAvLyAgICAgdGV4dDogdGhpcy50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnNicpLAogICAgICAgICAgICAvLyAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgIC8vICAgaWYodGhpcy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKXsKICAgICAgICAgICAgLy8gICAgIHRoaXMuc2VhcmNoX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgLy8gICB9ZWxzZXsKICAgICAgICAgICAgLy8gICAgIHRoaXMubG9hZF9pbnRlbnQodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTUdfRFVQTElDQVRFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ltZ19leGlzdF9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzcnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2c0JyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gLy8gdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgaXNfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgICAgIGltYWdlX2VkaXQ6IHRydWUsCiAgICAgICAgICAgIG9sZF9pbnRlbnRfbmFtZTogaW50ZW50X3RvX3NlbmQsCiAgICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIG9sZF9pbWFnZV9uYW1lOiB0aGlzLm9sZF9pbWFnZV9uYW1lLAogICAgICAgICAgICBuZXdfaW1hZ2VfbmFtZTogdGhpcy5maWxlX2xhYmVsMywKICAgICAgICAgICAgaW1hZ2VfYmxvYjogdGhpcy5maWxlX2NvbnRlbnQzLAogICAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgIHJlc3BvbnNlOiB7CiAgICAgICAgICAgICAgZmlsZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwzLAogICAgICAgICAgICAgIHZpZGVvX2xpbms6IHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9PSAiWWVzIiA/IHRoaXMuZW1iZF9saW5rX2VkaXQgOiBbXSwKICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3NvdXJjZSwKICAgICAgICAgICAgICByZXNwb25zZTogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzcnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2ludGVudF9lZGl0ZWRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfSU5fRElBTE9HX0VESVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdpbnRlbnRfZWRpdGVkX2FsZXJ0X21zZzEnKSwKICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlNUQVRVU19GQUlMVVJFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2c5JyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJFcnJvciIpIHsKICAgICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgICAgLy8gICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIC8vICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2cxMCcpLAogICAgICAgICAgICAvLyAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgIC8vIH0gCiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTUdfRFVQTElDQVRFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ltZ19leGlzdF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2c1JyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOyAvLyB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsgLy8gdGhpcy5yZXNwb25zZSA9ICIiOwogICAgICAgICAgLy8gdGhpcy5zb3VyY2UgPSAiIjsKICAgICAgICAgIC8vIHRoaXMuaW50ZW50cyA9ICIiOwogICAgICAgICAgLy8gdGhpcy5maWxlX2xhYmVsMiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAvLyB0aGlzLmZpbGVfY29udGVudDIgPSAiIjsKICAgICAgICAgIC8vIHRoaXMudmlkZW9fbGluayA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwpIHsKICAgICAgICBpZiAodGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmIHRoaXMuZWRpdGFibGVfdmFsdWVzICE9ICIiKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGFza19pbnB1dF92YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0pOwogICAgICAgICAgICBpZiAodGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ID09ICIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWxsX3JlcXVpcmVkX3ZhbHVlc19tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy51cmwgPT0gIiIgfHwgdGhpcy5hcGlfbWV0aG9kID09IG51bGwgfHwgdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gbnVsbCB8fCB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5lZGl0YWJsZV92YWx1ZXMgPT0gIiIpIHsKICAgICAgICAgIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc2VsZWN0X21ldGhvZF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3NlbGVjdF9yZXF1ZXN0X2pzb25fYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FsbF9yZXF1aXJlZF92YWx1ZXNfbXNnMScpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXFfanNvbigpID09IGZhbHNlKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3JlcXVlc3RfanNvbl9pbnZhbGlkX21zZycpLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiAhdGhpcy5pc0VkaXQpIHsvLyB2YXIgY3N2ID0gdGhpcy5lZGl0YWJsZV92YWx1ZXMuc3BsaXQoIjsiKTsKICAgICAgICAgICAgLy8gdmFyIGlucHV0X3ZhbHVlOwogICAgICAgICAgICAvLyB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gY3N2KSB7CiAgICAgICAgICAgIC8vICAgbGV0IHRlbXBfbGlzdCA9IGNzdltpXS5zcGxpdCgiLCIpOwogICAgICAgICAgICAvLyAgIGlucHV0X3ZhbHVlID0gdGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgLy8gICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICAvLyAgICAga2V5X25hbWU6IGlucHV0X3ZhbHVlLAogICAgICAgICAgICAvLyAgICAgaW5wdXRfdGV4dDogIiIsCiAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgIC8vIGxldCBlbXB0eV92YXJzID0gW107CiAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAvLyAgIGlmICh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgLy8gICAgIGVtcHR5X3ZhcnMucHVzaCh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQpOwogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gICAvLyAgY29uc29sZS5sb2codGhpcy50YXNrX2lucHV0X3ZhbHVlcyk7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgLy8gaWYoZW1wdHlfdmFycy5sZW5ndGggIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmZpbmFsc3RlcCA9IHRydWU7IC8vIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSB2YWx1ZXMuIik7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmluYWxzdGVwID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmZpbmFsc3RlcCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgZXhpc3RpbmdfaW50ZW50X2xpc3QgPSB0aGlzLmFwaV9saXN0LmZpbHRlcihmdW5jdGlvbiAoYXBpKSB7CiAgICAgICAgICAgIHJldHVybiBhcGkuaW50ZW50ID09IF90aGlzOC5pbnRlbnRzOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgcG9zdF9tZXRob2RfZGF0YSwgZ2V0X21ldGhvZF9kYXRhOwogICAgICAgICAgcG9zdF9tZXRob2RfZGF0YSA9IHt9OwogICAgICAgICAgZ2V0X21ldGhvZF9kYXRhID0ge307IC8vIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gIlBPU1QiICYmIHRoaXMudGFza19mcm9tID09ICJmcm9tX2VudGl0eSIpIHsKCiAgICAgICAgICBpZiAodGhpcy5hcGlfbWV0aG9kID09ICJQT1NUIikgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICBwb3N0X21ldGhvZF9kYXRhW3RoaXMudGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gewogICAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCAhPSAiIiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVudGl0eTogdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50LAogICAgICAgICAgICAgICAgbm90X2ludGVudDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5hcGlfbWV0aG9kID09ICJHRVQiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgIGdldF9tZXRob2RfZGF0YVt0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmtleV9uYW1lXSA9IHsKICAgICAgICAgICAgICAgIEVudGl0eTogdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgU2xvdDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXhpc3RpbmdfaW50ZW50X2xpc3QubGVuZ3RoID4gMCAmJiAhdGhpcy5pc0VkaXQpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9hbHJlYWR5X2V4aXN0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5lbmR1c2VyX21zZ190eXBlID09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2VuZF9tc2dfdHlwZV9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDUwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJlc3BfanNvbigpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgncmVxdWVzdF9qc29uX2ludmFsaWRfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPT0gIiIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhbGxfcmVxdWlyZWRfdmFsdWVzX21zZzInKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID09ICJUcnVlIikgewogICAgICAgICAgICAgIGlmICh0aGlzLnJlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWxsX3JlcXVpcmVkX3ZhbHVlc19tc2czJyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5lbmRfdXNlcl9tZXNzYWdlID0gIiI7IC8vIGNvbnNvbGUubG9nKCJlbmRfdXNlciBtZXNzYWdlIG51bGwiLHRoaXMuZW5kX3VzZXJfbWVzc2FnZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgewogICAgICAgICAgICB0aGlzLnJlc3BvbnNlX2tleV90b19lbmR1c2VyID0gIiI7CiAgICAgICAgICAgIHRoaXMucmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9ICIiOyAvLyBjb25zb2xlLmxvZygicmVzcG9uc2Uga2V5IHRvIGVuZCB1c2VyIG51bGwiLHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnVuc3VjY2Vzc2Z1bF9tZXNzYWdlID09ICIiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhbGxfcmVxdWlyZWRfdmFsdWVzX21zZzQnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoKHRoaXMuZW5kX3VzZXJfbWVzc2FnZSAhPSAiIiB8fCB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIikgJiYgKHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSAhPSBudWxsIHx8IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgJiYgdGhpcy5lbmR1c2VyX21zZ190eXBlICE9IG51bGwgJiYgKHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgIT0gIiIgfHwgdGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSAmJiAodGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSAhPSAiIiB8fCB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uID09ICJTaWx2ZXIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3VwZ3JhZGVfcGxhbl9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgICAgdmFyIHRhc2tzID0ge307CgogICAgICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwIHx8IHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJGYWxzZSIpIHsKICAgICAgICAgICAgICAgIHZhciBfYXhpb3MkcG9zdDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBbXTsKICAgICAgICAgICAgICAgICAgdGVtcC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBUeXBlOiAiQXNrIiwKICAgICAgICAgICAgICAgICAgICBUZXh0OiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHRhc2tzW3RoaXMudGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gdGVtcDsKICAgICAgICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coInJlYWNoZWQgaGVyZSBmaW5hbGx5Iik7CgoKICAgICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCAoX2F4aW9zJHBvc3QgPSB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgICAgICAgICAgICBpc19lbmRwb2ludDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgICAgICAgICAgb2xkX3F1ZXN0aW9uX2xpc3Q6IHRoaXMub2xkX3F1ZXN0aW9uc19saXN0LAogICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucywKICAgICAgICAgICAgICAgICAgaW50ZW50X2Rlc2NyaXB0aW9uOiB0aGlzLnNlbGVjdGVkX2ludGVudF9kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLnVybCwKICAgICAgICAgICAgICAgICAgcmVxdWVzdGpzb246IHRoaXMuc2hvd19qc29uX3JlcXVlc3RfZGF0YSwKICAgICAgICAgICAgICAgICAgYXBpX21ldGhvZDogdGhpcy5hcGlfbWV0aG9kLAogICAgICAgICAgICAgICAgICBlbmRfdXNlcl9tZXNzYWdlOiB0aGlzLmVuZF91c2VyX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgIG1zZ190eXBlOiB0aGlzLmVuZHVzZXJfbXNnX3R5cGUsCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNla2V5OiB0aGlzLnJlc3BvbnNlX2tleV90b19lbmR1c2VyLAogICAgICAgICAgICAgICAgICBhcGlfZWRpdDogdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUsCiAgICAgICAgICAgICAgICAgIGFwaV9lZGl0YWJsZV92YWx1ZTogdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5lZGl0YWJsZV92YWx1ZXMgOiAiIiwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2Vqc29uOiB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIiA/IHRoaXMuc2hvd19qc29uX3Jlc3BvbnNlX2RhdGEgOiAiIiwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbXNnX2VkaXRhYmxlOiB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUsCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX21zZ19lZGl0YWJsZV92YWx1ZTogdGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID09ICJUcnVlIiA/IHRoaXMucmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA6ICIiLAogICAgICAgICAgICAgICAgICByZXF1ZXN0X2pzb25fa2V5X21hcHBpbmc6IGdldF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGE6IHBvc3RfbWV0aG9kX2RhdGEsCiAgICAgICAgICAgICAgICAgIHVuc3VjY2Vzc2Z1bF9tc2c6IHRoaXMudW5zdWNjZXNzZnVsX21lc3NhZ2UKICAgICAgICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgImxpY2Vuc2Vfa2V5IiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5KSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAiZW1haWwiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJ0b2tlbiIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJ0YXNrX2RldGFpbHMiLCB0YXNrcyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInN1YnNjcmlwdGlvbiIsICJQbGF0aW51bSIpLCBfYXhpb3MkcG9zdCksIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5BRERfQ09ORklHVVJJTkdfQVBJX1VSTF9TVUNDRVNTXzIwMDhfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdpbnRlbnRfYWRkZWRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLkFERF9DT05GSUdVUklOR19BUElfSlNPTl9TVUNDRVNTXzIwMDZfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2FkZGVkX3N1Y2Nlc3NfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgey8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfSU5fRElBTE9HX0VESVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdpbnRlbnRfZWRpdGVkX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsvLyB0aGlzLmxvYWRfaW50ZW50KHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdzb21lX2Vycm9yX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLkVORFBPSU5UX0xJTUlUX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ3VwZ3JhZGVfcGxhbl9hbGVydF9tc2cyJyksCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgey8vIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgfSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdzb21lX2Vycm9yX2FsZXJ0X21zZzInKSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IC8vIGVsc2UgaWYgKAogICAgICAgICAgICAgIC8vICAgICB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiRmFsc2UiICYmCiAgICAgICAgICAgICAgLy8gICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMubGVuZ3RoID4gMAogICAgICAgICAgICAgIC8vICAgKQoKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCB2YWx1ZXMiKTsKICAgICAgICAgICAgaWYgKHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9PSBudWxsICYmIHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiICYmIHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgIT0gIiIgJiYgdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSAhPSAiIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3NlbGVjdF9yZXNwb25zZV9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWxsX3JlcXVpcmVkX3ZhbHVlc19hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX2ludGVudDogZnVuY3Rpb24gc2F2ZV9pbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5hZGRfZWRpdCA9ICJ0cnVlIjsKCiAgICAgIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cykgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX25hbWVfYWxlcnRfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMubmV3X2ludGVudHMgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9hZGRfbmFtZV9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0Lmxlbmd0aDsgX2kzKyspIHsKICAgICAgICAgIGlmICh0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdFtfaTNdID09PSAiIiB8fCB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdFtfaTNdID09PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9xc19hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmFkZF9lZGl0ID09ICJ0cnVlIikgewogICAgICAgIGlmICh0aGlzLnZpZXdfcmVzcG9uc2VfbW9kYWwpIHsKICAgICAgICAgIGlmICh0aGlzLmltYWdlX3Jlc3BvbnNlID09ICJZZXMiICYmIHRoaXMuZmlsZV9jb250ZW50MiA9PSAiIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfaW1nX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsgLy8gIGNvbnNvbGUubG9nKCJjc2Rjc2RmZ2UgaW1hZ2UiKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy52aWRlb19yZXNwb25zZSA9PSAiWWVzIiAmJiB0aGlzLmVtYmRfbGluayA9PSAiIikgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlVwbG9hZCBhIFZpZGVvIGxpbmsiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3ZpZGVvX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsgLy8gIGNvbnNvbGUubG9nKCJjc2Rjc2RmZ2UgdmlkZW8iKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCB0aGlzLm11bHRpcGxlX3Jlc3BvbnNlLmxlbmd0aDsgX2k0KyspIHsKICAgICAgICAgICAgaWYgKHRoaXMubXVsdGlwbGVfcmVzcG9uc2VbX2k0XSA9PSAiIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3Jlc3BvbnNlX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsMiA9PSAiQ2hvb3NlIGZpbGUiKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCIpOwogICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICAgIC8vICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9zdWJtaXRfZGV0YWlsc19tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICAgICAgICBpc19yZXNwb25zZTogdHJ1ZSwKICAgICAgICAgICAgICAvLyBpbnRlbnQ6IHRoaXMuY29tcGFueWlkICsgIl8iICsgdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LAogICAgICAgICAgICAgIHJlc3BvbnNlOiB7CiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgICB2aWRlb19saW5rOiB0aGlzLnZpZGVvX3Jlc3BvbnNlID09ICJZZXMiID8gdGhpcy5lbWJkX2xpbmsgOiBbXSwKICAgICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zb3VyY2UsCiAgICAgICAgICAgICAgICByZXNwb25zZTogdGhpcy5tdWx0aXBsZV9yZXNwb25zZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkFEREVEX1NVQ0NFU1NGVUxMWV8wMDAyX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfYWRkX3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVybmFsX3NlcnZlcl9tc2cxJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVybmFsX3NlcnZlcl9tc2czJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImFwaSBjYWxsIHdpdGggaW1hZ2UgIik7CiAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgLy8gJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3N1Ym1pdF9kZXRhaWxzX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgICAgICAgIGlzX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsMiwKICAgICAgICAgICAgICAgIGZpbGVfZGF0YTogdGhpcy5maWxlX2NvbnRlbnQyLAogICAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy52aWRlb19yZXNwb25zZSA9PSAiWWVzIiA/IHRoaXMuZW1iZF9saW5rIDogW10sCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMubXVsdGlwbGVfcmVzcG9uc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5BRERFRF9TVUNDRVNTRlVMTFlfMDAwMl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2FkZGVkX3N1Y2Nlc3NfbXNnMicpLAogICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczkudGx0KCdpbnRlbnRfcGFnZV9pbnRlcm5hbF9zZXJ2ZXJfbWFnMScpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU1HX0RVUExJQ0FURS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ltYWdlX2V4aXN0X2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVybmFsX3NlcnZlcl9tYWczJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIXRoaXMudmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmIHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAvLyAgY29uc29sZS5sb2codGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cykgewogICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIkFuIEludGVudCB3aXRoIHRoaXMgbmFtZSBhbHJlYWR5IGV4aXN0cy4iKTsKICAgICAgICAgIC8vIH0KCgogICAgICAgICAgaWYgKHRoaXMuc2F2ZV91cmwgPT0gIiIgfHwgdGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gbnVsbCB8fCB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09IG51bGwgfHwgdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyA9PSAiIikgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIpOwogICAgICAgICAgICBpZiAodGhpcy5zYXZlX2FwaV9tZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3NlbGVjdF9tZXRob2RfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3JlcXVlc3RfanNvbl9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2cxJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2F2ZV9yZXFfanNvbigpID09IGZhbHNlKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9yZXF1ZXN0X2pzb25fbXNnMScpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiAhdGhpcy5pc0VkaXQpIHsvLyB2YXIgY3N2ID0gdGhpcy5lZGl0YWJsZV92YWx1ZXMuc3BsaXQoIjsiKTsKICAgICAgICAgICAgICAvLyB2YXIgaW5wdXRfdmFsdWU7CiAgICAgICAgICAgICAgLy8gdGhpcy50YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwogICAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gY3N2KSB7CiAgICAgICAgICAgICAgLy8gICBsZXQgdGVtcF9saXN0ID0gY3N2W2ldLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgLy8gICBpbnB1dF92YWx1ZSA9IHRlbXBfbGlzdFt0ZW1wX2xpc3QubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgLy8gICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICAgIC8vICAgICBrZXlfbmFtZTogaW5wdXRfdmFsdWUsCiAgICAgICAgICAgICAgLy8gICAgIGlucHV0X3RleHQ6ICIiLAogICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIpIHsKICAgICAgICAgICAgICAvLyBsZXQgZW1wdHlfdmFycyA9IFtdOwogICAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgIC8vICAgaWYgKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgICAgIC8vICAgICBlbXB0eV92YXJzLnB1c2godGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXSk7CiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gICAvLyAgY29uc29sZS5sb2codGhpcy50YXNrX2lucHV0X3ZhbHVlcyk7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIC8vIGlmIChlbXB0eV92YXJzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5maW5hbHN0ZXAgPSB0cnVlOyAvLyB9IGVsc2UgewogICAgICAgICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSB2YWx1ZXMuIik7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZmluYWxzdGVwID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmZpbmFsc3RlcCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBleGlzdGluZ19pbnRlbnRfbGlzdCA9IHRoaXMuYXBpX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChhcGkpIHsKICAgICAgICAgICAgICByZXR1cm4gYXBpLmludGVudCA9PSBfdGhpczkuaW50ZW50czsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBwb3N0X21ldGhvZF9kYXRhLCBnZXRfbWV0aG9kX2RhdGE7CiAgICAgICAgICAgIHBvc3RfbWV0aG9kX2RhdGEgPSB7fTsKICAgICAgICAgICAgZ2V0X21ldGhvZF9kYXRhID0ge307IC8vIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gIlBPU1QiICYmIHRoaXMudGFza19mcm9tID09ICJmcm9tX2VudGl0eSIpIHsKCiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfYXBpX21ldGhvZCA9PSAiUE9TVCIpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgICAgcG9zdF9tZXRob2RfZGF0YVt0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gewogICAgICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgICAgIGZyb21fZW50aXR5OiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCAhPSAiIiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZW50aXR5OiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCwKICAgICAgICAgICAgICAgICAgLy8gaW50ZW50OiB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICAgICAgbm90X2ludGVudDogbnVsbAogICAgICAgICAgICAgICAgfTsgLy8gIGNvbnNvbGUubG9nKCJwb3N0IG1ldGhvZCIscG9zdF9tZXRob2RfZGF0YSk7CiAgICAgICAgICAgICAgfSAvLyAgY29uc29sZS5sb2coInBvc3QgbWV0aG9kIixwb3N0X21ldGhvZF9kYXRhKTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfYXBpX21ldGhvZCA9PSAiR0VUIikgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgICAgICBnZXRfbWV0aG9kX2RhdGFbdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmtleV9uYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgRW50aXR5OiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCwKICAgICAgICAgICAgICAgICAgU2xvdDogbnVsbAogICAgICAgICAgICAgICAgfTsgLy8gIGNvbnNvbGUubG9nKCJnZXQgbWV0aG9kIixnZXRfbWV0aG9kX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGV4aXN0aW5nX2ludGVudF9saXN0Lmxlbmd0aCA+IDAgJiYgIXRoaXMuaXNFZGl0KSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfbmFtZV9leGlzdF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfbXNnX3R5cGVfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKCh0aGlzLnNhdmVfZW5kX3VzZXJfbWVzc2FnZSAhPSAiIiB8fCB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiKSAmJiAodGhpcy5zYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGUgIT0gbnVsbCB8fCB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgJiYgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgIT0gbnVsbCAmJiAodGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyICE9ICIiIHx8IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSAmJiAodGhpcy5zYXZlX2pzb25fcmVzcG9uc2VfZGF0YSAhPSAiIiB8fCB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwX2pzb24oKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfcmVxdWVzdF9qc29uX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX2FsbF92YWx1ZXNfYWxlcnRfbXNnMScpLAogICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2cyJyksCiAgICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9lbmRfdXNlcl9tZXNzYWdlID0gIiI7IC8vIGNvbnNvbGUubG9nKCJlbmRfdXNlciBtZXNzYWdlIG51bGwiLHRoaXMuc2F2ZV9lbmRfdXNlcl9tZXNzYWdlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9ICIiOyAvLyBjb25zb2xlLmxvZygicmVzcG9uc2Uga2V5IHRvIGVuZCB1c2VyIG51bGwiLHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlcik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Vuc3VjY2Vzc2Z1bF9tZXNzYWdlID09ICIiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX2FsbF92YWx1ZXNfYWxlcnRfbXNnMycpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uID09ICJTaWx2ZXIiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3VwZ3JhZGVfcGxhbl9tc2cnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM5LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciB0YXNrcyA9IHt9OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMubGVuZ3RoID4gMCB8fCB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJGYWxzZSIpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9heGlvcyRwb3N0MjsKCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBbXTsKICAgICAgICAgICAgICAgICAgICB0ZW1wLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgICAgICAgICAgICBUZXh0OiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRhc2tzW3RoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB0ZW1wOwogICAgICAgICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCJyZWFjaGVkIGhlcmUgZmluYWxseSIpOwogICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm5ld19pbnRlbnRzKTsKCgogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc3VibWl0X2RldGFpbHNfbXNnMScpLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCAoX2F4aW9zJHBvc3QyID0gewogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBpc19lbmRwb2ludDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAvLyBpbnRlbnQ6IHRoaXMuY29tcGFueWlkICsgIl8iICsgdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNhdmVfdXJsLAogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Rqc29uOiB0aGlzLnNhdmVfanNvbl9yZXF1ZXN0X2RhdGEsCiAgICAgICAgICAgICAgICAgICAgYXBpX21ldGhvZDogdGhpcy5zYXZlX2FwaV9tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgZW5kX3VzZXJfbWVzc2FnZTogdGhpcy5zYXZlX2VuZF91c2VyX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgbXNnX3R5cGU6IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlLAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNla2V5OiB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIsCiAgICAgICAgICAgICAgICAgICAgYXBpX2VkaXQ6IHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUsCiAgICAgICAgICAgICAgICAgICAgYXBpX2VkaXRhYmxlX3ZhbHVlOiB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiA/IHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgOiAiIiwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZWpzb246IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIgPyB0aGlzLnNhdmVfanNvbl9yZXNwb25zZV9kYXRhIDogIiIsCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbXNnX2VkaXRhYmxlOiB0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZV9tc2dfZWRpdGFibGVfdmFsdWU6IHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlID09ICJUcnVlIiA/IHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlIDogIiIsCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdF9qc29uX2tleV9tYXBwaW5nOiBnZXRfbWV0aG9kX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGE6IHBvc3RfbWV0aG9kX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgdW5zdWNjZXNzZnVsX21zZzogdGhpcy5zYXZlX3Vuc3VjY2Vzc2Z1bF9tZXNzYWdlCiAgICAgICAgICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJsaWNlbnNlX2tleSIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJlbWFpbCIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJ0b2tlbiIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAidGFza19kZXRhaWxzIiwgdGFza3MpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAic3Vic2NyaXB0aW9uIiwgIlBsYXRpbnVtIiksIF9heGlvcyRwb3N0MiksIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5BRERfQ09ORklHVVJJTkdfQVBJX1VSTF9TVUNDRVNTXzIwMDguTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVudF9hZGRlZF9tc2cnKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5BRERfQ09ORklHVVJJTkdfQVBJX1BPU1RfTUVUSE9EX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfcG9zdF9yZXF1ZXN0X21zZycpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkFERF9DT05GSUdVUklOR19BUElfSlNPTl9TVUNDRVNTXzIwMDZfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczkudGx0KCdpbnRlbnRfcGFnZV9pbnRlbnRfYWRkZWRfbXNnMScpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczkudGx0KCdpbnRlbnRfcGFnZV9pbnRlcm5hbF9zZXJ2ZXJfbWFnNCcpLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkVORFBPSU5UX0xJTUlUX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX3VwZ3JhZGVfcGxhbl9tc2cxJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIGVsc2UgaWYgKAogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIkZhbHNlIiAmJgogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwCiAgICAgICAgICAgICAgICAvLyAgICkKCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9PSBudWxsICYmIHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIgJiYgdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyICE9ICIiICYmIHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEgIT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfcmVzcG9uc2VfanNvbl9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2c0JyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIGlmICh0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgICAgdGhpcy52ZXJpZnlfY2hhbmdlcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlYXJjaF9pbnRlbnQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfaW50ZW50OiBmdW5jdGlvbiBzZWFyY2hfaW50ZW50KGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMubmV3X2ludGVudF9saXN0ID0gW107CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEwLnRsdCgnaW50ZW50X3BhZ2Vfbm9fcmVzdWx0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUgJiYgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMTAuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICBfdGhpczEwLnBhZ2Vfbm8gPSAxOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczEwLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgX3RoaXMxMC50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIF90aGlzMTAuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5SZXNwb25zZUxpc3Q7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMxMC5pbnRlbnRsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMxMC5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEwLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxMC5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zaG93X2ludGVudHMoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMC5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczEwLnNldHBhZ2luYXRpb24oX3RoaXMxMC5wYWdlX25vKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEwLnRsdCgnaW50ZW50X3BhZ2VfaW50ZXJuYWxfc2VydmVyX21zZzUnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczEwLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczEwLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczEwLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3NlYXJjaF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfc2VsZWN0ZWQ6IGZ1bmN0aW9uIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfbm9faW50ZW50X21zZycpLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXSk7CiAgICAgICAgfSAvLyBjb25zb2xlLmxvZyh0aGlzLm5ld19pbnRlbnRfbGlzdCk7CgoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9zd2FsX2FsZXJ0X21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3JldmVydF9hbGVydF9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3N3YWxfYWxlcnRfZGVsZXRlX21zZycpCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgICBpbnRlbnRfbGlzdDogX3RoaXMxMS5uZXdfaW50ZW50X2xpc3QsCiAgICAgICAgICAgICAgaXNfZGVsZXRlOiB0cnVlLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxMS5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczExLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTEuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczExLm5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICAgICAgICAgIF90aGlzMTEuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuSU5URU5UU19ERUxFVEVEX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3BhZ2Vfc3dhbF9hbGVydF9kZWxldGVfbXNnMScpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7Ly8gaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgIH0pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXMxMS5pbnRlbnRsaXN0Lmxlbmd0aCAmJiBfdGhpczExLnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEucGFnZV9ubyA9IF90aGlzMTEucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX1VTRURfSU5fRElBTE9HX0RFTEVURURfU1VDQ0VTU0ZVTExZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ2ludGVudF9wYWdlX3N3YWxfYWxlcnRfZGVsZXRlX21zZzInKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDgwMDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzMTEuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXMxMS5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczExLnBhZ2Vfbm8gPSBfdGhpczExLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLk5PVEhJTkdfVE9fREVMRVRFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ2ludGVudF9wYWdlX2FueV9pbnRlbnRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9ERUxFVEVEX1RSQUlOX01PREVMX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ2ludGVudF9wYWdlX3RyYWluZWRfaW10ZW50X21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfdGhpczExLm5ld19pbnRlbnRfbGlzdCA9IFtdOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzMTEuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXMxMS5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczExLnBhZ2Vfbm8gPSBfdGhpczExLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLlRSQUlORURfSU5URU5UX0FORF9JTlRFTlRfVVNFRF9JTl9ESUFMT0dfREVMRVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3BhZ2VfdHJhaW5lZF9pbnRlbnRfbXNnMScpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX3RoaXMxMS5uZXdfaW50ZW50X2xpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczExLmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzMTEucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5wYWdlX25vID0gX3RoaXMxMS5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxMS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgICAgIF90aGlzMTEubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczExLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIHRoaXMubmV3X2ludGVudF9saXN0ID0gW107CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczEyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczEyLmludGVudGxpc3QgPSBbXTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhWzBdKSB7CiAgICAgICAgICAgICAgLy8gICB0aGlzLmludGVudGxpc3QucHVzaCh7CiAgICAgICAgICAgICAgLy8gICAgIGludGVudDogcmVzcG9uc2UuZGF0YVswXVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIiksCiAgICAgICAgICAgICAgLy8gICAgIGVtYWlsOiByZXNwb25zZS5kYXRhWzFdW2ldLAogICAgICAgICAgICAgIC8vICAgICBjcmVhdGVkOiByZXNwb25zZS5kYXRhWzJdW2ldLAogICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsgLy8gZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAvLyAgIHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQgPSB0aGlzLmludGVudGxpc3RbaV0uSW50ZW50LnJlcGxhY2UoCiAgICAgICAgICAgICAgLy8gICAgIGAke3RoaXMuY29tcGFueWlkfV9gLAogICAgICAgICAgICAgIC8vICAgICAiIgogICAgICAgICAgICAgIC8vICAgKTsKICAgICAgICAgICAgICAvLyB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEyLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxMi5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczEyLnNldHBhZ2luYXRpb24oX3RoaXMxMi5wYWdlX25vKTsgLy8gY29uc29sZS5sb2coInBhZ2UgcmVxdWlyZSBpcyBoZXJlIik7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGlmKHRoaXMuc2VhcmNoX2J5PT0nRW1haWwgQWRkcmVzcycpewogICAgICAgICAgLy8gICB0aGlzLnNlYXJjaGJ5PSdDcmVhdGVkQnknOwogICAgICAgICAgLy8gfQogICAgICAgICAgLy8gZWxzZXsKICAgICAgICAgIC8vICAgdGhpcy5zZWFyY2hieT10aGlzLnNlYXJjaF9ieTsKICAgICAgICAgIC8vIH0KICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgcGFnZSA9IE1hdGguY2VpbCgoMSArIHBhZ2UpIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHBhZ2UgPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyBwYWdlKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEyLnRsdCgnaW50ZW50X3BhZ2Vfbm9fcmVzdWx0X2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczEyLmludGVudGxpc3QgPSBbXTsKICAgICAgICAgICAgICBfdGhpczEyLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgX3RoaXMxMi50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5SZXNwb25zZUxpc3Q7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMxMi5pbnRlbnRsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBfdGhpczEyLmludGVudGxpc3RbaV0uSW50ZW50ID0gX3RoaXMxMi5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEyLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxMi5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfdGhpczEyLnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTIuc2V0cGFnaW5hdGlvbihfdGhpczEyLnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczEyLnRsdCgnaW50ZW50X3BhZ2VfaW50ZXJuYWxfc2VydmVyX21zZzgnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMTIubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMi5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczEyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2V0cGFnaW5hdGlvbjogZnVuY3Rpb24gc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7CiAgICAgIHRoaXMucGFnZV9hcnJheSA9IFtdOwoKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAodmFyIF9pNSA9IDA7IF9pNSA8IDQ7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k2ID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IF9pNiA8IHRoaXMudG90YWxfcGFnZXM7IF9pNisrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTYgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yICh2YXIgX2k3ID0gMDsgX2k3IDwgcGFnZV9ubyArIDM7IF9pNysrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTcgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pOCA9IHBhZ2Vfbm8gLSA0OyBfaTggPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTgrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k4ICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pOSA9IHBhZ2Vfbm8gLSAzOyBfaTkgPD0gcGFnZV9ubyArIDM7IF9pOSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTkpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3M6IGZ1bmN0aW9uIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfaW50ZW50czogZnVuY3Rpb24gc2VsZWN0ZWRfaW50ZW50cyhJbnRlbnQpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgaWYgKEludGVudCA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmludGVudGxpc3Q7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7IC8vIGNvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0KTsKCiAgICAgICAgICB0ZW1wID0gW107IC8vIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5tYXAoKGFycikgPT4gYXJyLkludGVudCk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCkKCiAgICAgICAgICB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiAhX3RoaXMxMy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKGl0ZW0uSW50ZW50KTsKICAgICAgICAgIH0pOyAvLyBjb25zb2xlLmxvZyh0aGlzLmNoZWNrZWRfbGlzdC5tYXAoKGFycikgPT4gYXJyLkludGVudCkuZmlsdGVyKChpdGVtKSA9PiAhKHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyhpdGVtLkludGVudCkpKSkKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0Lm1hcCgoYXJyKSA9PiBhcnIuSW50ZW50KSkKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRlbXApOwoKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSW50ZW50OwogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjaW50ZW50X2NoZWNrYm94XyIgKyB0aGlzLmNoZWNrZWRfbGlzdFtpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHZhbF9pbmRleCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoaW50ZW50cykgewogICAgICAgICAgICByZXR1cm4gaW50ZW50cy5JbnRlbnQgPT0gSW50ZW50OwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHZhbF9pbmRleC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKEludGVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoaW50ZW50cykgewogICAgICAgICAgICByZXR1cm4gaW50ZW50cyAhPSBJbnRlbnQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IF90ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZF90b19yZXNwb25zZV9saXN0OiBmdW5jdGlvbiBhZGRfdG9fcmVzcG9uc2VfbGlzdCh0eXBlLCBpbmRleCkgewogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZS5sZW5ndGgpOwogICAgICBpZiAodHlwZSA9PSAiYWRkIiAmJiAodGhpcy5tdWx0aXBsZV9yZXNwb25zZS5sZW5ndGggPT0gMTAgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UubGVuZ3RoID09IDEwKSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3Rlbl9yZXNwb25zZXNfYWRkZWRfYWxlcnRfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgICB0aGlzLm11bHRpcGxlX3Jlc3BvbnNlLnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5tdWx0aXBsZV9yZXNwb25zZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZF90b19xdWVzdGlvbnNfbGlzdDogZnVuY3Rpb24gYWRkX3RvX3F1ZXN0aW9uc19saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2hhbmdlX3Jlc3BvbnNlX3R5cGU6IGZ1bmN0aW9uIGNoYW5nZV9yZXNwb25zZV90eXBlKCkgewogICAgICBpZiAodGhpcy5kZWZpbmVfYXBpX2VuZHBvaW50cyA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5kZWZpbmVfYXBpX2VuZHBvaW50cyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0OiBmdW5jdGlvbiBmaWxlaW5wdXQoKSB7CiAgICAgIHRoaXMuZmlsZV9sYWJlbCA9IGV2ZW50LnRhcmdldC5maWxlc1swXS5uYW1lOwogICAgICB2YXIgZmlsZV9uYW1lID0gdGhpcy5jb21wYW55bmFtZSArICJJbnRlbnRGaWxlLmNzdiI7CgogICAgICBpZiAodGhpcy5maWxlX2xhYmVsICE9IGZpbGVfbmFtZSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfZG93bmxvYWRfaW50ZW50X2ZpbGVzX21zZycpLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsZV9jb250ZW50ID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0MjogZnVuY3Rpb24gZmlsZWlucHV0MihldmVudCkgewogICAgICB2YXIgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIHRoaXMuZmlsZV9sYWJlbDIgPSBldmVudC50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgdGhpcy5maWxlX3R5cGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF0udHlwZTsgLy8gY29uc29sZS5sb2coZmlsZXMpCiAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldC5maWxlc1swXSkKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwyICE9IHRoaXMudGVtcF9maWxlX25hbWUpIHsKICAgICAgICB0aGlzLmltYWdlX2VkaXQgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGhpcy5maWxlX3R5cGUgPT0gImltYWdlL3BuZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzLCB0aGlzLmZpbGVfdHlwZSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5maWxlX3R5cGUgPT0gImltYWdlL2pwZWciKSB7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZShmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfdXBsb2FkX2ZpbGVzX21zZycpLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUltYWdlOiBmdW5jdGlvbiBjcmVhdGVJbWFnZShmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNC5maWxlX2NvbnRlbnQyID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBmaWxlaW5wdXQzOiBmdW5jdGlvbiBmaWxlaW5wdXQzKGV2ZW50KSB7CiAgICAgIHZhciBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgdGhpcy5maWxlX2xhYmVsMyA9IGV2ZW50LnRhcmdldC5maWxlc1swXS5uYW1lOwogICAgICB0aGlzLmZpbGVfdHlwZTMgPSBldmVudC50YXJnZXQuZmlsZXNbMF0udHlwZTsgLy8gY29uc29sZS5sb2coZmlsZXMpCiAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldC5maWxlc1swXSkKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwzICE9IHRoaXMudGVtcF9maWxlX25hbWUpIHsKICAgICAgICB0aGlzLmltYWdlX2VkaXQgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGhpcy5maWxlX3R5cGUzID09ICJpbWFnZS9wbmciKSB7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZTMoZmlsZXMsIHRoaXMuZmlsZV90eXBlKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVfdHlwZTMgPT0gImltYWdlL2pwZWciKSB7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZTMoZmlsZXMsIHRoaXMuZmlsZV90eXBlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3VwbG9hZF9maWxlc19tc2cxJyksCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2UzOiBmdW5jdGlvbiBjcmVhdGVJbWFnZTMoZmlsZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTUuZmlsZV9jb250ZW50MyA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwoKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgZW1iZWRkZWRfY2hhbmdlOiBmdW5jdGlvbiBlbWJlZGRlZF9jaGFuZ2UoKSB7CiAgICAgIHZhciByZWdFeHAgPSAvXi4qKHlvdXR1LmJlXC98dlwvfHVcL1x3XC98ZW1iZWRcL3x3YXRjaFw/dj18XCZ2PSkoW14jXCZcP10qKS4qLzsKICAgICAgdmFyIG1hdGNoID0gdGhpcy52aWRlb19saW5rLm1hdGNoKHJlZ0V4cCk7CgogICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMl0ubGVuZ3RoID09IDExKSB7Ly8gY29uc29sZS5sb2cobWF0Y2hbMl0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiZXJyb3IiOwogICAgICB9CgogICAgICB0aGlzLmVtYmRfbGluayA9ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8iICsgbWF0Y2hbMl07IC8vIGNvbnNvbGUubG9nKHRoaXMuZW1iZF9saW5rKTsKICAgIH0sCiAgICBlbWJlZGRlZF9jaGFuZ2VfZWRpdDogZnVuY3Rpb24gZW1iZWRkZWRfY2hhbmdlX2VkaXQoKSB7CiAgICAgIHZhciByZWdFeHAgPSAvXi4qKHlvdXR1LmJlXC98dlwvfHVcL1x3XC98ZW1iZWRcL3x3YXRjaFw/dj18XCZ2PSkoW14jXCZcP10qKS4qLzsKICAgICAgdmFyIG1hdGNoID0gdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfdmlkZW8ubWF0Y2gocmVnRXhwKTsKCiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsyXS5sZW5ndGggPT0gMTEpIHsvLyBjb25zb2xlLmxvZyhtYXRjaFsyXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJlcnJvciI7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1iZF9saW5rX2VkaXQgPSAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvIiArIG1hdGNoWzJdOyAvLyBjb25zb2xlLmxvZyh0aGlzLmVtYmRfbGluayk7CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGU6IGZ1bmN0aW9uIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAvLyB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgIHRoaXMubXVsdGlwbGVfcmVzcG9uc2UgPSBbIiJdOyAvLyB0aGlzLmVkaXRfcmVzcG9uc2UgPSAiIjsKICAgICAgLy8gdGhpcy4kZW1pdCgKICAgICAgLy8gICAiaW5wdXQiLAogICAgICAvLyAgICAiIgogICAgICAvLyApOwoKICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsKICAgICAgdGhpcy5zYXZlX3VybCA9ICIiOwogICAgICB0aGlzLnNhdmVfYXBpX21ldGhvZCA9IG51bGw7CiAgICAgIHRoaXMuc2F2ZV9qc29uX3JlcXVlc3RfZGF0YSA9ICIiOwogICAgICB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID0gbnVsbDsKICAgICAgdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyA9ICIiOwogICAgICB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMgPSBbXTsKICAgICAgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPSAiQ3VzdG9tIjsKICAgICAgdGhpcy5zYXZlX2pzb25fcmVzcG9uc2VfZGF0YSA9ICIiOwogICAgICB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPSAiIjsKICAgICAgdGhpcy5zYXZlX2VuZF91c2VyX21lc3NhZ2UgPSAiIjsKICAgICAgdGhpcy5zYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGUgPSBudWxsOwogICAgICB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9ICIiOwogICAgICB0aGlzLnNhdmVfdW5zdWNjZXNzZnVsX21lc3NhZ2UgPSAiIjsKICAgICAgdGhpcy5zb3VyY2UgPSAiV2ViIjsKICAgICAgdGhpcy5pbnRlbnRzID0gdGhpcy5pbnRlbnRsaXN0WzBdOwogICAgICB0aGlzLm5ld19pbnRlbnRzID0gIiI7CiAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0ID0gWyIiXTsKICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgdGhpcy5pbWFnZV91cmwgPSAiIjsKICAgICAgdGhpcy5pbWFnZV9yZXNwb25zZSA9ICJObyI7CiAgICAgIHRoaXMudmlkZW9fcmVzcG9uc2UgPSAiTm8iOwogICAgICB0aGlzLnZpZGVvX2xpbmsgPSAiIiwgdGhpcy5lbWJkX2xpbmsgPSAiIjsKICAgICAgdGhpcy5maWxlX2xhYmVsMiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIHRoaXMuZmlsZV9sYWJlbDMgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB0aGlzLmZpbGVfY29udGVudCA9ICIiOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZUFkZG9uMDEiKS52YWx1ZSA9ICIiOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGVBZGRvbjAyIikudmFsdWUgPSAiIjsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhZGlvQnRubiIpLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgdGhpcy51bmNoZWNrKCk7CiAgICAgIHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgIHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsgLy8gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9oaWdobGlnaHQgPSIiOwogICAgfSwKICAgIGpzb25fcmVxdWVzdF9jbGFzczogZnVuY3Rpb24ganNvbl9yZXF1ZXN0X2NsYXNzKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5qc29uX3JlcXVlc3RfZGF0YVt0aGlzLmluZGV4XSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gImlzLWludmFsaWQiOwogICAgICB9CgogICAgICByZXR1cm4gImlzLXZhbGlkIjsKICAgIH0sCiAgICBqc29uX3Jlc3BvbnNlX2NsYXNzOiBmdW5jdGlvbiBqc29uX3Jlc3BvbnNlX2NsYXNzKCkgewogICAgICB0cnkgewogICAgICAgIEpTT04ucGFyc2UodGhpcy5qc29uX3Jlc3BvbnNlX2RhdGFbdGhpcy5pbmRleF0pOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuICJpcy1pbnZhbGlkIjsKICAgICAgfQoKICAgICAgcmV0dXJuICJpcy12YWxpZCI7CiAgICB9LAogICAgZWRpdF9pbnRlbnRfZGV0YWlsczogZnVuY3Rpb24gZWRpdF9pbnRlbnRfZGV0YWlscygpIHsKICAgICAgLy8gaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfaW50ZW50cy5pbmNsdWRlcyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSkgewogICAgICAvLyAgIFN3YWwoewogICAgICAvLyAgICAgdGl0bGU6ICJPb3BzIiwKICAgICAgLy8gICAgIHRleHQ6ICJUaGlzIGlzIGEgRGVmYXVsdCBJbnRlbnQhIEl0IGNhbm5vdCBiZSBlZGl0ZWQiLAogICAgICAvLyAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAvLyAgICAgdGltZXI6IDIwMDAsCiAgICAgIC8vICAgfSk7CiAgICAgIC8vICAgcmV0dXJuIGZhbHNlOwogICAgICAvLyB9CiAgICAgIGlmICghdGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICB0aGlzLmlzRWRpdEludGVudCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSBmYWxzZTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9LAogICAgc2hvd19ibG9jazogZnVuY3Rpb24gc2hvd19ibG9jayh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT0gInVwIikgewogICAgICAgIHRoaXMuc2hvd19vcl9ibG9jayA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09ICJkb3duIikgewogICAgICAgIHRoaXMuc2hvd19vcl9ibG9jayA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlX3N1Ym1pdDogZnVuY3Rpb24gZmlsZV9zdWJtaXQoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAoJCgiI2lucHV0R3JvdXBGaWxlY3N2IikudmFsKCkgPT0gJycpIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfaW5wdXRfZmllbGRfbXNnJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3VwbG9hZF9jc3ZfZmlsZXNfbXNnJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgdXNlcl9kZXRhaWxzID0gewogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgaXNfZm9ybV9pbnRlbnRzOiBmYWxzZQogICAgICB9OwogICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHVzZXJfZGV0YWlscyk7CiAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7CiAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iCiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbF9jc3YgPT0gIkNob29zZSBmaWxlIikge30gZWxzZSB7CiAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZmQuYXBwZW5kKCJmaWxlIiwgdGhpcy5maWxlX2NvbnRlbnRfY3N2LCB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2Iik7CiAgICAgICAgZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudXBsb2FkX2ZpbGVfdXJsKCksIGZkLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczE2LmFwaV9zdGF0dXNfY29kZS5GSUxFX1VQTE9BRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzMTYudGx0KCdpbnRlbnRfdXBsb2FkX2ZpbGVzX3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLklOQ09SUkVDVF9GSUxFX0ZPUk1BVF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgICAgLy8gICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X2luY29ycmVjdF9maWxlX2FsZXJ0X21zZycpLAogICAgICAgICAgICAvLyAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAvLyAgICAgdGV4dDoKICAgICAgICAgICAgLy8gdGx0KCdzYW1wbGVfaW50ZW50X2ZpbGVfbXNnJyksCiAgICAgICAgICAgIC8vICAgICAvLyB0aW1lcjogNDAwMCwKICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczE2LmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0ZJTEVfVFlQRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzMTYudGx0KCdpbnRlbnRfZmlsZV90eXBlX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczE2LnRsdCgnaW50ZW50X2Rvd25sb2FkX2ZpbGVzX21zZycpIC8vIHRpbWVyOiA0MDAwLAoKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczE2LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTYuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlY3N2IikudmFsdWUgPSAiIjsKCiAgICAgICAgICBfdGhpczE2LmxvYWRfaW50ZW50KCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczE2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlX2ZpbGU6IGZ1bmN0aW9uIGRvd25sb2FkX3NhbXBsZV9maWxlKCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0aGlzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5maWxlX2Rvd25sb2FkKCksCiAgICAgICAgcmVzcG9uc2VUeXBlOiAiYmxvYiIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgc2FtcGxlX2ZpbGU6ICJpbnRlbnQiLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIF90aGlzMTcuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJOb3QgYWJsZSB0byBkb3dubG9hZCBmaWxlIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiBfdGhpczE3LnRsdCgnaW50ZW50X3NvbWVfZXJyb3Jfb2NjdXJfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7IC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCgogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgX3RoaXMxNy5jb21wYW55bmFtZSArICJJbnRlbnRGaWxlLmNzdiIpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICBfdGhpczE3LnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6IF90aGlzMTcudGx0KCdpbnRlbnRfc29tZV9lcnJvcl9vY2N1cl9tc2cxJyksCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE3LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZmlsZWlucHV0X2NzdjogZnVuY3Rpb24gZmlsZWlucHV0X2NzdigpIHsKICAgICAgdGhpcy5maWxlX2xhYmVsX2NzdiA9IGV2ZW50LnRhcmdldC5maWxlc1swXS5uYW1lOyAvLyB2YXIgZmlsZV9uYW1lID0gdGhpcy5jb21wYW55bmFtZSArICJJbnRlbnRGaWxlLmNzdiI7CgogICAgICB0aGlzLmZpbGVfY29udGVudF9jc3YgPSBldmVudC50YXJnZXQuZmlsZXNbMF07IC8vIGlmICh0aGlzLmZpbGVfbGFiZWxfY3N2ICE9IGZpbGVfbmFtZSkgewogICAgICAvLyAgIFN3YWwoewogICAgICAvLyAgICAgdHlwZTogImluZm8iLAogICAgICAvLyAgICAgdGV4dDoKICAgICAgLy8gICAgICAgIlVzZXJzIG5lZWQgdG8gZG93bmxvYWQgdGhlIFNhbXBsZSBJbnRlbnQgQ1NWIEZpbGUgZnJvbSAnVXBsb2FkIENTViBGaWxlJyBtb2RlbC4gQ2hhbmdlcyB0byB0aGlzIGZpbGUgd2lsbCBiZSBhY2NlcHRlZCBieSB0aGUgc3lzdGVtLiIsCiAgICAgIC8vICAgICB0aW1lcjogMTAwMDAsCiAgICAgIC8vICAgfSk7CiAgICAgIC8vICAgdGhpcy5maWxlX2xhYmVsX2NzdiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIC8vICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlY3N2IikudmFsdWUgPSAiIjsKICAgICAgLy8gfSBlbHNlIHsKICAgICAgLy8gICB0aGlzLmZpbGVfY29udGVudF9jc3YgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIC8vIH0KICAgIH0sCiAgICBkb3dubG9hZF9jc3Y6IGZ1bmN0aW9uIGRvd25sb2FkX2NzdigpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucXVlc3Rpb25faW50ZW50X2NzdigpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc19mb3JtX2ludGVudHM6IGZhbHNlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTguYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICB2YXIgYSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBhLmhyZWYgPSByZXNwb25zZS5kYXRhLmRhdGEuQ1NWX1VSTDsKICAgICAgICAgIGEuZG93bmxvYWQgPSB0cnVlOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgIGEuY2xpY2soKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHVwbG9hZF9maWxlX29wZW5fbW9kYWw6IGZ1bmN0aW9uIHVwbG9hZF9maWxlX29wZW5fbW9kYWwoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoJ3Nob3cnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}