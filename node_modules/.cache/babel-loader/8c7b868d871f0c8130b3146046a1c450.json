{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Dashboard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Dashboard.vue","mtime":1663910265458},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgeyBidXMgfSBmcm9tICJAL3BvcnRhbC9tYWluIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgUmVxdWVzdENoYXJ0IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvUmVxdWVzdENoYXJ0LnZ1ZSI7CmltcG9ydCBBcmVhQ2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9BcmVhQ2hhcnQudnVlIjsKaW1wb3J0IEJpbGxpbmdDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0JpbGxpbmdDaGFydC52dWUiOwppbXBvcnQgc3dhbCBmcm9tICdzd2VldGFsZXJ0Mic7CmltcG9ydCBNdWx0aXNlbGVjdCBmcm9tICJ2dWUtbXVsdGlzZWxlY3QiOwppbXBvcnQgY3VycmVuY3kgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9DdXJyZW5jeSI7CmltcG9ydCBMaW5lQ2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9MaW5lQ2hhcnQiOwppbXBvcnQgeyBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7IC8vaW1wb3J0IHBhZ2VfZ3VpZGUgZnJvbSAiQC9wb3J0YWwvbWl4aW5zL3BhZ2VndWlkZS5qcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgLy9taXhpbnM6IFtwYWdlX2d1aWRlXSwKICBwcm9wczoge30sCiAgbWl4aW5zOiBbY2xvc2VfbW9kYWxdLAogIGNvbXBvbmVudHM6IHsKICAgIFJlcXVlc3RDaGFydDogUmVxdWVzdENoYXJ0LAogICAgQXJlYUNoYXJ0OiBBcmVhQ2hhcnQsCiAgICBCaWxsaW5nQ2hhcnQ6IEJpbGxpbmdDaGFydCwKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdCwKICAgIExpbmVDaGFydDogTGluZUNoYXJ0CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB0aGlzLnJldGFpbF93ZWJfZnJhbWV3b3JrID0gdGhpcy4kc2Vzc2lvbi5nZXQoInJldGFpbF93ZWJfZnJhbWV3b3JrIik7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW5jeS5sZW5ndGg7IGkrKykgewogICAgICB0aGlzLmN1cnJlbmN5X2xpc3QucHVzaCh7CiAgICAgICAgZGlzcGxheV9uYW1lOiBjdXJyZW5jeVtpXS5lbW9qaSArICIgIiArIGN1cnJlbmN5W2ldLmN1cnJlbmN5X2NvZGUgKyAiIC0gIiArIGN1cnJlbmN5W2ldLmN1cnJlbmN5X25hbWUsCiAgICAgICAgdmFsdWU6IGN1cnJlbmN5W2ldLmN1cnJlbmN5X2NvZGUKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKTsKICAgIHRoaXMuY3VycmVudF95ZWFyID0gY3VycmVudFRpbWUuZ2V0RnVsbFllYXIoKTsKCiAgICBpZiAodGhpcy53aGF0c2FwcF9zdWJzY3JpcHRpb24gPT0gdHJ1ZSkgewogICAgICB0aGlzLmdldF9tZXRyaWNzX2RhdGEoKTsKICAgICAgdGhpcy5nZXRfbWV0cmljc19wcmljZV9kYXRhKCk7CiAgICB9CgogICAgdmFyIGNoZWNrX2RvbWFpbiA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5kb21haW47CiAgICB2YXIgaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2UgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2U7CgogICAgaWYgKGlzX3NldF9kZWZhdWx0X2xhbmd1YWdlID09IHRydWUpIHsKICAgICAgJCgiI2JvdF9sYW5ndWFnZV9zZXR1cCIpLm1vZGFsKCdzaG93Jyk7CiAgICB9CgogICAgdGhpcy4kcm9vdC4kb24oJ2NhbGxfZGFzaGJvYXJkX2RldGFpbHMnLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIF90aGlzLmRhc2hib2FyZF9kZXRhaWxzKCk7CgogICAgICAgIF90aGlzLmJhcl9jaGFydF9kcm9wZG93bihfdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWUpOwogICAgICB9CiAgICB9KTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICBpZiAoIXRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSAmJiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikucm9sZSAmJiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgdG9hc3RyLndhcm5pbmcodGhpcy50bHQoJ3NlbGVjdF9jb21wYW55X25hbWVfbGFiZWwnKSk7CiAgICB9CgogICAgaWYgKHRoaXMudXNlcl9yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICBpZiAodGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpKSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKSA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkIDogIiI7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lIDogIiI7CiAgICB9CgogICAgdGhpcy53aGF0c2FwcF9zdWJzY3JpcHRpb24gPSB0aGlzLiRzZXNzaW9uLmdldCgid2hhdHNhcHBfc3Vic2NyaXB0aW9uIik7CiAgICB0aGlzLmRhc2hib2FyZF9kZXRhaWxzKCk7IC8vIGF4aW9zCiAgICAvLyAgIC5wb3N0KAogICAgLy8gICAgIGFwaV9jYWxscy5iaWxsaW5nX3VzYWdlX3VybCgpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgbG9hZF9kYXRhX2J5OiAiTGFzdCA3IGRheXMiLAogICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICB9LAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIH0KICAgIC8vICAgKQogICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMgPSBbXTsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQgPSBbXTsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5Nc2dFeGNoYW5nZSA9IFtdOwogICAgLy8gICAgIHRoaXMuU2Vjb25kX2NoYXJ0LlRhc2tFeGVjdXRpb24gPSBbXTsKICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm8gRGF0YSBhdmFpbGFibGUiKSB7CiAgICAvLyAgICAgICBidXMuJGVtaXQoCiAgICAvLyAgICAgICAgICJjaGFydCBpcyB1cGRhdGVkIiwKICAgIC8vICAgICAgICAgIlRydWUiLAogICAgLy8gICAgICAgICBbXSwKICAgIC8vICAgICAgICAgW10sCiAgICAvLyAgICAgICAgIFtdLAogICAgLy8gICAgICAgICBbXSwKICAgIC8vICAgICAgICAgdGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlCiAgICAvLyAgICAgICApOwogICAgLy8gICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEpIHsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQubGFiZWxzLnB1c2goaSk7CiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudC5wdXNoKHJlc3BvbnNlLmRhdGFbaV0uQ2FsbENvdW50KTsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuTXNnRXhjaGFuZ2UucHVzaChyZXNwb25zZS5kYXRhW2ldLk1zZ0V4Y2hhbmdlKTsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuVGFza0V4ZWN1dGlvbi5wdXNoKAogICAgLy8gICAgICAgICAgIHJlc3BvbnNlLmRhdGFbaV0uVGFza0V4ZWN1dGlvbgogICAgLy8gICAgICAgICApOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgYnVzLiRlbWl0KAogICAgLy8gICAgICAgICAiYmlsbGluZyBjaGFydCBpcyB1cGRhdGVkIiwKICAgIC8vICAgICAgICAgIlRydWUiLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQsCiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0Lk1zZ0V4Y2hhbmdlLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5UYXNrRXhlY3V0aW9uLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMsCiAgICAvLyAgICAgICAgIHRoaXMuYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZQogICAgLy8gICAgICAgKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pCiAgICAvLyAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICApIHsKICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKCiAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5kYXNoYm9hcmRfY2hhcnRfdXJsKCksIHsKICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgIGxvYWRfZGF0YV9ieTogIk1vbnRobHkgYmlsbGluZyBjeWNsZSIsCiAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkKICAgIH0sIHsKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5CSUxMSU5HX0NIQVJULk1TR19DT0RFKSB7CiAgICAgICAgX3RoaXMyLnVwZGF0ZV9jaGFydF9kYXRhKHJlc3BvbnNlLmRhdGEuZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzMi50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2czJykpOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICBjb25zb2xlLmxvZyhlKTsKCiAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgfQogICAgfSk7CiAgfSwKICB1cGRhdGVkOiBmdW5jdGlvbiB1cGRhdGVkKCkgewogICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgYnVzLiRvbigiY29tcGFueSBhdHRyaWJ1dGVzIHVwZGF0ZWQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PSAiVHJ1ZSIpIHsKICAgICAgICBidXMuJGVtaXQoInNlbmQgY29tcGFueSBhdHRyaWJ1dGVzIik7CiAgICAgIH0KICAgIH0pOwogICAgYnVzLiRvbigiY29tcGFueSBuYW1lIGFuZCBjb21wYW55IGlkIiwgZnVuY3Rpb24gKGRhdGExLCBkYXRhMikgewogICAgICBfdGhpczMuJHJvdXRlci5nbygpOwogICAgfSk7CiAgfSwKICBjb21wdXRlZDogewogICAgdmFsaWRFbWFpbDogZnVuY3Rpb24gdmFsaWRFbWFpbCgpIHsKICAgICAgaWYgKHRoaXMuY29udGFjdF91c19lbWFpbCAhPSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuZW1haWxfdmFsaWRpdHkudGVzdCh0aGlzLmNvbnRhY3RfdXNfZW1haWwpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRoaXMudGx0KCd2YWxpZF9lbWFpbF9hZGRyX2xhYmVsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbGluZV9jaGFydF9wcm9wc19tb250aGx5X3VzYWdlOiBmdW5jdGlvbiBsaW5lX2NoYXJ0X3Byb3BzX21vbnRobHlfdXNhZ2UoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeEF4aXNMYWJlbDogJ1RpbWVsaW5lJywKICAgICAgICB5QXhpc0xhYmVsOiAnVmFsdWUnLAogICAgICAgIHhLZXk6ICdkYXRlJywKICAgICAgICB5S2V5OiAndmFsdWUnLAogICAgICAgIGludGVydmFsOiAnZGF5JywKICAgICAgICBkYXRhOiB0aGlzLm1vbnRobHlfdXNhZ2VfZGF0YQogICAgICB9OwogICAgfSwKICAgIGxpbmVfY2hhcnRfcHJvcHNfYXBwcm94X2NoYXJnZTogZnVuY3Rpb24gbGluZV9jaGFydF9wcm9wc19hcHByb3hfY2hhcmdlKCkgewogICAgICByZXR1cm4gewogICAgICAgIHhBeGlzTGFiZWw6ICdUaW1lbGluZScsCiAgICAgICAgeUF4aXNMYWJlbDogJ3ByaWNlICgkKScsCiAgICAgICAgeEtleTogJ2RhdGUnLAogICAgICAgIHlLZXk6ICd2YWx1ZScsCiAgICAgICAgaW50ZXJ2YWw6ICdkYXknLAogICAgICAgIGRhdGE6IHRoaXMucHJpY2luZ19kYXRhCiAgICAgIH07CiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc2hvdzogZmFsc2UsCiAgICAgIGJhcl9jaGFydF9kcm9wZG93bl92YWx1ZTogIk1vbnRobHkgYmlsbGluZyBjeWNsZSIsCiAgICAgIGJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93OiAiTW9udGhseSBiaWxsaW5nIGN5Y2xlIiwKICAgICAgYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZTogIkxhc3QgNyBkYXlzIiwKICAgICAgY29tcGFueW5hbWU6IG51bGwsCiAgICAgIGNvbXBhbnlpZDogbnVsbCwKICAgICAgcGVybWlzc2lvbl9saXN0OiBbXSwKICAgICAgQVBJX2RhdGE6IHsKICAgICAgICBsYWJlbHM6IFtdLAogICAgICAgIFN1Y2Nlc3NmdWw6IFtdLAogICAgICAgIFRvdGFsOiBbXSwKICAgICAgICBVbnN1Y2Nlc3NmdWw6IFtdLAogICAgICAgIHhBeGlzTGFiZWw6ICIiCiAgICAgIH0sCiAgICAgIFNlY29uZF9jaGFydDogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgQ2FsbENvdW50OiBbXSwKICAgICAgICBNc2dFeGNoYW5nZTogW10sCiAgICAgICAgVGFza0V4ZWN1dGlvbjogW10KICAgICAgfSwKICAgICAgQ29uY3VycmVudF9Vc2Vyc19EYXRhOiB7CiAgICAgICAgbGFiZWxzOiBbXSwKICAgICAgICBkYXRhOiBbXQogICAgICB9LAogICAgICBjb25jdXJyZW50X3VzZXJzX21vbnRoOiAiIiwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA6ICIiLAogICAgICBpbnRlbnRfY291bnQ6IDUzLAogICAgICBpbnRlbnRfY291bnRfZGlzcGxheTogMCwKICAgICAgZGlzcGxheV9saXN0OiBbXSwKICAgICAgcHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3Q6IFsiSW50ZW50cyIsICJRdWVzdGlvbnMiLCAiUmVzcG9uc2VzIiwgIlRyYWluaW5nIl0sCiAgICAgIGRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3Q6IFsiVmVyaWZ5IFJlc3BvbnNlcyBVbmFuc3dlcmVkIiwgIlZlcmlmeSBCb3QgUmVzcG9uc2UiLCAiUHJvZHVjdHMiLCAiU3lub255bXMiLCAiQWNjb3VudHMiXSwKICAgICAgaW5mb19pdGVtX2VudGl0aWVzX2xpc3Q6IFtdLAogICAgICBzdWNjZXNzX2l0ZW1faW5mb19saXN0OiBbIkNoZWNrIEJvdCBSZXNwb25zZSIsICJCb3QgQ29uZmlndXJhdGlvbiJdLAogICAgICBpdGVtX2xpc3Rfb3JkZXI6IFsiZGFuZ2VyX2l0ZW1fZW50aXRpZXNfbGlzdCIsICJzdWNjZXNzX2l0ZW1faW5mb19saXN0IiwgInByaW1hcnlfaXRlbV9lbnRpdGllc19saXN0Il0sCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIHJldGFpbF93ZWJfZnJhbWV3b3JrOiB0aGlzLiRzZXNzaW9uLmdldCgicmV0YWlsX3dlYl9mcmFtZXdvcmsiKSwKICAgICAgY3VycmVuY3lfY29kZTogIiIsCiAgICAgIGN1cnJlbmN5X2xpc3Q6IFtdLAogICAgICBlbWFpbF92YWxpZGl0eTogL14oWzAtOWEtekEtWl0oWy0uXHddKlswLTlhLXpBLVpdKSpAKFswLTlhLXpBLVpdWy1cd10qWzAtOWEtekEtWl1cLikrW2EtekEtWl17Miw5fSkkLywKICAgICAgY29udGFjdF91c19lbWFpbDogJycsCiAgICAgIG1vbnRobHlfdXNhZ2VfZGF0YTogW10sCiAgICAgIHByaWNpbmdfZGF0YTogW10sCiAgICAgIGxpbmVfY2hhcnRfZHJvcGRvd25fdmFsdWU6ICdhbGwnLAogICAgICBsaXN0X29mX3llYXI6IFtdLAogICAgICBwcmljZV9jaGFydF9kcm9wZG93bl92YWx1ZTogJycsCiAgICAgIGN1cnJlbnRfeWVhcjogJycsCiAgICAgIHdoYXRzYXBwX3N1YnNjcmlwdGlvbjogZmFsc2UsCiAgICAgIG5vdF9lbm91Z2hfZGF0YTogZmFsc2UsCiAgICAgIGlzX2JvdF9sYW5nX3NldDogZmFsc2UsCiAgICAgIGNvdW50cnlfbGlzdDogW3sKICAgICAgICBkaXNwbGF5X25hbWU6ICLwn4e68J+HuCBFbmdsaXNoIiwKICAgICAgICB2YWx1ZTogImVuIiwKICAgICAgICBsYW5nOiAiZW5nbGlzaCIKICAgICAgfSwgLy8gewogICAgICAvLyAgIGRpc3BsYXlfbmFtZTogIvCfh6rwn4e4IFNwYW5pc2giLAogICAgICAvLyAgIHZhbHVlOiAiZXMiLAogICAgICAvLyAgIGxhbmc6ICJzcGFuaXNoIgogICAgICAvLyB9LAogICAgICB7CiAgICAgICAgZGlzcGxheV9uYW1lOiAi8J+HrvCfh7MgSGluZGkiLAogICAgICAgIHZhbHVlOiAiaGkiLAogICAgICAgIGxhbmc6ICJoaW5kaSIKICAgICAgfSwgewogICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7Xwn4e5IFBvcnR1Z3Vlc2UiLAogICAgICAgIHZhbHVlOiAicHQiLAogICAgICAgIGxhbmc6ICJwb3J0dWd1ZXNlIgogICAgICB9XSwKICAgICAgbGFuZ3VhZ2VfY29kZTogbnVsbCAvL3RvdXJfZ3VpZGVfaWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9pbmZvX2ljb24uc3ZnIiksCgogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIGdyYXBoXzJfYmFyX2NoYXJ0X2Ryb3Bkb3duKCkgewogICAgLy8gICB0aGlzLmJhcl9jaGFydDJfZHJvcGRvd25fdmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7CiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKHRoaXMuYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZSkKICAgIC8vICAgYXhpb3MKICAgIC8vICAgICAucG9zdCgKICAgIC8vICAgICAgIGFwaV9jYWxscy5iaWxsaW5nX3VzYWdlX3VybCgpLAogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgbG9hZF9kYXRhX2J5OiB0aGlzLmJhcl9jaGFydDJfZHJvcGRvd25fdmFsdWUsCiAgICAvLyAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgIH0sCiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgKQogICAgLy8gICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgICAgdGhpcy5TZWNvbmRfY2hhcnQubGFiZWxzID0gW107CiAgICAvLyAgICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQgPSBbXTsKICAgIC8vICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0Lk1zZ0V4Y2hhbmdlID0gW107CiAgICAvLyAgICAgICB0aGlzLlNlY29uZF9jaGFydC5UYXNrRXhlY3V0aW9uID0gW107CiAgICAvLyAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm8gRGF0YSBhdmFpbGFibGUiKSB7CiAgICAvLyAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEpIHsKICAgIC8vICAgICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMucHVzaChpKTsKICAgIC8vICAgICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQucHVzaChyZXNwb25zZS5kYXRhW2ldLkNhbGxDb3VudCk7CiAgICAvLyAgICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuTXNnRXhjaGFuZ2UucHVzaChyZXNwb25zZS5kYXRhW2ldLk1zZ0V4Y2hhbmdlKTsKICAgIC8vICAgICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5UYXNrRXhlY3V0aW9uLnB1c2goCiAgICAvLyAgICAgICAgICAgICByZXNwb25zZS5kYXRhW2ldLlRhc2tFeGVjdXRpb24KICAgIC8vICAgICAgICAgICApOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuY2F0Y2goKGUpID0+IHsKICAgIC8vICAgICAgIGlmICgKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICAgICkgewogICAgLy8gICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0pOwogICAgLy8gfSwKICAgIGJhcl9jaGFydF9kcm9wZG93bjogZnVuY3Rpb24gYmFyX2NoYXJ0X2Ryb3Bkb3duKHZhbCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmIChfdHlwZW9mKHZhbCkgPT0gJ29iamVjdCcpIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9IHZhbDsKICAgICAgfQoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZGFzaGJvYXJkX2NoYXJ0X3VybCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgbG9hZF9kYXRhX2J5OiB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNC5hcGlfc3RhdHVzX2NvZGUuQklMTElOR19DSEFSVC5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM0LnVwZGF0ZV9jaGFydF9kYXRhKHJlc3BvbnNlLmRhdGEuZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZV9jaGFydF9kYXRhOiBmdW5jdGlvbiB1cGRhdGVfY2hhcnRfZGF0YShtZXNzYWdlKSB7CiAgICAgIHRoaXMuQVBJX2RhdGEubGFiZWxzID0gW107CiAgICAgIHRoaXMuQVBJX2RhdGEuU3VjY2Vzc2Z1bCA9IFtdOwogICAgICB0aGlzLkFQSV9kYXRhLlRvdGFsID0gW107CiAgICAgIHRoaXMuQVBJX2RhdGEuVW5zdWNjZXNzZnVsID0gW107CgogICAgICBpZiAodGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWUgPT0gJ01vbnRobHkgYmlsbGluZyBjeWNsZScpIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93ID0gdGhpcy50bHQoJ2Rhc2hib2FyZF9iaWxsaW5nX2N5Y2xlJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWUgPT0gJ0xhc3QgNyBkYXlzJykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3Rfc2V2ZW4nKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTGFzdCAzMCBkYXlzJykgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3RfMzAnKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTGFzdCAzIG1vbnRocycpIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93ID0gdGhpcy50bHQoJ2Rhc2hib2FyZF9sYXN0XzNfbW9udGgnKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTGFzdCA5IG1vbnRocycpIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93ID0gdGhpcy50bHQoJ2Rhc2hib2FyZF9sYXN0XzlfbW9udGgnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93ID0gdGhpcy50bHQoJ2Rhc2hib2FyZF9sYXN0XzEyX21vbnRoJyk7CiAgICAgIH0KCiAgICAgIGlmIChtZXNzYWdlID09ICJObyBEYXRhIGF2YWlsYWJsZSIpIHt9IGVsc2UgewogICAgICAgIGZvciAodmFyIGkgaW4gbWVzc2FnZSkgewogICAgICAgICAgdGhpcy5BUElfZGF0YS5sYWJlbHMucHVzaChpKTsKICAgICAgICAgIHRoaXMuQVBJX2RhdGEuU3VjY2Vzc2Z1bC5wdXNoKG1lc3NhZ2VbaV0uU3VjY2Vzc2Z1bCk7CiAgICAgICAgICB0aGlzLkFQSV9kYXRhLlRvdGFsLnB1c2gobWVzc2FnZVtpXS5Ub3RhbCk7CiAgICAgICAgICB0aGlzLkFQSV9kYXRhLlVuc3VjY2Vzc2Z1bC5wdXNoKG1lc3NhZ2VbaV0uVW5zdWNjZXNzZnVsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnb190b19wYWdlOiBmdW5jdGlvbiBnb190b19wYWdlKHBhZ2VfbmFtZSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmIChwYWdlX25hbWUgPT0gIlZlcmlmeSBSZXNwb25zZXMgVW5hbnN3ZXJlZCIpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAiVmVyaWZ5IEJvdCBSZXNwb25zZSIsCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgbW9kYWxfb3Blbl9zd2l0Y2hfdGFiOiBmYWxzZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHBhZ2VfbmFtZSA9PSAiU3lub255bXMiKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2Rhc2hib2FyZF9zd2FsX2FsZXJ0X21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2Rhc2hib2FyZF90cmFpbl9tb2RlbF9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdkYXNoYm9hcmRfc3dhbF9jb25maXJtX21zZycpLAogICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50cmFpbl9pbnRlbnRfbmVyX21vZGVsKCksIHsKICAgICAgICAgICAgICBlbWFpbDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzNS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICB1cGRhdGVfbW9kZWw6IHRydWUsCiAgICAgICAgICAgICAgdXBkYXRlX21vZGVsX3N0YXR1czogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLCB0cnVlKTsKCiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczUudGx0KCdkYXNoYm9hcmRfaW50ZXJuYWxfc2VydmVyX21zZycpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihfdGhpczUudGx0KCdzb21lX2Vycm9yX3BsZWFzZV90cnlfYWdhaW4nLCAnY29kZScpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9uYW1lID09ICJQcm9kdWN0cyIpIHsKICAgICAgICAkKCIjc3RvcmVfY29uZmlnIikubW9kYWwoJ3Nob3cnKTsKICAgICAgICB0aGlzLmxvYWRfcHJvZHVjdF9zZXR0aW5ncygpOwogICAgICB9IGVsc2UgaWYgKHBhZ2VfbmFtZSA9PSAiQWNjb3VudHMiKSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogJ1NldHRpbmdzJywKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiBwYWdlX25hbWUsCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgbW9kYWxfb3Blbl9zd2l0Y2hfdGFiOiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBpbnRlbnRzX2NvdW50X2Z1bmN0aW9uOiBmdW5jdGlvbiBpbnRlbnRzX2NvdW50X2Z1bmN0aW9uKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBzdGFydFRpbWVzdGFtcCA9IG51bGw7CiAgICAgIHZhciBkdXJhdGlvbiA9IDIwMDA7CiAgICAgIHZhciBlbmQgPSB0aGlzLmludGVudF9jb3VudDsKICAgICAgdmFyIHN0YXJ0ID0gMDsKCiAgICAgIHZhciBzdGVwID0gZnVuY3Rpb24gc3RlcCh0aW1lc3RhbXApIHsKICAgICAgICBpZiAoIXN0YXJ0VGltZXN0YW1wKSBzdGFydFRpbWVzdGFtcCA9IHRpbWVzdGFtcDsKICAgICAgICB2YXIgcHJvZ3Jlc3MgPSBNYXRoLm1pbigodGltZXN0YW1wIC0gc3RhcnRUaW1lc3RhbXApIC8gZHVyYXRpb24sIDEpOwogICAgICAgIF90aGlzNi5pbnRlbnRfY291bnRfZGlzcGxheSA9IE1hdGguZmxvb3IocHJvZ3Jlc3MgKiAoZW5kIC0gc3RhcnQpICsgc3RhcnQpOwoKICAgICAgICBpZiAocHJvZ3Jlc3MgPCAxKSB7CiAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXApOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcCk7CiAgICB9LAogICAgbGlzdF9ncm91cF9keW5hbWljX2NsYXNzOiBmdW5jdGlvbiBsaXN0X2dyb3VwX2R5bmFtaWNfY2xhc3Mocm93KSB7CiAgICAgIGlmICh0aGlzLnByaW1hcnlfaXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImxpc3QtZ3JvdXAtaXRlbS1wcmltYXJ5IjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAibGlzdC1ncm91cC1pdGVtLWRhbmdlciI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pbmZvX2l0ZW1fZW50aXRpZXNfbGlzdC5pbmNsdWRlcyhyb3cpKSB7CiAgICAgICAgcmV0dXJuICJsaXN0LWdyb3VwLWl0ZW0taW5mbyI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdWNjZXNzX2l0ZW1faW5mb19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzIjsKICAgICAgfQogICAgfSwKICAgIGxpc3RfZ3JvdXBfZHluYW1pY190eXBlOiBmdW5jdGlvbiBsaXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyb3cpIHsKICAgICAgLyoqCiAgICAgICAgKiBAcGFyYW0tIHJvdyBkZXRlcm1pbmVzIHdoaWNoIGxpc3QgZ3JvdSBwaXQgYmVsb25ncyB0by4KICAgICAgICAqIEByZXR1cm5zLSB0aGUgcmVzcGVjdGl2ZSBsaXN0IGl0ZW0gY29sb3VyIHByZWZpeGVkIHdpdGggYWxwaGFiZXQgZm9yIGVhc3kgc29ydGluZyBhcyBwZXIgb3VyIHJlcXVpcmVtZW50CiAgICAgICovCiAgICAgIGlmICh0aGlzLnByaW1hcnlfaXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImQtcHJpbWFyeSI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5kYW5nZXJfaXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImEtZGFuZ2VyIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmluZm9faXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImItaW5mbyI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdWNjZXNzX2l0ZW1faW5mb19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImMtc3VjY2VzcyI7CiAgICAgIH0KICAgIH0sCiAgICBkaXNwbGF5X2xpc3RfZHluYW1pY19jbGFzczogZnVuY3Rpb24gZGlzcGxheV9saXN0X2R5bmFtaWNfY2xhc3MoKSB7CiAgICAgIGlmICh0aGlzLmRpc3BsYXlfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuICJwYWRkaW5nOiAyMHB4IDI1cHg7IjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gInBhZGRpbmc6IDEwcHggMjVweDsiOwogICAgICB9CiAgICB9LAogICAgY29uZmlndXJlX3Byb2R1Y3Rfc2V0dGluZ3M6IGZ1bmN0aW9uIGNvbmZpZ3VyZV9wcm9kdWN0X3NldHRpbmdzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnZhbGlkRW1haWwgIT0gdHJ1ZSkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2Rhc2hib2FyZF92YWxpZF9lbWFpbF90ZXh0JyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVuY3lfY29kZSA9PSAnJykgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2Rhc2hib2FyZF9iYXNlX2N1cnJlbmN5X3RleHQnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb2R1Y3Rfc2V0dGluZ3MoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgaXNfZW1haWxfcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBlbWFpbF9yZXF1aXJlZDogewogICAgICAgICAgICBjb250YWN0X2hlbHBfZW1haWw6IHRoaXMuY29udGFjdF91c19lbWFpbCwKICAgICAgICAgICAgYmFzZV9jdXJyZW5jeTogdGhpcy5jdXJyZW5jeV9jb2RlLAogICAgICAgICAgICAic2hvcF9zZXR0aW5nc19zYXZlZCI6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgJCgiI3N0b3JlX2NvbmZpZyIpLm1vZGFsKCdoaWRlJyk7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXM3LnRsdCgnZGFzaGJvYXJkX2NoYW5nZXNfc2F2ZWRfdGV4dCcpLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgX3RoaXM3LmRhc2hib2FyZF9kZXRhaWxzKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdkYXNoYm9hcmRfaW50ZXJuYWxfc2VydmVyX2Vycm9yJyksCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzNy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzNy50bHQoJ3NvbWVfZXJyb3Jfb2NjdXJyZWRfbXNnJywgJ2NvZGUnKSk7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgdGhpcy5jb250YWN0X3VzX2VtYWlsID0gJyc7CiAgICAgIHRoaXMuZW1haWxfcmVxdWlyZWQgPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW5jeV9jb2RlID0gIiI7CiAgICB9LAogICAgZGFzaGJvYXJkX2RldGFpbHM6IGZ1bmN0aW9uIGRhc2hib2FyZF9kZXRhaWxzKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZGFzaGJvYXJkX2JvdF9kZXRhaWxzX2NvdW50KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHBvcnRhbF9sYW5nOiB0aGlzLiRzZXNzaW9uLmdldCgiUHJlZmVycmVkTGFuZ3VhZ2UiKSwKICAgICAgICBpc19nZXQ6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBfdGhpczguZGlzcGxheV9saXN0ID0gW107CiAgICAgICAgX3RoaXM4LnBlcm1pc3Npb25fbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIF90aGlzOC4kc2Vzc2lvbi5nZXQoIkNoYXRib3RNZW51IikpIHsKICAgICAgICAgIF90aGlzOC5wZXJtaXNzaW9uX2xpc3QucHVzaChfdGhpczguJHNlc3Npb24uZ2V0KCJDaGF0Ym90TWVudSIpW2ldLm1haW5fbWVudS5uYW1lKTsKCiAgICAgICAgICBmb3IgKHZhciBqIGluIF90aGlzOC4kc2Vzc2lvbi5nZXQoIkNoYXRib3RNZW51IilbaV0uc3ViX21lbnVfbGlzdCkgewogICAgICAgICAgICBfdGhpczgucGVybWlzc2lvbl9saXN0LnB1c2goX3RoaXM4LiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKVtpXS5zdWJfbWVudV9saXN0W2pdLm5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgdmFyIHZlcmlmeV9ib3RfcmVzcG9uc2UgPSBmYWxzZSwKICAgICAgICAgICAgICBzdG9yZV9zZXR0aW5ncyA9IGZhbHNlOwoKICAgICAgICAgIGZvciAodmFyIG4gaW4gX3RoaXM4LnBlcm1pc3Npb25fbGlzdCkgewogICAgICAgICAgICBpZiAoX3RoaXM4LnBlcm1pc3Npb25fbGlzdFtuXSA9PSAiVmVyaWZ5IEJvdCBSZXNwb25zZSIpIHsKICAgICAgICAgICAgICB2ZXJpZnlfYm90X3Jlc3BvbnNlID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF90aGlzOC5wZXJtaXNzaW9uX2xpc3Rbbl0gPT09ICJTdG9yZSIpIHsKICAgICAgICAgICAgICBzdG9yZV9zZXR0aW5ncyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhKSB7CiAgICAgICAgICAgIHZhciBwdXNoZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAodmFyIGogaW4gX3RoaXM4LnBlcm1pc3Npb25fbGlzdCkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkgPT0gX3RoaXM4LnBlcm1pc3Npb25fbGlzdFtqXSkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSBfdGhpczgubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KTsKCiAgICAgICAgICAgICAgICBfdGhpczguZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwoKICAgICAgICAgICAgICAgIHB1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodmVyaWZ5X2JvdF9yZXNwb25zZSA9PSB0cnVlICYmIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PSAiVmVyaWZ5IFJlc3BvbnNlcyBVbmFuc3dlcmVkIikgewogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gX3RoaXM4Lmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSk7CgogICAgICAgICAgICAgICAgX3RoaXM4LmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKTsKCiAgICAgICAgICAgICAgICB2ZXJpZnlfYm90X3Jlc3BvbnNlID0gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoc3RvcmVfc2V0dGluZ3MgPT0gdHJ1ZSAmJiByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkgPT0gIlByb2R1Y3RzIikgewogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gX3RoaXM4Lmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSk7CgogICAgICAgICAgICAgICAgX3RoaXM4LmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKTsKCiAgICAgICAgICAgICAgICBzdG9yZV9zZXR0aW5ncyA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFwdXNoZWQpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09PSAiVHJhaW5pbmciKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5saXN0X2JlbG9uZyA9IF90aGlzOC5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpOwoKICAgICAgICAgICAgICAgIF90aGlzOC5kaXNwbGF5X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXSk7CgogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghcHVzaGVkKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PT0gIlN5bm9ueW1zIikgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSBfdGhpczgubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KTsKCiAgICAgICAgICAgICAgICBfdGhpczguZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwoKICAgICAgICAgICAgICAgIHB1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXB1c2hlZCkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkgPT09ICJBY2NvdW50cyIpIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gX3RoaXM4Lmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSk7CgogICAgICAgICAgICAgICAgX3RoaXM4LmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKTsKCiAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzOC5kaXNwbGF5X2xpc3Quc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5saXN0X2JlbG9uZyA+IGIubGlzdF9iZWxvbmcgPyAxIDogLTE7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRfcHJvZHVjdF9zZXR0aW5nczogZnVuY3Rpb24gbG9hZF9wcm9kdWN0X3NldHRpbmdzKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHRoaXMuY29udGFjdF91c19lbWFpbCA9ICcnOwogICAgICB0aGlzLmVtYWlsX3JlcXVpcmVkID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVuY3lfY29kZSA9ICIiOwogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc19nZXQ6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzOS5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIHZhciB3ZWJmcmFtZXdvcmsgPSBfdGhpczkucmV0YWlsX3dlYl9mcmFtZXdvcms7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM5LmNvbnRhY3RfdXNfZW1haWwgPSByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10uY29udGFjdF9oZWxwX2VtYWlsOwogICAgICAgICAgX3RoaXM5LmVtYWlsX3JlcXVpcmVkID0gcmVzcG9uc2UuZGF0YS5kYXRhW3dlYmZyYW1ld29yayArICdfZGV0YWlscyddLm9yZGVyX3JldHJpZXZhbF9vbmx5X2VtYWlsX3JlcXVpcmVkOwogICAgICAgICAgX3RoaXM5LmN1cnJlbmN5X2NvZGUgPSByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10uYmFzZV9jdXJyZW5jeTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKF90aGlzOS50bHQoJ2Rhc2hib2FyZF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczkuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IoX3RoaXM5LnRsdCgnc29tZV9lcnJvcl9vY2N1cnJlZF9tc2cnLCAnY29kZScpKTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXRfbWV0cmljc19kYXRhOiBmdW5jdGlvbiBnZXRfbWV0cmljc19kYXRhKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9tZXRyaWNzKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgaXNfZ2V0OiB0aGlzLmxpbmVfY2hhcnRfZHJvcGRvd25fdmFsdWUsCiAgICAgICAgaXNfZ2V0X2NvbnZlcnNhdGlvbl9tZXRyaWNzOiB0cnVlLAogICAgICAgIHllYXI6IHRoaXMuY3VycmVudF95ZWFyCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLklOU1VGRklDSUVOVF9XSEFUU0FQUF9NRVRSSUNTX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTAubm90X2Vub3VnaF9kYXRhID0gdHJ1ZTsKICAgICAgICAgIF90aGlzMTAubW9udGhseV91c2FnZV9kYXRhID0gW107CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTAubW9udGhseV91c2FnZV9kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGE7CiAgICAgICAgICBfdGhpczEwLm5vdF9lbm91Z2hfZGF0YSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZXRfbWV0cmljc19wcmljZV9kYXRhOiBmdW5jdGlvbiBnZXRfbWV0cmljc19wcmljZV9kYXRhKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9tZXRyaWNzKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgaXNfZ2V0OiAncHJpY2UnLAogICAgICAgIGlzX2dldF9jb252ZXJzYXRpb25fbWV0cmljczogdHJ1ZSwKICAgICAgICB5ZWFyOiB0aGlzLmN1cnJlbnRfeWVhcgogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlNVRkZJQ0lFTlRfV0hBVFNBUFBfTUVUUklDU19EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczExLnByaWNpbmdfZGF0YSA9IFtdOwogICAgICAgICAgX3RoaXMxMS5wcmljaW5nX2RhdGEgPSBbXTsKICAgICAgICAgIF90aGlzMTEubm90X2Vub3VnaF9kYXRhID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMS5wcmljaW5nX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGEuZGF0YTsKICAgICAgICAgIF90aGlzMTEubGlzdF9vZl95ZWFyID0gcmVzcG9uc2UuZGF0YS5kYXRhLnllYXJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGxpbmVfY2hhcnRfZHJvcGRvd246IGZ1bmN0aW9uIGxpbmVfY2hhcnRfZHJvcGRvd24oKSB7CiAgICAgIHRoaXMubGluZV9jaGFydF9kcm9wZG93bl92YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgICAgdGhpcy5nZXRfbWV0cmljc19kYXRhKCk7CiAgICB9LAogICAgbGluZV9jaGFydF95ZWFyX2Ryb3Bkb3duOiBmdW5jdGlvbiBsaW5lX2NoYXJ0X3llYXJfZHJvcGRvd24oKSB7CiAgICAgIHRoaXMuY3VycmVudF95ZWFyID0gZXZlbnQudGFyZ2V0LnZhbHVlOwogICAgICB0aGlzLmdldF9tZXRyaWNzX3ByaWNlX2RhdGEoKTsKICAgICAgdGhpcy5nZXRfbWV0cmljc19kYXRhKCk7CiAgICB9LAogICAgc2F2ZV9sYW5ndWFnZV9jaGF0Ym90OiBmdW5jdGlvbiBzYXZlX2xhbmd1YWdlX2NoYXRib3QoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmxhbmd1YWdlX2NvZGUgPT0gbnVsbCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgbGFuZ3VhZ2UiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsYW5ndWFnZSA9IHRoaXMubGFuZ3VhZ2VfY29kZS5sYW5nOwogICAgICB2YXIgbGFuZ19jb2RlID0gdGhpcy5sYW5ndWFnZV9jb2RlLnZhbHVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wb3J0YWxfbGFuZ3VhZ2VfZGF0YSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBjaGF0Ym90X2xhbmd1YWdlX2NvZGU6IGxhbmdfY29kZSwKICAgICAgICBjaGF0Ym90X2xhbmd1YWdlOiBsYW5ndWFnZSwKICAgICAgICBzYXZlX2NoYXRib3RfbGFuZ3VhZ2U6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuTEFOR1VBR0VfVVBEQVRFRC5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJCb3QgTGFuZ3VhZ2UgVXBkYXRlIFN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciB1c2VyaW5mbyA9IF90aGlzMTIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKTsKCiAgICAgICAgICB1c2VyaW5mb1siaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2UiXSA9IGZhbHNlOwogICAgICAgICAgdXNlcmluZm9bImNoYXRib3RfbGFuZ3VhZ2UiXSA9IGxhbmd1YWdlOwogICAgICAgICAgdXNlcmluZm9bImNoYXRib3RfbGFuZ3VhZ2VfY29kZSJdID0gbGFuZ19jb2RlOwoKICAgICAgICAgIF90aGlzMTIuJHNlc3Npb24uc2V0KCJVc2VySW5mb3JtYXRpb24iLCB1c2VyaW5mbyk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX09QRVJBVElPTi5NU0dfQ09ERSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJVbmFibGUgdG8gdXBkYXRlIEJvdCBMYW5ndWFnZSIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2xvc2VfbW9kYWwoJ3NhdmVfbGFuZ3VhZ2VfY2hhdGJvdF9idG4nKTsKICAgIH0KICB9Cn07"},null]}