{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Entities.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Entities.vue","mtime":1645594423479},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBUZW1wbGF0ZSBmcm9tICcuLi9UZW1wbGF0ZS52dWUnOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgVGVtcGxhdGU6IFRlbXBsYXRlCiAgfSwKICBuYW1lOiAiZW50aXRpZXMtY29tcG9uZW50IiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaXNfYXRfaW5fZW50aXR5OiBmYWxzZSwKICAgICAgdmFsaWRhdGlvbl9uZWVkZWQ6IGZhbHNlLAogICAgICB2YWxpZGF0aW9uX3R5cGU6IG51bGwsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl9uZWVkZWQ6IGZhbHNlLAogICAgICBjdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZTogbnVsbCwKICAgICAgc2F2ZV9uZXdfZW50aXRpZXM6ICcnLAogICAgICBlbnRpdGllc192YWx1ZV90eXBlOiAnc3lub255bXMnLAogICAgICBzeW5vbnltc192YWx1ZV9saXN0OiBbewogICAgICAgIHZhbHVlOiAnJywKICAgICAgICBzeW5vbnltczogWyIiXQogICAgICB9XSwKICAgICAgcGF0dGVybl9saXN0OiBbewogICAgICAgIHBhdHRlcm46ICcnCiAgICAgIH1dLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBlbnRpdHlfYWxyZWFkeV9leGlzdHM6IGZhbHNlLAogICAgICBlbnRpdHlfYWxyZWFkeV9leGlzdHNfZWRpdDogZmFsc2UsCiAgICAgIHBlbmNpbF9zdmc6ICc8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE1LjU0NiIgaGVpZ2h0PSIxNS40NjEiIHZpZXdCb3g9IjAgMCAxNS41NDYgMTUuNDYxIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojOWU5ZTllO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzQ3Ljg4OCAtMzU2Ljc2OSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNzU5LjQxNiwzNTYuNzY5YTIuMzU4LDIuMzU4LDAsMCwxLDEuNzc3LjY2MmMuNTM0LjUxMywxLjA3MiwxLjAyNSwxLjU2NywxLjU3NWEyLjMsMi4zLDAsMCwxLS4wNzEsMy4zMjVjLTIuNzM2LDIuNzYtNS40OTQsNS41LTguMjM4LDguMjUxYTEuMzgxLDEuMzgxLDAsMCwxLS43NTguMjg4Yy0uNzE5LjE3NC0xLjQyOS4zNzktMi4xNDQuNTcyLS45MzIuMjUxLTEuODYyLjUtMi43OTUuNzUxLS42LjE1OC0uOTg5LS4yMTMtLjgzMi0uODA3cS42ODktMi41OTUsMS40MDYtNS4xODJhMS4xNjQsMS4xNjQsMCwwLDEsLjI4OS0uNDg3cTQuMDkxLTQuMTA3LDguMi04LjJBMi4yNjUsMi4yNjUsMCwwLDEsNzU5LjQxNiwzNTYuNzY5Wm0tMS45ODksMi45NTYtNi41NCw2LjUzOCwzLjAyNSwzLjAyNCw2LjUzOC02LjUzN1ptNC4wMjMsMi4xNjVjLjExOC0uMTM1LjIyNS0uMjY5LjM0My0uMzkyYTEuMTM0LDEuMTM0LDAsMCwwLDAtMS43MzRjLS40Ni0uNDY2LS45MjYtLjkyNS0xLjM4OC0xLjM5YTEuMTY2LDEuMTY2LDAsMCwwLS44NjEtLjM2OGMtLjU3OCwwLS44ODEuNC0xLjIxNC43NlptLTEyLjA4NCw4Ljg2MywzLjItLjg2My0yLjMzNy0yLjMzMVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDApIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik04MTMuOTQyLDQyMi42bC0uNzg5LS44LDMuODIxLTMuODE5Ljc4NC44WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU5LjY0OCAtNTUuOTQ3KSIvPjwvZz48L3N2Zz4nLAogICAgICBzZWFyY2hfbmFtZTogIiIsCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgZmlsZV9sYWJlbF9jc3Y6ICJDaG9vc2UgZmlsZSIsCiAgICAgIHNwaW5uZXJPbkZpbGVEb3dubG9hZDogZmFsc2UsCiAgICAgIGVudGl0eV9saXN0OiBbXSwKICAgICAgcGFnZV9ubzogMSwKICAgICAgcGVyX3BhZ2U6IDE1LAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIG51bWJlcl9vZl9yb3dzOiBudWxsLAogICAgICBpc0VkaXRFbnRpdHk6IGZhbHNlLAogICAgICBpc19zZWFyY2hfYWN0aXZlOiBmYWxzZSwKICAgICAgb2xkX2VudGl0eV9uYW1lOiAnJywKICAgICAgY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaGlnaGxpZ2h0OiAnJywKICAgICAgY3VycmVudF9zZWxlY3RlZF9lbnRpdHk6ICcnLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleDogMCwKICAgICAgY3VycmVudF9zZWxlY3RlZF90eXBlOiAnJywKICAgICAgY3VycmVudF9zZWxlY3RlZF9pZDogbnVsbCwKICAgICAgY3VycmVudF9zZWxlY3RlZF9kZXNjcmlwdGlvbjogJycsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzOiBbewogICAgICAgIHZhbHVlOiAnJywKICAgICAgICBzeW5vbnltczogWyIiXQogICAgICB9XSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuOiBbewogICAgICAgIHBhdHRlcm46ICcnCiAgICAgIH1dCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2Ugc2VsZWN0IGEgY29tcGFueSBuYW1lIGZyb20gdGhlIGRyb3Bkb3duIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQoKICAgIHRoaXMubG9hZF9lbnRpdHkoKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgnYVtkYXRhLXRhcmdldD0iI2VudGl0eW1vZGVsIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh2bS5pc0VkaXRFbnRpdHkgPT0gdHJ1ZSkgewogICAgICAgIHZtLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAkKCIjZW50aXR5bW9kZWwiKS5tb2RhbCgnc2hvdycpOwogICAgICB9CiAgICB9KTsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgLy8gJCgnZGl2OmlucHV0JykucHJvcCgnY2hlY2tlZCcsdHJ1ZSk7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICB9LAogIHdhdGNoOiB7CiAgICBjdXJyZW50X3NlbGVjdGVkX2VudGl0eTogZnVuY3Rpb24gY3VycmVudF9zZWxlY3RlZF9lbnRpdHkodmFsKSB7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfSwKICAgIHNhdmVfbmV3X2VudGl0aWVzOiBmdW5jdGlvbiBzYXZlX25ld19lbnRpdGllcyh2YWwpIHsKICAgICAgdGhpcy5zYXZlX25ld19lbnRpdGllcyA9IHZhbC5yZXBsYWNlKC9bXmEtekEtWjAtOV8gXS9nLCAiIik7CiAgICB9LAogICAgc2VhcmNoX25hbWU6IGZ1bmN0aW9uIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfZW50aXR5KCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIGlmICh0aGlzLmlzRWRpdEVudGl0eSkgewogICAgICB0aGlzLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgewogICAgICBuZXh0KCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICB2ZXJpZnlfY2hhbmdlczogZnVuY3Rpb24gdmVyaWZ5X2NoYW5nZXMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgIHRleHQ6ICJJZiB5b3UgaGF2ZSBtYWRlIGFueSBjaGFuZ2VzIGluIHRoZSBwcm9kdWN0IHNldHRpbmdzIHBsZWFzZSBzYXZlIHRoZW0gZmlyc3QsIGVsc2UgdGhleSB3aWxsIGRpc2NhcmRlZCEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJTYXZlIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAiQ2FuY2VsIgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpcy5lZGl0X2VudGl0eSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpcy5pc0VkaXRFbnRpdHkgPSBmYWxzZTsKCiAgICAgICAgICBfdGhpcy5sb2FkX2VudGl0eSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8gcm91dGV0b2Fzc2lzdGFudExheW91dCgpewogICAgLy8gdGhpcy4kcm91dGVyLnB1c2goewogICAgLy8gICAgIG5hbWU6ICJDb252ZXJzYXRpb25hbCBGbG93IiwKICAgIC8vICAgICBwYXJhbXM6e21vZGFsX29wZW5fZW50aXR5X3RhYjogdHJ1ZSAgfQogICAgLy8gICB9KTsKICAgIC8vIH0sCiAgICBjaGVja19jdXJyZW50X2VudGl0eTogZnVuY3Rpb24gY2hlY2tfY3VycmVudF9lbnRpdHkoaW5kZXgpIHsKICAgICAgdmFyIHJldHVybl92YXIgPSAiIjsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHkgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eV9oaWdobGlnaHQpIHsKICAgICAgICByZXR1cm5fdmFyICs9ICJjdXJyZW50LWFjdGl2ZS1lbnRpdHkiOwogICAgICB9CgogICAgICByZXR1cm4gcmV0dXJuX3ZhcjsKICAgIH0sCiAgICBzaG93X2VudGl0aWVzOiBmdW5jdGlvbiBzaG93X2VudGl0aWVzKGluZGV4KSB7CiAgICAgIHRoaXMuaXNFZGl0RW50aXR5ID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXggPSBpbmRleDsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHkuc3Vic3RyaW5nKDAsIDEpID09PSAiQCIpIHsKICAgICAgICB0aGlzLmlzX2F0X2luX2VudGl0eSA9IHRydWU7CiAgICAgICAgdmFyIGxlbiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5sZW5ndGg7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5zdWJzdHJpbmcoMSwgbGVuKTsKICAgICAgICB0aGlzLm9sZF9lbnRpdHlfbmFtZSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eS5zdWJzdHJpbmcoMSwgbGVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzX2F0X2luX2VudGl0eSA9IGZhbHNlOwogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHk7CiAgICAgICAgdGhpcy5vbGRfZW50aXR5X25hbWUgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS5lbnRpdHk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pZCA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmlkOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2hpZ2hsaWdodCA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmVudGl0eTsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3R5cGUgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS50eXBlOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl9uZWVkZWQgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS52YWxpZGF0aW9uX25lZWRlZDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZSA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbGlkYXRpb25fdHlwZTsgLy8gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlcyA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbHVlczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PSAncGF0dGVybicpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLnZhbHVlczsKICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PSAnc3lzdGVtJykgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9kZXNjcmlwdGlvbiA9IHRoaXMuZW50aXR5X2xpc3RbaW5kZXhdLmRlc2NyaXB0aW9uOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXMgPSB0aGlzLmVudGl0eV9saXN0W2luZGV4XS52YWx1ZXM7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2VudGl0eTogZnVuY3Rpb24gbG9hZF9lbnRpdHkoY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPSBmYWxzZTsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19nZXRfZW50aXR5OiB0cnVlLAogICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgX3RoaXMyLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICBfdGhpczIudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwoX3RoaXMyLm51bWJlcl9vZl9yb3dzIC8gX3RoaXMyLnBlcl9wYWdlKTsKICAgICAgICAgIF90aGlzMi5lbnRpdHlfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZW50aXR5X25hbWVzOwoKICAgICAgICAgIGlmIChfdGhpczIuZW50aXR5X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCkpIHsKICAgICAgICAgICAgICBfdGhpczIuc2hvd19lbnRpdGllcyhjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMyLnNob3dfZW50aXRpZXMoMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIuc2V0cGFnaW5hdGlvbihfdGhpczIucGFnZV9ubyk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczIuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZTogZnVuY3Rpb24gY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICBjYWxsc2VhcmNoOiBmdW5jdGlvbiBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICBpZiAodGhpcy5pc0VkaXRFbnRpdHkpIHsKICAgICAgICAgIHRoaXMudmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zZWFyY2hfZW50aXR5KCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VhcmNoX2VudGl0eTogZnVuY3Rpb24gc2VhcmNoX2VudGl0eShjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkVudGl0eSBEb2VzIG5vdCBFeGlzdHMiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJObyBSZXN1bHRzIEZvdW5kIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBfdGhpczMubG9hZF9lbnRpdHkoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT09ICJFbnRpdGllcyBTZWFyY2ggU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBfdGhpczMuZW50aXR5X2xpc3QgPSBbXTsKICAgICAgICAgICAgX3RoaXMzLnBhZ2Vfbm8gPSAxOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gInRva2VuIGludmFsaWQiKSB7CiAgICAgICAgICAgICAgX3RoaXMzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgX3RoaXMzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKF90aGlzMy5udW1iZXJfb2Zfcm93cyAvIF90aGlzMy5wZXJfcGFnZSk7CiAgICAgICAgICAgICAgX3RoaXMzLmVudGl0eV9saXN0ID0gcmVzcG9uc2UuZGF0YS5lbnRpdGllc19zZWFyY2g7CgogICAgICAgICAgICAgIGlmIChfdGhpczMuZW50aXR5X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMzLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5X2luZGV4KSkgewogICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd19lbnRpdGllcyhjdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczMuc2hvd19lbnRpdGllcygwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMy5zZXRwYWdpbmF0aW9uKF90aGlzMy5wYWdlX25vKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMzLmxvYWRfZW50aXR5KCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIkVudGVyIHByb3BlciBkYXRhIGZvciBzZWFyY2hpbmciLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGZpbGVfc3VibWl0OiBmdW5jdGlvbiBmaWxlX3N1Ym1pdCgpIHt9LAogICAgZmlsZWlucHV0X2NzdjogZnVuY3Rpb24gZmlsZWlucHV0X2NzdigpIHt9LAogICAgZG93bmxvYWRfc2FtcGxlX2ZpbGU6IGZ1bmN0aW9uIGRvd25sb2FkX3NhbXBsZV9maWxlKCkgey8vIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gdHJ1ZTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9lbnRpdGllc19uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgdGhpcy5zYXZlX25ld19lbnRpdGllcyA9ICcnLCB0aGlzLmVudGl0aWVzX3ZhbHVlX3R5cGUgPSAnc3lub255bXMnLCB0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3QgPSBbewogICAgICAgIHZhbHVlOiAnJywKICAgICAgICBzeW5vbnltczogWyIiXQogICAgICB9XSwgdGhpcy5wYXR0ZXJuX2xpc3QgPSBbewogICAgICAgIHBhdHRlcm46ICcnCiAgICAgIH1dLCB0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0c19lZGl0ID0gZmFsc2U7CiAgICAgIHRoaXMuZW50aXR5X2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICB9LAogICAgZG93bmxvYWRfY3N2OiBmdW5jdGlvbiBkb3dubG9hZF9jc3YoKSB7fSwKICAgIHRyYWluX21vZGVsOiBmdW5jdGlvbiB0cmFpbl9tb2RlbCgpIHt9LAogICAgZGVsZXRlX3NlbGVjdGVkOiBmdW5jdGlvbiBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGV4dDogIk5vIEVudGl0eSBTZWxlY3RlZCAhIiwKICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBkZWxldGVfZW50aXR5X2xpc3QgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgICAgZGVsZXRlX2VudGl0eV9saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0pOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgZGVsZXRlISEiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzNC5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzNC5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczQuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc19kZWxldGU6IHRydWUsCiAgICAgICAgICAgICAgZW50aXR5OiBkZWxldGVfZW50aXR5X2xpc3QKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM0LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgX3RoaXM0LmJpZ19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiRW50aXRpZXMgVmFsdWVzIERlbGV0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICJFbnRpdGllcyBkZWxldGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNC5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczQuZW50aXR5X2xpc3QubGVuZ3RoICYmIF90aGlzNC5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczQucGFnZV9ubyA9IF90aGlzNC5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczQuY2hlY2tlZF9saXN0ID0gW107CgogICAgICAgICAgICAgICAgX3RoaXM0LmxvYWRfZW50aXR5KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiVXNlZCBFbnRpdGllcyBWYWx1ZXMgRGVsZXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogIkVudGl0eSBoYXMgYmVlbiBkZWxldGVkLCB0aGF0IGlzIHVzZWQgaW4gZGlhbG9nIG5vZGUocykuIFBsZWFzZSBtb2RpZnkgdGhpcyBpbiBkaWFsb2cgbm9kZShzKSBhbHNvIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjogNzUwMCwKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJpbmZvIiAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgICAgICAvLyBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNC5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczQuZW50aXR5X2xpc3QubGVuZ3RoICYmIF90aGlzNC5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczQucGFnZV9ubyA9IF90aGlzNC5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpczQuY2hlY2tlZF9saXN0ID0gW107CgogICAgICAgICAgICAgICAgX3RoaXM0LmxvYWRfZW50aXR5KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiRW50aXR5IFZhbHVlcyBkb2VzIG5vdCBFeGlzdHMiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlRoZXJlIHdhcyBhbiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM0LmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkLiIpOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc2F2ZV9lbnRpdHk6IGZ1bmN0aW9uIHNhdmVfZW50aXR5KCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0c3MpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJBbiBFbnRpdHkgd2l0aCB0aGlzIG5hbWUgYWxyZWFkeSBleGlzdHMiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNhdmVfbmV3X2VudGl0aWVzID09PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbiBFbnRpdHkgbmFtZSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKEJvb2xlYW4odGhpcy52YWxpZGF0aW9uX25lZWRlZCkgJiYgIUJvb2xlYW4odGhpcy52YWxpZGF0aW9uX3R5cGUpKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCB2YWxpZGF0aW9uIHRvIHRoZSBlbnRpdHkiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDQ1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVudGl0aWVzX3ZhbHVlX3R5cGUgPT09ICdwYXR0ZXJuJykgewogICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnBhdHRlcm5fbGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnBhdHRlcm5fbGlzdFtpbmRleF1bJ3BhdHRlcm4nXSA9PT0gJycgfHwgdGhpcy5wYXR0ZXJuX2xpc3RbaW5kZXhdWydwYXR0ZXJuJ10gPT09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBhdHRlcm4gY2Fubm90IGJlIGJsYW5rIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lbnRpdGllc192YWx1ZV90eXBlID09PSAnc3lub255bXMnKSB7CiAgICAgICAgZm9yICh2YXIgX2luZGV4ID0gMDsgX2luZGV4IDwgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0Lmxlbmd0aDsgX2luZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbX2luZGV4XVsndmFsdWUnXSA9PT0gJycgfHwgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0W19pbmRleF1bJ3ZhbHVlJ10gPT09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlZhbHVlIGNhbm5vdCBiZSBibGFuayIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbX2luZGV4XVsnc3lub255bXMnXS5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAodGhpcy5zeW5vbnltc192YWx1ZV9saXN0W19pbmRleF1bJ3N5bm9ueW1zJ11bal0gPT09ICcnIHx8IHRoaXMuc3lub255bXNfdmFsdWVfbGlzdFtfaW5kZXhdWydzeW5vbnltcyddW2pdID09PSBudWxsKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiU3lub255bXMgY2Fubm90IGJlIGJsYW5rIiwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX2FkZF9lbnRpdHkoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgaXNfc2F2ZTogdHJ1ZSwKICAgICAgICBlbnRpdHlfZGV0YWlsczogewogICAgICAgICAgImVudGl0eSI6ICJAIiArIHRoaXMuc2F2ZV9uZXdfZW50aXRpZXMsCiAgICAgICAgICAidHlwZSI6IHRoaXMuZW50aXRpZXNfdmFsdWVfdHlwZSwKICAgICAgICAgICJ2YWxpZGF0aW9uX25lZWRlZCI6IHRoaXMudmFsaWRhdGlvbl9uZWVkZWQsCiAgICAgICAgICAidmFsaWRhdGlvbl90eXBlIjogdGhpcy52YWxpZGF0aW9uX25lZWRlZCA9PT0gdHJ1ZSA/IHRoaXMudmFsaWRhdGlvbl90eXBlIDogbnVsbCwKICAgICAgICAgICJ2YWx1ZXMiOiB0aGlzLmVudGl0aWVzX3ZhbHVlX3R5cGUgPT0gJ3BhdHRlcm4nID8gdGhpcy5wYXR0ZXJuX2xpc3QgOiB0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3QKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczUuYmlnX3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJFbnRpdHkgRGF0YSBTYXZlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogInZhbHVlIHNhdmVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICAkKCIjZW50aXR5bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgIF90aGlzNS5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgIF90aGlzNS5sb2FkX2VudGl0eSgpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludmFsaWQgUmVnZXggcGF0dGVybiIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIHRleHQ6ICJJbnZhbGlkIFBhdHRlcm4hIFBsZWFzZSBlbnRlciBhIHByb3BlciBwYXR0ZXJuIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczUuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIik7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZWRpdF9lbnRpdHk6IGZ1bmN0aW9uIGVkaXRfZW50aXR5KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmVudGl0eV9hbHJlYWR5X2V4aXN0c19lZGl0KSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiQW4gRW50aXR5IHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5vbGRfZW50aXR5X25hbWUgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSkgewogICAgICAgIHZhciBlbnRpdHlfdG9fc2VuZCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVudGl0eV90b19zZW5kID0gdGhpcy5pc19hdF9pbl9lbnRpdHkgPT0gZmFsc2UgPyB0aGlzLm9sZF9lbnRpdHlfbmFtZSA6ICJAIiArIHRoaXMub2xkX2VudGl0eV9uYW1lOwogICAgICB9CgogICAgICBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSA9PT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYW4gRW50aXR5IG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChCb29sZWFuKHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWxpZGF0aW9uX25lZWRlZCkgJiYgIUJvb2xlYW4odGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbGlkYXRpb25fdHlwZSkpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugc2VsZWN0IHZhbGlkYXRpb24gdG8gdGhlIGVudGl0eSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogNDUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF90eXBlID09PSAncGF0dGVybicpIHsKICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3BhdHRlcm4ubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX3BhdHRlcm5baW5kZXhdWydwYXR0ZXJuJ10gPT09ICcnIHx8IHRoaXMuY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuW2luZGV4XVsncGF0dGVybiddID09PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJQYXR0ZXJuIGNhbm5vdCBiZSBibGFuayIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAzNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF90eXBlID09PSAnc3lub255bXMnKSB7CiAgICAgICAgZm9yICh2YXIgX2luZGV4MiA9IDA7IF9pbmRleDIgPCB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzLmxlbmd0aDsgX2luZGV4MisrKSB7CiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlc1tfaW5kZXgyXVsndmFsdWUnXSA9PT0gJycgfHwgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlc1tfaW5kZXgyXVsndmFsdWUnXSA9PT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiVmFsdWUgY2Fubm90IGJlIGJsYW5rIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ10ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ11bal0gPT09ICcnIHx8IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbX2luZGV4Ml1bJ3N5bm9ueW1zJ11bal0gPT09IG51bGwpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJTeW5vbnltcyBjYW5ub3QgYmUgYmxhbmsiLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDM1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fYWRkX2VudGl0eSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgIG9sZF9lbnRpdHlfbmFtZTogZW50aXR5X3RvX3NlbmQsCiAgICAgICAgZW50aXR5OiB0aGlzLmlzX2F0X2luX2VudGl0eSA9PSBmYWxzZSA/IHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgOiAiQCIgKyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5LAogICAgICAgIGVkaXRfZW50aXR5X2RldGFpbDogewogICAgICAgICAgInR5cGUiOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSwKICAgICAgICAgICJpZCI6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pZCwKICAgICAgICAgICJ2YWxpZGF0aW9uX25lZWRlZCI6IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWxpZGF0aW9uX25lZWRlZCwKICAgICAgICAgICJ2YWxpZGF0aW9uX3R5cGUiOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl9uZWVkZWQgPT09IHRydWUgPyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsaWRhdGlvbl90eXBlIDogbnVsbCwKICAgICAgICAgICJ2YWx1ZXMiOiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdHlwZSA9PSAncGF0dGVybicgPyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfcGF0dGVybiA6IHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXMKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczYuYmlnX3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJFbnRpdGllcyBEYXRhIEVkaXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogIkVudGl0eSBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB0aW1lcjogMzUwMCwKICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICB9KTsgLy8gdGhpcy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgIGlmIChfdGhpczYuaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczYuc2VhcmNoX2VudGl0eShfdGhpczYuY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM2LmxvYWRfZW50aXR5KF90aGlzNi5jdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiVXNlZCBFbnRpdGllcyBEYXRhIEVkaXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogIkVudGl0eSBoYXMgYmVlbiBlZGl0ZWQsIHRoYXQgaXMgdXNlZCBpbiBkaWFsb2cgbm9kZShzKS4gUGxlYXNlIG1vZGlmeSB0aGlzIGluIGRpYWxvZyBub2RlKHMpIGFsc28iLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRpbWVyOiA3NTAwLAogICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAvLyBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIC8vIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKCiAgICAgICAgICB9KTsgLy8gdGhpcy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgIGlmIChfdGhpczYuaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczYuc2VhcmNoX2VudGl0eShfdGhpczYuY3VycmVudF9zZWxlY3RlZF9lbnRpdHlfaW5kZXgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM2LmxvYWRfZW50aXR5KF90aGlzNi5jdXJyZW50X3NlbGVjdGVkX2VudGl0eV9pbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczYuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIik7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VhcmNoX2VudGl0aWVzX25hbWU6IGZ1bmN0aW9uIHNlYXJjaF9lbnRpdGllc19uYW1lKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9hZGRfZW50aXR5KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19zZWFyY2hfZW50aXR5OiB0cnVlLAogICAgICAgIGVudGl0eTogIkAiICsgdGhpcy5zYXZlX25ld19lbnRpdGllcwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJOb3QgRXhpc3RzIikgewogICAgICAgICAgX3RoaXM3LmVudGl0eV9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0aWVzX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChfdGhpczcuc2F2ZV9uZXdfZW50aXRpZXMgIT0gIiIpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0aWVzX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFscmVhZHkgRXhpc3RzIikgewogICAgICAgICAgX3RoaXM3LmVudGl0eV9hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXRpZXNfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlbnRlcl9lbnRpdHlfZWRpdDogZnVuY3Rpb24gZW50ZXJfZW50aXR5X2VkaXQoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX2FkZF9lbnRpdHkoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgIGlzX3NlYXJjaF9lbnRpdHk6IHRydWUsCiAgICAgICAgZW50aXR5OiB0aGlzLmlzX2F0X2luX2VudGl0eSA9PSBmYWxzZSA/IHRoaXMuY3VycmVudF9zZWxlY3RlZF9lbnRpdHkgOiAiQCIgKyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vdCBFeGlzdHMiKSB7CiAgICAgICAgICBfdGhpczguZW50aXR5X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9lbnRpdHlfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2VudGl0eSAhPSAiIikgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXR5X2VkaXRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFscmVhZHkgRXhpc3RzIikgewogICAgICAgICAgaWYgKF90aGlzOC5vbGRfZW50aXR5X25hbWUgPT0gX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfZW50aXR5KSB7CiAgICAgICAgICAgIF90aGlzOC5lbnRpdHlfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfZW50aXR5X2VkaXRfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXM4LmVudGl0eV9hbHJlYWR5X2V4aXN0c19lZGl0ID0gdHJ1ZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2VudGl0eV9lZGl0X2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVkaXRfZW50aXR5X2RldGFpbHM6IGZ1bmN0aW9uIGVkaXRfZW50aXR5X2RldGFpbHMoKSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRFbnRpdHkpIHsKICAgICAgICB0aGlzLmlzRWRpdEVudGl0eSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRFbnRpdHkgPSBmYWxzZTsKICAgICAgICB0aGlzLmxvYWRfZW50aXR5KCk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX3JlcXVpcmU6IGZ1bmN0aW9uIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7fSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PSAiIikgewogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fYWRkX2VudGl0eSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgIGlzX2dldF9lbnRpdHk6IHRydWUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiRW50aXR5IERhdGEgRXhpc3RzIikgewogICAgICAgICAgICAgIF90aGlzOS5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIF90aGlzOS50b3RhbF9wYWdlcyA9IE1hdGguY2VpbChfdGhpczkubnVtYmVyX29mX3Jvd3MgLyBfdGhpczkucGVyX3BhZ2UpOwogICAgICAgICAgICAgIF90aGlzOS5lbnRpdHlfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZW50aXR5X25hbWVzOwoKICAgICAgICAgICAgICBpZiAoX3RoaXM5LmVudGl0eV9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIF90aGlzOS5zaG93X2VudGl0aWVzKDApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXM5LnNldHBhZ2luYXRpb24oX3RoaXM5LnBhZ2Vfbm8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CgogICAgICAgICAgaWYgKHRoaXMucGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2VubzsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fYWRkX2VudGl0eSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczkuZW50aXR5X2xpc3QgPSBbXTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmVudGl0aWVzX3NlYXJjaC5sZW5ndGgpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIpIHsKICAgICAgICAgICAgICAgIF90aGlzOS5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgICAgX3RoaXM5LnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKF90aGlzOS5udW1iZXJfb2Zfcm93cyAvIF90aGlzOS5wZXJfcGFnZSk7CiAgICAgICAgICAgICAgICBfdGhpczkuZW50aXR5X2xpc3QgPSByZXNwb25zZS5kYXRhLmVudGl0aWVzX3NlYXJjaDsKCiAgICAgICAgICAgICAgICBfdGhpczkuc2V0cGFnaW5hdGlvbihfdGhpczkucGFnZV9ubyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJFbnRpdHkgRG9lcyBub3QgRXhpc3RzIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogIk5vIFJlc3VsdCBGb3VuZCIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczkubG9hZF9lbnRpdHkoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzOS5sb2FkX2VudGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgNDsgX2krKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2kyID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IF9pMiA8IHRoaXMudG90YWxfcGFnZXM7IF9pMisrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTIgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgcGFnZV9ubyArIDM7IF9pMysrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTMgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNCA9IHBhZ2Vfbm8gLSA0OyBfaTQgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNSA9IHBhZ2Vfbm8gLSAzOyBfaTUgPD0gcGFnZV9ubyArIDM7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3M6IGZ1bmN0aW9uIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgZW50aXR5X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzOiBmdW5jdGlvbiBlbnRpdHlfbmFtZV9jaGVja19zcGVjaWFsX2NoYXJhY3RlcnMoZSkgewogICAgICBpZiAoL15bXmEtekEtWjAtOV8gXSokLy50ZXN0KGUua2V5KSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSwKICAgIGFkZF90b19wYXR0ZXJuX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b19wYXR0ZXJuX2xpc3QodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICB0aGlzLnBhdHRlcm5fbGlzdC51bnNoaWZ0KHsKICAgICAgICAgIHBhdHRlcm46ICcnCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMucGF0dGVybl9saXN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfdG9fcGF0dGVybl9saXN0X2VkaXQ6IGZ1bmN0aW9uIGFkZF90b19wYXR0ZXJuX2xpc3RfZWRpdCh0eXBlLCBpbmRleCkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9wYXR0ZXJuLnVuc2hpZnQoewogICAgICAgICAgcGF0dGVybjogJycKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3BhdHRlcm4uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF90b192YWx1ZXNfbGlzdDogZnVuY3Rpb24gYWRkX3RvX3ZhbHVlc19saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0LnVuc2hpZnQoewogICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgc3lub255bXM6IFsiIl0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5zeW5vbnltc192YWx1ZV9saXN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfdG9fdmFsdWVzX2xpc3RfZWRpdDogZnVuY3Rpb24gYWRkX3RvX3ZhbHVlc19saXN0X2VkaXQodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfdmFsdWVzLnVuc2hpZnQoewogICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgc3lub255bXM6IFsiIl0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3N5bm9ueW1zX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b19zeW5vbnltc19saXN0KHR5cGUsIGluZGV4LCBpbmRleDEpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICB0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbaW5kZXhdWydzeW5vbnltcyddLnVuc2hpZnQoIiIpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLnN5bm9ueW1zX3ZhbHVlX2xpc3RbaW5kZXhdWydzeW5vbnltcyddLnNwbGljZShpbmRleDEsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3N5bm9ueW1zX2xpc3RfZWRpdDogZnVuY3Rpb24gYWRkX3RvX3N5bm9ueW1zX2xpc3RfZWRpdCh0eXBlLCBpbmRleCwgaW5kZXgxKSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3ZhbHVlc1tpbmRleF1bJ3N5bm9ueW1zJ10udW5zaGlmdCgiIik7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF92YWx1ZXNbaW5kZXhdWydzeW5vbnltcyddLnNwbGljZShpbmRleDEsIDEpOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfZW50aXRpZXM6IGZ1bmN0aW9uIHNlbGVjdGVkX2VudGl0aWVzKGVudGl0eV9uYW1lKSB7CiAgICAgIGlmIChlbnRpdHlfbmFtZSA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdmFyIHRlbXAgPSBbXTsKICAgICAgICAgIHRlbXAgPSB0aGlzLmVudGl0eV9saXN0LmZpbHRlcihmdW5jdGlvbiAoZW50aXR5KSB7CiAgICAgICAgICAgIHJldHVybiBlbnRpdHkudHlwZSAhPSAnc3lzdGVtJzsKICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS5lbnRpdHk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICQoIiNlbnRpdHlfY2hlY2tib3hfIiArIFtpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHZhbF9pbmRleCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoZW50aXRlcykgewogICAgICAgICAgICByZXR1cm4gZW50aXRlcy5lbnRpdHlfbmFtZSA9PSBlbnRpdHlfbmFtZTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICh2YWxfaW5kZXgubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaChlbnRpdHlfbmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcihmdW5jdGlvbiAoZW50aXRlcykgewogICAgICAgICAgICByZXR1cm4gZW50aXRlcyAhPSBlbnRpdHlfbmFtZTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gX3RlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}