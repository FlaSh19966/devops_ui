{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/HR Management/HrScheduler.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/HR Management/HrScheduler.vue","mtime":1655466542524},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsgLy8gaW1wb3J0IFRpbWVQaWNrZXIgZnJvbSAiYW50LWRlc2lnbi12dWUvbGliL3RpbWUtcGlja2VyIjsKCmltcG9ydCBDYWxlbmRhciBmcm9tICIuLi8uLi8uLi8uLi8uLi9wdWJsaWMvanMvdHVpLWNhbGVuZGFyLm1pbi5qcyI7CmltcG9ydCBEYXRlUGlja2VyIGZyb20gInR1aS1kYXRlLXBpY2tlciI7CmltcG9ydCAidHVpLWRhdGUtcGlja2VyL2Rpc3QvdHVpLWRhdGUtcGlja2VyLmNzcyI7CmltcG9ydCAiLi4vLi4vLi4vLi4vLi4vcHVibGljL2Nzcy9zZWdvZS11aS5jc3MiOwppbXBvcnQgIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9jc3MvdHVpLWNhbGVuZGFyLm1pbi5jc3MiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkludGVydmlldyBTY2hlZHVsZXIiLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjYWxlbmRhckluc3RhbmNlOiBudWxsLAogICAgICBjdXJyZW50X2NhbGVuZGFyX3ZpZXc6ICdkYXknLAogICAgICBzaG93X3NwaW5uZXI6IGZhbHNlLAogICAgICBzZWxlY3RlZF90aW1lOiAiIiwKICAgICAgZGlzcGxheV9zZWxlY3RlZF90aW1lOiAiIiwKICAgICAgc2NoZWR1bGVkX3RpbWU6ICIiLAogICAgICBzZWxlY3RlZF9kYXRlOiAiIiwKICAgICAgY2FuZGlkYXRlX25hbWU6ICIiLAogICAgICB2aXNpdG9yX251bWJlcjogIiIsCiAgICAgIGNhbmRpZGF0ZV9wb3NpdGlvbjogIiIsCiAgICAgIGNhbmRpZGF0ZV9lbWFpbDogIiIsCiAgICAgIHNjaGVkdWxlX2xpc3Q6IFtdLAogICAgICBzZWxlY3RlZF9zY2hlZHVsZV9pZDogIiIsCiAgICAgIHNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Q6ICIiLAogICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBwaG9uZV9udW1iZXJfdmFsaWRpdHk6IC9cK1swLTldezksMTR9JC8sCiAgICAgIGZ1bGxfdGltZV9zbG90czogW10sCiAgICAgIHRpbWVfc2xvdHM6IFtdLAogICAgICB3b3JraW5nX2hyczogewogICAgICAgICJNb25kYXkiOiBbXSwKICAgICAgICAiVHVlc2RheSI6IFtdLAogICAgICAgICJXZWRuZXNkYXkiOiBbXSwKICAgICAgICAiVGh1cnNkYXkiOiBbXSwKICAgICAgICAiRnJpZGF5IjogW10sCiAgICAgICAgIlNhdHVyZGF5IjogW10sCiAgICAgICAgIlN1bmRheSI6IFtdCiAgICAgIH0sCiAgICAgIHNlbGVjdGVkX3RpbWVfc2xvdDogIiIsCiAgICAgIGJ1ZmZlcl90aW1lX3BlcmlvZDogIiIsCiAgICAgIG1pbmltdW1fbm90aWNlX2RheXM6ICIiLAogICAgICBtZWV0aW5nX2RheXNfcmFuZ2U6ICIiLAogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICBzY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBGaWxlIiwKICAgICAgd2Vla19kYXlzOiBbIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiLCAiU3VuZGF5Il0sCiAgICAgIGRheXNJbk1vbnRoOiBbXSwKICAgICAgYWN0aXZlTW9udGhZZWFyOiAnJywKICAgICAgY3N2X2ZpbGU6ICIiLAogICAgICBzaG93X2NoZWNrX2FuZF9jaGFuZ2Vfc3RhdHVzOiB0cnVlLAogICAgICB1c2VyX3R5cGU6IG51bGwsCiAgICAgIHZpc2l0X3N0YXR1c19kYXRhOiBudWxsLAogICAgICB2aXNpdF9zdGF0dXNfY29tcGFyaXNvbl9kYXRhOiBbXSwKICAgICAgZGFpbHlfZGF0ZTogIiIsCiAgICAgIGlzUmVzY2hlZHVsZTogdHJ1ZSwKICAgICAgZGF0ZXBpY2tlckluc3RhbmNlOiBudWxsLAogICAgICBuZXdfc2VsZWN0ZWRfZGF0ZTogIiIsCiAgICAgIGVkaXRfc2NoZWR1bGluZzogZmFsc2UsCiAgICAgIHRlbXBfZGF0YTogIiIsCiAgICAgIGlzQXBwb2ludG1lbnRDb25maXJtZWQ6IGZhbHNlLAogICAgICBhcHBvaW50bWVudFN0YXR1czogIiIsCiAgICAgIHZpc2l0U3RhdHVzOiAiIiwKICAgICAgQXBwb2ludG1lbnRJRDogJycsCiAgICAgIGlzUmVzY2hlZHVsZXRpbWU6IGZhbHNlLAogICAgICB0ZW1wX25hbWU6ICIiLAogICAgICB0ZW1wX3Bvc2l0aW9uOiAiIiwKICAgICAgdGVtcF9lbWFpbDogIiIsCiAgICAgIHRlbXBfYXBwb2ludG1lbnRfZGF0ZTogIiIsCiAgICAgIHRlbXBfYXBwb2ludG1lbnRfdGltZTogIiIsCiAgICAgIHRlbXBfdGltZV9zbG90czogW10sCiAgICAgIGNvbXBhbnlpZDogIiIsCiAgICAgIGNvbXBhbnluYW1lOiAiIiwKICAgICAgc3VwcG9ydF9udW1iZXJzX2xpc3Q6IFtdLAogICAgICBmaWxsZWRfdGltZV9zbG90c19zZWxlY3RlZF9kYXRlOiBbXQogICAgfTsKICB9LAogIGNvbXBvbmVudHM6IHsvLyBUaW1lUGlja2VyCiAgfSwKICBjb21wdXRlZDogewogICAgdmFsaWRQaG9uZU51bWJlcjogZnVuY3Rpb24gdmFsaWRQaG9uZU51bWJlcigpIHsKICAgICAgaWYgKHRoaXMucGhvbmVfbnVtYmVyX3ZhbGlkaXR5LnRlc3QodGhpcy5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyLnJlcGxhY2UoL1xzKy9nLCAnJykpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBwaG9uZSBudW1iZXIgaW4gdGhlIGZvcm1hdDogK0NvdW50cnlDb2RlIE51bWJlciI7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVNb2RhbFRpdGxlOiBmdW5jdGlvbiBjcmVhdGVNb2RhbFRpdGxlKCkgewogICAgICByZXR1cm4gdGhpcy5jYW5kaWRhdGVfbmFtZS5zcGxpdCgnICcpLnNsaWNlKDAsIDEpLm1hcChmdW5jdGlvbiAod29yZCkgewogICAgICAgIHJldHVybiB3b3JkLmNoYXJBdCgwKTsKICAgICAgfSkuam9pbignJykudG9VcHBlckNhc2UoKTsKICAgIH0sCiAgICB0aW1lU2xvdHNMaXN0OiBmdW5jdGlvbiB0aW1lU2xvdHNMaXN0KCkgewogICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gMjM7IGkgKz0gMSkgewogICAgICAgIGxpc3QucHVzaCh7CiAgICAgICAgICBkaXNwbGF5OiBtb21lbnQoaSwgWydoJ10pLmZvcm1hdCgnaDptbSBBJyksCiAgICAgICAgICB2YWx1ZTogbW9tZW50KGksIFsnaCddKS5mb3JtYXQoJ0g6bW0nKQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gbGlzdDsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBjdXJyZW50X2NhbGVuZGFyX3ZpZXc6IGZ1bmN0aW9uIGN1cnJlbnRfY2FsZW5kYXJfdmlldyhuZXdWYWwpIHsKICAgICAgdGhpcy50b2dnbGVfdmlldyhuZXdWYWwpOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgdmFyIHZtID0gdGhpczsKICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZSA9IG5ldyBDYWxlbmRhcigiI2NhbGVuZGFyIiwgewogICAgICBkZWZhdWx0VmlldzogImRheSIsCiAgICAgIHRhc2tWaWV3OiBmYWxzZSwKICAgICAgc2NoZWR1bGVWaWV3OiBbInRpbWUiXSwKICAgICAgdGhlbWU6IHsKICAgICAgICAnbW9udGguZGF5bmFtZS50ZXh0QWxpZ24nOiAnY2VudGVyJywKICAgICAgICAnbW9udGguZGF5bmFtZS50ZXh0VHJhbnNmb3JtJzogJ3VwcGVyY2FzZScsCiAgICAgICAgJ3dlZWsuZGF5bmFtZS5ib3JkZXJMZWZ0JzogJzFweCBzb2xpZCAjREZERkRGJywKICAgICAgICAnbW9udGguc2NoZWR1bGUuYm9yZGVyUmFkaXVzJzogJzJweCcsCiAgICAgICAgJ21vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCc6ICcycHgnLAogICAgICAgICdtb250aC5zY2hlZHVsZS5tYXJnaW5MZWZ0JzogJzhweCcsCiAgICAgICAgJ21vbnRoLnNjaGVkdWxlLm1hcmdpblJpZ2h0JzogJzhweCcsCiAgICAgICAgJ3dlZWsuZGF5Z3JpZC5iYWNrZ3JvdW5kQ29sb3InOiAnbm9uZScsCiAgICAgICAgJ3dlZWsuZGF5bmFtZS50ZXh0QWxpZ24nOiAnY2VudGVyJywKICAgICAgICAnd2Vlay5kYXluYW1lLnRleHRUcmFuc2Zvcm0nOiAndXBwZXJjYXNlJywKICAgICAgICAnd2Vlay50aW1lZ3JpZEhvcml6b250YWxMaW5lLmJvcmRlckJvdHRvbSc6ICcxcHggZGFzaGVkICNGMUYxRjEnLAogICAgICAgICd3ZWVrLnRpbWVncmlkLmJvcmRlclJpZ2h0JzogJzFweCBzb2xpZCAjREZERkRGJwogICAgICB9LAogICAgICB0ZW1wbGF0ZTogewogICAgICAgIG1vbnRoR3JpZEhlYWRlcjogZnVuY3Rpb24gbW9udGhHcmlkSGVhZGVyKGRheU1vZGVsKSB7CiAgICAgICAgICB2YXIgZGF0ZSA9IG1vbWVudChkYXlNb2RlbC5kYXRlLCBbJ1lZWVktTU0tREQnXSkuZm9ybWF0KCdERCcpOwogICAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBbJ3R1aS1mdWxsLWNhbGVuZGFyLXdlZWtkYXktZ3JpZC1kYXRlICddOwoKICAgICAgICAgIGlmIChkYXlNb2RlbC5pc1RvZGF5KSB7CiAgICAgICAgICAgIGNsYXNzTmFtZXMucHVzaCgndHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1ncmlkLWRhdGUtZGVjb3JhdG9yJyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIGNsYXNzTmFtZXMuam9pbignICcpICsgJyI+JyArIGRhdGUgKyAnPC9zcGFuPic7CiAgICAgICAgfSwKICAgICAgICBtb250aERheW5hbWU6IGZ1bmN0aW9uIG1vbnRoRGF5bmFtZShtb2RlbCkgewogICAgICAgICAgcmV0dXJuICI8c3BhbiBzdHlsZT1cImNvbG9yOiM5NTk1OTVcIj4iLmNvbmNhdChtb2RlbC5sYWJlbC50b1N0cmluZygpLnRvTG9jYWxlVXBwZXJDYXNlKCksICI8L3NwYW4+Iik7CiAgICAgICAgfSwKICAgICAgICB3ZWVrRGF5bmFtZTogZnVuY3Rpb24gd2Vla0RheW5hbWUobW9kZWwpIHsKICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9InR1aS1mdWxsLWNhbGVuZGFyLWRheW5hbWUtZGF0ZSI+PC9zcGFuPiZuYnNwOyZuYnNwOzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1kYXluYW1lLW5hbWUiPicgKyBtb2RlbC5kYXlOYW1lLnRvTG9jYWxlVXBwZXJDYXNlKCkgKyAnPC9zcGFuPic7CiAgICAgICAgfQogICAgICB9LAogICAgICB1c2VDcmVhdGlvblBvcHVwOiBmYWxzZSwKICAgICAgdXNlRGV0YWlsUG9wdXA6IGZhbHNlCiAgICB9KTsKICAgIHRoaXMuY3VycmVudF9jYWxlbmRhcl92aWV3ID0gImRheSI7CiAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2Uub24oImNsaWNrRGF5bmFtZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmICh2bS5jYWxlbmRhckluc3RhbmNlLmdldFZpZXdOYW1lKCkgPT09ICJ3ZWVrIikgewogICAgICAgIHZtLmNhbGVuZGFySW5zdGFuY2Uuc2V0RGF0ZShuZXcgRGF0ZShlLmRhdGUpKTsKICAgICAgICB2bS5jYWxlbmRhckluc3RhbmNlLmNoYW5nZVZpZXcoImRheSIsIHRydWUpOwogICAgICAgIHRoaXMuY3VycmVudF9jYWxlbmRhcl92aWV3ID0gImRheSI7CiAgICAgICAgdm0uc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJhZnRlclJlbmRlclNjaGVkdWxlIiwgZnVuY3Rpb24gKGUpIHt9KTsKICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2Uub24oImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgX3RoaXMubmV3X3NjaGVkdWxlKGUuc3RhcnQuX2RhdGUpOwoKICAgICAgZS5ndWlkZS5jbGVhckd1aWRlRWxlbWVudCgpOwogICAgfSk7CiAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2Uub24oImNsaWNrU2NoZWR1bGUiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LnNjaGVkdWxlLnJhdy5pc0hvbGlkYXkpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIllvdSBjYW5ub3QgZW50ZXIgYSBzY2hlZHVsZSBmb3IgdGhpcyBkYXRlLiBcbiBSZWFzb246ICIgKyBldmVudC5zY2hlZHVsZS5yYXcucmVhc29uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc2NoZWR1bGUgPSBldmVudC5zY2hlZHVsZTsKICAgICAgICB2bS5jYW5kaWRhdGVfbmFtZSA9IHNjaGVkdWxlLnRpdGxlOwogICAgICAgIHZtLmNhbmRpZGF0ZV9wb3NpdGlvbiA9IHNjaGVkdWxlLnJhdy5jYW5kaWRhdGVfcG9zaXRpb247CiAgICAgICAgdm0uY2FuZGlkYXRlX2VtYWlsID0gc2NoZWR1bGUucmF3LmNhbmRpZGF0ZV9lbWFpbDsKICAgICAgICB2bS52aXNpdG9yX251bWJlciA9IHNjaGVkdWxlLnJhdy5waG9uZV9udW1iZXI7CiAgICAgICAgdmFyIHNlbGVjdGVkX3RpbWUgPSBzY2hlZHVsZS5yYXcuc3RhcnQgKyAiLSIgKyBzY2hlZHVsZS5yYXcuZW5kOwogICAgICAgIHZhciBzZWxlY3RlZF90aW1lX3N0YXJ0ID0gbW9tZW50KHNjaGVkdWxlLnJhdy5zdGFydCwgWydISDptbSddKS5mb3JtYXQoJ2hoOm1tIEEnKTsKICAgICAgICB2YXIgc2VsZWN0ZWRfdGltZV9lbmQgPSBtb21lbnQoc2NoZWR1bGUucmF3LmVuZCwgWydISDptbSddKS5mb3JtYXQoJ2hoOm1tIEEnKTsKICAgICAgICB2bS5kaXNwbGF5X3NlbGVjdGVkX3RpbWUgPSAiIi5jb25jYXQoc2VsZWN0ZWRfdGltZV9zdGFydCwgIiAtICIpLmNvbmNhdChzZWxlY3RlZF90aW1lX2VuZCk7CiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfaWQgPSBzY2hlZHVsZS5pZDsKICAgICAgICB2bS5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90ID0gc2NoZWR1bGUucmF3LnZpc2l0X3Nsb3Q7CiAgICAgICAgdm0uZ2V0X3RpbWVfc2xvdHMoc2NoZWR1bGUuc3RhcnQuX2RhdGUsICIjc2NoZWR1bGVfZGV0YWlscyIsIHNlbGVjdGVkX3RpbWUpOwogICAgICAgIHZtLmFwcG9pbnRtZW50U3RhdHVzID0gc2NoZWR1bGUucmF3LmFwcG9pbnRtZW50X3N0YXR1czsKICAgICAgICB2bS5BcHBvaW50bWVudElEID0gc2NoZWR1bGUucmF3LmFwcG9pbnRtZW50X2lkOwogICAgICAgIHZtLnZpc2l0U3RhdHVzID0gc2NoZWR1bGUucmF3LnZpc2l0X3N0YXR1czsKICAgICAgICB2bS5vcGVuQ2hlY2tBbmRDaGFuZ2VTdGF0dXNNb2RhbChzY2hlZHVsZS5yYXcuYXBwb2ludG1lbnRfaWQsIHNjaGVkdWxlLnN0YXJ0Ll9kYXRlKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgJCgiI3NjaGVkdWxlX2RldGFpbHMiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXZtLmVkaXRfc2NoZWR1bGluZykgewogICAgICAgIHZtLmNhbmRpZGF0ZV9uYW1lID0gIiI7CiAgICAgICAgdm0uY2FuZGlkYXRlX3Bvc2l0aW9uID0gIiI7CiAgICAgICAgdm0uY2FuZGlkYXRlX2VtYWlsID0gIiI7CiAgICAgICAgdm0udmlzaXRvcl9udW1iZXIgPSAiIjsKICAgICAgICB2bS5zZWxlY3RlZF90aW1lID0gIiI7CiAgICAgICAgdm0uaXNFZGl0ID0gZmFsc2U7CiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfaWQgPSAiIjsKICAgICAgICB2bS5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90ID0gIiI7CiAgICAgICAgdm0uaXNSZXNjaGVkdWxldGltZSA9IGZhbHNlOwogICAgICAgIHZtLmVkaXRfc2NoZWR1bGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKICAgICQoIiNzY2hlZHVsZV9jcmVhdGUiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICB2bS5jYW5kaWRhdGVfbmFtZSA9ICIiOwogICAgICB2bS5jYW5kaWRhdGVfcG9zaXRpb24gPSAiIjsKICAgICAgdm0uY2FuZGlkYXRlX2VtYWlsID0gIiI7CiAgICAgIHZtLnZpc2l0b3JfbnVtYmVyID0gIiI7CiAgICAgIHZtLnNlbGVjdGVkX3RpbWUgPSAiIjsKICAgIH0pOwogICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICB2bS5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyID0gIiI7CiAgICAgIHZtLmNzdl9maWxlID0gIiI7CiAgICAgIHZtLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIEZpbGUiOwogICAgfSk7CiAgICB2YXIgeCwKICAgICAgICBpLAogICAgICAgIGosCiAgICAgICAgbCwKICAgICAgICBsbCwKICAgICAgICBzZWxFbG1udCwKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICB2bSA9IHRoaXM7CiAgICAvKmxvb2sgZm9yIGFueSBlbGVtZW50cyB3aXRoIHRoZSBjbGFzcyAiY3VzdG9tLXNjaGVkdWxlci1zZWxlY3QiOiovCgogICAgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImN1c3RvbS1zY2hlZHVsZXItc2VsZWN0Iik7CiAgICBsID0geC5sZW5ndGg7CgogICAgZm9yIChpID0gMDsgaSA8IGw7IGkrKykgewogICAgICBzZWxFbG1udCA9IHhbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNlbGVjdCIpWzBdOwogICAgICBsbCA9IHNlbEVsbW50Lmxlbmd0aDsKICAgICAgLypmb3IgZWFjaCBlbGVtZW50LCBjcmVhdGUgYSBuZXcgRElWIHRoYXQgd2lsbCBhY3QgYXMgdGhlIHNlbGVjdGVkIGl0ZW06Ki8KCiAgICAgIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsKICAgICAgYS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInNlbGVjdC1zZWxlY3RlZCIpOwogICAgICBhLmlubmVySFRNTCA9IHNlbEVsbW50Lm9wdGlvbnNbc2VsRWxtbnQuc2VsZWN0ZWRJbmRleF0uaW5uZXJIVE1MOwogICAgICB4W2ldLmFwcGVuZENoaWxkKGEpOwogICAgICAvKmZvciBlYWNoIGVsZW1lbnQsIGNyZWF0ZSBhIG5ldyBESVYgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIG9wdGlvbiBsaXN0OiovCgogICAgICBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7CiAgICAgIGIuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzZWxlY3QtaXRlbXMgc2VsZWN0LWhpZGUiKTsKCiAgICAgIGZvciAoaiA9IDE7IGogPCBsbDsgaisrKSB7CiAgICAgICAgLypmb3IgZWFjaCBvcHRpb24gaW4gdGhlIG9yaWdpbmFsIHNlbGVjdCBlbGVtZW50LAogICAgICAgIGNyZWF0ZSBhIG5ldyBESVYgdGhhdCB3aWxsIGFjdCBhcyBhbiBvcHRpb24gaXRlbToqLwogICAgICAgIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsKICAgICAgICBjLmlubmVySFRNTCA9IHNlbEVsbW50Lm9wdGlvbnNbal0uaW5uZXJIVE1MOwogICAgICAgIGMuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgLyp3aGVuIGFuIGl0ZW0gaXMgY2xpY2tlZCwgdXBkYXRlIHRoZSBvcmlnaW5hbCBzZWxlY3QgYm94LAogICAgICAgICAgYW5kIHRoZSBzZWxlY3RlZCBpdGVtOiovCiAgICAgICAgICB2YXIgeSwgaSwgaywgcywgaCwgc2wsIHlsOwogICAgICAgICAgcyA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZWxlY3QiKVswXTsKICAgICAgICAgIHNsID0gcy5sZW5ndGg7CiAgICAgICAgICBoID0gdGhpcy5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZzsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2w7IGkrKykgewogICAgICAgICAgICBpZiAocy5vcHRpb25zW2ldLmlubmVySFRNTCA9PSB0aGlzLmlubmVySFRNTCkgewogICAgICAgICAgICAgIHMuc2VsZWN0ZWRJbmRleCA9IGk7CiAgICAgICAgICAgICAgaC5pbm5lckhUTUwgPSB0aGlzLmlubmVySFRNTDsKICAgICAgICAgICAgICB5ID0gdGhpcy5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInNhbWUtYXMtc2VsZWN0ZWQiKTsKICAgICAgICAgICAgICB5bCA9IHkubGVuZ3RoOwoKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgeWw7IGsrKykgewogICAgICAgICAgICAgICAgeVtrXS5yZW1vdmVBdHRyaWJ1dGUoImNsYXNzIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic2FtZS1hcy1zZWxlY3RlZCIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaC5jbGljaygpOwogICAgICAgICAgdm0uY3VycmVudF9jYWxlbmRhcl92aWV3ID0gc2VsRWxtbnQudmFsdWU7CiAgICAgICAgfSk7CiAgICAgICAgYi5hcHBlbmRDaGlsZChjKTsKICAgICAgfQoKICAgICAgeFtpXS5hcHBlbmRDaGlsZChiKTsKICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgLyp3aGVuIHRoZSBzZWxlY3QgYm94IGlzIGNsaWNrZWQsIGNsb3NlIGFueSBvdGhlciBzZWxlY3QgYm94ZXMsCiAgICAgICAgYW5kIG9wZW4vY2xvc2UgdGhlIGN1cnJlbnQgc2VsZWN0IGJveDoqLwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgY2xvc2VBbGxTZWxlY3QodGhpcyk7CiAgICAgICAgdGhpcy5uZXh0U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCJzZWxlY3QtaGlkZSIpOwogICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgic2VsZWN0LWFycm93LWFjdGl2ZSIpOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZUFsbFNlbGVjdChlbG1udCkgewogICAgICAvKmEgZnVuY3Rpb24gdGhhdCB3aWxsIGNsb3NlIGFsbCBzZWxlY3QgYm94ZXMgaW4gdGhlIGRvY3VtZW50LAogICAgICBleGNlcHQgdGhlIGN1cnJlbnQgc2VsZWN0IGJveDoqLwogICAgICB2YXIgeCwKICAgICAgICAgIHksCiAgICAgICAgICBpLAogICAgICAgICAgeGwsCiAgICAgICAgICB5bCwKICAgICAgICAgIGFyck5vID0gW107CiAgICAgIHggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWxlY3QtaXRlbXMiKTsKICAgICAgeSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInNlbGVjdC1zZWxlY3RlZCIpOwogICAgICB4bCA9IHgubGVuZ3RoOwogICAgICB5bCA9IHkubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSA8IHlsOyBpKyspIHsKICAgICAgICBpZiAoZWxtbnQgPT0geVtpXSkgewogICAgICAgICAgYXJyTm8ucHVzaChpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgeVtpXS5jbGFzc0xpc3QucmVtb3ZlKCJzZWxlY3QtYXJyb3ctYWN0aXZlIik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgeGw7IGkrKykgewogICAgICAgIGlmIChhcnJOby5pbmRleE9mKGkpKSB7CiAgICAgICAgICB4W2ldLmNsYXNzTGlzdC5hZGQoInNlbGVjdC1oaWRlIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKmlmIHRoZSB1c2VyIGNsaWNrcyBhbnl3aGVyZSBvdXRzaWRlIHRoZSBzZWxlY3QgYm94LAogICAgdGhlbiBjbG9zZSBhbGwgc2VsZWN0IGJveGVzOiovCgoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgY2xvc2VBbGxTZWxlY3QpOwogIH0sCiAgbWV0aG9kczogewogICAgaW50ZXJ2aWV3ZXJzX2RldGFpbDogZnVuY3Rpb24gaW50ZXJ2aWV3ZXJzX2RldGFpbCgpIHsvL1RvLURvCiAgICAgIC8vIGlzX2dldCArIGdldF9hbGwgLT4gcmV0dXJucyBhbGwgaW50ZXJ2aWV3ZXJzIGxpc3QKICAgICAgLy8gaXNfZ2V0ICsgcmVxX2ludGVydmlld2VyX2VtYWlsIC0+IHJldHVybnMgc2luZ2xlIGludGVydmlld2VyIGRldGFpbHMgd2l0aCB0aGVpciB3b3JraW5nIGhvdXIKICAgICAgLy8gY29tcGFueV9pZCA9IHJlcXVlc3QuanNvbi5nZXQoJ2NvbXBhbnlfaWQnLCBOb25lKQogICAgICAvLyBjb21wYW55X25hbWUgPSByZXF1ZXN0Lmpzb24uZ2V0KCdjb21wYW55X25hbWUnLCBOb25lKQogICAgICAvLyBpc19nZXQgPSByZXF1ZXN0Lmpzb24uZ2V0KCdpc19nZXQnLCBGYWxzZSkKICAgICAgLy8gZ2V0X2FsbCA9IHJlcXVlc3QuanNvbi5nZXQoJ2dldF9hbGwnLCBGYWxzZSkKICAgICAgLy8gaXNfc2F2ZSA9IHJlcXVlc3QuanNvbi5nZXQoJ2lzX3NhdmUnLCBGYWxzZSkKICAgICAgLy8gaXNfZWRpdCA9IHJlcXVlc3QuanNvbi5nZXQoJ2lzX2VkaXQnLCBGYWxzZSkKICAgICAgLy8gaXNfc2VhcmNoID0gcmVxdWVzdC5qc29uLmdldCgnaXNfc2VhcmNoJywgRmFsc2UpCiAgICAgIC8vIHNlYXJjaF9rZXkgPSByZXF1ZXN0Lmpzb24uZ2V0KCdzZWFyY2hfa2V5JywgTm9uZSkKICAgICAgLy8gcmVxX2ludGVydmlld2VyX2VtYWlsID0gcmVxdWVzdC5qc29uLmdldCgncmVxX2ludGVydmlld2VyX2VtYWlsJywgTm9uZSkKICAgICAgLy8gaW50ZXJ2aWV3ZXJzX2RldGFpbCA9IHJlcXVlc3QuanNvbi5nZXQoJ2ludGVydmlld2Vyc19kZXRhaWwnLCBOb25lKQogICAgICAvLyBwYWdlX25vID0gcmVxdWVzdC5qc29uLmdldCgncGFnZV9ubycsIDEpCiAgICAgIC8vIHBlcl9wYWdlID0gcmVxdWVzdC5qc29uLmdldCgncGVyX3BhZ2UnLCAxMCkKICAgIH0sCiAgICBhZGRfdGltaW5nX3Nsb3Q6IGZ1bmN0aW9uIGFkZF90aW1pbmdfc2xvdChkYXlzKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CgogICAgICBpZiAoQm9vbGVhbih0aGlzLndvcmtpbmdfaHJzW2RheXNdKSkgewogICAgICAgIHRoaXMud29ya2luZ19ocnNbZGF5c10ucHVzaCh7CiAgICAgICAgICBFbmRUaW1lOiAiIiwKICAgICAgICAgIFN0YXJ0VGltZTogIiIKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLndvcmtpbmdfaHJzW2RheXNdID0gW3sKICAgICAgICAgIEVuZFRpbWU6ICIiLAogICAgICAgICAgU3RhcnRUaW1lOiAiIgogICAgICAgIH1dOwogICAgICB9CgogICAgICB2bS4kc2V0KHZtLndvcmtpbmdfaHJzLCBkYXlzLCB2bS53b3JraW5nX2hyc1tkYXlzXSk7CiAgICB9LAogICAgcmVtb3ZlX3RpbWluZ19zbG90OiBmdW5jdGlvbiByZW1vdmVfdGltaW5nX3Nsb3QoZGF5cywgaW5kZXgpIHsKICAgICAgdGhpcy53b3JraW5nX2hyc1tkYXlzXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgfSwKICAgIG9wZW5fc2NoZWR1bGluZ19tb2RhbDogZnVuY3Rpb24gb3Blbl9zY2hlZHVsaW5nX21vZGFsKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0X3NjaGVkdWxpbmcgPSBmYWxzZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGluZ19zZXR0aW5nc191cmwoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgZ2V0U2NoZWR1bGluZ0luZm86IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCAmJiByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mbyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgIF90aGlzMi5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyID0gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ucGhvbmVfbnVtYmVyOwogICAgICAgICAgX3RoaXMyLnNlbGVjdGVkX3RpbWVfc2xvdCA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLnRpbWVfc2xvdCAhPT0gbnVsbCA/IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLnRpbWVfc2xvdCA6ICIiOwogICAgICAgICAgX3RoaXMyLmJ1ZmZlcl90aW1lX3BlcmlvZCA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLmJ1ZmZlcl90aW1lICE9PSBudWxsID8gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uYnVmZmVyX3RpbWUgOiAiIjsKICAgICAgICAgIF90aGlzMi5taW5pbXVtX25vdGljZV9kYXlzID0gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ubWluaW11bV9ub3RpY2VfZGF5cyAhPT0gbnVsbCA/IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLm1pbmltdW1fbm90aWNlX2RheXMgOiAiIjsKICAgICAgICAgIF90aGlzMi5tZWV0aW5nX2RheXNfcmFuZ2UgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5tZWV0aW5nX2RheXNfcmFuZ2UgIT09IG51bGwgPyByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5tZWV0aW5nX2RheXNfcmFuZ2UgOiAiIjsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uSG9saWRheV9saXN0X2ZpbGVfbmFtZSA9PSAiIiB8fCByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5Ib2xpZGF5X2xpc3RfZmlsZV9uYW1lID09IG51bGwpIHt9IGVsc2UgewogICAgICAgICAgICBfdGhpczIuZmlsZV9sYWJlbCA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLkhvbGlkYXlfbGlzdF9maWxlX25hbWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLndvcmtpbmdfaHJzICE9IG51bGwgfHwgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ud29ya2luZ19ocnMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIF90aGlzMi53b3JraW5nX2hycyA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLndvcmtpbmdfaHJzOwogICAgICAgICAgfQoKICAgICAgICAgICQoIiNzY2hlZHVsaW5nX21vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgIF90aGlzMi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0X3RpbWVfc2xvdHM6IGZ1bmN0aW9uIGdldF90aW1lX3Nsb3RzKHN0YXJ0X2RhdGUsIHR5cGUsIHNlbGVjdGVkX3RpbWUsIGlzX3Jlc2NoZWR1bGluZykgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0X3NjaGVkdWxpbmcgPSBpc19yZXNjaGVkdWxpbmcgPT09ICJpc19yZXNjaGVkdWxpbmciOwoKICAgICAgaWYgKGlzX3Jlc2NoZWR1bGluZyA9PT0gImlzX3Jlc2NoZWR1bGluZyIpIHsKICAgICAgICB0aGlzLmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKTsKICAgICAgfQoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfZ2V0X3NjaGVkdWxlX2FwcG9pbnRtZW50KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIERhdGU6IG1vbWVudChzdGFydF9kYXRlKS5mb3JtYXQoJ1lZWVktTU0tREQnKSwKICAgICAgICBhcHBvaW50bWVudF9kYXRlOiBtb21lbnQoc3RhcnRfZGF0ZSkuZm9ybWF0KCdZWVlZLU1NLUREJykKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCkge30gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIF90aGlzMy5mdWxsX3RpbWVfc2xvdHMgPSBbXTsKICAgICAgICAgICAgdmFyIGdldF9mdWxsX3Nsb3RfbGlzdCA9IHRydWU7CiAgICAgICAgICAgIHZhciB0ZW1wX3N0YXJ0X2RhdGUgPSBuZXcgRGF0ZShzdGFydF9kYXRlKTsKCiAgICAgICAgICAgIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSA+IGR0LmdldEZ1bGxZZWFyKCkpIHt9IGVsc2UgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRGdWxsWWVhcigpID09IGR0LmdldEZ1bGxZZWFyKCkpIHsKICAgICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldE1vbnRoKCkgPiBkdC5nZXRNb250aCgpKSB7fSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0TW9udGgoKSA9PSBkdC5nZXRNb250aCgpKSB7CiAgICAgICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA+IGR0LmdldERhdGUoKSkge30gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA9PSBkdC5nZXREYXRlKCkpIHsKICAgICAgICAgICAgICAgICAgZ2V0X2Z1bGxfc2xvdF9saXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IC8vIGlmIChtb21lbnQoc3RhcnRfZGF0ZSkuZGlmZihtb21lbnQoKSwgImRheSIpIDw9IDApIHsKICAgICAgICAgICAgLy8gICBnZXRfZnVsbF9zbG90X2xpc3QgPSBmYWxzZTsKICAgICAgICAgICAgLy8gfQoKCiAgICAgICAgICAgIGlmIChnZXRfZnVsbF9zbG90X2xpc3QpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgICBfdGhpczMuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0sCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMy5nZW5lcmF0ZV90aW1lKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0pCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgICAgaWYgKGR0LmdldEhvdXJzKCkgPCBOdW1iZXIocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSkgewogICAgICAgICAgICAgICAgICBfdGhpczMuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczMuZ2VuZXJhdGVfdGltZShyZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLCByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzFdKQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90cykgewogICAgICAgICAgICAgIC8vICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7CiAgICAgICAgICAgICAgLy8gICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLAogICAgICAgICAgICAgIC8vICAgICB0ZXh0OiB0aGlzLmdlbmVyYXRlX3RpbWUoCiAgICAgICAgICAgICAgLy8gICAgICAgcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAgIC8vICAgICAgIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXQogICAgICAgICAgICAgIC8vICAgICApCiAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAvLyB9CgogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoQm9vbGVhbihzZWxlY3RlZF90aW1lKSkgewogICAgICAgICAgICAgIF90aGlzMy5pc0VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgICBfdGhpczMuc2VsZWN0ZWRfdGltZSA9IHNlbGVjdGVkX3RpbWU7CiAgICAgICAgICAgICAgX3RoaXMzLnNjaGVkdWxlZF90aW1lID0gX3RoaXMzLmdlbmVyYXRlX3RpbWUoc2VsZWN0ZWRfdGltZS5zcGxpdCgiLSIpWzBdLCBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMV0pOwogICAgICAgICAgICAgIF90aGlzMy50aW1lX3Nsb3RzID0gW107IC8vIHRoaXMudGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgICAvLyAgIHZhbHVlOiBzZWxlY3RlZF90aW1lLAogICAgICAgICAgICAgIC8vICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKAogICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMF0sCiAgICAgICAgICAgICAgLy8gICAgIHNlbGVjdGVkX3RpbWUuc3BsaXQoIi0iKVsxXQogICAgICAgICAgICAgIC8vICAgKQogICAgICAgICAgICAgIC8vIH0pCgogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gX3RoaXMzLmZ1bGxfdGltZV9zbG90cykgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZmlsbGVkX3RpbWVfc2xvdHMuaW5kZXhPZihfdGhpczMuZnVsbF90aW1lX3Nsb3RzW2ldLnZhbHVlKSA9PSAtMSB8fCBfdGhpczMuc2VsZWN0ZWRfdGltZSA9PSBfdGhpczMuZnVsbF90aW1lX3Nsb3RzW2ldLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMy50aW1lX3Nsb3RzLnB1c2goX3RoaXMzLmZ1bGxfdGltZV9zbG90c1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAvLyBmb3IgKHZhciBpIGluIHRoaXMuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgLy8gICB0aGlzLnRpbWVfc2xvdHMucHVzaCh0aGlzLmZ1bGxfdGltZV9zbG90c1tpXSk7CiAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgfSBlbHNlIGlmICghQm9vbGVhbihzZWxlY3RlZF90aW1lKSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczMudGltZV9zbG90cyA9IF90aGlzMy5mdWxsX3RpbWVfc2xvdHM7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzMy50aW1lX3Nsb3RzID0gW107CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfdGhpczMuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoX3RoaXMzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZSkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczMudGltZV9zbG90cy5wdXNoKF90aGlzMy5mdWxsX3RpbWVfc2xvdHNbaV0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8vICB0aGlzLnRpbWVfc2xvdHMgPSByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzOwoKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfdGhpczMudGltZV9zbG90cy5sZW5ndGggPT09IDAgJiYgdHlwZSA9PSAnc2NoZWR1bGVfZGV0YWlscycpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ05vIEZyZWUgU2xvdHMgZm9yIHRoaXMgRGF0ZScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICQodHlwZSkubW9kYWwoInNob3ciKTsKICAgICAgICAgICAgICBfdGhpczMudGVtcF9uYW1lID0gX3RoaXMzLmNhbmRpZGF0ZV9uYW1lOwogICAgICAgICAgICAgIF90aGlzMy50ZW1wX3Bvc2l0aW9uID0gX3RoaXMzLmNhbmRpZGF0ZV9wb3NpdGlvbjsKICAgICAgICAgICAgICBfdGhpczMudGVtcF9lbWFpbCA9IF90aGlzMy5jYW5kaWRhdGVfZW1haWw7CiAgICAgICAgICAgICAgX3RoaXMzLnRlbXBfYXBwb2ludG1lbnRfdGltZSA9IF90aGlzMy5zZWxlY3RlZF90aW1lOwogICAgICAgICAgICAgIF90aGlzMy5pc1Jlc2NoZWR1bGUgPSB0cnVlOwogICAgICAgICAgICAgIHZhciBuRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSArICItIiArIChzdGFydF9kYXRlLmdldE1vbnRoKCkgPCA5ID8gIjAiICsgKHN0YXJ0X2RhdGUuZ2V0TW9udGgoKSArIDEpIDogc3RhcnRfZGF0ZS5nZXRNb250aCgpICsgMSkgKyAiLSIgKyBzdGFydF9kYXRlLmdldERhdGUoKSk7CiAgICAgICAgICAgICAgX3RoaXMzLnRlbXBfZGF0YSA9IG5EYXRlOwogICAgICAgICAgICAgIF90aGlzMy5wcmV2aW91c192aXNpdF9kYXRlID0gbkRhdGU7CiAgICAgICAgICAgICAgX3RoaXMzLnRlbXBfYXBwb2ludG1lbnRfZGF0ZSA9IG1vbWVudChuRGF0ZSkuZm9ybWF0KCJNTS1ERC1ZWVlZIik7CiAgICAgICAgICAgICAgdmFyIG1pZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgX3RoaXMzLmRhdGVwaWNrZXJJbnN0YW5jZSA9IG5ldyBEYXRlUGlja2VyKCIjZGF0ZXBpY2tlciIsIHsKICAgICAgICAgICAgICAgIGRhdGU6IG5EYXRlLAogICAgICAgICAgICAgICAgbWluRGF0ZTogbWlkYXRlLAogICAgICAgICAgICAgICAgaW5wdXQ6IHsKICAgICAgICAgICAgICAgICAgZWxlbWVudDogIiNkYXRlcGlja2VyLWlucHV0IiwKICAgICAgICAgICAgICAgICAgZm9ybWF0OiAieXl5eS1NTS1kZCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXRSYW5nZXM6IFtbbmV3IERhdGUoKSwgbmV3IERhdGUoMjA1MCwgMTIsIDEyKV1dCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIHZtID0gX3RoaXMzOwoKICAgICAgICAgICAgICBfdGhpczMuZGF0ZXBpY2tlckluc3RhbmNlLm9uKCJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vdmFyIHg9IG5EYXRlCiAgICAgICAgICAgICAgICB2bS5jaGVja2RhdGUoKTsgLy8gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIH0sIDEwMDApOwoKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIF90aGlzMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsgLy8gY29uc29sZS5sb2coZXJyb3IpOwoKICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICB9KTsKICAgIH0sCiAgICBzYW1wbGVfaG9saWRheTogZnVuY3Rpb24gc2FtcGxlX2hvbGlkYXkoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5ob2xpZGF5X2ZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0sCiAgICAgICAgZGF0YTogewogICAgICAgICAgaXNIb2xpZGF5RmlsZTogdHJ1ZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczQuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCAiaG9saWRheVNhbXBsZUZpbGUuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczQuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZmlsZWlucHV0OiBmdW5jdGlvbiBmaWxlaW5wdXQoZSkgewogICAgICB2YXIgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKCiAgICAgIGlmIChmaWxlc1swXS5zaXplIDwgMTAwMDAwMCkgewogICAgICAgIGlmIChmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJjc3YiKSkgewogICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICAgIHRoaXMuY3JlYXRlQ1NWKGZpbGVzWzBdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJVcGxvYWQgb25seSAuY3N2IGZpbGUgd2l0aCBzaXplIGxlc3MgdGhhbiAxTUIiKTsKICAgICAgfQoKICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHJldHVybjsKICAgIH0sCiAgICBjcmVhdGVDU1Y6IGZ1bmN0aW9uIGNyZWF0ZUNTVihmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczUuY3N2X2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIHNlbmRfc2NoZWR1bGluZzogZnVuY3Rpb24gc2VuZF9zY2hlZHVsaW5nKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBjaGVjayA9IGZhbHNlOwoKICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLndvcmtpbmdfaHJzKSB7CiAgICAgICAgZm9yICh2YXIgaiBpbiB0aGlzLndvcmtpbmdfaHJzW2ldKSB7CiAgICAgICAgICBpZiAodGhpcy53b3JraW5nX2hyc1tpXVtqXS5TdGFydFRpbWUgPT0gIiIgfHwgdGhpcy53b3JraW5nX2hyc1tpXVtqXS5FbmRUaW1lID09ICIiKSB7CiAgICAgICAgICAgIGNoZWNrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjaGVjayA9PSB0cnVlKSB7CiAgICAgICAgc3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiRmlsbCB0aW1lIHNsb3RzIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiQWRtaW4iKSB7CgoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfdGltZV9zbG90ICE9ICIiICYmIHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlciAhPSAiIiAmJiB0aGlzLnZhbGlkUGhvbmVOdW1iZXIgPT0gdHJ1ZSAmJiB0aGlzLmJ1ZmZlcl90aW1lX3BlcmlvZCAhPSAiIiAmJiB0aGlzLm1pbmltdW1fbm90aWNlX2RheXMgIT0gIiIgJiYgdGhpcy5tZWV0aW5nX2RheXNfcmFuZ2UgIT0gIiIpIHsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGluZ19zZXR0aW5nc191cmwoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZ2V0U2NoZWR1bGluZ0luZm86IGZhbHNlLAogICAgICAgICAgaXN1cGRhdGU6IHRydWUsCiAgICAgICAgICAvLyB1cGRhdGVDb250YWN0OiB0cnVlLAogICAgICAgICAgQ29udGFjdE51bWJlcjogdGhpcy5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgdGltZXNsb3Q6IE51bWJlcih0aGlzLnNlbGVjdGVkX3RpbWVfc2xvdCksCiAgICAgICAgICBidWZmZXJfdGltZTogTnVtYmVyKHRoaXMuYnVmZmVyX3RpbWVfcGVyaW9kKSwKICAgICAgICAgIG1lZXRpbmdfZGF5c19yYW5nZTogTnVtYmVyKHRoaXMubWVldGluZ19kYXlzX3JhbmdlKSwKICAgICAgICAgIG1pbmltdW1fbm90aWNlX2RheXM6IE51bWJlcih0aGlzLm1pbmltdW1fbm90aWNlX2RheXMpLAogICAgICAgICAgd29ya2luZ19ocnM6IHRoaXMud29ya2luZ19ocnMsCiAgICAgICAgICBpc3VwZGF0ZUhvbGlkYXk6IHRoaXMuY3N2X2ZpbGUgIT0gIiIgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICBob2xpZGF5X2xpc3RfZmlsZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwsCiAgICAgICAgICBob2xpZGF5X2xpc3RfZmlsZV9kYXRhOiB0aGlzLmNzdl9maWxlID09ICIiID8gbnVsbCA6IHRoaXMuY3N2X2ZpbGUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICBfdGhpczYuaGlkZV9tb2RhbCgic2NoZWR1bGluZ19tb2RhbCIpOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwgJiYgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIlNjaGVkdWxpbmcgaW5mbyB1cGRhdGVkIikgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciBzY2hlZHVsaW5nIGluZm9ybWF0aW9uIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Iik7CgogICAgICAgICAgICBfdGhpczYudXBkYXRlX3NjaGVkdWxlc19saXN0KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnZhbGlkIEhlYWRlciIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgeW91ciBoZWFkZXJzIGFzIHByb3ZpZGVkIGluIHRoZSBzYW1wbGUgZmlsZSBiZWxvdy4iKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIiIpIHt9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gaWYgKHRoaXMudmFsaWRQaG9uZU51bWJlciAhPSB0cnVlICAmJiB0aGlzLnNjaGVkdWxpbmdfY29udGFjdF9udW1iZXIgIT0gIiIpewogICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJNb2JpbGUgbnVtYmVyIGlzIGludmFsaWQsIHBsZWFzZSBlbnRlciBpbiBmb3JtYXQ6ICsgQ291bnRyeUNvZGUgTnVtYmVyIik7CiAgICAgICAgLy8gfWVsc2V7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCBmaWVsZHMuIik7IC8vIH0KICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlX3RpbWU6IGZ1bmN0aW9uIGdlbmVyYXRlX3RpbWUoc3RhcnRfdGltZSwgZW5kX3RpbWUpIHsKICAgICAgdmFyIHN0YXJ0ID0gbW9tZW50KHN0YXJ0X3RpbWUsIFsiaGg6bW0iXSkuZm9ybWF0KCJoaDptbSBBIik7CiAgICAgIHZhciBlbmQgPSBtb21lbnQoZW5kX3RpbWUsIFsiaGg6bW0iXSkuZm9ybWF0KCJoaDptbSBBIik7CiAgICAgIHJldHVybiAiIi5jb25jYXQoc3RhcnQsICItIikuY29uY2F0KGVuZCk7CiAgICB9LAogICAgbmV3X3NjaGVkdWxlOiBmdW5jdGlvbiBuZXdfc2NoZWR1bGUoc3RhcnREYXRlKSB7CiAgICAgIHZhciBzY2hlZHVsZURhdGUgPSAnJzsKCiAgICAgIGlmIChtb21lbnQoc3RhcnREYXRlLCAnWVlZWS1NTS1ERCcsIHRydWUpLmlzVmFsaWQoKSkgewogICAgICAgIHNjaGVkdWxlRGF0ZSA9IHN0YXJ0RGF0ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzY2hlZHVsZURhdGUgPSB0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpOwogICAgICB9CgogICAgICB2YXIgaG9saWRheV9kYXRlID0gdGhpcy5zY2hlZHVsZV9saXN0LmZpbHRlcihmdW5jdGlvbiAoc2NoZWR1bGUpIHsKICAgICAgICByZXR1cm4gbW9tZW50KHNjaGVkdWxlLnN0YXJ0KS5mb3JtYXQoIllZWVkgTU1NTSBERCIpID09IG1vbWVudChzY2hlZHVsZURhdGUpLmZvcm1hdCgiWVlZWSBNTU1NIEREIikgJiYgc2NoZWR1bGUucmF3LmlzSG9saWRheSA9PSB0cnVlOwogICAgICB9KTsKICAgICAgdmFyIHRvZGF5X3RpbWUgPSBuZXcgRGF0ZSgpOwogICAgICB2YXIgc3RhcnRfdGltZSA9IHNjaGVkdWxlRGF0ZTsKICAgICAgdGhpcy5zZWxlY3RlZF9kYXRlID0gc3RhcnRfdGltZTsKICAgICAgc3RhcnRfdGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTsKCiAgICAgIGlmICh0aGlzLmRhdGVfY29uZGl0aW9uKHRvZGF5X3RpbWUsIHN0YXJ0X3RpbWUpICYmIGhvbGlkYXlfZGF0ZS5sZW5ndGggPT0gMCAmJiBtb21lbnQoc3RhcnRfdGltZSkuZm9ybWF0KCJkZGRkIikgIT0gIlN1bmRheSIpIHsKICAgICAgICB0aGlzLmdldF90aW1lX3Nsb3RzKHNjaGVkdWxlRGF0ZSwgIiNzY2hlZHVsZV9jcmVhdGUiKTsKICAgICAgfSBlbHNlIGlmIChob2xpZGF5X2RhdGUubGVuZ3RoID4gMCkgewogICAgICAgIHRvYXN0ci5lcnJvcigiWW91IGNhbm5vdCBlbnRlciBhIHNjaGVkdWxlIGZvciB0aGlzIGRhdGUuIFxuIFJlYXNvbjogIiArIGhvbGlkYXlfZGF0ZVswXS5yYXcucmVhc29uKTsKICAgICAgfSBlbHNlIHt9CiAgICB9LAogICAgY3JlYXRlX2FwcG9pbnRtZW50OiBmdW5jdGlvbiBjcmVhdGVfYXBwb2ludG1lbnQoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdmFyIHJlZ2V4ID0gL1wrWzAtOV17OSwxNH0kLzsKICAgICAgdmFyIHggPSB0aGlzLnZpc2l0b3JfbnVtYmVyLnJlcGxhY2UoL1xzKy9nLCAnJyk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5jYW5kaWRhdGVfcG9zaXRpb24gPT0gIiIgfHwgdGhpcy5jYW5kaWRhdGVfZW1haWwgPT0gIiIgfHwgdGhpcy5jYW5kaWRhdGVfbmFtZSA9PSAiIiB8fCB0aGlzLnZpc2l0b3JfbnVtYmVyID09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfdGltZSA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFyZWdleC50ZXN0KHgpKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJNb2JpbGUgbnVtYmVyIGlzIGludmFsaWQsIHBsZWFzZSBlbnRlciBpbiBmb3JtYXQ6ICsgQ291bnRyeUNvZGUgTnVtYmVyIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0VkaXQpIHsKICAgICAgICB2YXIgYXBwb2ludG1lbnRfcGF5bG9hZCA9IHsKICAgICAgICAgIENhbmRpZGF0ZU5hbWU6IHRoaXMuY2FuZGlkYXRlX25hbWUsCiAgICAgICAgICBDYW5kaWRhdGVQb3NpdGlvbjogdGhpcy5jYW5kaWRhdGVfcG9zaXRpb24sCiAgICAgICAgICBDYW5kaWRhdGVFbWFpbDogdGhpcy5jYW5kaWRhdGVfZW1haWwsCiAgICAgICAgICBWaXNpdFNsb3Q6IHRoaXMuc2VsZWN0ZWRfdGltZSwKICAgICAgICAgIFBob25lTnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLAogICAgICAgICAgVmlzaXREYXRlOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXQogICAgICAgIH07CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxlX2VkaXRfZGVsZXRlX3VybCgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBkYXRlOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXSwKICAgICAgICAgIGlzX2VkaXQ6IHRoaXMuaXNFZGl0LAogICAgICAgICAgYXBwb2ludG1lbnRfaWQ6IHRoaXMuc2VsZWN0ZWRfc2NoZWR1bGVfaWQsCiAgICAgICAgICBhcHBvaW50bWVudF9pbmZvOiBhcHBvaW50bWVudF9wYXlsb2FkCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLm1zZyA9PSAiRWRpdCBBcHBvaW50bWVudCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gZWRpdGVkIHN1Y2Nlc3NmdWxseS4iKTsKCiAgICAgICAgICAgIF90aGlzNy5oaWRlX21vZGFsKCJzY2hlZHVsZV9jcmVhdGUiKTsKCiAgICAgICAgICAgIF90aGlzNy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKCiAgICAgICAgICAgIF90aGlzNy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgX3RoaXM3LmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX2F4aW9zJHBvc3Q7CgogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9hcHBvaW50bWVudF91cmwoKSwgKF9heGlvcyRwb3N0ID0gewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLAogICAgICAgICAgY2FuZGlkYXRlX25hbWU6IHRoaXMuY2FuZGlkYXRlX25hbWUsCiAgICAgICAgICBjYW5kaWRhdGVfcG9zaXRpb246IHRoaXMuY2FuZGlkYXRlX3Bvc2l0aW9uCiAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAiY2FuZGlkYXRlX3Bvc2l0aW9uIiwgdGhpcy5jYW5kaWRhdGVfZW1haWwpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJ2aXNpdF9zbG90IiwgdGhpcy5zZWxlY3RlZF90aW1lKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAidmlzaXRfZGF0ZSIsICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUpLCBfYXhpb3MkcG9zdCksIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIkFwcG9pbnRtZW50IEFkZGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gY3JlYXRlZCBzdWNjZXNzZnVsbHkuIik7CgogICAgICAgICAgICBfdGhpczcuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIik7CgogICAgICAgICAgICBfdGhpczcudXBkYXRlX3NjaGVkdWxlc19saXN0KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgICBfdGhpczcuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIik7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CgogICAgICAgICAgX3RoaXM3LmhpZGVfbW9kYWwoInNjaGVkdWxlX2NyZWF0ZSIpOwoKICAgICAgICAgIF90aGlzNy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9hcHBvaW50bWVudDogZnVuY3Rpb24gZGVsZXRlX2FwcG9pbnRtZW50KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXM4LnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9lZGl0X2RlbGV0ZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgZW1haWw6IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICAgICAgZGF0ZTogX3RoaXM4LnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXSwKICAgICAgICAgICAgYXBwb2ludG1lbnRfaWQ6IF90aGlzOC5zZWxlY3RlZF9zY2hlZHVsZV9pZAogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczguJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczguc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBfdGhpczguaGlkZV9tb2RhbCgic2NoZWR1bGVfZGV0YWlscyIpOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJEZWxldGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciBhcHBvaW50bWVudCBoYXMgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseS4iKTsKCiAgICAgICAgICAgICAgX3RoaXM4LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKCiAgICAgICAgICAgICAgX3RoaXM4LmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKCiAgICAgICAgICAgIF90aGlzOC5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIik7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHJlbmRlcl9zY2hlZHVsZTogZnVuY3Rpb24gcmVuZGVyX3NjaGVkdWxlKGRhdGEpIHsKICAgICAgdmFyIHNjaGVkdWxlID0gW107CgogICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICBmb3IgKHZhciBqIGluIGRhdGFbaV0pIHsKICAgICAgICAgIGlmIChqID09ICJIb2xpZGF5IikgewogICAgICAgICAgICBzY2hlZHVsZS5wdXNoKHsKICAgICAgICAgICAgICBpZDogaiwKICAgICAgICAgICAgICBjYWxlbmRhcklkOiAiMSIsCiAgICAgICAgICAgICAgdGl0bGU6ICJIb2xpZGF5IiwKICAgICAgICAgICAgICBjYXRlZ29yeTogInRpbWUiLAogICAgICAgICAgICAgIGR1ZURhdGVDbGFzczogIiIsCiAgICAgICAgICAgICAgcmF3OiB7CiAgICAgICAgICAgICAgICByZWFzb246IGRhdGFbaV1bal0uUmVhc29uLAogICAgICAgICAgICAgICAgaXNIb2xpZGF5OiB0cnVlCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzdGFydDogdGhpcy5zZXRfdGltZV9pbnRlcnZhbHMoaSwgIjAwOjAwIiksCiAgICAgICAgICAgICAgZW5kOiB0aGlzLnNldF90aW1lX2ludGVydmFscyhpLCAiMjM6NTkiKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFwcG9pbnRtZW50U3RhdHVzOiAibm9uZSIKICAgICAgICAgICAgLy8gUGhvbmVOdW1iZXI6ICIrOTE5ODY5NTMzOTA3NiIKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRBcHBvaW50bWVudEZyb206IG51bGwKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRBcHBvaW50bWVudFRvOiBudWxsCiAgICAgICAgICAgIC8vIFJlc2NoZWR1bGVkRnJvbTogbnVsbAogICAgICAgICAgICAvLyBSZXNjaGVkdWxlZFRvOiBudWxsCiAgICAgICAgICAgIC8vIFN5bXB0b21zOiAiampqamoiCiAgICAgICAgICAgIC8vIFZpc2l0RGF0ZTogIlR1ZSwgMTkgQXByIDIwMjIgMDA6MDA6MDAgR01UIgogICAgICAgICAgICAvLyBWaXNpdFJlYXNvbjogImdnZyIKICAgICAgICAgICAgLy8gVmlzaXRTbG90OiAiMjAyMi0wNC0xOSAwODowMC0wOTowMCIKICAgICAgICAgICAgLy8gVmlzaXRTdGF0dXM6ICJub3QtdmlzaXRlZCIKICAgICAgICAgICAgLy8gVmlzaXRvck5hbWU6ICJha2kiCiAgICAgICAgICAgIC8vIEFwcG9pbnRtZW50U3RhdHVzOiAibm9uZSIKICAgICAgICAgICAgLy8gQ2FuZGlkYXRlQ29udGFjdE51bWJlcjogIjg4ODg4OTk5OTkiCiAgICAgICAgICAgIC8vIENhbmRpZGF0ZUVtYWlsOiAic2FnYXIuYmhhbnVzaGFsaUBzYWtlYy5hYy5pbiIKICAgICAgICAgICAgLy8gQ2FuZGlkYXRlTmFtZTogInNhZ2FyIGJoYW51c2hhbGkiCiAgICAgICAgICAgIC8vIENhbmRpZGF0ZVBvc2l0aW9uOiAiUHl0aG9uIgogICAgICAgICAgICAvLyBDYW5kaWRhdGVWaXNpdFNsb3Q6ICIyMDIyLTA0LTIwIDA5OjQ1LTEwOjE1IgogICAgICAgICAgICAvLyBSZXNjaGVkdWxlZEFwcG9pbnRtZW50RnJvbTogbnVsbAogICAgICAgICAgICAvLyBSZXNjaGVkdWxlZEFwcG9pbnRtZW50VG86IG51bGwKICAgICAgICAgICAgLy8gUmVzY2hlZHVsZWRGcm9tOiBudWxsCiAgICAgICAgICAgIC8vIFJlc2NoZWR1bGVkVG86IG51bGwKICAgICAgICAgICAgLy8gVmlzaXREYXRlOiAiV2VkLCAyMCBBcHIgMjAyMiAwMDowMDowMCBHTVQiCiAgICAgICAgICAgIC8vIFZpc2l0U3RhdHVzOiAibm90LXZpc2l0ZWQiCiAgICAgICAgICAgIHNjaGVkdWxlLnB1c2goewogICAgICAgICAgICAgIGlkOiBqLAogICAgICAgICAgICAgIGNhbGVuZGFySWQ6ICIxIiwKICAgICAgICAgICAgICB0aXRsZTogZGF0YVtpXVtqXS5DYW5kaWRhdGVOYW1lLAogICAgICAgICAgICAgIC8vdGl0bGU6IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS50ZW1wbGF0ZSgpLAogICAgICAgICAgICAgIGNhdGVnb3J5OiAidGltZSIsCiAgICAgICAgICAgICAgZHVlRGF0ZUNsYXNzOiAiIiwKICAgICAgICAgICAgICByYXc6IHsKICAgICAgICAgICAgICAgIHBob25lX251bWJlcjogZGF0YVtpXVtqXS5DYW5kaWRhdGVDb250YWN0TnVtYmVyLAogICAgICAgICAgICAgICAgY2FuZGlkYXRlX3Bvc2l0aW9uOiBkYXRhW2ldW2pdLkNhbmRpZGF0ZVBvc2l0aW9uLAogICAgICAgICAgICAgICAgY2FuZGlkYXRlX2VtYWlsOiBkYXRhW2ldW2pdLkNhbmRpZGF0ZUVtYWlsLAogICAgICAgICAgICAgICAgLy8gcmVhc29uOiBkYXRhW2ldW2pdLlZpc2l0UmVhc29uLAogICAgICAgICAgICAgICAgLy8gc3ltcHRvbXM6IGRhdGFbaV1bal0uU3ltcHRvbXMsCiAgICAgICAgICAgICAgICB2aXNpdF9zbG90OiBkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdCwKICAgICAgICAgICAgICAgIHN0YXJ0OiBkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzFdLnNwbGl0KCItIilbMF0sCiAgICAgICAgICAgICAgICBlbmQ6IGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMV0uc3BsaXQoIi0iKVsxXSwKICAgICAgICAgICAgICAgIGlzSG9saWRheTogZmFsc2UsCiAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9zdGF0dXM6IGRhdGFbaV1bal0uQXBwb2ludG1lbnRTdGF0dXMsCiAgICAgICAgICAgICAgICB2aXNpdF9zdGF0dXM6IGRhdGFbaV1bal0uVmlzaXRTdGF0dXMsCiAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9pZDogagogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMuc2V0X3RpbWVfaW50ZXJ2YWxzKGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sIGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMV0uc3BsaXQoIi0iKVswXSksCiAgICAgICAgICAgICAgZW5kOiBkYXRhW2ldW2pdLkNhbmRpZGF0ZVZpc2l0U2xvdC5zcGxpdCgiICIpWzFdLnNwbGl0KCItIilbMV0gPT0gIjAwOjAwIiA/IHRoaXMuc2V0X3RpbWVfaW50ZXJ2YWxzKGRhdGFbaV1bal0uQ2FuZGlkYXRlVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sICIyMzo1OSIpIDogdGhpcy5zZXRfdGltZV9pbnRlcnZhbHMoZGF0YVtpXVtqXS5DYW5kaWRhdGVWaXNpdFNsb3Quc3BsaXQoIiAiKVswXSwgZGF0YVtpXVtqXS5DYW5kaWRhdGVWaXNpdFNsb3Quc3BsaXQoIiAiKVsxXS5zcGxpdCgiLSIpWzFdKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2NoZWR1bGVfbGlzdCA9IHNjaGVkdWxlOwogICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuY2xlYXIoKTsKICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLmNyZWF0ZVNjaGVkdWxlcyhzY2hlZHVsZSk7CiAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5yZW5kZXIoKTsKICAgIH0sCiAgICBzZXRSZW5kZXJSYW5nZVRleHQ6IGZ1bmN0aW9uIHNldFJlbmRlclJhbmdlVGV4dCgpIHsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgdmFyIHJlbmRlclJhbmdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlbmRlclJhbmdlIik7CiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldE9wdGlvbnMoKTsKICAgICAgdmFyIHZpZXdOYW1lID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldFZpZXdOYW1lKCk7CiAgICAgIHZhciBodG1sID0gW107CgogICAgICBpZiAodmlld05hbWUgPT09ICJtb250aCIgJiYgKCFvcHRpb25zLm1vbnRoLnZpc2libGVXZWVrc0NvdW50IHx8IG9wdGlvbnMubW9udGgudmlzaWJsZVdlZWtzQ291bnQgPiA0KSB8fCB2aWV3TmFtZSA9PT0gImRheSIpIHsKICAgICAgICBodG1sLnB1c2gobW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoIk1NTU0gWVlZWSIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc3RhcnREYXRlID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGVSYW5nZVN0YXJ0KCkuZ2V0VGltZSgpOwogICAgICAgIHZhciBlbmREYXRlID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGVSYW5nZUVuZCgpLmdldFRpbWUoKTsKCiAgICAgICAgaWYgKG1vbWVudChlbmREYXRlKS5zdWJ0cmFjdChzdGFydERhdGUsICd5ZWFyJykpIHsKICAgICAgICAgIGh0bWwucHVzaCgiIi5jb25jYXQobW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJEIE1NTU0gWVlZWSIpLCAiIHRvICIpLmNvbmNhdChtb21lbnQoZW5kRGF0ZSkuZm9ybWF0KCJEIE1NTU0gWVlZWSIpKSk7CiAgICAgICAgfSBlbHNlIGlmIChtb21lbnQoZW5kRGF0ZSkuc3VidHJhY3Qoc3RhcnREYXRlLCAnbW9udGgnKSkgewogICAgICAgICAgaHRtbC5wdXNoKCIiLmNvbmNhdChtb21lbnQoc3RhcnREYXRlKS5mb3JtYXQoIkQgTU1NTSIpLCAiIHRvICIpLmNvbmNhdChtb21lbnQoZW5kRGF0ZSkuZm9ybWF0KCJEIE1NTU0gWVlZWSIpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGh0bWwucHVzaCgiIi5jb25jYXQobW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJEIiksICIgdG8gIikuY29uY2F0KG1vbWVudChlbmREYXRlKS5mb3JtYXQoIkQgTU1NTSBZWVlZIikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZ2VuZXJhdGVfZGF5c19pbl9tb250aChtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpLmZvcm1hdCgnRCcpLCBtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpLmZvcm1hdCgnTU1NTScpLCBtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpLmZvcm1hdCgiWVlZWSIpKTsKICAgICAgcmVuZGVyUmFuZ2UuaW5uZXJIVE1MID0gaHRtbC5qb2luKCIiKTsKICAgICAgdGhpcy5kYWlseV9kYXRlID0gcmVuZGVyUmFuZ2UuaW5uZXJIVE1MOwogICAgfSwKICAgIGRhdGVfY29uZGl0aW9uOiBmdW5jdGlvbiBkYXRlX2NvbmRpdGlvbihmcm9tX29iamVjdCwgdG9fb2JqZWN0KSB7CiAgICAgIGlmIChmcm9tX29iamVjdCAhPT0gbnVsbCAmJiB0b19vYmplY3QgIT09IG51bGwpIHsKICAgICAgICBpZiAodG9fb2JqZWN0LmdldEZ1bGxZZWFyKCkgPiBmcm9tX29iamVjdC5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHRvX29iamVjdC5nZXRGdWxsWWVhcigpID09IGZyb21fb2JqZWN0LmdldEZ1bGxZZWFyKCkpIHsKICAgICAgICAgIGlmICh0b19vYmplY3QuZ2V0TW9udGgoKSA+IGZyb21fb2JqZWN0LmdldE1vbnRoKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHRvX29iamVjdC5nZXRNb250aCgpID09IGZyb21fb2JqZWN0LmdldE1vbnRoKCkpIHsKICAgICAgICAgICAgaWYgKE51bWJlcih0b19vYmplY3QuZ2V0RGF0ZSgpKSA+PSBOdW1iZXIoZnJvbV9vYmplY3QuZ2V0RGF0ZSgpKSkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgaWYgKGZyb21fb2JqZWN0ID09PSBudWxsICYmIHRvX29iamVjdCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHRvZ2dsZV92aWV3OiBmdW5jdGlvbiB0b2dnbGVfdmlldyh0eXBlKSB7CiAgICAgIGlmICh0eXBlID09ICJkYXkiKSB7CiAgICAgICAgdGhpcy5zaG93X2NoZWNrX2FuZF9jaGFuZ2Vfc3RhdHVzID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfY2hlY2tfYW5kX2NoYW5nZV9zdGF0dXMgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLmNoYW5nZVZpZXcodHlwZSwgdHJ1ZSk7CiAgICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICB9LAogICAgc3dpdGNoX2NhbGVuZGFyOiBmdW5jdGlvbiBzd2l0Y2hfY2FsZW5kYXIodHlwZSwgZGF0ZSkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICh0eXBlID09ICJ0b2RheSIpIHsKICAgICAgICB0aGlzLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9ICJkYXkiOwogICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS50b2RheSgpOyAvLyB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gIndlZWsiIHx8IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gImRheSIpIHsKICAgICAgICBpZiAodHlwZSA9PSAibmV4dCIpIHsKICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5uZXh0KCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJwcmV2IikgewogICAgICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLnByZXYoKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gImN1c3RvbSIpIHsKICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5zZXREYXRlKG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuc2V0RGF0ZShkYXRlKSkpOwogICAgICAgIH0gLy8gdGhpcy5zZXRSZW5kZXJSYW5nZVRleHQoKTsKCiAgICAgIH0gZWxzZSBpZiAodGhpcy5jYWxlbmRhckluc3RhbmNlLl92aWV3TmFtZSA9PSAibW9udGgiKSB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwoKICAgICAgICBpZiAodHlwZSA9PSAibmV4dCIpIHsKICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5uZXh0KCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJwcmV2IikgewogICAgICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLnByZXYoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfZ2V0X3NjaGVkdWxlX2luZm9fdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGZpcnN0X2RheTogdGhpcy5tb250aF9yYW5nZSgic3RhcnRfdGltZSIpLAogICAgICAgIGxhc3RfZGF5OiB0aGlzLm1vbnRoX3JhbmdlKCJlbmRfdGltZSIpCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczkuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgIF90aGlzOS5yZW5kZXJfc2NoZWR1bGUocmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8pOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRSZW5kZXJSYW5nZVRleHQoKTsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgIH0sCiAgICBtb250aF9yYW5nZTogZnVuY3Rpb24gbW9udGhfcmFuZ2UodHlwZSkgewogICAgICB2YXIgdGltZSA9IG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSk7CiAgICAgIHRpbWUgPSBtb21lbnQodGltZSkuZGF5c0luTW9udGgoKTsKCiAgICAgIGlmICh0eXBlID09ICJzdGFydF90aW1lIikgewogICAgICAgIHZhciBzdGFydF90aW1lID0gbnVsbDsKCiAgICAgICAgaWYgKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gIndlZWsiKSB7CiAgICAgICAgICBzdGFydF90aW1lID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLl9yZW5kZXJSYW5nZS5zdGFydC5fZGF0ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhcnRfdGltZSA9IG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuX2RhdGUuZ2V0RnVsbFllYXIoKSwgdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5fZGF0ZS5nZXRNb250aCgpLCAxKTsKICAgICAgICB9CgogICAgICAgIHN0YXJ0X3RpbWUgPSBzdGFydF90aW1lLmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoc3RhcnRfdGltZS5nZXRNb250aCgpIDwgOSA/ICIwIiArIChzdGFydF90aW1lLmdldE1vbnRoKCkgKyAxKSA6IHN0YXJ0X3RpbWUuZ2V0TW9udGgoKSArIDEpICsgIi0iICsgKHN0YXJ0X3RpbWUuZ2V0RGF0ZSgpIDwgMTAgPyAiMCIgKyBzdGFydF90aW1lLmdldERhdGUoKSA6IHN0YXJ0X3RpbWUuZ2V0RGF0ZSgpKTsKICAgICAgICByZXR1cm4gc3RhcnRfdGltZTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJlbmRfdGltZSIpIHsKICAgICAgICB2YXIgZW5kX3RpbWUgPSBudWxsOwoKICAgICAgICBpZiAodGhpcy5jYWxlbmRhckluc3RhbmNlLl92aWV3TmFtZSA9PSAid2VlayIpIHsKICAgICAgICAgIGVuZF90aW1lID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLl9yZW5kZXJSYW5nZS5lbmQuX2RhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVuZF90aW1lID0gbmV3IERhdGUodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5fZGF0ZS5nZXRGdWxsWWVhcigpLCB0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLl9kYXRlLmdldE1vbnRoKCksIHRpbWUpOwogICAgICAgIH0KCiAgICAgICAgZW5kX3RpbWUgPSBlbmRfdGltZS5nZXRGdWxsWWVhcigpICsgIi0iICsgKGVuZF90aW1lLmdldE1vbnRoKCkgPCA5ID8gIjAiICsgKGVuZF90aW1lLmdldE1vbnRoKCkgKyAxKSA6IGVuZF90aW1lLmdldE1vbnRoKCkgKyAxKSArICItIiArIChlbmRfdGltZS5nZXREYXRlKCkgPCAxMCA/ICIwIiArIGVuZF90aW1lLmdldERhdGUoKSA6IGVuZF90aW1lLmdldERhdGUoKSk7CiAgICAgICAgcmV0dXJuIGVuZF90aW1lOwogICAgICB9CiAgICB9LAogICAgZ2VuZXJhdGVfZGF5c19pbl9tb250aDogZnVuY3Rpb24gZ2VuZXJhdGVfZGF5c19pbl9tb250aChkYXksIG1vbnRoLCB5ZWFyKSB7CiAgICAgIHZhciB0b3RhbF9kYXlzID0gbW9tZW50KCIiLmNvbmNhdChtb250aCwgIiAiKS5jb25jYXQoeWVhciksIFsnTU1NTSBZWVlZJ10pLmRheXNJbk1vbnRoKCk7CiAgICAgIHRoaXMuZGF5c0luTW9udGggPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAxLCBuID0gdG90YWxfZGF5czsgaSA8PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmRheXNJbk1vbnRoLnB1c2goewogICAgICAgICAgZGF5OiBtb21lbnQoIiIuY29uY2F0KGksICIgIikuY29uY2F0KG1vbnRoLCAiICIpLmNvbmNhdCh5ZWFyKSwgWydEIE1NTU0gWVlZWSddKS5mb3JtYXQoJ2RkJyksCiAgICAgICAgICBkYXRlOiBpLAogICAgICAgICAgaXNfYWN0aXZlOiBtb21lbnQoIiIuY29uY2F0KGRheSwgIiAiKS5jb25jYXQobW9udGgsICIgIikuY29uY2F0KHllYXIpLCBbJ0QgTU1NTSBZWVlZJ10pLmlzU2FtZShtb21lbnQoIiIuY29uY2F0KGksICIgIikuY29uY2F0KG1vbnRoLCAiICIpLmNvbmNhdCh5ZWFyKSwgWydEIE1NTU0gWVlZWSddKSwgJ2RheScpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRfdGltZV9pbnRlcnZhbHM6IGZ1bmN0aW9uIHNldF90aW1lX2ludGVydmFscyh5ZWFyLCB0aW1lKSB7CiAgICAgIHZhciB2bSA9IG5ldyBEYXRlKHllYXIuc3BsaXQoIi0iKVswXSwgeWVhci5zcGxpdCgiLSIpWzFdIC0gMSwgeWVhci5zcGxpdCgiLSIpWzJdLCB0aW1lLnNwbGl0KCI6IilbMF0sIHRpbWUuc3BsaXQoIjoiKVsxXSk7CiAgICAgIHZtID0gbW9tZW50KHZtKS5mb3JtYXQoKTsKICAgICAgcmV0dXJuIHZtOwogICAgfSwKICAgIG9wZW5DaGVja0FuZENoYW5nZVN0YXR1c01vZGFsOiBmdW5jdGlvbiBvcGVuQ2hlY2tBbmRDaGFuZ2VTdGF0dXNNb2RhbChBcHBvaW50bWVudElELCBzY2hlZHVsZURhdGUpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOyAvLyB2YXIgZGF0ZVRvU2VuZCA9IG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSkuZm9ybWF0KAogICAgICAvLyAgICJZWVlZLU1NLUREIgogICAgICAvLyApOwoKICAgICAgdmFyIGRhdGVUb1NlbmQgPSBtb21lbnQoc2NoZWR1bGVEYXRlKS5mb3JtYXQoIllZWVktTU0tREQiKTsgLy8gdmFyIGRhdGVvYmogPSBuZXcgRGF0ZShtb21lbnQodGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGUoKS5nZXRUaW1lKCkpLmZvcm1hdCgiTU1NTSBERCwgWVlZWSIpKTsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX3Zpc2l0X3N0YXR1c19pbmZvKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGRhdGU6IGRhdGVUb1NlbmQsCiAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczEwLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICB2YXIgYXBwb2ludG1lbnRGaWx0ZXIgPSByZXNwb25zZS5kYXRhLmRhdGEuZmlsdGVyKGZ1bmN0aW9uIChhcHB0KSB7CiAgICAgICAgICAgIHJldHVybiBhcHB0WyJBcHBvaW50bWVudElEIl0gPT0gQXBwb2ludG1lbnRJRDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChhcHBvaW50bWVudEZpbHRlci5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgX3RoaXMxMC52aXNpdFN0YXR1cyA9IGFwcG9pbnRtZW50RmlsdGVyWzBdWyJWaXNpdFN0YXR1cyJdOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICB2YXIgY29uZmlybWVkX2FwcHQgPSBbXTsKICAgICAgICAgIHZhciBub25lX2FwcHQgPSBbXTsKICAgICAgICAgIHZhciByZXNjaGVkdWxlX2FwcHQgPSBbXTsKICAgICAgICAgIHZhciBkZWxldGVkX2FwcHQgPSBbXTsgLy8gdGhpcy52aXNpdF9zdGF0dXNfY29tcGFyaXNvbl9kYXRhID0gdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5zbGljZSgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IF90aGlzMTAuc2NoZWR1bGVfbGlzdC5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkNvbXBhcmVWaXNpdFN0YXR1cyJdID0KICAgICAgICAgICAgICAvLyAgIHJlc3BvbnNlLmRhdGEuZGF0YVtpXS5WaXNpdFN0YXR1czsKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudElEID09PSBfdGhpczEwLnNjaGVkdWxlX2xpc3Rbal0uaWQpIHsKICAgICAgICAgICAgICAgIF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkFwcG9pbnRtZW50U3RhdHVzIl0gPSBfdGhpczEwLnNjaGVkdWxlX2xpc3Rbal0ucmF3LmFwcG9pbnRtZW50X3N0YXR1czsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQXBwb2ludG1lbnRTdGF0dXMiXSA9PT0gJ2NvbmZpcm1lZCcpIHsKICAgICAgICAgICAgICAgICAgY29uZmlybWVkX2FwcHQucHVzaChfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQXBwb2ludG1lbnRTdGF0dXMiXSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgIG5vbmVfYXBwdC5wdXNoKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJBcHBvaW50bWVudFN0YXR1cyJdID09PSAncmVzY2hlZHVsZWQnKSB7CiAgICAgICAgICAgICAgICAgIHJlc2NoZWR1bGVfYXBwdC5wdXNoKF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGFbaV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJBcHBvaW50bWVudFN0YXR1cyJdID09PSAnZGVsZXRlZCcpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlZF9hcHB0LnB1c2goX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXSk7CiAgICAgICAgICAgICAgICB9IC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhID0gW107CiAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSBub25lX2FwcHQ7CiAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSBjb25maXJtZWRfYXBwdDsKICAgICAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhICs9IHJlc2NoZWR1bGVfYXBwdDsKICAgICAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhICs9IGRlbGV0ZWRfYXBwdDsKCiAgICAgICAgICAgICAgfSAvLyB0aGlzLnZpc2l0X3N0YXR1c19jb21wYXJpc29uX2RhdGEucHVzaChyZXNwb25zZS5kYXRhLmRhdGFbaV0pOwoKCiAgICAgICAgICAgICAgX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQ29tcGFyZVZpc2l0U3RhdHVzIl0gPSByZXNwb25zZS5kYXRhLmRhdGFbaV0uVmlzaXRTdGF0dXM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhID0gW107CiAgICAgICAgICBfdGhpczEwLnZpc2l0X3N0YXR1c19kYXRhID0gX3RoaXMxMC52aXNpdF9zdGF0dXNfZGF0YS5jb25jYXQobm9uZV9hcHB0LCBjb25maXJtZWRfYXBwdCwgcmVzY2hlZHVsZV9hcHB0LCBkZWxldGVkX2FwcHQpOyAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5jb25jYXQoIGNvbmZpcm1lZF9hcHB0KTsKICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmNvbmNhdChyZXNjaGVkdWxlX2FwcHQpOwogICAgICAgICAgLy8gIHRoaXMudmlzaXRfc3RhdHVzX2RhdGEuY29uY2F0KGRlbGV0ZWRfYXBwdCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PT0gJ05vIEFwcG9pbnRtZW50cyBTY2hlZHVsZWQnIHx8IHJlc3BvbnNlLmRhdGEuZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIF90aGlzMTAudmlzaXRfc3RhdHVzX2RhdGEgPSBbXTsKICAgICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRleHQ6ICJObyBBcHBvaW50bWVudHMgaGF2ZSBiZWVuIHNjaGVkdWxlZCBmb3IgIiArICIgIiArIF90aGlzMTAuZGFpbHlfZGF0ZSwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJPa2F5IgogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgX3RoaXMxMC5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICB9KTsKICAgIH0sCiAgICBjaGFuZ2VTaW5nbGVWaXNpdFN0YXR1czogZnVuY3Rpb24gY2hhbmdlU2luZ2xlVmlzaXRTdGF0dXMoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGRhdGVUb1NlbmQgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOwogICAgICB2YXIgZm9ybUxlbmd0aCA9IHRoaXMudmlzaXRfc3RhdHVzX2RhdGEubGVuZ3RoOwogICAgICB2YXIgYXJyYXkgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybUxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRJRCA9PT0gdGhpcy5BcHBvaW50bWVudElEKSB7CiAgICAgICAgICBhcnJheS5wdXNoKHsKICAgICAgICAgICAgQXBwb2ludG1lbnRJRDogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudElELAogICAgICAgICAgICBWaXNpdG9yTmFtZTogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdG9yTmFtZSwKICAgICAgICAgICAgVmlzaXRTbG90OiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLlZpc2l0U2xvdCwKICAgICAgICAgICAgQXBwb2ludG1lbnRTdGF0dXM6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRTdGF0dXMsCiAgICAgICAgICAgIFZpc2l0U3RhdHVzOiB0aGlzLnZpc2l0U3RhdHVzCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfdmlzaXRfc3RhdHVzX2luZm8oKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgcmVzcG9uc2VfdmlzaXRfc3RhdHVzOiBhcnJheSwKICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICBkYXRlOiBkYXRlVG9TZW5kCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczExLnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiVmlzaXQgU3RhdHVzIEVkaXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIlZpc2l0IFN0YXR1cyBDaGFuZ2VkIFN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMxMS5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBfdGhpczExLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VWaXNpdFN0YXR1czogZnVuY3Rpb24gY2hhbmdlVmlzaXRTdGF0dXMoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGRhdGVUb1NlbmQgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOwogICAgICB2YXIgZm9ybUxlbmd0aCA9IHRoaXMudmlzaXRfc3RhdHVzX2RhdGEubGVuZ3RoOwogICAgICB2YXIgYXJyYXkgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybUxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQ29tcGFyZVZpc2l0U3RhdHVzID09PSB0aGlzLnZpc2l0U3RhdHVzIC8vIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRTdGF0dXMKICAgICAgICApIHt9IGVsc2UgewogICAgICAgICAgYXJyYXkucHVzaCh7CiAgICAgICAgICAgIEFwcG9pbnRtZW50SUQ6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRJRCwKICAgICAgICAgICAgVmlzaXRvck5hbWU6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRvck5hbWUsCiAgICAgICAgICAgIFZpc2l0U2xvdDogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdFNsb3QsCiAgICAgICAgICAgIEFwcG9pbnRtZW50U3RhdHVzOiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkFwcG9pbnRtZW50U3RhdHVzLAogICAgICAgICAgICBWaXNpdFN0YXR1czogdGhpcy52aXNpdFN0YXR1cyAvLyBWaXNpdFN0YXR1czogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdFN0YXR1cwoKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ocl92aXNpdF9zdGF0dXNfaW5mbygpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICByZXNwb25zZV92aXNpdF9zdGF0dXM6IGFycmF5LAogICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgIGRhdGU6IGRhdGVUb1NlbmQKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTIuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJWaXNpdCBTdGF0dXMgRWRpdGVkIikgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiVmlzaXQgU3RhdHVzIENoYW5nZWQgU3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczEyLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQiKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIF90aGlzMTIuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQiKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNvbmZpcm1SZXNjaGVkdWxlOiBmdW5jdGlvbiBjb25maXJtUmVzY2hlZHVsZSgpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdmFyIGlzX2ludmFsaWQgPSBtb21lbnQodGhpcy50ZW1wX2FwcG9pbnRtZW50X2RhdGUsIFsnTU0tREQtWVlZWSddKS5kaWZmKG1vbWVudCgkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlLCBbJ1lZWVktTU0tREQnXSksICJkYXkiKSA9PT0gMCAmJiB0aGlzLnRlbXBfYXBwb2ludG1lbnRfdGltZSA9PSB0aGlzLnNlbGVjdGVkX3RpbWU7CgogICAgICBpZiAoaXNfaW52YWxpZCkgewogICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0ZXh0OiAiSXQgbG9va3MgbGlrZSB5b3UgaGF2ZSBub3QgbWFkZSBhbnkgY2hhbmdlIHRvIHRoZSBhcHBvaW50bWVudCBkYXRlIGFuZCBhcHBvaW50bWVudCB0aW1lIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgdGltZXI6IDkwMDAKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmlsbGVkX3RpbWVfc2xvdHNfc2VsZWN0ZWRfZGF0ZS5pbmNsdWRlcyh0aGlzLnNlbGVjdGVkX3RpbWUpIHx8IHRoaXMuc2VsZWN0ZWRfdGltZSA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgX2F4aW9zJHBvc3QyOwoKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgdmFyIGRhdGVTZWxlY3RlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkYXRlcGlja2VyLWlucHV0IikudmFsdWU7CiAgICAgICAgdmFyIHByZXZpb3VzRGF0ZSA9IG1vbWVudCh0aGlzLnRlbXBfYXBwb2ludG1lbnRfZGF0ZSwgWydNTS1ERC1ZWVlZJ10pLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmhyX3Jlc2NoZWR1bGVfYXBwb2ludG1lbnQoKSwgKF9heGlvcyRwb3N0MiA9IHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLAogICAgICAgICAgY2FuZGlkYXRlX25hbWU6IHRoaXMuY2FuZGlkYXRlX25hbWUsCiAgICAgICAgICBjYW5kaWRhdGVfcG9zaXRpb246IHRoaXMuY2FuZGlkYXRlX3Bvc2l0aW9uLAogICAgICAgICAgdmlzaXRfc2xvdDogdGhpcy5zZWxlY3RlZF90aW1lCiAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImNhbmRpZGF0ZV9wb3NpdGlvbiIsIHRoaXMuY2FuZGlkYXRlX3Bvc2l0aW9uKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImNhbmRpZGF0ZV9lbWFpbCIsIHRoaXMuY2FuZGlkYXRlX2VtYWlsKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInZpc2l0X2RhdGUiLCBkYXRlU2VsZWN0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAicHJldmlvdXNfdmlzaXRfZGF0ZSIsIHByZXZpb3VzRGF0ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJ0b2tlbiIsIHRoaXMuJHNlc3Npb24uZ2V0KCJCb3RUb2tlbiIpKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImFwcG9pbnRtZW50X2lkIiwgdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV9pZCksIF9heGlvcyRwb3N0MiksIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgLy8gdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsaW5nX21vZGFsIikKICAgICAgICAgIF90aGlzMTMuZWRpdF9zY2hlZHVsaW5nID0gZmFsc2U7CgogICAgICAgICAgX3RoaXMxMy5oaWRlX21vZGFsKCJzY2hlZHVsZV9jcmVhdGUiKTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkFwcG9pbnRtZW50IFJlc2NoZWR1bGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgX3RoaXMxMy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIkFwcG9pbnRtZW50IEhhcyBCZWVuIFJlc2NoZWR1bGVkIFN1Y2Nlc3NmdWxseSIpOwoKICAgICAgICAgICAgX3RoaXMxMy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMTMuc2hvd19zcGlubmVyID0gZmFsc2U7CgogICAgICAgICAgICBfdGhpczEzLnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwoKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21ldGhpbmcgV2VudCBXcm9uZyIpOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgLy8gICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgLy8gfSwgMTAwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBfdGhpczEzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBrZWVwY2hlY2tpbmdkYXRlOiBmdW5jdGlvbiBrZWVwY2hlY2tpbmdkYXRlKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuZGF0ZXBpY2tlckluc3RhbmNlLm9uKCJjbG9zZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyB2bS5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIHZtLmNoZWNrZGF0ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICBjaGVja2RhdGU6IGZ1bmN0aW9uIGNoZWNrZGF0ZSgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgLy9ldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgZHQgPSBuZXcgRGF0ZSgpOwoKICAgICAgaWYgKHRoaXMuZGF0ZV9jb25kaXRpb24oZHQsIG5ldyBEYXRlKCQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUpKSkgewogICAgICAgIHRoaXMuc2VsZWN0ZWRfZGF0ZSA9ICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWU7CiAgICAgICAgdmFyIHN0YXJ0X2RhdGUgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOwogICAgICAgIHZhciBzZWxlY3RlZF90aW1lID0gdGhpcy5zZWxlY3RlZF90aW1lOwogICAgICAgIHZhciB0aW1lID0gZHQuZ2V0SG91cnMoKSArICI6IiArIGR0LmdldE1pbnV0ZXMoKSArICI6IiArIGR0LmdldFNlY29uZHMoKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ocl9nZXRfc2NoZWR1bGVfYXBwb2ludG1lbnQoKSwgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBwaG9uZV9udW1iZXI6IHRoaXMudmlzaXRvcl9udW1iZXIsCiAgICAgICAgICBEYXRlOiB0aGlzLnNlbGVjdGVkX2RhdGUsCiAgICAgICAgICBhcHBvaW50bWVudF9kYXRlOiB0aGlzLnNlbGVjdGVkX2RhdGUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczE0Lm5ld19zZWxlY3RlZF9kYXRlID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsgLy8gICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUgPSB0aGlzLnNlbGVjdGVkX2RhdGU7CgogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCkge30gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHVwZGF0ZSB5b3VyIHNjaGVkdWxlciBzZXR0aW5ncyIpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgKHJlc3BvbnNlLmRhdGEuRnVsbFRpbWVTbG90ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyAgIHZhciBkdCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIC8vICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMgPSBbXTsKICAgICAgICAgICAgLy8gICB0aGlzLnRpbWVfc2xvdHMgPSBbXTsKICAgICAgICAgICAgLy8gICAvLyBmb3IgKHZhciBpIGluIHRoaXMuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgIC8vICAgLy8gICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAvLyAgIC8vICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5GdWxsVGltZVNsb3RbaV0sCiAgICAgICAgICAgIC8vICAgLy8gICAgIHRleHQ6IHRoaXMuZ2VuZXJhdGVfdGltZSgKICAgICAgICAgICAgLy8gICAvLyAgICAgICByZXNwb25zZS5kYXRhLkZ1bGxUaW1lU2xvdFtpXS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAvLyAgIC8vICAgICAgIHJlc3BvbnNlLmRhdGEuRnVsbFRpbWVTbG90W2ldLnNwbGl0KCItIilbMV0KICAgICAgICAgICAgLy8gICAvLyAgICAgKQogICAgICAgICAgICAvLyAgIC8vICAgICB9KTsKICAgICAgICAgICAgLy8gICAvLyAgIGlmICgKICAgICAgICAgICAgLy8gICAvLyAgICAgcmVzcG9uc2UuZGF0YS5BdmFpbGFibGVUaW1lU2xvdC5pbmRleE9mKAogICAgICAgICAgICAvLyAgIC8vICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzW2ldLnZhbHVlCiAgICAgICAgICAgIC8vICAgLy8gICAgICkgPT0gLTEKICAgICAgICAgICAgLy8gICAvLyAgICkgewogICAgICAgICAgICAvLyAgIC8vICAgICB0aGlzLnRpbWVfc2xvdHMucHVzaCh0aGlzLmZ1bGxfdGltZV9zbG90c1tpXSk7CiAgICAgICAgICAgIC8vICAgLy8gICB9CiAgICAgICAgICAgIC8vICAgLy8gfQogICAgICAgICAgICAvLyAgICAgZm9yKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHMpewogICAgICAgICAgICAvLyAgICAgICB0aGlzLmZ1bGxfdGltZV9zbG90cy5wdXNoKHsKICAgICAgICAgICAgLy8gICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXSwKICAgICAgICAgICAgLy8gICAgICAgICB0ZXh0OiB0aGlzLmdlbmVyYXRlX3RpbWUoCiAgICAgICAgICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLAogICAgICAgICAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXQogICAgICAgICAgICAvLyAgICAgICAgICkKICAgICAgICAgICAgLy8gICAgICAgfSkKICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gICAgICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUgPSB0aGlzLnNlbGVjdGVkX2RhdGUKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICBfdGhpczE0LmlzUmVzY2hlZHVsZXRpbWUgPSB0cnVlOwogICAgICAgICAgICBfdGhpczE0LmZ1bGxfdGltZV9zbG90cyA9IFtdOwogICAgICAgICAgICBfdGhpczE0LnRpbWVfc2xvdHMgPSBbXTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90cyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB2YXIgZHQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIF90aGlzMTQuZnVsbF90aW1lX3Nsb3RzID0gW107CiAgICAgICAgICAgICAgdmFyIGdldF9mdWxsX3Nsb3RfbGlzdCA9IHRydWU7CiAgICAgICAgICAgICAgdmFyIHRlbXBfc3RhcnRfZGF0ZSA9IG5ldyBEYXRlKHN0YXJ0X2RhdGUpOwoKICAgICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgPiBkdC5nZXRGdWxsWWVhcigpKSB7fSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSA9PSBkdC5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICAgICAgICBpZiAodGVtcF9zdGFydF9kYXRlLmdldE1vbnRoKCkgPiBkdC5nZXRNb250aCgpKSB7fSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0TW9udGgoKSA9PSBkdC5nZXRNb250aCgpKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RGF0ZSgpID4gZHQuZ2V0RGF0ZSgpKSB7fSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RGF0ZSgpID09IGR0LmdldERhdGUoKSkgewogICAgICAgICAgICAgICAgICAgIGdldF9mdWxsX3Nsb3RfbGlzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZ2V0X2Z1bGxfc2xvdF9saXN0KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTQuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczE0LmdlbmVyYXRlX3RpbWUocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXSwgcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXSkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMpIHsKICAgICAgICAgICAgICAgICAgaWYgKGR0LmdldEhvdXJzKCkgPCBOdW1iZXIocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzMTQuZnVsbF90aW1lX3Nsb3RzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXMxNC5nZW5lcmF0ZV90aW1lKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0pCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IC8vIGlmIChzZWxlY3RlZF90aW1lICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIC8vICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgICAvLyAgIHRoaXMuc2VsZWN0ZWRfdGltZSA9IHNlbGVjdGVkX3RpbWU7CiAgICAgICAgICAgICAgLy8gICB0aGlzLnNjaGVkdWxlZF90aW1lID0gdGhpcy5nZW5lcmF0ZV90aW1lKAogICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMF0sCiAgICAgICAgICAgICAgLy8gICAgIHNlbGVjdGVkX3RpbWUuc3BsaXQoIi0iKVsxXQogICAgICAgICAgICAgIC8vICAgKTsKICAgICAgICAgICAgICAvLyB9IGVsc2UgaWYgKHNlbGVjdGVkX3RpbWUgPT0gdW5kZWZpbmVkKSB7CgoKICAgICAgICAgICAgICBfdGhpczE0LmZpbGxlZF90aW1lX3Nsb3RzX3NlbGVjdGVkX2RhdGUgPSByZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzOwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90cy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxNC50aW1lX3Nsb3RzID0gX3RoaXMxNC5mdWxsX3RpbWVfc2xvdHM7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzMTQudGltZV9zbG90cyA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gX3RoaXMxNC5mdWxsX3RpbWVfc2xvdHMpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZmlsbGVkX3RpbWVfc2xvdHMuaW5kZXhPZihfdGhpczE0LmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZSkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczE0LnRpbWVfc2xvdHMucHVzaChfdGhpczE0LmZ1bGxfdGltZV9zbG90c1tpXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gLy8gdGhpcy50aW1lX3Nsb3RzID0gcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90czsKCiAgICAgICAgICAgICAgfSAvL30KCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczE0LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIFNlbGVjdCBBIFZhbGlkIERhdGUiKTsKICAgICAgICB0aGlzLmRhdGVwaWNrZXJJbnN0YW5jZS5vcGVuKCk7CiAgICAgICAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMubmV3X3NlbGVjdGVkX2RhdGU7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX3JlbWluZGVyOiBmdW5jdGlvbiBzZW5kX3JlbWluZGVyKEFwcG9pbnRtZW50SUQpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgc3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgIHRleHQ6ICIgWW91IHdhbnQgdG8gU2VuZCB0aGUgUmVtaW5kZXIiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIFNlbmQhISIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXMxNS5zaG93X3NwaW5uZXIgPSB0cnVlOyAvLyB2YXIgdG9kYXlzX2RhdGUgPSB0aGlzLmRhaWx5X2RhdGU7CgogICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShfdGhpczE1LnRlbXBfYXBwb2ludG1lbnRfZGF0ZSk7CiAgICAgICAgICB2YXIgcHJldmlvdXNEYXRlID0gZC5nZXRGdWxsWWVhcigpICsgIi0iICsgKGQuZ2V0TW9udGgoKSArIDEpICsgIi0iICsgZC5nZXREYXRlKCk7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zZW5kX3JlbWluZGVyKCksIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiBfdGhpczE1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgZW1haWw6IF90aGlzMTUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMTUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IF90aGlzMTUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiBBcHBvaW50bWVudElELAogICAgICAgICAgICBkYXRlOiBwcmV2aW91c0RhdGUsCiAgICAgICAgICAgIHZpc2l0X3Nsb3Q6IF90aGlzMTUuZGlzcGxheV9zZWxlY3RlZF90aW1lCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTUuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczE1LnNob3dfc3Bpbm5lciA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2VzcyA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIk5vdGlmaWNhdGlvbiBIYXMgYmVlbiBzZW50Iik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdWNjZXNzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJDb3VsZCBOb3QgU2VuZCBOb3RpZmljYXRpb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgIF90aGlzMTUuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNvbmZpcm1BcHBvaW50bWVudDogZnVuY3Rpb24gY29uZmlybUFwcG9pbnRtZW50KCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgaXNfaW52YWxpZCA9IG1vbWVudCgpLmRpZmYobW9tZW50KCIiLmNvbmNhdCh0aGlzLnRlbXBfYXBwb2ludG1lbnRfdGltZSwgIiAiKS5jb25jYXQodGhpcy50ZW1wX2FwcG9pbnRtZW50X2RhdGUpLCBbJ0hIOm1tIE1NLURELVlZWVknXSksICJtaW51dGUiKSA+PSAwOyAvLyBpZiAoKHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlICE9ICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUpIHx8IHRoaXMudGVtcF9hcHBvaW50bWVudF90aW1lICE9IHRoaXMuc2VsZWN0ZWRfdGltZSkgewoKICAgICAgaWYgKGlzX2ludmFsaWQpIHsKICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGV4dDogIkl0IGxvb2tzIGxpa2UgeW91IGhhdmUgbWFkZSBjaGFuZ2UgdG8gdGhlIGFwcG9pbnRtZW50IGRhdGUgYW5kIGFwcG9pbnRtZW50IHRpbWUsIHNvIHBsZWFzZSByZXNjaGVkdWxlIHRoZSBhcHBvaW50bWVudCBmaXJzdCIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIHRpbWVyOiA1MDAwCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7fSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiIFlvdSB3YW50IHRvIENvbmZpcm0gdGhlIEFwcHBvaW50bWVudD8gVGhpcyB3aWxsIHNlbmQgYSBtZXNzYWdlIHRvIHRoZSBwYXRpZW50IiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIGlmIChfdGhpczE2LnRlbXBfbmFtZSAhPSBfdGhpczE2LmNhbmRpZGF0ZV9uYW1lIHx8IF90aGlzMTYudGVtcF9wb3NpdGlvbiAhPSBfdGhpczE2LmNhbmRpZGF0ZV9wb3NpdGlvbiB8fCBfdGhpczE2LnRlbXBfZW1haWwgIT0gX3RoaXMxNi5jYW5kaWRhdGVfZW1haWwpIHsKICAgICAgICAgICAgICB2YXIgX2FwcG9pbnRtZW50X3BheWxvYWQ7CgogICAgICAgICAgICAgIC8vIGFsZXJ0KCJIaSIpOwogICAgICAgICAgICAgIHZhciBhcHBvaW50bWVudF9wYXlsb2FkID0gKF9hcHBvaW50bWVudF9wYXlsb2FkID0gewogICAgICAgICAgICAgICAgY2FuZGlkYXRlX25hbWU6IF90aGlzMTYuY2FuZGlkYXRlX25hbWUsCiAgICAgICAgICAgICAgICBjYW5kaWRhdGVfcG9zaXRpb246IF90aGlzMTYuY2FuZGlkYXRlX3Bvc2l0aW9uCiAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9hcHBvaW50bWVudF9wYXlsb2FkLCAiY2FuZGlkYXRlX3Bvc2l0aW9uIiwgX3RoaXMxNi5jYW5kaWRhdGVfZW1haWwpLCBfZGVmaW5lUHJvcGVydHkoX2FwcG9pbnRtZW50X3BheWxvYWQsICJWaXNpdFNsb3QiLCBfdGhpczE2LnNlbGVjdGVkX3RpbWUpLCBfZGVmaW5lUHJvcGVydHkoX2FwcG9pbnRtZW50X3BheWxvYWQsICJQaG9uZU51bWJlciIsIF90aGlzMTYudmlzaXRvcl9udW1iZXIpLCBfZGVmaW5lUHJvcGVydHkoX2FwcG9pbnRtZW50X3BheWxvYWQsICJWaXNpdERhdGUiLCBfdGhpczE2LnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXSksIF9hcHBvaW50bWVudF9wYXlsb2FkKTsKICAgICAgICAgICAgICBfdGhpczE2LnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfZWRpdF9kZWxldGVfdXJsKCksIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgZW1haWw6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIGRhdGU6IF90aGlzMTYuc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdC5zcGxpdCgiICIpWzBdLAogICAgICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiBfdGhpczE2LnNlbGVjdGVkX3NjaGVkdWxlX2lkLAogICAgICAgICAgICAgICAgYXBwb2ludG1lbnRfaW5mbzogYXBwb2ludG1lbnRfcGF5bG9hZAogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczE2LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tc2cgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubXNnID09ICJFZGl0IEFwcG9pbnRtZW50IikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciBhcHBvaW50bWVudCBoYXMgYmVlbiBlZGl0ZWQgc3VjY2Vzc2Z1bGx5LiIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgICAkKCIjc2NoZWR1bGVfZGV0YWlscyIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgICAkKCIjc2NoZWR1bGVfZGV0YWlscyIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTYuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIGRhdGVTZWxlY3RlZCA9IG1vbWVudChfdGhpczE2LnRlbXBfYXBwb2ludG1lbnRfZGF0ZSwgWydNTS1ERC1ZWVlZJ10pLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwogICAgICAgICAgICB2YXIgRGF0ZTEgPSBfdGhpczE2LnByZXZpb3VzX3Zpc2l0X2RhdGU7CiAgICAgICAgICAgIHZhciBwcmV2aW91c0RhdGUgPSBtb21lbnQoRGF0ZTEpLmZvcm1hdCgnWVlZWS1NTS1ERCcpOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jb25maXJtX2FwcG9pbnRtZW50KCksIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiBfdGhpczE2LnZpc2l0b3JfbnVtYmVyLAogICAgICAgICAgICAgIGNhbmRpZGF0ZV9uYW1lOiBfdGhpczE2LmNhbmRpZGF0ZV9uYW1lLAogICAgICAgICAgICAgIGNhbmRpZGF0ZV9wb3NpdGlvbjogX3RoaXMxNi5jYW5kaWRhdGVfcG9zaXRpb24sCiAgICAgICAgICAgICAgdmlzaXRfc2xvdDogX3RoaXMxNi5zZWxlY3RlZF90aW1lLAogICAgICAgICAgICAgIGNhbmRpZGF0ZV9lbWFpbDogX3RoaXMxNi5jYW5kaWRhdGVfZW1haWwsCiAgICAgICAgICAgICAgdmlzaXRfZGF0ZTogZGF0ZVNlbGVjdGVkLAogICAgICAgICAgICAgIHRva2VuOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiBfdGhpczE2LnNlbGVjdGVkX3NjaGVkdWxlX2lkCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMTYuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBfdGhpczE2LmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJBcHBvaW50bWVudCBDb25maXJtZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJBcHBvaW50bWVudCBoYXMgYmVlbiBDb25maXJtZWQiKTsKCiAgICAgICAgICAgICAgICBfdGhpczE2LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkFwcG9pbnRtZW50IENvbmZpcm1hdGlvbiBGYWlsZWQiKSB7CiAgICAgICAgICAgICAgICBfdGhpczE2LnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIkFwcG9pbnRtZW50IENvbmZpcm1hdGlvbiBGYWlsZWQiKTsKCiAgICAgICAgICAgICAgICBfdGhpczE2LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkFuIEVycm9yIE9jY3VycmVkIikgewogICAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZXRoaW5nIFdlbnQgV3JvbmciKTsKCiAgICAgICAgICAgICAgICBfdGhpczE2LnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNhbmNlbF9yZXNjaGVkdWxlOiBmdW5jdGlvbiBjYW5jZWxfcmVzY2hlZHVsZSgpIHsKICAgICAgdGhpcy5pc1Jlc2NoZWR1bGUgPSAhdGhpcy5pc1Jlc2NoZWR1bGU7IC8vICAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlID0gdGhpcy50ZW1wX2RhdGE7CiAgICB9LAogICAgY29udmVydF9jYXNpbmc6IGZ1bmN0aW9uIGNvbnZlcnRfY2FzaW5nKHRleHQpIHsKICAgICAgaWYgKHRleHQgPT09ICdub25lJykgewogICAgICAgIHRleHQgPSAnc2NoZWR1bGVkJzsKICAgICAgfQoKICAgICAgdGV4dCA9IHRleHQudG9TdHJpbmcoKTsKICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvXHdcUyovZywgZnVuY3Rpb24gKHR4dCkgewogICAgICAgIHJldHVybiB0eHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdHh0OwogICAgfSwKICAgIGhpZGVfbW9kYWw6IGZ1bmN0aW9uIGhpZGVfbW9kYWwoaWQpIHsKICAgICAgJCgiIyIuY29uY2F0KGlkKSkubW9kYWwoJ2hpZGUnKTsKICAgIH0sCiAgICB1cGRhdGVfc2NoZWR1bGVzX2xpc3Q6IGZ1bmN0aW9uIHVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaHJfZ2V0X3NjaGVkdWxlX2luZm9fdXJsKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGZpcnN0X2RheTogdGhpcy5tb250aF9yYW5nZSgic3RhcnRfdGltZSIpLAogICAgICAgIGxhc3RfZGF5OiB0aGlzLm1vbnRoX3JhbmdlKCJlbmRfdGltZSIpCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE3LnJlbmRlcl9zY2hlZHVsZShyZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mbyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},null]}