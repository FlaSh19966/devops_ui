{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/NewIntentPage.vue","mtime":1663910265466},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybCI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiL2hvbWUvdmltYWxlc2gvTGVhcm5pbmcvZGV2b3BzX3VpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IFRlbXBsYXRlIGZyb20gIi4uL1RlbXBsYXRlLnZ1ZSI7CmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKaW1wb3J0IHsgYnVzIH0gZnJvbSAiQC9wb3J0YWwvbWFpbiI7CmltcG9ydCBwYWdlX2d1aWRlIGZyb20gIkAvcG9ydGFsL21peGlucy9wYWdlX2d1aWRlLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIFRlbXBsYXRlOiBUZW1wbGF0ZSwKICAgIFZ1ZUVkaXRvcjogVnVlRWRpdG9yCiAgfSwKICBuYW1lOiAiTmV3SW50ZW50c1BhZ2UiLAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsIHBhZ2VfZ3VpZGUsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbF0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBlbmNpbF9zdmc6ICcgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgcG9pbnRfY2lyY2xlX3N2ZzogJzxzdmcgZGF0YS12LThjYjhkOWZlPSIiIGRhdGEtdG9vbHRpcD0idG9vbHRpcCIgZGF0YS1wbGFjZW1lbnQ9ImJvdHRvbSIgdGl0bGU9IiIgZGF0YS10b2dnbGU9Im1vZGFsIiBkYXRhLXRhcmdldD0iI2NvbmZpZ2FwaW1vZGFsNCIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgaGVpZ2h0PSIyNCIgd2lkdGg9IjI0IiB2ZXJzaW9uPSIxLjEiIGRhdGEtb3JpZ2luYWwtdGl0bGU9IkhlbHAiPjxnIGRhdGEtdi04Y2I4ZDlmZT0iIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC0xMDI4LjQpIj48cGF0aCBkYXRhLXYtOGNiOGQ5ZmU9IiIgZD0ibTIyIDEyYzAgNS41MjMtNC40NzcgMTAtMTAgMTAtNS41MjI4IDAtMTAtNC40NzctMTAtMTAgMC01LjUyMjggNC40NzcyLTEwIDEwLTEwIDUuNTIzIDAgMTAgNC40NzcyIDEwIDEweiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAxMDI5LjQpIiBmaWxsPSIjMjk4MGI5Ij48L3BhdGg+PHBhdGggZGF0YS12LThjYjhkOWZlPSIiIGQ9Im0yMiAxMmMwIDUuNTIzLTQuNDc3IDEwLTEwIDEwLTUuNTIyOCAwLTEwLTQuNDc3LTEwLTEwIDAtNS41MjI4IDQuNDc3Mi0xMCAxMC0xMCA1LjUyMyAwIDEwIDQuNDc3MiAxMCAxMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMTAyOC40KSIgZmlsbD0iIzI3MzY3OSI+PC9wYXRoPjwvZz48L3N2Zz4nLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgcGFnZV9ubzogMSwKICAgICAgcGVyX3BhZ2U6IDE1LAogICAgICBuZXdfaW50ZW50X2xpc3Q6IFtdLAogICAgICBvbGRfaW50ZW50X25hbWU6ICIiLAogICAgICBvbGRfcXVlc3Rpb25zX2xpc3Q6IFtdLAogICAgICBvbGRfaW1hZ2VfbmFtZTogIiIsCiAgICAgIG9sZF92aWRlb191cmw6ICIiLAogICAgICBpbnRlbnRsaXN0OiBbXSwKICAgICAgY29tcGFueW5hbWU6ICIiLAogICAgICBjb21wYW55aWQ6ICIiLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgZWRpdDogIkZhbHNlIiwKICAgICAgYWRkX2VkaXQ6ICJmYWxzZSIsCiAgICAgIC8vIGVkaXRfcmVzcG9uc2U6ICIiLAogICAgICBvbGRfaW50ZW50X2RhdGE6IFtdLAogICAgICBuZXdfaW50ZW50X2RhdGE6IFtdLAogICAgICBpc19yZXNwb25zZTogZmFsc2UsCiAgICAgIGlzX2VuZHBvaW50OiBmYWxzZSwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBzaG93X3Rhc2tfdmFsdWVzOiBmYWxzZSwKICAgICAgc2F2ZV9zaG93X3Rhc2tfdmFsdWVzOiBmYWxzZSwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHBhZ2VubzogIiIsCiAgICAgIHZpZXdfZGVmaW5lX2FwaV9lbmRwb2ludHM6IGZhbHNlLAogICAgICBkZWZpbmVfYXBpX2VuZHBvaW50czogZmFsc2UsCiAgICAgIHZpZXdfcmVzcG9uc2VfbW9kYWw6IHRydWUsCiAgICAgIGVkaXRfdmlld19yZXNwb25zZV9tb2RhbDogdHJ1ZSwKICAgICAgaW1hZ2VfcmVzcG9uc2U6ICJObyIsCiAgICAgIHZpZGVvX3Jlc3BvbnNlOiAiTm8iLAogICAgICB2aWRlb19saW5rOiAiIiwKICAgICAgZW1iZF9saW5rOiAiIiwKICAgICAgZW1iZF9saW5rX2VkaXQ6ICIiLAogICAgICBmaWxlX2xhYmVsOiAiQ2hvb3NlIGZpbGUiLAogICAgICBmaWxlX2xhYmVsMjogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbDM6ICJDaG9vc2UgZmlsZSIsCiAgICAgIG9wdGlvbnM6IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudDogIiIsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4OiAwLAogICAgICAvL3RoaXMgaXMgYWxzbyB1c2VkIHRvIGVkaXQgaW50ZW50IHJlc3BvbnNlCiAgICAgIHNlbGVjdGVkX2ludGVudF9yZXNwb25zZTogWyIiXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaGlnaGxpZ2h0OiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX2ltYWdlOiAiIiwKICAgICAgbmFtZV9maWxlOiAiIiwKICAgICAgdGVtcF9maWxlX25hbWU6ICIiLAogICAgICBzZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfdmlkZW86ICIiLAogICAgICBzZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Vfc291cmNlOiAiIiwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9uczogWyIiXSwKICAgICAgaXNFZGl0SW50ZW50OiBmYWxzZSwKICAgICAgdXJsOiAiIiwKICAgICAgLy8gVGhpcyBWYXJpYWJsZXMgYXJlIGZvciBORVcgSU5URU5UCiAgICAgIG5ld19pbnRlbnRzOiAiIiwKICAgICAgYWRkX3F1ZXN0aW9uc19saXN0OiBbIiJdLAogICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAvLyByZXNwb25zZTogWyIiXSwKICAgICAgbXVsdGlwbGVfcmVzcG9uc2U6IFsiIl0sCiAgICAgIGN1c3RvbVRvb2xiYXI6IFtbImJvbGQiLCAiaXRhbGljIiwgInVuZGVybGluZSJdLCBbewogICAgICAgIGNvbG9yOiBbXQogICAgICB9LCB7CiAgICAgICAgYmFja2dyb3VuZDogW10KICAgICAgfV0sIFt7CiAgICAgICAgbGlzdDogIm9yZGVyZWQiCiAgICAgIH0sIHsKICAgICAgICBsaXN0OiAiYnVsbGV0IgogICAgICB9XSwgWyJsaW5rIl1dLAogICAgICBzYXZlX3VybDogIiIsCiAgICAgIHNhdmVfYXBpX21ldGhvZDogbnVsbCwKICAgICAgc2F2ZV9qc29uX3JlcXVlc3RfZGF0YTogIiIsCiAgICAgIHNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlOiBudWxsLAogICAgICBzYXZlX2VkaXRhYmxlX3ZhbHVlczogIiIsCiAgICAgIHNhdmVfdGFza19pbnB1dF92YWx1ZXM6IFtdLAogICAgICBzYXZlX2VuZHVzZXJfbXNnX3R5cGU6ICJDdXN0b20iLAogICAgICBzYXZlX2pzb25fcmVzcG9uc2VfZGF0YTogIiIsCiAgICAgIHNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXI6ICIiLAogICAgICBzYXZlX2VuZF91c2VyX21lc3NhZ2U6ICIiLAogICAgICBzYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGU6IG51bGwsCiAgICAgIHNhdmVfcmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZTogIiIsCiAgICAgIHNhdmVfdW5zdWNjZXNzZnVsX21lc3NhZ2U6IG51bGwsCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgYXBpX21ldGhvZDogbnVsbCwKICAgICAgcG9zdF9tZXRob2RfcmVxdWVzdF9saXN0OiBbXSwKICAgICAgc2hvd19qc29uX3JlcXVlc3RfZGF0YTogIiIsCiAgICAgIHNob3dfanNvbl9yZXNwb25zZV9kYXRhOiAiIiwKICAgICAgcmVxdWVzdF9qc29uX2VkaXRhYmxlOiBudWxsLAogICAgICBlZGl0YWJsZV92YWx1ZXM6ICIiLAogICAgICBpc0VkaXQ6IGZhbHNlLAogICAgICB1dHRlcmFuY2VzOiBbXSwKICAgICAgZW5kdXNlcl9tc2dfdHlwZTogbnVsbCwKICAgICAgcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXI6ICIiLAogICAgICBlbmRfdXNlcl9tZXNzYWdlOiBudWxsLAogICAgICByZXNwb25zZV9qc29uX2VkaXRhYmxlOiBudWxsLAogICAgICByZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlOiAiIiwKICAgICAgdW5zdWNjZXNzZnVsX21lc3NhZ2U6IG51bGwsCiAgICAgIGZpbmFsc3RlcDogZmFsc2UsCiAgICAgIGFwaV9saXN0OiBbXSwKICAgICAgcmVxdWVzdF9qc29uX2Nhc2VfMTogIntcbiAgICAgICAgICBcImNvbXBhbnlpZFwiOlwiQ29tcGFueUlkXCIsXG4gICAgICAgICAgXCJlbWFpbFwiOlwiZW1haWxcIixcbiAgICAgICAgICBcInJvbGVcIjpcInJvbGVcIixcbiAgICAgICAgICBcInN1YmplY3RcIjpcIiBcIixcbiAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6XCIgXCIsXG4gICAgICAgIH0iLAogICAgICBpbnB1dF9mcm9tX3VzZXJfY2FzZV8xOiAic3ViamVjdDtkZXNjcmlwdGlvbiIsCiAgICAgIHJlcXVlc3RfanNvbl9jYXNlXzI6ICJ7XG5cdCAgICAgICAgXCJ1c2VyXCI6IHtcblx0XHQgICAgICBcImNvbXBhbnlpZFwiOiAnY29tcGFueUlkJyxcblx0XHQgICAgICBcImVtYWlsXCI6ICdlbWFpbCcsXG5cdFx0ICAgICAgXCJyb2xlXCI6ICdyb2xlJyxcblx0XHQgICAgICBcImluZm9cIjoge1xuXHRcdCAgICAgIFx0XCJuaWNrbmFtZVwiOiBcIlwiXG5cdFx0ICAgICAgfVxuXHQgICAgICB9LFxuXHQgICAgICBcInNlYXJjaHBhcmFtZXRlclwiOiB7XG5cdFx0ICAgICAgXCJzdGF0dXNcIjogXCJcIixcblx0XHQgICAgICBcIm9yZGVyYnlcIjogXCJcIixcblx0XHQgICAgICBcImZyb21kYXRlXCI6IFwiMDEvMDEvMjAxOFwiLFxuXHRcdCAgICAgIFwiY291bnRcIjogMTAsXG5cdFx0ICAgICAgXCJzZWFyY2h0ZXh0XCI6IFwiXCIsXG5cdFx0ICAgICAgXCJ0eXBlb2Z2aXNpdFwiOiBcIkFMTFwiLFxuXHRcdCAgICAgIFwic29ydG9yZGVyXCI6IFwiYXBwb2ludG1lbnRcIixcblx0XHQgICAgICBcInN0YXJ0aW5kZXhcIjogXCIxXCIsXG5cdFx0ICAgICAgXCJlbmRpbmRleFwiOiBcIjEwXCIsXG5cdFx0ICAgICAgXCJ0b2RhdGVcIjogXCIwOC8wNi8yMDE4XCJcblx0ICAgICAgfVxuXG4gICAgICB9IiwKICAgICAgaW5wdXRfZnJvbV91c2VyX2Nhc2VfMjogInVzZXIsaW5mbyxuaWNrbmFtZTtzZWFyY2hwYXJhbWV0ZXIsZnJvbWRhdGU7c2VhcmNocGFyYW1ldGVyLHRvZGF0ZSIsCiAgICAgIHJlcXVlc3RfanNvbl9jYXNlXzM6ICJ7IFxuICAgICAgICAgIFwiY29tcGFueWlkXCI6XCJjb21wYW55aWRcIixcbiAgICAgICAgICBcImVtYWlsXCI6XCJlbWFpbFwiLFxuICAgICAgICAgIFwicm9sZVwiOlwicm9sZVwiIFxuICAgICAgfSIsCiAgICAgIHJlc3BvbnNlX2pzb25fY2FzZV8xOiAie1xuICAgICAgICAgICdtZXNzYWdlJzonWW91ciBhcHBvaW50bWVudCBoYXMgYmVlbiBzY2hlZHVsZWQnLFxuICAgICAgICAgICd1c2VybmFtZSc6J0NlbnNlJyxcbiAgICAgICAgICAnZW1haWwnOid1c2VyQGNlbnNlLmFpJ1xuICAgICAgfSIsCiAgICAgIHJlc3BvbnNlX2pzb25fY2FzZV8xMTogIntcbiAgICAgICAgICAnbWVzc2FnZSc6J0FQSSBleGVjdXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgICdjb3VudCc6JzgnXG4gICAgICAgICAgJ3VzZXJuYW1lJzonQ2Vuc2UnLFxuICAgICAgICAgICdlbWFpbCc6J3VzZXJAY2Vuc2UuYWknXG4gICAgICB9IiwKICAgICAgdGFza19pbnB1dF92YWx1ZXM6IFtdLAogICAgICBpbnRlbnRfYWxyZWFkeV9leGlzdHM6IGZhbHNlLAogICAgICBpbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdDogZmFsc2UsCiAgICAgIGVkaXRfdmlkZW9fcmVzcG9uc2U6ICJObyIsCiAgICAgIGVkaXRfaW1hZ2VfcmVzcG9uc2U6ICJObyIsCiAgICAgIGZpbGVfY29udGVudDI6ICIiLAogICAgICBmaWxlX2NvbnRlbnQzOiAiIiwKICAgICAgc3Bpbm5lck9uRmlsZURvd25sb2FkOiBmYWxzZSwKICAgICAgZmlsZV9sYWJlbF9jc3Y6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfY29udGVudF9jc3Y6ICIiLAogICAgICBkZWZhdWx0X3JldGFpbF9pbnRlbnRzOiBbXSwKICAgICAgd2FudF9zdGF0dXM6IHRydWUsCiAgICAgIGludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3M6IGZhbHNlLAogICAgICBzZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb246ICcnLAogICAgICBpc19zZWFyY2hfYWN0aXZlOiBmYWxzZSwKICAgICAgZGF0YV9pc19lbWl0OiAiIiwKICAgICAgZGlzYWJsZV9idG5fZXhwaXJlZDogZmFsc2UsCiAgICAgIHJlZ191cmw6IC9odHRwczpcL1wvWyh3d3dcLik/YS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIoWy1hLXpBLVowLTlAOiVfXCsufiM/JlwvXC89XSopL2ksCiAgICAgIG5ld19pbnRlbnRfcXVlc3Rpb25fbGlzdDogWycnXQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICAgIHRvYXN0ci53YXJuaW5nKHRoaXMudGx0KCdpbnRlbnRfcGFnZV9zZWxlY3RfY29tcGFueV9tc2cnKSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQoKICAgIGF4aW9zLmdldChhcGlfY2FsbHMuc291cmNlX2xpc3RfdXJsKCksIHsKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGlmIChfdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgX3RoaXMub3B0aW9ucyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgfSBlbHNlIGlmIChfdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIkludGVybmFsIHNlcnZlciBlcnJvciIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgX3RoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgIH0KICAgIH0pOwogICAgYXhpb3MuZ2V0KGFwaV9jYWxscy5nZXRfbmVyX3RhZ3MoKSwgewogICAgICBwYXJhbXM6IHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgIH0sCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICBfdGhpcy5lbnRpdHlfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgX3RoaXMucG9zdF9tZXRob2RfcmVxdWVzdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgX3RoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgdGhpcy5jaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXMoKTsgLy8gY29uc29sZS5sb2coIlV0dGVyYW5jZXMiLCB0aGlzLnV0dGVyYW5jZXMpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGVkaXRhYmxlX3ZhbHVlczogZnVuY3Rpb24gZWRpdGFibGVfdmFsdWVzKCkgewogICAgICBpZiAodGhpcy5lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICB0aGlzLnNob3dfdGFza192YWx1ZXMgPSB0cnVlOyAvLyAgY29uc29sZS5sb2coIkhlcmUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfdGFza192YWx1ZXMgPSBmYWxzZTsgLy8gIGNvbnNvbGUubG9nKCJOb3QgSGVyZSIpOwogICAgICB9CiAgICB9LAogICAgc2F2ZV9lZGl0YWJsZV92YWx1ZXM6IGZ1bmN0aW9uIHNhdmVfZWRpdGFibGVfdmFsdWVzKCkgewogICAgICBpZiAodGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyAhPSAiIikgewogICAgICAgIHRoaXMuc2F2ZV9zaG93X3Rhc2tfdmFsdWVzID0gdHJ1ZTsgLy8gIGNvbnNvbGUubG9nKCJIZXJlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zYXZlX3Nob3dfdGFza192YWx1ZXMgPSBmYWxzZTsgLy8gIGNvbnNvbGUubG9nKCJOb3QgSGVyZSIpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX25hbWU6IGZ1bmN0aW9uIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBuZXdfaW50ZW50czogZnVuY3Rpb24gbmV3X2ludGVudHModmFsKSB7CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfSwKICAgIGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50OiBmdW5jdGlvbiBjdXJyZW50X3NlbGVjdGVkX2ludGVudCh2YWwpIHsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCA9IHZhbC5yZXBsYWNlKC9bXmEtekEtWjAtOV8gXS9nLCAiIik7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgY2hlY2tfc2VsZWN0X2FsbF9pbnRlbnRzX2NieF9kaXNhYmxlZDogZnVuY3Rpb24gY2hlY2tfc2VsZWN0X2FsbF9pbnRlbnRzX2NieF9kaXNhYmxlZCgpIHsKICAgICAgaWYgKHRoaXMuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHRlbXAgPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCF0aGlzLmRlZmF1bHRfcmV0YWlsX2ludGVudHMuaW5jbHVkZXModGhpcy5pbnRlbnRsaXN0W2ldLkludGVudCkpIHsKICAgICAgICAgICAgdGVtcCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRlbXA7CiAgICAgIH0KICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICB0aGlzLnBhZ2VfZ3VpZGUoKTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBfdGhpczIuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiTmV3SW50ZW50c1BhZ2VEaXNhYmxlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgX3RoaXMyLmRpc2FibGVfYnRuX2V4cGlyZWQgPSB0cnVlOwogICAgICB9CiAgICB9KTsKICAgIHZhciBib3RfdGVtcGxhdGVzX2RhdGEgPSB0aGlzLiRzZXNzaW9uLmdldCgiQm90VGVtcGxhdGVzIik7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib3RfdGVtcGxhdGVzX2RhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGJvdF90ZW1wbGF0ZXNfZGF0YVtpXS5kb21haW4gPT09ICJSZXRhaWwiICYmIGJvdF90ZW1wbGF0ZXNfZGF0YVtpXS5pbnRlbnRfZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzID0gYm90X3RlbXBsYXRlc19kYXRhW2ldLmludGVudF9kYXRhLm1hcChmdW5jdGlvbiAoYXJyKSB7CiAgICAgICAgICByZXR1cm4gYXJyLkludGVudDsKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgIC8vICQoJ2RpdjppbnB1dCcpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI2NvbmZpZ2FwaW1vZGFsNCIpLm9uKCJzaG93bi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICItMC41Iik7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbDQiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIjEiKTsKICAgIH0pOwogICAgJCgnW2RhdGEtdG9nZ2xlPSJ0b29sdGlwIl0nKS50b29sdGlwKCk7CiAgICAkKCIjaW50ZW50bW9kZWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgIH0pOwogICAgJCgiI2NvbmZpZ2FwaW1vZGFsMiIpLm9uKCJzaG93bi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoIiNjb25maWdhcGltb2RhbCIpLmNzcygib3BhY2l0eSIsICItMC41Iik7CiAgICB9KTsKICAgICQoIiNjb25maWdhcGltb2RhbDIiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgJCgiI2NvbmZpZ2FwaW1vZGFsIikuY3NzKCJvcGFjaXR5IiwgIjEiKTsKICAgIH0pOwogICAgJCgiI2NvbmZpZ2FwaW1vZGFsX2pzb25fZWRpdGFibGUiKS5vbigic2hvd24uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiLTAuNSIpOwogICAgfSk7CiAgICAkKCIjY29uZmlnYXBpbW9kYWxfanNvbl9lZGl0YWJsZSIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAkKCIjY29uZmlnYXBpbW9kYWwiKS5jc3MoIm9wYWNpdHkiLCAiMSIpOwogICAgfSk7CiAgICAkKCdhW2RhdGEtdGFyZ2V0PSIjaW50ZW50bW9kZWwiXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHZtLmlzRWRpdEludGVudCA9PSB0cnVlKSB7CiAgICAgICAgdm0udmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oInNlbmRfbW9kZWxfc3RhdHVzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGEgPT0gdHJ1ZSkgewogICAgICAgIF90aGlzMi5jaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXMoKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKHRoaXMuJHJvdXRlLnBhcmFtcy5tb2RhbF9vcGVuX3N3aXRjaF90YWIpIHsKICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiY2hhbmdlX3NpZGViYXJfbWFpbl9tZW51IiwgIlRyYWluaW5nIEh1YiIpOwogICAgfQogIH0sCiAgYmVmb3JlUm91dGVMZWF2ZTogZnVuY3Rpb24gYmVmb3JlUm91dGVMZWF2ZSh0bywgZnJvbSwgbmV4dCkgewogICAgaWYgKHRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgIHRoaXMudmVyaWZ5X2NoYW5nZXMoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFkZF92YXJpYW50X29wZW5fbW9kYWw6IGZ1bmN0aW9uIGFkZF92YXJpYW50X29wZW5fbW9kYWwoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoJ3Nob3cnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgdmVyaWZ5X2NoYW5nZXM6IGZ1bmN0aW9uIHZlcmlmeV9jaGFuZ2VzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9wYWdlX3ZlcmlmeV9jaGFuZ2VzX21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3ZlcmlmeV9jaGFuZ2VzX2FsZXJ0X21zZycpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfdmVyaWZ5X2NoYW5nZXNfc2F2ZV9tc2cnKSwKICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV92ZXJpZnlfY2hhbmdlc19jYW5jZWxfbXNnJykKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXMzLmVkaXRfaW50ZW50KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczMuc2hvd19pbnRlbnRzKF90aGlzMy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CgogICAgICAgICAgICBfdGhpczMuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNoa19jYnhfY3JzcjogZnVuY3Rpb24gY2hrX2NieF9jcnNyKGludGVudCkgewogICAgICBpZiAoaW50ZW50ID09ICdhbGwnKSB7CiAgICAgICAgdmFyIHRlbXAgPSAiY3Vyc29yOiBwb2ludGVyOyI7CgogICAgICAgIGlmICh0aGlzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgdGVtcCA9ICJjdXJzb3I6IG5vdC1hbGxvd2VkOyI7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmRlZmF1bHRfcmV0YWlsX2ludGVudHMuaW5jbHVkZXModGhpcy5pbnRlbnRsaXN0W2ldLkludGVudCkpIHsKICAgICAgICAgICAgICB0ZW1wID0gImN1cnNvcjogcG9pbnRlcjsiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGVtcDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKGludGVudCkpIHsKICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3dpdGNoaW5nOiBmdW5jdGlvbiBzd2l0Y2hpbmcoZWxlbWVudCkgewogICAgICBpZiAodGhpcy52aWV3X3Jlc3BvbnNlX21vZGFsID09IHRydWUpIHsKICAgICAgICB0aGlzLmNoZWNrKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy51bmNoZWNrKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVjazogZnVuY3Rpb24gY2hlY2soKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyYWRpb0J0bm4iKS5jaGVja2VkID0gdHJ1ZTsKICAgICAgdGhpcy52aWV3X3Jlc3BvbnNlX21vZGFsID0gZmFsc2U7IC8vIGNvbnNvbGUubG9nKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCk7CiAgICB9LAogICAgdW5jaGVjazogZnVuY3Rpb24gdW5jaGVjaygpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhZGlvQnRubiIpLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgdGhpcy52aWV3X3Jlc3BvbnNlX21vZGFsID0gdHJ1ZTsgLy8gY29uc29sZS5sb2codGhpcy52aWV3X3Jlc3BvbnNlX21vZGFsKTsKICAgIH0sCiAgICBjaGVja19pbnRlbnRfY29yZV9tb2RlbF9zdGF0dXM6IGZ1bmN0aW9uIGNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpIHsKICAgICAgdGhpcy5tb2RlbF9zdGF0dXMgPSB0aGlzLiRzZXNzaW9uLmdldCgiTW9kZWxTdGF0dXMiKTsKCiAgICAgIGlmICh0aGlzLm1vZGVsX3N0YXR1cyA9PSAiTm8gRmFpbHVyZSIpIHsKICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChCb29sZWFuKHRoaXMubW9kZWxfc3RhdHVzLmludGVudF9tb2RlbCkgPT09IHRydWUgfHwgQm9vbGVhbih0aGlzLm1vZGVsX3N0YXR1cy5kaWFsb2d1ZV9tb2RlbCkgPT09IHRydWUpIHsKICAgICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMuaW50ZW50X21vZGVsID09ICJJblByb2dyZXNzIiB8fCB0aGlzLm1vZGVsX3N0YXR1cy5kaWFsb2d1ZV9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIpIHsKICAgICAgICAgIHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHNob3dfbW9kZWxfcHJvZ3Jlc3M6IGZ1bmN0aW9uIHNob3dfbW9kZWxfcHJvZ3Jlc3MoaW5kZXgpIHsKICAgICAgaWYgKHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9PSB0cnVlKSB7CiAgICAgICAgaWYgKGluZGV4ID09ICdzdHlsZScpIHsKICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAndGl0bGUnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50bHQoJ3RyYWluX21vZGVsX3Byb2dyZXNzX21zZycpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIC8vIGVkaXRzd2l0Y2hpbmcoZWxlbWVudCkgewogICAgLy8gICAvLyBpZiAodGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPT0gdHJ1ZSkgewogICAgLy8gICAvLyAgIHRoaXMuZWNoZWNrKCk7CiAgICAvLyAgIC8vIH0gZWxzZSB7CiAgICAvLyAgIC8vICAgdGhpcy5ldW5jaGVjaygpOwogICAgLy8gICAvLyB9CiAgICAvLyB9LAogICAgLy8gZWNoZWNrKCkgewogICAgLy8gICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG4iKS5jaGVja2VkID0gdHJ1ZTsKICAgIC8vICAgdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPSBmYWxzZTsKICAgIC8vICAgLy90aGVuIG1ha2luZyBudWxsIHZhbHVlcyB0byBzZXQgZnJlc2ggbmV3IHZhbHVlcwogICAgLy8gICB0aGlzLnVybCA9ICIiOwogICAgLy8gICB0aGlzLmFwaV9tZXRob2QgPSAiIjsKICAgIC8vICAgdGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhID0gIiI7CiAgICAvLyAgIHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID0gIiI7CiAgICAvLyAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSAiIjsKICAgIC8vICAgdGhpcy5lZGl0YWJsZV92YWx1ZXMgPSAiIjsKICAgIC8vICAgdGhpcy5lbmR1c2VyX21zZ190eXBlID0gIiI7CiAgICAvLyAgIHRoaXMuZW5kX3VzZXJfbWVzc2FnZSA9ICIiOwogICAgLy8gICB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPSAiIjsKICAgIC8vICAgdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA9ICIiOwogICAgLy8gICB0aGlzLnJlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPSAiIjsKICAgIC8vICAgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9ICIiOwogICAgLy8gICB0aGlzLnVuc3VjY2Vzc2Z1bF9tZXNzYWdlID0gIiI7CiAgICAvLyAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsKTsKICAgIC8vIH0sCiAgICAvLyBldW5jaGVjaygpIHsKICAgIC8vICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJhZGlvQnRuIikuY2hlY2tlZCA9IGZhbHNlOwogICAgLy8gICB0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCA9IHRydWU7CiAgICAvLyAgIC8vIG1ha2luZyB2YWx1ZXMgbnVsbAogICAgLy8gICB0aGlzLnF1aWxsMi5zZXRUZXh0KCIiKTsKICAgIC8vICAgdGhpcy5zb3VyY2UgPSAiV2ViIjsKICAgIC8vICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgdGhpcy5pbWFnZV91cmwgPSAiIjsKICAgIC8vICAgKHRoaXMuZWRpdF92aWRlb19yZXNwb25zZSA9ICJObyIpLHZpZGVvX3Jlc3BvbnNlCiAgICAvLyAgIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgLy8gICB0aGlzLmZpbGVfbGFiZWwzID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgdGhpcy5maWxlX2NvbnRlbnQgPSAiIjsKICAgIC8vICAgLy8gY29uc29sZS5sb2codGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwpOwogICAgLy8gfSwKICAgIHRyYWluX21vZGVsOiBmdW5jdGlvbiB0cmFpbl9tb2RlbCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCd0cmFpbl9tb2RlbF9zd2FsX21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3RyYWluX21vZGVsX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgICB0eXBlOiAicXVlc3Rpb24iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgndHJhaW5fbW9kZWxfc3dhbF9jb25maXJtX21zZycpLAogICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50cmFpbl9tb2RlbCgpLCB7CiAgICAgICAgICAgICAgZW1haWw6IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogX3RoaXM0LmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzNC5jb21wYW55aWQKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXM0LiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIF90aGlzNC53YW50X3N0YXR1cyA9IHRydWU7CgogICAgICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLCBfdGhpczQud2FudF9zdGF0dXMpOwoKICAgICAgICAgICAgICBfdGhpczQuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CgogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IDIwMDAwMTUxKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gMjAwMDAxNDEpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKHRoaXMudGx0KCd0cmFpbl9tb2RlbF9pbnRlcm5hbF9zZXJ2ZXJfbXNnJykpOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyB0cmFpbl9hbmRfdGVzdF9tb2RlbCgpIHsKICAgIC8vICAgU3dhbCh7CiAgICAvLyAgICAgdGl0bGU6ICJBcmUgWW91IFN1cmU/IiwKICAgIC8vICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gVHJhaW4gJiBUZXN0IFRoZSBNb2RlbD8iLAogICAgLy8gICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAvLyAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgIC8vICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgIC8vICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgLy8gICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBDb25maXJtISIsCiAgICAvLyAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgLy8gICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgIC8vICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgLy8gICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgLy8gICAgICAgYXhpb3MKICAgIC8vICAgICAgICAgLnBvc3QoCiAgICAvLyAgICAgICAgICAgYXBpX2NhbGxzLnRyYWluX2ludGVudF9tb2RlbCgpLAogICAgLy8gICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgICAgICAgdGVzdF9tb2RlbDogdHJ1ZSwKICAgIC8vICAgICAgICAgICB9LAogICAgLy8gICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgICAgICB9LAogICAgLy8gICAgICAgICAgIH0KICAgIC8vICAgICAgICAgKQogICAgLy8gICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09IDQwNDYpIHsKICAgIC8vICAgICAgICAgICAgIHN3YWwoewogICAgLy8gICAgICAgICAgICAgICB0aXRsZTogIlJlc3VsdHMgd291bGQgYmUgYXZhaWxhYmxlIHNvb24iLAogICAgLy8gICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLk1TRywKICAgIC8vICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgLy8gICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAvLyAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgIC8vICAgICAgICAgICAgICAgICAvLyAkKCcjZmlsZV91cGxvYWQnKS5tb2RhbCgnaGlkZScpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgLy8gICAgICAgICAgICAgICAgIC8vIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgIC8vICAgICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgfSk7CiAgICAvLyAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09PSAxMDM0KSB7CiAgICAvLyAgICAgICAgICAgICBzd2FsKHsKICAgIC8vICAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgIC8vICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5NU0csCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgLy8gICAgICAgICAgICAgICAgIC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAvLyAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAvLyAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgLy8gICAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgICAgc3dhbCh7CiAgICAvLyAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgLy8gJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgIC8vICAgICAgICAgfSkKICAgIC8vICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICAgICAgLy8gY29uc29sZS5sb2coZSk7CiAgICAvLyAgICAgICAgICAgaWYgKAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgICAgICkgewogICAgLy8gICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgICAgU3dhbCh7CiAgICAvLyAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAvLyAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAvLyAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgIC8vICAgICAgICAgICAgICAgLy8gJCgnI2ZpbGVfdXBsb2FkJykubW9kYWwoJ2hpZGUnKTsKICAgIC8vICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgIC8vICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9ICIiOwogICAgLy8gICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAvLyAgICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICAgIH0pOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgICAvLyB9LAogICAgY2hlY2tfY3VycmVudF9pbnRlbnQ6IGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnRfaW50ZW50KGluZGV4KSB7CiAgICAgIHZhciByZXR1cm5fdmFyID0gIiI7CgogICAgICBpZiAodGhpcy5pbnRlbnRsaXN0W2luZGV4XS5JbnRlbnQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9oaWdobGlnaHQpIHsKICAgICAgICByZXR1cm5fdmFyICs9ICJjdXJyZW50LWFjdGl2ZS1pbnRlbnQiOwogICAgICB9CgogICAgICBpZiAodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuaW50ZW50bGlzdFtpbmRleF0uSW50ZW50KSkgewogICAgICAgIHJldHVybl92YXIgKz0gIiBkaXNhYmxlZC1pbnRlbnQiOwogICAgICB9CgogICAgICByZXR1cm4gcmV0dXJuX3ZhcjsKICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZTogZnVuY3Rpb24gY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICBsb2FkX2ludGVudDogZnVuY3Rpb24gbG9hZF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICAvLyB0aGlzLmludGVudGxpc3QgPSBbXTsKICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAnJzsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChfdGhpczUuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzNS5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgX3RoaXM1LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICBfdGhpczUuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKCiAgICAgICAgICBpZiAoX3RoaXM1LmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICBfdGhpczUuc2hvd19pbnRlbnRzKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczUuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczUuc2V0cGFnaW5hdGlvbihfdGhpczUucGFnZV9ubyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNob3dfaW50ZW50czogZnVuY3Rpb24gc2hvd19pbnRlbnRzKGluZGV4KSB7CiAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgIHZhciBjbG9uZV9zZWxlY3RlZF9pbnRlbnQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuaW50ZW50bGlzdFtpbmRleF0pKTsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCA9IGluZGV4OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkludGVudDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9oaWdobGlnaHQgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50OwogICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUXVlc3Rpb25zOwogICAgICB0aGlzLm5ld19pbnRlbnRfcXVlc3Rpb25fbGlzdCA9IF90b0NvbnN1bWFibGVBcnJheShuZXcgU2V0KGNsb25lX3NlbGVjdGVkX2ludGVudC5RdWVzdGlvbnMpKTsKICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24gPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50RGVzY3JpcHRpb247CiAgICAgIHRoaXMub2xkX2ludGVudF9uYW1lID0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudDsKICAgICAgdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QgPSB0aGlzLmludGVudGxpc3RbaW5kZXhdLlF1ZXN0aW9uczsKICAgICAgdGhpcy5pc19yZXNwb25zZSA9IGZhbHNlOwogICAgICB0aGlzLmlzX2VuZHBvaW50ID0gZmFsc2U7CgogICAgICBpZiAoY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlICE9IG51bGwgJiYgY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlICE9ICIiKSB7CiAgICAgICAgdGhpcy5lZGl0X3ZpZXdfcmVzcG9uc2VfbW9kYWwgPSB0cnVlOwogICAgICAgIHRoaXMub2xkX3ZpZGVvX3VybCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZS5WaWRlb1VybDsKICAgICAgICB0aGlzLmlzX3Jlc3BvbnNlID0gdHJ1ZTsKICAgICAgICB0aGlzLmlzX2VuZHBvaW50ID0gZmFsc2U7CiAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuUmVzcG9uc2UuUmVzcG9uc2U7IC8vIHRoaXMucXVpbGwyLnJvb3QuaW5uZXJIVE1MID0gdGhpcy5pbnRlbnRsaXN0W2luZGV4XS5SZXNwb25zZS5SZXNwb25zZTsKCiAgICAgICAgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Vfc291cmNlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LlJlc3BvbnNlLlNvdXJjZTsKICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV9pbWFnZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZS5JbWFnZVVybDsKCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX2ltYWdlICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMubmFtZV9maWxlID0gdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VfaW1hZ2Uuc3BsaXQoIi8iKTsKICAgICAgICAgIHRoaXMudGVtcF9maWxlX25hbWUgPSB0aGlzLm5hbWVfZmlsZVt0aGlzLm5hbWVfZmlsZS5sZW5ndGggLSAxXTsgLy8gY29uc29sZS5sb2coInNwbGl0dGVkIik7CgogICAgICAgICAgdGhpcy5maWxlX2xhYmVsMyA9IHRoaXMudGVtcF9maWxlX25hbWU7CiAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lID0gdGhpcy5maWxlX2xhYmVsMzsKICAgICAgICAgIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9ICJZZXMiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lID0gIiI7CiAgICAgICAgICB0aGlzLmVkaXRfaW1hZ2VfcmVzcG9uc2UgPSAiTm8iOwogICAgICAgICAgdGhpcy5maWxlX2xhYmVsMyA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV92aWRlbyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5SZXNwb25zZS5WaWRlb1VybDsKCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3ZpZGVvICE9ICIiIHx8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlX3ZpZGVvLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICB0aGlzLmVkaXRfdmlkZW9fcmVzcG9uc2UgPSAiWWVzIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lZGl0X3ZpZGVvX3Jlc3BvbnNlID0gIk5vIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50ICE9IG51bGwgJiYgY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50ICE9ICIiKSB7CiAgICAgICAgdGhpcy5pc19yZXNwb25zZSA9IGZhbHNlOwogICAgICAgIHRoaXMuaXNfZW5kcG9pbnQgPSB0cnVlOwogICAgICAgIHRoaXMuZWRpdF92aWV3X3Jlc3BvbnNlX21vZGFsID0gZmFsc2U7CiAgICAgICAgdGhpcy51dHRlcmFuY2VzID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlRhc2tzLlV0dGVyYW5jZXM7CiAgICAgICAgdGhpcy5hcGlfbWV0aG9kID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50Lk1FVEhPRDsKICAgICAgICB0aGlzLmVkaXRhYmxlX3ZhbHVlcyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5WYWx1ZXNUb0VkaXQ7CiAgICAgICAgdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuaXNFZGl0OwogICAgICAgIHRoaXMudXJsID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlVSTDsKICAgICAgICB0aGlzLnNob3dfanNvbl9yZXF1ZXN0X2RhdGEgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVxdWVzdEpzb247CiAgICAgICAgdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXNwb25zZUpzb247CiAgICAgICAgdGhpcy5lbmR1c2VyX21zZ190eXBlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50Lk1zZ190eXBlOwogICAgICAgIHRoaXMuZW5kX3VzZXJfbWVzc2FnZSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5NZXNzYWdlVG9FbmRVc2VyOwogICAgICAgIHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuQVBJRW5kcG9pbnQuUmVzcG9uc2VLZXlUb0VuZFVzZXI7CiAgICAgICAgdGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlc3BvbnNlS2V5RWRpdGFibGU7CiAgICAgICAgdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5BUElFbmRwb2ludC5SZXNwb25zZUpzb247CiAgICAgICAgdGhpcy5yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlJlc3BvbnNlS2V5TWVzc2FnZVRvRW5kVXNlcjsKICAgICAgICB0aGlzLnVuc3VjY2Vzc2Z1bF9tZXNzYWdlID0gY2xvbmVfc2VsZWN0ZWRfaW50ZW50LkFQSUVuZHBvaW50LlVuU3VjY2Vzc2Z1bE1lc3NhZ2U7CiAgICAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudXR0ZXJhbmNlcykgewogICAgICAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5wdXNoKHsKICAgICAgICAgICAga2V5X25hbWU6IHRoaXMudXR0ZXJhbmNlc1tpXS5SYXdTbG90TmFtZSwKICAgICAgICAgICAgaW5wdXRfdGV4dDogdGhpcy51dHRlcmFuY2VzW2ldLlRleHQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNhdmVfcmVxX2pzb246IGZ1bmN0aW9uIHNhdmVfcmVxX2pzb24oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNhdmVfanNvbl9yZXF1ZXN0X2RhdGEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICByZXFfanNvbjogZnVuY3Rpb24gcmVxX2pzb24oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNob3dfanNvbl9yZXF1ZXN0X2RhdGEpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBzYXZlX3Jlc3BfanNvbjogZnVuY3Rpb24gc2F2ZV9yZXNwX2pzb24oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNhdmVfanNvbl9yZXNwb25zZV9kYXRhKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgcmVzcF9qc29uOiBmdW5jdGlvbiByZXNwX2pzb24oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgc2F2ZV9wdXNoaW5nOiBmdW5jdGlvbiBzYXZlX3B1c2hpbmcoKSB7CiAgICAgIGlmICh0aGlzLnNhdmVfYXBpX21ldGhvZCA9PT0gbnVsbCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgTWV0aG9kIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHRoaXMuc2F2ZV9lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICAgIHZhciBlbXB0eV92YXJzID0gW107CiAgICAgICAgICB2YXIgY3N2ID0gdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcy5zcGxpdCgiOyIpOyAvLyAgY29uc29sZS5sb2coInRoaXMgaXMgY3N2Iixjc3YpOwoKICAgICAgICAgIHZhciBpbnB1dF92YWx1ZTsgLy8gdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBjc3YpIHsKICAgICAgICAgICAgdmFyIHRlbXBfbGlzdCA9IGNzdltpXS5zcGxpdCgiLCIpOyAvLyAgY29uc29sZS5sb2coInRoaXMgaXMgdGVtcCIsdGVtcF9saXN0KTsKCiAgICAgICAgICAgIGlmICh0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdICE9ICIiKSB7CiAgICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKCJoZXJlZWUiKTsKICAgICAgICAgICAgICBpbnB1dF92YWx1ZSA9IHRlbXBfbGlzdFt0ZW1wX2xpc3QubGVuZ3RoIC0gMV07CgogICAgICAgICAgICAgIGlmICghdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5LmtleV9uYW1lOwogICAgICAgICAgICAgIH0pLmluY2x1ZGVzKGlucHV0X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzLnB1c2goewogICAgICAgICAgICAgICAgICBrZXlfbmFtZTogaW5wdXRfdmFsdWUsCiAgICAgICAgICAgICAgICAgIGlucHV0X3RleHQ6ICIiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdGVtcCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChjc3YuaW5jbHVkZXModGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2luZGV4XVsna2V5X25hbWUnXSkpIHsKICAgICAgICAgICAgICB0ZW1wLnB1c2godGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2luZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMgPSB0ZW1wOyAvLyBmb3IgKHZhciBpIGluIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgLy8gICBpZiAodGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgIC8vICAgICBlbXB0eV92YXJzLnB1c2godGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMgPSBbXTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsvLyBjb25zb2xlLmxvZyhlKTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfcHVzaGluZzogZnVuY3Rpb24gZWRpdF9wdXNoaW5nKCkgewogICAgICB0cnkgewogICAgICAgIGlmICh0aGlzLmVkaXRhYmxlX3ZhbHVlcyAhPSAiIikgewogICAgICAgICAgdmFyIGVtcHR5X3ZhcnMgPSBbXTsKICAgICAgICAgIHZhciBjc3YgPSB0aGlzLmVkaXRhYmxlX3ZhbHVlcy5zcGxpdCgiOyIpOwogICAgICAgICAgdmFyIGlucHV0X3ZhbHVlOyAvLyB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBjc3YpIHsKICAgICAgICAgICAgdmFyIHRlbXBfbGlzdCA9IGNzdltpXS5zcGxpdCgiLCIpOwoKICAgICAgICAgICAgaWYgKHRlbXBfbGlzdFt0ZW1wX2xpc3QubGVuZ3RoIC0gMV0gIT0gIiIpIHsKICAgICAgICAgICAgICBpbnB1dF92YWx1ZSA9IHRlbXBfbGlzdFt0ZW1wX2xpc3QubGVuZ3RoIC0gMV07CgogICAgICAgICAgICAgIGlmICghdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGtleS5rZXlfbmFtZTsKICAgICAgICAgICAgICB9KS5pbmNsdWRlcyhpbnB1dF92YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIGtleV9uYW1lOiBpbnB1dF92YWx1ZSwKICAgICAgICAgICAgICAgICAgaW5wdXRfdGV4dDogIiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gW107CgogICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMudGFza19pbnB1dF92YWx1ZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChjc3YuaW5jbHVkZXModGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpbmRleF1bJ2tleV9uYW1lJ10pKSB7CiAgICAgICAgICAgICAgdGVtcC5wdXNoKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaW5kZXhdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSB0ZW1wOyAvLyBmb3IgKHZhciBpIGluIHRoaXMudGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgIC8vICAgaWYgKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgLy8gICAgIGVtcHR5X3ZhcnMucHVzaCh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBUaGlzIGlzIGZvciBjaGVja2luZyB3aGlsZSBlbnRlcmluZyBhIGludGVudCBuYW1lIGlmIGl0IGFscmVhZHkgZXhpc3RzIG9yIG5vdAogICAgZW50ZXJpbnRlbnRpZDogZnVuY3Rpb24gZW50ZXJpbnRlbnRpZCgpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgaW50ZW50X3NlYXJjaF9rZXkgPSB0aGlzLm5ld19pbnRlbnRzOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgIGlzX2ludGVudF9zZWFyY2g6IHRydWUsCiAgICAgICAgaW50ZW50X3NlYXJjaF9rZXk6IHRoaXMubmV3X2ludGVudHMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfTkFNRV9OT1RfRVhJU1RTX01PREVMUy5NU0dfQ09ERSAmJiBfdGhpczYubmV3X2ludGVudHMgPT09IGludGVudF9zZWFyY2hfa2V5KSB7CiAgICAgICAgICBfdGhpczYuaW50ZW50X2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM2Lm5ld19pbnRlbnRzICE9ICIiKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuRFVQTElDQVRFX0lOVEVOVF80MDExX01PREVMUy5NU0dfQ09ERSAmJiBfdGhpczYubmV3X2ludGVudHMgPT09IGludGVudF9zZWFyY2hfa2V5KSB7CiAgICAgICAgICBfdGhpczYuaW50ZW50X2FscmVhZHlfZXhpc3RzID0gdHJ1ZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvLyBUaGlzIGlzIGZvciBjaGVja2luZyB3aGlsZSBlZGl0aW5nIGFuZCBlbnRlcmluZyBhIGludGVudCBuYW1lIGlmIGl0IGFscmVhZHkgZXhpc3RzIG9yIG5vdAogICAgZW50ZXJpbnRlbnRpZF9lZGl0OiBmdW5jdGlvbiBlbnRlcmludGVudGlkX2VkaXQoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgIGludGVudF9zZWFyY2hfa2V5OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50CiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KTsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX05BTUVfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzNy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM3LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50ICE9ICIiKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5EVVBMSUNBVEVfSU5URU5UXzQwMTFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICBpZiAoX3RoaXM3Lm9sZF9pbnRlbnRfbmFtZSA9PSBfdGhpczcuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpIHsKICAgICAgICAgICAgX3RoaXM3LmludGVudF9hbHJlYWR5X2V4aXN0c19lZGl0ID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9IG51bGw7IC8vICBjb25zb2xlLmxvZygieW91IG9sZCBvbmx5Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAgY29uc29sZS5sb2coInlvdSBoZXJlIik7CiAgICAgICAgICAgIF90aGlzNy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWRfZWRpdCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBpbnRlbnRfbmFtZV9jaGVja19zcGVjaWFsX2NoYXJhY3RlcnM6IGZ1bmN0aW9uIGludGVudF9uYW1lX2NoZWNrX3NwZWNpYWxfY2hhcmFjdGVycyhlKSB7CiAgICAgIGlmICgvXlteYS16QS1aMC05XyBdKiQvLnRlc3QoZS5rZXkpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgZWRpdF9pbnRlbnQ6IGZ1bmN0aW9uIGVkaXRfaW50ZW50KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLm9sZF9pbnRlbnRfbmFtZSA9PSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSB7CiAgICAgICAgdmFyIGludGVudF90b19zZW5kID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB2YXIgaW50ZW50X3RvX3NlbmQgPSB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMub2xkX2ludGVudF9uYW1lOwogICAgICAgIHZhciBpbnRlbnRfdG9fc2VuZCA9IHRoaXMub2xkX2ludGVudF9uYW1lOwogICAgICB9CgogICAgICBpZiAodGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCkgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnZWRpdF9pbnRlbnRfbmFtZV9leGlzdF9tc2cnKSk7CiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPT0gIiIpIHsKICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbiBJbnRlbnQgbmFtZSIpOwogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2VkaXRfaW50ZW50X2VudGVyX25hbWVfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnNbX2ldID09PSAiIiB8fCB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnNbX2ldID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiUXVlc3Rpb25zIGNhbm5vdCBiZSBibGFuayIpOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF9pbnRlbnRfcXVlc3Rpb25fYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCAhPSAnc2hpcHBpbmcnICYmIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gJ21lc3NhZ2luZ19wbGF0Zm9ybScgJiYgdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCAhPSAnY29udGFjdF91cycgJiYgdGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgICAgaXNfZGVmYXVsdF9pbnRlbnQ6IHRydWUsCiAgICAgICAgICAvLyBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgaW50ZW50OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50LAogICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgb2xkX3F1ZXN0aW9uX2xpc3Q6IHRoaXMub2xkX3F1ZXN0aW9uc19saXN0CiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7IC8vIHRoaXMuaW50ZW50cyA9ICIiOwogICAgICAgICAgLy8gdGhpcy5xdWVzdGlvbl9saXN0ID0gWzBdOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfZW50ZXJfbmFtZV9tc2cnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2VudGVyX25hbWVfbXNnJyksCiAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVOVF9JTl9ESUFMT0dfRURJVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2VudGVyX25hbWVfbXNnMScpLAogICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5TVEFUVVNfRkFJTFVSRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnMScpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRXJyb3IiKSB7CiAgICAgICAgICAvLyAgIFN3YWwoewogICAgICAgICAgLy8gICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAvLyAgICAgdGV4dDogdGhpcy50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnMicpLAogICAgICAgICAgLy8gICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgLy8gICB9KTsKICAgICAgICAgIC8vICAgaWYodGhpcy5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKXsKICAgICAgICAgIC8vICAgICAgIHRoaXMuc2VhcmNoX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgIC8vICAgfWVsc2V7CiAgICAgICAgICAvLyAgICAgdGhpcy5sb2FkX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gfSAKICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5VTlNVQ0NFU1NGVUxfREJfUVVFUllfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2czJyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfSAvLyB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX3Jlc3BvbnNlID09PSBmYWxzZSAmJiB0aGlzLmlzX2VuZHBvaW50ID09PSBmYWxzZSkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9zYXZlX2ludGVudF9leGFtcGxlKCksIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVkaXRfaW50ZW50OiB0cnVlLAogICAgICAgICAgb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgIGludGVudF9kZXNjcmlwdGlvbjogdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzOC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludGVudCBRdWVzdGlvbiBFZGl0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9lZGl0X3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICAgIHRpdGxlOiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zdWNjZXNzX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIlVzZWQgSW50ZW50IE5hbWUgRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X2VkaXRlZF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludGVudCBRdWVzdGlvbiBOb3QgRWRpdGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMicpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZzMnKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgIGlmICh0aGlzLm9sZF9pbWFnZV9uYW1lID09IHRoaXMuZmlsZV9sYWJlbDMpIHsKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbDMgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2UubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlW19pMl0gPT0gIiIgfHwgdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2VbX2kyXSA9PSAiPHA+PGJyPjwvcD4iKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlZGl0X2ludGVudF9yZXNwb25zZV9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwzID09ICJDaG9vc2UgZmlsZSIpIHsKICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwzID09PSAiQ2hvb3NlIGZpbGUiICYmIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9PSAiTm8iKSB7CiAgICAgICAgICAgIHZhciBkZWxldGVfaW1hZ2U7CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCIpOwoKCiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgaXNfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgICAgIG9sZF9pbnRlbnRfbmFtZTogaW50ZW50X3RvX3NlbmQsCiAgICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICAgIGludGVudF9kZXNjcmlwdGlvbjogdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICBmaWxlX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy5lZGl0X3ZpZGVvX3Jlc3BvbnNlID09ICJZZXMiID8gdGhpcy5lbWJkX2xpbmtfZWRpdCA6IFtdLAogICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Vfc291cmNlLAogICAgICAgICAgICAgIHJlc3BvbnNlOiB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZQogICAgICAgICAgICB9LAogICAgICAgICAgICBvbGRfaW1hZ2VfZGVsZXRlOiB0aGlzLmZpbGVfbGFiZWwzID09PSAiQ2hvb3NlIGZpbGUiICYmIHRoaXMuZWRpdF9pbWFnZV9yZXNwb25zZSA9PSAiTm8iID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICBvbGRfaW1hZ2VfbmFtZTogdGhpcy5vbGRfaW1hZ2VfbmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOyAvLyB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgICAgICAgIC8vIHRoaXMuaW50ZW50cyA9ICIiOwogICAgICAgICAgICAvLyB0aGlzLnF1ZXN0aW9uX2xpc3QgPSBbMF07CiAgICAgICAgICAgIC8vIHZhciByZXNwb25zZV9hcGkgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzQnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUllfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9lZGl0X3N1Y2Nlc3NfbXNnMScpLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX0lOX0RJQUxPR19FRElURURfU1VDQ0VTU0ZVTExZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfZWRpdGVkX2FsZXJ0X21zZzEnKSwKICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiA3NTAwCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLlNUQVRVU19GQUlMVVJFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2c1JyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJFcnJvciIpIHsKICAgICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgICAgLy8gICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIC8vICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF9pbnRlbnRfc29tZV9lcnJvcl9tc2c2JyksCiAgICAgICAgICAgIC8vICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgLy8gICBpZih0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpewogICAgICAgICAgICAvLyAgICAgdGhpcy5zZWFyY2hfaW50ZW50KHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAvLyAgIH1lbHNlewogICAgICAgICAgICAvLyAgICAgdGhpcy5sb2FkX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklNR19EVVBMSUNBVEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW1nX2V4aXN0X21zZzInKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnNycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5zZWFyY2hfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZzQnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgfSAvLyB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwoKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgICAgICBpc19yZXNwb25zZTogdHJ1ZSwKICAgICAgICAgICAgaW1hZ2VfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgb2xkX2ludGVudF9uYW1lOiBpbnRlbnRfdG9fc2VuZCwKICAgICAgICAgICAgaW50ZW50OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50LAogICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICAgIGludGVudF9kZXNjcmlwdGlvbjogdGhpcy5zZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgb2xkX2ltYWdlX25hbWU6IHRoaXMub2xkX2ltYWdlX25hbWUsCiAgICAgICAgICAgIG5ld19pbWFnZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwzLAogICAgICAgICAgICBpbWFnZV9ibG9iOiB0aGlzLmZpbGVfY29udGVudDMsCiAgICAgICAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiB0aGlzLm9sZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICBmaWxlX25hbWU6IHRoaXMuZmlsZV9sYWJlbDMsCiAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy5lZGl0X3ZpZGVvX3Jlc3BvbnNlID09ICJZZXMiID8gdGhpcy5lbWJkX2xpbmtfZWRpdCA6IFtdLAogICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcmVzcG9uc2Vfc291cmNlLAogICAgICAgICAgICAgIHJlc3BvbnNlOiB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZQogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfbXNnNycpLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnaW50ZW50X2VkaXRlZF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVOVF9JTl9ESUFMT0dfRURJVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2ludGVudF9lZGl0ZWRfYWxlcnRfbXNnMScpLAogICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDc1MDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpczguaXNfc2VhcmNoX2FjdGl2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LmxvYWRfaW50ZW50KF90aGlzOC5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX0ZBSUxVUkVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczgudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzknKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkVycm9yIikgewogICAgICAgICAgICAvLyAgIFN3YWwoewogICAgICAgICAgICAvLyAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgLy8gICAgIHRleHQ6IHRoaXMudGx0KCdlZGl0X2ludGVudF9zb21lX2Vycm9yX21zZzEwJyksCiAgICAgICAgICAgIC8vICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgLy8gfSAKICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklNR19EVVBMSUNBVEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW1nX2V4aXN0X2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2VkaXRfaW50ZW50X3NvbWVfZXJyb3JfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnZWRpdF9pbnRlbnRfaW50ZXJuYWxfc2VydmVyX21zZzUnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7IC8vIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOyAvLyB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgICAgICAvLyB0aGlzLnNvdXJjZSA9ICIiOwogICAgICAgICAgLy8gdGhpcy5pbnRlbnRzID0gIiI7CiAgICAgICAgICAvLyB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgIC8vIHRoaXMuZmlsZV9jb250ZW50MiA9ICIiOwogICAgICAgICAgLy8gdGhpcy52aWRlb19saW5rID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCF0aGlzLmVkaXRfdmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgIGlmICh0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5lZGl0YWJsZV92YWx1ZXMgIT0gIiIpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyAgY29uc29sZS5sb2codGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXSk7CiAgICAgICAgICAgIGlmICh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQgPT0gIiIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhbGxfcmVxdWlyZWRfdmFsdWVzX21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnVybCA9PSAiIiB8fCB0aGlzLmFwaV9tZXRob2QgPT0gbnVsbCB8fCB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSBudWxsIHx8IHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLmVkaXRhYmxlX3ZhbHVlcyA9PSAiIikgewogICAgICAgICAgaWYgKHRoaXMuYXBpX21ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdzZWxlY3RfbWV0aG9kX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc2VsZWN0X3JlcXVlc3RfanNvbl9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWxsX3JlcXVpcmVkX3ZhbHVlc19tc2cxJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJlcV9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgncmVxdWVzdF9qc29uX2ludmFsaWRfbXNnJyksCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmICF0aGlzLmlzRWRpdCkgey8vIHZhciBjc3YgPSB0aGlzLmVkaXRhYmxlX3ZhbHVlcy5zcGxpdCgiOyIpOwogICAgICAgICAgICAvLyB2YXIgaW5wdXRfdmFsdWU7CiAgICAgICAgICAgIC8vIHRoaXMudGFza19pbnB1dF92YWx1ZXMgPSBbXTsKICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiBjc3YpIHsKICAgICAgICAgICAgLy8gICBsZXQgdGVtcF9saXN0ID0gY3N2W2ldLnNwbGl0KCIsIik7CiAgICAgICAgICAgIC8vICAgaW5wdXRfdmFsdWUgPSB0ZW1wX2xpc3RbdGVtcF9saXN0Lmxlbmd0aCAtIDFdOwogICAgICAgICAgICAvLyAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMucHVzaCh7CiAgICAgICAgICAgIC8vICAgICBrZXlfbmFtZTogaW5wdXRfdmFsdWUsCiAgICAgICAgICAgIC8vICAgICBpbnB1dF90ZXh0OiAiIiwKICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIpIHsKICAgICAgICAgICAgLy8gbGV0IGVtcHR5X3ZhcnMgPSBbXTsKICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgIC8vICAgaWYgKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgICAvLyAgICAgZW1wdHlfdmFycy5wdXNoKHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCk7CiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyAgIC8vICBjb25zb2xlLmxvZyh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAvLyBpZihlbXB0eV92YXJzLmxlbmd0aCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuZmluYWxzdGVwID0gdHJ1ZTsgLy8gfSBlbHNlIHsKICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHZhbHVlcy4iKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maW5hbHN0ZXAgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZmluYWxzdGVwID09IHRydWUpIHsKICAgICAgICAgIHZhciBleGlzdGluZ19pbnRlbnRfbGlzdCA9IHRoaXMuYXBpX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChhcGkpIHsKICAgICAgICAgICAgcmV0dXJuIGFwaS5pbnRlbnQgPT0gX3RoaXM4LmludGVudHM7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBwb3N0X21ldGhvZF9kYXRhLCBnZXRfbWV0aG9kX2RhdGE7CiAgICAgICAgICBwb3N0X21ldGhvZF9kYXRhID0ge307CiAgICAgICAgICBnZXRfbWV0aG9kX2RhdGEgPSB7fTsgLy8gaWYgKHRoaXMuYXBpX21ldGhvZCA9PSAiUE9TVCIgJiYgdGhpcy50YXNrX2Zyb20gPT0gImZyb21fZW50aXR5IikgewoKICAgICAgICAgIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gIlBPU1QiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgIHBvc3RfbWV0aG9kX2RhdGFbdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB7CiAgICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgICBmcm9tX2VudGl0eTogdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ICE9ICIiID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgICAgZW50aXR5OiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQsCiAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQsCiAgICAgICAgICAgICAgICBub3RfaW50ZW50OiBudWxsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmFwaV9tZXRob2QgPT0gIkdFVCIpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgICAgZ2V0X21ldGhvZF9kYXRhW3RoaXMudGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gewogICAgICAgICAgICAgICAgRW50aXR5OiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldLmlucHV0X3RleHQsCiAgICAgICAgICAgICAgICBTbG90OiBudWxsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChleGlzdGluZ19pbnRlbnRfbGlzdC5sZW5ndGggPiAwICYmICF0aGlzLmlzRWRpdCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2FscmVhZHlfZXhpc3RfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gbnVsbCkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW5kX21zZ190eXBlX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNTAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVzcF9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdyZXF1ZXN0X2pzb25faW52YWxpZF9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9PSAiIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FsbF9yZXF1aXJlZF92YWx1ZXNfbXNnMicpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMucmVzcG9uc2Vfa2V5X2VkaXRfbWVzc2FnZSA9PSAiIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhbGxfcmVxdWlyZWRfdmFsdWVzX21zZzMnKSwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmVuZF91c2VyX21lc3NhZ2UgPSAiIjsgLy8gY29uc29sZS5sb2coImVuZF91c2VyIG1lc3NhZ2UgbnVsbCIsdGhpcy5lbmRfdXNlcl9tZXNzYWdlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSB7CiAgICAgICAgICAgIHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPSAiIjsKICAgICAgICAgICAgdGhpcy5yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gIiI7IC8vIGNvbnNvbGUubG9nKCJyZXNwb25zZSBrZXkgdG8gZW5kIHVzZXIgbnVsbCIsdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlcik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMudW5zdWNjZXNzZnVsX21lc3NhZ2UgPT0gIiIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FsbF9yZXF1aXJlZF92YWx1ZXNfbXNnNCcpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgodGhpcy5lbmRfdXNlcl9tZXNzYWdlICE9ICIiIHx8IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiKSAmJiAodGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlICE9IG51bGwgfHwgdGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSAmJiB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgIT0gbnVsbCAmJiAodGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciAhPSAiIiB8fCB0aGlzLmVuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpICYmICh0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhICE9ICIiIHx8IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiQ3VzdG9tIikpIHsKICAgICAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24gPT0gIlNpbHZlciIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndXBncmFkZV9wbGFuX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgdGFza3MgPSB7fTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aCA+IDAgfHwgdGhpcy5yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIkZhbHNlIikgewogICAgICAgICAgICAgICAgdmFyIF9heGlvcyRwb3N0OwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2lucHV0X3ZhbHVlcykgewogICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IFtdOwogICAgICAgICAgICAgICAgICB0ZW1wLnB1c2goewogICAgICAgICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgICAgICAgIFRleHQ6IHRoaXMudGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGFza3NbdGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB0ZW1wOwogICAgICAgICAgICAgICAgfSAvLyBjb25zb2xlLmxvZygicmVhY2hlZCBoZXJlIGZpbmFsbHkiKTsKCgogICAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIChfYXhpb3MkcG9zdCA9IHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsCiAgICAgICAgICAgICAgICAgIGlzX2VuZHBvaW50OiB0cnVlLAogICAgICAgICAgICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLAogICAgICAgICAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICB1cmw6IHRoaXMudXJsLAogICAgICAgICAgICAgICAgICByZXF1ZXN0anNvbjogdGhpcy5zaG93X2pzb25fcmVxdWVzdF9kYXRhLAogICAgICAgICAgICAgICAgICBhcGlfbWV0aG9kOiB0aGlzLmFwaV9tZXRob2QsCiAgICAgICAgICAgICAgICAgIGVuZF91c2VyX21lc3NhZ2U6IHRoaXMuZW5kX3VzZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgbXNnX3R5cGU6IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2VrZXk6IHRoaXMucmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIsCiAgICAgICAgICAgICAgICAgIGFwaV9lZGl0OiB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgYXBpX2VkaXRhYmxlX3ZhbHVlOiB0aGlzLnJlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgPyB0aGlzLmVkaXRhYmxlX3ZhbHVlcyA6ICIiLAogICAgICAgICAgICAgICAgICByZXNwb25zZWpzb246IHRoaXMuZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiID8gdGhpcy5zaG93X2pzb25fcmVzcG9uc2VfZGF0YSA6ICIiLAogICAgICAgICAgICAgICAgICByZXNwb25zZV9tc2dfZWRpdGFibGU6IHRoaXMucmVzcG9uc2VfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfbXNnX2VkaXRhYmxlX3ZhbHVlOiB0aGlzLnJlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlIDogIiIsCiAgICAgICAgICAgICAgICAgIHJlcXVlc3RfanNvbl9rZXlfbWFwcGluZzogZ2V0X21ldGhvZF9kYXRhLAogICAgICAgICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YTogcG9zdF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgdW5zdWNjZXNzZnVsX21zZzogdGhpcy51bnN1Y2Nlc3NmdWxfbWVzc2FnZQogICAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAibGljZW5zZV9rZXkiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJlbWFpbCIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInRva2VuIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdCwgInRhc2tfZGV0YWlscyIsIHRhc2tzKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAic3Vic2NyaXB0aW9uIiwgIlBsYXRpbnVtIiksIF9heGlvcyRwb3N0KSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM4LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzOC5pc19zZWFyY2hfYWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXM4LnNlYXJjaF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczgubG9hZF9pbnRlbnQoX3RoaXM4LmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLkFERF9DT05GSUdVUklOR19BUElfVVJMX1NVQ0NFU1NfMjAwOF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2ludGVudF9hZGRlZF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuQUREX0NPTkZJR1VSSU5HX0FQSV9KU09OX1NVQ0NFU1NfMjAwNl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgIC8vIH0sIDI1MDApOwogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgnYWRkZWRfc3VjY2Vzc19hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7Ly8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczguYXBpX3N0YXR1c19jb2RlLklOVEVOVF9JTl9ESUFMT0dfRURJVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ2ludGVudF9lZGl0ZWRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogNzUwMAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgey8vIHRoaXMubG9hZF9pbnRlbnQodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ3NvbWVfZXJyb3JfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge30pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuRU5EUE9JTlRfTElNSVRfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM4LnRsdCgndXBncmFkZV9wbGFuX2FsZXJ0X21zZzInKSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7Ly8gaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICB9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ3NvbWVfZXJyb3JfYWxlcnRfbXNnMicpLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXM4LmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczguc2VhcmNoX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF90aGlzOC5sb2FkX2ludGVudChfdGhpczguY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczguJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gLy8gZWxzZSBpZiAoCiAgICAgICAgICAgICAgLy8gICAgIHRoaXMucmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJGYWxzZSIgJiYKICAgICAgICAgICAgICAvLyAgICAgdGhpcy50YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwCiAgICAgICAgICAgICAgLy8gICApCgogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyIpOwogICAgICAgICAgICBpZiAodGhpcy5yZXNwb25zZV9qc29uX2VkaXRhYmxlID09IG51bGwgJiYgdGhpcy5lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIgJiYgdGhpcy5yZXNwb25zZV9rZXlfdG9fZW5kdXNlciAhPSAiIiAmJiB0aGlzLnNob3dfanNvbl9yZXNwb25zZV9kYXRhICE9ICIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc2VsZWN0X3Jlc3BvbnNlX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhbGxfcmVxdWlyZWRfdmFsdWVzX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNhdmVfaW50ZW50OiBmdW5jdGlvbiBzYXZlX2ludGVudCgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0aGlzLmFkZF9lZGl0ID0gInRydWUiOwoKICAgICAgaWYgKHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfbmFtZV9hbGVydF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5uZXdfaW50ZW50cyA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX2FkZF9uYW1lX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QubGVuZ3RoOyBfaTMrKykgewogICAgICAgICAgaWYgKHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W19pM10gPT09ICIiIHx8IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W19pM10gPT09IG51bGwpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3FzX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuYWRkX2VkaXQgPT0gInRydWUiKSB7CiAgICAgICAgaWYgKHRoaXMudmlld19yZXNwb25zZV9tb2RhbCkgewogICAgICAgICAgaWYgKHRoaXMuaW1hZ2VfcmVzcG9uc2UgPT0gIlllcyIgJiYgdGhpcy5maWxlX2NvbnRlbnQyID09ICIiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9pbWdfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOyAvLyAgY29uc29sZS5sb2coImNzZGNzZGZnZSBpbWFnZSIpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZpZGVvX3Jlc3BvbnNlID09ICJZZXMiICYmIHRoaXMuZW1iZF9saW5rID09ICIiKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiVXBsb2FkIGEgVmlkZW8gbGluayIpOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfdmlkZW9fYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOyAvLyAgY29uc29sZS5sb2coImNzZGNzZGZnZSB2aWRlbyIpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IHRoaXMubXVsdGlwbGVfcmVzcG9uc2UubGVuZ3RoOyBfaTQrKykgewogICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZV9yZXNwb25zZVtfaTRdID09ICIiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfcmVzcG9uc2VfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwyID09ICJDaG9vc2UgZmlsZSIpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImFwaSBjYWxsIik7CiAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgLy8gJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3N1Ym1pdF9kZXRhaWxzX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgICAgICAgIGlzX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICAgIC8vIGludGVudDogdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgcXVlc3Rpb25fbGlzdDogdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QsCiAgICAgICAgICAgICAgcmVzcG9uc2U6IHsKICAgICAgICAgICAgICAgIGZpbGVfbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgIHZpZGVvX2xpbms6IHRoaXMudmlkZW9fcmVzcG9uc2UgPT0gIlllcyIgPyB0aGlzLmVtYmRfbGluayA6IFtdLAogICAgICAgICAgICAgICAgc291cmNlOiB0aGlzLnNvdXJjZSwKICAgICAgICAgICAgICAgIHJlc3BvbnNlOiB0aGlzLm11bHRpcGxlX3Jlc3BvbnNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgLy8gdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuQURERURfU1VDQ0VTU0ZVTExZXzAwMDJfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczkudGx0KCdpbnRlbnRfcGFnZV9hZGRfc3VjY2Vzc19tc2cnKSwKICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHt9KTsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfaW50ZXJuYWxfc2VydmVyX21zZzEnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfaW50ZXJuYWxfc2VydmVyX21zZzMnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYXBpIGNhbGwgd2l0aCBpbWFnZSAiKTsKICAgICAgICAgICAgLy8gdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICAvLyAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc3VibWl0X2RldGFpbHNfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICAgICAgaXNfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LAogICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgICByZXNwb25zZTogewogICAgICAgICAgICAgICAgZmlsZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwyLAogICAgICAgICAgICAgICAgZmlsZV9kYXRhOiB0aGlzLmZpbGVfY29udGVudDIsCiAgICAgICAgICAgICAgICB2aWRlb19saW5rOiB0aGlzLnZpZGVvX3Jlc3BvbnNlID09ICJZZXMiID8gdGhpcy5lbWJkX2xpbmsgOiBbXSwKICAgICAgICAgICAgICAgIHNvdXJjZTogdGhpcy5zb3VyY2UsCiAgICAgICAgICAgICAgICByZXNwb25zZTogdGhpcy5tdWx0aXBsZV9yZXNwb25zZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkFEREVEX1NVQ0NFU1NGVUxMWV8wMDAyX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfYWRkZWRfc3VjY2Vzc19tc2cyJyksCiAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVybmFsX3NlcnZlcl9tYWcxJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM5LmFwaV9zdGF0dXNfY29kZS5JTUdfRFVQTElDQVRFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfaW1hZ2VfZXhpc3RfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfaW50ZXJuYWxfc2VydmVyX21hZzMnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghdGhpcy52aWV3X3Jlc3BvbnNlX21vZGFsKSB7CiAgICAgICAgICBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiVHJ1ZSIgJiYgdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyAhPSAiIikgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZyh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0pOwogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0uaW5wdXRfdGV4dCA9PSAiIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9hbGxfdmFsdWVzX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gaWYgKHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzKSB7CiAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiQW4gSW50ZW50IHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzLiIpOwogICAgICAgICAgLy8gfQoKCiAgICAgICAgICBpZiAodGhpcy5zYXZlX3VybCA9PSAiIiB8fCB0aGlzLnNhdmVfYXBpX21ldGhvZCA9PSBudWxsIHx8IHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gbnVsbCB8fCB0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIiAmJiB0aGlzLnNhdmVfZWRpdGFibGVfdmFsdWVzID09ICIiKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgdmFsdWVzIik7CiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfYXBpX21ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc2VsZWN0X21ldGhvZF9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfcmVxdWVzdF9qc29uX21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9hbGxfdmFsdWVzX2FsZXJ0X21zZzEnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXZlX3JlcV9qc29uKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9wYWdlX3JlcXVlc3RfanNvbl9tc2cxJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmICF0aGlzLmlzRWRpdCkgey8vIHZhciBjc3YgPSB0aGlzLmVkaXRhYmxlX3ZhbHVlcy5zcGxpdCgiOyIpOwogICAgICAgICAgICAgIC8vIHZhciBpbnB1dF92YWx1ZTsKICAgICAgICAgICAgICAvLyB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzID0gW107CiAgICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiBjc3YpIHsKICAgICAgICAgICAgICAvLyAgIGxldCB0ZW1wX2xpc3QgPSBjc3ZbaV0uc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAvLyAgIGlucHV0X3ZhbHVlID0gdGVtcF9saXN0W3RlbXBfbGlzdC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAvLyAgIHRoaXMudGFza19pbnB1dF92YWx1ZXMucHVzaCh7CiAgICAgICAgICAgICAgLy8gICAgIGtleV9uYW1lOiBpbnB1dF92YWx1ZSwKICAgICAgICAgICAgICAvLyAgICAgaW5wdXRfdGV4dDogIiIsCiAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfcmVxdWVzdF9qc29uX2VkaXRhYmxlID09ICJUcnVlIikgewogICAgICAgICAgICAgIC8vIGxldCBlbXB0eV92YXJzID0gW107CiAgICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiB0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgICAgLy8gICBpZiAodGhpcy50YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ID09ICIiKSB7CiAgICAgICAgICAgICAgLy8gICAgIGVtcHR5X3ZhcnMucHVzaCh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzW2ldKTsKICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAvLyAgIC8vICBjb25zb2xlLmxvZyh0aGlzLnRhc2tfaW5wdXRfdmFsdWVzKTsKICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgLy8gaWYgKGVtcHR5X3ZhcnMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICB0aGlzLmZpbmFsc3RlcCA9IHRydWU7IC8vIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHZhbHVlcy4iKTsKICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5maW5hbHN0ZXAgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuZmluYWxzdGVwID09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGV4aXN0aW5nX2ludGVudF9saXN0ID0gdGhpcy5hcGlfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGFwaSkgewogICAgICAgICAgICAgIHJldHVybiBhcGkuaW50ZW50ID09IF90aGlzOS5pbnRlbnRzOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHBvc3RfbWV0aG9kX2RhdGEsIGdldF9tZXRob2RfZGF0YTsKICAgICAgICAgICAgcG9zdF9tZXRob2RfZGF0YSA9IHt9OwogICAgICAgICAgICBnZXRfbWV0aG9kX2RhdGEgPSB7fTsgLy8gaWYgKHRoaXMuYXBpX21ldGhvZCA9PSAiUE9TVCIgJiYgdGhpcy50YXNrX2Zyb20gPT0gImZyb21fZW50aXR5IikgewoKICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9hcGlfbWV0aG9kID09ICJQT1NUIikgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzKSB7CiAgICAgICAgICAgICAgICBwb3N0X21ldGhvZF9kYXRhW3RoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5rZXlfbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgIGZyb21fdGV4dDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0ICE9ICIiID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgICAgICBlbnRpdHk6IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgICAvLyBpbnRlbnQ6IHRoaXMuY29tcGFueWlkICsgIl8iICsgdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgICAgICBub3RfaW50ZW50OiBudWxsCiAgICAgICAgICAgICAgICB9OyAvLyAgY29uc29sZS5sb2coInBvc3QgbWV0aG9kIixwb3N0X21ldGhvZF9kYXRhKTsKICAgICAgICAgICAgICB9IC8vICBjb25zb2xlLmxvZygicG9zdCBtZXRob2QiLHBvc3RfbWV0aG9kX2RhdGEpOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9hcGlfbWV0aG9kID09ICJHRVQiKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICAgIGdldF9tZXRob2RfZGF0YVt0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXNbaV0ua2V5X25hbWVdID0gewogICAgICAgICAgICAgICAgICBFbnRpdHk6IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0LAogICAgICAgICAgICAgICAgICBTbG90OiBudWxsCiAgICAgICAgICAgICAgICB9OyAvLyAgY29uc29sZS5sb2coImdldCBtZXRob2QiLGdldF9tZXRob2RfZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXhpc3RpbmdfaW50ZW50X2xpc3QubGVuZ3RoID4gMCAmJiAhdGhpcy5pc0VkaXQpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9uYW1lX2V4aXN0X2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09IG51bGwpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9tc2dfdHlwZV9tc2cnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoKHRoaXMuc2F2ZV9lbmRfdXNlcl9tZXNzYWdlICE9ICIiIHx8IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJUaHJvdWdoX0FQSSIpICYmICh0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSAhPSBudWxsIHx8IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSAmJiB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSAhPSBudWxsICYmICh0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgIT0gIiIgfHwgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIkN1c3RvbSIpICYmICh0aGlzLnNhdmVfanNvbl9yZXNwb25zZV9kYXRhICE9ICIiIHx8IHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSkgewogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9PSAiVGhyb3VnaF9BUEkiKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Jlc3BfanNvbigpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9yZXF1ZXN0X2pzb25fYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9PSAiIikgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2cxJyksCiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlID09ICJUcnVlIikgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5zYXZlX3Jlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9hbGxfdmFsdWVzX2FsZXJ0X21zZzInKSwKICAgICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5zYXZlX2VuZF91c2VyX21lc3NhZ2UgPSAiIjsgLy8gY29uc29sZS5sb2coImVuZF91c2VyIG1lc3NhZ2UgbnVsbCIsdGhpcy5zYXZlX2VuZF91c2VyX21lc3NhZ2UpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9lbmR1c2VyX21zZ190eXBlID09ICJDdXN0b20iKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgPSAiIjsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gIiI7IC8vIGNvbnNvbGUubG9nKCJyZXNwb25zZSBrZXkgdG8gZW5kIHVzZXIgbnVsbCIsdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV90b19lbmR1c2VyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aGlzLnNhdmVfdW5zdWNjZXNzZnVsX21lc3NhZ2UgPT0gIiIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfYWxsX3ZhbHVlc19hbGVydF9tc2czJyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24gPT0gIlNpbHZlciIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfdXBncmFkZV9wbGFuX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczkuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICAgICAgdmFyIHRhc2tzID0ge307CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiICYmIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcy5sZW5ndGggPiAwIHx8IHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIkZhbHNlIikgewogICAgICAgICAgICAgICAgICB2YXIgX2F4aW9zJHBvc3QyOwoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNhdmVfdGFza19pbnB1dF92YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRlbXAucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBUeXBlOiAiQXNrIiwKICAgICAgICAgICAgICAgICAgICAgIFRleHQ6IHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlc1tpXS5pbnB1dF90ZXh0CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGFza3NbdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzW2ldLmtleV9uYW1lXSA9IHRlbXA7CiAgICAgICAgICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coInJlYWNoZWQgaGVyZSBmaW5hbGx5Iik7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMubmV3X2ludGVudHMpOwoKCiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9zdWJtaXRfZGV0YWlsc19tc2cxJyksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIChfYXhpb3MkcG9zdDIgPSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGlzX2VuZHBvaW50OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIC8vIGludGVudDogdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdCwKICAgICAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2F2ZV91cmwsCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGpzb246IHRoaXMuc2F2ZV9qc29uX3JlcXVlc3RfZGF0YSwKICAgICAgICAgICAgICAgICAgICBhcGlfbWV0aG9kOiB0aGlzLnNhdmVfYXBpX21ldGhvZCwKICAgICAgICAgICAgICAgICAgICBlbmRfdXNlcl9tZXNzYWdlOiB0aGlzLnNhdmVfZW5kX3VzZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBtc2dfdHlwZTogdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VrZXk6IHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciwKICAgICAgICAgICAgICAgICAgICBhcGlfZWRpdDogdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSwKICAgICAgICAgICAgICAgICAgICBhcGlfZWRpdGFibGVfdmFsdWU6IHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5zYXZlX2VkaXRhYmxlX3ZhbHVlcyA6ICIiLAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlanNvbjogdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIiA/IHRoaXMuc2F2ZV9qc29uX3Jlc3BvbnNlX2RhdGEgOiAiIiwKICAgICAgICAgICAgICAgICAgICByZXNwb25zZV9tc2dfZWRpdGFibGU6IHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlLAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX21zZ19lZGl0YWJsZV92YWx1ZTogdGhpcy5zYXZlX3Jlc3BvbnNlX2pzb25fZWRpdGFibGUgPT0gIlRydWUiID8gdGhpcy5zYXZlX3Jlc3BvbnNlX2tleV9lZGl0X21lc3NhZ2UgOiAiIiwKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2pzb25fa2V5X21hcHBpbmc6IGdldF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YTogcG9zdF9tZXRob2RfZGF0YSwKICAgICAgICAgICAgICAgICAgICB1bnN1Y2Nlc3NmdWxfbXNnOiB0aGlzLnNhdmVfdW5zdWNjZXNzZnVsX21lc3NhZ2UKICAgICAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImxpY2Vuc2Vfa2V5IiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5KSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgImVtYWlsIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MiwgInRva2VuIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJ0YXNrX2RldGFpbHMiLCB0YXNrcyksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJzdWJzY3JpcHRpb24iLCAiUGxhdGludW0iKSwgX2F4aW9zJHBvc3QyKSwgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzOS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkFERF9DT05GSUdVUklOR19BUElfVVJMX1NVQ0NFU1NfMjAwOC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfaW50ZW50X2FkZGVkX21zZycpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczkuYXBpX3N0YXR1c19jb2RlLkFERF9DT05GSUdVUklOR19BUElfUE9TVF9NRVRIT0RfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczkudGx0KCdpbnRlbnRfcGFnZV9wb3N0X3JlcXVlc3RfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuQUREX0NPTkZJR1VSSU5HX0FQSV9KU09OX1NVQ0NFU1NfMjAwNl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVudF9hZGRlZF9tc2cxJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkX2ludGVudCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJCgiI2ludGVudG1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzOS50bHQoJ2ludGVudF9wYWdlX2ludGVybmFsX3NlcnZlcl9tYWc0JyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuRU5EUE9JTlRfTElNSVRfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogX3RoaXM5LnRsdCgnaW50ZW50X3BhZ2VfdXBncmFkZV9wbGFuX21zZzEnKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczkubG9hZF9pbnRlbnQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gLy8gZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5zYXZlX3JlcXVlc3RfanNvbl9lZGl0YWJsZSA9PSAiRmFsc2UiICYmCiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5zYXZlX3Rhc2tfaW5wdXRfdmFsdWVzLmxlbmd0aCA+IDAKICAgICAgICAgICAgICAgIC8vICAgKQoKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc2F2ZV9yZXNwb25zZV9qc29uX2VkaXRhYmxlID09IG51bGwgJiYgdGhpcy5zYXZlX2VuZHVzZXJfbXNnX3R5cGUgPT0gIlRocm91Z2hfQVBJIiAmJiB0aGlzLnNhdmVfcmVzcG9uc2Vfa2V5X3RvX2VuZHVzZXIgIT0gIiIgJiYgdGhpcy5zYXZlX2pzb25fcmVzcG9uc2VfZGF0YSAhPSAiIikgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9yZXNwb25zZV9qc29uX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9hbGxfdmFsdWVzX2FsZXJ0X21zZzQnKSwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2FsbHNlYXJjaDogZnVuY3Rpb24gY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgICB0aGlzLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2VhcmNoX2ludGVudCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9pbnRlbnQ6IGZ1bmN0aW9uIHNlYXJjaF9pbnRlbnQoY3VycmVudF9zZWxlY3RlZF9pbnRlbnRfaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTAudGx0KCdpbnRlbnRfcGFnZV9ub19yZXN1bHRfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SX01PREVMUy5NU0dfQ09ERSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gW107CiAgICAgICAgICAgIF90aGlzMTAucGFnZV9ubyA9IDE7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzMTAubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgICBfdGhpczEwLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgX3RoaXMxMC5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczEwLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIF90aGlzMTAuaW50ZW50bGlzdFtpXS5JbnRlbnQgPSBfdGhpczEwLmludGVudGxpc3RbaV0uSW50ZW50OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEwLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KSkgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczEwLnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTAuc2V0cGFnaW5hdGlvbihfdGhpczEwLnBhZ2Vfbm8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTAudGx0KCdpbnRlbnRfcGFnZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnNScpLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTAubG9hZF9pbnRlbnQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTAubG9hZF9pbnRlbnQoKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc2VhcmNoX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9zZWxlY3RlZDogZnVuY3Rpb24gZGVsZXRlX3NlbGVjdGVkKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9ub19pbnRlbnRfbXNnJyksCiAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuY2hlY2tlZF9saXN0KSB7CiAgICAgICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdC5wdXNoKHRoaXMuY2hlY2tlZF9saXN0W2ldKTsKICAgICAgICB9IC8vIGNvbnNvbGUubG9nKHRoaXMubmV3X2ludGVudF9saXN0KTsKCgogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9wYWdlX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2VfcmV2ZXJ0X2FsZXJ0X21zZycpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnaW50ZW50X3BhZ2Vfc3dhbF9hbGVydF9kZWxldGVfbXNnJykKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwgewogICAgICAgICAgICAgIGludGVudF9saXN0OiBfdGhpczExLm5ld19pbnRlbnRfbGlzdCwKICAgICAgICAgICAgICBpc19kZWxldGU6IHRydWUsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiBfdGhpczExLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMTEuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczExLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMTEuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMxMS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoX3RoaXMxMS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzMTEubmV3X2ludGVudF9saXN0ID0gW107CiAgICAgICAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlRFTlRTX0RFTEVURURfU1VDQ0VTU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEudGx0KCdpbnRlbnRfcGFnZV9zd2FsX2FsZXJ0X2RlbGV0ZV9tc2cxJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsvLyBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgfSk7IC8vIHRoaXMubG9hZF9pbnRlbnQoKTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5jaGVja2VkX2xpc3QubGVuZ3RoID09PSBfdGhpczExLmludGVudGxpc3QubGVuZ3RoICYmIF90aGlzMTEucGFnZV9ubyA+IDEpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS5wYWdlX25vID0gX3RoaXMxMS5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczExLmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfVVNFRF9JTl9ESUFMT0dfREVMRVRFRF9TVUNDRVNTRlVMTFlfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3BhZ2Vfc3dhbF9hbGVydF9kZWxldGVfbXNnMicpLAogICAgICAgICAgICAgICAgICB0aW1lcjogODAwMAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXMxMS5pbnRlbnRsaXN0Lmxlbmd0aCAmJiBfdGhpczExLnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEucGFnZV9ubyA9IF90aGlzMTEucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuTk9USElOR19UT19ERUxFVEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3BhZ2VfYW55X2ludGVudF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX0RFTEVURURfVFJBSU5fTU9ERUxfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgnaW50ZW50X3BhZ2VfdHJhaW5lZF9pbXRlbnRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF90aGlzMTEubmV3X2ludGVudF9saXN0ID0gW107CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gX3RoaXMxMS5pbnRlbnRsaXN0Lmxlbmd0aCAmJiBfdGhpczExLnBhZ2Vfbm8gPiAxKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEucGFnZV9ubyA9IF90aGlzMTEucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuVFJBSU5FRF9JTlRFTlRfQU5EX0lOVEVOVF9VU0VEX0lOX0RJQUxPR19ERUxFVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTEudGx0KCdpbnRlbnRfcGFnZV90cmFpbmVkX2ludGVudF9tc2cxJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfdGhpczExLm5ld19pbnRlbnRfbGlzdCA9IFtdOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IF90aGlzMTEuaW50ZW50bGlzdC5sZW5ndGggJiYgX3RoaXMxMS5wYWdlX25vID4gMSkgewogICAgICAgICAgICAgICAgICBfdGhpczExLnBhZ2Vfbm8gPSBfdGhpczExLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICAgIH0pOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczExLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgX3RoaXMxMS5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTEubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX3JlcXVpcmU6IGZ1bmN0aW9uIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkge30gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW50ZW50X3F1ZXN0aW9uX3Jlc3BvbnNlKCksIHsKICAgICAgICAgICAgaW50ZW50OiB0aGlzLm5ld19pbnRlbnRzLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMTIuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdCA9IFtdOwoKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGFbMF0pIHsKICAgICAgICAgICAgICAvLyAgIHRoaXMuaW50ZW50bGlzdC5wdXNoKHsKICAgICAgICAgICAgICAvLyAgICAgaW50ZW50OiByZXNwb25zZS5kYXRhWzBdW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwKICAgICAgICAgICAgICAvLyAgICAgZW1haWw6IHJlc3BvbnNlLmRhdGFbMV1baV0sCiAgICAgICAgICAgICAgLy8gICAgIGNyZWF0ZWQ6IHJlc3BvbnNlLmRhdGFbMl1baV0sCiAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgX3RoaXMxMi5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOyAvLyBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIC8vICAgdGhpcy5pbnRlbnRsaXN0W2ldLkludGVudCA9IHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQucmVwbGFjZSgKICAgICAgICAgICAgICAvLyAgICAgYCR7dGhpcy5jb21wYW55aWR9X2AsCiAgICAgICAgICAgICAgLy8gICAgICIiCiAgICAgICAgICAgICAgLy8gICApOwogICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTIuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEyLnNob3dfaW50ZW50cygwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTIuc2V0cGFnaW5hdGlvbihfdGhpczEyLnBhZ2Vfbm8pOyAvLyBjb25zb2xlLmxvZygicGFnZSByZXF1aXJlIGlzIGhlcmUiKTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gaWYodGhpcy5zZWFyY2hfYnk9PSdFbWFpbCBBZGRyZXNzJyl7CiAgICAgICAgICAvLyAgIHRoaXMuc2VhcmNoYnk9J0NyZWF0ZWRCeSc7CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyBlbHNlewogICAgICAgICAgLy8gICB0aGlzLnNlYXJjaGJ5PXRoaXMuc2VhcmNoX2J5OwogICAgICAgICAgLy8gfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICBwYWdlID0gTWF0aC5jZWlsKCgxICsgcGFnZSkgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgcGFnZSA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHBhZ2UpIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubwogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTIudGx0KCdpbnRlbnRfcGFnZV9ub19yZXN1bHRfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1JfTU9ERUxTLk1TR19DT0RFICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSBfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICAgIF90aGlzMTIubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgICBfdGhpczEyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgX3RoaXMxMi5pbnRlbnRsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJlc3BvbnNlTGlzdDsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczEyLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIF90aGlzMTIuaW50ZW50bGlzdFtpXS5JbnRlbnQgPSBfdGhpczEyLmludGVudGxpc3RbaV0uSW50ZW50OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTIuaW50ZW50bGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEyLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIF90aGlzMTIuc2hvd19pbnRlbnRzKDApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxMi5zZXRwYWdpbmF0aW9uKF90aGlzMTIucGFnZV9ubyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IF90aGlzMTIudGx0KCdpbnRlbnRfcGFnZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnOCcpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMxMi5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfdGhpczEyLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMTIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2k1ID0gMDsgX2k1IDwgNDsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTYgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2k2IDwgdGhpcy50b3RhbF9wYWdlczsgX2k2KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNiArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTcgPSAwOyBfaTcgPCBwYWdlX25vICsgMzsgX2k3KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNyArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k4ID0gcGFnZV9ubyAtIDQ7IF9pOCA8IHRoaXMudG90YWxfcGFnZXM7IF9pOCsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTggKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k5ID0gcGFnZV9ubyAtIDM7IF9pOSA8PSBwYWdlX25vICsgMzsgX2k5KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pOSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RlZF9pbnRlbnRzOiBmdW5jdGlvbiBzZWxlY3RlZF9pbnRlbnRzKEludGVudCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAoSW50ZW50ID09ICJhbGwiKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuaW50ZW50bGlzdDsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsgLy8gY29uc29sZS5sb2codGhpcy5jaGVja2VkX2xpc3QpOwoKICAgICAgICAgIHRlbXAgPSBbXTsgLy8gdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0Lm1hcCgoYXJyKSA9PiBhcnIuSW50ZW50KTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRlbXApOwogICAgICAgICAgLy8gY29uc29sZS5sb2coKQoKICAgICAgICAgIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuICFfdGhpczEzLmRlZmF1bHRfcmV0YWlsX2ludGVudHMuaW5jbHVkZXMoaXRlbS5JbnRlbnQpOwogICAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0Lm1hcCgoYXJyKSA9PiBhcnIuSW50ZW50KS5maWx0ZXIoKGl0ZW0pID0+ICEodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKGl0ZW0uSW50ZW50KSkpKQogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jaGVja2VkX2xpc3QubWFwKChhcnIpID0+IGFyci5JbnRlbnQpKQogICAgICAgICAgLy8gY29uc29sZS5sb2codGVtcCk7CgogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gaXRlbS5JbnRlbnQ7CiAgICAgICAgICB9KTsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICQoIiNpbnRlbnRfY2hlY2tib3hfIiArIHRoaXMuY2hlY2tlZF9saXN0W2ldKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgdmFsX2luZGV4ID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzLkludGVudCA9PSBJbnRlbnQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAodmFsX2luZGV4Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goSW50ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF90ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uIChpbnRlbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzICE9IEludGVudDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gX3RlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3Jlc3BvbnNlX2xpc3Q6IGZ1bmN0aW9uIGFkZF90b19yZXNwb25zZV9saXN0KHR5cGUsIGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlLmxlbmd0aCk7CiAgICAgIGlmICh0eXBlID09ICJhZGQiICYmICh0aGlzLm11bHRpcGxlX3Jlc3BvbnNlLmxlbmd0aCA9PSAxMCB8fCB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZS5sZW5ndGggPT0gMTApKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndGVuX3Jlc3BvbnNlc19hZGRlZF9hbGVydF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMubXVsdGlwbGVfcmVzcG9uc2UudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLm11bHRpcGxlX3Jlc3BvbnNlLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZS51bnNoaWZ0KCIiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3Jlc3BvbnNlLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYWRkX3RvX3F1ZXN0aW9uc19saXN0OiBmdW5jdGlvbiBhZGRfdG9fcXVlc3Rpb25zX2xpc3QodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKCF0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgICB0aGlzLmFkZF9xdWVzdGlvbnNfbGlzdC51bnNoaWZ0KCIiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMudW5zaGlmdCgiIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VfcmVzcG9uc2VfdHlwZTogZnVuY3Rpb24gY2hhbmdlX3Jlc3BvbnNlX3R5cGUoKSB7CiAgICAgIGlmICh0aGlzLmRlZmluZV9hcGlfZW5kcG9pbnRzID09IHRydWUpIHsKICAgICAgICB0aGlzLmRlZmluZV9hcGlfZW5kcG9pbnRzID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQ6IGZ1bmN0aW9uIGZpbGVpbnB1dCgpIHsKICAgICAgdGhpcy5maWxlX2xhYmVsID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHZhciBmaWxlX25hbWUgPSB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2IjsKCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwgIT0gZmlsZV9uYW1lKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9kb3dubG9hZF9pbnRlbnRfZmlsZXNfbXNnJyksCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWxlX2NvbnRlbnQgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQyOiBmdW5jdGlvbiBmaWxlaW5wdXQyKGV2ZW50KSB7CiAgICAgIHZhciBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgdGhpcy5maWxlX2xhYmVsMiA9IGV2ZW50LnRhcmdldC5maWxlc1swXS5uYW1lOwogICAgICB0aGlzLmZpbGVfdHlwZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXS50eXBlOyAvLyBjb25zb2xlLmxvZyhmaWxlcykKICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQudGFyZ2V0LmZpbGVzWzBdKQoKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbDIgIT0gdGhpcy50ZW1wX2ZpbGVfbmFtZSkgewogICAgICAgIHRoaXMuaW1hZ2VfZWRpdCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbGVfdHlwZSA9PSAiaW1hZ2UvcG5nIikgewogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UoZmlsZXMsIHRoaXMuZmlsZV90eXBlKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVfdHlwZSA9PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzLCB0aGlzLmZpbGVfdHlwZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF91cGxvYWRfZmlsZXNfbXNnJyksCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbDIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE0LmZpbGVfY29udGVudDIgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGZpbGVpbnB1dDM6IGZ1bmN0aW9uIGZpbGVpbnB1dDMoZXZlbnQpIHsKICAgICAgdmFyIGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB0aGlzLmZpbGVfbGFiZWwzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHRoaXMuZmlsZV90eXBlMyA9IGV2ZW50LnRhcmdldC5maWxlc1swXS50eXBlOyAvLyBjb25zb2xlLmxvZyhmaWxlcykKICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQudGFyZ2V0LmZpbGVzWzBdKQoKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbDMgIT0gdGhpcy50ZW1wX2ZpbGVfbmFtZSkgewogICAgICAgIHRoaXMuaW1hZ2VfZWRpdCA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbGVfdHlwZTMgPT0gImltYWdlL3BuZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMyhmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsZV90eXBlMyA9PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMyhmaWxlcywgdGhpcy5maWxlX3R5cGUpOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfdXBsb2FkX2ZpbGVzX21zZzEnKSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsMiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVJbWFnZTM6IGZ1bmN0aW9uIGNyZWF0ZUltYWdlMyhmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNS5maWxlX2NvbnRlbnQzID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBlbWJlZGRlZF9jaGFuZ2U6IGZ1bmN0aW9uIGVtYmVkZGVkX2NoYW5nZSgpIHsKICAgICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcL3x2XC98dVwvXHdcL3xlbWJlZFwvfHdhdGNoXD92PXxcJnY9KShbXiNcJlw/XSopLiovOwogICAgICB2YXIgbWF0Y2ggPSB0aGlzLnZpZGVvX2xpbmsubWF0Y2gocmVnRXhwKTsKCiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsyXS5sZW5ndGggPT0gMTEpIHsvLyBjb25zb2xlLmxvZyhtYXRjaFsyXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJlcnJvciI7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1iZF9saW5rID0gImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLyIgKyBtYXRjaFsyXTsgLy8gY29uc29sZS5sb2codGhpcy5lbWJkX2xpbmspOwogICAgfSwKICAgIGVtYmVkZGVkX2NoYW5nZV9lZGl0OiBmdW5jdGlvbiBlbWJlZGRlZF9jaGFuZ2VfZWRpdCgpIHsKICAgICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcL3x2XC98dVwvXHdcL3xlbWJlZFwvfHdhdGNoXD92PXxcJnY9KShbXiNcJlw/XSopLiovOwogICAgICB2YXIgbWF0Y2ggPSB0aGlzLnNlbGVjdGVkX2ludGVudF9yZXNwb25zZV92aWRlby5tYXRjaChyZWdFeHApOwoKICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdLmxlbmd0aCA9PSAxMSkgey8vIGNvbnNvbGUubG9nKG1hdGNoWzJdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gImVycm9yIjsKICAgICAgfQoKICAgICAgdGhpcy5lbWJkX2xpbmtfZWRpdCA9ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8iICsgbWF0Y2hbMl07IC8vIGNvbnNvbGUubG9nKHRoaXMuZW1iZF9saW5rKTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIC8vIHRoaXMucmVzcG9uc2UgPSAiIjsKICAgICAgdGhpcy5tdWx0aXBsZV9yZXNwb25zZSA9IFsiIl07IC8vIHRoaXMuZWRpdF9yZXNwb25zZSA9ICIiOwogICAgICAvLyB0aGlzLiRlbWl0KAogICAgICAvLyAgICJpbnB1dCIsCiAgICAgIC8vICAgICIiCiAgICAgIC8vICk7CgogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICB0aGlzLnNhdmVfdXJsID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9hcGlfbWV0aG9kID0gbnVsbDsKICAgICAgdGhpcy5zYXZlX2pzb25fcmVxdWVzdF9kYXRhID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9yZXF1ZXN0X2pzb25fZWRpdGFibGUgPSBudWxsOwogICAgICB0aGlzLnNhdmVfZWRpdGFibGVfdmFsdWVzID0gIiI7CiAgICAgIHRoaXMuc2F2ZV90YXNrX2lucHV0X3ZhbHVlcyA9IFtdOwogICAgICB0aGlzLnNhdmVfZW5kdXNlcl9tc2dfdHlwZSA9ICJDdXN0b20iOwogICAgICB0aGlzLnNhdmVfanNvbl9yZXNwb25zZV9kYXRhID0gIiI7CiAgICAgIHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfdG9fZW5kdXNlciA9ICIiOwogICAgICB0aGlzLnNhdmVfZW5kX3VzZXJfbWVzc2FnZSA9ICIiOwogICAgICB0aGlzLnNhdmVfcmVzcG9uc2VfanNvbl9lZGl0YWJsZSA9IG51bGw7CiAgICAgIHRoaXMuc2F2ZV9yZXNwb25zZV9rZXlfZWRpdF9tZXNzYWdlID0gIiI7CiAgICAgIHRoaXMuc2F2ZV91bnN1Y2Nlc3NmdWxfbWVzc2FnZSA9ICIiOwogICAgICB0aGlzLnNvdXJjZSA9ICJXZWIiOwogICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSAiIjsKICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QgPSBbIiJdOwogICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICB0aGlzLmltYWdlX3VybCA9ICIiOwogICAgICB0aGlzLmltYWdlX3Jlc3BvbnNlID0gIk5vIjsKICAgICAgdGhpcy52aWRlb19yZXNwb25zZSA9ICJObyI7CiAgICAgIHRoaXMudmlkZW9fbGluayA9ICIiLCB0aGlzLmVtYmRfbGluayA9ICIiOwogICAgICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgdGhpcy5maWxlX2xhYmVsMyA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIHRoaXMuZmlsZV9jb250ZW50ID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPSAiIjsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlQWRkb24wMSIpLnZhbHVlID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZUFkZG9uMDIiKS52YWx1ZSA9ICIiOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmFkaW9CdG5uIikuY2hlY2tlZCA9IGZhbHNlOwogICAgICB0aGlzLnVuY2hlY2soKTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOyAvLyB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCA9IiI7CiAgICB9LAogICAganNvbl9yZXF1ZXN0X2NsYXNzOiBmdW5jdGlvbiBqc29uX3JlcXVlc3RfY2xhc3MoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLmpzb25fcmVxdWVzdF9kYXRhW3RoaXMuaW5kZXhdKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiAiaXMtaW52YWxpZCI7CiAgICAgIH0KCiAgICAgIHJldHVybiAiaXMtdmFsaWQiOwogICAgfSwKICAgIGpzb25fcmVzcG9uc2VfY2xhc3M6IGZ1bmN0aW9uIGpzb25fcmVzcG9uc2VfY2xhc3MoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgSlNPTi5wYXJzZSh0aGlzLmpzb25fcmVzcG9uc2VfZGF0YVt0aGlzLmluZGV4XSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gImlzLWludmFsaWQiOwogICAgICB9CgogICAgICByZXR1cm4gImlzLXZhbGlkIjsKICAgIH0sCiAgICBlZGl0X2ludGVudF9kZXRhaWxzOiBmdW5jdGlvbiBlZGl0X2ludGVudF9kZXRhaWxzKCkgewogICAgICAvLyBpZiAodGhpcy5kZWZhdWx0X3JldGFpbF9pbnRlbnRzLmluY2x1ZGVzKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpKSB7CiAgICAgIC8vICAgU3dhbCh7CiAgICAgIC8vICAgICB0aXRsZTogIk9vcHMiLAogICAgICAvLyAgICAgdGV4dDogIlRoaXMgaXMgYSBEZWZhdWx0IEludGVudCEgSXQgY2Fubm90IGJlIGVkaXRlZCIsCiAgICAgIC8vICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgIC8vICAgICB0aW1lcjogMjAwMCwKICAgICAgLy8gICB9KTsKICAgICAgLy8gICByZXR1cm4gZmFsc2U7CiAgICAgIC8vIH0KICAgICAgaWYgKCF0aGlzLmlzRWRpdEludGVudCkgewogICAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOyAvLyB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0sCiAgICBzaG93X2Jsb2NrOiBmdW5jdGlvbiBzaG93X2Jsb2NrKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PSAidXAiKSB7CiAgICAgICAgdGhpcy5zaG93X29yX2Jsb2NrID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gImRvd24iKSB7CiAgICAgICAgdGhpcy5zaG93X29yX2Jsb2NrID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGZpbGVfc3VibWl0OiBmdW5jdGlvbiBmaWxlX3N1Ym1pdCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICgkKCIjaW5wdXRHcm91cEZpbGVjc3YiKS52YWwoKSA9PSAnJykgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9pbnB1dF9maWVsZF9tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfdXBsb2FkX2Nzdl9maWxlc19tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciB1c2VyX2RldGFpbHMgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBpc19mb3JtX2ludGVudHM6IGZhbHNlCiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgfSk7CgogICAgICBpZiAodGhpcy5maWxlX2xhYmVsX2NzdiA9PSAiQ2hvb3NlIGZpbGUiKSB7fSBlbHNlIHsKICAgICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBmZC5hcHBlbmQoImZpbGUiLCB0aGlzLmZpbGVfY29udGVudF9jc3YsIHRoaXMuY29tcGFueW5hbWUgKyAiSW50ZW50RmlsZS5jc3YiKTsKICAgICAgICBmZC5hcHBlbmQoImpzb24iLCBibG9iKTsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy51cGxvYWRfZmlsZV91cmwoKSwgZmQsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMxNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLkZJTEVfVVBMT0FEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXMxNi50bHQoJ2ludGVudF91cGxvYWRfZmlsZXNfc3VjY2Vzc19tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxNi5hcGlfc3RhdHVzX2NvZGUuSU5DT1JSRUNUX0ZJTEVfRk9STUFUX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAvLyAgIFN3YWwoewogICAgICAgICAgICAvLyAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfaW5jb3JyZWN0X2ZpbGVfYWxlcnRfbXNnJyksCiAgICAgICAgICAgIC8vICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIC8vICAgICB0ZXh0OgogICAgICAgICAgICAvLyB0bHQoJ3NhbXBsZV9pbnRlbnRfZmlsZV9tc2cnKSwKICAgICAgICAgICAgLy8gICAgIC8vIHRpbWVyOiA0MDAwLAogICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfRklMRV9UWVBFX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXMxNi50bHQoJ2ludGVudF9maWxlX3R5cGVfYWxlcnRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzMTYudGx0KCdpbnRlbnRfZG93bmxvYWRfZmlsZXNfbXNnJykgLy8gdGltZXI6IDQwMDAsCgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNi5maWxlX2xhYmVsX2NzdiA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGVjc3YiKS52YWx1ZSA9ICIiOwoKICAgICAgICAgIF90aGlzMTYubG9hZF9pbnRlbnQoKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGVfZmlsZTogZnVuY3Rpb24gZG93bmxvYWRfc2FtcGxlX2ZpbGUoKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gdHJ1ZTsKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzYW1wbGVfZmlsZTogImludGVudCIsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICQoIiNmaWxlX3VwbG9hZCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgX3RoaXMxNy5zcGlubmVyT25GaWxlRG93bmxvYWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIGZpbGUiKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IF90aGlzMTcudGx0KCdpbnRlbnRfc29tZV9lcnJvcl9vY2N1cl9tc2cnKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsgLy8gY29uc29sZS5sb2codGhpcy5jb21wYW55bmFtZSkKCiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBfdGhpczE3LmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgIF90aGlzMTcuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogX3RoaXMxNy50bHQoJ2ludGVudF9zb21lX2Vycm9yX29jY3VyX21zZzEnKSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTcuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBmaWxlaW5wdXRfY3N2OiBmdW5jdGlvbiBmaWxlaW5wdXRfY3N2KCkgewogICAgICB0aGlzLmZpbGVfbGFiZWxfY3N2ID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7IC8vIHZhciBmaWxlX25hbWUgPSB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2IjsKCiAgICAgIHRoaXMuZmlsZV9jb250ZW50X2NzdiA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsgLy8gaWYgKHRoaXMuZmlsZV9sYWJlbF9jc3YgIT0gZmlsZV9uYW1lKSB7CiAgICAgIC8vICAgU3dhbCh7CiAgICAgIC8vICAgICB0eXBlOiAiaW5mbyIsCiAgICAgIC8vICAgICB0ZXh0OgogICAgICAvLyAgICAgICAiVXNlcnMgbmVlZCB0byBkb3dubG9hZCB0aGUgU2FtcGxlIEludGVudCBDU1YgRmlsZSBmcm9tICdVcGxvYWQgQ1NWIEZpbGUnIG1vZGVsLiBDaGFuZ2VzIHRvIHRoaXMgZmlsZSB3aWxsIGJlIGFjY2VwdGVkIGJ5IHRoZSBzeXN0ZW0uIiwKICAgICAgLy8gICAgIHRpbWVyOiAxMDAwMCwKICAgICAgLy8gICB9KTsKICAgICAgLy8gICB0aGlzLmZpbGVfbGFiZWxfY3N2ID0gIkNob29zZSBmaWxlIjsKICAgICAgLy8gICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGVjc3YiKS52YWx1ZSA9ICIiOwogICAgICAvLyB9IGVsc2UgewogICAgICAvLyAgIHRoaXMuZmlsZV9jb250ZW50X2NzdiA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgLy8gfQogICAgfSwKICAgIGRvd25sb2FkX2NzdjogZnVuY3Rpb24gZG93bmxvYWRfY3N2KCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5xdWVzdGlvbl9pbnRlbnRfY3N2KCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGlzX2Zvcm1faW50ZW50czogZmFsc2UKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIHZhciBhID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGEuaHJlZiA9IHJlc3BvbnNlLmRhdGEuZGF0YS5DU1ZfVVJMOwogICAgICAgICAgYS5kb3dubG9hZCA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOwogICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgdXBsb2FkX2ZpbGVfb3Blbl9tb2RhbDogZnVuY3Rpb24gdXBsb2FkX2ZpbGVfb3Blbl9tb2RhbCgpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgnc2hvdycpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0KICB9Cn07"},null]}