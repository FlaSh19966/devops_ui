{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotDesign.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotDesign.vue","mtime":1643027096156},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgcm9sZV9uYW1lczogIiIsCiAgICAgIC8vLy8vLy8vLy8vLwogICAgICBib3RfbmFtZXM6ICIiLAogICAgICBkZWxldGVfbGlzdDogW10sCiAgICAgIHJvbGVfbmFtZTogW10sCiAgICAgIC8vLy8vLy8vLy8KICAgICAgYm90X25hbWU6IFtdLAogICAgICB1c2VyX3R5cGVfbGlzdDogW10sCiAgICAgIHVzZXJfdHlwZTogbnVsbCwKICAgICAgLy8vLy8vLy8vLwogICAgICBib3RfdHlwZTogIkNsb3NlZCBCb3QiLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTAsCiAgICAgIHRvdGFsX3BhZ2VzOiAwLAogICAgICBhZGRfZWRpdDogInRydWUiLAogICAgICBvbGRfcm9sZV9uYW1lOiAiIiwKICAgICAgLy9oYXJzaAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBlbXB0eV9zdHJpbmdfdmFsaWRpdHk6IC9eJC8KICAgIH07CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIGF4aW9zLmdldChhcGlfY2FsbHMuc2hvd19jbG9zZWRfZm9ybV91cmwoKSwgewogICAgICBwYXJhbXM6IHsKICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgX3RoaXMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEuQm90cy5sZW5ndGg7IGkrKykgewogICAgICAgIF90aGlzLmJvdF9uYW1lLnB1c2goewogICAgICAgICAgbmFtZTogcmVzcG9uc2UuZGF0YS5Cb3RzW2ldLmJvdF9uYW1lLAogICAgICAgICAgdHlwZTogIkNsb3NlZCBCb3QiLAogICAgICAgICAgaWQ6IHJlc3BvbnNlLmRhdGEuQm90c1tpXS5ib3RfaWQsCiAgICAgICAgICB2ZXJzaW9uOiByZXNwb25zZS5kYXRhLkJvdHNbaV0uYm90X3ZlcnNpb24KICAgICAgICB9KTsKICAgICAgfQogICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgX3RoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgIH0KICAgIH0pOyAvLyBheGlvcwogICAgLy8gICAuZ2V0KAogICAgLy8gICAgIGFwaV9jYWxscy5vcGVuX2JvdCgpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIHBhcmFtczogewogICAgLy8gICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgIC8vIGJvdF9uYW1lOiB0aGlzLiRyb3V0ZS5wYXJhbXMuYm90ZGF0YS5ib3RfbmFtZSwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgfSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICB9CiAgICAvLyAgICkKICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgLy8gICAgIC8vIGZvcihsZXQgaT0wO2k8cmVzcG9uc2UuZGF0YS5Cb3RzLmxlbmd0aDtpKyspewogICAgLy8gICAgIC8vICAgdGhpcy5ib3RfbmFtZS5wdXNoKHsKICAgIC8vICAgICAvLyAgICAgbmFtZTpyZXNwb25zZS5kYXRhLkJvdHNbaV0sCiAgICAvLyAgICAgLy8gICAgIHR5cGU6J0Nsb3NlZCBCb3QnLAogICAgLy8gICAgIC8vICAgfSk7CiAgICAvLyAgICAgLy8gfQogICAgLy8gICAgIC8vIHRoaXMubGV2ZWxzPXJlc3BvbnNlLmRhdGEuQm90LnN0cnVjdHVyZTsKICAgIC8vICAgICAvLyB0aGlzLm1heGlkID0gdGhpcy5sZXZlbHMubGVuZ3RoCiAgICAvLyAgIH0pCiAgICAvLyAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICApIHsKICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKICAgIC8vIGF4aW9zCiAgICAvLyAuZ2V0KGFwaV9jYWxscy5vcGVuX2JvdCgpLHsKICAgIC8vICAgcGFyYW1zOiB7CiAgICAvLyAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgIH0KICAgIC8vIH0sIHsKICAgIC8vICAgaGVhZGVyczogewogICAgLy8gICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICB9LAogICAgLy8gfSkKICAgIC8vIC50aGVuKHJlc3BvbnNlPT57CiAgICAvLyAgIGZvcihsZXQgaT0wO2k8cmVzcG9uc2UuZGF0YS5Cb3RzLmxlbmd0aDtpKyspewogICAgLy8gICAgIHRoaXMuYm90X25hbWUucHVzaCh7CiAgICAvLyAgICAgICBuYW1lOnJlc3BvbnNlLmRhdGEuQm90c1tpXSwKICAgIC8vICAgICAgIHR5cGU6J09wZW4gQm90JywKICAgIC8vICAgICB9KTsKICAgIC8vICAgfQogICAgLy8gfSkKICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgICAvLyBheGlvcwogICAgLy8gICAucG9zdChhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLCB7CiAgICAvLyAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgcGFnZV9ubzogMSwKICAgIC8vICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgIC8vICAgICBpc1Nob3c6IHRydWUKICAgIC8vICAgfSwgewogICAgLy8gICBoZWFkZXJzOiB7CiAgICAvLyAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgIH0sCiAgICAvLyB9KQogICAgLy8gICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gInRva2VuIGludmFsaWQiJiZyZXNwb25zZS5kYXRhIT1udWxsKSB7CiAgICAvLyAgICAgICB0aGlzLm9yZ2FuaXplX3JvbGVzKHJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgIH0KICAgIC8vICAgfSkKICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBjaGVja19saXN0X2FycmF5OiBmdW5jdGlvbiBjaGVja19saXN0X2FycmF5KGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIHZhciByb2xlX2xlbmd0aCA9IHRoaXMucm9sZV9uYW1lLmxlbmd0aDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb2xlX2xlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgaWYgKCF0aGlzLmNoZWNrZWRfbGlzdC5pbmNsdWRlcyhpbmRleCkpIHsKICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaChpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnNwbGljZSh0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKGluZGV4KSwgMSk7IC8vIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKHJvbGVzID0+IHsKICAgICAgICAgIC8vICAgcmV0dXJuIHJvbGUucm9sZSAhPT0gaW5kZXg7CiAgICAgICAgICAvLyB9KTsKICAgICAgICAgIC8vIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBlZGl0X3JvbGU6IGZ1bmN0aW9uIGVkaXRfcm9sZShpbmRleCkgewogICAgICB0aGlzLm9sZF9yb2xlX25hbWUgPSB0aGlzLnJvbGVfbmFtZVtpbmRleF07CiAgICAgIHRoaXMucm9sZV9uYW1lcyA9IHRoaXMucm9sZV9uYW1lW2luZGV4XTsKICAgICAgdGhpcy51c2VyX3R5cGUgPSB0aGlzLnVzZXJfdHlwZV9saXN0W2luZGV4XTsKICAgICAgdGhpcy5hZGRfZWRpdCA9ICJmYWxzZSI7CiAgICB9LAogICAgZGVsZXRlX3JvbGU6IGZ1bmN0aW9uIGRlbGV0ZV9yb2xlKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5kZWxldGVfbGlzdC5wdXNoKHRoaXMucm9sZV9uYW1lW2luZGV4XSk7CiAgICAgIHRoaXMucm9sZV9uYW1lcyA9IHRoaXMucm9sZV9uYW1lW2luZGV4XSwgdGhpcy51c2VyX3R5cGUgPSB0aGlzLnVzZXJfdHlwZV9saXN0W2luZGV4XTsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIGRlbGV0ZSEhIgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczIuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55aWQ6IF90aGlzMi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnluYW1lOiBfdGhpczIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZW1haWw6IF90aGlzMi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogX3RoaXMyLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBkZWxldGVfcm9sZXM6IFt7CiAgICAgICAgICAgICAgUm9sZTogX3RoaXMyLnJvbGVfbmFtZXMsCiAgICAgICAgICAgICAgVXNlclR5cGU6IF90aGlzMi51c2VyX3R5cGUKICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGlzRGVsZXRlOiB0cnVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzMi4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzMi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXMyLnJvbGVfbmFtZXMgPSAiIjsKICAgICAgICAgICAgX3RoaXMyLnVzZXJfdHlwZSA9IG51bGw7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiVXNlciBSb2xlcyBEZWxldGVkIikgewogICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICB0aXRsZTogIkRlbGV0ZWQhIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIGJvdHMgaGF2ZSBiZWVuIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczIuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlVTRVIgRVhJU1QiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIlRoZXJlIGlzIGFscmVhZHkgYSB1c2VyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIFJvbGUiLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZV9ib3Q6IGZ1bmN0aW9uIGRlbGV0ZV9ib3QoaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgIHRoaXMuZGVsZXRlX2xpc3QucHVzaCh7CiAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWVbaW5kZXhdLm5hbWUsCiAgICAgICAgYm90X2lkOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5pZAogICAgICB9KTsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIGRlbGV0ZSEhIgogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gdHJ1ZTsgLy8gY29uc29sZS5sb2codGhpcy5kZWxldGVfbGlzdCk7CgogICAgICAgICAgYXhpb3MuZGVsZXRlKGFwaV9jYWxscy5kZWxldGVfY2xvc2VkX2Zvcm1fdXJsKCksIHsKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgY29tcGFueWlkOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGJvdHM6IF90aGlzMy5kZWxldGVfbGlzdAogICAgICAgICAgICB9LAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiRGVsZXRlZCEiLAogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgYm90cyBoYXZlIGJlZW4gZGVsZXRlZC4iLAogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIF90aGlzMy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlBhcnRpYWwiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4iLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRmFpbHVyZSIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX211bHRpcGxlX3JvbGU6IGZ1bmN0aW9uIGRlbGV0ZV9tdWx0aXBsZV9yb2xlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgdmFyIGxlbiA9IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdFtpXTsKICAgICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2goewogICAgICAgICAgUm9sZTogdGhpcy5yb2xlX25hbWVbaW5kZXhdLAogICAgICAgICAgVXNlclR5cGU6IHRoaXMudXNlcl90eXBlX2xpc3RbaW5kZXhdCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5tYWluX3JvbGVfdXJsKCksIHsKICAgICAgICAgICAgY29tcGFueWlkOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM0LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiBfdGhpczQuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgdG9rZW46IF90aGlzNC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZGVsZXRlX3JvbGVzOiBfdGhpczQuZGVsZXRlX2xpc3QsCiAgICAgICAgICAgIGlzRGVsZXRlOiB0cnVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNC4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgdGl0bGU6ICJEZWxldGVkISIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBib3RzIGhhdmUgYmVlbiBkZWxldGVkLiIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXM0LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiUGFydGlhbCIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIGludGVudHMgYWxyZWFkeSBleGlzdHMuIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIkZhaWxlZCIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJUaGUgaW50ZW50cyBhbHJlYWR5IGV4aXN0cy4iLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXM0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZV9tdWx0aXBsZV9ib3Q6IGZ1bmN0aW9uIGRlbGV0ZV9tdWx0aXBsZV9ib3QoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgICAgdmFyIGxlbiA9IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5jaGVja2VkX2xpc3RbaV07CiAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2goewogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZVtpbmRleF0ubmFtZSwKICAgICAgICAgICAgYm90X2lkOiB0aGlzLmJvdF9uYW1lW2luZGV4XS5pZAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IHRydWU7IC8vIGNvbnNvbGUubG9nKHRoaXMuZGVsZXRlX2xpc3QpOwoKICAgICAgICAgICAgYXhpb3MuZGVsZXRlKGFwaV9jYWxscy5kZWxldGVfY2xvc2VkX2Zvcm1fdXJsKCksIHsKICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiBfdGhpczUuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICBlbWFpbDogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogX3RoaXM1LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgYm90czogX3RoaXM1LmRlbGV0ZV9saXN0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KF90aGlzNS4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJTdWNjZXNzIikgewogICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJEZWxldGVkISIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIGJvdHMgaGF2ZSBiZWVuIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgX3RoaXM1LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gIlBhcnRpYWwiKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBib3QgY291bGQgbm90IGJlIGRlbGV0ZWQiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiRmFpbHVyZSIpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJCb3QgY291bGQgbm90IGJlIGRlbGV0ZWQiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM1LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiQm90IGNvdWxkIG5vdCBiZSBkZWxldGVkIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJObyBib3Qgc2VsZWN0ZWQgdG8gZGVsZXRlICIpOwogICAgICB9CiAgICB9LAogICAgYWRkX2JvdDogZnVuY3Rpb24gYWRkX2JvdCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmICh0aGlzLmVtcHR5X3N0cmluZ192YWxpZGl0eS50ZXN0KHRoaXMuYm90X25hbWVzKSkgewogICAgICAgIC8vdG9hc3RlcgogICAgICAgIHRvYXN0ci5lcnJvcigiRW50ZXIgQm90IE5hbWUiKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJvdF90eXBlID09IG51bGwpIHsKICAgICAgICAvL3RvYXN0ZXIKICAgICAgICB0b2FzdHIuZXJyb3IoIlNlbGVjdCBCb3QgVHlwZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBzYW1lX25hbWUgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvdF9uYW1lLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy5ib3RfbmFtZVtpXS5uYW1lID09IHRoaXMuYm90X25hbWVzKSB7CiAgICAgICAgICAgIHNhbWVfbmFtZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc2FtZV9uYW1lKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkJvdCB3aXRoIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYm90X3R5cGUgPSAiQ2xvc2VkIEJvdCI7CgogICAgICAgICAgaWYgKHRoaXMuYm90X3R5cGUgPT0gIk9wZW4gQm90IikgewogICAgICAgICAgICAkKCIjYm90bW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogIk9wZW5Cb3QiLAogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgYm90ZGF0YTogewogICAgICAgICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZXMsCiAgICAgICAgICAgICAgICAgIGJvdF90eXBlOiB0aGlzLmJvdF90eXBlLAogICAgICAgICAgICAgICAgICBpc19lZGl0OiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYm90X3R5cGUgPT0gIkNsb3NlZCBCb3QiKSB7CiAgICAgICAgICAgICQoIiNib3Rtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiAiV29ya2Zsb3ciLAogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgYm90ZGF0YTogewogICAgICAgICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZXMsCiAgICAgICAgICAgICAgICAgIGJvdF90eXBlOiB0aGlzLmJvdF90eXBlLAogICAgICAgICAgICAgICAgICBpc19lZGl0OiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgLy8gICBuYW1lOiByb3V0ZV9uYW1lLAogICAgICAgIC8vICAgcHJvcHM6IHRydWUKICAgICAgICAvLyB9KTsKCiAgICAgIH0KICAgIH0sCiAgICBwYWdlX2NoYW5nZTogZnVuY3Rpb24gcGFnZV9jaGFuZ2UocGFnZW5vKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgaWYgKHBhZ2VubyA9PSAwIHx8IHBhZ2VubyA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkge30gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlbm87CiAgICAgICAgICB9CgogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIgJiYgcmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXM2Lm9yZ2FuaXplX3JvbGVzKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczYuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZW5vOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwgewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHBhZ2Vfbm86IHBhZ2VubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLAogICAgICAgICAgICBzZWFyY2hzdHJpbmc6IHRoaXMuc2VhcmNoX25hbWUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJ0b2tlbiBpbnZhbGlkIiAmJiByZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICBfdGhpczYub3JnYW5pemVfcm9sZXMocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3JnYW5pemVfcm9sZXM6IGZ1bmN0aW9uIG9yZ2FuaXplX3JvbGVzKHJvbGVzX2xpc3QpIHsKICAgICAgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJvbGVzX2xpc3QubnVtYmVyX29mX3Jvd3M7CiAgICAgIHRoaXMucm9sZV9uYW1lID0gW107CiAgICAgIHRoaXMudXNlcl90eXBlX2xpc3QgPSBbXTsKICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJvbGVzX2xpc3QuUGFnZUNvdW50OwogICAgICB2YXIgcG9ydGFsX2xlbiA9IHJvbGVzX2xpc3QuUG9ydGFsLmxlbmd0aDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9ydGFsX2xlbjsgaSsrKSB7CiAgICAgICAgdGhpcy51c2VyX3R5cGVfbGlzdC5wdXNoKCJQb3J0YWwgVXNlciIpOwogICAgICAgIHRoaXMucm9sZV9uYW1lLnB1c2gocm9sZXNfbGlzdC5Qb3J0YWxbaV0pOwogICAgICB9CgogICAgICB2YXIgYm90X2xlbiA9IHJvbGVzX2xpc3QuQm90Lmxlbmd0aDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm90X2xlbjsgaSsrKSB7CiAgICAgICAgdGhpcy51c2VyX3R5cGVfbGlzdC5wdXNoKCJCb3QgVXNlciIpOwogICAgICAgIHRoaXMucm9sZV9uYW1lLnB1c2gocm9sZXNfbGlzdC5Cb3RbaV0pOwogICAgICB9CgogICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIHRoaXMuc2VhcmNoX3Byb2R1Y3QoKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9wcm9kdWN0OiBmdW5jdGlvbiBzZWFyY2hfcHJvZHVjdCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5tYWluX3JvbGVfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogMQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJ0b2tlbiBpbnZhbGlkIiAmJiByZXNwb25zZS5kYXRhICE9IG51bGwgJiYgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIFJvbGVzIEFkZGVkIFlldCIpIHsKICAgICAgICAgICAgX3RoaXM3LnBhZ2Vfbm8gPSAxOwoKICAgICAgICAgICAgX3RoaXM3Lm9yZ2FuaXplX3JvbGVzKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gUm9sZXMgQWRkZWQgWWV0IikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIk5vIHJvbGUgZm91bmQiKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXM3LiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJJbnRybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczcuJHJvdXRlci5nbygpOwogICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIkVudGVyIHByb3BlciBkYXRhIGZvciBzZWFyY2hpbmciKTsKICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgNDsgX2krKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2kyID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IF9pMiA8IHRoaXMudG90YWxfcGFnZXM7IF9pMisrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTIgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgcGFnZV9ubyArIDM7IF9pMysrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTMgKyAxKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNCA9IHBhZ2Vfbm8gLSA0OyBfaTQgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pNSA9IHBhZ2Vfbm8gLSAzOyBfaTUgPD0gcGFnZV9ubyArIDM7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHJvdXRlX3RvX3ByZXZpZXc6IGZ1bmN0aW9uIHJvdXRlX3RvX3ByZXZpZXcoaW5kZXgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICJUZXN0IENsb3NlZCBCb3QiLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgYm90ZGF0YTogewogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZVtpbmRleF0ubmFtZSwKICAgICAgICAgICAgYm90X3R5cGU6IHRoaXMuYm90X25hbWVbaW5kZXhdLnR5cGUsCiAgICAgICAgICAgIGJvdF9pZDogdGhpcy5ib3RfbmFtZVtpbmRleF0uaWQKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVkaXRfYm90OiBmdW5jdGlvbiBlZGl0X2JvdChpbmRleCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgbmFtZTogIldvcmtmbG93IiwKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIGJvdGRhdGE6IHsKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWVbaW5kZXhdLm5hbWUsCiAgICAgICAgICAgIGJvdF90eXBlOiB0aGlzLmJvdF9uYW1lW2luZGV4XS50eXBlLAogICAgICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgICAgICBib3RfaWQ6IHRoaXMuYm90X25hbWVbaW5kZXhdLmlkLAogICAgICAgICAgICBib3RfdmVyc2lvbjogdGhpcy5ib3RfbmFtZVtpbmRleF0udmVyc2lvbgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJfYWxsOiBmdW5jdGlvbiBjbGVhcl9hbGwoKSB7CiAgICAgIHRoaXMuYm90X25hbWVzID0gbnVsbDsKICAgIH0sCiAgICBzZXRfYWN0aXZlOiBmdW5jdGlvbiBzZXRfYWN0aXZlKGluZGV4KSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuYm90X25hbWUuc3RhdHVzID09ICJhY3RpdmUiKSB7Ly8gU3dhbC5maXJlKAogICAgICAgIC8vICAgIllvdXIgYm90cyBpcyBhbHJlYWR5IGFjdGl2ZSEhIiwKICAgICAgICAvLyAgICJZb3VyIGJvdHMgaXMgYWxyZWFkeSBhY3RpdmUuIiwKICAgICAgICAvLyAgICJzdWNjZXNzIgogICAgICAgIC8vICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiU3VibWl0IHRvIEFjdGl2YXRlIHRoZSBCb3QhIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgZGVsZXRlISEiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLm9wZW5fYm90X2Fzc2lnbm1lbnQoKSwgewogICAgICAgICAgICAgIGNvbXBhbnlpZDogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55bmFtZTogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczguJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogX3RoaXM4LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IF90aGlzOC4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdGF0dXM6ICIiLAogICAgICAgICAgICAgIGV0YTogIiIsCiAgICAgICAgICAgICAgZXRhX2NoYW5nZV9yZWFzb246ICIiLAogICAgICAgICAgICAgIGFzc2lnbmVkX3RvOiAiIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChfdGhpczguJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHt9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7IC8vIGF4aW9zCiAgICAgICAgICAgIC8vIC5wb3N0KGFwaV9jYWxscy5vcGVuX2JvdF9hc3NpZ25tZW50KCksewogICAgICAgICAgICAvLyAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIC8vICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIC8vICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgLy8gICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAvLyAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAvLyAgIHN0YXR1czonJywKICAgICAgICAgICAgLy8gICBldGE6ICcnLAogICAgICAgICAgICAvLyAgIGV0YV9jaGFuZ2VfcmVhc29uOicnLAogICAgICAgICAgICAvLyAgIHByb2dyZXNzX3VwZGF0ZTonJywKICAgICAgICAgICAgLy8gfSwgewogICAgICAgICAgICAvLyAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgLy8gICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAvLyAgIH0sCiAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgIC8vIC50aGVuKHJlc3BvbnNlPT57CiAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgIC8vICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgLy8gICBpZiAoCiAgICAgICAgICAgIC8vICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIC8vICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIC8vICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgIC8vICAgKSB7CiAgICAgICAgICAgIC8vICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9Cn07"},null]}