{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Newtestbot.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Newtestbot.vue","mtime":1660042032575},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDgtYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50MzItYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5jb3B5LXdpdGhpbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmV2ZXJ5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbHRlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWluZGV4IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubGFzdC1pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZS1yaWdodCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJldmVyc2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zZXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb3J0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc3ViYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1sb2NhbGUtc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IGZpbmdlcnByaW50IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvZmluZ2VycHJpbnQiOwppbXBvcnQgeyBidXMgfSBmcm9tICJAL3BvcnRhbC9tYWluIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBTb2NrZXQgfSBmcm9tICJwaG9lbml4LXNvY2tldCI7CmltcG9ydCB7IHNldFRpbWVvdXQsIHNldEludGVydmFsIH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IFJlY29yZGVyIGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvcmVjb3JkZXIiOwppbXBvcnQgU2Nyb2xsYmFyIGZyb20gInNtb290aC1zY3JvbGxiYXIiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IGRlYm91bmNlIGZyb20gInZ1ZS1kZWJvdW5jZS9zcmMvZGVib3VuY2UiOwppbXBvcnQgY291bnRyeV9jb2RlIGZyb20gIi4uL0Rhc2hib2FyZC9jb3VudHJ5X2NvZGVfZGF0YS5qc29uIjsKaW1wb3J0IENvdW50cnlDb2RlcyBmcm9tICIuLi9EYXNoYm9hcmQvQ291bnRyeUNvZGVzLmpzb24iOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImNsb3NlZC1mb3JtLXJlc3BvbnNlLWJvdCIsCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3Q6IE11bHRpc2VsZWN0CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHBvcHVwX21zZzogIllvdSBjYW4gdHlwZSDigJhSZXN0YXJ04oCdICBhdCA8L2JyPmFueSAgdGltZSB0byBnZXQgYmFjazwvYnI+IHRvIHRoZSBNYWluIE1lbnUiLAogICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiB0cnVlLAogICAgICBxdXNfYW5zOiAiYW5zd2VycyIsCiAgICAgIHRvX3NlbmQ6ICIiLAogICAgICBjZW5zZV9lbnF1aXJ5OiBmYWxzZSwKICAgICAgaXNfdHlwaW5nOiBmYWxzZSwKICAgICAgdXNlcl9uYW1lOiAiIiwKICAgICAgc2hvdzogZmFsc2UsCiAgICAgIGNoYXQ6IFtdLAogICAgICBmaW5nZXJwcmludDogbnVsbCwKICAgICAgYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlOiB0aGlzLiRzZXNzaW9uLmdldCgiUmVzcG9uc2VCb3RUb2tlbiIpID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlJlc3BvbnNlQm90VG9rZW4iKSA6ICIiLAogICAgICBmaXJzdF9jbGljazogZmFsc2UsCiAgICAgIGxldmVsOiAwLAogICAgICByZWNvZ25pdGlvbjogbnVsbCwKICAgICAganNvbl9kYXRhOiB7CiAgICAgICAgY3JlYXRlX2FwcG9pbnRtZW50OiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDAwMjM3In0sIlVzZXJOYW1lIjoiYWMiLCJJRCI6IlVTMDAwMDAwMDAwMDAwMDAwMTM4IiwiQWNjb3VudCI6IHsiSUQiOiAiQ08wMDAyMyJ9LCJUb2tlbiI6ICJaMXJTR0dtMFhwTVdqdDNnaUFFclBQV1o4NFRRTjlGc0ZNQkxzVSsvTEF1Nnl1YWxNZzZFUDJic3J3WmpMUHdtM2o0RHBQY0djNUxjSXAzTmpnZlVzQT09IiwiU3BlY2lhbHR5IjogeyJJRCI6ICJQRzAwMDAwMDAwMDAwMDAwMDE0MSIsICJOYW1lIjogIkFDIiwgIkNvZGUiOiAiQUMifSwiRG9tYWluIjogImdvZ3JlZW5iaWxscy5jb20ifSwiQXBwb2ludG1lbnQiOiB7IkRhdGUiOiAiMDgvMzAvMjAxOCIsICJJc0pTT05Ob3RlIjogMCwgIlBhdGllbnQiOiB7IkNhc2VJRCI6ICIifX19JywKICAgICAgICB2aXNpdHNfZmluYWxpemVkOiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDExODg2In0sIlVzZXJOYW1lIjogImNoIiwiSUQiOiAiVVMwMDAwMDAwMDAwMDAwMDAxNDMiLCJBY2NvdW50Ijp7IklEIjoiQ08wMDAyMyJ9LCJUb2tlbiI6ImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSklVekkxTmlKOS5leUoxYzJWeUlqb2lZWFprYUhWMElpd2laWGh3SWpveE5USTVORGd5TmpZemZRLnYxYzBIYnVXdVpYWHBKZkRyWFZjMUhQVnVmZmJuR2NMcWtwZzB6bTZBb1EiLCJTcGVjaWFsdHkiOiB7IklEIjogIlBHMDAwMDAwMDAwMDAwMDAwMTQyIiwiQ29kZSI6ICJjaCJ9LCJEb21haW4iOiAiZ3JlZW55b3VyYmlsbHMuY29tIn0sIlNlYXJjaFBhcmFtZXRlcnMiOiB7IlN0YXR1cyI6ICIiLCJPcmRlckJ5IjogIiIsIkZyb21EYXRlIjogIjAxLzAxLzIwMTgiLCJDb3VudCI6ICIxMCIsIlNlYXJjaFRleHQiOiAiIiwiVHlwZU9mVmlzaXQiOiAiQUxMIiwiU29ydE9yZGVyIjogImFwcG9pbnRtZW50IiwiU3RhcnRJbmRleCI6ICIxIiwiRW5kSW5kZXgiOiAiMTAiLCJUb0RhdGUiOiAiMDgvMDYvMjAxOCJ9fScsCiAgICAgICAgYXBwb2ludG1lbnRzX2NvdW50OiAneyJVc2VyIjogeyJQaHlzaWNpYW4iOiB7IklEIjogIkRUMDAwMDAwMDAwMDAwMDExODg2In0sIlVzZXJOYW1lIjogImNoIiwiSUQiOiAiVVMwMDAwMDAwMDAwMDAwMDAxNDMiLCJBY2NvdW50Ijp7IklEIjoiQ08wMDAyMyJ9LCJUb2tlbiI6ImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSklVekkxTmlKOS5leUoxYzJWeUlqb2lZWFprYUhWMElpd2laWGh3SWpveE5USTVORGd5TmpZemZRLnYxYzBIYnVXdVpYWHBKZkRyWFZjMUhQVnVmZmJuR2NMcWtwZzB6bTZBb1EiLCJTcGVjaWFsdHkiOiB7IklEIjogIlBHMDAwMDAwMDAwMDAwMDAwMTQyIiwiQ29kZSI6ICJjaCJ9LCJEb21haW4iOiAiZ3JlZW55b3VyYmlsbHMuY29tIn0sIlNlYXJjaFBhcmFtZXRlcnMiOiB7IlN0YXR1cyI6ICIiLCJPcmRlckJ5IjogIiIsIkZyb21EYXRlIjogIjAxLzAxLzIwMTgiLCJDb3VudCI6ICIxMCIsIlNlYXJjaFRleHQiOiAiIiwiVHlwZU9mVmlzaXQiOiAiQUxMIiwiU29ydE9yZGVyIjogImFwcG9pbnRtZW50IiwiU3RhcnRJbmRleCI6ICIxIiwiRW5kSW5kZXgiOiAiMTAiLCJUb0RhdGUiOiAiMDgvMDYvMjAxOCJ9fScsCiAgICAgICAgY3JlYXRlX3RpY2tldDogJ3siQWNjb3VudE5hbWUiOm51bGwsIkNhbGxiYWNrUGhvbmUiOiIiLCJDb21wYW55SUQiOiJDTzAwMDIzIiwiRGVzY3JpcHRpb24iOiJEZSIsIkRvbWFpbk5hbWUiOm51bGwsIkVtYWlsQ0MiOiJhYmhheS53QGNvZGVhcnJheS50ZWNoIiwiRW1haWxEZWZhdWx0IjoibWFuaXNoLnlAY29kZWFycmF5LnRlY2giLCJQcmlvcml0eSI6IjMiLCJQcmlvcml0eUlEIjowLCJSYWlzZWRCeSI6Imxhd3VzZXIiLCJTdGF0dXMiOjAsIlN0YXR1c0NvZGUiOm51bGwsIlN0YXR1c1RleHQiOm51bGwsIlNUeXBlIjoiV1AiLCJTdWJqZWN0IjoiRGUiLCJTdWJUeXBlIjoiU0FNRC1QIiwiVGlja2V0SUQiOjAsIlRpY2tldE51bWJlciI6bnVsbCwiVHlwZSI6MCwiVHlwZVRleHQiOiJXZWJzaXRlIFByb2JsZW0iLCJsaXN0RmlsZXMxIjpbImNocTEucGRmIl19JywKICAgICAgICBnZXRfcmVwb3J0OiAneyJjb21wYW55SWQiOiAiQ08wMDAyMyJ9JwogICAgICB9LAogICAgICBwaG9uZV9udW1iZXI6ICIiLAogICAgICBzdG9wOiB0cnVlLAogICAgICBkZW1vdXJsYmluZDogZmFsc2UsCiAgICAgIHJldmlld3N1cmxiaW5kOiBmYWxzZSwKICAgICAgcmV2aWV3c3VybDogImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL3BhQWVXODZlUVo0IiwKICAgICAgZGVtb3VybDogWyJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9LY3JKbTlVeFczcyZpbmRleD0xMyZsaXN0PVBMX2pYbGloOGRna1RFOENyUHBpV2NBOUt4UWVLSFpBbnQmdD0wcyIsICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92aWRlb3Nlcmllcz9xelMycUlOSTZJTSZsaXN0PVBMX2pYbGloOGRna1J1NWRkR1hBR3FaNHVMTGtvSnpDajgmaW5kZXg9MiJdLAogICAgICBjaGF0X3dpZGdldDogewogICAgICAgIGxvZ286ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgICBzdHlsZTogIiIKICAgICAgfSwKICAgICAgc2VsZWN0ZWRfZGF0ZTogIiIsCiAgICAgIHNlbGVjdGVkX3RpbWU6ICIiLAogICAgICByZWFzb25fb2ZfdmlzaXQ6ICIiLAogICAgICBwYXRpZW50X25hbWU6ICIiLAogICAgICB2aXNpdG9yX251bWJlcjogIiIsCiAgICAgIGZ1bGxfdGltZV9zbG90czogW10sCiAgICAgIHRpbWVfc2xvdHM6IFtdLAogICAgICBUT0RBWV9EQVRFOiAiIiwKICAgICAgY2hhbm5lbDogbnVsbCwKICAgICAgY2hhdF9zb2NrZXQ6IG51bGwsCiAgICAgIHZvaWNlX3NvY2tldDogbnVsbCwKICAgICAgbGl2ZV9jaGF0X29uOiBmYWxzZSwKICAgICAgbGl2ZV9jaGF0X3Rva2VuOiBudWxsLAogICAgICBjaGF0X2dyb3VwX25hbWU6IG51bGwsCiAgICAgIHRvX3Njcm9sbDogZmFsc2UsCiAgICAgIGZvcm1fcGF5bG9hZDogbnVsbCwKICAgICAgcmVmcmVzaF90aW1lOiAwLAogICAgICBwaG9uZV9udW1iZXJfdmFsaWRpdHk6IC9bMC05XXsxMCwxMX0kLywKICAgICAgZW1wdHlfc3RyaW5nX3ZhbGlkaXR5OiAvXiQvLAogICAgICAvL2hhcnNoCiAgICAgIGlzZXhjaGFuZ2U6IGZhbHNlLAogICAgICBjdXJyZW5jeWV4Y2hhbmdlX2xpc3Q6IG51bGwsCiAgICAgIHNlbGVjdGVkX2luZGljYXRpb246IFtdLAogICAgICByZXM6IHt9LAogICAgICBpc2Nsb3NlZGJvdG9uOiBmYWxzZSwKICAgICAgaXNmb3Jtb246IGZhbHNlLAogICAgICBmb3JtX25hbWU6IG51bGwsCiAgICAgIGxhc3RjbG9zZWRib3RpbnB1dG5vZGU6IG51bGwsCiAgICAgIGNsb3NlZF9mb3JtX3JlcGx5X2RhdGE6IG51bGwsCiAgICAgIHNlbGVjdGVkbm9kZWlkOiBudWxsLAogICAgICBib3RfbmFtZTogbnVsbCwKICAgICAgYm90X3R5cGU6IG51bGwsCiAgICAgIGlmZmlyc3R0aW1lOiB0cnVlLAogICAgICBpc2VtYWlsOiBmYWxzZSwKICAgICAgaXNfcGhvbmVfbnVtYmVyOiBmYWxzZSwKICAgICAgaXNfdGV4dF9hcmVhOiBmYWxzZSwKICAgICAgY29udmVyc2F0aW9uX2lkOiAiIiwKICAgICAgaXNfcGhvbmVfbnVtYmVyX290cDogZmFsc2UsCiAgICAgIG5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXI6IG51bGwsCiAgICAgIGlzX3Bob25lX251bWJlcl9lcnJfbXNnOiBmYWxzZQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuY29udmVyc2F0aW9uX2lkID0gdGhpcy5nZW5lcmF0ZVVVSUQoKTsKICAgIHRoaXMuJHNlc3Npb24uc3RhcnQoKTsKICAgIHRoaXMuJHNlc3Npb24uc2V0KCJjb252ZXJzYXRpb25faWQiLCB0aGlzLmNvbnZlcnNhdGlvbl9pZCk7IC8vIGNvbnNvbGUubG9nKGNvdW50cnlfY29kZSk7CiAgICAvLyBjb25zb2xlLmxvZyhKU09OLnBhcnNlKGNvdW50cnlfY29kZSkpOwoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIikpIHsvLyB0aGlzLmNoYXQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIik7CiAgICB9CgogICAgaWYgKCF0aGlzLiRzZXNzaW9uLmhhcygiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIpKSB7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBpc1Nob3c6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LnRpdGxlID0gcmVzcG9uc2UuZGF0YS5XaWRnZXRUaXRsZTsKICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5sb2dvID0gcmVzcG9uc2UuZGF0YS5JbWFnZVVybDsKCiAgICAgICAgX3RoaXMuJHNlc3Npb24uc2V0KCJDaGF0Qm90SW1hZ2VQYXJhbWV0ZXJzIiwgX3RoaXMuY2hhdF93aWRnZXQpOwoKICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6YXV0byI7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKF90aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lID09ICJnb2d5YiIpIHsKICAgICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LnN0eWxlID0gIm1hcmdpbi10b3A6IDVweDtoZWlnaHQ6MzBweDt3aWR0aDo2MHB4IjsKICAgICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LmxvZ28gPSAiL2ltZy9jZW5zZV9pbWFnZS5wbmciOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUgPT0gIk1UIENhcmUiKSB7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5sb2dvID0gIi9pbWcvcm9ib21hdGVfbG9nby5wbmciOwogICAgICAgICAgX3RoaXMuY2hhdF93aWRnZXQuc3R5bGUgPSAibWFyZ2luLXRvcDogNXB4O2hlaWdodDo1MHB4O3dpZHRoOjk1cHgiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpcy5jaGF0X3dpZGdldC5sb2dvID0gIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIjsKICAgICAgICAgIF90aGlzLmNoYXRfd2lkZ2V0LnN0eWxlID0gIm1hcmdpbi10b3A6IDVweDtoZWlnaHQ6MzBweDt3aWR0aDo2MHB4IjsKICAgICAgICB9CgogICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIsIF90aGlzLmNoYXRfd2lkZ2V0KTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNoYXRfd2lkZ2V0ID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNoYXRCb3RJbWFnZVBhcmFtZXRlcnMiKTsKICAgICAgdGhpcy5jaGF0X3dpZGdldC5zdHlsZSA9ICJtYXJnaW4tdG9wOiA1cHg7aGVpZ2h0OjMwcHg7d2lkdGg6YXV0byI7CiAgICB9CgogICAgaWYgKCF0aGlzLiRzZXNzaW9uLmhhcygiUmVzcG9uc2VCb3RUb2tlbiIpKSB7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmJvdF9yZXNwb25zZV90b2tlbigpLCB7CiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMuJHNlc3Npb24uc2V0KCJSZXNwb25zZUJvdFRva2VuIiwgcmVzcG9uc2UuZGF0YS5kYXRhKTsKCiAgICAgICAgX3RoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlID0gcmVzcG9uc2UuZGF0YS5kYXRhOwoKICAgICAgICBfdGhpcy5yZWZyZXNoX2NoYXRib3QoKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnJlZnJlc2hfY2hhdGJvdCgpOwogICAgfSAvL2hhcnNoCgoKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkgPT0gIi5lSnhUY3NzdlNzMU16NnRJemtqTVMwODFORGV4TklRS0tVREZNa3BLQ29xdDlQWEx5OHYxMGxCVTZ5WG41LW9sbHVvYkdSaGE2aHFZNnhxWUtCZ2FXQmtaVzVtYTZobWJtNWdZbVNvQkFHYTlIcDAuWFIzVHV3Llg3N0ZfN0xEdE9McDJWdDlzbkZEU28zMW5UdyIpIHsKICAgICAgdGhpcy5pc2V4Y2hhbmdlID0gdHJ1ZTsKICAgIH0KCiAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ib3RfdXNlcl9kYXRhKCksIHsKICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgdHo6IEludGwuRGF0ZVRpbWVGb3JtYXQoKS5yZXNvbHZlZE9wdGlvbnMoKS50aW1lWm9uZSwKICAgICAgZGF0ZXRpbWU6IGQudG9JU09TdHJpbmcoKSwKICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHt9KTsKCiAgICBpZiAodGhpcy4kcm91dGUucGFyYW1zLmJvdGRhdGEgPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAnRGFzaGJvYXJkJwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYm90X25hbWUgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuYm90ZGF0YS5ib3RfbmFtZTsKICAgICAgdGhpcy5ib3RfdHlwZSA9IHRoaXMuJHJvdXRlLnBhcmFtcy5ib3RkYXRhLmJvdF90eXBlOyAvLyBheGlvcwogICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSx7CiAgICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAvLyAgICAgdWlkOiAiY2xvc2VkX2Zvcm1fdXNlciIsCiAgICAgIC8vICAgICBjaGF0OiBudWxsLAogICAgICAvLyAgICAgbm9kZV9zZWxlY3RlZDogbnVsbCwKICAgICAgLy8gICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lLAogICAgICAvLyAgIH0pCiAgICAgIC8vICAgLnRoZW4ocmVzcG9uc2U9PnsKICAgICAgLy8gICAgIGlmKHJlc3BvbnNlLmRhdGEuZXJyb3I9PXVuZGVmaW5lZCl7CiAgICAgIC8vICAgICAgIHRoaXMuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAvLyAgICAgICB0aGlzLmlzY2xvc2VkYm90b249dHJ1ZTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICBDb3VudHJ5Q29kZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICBpZiAoYS5jb2RlIDwgYi5jb2RlKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CgogICAgICBpZiAoYS5jb2RlID4gYi5jb2RlKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfSk7CiAgICB0aGlzLnNob3cgPSBmYWxzZTsKCiAgICBpZiAodGhpcy4kcm91dGUubmFtZSA9PSAiVHJhaW4gdGhlIEJvdCIpIHsKICAgICAgJCgiLmNoYXQtd3JhcCIpLmNzcygicmlnaHQiLCAiYXV0byIpOwogICAgfQoKICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09ICJEaXJlY3QgUmVzcG9uc2UgQm90IikgewogICAgICAkKCIuY2hhdC13cmFwIikuY3NzKCJtYXJnaW5Ub3AiLCAiNSUiKTsKICAgIH0KCiAgICAkKCdbZGF0YS10b2dnbGU9InBvcG92ZXIiXScpLnBvcG92ZXIoewogICAgICBodG1sOiB0cnVlLAogICAgICBjb250ZW50OiAkKCIjcG9wb3Zlcl9jb250ZW50IikKICAgIH0pLm9uKCJzaG93LmJzLnBvcG92ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ibG9jayIpOwogICAgfSkub24oImhpZGUuYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmFkZENsYXNzKCJkLW5vbmUiKTsKICAgIH0pOwogICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmNzcygiekluZGV4IiwgOTk5OSk7CiAgICBidXMuJG9uKCJMb2dvdXQgaGFzIGJlZW4gY2xpY2tlZCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChkYXRhID09ICJUcnVlIikgewogICAgICAgICQoJ1tkYXRhLXRvZ2dsZT0icG9wb3ZlciJdJykucG9wb3ZlcigiaGlkZSIpOwogICAgICB9CiAgICB9KTsKICAgIHdpbmRvdy5TcGVlY2hSZWNvZ25pdGlvbiA9IHdpbmRvdy53ZWJraXRTcGVlY2hSZWNvZ25pdGlvbiB8fCB3aW5kb3cuU3BlZWNoUmVjb2duaXRpb247CiAgICB3aW5kb3cuQXVkaW9Db250ZXh0ID0gd2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0OwogICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgfHwgbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSB8fCBuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhIHx8IG5hdmlnYXRvci5tc0dldFVzZXJNZWRpYTsKICB9LAogIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQoKSB7CiAgICB0aGlzLnN1Ym1pdF9jdXN0b21fZm9ybSgpOwoKICAgIGlmICh0aGlzLmlzY2xvc2VkYm90b24gJiYgdGhpcy5pc2Zvcm1vbikgewogICAgICB0aGlzLnN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhKCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZW5lcmF0ZVVVSUQ6IGZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHsKICAgICAgLy8gUHVibGljIERvbWFpbi9NSVQKICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgLy9UaW1lc3RhbXAKCiAgICAgIHZhciBkMiA9IHBlcmZvcm1hbmNlICYmIHBlcmZvcm1hbmNlLm5vdyAmJiBwZXJmb3JtYW5jZS5ub3coKSAqIDEwMDAgfHwgMDsgLy9UaW1lIGluIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgb3IgMCBpZiB1bnN1cHBvcnRlZAoKICAgICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAxNjsgLy9yYW5kb20gbnVtYmVyIGJldHdlZW4gMCBhbmQgMTYKCiAgICAgICAgaWYgKGQgPiAwKSB7CiAgICAgICAgICAvL1VzZSB0aW1lc3RhbXAgdW50aWwgZGVwbGV0ZWQKICAgICAgICAgIHIgPSAoZCArIHIpICUgMTYgfCAwOwogICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy9Vc2UgbWljcm9zZWNvbmRzIHNpbmNlIHBhZ2UtbG9hZCBpZiBzdXBwb3J0ZWQKICAgICAgICAgIHIgPSAoZDIgKyByKSAlIDE2IHwgMDsKICAgICAgICAgIGQyID0gTWF0aC5mbG9vcihkMiAvIDE2KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAoYyA9PT0gJ3gnID8gciA6IHIgJiAweDMgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgfSk7CiAgICB9LAogICAgdm9pY2VfY29tbXVuaWNhdGlvbjogZnVuY3Rpb24gdm9pY2VfY29tbXVuaWNhdGlvbigpIHsKICAgICAgaWYgKC9DaHJvbWl1bS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICB0aGlzLmNhbGxfY2xvdWRfYXBpKCk7CiAgICAgIH0gZWxzZSBpZiAod2luZG93LlNwZWVjaFJlY29nbml0aW9uICE9IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucmVjb2duaXRpb24gPSBuZXcgd2luZG93LlNwZWVjaFJlY29nbml0aW9uKCk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QuYWRkKCJ2b2ljZS1vbiIpOwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLm9ucmVzdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBzcGVlY2hUb1RleHQgPSBlLnJlc3VsdHNbMF1bMF0udHJhbnNjcmlwdDsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlY29nbml0aW9uLm9uZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QucmVtb3ZlKCJ2b2ljZS1vbiIpOyAvL0FnYWluIOKAkyBnaXZlIHRoZSB1c2VyIGZlZWRiYWNrIHRoYXQgeW91IGFyZSBub3QgbGlzdGVuaW5nIGFueW1vcmUuIElmIHlvdSB3aXNoIHRvIGFjaGlldmUgY29udGludW91cyByZWNvZ25pdGlvbiDigJMgeW91IGNhbiB3cml0ZSBhIHNjcmlwdCB0byBzdGFydCB0aGUgcmVjb2duaXplciBhZ2FpbiBoZXJlLgogICAgICAgIH07CgogICAgICAgIHZhciB2bSA9IHRoaXM7CgogICAgICAgIHRoaXMucmVjb2duaXRpb24ub25yZXN1bHQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnQucmVzdWx0cyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgLy9Tb21ldGhpbmcgaXMgd3JvbmfigKYKICAgICAgICAgICAgdGhpcy5yZWNvZ25pdGlvbi5zdG9wKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpID0gZXZlbnQucmVzdWx0SW5kZXg7IGkgPCBldmVudC5yZXN1bHRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChldmVudC5yZXN1bHRzW2ldLmlzRmluYWwpIHsKICAgICAgICAgICAgICAvL0ZpbmFsIHJlc3VsdHMKICAgICAgICAgICAgICB2bS50b19zZW5kID0gZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJmaW5hbCByZXN1bHRzOiAiICsgZXZlbnQucmVzdWx0c1tpXVswXS50cmFuc2NyaXB0KTsgLy9PZiBjb3Vyc2Ug4oCTIGhlcmUgaXMgdGhlIHBsYWNlIHRvIGRvIHVzZWZ1bCB0aGluZ3Mgd2l0aCB0aGUgcmVzdWx0cy4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvL2kuZS4gaW50ZXJpbS4uLgogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpbnRlcmltIHJlc3VsdHM6ICIgKyBldmVudC5yZXN1bHRzW2ldWzBdLnRyYW5zY3JpcHQpOyAvL1lvdSBjYW4gdXNlIHRoZXNlIHJlc3VsdHMgdG8gZ2l2ZSB0aGUgdXNlciBuZWFyIHJlYWwgdGltZSBleHBlcmllbmNlLgogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vZW5kIGZvciBsb29wCgogICAgICAgIH07CgogICAgICAgIHRoaXMucmVjb2duaXRpb24uc3RhcnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbGxfY2xvdWRfYXBpKCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsX2Nsb3VkX2FwaTogZnVuY3Rpb24gY2FsbF9jbG91ZF9hcGkoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI21pY3JvcGhvbmUiKS5jbGFzc0xpc3QuYWRkKCJ2b2ljZS1vbiIpOwogICAgICB2YXIgYXVkaW9Db250ZXh0ID0gbmV3ICh3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQpKCk7CiAgICAgIHZhciBidWZmZXJfbGlzdCwgYnVmZmVyX2kzMjsKICAgICAgdmFyIHJlY29yZGVyID0gbmV3IFJlY29yZGVyKGF1ZGlvQ29udGV4dCwgewogICAgICAgIC8vIEFuIGFycmF5IG9mIDI1NSBOdW1iZXJzCiAgICAgICAgLy8gWW91IGNhbiB1c2UgdGhpcyB0byB2aXN1YWxpemUgdGhlIGF1ZGlvIHN0cmVhbQogICAgICAgIC8vIElmIHlvdSB1c2UgcmVhY3QsIGNoZWNrIG91dCByZWFjdC13YXZlLXN0cmVhbQogICAgICAgIG9uQW5hbHlzZWQ6IGZ1bmN0aW9uIG9uQW5hbHlzZWQoZGF0YSkge30KICAgICAgfSk7CiAgICAgIHZhciB2b2ljZV9jaGFubmVsLAogICAgICAgICAgd2F2X3BhcmFtZXRlcnMsCiAgICAgICAgICByZWNCdWZmZXJzID0gW10sCiAgICAgICAgICByZWNMZW5ndGgsCiAgICAgICAgICBtZXRhX2RhdGE7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGF4aW9zLmdldChhcGlfY2FsbHMudm9pY2VfY2hhbm5lbF9hcGkoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczIudm9pY2Vfc29ja2V0ID0gbmV3IFNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBjb21wYW55OiBfdGhpczIuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIHZvaWNlX2NoYW5uZWxfbmFtZTogcmVzcG9uc2UuZGF0YS52b2ljZV9jaGFubmVsX25hbWUsCiAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5kYXRhLnRva2VuLAogICAgICAgICAgICBpc192b2ljZTogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBfdGhpczIudm9pY2Vfc29ja2V0LmNvbm5lY3QoKTsKCiAgICAgICAgdm9pY2VfY2hhbm5lbCA9IF90aGlzMi52b2ljZV9zb2NrZXQuY2hhbm5lbCgidm9pY2VfdG9fdGV4dDoiICsgcmVzcG9uc2UuZGF0YS52b2ljZV9jaGFubmVsX25hbWUpOwogICAgICAgIHZvaWNlX2NoYW5uZWwuam9pbigpOwogICAgICB9KTsKICAgICAgdmFyIGJsb2IgPSBudWxsOwogICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgYXVkaW86IHRydWUKICAgICAgfSkudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmVjb3JkZXIuaW5pdChzdHJlYW0pOwogICAgICAgIHN0YXJ0UmVjb3JkaW5nKCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICByZXR1cm4gY29uc29sZS5sb2coIlVoIG9oLi4uIHVuYWJsZSB0byBnZXQgc3RyZWFtLi4uIiwgZXJyKTsKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBzdGFydFJlY29yZGluZygpIHsKICAgICAgICByZWNvcmRlci5zdGFydCgpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgc3RvcFJlY29yZGluZygpOwogICAgICAgIH0sIDQwMDApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzdG9wUmVjb3JkaW5nKCkgewogICAgICAgIHJlY29yZGVyLnN0b3AoKS50aGVuKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICB2YXIgYmxvYiA9IF9yZWYuYmxvYiwKICAgICAgICAgICAgICBidWZmZXIgPSBfcmVmLmJ1ZmZlcjsKICAgICAgICAgIC8vIGJ1ZmZlcl9saXN0ID0gYnVmZmVyWzBdOwogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7CgogICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgYnVmZmVyX2xpc3QgPSByZWFkZXIucmVzdWx0OwogICAgICAgICAgICB2YXIgdGVtcCA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcl9saXN0KTsKICAgICAgICAgICAgd2F2X3BhcmFtZXRlcnMgPSB3YXZfZmlsZV9wcm9jZXNzaW5nX3JlYWRfcGFyYW1ldGVycyh0ZW1wKTsKICAgICAgICAgICAgaW5pdF9lbmNvZGVyKGJ1ZmZlcl9saXN0KTsKICAgICAgICAgIH07IC8vIFJlY29yZGVyLmRvd25sb2FkKGJsb2IsICJteS1maWxlIik7CiAgICAgICAgICAvLyBidWZmZXIgaXMgYW4gQXVkaW9CdWZmZXIKCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGluaXRfZW5jb2RlcihkYXRhKSB7CiAgICAgICAgdmFyIGFycmF5QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgICAgICAgdmFyIGVuY0RhdGEgPSBbXTsKICAgICAgICB2YXIgcmVzdWx0ID0gZW5jb2RlRmxhYyhhcnJheUJ1ZmZlciwgZW5jRGF0YSk7IC8vIGNvbnNvbGUubG9nKCJlbmNvZGVkIGRhdGEgYXJyYXk6ICIsIGVuY0RhdGEpOwoKICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJDb252ZXJzaW9uIGZhaWxlZCEhIik7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWV0YURhdGEgPSByZXN1bHQubWV0YURhdGE7CgogICAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7CiAgICAgICAgICAvL3VzaW5nIGRhdGEtdXRpbC5qcyB1dGlsaXR5IGZ1bmN0aW9uKHMpCiAgICAgICAgICB2YXIgYmxvYl9kb3dubG9hZCA9IGV4cG9ydEZsYWNGaWxlKGVuY0RhdGEsIG1ldGFEYXRhKTsgLy8gdmFyIGRvd25fZmlsZSA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYl9kb3dubG9hZCk7CiAgICAgICAgICAvLyBsZXQgZmlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIC8vIGZpbGUuaHJlZiA9IGRvd25fZmlsZTsKICAgICAgICAgIC8vIGZpbGUuZG93bmxvYWQgPSAib3V0cHV0LmZsYWMiOwogICAgICAgICAgLy8gZmlsZS5jbGljaygpCgogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iX2Rvd25sb2FkKTsKCiAgICAgICAgICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcmVhZGVyX3N0cmluZyA9IHJlYWRlci5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgICAgICAgdm9pY2VfY2hhbm5lbC5wdXNoKCJ2b2ljZV9wYWNrZXRzX3NlbnQiLCB7CiAgICAgICAgICAgICAgc3RyZWFtOiByZWFkZXJfc3RyaW5nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2b2ljZV9jaGFubmVsLm9uKCJ2b2ljZV90b190ZXh0X3JlcGx5IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbWljcm9waG9uZSIpLmNsYXNzTGlzdC5yZW1vdmUoInZvaWNlLW9uIik7CgogICAgICAgICAgICAgIGlmIChkYXRhLnRleHQucmVzdWx0cyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZtLnRvX3NlbmQgPSBkYXRhLnRleHQucmVzdWx0c1swXS5hbHRlcm5hdGl2ZXNbMF0udHJhbnNjcmlwdDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJXZSBjb3VsZCBub3QgcmVjb2duaXplIHlvdXIgdm9pY2UuIFBsZWFzZSB0cnkgYWdhaW4gb3IgdHlwZSBpbi4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZtLmJ1dHRvbl9maWxsKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGVuY29kZUZsYWMoYmluRGF0YSwgcmVjQnVmZmVycykgewogICAgICAgIHZhciB1aThfZGF0YSA9IG5ldyBVaW50OEFycmF5KGJpbkRhdGEpOwogICAgICAgIHZhciBzYW1wbGVfcmF0ZSA9IDAsCiAgICAgICAgICAgIGNoYW5uZWxzID0gMCwKICAgICAgICAgICAgYnBzID0gMCwKICAgICAgICAgICAgdG90YWxfc2FtcGxlcyA9IDAsCiAgICAgICAgICAgIGJsb2NrX2FsaWduLAogICAgICAgICAgICBwb3NpdGlvbiA9IDAsCiAgICAgICAgICAgIHJlY0xlbmd0aCA9IDAsCiAgICAgICAgICAgIG1ldGFfZGF0YTsKICAgICAgICAvKioKICAgICAgICAgKiAgcmVjb3Jkcy9zYXZlcyB0aGUgb3V0cHV0IGRhdGEgb2YgbGliZmxhYy1lbmNvZGUgbWV0aG9kCiAgICAgICAgICovCgogICAgICAgIGZ1bmN0aW9uIHdyaXRlX2NhbGxiYWNrX2ZuKGJ1ZmZlciwgYnl0ZXMsIHNhbXBsZXMsIGN1cnJlbnRfZnJhbWUpIHsKICAgICAgICAgIHJlY0J1ZmZlcnMucHVzaChidWZmZXIpOwogICAgICAgICAgcmVjTGVuZ3RoICs9IGJ5dGVzOyAvLyByZWNMZW5ndGggKz0gYnVmZmVyLmJ5dGVMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtZXRhZGF0YV9jYWxsYmFja19mbihkYXRhKSB7CiAgICAgICAgICBtZXRhX2RhdGEgPSBkYXRhOwogICAgICAgIH0gLy8gY2hlY2s6IGlzIGZpbGUgYSBjb21wYXRpYmxlIHdhdi1maWxlPwoKCiAgICAgICAgaWYgKHdhdl9maWxlX3Byb2Nlc3NpbmdfY2hlY2tfd2F2X2Zvcm1hdCh1aThfZGF0YSkgPT0gZmFsc2UpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVycm9yOiAiV3JvbmcgV0FWIGZpbGUgZm9ybWF0IiwKICAgICAgICAgICAgc3RhdHVzOiAwCiAgICAgICAgICB9OwogICAgICAgIH0gLy8gZ2V0IFdBVi9QQ00gcGFyYW1ldGVycyBmcm9tIGRhdGEgLyBmaWxlCgoKICAgICAgICB2YXIgd2F2X3BhcmFtZXRlcnMgPSB3YXZfZmlsZV9wcm9jZXNzaW5nX3JlYWRfcGFyYW1ldGVycyh1aThfZGF0YSk7CiAgICAgICAgdmFyIHRvdF9zYW1wbGVzID0gMDsKICAgICAgICB2YXIgY29tcHJlc3Npb25fbGV2ZWwgPSA1OwogICAgICAgIHZhciBmbGFjX29rID0gMTsKICAgICAgICB2YXIgaXNfdmVyaWZ5ID0gdHJ1ZTsKICAgICAgICB2YXIgZmxhY19lbmNvZGVyID0gRmxhYy5jcmVhdGVfbGliZmxhY19lbmNvZGVyKHdhdl9wYXJhbWV0ZXJzLnNhbXBsZV9yYXRlLCB3YXZfcGFyYW1ldGVycy5jaGFubmVscywgd2F2X3BhcmFtZXRlcnMuYnBzLCBjb21wcmVzc2lvbl9sZXZlbCwgdG90X3NhbXBsZXMsIGlzX3ZlcmlmeSk7CgogICAgICAgIGlmIChmbGFjX2VuY29kZXIgIT0gMCkgewogICAgICAgICAgdmFyIGluaXRfc3RhdHVzID0gRmxhYy5pbml0X2VuY29kZXJfc3RyZWFtKGZsYWNfZW5jb2Rlciwgd3JpdGVfY2FsbGJhY2tfZm4sIG1ldGFkYXRhX2NhbGxiYWNrX2ZuLCAwKTsKICAgICAgICAgIGZsYWNfb2sgJj0gaW5pdF9zdGF0dXMgPT0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIG1zZyA9ICJFcnJvciBpbml0aWFsaXppbmcgdGhlIGRlY29kZXIuIjsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVycm9yOiBtc2csCiAgICAgICAgICAgIHN0YXR1czogMQogICAgICAgICAgfTsKICAgICAgICB9IC8vIGNvbnZlcnQgdGhlIFBDTS1EYXRhIHRvIHRoZSBhcHByb3ByaWF0ZSBmb3JtYXQgZm9yIHRoZSBsaWJmbGFjIGxpYnJhcnkgbWV0aG9kcyAoMzItYml0IGFycmF5IG9mIHNhbXBsZXMpCiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBhcnJheSAoMzItYml0KSBhbmQgc3RvcmVzIHRoZSAxNi1iaXQgZGF0YSBvZiB0aGUgd2F2LWZpbGUgYXMgMzItYml0IGRhdGEKCgogICAgICAgIHZhciBidWZmZXJfaTMyID0gd2F2X2ZpbGVfcHJvY2Vzc2luZ19jb252ZXJ0XzE2Yml0ZGF0YV90bzMyYml0ZGF0YSh1aThfZGF0YS5idWZmZXIpOwogICAgICAgIHZhciBmbGFjX3JldHVybiA9IEZsYWMuRkxBQ19fc3RyZWFtX2VuY29kZXJfcHJvY2Vzc19pbnRlcmxlYXZlZChmbGFjX2VuY29kZXIsIGJ1ZmZlcl9pMzIsIGJ1ZmZlcl9pMzIubGVuZ3RoIC8gd2F2X3BhcmFtZXRlcnMuY2hhbm5lbHMpOwoKICAgICAgICBpZiAoZmxhY19yZXR1cm4gIT0gdHJ1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coIkVycm9yOiBGTEFDX19zdHJlYW1fZW5jb2Rlcl9wcm9jZXNzX2ludGVybGVhdmVkIHJldHVybmVkIGZhbHNlLiAiICsgZmxhY19yZXR1cm4pOwogICAgICAgIH0KCiAgICAgICAgZmxhY19vayAmPSBGbGFjLkZMQUNfX3N0cmVhbV9lbmNvZGVyX2ZpbmlzaChmbGFjX2VuY29kZXIpOwogICAgICAgIEZsYWMuRkxBQ19fc3RyZWFtX2VuY29kZXJfZGVsZXRlKGZsYWNfZW5jb2Rlcik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG1ldGFEYXRhOiBtZXRhX2RhdGEsCiAgICAgICAgICBzdGF0dXM6IGZsYWNfb2sKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiB3YXZfZmlsZV9wcm9jZXNzaW5nX2NoZWNrX3dhdl9mb3JtYXQodWk4X2RhdGEpIHsKICAgICAgICAvLyBjaGVjazogaXMgZmlsZSBhIGNvbXBhdGlibGUgd2F2LWZpbGU/CiAgICAgICAgaWYgKHVpOF9kYXRhLmxlbmd0aCA8IDQ0IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgdWk4X2RhdGEuc3ViYXJyYXkoMCwgNCkpICE9ICJSSUZGIiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDgsIDE2KSkgIT0gIldBVkVmbXQgIiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDM2LCA0MCkpICE9ICJkYXRhIikgewogICAgICAgICAgY29uc29sZS5sb2coIkVSUk9SOiB3cm9uZyBmb3JtYXQgZm9yIHdhdi1maWxlLiIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqICBjaGVja3MgaWYgdGhlIGdpdmVuIHVpOF9kYXRhICh1aThhcnJheSkgaXMgb2YgYSBmbGFjLWZpbGUKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gZmxhY19maWxlX3Byb2Nlc3NpbmdfY2hlY2tfZmxhY19mb3JtYXQodWk4X2RhdGEpIHsKICAgICAgICAvLyBjaGVjazogaXMgZmlsZSBhIGNvbXBhdGlibGUgZmxhYy1maWxlPwogICAgICAgIGlmICh1aThfZGF0YS5sZW5ndGggPCA0MiB8fCBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHVpOF9kYXRhLnN1YmFycmF5KDAsIDQpKSAhPSAiZkxhQyIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFUlJPUjogd3JvbmcgZm9ybWF0IGZvciBmbGFjLWZpbGUuIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyh1aThfZGF0YS5idWZmZXIpOyAvL2NoZWNrIGxhc3QgNyBiaXRzIG9mIDR0aCBieXRlIGZvciBtZXRhLWRhdGEgQkxPQ0sgdHlwZTogbXVzdCBiZSBTVFJFQU1JTkZPICgwKQoKICAgICAgICBpZiAoKHZpZXcuZ2V0VWludDgoNCkgJiAweDdmKSAhPSAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRVJST1I6IHdyb25nIGZvcm1hdCBmb3IgZmxhYy1maWxlLiIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdhdl9maWxlX3Byb2Nlc3NpbmdfcmVhZF9wYXJhbWV0ZXJzKHVpOF9kYXRhKSB7CiAgICAgICAgdmFyIHNhbXBsZV9yYXRlID0gMCwKICAgICAgICAgICAgY2hhbm5lbHMgPSAwLAogICAgICAgICAgICBicHMgPSAwLAogICAgICAgICAgICB0b3RhbF9zYW1wbGVzID0gMCwKICAgICAgICAgICAgYmxvY2tfYWxpZ247IC8vIGdldCBXQVYvUENNIHBhcmFtZXRlcnMgZnJvbSBkYXRhIC8gZmlsZQoKICAgICAgICBzYW1wbGVfcmF0ZSA9ICgodWk4X2RhdGFbMjddIDw8IDggfCB1aThfZGF0YVsyNl0pIDw8IDggfCB1aThfZGF0YVsyNV0pIDw8IDggfCB1aThfZGF0YVsyNF07CiAgICAgICAgY2hhbm5lbHMgPSB1aThfZGF0YVsyMl07CiAgICAgICAgYnBzID0gdWk4X2RhdGFbMzRdOwogICAgICAgIGJsb2NrX2FsaWduID0gdWk4X2RhdGFbMzJdOwogICAgICAgIHRvdGFsX3NhbXBsZXMgPSAoKCh1aThfZGF0YVs0M10gPDwgOCB8IHVpOF9kYXRhWzQyXSkgPDwgOCB8IHVpOF9kYXRhWzQxXSkgPDwgOCB8IHVpOF9kYXRhWzQwXSkgLyBibG9ja19hbGlnbjsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2FtcGxlX3JhdGU6IHNhbXBsZV9yYXRlLAogICAgICAgICAgY2hhbm5lbHM6IGNoYW5uZWxzLAogICAgICAgICAgYnBzOiBicHMsCiAgICAgICAgICB0b3RhbF9zYW1wbGVzOiB0b3RhbF9zYW1wbGVzLAogICAgICAgICAgYmxvY2tfYWxpZ246IGJsb2NrX2FsaWduCiAgICAgICAgfTsKICAgICAgfQogICAgICAvKioKICAgICAgICogIGNvbnZlcnRzIHRoZSBQQ00gZGF0YSBvZiB0aGUgd2F2IGZpbGUgKGVhY2ggc2FtcGxlIHN0b3JlZCBhcyAxNiBiaXQgdmFsdWUpIGludG8KICAgICAgICogIGEgZm9ybWF0IGV4cGVjdGVkIGJ5IHRoZSBsaWJmbGFjLWVuY29kZXIgbWV0aG9kIChlYWNoIHNhbXBsZSBzdG9yZWQgYXMgMzIgYml0IHZhbHVlIGluIGEgMzItYml0IGFycmF5KQogICAgICAgKi8KCgogICAgICBmdW5jdGlvbiB3YXZfZmlsZV9wcm9jZXNzaW5nX2NvbnZlcnRfMTZiaXRkYXRhX3RvMzJiaXRkYXRhKGFycmF5YnVmZmVyKSB7CiAgICAgICAgLy8gY29udmVydCB0aGUgUENNLURhdGEgdG8gdGhlIGFwcHJvcHJpYXRlIGZvcm1hdCBmb3IgdGhlIGxpYmZsYWMgbGlicmFyeSBtZXRob2RzICgzMi1iaXQgYXJyYXkgb2Ygc2FtcGxlcykKICAgICAgICAvLyBjcmVhdGVzIGEgbmV3IGFycmF5ICgzMi1iaXQpIGFuZCBzdG9yZXMgdGhlIDE2LWJpdCBkYXRhIG9mIHRoZSB3YXYtZmlsZSBhcyAzMi1iaXQgZGF0YQogICAgICAgIHZhciBhYl9pMTYgPSBuZXcgRGF0YVZpZXcoYXJyYXlidWZmZXIsIDQ0KTsKICAgICAgICB2YXIgYnVmX2xlbmd0aCA9IGFiX2kxNi5ieXRlTGVuZ3RoOwogICAgICAgIHZhciBidWYzMl9sZW5ndGggPSBidWZfbGVuZ3RoIC8gMjsKICAgICAgICB2YXIgYnVmZmVyX2kzMiA9IG5ldyBVaW50MzJBcnJheShidWYzMl9sZW5ndGgpOwogICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcl9pMzIuYnVmZmVyKTsKICAgICAgICB2YXIgaW5kZXggPSAwOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGJ1Zl9sZW5ndGg7IGogKz0gMikgewogICAgICAgICAgdmlldy5zZXRJbnQzMihpbmRleCwgYWJfaTE2LmdldEludDE2KGosIHRydWUpLCB0cnVlKTsKICAgICAgICAgIGluZGV4ICs9IDQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnVmZmVyX2kzMjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwb3J0RmxhY0ZpbGUocmVjQnVmZmVycywgbWV0YURhdGEpIHsKICAgICAgICB2YXIgcmVjTGVuZ3RoID0gZ2V0TGVuZ3RoKHJlY0J1ZmZlcnMpOwoKICAgICAgICBpZiAobWV0YURhdGEpIHsKICAgICAgICAgIGFkZEZMQUNNZXRhRGF0YShyZWNCdWZmZXJzLCBtZXRhRGF0YSk7CiAgICAgICAgfSAvL2NvbnZlcnQgYnVmZmVycyBpbnRvIG9uZSBzaW5nbGUgYnVmZmVyCgoKICAgICAgICB2YXIgc2FtcGxlcyA9IG1lcmdlQnVmZmVycyhyZWNCdWZmZXJzLCByZWNMZW5ndGgpOwogICAgICAgIHZhciB0aGVfYmxvYiA9IG5ldyBCbG9iKFtzYW1wbGVzXSk7CiAgICAgICAgcmV0dXJuIHRoZV9ibG9iOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRMZW5ndGgocmVjQnVmZmVycykgewogICAgICAgIC8vZ2V0IGxlbmd0aAogICAgICAgIHZhciByZWNMZW5ndGggPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gcmVjQnVmZmVycy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgcmVjTGVuZ3RoICs9IHJlY0J1ZmZlcnNbaV0uYnl0ZUxlbmd0aDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZWNMZW5ndGg7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZEZMQUNNZXRhRGF0YShjaHVua3MsIG1ldGFkYXRhKSB7CiAgICAgICAgdmFyIG9mZnNldCA9IDQ7CiAgICAgICAgdmFyIGRhdGEgPSBjaHVua3NbMF07IC8vMXN0IGRhdGEgY2h1bmsgc2hvdWxkIGNvbnRhaW4gRkxBQyBpZGVudGlmaWVyICJmTGFDIgoKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPCA0IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZGF0YS5zdWJhcnJheSgwLCA0KSkgIT0gImZMYUMiKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJVbmtub3duIGRhdGEgZm9ybWF0OiBjYW5ub3QgYWRkIGFkZGl0aW9uYWwgRkxBQyBtZXRhIGRhdGEgdG8gaGVhZGVyIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvL2ZpcnN0IGNodW5rIG9ubHkgY29udGFpbnMgdGhlIGZsYWMgaWRlbnRpZmllciBzdHJpbmc/CgoKICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT0gNCkgewogICAgICAgICAgZGF0YSA9IGNodW5rc1sxXTsgLy9nZXQgMm5kIGRhdGEgY2h1bmsgd2hpY2ggc2hvdWxkIGNvbnRhaW4gU1RSRUFNSU5GTyBtZXRhLWRhdGEgYmxvY2sgKGFuZCBwcm9iYWJseSBtb3JlKQoKICAgICAgICAgIG9mZnNldCA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhkYXRhLmJ1ZmZlcik7IC8vTk9URSBieSBkZWZhdWx0LCB0aGUgZW5jb2RlciB3cml0ZXMgYSAybmQgbWV0YS1kYXRhIGJsb2NrICh0eXBlIFZPUkJJU19DT01NRU5UKSB3aXRoIGVuY29kZXIvdmVyc2lvbiBpbmZvIC0+IGRvIG5vdCBzZXQgImlzIGxhc3QiIHRvIFRSVUUgZm9yIGZpcnN0IG9uZQogICAgICAgIC8vCS8vIHdyaXRlICJpcyBsYXN0IG1ldGEgZGF0YSBibG9jayIgJiB0eXBlIFNUUkVBTUlORk8gdHlwZSAoMCkgYXMgbGl0dGxlIGVuZGlhbiBjb21iaW5lZCB1aW50MSAmIHVpbnQ3IC0+IHVpbnQ4OgogICAgICAgIC8vCXZhciBpc0xhc3QgPSAxOy8vMSBiaXQKICAgICAgICAvLwl2YXIgc3RyZWFtSW5mb1R5cGUgPSAwOy8vNyBiaXQKICAgICAgICAvLwl2aWV3LnNldFVpbnQ4KDAgKyBvZmZzZXQsIGlzTGFzdCA8PCA3IHwgc3RyZWFtSW5mb1R5cGUsIHRydWUpOy8vOCBiaXQKICAgICAgICAvLyBibG9jay1oZWFkZXI6IFNUUkVBTUlORk8gdHlwZSwgYmxvY2sgbGVuZ3RoIC0+IGFscmVhZHkgc2V0CiAgICAgICAgLy8gYmxvY2stY29udGVudDogbWluX2Jsb2Nrc2l6ZSwgbWluX2Jsb2Nrc2l6ZSAtPiBhbHJlYWR5IHNldAogICAgICAgIC8vIHdyaXRlIG1pbl9mcmFtZXNpemUgYXMgbGl0dGxlIGVuZGlhbiB1aW50MjQ6CgogICAgICAgIHZpZXcuc2V0VWludDgoOCArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSA+PiAxNiwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoOSArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSA+PiA4LCB0cnVlKTsgLy8yNCBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgxMCArIG9mZnNldCwgbWV0YWRhdGEubWluX2ZyYW1lc2l6ZSwgdHJ1ZSk7IC8vMjQgYml0CiAgICAgICAgLy8gd3JpdGUgbWF4X2ZyYW1lc2l6ZSBhcyBsaXR0bGUgZW5kaWFuIHVpbnQyNDoKCiAgICAgICAgdmlldy5zZXRVaW50OCgxMSArIG9mZnNldCwgbWV0YWRhdGEubWF4X2ZyYW1lc2l6ZSA+PiAxNiwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMTIgKyBvZmZzZXQsIG1ldGFkYXRhLm1heF9mcmFtZXNpemUgPj4gOCwgdHJ1ZSk7IC8vMjQgYml0CgogICAgICAgIHZpZXcuc2V0VWludDgoMTMgKyBvZmZzZXQsIG1ldGFkYXRhLm1heF9mcmFtZXNpemUsIHRydWUpOyAvLzI0IGJpdAogICAgICAgIC8vIGJsb2NrLWNvbnRlbnQ6IHNhbXBsZVJhdGUsIGNoYW5uZWxzLCBiaXRzUGVyU2FtcGxlIC0+IGFscmVhZHkgc2V0CiAgICAgICAgLy8gd3JpdGUgdG90YWxfc2FtcGxlcyBhcyBsaXR0bGUgZW5kaWFuIHVpbnQzNjoKICAgICAgICAvL1RPRE8gc2V0IGxhc3QgNCBiaXRzIHRvIGhhbGYgb2YgdGhlIHZhbHVlIGluIGluZGV4IDE3CgogICAgICAgIHZpZXcuc2V0VWludDgoMTggKyBvZmZzZXQsIG1ldGFkYXRhLnRvdGFsX3NhbXBsZXMgPj4gMjQsIHRydWUpOyAvLzM2IGJpdAoKICAgICAgICB2aWV3LnNldFVpbnQ4KDE5ICsgb2Zmc2V0LCBtZXRhZGF0YS50b3RhbF9zYW1wbGVzID4+IDE2LCB0cnVlKTsgLy8zNiBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgyMCArIG9mZnNldCwgbWV0YWRhdGEudG90YWxfc2FtcGxlcyA+PiA4LCB0cnVlKTsgLy8zNiBiaXQKCiAgICAgICAgdmlldy5zZXRVaW50OCgyMSwgbWV0YWRhdGEudG90YWxfc2FtcGxlcywgdHJ1ZSk7IC8vMzYgYml0CgogICAgICAgIHdyaXRlTWQ1KHZpZXcsIDIyICsgb2Zmc2V0LCBtZXRhZGF0YS5tZDVzdW0pOyAvLzE2ICogOCBiaXQKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbWVyZ2VCdWZmZXJzKGNoYW5uZWxCdWZmZXIsIHJlY29yZGluZ0xlbmd0aCkgewogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVWludDhBcnJheShyZWNvcmRpbmdMZW5ndGgpOwogICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgIHZhciBsbmcgPSBjaGFubmVsQnVmZmVyLmxlbmd0aDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsbmc7IGkrKykgewogICAgICAgICAgdmFyIGJ1ZmZlciA9IGNoYW5uZWxCdWZmZXJbaV07CiAgICAgICAgICByZXN1bHQuc2V0KGJ1ZmZlciwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSBidWZmZXIubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gd3JpdGVNZDUodmlldywgb2Zmc2V0LCBzdHIpIHsKICAgICAgICB2YXIgaW5kZXg7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aCAvIDI7ICsraSkgewogICAgICAgICAgaW5kZXggPSBpICogMjsKICAgICAgICAgIHZpZXcuc2V0VWludDgoaSArIG9mZnNldCwgcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhpbmRleCwgaW5kZXggKyAyKSwgMTYpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdGFydF92aWRlb19jYWxsOiBmdW5jdGlvbiBzdGFydF92aWRlb19jYWxsKCkge30sCiAgICByZWZyZXNoX2NoYXRib3Q6IGZ1bmN0aW9uIHJlZnJlc2hfY2hhdGJvdCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsgLy8gZGVidWdnZXI7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgY2hhdDogIiIsCiAgICAgICAgZGF0YTogIiIsCiAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgcmVmcmVzaGVkX29yX2Nsb3NlZDogdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICBfdGhpczMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXMzLmlmZmlyc3R0aW1lKSB7CiAgICAgICAgICBfdGhpczMuaWZmaXJzdHRpbWUgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHVpZDogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IG51bGwsCiAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IG51bGwsCiAgICAgICAgICAgIGJvdF9uYW1lOiBfdGhpczMuYm90X25hbWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogX3RoaXMzLmNvbnZlcnNhdGlvbl9pZAogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmVycm9yID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdnYXlhJyk7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgICAgICAgICAgICBfdGhpczMuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICAgICAgICBfdGhpczMuaXNjbG9zZWRib3RvbiA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09ICJzdXBwb3J0IikgewogICAgICAgICAgX3RoaXMzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICJJcyB0aGVyZSBhbnl0aGluZyBlbHNlIEkgY2FuIGhlbHAgeW91IHdpdGg/IiwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IF90aGlzMy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzMy5jb21wYW55aWQgPT0gIkN1c3RvbWVySGFwcGluZXNzOTUxODUiIHx8IF90aGlzMy5jb21wYW55aWQgPT0gIjN4NWl2ZTk5NTM0IiB8fCBfdGhpczMuY29tcGFueWlkID09ICJGb3JlaWdueGNoYW5nZTE3NDkxIiB8fCBfdGhpczMuY29tcGFueWlkID09ICJjbGluaWNhbHRyaWFsczgxMzUyIikgewogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICAgIGNoYXQ6ICIvd2VsY29tZV9tZXNzYWdlIiwKICAgICAgICAgICAgdG9rZW46IF90aGlzMy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgIHVzZXJuYW1lOiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgICAgdXNlcl9pZDogIiIsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICAgIHJvbGU6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczMucHVzaF9tc2cocmVzcG9uc2UsIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMucHJvbXB0X3VybCgpLCB7CiAgICAgICAgICB1aWQ6ICJjZW5zZSIsCiAgICAgICAgICAvL3RoaXMuZmluZ2VycHJpbnQKICAgICAgICAgIGNvbXBhbnlfaWQ6IF90aGlzMy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBsaWNlbnNlX2tleTogX3RoaXMzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICBjaGF0OiAiIgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSAiTk8gQ0xPU0VEIEZPUk0gQk9UIikgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5leHRyYXMgIT0gbnVsbCAmJiByZXNwb25zZS5kYXRhLmV4dHJhc1swXS5UeXBlID09ICJUQUJMRSIpIHsKICAgICAgICAgICAgICBfdGhpczMuY3JlYXRlX2NoYXQocmVzcG9uc2UuZGF0YSwgImlzdGFibGUiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJldHVybiA9PSAiUFJPTVBUUyIpIHsKICAgICAgICAgICAgICBfdGhpczMuY3JlYXRlX2NoYXQocmVzcG9uc2UuZGF0YSwgImlzcHJvbXB0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkge30pOwogICAgICB9KTsKICAgIH0sCiAgICBkb3dubG9hZF9wZGY6IGZ1bmN0aW9uIGRvd25sb2FkX3BkZih1cmwsIGZpbGVfbmFtZSkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBmaWxlX25hbWUpOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICBsaW5rLmNsaWNrKCk7CiAgICB9LAogICAgc2Nyb2xsX2RpdjogZnVuY3Rpb24gc2Nyb2xsX2RpdigpIHsKICAgICAgdmFyIGRvYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5idXktcHJvZHVjdHMiKTsKCiAgICAgIGlmIChldmVudC5kZWx0YVggPiBldmVudC5kZWx0YVkpIHsKICAgICAgICBkb2Muc2Nyb2xsTGVmdCArPSAxMDsKICAgICAgfSBlbHNlIGlmIChldmVudC5kZWx0YVggPCBldmVudC5kZWx0YVkpIHsKICAgICAgICBkb2Muc2Nyb2xsTGVmdCAtPSAxMDsKICAgICAgfQogICAgfSwKICAgIGNhbGxfc3VwcG9ydDogZnVuY3Rpb24gY2FsbF9zdXBwb3J0KHR5cGUpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodHlwZSA9PSAiWWVzIikgewogICAgICAgIHZhciBfYXhpb3MkcG9zdDsKCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3QgPSB7CiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICBjaGF0OiAiL2NhbGxfc3VwcG9ydCIKICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QsICJ0b2tlbiIsIHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAicm9sZSIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0LCAicmVmcmVzaGVkX29yX2Nsb3NlZCIsIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCksIF9heGlvcyRwb3N0KSkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgICAgX3RoaXM0LmNoYXQucHVzaCh7CiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLnRleHQsCiAgICAgICAgICAgIHRpbWU6IF90aGlzNC5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzNC4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzNC5jaGF0KTsKCiAgICAgICAgICBfdGhpczQudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJObyIpIHsKICAgICAgICB0aGlzLmNoYXQucHVzaCh0aGlzLmNoYXRbMF0pOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHRoaXMuY2hhdFsxXSk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOyAvLyB0aGlzLnJlZnJlc2hfY2hhdGJvdCgic3VwcG9ydCIpOwogICAgICB9CiAgICB9LAogICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKHN0cmluZykgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgve3suKj99fS9nLCBmdW5jdGlvbiAobWF0Y2gpIHsKICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOwogICAgICAgIHZhciBkZCA9IHRvZGF5LmdldERhdGUoKTsKICAgICAgICB2YXIgbW0gPSB0b2RheS5nZXRNb250aCgpICsgMTsKICAgICAgICB2YXIgeXl5eSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7CgogICAgICAgIGlmIChkZCA8IDEwKSB7CiAgICAgICAgICBkZCA9ICIwIiArIGRkOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1tIDwgMTApIHsKICAgICAgICAgIG1tID0gIjAiICsgbW07CiAgICAgICAgfQoKICAgICAgICB0b2RheSA9IGRkICsgIi0iICsgbW0gKyAiLSIgKyB5eXl5OwogICAgICAgIHZhciBleHByZXNzaW9uID0gbWF0Y2guc2xpY2UoMiwgLTIpOwogICAgICAgIF90aGlzNS4kZGF0YVtleHByZXNzaW9uXSA9IHRvZGF5OwogICAgICAgIHJldHVybiBfdGhpczUuJGRhdGFbZXhwcmVzc2lvbl07CiAgICAgIH0pOwogICAgfSwKICAgIGdlbmVyYXRlX3RpbWU6IGZ1bmN0aW9uIGdlbmVyYXRlX3RpbWUoKSB7CiAgICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgICAgdmFyIGgsIG0sIHR5cGU7CgogICAgICBpZiAoZC5nZXRIb3VycygpID4gMTIpIHsKICAgICAgICBoID0gZC5nZXRIb3VycygpICUgMTI7CiAgICAgICAgdHlwZSA9ICIgcG0iOwogICAgICB9IGVsc2UgaWYgKGQuZ2V0SG91cnMoKSA8IDEyKSB7CiAgICAgICAgaCA9IGQuZ2V0SG91cnMoKTsKICAgICAgICB0eXBlID0gIiBhbSI7CiAgICAgIH0gZWxzZSBpZiAoZC5nZXRIb3VycygpID09IDEyKSB7CiAgICAgICAgaCA9IGQuZ2V0SG91cnMoKTsKICAgICAgICB0eXBlID0gIiBwbSI7CiAgICAgIH0KCiAgICAgIG0gPSBkLmdldE1pbnV0ZXMoKTsKCiAgICAgIGlmIChtIDwgMTApIHsKICAgICAgICBtID0gMCArIFN0cmluZyhtKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGggKyAiOiIgKyBtICsgdHlwZTsKICAgIH0sCiAgICBjYWxsX2FwaTogZnVuY3Rpb24gY2FsbF9hcGkoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5waG9uZV9udW1iZXJfdmFsaWRpdHkudGVzdCh0aGlzLnBob25lX251bWJlcikpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jYWxsX3N1cHBvcnRfdXJsKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgcGhvbmVudW1iZXI6IHRoaXMucGhvbmVfbnVtYmVyLAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJDYWxsIGluY29taW5nISIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIldlIHdpbGwgZ2V0IGluIHRvdWNoIHdpdGggeW91IHNvb24uIFRoYW5rcyIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIEVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyIik7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X3BvcHVwOiBmdW5jdGlvbiBzaG93X3BvcHVwKCkgewogICAgICB0aGlzLnNob3cgPSBmYWxzZTsKICAgICAgdGhpcy5zdG9wID0gZmFsc2U7CiAgICB9LAogICAgc3ViX2xlYWZfbm9kZV9jYWxsOiBmdW5jdGlvbiBzdWJfbGVhZl9ub2RlX2NhbGwodHlwZSkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBkaXZjbGljayA9IGV2ZW50LnRhcmdldC5pbm5lclRleHQ7CgogICAgICBpZiAoZGl2Y2xpY2sgPT0gIldhdGNoIERlbW8gVmlkZW8iKSB7CiAgICAgICAgdGhpcy5kZW1vdXJsYmluZCA9IHRydWU7CiAgICAgICAgdGhpcy5yZXZpZXdzdXJsYmluZCA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKGRpdmNsaWNrID09ICJVc2VyIFJldmlld3MvVGVzdGltb25pYWxzIikgewogICAgICAgIHRoaXMucmV2aWV3c3VybGJpbmQgPSB0cnVlOwogICAgICAgIHRoaXMuZGVtb3VybGJpbmQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKGRpdmNsaWNrID09ICJXYXRjaCBEZW1vIFZpZGVvIiB8fCBkaXZjbGljayA9PSAiVXNlciBSZXZpZXdzL1Rlc3RpbW9uaWFscyIpIHsKICAgICAgICB0aGlzLnNob3cgPSAhdGhpcy5zaG93OwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0sIDEwMDApOwogICAgICB9IGVsc2UgaWYgKGRpdmNsaWNrID09ICJCdXkgVHV0b3JpYWwiKSB7CiAgICAgICAgdGhpcy5jZW5zZV9lbnF1aXJ5ID0gdHJ1ZTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICBjaGF0OiAiL3BlcnNvbmFsX2RldGFpbHMiLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6ICIiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1swXS50ZXh0LAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICB0aW1lOiBfdGhpczYuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzNi5jaGF0LnB1c2gobXNnKTsKCiAgICAgICAgICBfdGhpczYudXBkYXRlX3Njcm9sbGJhcigpOwoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9LCAxMDAwKTsKCiAgICAgICAgICBfdGhpczYuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczYuY2hhdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB0aWNrZXRfbnVtYmVyOiBmdW5jdGlvbiB0aWNrZXRfbnVtYmVyKCkgewogICAgICB2YXIgcmFuZG9tX251bSA9IE1hdGguZmxvb3IoMTAwMDAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwMDAwKTsKICAgICAgdmFyIGNvbXBhbnkgPSB0aGlzLmNvbXBhbnluYW1lLnNsaWNlKDAsIDEpLnRvVXBwZXJDYXNlKCk7CiAgICAgIHJldHVybiBjb21wYW55ICsgIl8iICsgcmFuZG9tX251bTsKICAgIH0sCiAgICBzZW5kX21lc3NhZ2U6IGZ1bmN0aW9uIHNlbmRfbWVzc2FnZSh0eXBlLCBtZXNzYWdlLCB0b19iZV9kaXNwbGF5ZWQpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAvL2hhcnNoCiAgICAgIC8vIGRlYnVnZ2VyOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICB0eXBlID0gImlzX3Byb21wdCI7CiAgICAgICAgdG9fYmVfZGlzcGxheWVkID0gdGhpcy50b19zZW5kOwogICAgICAgIHRoaXMudG9fc2VuZCA9IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvblswXS52YWx1ZS5zcGxpdCgieyIpWzBdICsgSlNPTi5zdHJpbmdpZnkodGhpcy5yZXMpOwogICAgICAgIHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbiA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc2Nsb3NlZGJvdG9uICYmIHR5cGUgIT0gJ2lzX2J1dHRvbicpIHsKICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgIHRoaXMuc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEoKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJpc19idXR0b24iKSB7CiAgICAgICAgJCgiI3Jlc3BvbnNlX2JvdF90ZXh0IikucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CgogICAgICAgIGlmIChtZXNzYWdlLnZhbHVlID09ICJpc2Rpc2FibGVkIiAmJiB0aGlzLmNvbXBhbnlpZCA9PSAiY2xpbmljYWx0cmlhbHM4MTM1MiIgJiYgbWVzc2FnZS50aXRsZSA9PSAiTm8iKSB7fSBlbHNlIGlmICh0aGlzLmlzY2xvc2VkYm90b24pIHsKICAgICAgICAgIHRoaXMuc3VibWl0X2Nsb3NlZF9mb3JtX2RhdGEodHlwZSwgbWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBpbmRleCA9IHRvX2JlX2Rpc3BsYXllZDsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHNlbnQ6IG1lc3NhZ2UudGl0bGUsCiAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICBkcm9wZG93bjogIiIKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgICAgICBjaGF0OiBtZXNzYWdlLnZhbHVlLAogICAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgICAgICByZWZyZXNoZWRfb3JfY2xvc2VkOiB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChfdGhpczcuY2hhdFtpbmRleF0ucmVtb3ZhYmxlID09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczcuY2hhdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczcucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gImlzX3Byb21wdCIpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IHRvX2JlX2Rpc3BsYXllZCwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgZGVsaXZlcmVkOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgIC8vIGhvc3Q6IHRoaXMudXNlcl9kYXRhLmhvc3QsCiAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIGNoYXQ6IHRoaXMudG9fc2VuZAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwoKICAgICAgICAgIF90aGlzNy5leDEoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgPT0gIlJlc3RhcnQiIHx8IHRoaXMudG9fc2VuZCA9PSAicmVzdGFydCIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wcm9tcHRfdXJsKCksIHsKICAgICAgICAgIHVpZDogImNlbnNlIiwKICAgICAgICAgIC8vdGhpcy5maW5nZXJwcmludAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgY2hhdDogIiIKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM3LmNoYXQucHVzaChyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgICBfdGhpczcudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKCiAgICAgICAgICBfdGhpczcuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCBfdGhpczcuY2hhdCk7CgogICAgICAgICAgX3RoaXM3LmZpcnN0X2NsaWNrID0gdHJ1ZTsKICAgICAgICAgIF90aGlzNy5sZXZlbCA9IHJlc3BvbnNlLmRhdGEubGV2ZWw7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHt9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNlbnNlX2VucXVpcnkgPT0gdHJ1ZSAmJiB0aGlzLnRvX3NlbmQgIT0gIiIgJiYgdGhpcy50b19zZW5kICE9IG51bGwgJiYgIS9eXHMqJC8udGVzdCh0aGlzLnRvX3NlbmQpKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICB2YXIgc2VuZF9tc2cgPSB7CiAgICAgICAgICBzZW50OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICAgIH07CiAgICAgICAgdGhpcy5jaGF0LnB1c2goc2VuZF9tc2cpOwogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIHsKICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICBjaGF0OiAiL3BlcnNvbmFsX2RldGFpbHMiLAogICAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICAgIHVzZXJfaWQ6ICIiLAogICAgICAgICAgY29tcGFueV9pZDogIkNPMDAwMjMiLAogICAgICAgICAgZGF0YTogIiIsCiAgICAgICAgICByb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6ICIiLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbMF0udGV4dCwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogX3RoaXM3LmdlbmVyYXRlX3RpbWUoKQogICAgICAgICAgfTsKCiAgICAgICAgICBfdGhpczcuY2hhdC5wdXNoKG1zZyk7CgogICAgICAgICAgX3RoaXM3LiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXM3LmNoYXQpOwoKICAgICAgICAgIF90aGlzNy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM3LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmxpdmVfY2hhdF9vbikgewogICAgICAgIGlmICh0aGlzLnVzZXJfbmFtZSA9PSAiIikgewogICAgICAgICAgdGhpcy5jaGFubmVsLnB1c2goIm5ld19uYW1lIiwgewogICAgICAgICAgICBuYW1lOiB0aGlzLnRvX3NlbmQKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy51c2VyX25hbWUgPSB0aGlzLnRvX3NlbmQ7CiAgICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJuZXdfY2hhdF9tZXNzYWdlIiwgewogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLnRvX3NlbmQKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgc2VudDogdGhpcy50b19zZW5kLAogICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCkKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInNlbmRlciIpOwogICAgICB9IGVsc2UgaWYgKHRoaXMudG9fc2VuZCAhPSAiIiAmJiB0aGlzLnRvX3NlbmQgIT0gbnVsbCAmJiB0aGlzLmNlbnNlX2VucXVpcnkgIT0gdHJ1ZSkgewogICAgICAgIHZhciBfYXhpb3MkcG9zdDI7CgogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJzZW5kZXIiKTsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIChfYXhpb3MkcG9zdDIgPSB7CiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQKICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAidG9rZW4iLCB0aGlzLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDIsICJyb2xlIiwgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QyLCAicmVmcmVzaGVkX29yX2Nsb3NlZCIsIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCksIF9heGlvcyRwb3N0MikpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczcucmVzcG9uc2VfaGFuZGxpbmcocmVzcG9uc2UpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczcudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy50b19zZW5kID0gIiI7CiAgICAgIHRoaXMuYnV0dG9uX2ZpbGwoKTsKICAgIH0sCiAgICBpbml0aWF0ZV9zdXBwb3J0X2NoYXQ6IGZ1bmN0aW9uIGluaXRpYXRlX3N1cHBvcnRfY2hhdCgpIHsKICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogIlNvcnJ5IEkgYW0gbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbiIsCiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6ICJXb3VsZCB5b3UgbGlrZSB0byB0YWxrIHdpdGggc3VwcG9ydCB0ZWFtPyIsCiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgc2hvd19idXR0b25zOiB0cnVlLAogICAgICAgIHN1cHBvcnRfYnV0dG9uczogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9KTsKICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgfSwKICAgIGRpc2Nvbm5lY3Rfc3VwcG9ydF9jaGF0OiBmdW5jdGlvbiBkaXNjb25uZWN0X3N1cHBvcnRfY2hhdCgpIHsKICAgICAgdGhpcy5jaGFubmVsLnB1c2goInN0b3BwZWRfY2hhdCIsIHsKICAgICAgICBuYW1lOiB0aGlzLnVzZXJfbmFtZSwKICAgICAgICBtZXNzYWdlOiAiIGhhcyBlbmRlZCB0aGUgY29udmVyc2F0aW9uLiIKICAgICAgfSk7CiAgICAgIHRoaXMuY2hhbm5lbC5sZWF2ZSgpOwogICAgICB0aGlzLmNoYXRfc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgdGhpcy5saXZlX2NoYXRfb24gPSBmYWxzZTsKICAgIH0sCiAgICBjaGF0X3Jlc3BvbnNlX2Vycm9yOiBmdW5jdGlvbiBjaGF0X3Jlc3BvbnNlX2Vycm9yKCkgewogICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiAiU29ycnkgSSdtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iLAogICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgIH0pOwogICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgfSwKICAgIHNlbmRfcmVxdWVzdF9qc29uOiBmdW5jdGlvbiBzZW5kX3JlcXVlc3RfanNvbihtZXNzYWdlKSB7CiAgICAgIHZhciBfYXhpb3MkcG9zdDMsCiAgICAgICAgICBfdGhpczggPSB0aGlzOwoKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCAoX2F4aW9zJHBvc3QzID0gewogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgInRva2VuIiwgdGhpcy5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QzLCAicm9sZSIsIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgInJlZnJlc2hlZF9vcl9jbG9zZWQiLCB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3QzLCAiY2hhdCIsICIiKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgInNvdXJjZSIsICJXZWIiKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0MywgImRhdGEiLCB0aGlzLmpzb25fZGF0YVttZXNzYWdlLnJlc3BvbnNlc1swXS5pbnRlbnRdKSwgX2F4aW9zJHBvc3QzKSkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIF90aGlzOC5jaGF0LnB1c2goewogICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICByZWNlaXZlZDogcmVzcC5kYXRhLnJlc3BvbnNlcy5sZW5ndGggPT0gMCA/ICJTb3JyeSBJJ20gbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbiIgOiByZXNwLmRhdGEucmVzcG9uc2VzWzBdLnRleHQsCiAgICAgICAgICB0aW1lOiBfdGhpczguZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgaW1hZ2U6IHJlc3AuZGF0YS5yZXNwb25zZXNbMF0uaW1nID09ICIiID8gbnVsbCA6IHJlc3AuZGF0YS5yZXNwb25zZXNbMF0uaW1nCiAgICAgICAgfSk7CgogICAgICAgIF90aGlzOC4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzOC5jaGF0KTsKCiAgICAgICAgX3RoaXM4LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3BvbnNlX2hhbmRsaW5nOiBmdW5jdGlvbiByZXNwb25zZV9oYW5kbGluZyhyZXNwb25zZSwgdHlwZSkgewogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciBkZWxheSA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBoYW5kbGVfcmVzcG9uc2UoKTsKICAgICAgfSwgZGVsYXkpOwoKICAgICAgZnVuY3Rpb24gaGFuZGxlX3Jlc3BvbnNlKCkgewogICAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSBudWxsIHx8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHZtLmNoYXRfcmVzcG9uc2VfZXJyb3IoKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmVxdWVzdF9qc29uICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5yZXF1ZXN0X2pzb24gPT0gdHJ1ZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQsCiAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgICBpbWFnZTogcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW1nLAogICAgICAgICAgICAgICAgdmlkZW86IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnZpZGVvCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdm0uJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB2bS5jaGF0KTsKICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ID09ICJnb2d5YjQ1MF9jcmVhdGVfdGlja2V0IikgewogICAgICAgICAgICAgIHZhciBfYXhpb3MkcG9zdDQ7CgogICAgICAgICAgICAgIHZhciBuYW1lOwoKICAgICAgICAgICAgICBpZiAodm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG5hbWUgPSB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmZpcnN0X25hbWUgKyAiICIgKyB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxhc3RfbmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZtLiRzZXNzaW9uLmhhcygiVXNlckZpcnN0TmFtZSIpKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gdm0uJHNlc3Npb24uZ2V0KCJVc2VyRmlyc3ROYW1lIikgKyAiICIgKyB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJMYXN0TmFtZSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICB1c2VybmFtZTogbmFtZSwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdm0uY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB2bS5jb21wYW55aWQsCiAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgICAgICAgIGVtYWlsOiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICB0aWNrZXRfaXNzdWU6ICIiLAogICAgICAgICAgICAgICAgdGlja2V0X251bWJlcjogdm0udGlja2V0X251bWJlcigpLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICIiLAogICAgICAgICAgICAgICAgZmlsZV9jb250ZW50OiBudWxsLAogICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBudWxsLAogICAgICAgICAgICAgICAgaXNFZGl0OiBmYWxzZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpOwogICAgICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgKF9heGlvcyRwb3N0NCA9IHsKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHZtLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgICAgICAgfSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgInRva2VuIiwgdm0uYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgInJvbGUiLCB2bS4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAicmVmcmVzaGVkX29yX2Nsb3NlZCIsIHZtLnJlZnJlc2hlZF9vcl9jbG9zZWQpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q0LCAiY2hhdCIsICIiKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgInNvdXJjZSIsICJXZWIiKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NCwgImRhdGEiLCBwYXlsb2FkKSwgX2F4aW9zJHBvc3Q0KSkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlc3AuZGF0YS5yZXNwb25zZXMubGVuZ3RoID09IDAgPyAiU29ycnkgSSdtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iIDogcmVzcC5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LAogICAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgICAgIGltYWdlOiByZXNwLmRhdGEucmVzcG9uc2VzW2ldLmltZywKICAgICAgICAgICAgICAgICAgdmlkZW86IHJlc3AuZGF0YS5yZXNwb25zZXNbaV0udmlkZW8gIT0gbnVsbCA/IHJlc3AuZGF0YS5yZXNwb25zZXNbaV0udmlkZW8gOiBudWxsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZtLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdm0uY2hhdCk7CiAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmludGVudCA9PSAiY3JlYXRlX2FwcG9pbnRtZW50IikgewogICAgICAgICAgICAgIHZhciB0b2RheV9kYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9hcHBvaW50bWVudF91cmwoKSwgewogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB2bS5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHZtLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIERhdGU6IHRvZGF5X2RhdGUuZ2V0RnVsbFllYXIoKSArICItIiArICh0b2RheV9kYXRlLmdldE1vbnRoKCkgPCA5ID8gIjAiICsgKHRvZGF5X2RhdGUuZ2V0TW9udGgoKSArIDEpIDogdG9kYXlfZGF0ZS5nZXRNb250aCgpICsgMSkgKyAiLSIgKyB0b2RheV9kYXRlLmdldERhdGUoKSAvL01vbnRoIG9iamVjdCBkb2N1bWVudCBpdAogICAgICAgICAgICAgICAgLy8gRGF0ZTogc3RhcnRfdGltZSwKCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsvLyB0aGlzLnRpbWVfc2xvdHMgPSB0aGlzLmZ1bGxfdGltZV9zbG90czsKICAgICAgICAgICAgICAgIC8vIGlmIChyZXNwb25zZS5kYXRhLlNsb3QgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAvLyAgIGlmIChyZXNwb25zZS5kYXRhLlNsb3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgLy8gICAgIGxldCBpbmRleDsKICAgICAgICAgICAgICAgIC8vICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuU2xvdCkgewogICAgICAgICAgICAgICAgLy8gICAgICAgaW5kZXggPSB0aGlzLnRpbWVfc2xvdHMuaW5kZXhPZihyZXNwb25zZS5kYXRhLlNsb3RbaV0pOwogICAgICAgICAgICAgICAgLy8gICAgICAgaWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHRoaXMudGltZV9zbG90cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgLy8gICAgICAgfQogICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7Ly8gY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdm0uc2VuZF9yZXF1ZXN0X2pzb24ocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmV0dXJuX2ludGVudCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucmV0dXJuX2ludGVudCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBfYXhpb3MkcG9zdDU7CgogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGF0Ym90X3Jlc3BvbnNlX2NlbnNlKCksIChfYXhpb3MkcG9zdDUgPSB7CiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHZtLmJvdF9yZXNwb25zZV90b2tlbl92YWx1ZSwKICAgICAgICAgICAgICB1c2VybmFtZTogdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAidG9rZW4iLCB2bS5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUpLCBfZGVmaW5lUHJvcGVydHkoX2F4aW9zJHBvc3Q1LCAicm9sZSIsIHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDUsICJyZWZyZXNoZWRfb3JfY2xvc2VkIiwgdm0ucmVmcmVzaGVkX29yX2Nsb3NlZCksIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDUsICJjaGF0IiwgIi8iICsgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50KSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NSwgInNvdXJjZSIsICJXZWIiKSwgX2F4aW9zJHBvc3Q1KSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICB2bS5oYW5kbGVfcmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodm0uY29tcGFueWlkID09ICIzeDVpdmU5OTUzNCIgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uaW50ZW50ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbnRlbnQgPT0gImNvbmZ1c2lvbiIpIHsKICAgICAgICAgICAgdm0uY29uZnVzaW9uX21lc3NhZ2UoIi9uZWVkX2hlbHAiKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uYnV0dG9ucyAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdm0ubG9hZF9idXR0b25zKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLCBpKTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvL0NIYW5nZSAgdGhlIGNvbmRpdGlvbiBoZXJlCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5jdXN0b20udHlwZSAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0uY3VzdG9tLnR5cGUgPT0gIm11bHRpc2VsZWN0X2Ryb3Bkb3duIikgewogICAgICAgICAgICAgIHZtLm11bHRpc2VsZWN0X2xvYWQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0sIGkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmN1c3RvbS50eXBlICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5jdXN0b20udHlwZSA9PSAidGFibGUiKSB7CiAgICAgICAgICAgICAgdm0ubG9hZF90YWJsZShyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXSwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy90aGlzIG9uZSBmb3IgZm9yZWlnbnhjaGFuZ2UKICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LnRvTG93ZXJDYXNlKCkgPT0gInNvcnJ5IGkgYW0gbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbiIgfHwgcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC50b0xvd2VyQ2FzZSgpID09ICJpcyB0aGVyZSBhbnl0aGluZyBpIGNhbiBoZWxwIHlvdSB3aXRoPyIpKSB7CiAgICAgICAgICAgICAgaWYgKHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXkgPT0gIi5lSnhUY3NzdlNzMU16NnRJemtqTVMwODFORGV4TklRS0tVREZNa3BLQ29xdDlQWEx5OHYxMGxCVTZ5WG41LW9sbHVvYkdSaGE2aHFZNnhxWUtCZ2FXQmtaVzVtYTZobWJtNWdZbVNvQkFHYTlIcDAuWFIzVHV3Llg3N0ZfN0xEdE9McDJWdDlzbkZEU28zMW5UdyIgfHwgdm0uJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSA9PSAiLmVKeFRjaTR0THNuUFRTM3lTQ3dveU14TExTNjJORFcwTUlXSktzQ0ZNMHBLQ29xdDlQWEx5OHYxa2pPS0VfVVNVX1dOREF3dGRRM01kUTJORkF3TnJZREl4RnpQeE1UUzB0SklDUUJqWnh1eC5YU2hxOHcuUGdvNWNtS3dNUUZuWVVzc2Nwb2p3RXFEWFF3IikgewogICAgICAgICAgICAgICAgdm0uaW5pdGlhdGVfc3VwcG9ydF9jaGF0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJTb3JyeSBJIGFtIG5vdCBnZXR0aW5nIHlvdXIgcXVlc3Rpb24iLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogdm0uZ2VuZXJhdGVfdGltZSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWU6IGkgPT0gcmVzcG9uc2UuZGF0YS5yZXNwb25zZXMubGVuZ3RoIC0gMSA/IHZtLmdlbmVyYXRlX3RpbWUoKSA6IG51bGwKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9ICJTb3JyeSB3ZSBhcmUgbm90IGdldHRpbmcgeW91ciBxdWVzdGlvbi4iOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmluZyA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0LmluY2x1ZGVzKCIucGRmIikpIHsKICAgICAgICAgICAgICAgIHZtLmRpc3BsYXlfcGRmX2NoYXQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS50ZXh0ICE9IHVuZGVmaW5lZCAmJiAhcmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dC5pbmNsdWRlcygiRG93bmxvYWQgeW91ciBtYW5pZmVzdCBoZXJlIikpIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZlZCA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQ7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2aW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1zZy5pbWFnZSA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLmltZzsKICAgICAgICAgICAgICAgIG1zZy52aWRlb3MgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbyA9PSBudWxsID8gW10gOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS52aWRlbzsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaChtc2cpOwoKICAgICAgICAgICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdm0udG9fc2Nyb2xsID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPiAwLjUgJiYgJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC42KSB7CiAgICAgICAgICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogMC45ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDAuNzUgKiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSAtICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIHZtLnRvX3Njcm9sbCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlc1tpXS5pbnRlbnQgPT0gImNoYXRfc3VwcG9ydCIpIHsKICAgICAgICAgICAgICAgIG1zZy5yZWNlaXZpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gIkkgYW0gY29ubmVjdGluZyB5b3UgdG8gb25lIG9mIG91ciBzdXBwb3J0IGFnZW50cy4gUGxlYXNlIHdhaXQgZm9yIGEgd2hpbGUuIjsKICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgICB2bS5jaGF0LnB1c2gobXNnKTsKICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJXaGF0J3MgeW91ciBuYW1lPyIsCiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdm0udXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICAgICAgICAgIGF4aW9zLmdldChhcGlfY2FsbHMuY2hhdF9ncm91cF9hcGkoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgdm0uY2hhdF9ncm91cF9uYW1lID0gcmVzcG9uc2UuZGF0YS5jaGF0X2dyb3VwX25hbWU7CiAgICAgICAgICAgICAgICAgIHZtLmxpdmVfY2hhdF90b2tlbiA9IHJlc3BvbnNlLmRhdGEudG9rZW47CiAgICAgICAgICAgICAgICAgIHZtLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHZtLmNoYXRfc29ja2V0ID0gbmV3IFNvY2tldChwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbnk6IHZtLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgY2hhdF9ncm91cF9uYW1lOiB2bS5jaGF0X2dyb3VwX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogdm0ubGl2ZV9jaGF0X3Rva2VuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhdF9zb2NrZXQuY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsID0gdm0uY2hhdF9zb2NrZXQuY2hhbm5lbCgiY3VzdG9tZXJzX2dyb3VwczoiICsgdm0uY2hhdF9ncm91cF9uYW1lKTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5qb2luKCk7CiAgICAgICAgICAgICAgICAgIHZtLmNoYW5uZWwucHVzaCgiY3VzdG9tZXJfbmVlZHNfc3VwcG9ydF9hZ2VudCIpOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsLm9uKCJuZXdfY2hhdF9tZXNzYWdlIiwgZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc2VuZGVyICE9ICJjdXN0b21lciIpIHsKICAgICAgICAgICAgICAgICAgICAgIHZtLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6IHJlcy5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiB2bS5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB2bS5jaGFubmVsLm9uKCJzdG9wcGVkX2NoYXQiLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICJTdXBwb3J0IGFnZW50ICIgKyByZXMubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IF90aGlzOS5nZW5lcmF0ZV90aW1lKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB2bS5saXZlX2NoYXRfb24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigic3RhcnRlZF90eXBpbmciLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uaXNfdHlwaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdm0uY2hhbm5lbC5vbigic3RvcHBlZF90eXBpbmciLCBmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICAgICAgdm0uaXNfdHlwaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0udGV4dCAhPSB1bmRlZmluZWQgJiYgKHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQuaW5jbHVkZXMoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSIpIHx8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQuaW5jbHVkZXMoLy5wZGYvKSkpIHsKICAgICAgICAgICAgICAgIHZtLmRpc3BsYXlfcGRmX2NoYXQocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXNwb25zZXNbaV0ucHJvZHVjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdm0uZGlzcGxheV9wcm9kdWN0c19jaGF0KHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSA8IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgaSArPSAxOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICBkZWxheSA9IHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2VzW2ldLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICAgICAgICBoYW5kbGVfcmVzcG9uc2UoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBkZWxheSk7CiAgICAgIH0KICAgIH0sCiAgICBwdXNoX21zZzogZnVuY3Rpb24gcHVzaF9tc2cocmVzcG9uc2VzLCByZXNwb25zZSkgewogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2YXIgZGVsYXkgPSByZXNwb25zZVtpbmRleF0udGV4dC5sZW5ndGggPiAxMCA/IDIwMDAgOiA1MDA7CiAgICAgIHB1c2hfY2hhdChyZXNwb25zZVtpbmRleF0sIGRlbGF5KTsKICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKCiAgICAgIGZ1bmN0aW9uIHB1c2hfY2hhdChtc2csIHRpbWVfZGVsYXkpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgICAgICAgIGlmIChyZXNwb25zZXMuZGF0YS5yZXNwb25zZXNbaW5kZXhdLmJ1dHRvbnMgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZtLmxvYWRfYnV0dG9ucyhyZXNwb25zZXMuZGF0YS5yZXNwb25zZXNbaW5kZXhdLCAiaXNfYnV0dG9uIiwgIndlbGNvbWVfbWVzc2FnZSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0uY2hhdC5wdXNoKHsKICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgcmVjZWl2ZWQ6IG1zZy50ZXh0LAogICAgICAgICAgICAgIHRpbWU6IGluZGV4ID09IHJlc3BvbnNlLmxlbmd0aCAtIDEgPyB2bS5nZW5lcmF0ZV90aW1lKCkgOiB1bmRlZmluZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiLnRpbWUiKS5sYXN0KCkuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCIudGltZSIpLmxhc3QoKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsKCiAgICAgICAgICAgIGlmIChpbmRleCA8IHJlc3BvbnNlLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICBpbmRleCArPSAxOwogICAgICAgICAgICAgIGRlbGF5ID0gcmVzcG9uc2VbaW5kZXhdLnRleHQubGVuZ3RoID4gMTAgPyAyMDAwIDogNTAwOwogICAgICAgICAgICAgIHB1c2hfY2hhdChyZXNwb25zZVtpbmRleF0sIGRlbGF5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMScpOwogICAgICAgICAgICAgIHZtLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9LCB0aW1lX2RlbGF5KTsKICAgICAgfQogICAgfSwKICAgIGNvbmZ1c2lvbl9tZXNzYWdlOiBmdW5jdGlvbiBjb25mdXNpb25fbWVzc2FnZShtc2dfc3RyaW5nKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoYXRib3RfcmVzcG9uc2VfY2Vuc2UoKSwgewogICAgICAgIGNoYXQ6IG1zZ19zdHJpbmcsCiAgICAgICAgdG9rZW46IHRoaXMuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgc291cmNlOiAiV2ViIiwKICAgICAgICB1c2VyX2lkOiAiIiwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIGRhdGE6ICIiLAogICAgICAgIHJvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICAgIHJlZnJlc2hlZF9vcl9jbG9zZWQ6IGZhbHNlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMC5yZXNwb25zZV9oYW5kbGluZyhyZXNwb25zZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpeF9hcHBvaW50bWVudDogZnVuY3Rpb24gZml4X2FwcG9pbnRtZW50KCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfSwKICAgIGRpc3BsYXlfcHJvZHVjdHNfY2hhdDogZnVuY3Rpb24gZGlzcGxheV9wcm9kdWN0c19jaGF0KG1lc3NhZ2UpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwogICAgICBtc2cuaXNwcm9kdWN0ID0gdHJ1ZTsKICAgICAgbXNnLmVsZW1lbnRzID0gbWVzc2FnZTsKICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgIH0sCiAgICBkaXNwbGF5X3BkZl9jaGF0OiBmdW5jdGlvbiBkaXNwbGF5X3BkZl9jaGF0KG1lc3NhZ2UpIHsKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwoKICAgICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoIkRvd25sb2FkIHlvdXIgbWFuaWZlc3QgaGVyZSAiKSkgewogICAgICAgIHZhciB0ZW1wID0gbWVzc2FnZS5zcGxpdCgiRG93bmxvYWQgeW91ciBtYW5pZmVzdCBoZXJlICIpOwogICAgICAgIG1zZy51cmwgPSB0ZW1wWzFdOwogICAgICAgIG1zZy5yZWNlaXZpbmcgPSBmYWxzZTsKICAgICAgICBtc2cuZmlsZV9uYW1lID0gbWVzc2FnZS5zcGxpdCgvXi4qW1xcXC9dLylbMV07CiAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgdGhpcy5jaGF0KTsKICAgICAgICB0aGlzLnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHVybCA9IG1lc3NhZ2UubWF0Y2goLygoKFtBLVphLXpdezMsOX06KD86XC9cLyk/KSg/OltcLTs6Jj1cK1wkLFx3XStAKT9bQS1aYS16MC05XC5cLV0rfCg/Ond3d1wufFtcLTs6Jj1cK1wkLFx3XStAKVtBLVphLXowLTlcLlwtXSspKCg/OlwvW1wrfiVcL1wuXHdcLV9dKik/XD8/KD86W1wtXCs9JjslQFwuXHdfXSopIz8oPzpbXC5cIVwvXFxcd10qKSk/KS9nKVswXTsKICAgICAgICBtc2cudXJsID0gdXJsOwogICAgICAgIG1zZy5yZWNlaXZpbmcgPSBmYWxzZTsKICAgICAgICBtc2cuZmlsZV9uYW1lID0gdXJsLnNwbGl0KC9eLipbXFxcL10vKVsxXTsKICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJCb3RSZXNwb25zZV9Db252ZXJzYXRpb24iLCB0aGlzLmNoYXQpOwogICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlX3BheW1lbnQ6IGZ1bmN0aW9uIGdlbmVyYXRlX3BheW1lbnQocHJpY2UsIG5hbWUpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgIGFtb3VudDogcHJpY2UgKiAxMDAsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgY3VycmVuY3k6ICJJTlIiLAogICAgICAgIGRlc2NyaXB0aW9uOiAiSW5zdGlsbCBJbnRlbGxpZ2VuY2UiLAogICAgICAgIGltYWdlOiAiL2ltZy9jZW5zZV9pbWFnZS5wbmciLAogICAgICAgIC8vIENPTVBBTlkgTE9HTwogICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIocmVzcG9uc2UpIHsKICAgICAgICAgIHZhciBjb250YWN0ID0gJCgnI2NvbnRhY3RbdHlwZT0idGVsIl0nKS52YWx1ZTsKICAgICAgICAgIHZhciBlbWFpbCA9ICQoJyNlbWFpbFt0eXBlPSJlbWFpbCJdJykudmFsdWU7CiAgICAgICAgICB2bS5wYXltZW50aWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwoKICAgICAgICAgIGlmICh0cmFuc2Zlcl9hY2NvdW50ICE9IG51bGwpIHsKICAgICAgICAgICAgdm0udHJhbnNmZXJfcGF5bWVudCh0cmFuc2Zlcl9hY2NvdW50LCBwcmljZSAqIDEwMCwgIklOUiIsIG5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcHJlZmlsbDogewogICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAvLyBwYXNzIGN1c3RvbWVyIG5hbWUKICAgICAgICAgIGVtYWlsOiAiIiwKICAgICAgICAgIC8vIGN1c3RvbWVyIGVtYWlsCiAgICAgICAgICBjb250YWN0OiAiIiAvL2N1c3RvbWVyIHBob25lIG5vLgoKICAgICAgICB9LAogICAgICAgIG5vdGVzOiB7CiAgICAgICAgICBhZGRyZXNzOiAiYWRkcmVzcyIgLy9jdXN0b21lciBhZGRyZXNzCgogICAgICAgIH0sCiAgICAgICAgdGhlbWU6IHsKICAgICAgICAgIGNvbG9yOiAiIzI4Mzc3NyIgLy8gc2NyZWVuIGNvbG9yCgogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHJ6cDEgPSBuZXcgUmF6b3JwYXkob3B0aW9ucyk7CiAgICAgIHJ6cDEub3BlbigpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfSwKICAgIHRyYW5zZmVyX3BheW1lbnQ6IGZ1bmN0aW9uIHRyYW5zZmVyX3BheW1lbnQoYWNjb3VudCwgYW1vdW50LCBjdXJyZW5jeSwgbmFtZSkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KCJodHRwczovL2FwaS5yYXpvcnBheS5jb20vMS90cmFuc2ZlcnMiLCB7CiAgICAgICAgYXV0aDogewogICAgICAgICAgcnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQ6ICJsbHhFS2JnQUJIOEx4NFhBcGV4OWNHemoiCiAgICAgICAgfSwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3kKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gaWYodGhpcy51c2VyX2RhdGEuYXBpX2tleSE9JycpIHsKICAgICAgICBfdGhpczExLnNob3BpZnlfb3JkZXJfY3JlYXRlKG5hbWUpOyAvLyB9CgogICAgICB9KTsKICAgIH0sCiAgICBzaG9waWZ5X29yZGVyX2NyZWF0ZTogZnVuY3Rpb24gc2hvcGlmeV9vcmRlcl9jcmVhdGUobmFtZSkge30sCiAgICBjbGlja19wcm9tcHQ6IGZ1bmN0aW9uIGNsaWNrX3Byb21wdCh0eXBlKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHRoaXMubGl2ZV9jaGF0X29uID0gZmFsc2U7CiAgICAgIHZhciBkaXZjbGlja3BvcHVwID0gZXZlbnQudGFyZ2V0LmlubmVyVGV4dDsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICB9LCA1MDApOwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgaWYgKHR5cGUgIT0gImNvbGxhcHNpYmxlIikgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnByb21wdF91cmwoKSwgewogICAgICAgICAgdWlkOiAiY2Vuc2UiLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgY2hhdDogZXZlbnQudGFyZ2V0LmlubmVyVGV4dCwKICAgICAgICAgIGxldmVsOiBldmVudC50YXJnZXQuYXR0cmlidXRlcy52YWx1ZS5ub2RlVmFsdWUKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29sbGFwc2libGUgPT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczEyLmNyZWF0ZV9jaGF0KHJlc3BvbnNlLmRhdGEsICJpc3Byb21wdCIpOwoKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLmV4dHJhcyAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5leHRyYXNbMF0uVHlwZSA9PSAiVEFCTEUiKSB7CiAgICAgICAgICAgIF90aGlzMTIuY3JlYXRlX2NoYXQocmVzcG9uc2UuZGF0YSwgImlzdGFibGUiKTsKCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9ICJPb3BzISBTb21ldGhpbmcgd2VudCB3cm9uZyEiKSB7CiAgICAgICAgICAgICAgX3RoaXMxMi5jcmVhdGVfY2hhdChyZXNwb25zZS5kYXRhLCAiaXNwcm9tcHQiKTsKCiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk9vcHMhIFNvbWV0aGluZyB3ZW50IHdyb25nISIpIHsKICAgICAgICAgICAgICBfdGhpczEyLmNoYXQucHVzaChyZXNwb25zZS5kYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXMxMi4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIF90aGlzMTIuY2hhdCk7CgogICAgICAgICAgICAgIF90aGlzMTIudXBkYXRlX3Njcm9sbGJhcigpOwoKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJjb2xsYXBzaWJsZSIpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5wcm9tcHRfdXJsKCksIHsKICAgICAgICAgIHVpZDogImNlbnNlIiwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGNoYXQ6ICIiCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTIuY2hhdC5wdXNoKHJlc3BvbnNlLmRhdGEpOwoKICAgICAgICAgIF90aGlzMTIudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKCiAgICAgICAgICBfdGhpczEyLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXMxMi5jaGF0KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGJ1dHRvbl9maWxsOiBmdW5jdGlvbiBidXR0b25fZmlsbCgpIHsKICAgICAgaWYgKHRoaXMuaXNleGNoYW5nZSkgewogICAgICAgIGlmICh0aGlzLnRvX3NlbmQgPT0gIiIpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZW5kX2J1dHRvbiIpLnN0eWxlLmZpbGwgPSAiIzhhOGE4YTYzIjsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMudG9fc2VuZCAhPSAiIikgewogICAgICAgICAgaWYgKHRoaXMubGl2ZV9jaGF0X29uKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKCJzdGFydGVkX3R5cGluZyIpOwogICAgICAgICAgICB0aGlzLnN0b3BfdHlwaW5nKHRoaXMpOwogICAgICAgICAgfQoKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZW5kX2J1dHRvbiIpLnN0eWxlLmZpbGwgPSAiI2ZkY2YzOCI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCF0aGlzLmlzZXhjaGFuZ2UpIHsKICAgICAgICBpZiAodGhpcy50b19zZW5kID09ICIiKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiM4YThhOGE2MyI7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRvX3NlbmQgIT0gIiIpIHsKICAgICAgICAgIGlmICh0aGlzLmxpdmVfY2hhdF9vbikgewogICAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaCgic3RhcnRlZF90eXBpbmciKTsKICAgICAgICAgICAgdGhpcy5zdG9wX3R5cGluZyh0aGlzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VuZF9idXR0b24iKS5zdHlsZS5maWxsID0gIiMyNzM2NzkiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN0b3BfdHlwaW5nOiBkZWJvdW5jZShmdW5jdGlvbiAodm0pIHsKICAgICAgdm0uY2hhbm5lbC5wdXNoKCJzdG9wcGVkX3R5cGluZyIpOwogICAgfSwgNTAwMCksCiAgICBzY3JvbGxfZG93bjogZnVuY3Rpb24gc2Nyb2xsX2Rvd24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hhdC1ib2R5Iikuc2Nyb2xsSGVpZ2h0IC0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbFRvcCAtICQoIi5jaGF0LWhpcyIpLmxhc3QoKS5oZWlnaHQoKSA8PSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hhdC1ib2R5IikuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgdGhpcy50b19zY3JvbGwgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRvX3Njcm9sbCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2J1dHRvbnM6IGZ1bmN0aW9uIGxvYWRfYnV0dG9ucyhtZXNzYWdlLCBpbmRleCwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICB2YXIgbXNnID0gewogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgYnV0dG9uX3ByZWZpeDogbWVzc2FnZS5wcmVmaXgsCiAgICAgICAgY3VzdG9tX2J1dHRvbnM6IHRydWUsCiAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLnRleHQsCiAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgIH07CgogICAgICBpZiAobWVzc2FnZS5idXR0b25zLmxlbmd0aCA9PSAzKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UuYnV0dG9uc1swXS50aXRsZSA9PSAiRXhjaGFuZ2UgUmF0ZSIgJiYgbWVzc2FnZS5idXR0b25zWzFdLnRpdGxlID09ICJUcmFjayBNeSBQYXJjZWwiICYmIG1lc3NhZ2UuYnV0dG9uc1syXS50aXRsZSA9PSAiQ2FsbCBIZWxwZGVzayIpIHsKICAgICAgICAgIG1zZy5yZW1vdmFibGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChtZXNzYWdlLnRleHQgPT0gIldvdWxkIHlvdSBsaWtlIHRvIHNoYXJlIHlvdXIgbmFtZSBhbmQgbnVtYmVyPyIgJiYgdGhpcy5pc2V4Y2hhbmdlKSB7CiAgICAgICAgJCgiI3Jlc3BvbnNlX2JvdF90ZXh0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSBpbiBtZXNzYWdlLmJ1dHRvbnMpIHsKICAgICAgICBpZiAobXNnLmJ1dHRvbl9wcmVmaXggIT0gbnVsbCkgewogICAgICAgICAgbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgdGl0bGU6IG1lc3NhZ2UuYnV0dG9uc1tpXS50aXRsZSwKICAgICAgICAgICAgdmFsdWU6IG1zZy5idXR0b25fcHJlZml4ICsgbWVzc2FnZS5idXR0b25zW2ldLnZhbHVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgdGl0bGU6IG1lc3NhZ2UuYnV0dG9uc1tpXS50aXRsZSwKICAgICAgICAgICAgdmFsdWU6IG1lc3NhZ2UuYnV0dG9uc1tpXS52YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobXNnLmJ1dHRvbnNfbGlzdFtpXS50aXRsZSA9PSAiTm8iICYmIG1lc3NhZ2UudGV4dCAhPSAiQ2FuIEkgaGVscCB5b3Ugd2l0aCBhbnl0aGluZyBlbHNlPyIgJiYgdGhpcy5jb21wYW55aWQgPT0gImNsaW5pY2FsdHJpYWxzODEzNTIiKSB7CiAgICAgICAgICBtc2cuYnV0dG9uc19saXN0W2ldLnZhbHVlID0gImlzZGlzYWJsZWQiOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMy5jaGF0LnB1c2gobXNnKTsKCiAgICAgICAgaWYgKGluZGV4ID09ICJpc19idXR0b24iIHx8IGluZGV4ID09IDApIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoJCgiLmNoYXQtYm9keSIpLmNoaWxkcmVuKCkubGFzdCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC41KSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxUb3AiKSArIDUwCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczEzLnRvX3Njcm9sbCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBfdGhpczEzLiRzZXNzaW9uLnNldCgiQm90UmVzcG9uc2VfQ29udmVyc2F0aW9uIiwgX3RoaXMxMy5jaGF0KTsKICAgICAgfSwgMjUwMCk7CiAgICB9LAogICAgbXVsdGlzZWxlY3RfbG9hZDogZnVuY3Rpb24gbXVsdGlzZWxlY3RfbG9hZChtZXNzYWdlLCBpbmRleCkgewogICAgICB2YXIgbXNnID0gewogICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgIG11bHRpc2VsZWN0X3ZhbHVlczogbWVzc2FnZS5jdXN0b20udmFsdWVzLAogICAgICAgIHBsYWNlaG9sZGVyOiBtZXNzYWdlLmN1c3RvbS5wbGFjZWhvbGRlciwKICAgICAgICBpc19tdWx0aXNlbGVjdDogdHJ1ZSwKICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2UudGV4dCwKICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKQogICAgICB9OwogICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgfSwKICAgIGxvYWRfdGFibGU6IGZ1bmN0aW9uIGxvYWRfdGFibGUobWVzc2FnZSwgaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICBjb2xfbGlzdDogT2JqZWN0LmtleXMobWVzc2FnZS5jdXN0b20udmFsdWVzWzBdKSwKICAgICAgICB0YWJsZV92YWx1ZTogbWVzc2FnZS5jdXN0b20udmFsdWVzLAogICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICByZWNlaXZlZDogbWVzc2FnZS50ZXh0LAogICAgICAgIGlzX3RhYmxlOiB0cnVlLAogICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpCiAgICAgIH07CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTQuY2hhdC5wdXNoKG1zZyk7CgogICAgICAgIGlmIChpbmRleCA9PSAwKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAwLjcgKiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsVG9wIikgKyAxMDAKICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgX3RoaXMxNC50b19zY3JvbGwgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwgMjUwMCk7CiAgICB9LAogICAgY3JlYXRlX2NoYXQ6IGZ1bmN0aW9uIGNyZWF0ZV9jaGF0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgdmFyIGN1cnJlbmN5X2xpc3QgPSBbXTsKCiAgICAgIGlmICh0eXBlID09ICJpc3RhYmxlIikgewogICAgICAgIGF4aW9zLmdldCgiaHR0cHM6Ly9hcGkuZXhjaGFuZ2VyYXRlc2FwaS5pby9sYXRlc3QiLCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgYmFzZTogIkFVRCIKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgZm9yICh2YXIgaSBpbiBtZXNzYWdlLmV4dHJhc1swXS5UQUJMRSkgewogICAgICAgICAgICBpZiAobWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uUFJPUCA9PSAiVFIiKSB7CiAgICAgICAgICAgICAgY3VycmVuY3lfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIGN1cnJlbmN5X3RpdGxlOiBtZXNzYWdlLmV4dHJhc1swXS5UQUJMRVtpXS5URCwKICAgICAgICAgICAgICAgIGN1cnJlbmN5X3ZhbHVlOiBwYXJzZUZsb2F0KE1hdGgucm91bmQocmVzcG9uc2UuZGF0YS5yYXRlc1ttZXNzYWdlLmV4dHJhc1swXS5UQUJMRVtpXVsiVERfMSJdXSAqIDEwMCkgLyAxMDApLnRvRml4ZWQoNCksCiAgICAgICAgICAgICAgICB0eXBlOiAiVFIiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5leHRyYXNbMF0uVEFCTEVbaV0uUFJPUCA9PSAiVEhFQUQiICYmICFfdGhpczE1LmlzZXhjaGFuZ2UpIHsKICAgICAgICAgICAgICBjdXJyZW5jeV9saXN0LnB1c2goewogICAgICAgICAgICAgICAgY291bnRyeV9uYW1lOiBtZXNzYWdlLmV4dHJhc1swXS5UQUJMRVtpXS5URCwKICAgICAgICAgICAgICAgIGN1cnJlbmN5X25hbWU6IG1lc3NhZ2UuZXh0cmFzWzBdLlRBQkxFW2ldLlREXzEsCiAgICAgICAgICAgICAgICB0eXBlOiAiVEhFQUQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8vCgoKICAgICAgICAgIF90aGlzMTUuY3VycmVuY3lleGNoYW5nZV9saXN0ID0gY3VycmVuY3lfbGlzdDsgLy8vCgogICAgICAgICAgX3RoaXMxNS5jaGF0LnB1c2goewogICAgICAgICAgICBpc190YWJsZTogdHJ1ZSwKICAgICAgICAgICAgdGFibGVfdGl0bGU6IF90aGlzMTUucGFyc2UobWVzc2FnZS50aXRsZSksCiAgICAgICAgICAgIHRhYmxlX2xpc3Q6IGN1cnJlbmN5X2xpc3QKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMTUudXBkYXRlX3Njcm9sbGJhcigpOwoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJpc3Byb21wdCIpIHsKICAgICAgICBpZiAobWVzc2FnZS5sZXZlbCA+IDApIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1lc3NhZ2UpOwogICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICAgICAgICB0aGlzLmxldmVsID0gbWVzc2FnZS5sZXZlbDsKICAgICAgICAgIHRoaXMudXBkYXRlX3Njcm9sbGJhcigidXB0b19lbmQiLCAicmVzcG9uc2UiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobWVzc2FnZSk7CiAgICAgICAgICB0aGlzLmZpcnN0X2NsaWNrID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubGV2ZWwgPSBtZXNzYWdlLmxldmVsOwogICAgICAgICAgdGhpcy51cGRhdGVfc2Nyb2xsYmFyKCJ1cHRvX2VuZCIsICJyZXNwb25zZSIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoYXQucHVzaChtZXNzYWdlKTsKICAgICAgfQoKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkJvdFJlc3BvbnNlX0NvbnZlcnNhdGlvbiIsIHRoaXMuY2hhdCk7CiAgICB9LAogICAgc3VibWl0X2N1c3RvbV9mb3JtOiBmdW5jdGlvbiBzdWJtaXRfY3VzdG9tX2Zvcm0oKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjZGV0YWlsc19mb3JtIikgIT0gbnVsbCkgewogICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2RldGFpbHNfZm9ybSIpOwogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3VibWl0IiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBhY3R1YWwgbG9naWMsIGUuZy4gdmFsaWRhdGUgdGhlIGZvcm0KCiAgICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjZGV0YWlsc19mb3JtIikuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgICBpZiAoX3RoaXMxNi5mb3JtX3BheWxvYWQgPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgX2F4aW9zJHBvc3Q2OwoKICAgICAgICAgICAgX3RoaXMxNi5mb3JtX3BheWxvYWQgPSB7fTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgICBfdGhpczE2LmZvcm1fcGF5bG9hZFtxdWVyeVN0cmluZ1tpXS5uYW1lXSA9IHF1ZXJ5U3RyaW5nW2ldLnZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5ib3RfdXNlcl9kYXRhKCksIChfYXhpb3MkcG9zdDYgPSB7CiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBkYXRhOiBfdGhpczE2LmZvcm1fcGF5bG9hZCwKICAgICAgICAgICAgICB0b2tlbjogX3RoaXMxNi5ib3RfcmVzcG9uc2VfdG9rZW5fdmFsdWUsCiAgICAgICAgICAgICAgdXNlcm5hbWU6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBzb3VyY2U6ICJXZWIiCiAgICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfYXhpb3MkcG9zdDYsICJ0b2tlbiIsIF90aGlzMTYuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlKSwgX2RlZmluZVByb3BlcnR5KF9heGlvcyRwb3N0NiwgInJvbGUiLCBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSksIF9heGlvcyRwb3N0NikpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkJvdCBVc2VyIERhdGEgU2F2ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgICAgJCgiI2RldGFpbHNfZm9ybSA6aW5wdXQiKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgJCgiI2RldGFpbHNfZm9ybSA6YnV0dG9uIikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKCiAgICAgICAgICAgICAgICBfdGhpczE2LnVwZGF0ZV9zY3JvbGxiYXIoInVwdG9fZW5kIiwgInJlc3BvbnNlIik7CgogICAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2hhdGJvdF9yZXNwb25zZV9jZW5zZSgpLCB7CiAgICAgICAgICAgICAgICAgIGNoYXQ6ICIvZGV0YWlsc19mb3JtIiwKICAgICAgICAgICAgICAgICAgdG9rZW46IF90aGlzMTYuYm90X3Jlc3BvbnNlX3Rva2VuX3ZhbHVlLAogICAgICAgICAgICAgICAgICB1c2VybmFtZTogX3RoaXMxNi4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBzb3VyY2U6ICJXZWIiLAogICAgICAgICAgICAgICAgICB1c2VyX2lkOiAiIiwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IF90aGlzMTYuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgRGV0YWlsczogSlNPTi5zdHJpbmdpZnkoX3RoaXMxNi5mb3JtX3BheWxvYWQpLAogICAgICAgICAgICAgICAgICByb2xlOiBfdGhpczE2LiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICAgICAgICAgICAgcmVmcmVzaGVkX29yX2Nsb3NlZDogZmFsc2UKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxNi5yZXNwb25zZV9oYW5kbGluZyhyZXNwKTsKCiAgICAgICAgICAgICAgICAgICQoIi5jaGF0LWJvZHkiKS5hbmltYXRlKHsKICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsvLyBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVfc2Nyb2xsYmFyOiBmdW5jdGlvbiB1cGRhdGVfc2Nyb2xsYmFyKHR5cGUsIGlzcmVzcG9uc2UsIGlzd2VsY29tZSwgZGVsYXlfdmFsdWUpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgdmFyIHNjcm9sbF9kZWxheSA9IGlzd2VsY29tZSA9PSAiaXNfd2VsY29tZSIgPyBkZWxheV92YWx1ZSA6IDIwMDA7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgogICAgICBpZiAoaXNyZXNwb25zZSA9PSAicmVzcG9uc2UiKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfSwgc2Nyb2xsX2RlbGF5KTsKICAgICAgfSBlbHNlIGlmIChpc3Jlc3BvbnNlID09ICJzZW5kZXIiKSB7CiAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgc2Nyb2xsVG9wOiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICB9LCA3NTApOwogICAgICB9CgogICAgICBpZiAoaXNyZXNwb25zZSAhPSAic2VuZGVyIikgewogICAgICAgIGlmICh0eXBlID09ICJ1cHRvX2VuZCIpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbFRvcCIpIDwgJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpKSB7CiAgICAgICAgICAgICAgaWYgKCQoIi5yZWNlaXZlciIpLmxhc3QoKS5wYXJlbnQoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA+IDAuNSkgewogICAgICAgICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IDAuNzUgKiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgICAgX3RoaXMxNy50b19zY3JvbGwgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPCAwLjUpIHsKICAgICAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgICAgIH0sIHNjcm9sbF9kZWxheSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHNjcm9sbF9kZWxheSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY2hhdC1ib2R5Iikuc2Nyb2xsVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtYm9keSIpLnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWJvZHkiKS5sYXN0Q2hpbGQuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgRlhQYXltZW50TW9kZTogZnVuY3Rpb24gRlhQYXltZW50TW9kZSgpIHsKICAgICAgdGhpcy50b19zZW5kID0gIi9Gb3JlaWdueGNoYW5nZTE3NDkxX3BheW1lbnRfbW9kZSI7CiAgICAgIHRoaXMuc2VuZF9tZXNzYWdlKCJpc19wcm9tcHQiLCAiL0ZvcmVpZ254Y2hhbmdlMTc0OTFfcGF5bWVudF9tb2RlIiwgIlBheW1lbnQiKTsKICAgIH0sCiAgICBGWFRyYWNraW5nUGFyY2VsOiBmdW5jdGlvbiBGWFRyYWNraW5nUGFyY2VsKCkgewogICAgICB0aGlzLnRvX3NlbmQgPSAiL0ZvcmVpZ254Y2hhbmdlMTc0OTFfdHJhY2tpbmdfcGFyY2VsIjsKICAgICAgdGhpcy5zZW5kX21lc3NhZ2UoImlzX3Byb21wdCIsICIvRm9yZWlnbnhjaGFuZ2UxNzQ5MV90cmFja2luZ19wYXJjZWwiLCAiVHJhY2sgTXkgUGFyY2VsIik7CiAgICB9LAogICAgLy8gRm9yZWlnbkV4Y2hhbmdlQ29udmVyc2lvbigpIHsKICAgIC8vICAgdGhpcy50b19zZW5kID0gIi9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGUiOwogICAgLy8gICB0aGlzLnNlbmRfbWVzc2FnZSgKICAgIC8vICAgICAiaXNfcHJvbXB0IiwKICAgIC8vICAgICAiL0ZvcmVpZ254Y2hhbmdlMTc0OTFfZXhjaGFuZ2VfcmF0ZSIsCiAgICAvLyAgICAgIkV4Y2hhbmdlIFJhdGUiCiAgICAvLyAgICk7CiAgICAvLyB9LAogICAgRm9yZWlnbkV4Y2hhbmdlQ29udmVyc2lvbjogZnVuY3Rpb24gRm9yZWlnbkV4Y2hhbmdlQ29udmVyc2lvbigpIHsKICAgICAgLy8gdGhpcy50b19zZW5kID0gIi9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGUiOwogICAgICB0aGlzLnRvX3NlbmQgPSAnL0ZvcmVpZ254Y2hhbmdlMTc0OTFfZXhjaGFuZ2VfcmF0ZXsiQlVZX09SX1NFTEwiOiAiQlVZIn0nOwogICAgICB0aGlzLnNlbmRfbWVzc2FnZSgiaXNfcHJvbXB0IiwgJy9Gb3JlaWdueGNoYW5nZTE3NDkxX2V4Y2hhbmdlX3JhdGV7IkJVWV9PUl9TRUxMIjogIkJVWSJ9JywgIkV4Y2hhbmdlIFJhdGUiKTsKICAgIH0sCiAgICBleDE6IGZ1bmN0aW9uIGV4MSgpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMSIpICE9IG51bGwpIHsKICAgICAgICAgICQoIiNsMSIpLnZhbCgxKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzMTguY3VycmVuY3lleGNoYW5nZV9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICQoIiNjb3VudHJ5IikuYXBwZW5kKCI8b3B0aW9uIHZhbHVlPVwiIi5jb25jYXQoX3RoaXMxOC5jdXJyZW5jeWV4Y2hhbmdlX2xpc3RbaV0uY3VycmVuY3lfdmFsdWUsICJcIj4iKS5jb25jYXQoX3RoaXMxOC5jdXJyZW5jeWV4Y2hhbmdlX2xpc3RbaV0uY3VycmVuY3lfdGl0bGUsICI8L29wdGlvbj4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiI3IxIikudGV4dChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeSIpLnZhbHVlKTsgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIxIikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpIHsKICAgICAgICAgIC8vICAgdmFyIHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjEiKS5pbm5lclRleHQ7CiAgICAgICAgICAvLyAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeSIpLnZhbHVlOwogICAgICAgICAgLy8gICB4ID0geCAvIGNvbjsKICAgICAgICAgIC8vICAgeCA9IHgudG9GaXhlZCg0KTsKICAgICAgICAgIC8vICAgJCgiI2wxIikudmFsKHgpOwogICAgICAgICAgLy8gfSk7CgogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwxIikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwxIikudmFsdWU7CiAgICAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeSIpLnZhbHVlOwogICAgICAgICAgICB4ID0geCAqIGNvbjsKICAgICAgICAgICAgeCA9IHgudG9GaXhlZCg0KTsKICAgICAgICAgICAgJCgiI3IxIikudGV4dCh4KTsKICAgICAgICAgIH0pOwogICAgICAgICAgJChkb2N1bWVudCkub24oImNoYW5nZSIsICIjY291bnRyeSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdW50cnkiKS5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwxIikudmFsdWU7CiAgICAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeSIpLnZhbHVlOwogICAgICAgICAgICB4ID0geCAqIGNvbjsKICAgICAgICAgICAgeCA9IHgudG9GaXhlZCg0KTsKICAgICAgICAgICAgJCgiI3IxIikudGV4dCh4KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgMTAwKTsKICAgIH0sCiAgICBhZGRkcm9wZG93bnZhbHVlOiBmdW5jdGlvbiBhZGRkcm9wZG93bnZhbHVlKCkgewogICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uWzBdICE9IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMudG9fc2VuZCA9ICIiOwogICAgICAgIHRoaXMucmVzID0ge307CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMudG9fc2VuZCA9IHRoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS50aXRsZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudG9fc2VuZCA9IHRoaXMudG9fc2VuZCArICIsICIgKyB0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udGl0bGU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMucmVzW3RoaXMuc2VsZWN0ZWRfaW5kaWNhdGlvbltpXS52YWx1ZS5zcGxpdCgnIicpWzFdXSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5yZXNbdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbMV1dID0gdGhpcy5zZWxlY3RlZF9pbmRpY2F0aW9uW2ldLnZhbHVlLnNwbGl0KCciJylbM107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnJlc1t0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udmFsdWUuc3BsaXQoJyInKVsxXV0gPSB0aGlzLnJlc1t0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udmFsdWUuc3BsaXQoJyInKVsxXV0gKyAiLCIgKyB0aGlzLnNlbGVjdGVkX2luZGljYXRpb25baV0udmFsdWUuc3BsaXQoJyInKVszXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuYnV0dG9uX2ZpbGwoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRvX3NlbmQgPSAiIjsKICAgICAgICB0aGlzLnJlcyA9IFtdOwogICAgICB9CgogICAgICB0aGlzLmJ1dHRvbl9maWxsKCk7CiAgICB9LAogICAgY2xvc2VkX2JvdF9jaGF0OiBmdW5jdGlvbiBjbG9zZWRfYm90X2NoYXQobWVzc2FnZSwgdHlwZSkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CgogICAgICAvLyBkZWJ1Z2dlcjsKICAgICAgLy8gY29uc29sZS5sb2cobWVzc2FnZSk7CiAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7IC8vIGxhc3RjbG9zZWRib3RpbnB1dG5vZGUKCiAgICAgIGlmIChtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0ubm9kZV90eXBlID09ICJoZWFkZXIiICYmIG1lc3NhZ2Uubm9kZXNbbWVzc2FnZS5ub2Rlcy5sZW5ndGggLSAxXS5ub2RlX3R5cGUgIT0gbnVsbCAmJiAhdGhpcy5lbXB0eV9zdHJpbmdfdmFsaWRpdHkudGVzdChtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0ubm9kZV90eXBlKSkgewogICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW21lc3NhZ2Uubm9kZXMubGVuZ3RoIC0gMV0udGl0bGUgPT0gIkRpc3BsYXkgTWVzc2FnZSIpIHsKICAgICAgICAgIG1lc3NhZ2Uubm9kZXNbbWVzc2FnZS5ub2Rlcy5sZW5ndGggLSAxXS50aXRsZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1ttZXNzYWdlLm5vZGVzLmxlbmd0aCAtIDFdLnRpdGxlLAogICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgfSk7CiAgICAgIH0gLy8gY29uc29sZS5sb2cobWVzc2FnZS5ub2Rlcy5sZW5ndGgpOwoKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZS5ub2Rlcy5sZW5ndGggLSAxOyBpICs9IDEpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhtZXNzYWdlLm5vZGVzKTsKICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImJ1dHRvbiIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgYnV0dG9uc19saXN0OiBbXSwKICAgICAgICAgICAgYnV0dG9uX3ByZWZpeDogbnVsbCwKICAgICAgICAgICAgY3VzdG9tX2J1dHRvbnM6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICB9OwoKICAgICAgICAgIHdoaWxlIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJidXR0b24iKSB7CiAgICAgICAgICAgICAgbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuYnV0dG9uLAogICAgICAgICAgICAgICAgdmFsdWU6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wYXlsb2FkLAogICAgICAgICAgICAgICAgaWQ6IG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCwKICAgICAgICAgICAgICAgIG5vZGU6IG1lc3NhZ2Uubm9kZXNbaV0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyBtc2cuYnV0dG9uc19saXN0LnB1c2goewogICAgICAgICAgICAvLyAgIHRpdGxlOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuYnV0dG9ucywKICAgICAgICAgICAgLy8gICB2YWx1ZTogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnBheWxvYWQsCiAgICAgICAgICAgIC8vIH0pOwoKCiAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KCiAgICAgICAgICBpLS07CiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gInRleHRfYm94IiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlCiAgICAgICAgICB9KTsgLy8gdmFyIG1zZyA9IHsKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAvLyAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAvLyAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAvLyAgIHJlY2VpdmVkOiAnPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSInK21lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wbGFjZWhvbGRlcisnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nK2krJyI+JywKICAgICAgICAgIC8vICAgdGltZTogbnVsbCwKICAgICAgICAgIC8vICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICAvLyB9OwoKICAgICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOyAvLyBjb25zb2xlLmxvZygnMicpOwogICAgICAgICAgLy8gdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJ0ZXh0X2FyZWEiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIC8vIHJlY2VpdmVkOiAnPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSInK21lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wbGFjZWhvbGRlcisnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nK2krJyI+JywKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8dGV4dGFyZWEgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iNCIgY29scz0iMTUwInN0eWxlPSJwYWRkaW5nLWxlZnQ6MTJweDtyZXNpemU6bm9uZTtvdmVyZmxvdy15OmF1dG87bWluLWhlaWdodDozMHB4IiBwbGFjZWhvbGRlcj0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5wbGFjZWhvbGRlciArICcibmFtZT0iY2xvc2VkX2JvdF9ub2RlXycgKyBpICsgJyI+PC90ZXh0YXJlYT4nLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZW1vdmFibGU6IHR5cGUgPT0gIndlbGNvbWVfbWVzc2FnZSIgPyBmYWxzZSA6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgPSAiY2xvc2VkX2JvdF9ub2RlXyIgKyBpOyAvLyBtc2cuYnV0dG9uc19saXN0LnB1c2goewogICAgICAgICAgLy8gICAgIHRpdGxlOiAnU3VibWl0JywKICAgICAgICAgIC8vICAgICB2YWx1ZTogJ1N1Ym1pdCcsCiAgICAgICAgICAvLyAgIH0pOwoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgICB0aGlzLmlzX3RleHRfYXJlYSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiZW1haWwiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5pc2VtYWlsID0gdHJ1ZTsgLy8gaWYobWVzc2FnZS5ub2Rlc1tpXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpewogICAgICAgICAgLy8gdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgLy8gICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAvLyAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZXJyb3JfbXNnLAogICAgICAgICAgLy8gICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIC8vICAgdGltZTogbnVsbAogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIC8vICBpZighbWVzc2FnZS5ub2Rlc1tpXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwpewoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOyAvLyAgfQogICAgICAgICAgLy8gdmFyIG1zZyA9IHsKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAvLyAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAvLyAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAvLyAgIHJlY2VpdmVkOiAnPGlucHV0IHR5cGU9ImVtYWlsIiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSsnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nK2krJyI+JywKICAgICAgICAgIC8vICAgdGltZTogbnVsbCwKICAgICAgICAgIC8vICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICAvLyB9OwogICAgICAgICAgLy8gLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgIC8vIC8vICAgICB0aXRsZTogJ1N1Ym1pdCcsCiAgICAgICAgICAvLyAvLyAgICAgdmFsdWU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICB9KTsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAicGhvbmVfbnVtYmVyIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuaXNfcGhvbmVfbnVtYmVyID0gdHJ1ZTsgLy8gaWYobWVzc2FnZS5ub2Rlc1tpXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gZmFsc2UpewogICAgICAgICAgLy8gdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgLy8gICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAvLyAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZXJyb3JfbXNnLAogICAgICAgICAgLy8gICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIC8vICAgdGltZTogbnVsbAogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgIC8vIH0KCiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleCI+IDxzZWxlY3QgbmFtZT0iY291bnRyeWNvZGUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHN0eWxlPSJwYWRkaW5nLWxlZnQ6NnB4ICFpbXBvcnRhbnQ7cGFkZGluZy1yaWdodDo2cHggIWltcG9ydGFudDsgd2lkdGg6NDAlO2hlaWdodDo1MHB4ICFpbXBvcnRhbnQ7IiAgPicgLy8gcmVjZWl2ZWQ6ICcnLAoKICAgICAgICAgIH07IC8vIHZhciBkcm9wZG93biA9IFtdOwoKICAgICAgICAgIHZhciBkYXRhID0gQ291bnRyeUNvZGVzOwogICAgICAgICAgdmFyIG9wdGlvbiA9IHZvaWQgMDsKCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZGF0YS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgLy8gb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgIC8vIG9wdGlvbi50ZXh0ID0gZGF0YVtpXS5jb3VudHJ5X2NvZGU7CiAgICAgICAgICAgIC8vIG9wdGlvbi52YWx1ZSA9IGRhdGFbaV0uY2FsbGluZ19jb2RlOwogICAgICAgICAgICAvLyAvLyBkcm9wZG93bi5hZGQob3B0aW9uKTsKICAgICAgICAgICAgLy8gbXNnLnJlY2VpdmVkPW1zZy5yZWNlaXZlZCArIG9wdGlvbjsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxvcHRpb24gdmFsdWU9ICcgKyBkYXRhW19pXS5kaWFsX2NvZGUgKyAnPicgKyBkYXRhW19pXS5jb2RlICsgIigiICsgZGF0YVtfaV0uZGlhbF9jb2RlICsgIikiICsgJzwvb3B0aW9uPic7CiAgICAgICAgICB9CgogICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICBtc2cucmVjZWl2ZWQgPSBtc2cucmVjZWl2ZWQgKyAnPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MTJweCAhaW1wb3J0YW50OyBoZWlnaHQ6NTBweCAhaW1wb3J0YW50OyIgYXV0b2NvbXBsZXRlPSJvZmYiIG5hbWU9InBob25lbnVtYmVyIiBpZD0gInBob25lbnVtYmVyIiBuYW1lPSJjbG9zZWRfYm90X25vZGVfJyArIGkgKyAnIj4gIDwvZGl2Pic7IC8vIGNvbnNvbGUubG9nKG1zZyk7CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsgLy8gdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgLy8gcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgLy8gcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgLy8gY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyB0aW1lOiBudWxsCiAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICB0aGlzLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gInBob25lbnVtYmVyIjsgLy8gdmFyIG1zZyA9IHsKICAgICAgICAgIC8vICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAvLyAgIGJ1dHRvbnNfbGlzdDogW10sCiAgICAgICAgICAvLyAgIGJ1dHRvbl9wcmVmaXg6IG51bGwsCiAgICAgICAgICAvLyAgIGN1c3RvbV9idXR0b25zOiB0cnVlLAogICAgICAgICAgLy8gICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAvLyAgIHJlY2VpdmVkOiAnPGlucHV0IHR5cGU9ImVtYWlsIiBwbGFjZWhvbGRlcj0iJyttZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSsnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nK2krJyI+JywKICAgICAgICAgIC8vICAgdGltZTogbnVsbCwKICAgICAgICAgIC8vICAgcmVtb3ZhYmxlOiB0eXBlID09ICJ3ZWxjb21lX21lc3NhZ2UiID8gZmFsc2UgOiB0cnVlCiAgICAgICAgICAvLyB9OwogICAgICAgICAgLy8gLy8gbXNnLmJ1dHRvbnNfbGlzdC5wdXNoKHsKICAgICAgICAgIC8vIC8vICAgICB0aXRsZTogJ1N1Ym1pdCcsCiAgICAgICAgICAvLyAvLyAgICAgdmFsdWU6ICdTdWJtaXQnLAogICAgICAgICAgLy8gLy8gICB9KTsKICAgICAgICAgIC8vIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiaHlwZXJsaW5rIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8YSBocmVmPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lmh5cGVybGluayArICciIHRhcmdldD0iX2JsYW5rIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lmh5cGVybGluayArICc8L2E+JwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAicmFkaW9fYnV0dG9ucyIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJycKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgcmVjZWl2ZWQ6IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgfSk7IC8vIG1zZy5yZWNlaXZlZCA9IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5tZXNzYWdlOwoKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnJhZGlvX2J1dHRvbnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV9pZCArICciIHZhbHVlPSInICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnJhZGlvX2J1dHRvbnNbal0udGl0bGUgKyAnIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnJhZGlvX2J1dHRvbnNbal0udGl0bGUgKyAnPGJyPic7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5jaGF0LnB1c2gobXNnKTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJjaGVja19ib3giICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgcmVjZWl2ZWQ6ICcnCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwKICAgICAgICAgIH0pOwoKICAgICAgICAgIGZvciAodmFyIF9qID0gMDsgX2ogPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmFsdWVzLmxlbmd0aDsgX2orKykgewogICAgICAgICAgICBtc2cucmVjZWl2ZWQgPSBtc2cucmVjZWl2ZWQgKyAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSInICsgbWVzc2FnZS5ub2Rlc1tpXS5ub2RlX2lkICsgJyIgdmFsdWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmFsdWVzW19qXS50aXRsZSArICciPicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmFsdWVzW19qXS50aXRsZSArICc8YnI+JzsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNoYXQucHVzaChtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5ub2Rlc1tpXS5ub2RlX3R5cGUgPT0gIm5vZGUiICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gImRyb3Bkb3duIiAmJiAhbWVzc2FnZS5ub2Rlc1tpXS5wYXJ0X29mX2Zvcm0pIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPHNlbGVjdCBuYW1lPSInICsgbWVzc2FnZS5ub2Rlc1tpXS5ub2RlX2lkICsgJyIgY2xhc3M9ImZvcm0tY29udHJvbCIgPjxvcHRpb24gdmFsdWUgZGlzYWJsZWQ9ImRpc2FibGVkIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UgKyAnPC9vcHRpb24+JyAvLyByZWNlaXZlZDogJycsCgogICAgICAgICAgfTsKCiAgICAgICAgICBmb3IgKHZhciBfajIgPSAwOyBfajIgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZHJvcGRvd24ubGVuZ3RoOyBfajIrKykgewogICAgICAgICAgICBtc2cucmVjZWl2ZWQgPSBtc2cucmVjZWl2ZWQgKyAnPG9wdGlvbj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmRyb3Bkb3duW19qMl0udGl0bGUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgIH0KCiAgICAgICAgICBtc2cucmVjZWl2ZWQgPSBtc2cucmVjZWl2ZWQgKyAnPC9zZWxlY3Q+JzsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiaW1hZ2UiICYmICFtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICByZWNlaXZlZDogJzxpbWcgd2lkdGg9IjIxMHB4IiBoZWlnaHQ9IjE0MHB4IiBzcmM9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuaW1hZ2UgKyAnIj4nCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJ2aWRlbyIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnPGlmcmFtZSB3aWR0aD0iMjEwcHgiIGhlaWdodD0iMTQwcHgiIHNyYz0iJyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC52aWRlbyArICciPC9pZnJhbWU+JwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAibWVzc2FnZSIgJiYgIW1lc3NhZ2Uubm9kZXNbaV0ucGFydF9vZl9mb3JtKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQubWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIpIHsKICAgICAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgICAgIHJlY2VpdmluZzogdHJ1ZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgIHJlY2VpdmVkOiAnJwogICAgICAgICAgfTsKICAgICAgICAgIHZhciBmb3JtID0gJzxmb3JtIGlkPSInICsgbWVzc2FnZS5ub2Rlc1tpXS5mb3JtX25hbWUucmVwbGFjZSgnICcsICdfJykgKyAnIj4nOwoKICAgICAgICAgIHdoaWxlIChtZXNzYWdlLm5vZGVzW2ldLnBhcnRfb2ZfZm9ybSkgewogICAgICAgICAgICAvLyBmb3JtPWZvcm0rJzxicj4nCiAgICAgICAgICAgIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAidGV4dF9ib3giKSB7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6NDUwO2ZvbnQtc2l6ZToxNXB4OyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJzwvcD4nOwogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxpbnB1dCBuYW1lPSInICsgbWVzc2FnZS5ub2Rlc1tpXS5oZWFkZXIgKyAnIiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjEwcHggIWltcG9ydGFudCIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucGxhY2Vob2xkZXIgKyAnIm5hbWU9ImNsb3NlZF9ib3Rfbm9kZV8nICsgaSArICciPic7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAiZHJvcGRvd24iKSB7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6NDUwO2ZvbnQtc2l6ZToxNXB4OyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJzwvcD4nOwogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxzZWxlY3QgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJyIgY2xhc3M9ImZvcm0tY29udHJvbCIgPic7CgogICAgICAgICAgICAgIGZvciAodmFyIF9qMyA9IDA7IF9qMyA8IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5kcm9wZG93bi5sZW5ndGg7IF9qMysrKSB7CiAgICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8b3B0aW9uPicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZHJvcGRvd25bX2ozXS50aXRsZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9zZWxlY3Q+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8L2Rpdj4nOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2Uubm9kZXNbaV0ubm9kZV90eXBlID09ICJub2RlIiAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlID09ICJjaGVja19ib3giKSB7CiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+JzsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTowcHg7Zm9udC13ZWlnaHQ6NDUwO2ZvbnQtc2l6ZToxNXB4OyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJzwvcD4nOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfajQgPSAwOyBfajQgPCBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmFsdWVzLmxlbmd0aDsgX2o0KyspIHsKICAgICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJyIgdmFsdWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQudmFsdWVzW19qNF0udGl0bGUgKyAnIj4nICsgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LnZhbHVlc1tfajRdLnRpdGxlICsgJzxicj4nOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPC9kaXY+JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLm5vZGVzW2ldLm5vZGVfdHlwZSA9PSAibm9kZSIgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSA9PSAicmFkaW9fYnV0dG9ucyIpIHsKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4nOwogICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxwIHN0eWxlPSJtYXJnaW4tYm90dG9tOjBweDtmb250LXdlaWdodDo0NTA7Zm9udC1zaXplOjE1cHg7Ij4nICsgbWVzc2FnZS5ub2Rlc1tpXS5oZWFkZXIgKyAnPC9wPic7CgogICAgICAgICAgICAgIGZvciAodmFyIF9qNSA9IDA7IF9qNSA8IG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zLmxlbmd0aDsgX2o1KyspIHsKICAgICAgICAgICAgICAgIGZvcm0gPSBmb3JtICsgJzxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iJyArIG1lc3NhZ2Uubm9kZXNbaV0uaGVhZGVyICsgJyIgdmFsdWU9IicgKyBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQucmFkaW9fYnV0dG9uc1tfajVdLnRpdGxlICsgJyI+JyArIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5yYWRpb19idXR0b25zW19qNV0udGl0bGUgKyAnPGJyPic7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3JtID0gZm9ybSArICc8L2Rpdj4nOwogICAgICAgICAgICB9IC8vIGZvcm09Zm9ybSsnPGJyPicKCgogICAgICAgICAgICBpKys7CiAgICAgICAgICB9CgogICAgICAgICAgaS0tOwogICAgICAgICAgZm9ybSA9IGZvcm0gKyAnPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiPlN1Ym1pdDwvYnV0dG9uPjwvZm9ybT4nOwogICAgICAgICAgdGhpcy5pc2Zvcm1vbiA9IHRydWU7CiAgICAgICAgICB0aGlzLmZvcm1fbmFtZSA9IG1lc3NhZ2Uubm9kZXNbaV0uZm9ybV9uYW1lLnJlcGxhY2UoJyAnLCAnXycpOwogICAgICAgICAgbXNnLnJlY2VpdmVkID0gZm9ybTsKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKG1zZyk7CiAgICAgICAgICB0aGlzLnN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgIHRpbWU6IHRoaXMuZ2VuZXJhdGVfdGltZSgpLAogICAgICAgICAgcmVjZWl2ZWQ6IG51bGwKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgIT0gJ21lc3NhZ2UnICYmIG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgIT0gJ2ltYWdlJyAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICd2aWRlbycgJiYgbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50LmVsZW1lbnRfdHlwZSAhPSAnYnV0dG9uJyAmJiBtZXNzYWdlLm5vZGVzW2ldLnVpX2VsZW1lbnQuZWxlbWVudF90eXBlICE9ICdoeXBlcmxpbmsnKSB7CiAgICAgICAgICB0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgPSB0aGlzLmNoYXQubGVuZ3RoIC0gMTsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRub2RlaWQgPSBtZXNzYWdlLm5vZGVzW2ldOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1lc3NhZ2Uubm9kZXNbaV0udWlfZWxlbWVudC5lbGVtZW50X3R5cGUgPT0gJ2J1dHRvbicpIHsKICAgICAgICAgIHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSA9IHRoaXMuY2hhdC5sZW5ndGggLSAyOwogICAgICAgICAgdGhpcy5zZWxlY3RlZG5vZGVpZCA9IG1lc3NhZ2Uubm9kZXNbaV07CiAgICAgICAgfQoKICAgICAgICBpZiAobWVzc2FnZS5ub2Rlc1tpXS5pc19sZWFmKSB7CiAgICAgICAgICB0aGlzLmlzY2xvc2VkYm90b24gPSBmYWxzZTsKICAgICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwogICAgICAgICAgdGhpcy5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB2bSA9IF90aGlzMTk7CiAgICAgICAgdm0udG9fc2Nyb2xsID0gdHJ1ZTsKCiAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5jaGlsZHJlbigpLmxhc3QoKS5oZWlnaHQoKSAvICQoIi5jaGF0LWJvZHkiKS5oZWlnaHQoKSA8IDAuNSkgewogICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICBzY3JvbGxUb3A6ICQoIi5jaGF0LWJvZHkiKS5wcm9wKCJzY3JvbGxIZWlnaHQiKQogICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSBlbHNlIGlmICgkKCIucmVjZWl2ZXIiKS5sYXN0KCkucGFyZW50KCkuaGVpZ2h0KCkgLyAkKCIuY2hhdC1ib2R5IikuaGVpZ2h0KCkgPiAwLjUgJiYgJCgiLnJlY2VpdmVyIikubGFzdCgpLnBhcmVudCgpLmhlaWdodCgpIC8gJCgiLmNoYXQtYm9keSIpLmhlaWdodCgpIDwgMC42KSB7CiAgICAgICAgICAkKCIuY2hhdC1ib2R5IikuYW5pbWF0ZSh7CiAgICAgICAgICAgIHNjcm9sbFRvcDogMC45ICogJCgiLmNoYXQtYm9keSIpLnByb3AoInNjcm9sbEhlaWdodCIpCiAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgJCgiLmNoYXQtYm9keSIpLmFuaW1hdGUoewogICAgICAgICAgICBzY3JvbGxUb3A6IDAuNzUgKiAkKCIuY2hhdC1ib2R5IikucHJvcCgic2Nyb2xsSGVpZ2h0IikKICAgICAgICAgIH0sIDE1MDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCQoIi5jaGF0LWJvZHkiKS5zY3JvbGxUb3AoKSA9PSAwKSB7CiAgICAgICAgICBfdGhpczE5LnRvX3Njcm9sbCA9IGZhbHNlOwogICAgICAgIH0gLy8gY29uc29sZS5sb2coJCgnW25hbWU9Jyt2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKyddJykpCgoKICAgICAgICBpZiAodm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciAhPSBudWxsKSB7CiAgICAgICAgICAkKCdbbmFtZT0nICsgdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciArICddJylbMF0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB2bS5hcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94KTsKICAgICAgICB9CiAgICAgIH0sIDEwMDApOwogICAgfSwKICAgIHN1Ym1pdF9jbG9zZWRfZm9ybV9kYXRhOiBmdW5jdGlvbiBzdWJtaXRfY2xvc2VkX2Zvcm1fZGF0YSh0eXBlLCBtZXNzYWdlKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKCiAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAvLyBjb25zb2xlLmxvZyh0eXBlLCAnSGVsbG8gSGFyc2gnKTsKICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSkgIT0gbnVsbCAmJiB0eXBlID09ICdpc19idXR0b24nICYmIG1lc3NhZ2UudGl0bGUgPT0gIlN1Ym1pdCIpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgKyAxKSk7CiAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwoKICAgICAgICBpZiAodGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID09IG51bGwpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSB7fTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YVtxdWVyeVN0cmluZ1tpXS5uYW1lXSA9IHF1ZXJ5U3RyaW5nW2ldLnZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgaW4gcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhLnF1ZXJ5U3RyaW5nW2ldLm5hbWUucHVzaChxdWVyeVN0cmluZ1tpXS52YWx1ZSk7CiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgY2hhdDogdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhLAogICAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZAogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwoKICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnaXNfYnV0dG9uJykgewogICAgICAgIHRoaXMucmVmcmVzaGVkX29yX2Nsb3NlZCA9IHRydWU7CiAgICAgICAgdGhpcy5jaGF0LnB1c2goewogICAgICAgICAgc2VudDogbWVzc2FnZS50aXRsZSwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgZHJvcGRvd246ICIiCiAgICAgICAgfSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHVpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgY2hhdDogbWVzc2FnZS50aXRsZSwKICAgICAgICAgIC8vIG5vZGVfc2VsZWN0ZWQ6IHtub2RlX2lkOiBtZXNzYWdlLmlkfSwKICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IG1lc3NhZ2Uubm9kZSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQsCiAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwoKICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gdW5kZWZpbmVkICYmICF0aGlzLmlzZm9ybW9uICYmICF0aGlzLmlzZW1haWwgJiYgIXRoaXMuaXNfcGhvbmVfbnVtYmVyICYmIHRoaXMuaXNfdGV4dF9hcmVhKSB7CiAgICAgICAgdGhpcy5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsgLy8gJCgnW25hbWU9Jyt0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIrJ10nKS5hdHRyKCJkaXNhYmxlZCIsICdkaXNhYmxlZCcpCiAgICAgICAgLy8gdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyID0gbnVsbDsKCiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlICsgMSkpOwogICAgICAgIHZhciBxdWVyeVN0cmluZyA9ICQoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgLSAxKSArICIgOmlucHV0Iikuc2VyaWFsaXplQXJyYXkoKTsKCiAgICAgICAgaWYgKHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICB0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0gPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YVtxdWVyeVN0cmluZ1tpXS5uYW1lXS5wdXNoKHF1ZXJ5U3RyaW5nW2ldLnZhbHVlKTsKICAgICAgICAgICAgOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgc2VudDogdGhpcy50b19zZW5kLAogICAgICAgICAgICBzZW5kaW5nOiB0cnVlLAogICAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgIGRlbGl2ZXJlZDogdHJ1ZSwKICAgICAgICAgICAgZHJvcGRvd246ICIiCiAgICAgICAgICB9KTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNsb3NlZF9mb3JtX3Jlc3BvbnNlX2FwaSgpLCB7CiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHVpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBjaGF0OiB0aGlzLnRvX3NlbmQsCiAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0ZWRub2RlaWQsCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9pZDogdGhpcy5jb252ZXJzYXRpb25faWQsCiAgICAgICAgICAgIGJvdF9uYW1lOiB0aGlzLmJvdF9uYW1lCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IG51bGw7CgogICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiB0aGlzLmlzZm9ybW9uICYmICF0aGlzLmlzZW1haWwgJiYgIXRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiMiICsgdGhpcy5mb3JtX25hbWUpICE9IG51bGwpIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiIyIgKyB0aGlzLmZvcm1fbmFtZSk7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoInN1Ym1pdCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjIiArIF90aGlzMjAuZm9ybV9uYW1lKS5zZXJpYWxpemVBcnJheSgpOwoKICAgICAgICAgICAgaWYgKF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSB7fTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBxdWVyeVN0cmluZykgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhW3F1ZXJ5U3RyaW5nW2ldLm5hbWVdID0gW107CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGFbcXVlcnlTdHJpbmdbaV0ubmFtZV0ucHVzaChxdWVyeVN0cmluZ1tpXS52YWx1ZSk7CgogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiBfdGhpczIwLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB1aWQ6IF90aGlzMjAuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGNoYXQ6IF90aGlzMjAuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSwKICAgICAgICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IF90aGlzMjAuc2VsZWN0ZWRub2RlaWQsCiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IF90aGlzMjAuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgICAgICAgYm90X25hbWU6IF90aGlzMjAuYm90X25hbWUKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgJCgiIyIgKyBfdGhpczIwLmZvcm1fbmFtZSArICIgOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsgLy8gY29uc29sZS5sb2coIiMiK3RoaXMuZm9ybV9uYW1lKyI6aW5wdXQiKTsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2xvc2VkX2JvdF9jaGF0KHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSB1bmRlZmluZWQgJiYgdGhpcy5pc2VtYWlsKSB7CiAgICAgICAgLy8gYWxlcnQodGhpcy50b19zZW5kKTsKICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpKSAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICBkZWxpdmVyZWQ6IHRydWUsCiAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjaGF0IiArICh0aGlzLmxhc3RjbG9zZWRib3RpbnB1dG5vZGUgKyAxKSk7CiAgICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkgKyAiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAgICAgICB2YXIgeCA9IHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDE7IC8vIGlmKHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YT09bnVsbCl7CgogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgIHRoaXMuY2xvc2VkX2Zvcm1fcmVwbHlfZGF0YSA9IHt9OwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNoYXQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgICAgbm9kZV9zZWxlY3RlZDogdGhpcy5zZWxlY3RlZG5vZGVpZCwKICAgICAgICAgICAgY29udmVyc2F0aW9uX2lkOiB0aGlzLmNvbnZlcnNhdGlvbl9pZCwKICAgICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHZhciBlcnJvcl92YXJpYWJsZSA9IG51bGw7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCiAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHJlc3BvbnNlLmRhdGEubm9kZXMubGVuZ3RoIC0gMTsgX2kyICs9IDEpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTJdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTJdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgZXJyb3JfdmFyaWFibGUgPSBfaTI7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLm5vZGVzW19pMl0udWlfZWxlbWVudC5lcnJvcl9tc2csCiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpczIwLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlcnJvcl92YXJpYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICBfdGhpczIwLmlzZW1haWwgPSBmYWxzZTsKCiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlID09IHVuZGVmaW5lZCAmJiB0aGlzLmlzX3Bob25lX251bWJlcikgewogICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkpICE9IG51bGwpIHsKICAgICAgICAgIGlmICh0aGlzLmlzX3Bob25lX251bWJlcl9vdHAgPT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZHRzID0gdGhpcy50b19zZW5kOwogICAgICAgICAgICB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgc2VudDogdGhpcy50b19zZW5kLAogICAgICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICAgICAgdGltZTogdGhpcy5nZW5lcmF0ZV90aW1lKCksCiAgICAgICAgICAgICAgY29udmVyc2F0aW9uX29ubHk6IHRydWUsCiAgICAgICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgICAgIGRyb3Bkb3duOiAiIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSk7CgogICAgICAgICAgICBpZiAodGhpcy5pc19waG9uZV9udW1iZXJfZXJyX21zZykgewogICAgICAgICAgICAgIHZhciB4ID0gJCgiI2NoYXQiICsgKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSAtIDEpICsgIiA6aW5wdXQiKS5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpZiBsb29wIik7CiAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZWxzZSBsb29wIik7CiAgICAgICAgICAgICAgdmFyIHggPSAkKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkgKyAiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHgpOwogICAgICAgICAgICB2YXIgZHRzID0geFswXS52YWx1ZSArIHhbMV0udmFsdWU7CiAgICAgICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICBzZW50OiBkdHMsCiAgICAgICAgICAgICAgc2VuZGluZzogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICBkZWxpdmVyZWQ6IHRydWUsCiAgICAgICAgICAgICAgZHJvcGRvd246ICIiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSAvLyB0aGlzLmRpc2FibGVfbmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcigpOwogICAgICAgICAgLy8gdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY2hhdCIrKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZSsxKSk7CiAgICAgICAgICAvLyB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjY2hhdCIrKHRoaXMubGFzdGNsb3NlZGJvdGlucHV0bm9kZS0xKSsiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAgICAgICAvLyBpZih0aGlzLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGE9PW51bGwpewoKCiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudHlwaW5nLWluZGljYXRvciIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgdGhpcy5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0ge307CiAgICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jbG9zZWRfZm9ybV9yZXNwb25zZV9hcGkoKSwgewogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgY2hhdDogZHRzLAogICAgICAgICAgICBub2RlX3NlbGVjdGVkOiB0aGlzLnNlbGVjdGVkbm9kZWlkLAogICAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgICBib3RfbmFtZTogdGhpcy5ib3RfbmFtZQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jaGF0KTsKICAgICAgICAgICAgX3RoaXMyMC50b19zZW5kID0gIiI7CiAgICAgICAgICAgIHZhciBlcnJvcl92YXJpYWJsZSA9IG51bGw7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi50eXBpbmctaW5kaWNhdG9yIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCiAgICAgICAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IHJlc3BvbnNlLmRhdGEubm9kZXMubGVuZ3RoIC0gMTsgX2kzICs9IDEpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQudmFsaWRhdGUgPT0gInBob25lX251bWJlciIgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCAhPSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnZhbGlkYXRpb25fc3VjY2Vzc2Z1bCA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgX3RoaXMyMC5pc19waG9uZV9udW1iZXJfZXJyX21zZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgZXJyb3JfdmFyaWFibGUgPSBfaTM7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsgLy8gIHRoaXMuc2VsZWN0ZWRub2RlaWQgPSByZXNwb25zZS5kYXRhLm5vZGVzOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQuZXJyb3JfbXNnLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIG1zZyA9IHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQ6ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXgiPiA8c2VsZWN0IG5hbWU9ImNvdW50cnljb2RlIiBjbGFzcz0iZm9ybS1jb250cm9sIiBzdHlsZT0icGFkZGluZy1sZWZ0OjZweCAhaW1wb3J0YW50O3BhZGRpbmctcmlnaHQ6NnB4ICFpbXBvcnRhbnQ7IHdpZHRoOjQwJTtoZWlnaHQ6NTBweCAhaW1wb3J0YW50OyIgID4nIC8vIHJlY2VpdmVkOiAnJywKCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInJlYWNoZWQgaGVyZSIpOyAvLyB2YXIgZHJvcGRvd24gPSBbXTsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmRpc2FibGVfbmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcigpOwoKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gQ291bnRyeUNvZGVzOwogICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IHZvaWQgMDsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCBkYXRhLmxlbmd0aDsgX2k0KyspIHsKICAgICAgICAgICAgICAgICAgLy8gb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbi50ZXh0ID0gZGF0YVtpXS5jb3VudHJ5X2NvZGU7CiAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbi52YWx1ZSA9IGRhdGFbaV0uY2FsbGluZ19jb2RlOwogICAgICAgICAgICAgICAgICAvLyAvLyBkcm9wZG93bi5hZGQob3B0aW9uKTsKICAgICAgICAgICAgICAgICAgLy8gbXNnLnJlY2VpdmVkPW1zZy5yZWNlaXZlZCArIG9wdGlvbjsKICAgICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzxvcHRpb24gdmFsdWU9ICcgKyBkYXRhW19pNF0uZGlhbF9jb2RlICsgJz4nICsgZGF0YVtfaTRdLmNvZGUgKyAiKCIgKyBkYXRhW19pNF0uZGlhbF9jb2RlICsgIikiICsgJzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXNnLnJlY2VpdmVkID0gbXNnLnJlY2VpdmVkICsgJzwvc2VsZWN0Pic7CiAgICAgICAgICAgICAgICBtc2cucmVjZWl2ZWQgPSBtc2cucmVjZWl2ZWQgKyAnPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MTJweCAhaW1wb3J0YW50OyBoZWlnaHQ6NTBweCAhaW1wb3J0YW50OyIgYXV0b2NvbXBsZXRlPSJvZmYiIG5hbWU9InBob25lbnVtYmVyIiBpZD0gInBob25lbnVtYmVyIiBuYW1lPSJjbG9zZWRfYm90X25vZGVfJyArIF9pMyArICciPiAgPC9kaXY+JzsgLy8gY29uc29sZS5sb2cobXNnKTsKCiAgICAgICAgICAgICAgICBfdGhpczIwLmNoYXQucHVzaChtc2cpOyAvLyB0aGlzLmNoYXQucHVzaCh7CiAgICAgICAgICAgICAgICAvLyByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAvLyByZWNlaXZlZDogbWVzc2FnZS5ub2Rlc1tpXS51aV9lbGVtZW50Lm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAvLyBjb252ZXJzYXRpb25fb25seTogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vIHRpbWU6IG51bGwKICAgICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgICAgLy8gdGhpcy5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsKCgogICAgICAgICAgICAgICAgX3RoaXMyMC5yZWZyZXNoZWRfb3JfY2xvc2VkID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyMC5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgJCgnW25hbWU9JyArIF90aGlzMjAubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciArICddJykub2ZmKCdrZXl1cCcsIHZtLmFwcGVuZF9tZXNzYWdlX3RvX2NoYXRib3gpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzMjAubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciA9ICJwaG9uZW51bWJlciI7CiAgICAgICAgICAgICAgICB2YXIgdm0gPSBfdGhpczIwOwogICAgICAgICAgICAgICAgX3RoaXMyMC5sYXN0Y2xvc2VkYm90aW5wdXRub2RlID0gX3RoaXMyMC5jaGF0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF90aGlzMjAubGFzdGNsb3NlZGJvdGlucHV0bm9kZSk7CiAgICAgICAgICAgICAgICB2YXIgbGVuID0gJCgnW25hbWU9JyArIHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLmxlbmd0aDsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAvLyBpZih2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyICE9IG51bGwpewogICAgICAgICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpKQogICAgICAgICAgICAgICAgICAvLyAgIGlmKCQoJ1tuYW1lPScrdm0ubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lcisnXScpLmxlbmd0aD4xKXsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgY29uc29sZS5sb2coJCgnW25hbWU9Jyt2bS5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKyddJylbbGVuXSkKICAgICAgICAgICAgICAgICAgJCgnW25hbWU9JyArIHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpW2xlbl0uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB2bS5hcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94KTsgLy8gfWVsc2UgewoKICAgICAgICAgICAgICAgICAgJCgnW25hbWU9JyArIHZtLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpWzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdm0uYXBwZW5kX21lc3NhZ2VfdG9fY2hhdGJveCk7IC8vIH0KICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICAgICAgICBfdGhpczIwLnJlZnJlc2hlZF9vcl9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQudmFsaWRhdGUgIT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlID09ICJvdHAiICYmIHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS52YWxpZGF0aW9uX3N1Y2Nlc3NmdWwgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIF90aGlzMjAuc2VsZWN0ZWRub2RlaWQgPSByZXNwb25zZS5kYXRhLm5vZGVzW19pM107CiAgICAgICAgICAgICAgICBlcnJvcl92YXJpYWJsZSA9IF9pMzsKICAgICAgICAgICAgICAgIF90aGlzMjAuaXNfcGhvbmVfbnVtYmVyX290cCA9IHRydWU7CgogICAgICAgICAgICAgICAgX3RoaXMyMC5jaGF0LnB1c2goewogICAgICAgICAgICAgICAgICByZWNlaXZpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgIHJlY2VpdmVkOiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC5vdHBfcXVlc3Rpb25fbGFiZWwsCiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXS51aV9lbGVtZW50LnZhbGlkYXRlICE9IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udWlfZWxlbWVudC52YWxpZGF0ZSA9PSAib3RwIiAmJiByZXNwb25zZS5kYXRhLm5vZGVzW19pM10udmFsaWRhdGlvbl9zdWNjZXNzZnVsID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBfdGhpczIwLmNsb3NlZF9mb3JtX3JlcGx5X2RhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgX3RoaXMyMC5zZWxlY3RlZG5vZGVpZCA9IHJlc3BvbnNlLmRhdGEubm9kZXNbX2kzXTsKICAgICAgICAgICAgICAgIGVycm9yX3ZhcmlhYmxlID0gX2kzOwoKICAgICAgICAgICAgICAgIF90aGlzMjAuY2hhdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgcmVjZWl2aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICByZWNlaXZlZDogcmVzcG9uc2UuZGF0YS5ub2Rlc1tfaTNdLnVpX2VsZW1lbnQuaW5jb3JyZWN0X290cF9tc2csCiAgICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMjAucmVmcmVzaGVkX29yX2Nsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJyZWFjaGVkIGhlcmUyIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlcnJvcl92YXJpYWJsZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICAgICAgX3RoaXMyMC5kaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgoKICAgICAgICAgICAgICBfdGhpczIwLmlzX3Bob25lX251bWJlciA9IGZhbHNlOyAvLyB9LCAxKTsKCiAgICAgICAgICAgICAgX3RoaXMyMC5jbG9zZWRfYm90X2NoYXQocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOyAvLyB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gdW5kZWZpbmVkICYmICF0aGlzLmlzZm9ybW9uICYmICF0aGlzLmlzZW1haWwgJiYgIXRoaXMuaXNfcGhvbmVfbnVtYmVyICYmICF0aGlzLmlzX3RleHRfYXJlYSkgewogICAgICAgIHRoaXMuY2hhdC5wdXNoKHsKICAgICAgICAgIHNlbnQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIHNlbmRpbmc6IHRydWUsCiAgICAgICAgICB0aW1lOiB0aGlzLmdlbmVyYXRlX3RpbWUoKSwKICAgICAgICAgIGNvbnZlcnNhdGlvbl9vbmx5OiB0cnVlLAogICAgICAgICAgZGVsaXZlcmVkOiB0cnVlLAogICAgICAgICAgZHJvcGRvd246ICIiCiAgICAgICAgfSk7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMuY2xvc2VkX2Zvcm1fcmVzcG9uc2VfYXBpKCksIHsKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB1aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGNoYXQ6IHRoaXMudG9fc2VuZCwKICAgICAgICAgIG5vZGVfc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0ZWRub2RlaWQsCiAgICAgICAgICBjb252ZXJzYXRpb25faWQ6IHRoaXMuY29udmVyc2F0aW9uX2lkLAogICAgICAgICAgYm90X25hbWU6IHRoaXMuYm90X25hbWUKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnR5cGluZy1pbmRpY2F0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgX3RoaXMyMC5jbG9zZWRfZm9ybV9yZXBseV9kYXRhID0gbnVsbDsKCiAgICAgICAgICBfdGhpczIwLmNsb3NlZF9ib3RfY2hhdChyZXNwb25zZS5kYXRhKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGdldGRhdGE6IGZ1bmN0aW9uIGdldGRhdGEoKSB7CiAgICAgIGlmICghdGhpcy5pc2Zvcm1vbiAmJiAhdGhpcy5pc19waG9uZV9udW1iZXIpIHsKICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkKCIjY2hhdCIgKyAodGhpcy5sYXN0Y2xvc2VkYm90aW5wdXRub2RlIC0gMSkgKyAiIDppbnB1dCIpLnNlcmlhbGl6ZUFycmF5KCk7CiAgICAgICAgdGhpcy50b19zZW5kID0gJyc7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVlcnlTdHJpbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgdGhpcy50b19zZW5kID0gcXVlcnlTdHJpbmdbaV0udmFsdWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnRvX3NlbmQgPSB0aGlzLnRvX3NlbmQgKyAiLCIgKyBxdWVyeVN0cmluZ1tpXS52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYnV0dG9uX2ZpbGwoKTsKICAgIH0sCiAgICBhcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94OiBmdW5jdGlvbiBhcHBlbmRfbWVzc2FnZV90b19jaGF0Ym94KCkgewogICAgICBjb25zb2xlLmxvZyh0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIsIHRoaXMuaXNfcGhvbmVfbnVtYmVyKTsKICAgICAgY29uc29sZS5sb2coJCgnW25hbWU9JyArIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciArICddJykpOwoKICAgICAgaWYgKHRoaXMuaXNfdGV4dF9hcmVhKSB7CiAgICAgICAgdGhpcy50b19zZW5kID0gJCgnW25hbWU9JyArIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciArICddJylbMF0udmFsdWU7CiAgICAgICAgdGhpcy5idXR0b25fZmlsbCgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc19waG9uZV9udW1iZXIpIHsKICAgICAgICB2YXIgbGVuID0gJCgnW25hbWU9JyArIHRoaXMubmFtZV9lbGVtZW50X2Zvcl9ldmVudF9saXN0ZW5lciArICddJykubGVuZ3RoOwogICAgICAgIHRoaXMudG9fc2VuZCA9ICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpW2xlbiAtIDFdLnZhbHVlOwogICAgICB9CiAgICB9LAogICAgZGlzYWJsZV9uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyOiBmdW5jdGlvbiBkaXNhYmxlX25hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJXZSBhcmUgaGVyZSBkaXNhYmxlZCBmdW5jdGlvbiIpCiAgICAgICQoJ1tuYW1lPScgKyB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgKyAnXScpLmF0dHIoImRpc2FibGVkIiwgJ2Rpc2FibGVkJyk7IC8vICQoJ1tuYW1lPScrdGhpcy5uYW1lX2VsZW1lbnRfZm9yX2V2ZW50X2xpc3RlbmVyKyddJykucmVtb3ZlKCk7CgogICAgICB0aGlzLm5hbWVfZWxlbWVudF9mb3JfZXZlbnRfbGlzdGVuZXIgPSBudWxsOwoKICAgICAgaWYgKHRoaXMuaXNfcGhvbmVfbnVtYmVyKSB7CiAgICAgICAgJCgnW25hbWU9Y291bnRyeWNvZGVdJykuYXR0cigiZGlzYWJsZWQiLCAnZGlzYWJsZWQnKTsgLy8gJCgnW25hbWU9Y291bnRyeWNvZGVdJykucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBnb190b19kZXNpZ25fYm90c19wYWdlOiBmdW5jdGlvbiBnb190b19kZXNpZ25fYm90c19wYWdlKCkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2JvdC9kZXNpZ25ib3QnKTsKICAgIH0gLy9zZWxsIGZ1bmN0aW9uIGZvciBmb3JlaWduIGV4Y2hhbmdlCiAgICAvLyBleDIoKSB7CiAgICAvLyAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgLy8gICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicjIiKSAhPSBudWxsKSB7CiAgICAvLyAgICAgICAkKCIjbDIiKS52YWwoMSk7CiAgICAvLyAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY3VycmVuY3lleGNoYW5nZV9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICAgICAgICQoIiNjb3VudHJ5MiIpLmFwcGVuZCgKICAgIC8vICAgICAgICAgICBgPG9wdGlvbiB2YWx1ZT0iJHt0aGlzLmN1cnJlbmN5ZXhjaGFuZ2VfbGlzdFtpXS5jdXJyZW5jeV92YWx1ZX0iPiR7dGhpcy5jdXJyZW5jeWV4Y2hhbmdlX2xpc3RbaV0uY3VycmVuY3lfdGl0bGV9PC9vcHRpb24+YAogICAgLy8gICAgICAgICApOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgJCgiI3IyIikudmFsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb3VudHJ5MiIpLnZhbHVlKTsKICAgIC8vICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyMiIpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInIyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZTsKICAgIC8vICAgICAgICAgeCA9IHggLyBjb247CiAgICAvLyAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAvLyAgICAgICAgICQoIiNsMiIpLnZhbCh4KTsKICAgIC8vICAgICAgIH0pOwogICAgLy8gICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwyIikuYWRkRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBmdW5jdGlvbigpIHsKICAgIC8vICAgICAgICAgdmFyIHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibDIiKS52YWx1ZTsKICAgIC8vICAgICAgICAgdmFyIGNvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb3VudHJ5MiIpLnZhbHVlOwogICAgLy8gICAgICAgICB4ID0geCAqIGNvbjsKICAgIC8vICAgICAgICAgeCA9IHgudG9GaXhlZCg0KTsKICAgIC8vICAgICAgICAgJCgiI3IyIikudmFsKHgpOwogICAgLy8gICAgICAgfSk7CiAgICAvLyAgICAgICAkKGRvY3VtZW50KS5vbigiY2hhbmdlIiwgIiNjb3VudHJ5MiIsIGZ1bmN0aW9uKCkgewogICAgLy8gICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uKCl7CiAgICAvLyAgICAgICAgIHZhciB4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImwyIikudmFsdWU7CiAgICAvLyAgICAgICAgIHZhciBjb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY291bnRyeTIiKS52YWx1ZTsKICAgIC8vICAgICAgICAgeCA9IHggKiBjb247CiAgICAvLyAgICAgICAgIHggPSB4LnRvRml4ZWQoNCk7CiAgICAvLyAgICAgICAgICQoIiNyMiIpLnZhbCh4KTsKICAgIC8vICAgICAgIH0pOwogICAgLy8gICAgIH0KICAgIC8vICAgfSwgMzAwMCk7CiAgICAvLyB9CgogIH0KfTs="},null]}