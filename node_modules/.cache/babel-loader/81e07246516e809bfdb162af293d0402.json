{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Templates/WhatsappTemplate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Templates/WhatsappTemplate.vue","mtime":1663910265478},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgVnVlRWRpdG9yIH0gZnJvbSAidnVlMi1lZGl0b3IiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmltcG9ydCBNdWx0aXNlbGVjdCBmcm9tICJ2dWUtbXVsdGlzZWxlY3QiOwppbXBvcnQgVnVlUGhvbmVOdW1iZXJJbnB1dCBmcm9tICJ2dWUtcGhvbmUtbnVtYmVyLWlucHV0IjsKaW1wb3J0ICJ2dWUtcGhvbmUtbnVtYmVyLWlucHV0L2Rpc3QvdnVlLXBob25lLW51bWJlci1pbnB1dC5jc3MiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIldoYXRzYXBwVGVtcGxhdGVQYWdlIiwKICBjb21wb25lbnRzOiB7CiAgICBWdWVFZGl0b3I6IFZ1ZUVkaXRvciwKICAgIE11bHRpc2VsZWN0OiBNdWx0aXNlbGVjdCwKICAgIFZ1ZVBob25lTnVtYmVySW5wdXQ6IFZ1ZVBob25lTnVtYmVySW5wdXQKICB9LAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwgY2xvc2VfbW9kYWxdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjb250OiBbIklOIl0sCiAgICAgIHBlbmNpbF9zdmc6ICcgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVfbmFtZTogIiIsCiAgICAgIHNhdmVfc3ViamVjdDogIiIsCiAgICAgIGlzX3B1Ymxpc2hfdGVtcGxhdGU6IHRydWUsCiAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM6IG51bGwsCiAgICAgIGRlZmF1bHRfdGVtcGxhdGVsaXN0OiBbXSwKICAgICAgdGVtcGxhdGVsaXN0OiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgY3VycmVudF90ZW1wbGF0ZTogW10sCiAgICAgIG9sZF90ZW1wbGF0ZV9uYW1lOiAiIiwKICAgICAgaXNFZGl0VGVtcGxhdGU6IGZhbHNlLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgcHJldmlld190ZW1wbGF0ZV9kYXRhOiBudWxsLAogICAgICBwcmV2aWV3X3RlbXBsYXRlX2RhdGExOiB7CiAgICAgICAgSEVBREVSOiB7CiAgICAgICAgICB0eXBlOiAiSU1BR0UiLAogICAgICAgICAgYm9keTogImh0dHBzOi8vc3RvcmFnZS5jZW5zZS5haS9jb2RlYXJyYXkvY2Vuc2Vfd2Vic2l0ZV9zdGF0aWNfYXNzZXRzL3JldGFpbC9BdmFpbGFibGVEaXNjb3VudHMuc3ZnIgogICAgICAgIH0sCiAgICAgICAgQk9EWTogewogICAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgICAgYm9keTogIkhlbGxvIFdPcmxkIgogICAgICAgIH0sCiAgICAgICAgRk9PVEVSOiB7CiAgICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgICBib2R5OiAiV29ybGQsIGhlbGxvICEiCiAgICAgICAgfSwKICAgICAgICBCVVRUT046IHsKICAgICAgICAgIGJvZHk6IFt7CiAgICAgICAgICAgIHR5cGU6ICJVUkwiLAogICAgICAgICAgICBsYWJlbDogIktub3cgbW9yZSIsCiAgICAgICAgICAgIGJvZHk6ICJodHRwczovL3Rlc3QuY29tIgogICAgICAgICAgfSwgewogICAgICAgICAgICB0eXBlOiAiVVJMIiwKICAgICAgICAgICAgbGFiZWw6ICJLbm93IG1vcmUiLAogICAgICAgICAgICBib2R5OiAiaHR0cHM6Ly90ZXN0LmNvbSIKICAgICAgICAgIH1dCiAgICAgICAgfQogICAgICB9LAogICAgICB0ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3Q6IGZhbHNlLAogICAgICBlZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdDogZmFsc2UsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICBzZW5kX3RlbXBsYXRlX2FsbF9jdXN0b21lcjogdHJ1ZSwKICAgICAgY29udGFjdHNfbGlzdDogW10sCiAgICAgIGNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbjogMSwKICAgICAgY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uX2NvdW50OiAwLAogICAgICBicm9hZGNhc3RfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbjogMSwKICAgICAgYnJvYWRjYXN0X2xpc3Rfc2VhcmNoX3BhZ2luYXRpb25fY291bnQ6IDAsCiAgICAgIGJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb246IDEsCiAgICAgIGJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb25fY291bnQ6IDAsCiAgICAgIHNlYXJjaF9icm9hZGNhc3RfbmFtZTogIiIsCiAgICAgIGJyb2FkY2FzdF9saXN0OiBbXSwKICAgICAgc2VsZWN0X2Jyb2FkY2FzdF9saXN0OiBbXSwKICAgICAgc2VhcmNoX2N1c3RvbWVyOiAiIiwKICAgICAgc3BlY2lmaWNfY29udGFjdF9saXN0OiBbXSwKICAgICAgZGlzYWJsZV9idG5fZXhwaXJlZDogZmFsc2UsCiAgICAgIGNob29zZW5fdGVtcGxhdGU6IG51bGwsCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBhZGRfY3VzdG9tZXJfY29udGFjdF9udW1iZXI6IG51bGwsCiAgICAgIGFkZF9jdXN0b21lcl9uYW1lOiBudWxsLAogICAgICBwaG9uZU51bWJlcjogbnVsbCwKICAgICAgY3JlZGl0c19iYWxhbmNlOiBudWxsLAogICAgICBzZW5kX3RvOiAnc3BlY2lmaWMnLAogICAgICBjdXN0b21fdGVtcGxhdGVfdHlwZTogJ2ZpbGUnLAogICAgICByZWdfdmlkZW9fdXJsOiAvaHR0cHM6XC9cL1sod3d3XC4pP2EtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKFstYS16QS1aMC05QDolX1wrLn4jPyZcL1wvPV0qKS9pLAogICAgICByZWdfaW1hZ2U6IC8oaHR0cHM6XC9cLykoW15ccyhbIjwsPi9dKikoXC8pW15cc1siLD48XSooLnBuZ3wuanBnfC5qcGVnfC5naWYpKFw/W15cc1siLD48XSopPy8sCiAgICAgIGN1c3RvbV90ZW1wbGF0ZV9uYW1lOiAnJywKICAgICAgY3VzdG9tX3RleHRfYm94X2NvbnRlbnQ6ICcnLAogICAgICBjdXN0b21fdGVtcGxhdGVfb3B0aW9uOiAnJywKICAgICAgY3VzdG9tX3RlbXBsYXRlX2ltZ19maWxlOiBudWxsLAogICAgICBjdXN0b21fdGVtcGxhdGVfaW1nX2ZpbGVfbmFtZTogJycsCiAgICAgIGN1c3RvbV90ZW1wbGF0ZV92aWRlb19maWxlOiBudWxsLAogICAgICBjdXN0b21fdGVtcGxhdGVfdmlkZW9fZmlsZV9uYW1lOiAnJywKICAgICAgY3VzdG9tX3RlbXBsYXRlX2ltZ191cmw6ICcnLAogICAgICBjdXN0b21fdGVtcGxhdGVfdmlkZW9fdXJsOiAnJwogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBpc19ub3RpZmljYXRpb25fdGVtcGxhdGU6IEJvb2xlYW4KICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGNob29zZW5fdGVtcGxhdGU6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcih2YWwsIG9sZFZhbCkgewogICAgICAgIGlmICh0aGlzLmNob29zZW5fdGVtcGxhdGUgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5wcmV2aWV3X3RlbXBsYXRlKCJuZXciKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0sCiAgICBjdXJyZW50X3RlbXBsYXRlOiB7CiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIodmFsLCBvbGRWYWwpIHsKICAgICAgICBpZiAodGhpcy5jdXJyZW50X3RlbXBsYXRlLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICB0aGlzLnByZXZpZXdfdGVtcGxhdGUoIm9sZCIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDIwMDApOwogICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwoKICAgIGlmICh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSA9PT0gZmFsc2UpIHsKICAgICAgdGhpcy5sb2FkX2N1c3RvbWVyX2xpc3QoKTsKICAgICAgdGhpcy5nZXRfYnJvYWRjYXN0KCk7CiAgICB9CgogICAgdmFyIHZtID0gdGhpczsKICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKCiAgICAgIGlmICgkKHRoaXMpLmlzKCI6Y2hlY2tlZCIpKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB9CiAgICB9KTsKICAgIHZhciBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNsaXN0X2lkIik7CiAgICBlbC5vbndoZWVsID0gdGhpcy5oYW5kbGVXaGVlbDsKICAgIHZhciBlbDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjYnJvYWRjYXN0X2xpc3RfaWQiKTsKICAgIGVsMS5vbndoZWVsID0gdGhpcy5oYW5kbGVXaGVlbF9icm9hZGNhc3Q7CiAgfSwKICBtZXRob2RzOiB7CiAgICBoYW5kbGVXaGVlbF9icm9hZGNhc3Q6IGZ1bmN0aW9uIGhhbmRsZVdoZWVsX2Jyb2FkY2FzdChldmVudCwgZGF0YSwgZnVuYykgewogICAgICBpZiAoZXZlbnQuZGVsdGFZID4gMCkgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9icm9hZGNhc3RfbmFtZSAhPSAiIikgewogICAgICAgICAgaWYgKHRoaXMuYnJvYWRjYXN0X2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gPCB0aGlzLmJyb2FkY2FzdF9saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50KSB7CiAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gKz0gMTsKICAgICAgICAgICAgdGhpcy5zZWFyY2hfYnJvYWRjYXN0KHRoaXMuc2VhcmNoX2Jyb2FkY2FzdF9uYW1lLCAnc2Nyb2xsJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb24gPCB0aGlzLmJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb25fY291bnQpIHsKICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3RfcGFnaW5hdGlvbiArPSAxOwogICAgICAgICAgdGhpcy5nZXRfYnJvYWRjYXN0KCdzY3JvbGwnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVXaGVlbDogZnVuY3Rpb24gaGFuZGxlV2hlZWwoZXZlbnQsIGRhdGEsIGZ1bmMpIHsKICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDApIHsKICAgICAgICBpZiAodGhpcy5jb250YWN0c19saXN0X3BhZ2luYXRpb24gPCB0aGlzLmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbl9jb3VudCkgewogICAgICAgICAgdGhpcy5jb250YWN0c19saXN0X3BhZ2luYXRpb24gKz0gMTsKICAgICAgICAgIHRoaXMubG9hZF9jdXN0b21lcl9saXN0KCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9jdXN0b21lciAhPSAiIikgewogICAgICAgICAgdGhpcy5zZWFyY2hfY3VzdG9tZXJfbGlzdCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdldF9icm9hZGNhc3Q6IGZ1bmN0aW9uIGdldF9icm9hZGNhc3QodHlwZSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGlmICh0eXBlICE9PSAnc2Nyb2xsJykgewogICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3RfcGFnaW5hdGlvbiA9IDE7CiAgICAgIH0KCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICBwYWdlX25vOiB0aGlzLmJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb24sCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGFnZV9ubwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAodHlwZSAhPT0gJ3Njcm9sbCcpIHsKICAgICAgICAgIF90aGlzMi5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEuYnJvYWRjYXN0cykgewogICAgICAgICAgICBfdGhpczIuYnJvYWRjYXN0X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuYnJvYWRjYXN0c1tpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLmJyb2FkY2FzdF9saXN0X3BhZ2luYXRpb25fY291bnQgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXMyLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMyLmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMyLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlYXJjaF9icm9hZGNhc3Q6IGZ1bmN0aW9uIHNlYXJjaF9icm9hZGNhc3QocXVlcnksIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAocXVlcnkgIT0gIiIpIHsKICAgICAgICBpZiAodHlwZSAhPT0gJ3Njcm9sbCcpIHsKICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gPSAxOwogICAgICAgIH0KCiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgcGFnZV9ubzogdGhpcy5icm9hZGNhc3RfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiwKICAgICAgICAgIHNlYXJjaF9rZXk6IHF1ZXJ5LAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGFnZV9ubwogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmICh0eXBlICE9PSAnc2Nyb2xsJykgewogICAgICAgICAgICBfdGhpczMuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLmJyb2FkY2FzdHMpIHsKICAgICAgICAgICAgICBfdGhpczMuYnJvYWRjYXN0X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuYnJvYWRjYXN0c1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMy5icm9hZGNhc3RfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbl9jb3VudCA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMy5hcGlfc3RhdHVzX2NvZGUuTk9fV0hBVFNBUFBfVEVNUExBVEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMzLmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgX3RoaXMzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ2V0X2Jyb2FkY2FzdCgpOwogICAgICB9CiAgICB9LAogICAgYWRkX2N1c3RvbWVyOiBmdW5jdGlvbiBhZGRfY3VzdG9tZXIoKSB7CiAgICAgIGlmICh0aGlzLnBob25lTnVtYmVyICE9IG51bGwgJiYgdGhpcy5waG9uZU51bWJlci5pc1ZhbGlkID09IHRydWUpIHsKICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3QucHVzaCh7CiAgICAgICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6IHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyLAogICAgICAgICAgcHJvZmlsZV9uYW1lOiB0aGlzLnBob25lTnVtYmVyLmZvcm1hdHRlZE51bWJlcgogICAgICAgIH0pOwogICAgICAgIHRoaXMuc3BlY2lmaWNfY29udGFjdF9saXN0LnB1c2goewogICAgICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0aGlzLnBob25lTnVtYmVyLmZvcm1hdHRlZE51bWJlciwKICAgICAgICAgIHByb2ZpbGVfbmFtZTogdGhpcy5waG9uZU51bWJlci5mb3JtYXR0ZWROdW1iZXIKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBwaG9uZSBudW1iZXIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2FkZG9uc19iYWxhbmNlOiBmdW5jdGlvbiBjaGVja19hZGRvbnNfYmFsYW5jZSgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy5jaGVja19hZGRvbnNfYmFsYW5jZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNoZWNrX2JhbGFuY2U6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfdGhpczQuYXBpX3N0YXR1c19jb2RlLkNIRUNLX0JBTEFOQ0UuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgdmFyIHRlbXBsYXRlX2NvdW50ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNyZWRpdHMuc21zX2NvdW50OwogICAgICAgICAgX3RoaXM0LmNyZWRpdHNfYmFsYW5jZSA9ICJZb3VyIGN1cnJlbnQgU01TIGNyZWRpdHMgYXJlIDxzdHJvbmc+IGZvciBVUyByZWdpb24gOiIgKyB0ZW1wbGF0ZV9jb3VudC51cyArICIgfCBmb3IgTm9uLVVTIHJlZ2lvbjogIiArIHRlbXBsYXRlX2NvdW50Lm5vbl91cyArICI8L3N0cm9uZz4iOwogICAgICAgICAgJCgiI2NoZWNrYmFsYW5jZSIpLm1vZGFsKCJzaG93Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczQuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZTogZnVuY3Rpb24gY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICBjYWxsc2VhcmNoOiBmdW5jdGlvbiBjYWxsc2VhcmNoKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgX3RoaXM1LnRlbXBsYXRlbGlzdCA9IFtdOwoKICAgICAgICAgIGlmIChfdGhpczUuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM1LnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEudGVtcGxhdGVzOwoKICAgICAgICAgICAgaWYgKF90aGlzNS50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzNS5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczUubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgX3RoaXM1LnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICBfdGhpczUuc2V0cGFnaW5hdGlvbigxKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM1LmFwaV9zdGF0dXNfY29kZS5OT19XSEFUU0FQUF9URU1QTEFURS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzNS50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzNS5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczUuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNhdmVfdGVtcGxhdGU6IGZ1bmN0aW9uIHNhdmVfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMudGVtcGxhdGVfbmFtZSA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3RlbXBsYXRlX25hbWVfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY2hvb3Nlbl90ZW1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgdmFyIGNoZWNrID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnZhcmlhYmxlX2xpc3QpIHsKICAgICAgICAgIGlmICh0aGlzLmNob29zZW5fdGVtcGxhdGUudmFyaWFibGVfbGlzdFtpXSA9PSAiIikgewogICAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hlY2spIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndmFyaWFibGVfdmFsdWVfbXNnJyksCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID09IHRydWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB0ZW1wbGF0ZV9kZXRhaWxzID0gewogICAgICAgIHRlbXBsYXRlX25hbWU6IHRoaXMudGVtcGxhdGVfbmFtZSwKICAgICAgICBwYXJlbnRfdGVtcGxhdGVfaWQ6IHRoaXMuY2hvb3Nlbl90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICB2YXJpYWJsZV9kaWN0OiB0aGlzLmNob29zZW5fdGVtcGxhdGUudmFyaWFibGVfZGljdAogICAgICB9OyAvLyByZXR1cm47CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgdGVtcGxhdGVfZGV0YWlsczogdGVtcGxhdGVfZGV0YWlscwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICQoIiNhZGR0ZW1wbGF0ZW1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ3RlbXBsYXRlX2RhdGFfYWRkZWQnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBfdGhpczYuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICAgIF90aGlzNi5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczYuYXBpX3N0YXR1c19jb2RlLlBBUkVOVF9URU1QTEFURV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ3BhcmVudF90ZW1wbGF0ZV9ub3RfZm91bmQnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5VTlNVQ0NFU1NGVUxfREJfT1BFUkFUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczYudGx0KCdkYl9vcGVyYXRpb25fdW5zdWNjZXNzJyksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuVEVNUExBVEVfREVUQUlMU19NSVNTSU5HLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNi50bHQoJ3RlbXBsYXRlX2RldGFpbF9taXNzaW5nJyksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM2LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNsb3NlX21vZGFsKCdyZXNfbl9pbnRfc2F2ZScpOwogICAgfSwKICAgIGVkaXRfdGVtcGxhdGVfZGV0YWlsczogZnVuY3Rpb24gZWRpdF90ZW1wbGF0ZV9kZXRhaWxzKCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0VGVtcGxhdGUpIHsKICAgICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgIHRoaXMuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfdGVtcGxhdGU6IGZ1bmN0aW9uIGVkaXRfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF90ZW1wbGF0ZV9uYW1lX2JsYW5rJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgdmFyIGNoZWNrID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jdXJyZW50X3RlbXBsYXRlLnZhcmlhYmxlX2RpY3QpIHsKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfZGljdFtpXSA9PSAiIikgewogICAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hlY2spIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZWRpdF90ZW1wbGF0ZV92YWx1ZV9lbXB0eV9tc2cnKSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIHZhciB0ZW1wbGF0ZV9kZXRhaWxzID0gewogICAgICAgIHRlbXBsYXRlX25hbWU6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lLAogICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQsCiAgICAgICAgdmFyaWFibGVfZGljdDogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnZhcmlhYmxlX2RpY3QKICAgICAgfTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIHRlbXBsYXRlX2RldGFpbHM6IHRlbXBsYXRlX2RldGFpbHMsCiAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczcuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSkgewogICAgICAgICAgJCgiI2FkZHRlbXBsYXRlbW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogX3RoaXM3LnRsdCgnZWRpdF90ZW1wbGF0ZV9kYXRhX2VkaXRlZCcpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIF90aGlzNy5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgX3RoaXM3LmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSBfdGhpczcuYXBpX3N0YXR1c19jb2RlLlNFTEVDVEVEX1RFTVBMQVRFX05PVF9GT1VORC5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ2VkaXRfdGVtcGxhdGVfc2VsZWN0ZWRfdGVtcGxhdGUnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX09QRVJBVElPTi5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ2VkaXRfdGVtcGxhdGVfb3BlcmF0aW9uX3Vuc3VjY2Vzc2Z1bCcpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5URU1QTEFURV9ERVRBSUxTX01JU1NJTkcuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdlZGl0X3RlbXBsYXRlX2RldGFpbF9taXNzaW5nJyksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM3LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM3LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRfY3VzdG9tZXJfbGlzdDogZnVuY3Rpb24gbG9hZF9jdXN0b21lcl9saXN0KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGdldF9jb250YWN0c19saXN0OiB0cnVlLAogICAgICAgIHBlcl9wYWdlOiA1LAogICAgICAgIHBhZ2Vfbm86IHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5jb250YWN0c19saXN0KSB7CiAgICAgICAgICAgIF90aGlzOC5jb250YWN0c19saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzX2xpc3RbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzOC5jb250YWN0c19saXN0X3BhZ2luYXRpb25fY291bnQgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gX3RoaXM4LmFwaV9zdGF0dXNfY29kZS5OT19DT05UQUNUU19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM4LmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6IF90aGlzOC50bHQoJ3NvbWVfZXJyb3JfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczguc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXM4LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VhcmNoX2N1c3RvbWVyX2xpc3Q6IGZ1bmN0aW9uIHNlYXJjaF9jdXN0b21lcl9saXN0KHF1ZXJ5KSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKHF1ZXJ5ICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBnZXRfY29udGFjdHNfbGlzdDogdHJ1ZSwKICAgICAgICAgIHNlYXJjaF9rZXk6IHF1ZXJ5LAogICAgICAgICAgcGVyX3BhZ2U6IDUsCiAgICAgICAgICBwYWdlX25vOiAxCiAgICAgICAgfSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgfQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBfdGhpczkuY29udGFjdHNfbGlzdCA9IFtdOwogICAgICAgICAgX3RoaXM5LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmNvbnRhY3RzX2xpc3QpIHsKICAgICAgICAgICAgICBfdGhpczkuY29udGFjdHNfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0c19saXN0W2ldKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbl9jb3VudCA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuTk9fQ09OVEFDVFNfREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXM5LmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBfdGhpczkuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzOS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbiA9IDE7CiAgICAgICAgdGhpcy5jb250YWN0c19saXN0ID0gW107CiAgICAgICAgdGhpcy5sb2FkX2N1c3RvbWVyX2xpc3QoKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfdGVtcGxhdGU6IGZ1bmN0aW9uIHNlbmRfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHZhciBsaXN0ID0gW107CiAgICAgIHZhciBzZWxlY3RfbGlzdCA9IFtdOwoKICAgICAgaWYgKHRoaXMuc2VuZF90byA9PT0gJ3NwZWNpZmljJykgewogICAgICAgIGlmICh0aGlzLnNwZWNpZmljX2NvbnRhY3RfbGlzdC5sZW5ndGggIT0gMCkgewogICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNwZWNpZmljX2NvbnRhY3RfbGlzdCkgewogICAgICAgICAgICBsaXN0LnB1c2godGhpcy5zcGVjaWZpY19jb250YWN0X2xpc3RbaV0ud2hhdHNhcHBfcGhvbmVfbnVtYmVyKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnc2VuZF90ZW1wbGF0ZV9zZWxlY3RfY29udGFjdCcpLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNlbmRfdG8gPT09ICdicm9hZGNhc3QnKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0X2Jyb2FkY2FzdF9saXN0Lmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2VsZWN0X2Jyb2FkY2FzdF9saXN0KSB7CiAgICAgICAgICAgIHNlbGVjdF9saXN0LnB1c2godGhpcy5zZWxlY3RfYnJvYWRjYXN0X2xpc3RbaV0uaWQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdTZWxlY3QgYXRsZWFzdCBvbmUgYnJvYWRjYXN0JyksCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgdGVtcGxhdGVfaWQ6IHRoaXMuc2VuZF90byA9PT0gJ2Jyb2FkY2FzdCcgPyBbdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX2lkXSA6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICAgIGNvbnRhY3RzX2xpc3Q6IGxpc3QsCiAgICAgICAgICBicm9hZGNhc3RfaWRzOiBzZWxlY3RfbGlzdCwKICAgICAgICAgIHB1Ymxpc2hfdGVtcGxhdGU6IHRydWUsCiAgICAgICAgICBzZW5kX3RvOiB0aGlzLnNlbmRfdG8KICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9DT05UQUNUX0xJU1QuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9NRURJQV9TRU5EX0ZBSUxVUkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXMxMC50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMC5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyMzMDg1ZDYnLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfdGhpczEwLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF90aGlzMTAudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgX3RoaXMxMC4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICBuYW1lOiAnU2V0dGluZ3MnLAogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb246IHRydWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5TRU5ESU5HX1RFTVBMQVRFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzMTAudGx0KCdzZW5kX3RlbXBsYXRlX3NlbnRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMTAuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgICAgICQoIiNzZW5kdGVtcGxhdGUiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczEwLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9PUFRfT1VUX0NPTlRBQ1RTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogX3RoaXMxMC50bHQoJ0FsbF9jb250YWN0c19oYXZlX29wdGVkX291dF9vZl9nZXR0aW5nX3RlbXBsYXRlcycpLAogICAgICAgICAgICAgIHR5cGU6ICJlcm9vciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA0MDAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMxMC5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICAgICAgJCgiI3NlbmR0ZW1wbGF0ZSIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTAuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7IC8vICBsZXQgYnRuID1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VuZF90ZW1wbGF0ZSIpOwogICAgICAgIC8vICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoImRhdGEtZGlzbWlzcyIgLCAibW9kYWwiKTsKICAgICAgICAvLyAgICAgICAvLyAkKGAjJHtpZH1gKS5hdHRyKCJkYXRhLWRpc21pc3MiLCJtb2RhbCIpOyAKICAgICAgICAvLyAgICAgICBjb25zb2xlLmxvZygnYXR0YWNoZWQnICkKICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgLy8gICAgICAgICAgIC8vICQoYCMke2lkfWApLmF0dHIoImRhdGEtZGlzbWlzcyIsIm1vZGFsIik7IAogICAgICAgIC8vICAgICAgICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCJkYXRhLWRpc21pc3MiKTsKICAgICAgICAvLyAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZWQnKSAKICAgICAgICAvLyAgICAgICB9LDEwMCkKCiAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgic2VuZF90ZW1wbGF0ZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICB2YWxpZGF0ZV90ZW1wbGF0ZV9uYW1lOiBmdW5jdGlvbiB2YWxpZGF0ZV90ZW1wbGF0ZV9uYW1lKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGlzX3RlbXBsYXRlX25hbWVfZXhpc3RzOiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy50ZW1wbGF0ZV9uYW1lCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVEVNUExBVEVfTkFNRV9ET0VTX05PVF9FWElTVFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMS50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CgogICAgICAgICAgaWYgKF90aGlzMTEudGVtcGxhdGVfbmFtZSAhPSAiIikgey8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgIC8vICIxcHggc29saWQgZ3JlZW4iOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMS5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVEVNUExBVEVfTkFNRV9FWElTVFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxMS50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfdGVtcGxhdGVfbmFtZTogZnVuY3Rpb24gdmFsaWRhdGVfZWRpdF90ZW1wbGF0ZV9uYW1lKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfdGVtcGxhdGVfbmFtZV9leGlzdHM6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1RFTVBMQVRFX05BTUVfRE9FU19OT1RfRVhJU1RTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTIuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChfdGhpczEyLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZSAhPSAiIikgey8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAvLyAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVEVNUExBVEVfTkFNRV9FWElTVFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzMTIub2xkX3RlbXBsYXRlX25hbWUgPT0gX3RoaXMxMi5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUpIHsKICAgICAgICAgICAgX3RoaXMxMi5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMTIuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHByZXZpZXdfdGVtcGxhdGU6IGZ1bmN0aW9uIHByZXZpZXdfdGVtcGxhdGUodmFsKSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKCiAgICAgIGlmICh2YWwgPT0gIm9sZCIpIHsKICAgICAgICB2YXIgdGVtcGxhdGVfaWQgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQ7CiAgICAgICAgdmFyIHZhcmlhYmxlX2RpY3QgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfZGljdDsKICAgICAgICB2YXIgaXNfcGFyZW50X3RlbXBsYXRlID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodmFsID09ICJuZXciKSB7CiAgICAgICAgdmFyIHRlbXBsYXRlX2lkID0gdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnRlbXBsYXRlX2lkOwogICAgICAgIHZhciB2YXJpYWJsZV9kaWN0ID0gdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnZhcmlhYmxlX2RpY3Q7CiAgICAgICAgdmFyIGlzX3BhcmVudF90ZW1wbGF0ZSA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wbGF0ZV9pZCAhPSB1bmRlZmluZWQpIHsKICAgICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgIGlzX3ByZXZpZXc6IHRydWUsCiAgICAgICAgICBpc19wYXJlbnRfdGVtcGxhdGU6IGlzX3BhcmVudF90ZW1wbGF0ZSwKICAgICAgICAgIHRlbXBsYXRlX2lkOiB0ZW1wbGF0ZV9pZCwKICAgICAgICAgIHZhcmlhYmxlX2RpY3Q6IHZhcmlhYmxlX2RpY3QKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIF90aGlzMTMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgX3RoaXMxMy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGEuYm9keTsgLy8gJCgiI3ByZXZpZXdfdGVtcGxhdGVfdmlzaWJsZSIpLm1vZGFsKCJzaG93Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIF90aGlzMTMuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzMTMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX2VtYWlsX2NvbmZpcm1fcHJvbXB0X3RleHQ6IGZ1bmN0aW9uIHNlbmRfZW1haWxfY29uZmlybV9wcm9tcHRfdGV4dChhbGxfY3VzdG9tZXIpIHsKICAgICAgaWYgKGFsbF9jdXN0b21lcikgewogICAgICAgIHJldHVybiB0aGlzLnRsdCgnc2VuZF9idWxrX21zZycpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLnRsdCgnZW1haWxfdG9fc3BlY2lmaWNfY3VzdG9tZXInKTsKICAgICAgfQogICAgfSwKICAgIHNlbGVjdGVkX3RlbXBsYXRlczogZnVuY3Rpb24gc2VsZWN0ZWRfdGVtcGxhdGVzKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGVtcGxhdGVsaXN0KSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy50ZW1wbGF0ZWxpc3RbaV0udGVtcGxhdGVfaWQpOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICQoIiMiICsgW19pXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwoKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKGZ1bmN0aW9uICh0ZW1wbGF0ZXNfaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlc19pZCAhPSB2YWx1ZTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV90ZW1wbGF0ZTogZnVuY3Rpb24gZGVsZXRlX3RlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoIDwgMSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3NlbGVjdF9vbmVfdGVtcGxhdGUnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZV9saXN0OiB0aGlzLmNoZWNrZWRfbGlzdAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxNC5lbXB0eV92YXJpYWJsZSgpOwoKICAgICAgICBfdGhpczE0LmxvYWRfdGVtcGxhdGVzKCk7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTQuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTQuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxNC50bHQoJ3RlbXBsYXRlX2RlbGV0ZWRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gX3RoaXMxNC5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX09QRVJBVElPTi5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxNC5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczE0LnRsdCgncXVlcnlfZXhlY3V0ZWRfbXNnJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczE0LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE0LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbG9hZF90ZW1wbGF0ZXM6IGZ1bmN0aW9uIGxvYWRfdGVtcGxhdGVzKCkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB0aGlzLmN1cnJlbnRfdGVtcGxhdGUgPSB7fTsgLy8gR2V0IGRlZmF1bHQgdGVtcGxhdGVzCgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIGlzX2dldF9kZWZhdWx0X3RlbXBsYXRlczogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMTUuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTUuZGVmYXVsdF90ZW1wbGF0ZWxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuZGVmYXVsdF90ZW1wbGF0ZXM7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczE1LmFwaV9zdGF0dXNfY29kZS5OT19ERUZBVUxUX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTUuZGVmYXVsdF90ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMxNS5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOyAvLyBHZXQgU2F2ZWQgVGVtcGxhdGVzCgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczE1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczE1LmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxNS50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgIF90aGlzMTUudGVtcGxhdGVsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlczsKICAgICAgICAgIF90aGlzMTUubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgIF90aGlzMTUudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICBpZiAoX3RoaXMxNS50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBfdGhpczE1LnNob3dfdGVtcGxhdGUoMCk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMxNS5zZXRwYWdpbmF0aW9uKF90aGlzMTUucGFnZV9ubyk7CgogICAgICAgICAgX3RoaXMxNS5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczE1LmFwaV9zdGF0dXNfY29kZS5OT19XSEFUU0FQUF9URU1QTEFURS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXMxNS50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTUuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBwYWdlX3JlcXVpcmU6IGZ1bmN0aW9uIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkge30gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxNi50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgICAgICBfdGhpczE2LnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXM7CiAgICAgICAgICAgICAgX3RoaXMxNi5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIF90aGlzMTYudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzMTYudGVtcGxhdGVsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIF90aGlzMTYuc2hvd190ZW1wbGF0ZSgwKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzMTYuc2V0cGFnaW5hdGlvbihfdGhpczE2LnBhZ2Vfbm8pOwoKICAgICAgICAgICAgICBfdGhpczE2LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSBfdGhpczE2LmFwaV9zdGF0dXNfY29kZS5OT19XSEFUU0FQUF9URU1QTEFURS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzMTYudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpczE2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgICAgX3RoaXMxNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZQogICAgICAgICAgfSwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgX3RoaXMxNi5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgX3RoaXMxNi50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgICAgX3RoaXMxNi5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczE2LnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEudGVtcGxhdGVzOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxNi50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxNi5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMxNi5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIF90aGlzMTYudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgICAgX3RoaXMxNi5zZXRwYWdpbmF0aW9uKDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTYuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczE2LnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMTYuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgICAgICBfdGhpczE2LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uOiBmdW5jdGlvbiBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CgogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgNDsgX2kyKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMiArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTMgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgX2kzIDwgdGhpcy50b3RhbF9wYWdlczsgX2kzKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pMyArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCBwYWdlX25vICsgMzsgX2k0KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNCArIDEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k1ID0gcGFnZV9ubyAtIDQ7IF9pNSA8IHRoaXMudG90YWxfcGFnZXM7IF9pNSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChfaTUgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKCiAgICAgICAgZm9yICh2YXIgX2k2ID0gcGFnZV9ubyAtIDM7IF9pNiA8PSBwYWdlX25vICsgMzsgX2k2KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNik7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzczogZnVuY3Rpb24gcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X3RlbXBsYXRlOiBmdW5jdGlvbiBzaG93X3RlbXBsYXRlKGluZGV4KSB7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdKSk7CiAgICAgIHRoaXMub2xkX3RlbXBsYXRlX25hbWUgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZTsKICAgICAgdGhpcy5jdXJyZW50X3RlbXBsYXRlX2luZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgdGhpcy5wcmV2aWV3X3RlbXBsYXRlKCJvbGQiKTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZTogZnVuY3Rpb24gZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgdGhpcy5jaG9vc2VuX3RlbXBsYXRlID0gbnVsbDsKICAgICAgICB0aGlzLnNwZWNpZmljX2NvbnRhY3RfbGlzdCA9IFtdOwogICAgICAgIHRoaXMudGVtcGxhdGVfbmFtZSA9ICIiOwogICAgICAgIHRoaXMub2xkX3RlbXBsYXRlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLmN1c3RvbV90ZW1wbGF0ZV90eXBlID0gJ2ZpbGUnOwogICAgICAgIHRoaXMuY3VzdG9tX3RlbXBsYXRlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLmN1c3RvbV90ZXh0X2JveF9jb250ZW50ID0gIiI7CiAgICAgICAgdGhpcy5jdXN0b21fdGVtcGxhdGVfb3B0aW9uID0gIiI7CiAgICAgICAgdGhpcy5jdXN0b21fdGVtcGxhdGVfaW1nX2ZpbGUgPSBudWxsOwogICAgICAgIHRoaXMuY3VzdG9tX3RlbXBsYXRlX2ltZ19maWxlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLmN1c3RvbV90ZW1wbGF0ZV92aWRlb19maWxlID0gbnVsbDsKICAgICAgICB0aGlzLmN1c3RvbV90ZW1wbGF0ZV92aWRlb19maWxlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLmN1c3RvbV90ZW1wbGF0ZV9pbWdfdXJsID0gIiI7CiAgICAgICAgdGhpcy5jdXN0b21fdGVtcGxhdGVfdmlkZW9fdXJsID0gIiI7CgogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY3VzdG9taW1hZ2VmaWxlIikgIT0gbnVsbCAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY3VzdG9taW1hZ2VmaWxlIikudmFsdWUgIT0gIiIpIHsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b21pbWFnZWZpbGUiKS52YWx1ZSA9ICIiOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b212aWRlb2ZpbGUiKSAhPSBudWxsICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b212aWRlb2ZpbGUiKS52YWx1ZSAhPSAiIikgewogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbXZpZGVvZmlsZSIpLnZhbHVlID0gIiI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5jdXJyZW50X3RlbXBsYXRlLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICB0aGlzLnByZXZpZXdfdGVtcGxhdGUoIm9sZCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnByZXZpZXdfdGVtcGxhdGVfZGF0YSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2N1cnJlbnRfdGVtcGxhdGVfYWN0aXZlOiBmdW5jdGlvbiBjaGVja19jdXJyZW50X3RlbXBsYXRlX2FjdGl2ZShpbmRleCkgewogICAgICAvLyBjb25zb2xlLnRhYmxlKGluZGV4LCB0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0sIHRoaXMuY3VycmVudF90ZW1wbGF0ZSk7CiAgICAgIGlmIChCb29sZWFuKHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XSkgPT09IHRydWUpIHsKICAgICAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdLnRlbXBsYXRlX25hbWUgPT09IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lID8gImN1cnJlbnQtYWN0aXZlLXRlbXBsYXRlIiA6IG51bGw7CiAgICAgIH0KICAgIH0sCiAgICBleHBhbmRfdGV4dGJveDogZnVuY3Rpb24gZXhwYW5kX3RleHRib3goaWQsIGtleSkgewogICAgICB2YXIgdGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTsKICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHNjcm9sbF9oZWlnaHQgPSBlLnRhcmdldC5zY3JvbGxIZWlnaHQ7CiAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gIiIuY29uY2F0KHNjcm9sbF9oZWlnaHQsICJweCIpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGxvYWRfaW1hZ2VfY3VzdG9tX3RlbXA6IGZ1bmN0aW9uIHVwbG9hZF9pbWFnZV9jdXN0b21fdGVtcChlKSB7CiAgICAgIHZhciBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwoKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICB0aGlzLmN1c3RvbV90ZW1wbGF0ZV9pbWdfZmlsZV9uYW1lID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZV9pbWFnZShmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IGFuIEltYWdlIG9mIHR5cGUgUE5HIG9yIEpQRUciKTsKICAgICAgfQogICAgfSwKICAgIHVwbG9hZF92aWRlb19jdXN0b21fdGVtcDogZnVuY3Rpb24gdXBsb2FkX3ZpZGVvX2N1c3RvbV90ZW1wKGUpIHsKICAgICAgdmFyIGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CgogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIGxlc3MgdGhhbiAyTUIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJ2aWRlby9tcDQiKSB7CiAgICAgICAgdGhpcy5jdXN0b21fdGVtcGxhdGVfdmlkZW9fZmlsZV9uYW1lID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZV92aWRlbyhmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IGFuIFZpZGVvIG9mIHR5cGUgTVA0dXBsb2FkX2ltYWdlX2N1c3RvbV90ZW1wIik7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVfaW1hZ2U6IGZ1bmN0aW9uIGNyZWF0ZV9pbWFnZShmaWxlLCB0eXBlKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxNy5jdXN0b21fdGVtcGxhdGVfaW1nX2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKCiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGNyZWF0ZV92aWRlbzogZnVuY3Rpb24gY3JlYXRlX3ZpZGVvKGZpbGUsIHR5cGUpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE4LmN1c3RvbV90ZW1wbGF0ZV92aWRlb19maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CgogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBjaGVja192aWRlb191cmw6IGZ1bmN0aW9uIGNoZWNrX3ZpZGVvX3VybCh1cmwpIHsKICAgICAgaWYgKHRoaXMucmVnX3ZpZGVvX3VybC50ZXN0KHVybCkgPT09IHRydWUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19pbWdfdXJsOiBmdW5jdGlvbiBjaGVja19pbWdfdXJsKHVybCkgewogICAgICBpZiAodGhpcy5yZWdfaW1hZ2UudGVzdCh1cmwpID09PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAogICAgc2F2ZV9jdXN0b21lX3RlbXBsYXRlOiBmdW5jdGlvbiBzYXZlX2N1c3RvbWVfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnRlbXBsYXRlX25hbWUgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd0ZW1wbGF0ZV9uYW1lX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1c3RvbV90ZXh0X2JveF9jb250ZW50ID09ICIiIHx8IHRoaXMuY3VzdG9tX3RleHRfYm94X2NvbnRlbnQubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICdUZW1wbGF0ZSBib2R5IGNhbiBub3QgYmUgZW1wdHknLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1c3RvbV90ZW1wbGF0ZV9pbWdfZmlsZSA9PSBudWxsICYmIHRoaXMuY3VzdG9tX3RlbXBsYXRlX3ZpZGVvX2ZpbGUgPT0gbnVsbCAmJiB0aGlzLmN1c3RvbV90ZW1wbGF0ZV9vcHRpb24gIT0gIiIgJiYgdGhpcy5jdXN0b21fdGVtcGxhdGVfdHlwZSA9PSAnZmlsZScpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICdQbGVhc2UgY2hvb3NlIGEgZmlsZScsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY3VzdG9tX3RlbXBsYXRlX2ltZ191cmwgPT0gIiIgJiYgdGhpcy5jdXN0b21fdGVtcGxhdGVfdmlkZW9fdXJsID09ICIiICYmIHRoaXMuY3VzdG9tX3RlbXBsYXRlX29wdGlvbiAhPSAiIiAmJiB0aGlzLmN1c3RvbV90ZW1wbGF0ZV90eXBlICE9ICdmaWxlJykgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogJ1BsZWFzZSBlbnRlciB2YWxpZCB1cmwnLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmN1c3RvbV90ZW1wbGF0ZV90eXBlID09ICd1cmwnKSB7CiAgICAgICAgdmFyIGlzX3ZpZGVvX3VybF92YWxpZCA9IHRoaXMuY2hlY2tfdmlkZW9fdXJsKHRoaXMuY3VzdG9tX3RlbXBsYXRlX3ZpZGVvX3VybCk7CiAgICAgICAgdmFyIGlzX2ltZ191cmxfdmFsaWQgPSB0aGlzLmNoZWNrX2ltZ191cmwodGhpcy5jdXN0b21fdGVtcGxhdGVfaW1nX3VybCk7CgogICAgICAgIGlmIChpc192aWRlb191cmxfdmFsaWQgIT0gdHJ1ZSAmJiBpc19pbWdfdXJsX3ZhbGlkICE9IHRydWUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiAnUGxlYXNlIGVudGVyIHZhbGlkIHVybCcsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHRlbXBsYXRlX2RldGFpbHMgPSB7CiAgICAgICAgaXNfZmlsZV90eXBlOiB0aGlzLmN1c3RvbV90ZW1wbGF0ZV9vcHRpb24sCiAgICAgICAgaXNfZmlsZTogdGhpcy5jdXN0b21fdGVtcGxhdGVfdHlwZSA9PSAiZmlsZSIgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy50ZW1wbGF0ZV9uYW1lLAogICAgICAgIHRlbXBsYXRlX2JvZHk6IHRoaXMuY3VzdG9tX3RleHRfYm94X2NvbnRlbnQsCiAgICAgICAgY3VzdG9tX3RlbXBsYXRlX2ltZ19maWxlOiB0aGlzLmN1c3RvbV90ZW1wbGF0ZV9pbWdfZmlsZSwKICAgICAgICBjdXN0b21fdGVtcGxhdGVfaW1nX2ZpbGVfbmFtZTogdGhpcy5jdXN0b21fdGVtcGxhdGVfaW1nX2ZpbGVfbmFtZSwKICAgICAgICBjdXN0b21fdGVtcGxhdGVfdmlkZW9fZmlsZTogdGhpcy5jdXN0b21fdGVtcGxhdGVfdmlkZW9fZmlsZSwKICAgICAgICBjdXN0b21fdGVtcGxhdGVfdmlkZW9fZmlsZV9uYW1lOiB0aGlzLmN1c3RvbV90ZW1wbGF0ZV92aWRlb19maWxlX25hbWUsCiAgICAgICAgY3VzdG9tX3RlbXBsYXRlX2ltZ191cmw6IHRoaXMuY3VzdG9tX3RlbXBsYXRlX2ltZ191cmwsCiAgICAgICAgY3VzdG9tX3RlbXBsYXRlX3ZpZGVvX3VybDogdGhpcy5jdXN0b21fdGVtcGxhdGVfdmlkZW9fdXJsCiAgICAgIH07CiAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VzdG9tX3RlbXBsYXRlX2ltZ19maWxlLCB0ZW1wbGF0ZV9kZXRhaWxzKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfY3VzdG9tX3RlbXBsYXRlOiB0cnVlLAogICAgICAgIHRlbXBsYXRlX2RldGFpbHM6IHRlbXBsYXRlX2RldGFpbHMKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTkuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgJCgiI2FkZGN1c3RvbXRlbXBsYXRlIikubW9kYWwoImhpZGUiKTsKCiAgICAgICAgaWYgKF90aGlzMTkuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogX3RoaXMxOS50bHQoJ3RlbXBsYXRlX2RhdGFfYWRkZWQnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICBfdGhpczE5LmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgICBfdGhpczE5LmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTkuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogX3RoaXMxOS50bHQoJ2RiX29wZXJhdGlvbl91bnN1Y2Nlc3MnKSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxOS5hcGlfc3RhdHVzX2NvZGUuVEVNUExBVEVfREVUQUlMU19NSVNTSU5HLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzMTkudGx0KCd0ZW1wbGF0ZV9kZXRhaWxfbWlzc2luZycpLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzMTkuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczE5LnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICQoIiNhZGRjdXN0b210ZW1wbGF0ZSIpLm1vZGFsKCJoaWRlIik7CgogICAgICAgIF90aGlzMTkuZW1wdHlfdmFyaWFibGUoKTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczE5LiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2xvc2VfbW9kYWwoImN1c3RvbV90ZW1wbGF0ZV9zYXZlIik7CiAgICB9CiAgfQp9Ow=="},null]}