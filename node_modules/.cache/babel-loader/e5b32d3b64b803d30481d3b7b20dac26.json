{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js!/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Templates/SmsTemplates.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Templates/SmsTemplates.vue","mtime":1663910265478},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgVnVlRWRpdG9yIH0gZnJvbSAidnVlMi1lZGl0b3IiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CmltcG9ydCBNdWx0aXNlbGVjdCBmcm9tICJ2dWUtbXVsdGlzZWxlY3QiOwppbXBvcnQgVnVlUGhvbmVOdW1iZXJJbnB1dCBmcm9tICd2dWUtcGhvbmUtbnVtYmVyLWlucHV0JzsKaW1wb3J0ICd2dWUtcGhvbmUtbnVtYmVyLWlucHV0L2Rpc3QvdnVlLXBob25lLW51bWJlci1pbnB1dC5jc3MnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlNtc1RlbXBsYXRlUGFnZSIsCiAgY29tcG9uZW50czogewogICAgVnVlRWRpdG9yOiBWdWVFZGl0b3IsCiAgICBNdWx0aXNlbGVjdDogTXVsdGlzZWxlY3QsCiAgICBWdWVQaG9uZU51bWJlcklucHV0OiBWdWVQaG9uZU51bWJlcklucHV0CiAgfSwKICBtaXhpbnM6IFtmcmVlemVfcG9ydGFsLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwsIGNsb3NlX21vZGFsXSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGVuY2lsX3N2ZzogJyA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE1LjU0NiIgaGVpZ2h0PSIxNS40NjEiIHZpZXdCb3g9IjAgMCAxNS41NDYgMTUuNDYxIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojOWU5ZTllO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzQ3Ljg4OCAtMzU2Ljc2OSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNzU5LjQxNiwzNTYuNzY5YTIuMzU4LDIuMzU4LDAsMCwxLDEuNzc3LjY2MmMuNTM0LjUxMywxLjA3MiwxLjAyNSwxLjU2NywxLjU3NWEyLjMsMi4zLDAsMCwxLS4wNzEsMy4zMjVjLTIuNzM2LDIuNzYtNS40OTQsNS41LTguMjM4LDguMjUxYTEuMzgxLDEuMzgxLDAsMCwxLS43NTguMjg4Yy0uNzE5LjE3NC0xLjQyOS4zNzktMi4xNDQuNTcyLS45MzIuMjUxLTEuODYyLjUtMi43OTUuNzUxLS42LjE1OC0uOTg5LS4yMTMtLjgzMi0uODA3cS42ODktMi41OTUsMS40MDYtNS4xODJhMS4xNjQsMS4xNjQsMCwwLDEsLjI4OS0uNDg3cTQuMDkxLTQuMTA3LDguMi04LjJBMi4yNjUsMi4yNjUsMCwwLDEsNzU5LjQxNiwzNTYuNzY5Wm0tMS45ODksMi45NTYtNi41NCw2LjUzOCwzLjAyNSwzLjAyNCw2LjUzOC02LjUzN1ptNC4wMjMsMi4xNjVjLjExOC0uMTM1LjIyNS0uMjY5LjM0My0uMzkyYTEuMTM0LDEuMTM0LDAsMCwwLDAtMS43MzRjLS40Ni0uNDY2LS45MjYtLjkyNS0xLjM4OC0xLjM5YTEuMTY2LDEuMTY2LDAsMCwwLS44NjEtLjM2OGMtLjU3OCwwLS44ODEuNC0xLjIxNC43NlptLTEyLjA4NCw4Ljg2MywzLjItLjg2My0yLjMzNy0yLjMzMVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDApIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik04MTMuOTQyLDQyMi42bC0uNzg5LS44LDMuODIxLTMuODE5Ljc4NC44WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU5LjY0OCAtNTUuOTQ3KSIvPjwvZz48L3N2Zz4nLAogICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICB0ZW1wbGF0ZV9uYW1lOiAiIiwKICAgICAgc2F2ZV9zbXM6ICIiLAogICAgICBpc19zbXM6IGZhbHNlLAogICAgICBpc19lbWFpbDogdHJ1ZSwKICAgICAgc2F2ZV9zdWJqZWN0OiAiIiwKICAgICAgaXNfcHVibGlzaF9zbXM6IHRydWUsCiAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM6IG51bGwsCiAgICAgIGRlZmF1bHRfdGVtcGxhdGVsaXN0OiBbXSwKICAgICAgdGVtcGxhdGVsaXN0OiBbXSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgY3VycmVudF90ZW1wbGF0ZTogW10sCiAgICAgIG9sZF90ZW1wbGF0ZV9uYW1lOiAiIiwKICAgICAgaXNFZGl0VGVtcGxhdGU6IGZhbHNlLAogICAgICBudW1iZXJfb2Zfcm93czogbnVsbCwKICAgICAgdG90YWxfcGFnZXM6IG51bGwsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgcHJldmlld190ZW1wbGF0ZV9kYXRhOiAiIiwKICAgICAgdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0OiBmYWxzZSwKICAgICAgZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3Q6IGZhbHNlLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgc2VuZF9zbXNfYWxsX2N1c3RvbWVyOiB0cnVlLAogICAgICBjdXN0b21lcnNfbGlzdDogW10sCiAgICAgIHNwZWNpZmljX2N1c3RvbWVyX2xpc3Q6IFtdLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZSwKICAgICAgLy8gY3VycmVudF9zdGVwOiAxLAogICAgICBjaG9vc2VuX3RlbXBsYXRlOiBudWxsLAogICAgICBpc1Zpc2libGVTZWFyY2hDbGVhcjogZmFsc2UsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgYWRkX2N1c3RvbWVyX2NvbnRhY3RfbnVtYmVyOiBudWxsLAogICAgICBhZGRfY3VzdG9tZXJfbmFtZTogbnVsbCwKICAgICAgcGhvbmVOdW1iZXI6IG51bGwsCiAgICAgIGNyZWRpdHNfYmFsYW5jZTogbnVsbAogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBpc19ub3RpZmljYXRpb25fdGVtcGxhdGU6IEJvb2xlYW4KICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZTogZnVuY3Rpb24gc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDIwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIlNtc1RlbXBsYXRlUGFnZURpc2FibGVkIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHsKICAgICAgICBfdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmxvYWRfdGVtcGxhdGVzKCk7CgogICAgaWYgKHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlID09PSBmYWxzZSkgewogICAgICB0aGlzLmxvYWRfY3VzdG9tZXJfbGlzdCgpOwogICAgfQoKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgIHRoaXMuaXNfc21zID0gZmFsc2U7CiAgICAgIHRoaXMuaXNfZW1haWwgPSB0cnVlOwoKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgbWV0aG9kczogewogICAgYWRkX2N1c3RvbWVyOiBmdW5jdGlvbiBhZGRfY3VzdG9tZXIoKSB7CiAgICAgIGlmICh0aGlzLnBob25lTnVtYmVyLmlzVmFsaWQgPT0gdHJ1ZSAmJiB0aGlzLmFkZF9jdXN0b21lcl9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5jdXN0b21lcnNfbGlzdC5wdXNoKHsKICAgICAgICAgICdwaG9uZSc6IHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyLAogICAgICAgICAgJ2NvdW50cnknOiB0aGlzLnBob25lTnVtYmVyLmNvdW50cnlDb2RlLAogICAgICAgICAgJ2N1c3RvbWVyX25hbWUnOiB0aGlzLmFkZF9jdXN0b21lcl9uYW1lCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5zcGVjaWZpY19jdXN0b21lcl9saXN0LnB1c2goewogICAgICAgICAgJ3Bob25lJzogdGhpcy5waG9uZU51bWJlci5mb3JtYXR0ZWROdW1iZXIsCiAgICAgICAgICAnY291bnRyeSc6IHRoaXMucGhvbmVOdW1iZXIuY291bnRyeUNvZGUsCiAgICAgICAgICAnY3VzdG9tZXJfbmFtZSc6IHRoaXMuYWRkX2N1c3RvbWVyX25hbWUKICAgICAgICB9KTsKICAgICAgICB0aGlzLmFkZF9jdXN0b21lcl9uYW1lID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc21zX3RlbXBsYXRlX3ZhbGlkX3Bob25lX25vJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfYWRkb25zX2JhbGFuY2U6IGZ1bmN0aW9uIGNoZWNrX2FkZG9uc19iYWxhbmNlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmNoZWNrX2FkZG9uc19iYWxhbmNlKCksIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY2hlY2tfYmFsYW5jZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKF90aGlzMi5hcGlfc3RhdHVzX2NvZGUuQ0hFQ0tfQkFMQU5DRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICB2YXIgdGVtcGxhdGVfY291bnQgPSByZXNwb25zZS5kYXRhLmRhdGEuY3JlZGl0cy5zbXNfY291bnQ7CiAgICAgICAgICBfdGhpczIuY3JlZGl0c19iYWxhbmNlID0gIllvdXIgY3VycmVudCBTTVMgY3JlZGl0cyBhcmUgPHN0cm9uZz4gZm9yIFVTIHJlZ2lvbiA6IiArIHRlbXBsYXRlX2NvdW50LnVzICsgIiB8IGZvciBOb24tVVMgcmVnaW9uOiAiICsgdGVtcGxhdGVfY291bnQubm9uX3VzICsgIjwvc3Ryb25nPiI7CiAgICAgICAgICAkKCIjY2hlY2tiYWxhbmNlIikubW9kYWwoInNob3ciKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lOiBmdW5jdGlvbiBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGNhbGxzZWFyY2g6IGZ1bmN0aW9uIGNhbGxzZWFyY2goKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfc21zKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgX3RoaXMzLnRlbXBsYXRlbGlzdCA9IFtdOwoKICAgICAgICAgIGlmIChfdGhpczMuYXBpX3N0YXR1c19jb2RlLk5PX1NNU19URU1QTEFURV9NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMzLmFwaV9zdGF0dXNfY29kZS5URU1QTEFURV9TRUFSQ0hfUkVTVUxUX01PREVMUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIF90aGlzMy50ZW1wbGF0ZWxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEudGVtcGxhdGVzOwoKICAgICAgICAgICAgaWYgKF90aGlzMy50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzMy5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIF90aGlzMy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKCiAgICAgICAgICAgIF90aGlzMy5zZXRwYWdpbmF0aW9uKF90aGlzMy5wYWdlX25vKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgX3RoaXMzLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICBfdGhpczMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX3RlbXBsYXRlOiBmdW5jdGlvbiBzYXZlX3RlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnRlbXBsYXRlX25hbWUgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdzbXNfdGVtcGxhdGVfbmFtZV9ibGFua19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5jaG9vc2VuX3RlbXBsYXRlID09IG51bGwpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2Ugc2VsZWN0IHRoZSB0ZW1wbGF0ZSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY2hvb3Nlbl90ZW1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgdmFyIGNoZWNrID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnZhcmlhYmxlX2xpc3QpIHsKICAgICAgICAgIGlmICh0aGlzLmNob29zZW5fdGVtcGxhdGUudmFyaWFibGVfbGlzdFtpXSA9PSAiIikgewogICAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY2hlY2spIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc21zX3RlbXBsYXRlX3ZhbHVlc19jYW5ub3RfYmxhbmsnKSwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICB2YXIgdGVtcGxhdGVfZGV0YWlscyA9IHsKICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLnRlbXBsYXRlX25hbWUsCiAgICAgICAgcGFyZW50X3RlbXBsYXRlX2lkOiB0aGlzLmNob29zZW5fdGVtcGxhdGUudGVtcGxhdGVfaWQsCiAgICAgICAgdGVtcGxhdGVfYm9keTogdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnRlbXBsYXRlX2JvZHksCiAgICAgICAgdmFyaWFibGVfbGlzdDogdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnZhcmlhYmxlX2xpc3QsCiAgICAgICAgdGVtcGxhdGVfZXhhbXBsZTogdGhpcy5jaG9vc2VuX3RlbXBsYXRlLnRlbXBsYXRlX2V4YW1wbGUKICAgICAgfTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfc21zKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19zYXZlOiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgdGVtcGxhdGVfZGV0YWlsczogdGVtcGxhdGVfZGV0YWlscwogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoX3RoaXM0LmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICQoIiNhZGR0ZW1wbGF0ZW1vZGVsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHRleHQ6IF90aGlzNC50bHQoJ3RlbXBsYXRlX2RhdGFfYWRkZWRfbXNnJyksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgX3RoaXM0LmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgICBfdGhpczQubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXM0LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczQuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzNC5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczQuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM0LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNsb3NlX21vZGFsKCdyZXNfbl9pbnRfc2F2ZScpOwogICAgfSwKICAgIGVkaXRfdGVtcGxhdGVfZGV0YWlsczogZnVuY3Rpb24gZWRpdF90ZW1wbGF0ZV9kZXRhaWxzKCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0VGVtcGxhdGUpIHsKICAgICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgIHRoaXMuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGVkaXRfdGVtcGxhdGU6IGZ1bmN0aW9uIGVkaXRfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc21zX2VkaXRfdGVtcGxhdGVfbmFtZV9ibGFua19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5jdXJyZW50X3RlbXBsYXRlICE9IG51bGwpIHsKICAgICAgICB2YXIgY2hlY2sgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfbGlzdCkgewogICAgICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZS52YXJpYWJsZV9saXN0W2ldID09ICIiKSB7CiAgICAgICAgICAgIGNoZWNrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjaGVjaykgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdzbXNfZWRpdF90ZW1wbGF0ZV92YWx1ZXNfY2Fubm90X2JsYW5rJyksCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICB2YXIgdGVtcGxhdGVfZGV0YWlscyA9IHsKICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZSwKICAgICAgICBwYXJlbnRfdGVtcGxhdGVfaWQ6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS5wYXJlbnRfdGVtcGxhdGVfaWQsCiAgICAgICAgdGVtcGxhdGVfaWQ6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICB0ZW1wbGF0ZV9ib2R5OiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfYm9keSwKICAgICAgICB2YXJpYWJsZV9saXN0OiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfbGlzdCwKICAgICAgICB0ZW1wbGF0ZV9leGFtcGxlOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfZXhhbXBsZQogICAgICB9OwogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9zbXMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIHRlbXBsYXRlX2RldGFpbHM6IHRlbXBsYXRlX2RldGFpbHMsCiAgICAgICAgdGVtcGxhdGVfaWQ6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICBpc19lZGl0OiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzNS5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAkKCIjYWRkdGVtcGxhdGVtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB0ZXh0OiBfdGhpczUudGx0KCd0ZW1wbGF0ZV9kYXRhX2VkaXRfbXNnJyksCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgX3RoaXM1LmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgICAgICBfdGhpczUubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXM1LmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczUuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzNS5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczUuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM1LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNS4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIC8vIGNoYW5nZV9zdGVwKHZhbCkgewogICAgLy8gICBpZiAodmFsID09IDIgJiYgQm9vbGVhbih0aGlzLmNob29zZW5fdGVtcGxhdGUpICE9IGZhbHNlKXsKICAgIC8vICAgICB0aGlzLmN1cnJlbnRfc3RlcCA9IDIKICAgIC8vICAgfWVsc2UgaWYodmFsID09IDEpIHsKICAgIC8vICAgICB0aGlzLmN1cnJlbnRfc3RlcCA9IDEKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICBTd2FsKHsKICAgIC8vICAgICAgIHRleHQ6IHRoaXMudGx0KCdzZWxlY3RfdGVtcGxhdGVfbXNnJyksCiAgICAvLyAgICAgICB0b2FzdDogdHJ1ZSwKICAgIC8vICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAvLyAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAvLyAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAvLyAgICAgICB0aW1lcjogMjUwMCwKICAgIC8vICAgICB9KTsKICAgIC8vICAgfQogICAgLy8gfSwKICAgIGxvYWRfY3VzdG9tZXJfbGlzdDogZnVuY3Rpb24gbG9hZF9jdXN0b21lcl9saXN0KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfc21zKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBnZXRfY3VzdG9tZXJzX2xpc3Q6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzNi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzNi5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzNi5jdXN0b21lcnNfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jdXN0b21lcl9saXN0OwogICAgICAgIH0gZWxzZSBpZiAoX3RoaXM2LmFwaV9zdGF0dXNfY29kZS5OT19DVVNUT01FUl9EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM2LmN1c3RvbWVyc19saXN0ID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXM2LnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzNi4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbmRfc21zOiBmdW5jdGlvbiBzZW5kX3NtcygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCkgewogICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgdGVtcGxhdGVfaWQ6IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pZCwKICAgICAgICAgIHNlbmRfc21zX2FsbF9jdXN0b21lcjogdGhpcy5zZW5kX3Ntc19hbGxfY3VzdG9tZXIsCiAgICAgICAgICBzcGVjaWZpY19jdXN0b21lcnNfbGlzdDogdGhpcy5zcGVjaWZpY19jdXN0b21lcl9saXN0LAogICAgICAgICAgc2VuZF9zbXM6IHRydWUKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLlNNU19URU1QTEFURV9OT1RfRk9VTkRfTU9ERUxTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzNy50bHQoJ3NlbmRfc21zX2NyZWRpdDEnKSwKICAgICAgICAgICAgICB0ZXh0OiBfdGhpczcudGx0KCdub19jcmVkaXRzX2xlZnRfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5OT19DVVNUT01FUl9EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXM3LmFwaV9zdGF0dXNfY29kZS5OT05fVVNfU01TX0NSRURJVFNfRVhDRUVEU19NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogX3RoaXM3LnRsdCgnc2VuZF9zbXNfY3JlZGl0MScpLAogICAgICAgICAgICAgIHRleHQ6IF90aGlzNy50bHQoJ25vX2NyZWRpdHNfbGVmdF9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzNy5hcGlfc3RhdHVzX2NvZGUuU0VORElOR19TTVNfTU9ERUxTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IF90aGlzNy50bHQoJ3Ntc19pc19zZW50X21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzNy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczcuYXBpX3N0YXR1c19jb2RlLlVTX1NNU19DUkVESVRTX0VYQ0VFRFNfTU9ERUxTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICAgIF90aGlzNy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CgogICAgICB0aGlzLmNsb3NlX21vZGFsKCdzYXZlX3Ntc19idXR0b24nKTsKICAgIH0sCiAgICB2YWxpZGF0ZV90ZW1wbGF0ZV9uYW1lOiBmdW5jdGlvbiB2YWxpZGF0ZV90ZW1wbGF0ZV9uYW1lKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfdGVtcGxhdGVfbmFtZV9leGlzdHM6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLnRlbXBsYXRlX25hbWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChfdGhpczguYXBpX3N0YXR1c19jb2RlLlNNU19URU1QTEFURV9OQU1FX0RPRVNfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgX3RoaXM4LnRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKCiAgICAgICAgICBpZiAoX3RoaXM4LnRlbXBsYXRlX25hbWUgIT0gIiIpIHsvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAvLyAiMXB4IHNvbGlkIGdyZWVuIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKF90aGlzOC5hcGlfc3RhdHVzX2NvZGUuU01TX1RFTVBMQVRFX05BTUVfRVhJU1RTX01PREVMUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczgudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gdHJ1ZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9ICIxcHggc29saWQgcmVkIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzOC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfdGVtcGxhdGVfbmFtZTogZnVuY3Rpb24gdmFsaWRhdGVfZWRpdF90ZW1wbGF0ZV9uYW1lKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgaXNfdGVtcGxhdGVfbmFtZV9leGlzdHM6IHRydWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZQogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKF90aGlzOS5hcGlfc3RhdHVzX2NvZGUuU01TX1RFTVBMQVRFX05BTUVfRE9FU19OT1RfRVhJU1RTX01PREVMUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczkuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwoKICAgICAgICAgIGlmIChfdGhpczkuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lICE9ICIiKSB7Ly8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgIC8vICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczkuYXBpX3N0YXR1c19jb2RlLlNNU19URU1QTEFURV9OQU1FX0VYSVNUU19NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYgKF90aGlzOS5vbGRfdGVtcGxhdGVfbmFtZSA9PSBfdGhpczkuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lKSB7CiAgICAgICAgICAgIF90aGlzOS5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzOS5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczkuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBwcmV2aWV3X3RlbXBsYXRlOiBmdW5jdGlvbiBwcmV2aWV3X3RlbXBsYXRlKHZhbCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CgogICAgICBpZiAodmFsID09ICJvbGQiKSB7CiAgICAgICAgdmFyIHRlbXBsYXRlX2JvZHkgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfYm9keTsKICAgICAgICB2YXIgdmFyaWFibGVzX2xpc3QgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfbGlzdDsKICAgICAgfSBlbHNlIGlmICh2YWwgPT0gIm5ldyIpIHsKICAgICAgICB2YXIgdGVtcGxhdGVfYm9keSA9IHRoaXMuY2hvb3Nlbl90ZW1wbGF0ZS50ZW1wbGF0ZV9ib2R5OwogICAgICAgIHZhciB2YXJpYWJsZXNfbGlzdCA9IHRoaXMuY2hvb3Nlbl90ZW1wbGF0ZS52YXJpYWJsZV9saXN0OwogICAgICB9CgogICAgICBheGlvcy5wb3N0KGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9zbXMoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgaXNfcHJldmlldzogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZV9ib2R5OiB0ZW1wbGF0ZV9ib2R5LAogICAgICAgIHZhcmlhYmxlc19saXN0OiB2YXJpYWJsZXNfbGlzdAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMC5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKF90aGlzMTAuYXBpX3N0YXR1c19jb2RlLlNUQVRVU19TVUNDRVNTX01PREVMUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBfdGhpczEwLnByZXZpZXdfdGVtcGxhdGVfZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5ib2R5OwoKICAgICAgICAgIGlmICh2YWwgPT0gIm9sZCIpIHsKICAgICAgICAgICAgJCgiI3ByZXZpZXdfdGVtcGxhdGVfdmlzaWJsZSIpLm1vZGFsKCJzaG93Iik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzMTAuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgX3RoaXMxMC4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbmRfZW1haWxfY29uZmlybV9wcm9tcHRfdGV4dDogZnVuY3Rpb24gc2VuZF9lbWFpbF9jb25maXJtX3Byb21wdF90ZXh0KGFsbF9jdXN0b21lcikgewogICAgICBpZiAoYWxsX2N1c3RvbWVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGx0KCdzZW5kX2J1bGtfbXNnJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGx0KCdlbWFpbF90b19zcGVjaWZpY19jdXN0b21lcicpOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfdGVtcGxhdGVzOiBmdW5jdGlvbiBzZWxlY3RlZF90ZW1wbGF0ZXModmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09ICJhbGwiKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50ZW1wbGF0ZWxpc3QpIHsKICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaCh0aGlzLnRlbXBsYXRlbGlzdFtpXS50ZW1wbGF0ZV9pZCk7CiAgICAgICAgICB9CgogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwoKICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgJCgiIyIgKyBbX2ldKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaCh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CgogICAgICAgICAgaWYgKHNlbGVjdGFsbC5jaGVja2VkKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoZnVuY3Rpb24gKHRlbXBsYXRlc19pZCkgewogICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzX2lkICE9IHZhbHVlOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3RlbXBsYXRlOiBmdW5jdGlvbiBkZWxldGVfdGVtcGxhdGUoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPCAxKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnc2VsZWN0X29uZV90ZW1wbGF0ZScpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MucG9zdChhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfc21zKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZV9saXN0OiB0aGlzLmNoZWNrZWRfbGlzdAogICAgICB9LCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdCh0aGlzLiRzZXNzaW9uLmdldCgiYXQiKSkKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXMxMS5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxMS5sb2FkX3RlbXBsYXRlcygpOwoKICAgICAgICBfdGhpczExLmVtcHR5X3ZhcmlhYmxlKCk7CgogICAgICAgIF90aGlzMTEuY2hlY2tlZF9saXN0ID0gW107CgogICAgICAgIGlmIChfdGhpczExLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0ZXh0OiBfdGhpczExLnRsdCgndGVtcGxhdGVfZGVsZXRlZF9tc2cnKSwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTEuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWV9NT0RFTFMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxMS50bHQoJ3Ntc19pbnRlcm5hbF9zZXJ2ZXInKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzMTEuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczExLnNwaW5uZXJPbiA9IGZhbHNlOwoKICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkpIHsKICAgICAgICAgIF90aGlzMTEuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBsb2FkX3RlbXBsYXRlczogZnVuY3Rpb24gbG9hZF90ZW1wbGF0ZXMoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIC8vIEdldCBkZWZhdWx0IHRlbXBsYXRlcwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICBpc19nZXRfZGVmYXVsdF90ZW1wbGF0ZXM6IHRydWUKICAgICAgfSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQodGhpcy4kc2Vzc2lvbi5nZXQoImF0IikpCiAgICAgICAgfQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIF90aGlzMTIuc3Bpbm5lck9uID0gZmFsc2U7CgogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgIF90aGlzMTIuZGVmYXVsdF90ZW1wbGF0ZWxpc3QgPSBbXTsKCiAgICAgICAgICBpZiAoX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBfdGhpczEyLmRlZmF1bHRfdGVtcGxhdGVsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmRlZmF1bHRfdGVtcGxhdGVzOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTIuYXBpX3N0YXR1c19jb2RlLk5PX0RFRkFVTFRfU01TX1RFTVBMQVRFX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMTIuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7IC8vIEdldCBTYXZlZCBUZW1wbGF0ZXMKCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBfdGhpczEyLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIF90aGlzMTIudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgX3RoaXMxMi5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICBfdGhpczEyLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwoKICAgICAgICBpZiAoX3RoaXMxMi5hcGlfc3RhdHVzX2NvZGUuTk9fU01TX1RFTVBMQVRFX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTIudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmIChfdGhpczEyLmFwaV9zdGF0dXNfY29kZS5URU1QTEFURV9TRUFSQ0hfUkVTVUxUX01PREVMUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIF90aGlzMTIudGVtcGxhdGVsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlczsKCiAgICAgICAgICBpZiAoX3RoaXMxMi50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICBfdGhpczEyLnNob3dfdGVtcGxhdGUoMCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzMTIuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxMi5zZXRwYWdpbmF0aW9uKF90aGlzMTIucGFnZV9ubyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMxMi5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgaWYgKGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fCBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5KSB7CiAgICAgICAgICBfdGhpczEyLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlOiBmdW5jdGlvbiBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHt9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczEzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczEzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICBfdGhpczEzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwoKICAgICAgICAgICAgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLk5PX1NNU19URU1QTEFURV9NT0RFTFMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxMy50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMxMy5hcGlfc3RhdHVzX2NvZGUuVEVNUExBVEVfU0VBUkNIX1JFU1VMVF9NT0RFTFMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgX3RoaXMxMy50ZW1wbGF0ZWxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEudGVtcGxhdGVzOwoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMy50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgX3RoaXMxMy5jdXJyZW50X3RlbXBsYXRlID0gX3RoaXMxMy50ZW1wbGF0ZWxpc3RbMF07CgogICAgICAgICAgICAgICAgX3RoaXMxMy5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF90aGlzMTMuc2V0cGFnaW5hdGlvbihfdGhpczEzLnBhZ2Vfbm8pOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQoKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX3NtcygpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgICBzZWFyY2hfa2V5OiB0aGlzLnNlYXJjaF9uYW1lCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpKQogICAgICAgICAgICB9CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBfdGhpczEzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBfdGhpczEzLnRlbXBsYXRlbGlzdCA9IFtdOwoKICAgICAgICAgICAgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLk5PX1NNU19URU1QTEFURV9NT0RFTFMuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIF90aGlzMTMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMTMuYXBpX3N0YXR1c19jb2RlLlRFTVBMQVRFX1NFQVJDSF9SRVNVTFRfTU9ERUxTLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBfdGhpczEzLnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXM7CgogICAgICAgICAgICAgIGlmIChfdGhpczEzLnRlbXBsYXRlbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBfdGhpczEzLnNob3dfdGVtcGxhdGUoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpczEzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIF90aGlzMTMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CgogICAgICAgICAgICAgIF90aGlzMTMuc2V0cGFnaW5hdGlvbihfdGhpczEzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3RoaXMxMy5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMxMy5zcGlubmVyT24gPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8IGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSkgewogICAgICAgICAgICAgIF90aGlzMTMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb246IGZ1bmN0aW9uIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCA0OyBfaTIrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kyICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CgogICAgICAgIGZvciAodmFyIF9pMyA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBfaTMgPCB0aGlzLnRvdGFsX3BhZ2VzOyBfaTMrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2kzICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IHBhZ2Vfbm8gKyAzOyBfaTQrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k0ICsgMSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTUgPSBwYWdlX25vIC0gNDsgX2k1IDwgdGhpcy50b3RhbF9wYWdlczsgX2k1KyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKF9pNSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwoKICAgICAgICBmb3IgKHZhciBfaTYgPSBwYWdlX25vIC0gMzsgX2k2IDw9IHBhZ2Vfbm8gKyAzOyBfaTYrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goX2k2KTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdpbmF0aW9uX2NsYXNzOiBmdW5jdGlvbiBwYWdpbmF0aW9uX2NsYXNzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsKICAgICAgICByZXR1cm4gIiBhY3RpdmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKICAgIHNob3dfdGVtcGxhdGU6IGZ1bmN0aW9uIHNob3dfdGVtcGxhdGUoaW5kZXgpIHsKICAgICAgdGhpcy5jdXJyZW50X3RlbXBsYXRlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0pKTsKICAgICAgdGhpcy5vbGRfdGVtcGxhdGVfbmFtZSA9IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lOwogICAgICB0aGlzLmN1cnJlbnRfdGVtcGxhdGVfaW5kZXggPSBpbmRleDsKICAgICAgdGhpcy5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlOiBmdW5jdGlvbiBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpIHsKICAgICAgICB0aGlzLmNob29zZW5fdGVtcGxhdGUgPSBudWxsOwogICAgICAgIHRoaXMuY3VycmVudF9zdGVwID0gMTsKICAgICAgICB0aGlzLnNwZWNpZmljX2N1c3RvbWVyX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnNhdmVfc21zID0gIiI7CiAgICAgICAgdGhpcy50ZW1wbGF0ZV9uYW1lID0gIiI7CiAgICAgICAgdGhpcy5vbGRfdGVtcGxhdGVfbmFtZSA9ICIiOwogICAgICAgIHRoaXMudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgY2hlY2tfY3VycmVudF90ZW1wbGF0ZV9hY3RpdmU6IGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnRfdGVtcGxhdGVfYWN0aXZlKGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUudGFibGUoaW5kZXgsIHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XSwgdGhpcy5jdXJyZW50X3RlbXBsYXRlKTsKICAgICAgaWYgKEJvb2xlYW4odGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdKSA9PT0gdHJ1ZSkgewogICAgICAgIHJldHVybiB0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0udGVtcGxhdGVfbmFtZSA9PT0gdGhpcy5vbGRfdGVtcGxhdGVfbmFtZSA/ICJjdXJyZW50LWFjdGl2ZS10ZW1wbGF0ZSIgOiBudWxsOwogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}