{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js!/home/vimalesh/CENSE/chatbot-portal/node_modules/eslint-loader/index.js??ref--13-0!/home/vimalesh/CENSE/chatbot-portal/public/js/tui-calendar.min.js","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/public/js/tui-calendar.min.js","mtime":1643027096116},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmRlZmluZS1nZXR0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXNldHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0Lmxvb2t1cC1nZXR0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Quc2VhbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiKTsKCnZhciBfdHlwZW9mID0gcmVxdWlyZSgiL2hvbWUvdmltYWxlc2gvQ0VOU0UvY2hhdGJvdC1wb3J0YWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7CgovKiEKICogVE9BU1QgVUkgQ2FsZW5kYXIKICogQHZlcnNpb24gMS4xMi4xMyB8IFRodSBTZXAgMjQgMjAyMAogKiBAYXV0aG9yIE5ITiBGRSBEZXZlbG9wbWVudCBMYWIgPGRsX2phdmFzY3JpcHRAbmhuLmNvbT4KICogQGxpY2Vuc2UgTUlUCiAqLwohZnVuY3Rpb24gKGUsIHQpIHsKICAib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAib2JqZWN0IiA9PSAodHlwZW9mIG1vZHVsZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YobW9kdWxlKSkgPyBtb2R1bGUuZXhwb3J0cyA9IHQocmVxdWlyZSgidHVpLWNvZGUtc25pcHBldCIpLCByZXF1aXJlKCJ0dWktZGF0ZS1waWNrZXIiKSkgOiAiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbInR1aS1jb2RlLXNuaXBwZXQiLCAidHVpLWRhdGUtcGlja2VyIl0sIHQpIDogIm9iamVjdCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgPyBleHBvcnRzLkNhbGVuZGFyID0gdChyZXF1aXJlKCJ0dWktY29kZS1zbmlwcGV0IiksIHJlcXVpcmUoInR1aS1kYXRlLXBpY2tlciIpKSA6IChlLnR1aSA9IGUudHVpIHx8IHt9LCBlLnR1aS5DYWxlbmRhciA9IHQoZS50dWkgJiYgZS50dWkudXRpbCwgZS50dWkgJiYgZS50dWkuRGF0ZVBpY2tlcikpOwp9KHdpbmRvdywgZnVuY3Rpb24gKGUsIHQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgIHZhciB0ID0ge307CgogICAgZnVuY3Rpb24gbihsKSB7CiAgICAgIGlmICh0W2xdKSByZXR1cm4gdFtsXS5leHBvcnRzOwogICAgICB2YXIgbyA9IHRbbF0gPSB7CiAgICAgICAgaTogbCwKICAgICAgICBsOiAhMSwKICAgICAgICBleHBvcnRzOiB7fQogICAgICB9OwogICAgICByZXR1cm4gZVtsXS5jYWxsKG8uZXhwb3J0cywgbywgby5leHBvcnRzLCBuKSwgby5sID0gITAsIG8uZXhwb3J0czsKICAgIH0KCiAgICByZXR1cm4gbi5tID0gZSwgbi5jID0gdCwgbi5kID0gZnVuY3Rpb24gKGUsIHQsIGwpIHsKICAgICAgbi5vKGUsIHQpIHx8IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCB0LCB7CiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgZ2V0OiBsCiAgICAgIH0pOwogICAgfSwgbi5yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICAgIHZhbHVlOiAiTW9kdWxlIgogICAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiAhMAogICAgICB9KTsKICAgIH0sIG4udCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGlmICgxICYgdCAmJiAoZSA9IG4oZSkpLCA4ICYgdCkgcmV0dXJuIGU7CiAgICAgIGlmICg0ICYgdCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGUpICYmIGUgJiYgZS5fX2VzTW9kdWxlKSByZXR1cm4gZTsKICAgICAgdmFyIGwgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpZiAobi5yKGwpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkobCwgImRlZmF1bHQiLCB7CiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgdmFsdWU6IGUKICAgICAgfSksIDIgJiB0ICYmICJzdHJpbmciICE9IHR5cGVvZiBlKSBmb3IgKHZhciBvIGluIGUpIHsKICAgICAgICBuLmQobCwgbywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBlW3RdOwogICAgICAgIH0uYmluZChudWxsLCBvKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGw7CiAgICB9LCBuLm4gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUgJiYgZS5fX2VzTW9kdWxlID8gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBlLmRlZmF1bHQ7CiAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGU7CiAgICAgIH07CiAgICAgIHJldHVybiBuLmQodCwgImEiLCB0KSwgdDsKICAgIH0sIG4ubyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCk7CiAgICB9LCBuLnAgPSAiL2Rpc3QiLCBuKG4ucyA9IDM2KTsKICB9KFtmdW5jdGlvbiAodCwgbikgewogICAgdC5leHBvcnRzID0gZTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsLAogICAgICAgIG8gPSBuKDYpLAogICAgICAgIGkgPSBuKDEzKSwKICAgICAgICBhID0gbigwKSwKICAgICAgICByID0gL15hdXRvJHxeJHwlLzsKICAgIHZhciBzID0gKGwgPSB7CiAgICAgIGFwcGVuZEhUTUxFbGVtZW50OiBmdW5jdGlvbiBhcHBlbmRIVE1MRWxlbWVudChlLCB0LCBuKSB7CiAgICAgICAgdmFyIGw7CiAgICAgICAgcmV0dXJuIG4gPSBuIHx8ICIiLCAobCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZSkpLmNsYXNzTmFtZSA9IG4sIHQgPyB0LmFwcGVuZENoaWxkKGwpIDogZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsKSwgbDsKICAgICAgfSwKICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoZSkgewogICAgICAgIGUgJiYgZS5wYXJlbnROb2RlICYmIGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZSkgewogICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKTsKICAgICAgfSwKICAgICAgX21hdGNoZXI6IGZ1bmN0aW9uIF9tYXRjaGVyKGUsIHQpIHsKICAgICAgICByZXR1cm4gL15cLi8udGVzdCh0KSA/IGwuaGFzQ2xhc3MoZSwgdC5yZXBsYWNlKCIuIiwgIiIpKSA6IC9eIy8udGVzdCh0KSA/IGUuaWQgPT09IHQucmVwbGFjZSgiIyIsICIiKSA6IGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdC50b0xvd2VyQ2FzZSgpOwogICAgICB9LAogICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbyA9IFtdLAogICAgICAgICAgICBpID0gITEsCiAgICAgICAgICAgIHIgPSBhLmlzVW5kZWZpbmVkKG4pIHx8ICExID09PSBuLAogICAgICAgICAgICBzID0gYS5pc0Z1bmN0aW9uKG4pOwogICAgICAgIHJldHVybiBhLmlzU3RyaW5nKHQpICYmICh0ID0gbC5nZXQodCkpLCBmdW5jdGlvbiBlKHQsIGEpIHsKICAgICAgICAgIGZvciAodmFyIGMsIHUgPSB0LmNoaWxkTm9kZXMsIGQgPSAwLCBoID0gdS5sZW5ndGg7IGQgPCBoOyBkICs9IDEpIHsKICAgICAgICAgICAgaWYgKCIjdGV4dCIgIT09IChjID0gdVtkXSkubm9kZU5hbWUpIGlmIChsLl9tYXRjaGVyKGMsIGEpKSB7CiAgICAgICAgICAgICAgaWYgKChzICYmIG4oYykgfHwgIXMpICYmIG8ucHVzaChjKSwgcikgewogICAgICAgICAgICAgICAgaSA9ICEwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGMuY2hpbGROb2Rlcy5sZW5ndGggPiAwICYmIChlKGMsIGEpLCBpKSkgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSh0ID0gdCB8fCB3aW5kb3cuZG9jdW1lbnQuYm9keSwgZSksIHIgPyBvWzBdIHx8IG51bGwgOiBvOwogICAgICB9LAogICAgICBjbG9zZXN0OiBmdW5jdGlvbiBjbG9zZXN0KGUsIHQsIG4pIHsKICAgICAgICB2YXIgbzsKICAgICAgICBpZiAoIWUpIHJldHVybiBudWxsOwogICAgICAgIGlmIChvID0gZS5wYXJlbnROb2RlLCAhbiAmJiBsLl9tYXRjaGVyKGUsIHQpKSByZXR1cm4gZTsKCiAgICAgICAgZm9yICg7IG8gJiYgbyAhPT0gd2luZG93LmRvY3VtZW50LmJvZHk7KSB7CiAgICAgICAgICBpZiAobC5fbWF0Y2hlcihvLCB0KSkgcmV0dXJuIG87CiAgICAgICAgICBvID0gby5wYXJlbnROb2RlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCiAgICAgIHRleHQ6IGZ1bmN0aW9uIHRleHQoZSkgewogICAgICAgIHZhciB0ID0gIiIsCiAgICAgICAgICAgIG4gPSAwLAogICAgICAgICAgICBvID0gZS5ub2RlVHlwZTsKCiAgICAgICAgaWYgKG8pIHsKICAgICAgICAgIGlmICgxID09PSBvIHx8IDkgPT09IG8gfHwgMTEgPT09IG8pIHsKICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlLnRleHRDb250ZW50KSByZXR1cm4gZS50ZXh0Q29udGVudDsKCiAgICAgICAgICAgIGZvciAoZSA9IGUuZmlyc3RDaGlsZDsgZTsgZSA9IGUubmV4dFNpYmxpbmcpIHsKICAgICAgICAgICAgICB0ICs9IGwudGV4dChlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgzID09PSBvIHx8IDQgPT09IG8pIHJldHVybiBlLm5vZGVWYWx1ZTsKICAgICAgICB9IGVsc2UgZm9yICg7IGVbbl07IG4gKz0gMSkgewogICAgICAgICAgdCArPSBsLnRleHQoZVtuXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdDsKICAgICAgfSwKICAgICAgc2V0RGF0YTogZnVuY3Rpb24gc2V0RGF0YShlLCB0LCBuKSB7CiAgICAgICAgImRhdGFzZXQiIGluIGUgPyBlLmRhdGFzZXRbdF0gPSBuIDogZS5zZXRBdHRyaWJ1dGUoImRhdGEtIiArIHQsIG4pOwogICAgICB9LAogICAgICBnZXREYXRhOiBmdW5jdGlvbiBnZXREYXRhKGUsIHQpIHsKICAgICAgICByZXR1cm4gImRhdGFzZXQiIGluIGUgPyBlLmRhdGFzZXRbdF0gOiBlLmdldEF0dHJpYnV0ZSgiZGF0YS0iICsgdCk7CiAgICAgIH0sCiAgICAgIGhhc0NsYXNzOiBmdW5jdGlvbiBoYXNDbGFzcyhlLCB0KSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgcmV0dXJuIGEuaXNVbmRlZmluZWQoZS5jbGFzc0xpc3QpID8gKG4gPSBsLmdldENsYXNzKGUpKS5sZW5ndGggPiAwICYmIG5ldyBSZWdFeHAoIihefFxccykiICsgdCArICIoXFxzfCQpIikudGVzdChuKSA6IGUuY2xhc3NMaXN0LmNvbnRhaW5zKHQpOwogICAgICB9LAogICAgICBhZGRDbGFzczogZnVuY3Rpb24gYWRkQ2xhc3MoZSwgdCkgewogICAgICAgIHZhciBuOwogICAgICAgIGEuaXNVbmRlZmluZWQoZS5jbGFzc0xpc3QpID8gbC5oYXNDbGFzcyhlLCB0KSB8fCAobiA9IGwuZ2V0Q2xhc3MoZSksIGwuc2V0Q2xhc3MoZSwgKG4gPyBuICsgIiAiIDogIiIpICsgdCkpIDogYS5mb3JFYWNoQXJyYXkodC5zcGxpdCgiICIpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgZS5jbGFzc0xpc3QuYWRkKHQpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzZXRDbGFzczogZnVuY3Rpb24gc2V0Q2xhc3MoZSwgdCkgewogICAgICAgIGEuaXNVbmRlZmluZWQoZS5jbGFzc05hbWUuYmFzZVZhbCkgPyBlLmNsYXNzTmFtZSA9IHQgOiBlLmNsYXNzTmFtZS5iYXNlVmFsID0gdDsKICAgICAgfSwKICAgICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGUsIHQpIHsKICAgICAgICB2YXIgbiA9ICIiOwogICAgICAgIGEuaXNVbmRlZmluZWQoZS5jbGFzc0xpc3QpID8gKG4gPSAoIiAiICsgbC5nZXRDbGFzcyhlKSArICIgIikucmVwbGFjZSgiICIgKyB0ICsgIiAiLCAiICIpLCBsLnNldENsYXNzKGUsIG4ucmVwbGFjZSgvXlxzXHMqLywgIiIpLnJlcGxhY2UoL1xzXHMqJC8sICIiKSkpIDogZS5jbGFzc0xpc3QucmVtb3ZlKHQpOwogICAgICB9LAogICAgICBnZXRDbGFzczogZnVuY3Rpb24gZ2V0Q2xhc3MoZSkgewogICAgICAgIHJldHVybiBlICYmIGUuY2xhc3NOYW1lID8gYS5pc1VuZGVmaW5lZChlLmNsYXNzTmFtZS5iYXNlVmFsKSA/IGUuY2xhc3NOYW1lIDogZS5jbGFzc05hbWUuYmFzZVZhbCA6ICIiOwogICAgICB9LAogICAgICBnZXRTdHlsZTogZnVuY3Rpb24gZ2V0U3R5bGUoZSwgdCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBsID0gZS5zdHlsZVt0XSB8fCBlLmN1cnJlbnRTdHlsZSAmJiBlLmN1cnJlbnRTdHlsZVt0XTsKICAgICAgICByZXR1cm4gbCAmJiAiYXV0byIgIT09IGwgfHwgIWRvY3VtZW50LmRlZmF1bHRWaWV3IHx8IChsID0gKG4gPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGUsIG51bGwpKSA/IG5bdF0gOiBudWxsKSwgImF1dG8iID09PSBsID8gbnVsbCA6IGw7CiAgICAgIH0sCiAgICAgIGdldENvbXB1dGVkU3R5bGU6IGZ1bmN0aW9uIGdldENvbXB1dGVkU3R5bGUoZSkgewogICAgICAgIHZhciB0ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXc7CiAgICAgICAgcmV0dXJuIHQgJiYgdC5nZXRDb21wdXRlZFN0eWxlID8gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlKSA6IHsKICAgICAgICAgIGdldFByb3BlcnR5VmFsdWU6IGZ1bmN0aW9uIGdldFByb3BlcnR5VmFsdWUodCkgewogICAgICAgICAgICB2YXIgbiA9IC8oXC0oW2Etel0pezF9KS9nOwogICAgICAgICAgICByZXR1cm4gImZsb2F0IiA9PT0gdCAmJiAodCA9ICJzdHlsZUZsb2F0IiksIG4udGVzdCh0KSAmJiAodCA9IHQucmVwbGFjZShuLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFyZ3VtZW50c1syXS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICB9KSksIGUuY3VycmVudFN0eWxlW3RdID8gZS5jdXJyZW50U3R5bGVbdF0gOiBudWxsOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHNldFBvc2l0aW9uOiBmdW5jdGlvbiBzZXRQb3NpdGlvbihlLCB0LCBuKSB7CiAgICAgICAgdCA9IGEuaXNVbmRlZmluZWQodCkgPyAwIDogdCwgbiA9IGEuaXNVbmRlZmluZWQobikgPyAwIDogbiwgZS5fcG9zID0gW3QsIG5dLCBlLnN0eWxlLmxlZnQgPSBhLmlzTnVtYmVyKHQpID8gdCArICJweCIgOiB0LCBlLnN0eWxlLnRvcCA9IGEuaXNOdW1iZXIobikgPyBuICsgInB4IiA6IG47CiAgICAgIH0sCiAgICAgIHNldExUUkI6IGZ1bmN0aW9uIHNldExUUkIoZSwgdCkgewogICAgICAgIHZhciBuOwogICAgICAgIFsibGVmdCIsICJ0b3AiLCAicmlnaHQiLCAiYm90dG9tIl0uZm9yRWFjaChmdW5jdGlvbiAobCkgewogICAgICAgICAgbiA9IGEuaXNVbmRlZmluZWQodFtsXSkgPyAiIiA6IHRbbF0sIGUuc3R5bGVbbF0gPSBhLmlzTnVtYmVyKG4pID8gbiArICJweCIgOiBuOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRQb3NpdGlvbjogZnVuY3Rpb24gZ2V0UG9zaXRpb24oZSwgdCkgewogICAgICAgIHZhciBuLCBsLCBvOwogICAgICAgIHJldHVybiB0ICYmIChlLl9wb3MgPSBudWxsKSwgZS5fcG9zID8gZS5fcG9zIDogKG4gPSAwLCBsID0gMCwgKHIudGVzdChlLnN0eWxlLmxlZnQpIHx8IHIudGVzdChlLnN0eWxlLnRvcCkpICYmICJnZXRCb3VuZGluZ0NsaWVudFJlY3QiIGluIGUgPyAobiA9IChvID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkubGVmdCwgbCA9IG8udG9wKSA6IChuID0gcGFyc2VGbG9hdChlLnN0eWxlLmxlZnQgfHwgMCksIGwgPSBwYXJzZUZsb2F0KGUuc3R5bGUudG9wIHx8IDApKSwgW24sIGxdKTsKICAgICAgfSwKICAgICAgZ2V0U2l6ZTogZnVuY3Rpb24gZ2V0U2l6ZShlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4gPSBsLmdldFN0eWxlKGUsICJ3aWR0aCIpLAogICAgICAgICAgICBvID0gbC5nZXRTdHlsZShlLCAiaGVpZ2h0Iik7CiAgICAgICAgcmV0dXJuIChyLnRlc3QobikgfHwgci50ZXN0KG8pIHx8IGEuaXNOdWxsKG4pIHx8IGEuaXNOdWxsKG8pKSAmJiAiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiBpbiBlID8gKG4gPSAodCA9IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLndpZHRoIHx8IGUub2Zmc2V0V2lkdGgsIG8gPSB0LmhlaWdodCB8fCBlLm9mZnNldEhlaWdodCkgOiAobiA9IHBhcnNlRmxvYXQobiB8fCAwKSwgbyA9IHBhcnNlRmxvYXQobyB8fCAwKSksIFtuLCBvXTsKICAgICAgfSwKICAgICAgZ2V0QkNSZWN0OiBmdW5jdGlvbiBnZXRCQ1JlY3QoZSkgewogICAgICAgIHZhciB0ID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICByZXR1cm4gdCA9IGEuZXh0ZW5kKHsKICAgICAgICAgIHdpZHRoOiBlLm9mZnNldFdpZHRoLAogICAgICAgICAgaGVpZ2h0OiBlLm9mZnNldEhlaWdodAogICAgICAgIH0sIHQpOwogICAgICB9LAogICAgICB0ZXN0UHJvcDogZnVuY3Rpb24gdGVzdFByb3AoZSkgewogICAgICAgIGZvciAodmFyIHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUsIG4gPSAwLCBsID0gZS5sZW5ndGg7IG4gPCBsOyBuICs9IDEpIHsKICAgICAgICAgIGlmIChlW25dIGluIHQpIHJldHVybiBlW25dOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICExOwogICAgICB9LAogICAgICBnZXRGb3JtRGF0YTogZnVuY3Rpb24gZ2V0Rm9ybURhdGEoZSkgewogICAgICAgIHZhciB0ID0gbmV3IGkoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoOwogICAgICAgIH0pLAogICAgICAgICAgICBuID0gZnVuY3Rpb24gbihlKSB7CiAgICAgICAgICByZXR1cm4gIWUuZGlzYWJsZWQ7CiAgICAgICAgfSwKICAgICAgICAgICAgbyA9IHt9OwoKICAgICAgICByZXR1cm4gdC5hZGQuYXBwbHkodCwgbC5maW5kKCJpbnB1dCIsIGUsIG4pLmNvbmNhdChsLmZpbmQoInNlbGVjdCIsIGUsIG4pKS5jb25jYXQobC5maW5kKCJ0ZXh0YXJlYSIsIGUsIG4pKSksIHQgPSB0Lmdyb3VwQnkoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlICYmIGUuZ2V0QXR0cmlidXRlKCJuYW1lIikgfHwgIl9vdGhlciI7CiAgICAgICAgfSksIGEuZm9yRWFjaCh0LCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgIl9vdGhlciIgIT09IHQgJiYgZS5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBpID0gbi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgciA9IG4udHlwZSwKICAgICAgICAgICAgICAgIHMgPSBbXTsKICAgICAgICAgICAgInJhZGlvIiA9PT0gciA/IHMgPSBbZS5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2hlY2tlZDsKICAgICAgICAgICAgfSkudG9BcnJheSgpLnBvcCgpXSA6ICJjaGVja2JveCIgPT09IHIgPyBzID0gZS5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuY2hlY2tlZDsKICAgICAgICAgICAgfSkudG9BcnJheSgpIDogInNlbGVjdCIgPT09IGkgPyBlLmZpbmQoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gISFlLmNoaWxkTm9kZXMubGVuZ3RoOwogICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcyA9IHMuY29uY2F0KGwuZmluZCgib3B0aW9uIiwgZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlLnNlbGVjdGVkOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSkgOiBzID0gZS5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuICIiICE9PSBlLnZhbHVlOwogICAgICAgICAgICB9KS50b0FycmF5KCksIChzID0gYS5tYXAocywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZS52YWx1ZTsKICAgICAgICAgICAgfSkpLmxlbmd0aCA/IDEgPT09IHMubGVuZ3RoICYmIChzID0gc1swXSkgOiBzID0gIiIsIG9bdF0gPSBzOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIG87CiAgICAgIH0KICAgIH0pLnRlc3RQcm9wKFsidXNlclNlbGVjdCIsICJXZWJraXRVc2VyU2VsZWN0IiwgIk9Vc2VyU2VsZWN0IiwgIk1velVzZXJTZWxlY3QiLCAibXNVc2VyU2VsZWN0Il0pLAogICAgICAgIGMgPSAoIm9uc2VsZWN0c3RhcnQiIGluIGRvY3VtZW50KSwKICAgICAgICB1ID0gIiI7CiAgICBsLmRpc2FibGVUZXh0U2VsZWN0aW9uID0gYyA/IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIG8ub24oZSwgInNlbGVjdHN0YXJ0IiwgdCB8fCBvLnByZXZlbnREZWZhdWx0KTsKICAgIH0gOiBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUuc3R5bGU7CiAgICAgIHUgPSB0W3NdLCB0W3NdID0gIm5vbmUiOwogICAgfSwgbC5lbmFibGVUZXh0U2VsZWN0aW9uID0gYyA/IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIG8ub2ZmKHdpbmRvdywgInNlbGVjdHN0YXJ0IiwgdCB8fCBvLnByZXZlbnREZWZhdWx0KTsKICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZVtzXSA9IHU7CiAgICB9LCBsLmRpc2FibGVJbWFnZURyYWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG8ub24od2luZG93LCAiZHJhZ3N0YXJ0Iiwgby5wcmV2ZW50RGVmYXVsdCk7CiAgICB9LCBsLmVuYWJsZUltYWdlRHJhZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgby5vZmYod2luZG93LCAiZHJhZ3N0YXJ0Iiwgby5wcmV2ZW50RGVmYXVsdCk7CiAgICB9LCBlLmV4cG9ydHMgPSBsOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSAidHVpLWZ1bGwtY2FsZW5kYXItIiwKICAgICAgICBvID0gbmV3IFJlZ0V4cCgiXiIgKyBsICsgIndlZWtkYXlbXFxzXXR1aS12aWV3LShcXGQrKSIpLAogICAgICAgIGkgPSBuZXcgUmVnRXhwKCJeIiArIGwgKyAic2NoZWR1bGUoLXRpdGxlKT8kIiksCiAgICAgICAgYSA9IHsKICAgICAgdGhyb3dFcnJvcjogZnVuY3Rpb24gdGhyb3dFcnJvcihlKSB7CiAgICAgICAgYWxlcnQoZSk7CiAgICAgIH0sCiAgICAgIGNzc1ByZWZpeDogbCwKICAgICAgY2xhc3NuYW1lOiBmdW5jdGlvbiBjbGFzc25hbWUoZSkgewogICAgICAgIHJldHVybiAiLiIgPT09IChlID0gZSB8fCAiIikuY2hhckF0KDApID8gIi4iICsgYS5jc3NQcmVmaXggKyBlLnNsaWNlKDEpIDogYS5jc3NQcmVmaXggKyBlOwogICAgICB9LAogICAgICBhbGxkYXk6IHsKICAgICAgICBnZXRWaWV3SURSZWdFeHA6IG8sCiAgICAgICAgY2hlY2tDb25kUmVnRXhwOiBpCiAgICAgIH0sCiAgICAgIGRheWdyaWQ6IHsKICAgICAgICBnZXRWaWV3SURSZWdFeHA6IG8sCiAgICAgICAgY2hlY2tDb25kUmVnRXhwOiBpCiAgICAgIH0sCiAgICAgIHRpbWU6IHsKICAgICAgICBnZXRWaWV3SURSZWdFeHA6IG5ldyBSZWdFeHAoIl4iICsgbCArICJ0aW1lLWRhdGVbXFxzXXR1aS12aWV3LShcXGQrKSIpCiAgICAgIH0KICAgIH07CiAgICBlLmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSBuKDQpLkRhdGUsCiAgICAgICAgICBhID0gbigyNiksCiAgICAgICAgICByID0gbigwKSwKICAgICAgICAgIHMgPSAvXihcZHs0fVstfFwvXSpcZHsyfVstfFwvXSpcZHsyfSlccz8oXGR7Mn06XGR7Mn06XGR7Mn0pPyQvLAogICAgICAgICAgYyA9IHt9LAogICAgICAgICAgdSA9IHt9OwogICAgICBvID0gewogICAgICAgIFlZWVlNTUREOiBmdW5jdGlvbiBZWVlZTU1ERChlKSB7CiAgICAgICAgICByZXR1cm4gW2UuZ2V0RnVsbFllYXIoKSwgbC5sZWFkaW5nWmVybyhlLmdldE1vbnRoKCkgKyAxLCAyKSwgbC5sZWFkaW5nWmVybyhlLmdldERhdGUoKSwgMildLmpvaW4oIiIpOwogICAgICAgIH0sCiAgICAgICAgWVlZWTogZnVuY3Rpb24gWVlZWShlKSB7CiAgICAgICAgICByZXR1cm4gU3RyaW5nKGUuZ2V0RnVsbFllYXIoKSk7CiAgICAgICAgfSwKICAgICAgICBNTTogZnVuY3Rpb24gTU0oZSkgewogICAgICAgICAgcmV0dXJuIGwubGVhZGluZ1plcm8oZS5nZXRNb250aCgpICsgMSwgMik7CiAgICAgICAgfSwKICAgICAgICBERDogZnVuY3Rpb24gREQoZSkgewogICAgICAgICAgcmV0dXJuIGwubGVhZGluZ1plcm8oZS5nZXREYXRlKCksIDIpOwogICAgICAgIH0sCiAgICAgICAgIkhIOm1tIjogZnVuY3Rpb24gSEhNbShlKSB7CiAgICAgICAgICB2YXIgdCA9IGUuZ2V0SG91cnMoKSwKICAgICAgICAgICAgICBuID0gZS5nZXRNaW51dGVzKCk7CiAgICAgICAgICByZXR1cm4gbC5sZWFkaW5nWmVybyh0LCAyKSArICI6IiArIGwubGVhZGluZ1plcm8obiwgMik7CiAgICAgICAgfSwKICAgICAgICAiaGg6bW0iOiBmdW5jdGlvbiBoaE1tKGUpIHsKICAgICAgICAgIHZhciB0ID0gZS5nZXRIb3VycygpLAogICAgICAgICAgICAgIG4gPSBlLmdldE1pbnV0ZXMoKTsKICAgICAgICAgIHJldHVybiB0ID4gMTIgJiYgKHQgJT0gMTIpLCBsLmxlYWRpbmdaZXJvKHQsIDIpICsgIjoiICsgbC5sZWFkaW5nWmVybyhuLCAyKTsKICAgICAgICB9LAogICAgICAgIHR0OiBmdW5jdGlvbiB0dChlKSB7CiAgICAgICAgICByZXR1cm4gZS5nZXRIb3VycygpIDwgMTIgPyAiYW0iIDogInBtIjsKICAgICAgICB9CiAgICAgIH0sIGwgPSB7CiAgICAgICAgTUlMTElTRUNPTkRTX1BFUl9EQVk6IDg2NGU1LAogICAgICAgIE1JTExJU0VDT05EU19QRVJfSE9VUjogMzZlNSwKICAgICAgICBNSUxMSVNFQ09ORFNfUEVSX01JTlVURVM6IDZlNCwKICAgICAgICBNSUxMSVNFQ09ORFNfU0NIRURVTEVfTUlOX0RVUkFUSU9OOiAxMmU1LAogICAgICAgIF9jb252TWlsbGlzZWNvbmRzOiBmdW5jdGlvbiBfY29udk1pbGxpc2Vjb25kcyhlLCBuLCBsKSB7CiAgICAgICAgICB2YXIgbyA9IHsKICAgICAgICAgICAgZGF5OiAwLAogICAgICAgICAgICBob3VyOiAxLAogICAgICAgICAgICBtaW51dGVzOiAyLAogICAgICAgICAgICBzZWNvbmRzOiAzCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIGUgaW4gbyAmJiAhdC5pc05hTihuKSAmJiByLnJlZHVjZShbbl0uY29uY2F0KFsyNCwgNjAsIDYwLCAxZTNdLnNsaWNlKG9bZV0pKSwgbCk7CiAgICAgICAgfSwKICAgICAgICBtaWxsaXNlY29uZHNUbzogZnVuY3Rpb24gbWlsbGlzZWNvbmRzVG8oZSwgdCkgewogICAgICAgICAgdmFyIG4gPSBjLAogICAgICAgICAgICAgIG8gPSBlICsgdDsKICAgICAgICAgIHJldHVybiBuW29dIHx8IChuW29dID0gbC5fY29udk1pbGxpc2Vjb25kcyhlLCB0LCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gZSAvIHQ7CiAgICAgICAgICB9KSksIG5bb107CiAgICAgICAgfSwKICAgICAgICBtaWxsaXNlY29uZHNGcm9tOiBmdW5jdGlvbiBtaWxsaXNlY29uZHNGcm9tKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gdSwKICAgICAgICAgICAgICBvID0gZSArIHQ7CiAgICAgICAgICByZXR1cm4gbltvXSB8fCAobltvXSA9IGwuX2NvbnZNaWxsaXNlY29uZHMoZSwgdCwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGUgKiB0OwogICAgICAgICAgfSkpLCBuW29dOwogICAgICAgIH0sCiAgICAgICAgbWludXRlc0Zyb21Ib3VyczogZnVuY3Rpb24gbWludXRlc0Zyb21Ib3VycyhlKSB7CiAgICAgICAgICByZXR1cm4gNjAgKiBlOwogICAgICAgIH0sCiAgICAgICAgcmFuZ2U6IGZ1bmN0aW9uIHJhbmdlKGUsIHQsIG4pIHsKICAgICAgICAgIGZvciAodmFyIG8gPSBlLmdldFRpbWUoKSwgciA9IHQuZ2V0VGltZSgpLCBzID0gbywgYyA9IGEobmV3IGkoZSkpLCB1ID0gW107IHMgPD0gciAmJiByID49IGMuZC5nZXRUaW1lKCk7KSB7CiAgICAgICAgICAgIHUucHVzaChsLnN0YXJ0KGMuZCkpLCBzICs9IG4sIGMuYWRkRGF0ZSgxKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdTsKICAgICAgICB9LAogICAgICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZShlKSB7CiAgICAgICAgICByZXR1cm4gbmV3IGkoZSk7CiAgICAgICAgfSwKICAgICAgICBjb21wYXJlOiBmdW5jdGlvbiBjb21wYXJlKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gZS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgbCA9IHQuZ2V0VGltZSgpOwogICAgICAgICAgcmV0dXJuIG4gPCBsID8gLTEgOiBuID4gbCA/IDEgOiAwOwogICAgICAgIH0sCiAgICAgICAgaXNTYW1lTW9udGg6IGZ1bmN0aW9uIGlzU2FtZU1vbnRoKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBlLmdldEZ1bGxZZWFyKCkgPT09IHQuZ2V0RnVsbFllYXIoKSAmJiBlLmdldE1vbnRoKCkgPT09IHQuZ2V0TW9udGgoKTsKICAgICAgICB9LAogICAgICAgIGlzU2FtZURhdGU6IGZ1bmN0aW9uIGlzU2FtZURhdGUoZSwgdCkgewogICAgICAgICAgcmV0dXJuIGwuaXNTYW1lTW9udGgoZSwgdCkgJiYgZS5nZXREYXRlKCkgPT09IHQuZ2V0RGF0ZSgpOwogICAgICAgIH0sCiAgICAgICAgaXNWYWxpZDogZnVuY3Rpb24gaXNWYWxpZChlKSB7CiAgICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIGkgJiYgIXdpbmRvdy5pc05hTihlLmdldFRpbWUoKSk7CiAgICAgICAgfSwKICAgICAgICB0b1VUQzogZnVuY3Rpb24gdG9VVEMoZSkgewogICAgICAgICAgdmFyIHQgPSBlLmdldFRpbWUoKSwKICAgICAgICAgICAgICBuID0gbC5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpKTsKICAgICAgICAgIHJldHVybiBuZXcgaSh0ICsgbik7CiAgICAgICAgfSwKICAgICAgICBsZWFkaW5nWmVybzogZnVuY3Rpb24gbGVhZGluZ1plcm8oZSwgdCkgewogICAgICAgICAgdmFyIG4gPSAiIiwKICAgICAgICAgICAgICBsID0gMDsKICAgICAgICAgIGlmIChTdHJpbmcoZSkubGVuZ3RoID4gdCkgcmV0dXJuIFN0cmluZyhlKTsKCiAgICAgICAgICBmb3IgKDsgbCA8IHQgLSAxOyBsICs9IDEpIHsKICAgICAgICAgICAgbiArPSAiMCI7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIChuICsgZSkuc2xpY2UoLTEgKiB0KTsKICAgICAgICB9LAogICAgICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShlLCB0KSB7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgIG8sCiAgICAgICAgICAgICAgYSA9IGUubWF0Y2gocyk7CiAgICAgICAgICByZXR1cm4gci5pc1VuZGVmaW5lZCh0KSAmJiAodCA9IC0xKSwgISFhICYmIChlLmxlbmd0aCA+IDggPyAobiA9IH5lLmluZGV4T2YoIi8iKSA/ICIvIiA6ICItIiwgbCA9IChhID0gYS5zcGxpY2UoMSkpWzBdLnNwbGl0KG4pLCBvID0gYVsxXSA/IGFbMV0uc3BsaXQoIjoiKSA6IFswLCAwLCAwXSkgOiAobCA9IFsoYSA9IGFbMF0pLnN1YnN0cigwLCA0KSwgYS5zdWJzdHIoNCwgMiksIGEuc3Vic3RyKDYsIDIpXSwgbyA9IFswLCAwLCAwXSksIG5ldyBpKCkuc2V0V2l0aFJhdyhOdW1iZXIobFswXSksIE51bWJlcihsWzFdKSArIHQsIE51bWJlcihsWzJdKSwgTnVtYmVyKG9bMF0pLCBOdW1iZXIob1sxXSksIE51bWJlcihvWzJdKSwgMCkpOwogICAgICAgIH0sCiAgICAgICAgcmF3OiBmdW5jdGlvbiByYXcoZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeTogZS5nZXRGdWxsWWVhcigpLAogICAgICAgICAgICBNOiBlLmdldE1vbnRoKCksCiAgICAgICAgICAgIGQ6IGUuZ2V0RGF0ZSgpLAogICAgICAgICAgICBoOiBlLmdldEhvdXJzKCksCiAgICAgICAgICAgIG06IGUuZ2V0TWludXRlcygpLAogICAgICAgICAgICBzOiBlLmdldFNlY29uZHMoKSwKICAgICAgICAgICAgbXM6IGUuZ2V0TWlsbGlzZWNvbmRzKCkKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQoZSkgewogICAgICAgICAgdmFyIHQgPSBlID8gbmV3IGkoZSkgOiBuZXcgaSgpOwogICAgICAgICAgcmV0dXJuIHQuc2V0SG91cnMoMCwgMCwgMCwgMCksIHQ7CiAgICAgICAgfSwKICAgICAgICBlbmQ6IGZ1bmN0aW9uIGVuZChlKSB7CiAgICAgICAgICB2YXIgdCA9IGUgPyBuZXcgaShlKSA6IG5ldyBpKCk7CiAgICAgICAgICByZXR1cm4gdC5zZXRIb3VycygyMywgNTksIDU5LCAwKSwgdDsKICAgICAgICB9LAogICAgICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gdDsKICAgICAgICAgIHJldHVybiByLmZvckVhY2hPd25Qcm9wZXJ0aWVzKG8sIGZ1bmN0aW9uICh0LCBsKSB7CiAgICAgICAgICAgIG4gPSBuLnJlcGxhY2UobCwgdChlKSk7CiAgICAgICAgICB9KSwgbjsKICAgICAgICB9LAogICAgICAgIHN0YXJ0RGF0ZU9mTW9udGg6IGZ1bmN0aW9uIHN0YXJ0RGF0ZU9mTW9udGgoZSkgewogICAgICAgICAgdmFyIHQgPSBuZXcgaShlKTsKICAgICAgICAgIHJldHVybiB0LnNldERhdGUoMSksIHQuc2V0SG91cnMoMCwgMCwgMCwgMCksIHQ7CiAgICAgICAgfSwKICAgICAgICBlbmREYXRlT2ZNb250aDogZnVuY3Rpb24gZW5kRGF0ZU9mTW9udGgoZSkgewogICAgICAgICAgdmFyIHQgPSBsLnN0YXJ0RGF0ZU9mTW9udGgoZSk7CiAgICAgICAgICByZXR1cm4gdC5zZXRNb250aCh0LmdldE1vbnRoKCkgKyAxKSwgdC5zZXREYXRlKHQuZ2V0RGF0ZSgpIC0gMSksIHQuc2V0SG91cnMoMjMsIDU5LCA1OSksIHQ7CiAgICAgICAgfSwKICAgICAgICBhcnIyZENhbGVuZGFyOiBmdW5jdGlvbiBhcnIyZENhbGVuZGFyKGUsIHQsIG4pIHsKICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgIG0sCiAgICAgICAgICAgICAgZiA9IFtdLAogICAgICAgICAgICAgIGcgPSB0LnN0YXJ0RGF5T2ZXZWVrLAogICAgICAgICAgICAgIHkgPSAhIXIuaXNVbmRlZmluZWQodC5pc0Fsd2F5czZXZWVrKSB8fCB0LmlzQWx3YXlzNldlZWssCiAgICAgICAgICAgICAgUyA9IHQudmlzaWJsZVdlZWtzQ291bnQsCiAgICAgICAgICAgICAgXyA9IHQud29ya3dlZWs7CiAgICAgICAgICByZXR1cm4gUyA/IChzID0gbmV3IGkoZSksIChjID0gYShuZXcgaShlKSkpLmFkZERhdGUoNyAqIChTIC0gMSkpLCBjID0gYy5kKSA6IChzID0gbC5zdGFydERhdGVPZk1vbnRoKGUpLCBjID0gbC5lbmREYXRlT2ZNb250aChlKSksIG8gPSByLnJhbmdlKGcsIDcpLmNvbmNhdChyLnJhbmdlKDcpKS5zbGljZSgwLCA3KSwgdSA9IHIuaW5BcnJheShzLmdldERheSgpLCBvKSwgaCA9IDcgLSAoci5pbkFycmF5KGMuZ2V0RGF5KCksIG8pICsgMSksIGQgPSBTID8gNyAqIFMgOiB5ID8gNDIgOiB1ICsgYy5nZXREYXRlKCkgKyBoLCBwID0gbC5zdGFydChzKS5hZGREYXRlKC11KSwgci5mb3JFYWNoQXJyYXkoci5yYW5nZShkKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHQ7CiAgICAgICAgICAgIGUgJSA3IHx8IChtID0gZltlIC8gN10gPSBbXSksIHQgPSBsLnN0YXJ0KHApLCB0ID0gbiA/IG4odCkgOiB0LCBfICYmIGwuaXNXZWVrZW5kKHQuZ2V0RGF5KCkpIHx8IG0ucHVzaCh0KSwgcC5zZXREYXRlKHAuZ2V0RGF0ZSgpICsgMSk7CiAgICAgICAgICB9KSwgZjsKICAgICAgICB9LAogICAgICAgIGdldEdyaWRMZWZ0QW5kV2lkdGg6IGZ1bmN0aW9uIGdldEdyaWRMZWZ0QW5kV2lkdGgoZSwgdCwgbiwgbykgewogICAgICAgICAgdmFyIGkgPSAxMDAgLyBlLAogICAgICAgICAgICAgIGEgPSBlID4gNSA/IDEwMCAvIChlIC0gMSkgOiBpLAogICAgICAgICAgICAgIHMgPSAwLAogICAgICAgICAgICAgIGMgPSByLnJhbmdlKG4sIDcpLmNvbmNhdChyLnJhbmdlKGUpKS5zbGljZSgwLCA3KTsKICAgICAgICAgIHJldHVybiBvICYmIChjID0gci5maWx0ZXIoYywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuICFsLmlzV2Vla2VuZChlKTsKICAgICAgICAgIH0pKSwgdCA9ICFvICYmIHQsIHIubWFwKGMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBvLAogICAgICAgICAgICAgICAgciA9IHQgPyBhIDogaTsKICAgICAgICAgICAgcmV0dXJuIGUgPiA1ICYmIHQgJiYgbC5pc1dlZWtlbmQobikgJiYgKHIgPSBhIC8gMiksIG8gPSB7CiAgICAgICAgICAgICAgZGF5OiBuLAogICAgICAgICAgICAgIHdpZHRoOiByLAogICAgICAgICAgICAgIGxlZnQ6IHMKICAgICAgICAgICAgfSwgcyArPSByLCBvOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBpc1dlZWtlbmQ6IGZ1bmN0aW9uIGlzV2Vla2VuZChlKSB7CiAgICAgICAgICByZXR1cm4gMCA9PT0gZSB8fCA2ID09PSBlOwogICAgICAgIH0sCiAgICAgICAgaXNCZXR3ZWVuV2l0aERhdGU6IGZ1bmN0aW9uIGlzQmV0d2VlbldpdGhEYXRlKGUsIHQsIG4pIHsKICAgICAgICAgIHJldHVybiBlID0gcGFyc2VJbnQobC5mb3JtYXQoZSwgIllZWVlNTUREIiksIDEwKSwgdCA9IHBhcnNlSW50KGwuZm9ybWF0KHQsICJZWVlZTU1ERCIpLCAxMCksIG4gPSBwYXJzZUludChsLmZvcm1hdChuLCAiWVlZWU1NREQiKSwgMTApLCB0IDw9IGUgJiYgZSA8PSBuOwogICAgICAgIH0sCiAgICAgICAgaXNTdGFydE9mRGF5OiBmdW5jdGlvbiBpc1N0YXJ0T2ZEYXkoZSkgewogICAgICAgICAgcmV0dXJuICFsLmNvbXBhcmUobC5zdGFydChlKSwgZSk7CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0U3RhcnREYXlUb0xhc3REYXk6IGZ1bmN0aW9uIGNvbnZlcnRTdGFydERheVRvTGFzdERheShlKSB7CiAgICAgICAgICB2YXIgdCA9IG5ldyBpKGUpOwogICAgICAgICAgcmV0dXJuIGwuaXNTdGFydE9mRGF5KGUpICYmICh0LnNldERhdGUodC5nZXREYXRlKCkgLSAxKSwgdC5zZXRIb3VycygyMywgNTksIDU5KSksIHQ7CiAgICAgICAgfSwKICAgICAgICBnZXRTdGFydE9mTmV4dERheTogZnVuY3Rpb24gZ2V0U3RhcnRPZk5leHREYXkoZSkgewogICAgICAgICAgdmFyIHQgPSBsLnN0YXJ0KGUpOwogICAgICAgICAgcmV0dXJuIHQuc2V0SG91cnMoMjQpLCB0OwogICAgICAgIH0sCiAgICAgICAgZ2V0RGF0ZURpZmZlcmVuY2U6IGZ1bmN0aW9uIGdldERhdGVEaWZmZXJlbmNlKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gbmV3IGkoZS5nZXRGdWxsWWVhcigpLCBlLmdldE1vbnRoKCksIGUuZ2V0RGF0ZSgpKS5nZXRUaW1lKCksCiAgICAgICAgICAgICAgbyA9IG5ldyBpKHQuZ2V0RnVsbFllYXIoKSwgdC5nZXRNb250aCgpLCB0LmdldERhdGUoKSkuZ2V0VGltZSgpOwogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKG4gLSBvKSAvIGwuTUlMTElTRUNPTkRTX1BFUl9EQVkpOwogICAgICAgIH0sCiAgICAgICAgZ2V0SG91ckRpZmZlcmVuY2U6IGZ1bmN0aW9uIGdldEhvdXJEaWZmZXJlbmNlKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gbmV3IGkoZSkuZ2V0VGltZSgpLAogICAgICAgICAgICAgIG8gPSBuZXcgaSh0KS5nZXRUaW1lKCk7CiAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCgobiAtIG8pIC8gbC5NSUxMSVNFQ09ORFNfUEVSX0hPVVIpOwogICAgICAgIH0sCiAgICAgICAgaGFzTXVsdGlEYXRlczogZnVuY3Rpb24gaGFzTXVsdGlEYXRlcyhlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IGwuZ2V0RGF0ZURpZmZlcmVuY2UoZSwgdCksCiAgICAgICAgICAgICAgbyA9IE1hdGguYWJzKGwuZ2V0SG91ckRpZmZlcmVuY2UoZSwgdCkpLAogICAgICAgICAgICAgIGkgPSAtMSA9PT0gbiAmJiBvIDwgMjQgJiYgbC5pc1N0YXJ0T2ZEYXkodCk7CiAgICAgICAgICByZXR1cm4gIWwuaXNTYW1lRGF0ZShlLCB0KSAmJiAhaTsKICAgICAgICB9CiAgICAgIH0sIGUuZXhwb3J0cyA9IGw7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBzKCksCiAgICAgICAgaSA9IG8sCiAgICAgICAgYSA9IG51bGwsCiAgICAgICAgciA9ICExOwoKICAgIGZ1bmN0aW9uIHMoZSkgewogICAgICByZXR1cm4gZSA9IGUgfHwgRGF0ZS5ub3coKSwgNmU0ICogbmV3IERhdGUoZSkuZ2V0VGltZXpvbmVPZmZzZXQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjKGUpIHsKICAgICAgcmV0dXJuICFyICYmIGEgPyA2ZTQgKiBhKGUpIDogaTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KGUpIHsKICAgICAgdmFyIHQgPSBEYXRlLlVUQy5hcHBseShudWxsLCBlKTsKICAgICAgcmV0dXJuIG5ldyBEYXRlKHQgKyBzKHQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgbSkgdCA9IGUuZ2V0VVRDVGltZSgpO2Vsc2UgaWYgKCJudW1iZXIiID09IHR5cGVvZiBlKSB0ID0gZTtlbHNlIHsKICAgICAgICBpZiAobnVsbCAhPT0gZSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIFR5cGUiKTsKICAgICAgICB0ID0gMDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IERhdGUodCk7CiAgICB9CgogICAgZnVuY3Rpb24gaChlKSB7CiAgICAgIHZhciB0OwogICAgICBpZiAoZSBpbnN0YW5jZW9mIERhdGUpIHQgPSBlLmdldFRpbWUoKTtlbHNlIHsKICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBUeXBlIik7CiAgICAgICAgdCA9IERhdGUucGFyc2UoZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gcyhlKSwKICAgICAgICAgICAgbiA9IGMoZSk7CiAgICAgICAgcmV0dXJuIGUgLSBuICsgdCArIChuID8gMCA6IG8gLSB0KTsKICAgICAgfSh0KSwgbmV3IERhdGUodCk7CiAgICB9CgogICAgZnVuY3Rpb24gcChlKSB7CiAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgRGF0ZSB8fCAic3RyaW5nIiA9PSB0eXBlb2YgZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIGwuaXNVbmRlZmluZWQoZSkgJiYgKGUgPSBEYXRlLm5vdygpKSwgdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gdShhcmd1bWVudHMpIDogcChlKSA/IGgoZSkgOiBkKGUpLCB0aGlzLl9kYXRlID0gdDsKICAgIH0KCiAgICBtLnByb3RvdHlwZS5nZXRUaW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuX2RhdGUuZ2V0VGltZSgpOwoKICAgICAgcmV0dXJuIGUgKyBjKGUpIC0gcyhlKTsKICAgIH0sIG0ucHJvdG90eXBlLmdldFVUQ1RpbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kYXRlLmdldFRpbWUoKTsKICAgIH0sIG0ucHJvdG90eXBlLnRvVVRDU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fZGF0ZS50b1VUQ1N0cmluZygpOwogICAgfSwgbS5wcm90b3R5cGUudG9EYXRlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fZGF0ZTsKICAgIH0sIG0ucHJvdG90eXBlLnZhbHVlT2YgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmdldFRpbWUoKTsKICAgIH0sIG0ucHJvdG90eXBlLmFkZERhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5zZXREYXRlKHRoaXMuZ2V0RGF0ZSgpICsgZSksIHRoaXM7CiAgICB9LCBtLnByb3RvdHlwZS5hZGRNaW51dGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0TWludXRlcyh0aGlzLmdldE1pbnV0ZXMoKSArIGUpLCB0aGlzOwogICAgfSwgbS5wcm90b3R5cGUuYWRkTWlsbGlzZWNvbmRzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0TWlsbGlzZWNvbmRzKHRoaXMuZ2V0TWlsbGlzZWNvbmRzKCkgKyBlKSwgdGhpczsKICAgIH0sIG0ucHJvdG90eXBlLnNldFdpdGhSYXcgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbywgaSwgYSkgewogICAgICByZXR1cm4gdGhpcy5zZXRGdWxsWWVhcihlLCB0LCBuKSwgdGhpcy5zZXRIb3VycyhsLCBvLCBpLCBhKSwgdGhpczsKICAgIH0sIG0ucHJvdG90eXBlLnRvTG9jYWxUaW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuZ2V0VGltZSgpLAogICAgICAgICAgdCA9IHRoaXMuZ2V0VVRDVGltZSgpOwogICAgICByZXR1cm4gbmV3IG0odCAtIChlIC0gdCkpOwogICAgfSwgWyJnZXREYXRlIiwgImdldERheSIsICJnZXRGdWxsWWVhciIsICJnZXRIb3VycyIsICJnZXRNaWxsaXNlY29uZHMiLCAiZ2V0TWludXRlcyIsICJnZXRNb250aCIsICJnZXRTZWNvbmRzIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICBtLnByb3RvdHlwZVtlXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZVtlXS5hcHBseSh0aGlzLl9kYXRlLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSksIFsic2V0RGF0ZSIsICJzZXRGdWxsWWVhciIsICJzZXRIb3VycyIsICJzZXRNaWxsaXNlY29uZHMiLCAic2V0TWludXRlcyIsICJzZXRNb250aCIsICJzZXRTZWNvbmRzIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICBtLnByb3RvdHlwZVtlXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZVtlXS5hcHBseSh0aGlzLl9kYXRlLCBhcmd1bWVudHMpLCB0aGlzLmdldFRpbWUoKTsKICAgICAgfTsKICAgIH0pLCBlLmV4cG9ydHMgPSB7CiAgICAgIERhdGU6IG0sCiAgICAgIHNldE9mZnNldDogZnVuY3Rpb24gc2V0T2Zmc2V0KGUpIHsKICAgICAgICBpID0gNmU0ICogZTsKICAgICAgfSwKICAgICAgc2V0T2Zmc2V0QnlUaW1lem9uZU9wdGlvbjogZnVuY3Rpb24gc2V0T2Zmc2V0QnlUaW1lem9uZU9wdGlvbihlKSB7CiAgICAgICAgdGhpcy5zZXRPZmZzZXQoLWUpLCByID0gITA7CiAgICAgIH0sCiAgICAgIGdldE9mZnNldDogZnVuY3Rpb24gZ2V0T2Zmc2V0KCkgewogICAgICAgIHJldHVybiByID8gaSAvIDZlNCA6IDA7CiAgICAgIH0sCiAgICAgIHNldE9mZnNldENhbGxiYWNrOiBmdW5jdGlvbiBzZXRPZmZzZXRDYWxsYmFjayhlKSB7CiAgICAgICAgYSA9IGU7CiAgICAgIH0sCiAgICAgIHJlc3RvcmVPZmZzZXQ6IGZ1bmN0aW9uIHJlc3RvcmVPZmZzZXQoKSB7CiAgICAgICAgaSA9IHMoKTsKICAgICAgfQogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigxKSwKICAgICAgICBpID0gbigxMyksCiAgICAgICAgYSA9IG4oMyk7CgogICAgZnVuY3Rpb24gcihlKSB7CiAgICAgIHJldHVybiBlLmNpZCgpOwogICAgfQoKICAgIGUuZXhwb3J0cyA9IHsKICAgICAgY3JlYXRlU2NoZWR1bGVDb2xsZWN0aW9uOiBmdW5jdGlvbiBjcmVhdGVTY2hlZHVsZUNvbGxlY3Rpb24oZSkgewogICAgICAgIHZhciB0ID0gbmV3IGkocik7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggJiYgdC5hZGQuYXBwbHkodCwgYXJndW1lbnRzKSwgdDsKICAgICAgfSwKICAgICAgcmF0aW86IGZ1bmN0aW9uIHJhdGlvKGUsIHQsIG4pIHsKICAgICAgICByZXR1cm4gdCAqIG4gLyBlOwogICAgICB9LAogICAgICBuZWFyZXN0OiBmdW5jdGlvbiBuZWFyZXN0KGUsIHQpIHsKICAgICAgICB2YXIgbiA9IGwubWFwKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoZSAtIHQpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0W2wuaW5BcnJheShNYXRoLm1pbi5hcHBseShudWxsLCBuKSwgbildOwogICAgICB9LAogICAgICBtaXhpbjogZnVuY3Rpb24gbWl4aW4oZSwgdCkgewogICAgICAgIGwuZXh0ZW5kKHQucHJvdG90eXBlLCBlKTsKICAgICAgfSwKICAgICAgbGltaXQ6IGZ1bmN0aW9uIGxpbWl0KGUsIHQsIG4pIHsKICAgICAgICB2YXIgbCA9IE1hdGgubWF4LmFwcGx5KG51bGwsIFtlXS5jb25jYXQodCkpOwogICAgICAgIHJldHVybiBsID0gTWF0aC5taW4uYXBwbHkobnVsbCwgW2xdLmNvbmNhdChuKSk7CiAgICAgIH0sCiAgICAgIGxpbWl0RGF0ZTogZnVuY3Rpb24gbGltaXREYXRlKGUsIHQsIG4pIHsKICAgICAgICByZXR1cm4gZSA8IHQgPyB0IDogZSA+IG4gPyBuIDogZTsKICAgICAgfSwKICAgICAgbWF4RGF0ZTogZnVuY3Rpb24gbWF4RGF0ZShlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgPiB0ID8gZSA6IHQ7CiAgICAgIH0sCiAgICAgIHN0cmlwVGFnczogZnVuY3Rpb24gc3RyaXBUYWdzKGUpIHsKICAgICAgICByZXR1cm4gZS5yZXBsYWNlKC88KFtePl0rKT4vZ2ksICIiKTsKICAgICAgfSwKICAgICAgZmlyc3RJbjJkQXJyYXk6IGZ1bmN0aW9uIGZpcnN0SW4yZEFycmF5KGUpIHsKICAgICAgICByZXR1cm4gbC5waWNrKGUsICIwIiwgIjAiKTsKICAgICAgfSwKICAgICAgbGFzdEluMmRBcnJheTogZnVuY3Rpb24gbGFzdEluMmRBcnJheShlKSB7CiAgICAgICAgdmFyIHQgPSBlLmxlbmd0aCAtIDEsCiAgICAgICAgICAgIG4gPSBlW3RdLmxlbmd0aCAtIDE7CiAgICAgICAgcmV0dXJuIGwucGljayhlLCB0LCBuKTsKICAgICAgfSwKICAgICAgc2V0QXV0b0VsbGlwc2lzOiBmdW5jdGlvbiBzZXRBdXRvRWxsaXBzaXMoZSwgdCwgbikgewogICAgICAgIGwuZm9yRWFjaChvLmZpbmQoZSwgdCwgITApLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgKG4gfHwgZS5vZmZzZXRXaWR0aCA8IGUuc2Nyb2xsV2lkdGgpICYmIGUuc2V0QXR0cmlidXRlKCJ0aXRsZSIsIG8uZ2V0RGF0YShlLCAidGl0bGUiKSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGUsIHQsIG4pIHsKICAgICAgICB2YXIgbyA9IHQuc3BsaXQoIi4iKSwKICAgICAgICAgICAgaSA9IGU7CiAgICAgICAgbC5mb3JFYWNoKG8sIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpW2VdID0gaVtlXSB8fCB7fSwgdCA9PT0gby5sZW5ndGggLSAxID8gaVtlXSA9IG4gOiBpID0gaVtlXTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgc2hpZnRBcnJheTogZnVuY3Rpb24gc2hpZnRBcnJheShlLCB0KSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGwgPSBNYXRoLmFicyh0KTsKICAgICAgICBpZiAodCA+IDApIGZvciAobiA9IDA7IG4gPCBsOyBuICs9IDEpIHsKICAgICAgICAgIGUucHVzaChlLnNoaWZ0KCkpOwogICAgICAgIH0gZWxzZSBpZiAodCA8IDApIGZvciAobiA9IDA7IG4gPCBsOyBuICs9IDEpIHsKICAgICAgICAgIGUudW5zaGlmdChlLnBvcCgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGU7CiAgICAgIH0sCiAgICAgIHRha2VBcnJheTogZnVuY3Rpb24gdGFrZUFycmF5KGUsIHQsIG4pIHsKICAgICAgICB2YXIgbCA9IGUubGVuZ3RoIC0gbiwKICAgICAgICAgICAgbyA9IHQ7CiAgICAgICAgcmV0dXJuIGUuc3BsaWNlKG4sIGwpLCBlLnNwbGljZSgwLCBvKSwgZTsKICAgICAgfSwKICAgICAgc2hpZnRIb3VyczogZnVuY3Rpb24gc2hpZnRIb3VycyhlLCB0KSB7CiAgICAgICAgcmV0dXJuIHQgPiAwID8gZSA9IChlICsgdCkgJSAyNCA6IHQgPCAwICYmIChlID0gKGUgKz0gdCkgPiAwID8gZSA6IDI0ICsgZSksIGU7CiAgICAgIH0sCiAgICAgIHBhcnNlVW5pdDogZnVuY3Rpb24gcGFyc2VVbml0KGUpIHsKICAgICAgICByZXR1cm4gW3BhcnNlRmxvYXQoZSwgMTApLCBlLm1hdGNoKC9bXGQuXC0rXSpccyooLiopLylbMV0gfHwgIiJdOwogICAgICB9LAogICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbzsKICAgICAgICByZXR1cm4gbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gdCAmJiAobyA9IHQoZSkpLCAhbyB8fCAobyA9IGUsICExKTsKICAgICAgICB9LCBuKSwgbzsKICAgICAgfSwKICAgICAgZ2V0U2NoZWR1bGVDaGFuZ2VzOiBmdW5jdGlvbiBnZXRTY2hlZHVsZUNoYW5nZXMoZSwgdCwgbikgewogICAgICAgIHZhciBvID0ge30sCiAgICAgICAgICAgIGkgPSBbInN0YXJ0IiwgImVuZCJdOwogICAgICAgIHJldHVybiBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkuaW5kZXhPZih0KSA+IC0xID8gYS5jb21wYXJlKGVbdF0sIG5bdF0pICYmIChvW3RdID0gblt0XSkgOiBsLmlzVW5kZWZpbmVkKG5bdF0pIHx8IGVbdF0gPT09IG5bdF0gfHwgKG9bdF0gPSBuW3RdKTsKICAgICAgICB9KSwgbC5pc0VtcHR5KG8pID8gbnVsbCA6IG87CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IFsidG91Y2hzdGFydCIsICJtb3VzZWRvd24iXSwKICAgICAgICBpID0gewogICAgICBvbjogZnVuY3Rpb24gb24oZSwgdCwgbiwgbykgewogICAgICAgIGwuaXNTdHJpbmcodCkgPyBsLmZvckVhY2godC5zcGxpdCgiICIpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgaS5fb24oZSwgdCwgbiwgbyk7CiAgICAgICAgfSkgOiBsLmZvckVhY2hPd25Qcm9wZXJ0aWVzKHQsIGZ1bmN0aW9uICh0LCBsKSB7CiAgICAgICAgICBpLl9vbihlLCBsLCB0LCBuKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgX29uOiBmdW5jdGlvbiBfb24oZSwgdCwgbiwgbykgewogICAgICAgIHZhciBhLCByLCBzOwogICAgICAgIGEgPSB0ICsgbC5zdGFtcChuKSArIChvID8gIl8iICsgbC5zdGFtcChvKSA6ICIiKSwgZS5fZXZ0ICYmIGUuX2V2dFthXSB8fCAocyA9IHIgPSBmdW5jdGlvbiByKHQpIHsKICAgICAgICAgIG4uY2FsbChvIHx8IGUsIHQgfHwgd2luZG93LmV2ZW50KTsKICAgICAgICB9LCAiYWRkRXZlbnRMaXN0ZW5lciIgaW4gZSA/ICJtb3VzZWVudGVyIiA9PT0gdCB8fCAibW91c2VsZWF2ZSIgPT09IHQgPyAociA9IGZ1bmN0aW9uIHIodCkgewogICAgICAgICAgdCA9IHQgfHwgd2luZG93LmV2ZW50LCBpLl9jaGVja01vdXNlKGUsIHQpICYmIHModCk7CiAgICAgICAgfSwgZS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiA9PT0gdCA/ICJtb3VzZW92ZXIiIDogIm1vdXNlb3V0IiwgciwgITEpKSA6ICgibW91c2V3aGVlbCIgPT09IHQgJiYgZS5hZGRFdmVudExpc3RlbmVyKCJET01Nb3VzZVNjcm9sbCIsIHIsICExKSwgZS5hZGRFdmVudExpc3RlbmVyKHQsIHIsICExKSkgOiAiYXR0YWNoRXZlbnQiIGluIGUgJiYgZS5hdHRhY2hFdmVudCgib24iICsgdCwgciksIGUuX2V2dCA9IGUuX2V2dCB8fCB7fSwgZS5fZXZ0W2FdID0gcik7CiAgICAgIH0sCiAgICAgIG9mZjogZnVuY3Rpb24gb2ZmKGUsIHQsIG4sIG8pIHsKICAgICAgICBsLmlzU3RyaW5nKHQpID8gbC5mb3JFYWNoKHQuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkuX29mZihlLCB0LCBuLCBvKTsKICAgICAgICB9KSA6IGwuZm9yRWFjaE93blByb3BlcnRpZXModCwgZnVuY3Rpb24gKHQsIGwpIHsKICAgICAgICAgIGkuX29mZihlLCBsLCB0LCBuKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgX29mZjogZnVuY3Rpb24gX29mZihlLCB0LCBuLCBvKSB7CiAgICAgICAgdmFyIGkgPSB0ICsgbC5zdGFtcChuKSArIChvID8gIl8iICsgbC5zdGFtcChvKSA6ICIiKSwKICAgICAgICAgICAgYSA9IGUuX2V2dCAmJiBlLl9ldnRbaV07CgogICAgICAgIGlmIChhKSB7CiAgICAgICAgICBpZiAoInJlbW92ZUV2ZW50TGlzdGVuZXIiIGluIGUpICJtb3VzZWVudGVyIiA9PT0gdCB8fCAibW91c2VsZWF2ZSIgPT09IHQgPyBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiID09PSB0ID8gIm1vdXNlb3ZlciIgOiAibW91c2VvdXQiLCBhLCAhMSkgOiAoIm1vdXNld2hlZWwiID09PSB0ICYmIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLCBhLCAhMSksIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LCBhLCAhMSkpO2Vsc2UgaWYgKCJkZXRhY2hFdmVudCIgaW4gZSkgdHJ5IHsKICAgICAgICAgICAgZS5kZXRhY2hFdmVudCgib24iICsgdCwgYSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgZGVsZXRlIGUuX2V2dFtpXSwgbC5rZXlzKGUuX2V2dCkubGVuZ3RoIHx8IGRlbGV0ZSBlLl9ldnQ7CiAgICAgICAgfQogICAgICB9LAogICAgICBvbmNlOiBmdW5jdGlvbiBvbmNlKGUsIHQsIG4sIG8pIHsKICAgICAgICB2YXIgYSA9IHRoaXM7CiAgICAgICAgbC5pc09iamVjdCh0KSA/IGwuZm9yRWFjaE93blByb3BlcnRpZXModCwgZnVuY3Rpb24gKHQsIGwpIHsKICAgICAgICAgIGkub25jZShlLCBsLCB0LCBuKTsKICAgICAgICB9KSA6IGkub24oZSwgdCwgZnVuY3Rpb24gbCgpIHsKICAgICAgICAgIG4uYXBwbHkobyB8fCBlLCBhcmd1bWVudHMpLCBhLl9vZmYoZSwgdCwgbCwgbyk7CiAgICAgICAgfSwgbyk7CiAgICAgIH0sCiAgICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGUpIHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbiA/IGUuc3RvcFByb3BhZ2F0aW9uKCkgOiBlLmNhbmNlbEJ1YmJsZSA9ICEwOwogICAgICB9LAogICAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gcHJldmVudERlZmF1bHQoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQgPyBlLnByZXZlbnREZWZhdWx0KCkgOiBlLnJldHVyblZhbHVlID0gITE7CiAgICAgIH0sCiAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoZSkgewogICAgICAgIGkucHJldmVudERlZmF1bHQoZSksIGkuc3RvcFByb3BhZ2F0aW9uKGUpOwogICAgICB9LAogICAgICBkaXNhYmxlU2Nyb2xsUHJvcGFnYXRpb246IGZ1bmN0aW9uIGRpc2FibGVTY3JvbGxQcm9wYWdhdGlvbihlKSB7CiAgICAgICAgaS5vbihlLCAibW91c2V3aGVlbCBNb3pNb3VzZVBpeGVsU2Nyb2xsIiwgaS5zdG9wUHJvcGFnYXRpb24pOwogICAgICB9LAogICAgICBkaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbjogZnVuY3Rpb24gZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24oZSkgewogICAgICAgIGkub24oZSwgby5qb2luKCIgIikgKyAiIGNsaWNrIGRibGNsaWNrIiwgaS5zdG9wUHJvcGFnYXRpb24pOwogICAgICB9LAogICAgICBnZXRNb3VzZVBvc2l0aW9uOiBmdW5jdGlvbiBnZXRNb3VzZVBvc2l0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgbjsKICAgICAgICByZXR1cm4gdCA/IChuID0gdC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgW2UuY2xpZW50WCAtIG4ubGVmdCAtIHQuY2xpZW50TGVmdCwgZS5jbGllbnRZIC0gbi50b3AgLSB0LmNsaWVudFRvcF0pIDogW2UuY2xpZW50WCwgZS5jbGllbnRZXTsKICAgICAgfSwKICAgICAgZ2V0V2hlZWxEZWx0YTogZnVuY3Rpb24gZ2V0V2hlZWxEZWx0YShlKSB7CiAgICAgICAgdmFyIHQgPSAwOwogICAgICAgIHJldHVybiBlLndoZWVsRGVsdGEgJiYgKHQgPSBlLndoZWVsRGVsdGEgLyAxMjApLCBlLmRldGFpbCAmJiAodCA9IC1lLmRldGFpbCAvIDMpLCB0OwogICAgICB9LAogICAgICBfY2hlY2tNb3VzZTogZnVuY3Rpb24gX2NoZWNrTW91c2UoZSwgdCkgewogICAgICAgIHZhciBuID0gdC5yZWxhdGVkVGFyZ2V0OwogICAgICAgIGlmICghbikgcmV0dXJuICEwOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICg7IG4gJiYgbiAhPT0gZTspIHsKICAgICAgICAgICAgbiA9IG4ucGFyZW50Tm9kZTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbiAhPT0gZTsKICAgICAgfSwKICAgICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcihlLCB0LCBuKSB7CiAgICAgICAgbC5pc1VuZGVmaW5lZChuKSAmJiAvKG1vdXNlfGNsaWNrKS8uZXhlYyh0KSAmJiAobiA9IGkubW91c2VFdmVudCh0KSksIGUuZGlzcGF0Y2hFdmVudCA/IGUuZGlzcGF0Y2hFdmVudChuKSA6IGUuZmlyZUV2ZW50ICYmIGUuZmlyZUV2ZW50KCJvbiIgKyB0LCBuKTsKICAgICAgfSwKICAgICAgbW91c2VFdmVudDogZnVuY3Rpb24gbW91c2VFdmVudChlLCB0KSB7CiAgICAgICAgdmFyIG4sIG87CiAgICAgICAgcmV0dXJuIG8gPSBsLmV4dGVuZCh7CiAgICAgICAgICBidWJibGVzOiAhMCwKICAgICAgICAgIGNhbmNlbGFibGU6ICJtb3VzZW1vdmUiICE9PSBlLAogICAgICAgICAgdmlldzogd2luZG93LAogICAgICAgICAgd2hlZWxEZWx0YTogMCwKICAgICAgICAgIGRldGFpbDogMCwKICAgICAgICAgIHNjcmVlblg6IDAsCiAgICAgICAgICBzY3JlZW5ZOiAwLAogICAgICAgICAgY2xpZW50WDogMCwKICAgICAgICAgIGNsaWVudFk6IDAsCiAgICAgICAgICBjdHJsS2V5OiAhMSwKICAgICAgICAgIGFsdEtleTogITEsCiAgICAgICAgICBzaGlmdEtleTogITEsCiAgICAgICAgICBtZXRhS2V5OiAhMSwKICAgICAgICAgIGJ1dHRvbjogMCwKICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHZvaWQgMAogICAgICAgIH0sIHQpLCAiZnVuY3Rpb24iID09IHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFdmVudCA/IChuID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIikpLmluaXRNb3VzZUV2ZW50KGUsIG8uYnViYmxlcywgby5jYW5jZWxhYmxlLCBvLnZpZXcsIG8uZGV0YWlsLCBvLnNjcmVlblgsIG8uc2NyZWVuWSwgby5jbGllbnRYLCBvLmNsaWVudFksIG8uY3RybEtleSwgby5hbHRLZXksIG8uc2hpZnRLZXksIG8ubWV0YUtleSwgby5idXR0b24sIGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZSkgOiBkb2N1bWVudC5jcmVhdGVFdmVudE9iamVjdCAmJiAobiA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCksIGwuZm9yRWFjaChvLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgblt0XSA9IGU7CiAgICAgICAgfSwgdGhpcyksIG4uYnV0dG9uID0gewogICAgICAgICAgMDogMSwKICAgICAgICAgIDE6IDQsCiAgICAgICAgICAyOiAyCiAgICAgICAgfVtuLmJ1dHRvbl0gfHwgbi5idXR0b24pLCBuOwogICAgICB9LAogICAgICBnZXRNb3VzZUJ1dHRvbjogZnVuY3Rpb24gZ2V0TW91c2VCdXR0b24oZSkgewogICAgICAgIHZhciB0OwogICAgICAgIHJldHVybiBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5oYXNGZWF0dXJlKCJNb3VzZUV2ZW50cyIsICIyLjAiKSA/IGUuYnV0dG9uIDogKHQgPSBTdHJpbmcoZS5idXR0b24pLCAiMCwxLDMsNSw3Ii5pbmRleE9mKHQpID4gLTEgPyAwIDogIjIsNiIuaW5kZXhPZih0KSA+IC0xID8gMiA6IH4iNCIuaW5kZXhPZih0KSA/IDEgOiAtMSk7CiAgICAgIH0sCiAgICAgIGdldEV2ZW50VGFyZ2V0OiBmdW5jdGlvbiBnZXRFdmVudFRhcmdldChlKSB7CiAgICAgICAgcmV0dXJuIGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKICAgICAgfQogICAgfTsKICAgIGUuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIGUuZXhwb3J0cyA9IG4oMjEpLmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMSksCiAgICAgICAgaSA9IG4oMTMpOwoKICAgIGZ1bmN0aW9uIGEoZSkgewogICAgICB2YXIgdCA9IGwuc3RhbXAodGhpcyk7CiAgICAgIGwuaXNVbmRlZmluZWQoZSkgJiYgKGUgPSBvLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiKSksIG8uYWRkQ2xhc3MoZSwgdGhpcy5jc3NwcmVmaXgodCkpLCB0aGlzLmlkID0gdCwgdGhpcy5jb250YWluZXIgPSBlLCB0aGlzLmNoaWxkcmVuID0gbmV3IGkoZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbC5zdGFtcChlKTsKICAgICAgfSksIHRoaXMucGFyZW50ID0gbnVsbCwgdGhpcy5zdGF0ZSA9IHt9OwogICAgfQoKICAgIGEucHJvdG90eXBlLmNzc1ByZWZpeCA9ICJ0dWktdmlldy0iLCBhLnByb3RvdHlwZS5hZGRDaGlsZCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHQgJiYgdC5jYWxsKGUsIHRoaXMpLCBlLnBhcmVudCA9IHRoaXMsIHRoaXMuY2hpbGRyZW4uYWRkKGUpOwogICAgfSwgYS5wcm90b3R5cGUucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IGwuaXNOdW1iZXIoZSkgPyB0aGlzLmNoaWxkcmVuLml0ZW1zW2VdIDogZTsKICAgICAgZSA9IGwuc3RhbXAobiksIHQgJiYgdC5jYWxsKG4sIHRoaXMpLCB0aGlzLmNoaWxkcmVuLnJlbW92ZShlKTsKICAgIH0sIGEucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5yZW5kZXIoKTsKICAgICAgfSk7CiAgICB9LCBhLnByb3RvdHlwZS5yZWN1cnNpdmUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBsLmlzRnVuY3Rpb24oZSkgJiYgKHQgfHwgZSh0aGlzKSwgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5yZWN1cnNpdmUoZSk7CiAgICAgIH0pKTsKICAgIH0sIGEucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyksIHQgPSB0aGlzLnBhcmVudDsgdDspIHsKICAgICAgICBsLmlzRnVuY3Rpb24odC5fb25SZXNpemUpICYmIHQuX29uUmVzaXplLmFwcGx5KHQsIGUpLCB0ID0gdC5wYXJlbnQ7CiAgICAgIH0KICAgIH0sIGEucHJvdG90eXBlLl9iZWZvcmVEZXN0cm95ID0gZnVuY3Rpb24gKCkge30sIGEucHJvdG90eXBlLl9kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9iZWZvcmVEZXN0cm95KCksIHRoaXMuY2hpbGRyZW4uY2xlYXIoKSwgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gIiIsIHRoaXMuaWQgPSB0aGlzLnBhcmVudCA9IHRoaXMuY2hpbGRyZW4gPSB0aGlzLmNvbnRhaW5lciA9IG51bGw7CiAgICB9LCBhLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5kZXN0cm95KCEwKSwgZS5fZGVzdHJveSgpOwogICAgICB9KSwgZSB8fCB0aGlzLl9kZXN0cm95KCk7CiAgICB9LCBhLnByb3RvdHlwZS5nZXRWaWV3Qm91bmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5jb250YWluZXIsCiAgICAgICAgICB0ID0gby5nZXRQb3NpdGlvbihlKSwKICAgICAgICAgIG4gPSBvLmdldFNpemUoZSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogdFswXSwKICAgICAgICB5OiB0WzFdLAogICAgICAgIHdpZHRoOiBuWzBdLAogICAgICAgIGhlaWdodDogblsxXQogICAgICB9OwogICAgfSwgYS5wcm90b3R5cGUuY3NzcHJlZml4ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuY3NzUHJlZml4ICsgKGUgfHwgIiIpOwogICAgfSwgYS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICBsLmV4dGVuZCh0aGlzLnN0YXRlLCBlKTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKGEpLCBlLmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uIChlLCB0KSB7CiAgICB2YXIgbjsKCiAgICBuID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0oKTsKCiAgICB0cnkgewogICAgICBuID0gbiB8fCBuZXcgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgIm9iamVjdCIgPT0gKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHdpbmRvdykpICYmIChuID0gd2luZG93KTsKICAgIH0KCiAgICBlLmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITAsIHQuZXh0ZW5kID0gciwgdC5pbmRleE9mID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgZm9yICh2YXIgbiA9IDAsIGwgPSBlLmxlbmd0aDsgbiA8IGw7IG4rKykgewogICAgICAgIGlmIChlW25dID09PSB0KSByZXR1cm4gbjsKICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfSwgdC5lc2NhcGVFeHByZXNzaW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZiBlKSB7CiAgICAgICAgaWYgKGUgJiYgZS50b0hUTUwpIHJldHVybiBlLnRvSFRNTCgpOwogICAgICAgIGlmIChudWxsID09IGUpIHJldHVybiAiIjsKICAgICAgICBpZiAoIWUpIHJldHVybiBlICsgIiI7CiAgICAgICAgZSA9ICIiICsgZTsKICAgICAgfQoKICAgICAgaWYgKCFpLnRlc3QoZSkpIHJldHVybiBlOwogICAgICByZXR1cm4gZS5yZXBsYWNlKG8sIGEpOwogICAgfSwgdC5pc0VtcHR5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuICFlICYmIDAgIT09IGUgfHwgISghdShlKSB8fCAwICE9PSBlLmxlbmd0aCk7CiAgICB9LCB0LmNyZWF0ZUZyYW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSByKHt9LCBlKTsKICAgICAgcmV0dXJuIHQuX3BhcmVudCA9IGUsIHQ7CiAgICB9LCB0LmJsb2NrUGFyYW1zID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIGUucGF0aCA9IHQsIGU7CiAgICB9LCB0LmFwcGVuZENvbnRleHRQYXRoID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIChlID8gZSArICIuIiA6ICIiKSArIHQ7CiAgICB9OwogICAgdmFyIGwgPSB7CiAgICAgICImIjogIiZhbXA7IiwKICAgICAgIjwiOiAiJmx0OyIsCiAgICAgICI+IjogIiZndDsiLAogICAgICAnIic6ICImcXVvdDsiLAogICAgICAiJyI6ICImI3gyNzsiLAogICAgICAiYCI6ICImI3g2MDsiLAogICAgICAiPSI6ICImI3gzRDsiCiAgICB9LAogICAgICAgIG8gPSAvWyY8PiInYD1dL2csCiAgICAgICAgaSA9IC9bJjw+IidgPV0vOwoKICAgIGZ1bmN0aW9uIGEoZSkgewogICAgICByZXR1cm4gbFtlXTsKICAgIH0KCiAgICBmdW5jdGlvbiByKGUpIHsKICAgICAgZm9yICh2YXIgdCA9IDE7IHQgPCBhcmd1bWVudHMubGVuZ3RoOyB0KyspIHsKICAgICAgICBmb3IgKHZhciBuIGluIGFyZ3VtZW50c1t0XSkgewogICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGFyZ3VtZW50c1t0XSwgbikgJiYgKGVbbl0gPSBhcmd1bWVudHNbdF1bbl0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGU7CiAgICB9CgogICAgdmFyIHMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogICAgdC50b1N0cmluZyA9IHM7CgogICAgdmFyIGMgPSBmdW5jdGlvbiBjKGUpIHsKICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIGU7CiAgICB9OwoKICAgIGMoL3gvKSAmJiAodC5pc0Z1bmN0aW9uID0gYyA9IGZ1bmN0aW9uIGMoZSkgewogICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSAmJiAiW29iamVjdCBGdW5jdGlvbl0iID09PSBzLmNhbGwoZSk7CiAgICB9KSwgdC5pc0Z1bmN0aW9uID0gYzsKCiAgICB2YXIgdSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuICEoIWUgfHwgIm9iamVjdCIgIT0gX3R5cGVvZihlKSkgJiYgIltvYmplY3QgQXJyYXldIiA9PT0gcy5jYWxsKGUpOwogICAgfTsKCiAgICB0LmlzQXJyYXkgPSB1OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSBuKDApOwoKICAgICAgZnVuY3Rpb24gYShlKSB7CiAgICAgICAgcmV0dXJuIHRbIndlYmtpdCIgKyBlXSB8fCB0WyJtb3oiICsgZV0gfHwgdFsibXMiICsgZV07CiAgICAgIH0KCiAgICAgIGwgPSB0LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBhKCJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiKSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGUuY2FsbCh0KTsKICAgICAgfSwgbyA9IHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUgfHwgYSgiQ2FuY2VsQW5pbWF0aW9uRnJhbWUiKSB8fCBhKCJDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiKSB8fCBmdW5jdGlvbiAoKSB7fSwgZS5leHBvcnRzID0gewogICAgICAgIHJlcXVlc3RBbmltRnJhbWU6IGZ1bmN0aW9uIHJlcXVlc3RBbmltRnJhbWUoZSwgbikgewogICAgICAgICAgcmV0dXJuIGwuY2FsbCh0LCBpLmJpbmQoZSwgbikpOwogICAgICAgIH0sCiAgICAgICAgY2FuY2VsQW5pbUZyYW1lOiBmdW5jdGlvbiBjYW5jZWxBbmltRnJhbWUoZSkgewogICAgICAgICAgZSAmJiBvLmNhbGwodCwgZSk7CiAgICAgICAgfQogICAgICB9OwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwOwogICAgdmFyIGwgPSBbImRlc2NyaXB0aW9uIiwgImZpbGVOYW1lIiwgImxpbmVOdW1iZXIiLCAiZW5kTGluZU51bWJlciIsICJtZXNzYWdlIiwgIm5hbWUiLCAibnVtYmVyIiwgInN0YWNrIl07CgogICAgZnVuY3Rpb24gbyhlLCB0KSB7CiAgICAgIHZhciBuID0gdCAmJiB0LmxvYywKICAgICAgICAgIGkgPSB2b2lkIDAsCiAgICAgICAgICBhID0gdm9pZCAwLAogICAgICAgICAgciA9IHZvaWQgMCwKICAgICAgICAgIHMgPSB2b2lkIDA7CiAgICAgIG4gJiYgKGkgPSBuLnN0YXJ0LmxpbmUsIGEgPSBuLmVuZC5saW5lLCByID0gbi5zdGFydC5jb2x1bW4sIHMgPSBuLmVuZC5jb2x1bW4sIGUgKz0gIiAtICIgKyBpICsgIjoiICsgcik7CgogICAgICBmb3IgKHZhciBjID0gRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgZSksIHUgPSAwOyB1IDwgbC5sZW5ndGg7IHUrKykgewogICAgICAgIHRoaXNbbFt1XV0gPSBjW2xbdV1dOwogICAgICB9CgogICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSAmJiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBvKTsKCiAgICAgIHRyeSB7CiAgICAgICAgbiAmJiAodGhpcy5saW5lTnVtYmVyID0gaSwgdGhpcy5lbmRMaW5lTnVtYmVyID0gYSwgT2JqZWN0LmRlZmluZVByb3BlcnR5ID8gKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29sdW1uIiwgewogICAgICAgICAgdmFsdWU6IHIsCiAgICAgICAgICBlbnVtZXJhYmxlOiAhMAogICAgICAgIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgImVuZENvbHVtbiIsIHsKICAgICAgICAgIHZhbHVlOiBzLAogICAgICAgICAgZW51bWVyYWJsZTogITAKICAgICAgICB9KSkgOiAodGhpcy5jb2x1bW4gPSByLCB0aGlzLmVuZENvbHVtbiA9IHMpKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KCiAgICBvLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpLCB0LmRlZmF1bHQgPSBvLCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IGwuZm9yRWFjaE93blByb3BlcnRpZXMsCiAgICAgICAgaSA9IGwuZm9yRWFjaEFycmF5LAogICAgICAgIGEgPSBsLmlzRnVuY3Rpb24sCiAgICAgICAgciA9IGwuaXNPYmplY3QsCiAgICAgICAgcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCiAgICBmdW5jdGlvbiBjKGUpIHsKICAgICAgdGhpcy5pdGVtcyA9IHt9LCB0aGlzLmxlbmd0aCA9IDAsIGEoZSkgJiYgKHRoaXMuZ2V0SXRlbUlEID0gZSk7CiAgICB9CgogICAgYy5hbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdDsKICAgICAgcmV0dXJuIGUgPSBzLmNhbGwoYXJndW1lbnRzKSwgdCA9IGUubGVuZ3RoLCBmdW5jdGlvbiAobikgewogICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgdDsgbCArPSAxKSB7CiAgICAgICAgICBpZiAoIWVbbF0uY2FsbChudWxsLCBuKSkgcmV0dXJuICExOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICEwOwogICAgICB9OwogICAgfSwgYy5wcm90b3R5cGUuZ2V0SXRlbUlEID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIFN0cmluZyhlLl9pZCk7CiAgICB9LCBjLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpczsKICAgICAgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBpKHMuY2FsbChhcmd1bWVudHMpLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGwuYWRkKGUpOwogICAgICB9KSA6ICh0ID0gdGhpcy5nZXRJdGVtSUQoZSksIChuID0gdGhpcy5pdGVtcylbdF0gfHwgKHRoaXMubGVuZ3RoICs9IDEpLCBuW3RdID0gZSk7CiAgICB9LCBjLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBvID0gdGhpcywKICAgICAgICAgIGkgPSBbXTsKICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoID8gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBpID0gbC5tYXAocy5jYWxsKGFyZ3VtZW50cyksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIG8ucmVtb3ZlKGUpOwogICAgICB9KSA6ICh0ID0gdGhpcy5pdGVtcywgcihlKSAmJiAoZSA9IHRoaXMuZ2V0SXRlbUlEKGUpKSwgdFtlXSA/ICh0aGlzLmxlbmd0aCAtPSAxLCBuID0gdFtlXSwgZGVsZXRlIHRbZV0sIG4pIDogaSkgOiBpOwogICAgfSwgYy5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuaXRlbXMgPSB7fSwgdGhpcy5sZW5ndGggPSAwOwogICAgfSwgYy5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgIHJldHVybiAhIXRoaXMubGVuZ3RoICYmICh0ID0gYShlKSwgbiA9ICExLCB0ID8gdGhpcy5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICEwICE9PSBlKHQpIHx8IChuID0gITAsICExKTsKICAgICAgfSkgOiAoZSA9IHIoZSkgPyB0aGlzLmdldEl0ZW1JRChlKSA6IGUsIG4gPSBsLmlzRXhpc3R5KHRoaXMuaXRlbXNbZV0pKSwgbik7CiAgICB9LCBjLnByb3RvdHlwZS5kb1doZW5IYXMgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IHRoaXMuaXRlbXNbZV07CiAgICAgIGwuaXNFeGlzdHkobykgJiYgdC5jYWxsKG4gfHwgdGhpcywgbyk7CiAgICB9LCBjLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBuZXcgYygpOwogICAgICByZXR1cm4gdGhpcy5oYXNPd25Qcm9wZXJ0eSgiZ2V0SXRlbUlEIikgJiYgKHQuZ2V0SXRlbUlEID0gdGhpcy5nZXRJdGVtSUQpLCB0aGlzLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAhMCA9PT0gZShuKSAmJiB0LmFkZChuKTsKICAgICAgfSksIHQ7CiAgICB9LCBjLnByb3RvdHlwZS5ncm91cEJ5ID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBvLAogICAgICAgICAgaSA9IHt9LAogICAgICAgICAgciA9IGEoZSksCiAgICAgICAgICBzID0gdGhpcy5nZXRJdGVtSUQ7CgogICAgICBpZiAobC5pc0FycmF5KGUpKSB7CiAgICAgICAgaWYgKGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpW1N0cmluZyhlKV0gPSBuZXcgYyhzKTsKICAgICAgICB9KSwgIXQpIHJldHVybiBpOwogICAgICAgIGUgPSB0LCByID0gITA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICByID8gbyA9IGUodCkgOiAobyA9IHRbZV0sIGEobykgJiYgKG8gPSBvLmFwcGx5KHQpKSksIChuID0gaVtvXSkgfHwgKG4gPSBpW29dID0gbmV3IGMocykpLCBuLmFkZCh0KTsKICAgICAgfSksIGk7CiAgICB9LCBjLnByb3RvdHlwZS5zaW5nbGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBsLmlzRnVuY3Rpb24oZSk7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGwpIHsKICAgICAgICByZXR1cm4gbiAmJiAhZShsKSB8fCAodCA9IGwsICExKTsKICAgICAgfSwgdGhpcyksIHQ7CiAgICB9LCBjLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBbXTsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgIHQucHVzaChlKTsKICAgICAgfSksIGEoZSkgJiYgKHQgPSB0LnNvcnQoZSkpLCB0OwogICAgfSwgYy5wcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIG8odGhpcy5pdGVtcywgZSwgdCB8fCB0aGlzKTsKICAgIH0sIGMucHJvdG90eXBlLnRvQXJyYXkgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA/IGwubWFwKHRoaXMuaXRlbXMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGU7CiAgICAgIH0pIDogW107CiAgICB9LCBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDQpLkRhdGUsCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oNTUpLAogICAgICAgIHIgPSBuKDU2KSwKICAgICAgICBzID0gaS5NSUxMSVNFQ09ORFNfU0NIRURVTEVfTUlOX0RVUkFUSU9OLAogICAgICAgIGMgPSAiYWxsZGF5IjsKCiAgICBmdW5jdGlvbiB1KCkgewogICAgICB0aGlzLmlkID0gIiIsIHRoaXMudGl0bGUgPSAiIiwgdGhpcy5ib2R5ID0gIiIsIHRoaXMuaXNBbGxEYXkgPSAhMSwgdGhpcy5zdGFydCA9IG51bGwsIHRoaXMuZW5kID0gbnVsbCwgdGhpcy5jb2xvciA9ICIjMDAwIiwgdGhpcy5pc1Zpc2libGUgPSAhMCwgdGhpcy5iZ0NvbG9yID0gIiNhMWI1NmMiLCB0aGlzLmRyYWdCZ0NvbG9yID0gIiNhMWI1NmMiLCB0aGlzLmJvcmRlckNvbG9yID0gIiMwMDAiLCB0aGlzLmNhbGVuZGFySWQgPSAiIiwgdGhpcy5jYXRlZ29yeSA9ICIiLCB0aGlzLmR1ZURhdGVDbGFzcyA9ICIiLCB0aGlzLmN1c3RvbVN0eWxlID0gIiIsIHRoaXMuaXNQZW5kaW5nID0gITEsIHRoaXMuaXNGb2N1c2VkID0gITEsIHRoaXMuaXNSZWFkT25seSA9ICExLCB0aGlzLmlzUHJpdmF0ZSA9ICExLCB0aGlzLmxvY2F0aW9uID0gIiIsIHRoaXMuYXR0ZW5kZWVzID0gW10sIHRoaXMucmVjdXJyZW5jZVJ1bGUgPSAiIiwgdGhpcy5zdGF0ZSA9ICIiLCB0aGlzLmdvaW5nRHVyYXRpb24gPSAwLCB0aGlzLmNvbWluZ0R1cmF0aW9uID0gMCwgdGhpcy5yYXcgPSBudWxsLCBsLnN0YW1wKHRoaXMpOwogICAgfQoKICAgIHUuc2NoZW1hID0gewogICAgICByZXF1aXJlZDogWyJ0aXRsZSJdLAogICAgICBkYXRlUmFuZ2U6IFsic3RhcnQiLCAiZW5kIl0KICAgIH0sIHUuY3JlYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBuZXcgdSgpOwogICAgICByZXR1cm4gdC5pbml0KGUpLCB0OwogICAgfSwgdS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIChlID0gbC5leHRlbmQoe30sIGUpKS5jYXRlZ29yeSA9PT0gYyAmJiAoZS5pc0FsbERheSA9ICEwKSwgdGhpcy5pZCA9IGUuaWQgfHwgIiIsIHRoaXMudGl0bGUgPSBlLnRpdGxlIHx8ICIiLCB0aGlzLmJvZHkgPSBlLmJvZHkgfHwgIiIsIHRoaXMuaXNBbGxEYXkgPSAhIWwuaXNFeGlzdHkoZS5pc0FsbERheSkgJiYgZS5pc0FsbERheSwgdGhpcy5pc1Zpc2libGUgPSAhbC5pc0V4aXN0eShlLmlzVmlzaWJsZSkgfHwgZS5pc1Zpc2libGUsIHRoaXMuY29sb3IgPSBlLmNvbG9yIHx8IHRoaXMuY29sb3IsIHRoaXMuYmdDb2xvciA9IGUuYmdDb2xvciB8fCB0aGlzLmJnQ29sb3IsIHRoaXMuZHJhZ0JnQ29sb3IgPSBlLmRyYWdCZ0NvbG9yIHx8IHRoaXMuZHJhZ0JnQ29sb3IsIHRoaXMuYm9yZGVyQ29sb3IgPSBlLmJvcmRlckNvbG9yIHx8IHRoaXMuYm9yZGVyQ29sb3IsIHRoaXMuY2FsZW5kYXJJZCA9IGUuY2FsZW5kYXJJZCB8fCAiIiwgdGhpcy5jYXRlZ29yeSA9IGUuY2F0ZWdvcnkgfHwgIiIsIHRoaXMuZHVlRGF0ZUNsYXNzID0gZS5kdWVEYXRlQ2xhc3MgfHwgIiIsIHRoaXMuY3VzdG9tU3R5bGUgPSBlLmN1c3RvbVN0eWxlIHx8ICIiLCB0aGlzLmxvY2F0aW9uID0gZS5sb2NhdGlvbiB8fCAiIiwgdGhpcy5hdHRlbmRlZXMgPSBlLmF0dGVuZGVlcyB8fCBbXSwgdGhpcy5yZWN1cnJlbmNlUnVsZSA9IGUucmVjdXJyZW5jZVJ1bGUgfHwgIiIsIHRoaXMuaXNQcml2YXRlID0gZS5pc1ByaXZhdGUgfHwgITEsIHRoaXMuaXNQZW5kaW5nID0gZS5pc1BlbmRpbmcgfHwgITEsIHRoaXMuaXNGb2N1c2VkID0gZS5pc0ZvY3VzZWQgfHwgITEsIHRoaXMuaXNSZWFkT25seSA9IGUuaXNSZWFkT25seSB8fCAhMSwgdGhpcy5nb2luZ0R1cmF0aW9uID0gZS5nb2luZ0R1cmF0aW9uIHx8IDAsIHRoaXMuY29taW5nRHVyYXRpb24gPSBlLmNvbWluZ0R1cmF0aW9uIHx8IDAsIHRoaXMuc3RhdGUgPSBlLnN0YXRlIHx8ICIiLCB0aGlzLmlzQWxsRGF5ID8gdGhpcy5zZXRBbGxEYXlQZXJpb2QoZS5zdGFydCwgZS5lbmQpIDogdGhpcy5zZXRUaW1lUGVyaW9kKGUuc3RhcnQsIGUuZW5kKSwgdGhpcy5yYXcgPSBlLnJhdyB8fCBudWxsOwogICAgfSwgdS5wcm90b3R5cGUuc2V0QWxsRGF5UGVyaW9kID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgZSA9IGwuaXNTdHJpbmcoZSkgPyBpLnBhcnNlKGUuc3Vic3RyaW5nKDAsIDEwKSkgOiBuZXcgbyhlIHx8IERhdGUubm93KCkpLCB0ID0gbC5pc1N0cmluZyh0KSA/IGkucGFyc2UodC5zdWJzdHJpbmcoMCwgMTApKSA6IG5ldyBvKHQgfHwgdGhpcy5zdGFydCksIHRoaXMuc3RhcnQgPSBlLCB0aGlzLnN0YXJ0LnNldEhvdXJzKDAsIDAsIDApLCB0aGlzLmVuZCA9IHQgfHwgbmV3IG8odGhpcy5zdGFydCksIHRoaXMuZW5kLnNldEhvdXJzKDIzLCA1OSwgNTkpOwogICAgfSwgdS5wcm90b3R5cGUuc2V0VGltZVBlcmlvZCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHRoaXMuc3RhcnQgPSBuZXcgbyhlIHx8IERhdGUubm93KCkpLCB0aGlzLmVuZCA9IG5ldyBvKHQgfHwgdGhpcy5zdGFydCksIHQgfHwgdGhpcy5lbmQuc2V0TWludXRlcyh0aGlzLmVuZC5nZXRNaW51dGVzKCkgKyAzMCk7CiAgICB9LCB1LnByb3RvdHlwZS5nZXRTdGFydHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXJ0OwogICAgfSwgdS5wcm90b3R5cGUuZ2V0RW5kcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZW5kOwogICAgfSwgdS5wcm90b3R5cGUuY2lkID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbC5zdGFtcCh0aGlzKTsKICAgIH0sIHUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmlkID09PSBlLmlkICYmIHRoaXMudGl0bGUgPT09IGUudGl0bGUgJiYgdGhpcy5ib2R5ID09PSBlLmJvZHkgJiYgdGhpcy5pc0FsbERheSA9PT0gZS5pc0FsbERheSAmJiAwID09PSBpLmNvbXBhcmUodGhpcy5nZXRTdGFydHMoKSwgZS5nZXRTdGFydHMoKSkgJiYgMCA9PT0gaS5jb21wYXJlKHRoaXMuZ2V0RW5kcygpLCBlLmdldEVuZHMoKSkgJiYgdGhpcy5jb2xvciA9PT0gZS5jb2xvciAmJiB0aGlzLmJnQ29sb3IgPT09IGUuYmdDb2xvciAmJiB0aGlzLmRyYWdCZ0NvbG9yID09PSBlLmRyYWdCZ0NvbG9yICYmIHRoaXMuYm9yZGVyQ29sb3IgPT09IGUuYm9yZGVyQ29sb3I7CiAgICB9LCB1LnByb3RvdHlwZS5kdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmdldFN0YXJ0cygpLAogICAgICAgICAgdCA9IHRoaXMuZ2V0RW5kcygpOwogICAgICByZXR1cm4gdGhpcy5pc0FsbERheSA/IGkuZW5kKHQpIC0gaS5zdGFydChlKSA6IHQgLSBlOwogICAgfSwgdS5wcm90b3R5cGUuY29sbGlkZXNXaXRoID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmdldFN0YXJ0cygpLAogICAgICAgICAgbiA9IHRoaXMuZ2V0RW5kcygpLAogICAgICAgICAgbCA9IGUuZ2V0U3RhcnRzKCksCiAgICAgICAgICBvID0gZS5nZXRFbmRzKCksCiAgICAgICAgICBhID0gaS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgdGhpcy5nb2luZ0R1cmF0aW9uKSwKICAgICAgICAgIHIgPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCB0aGlzLmNvbWluZ0R1cmF0aW9uKSwKICAgICAgICAgIGMgPSBpLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLmdvaW5nRHVyYXRpb24pLAogICAgICAgICAgdSA9IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIGUuY29taW5nRHVyYXRpb24pOwogICAgICByZXR1cm4gTWF0aC5hYnMobiAtIHQpIDwgcyAmJiAobiArPSBzKSwgTWF0aC5hYnMobyAtIGwpIDwgcyAmJiAobyArPSBzKSwgbiArPSByLCBvICs9IHUsIChsIC09IGMpID4gKHQgLT0gYSkgJiYgbCA8IG4gfHwgbyA+IHQgJiYgbyA8IG4gfHwgbCA8PSB0ICYmIG8gPj0gbjsKICAgIH0sIHIubWl4aW4odS5wcm90b3R5cGUpLCBhLm1peGluKHUucHJvdG90eXBlKSwgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigzKTsKCiAgICBmdW5jdGlvbiBpKGUsIHQpIHsKICAgICAgcmV0dXJuIGUgIT09IHQgPyBlID8gLTEgOiAxIDogMDsKICAgIH0KCiAgICBmdW5jdGlvbiBhKGUsIHQpIHsKICAgICAgdmFyIG4gPSBTdHJpbmcoZSksCiAgICAgICAgICBsID0gU3RyaW5nKHQpOwogICAgICByZXR1cm4gbiA+IGwgPyAxIDogbiA8IGwgPyAtMSA6IDA7CiAgICB9CgogICAgZS5leHBvcnRzID0gewogICAgICBic2VhcmNoOiBmdW5jdGlvbiBic2VhcmNoKGUsIHQsIG4sIGwpIHsKICAgICAgICB2YXIgbywKICAgICAgICAgICAgaSwKICAgICAgICAgICAgciA9IDAsCiAgICAgICAgICAgIHMgPSBlLmxlbmd0aCAtIDE7CgogICAgICAgIGZvciAobCA9IGwgfHwgYTsgciA8PSBzOykgewogICAgICAgICAgaWYgKG8gPSAociArIHMpIC8gMiB8IDAsIChpID0gbChuID8gbihlW29dKSA6IGVbb10sIHQpKSA8IDApIHIgPSBvICsgMTtlbHNlIHsKICAgICAgICAgICAgaWYgKCEoaSA+IDApKSByZXR1cm4gbzsKICAgICAgICAgICAgcyA9IG8gLSAxOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIH5zOwogICAgICB9LAogICAgICBjb21wYXJlOiB7CiAgICAgICAgc2NoZWR1bGU6IHsKICAgICAgICAgIGFzYzogZnVuY3Rpb24gYXNjKGUsIHQpIHsKICAgICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICBjID0gZS52YWx1ZU9mKCksCiAgICAgICAgICAgICAgICB1ID0gdC52YWx1ZU9mKCk7CiAgICAgICAgICAgIHJldHVybiAociA9IGkoYy5pc0FsbERheSB8fCBlLmhhc011bHRpRGF0ZXMsIHUuaXNBbGxEYXkgfHwgdC5oYXNNdWx0aURhdGVzKSkgPyByIDogKHMgPSBvLmNvbXBhcmUoZS5nZXRTdGFydHMoKSwgdC5nZXRTdGFydHMoKSkpID8gcyA6IChuID0gZS5kdXJhdGlvbigpKSA8IChhID0gdC5kdXJhdGlvbigpKSA/IDEgOiBuID4gYSA/IC0xIDogbC5zdGFtcChjKSAtIGwuc3RhbXAodSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBib29sOiB7CiAgICAgICAgICBhc2M6IGksCiAgICAgICAgICBkZXNjOiBmdW5jdGlvbiBkZXNjKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIGUgIT09IHQgPyBlID8gMSA6IC0xIDogMDsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG51bTogewogICAgICAgICAgYXNjOiBmdW5jdGlvbiBhc2MoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKGUpIC0gTnVtYmVyKHQpOwogICAgICAgICAgfSwKICAgICAgICAgIGRlc2M6IGZ1bmN0aW9uIGRlc2MoZSwgdCkgewogICAgICAgICAgICB2YXIgbiA9IE51bWJlcihlKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcih0KSAtIG47CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdHI6IHsKICAgICAgICAgIGFzYzogYSwKICAgICAgICAgIGRlc2M6IGZ1bmN0aW9uIGRlc2MoZSwgdCkgewogICAgICAgICAgICB2YXIgbiA9IFN0cmluZyhlKSwKICAgICAgICAgICAgICAgIGwgPSBTdHJpbmcodCk7CiAgICAgICAgICAgIHJldHVybiBuID4gbCA/IC0xIDogbiA8IGwgPyAxIDogMDsKICAgICAgICAgIH0sCiAgICAgICAgICBhc2NJZ25vcmVDYXNlOiBmdW5jdGlvbiBhc2NJZ25vcmVDYXNlKGUsIHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBTdHJpbmcoZSkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIGwgPSBTdHJpbmcodCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgcmV0dXJuIG4gPiBsID8gMSA6IG4gPCBsID8gLTEgOiAwOwogICAgICAgICAgfSwKICAgICAgICAgIGRlc2NJZ25vcmVDYXNlOiBmdW5jdGlvbiBkZXNjSWdub3JlQ2FzZShlLCB0KSB7CiAgICAgICAgICAgIHZhciBuID0gU3RyaW5nKGUpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICBsID0gU3RyaW5nKHQpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHJldHVybiBuID4gbCA/IC0xIDogbiA8IGwgPyAxIDogMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oOCk7CgogICAgZnVuY3Rpb24gcihlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCA9IHRbci5QUk9QX0tFWV07CiAgICAgIGwgfHwgKGwgPSB0W3IuUFJPUF9LRVldID0gW10pLCBsLnB1c2godGhpcyksIHRoaXMuc2libGluZyA9IGwsIHRoaXMuekluZGV4ID0gdGhpcy5nZXRMYXJnZXN0WkluZGV4KCkgfHwgci5JTklUX1pJTkRFWCwgKG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSkuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgbi5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSIsIGkuYWRkQ2xhc3Mobiwgby5jbGFzc25hbWUoImZsb2F0aW5nLWxheWVyIikpLCB0LmFwcGVuZENoaWxkKG4pLCBhLmNhbGwodGhpcywgbiksIHRoaXMucGFyZW50ID0gdDsKICAgIH0KCiAgICBsLmluaGVyaXQociwgYSksIHIuUFJPUF9LRVkgPSAiX19mZV9mbG9hdGluZ19sYXllciIsIHIuSU5JVF9aSU5ERVggPSA5OTksIHIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIGUgPSB0aGlzLnBhcmVudCwgdCA9IHRoaXMuc2libGluZywgbiA9IDAsIGwgPSB0Lmxlbmd0aDsgbiA8IGw7IG4gKz0gMSkgewogICAgICAgIGlmICh0W25dID09PSB0aGlzKSB7CiAgICAgICAgICB0LnNwbGljZShuLCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCF0Lmxlbmd0aCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkZWxldGUgZVtyLlBST1BfS0VZXTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICBlW3IuUFJPUF9LRVldID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGUuc3R5bGUucG9zaXRpb24gPSAiIjsKICAgICAgfQoKICAgICAgaS5yZW1vdmUodGhpcy5jb250YWluZXIpLCB0aGlzLnNpYmxpbmcgPSBudWxsLCBhLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7CiAgICB9LCByLnByb3RvdHlwZS5pc1Zpc2libGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAibm9uZSIgIT09IHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXk7CiAgICB9LCByLnByb3RvdHlwZS5zZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGkuc2V0UG9zaXRpb24odGhpcy5jb250YWluZXIsIGUsIHQpOwogICAgfSwgci5wcm90b3R5cGUuc2V0TFRSQiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGkuc2V0TFRSQih0aGlzLmNvbnRhaW5lciwgZSk7CiAgICB9LCByLnByb3RvdHlwZS5zZXRTaXplID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLmNvbnRhaW5lcjsKICAgICAgZSA9IGwuaXNOdW1iZXIoZSkgPyBlICsgInB4IiA6IGUsIHQgPSBsLmlzTnVtYmVyKHQpID8gdCArICJweCIgOiB0LCBuLnN0eWxlLndpZHRoID0gZSwgbi5zdHlsZS5oZWlnaHQgPSB0OwogICAgfSwgci5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IGU7CiAgICB9LCByLnByb3RvdHlwZS5nZXRMYXJnZXN0WkluZGV4ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IGwubWFwKHRoaXMuc2libGluZywgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gZS56SW5kZXg7CiAgICAgIH0pOwogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgZSk7CiAgICB9LCByLnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmdldExhcmdlc3RaSW5kZXgoKSArIDE7CiAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IHRoaXMuekluZGV4ID0gZTsKICAgIH0sIHIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZm9jdXMoKSwgdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICB9LCByLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfSwgZS5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigxKSwKICAgICAgICBpID0gbig2KSwKICAgICAgICBhID0gbig1KSwKICAgICAgICByID0gbigzKSwKICAgICAgICBzID0gTWF0aC5tYXgsCiAgICAgICAgYyA9IE1hdGgubWluLAogICAgICAgIHUgPSB7CiAgICAgIF9yZXRyaXZlU2NoZWR1bGVEYXRhOiBmdW5jdGlvbiBfcmV0cml2ZVNjaGVkdWxlRGF0YShlLCB0KSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHUsCiAgICAgICAgICAgIGgsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIG0sCiAgICAgICAgICAgIGYgPSBlLmNoaWxkcmVuLnNpbmdsZSgpOwogICAgICAgIHJldHVybiAhIWYgJiYgKG4gPSBmLmNvbnRhaW5lciwgbSA9IGYuZ2V0UmVuZGVyRGF0ZVJhbmdlKCksIGwgPSBtLmxlbmd0aCwgcCA9IGYuZ2V0UmVuZGVyRGF0ZUdyaWRzKCksIHIgPSBvLmdldFNpemUobilbMF0sIHUgPSBpLmdldE1vdXNlUG9zaXRpb24odCwgbiksIGggPSBkKHAsIGEucmF0aW8ociwgMTAwLCB1WzBdKSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbyA9IGkuZ2V0TW91c2VQb3NpdGlvbih0LCBuKVswXSwKICAgICAgICAgICAgICB1ID0gZChwLCBhLnJhdGlvKHIsIDEwMCwgbykpOwogICAgICAgICAgcmV0dXJuIHUgPSBzKHUsIDApLCB1ID0gYyh1LCBsIC0gMSksIHsKICAgICAgICAgICAgcmVsYXRlZFZpZXc6IGUsCiAgICAgICAgICAgIGRyYWdTdGFydFhJbmRleDogaCwKICAgICAgICAgICAgZGF0ZXNJblJhbmdlOiBsLAogICAgICAgICAgICB4SW5kZXg6IHUsCiAgICAgICAgICAgIHRyaWdnZXJFdmVudDogdC50eXBlLAogICAgICAgICAgICBncmlkczogcCwKICAgICAgICAgICAgcmFuZ2U6IG0KICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9yZXRyaXZlU2NoZWR1bGVEYXRhRnJvbURhdGU6IGZ1bmN0aW9uIF9yZXRyaXZlU2NoZWR1bGVEYXRhRnJvbURhdGUoZSwgdCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBvLAogICAgICAgICAgICBpLAogICAgICAgICAgICBhID0gZS5jaGlsZHJlbi5zaW5nbGUoKSwKICAgICAgICAgICAgdSA9IDAsCiAgICAgICAgICAgIGQgPSAwOwogICAgICAgIHJldHVybiAhIWEgJiYgKG4gPSAoaSA9IGEuZ2V0UmVuZGVyRGF0ZVJhbmdlKCkpLmxlbmd0aCwgbyA9IGEuZ2V0UmVuZGVyRGF0ZUdyaWRzKCksIGwuZm9yRWFjaChpLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgci5pc1NhbWVEYXRlKGUsIHQpICYmICh1ID0gZCA9IG4pOwogICAgICAgIH0pLCB1ID0gcyh1LCAwKSwgdSA9IGModSwgbiAtIDEpLCB7CiAgICAgICAgICByZWxhdGVkVmlldzogZSwKICAgICAgICAgIGRyYWdTdGFydFhJbmRleDogZCwKICAgICAgICAgIGRhdGVzSW5SYW5nZTogbiwKICAgICAgICAgIHhJbmRleDogdSwKICAgICAgICAgIHRyaWdnZXJFdmVudDogIm1hbnVhbCIsCiAgICAgICAgICBncmlkczogbywKICAgICAgICAgIHJhbmdlOiBpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gZChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCA9IDAsCiAgICAgICAgICBvID0gZS5sZW5ndGg7CgogICAgICBmb3IgKHQgPCAwICYmICh0ID0gMCk7IGwgPCBvOyBsICs9IDEpIHsKICAgICAgICBpZiAoKG4gPSBlW2xdKS5sZWZ0IDw9IHQgJiYgdCA8PSBuLmxlZnQgKyBuLndpZHRoKSByZXR1cm4gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbig1KSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbig2KSwKICAgICAgICByID0gbigzMSksCiAgICAgICAgcyA9IG4oNCkuRGF0ZSwKICAgICAgICBjID0gewogICAgICBfY2FsY0dyaWRZSW5kZXg6IGZ1bmN0aW9uIF9jYWxjR3JpZFlJbmRleChlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwgPSBpLm1pbGxpc2Vjb25kc1RvKCJob3VyIiwgbiAqIGUgLyB0KSwKICAgICAgICAgICAgYSA9IDAgfCBsOwogICAgICAgIHJldHVybiBhICsgKG8ubmVhcmVzdChsIC0gYSwgWzAsIDFdKSA/IC41IDogMCk7CiAgICAgIH0sCiAgICAgIF9yZXRyaXZlU2NoZWR1bGVEYXRhOiBmdW5jdGlvbiBfcmV0cml2ZVNjaGVkdWxlRGF0YShlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLAogICAgICAgICAgICBuID0gZS5jb250YWluZXIsCiAgICAgICAgICAgIGMgPSBlLm9wdGlvbnMsCiAgICAgICAgICAgIHUgPSBlLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgICAgZCA9IGUuZ2V0RGF0ZSgpLAogICAgICAgICAgICBoID0gYy5ob3VyRW5kIC0gYy5ob3VyU3RhcnQsCiAgICAgICAgICAgIHAgPSBpLm1pbGxpc2Vjb25kc0Zyb20oImhvdXIiLCBoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG0sIGYpIHsKICAgICAgICAgIHZhciBnID0gci5uKGEuZ2V0TW91c2VQb3NpdGlvbihtLCBuKSkueSwKICAgICAgICAgICAgICB5ID0gby5yYXRpbyh1LCBoLCBnKSwKICAgICAgICAgICAgICBTID0gbmV3IHMoZCkuYWRkTWludXRlcyhpLm1pbnV0ZXNGcm9tSG91cnMoeSkpLAogICAgICAgICAgICAgIF8gPSB0Ll9jYWxjR3JpZFlJbmRleChwLCB1LCBnKSwKICAgICAgICAgICAgICBDID0gbmV3IHMoZCkuYWRkTWludXRlcyhpLm1pbnV0ZXNGcm9tSG91cnMoXyArIGMuaG91clN0YXJ0KSk7CgogICAgICAgICAgcmV0dXJuIGwuZXh0ZW5kKHsKICAgICAgICAgICAgdGFyZ2V0OiBhLmdldEV2ZW50VGFyZ2V0KG0pLAogICAgICAgICAgICByZWxhdGVkVmlldzogZSwKICAgICAgICAgICAgb3JpZ2luRXZlbnQ6IG0sCiAgICAgICAgICAgIG1vdXNlWTogZywKICAgICAgICAgICAgZ3JpZFk6IHksCiAgICAgICAgICAgIHRpbWVZOiBTLAogICAgICAgICAgICBuZWFyZXN0R3JpZFk6IF8sCiAgICAgICAgICAgIG5lYXJlc3RHcmlkVGltZVk6IEMsCiAgICAgICAgICAgIHRyaWdnZXJFdmVudDogbS50eXBlCiAgICAgICAgICB9LCBmKTsKICAgICAgICB9OwogICAgICB9LAogICAgICBfcmV0cml2ZVNjaGVkdWxlRGF0YUZyb21EYXRlOiBmdW5jdGlvbiBfcmV0cml2ZVNjaGVkdWxlRGF0YUZyb21EYXRlKGUsIHQsIG4sIGwpIHsKICAgICAgICB2YXIgbywKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgYyA9IGUuZ2V0RGF0ZSgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0YXJnZXQ6IGUsCiAgICAgICAgICByZWxhdGVkVmlldzogZSwKICAgICAgICAgIGdyaWRZOiBvID0gdC5nZXRIb3VycygpIC0gbCArIHUodC5nZXRNaW51dGVzKCkpLAogICAgICAgICAgdGltZVk6IG5ldyBzKGMpLmFkZE1pbnV0ZXMoaS5taW51dGVzRnJvbUhvdXJzKG8pKSwKICAgICAgICAgIG5lYXJlc3RHcmlkWTogYSA9IG8sCiAgICAgICAgICBuZWFyZXN0R3JpZFRpbWVZOiBuZXcgcyhjKS5hZGRNaW51dGVzKGkubWludXRlc0Zyb21Ib3VycyhhKSksCiAgICAgICAgICBuZWFyZXN0R3JpZEVuZFk6IHIgPSBuLmdldEhvdXJzKCkgLSBsICsgdShuLmdldE1pbnV0ZXMoKSksCiAgICAgICAgICBuZWFyZXN0R3JpZEVuZFRpbWVZOiBuZXcgcyhjKS5hZGRNaW51dGVzKGkubWludXRlc0Zyb21Ib3VycyhyKSksCiAgICAgICAgICB0cmlnZ2VyRXZlbnQ6ICJtYW51YWwiLAogICAgICAgICAgaG91clN0YXJ0OiBsCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgbWl4aW46IGZ1bmN0aW9uIG1peGluKGUpIHsKICAgICAgICB2YXIgdCA9IGUucHJvdG90eXBlOwogICAgICAgIGwuZm9yRWFjaChjLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgIm1peGluIiAhPT0gbiAmJiAodFtuXSA9IGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIHUoZSkgewogICAgICB2YXIgdDsKICAgICAgcmV0dXJuIDAgPT09IGUgPyB0ID0gMCA6IGUgPiAzMCA/IHQgPSAxIDogZSA8PSAzMCAmJiAodCA9IC41KSwgdDsKICAgIH0KCiAgICBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDUpLAogICAgICAgIGkgPSBuKDEpLAogICAgICAgIGEgPSBuKDYpLAogICAgICAgIHIgPSBNYXRoLmZsb29yOwoKICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS5jaGlsZHJlbiwKICAgICAgICAgIG4gPSB0LnNvcnQoZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICByZXR1cm4gbC5zdGFtcChlKSAtIGwuc3RhbXAodCk7CiAgICAgIH0pLAogICAgICAgICAgcyA9IHQubGVuZ3RoLAogICAgICAgICAgYyA9IHQuc2luZ2xlKCkuZ2V0UmVuZGVyRGF0ZVJhbmdlKCkubGVuZ3RoLAogICAgICAgICAgdSA9IGwucGljayhlLnZMYXlvdXQucGFuZWxzWzFdLCAiY29udGFpbmVyIiksCiAgICAgICAgICBkID0gaS5nZXRTaXplKHUpLAogICAgICAgICAgaCA9IGUuZ3JpZHM7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBpLAogICAgICAgICAgICBwLAogICAgICAgICAgICBtID0gYS5nZXRNb3VzZVBvc2l0aW9uKGUsIHUpLAogICAgICAgICAgICBmID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGZvciAodmFyIHQsIG4gPSAwLCBsID0gaC5sZW5ndGg7IG4gPCBsOyBuICs9IDEpIHsKICAgICAgICAgICAgaWYgKCh0ID0gaFtuXSkubGVmdCA8PSBlICYmIGUgPD0gdC5sZWZ0ICsgdC53aWR0aCkgcmV0dXJuIG47CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGUgPCAwID8gLTEgOiBuOwogICAgICAgIH0oby5yYXRpbyhkWzBdLCAxMDAsIG1bMF0pKSwKICAgICAgICAgICAgZyA9IHIoby5yYXRpbyhkWzFdLCBzLCBtWzFdKSk7CgogICAgICAgIHJldHVybiBnIDwgMCAmJiAoZyA9IDApLCBnID49IG4ubGVuZ3RoICYmIChnID0gbi5sZW5ndGggLSAxKSwgKHQgPSBsLnBpY2sobiwgZykpID8gKGYgPCAwICYmIChmID0gMCksIGYgPj0gKHAgPSB0LmdldFJlbmRlckRhdGVSYW5nZSgpKS5sZW5ndGggJiYgKGYgPSBwLmxlbmd0aCAtIDEpLCAoaSA9IGwucGljayhwLCBmKSkgPyB7CiAgICAgICAgICB4OiBmLAogICAgICAgICAgeTogZywKICAgICAgICAgIHNpemVYOiBjLAogICAgICAgICAgc2l6ZVk6IHMsCiAgICAgICAgICBkYXRlOiBpLAogICAgICAgICAgd2Vla2RheVZpZXc6IHQsCiAgICAgICAgICB0cmlnZ2VyRXZlbnQ6IGUudHlwZQogICAgICAgIH0gOiBudWxsKSA6IG51bGw7CiAgICAgIH07CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICBlLmV4cG9ydHMgPSBuKDIxKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGwoZSkgewogICAgICByZXR1cm4gZSAmJiBlLl9fZXNNb2R1bGUgPyBlIDogewogICAgICAgIGRlZmF1bHQ6IGUKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKGUpIHsKICAgICAgaWYgKGUgJiYgZS5fX2VzTW9kdWxlKSByZXR1cm4gZTsKICAgICAgdmFyIHQgPSB7fTsKICAgICAgaWYgKG51bGwgIT0gZSkgZm9yICh2YXIgbiBpbiBlKSB7CiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG4pICYmICh0W25dID0gZVtuXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQuZGVmYXVsdCA9IGUsIHQ7CiAgICB9CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgaSA9IG8obigyMikpLAogICAgICAgIGEgPSBsKG4oNDgpKSwKICAgICAgICByID0gbChuKDEyKSksCiAgICAgICAgcyA9IG8obigxMCkpLAogICAgICAgIGMgPSBvKG4oNDkpKSwKICAgICAgICB1ID0gbChuKDUxKSk7CgogICAgZnVuY3Rpb24gZCgpIHsKICAgICAgdmFyIGUgPSBuZXcgaS5IYW5kbGViYXJzRW52aXJvbm1lbnQoKTsKICAgICAgcmV0dXJuIHMuZXh0ZW5kKGUsIGkpLCBlLlNhZmVTdHJpbmcgPSBhLmRlZmF1bHQsIGUuRXhjZXB0aW9uID0gci5kZWZhdWx0LCBlLlV0aWxzID0gcywgZS5lc2NhcGVFeHByZXNzaW9uID0gcy5lc2NhcGVFeHByZXNzaW9uLCBlLlZNID0gYywgZS50ZW1wbGF0ZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGMudGVtcGxhdGUodCwgZSk7CiAgICAgIH0sIGU7CiAgICB9CgogICAgdmFyIGggPSBkKCk7CiAgICBoLmNyZWF0ZSA9IGQsIHUuZGVmYXVsdChoKSwgaC5kZWZhdWx0ID0gaCwgdC5kZWZhdWx0ID0gaCwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gbChlKSB7CiAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7CiAgICAgICAgZGVmYXVsdDogZQogICAgICB9OwogICAgfQoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LkhhbmRsZWJhcnNFbnZpcm9ubWVudCA9IHU7CiAgICB2YXIgbyA9IG4oMTApLAogICAgICAgIGkgPSBsKG4oMTIpKSwKICAgICAgICBhID0gbigyMyksCiAgICAgICAgciA9IG4oNDUpLAogICAgICAgIHMgPSBsKG4oMjQpKSwKICAgICAgICBjID0gbigyNSk7CiAgICB0LlZFUlNJT04gPSAiNC43LjMiOwogICAgdC5DT01QSUxFUl9SRVZJU0lPTiA9IDg7CiAgICB0LkxBU1RfQ09NUEFUSUJMRV9DT01QSUxFUl9SRVZJU0lPTiA9IDc7CiAgICB0LlJFVklTSU9OX0NIQU5HRVMgPSB7CiAgICAgIDE6ICI8PSAxLjAucmMuMiIsCiAgICAgIDI6ICI9PSAxLjAuMC1yYy4zIiwKICAgICAgMzogIj09IDEuMC4wLXJjLjQiLAogICAgICA0OiAiPT0gMS54LngiLAogICAgICA1OiAiPT0gMi4wLjAtYWxwaGEueCIsCiAgICAgIDY6ICI+PSAyLjAuMC1iZXRhLjEiLAogICAgICA3OiAiPj0gNC4wLjAgPDQuMy4wIiwKICAgICAgODogIj49IDQuMy4wIgogICAgfTsKCiAgICBmdW5jdGlvbiB1KGUsIHQsIG4pIHsKICAgICAgdGhpcy5oZWxwZXJzID0gZSB8fCB7fSwgdGhpcy5wYXJ0aWFscyA9IHQgfHwge30sIHRoaXMuZGVjb3JhdG9ycyA9IG4gfHwge30sIGEucmVnaXN0ZXJEZWZhdWx0SGVscGVycyh0aGlzKSwgci5yZWdpc3RlckRlZmF1bHREZWNvcmF0b3JzKHRoaXMpOwogICAgfQoKICAgIHUucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogdSwKICAgICAgbG9nZ2VyOiBzLmRlZmF1bHQsCiAgICAgIGxvZzogcy5kZWZhdWx0LmxvZywKICAgICAgcmVnaXN0ZXJIZWxwZXI6IGZ1bmN0aW9uIHJlZ2lzdGVySGVscGVyKGUsIHQpIHsKICAgICAgICBpZiAoIltvYmplY3QgT2JqZWN0XSIgPT09IG8udG9TdHJpbmcuY2FsbChlKSkgewogICAgICAgICAgaWYgKHQpIHRocm93IG5ldyBpLmRlZmF1bHQoIkFyZyBub3Qgc3VwcG9ydGVkIHdpdGggbXVsdGlwbGUgaGVscGVycyIpOwogICAgICAgICAgby5leHRlbmQodGhpcy5oZWxwZXJzLCBlKTsKICAgICAgICB9IGVsc2UgdGhpcy5oZWxwZXJzW2VdID0gdDsKICAgICAgfSwKICAgICAgdW5yZWdpc3RlckhlbHBlcjogZnVuY3Rpb24gdW5yZWdpc3RlckhlbHBlcihlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuaGVscGVyc1tlXTsKICAgICAgfSwKICAgICAgcmVnaXN0ZXJQYXJ0aWFsOiBmdW5jdGlvbiByZWdpc3RlclBhcnRpYWwoZSwgdCkgewogICAgICAgIGlmICgiW29iamVjdCBPYmplY3RdIiA9PT0gby50b1N0cmluZy5jYWxsKGUpKSBvLmV4dGVuZCh0aGlzLnBhcnRpYWxzLCBlKTtlbHNlIHsKICAgICAgICAgIGlmICh2b2lkIDAgPT09IHQpIHRocm93IG5ldyBpLmRlZmF1bHQoJ0F0dGVtcHRpbmcgdG8gcmVnaXN0ZXIgYSBwYXJ0aWFsIGNhbGxlZCAiJyArIGUgKyAnIiBhcyB1bmRlZmluZWQnKTsKICAgICAgICAgIHRoaXMucGFydGlhbHNbZV0gPSB0OwogICAgICAgIH0KICAgICAgfSwKICAgICAgdW5yZWdpc3RlclBhcnRpYWw6IGZ1bmN0aW9uIHVucmVnaXN0ZXJQYXJ0aWFsKGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5wYXJ0aWFsc1tlXTsKICAgICAgfSwKICAgICAgcmVnaXN0ZXJEZWNvcmF0b3I6IGZ1bmN0aW9uIHJlZ2lzdGVyRGVjb3JhdG9yKGUsIHQpIHsKICAgICAgICBpZiAoIltvYmplY3QgT2JqZWN0XSIgPT09IG8udG9TdHJpbmcuY2FsbChlKSkgewogICAgICAgICAgaWYgKHQpIHRocm93IG5ldyBpLmRlZmF1bHQoIkFyZyBub3Qgc3VwcG9ydGVkIHdpdGggbXVsdGlwbGUgZGVjb3JhdG9ycyIpOwogICAgICAgICAgby5leHRlbmQodGhpcy5kZWNvcmF0b3JzLCBlKTsKICAgICAgICB9IGVsc2UgdGhpcy5kZWNvcmF0b3JzW2VdID0gdDsKICAgICAgfSwKICAgICAgdW5yZWdpc3RlckRlY29yYXRvcjogZnVuY3Rpb24gdW5yZWdpc3RlckRlY29yYXRvcihlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuZGVjb3JhdG9yc1tlXTsKICAgICAgfSwKICAgICAgcmVzZXRMb2dnZWRQcm9wZXJ0eUFjY2Vzc2VzOiBmdW5jdGlvbiByZXNldExvZ2dlZFByb3BlcnR5QWNjZXNzZXMoKSB7CiAgICAgICAgYy5yZXNldExvZ2dlZFByb3BlcnRpZXMoKTsKICAgICAgfQogICAgfTsKICAgIHZhciBkID0gcy5kZWZhdWx0LmxvZzsKICAgIHQubG9nID0gZCwgdC5jcmVhdGVGcmFtZSA9IG8uY3JlYXRlRnJhbWUsIHQubG9nZ2VyID0gcy5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gbChlKSB7CiAgICAgIHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUgOiB7CiAgICAgICAgZGVmYXVsdDogZQogICAgICB9OwogICAgfQoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LnJlZ2lzdGVyRGVmYXVsdEhlbHBlcnMgPSBmdW5jdGlvbiAoZSkgewogICAgICBvLmRlZmF1bHQoZSksIGkuZGVmYXVsdChlKSwgYS5kZWZhdWx0KGUpLCByLmRlZmF1bHQoZSksIHMuZGVmYXVsdChlKSwgYy5kZWZhdWx0KGUpLCB1LmRlZmF1bHQoZSk7CiAgICB9LCB0Lm1vdmVIZWxwZXJUb0hvb2tzID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgZS5oZWxwZXJzW3RdICYmIChlLmhvb2tzW3RdID0gZS5oZWxwZXJzW3RdLCBuIHx8IGRlbGV0ZSBlLmhlbHBlcnNbdF0pOwogICAgfTsKICAgIHZhciBvID0gbChuKDM4KSksCiAgICAgICAgaSA9IGwobigzOSkpLAogICAgICAgIGEgPSBsKG4oNDApKSwKICAgICAgICByID0gbChuKDQxKSksCiAgICAgICAgcyA9IGwobig0MikpLAogICAgICAgIGMgPSBsKG4oNDMpKSwKICAgICAgICB1ID0gbChuKDQ0KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMDsKICAgIHZhciBsID0gbigxMCksCiAgICAgICAgbyA9IHsKICAgICAgbWV0aG9kTWFwOiBbImRlYnVnIiwgImluZm8iLCAid2FybiIsICJlcnJvciJdLAogICAgICBsZXZlbDogImluZm8iLAogICAgICBsb29rdXBMZXZlbDogZnVuY3Rpb24gbG9va3VwTGV2ZWwoZSkgewogICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSkgewogICAgICAgICAgdmFyIHQgPSBsLmluZGV4T2Yoby5tZXRob2RNYXAsIGUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICBlID0gdCA+PSAwID8gdCA6IHBhcnNlSW50KGUsIDEwKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlOwogICAgICB9LAogICAgICBsb2c6IGZ1bmN0aW9uIGxvZyhlKSB7CiAgICAgICAgaWYgKGUgPSBvLmxvb2t1cExldmVsKGUpLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgY29uc29sZSAmJiBvLmxvb2t1cExldmVsKG8ubGV2ZWwpIDw9IGUpIHsKICAgICAgICAgIHZhciB0ID0gby5tZXRob2RNYXBbZV07CiAgICAgICAgICBjb25zb2xlW3RdIHx8ICh0ID0gImxvZyIpOwoKICAgICAgICAgIGZvciAodmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoLCBsID0gQXJyYXkobiA+IDEgPyBuIC0gMSA6IDApLCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgICAgICBsW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zb2xlW3RdLmFwcGx5KGNvbnNvbGUsIGwpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHQuZGVmYXVsdCA9IG8sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmNyZWF0ZVByb3RvQWNjZXNzQ29udHJvbCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdC5jb25zdHJ1Y3RvciA9ICExLCB0Ll9fZGVmaW5lR2V0dGVyX18gPSAhMSwgdC5fX2RlZmluZVNldHRlcl9fID0gITEsIHQuX19sb29rdXBHZXR0ZXJfXyA9ICExOwogICAgICB2YXIgbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHJldHVybiBuLl9fcHJvdG9fXyA9ICExLCB7CiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgd2hpdGVsaXN0OiBsLmNyZWF0ZU5ld0xvb2t1cE9iamVjdChuLCBlLmFsbG93ZWRQcm90b1Byb3BlcnRpZXMpLAogICAgICAgICAgZGVmYXVsdFZhbHVlOiBlLmFsbG93UHJvdG9Qcm9wZXJ0aWVzQnlEZWZhdWx0CiAgICAgICAgfSwKICAgICAgICBtZXRob2RzOiB7CiAgICAgICAgICB3aGl0ZWxpc3Q6IGwuY3JlYXRlTmV3TG9va3VwT2JqZWN0KHQsIGUuYWxsb3dlZFByb3RvTWV0aG9kcyksCiAgICAgICAgICBkZWZhdWx0VmFsdWU6IGUuYWxsb3dQcm90b01ldGhvZHNCeURlZmF1bHQKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB0LnJlc3VsdElzQWxsb3dlZCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHJldHVybiBhKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUgPyB0Lm1ldGhvZHMgOiB0LnByb3BlcnRpZXMsIG4pOwogICAgfSwgdC5yZXNldExvZ2dlZFByb3BlcnRpZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIE9iamVjdC5rZXlzKGkpLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBkZWxldGUgaVtlXTsKICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBsID0gbig0NyksCiAgICAgICAgbyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlICYmIGUuX19lc01vZHVsZSkgcmV0dXJuIGU7CiAgICAgIHZhciB0ID0ge307CiAgICAgIGlmIChudWxsICE9IGUpIGZvciAodmFyIG4gaW4gZSkgewogICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBuKSAmJiAodFtuXSA9IGVbbl0pOwogICAgICB9CiAgICAgIHJldHVybiB0LmRlZmF1bHQgPSBlLCB0OwogICAgfShuKDI0KSksCiAgICAgICAgaSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgZnVuY3Rpb24gYShlLCB0KSB7CiAgICAgIHJldHVybiB2b2lkIDAgIT09IGUud2hpdGVsaXN0W3RdID8gITAgPT09IGUud2hpdGVsaXN0W3RdIDogdm9pZCAwICE9PSBlLmRlZmF1bHRWYWx1ZSA/IGUuZGVmYXVsdFZhbHVlIDogKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgITAgIT09IGlbZV0gJiYgKGlbZV0gPSAhMCwgby5sb2coImVycm9yIiwgJ0hhbmRsZWJhcnM6IEFjY2VzcyBoYXMgYmVlbiBkZW5pZWQgdG8gcmVzb2x2ZSB0aGUgcHJvcGVydHkgIicgKyBlICsgJyIgYmVjYXVzZSBpdCBpcyBub3QgYW4gIm93biBwcm9wZXJ0eSIgb2YgaXRzIHBhcmVudC5cbllvdSBjYW4gYWRkIGEgcnVudGltZSBvcHRpb24gdG8gZGlzYWJsZSB0aGUgY2hlY2sgb3IgdGhpcyB3YXJuaW5nOlxuU2VlIGh0dHBzOi8vaGFuZGxlYmFyc2pzLmNvbS9hcGktcmVmZXJlbmNlL3J1bnRpbWUtb3B0aW9ucy5odG1sI29wdGlvbnMtdG8tY29udHJvbC1wcm90b3R5cGUtYWNjZXNzIGZvciBkZXRhaWxzJykpOwogICAgICB9KHQpLCAhMSk7CiAgICB9CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oNCkuRGF0ZTsKCiAgICBmdW5jdGlvbiBvKGUpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIG8pKSByZXR1cm4gbmV3IG8oZSk7CiAgICAgIGUgaW5zdGFuY2VvZiBsIHx8IChlID0gbmV3IGwoZSkpLCB0aGlzLmQgPSBlOwogICAgfQoKICAgIG8ucHJvdG90eXBlLnNhZmUgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gZS5jb25zdHJ1Y3RvciA9PT0gbyA/IGUuZCA6IGU7CiAgICB9LCBvLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBvKG5ldyBsKHRoaXMuZCkpOwogICAgfSwgby5wcm90b3R5cGUuYWRkRGF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmQuc2V0RGF0ZSh0aGlzLmQuZ2V0RGF0ZSgpICsgZSksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5hZGRNb250aCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5kLmdldE1vbnRoKCksCiAgICAgICAgICBuID0gdGhpcy5kLmdldERhdGUoKSwKICAgICAgICAgIGwgPSB0aGlzLl9pc0xlYXBZZWFyKCksCiAgICAgICAgICBvID0gdCArIGUsCiAgICAgICAgICBpID0gdGhpcy5jbG9uZSgpLAogICAgICAgICAgYSA9IG47CgogICAgICByZXR1cm4gZSAmJiAoMSA9PT0gbyA/IGEgPSBsID8gMjkgOiAyOCA6IChlID4gMCA/IGkuZC5zZXRNb250aChvICsgMSwgMCkgOiBpLmQuc2V0TW9udGgodCwgMCksIGEgPSBpLmQuZ2V0RGF0ZSgpKSksIHRoaXMuZC5zZXRNb250aChvLCBNYXRoLm1pbihuLCBhKSksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5faXNMZWFwWWVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmQuZ2V0RnVsbFllYXIoKTsKICAgICAgcmV0dXJuIGUgJSA0ID09IDAgJiYgZSAlIDEwMCAhPSAwIHx8ICEoZSAlIDQwMCk7CiAgICB9LCBvLnByb3RvdHlwZS5zZXRIb3VycyA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgIHJldHVybiB0aGlzLmQuc2V0SG91cnMoZSwgdCwgbiwgbCksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5pc0JldHdlZW4gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHRoaXMuc2FmZTsKICAgICAgcmV0dXJuIG4oZSkgPD0gdGhpcy5kICYmIHRoaXMuZCA8PSBuKHQpOwogICAgfSwgZS5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigxKSwKICAgICAgICAgIGkgPSBuKDYpLAogICAgICAgICAgYSA9IG4oMik7CgogICAgICBmdW5jdGlvbiByKGUsIHQpIHsKICAgICAgICBpLm9uKHQsICJtb3VzZWRvd24iLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyksIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICAgIGRpc3RhbmNlOiAxMCwKICAgICAgICAgIGV4Y2x1ZGU6IG51bGwKICAgICAgICB9LCBlKSwgdGhpcy5jb250YWluZXIgPSB0LCB0aGlzLl9jYW5jZWxsZWQgPSAhMSwgdGhpcy5faXNNb3ZlZCA9ICExLCB0aGlzLl9kaXN0YW5jZSA9IDAsIHRoaXMuX2RyYWdTdGFydEZpcmVkID0gITEsIHRoaXMuX2RyYWdTdGFydEV2ZW50RGF0YSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHMoZSkgewogICAgICAgIG8uY2xvc2VzdChlLnRhcmdldCwgYS5jbGFzc25hbWUoIi5wb3B1cCIpKSB8fCBpLnByZXZlbnREZWZhdWx0KGUpOwogICAgICB9CgogICAgICByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGkub2ZmKHRoaXMuY29udGFpbmVyLCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpLCB0aGlzLl9pc01vdmVkID0gbnVsbCwgdGhpcy5jb250YWluZXIgPSBudWxsOwogICAgICB9LCByLnByb3RvdHlwZS5fY2xlYXJEYXRhID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2NhbmNlbGxlZCA9ICExLCB0aGlzLl9kaXN0YW5jZSA9IDAsIHRoaXMuX2lzTW92ZWQgPSAhMSwgdGhpcy5fZHJhZ1N0YXJ0RmlyZWQgPSAhMSwgdGhpcy5fZHJhZ1N0YXJ0RXZlbnREYXRhID0gbnVsbDsKICAgICAgfSwgci5wcm90b3R5cGUuX3RvZ2dsZURyYWdFdmVudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIGEgPSB0aGlzLmNvbnRhaW5lcjsKICAgICAgICBlID8gKG4gPSAib24iLCBsID0gImRpc2FibGUiKSA6IChuID0gIm9mZiIsIGwgPSAiZW5hYmxlIiksIG9bbCArICJUZXh0U2VsZWN0aW9uIl0oYSwgcyksIG9bbCArICJJbWFnZURyYWciXShhLCBzKSwgaVtuXSh0LmRvY3VtZW50LCB7CiAgICAgICAgICBtb3VzZW1vdmU6IHRoaXMuX29uTW91c2VNb3ZlLAogICAgICAgICAgbW91c2V1cDogdGhpcy5fb25Nb3VzZVVwCiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9nZXRFdmVudERhdGEgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0YXJnZXQ6IGkuZ2V0RXZlbnRUYXJnZXQoZSksCiAgICAgICAgICBvcmlnaW5FdmVudDogZQogICAgICAgIH07CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgIG4gPSBpLmdldEV2ZW50VGFyZ2V0KGUpOwogICAgICAgIDAgPT09IGkuZ2V0TW91c2VCdXR0b24oZSkgJiYgKHQuZXhjbHVkZSAmJiB0LmV4Y2x1ZGUobikgPyB0aGlzLl9jYW5jZWxsZWQgPSAhMCA6ICh0aGlzLl9jbGVhckRhdGEoKSwgdGhpcy5fZHJhZ1N0YXJ0RXZlbnREYXRhID0gdGhpcy5fZ2V0RXZlbnREYXRhKGUpLCB0aGlzLl90b2dnbGVEcmFnRXZlbnQoITApLCB0aGlzLmZpcmUoIm1vdXNlZG93biIsIHRoaXMuX2RyYWdTdGFydEV2ZW50RGF0YSkpKTsKICAgICAgfSwgci5wcm90b3R5cGUuX29uTW91c2VNb3ZlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdDsKICAgICAgICBpZiAodGhpcy5fY2FuY2VsbGVkKSB0aGlzLl9jbGVhckRhdGEoKTtlbHNlIGlmICh0ID0gdGhpcy5vcHRpb25zLmRpc3RhbmNlLCBzKGUpLCB0aGlzLl9kaXN0YW5jZSA8IHQpIHRoaXMuX2Rpc3RhbmNlICs9IDE7ZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5faXNNb3ZlZCA9ICEwLCAhdGhpcy5fZHJhZ1N0YXJ0RmlyZWQgJiYgKHRoaXMuX2RyYWdTdGFydEZpcmVkID0gITAsICF0aGlzLmludm9rZSgiZHJhZ1N0YXJ0IiwgdGhpcy5fZHJhZ1N0YXJ0RXZlbnREYXRhKSkpIHJldHVybiB0aGlzLl90b2dnbGVEcmFnRXZlbnQoITEpLCB2b2lkIHRoaXMuX2NsZWFyRGF0YSgpOwogICAgICAgICAgdGhpcy5maXJlKCJkcmFnIiwgdGhpcy5fZ2V0RXZlbnREYXRhKGUpKTsKICAgICAgICB9CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHRoaXMuX2NhbmNlbGxlZCB8fCAodGhpcy5fdG9nZ2xlRHJhZ0V2ZW50KCExKSwgdGhpcy5faXNNb3ZlZCA/ICh0aGlzLl9pc01vdmVkID0gITEsIHRoaXMuZmlyZSgiZHJhZ0VuZCIsIHRoaXMuX2dldEV2ZW50RGF0YShlKSkpIDogdGhpcy5maXJlKCJjbGljayIsIHRoaXMuX2dldEV2ZW50RGF0YShlKSksIHRoaXMuX2NsZWFyRGF0YSgpKTsKICAgICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4ociksIGUuZXhwb3J0cyA9IHI7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDMpLAogICAgICAgIGkgPSBvLk1JTExJU0VDT05EU19TQ0hFRFVMRV9NSU5fRFVSQVRJT047CgogICAgZnVuY3Rpb24gYShlKSB7CiAgICAgIHRoaXMubW9kZWwgPSBlLCB0aGlzLnRvcCA9IDAsIHRoaXMubGVmdCA9IDAsIHRoaXMud2lkdGggPSAwLCB0aGlzLmhlaWdodCA9IDAsIHRoaXMuaGFzQ29sbGlkZSA9ICExLCB0aGlzLmV4dHJhU3BhY2UgPSAwLCB0aGlzLmhpZGRlbiA9ICExLCB0aGlzLmhhc011bHRpRGF0ZXMgPSAhMSwgdGhpcy5yZW5kZXJTdGFydHMgPSBudWxsLCB0aGlzLmV4Y2VlZExlZnQgPSAhMSwgdGhpcy5yZW5kZXJFbmRzID0gbnVsbCwgdGhpcy5leGNlZWRSaWdodCA9ICExOwogICAgfQoKICAgIGEuY3JlYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIG5ldyBhKGUpOwogICAgfSwgYS5wcm90b3R5cGUuZ2V0U3RhcnRzID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5yZW5kZXJTdGFydHMgPyB0aGlzLnJlbmRlclN0YXJ0cyA6IHRoaXMubW9kZWwuc3RhcnQ7CiAgICB9LCBhLnByb3RvdHlwZS5nZXRFbmRzID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5yZW5kZXJFbmRzID8gdGhpcy5yZW5kZXJFbmRzIDogdGhpcy5tb2RlbC5lbmQ7CiAgICB9LCBhLnByb3RvdHlwZS5jaWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBsLnN0YW1wKHRoaXMubW9kZWwpOwogICAgfSwgYS5wcm90b3R5cGUudmFsdWVPZiA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWw7CiAgICB9LCBhLnByb3RvdHlwZS5kdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWwuZHVyYXRpb24oKTsKICAgIH0sIGEucHJvdG90eXBlLmNvbGxpZGVzV2l0aCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5nZXRTdGFydHMoKSwKICAgICAgICAgIG4gPSB0aGlzLmdldEVuZHMoKSwKICAgICAgICAgIGwgPSBlLmdldFN0YXJ0cygpLAogICAgICAgICAgYSA9IGUuZ2V0RW5kcygpLAogICAgICAgICAgciA9IG8ubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIHRoaXMudmFsdWVPZigpLmdvaW5nRHVyYXRpb24pLAogICAgICAgICAgcyA9IG8ubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIHRoaXMudmFsdWVPZigpLmNvbWluZ0R1cmF0aW9uKSwKICAgICAgICAgIGMgPSBvLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLnZhbHVlT2YoKS5nb2luZ0R1cmF0aW9uKSwKICAgICAgICAgIHUgPSBvLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBlLnZhbHVlT2YoKS5jb21pbmdEdXJhdGlvbik7CiAgICAgIHJldHVybiBNYXRoLmFicyhuIC0gdCkgPCBpICYmIChuICs9IGkpLCBNYXRoLmFicyhhIC0gbCkgPCBpICYmIChhICs9IGkpLCBuICs9IHMsIGEgKz0gdSwgKGwgLT0gYykgPiAodCAtPSByKSAmJiBsIDwgbiB8fCBhID4gdCAmJiBhIDwgbiB8fCBsIDw9IHQgJiYgYSA+PSBuOwogICAgfSwgZS5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig2KSwKICAgICAgICBzID0gbig4KSwKICAgICAgICBjID0gbig2NCksCiAgICAgICAgdSA9IG4oMjcpLAogICAgICAgIGQgPSBNYXRoLmFiczsKCiAgICBmdW5jdGlvbiBoKGUsIHQsIG4pIHsKICAgICAgdmFyIGksIHI7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBoKSkgcmV0dXJuIG5ldyBoKGUsIHQpOwogICAgICBzLmNhbGwodGhpcywgdCksIGEuYWRkQ2xhc3ModCwgby5jbGFzc25hbWUoInZsYXlvdXQtY29udGFpbmVyIikpLCBpID0gdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIHBhbmVsczogW10sCiAgICAgICAgcGFuZWxIZWlnaHRzOiBbXQogICAgICB9LCBlKSwgdGhpcy5wYW5lbHMgPSBbXSwgdGhpcy5fZHJhZyA9IG5ldyB1KHsKICAgICAgICBkaXN0YW5jZTogMTAsCiAgICAgICAgZXhjbHVkZTogZnVuY3Rpb24gZXhjbHVkZShlKSB7CiAgICAgICAgICByZXR1cm4gIWEuaGFzQ2xhc3MoZSwgby5jbGFzc25hbWUoInNwbGl0dGVyIikpOwogICAgICAgIH0KICAgICAgfSwgdCksIHRoaXMuX2RyYWcub24oewogICAgICAgIGRyYWdTdGFydDogdGhpcy5fb25EcmFnU3RhcnQsCiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5fZHJhZ0RhdGEgPSBudWxsLCB0aGlzLnRoZW1lID0gbiwgaS5wYW5lbHMubGVuZ3RoICYmIChpLnBhbmVsSGVpZ2h0cy5sZW5ndGggJiYgKHIgPSBpLnBhbmVsSGVpZ2h0cy5zbGljZSgpLCBsLmZvckVhY2goaS5wYW5lbHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5pc1NwbGl0dGVyIHx8IGUuYXV0b0hlaWdodCB8fCAoZS5oZWlnaHQgPSByLnNoaWZ0KCkpOwogICAgICB9KSksIHRoaXMuYWRkUGFuZWxzKGkucGFuZWxzLCB0aGlzLmNvbnRhaW5lcikpLCB0aGlzLnJlZnJlc2goKTsKICAgIH0KCiAgICBsLmluaGVyaXQoaCwgcyksIGgucHJvdG90eXBlLmdldExheW91dERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gW107CiAgICAgIHJldHVybiBsLmZvckVhY2godGhpcy5wYW5lbHMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5pc1NwbGl0dGVyKCkgfHwgdC5vcHRpb25zLmF1dG9IZWlnaHQgfHwgZS5wdXNoKHQuZ2V0SGVpZ2h0KCkpOwogICAgICB9KSwgZTsKICAgIH0sIGgucHJvdG90eXBlLnNldExheW91dERhdGEgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLmxlbmd0aCAmJiAobC5mb3JFYWNoKHRoaXMucGFuZWxzLCBmdW5jdGlvbiAodCkgewogICAgICAgIHQuaXNTcGxpdHRlcigpIHx8IHQub3B0aW9ucy5hdXRvSGVpZ2h0IHx8IHQuc2V0SGVpZ2h0KG51bGwsIGUuc2hpZnQoKSk7CiAgICAgIH0pLCB0aGlzLnJlZnJlc2goKSk7CiAgICB9LCBoLnByb3RvdHlwZS5uZXh0UGFuZWwgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5wYW5lbHNbZS5pbmRleCArIDFdOwogICAgfSwgaC5wcm90b3R5cGUucHJldlBhbmVsID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMucGFuZWxzW2UuaW5kZXggLSAxXTsKICAgIH0sIGgucHJvdG90eXBlLl9pbml0aWFsaXplR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSBlLmNsb25lTm9kZSghMCk7CiAgICAgIHJldHVybiBhLmFkZENsYXNzKG4sIG8uY2xhc3NuYW1lKCJzcGxpdHRlci1ndWlkZSIpKSwgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudChuLCB0KSwgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQobiksIG47CiAgICB9LCBoLnByb3RvdHlwZS5fcmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGUuc3R5bGUudG9wID0gdCArICJweCI7CiAgICB9LCBoLnByb3RvdHlwZS5fY2xlYXJHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICBhLnJlbW92ZShlKTsKICAgIH0sIGgucHJvdG90eXBlLl9yZXNpemUgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbywKICAgICAgICAgIGksCiAgICAgICAgICBhID0gZCh0IC0gbiksCiAgICAgICAgICByID0gW10sCiAgICAgICAgICBzID0gbiA+IHQsCiAgICAgICAgICBjID0gcyA/ICJuZXh0UGFuZWwiIDogInByZXZQYW5lbCI7CgogICAgICBmb3IgKGkgPSAobyA9IHRoaXNbcyA/ICJwcmV2UGFuZWwiIDogIm5leHRQYW5lbCJdKGUpKS5nZXRSZXNpemVJbmZvQnlHcm93dGgoYSksIHIucHVzaChbbywgaVswXV0pLCBvID0gdGhpc1tjXShvKTsgbC5pc0V4aXN0eShvKTsgbyA9IHRoaXNbY10obykpIHsKICAgICAgICBvLmlzU3BsaXR0ZXIoKSB8fCAoaSA9IG8uZ2V0UmVzaXplSW5mb0J5R3Jvd3RoKC1hKSwgci5wdXNoKFtvLCBpWzBdXSksIGEgLT0gaVsxXSk7CiAgICAgIH0KCiAgICAgIGwuZm9yRWFjaChyLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGVbMF0uc2V0SGVpZ2h0KG51bGwsIGVbMV0sICEwKSwgZVswXS5maXJlKCJyZXNpemUiKTsKICAgICAgfSk7CiAgICB9LCBoLnByb3RvdHlwZS5fZ2V0TW91c2VZQWRkaXRpb25hbExpbWl0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gMCwKICAgICAgICAgIG8gPSAwLAogICAgICAgICAgaSA9IGZ1bmN0aW9uIGkoZSkgewogICAgICAgIHJldHVybiBlLmlzU3BsaXR0ZXIoKSA/IGUuZ2V0SGVpZ2h0KCkgOiBlLm9wdGlvbnMubWluSGVpZ2h0OwogICAgICB9OwoKICAgICAgZm9yICh0ID0gdGhpcy5wcmV2UGFuZWwoZSk7IGwuaXNFeGlzdHkodCk7IHQgPSB0aGlzLnByZXZQYW5lbCh0KSkgewogICAgICAgIG4gKz0gaSh0KTsKICAgICAgfQoKICAgICAgZm9yICh0ID0gdGhpcy5uZXh0UGFuZWwoZSk7IGwuaXNFeGlzdHkodCk7IHQgPSB0aGlzLm5leHRQYW5lbCh0KSkgewogICAgICAgIG8gKz0gaSh0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIFtuLCBvXTsKICAgIH0sIGgucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS5vcmlnaW5FdmVudCwKICAgICAgICAgIG4gPSBlLnRhcmdldCwKICAgICAgICAgIGkgPSBhLmdldERhdGEobiwgInBhbmVsSW5kZXgiKSwKICAgICAgICAgIHMgPSB0aGlzLnBhbmVsc1tpXSwKICAgICAgICAgIGMgPSBzLmdldEhlaWdodCgpLAogICAgICAgICAgdSA9IHIuZ2V0TW91c2VQb3NpdGlvbih0LCBuKVsxXSwKICAgICAgICAgIGQgPSByLmdldE1vdXNlUG9zaXRpb24odCwgdGhpcy5jb250YWluZXIpWzFdLAogICAgICAgICAgaCA9IHRoaXMuX2luaXRpYWxpemVHdWlkZUVsZW1lbnQobiwgZCk7CgogICAgICBzLmFkZENsYXNzKG8uY2xhc3NuYW1lKCJzcGxpdHRlci1mb2N1c2VkIikpLCB0aGlzLl9kcmFnRGF0YSA9IHsKICAgICAgICBzcGxQYW5lbDogcywKICAgICAgICBzcGxPZmZzZXRZOiB1LAogICAgICAgIGd1aWRlRWxlbWVudDogaCwKICAgICAgICBzdGFydFk6IGQgLSB1LAogICAgICAgIG1pblk6IDAsCiAgICAgICAgbWF4WTogdGhpcy5nZXRWaWV3Qm91bmQoKS5oZWlnaHQgLSBjCiAgICAgIH0sIGwuYnJvd3Nlci5tc2llIHx8IGEuYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoInJlc2l6aW5nIikpOwogICAgfSwgaC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fZHJhZ0RhdGEsCiAgICAgICAgICBuID0gci5nZXRNb3VzZVBvc2l0aW9uKGUub3JpZ2luRXZlbnQsIHRoaXMuY29udGFpbmVyKVsxXTsKICAgICAgbiA9IGkubGltaXQobiAtIHQuc3BsT2Zmc2V0WSwgW3QubWluWV0sIFt0Lm1heFldKSwgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudCh0Lmd1aWRlRWxlbWVudCwgbik7CiAgICB9LCBoLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9kcmFnRGF0YSwKICAgICAgICAgIG4gPSB0aGlzLl9nZXRNb3VzZVlBZGRpdGlvbmFsTGltaXQodC5zcGxQYW5lbCksCiAgICAgICAgICBsID0gci5nZXRNb3VzZVBvc2l0aW9uKGUub3JpZ2luRXZlbnQsIHRoaXMuY29udGFpbmVyKVsxXTsKCiAgICAgIGwgPSBpLmxpbWl0KGwgLSB0LnNwbE9mZnNldFksIFt0Lm1pblkgKyBuWzBdXSwgW3QubWF4WSAtIG5bMV1dKSwgdGhpcy5fcmVzaXplKHQuc3BsUGFuZWwsIHQuc3RhcnRZLCBsKSwgdGhpcy5maXJlKCJyZXNpemUiLCB7CiAgICAgICAgbGF5b3V0RGF0YTogdGhpcy5nZXRMYXlvdXREYXRhKCkKICAgICAgfSksIHRoaXMuX2RyYWdEYXRhID0gbnVsbCwgdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQodC5ndWlkZUVsZW1lbnQpLCB0LnNwbFBhbmVsLnJlbW92ZUNsYXNzKG8uY2xhc3NuYW1lKCJzcGxpdHRlci1mb2N1c2VkIikpLCBhLnJlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZyIpKTsKICAgIH0sIGgucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlLAogICAgICAgICAgdCA9IFtdLAogICAgICAgICAgbiA9IHRoaXMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LAogICAgICAgICAgbyA9IDA7CiAgICAgIG4gJiYgKGwuZm9yRWFjaCh0aGlzLnBhbmVscywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLm9wdGlvbnMuYXV0b0hlaWdodCA/IHQucHVzaChlKSA6IG8gKz0gZS5nZXRIZWlnaHQoKTsKICAgICAgfSksIGUgPSAobiAtIG8pIC8gdC5sZW5ndGgsIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHQuc2V0SGVpZ2h0KG51bGwsIGUpOwogICAgICB9KSk7CiAgICB9LCBoLnByb3RvdHlwZS5hZGRQYW5lbCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksCiAgICAgICAgICBvID0gdGhpcy5wYW5lbHMsCiAgICAgICAgICBpID0gby5sZW5ndGg7CiAgICAgIGUgPSBsLmV4dGVuZCh7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSwgZSksIG8ucHVzaChuZXcgYyhlLCBuLCB0aGlzLnRoZW1lKSksIHQuYXBwZW5kQ2hpbGQobik7CiAgICB9LCBoLnByb3RvdHlwZS5hZGRQYW5lbHMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHRoaXMsCiAgICAgICAgICBvID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBuLmFkZFBhbmVsKGUsIG8pOwogICAgICB9KSwgdC5hcHBlbmRDaGlsZChvKTsKICAgIH0sIGgucHJvdG90eXBlLmdldFBhbmVsQnlOYW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHJldHVybiBsLmZvckVhY2godGhpcy5wYW5lbHMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgbi5uYW1lID09PSBlICYmICh0ID0gbik7CiAgICAgIH0pLCB0OwogICAgfSwgZS5leHBvcnRzID0gaDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBuKDgpOwoKICAgIGZ1bmN0aW9uIGMoZSwgdCkgewogICAgICB0ID0gaS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgdCwgby5jbGFzc25hbWUoIndlZWtkYXkiKSksIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBjb250YWluZXJCb3R0b21HdXR0ZXI6IDgsCiAgICAgICAgc2NoZWR1bGVIZWlnaHQ6IDE4LAogICAgICAgIHNjaGVkdWxlR3V0dGVyOiAyLAogICAgICAgIG5hcnJvd1dlZWtlbmQ6ICExLAogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAwLAogICAgICAgIHdvcmt3ZWVrOiAhMQogICAgICB9LCBlKSwgdGhpcy5fY2FjaGVQYXJlbnRWaWV3TW9kZWwgPSBudWxsLCBzLmNhbGwodGhpcywgdCk7CiAgICB9CgogICAgbC5pbmhlcml0KGMsIHMpLCBjLnByb3RvdHlwZS5nZXRSZW5kZXJEYXRlUmFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbC5yYW5nZTsKICAgIH0sIGMucHJvdG90eXBlLmdldFJlbmRlckRhdGVHcmlkcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlUGFyZW50Vmlld01vZGVsLmdyaWRzOwogICAgfSwgYy5wcm90b3R5cGUuZ2V0QmFzZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbiA9IGUucmFuZ2UsCiAgICAgICAgICBvID0gMTAwIC8gbi5sZW5ndGgsCiAgICAgICAgICBpID0gZS5ncmlkcywKICAgICAgICAgIHMgPSBlLmV4Y2VlZERhdGUgfHwge30sCiAgICAgICAgICBjID0gZS50aGVtZSwKICAgICAgICAgIHUgPSBuZXcgcigpLnRvTG9jYWxUaW1lKCk7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbCA9IGUsIHsKICAgICAgICB3aWR0aDogbywKICAgICAgICBzY2hlZHVsZUhlaWdodDogdC5zY2hlZHVsZUhlaWdodCwKICAgICAgICBzY2hlZHVsZUJsb2NrSGVpZ2h0OiB0LnNjaGVkdWxlSGVpZ2h0ICsgdC5zY2hlZHVsZUd1dHRlciwKICAgICAgICBzY2hlZHVsZUJsb2NrR3V0dGVyOiB0LnNjaGVkdWxlR3V0dGVyLAogICAgICAgIGRhdGVzOiBsLm1hcChuLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgdmFyIG4gPSBlLmdldERheSgpLAogICAgICAgICAgICAgIGwgPSBhLmZvcm1hdChuZXcgcihlKSwgIllZWVlNTUREIiksCiAgICAgICAgICAgICAgbyA9IGEuaXNTYW1lRGF0ZSh1LCBlKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRhdGU6IGEuZm9ybWF0KGUsICJZWVlZLU1NLUREIiksCiAgICAgICAgICAgIG1vbnRoOiBlLmdldE1vbnRoKCkgKyAxLAogICAgICAgICAgICBkYXk6IG4sCiAgICAgICAgICAgIGlzVG9kYXk6IG8sCiAgICAgICAgICAgIHltZDogbCwKICAgICAgICAgICAgaGlkZGVuU2NoZWR1bGVzOiBzW2xdIHx8IDAsCiAgICAgICAgICAgIHdpZHRoOiBpW3RdID8gaVt0XS53aWR0aCA6IDAsCiAgICAgICAgICAgIGxlZnQ6IGlbdF0gPyBpW3RdLmxlZnQgOiAwLAogICAgICAgICAgICBjb2xvcjogdGhpcy5fZ2V0RGF5TmFtZUNvbG9yKGMsIG4sIG8pLAogICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuX2dldERheUJhY2tncm91bmRDb2xvcihjLCBuKQogICAgICAgICAgfTsKICAgICAgICB9LCB0aGlzKQogICAgICB9OwogICAgfSwgYy5wcm90b3R5cGUuZ2V0RXhjZWVkRGF0ZSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBvID0gdGhpcy5faW5pdEV4Y2VlZERhdGUobik7CgogICAgICByZXR1cm4gbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG47CiAgICAgICAgICAgICF0IHx8IHQudG9wIDwgZSB8fCAodC5oaWRkZW4gPSAhMCwgbiA9IGEucmFuZ2UodC5nZXRTdGFydHMoKSwgdC5nZXRFbmRzKCksIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLCBsLmZvckVhY2gobiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGEuZm9ybWF0KGUsICJZWVlZTU1ERCIpOwogICAgICAgICAgICAgIG9bdF0gKz0gMTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pLCBvOwogICAgfSwgYy5wcm90b3R5cGUuX2luaXRFeGNlZWREYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB7fTsKICAgICAgcmV0dXJuIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuID0gYS5mb3JtYXQoZSwgIllZWVlNTUREIik7CiAgICAgICAgdFtuXSA9IDA7CiAgICAgIH0pLCB0OwogICAgfSwgYy5wcm90b3R5cGUuX2dldERheU5hbWVDb2xvciA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgIHZhciBvID0gIiI7CiAgICAgIHJldHVybiBlICYmIChvID0gMCA9PT0gdCA/IGwgPyBlLm1vbnRoLmhvbGlkYXlFeGNlcHRUaGlzTW9udGguY29sb3IgOiBlLmNvbW1vbi5ob2xpZGF5LmNvbG9yIDogNiA9PT0gdCA/IGwgPyBlLm1vbnRoLmRheUV4Y2VwdFRoaXNNb250aC5jb2xvciA6IGUuY29tbW9uLnNhdHVyZGF5LmNvbG9yIDogbiA/IGUuY29tbW9uLnRvZGF5LmNvbG9yIDogbCA/IGUubW9udGguZGF5RXhjZXB0VGhpc01vbnRoLmNvbG9yIDogZS5jb21tb24uZGF5bmFtZS5jb2xvciksIG87CiAgICB9LCBjLnByb3RvdHlwZS5fZ2V0RGF5QmFja2dyb3VuZENvbG9yID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSAiIjsKICAgICAgcmV0dXJuIGUgJiYgKG4gPSAwID09PSB0IHx8IDYgPT09IHQgPyBlLm1vbnRoLndlZWtlbmQuYmFja2dyb3VuZENvbG9yIDogImluaGVyaXQiKSwgbjsKICAgIH0sIGUuZXhwb3J0cyA9IGM7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCk7CgogICAgZnVuY3Rpb24gbyhlLCB0LCBuKSB7CiAgICAgIHRoaXMueCA9IG4gPyBNYXRoLnJvdW5kKGUpIDogZSwgdGhpcy55ID0gbiA/IE1hdGgucm91bmQodCkgOiB0OwogICAgfQoKICAgIG8uZ2V0UmF0aW8gPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICByZXR1cm4gdCA9PT0gbiA/IGUuY2xvbmUoKSA6IGUubXVsdGlwbHlCeShuKS5fZGl2aWRlQnkodCk7CiAgICB9LCBvLm4gPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIG8gPyBlIDogbC5pc0FycmF5KGUpID8gbmV3IG8oZVswXSwgZVsxXSwgdCkgOiBuZXcgbyhlLCB0LCBuKTsKICAgIH0sIG8ucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IG8odGhpcy54LCB0aGlzLnkpOwogICAgfSwgby5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fYWRkKG8ubihlKSk7CiAgICB9LCBvLnByb3RvdHlwZS5fYWRkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMueCArPSBlLngsIHRoaXMueSArPSBlLnksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5zdWJ0cmFjdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX3N1YnRyYWN0KG8ubihlKSk7CiAgICB9LCBvLnByb3RvdHlwZS5fc3VidHJhY3QgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy54IC09IGUueCwgdGhpcy55IC09IGUueSwgdGhpczsKICAgIH0sIG8ucHJvdG90eXBlLmRpdmlkZUJ5ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fZGl2aWRlQnkoZSk7CiAgICB9LCBvLnByb3RvdHlwZS5fZGl2aWRlQnkgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy54IC89IGUsIHRoaXMueSAvPSBlLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUubXVsdGlwbHlCeSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX211bHRpcGx5QnkoZSk7CiAgICB9LCBvLnByb3RvdHlwZS5fbXVsdGlwbHlCeSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB0aGlzLnggKj0gZSwgdGhpcy55ICo9IGUsIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5yb3VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fcm91bmQoKTsKICAgIH0sIG8ucHJvdG90eXBlLl9yb3VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMueCA9IE1hdGgucm91bmQodGhpcy54KSwgdGhpcy55ID0gTWF0aC5yb3VuZCh0aGlzLnkpLCB0aGlzOwogICAgfSwgby5wcm90b3R5cGUucmV2ZXJzZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5fcmV2ZXJzZSgpOwogICAgfSwgby5wcm90b3R5cGUuX3JldmVyc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnggKj0gLTEsIHRoaXMueSAqPSAtMSwgdGhpczsKICAgIH0sIG8ucHJvdG90eXBlLmZsb29yID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLl9mbG9vcigpOwogICAgfSwgby5wcm90b3R5cGUuX2Zsb29yID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy54ID0gTWF0aC5mbG9vcih0aGlzLngpLCB0aGlzLnkgPSBNYXRoLmZsb29yKHRoaXMueSksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5jZWlsID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLl9jZWlsKCk7CiAgICB9LCBvLnByb3RvdHlwZS5fY2VpbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMueCA9IE1hdGguY2VpbCh0aGlzLngpLCB0aGlzLnkgPSBNYXRoLmNlaWwodGhpcy55KSwgdGhpczsKICAgIH0sIG8ucHJvdG90eXBlLnJvdGF0ZSA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgIHJldHVybiB0aGlzLmNsb25lKCkuX3JvdGF0ZShlLCB0LCBuLCBsKTsKICAgIH0sIG8ucHJvdG90eXBlLl9yb3RhdGUgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICB2YXIgbywKICAgICAgICAgIGksCiAgICAgICAgICBhID0gZSAqIChNYXRoLlBJIC8gMTgwKTsKICAgICAgcmV0dXJuIG4gPSBuIHx8IHBhcnNlRmxvYXQoTWF0aC5jb3MoYSkudG9GaXhlZCg4KSksIGwgPSBsIHx8IHBhcnNlRmxvYXQoTWF0aC5zaW4oYSkudG9GaXhlZCg4KSksIHRoaXMuX3N1YnRyYWN0KHQpLCBvID0gdGhpcy54LCBpID0gdGhpcy55LCB0aGlzLnggPSBvICogbiAtIGkgKiBsLCB0aGlzLnkgPSBvICogbCArIGkgKiBuLCB0aGlzLl9hZGQodCksIHRoaXM7CiAgICB9LCBvLnByb3RvdHlwZS5kaXN0YW5jZVRvID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgIHJldHVybiB0ID0gKGUgPSBvLm4oZSkpLnggLSB0aGlzLngsIG4gPSBlLnkgLSB0aGlzLnksIE1hdGguc3FydCh0ICogdCArIG4gKiBuKTsKICAgIH0sIG8ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiAoZSA9IG8ubihlKSkueCA9PT0gdGhpcy54ICYmIGUueSA9PT0gdGhpcy55OwogICAgfSwgby5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAiUG9pbnQoIiArIHRoaXMueCArICIsICIgKyB0aGlzLnkgKyAiKSI7CiAgICB9LCBvLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55XTsKICAgIH0sIGUuZXhwb3J0cyA9IG87CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oOCksCiAgICAgICAgbyA9IG4oMTYpLAogICAgICAgIGkgPSBuKDApLAogICAgICAgIGEgPSBuKDc5KSwKICAgICAgICByID0gbig0KSwKICAgICAgICBzID0gbigyKSwKICAgICAgICBjID0gbig2KSwKICAgICAgICB1ID0gbigxKSwKICAgICAgICBkID0gbig1KSwKICAgICAgICBoID0gbigzKSwKICAgICAgICBwID0gbig4MCksCiAgICAgICAgbSA9IHIuRGF0ZTsKCiAgICBmdW5jdGlvbiBmKGUsIHQsIG4pIHsKICAgICAgbC5jYWxsKHRoaXMsIGUpLCB0aGlzLmxheWVyID0gbmV3IG8obnVsbCwgZSksIHRoaXMuX3ZpZXdNb2RlbCA9IG51bGwsIHRoaXMuX3NlbGVjdGVkQ2FsID0gbnVsbCwgdGhpcy5fc2NoZWR1bGUgPSBudWxsLCB0aGlzLmNhbGVuZGFycyA9IHQsIHRoaXMuX2ZvY3VzZWREcm9wZG93biA9IG51bGwsIHRoaXMuX3VzYWdlU3RhdGlzdGljcyA9IG4sIHRoaXMuX29uQ2xpY2tMaXN0ZW5lcnMgPSBbdGhpcy5fc2VsZWN0RHJvcGRvd25NZW51SXRlbS5iaW5kKHRoaXMpLCB0aGlzLl90b2dnbGVEcm9wZG93bk1lbnVWaWV3LmJpbmQodGhpcyksIHRoaXMuX2Nsb3NlRHJvcGRvd25NZW51Vmlldy5iaW5kKHRoaXMsIG51bGwpLCB0aGlzLl9jbG9zZVBvcHVwLmJpbmQodGhpcyksIHRoaXMuX3RvZ2dsZUlzQWxsZGF5LmJpbmQodGhpcyksIHRoaXMuX3RvZ2dsZUlzUHJpdmF0ZS5iaW5kKHRoaXMpLCB0aGlzLl9vbkNsaWNrU2F2ZVNjaGVkdWxlLmJpbmQodGhpcyldLCBjLm9uKGUsICJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpOwogICAgfQoKICAgIGkuaW5oZXJpdChmLCBsKSwgZi5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBjLmdldEV2ZW50VGFyZ2V0KGUpOwogICAgICB1LmNsb3Nlc3QodCwgcy5jbGFzc25hbWUoIi5mbG9hdGluZy1sYXllciIpKSB8fCB0aGlzLmhpZGUoKTsKICAgIH0sIGYucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMubGF5ZXIuZGVzdHJveSgpLCB0aGlzLmxheWVyID0gbnVsbCwgYy5vZmYodGhpcy5jb250YWluZXIsICJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpLCBjLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpLCBsLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7CiAgICB9LCBmLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gYy5nZXRFdmVudFRhcmdldChlKTsKICAgICAgaS5mb3JFYWNoKHRoaXMuX29uQ2xpY2tMaXN0ZW5lcnMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICFlKHQpOwogICAgICB9KTsKICAgIH0sIGYucHJvdG90eXBlLl9jbG9zZVBvcHVwID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBzLmNsYXNzbmFtZSgicG9wdXAtY2xvc2UiKTsKICAgICAgcmV0dXJuICEoIXUuaGFzQ2xhc3MoZSwgdCkgJiYgIXUuY2xvc2VzdChlLCAiLiIgKyB0KSkgJiYgKHRoaXMuaGlkZSgpLCAhMCk7CiAgICB9LCBmLnByb3RvdHlwZS5fdG9nZ2xlRHJvcGRvd25NZW51VmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gcy5jbGFzc25hbWUoImRyb3Bkb3duLWJ1dHRvbiIpLAogICAgICAgICAgbiA9IHUuaGFzQ2xhc3MoZSwgdCkgPyBlIDogdS5jbG9zZXN0KGUsICIuIiArIHQpOwogICAgICByZXR1cm4gISFuICYmICh1Lmhhc0NsYXNzKG4ucGFyZW50Tm9kZSwgcy5jbGFzc25hbWUoIm9wZW4iKSkgPyB0aGlzLl9jbG9zZURyb3Bkb3duTWVudVZpZXcobi5wYXJlbnROb2RlKSA6IHRoaXMuX29wZW5Ecm9wZG93bk1lbnVWaWV3KG4ucGFyZW50Tm9kZSksICEwKTsKICAgIH0sIGYucHJvdG90eXBlLl9jbG9zZURyb3Bkb3duTWVudVZpZXcgPSBmdW5jdGlvbiAoZSkgewogICAgICAoZSA9IGUgfHwgdGhpcy5fZm9jdXNlZERyb3Bkb3duKSAmJiAodS5yZW1vdmVDbGFzcyhlLCBzLmNsYXNzbmFtZSgib3BlbiIpKSwgdGhpcy5fZm9jdXNlZERyb3Bkb3duID0gbnVsbCk7CiAgICB9LCBmLnByb3RvdHlwZS5fb3BlbkRyb3Bkb3duTWVudVZpZXcgPSBmdW5jdGlvbiAoZSkgewogICAgICB1LmFkZENsYXNzKGUsIHMuY2xhc3NuYW1lKCJvcGVuIikpLCB0aGlzLl9mb2N1c2VkRHJvcGRvd24gPSBlOwogICAgfSwgZi5wcm90b3R5cGUuX3NlbGVjdERyb3Bkb3duTWVudUl0ZW0gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSBzLmNsYXNzbmFtZSgiZHJvcGRvd24tbWVudS1pdGVtIiksCiAgICAgICAgICBhID0gcy5jbGFzc25hbWUoImljb24iKSwKICAgICAgICAgIHIgPSBzLmNsYXNzbmFtZSgiY29udGVudCIpLAogICAgICAgICAgYyA9IHUuaGFzQ2xhc3MoZSwgaSkgPyBlIDogdS5jbG9zZXN0KGUsICIuIiArIGkpOwogICAgICByZXR1cm4gISFjICYmICh0ID0gdS5maW5kKCIuIiArIGEsIGMpLnN0eWxlLmJhY2tncm91bmRDb2xvciB8fCAidHJhbnNwYXJlbnQiLCBuID0gdS5maW5kKCIuIiArIHIsIGMpLmlubmVySFRNTCwgbCA9IHUuY2xvc2VzdChjLCBzLmNsYXNzbmFtZSgiLmRyb3Bkb3duIikpLCBvID0gdS5maW5kKHMuY2xhc3NuYW1lKCIuZHJvcGRvd24tYnV0dG9uIiksIGwpLCB1LmZpbmQoIi4iICsgciwgbykuaW5uZXJUZXh0ID0gbiwgdS5oYXNDbGFzcyhsLCBzLmNsYXNzbmFtZSgic2VjdGlvbi1jYWxlbmRhciIpKSAmJiAodS5maW5kKCIuIiArIGEsIG8pLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHQsIHRoaXMuX3NlbGVjdGVkQ2FsID0gZC5maW5kKHRoaXMuY2FsZW5kYXJzLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlLmlkID09PSB1LmdldERhdGEoYywgImNhbGVuZGFySWQiKTsKICAgICAgfSkpLCB1LnJlbW92ZUNsYXNzKGwsIHMuY2xhc3NuYW1lKCJvcGVuIikpLCAhMCk7CiAgICB9LCBmLnByb3RvdHlwZS5fdG9nZ2xlSXNBbGxkYXkgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBzLmNsYXNzbmFtZSgic2VjdGlvbi1hbGxkYXkiKSwKICAgICAgICAgIGwgPSB1Lmhhc0NsYXNzKGUsIG4pID8gZSA6IHUuY2xvc2VzdChlLCAiLiIgKyBuKTsKICAgICAgcmV0dXJuICEhbCAmJiAoKHQgPSB1LmZpbmQocy5jbGFzc25hbWUoIi5jaGVja2JveC1zcXVhcmUiKSwgbCkpLmNoZWNrZWQgPSAhdC5jaGVja2VkLCAhMCk7CiAgICB9LCBmLnByb3RvdHlwZS5fdG9nZ2xlSXNQcml2YXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBzLmNsYXNzbmFtZSgic2VjdGlvbi1wcml2YXRlIiksCiAgICAgICAgICBuID0gdS5oYXNDbGFzcyhlLCB0KSA/IGUgOiB1LmNsb3Nlc3QoZSwgIi4iICsgdCk7CiAgICAgIHJldHVybiAhIW4gJiYgKHUuaGFzQ2xhc3Mobiwgcy5jbGFzc25hbWUoInB1YmxpYyIpKSA/IHUucmVtb3ZlQ2xhc3Mobiwgcy5jbGFzc25hbWUoInB1YmxpYyIpKSA6IHUuYWRkQ2xhc3Mobiwgcy5jbGFzc25hbWUoInB1YmxpYyIpKSwgITApOwogICAgfSwgZi5wcm90b3R5cGUuX29uQ2xpY2tTYXZlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBhLAogICAgICAgICAgciA9IHMuY2xhc3NuYW1lKCJwb3B1cC1zYXZlIiksCiAgICAgICAgICBjID0gcy5jc3NQcmVmaXg7CiAgICAgIHJldHVybiAhKCF1Lmhhc0NsYXNzKGUsIHIpICYmICF1LmNsb3Nlc3QoZSwgIi4iICsgcikpICYmICh0ID0gdS5nZXQoYyArICJzY2hlZHVsZS10aXRsZSIpLCBuID0gbmV3IG0odGhpcy5yYW5nZVBpY2tlci5nZXRTdGFydERhdGUoKSkudG9Mb2NhbFRpbWUoKSwgbCA9IG5ldyBtKHRoaXMucmFuZ2VQaWNrZXIuZ2V0RW5kRGF0ZSgpKS50b0xvY2FsVGltZSgpLCB0aGlzLl92YWxpZGF0ZUZvcm0odCwgbiwgbCkgPyAoYSA9ICEhdS5nZXQoYyArICJzY2hlZHVsZS1hbGxkYXkiKS5jaGVja2VkLCBvID0gdGhpcy5fZ2V0UmFuZ2VEYXRlKG4sIGwsIGEpLCBpID0gewogICAgICAgIGNhbGVuZGFySWQ6IHRoaXMuX3NlbGVjdGVkQ2FsID8gdGhpcy5fc2VsZWN0ZWRDYWwuaWQgOiBudWxsLAogICAgICAgIHRpdGxlOiB0LAogICAgICAgIGxvY2F0aW9uOiB1LmdldChjICsgInNjaGVkdWxlLWxvY2F0aW9uIiksCiAgICAgICAgc3RhcnQ6IG8uc3RhcnQsCiAgICAgICAgZW5kOiBvLmVuZCwKICAgICAgICBpc0FsbERheTogYSwKICAgICAgICBzdGF0ZTogdS5nZXQoYyArICJzY2hlZHVsZS1zdGF0ZSIpLmlubmVyVGV4dCwKICAgICAgICBpc1ByaXZhdGU6ICF1Lmhhc0NsYXNzKHUuZ2V0KGMgKyAic2NoZWR1bGUtcHJpdmF0ZSIpLCBzLmNsYXNzbmFtZSgicHVibGljIikpCiAgICAgIH0sIHRoaXMuX2lzRWRpdE1vZGUgPyB0aGlzLl9vbkNsaWNrVXBkYXRlU2NoZWR1bGUoaSkgOiB0aGlzLl9vbkNsaWNrQ3JlYXRlU2NoZWR1bGUoaSksIHRoaXMuaGlkZSgpLCAhMCkgOiAodC52YWx1ZSB8fCB0LmZvY3VzKCksICExKSk7CiAgICB9LCBmLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpcy5jYWxlbmRhcnMsCiAgICAgICAgICBvID0gdGhpcy5sYXllciwKICAgICAgICAgIGEgPSB0aGlzOwogICAgICBlLnpJbmRleCA9IHRoaXMubGF5ZXIuekluZGV4ICsgNSwgZS5jYWxlbmRhcnMgPSBsLCBsLmxlbmd0aCAmJiAoZS5zZWxlY3RlZENhbCA9IHRoaXMuX3NlbGVjdGVkQ2FsID0gbFswXSksIHRoaXMuX2lzRWRpdE1vZGUgPSBlLnNjaGVkdWxlICYmIGUuc2NoZWR1bGUuaWQsIHRoaXMuX2lzRWRpdE1vZGUgPyAodCA9IGUudGFyZ2V0LCBlID0gdGhpcy5fbWFrZUVkaXRNb2RlRGF0YShlKSkgOiAodGhpcy5ndWlkZSA9IGUuZ3VpZGUsIHQgPSAobiA9IHRoaXMuX2dldEd1aWRlRWxlbWVudHModGhpcy5ndWlkZSkpLmxlbmd0aCA/IG5bMF0gOiBudWxsKSwgby5zZXRDb250ZW50KHAoZSkpLCB0aGlzLl9jcmVhdGVEYXRlcGlja2VyKGUuc3RhcnQsIGUuZW5kLCBlLmlzQWxsRGF5KSwgby5zaG93KCksIHQgJiYgdGhpcy5fc2V0UG9wdXBQb3NpdGlvbkFuZEFycm93RGlyZWN0aW9uKHQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLCBpLmRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgICBjLm9uKGRvY3VtZW50LmJvZHksICJtb3VzZWRvd24iLCBhLl9vbk1vdXNlRG93biwgYSk7CiAgICAgIH0pKCk7CiAgICB9LCBmLnByb3RvdHlwZS5fbWFrZUVkaXRNb2RlRGF0YSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBvLAogICAgICAgICAgaSwKICAgICAgICAgIGEsCiAgICAgICAgICByLAogICAgICAgICAgcyA9IGUuc2NoZWR1bGUsCiAgICAgICAgICBjID0gcy5yYXcgfHwge30sCiAgICAgICAgICB1ID0gdGhpcy5jYWxlbmRhcnMsCiAgICAgICAgICBoID0gcy5pZDsKICAgICAgcmV0dXJuIHQgPSBzLnRpdGxlLCBuID0gInByaXZhdGUiID09PSBjLmNsYXNzLCBsID0gcy5sb2NhdGlvbiwgbyA9IHMuc3RhcnQsIGkgPSBzLmVuZCwgYSA9IHMuaXNBbGxEYXksIHIgPSBzLnN0YXRlLCBlLnNlbGVjdGVkQ2FsID0gdGhpcy5fc2VsZWN0ZWRDYWwgPSBkLmZpbmQodGhpcy5jYWxlbmRhcnMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuaWQgPT09IGUuc2NoZWR1bGUuY2FsZW5kYXJJZDsKICAgICAgfSksIHRoaXMuX3NjaGVkdWxlID0gcywgewogICAgICAgIGlkOiBoLAogICAgICAgIHNlbGVjdGVkQ2FsOiB0aGlzLl9zZWxlY3RlZENhbCwKICAgICAgICBjYWxlbmRhcnM6IHUsCiAgICAgICAgdGl0bGU6IHQsCiAgICAgICAgaXNQcml2YXRlOiBuLAogICAgICAgIGxvY2F0aW9uOiBsLAogICAgICAgIGlzQWxsRGF5OiBhLAogICAgICAgIHN0YXRlOiByLAogICAgICAgIHN0YXJ0OiBvLAogICAgICAgIGVuZDogaSwKICAgICAgICByYXc6IHsKICAgICAgICAgIGNsYXNzOiBuID8gInByaXZhdGUiIDogInB1YmxpYyIKICAgICAgICB9LAogICAgICAgIHpJbmRleDogdGhpcy5sYXllci56SW5kZXggKyA1LAogICAgICAgIGlzRWRpdE1vZGU6IHRoaXMuX2lzRWRpdE1vZGUKICAgICAgfTsKICAgIH0sIGYucHJvdG90eXBlLl9zZXRQb3B1cFBvc2l0aW9uQW5kQXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHUuZmluZChzLmNsYXNzbmFtZSgiLnBvcHVwIiksIHRoaXMubGF5ZXIuY29udGFpbmVyKSwKICAgICAgICAgIG4gPSB7CiAgICAgICAgd2lkdGg6IHQub2Zmc2V0V2lkdGgsCiAgICAgICAgaGVpZ2h0OiB0Lm9mZnNldEhlaWdodAogICAgICB9LAogICAgICAgICAgbCA9IHRoaXMuY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLAogICAgICAgICAgbyA9IHRoaXMuX2NhbGNSZW5kZXJpbmdEYXRhKG4sIGwsIGUpOwoKICAgICAgdGhpcy5sYXllci5zZXRQb3NpdGlvbihvLngsIG8ueSksIHRoaXMuX3NldEFycm93RGlyZWN0aW9uKG8uYXJyb3cpOwogICAgfSwgZi5wcm90b3R5cGUuX2dldEd1aWRlRWxlbWVudHMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IFtdLAogICAgICAgICAgbiA9IDA7CiAgICAgIGlmIChlLmd1aWRlRWxlbWVudCkgdC5wdXNoKGUuZ3VpZGVFbGVtZW50KTtlbHNlIGlmIChlLmd1aWRlRWxlbWVudHMpIGZvciAoOyBuIDwgNjsgbiArPSAxKSB7CiAgICAgICAgZS5ndWlkZUVsZW1lbnRzW25dICYmIHQucHVzaChlLmd1aWRlRWxlbWVudHNbbl0pOwogICAgICB9CiAgICAgIHJldHVybiB0OwogICAgfSwgZi5wcm90b3R5cGUuX2dldEJvdW5kT2ZGaXJzdFJvd0d1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICByZXR1cm4gZS5sZW5ndGggPyB7CiAgICAgICAgdG9wOiAodCA9IGVbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpLnRvcCwKICAgICAgICBsZWZ0OiB0LmxlZnQsCiAgICAgICAgYm90dG9tOiB0LmJvdHRvbSwKICAgICAgICByaWdodDogdC5yaWdodAogICAgICB9IDogbnVsbDsKICAgIH0sIGYucHJvdG90eXBlLl9nZXRZQW5kQXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbykgewogICAgICB2YXIgaSA9ICJhcnJvdy1ib3R0b20iLAogICAgICAgICAgYSA9IGUgLSBuOwogICAgICByZXR1cm4gYSA8IGwgPyAoYSA9IHQgLSBsICsgMywgaSA9ICJhcnJvdy10b3AiKSA6IGEgPSBhIC0gbCAtIDMsIGEgKyBuID4gbyAmJiAoYSA9IG8gLSBuIC0gbCAtIDMpLCB7CiAgICAgICAgeTogYSwKICAgICAgICBhcnJvd0RpcmVjdGlvbjogaQogICAgICB9OwogICAgfSwgZi5wcm90b3R5cGUuX2dldFhBbmRBcnJvd0xlZnQgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbykgewogICAgICB2YXIgaSwKICAgICAgICAgIGEgPSAoZSArIHQpIC8gMiwKICAgICAgICAgIHIgPSBhIC0gbiAvIDI7CiAgICAgIHJldHVybiByICsgbiA+IG8gPyBpID0gYSAtIChyID0gdCAtIG4gKyA4KSA6IHIgKz0gOCwgciA8IGwgPyAociA9IDAsIGkgPSBhIC0gbCAtIDgpIDogciA9IHIgLSBsIC0gOCwgewogICAgICAgIHg6IHIsCiAgICAgICAgYXJyb3dMZWZ0OiBpCiAgICAgIH07CiAgICB9LCBmLnByb3RvdHlwZS5fY2FsY1JlbmRlcmluZ0RhdGEgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbCA9IHRoaXMuX2dldFlBbmRBcnJvd0RpcmVjdGlvbihuLnRvcCwgbi5ib3R0b20sIGUuaGVpZ2h0LCB0LnRvcCwgdC5ib3R0b20pLAogICAgICAgICAgbyA9IHRoaXMuX2dldFhBbmRBcnJvd0xlZnQobi5sZWZ0LCBuLnJpZ2h0LCBlLndpZHRoLCB0LmxlZnQsIHQucmlnaHQpOwoKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBvLngsCiAgICAgICAgeTogbC55LAogICAgICAgIGFycm93OiB7CiAgICAgICAgICBkaXJlY3Rpb246IGwuYXJyb3dEaXJlY3Rpb24sCiAgICAgICAgICBwb3NpdGlvbjogby5hcnJvd0xlZnQKICAgICAgICB9CiAgICAgIH07CiAgICB9LCBmLnByb3RvdHlwZS5fc2V0QXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUuZGlyZWN0aW9uIHx8ICJhcnJvdy1ib3R0b20iLAogICAgICAgICAgbiA9IHUuZ2V0KHMuY2xhc3NuYW1lKCJwb3B1cC1hcnJvdyIpKSwKICAgICAgICAgIGwgPSB1LmZpbmQocy5jbGFzc25hbWUoIi5wb3B1cC1hcnJvdy1ib3JkZXIiLCBuKSk7CiAgICAgIHQgIT09IHMuY2xhc3NuYW1lKCJhcnJvdy1ib3R0b20iKSAmJiAodS5yZW1vdmVDbGFzcyhuLCBzLmNsYXNzbmFtZSgiYXJyb3ctYm90dG9tIikpLCB1LmFkZENsYXNzKG4sIHMuY2xhc3NuYW1lKHQpKSksIGUucG9zaXRpb24gJiYgKGwuc3R5bGUubGVmdCA9IGUucG9zaXRpb24gKyAicHgiKTsKICAgIH0sIGYucHJvdG90eXBlLl9jcmVhdGVEYXRlcGlja2VyID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwgPSBzLmNzc1ByZWZpeDsKICAgICAgdGhpcy5yYW5nZVBpY2tlciA9IGEuY3JlYXRlUmFuZ2VQaWNrZXIoewogICAgICAgIHN0YXJ0cGlja2VyOiB7CiAgICAgICAgICBkYXRlOiBuZXcgbShlKS50b0RhdGUoKSwKICAgICAgICAgIGlucHV0OiAiIyIgKyBsICsgInNjaGVkdWxlLXN0YXJ0LWRhdGUiLAogICAgICAgICAgY29udGFpbmVyOiAiIyIgKyBsICsgInN0YXJ0cGlja2VyLWNvbnRhaW5lciIKICAgICAgICB9LAogICAgICAgIGVuZHBpY2tlcjogewogICAgICAgICAgZGF0ZTogbmV3IG0odCkudG9EYXRlKCksCiAgICAgICAgICBpbnB1dDogIiMiICsgbCArICJzY2hlZHVsZS1lbmQtZGF0ZSIsCiAgICAgICAgICBjb250YWluZXI6ICIjIiArIGwgKyAiZW5kcGlja2VyLWNvbnRhaW5lciIKICAgICAgICB9LAogICAgICAgIGZvcm1hdDogbiA/ICJ5eXl5LU1NLWRkIiA6ICJ5eXl5LU1NLWRkIEhIOm1tIiwKICAgICAgICB0aW1lcGlja2VyOiBuID8gbnVsbCA6IHsKICAgICAgICAgIHNob3dNZXJpZGllbTogITEsCiAgICAgICAgICB1c2FnZVN0YXRpc3RpY3M6IHRoaXMuX3VzYWdlU3RhdGlzdGljcwogICAgICAgIH0sCiAgICAgICAgdXNhZ2VTdGF0aXN0aWNzOiB0aGlzLl91c2FnZVN0YXRpc3RpY3MKICAgICAgfSk7CiAgICB9LCBmLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmxheWVyLmhpZGUoKSwgdGhpcy5ndWlkZSAmJiAodGhpcy5ndWlkZS5jbGVhckd1aWRlRWxlbWVudCgpLCB0aGlzLmd1aWRlID0gbnVsbCksIGMub2ZmKGRvY3VtZW50LmJvZHksICJtb3VzZWRvd24iLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyk7CiAgICB9LCBmLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl92aWV3TW9kZWwgJiYgdGhpcy5sYXllci5zZXRDb250ZW50KHRoaXMudG1wbCh0aGlzLl92aWV3TW9kZWwpKTsKICAgIH0sIGYucHJvdG90eXBlLnNldENhbGVuZGFycyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuY2FsZW5kYXJzID0gZSB8fCBbXTsKICAgIH0sIGYucHJvdG90eXBlLl92YWxpZGF0ZUZvcm0gPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICByZXR1cm4gISFlLnZhbHVlICYmICEoIXQgJiYgIW4pICYmIDEgIT09IGguY29tcGFyZSh0LCBuKTsKICAgIH0sIGYucHJvdG90eXBlLl9nZXRSYW5nZURhdGUgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICByZXR1cm4gbiAmJiAoZS5zZXRIb3VycygwLCAwLCAwKSwgdCA9IGguaXNTdGFydE9mRGF5KHQpID8gaC5jb252ZXJ0U3RhcnREYXlUb0xhc3REYXkodCkgOiB0LnNldEhvdXJzKDIzLCA1OSwgNTkpKSwgewogICAgICAgIHN0YXJ0OiBuZXcgbShlKSwKICAgICAgICBlbmQ6IG5ldyBtKHQpCiAgICAgIH07CiAgICB9LCBmLnByb3RvdHlwZS5fb25DbGlja1VwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBkLmdldFNjaGVkdWxlQ2hhbmdlcyh0aGlzLl9zY2hlZHVsZSwgWyJjYWxlbmRhcklkIiwgInRpdGxlIiwgImxvY2F0aW9uIiwgInN0YXJ0IiwgImVuZCIsICJpc0FsbERheSIsICJzdGF0ZSJdLCB7CiAgICAgICAgY2FsZW5kYXJJZDogZS5jYWxlbmRhcklkLAogICAgICAgIHRpdGxlOiBlLnRpdGxlLnZhbHVlLAogICAgICAgIGxvY2F0aW9uOiBlLmxvY2F0aW9uLnZhbHVlLAogICAgICAgIHN0YXJ0OiBlLnN0YXJ0LAogICAgICAgIGVuZDogZS5lbmQsCiAgICAgICAgaXNBbGxEYXk6IGUuaXNBbGxEYXksCiAgICAgICAgc3RhdGU6IGUuc3RhdGUKICAgICAgfSk7CiAgICAgIHRoaXMuZmlyZSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IGkuZXh0ZW5kKHsKICAgICAgICAgIHJhdzogewogICAgICAgICAgICBjbGFzczogZS5pc1ByaXZhdGUgPyAicHJpdmF0ZSIgOiAicHVibGljIgogICAgICAgICAgfQogICAgICAgIH0sIHRoaXMuX3NjaGVkdWxlKSwKICAgICAgICBjaGFuZ2VzOiB0LAogICAgICAgIHN0YXJ0OiBlLnN0YXJ0LAogICAgICAgIGVuZDogZS5lbmQsCiAgICAgICAgY2FsZW5kYXI6IHRoaXMuX3NlbGVjdGVkQ2FsLAogICAgICAgIHRyaWdnZXJFdmVudE5hbWU6ICJjbGljayIKICAgICAgfSk7CiAgICB9LCBmLnByb3RvdHlwZS5fb25DbGlja0NyZWF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIHsKICAgICAgICBjYWxlbmRhcklkOiBlLmNhbGVuZGFySWQsCiAgICAgICAgdGl0bGU6IGUudGl0bGUudmFsdWUsCiAgICAgICAgbG9jYXRpb246IGUubG9jYXRpb24udmFsdWUsCiAgICAgICAgcmF3OiB7CiAgICAgICAgICBjbGFzczogZS5pc1ByaXZhdGUgPyAicHJpdmF0ZSIgOiAicHVibGljIgogICAgICAgIH0sCiAgICAgICAgc3RhcnQ6IGUuc3RhcnQsCiAgICAgICAgZW5kOiBlLmVuZCwKICAgICAgICBpc0FsbERheTogZS5pc0FsbERheSwKICAgICAgICBzdGF0ZTogZS5zdGF0ZQogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IGY7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oOCksCiAgICAgICAgbyA9IG4oMTYpLAogICAgICAgIGkgPSBuKDApLAogICAgICAgIGEgPSBuKDIpLAogICAgICAgIHIgPSBuKDYpLAogICAgICAgIHMgPSBuKDEpLAogICAgICAgIGMgPSBuKDgxKTsKCiAgICBmdW5jdGlvbiB1KGUpIHsKICAgICAgbC5jYWxsKHRoaXMsIGUpLCB0aGlzLmxheWVyID0gbmV3IG8obnVsbCwgZSksIHRoaXMuX3ZpZXdNb2RlbCA9IG51bGwsIHRoaXMuX3NjaGVkdWxlID0gbnVsbCwgdGhpcy5fY2FsZW5kYXIgPSBudWxsLCByLm9uKGUsICJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpOwogICAgfQoKICAgIGkuaW5oZXJpdCh1LCBsKSwgdS5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSByLmdldEV2ZW50VGFyZ2V0KGUpOwogICAgICBzLmNsb3Nlc3QodCwgYS5jbGFzc25hbWUoIi5mbG9hdGluZy1sYXllciIpKSB8fCB0aGlzLmhpZGUoKTsKICAgIH0sIHUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMubGF5ZXIuZGVzdHJveSgpLCB0aGlzLmxheWVyID0gbnVsbCwgci5vZmYodGhpcy5jb250YWluZXIsICJjbGljayIsIHRoaXMuX29uQ2xpY2ssIHRoaXMpLCByLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpLCBsLnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gci5nZXRFdmVudFRhcmdldChlKTsKICAgICAgdGhpcy5fb25DbGlja0VkaXRTY2hlZHVsZSh0KSwgdGhpcy5fb25DbGlja0RlbGV0ZVNjaGVkdWxlKHQpOwogICAgfSwgdS5wcm90b3R5cGUuX29uQ2xpY2tFZGl0U2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGEuY2xhc3NuYW1lKCJwb3B1cC1lZGl0Iik7CiAgICAgIChzLmhhc0NsYXNzKGUsIHQpIHx8IHMuY2xvc2VzdChlLCAiLiIgKyB0KSkgJiYgKHRoaXMuZmlyZSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IHRoaXMuX3NjaGVkdWxlLAogICAgICAgIHRyaWdnZXJFdmVudE5hbWU6ICJjbGljayIsCiAgICAgICAgdGFyZ2V0OiB0aGlzLl9zY2hlZHVsZUVsCiAgICAgIH0pLCB0aGlzLmhpZGUoKSk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25DbGlja0RlbGV0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBhLmNsYXNzbmFtZSgicG9wdXAtZGVsZXRlIik7CiAgICAgIChzLmhhc0NsYXNzKGUsIHQpIHx8IHMuY2xvc2VzdChlLCAiLiIgKyB0KSkgJiYgKHRoaXMuZmlyZSgiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IHRoaXMuX3NjaGVkdWxlCiAgICAgIH0pLCB0aGlzLmhpZGUoKSk7CiAgICB9LCB1LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMubGF5ZXIsCiAgICAgICAgICBuID0gdGhpczsKICAgICAgdC5zZXRDb250ZW50KGMoewogICAgICAgIHNjaGVkdWxlOiBlLnNjaGVkdWxlLAogICAgICAgIGNhbGVuZGFyOiBlLmNhbGVuZGFyCiAgICAgIH0pKSwgdC5zaG93KCksIHRoaXMuX3NldFBvcHVwUG9zaXRpb25BbmRBcnJvd0RpcmVjdGlvbihlLmV2ZW50KSwgdGhpcy5fc2NoZWR1bGUgPSBlLnNjaGVkdWxlLCB0aGlzLl9jYWxlbmRhciA9IGUuY2FsZW5kYXIsIGkuZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICAgIHIub24oZG9jdW1lbnQuYm9keSwgIm1vdXNlZG93biIsIG4uX29uTW91c2VEb3duLCBuKTsKICAgICAgfSkoKTsKICAgIH0sIHUucHJvdG90eXBlLl9zZXRQb3B1cFBvc2l0aW9uQW5kQXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBzLmZpbmQoYS5jbGFzc25hbWUoIi5wb3B1cCIpLCB0aGlzLmxheWVyLmNvbnRhaW5lciksCiAgICAgICAgICBsID0gewogICAgICAgIHdpZHRoOiBuLm9mZnNldFdpZHRoLAogICAgICAgIGhlaWdodDogbi5vZmZzZXRIZWlnaHQKICAgICAgfSwKICAgICAgICAgIG8gPSB0aGlzLmNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwKICAgICAgICAgIGkgPSByLmdldEV2ZW50VGFyZ2V0KGUpLAogICAgICAgICAgYyA9IHMuY2xvc2VzdChpLCBhLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKSB8fCBzLmNsb3Nlc3QoaSwgYS5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlIikpIHx8IGksCiAgICAgICAgICB1ID0gYy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgdGhpcy5fc2NoZWR1bGVFbCA9IGMsIHQgPSB0aGlzLl9jYWxjUmVuZGVyaW5nRGF0YShsLCBvLCB1KSwgdGhpcy5sYXllci5zZXRQb3NpdGlvbih0LngsIHQueSksIHRoaXMuX3NldEFycm93RGlyZWN0aW9uKHQuYXJyb3cpOwogICAgfSwgdS5wcm90b3R5cGUuX2dldFlBbmRBcnJvd1RvcCA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsLCBvKSB7CiAgICAgIHZhciBpLCBhLCByOwogICAgICByZXR1cm4gKGEgPSAoaSA9ICgoZSA9IGUgPCAwID8gMCA6IGUpICsgdCkgLyAyKSAtIG4gLyAyKSA8IGwgPyAoYSA9IDAsIHIgPSBpIC0gbCAtIDgpIDogYSArIG4gPiBvID8gciA9IGkgLSAoYSA9IE1hdGgubWF4KG8gLSBuIC0gbCwgMCkpIC0gbCAtIDggOiBhIC09IGwsIChyIDwgMCB8fCByID4gbikgJiYgKHIgPSBudWxsKSwgewogICAgICAgIHk6IGEsCiAgICAgICAgYXJyb3dUb3A6IHIKICAgICAgfTsKICAgIH0sIHUucHJvdG90eXBlLl9nZXRYQW5kQXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCwgbykgewogICAgICB2YXIgaSA9ICJhcnJvdy1sZWZ0IiwKICAgICAgICAgIGEgPSB0OwogICAgICByZXR1cm4gYSArIG4gPiBvID8gKGkgPSAiYXJyb3ctcmlnaHQiLCBhID0gZSAtIG4gLSA0KSA6IGEgKz0gNCwgYSA8IGwgPyBhID0gMCA6IGEgLT0gbCwgewogICAgICAgIHg6IGEsCiAgICAgICAgYXJyb3dEaXJlY3Rpb246IGkKICAgICAgfTsKICAgIH0sIHUucHJvdG90eXBlLl9jYWxjUmVuZGVyaW5nRGF0YSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsID0gdGhpcy5fZ2V0WUFuZEFycm93VG9wKG4udG9wLCBuLmJvdHRvbSwgZS5oZWlnaHQsIHQudG9wLCB0LmJvdHRvbSksCiAgICAgICAgICBvID0gdGhpcy5fZ2V0WEFuZEFycm93RGlyZWN0aW9uKG4ubGVmdCwgbi5yaWdodCwgZS53aWR0aCwgdC5sZWZ0LCB0LnJpZ2h0KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgeDogby54LAogICAgICAgIHk6IGwueSwKICAgICAgICBhcnJvdzogewogICAgICAgICAgZGlyZWN0aW9uOiBvLmFycm93RGlyZWN0aW9uLAogICAgICAgICAgcG9zaXRpb246IGwuYXJyb3dUb3AKICAgICAgICB9CiAgICAgIH07CiAgICB9LCB1LnByb3RvdHlwZS5fc2V0QXJyb3dEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUuZGlyZWN0aW9uIHx8ICJhcnJvdy1sZWZ0IiwKICAgICAgICAgIG4gPSBzLmZpbmQoYS5jbGFzc25hbWUoIi5wb3B1cC1hcnJvdyIpLCB0aGlzLmxheWVyLmNvbnRhaW5lciksCiAgICAgICAgICBsID0gcy5maW5kKGEuY2xhc3NuYW1lKCIucG9wdXAtYXJyb3ctYm9yZGVyIiksIG4pOwogICAgICB0ICE9PSBhLmNsYXNzbmFtZSgiYXJyb3ctbGVmdCIpICYmIChzLnJlbW92ZUNsYXNzKG4sIGEuY2xhc3NuYW1lKCJhcnJvdy1sZWZ0IikpLCBzLmFkZENsYXNzKG4sIGEuY2xhc3NuYW1lKHQpKSksIGUucG9zaXRpb24gJiYgKGwuc3R5bGUudG9wID0gZS5wb3NpdGlvbiArICJweCIpOwogICAgfSwgdS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5sYXllci5oaWRlKCksIHRoaXMuZ3VpZGUgJiYgKHRoaXMuZ3VpZGUuY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy5ndWlkZSA9IG51bGwpLCByLm9mZihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpOwogICAgfSwgdS5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fdmlld01vZGVsICYmIHRoaXMubGF5ZXIuc2V0Q29udGVudCh0aGlzLnRtcGwodGhpcy5fdmlld01vZGVsKSk7CiAgICB9LCBlLmV4cG9ydHMgPSB1OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDUpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDE3KSwKICAgICAgICBzID0gbig4NCksCiAgICAgICAgYyA9IG4oNCkuRGF0ZTsKCiAgICBmdW5jdGlvbiB1KGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudmlldyA9IHQsIHRoaXMuY29udHJvbGxlciA9IG4sIHRoaXMuX2RyYWdTdGFydCA9IG51bGwsIGUub24oewogICAgICAgIGRyYWdTdGFydDogdGhpcy5fb25EcmFnU3RhcnQKICAgICAgfSwgdGhpcyksIHRoaXMuZ3VpZGUgPSBuZXcgcyh0aGlzKTsKICAgIH0KCiAgICB1LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmd1aWRlLmRlc3Ryb3koKSwgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLnZpZXcgPSB0aGlzLmNvbnRyb2xsZXIgPSB0aGlzLmd1aWRlID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIH0sIHUucHJvdG90eXBlLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBpID0gYS5nZXRDbGFzcyhlKTsKICAgICAgcmV0dXJuICF+aS5pbmRleE9mKG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUiKSkgJiYgISEodCA9IGEuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXkiKSkpICYmICEoIShuID0gKGkgPSBhLmdldENsYXNzKHQpKS5tYXRjaChvLmRheWdyaWQuZ2V0Vmlld0lEUmVnRXhwKSkgfHwgbi5sZW5ndGggPCAyKSAmJiBsLnBpY2sodGhpcy52aWV3LmNoaWxkcmVuLml0ZW1zLCBuWzFdKTsKICAgIH0sIHUucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGksCiAgICAgICAgICByLAogICAgICAgICAgcywKICAgICAgICAgIGMgPSBlLnRhcmdldCwKICAgICAgICAgIHUgPSB0aGlzLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24oYyksCiAgICAgICAgICBkID0gdGhpcy5jb250cm9sbGVyOwogICAgICB1ICYmICh0ID0gYS5jbG9zZXN0KGMsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpLCAhMCkpICYmIChuID0gYS5nZXREYXRhKHQsICJpZCIpLCAoaSA9IGQuc2NoZWR1bGVzLml0ZW1zW25dKSAmJiAoaS5pc1JlYWRPbmx5IHx8IChyID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0aGlzLnZpZXcsIGUub3JpZ2luRXZlbnQpLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSByLCBzID0gdGhpcy5fZHJhZ1N0YXJ0ID0gcihlLm9yaWdpbkV2ZW50KSwgbC5leHRlbmQocywgewogICAgICAgIHNjaGVkdWxlQmxvY2tFbGVtZW50OiB0LAogICAgICAgIG1vZGVsOiBpCiAgICAgIH0pLCB0aGlzLmRyYWdIYW5kbGVyLm9uKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kLAogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpLCB0aGlzLmZpcmUoImRyYWdzdGFydCIsIHMpKSkpOwogICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jOwogICAgICB0ICYmIHRoaXMuZmlyZSgiZHJhZyIsIHQoZS5vcmlnaW5FdmVudCkpOwogICAgfSwgdS5wcm90b3R5cGUuX3VwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLnRhcmdldE1vZGVsLAogICAgICAgICAgbiA9IGUueEluZGV4IC0gZS5kcmFnU3RhcnRYSW5kZXgsCiAgICAgICAgICBsID0gbmV3IGModC5zdGFydCksCiAgICAgICAgICBvID0gbmV3IGModC5lbmQpOwogICAgICBsID0gbC5hZGREYXRlKG4pLCBvID0gby5hZGREYXRlKG4pLCB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiB0LAogICAgICAgIGNoYW5nZXM6IHsKICAgICAgICAgIHN0YXJ0OiBsLAogICAgICAgICAgZW5kOiBvCiAgICAgICAgfSwKICAgICAgICBzdGFydDogbCwKICAgICAgICBlbmQ6IG8KICAgICAgfSk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBpID0gdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jLAogICAgICAgICAgYSA9IHRoaXMuX2RyYWdTdGFydDsKICAgICAgaSAmJiBhICYmICh0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgbyA9IGkoZS5vcmlnaW5FdmVudCksIGwuZXh0ZW5kKG8sIHsKICAgICAgICB0YXJnZXRNb2RlbDogYS5tb2RlbAogICAgICB9KSwgbiB8fCB0aGlzLl91cGRhdGVTY2hlZHVsZShvKSwgdGhpcy5maXJlKHQgfHwgImRyYWdlbmQiLCBvKSwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbCk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX29uRHJhZ0VuZChlLCAiY2xpY2siLCAhMCk7CiAgICB9LCBpLm1peGluKHIsIHUpLCBsLkN1c3RvbUV2ZW50cy5taXhpbih1KSwgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBuKDEwNiksCiAgICAgICAgYyA9IE1hdGgubWF4LAogICAgICAgIHUgPSBNYXRoLm1pbiwKICAgICAgICBkID0gTWF0aC5hYnMsCiAgICAgICAgaCA9IE1hdGguZmxvb3I7CgogICAgZnVuY3Rpb24gcChlLCB0KSB7CiAgICAgIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICB0b3A6IDAsCiAgICAgICAgaGVpZ2h0OiAiMjBweCIsCiAgICAgICAgYmdDb2xvcjogIiNmN2NhODgiLAogICAgICAgIGxhYmVsOiAiTmV3IGV2ZW50IiwKICAgICAgICBpc1Jlc2l6ZU1vZGU6ICExLAogICAgICAgIGlzQ3JlYXRpb25Nb2RlOiAhMSwKICAgICAgICBzdHlsZXM6IHRoaXMuX2dldFN0eWxlcyh0LmNvbnRyb2xsZXIudGhlbWUpCiAgICAgIH0sIGUpLCB0aGlzLnZpZXcgPSB0LCB0aGlzLndlZWtzID0gdC5jaGlsZHJlbi5zb3J0KGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGwuc3RhbXAoZSkgLSBsLnN0YW1wKHQpOwogICAgICB9KSwgdGhpcy5kYXlzID0gdC5jaGlsZHJlbi5zaW5nbGUoKS5nZXRSZW5kZXJEYXRlUmFuZ2UoKS5sZW5ndGgsIHRoaXMuc3RhcnRDb29yZCA9IFswLCAwXSwgdGhpcy5ndWlkZUVsZW1lbnRzID0ge30sIHRoaXMuZ3JpZHMgPSB0LmdyaWRzOwogICAgfQoKICAgIHAucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuY2xlYXIoKSwgdGhpcy5vcHRpb25zID0gdGhpcy52aWV3ID0gdGhpcy53ZWVrcyA9IHRoaXMuZGF5cyA9IHRoaXMuc3RhcnRDb29yZCA9IHRoaXMuZ3VpZGVFbGVtZW50cyA9IG51bGw7CiAgICB9LCBwLnByb3RvdHlwZS5jbGVhckd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kZXN0cm95KCk7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0UmF0aW9WYWx1ZUluV2VlayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiAodGhpcy5ncmlkc1tlXSB8fCB7CiAgICAgICAgbGVmdDogMTAwCiAgICAgIH0pLmxlZnQ7CiAgICB9LCBwLnByb3RvdHlwZS5fY3JlYXRlR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICByZXR1cm4gZS5pbm5lckhUTUwgPSBzKHRoaXMub3B0aW9ucyksIGUuZmlyc3RDaGlsZDsKICAgIH0sIHAucHJvdG90eXBlLl9nZXRHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ3VpZGVFbGVtZW50cywKICAgICAgICAgIG4gPSB0W2VdLAogICAgICAgICAgbCA9IHRoaXMud2Vla3NbZV07CiAgICAgIHJldHVybiBsID8gKG4gfHwgKG4gPSB0aGlzLl9jcmVhdGVHdWlkZUVsZW1lbnQoKSwgbC5jb250YWluZXIuYXBwZW5kQ2hpbGQobiksIHRbZV0gPSBuKSwgbikgOiBudWxsOwogICAgfSwgcC5wcm90b3R5cGUuX2dldENvb3JkQnlEYXRlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZm9yICh2YXIgdCA9IHRoaXMud2Vla3MsIG4gPSBsLnBpY2sodGhpcy52aWV3LCAib3B0aW9ucyIsICJ3b3Jrd2VlayIpID8gdGhpcy5kYXlzICsgMiA6IHRoaXMuZGF5cywgbyA9IGZ1bmN0aW9uIG8oZSwgdCkgewogICAgICAgIHJldHVybiBoKGEubWlsbGlzZWNvbmRzVG8oImRheSIsIGQodCAtIGUpKSk7CiAgICAgIH0sIGkgPSBhLnN0YXJ0KHRbMF0ub3B0aW9ucy5yZW5kZXJTdGFydERhdGUpLCBzID0gZSA8IGksIGMgPSBuZXcgcihpKSwgdSA9IG5ldyByKGkpLmFkZERhdGUocyA/IC1uIDogbikuYWRkRGF0ZSgtMSksIHAgPSBvKGUsIGMpLCBtID0gMDsgIWEuaXNCZXR3ZWVuV2l0aERhdGUoZSwgYywgdSk7KSB7CiAgICAgICAgYy5hZGREYXRlKHMgPyAtbiA6IG4pLCB1ID0gbmV3IHIoYykuYWRkRGF0ZShuIC0gMSksIHAgPSBvKGUsIGMpLCBtICs9IHMgPyAtMSA6IDE7CiAgICAgIH0KCiAgICAgIHJldHVybiBbcCwgbV07CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0TGltaXRlZENvb3JkID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwsCiAgICAgICAgICBvID0gZVswXSwKICAgICAgICAgIGkgPSBlWzFdOwogICAgICByZXR1cm4gdCA9IHQgfHwgWzAsIDBdLCBuID0gbiB8fCBbdGhpcy5kYXlzIC0gMSwgdGhpcy53ZWVrcy5sZW5ndGggLSAxXSwgaSA8IHRbMV0gPyBsID0gdC5zbGljZSgwKSA6IGkgPiBuWzFdID8gbCA9IG4uc2xpY2UoMCkgOiAobyA9IGModFswXSwgbyksIGwgPSBbbyA9IHUoblswXSwgbyksIGldKSwgbDsKICAgIH0sIHAucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbyA9IGUudGFyZ2V0LAogICAgICAgICAgaSA9IGUubW9kZWwsCiAgICAgICAgICBzID0gZS54LAogICAgICAgICAgYyA9IGUueSwKICAgICAgICAgIHUgPSBuZXcgcih0aGlzLnZpZXcub3B0aW9ucy5yZW5kZXJNb250aCk7CiAgICAgIG4uaXNDcmVhdGlvbk1vZGUgPyBpICYmICFhLmlzU2FtZU1vbnRoKHUsIGkuc3RhcnQpICYmIChpLnN0YXJ0LnNldE1vbnRoKHUuZ2V0TW9udGgoKSksIGkuc3RhcnQuc2V0RGF0ZSgxKSwgaS5lbmQuc2V0TW9udGgodS5nZXRNb250aCgpKSwgaS5lbmQuc2V0RGF0ZSgxKSkgOiAocyA9ICh0ID0gdGhpcy5fZ2V0Q29vcmRCeURhdGUoaS5nZXRTdGFydHMoKSkpWzBdLCBjID0gdFsxXSwgbC5leHRlbmQodGhpcy5vcHRpb25zLCB7CiAgICAgICAgdG9wOiBwYXJzZUludChvLnN0eWxlLnRvcCwgMTApICsgInB4IiwKICAgICAgICBoZWlnaHQ6IHBhcnNlSW50KG8uc3R5bGUuaGVpZ2h0LCAxMCkgKyAicHgiLAogICAgICAgIGxhYmVsOiBpLnRpdGxlCiAgICAgIH0sIGkpKSwgKGwuaXNVbmRlZmluZWQocykgfHwgbC5pc1VuZGVmaW5lZChjKSkgJiYgKHMgPSAodCA9IHRoaXMuX2dldENvb3JkQnlEYXRlKGkuZ2V0U3RhcnRzKCkpKVswXSwgYyA9IHRbMV0pLCB0aGlzLnN0YXJ0Q29vcmQgPSBbcywgY10sIHRoaXMudXBkYXRlKHMsIGMpOwogICAgfSwgcC5wcm90b3R5cGUuX3VwZGF0ZUd1aWRlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gZS5ndWlkZSwKICAgICAgICAgICAgbiA9IG8uY2xhc3NuYW1lKCJtb250aC1leGNlZWQtbGVmdCIpLAogICAgICAgICAgICBsID0gby5jbGFzc25hbWUoIm1vbnRoLWV4Y2VlZC1yaWdodCIpOwogICAgICAgIHQuc3R5bGUuZGlzcGxheSA9ICJibG9jayIsIHQuc3R5bGUubGVmdCA9IGUubGVmdCArICIlIiwgdC5zdHlsZS53aWR0aCA9IGUud2lkdGggKyAiJSIsIGUuZXhjZWVkTCA/IGkuYWRkQ2xhc3ModCwgbikgOiBpLnJlbW92ZUNsYXNzKHQsIG4pLCBlLmV4Y2VlZFIgPyBpLmFkZENsYXNzKHQsIGwpIDogaS5yZW1vdmVDbGFzcyh0LCBsKTsKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0T3JpZ2luSW5kaWNhdGUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBvID0gdShlWzBdLCB0WzBdKSwKICAgICAgICAgIGkgPSBjKGVbMF0sIHRbMF0pICsgMTsKICAgICAgcmV0dXJuIHRbMV0gPiBlWzFdID8gKG8gPSBlWzBdLCBpID0gdGhpcy5kYXlzLCBsID0gITApIDogdFsxXSA8IGVbMV0gJiYgKG8gPSAwLCBpID0gZVswXSArIDEsIG4gPSAhMCksIHsKICAgICAgICBsZWZ0OiB0aGlzLl9nZXRSYXRpb1ZhbHVlSW5XZWVrKG8pLAogICAgICAgIHdpZHRoOiB0aGlzLl9nZXRSYXRpb1ZhbHVlSW5XZWVrKGkpIC0gdGhpcy5fZ2V0UmF0aW9WYWx1ZUluV2VlayhvKSwKICAgICAgICBleGNlZWRMOiBuLAogICAgICAgIGV4Y2VlZFI6IGwKICAgICAgfTsKICAgIH0sIHAucHJvdG90eXBlLl9nZXRNb3VzZUluZGljYXRlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbyA9IHRbMF0sCiAgICAgICAgICBpID0gdFswXSArIDE7CiAgICAgIHJldHVybiB0WzFdID4gZVsxXSA/IChvID0gMCwgbiA9ICEwKSA6IHRbMV0gPCBlWzFdICYmIChpID0gdGhpcy5kYXlzLCBsID0gITApLCB7CiAgICAgICAgbGVmdDogdGhpcy5fZ2V0UmF0aW9WYWx1ZUluV2VlayhvKSwKICAgICAgICB3aWR0aDogdGhpcy5fZ2V0UmF0aW9WYWx1ZUluV2VlayhpKSAtIHRoaXMuX2dldFJhdGlvVmFsdWVJbldlZWsobyksCiAgICAgICAgZXhjZWVkTDogbiwKICAgICAgICBleGNlZWRSOiBsCiAgICAgIH07CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0Q29udGFpbkluZGljYXRlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gewogICAgICAgIGxlZnQ6IDAsCiAgICAgICAgd2lkdGg6IDEwMCwKICAgICAgICBleGNlZWRMOiAhMCwKICAgICAgICBleGNlZWRSOiAhMAogICAgICB9OwogICAgfSwgcC5wcm90b3R5cGUuX3JlbW92ZUd1aWRlRWxlbWVudHMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ3VpZGVFbGVtZW50czsKICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaS5yZW1vdmUodFtlXSksIGRlbGV0ZSB0W2VdOwogICAgICB9KTsKICAgIH0sIHAucHJvdG90eXBlLl9nZXRFeGNsdWRlc0luUmFuZ2UgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHUuYXBwbHkobnVsbCwgZSksCiAgICAgICAgICBvID0gYy5hcHBseShudWxsLCBlKSwKICAgICAgICAgIGkgPSBbXTsKICAgICAgcmV0dXJuIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAoZSkgewogICAgICAgICgoZSA9IHBhcnNlSW50KGUsIDEwKSkgPCBuIHx8IGUgPiBvKSAmJiBpLnB1c2goZSk7CiAgICAgIH0pLCBpOwogICAgfSwgcC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLAogICAgICAgICAgbyA9IHRoaXMuc3RhcnRDb29yZCwKICAgICAgICAgIGkgPSBbZSwgdF0sCiAgICAgICAgICBhID0gdGhpcy5vcHRpb25zLmlzUmVzaXplTW9kZSA/IHRoaXMuX2dldExpbWl0ZWRDb29yZChpLCBvKSA6IGksCiAgICAgICAgICByID0gbC5rZXlzKHRoaXMuZ3VpZGVFbGVtZW50cyksCiAgICAgICAgICBzID0gbC5yYW5nZSh1KG9bMV0sIGFbMV0pLCBjKG9bMV0sIGFbMV0pICsgMSksCiAgICAgICAgICBkID0gdGhpcy5fZ2V0RXhjbHVkZXNJblJhbmdlKHMsIHIpLAogICAgICAgICAgaCA9IHt9OwoKICAgICAgdGhpcy5fcmVtb3ZlR3VpZGVFbGVtZW50cyhkKSwgbC5mb3JFYWNoKHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIHIgPSBuLl9nZXRHdWlkZUVsZW1lbnQoZSk7CgogICAgICAgIHIgJiYgKHQgPSBlID09PSBvWzFdID8gbi5fZ2V0T3JpZ2luSW5kaWNhdGUobywgYSkgOiBlID09PSBpWzFdID8gbi5fZ2V0TW91c2VJbmRpY2F0ZShvLCBpKSA6IG4uX2dldENvbnRhaW5JbmRpY2F0ZSgpLCBoW2VdID0gbC5leHRlbmQoewogICAgICAgICAgZ3VpZGU6IHIKICAgICAgICB9LCB0KSk7CiAgICAgIH0pLCB0aGlzLl91cGRhdGVHdWlkZXMoaCk7CiAgICB9LCBwLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgbC5mb3JFYWNoKHRoaXMuZ3VpZGVFbGVtZW50cywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBpLnJlbW92ZShlKTsKICAgICAgfSksIHRoaXMuZ3VpZGVFbGVtZW50cyA9IHt9OwogICAgfSwgcC5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0ge307CiAgICAgIHJldHVybiBlICYmICh0LmJvcmRlciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYm9yZGVyLCB0LmJhY2tncm91bmRDb2xvciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYmFja2dyb3VuZENvbG9yLCB0LnNjaGVkdWxlSGVpZ2h0ID0gZS5tb250aC5zY2hlZHVsZS5oZWlnaHQsIHQuc2NoZWR1bGVHdXR0ZXIgPSBlLm1vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCwgdC5tYXJnaW5MZWZ0ID0gZS5tb250aC5zY2hlZHVsZS5tYXJnaW5MZWZ0LCB0Lm1hcmdpblJpZ2h0ID0gZS5tb250aC5zY2hlZHVsZS5tYXJnaW5SaWdodCwgdC5ib3JkZXJSYWRpdXMgPSBlLm1vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cyksIHQ7CiAgICB9LCBlLmV4cG9ydHMgPSBwOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsID0gbigwKSwKICAgICAgICAgIG8gPSBuKDM3KTsKICAgICAgbigxMTQpLCBuKDExNSksIHQualF1ZXJ5ICYmICh0LmpRdWVyeS5mbi50dWlDYWxlbmRhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgaSA9IHRoaXMuZ2V0KDApLAogICAgICAgICAgICBhID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGFyZ3VtZW50cyk7CiAgICAgICAgaWYgKGkpIGlmIChlID0gbC5waWNrKGEsIDApIHx8IHt9LCBuID0gdC5qUXVlcnkuZGF0YShpLCAidHVpQ2FsZW5kYXIiKSkgewogICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlICYmIG5bZV0pIHJldHVybiBuW2VdLmFwcGx5KG4sIGEuc2xpY2UoMSkpOwogICAgICAgIH0gZWxzZSBuID0gbmV3IG8oaSwgZSksIHQualF1ZXJ5LmRhdGEoaSwgInR1aUNhbGVuZGFyIiwgbik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0pLCBlLmV4cG9ydHMgPSBvOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyMCksCiAgICAgICAgaSA9IG4oMjYpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDUyKSwKICAgICAgICBzID0gbigyNyksCiAgICAgICAgYyA9IG4oNTMpLAogICAgICAgIHUgPSBuKDYzKSwKICAgICAgICBkID0gbig5NyksCiAgICAgICAgaCA9IG4oNCkuRGF0ZSwKICAgICAgICBwID0gbigyKSwKICAgICAgICBtID0gbig0KSwKICAgICAgICBmID0gbigxMSksCiAgICAgICAgZyA9IE1hdGgubWluOwoKICAgIGZ1bmN0aW9uIHkoZSwgdCkgewogICAgICAhMCA9PT0gKHQgPSBsLmV4dGVuZCh7CiAgICAgICAgdXNhZ2VTdGF0aXN0aWNzOiAhMAogICAgICB9LCB0KSkudXNhZ2VTdGF0aXN0aWNzICYmIGwuc2VuZEhvc3RuYW1lICYmIGwuc2VuZEhvc3RuYW1lKCJjYWxlbmRhciIsICJVQS0xMjk5NTE2OTktMSIpLCBsLmlzU3RyaW5nKGUpICYmIChlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlKSksIHRoaXMuX2NhbGVuZGFyQ29sb3IgPSB7fSwgdGhpcy5fcmVuZGVyRGF0ZSA9IGEuc3RhcnQoKSwgdGhpcy5fcmVuZGVyUmFuZ2UgPSB7CiAgICAgICAgc3RhcnQ6IG51bGwsCiAgICAgICAgZW5kOiBudWxsCiAgICAgIH0sIHRoaXMuX2NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBjKGUpOwogICAgICB9KHQpLCB0aGlzLl9jb250cm9sbGVyLnNldENhbGVuZGFycyh0LmNhbGVuZGFycyksIHRoaXMuX2xheW91dCA9IG5ldyByKGUsIHRoaXMuX2NvbnRyb2xsZXIudGhlbWUpLCB0aGlzLl9kcmFnSGFuZGxlciA9IG5ldyBzKHsKICAgICAgICBkaXN0YW5jZTogMTAKICAgICAgfSwgdGhpcy5fbGF5b3V0LmNvbnRhaW5lciksIHRoaXMuX3ZpZXdOYW1lID0gdC5kZWZhdWx0VmlldyB8fCAid2VlayIsIHRoaXMuX3JlZnJlc2hNZXRob2QgPSBudWxsLCB0aGlzLl9zY3JvbGxUb05vd01ldGhvZCA9IG51bGwsIHRoaXMuX3JlcXVlc3RTY3JvbGxUb05vdyA9ICExLCB0aGlzLl9vcGVuQ3JlYXRpb25Qb3B1cCA9IG51bGwsIHRoaXMuX2hpZGVNb3JlVmlldyA9IG51bGwsIHRoaXMuX3JlcXVlc3RSZW5kZXIgPSAwLCB0aGlzLl9vcHRpb25zID0ge30sIHRoaXMuX2luaXRpYWxpemUodCk7CiAgICB9CgogICAgZnVuY3Rpb24gUyhlLCB0KSB7CiAgICAgIGUucmVjdXJzaXZlKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4gPSBlLm9wdGlvbnM7CiAgICAgICAgbiAmJiB0KGUsIG4pOwogICAgICB9KTsKICAgIH0KCiAgICB5LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9kcmFnSGFuZGxlci5kZXN0cm95KCksIHRoaXMuX2NvbnRyb2xsZXIub2ZmKCksIHRoaXMuX2xheW91dC5jbGVhcigpLCB0aGlzLl9sYXlvdXQuZGVzdHJveSgpLCBsLmZvckVhY2godGhpcy5fb3B0aW9ucy50ZW1wbGF0ZSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBlICYmIG8udW5yZWdpc3RlckhlbHBlcih0ICsgIi10bXBsIik7CiAgICAgIH0pLCB0aGlzLl9vcHRpb25zID0gdGhpcy5fcmVuZGVyRGF0ZSA9IHRoaXMuX2NvbnRyb2xsZXIgPSB0aGlzLl9sYXlvdXQgPSB0aGlzLl9kcmFnSGFuZGxlciA9IHRoaXMuX3ZpZXdOYW1lID0gdGhpcy5fcmVmcmVzaE1ldGhvZCA9IHRoaXMuX3Njcm9sbFRvTm93TWV0aG9kID0gbnVsbDsKICAgIH0sIHkucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9jb250cm9sbGVyLAogICAgICAgICAgbiA9IHRoaXMuX3ZpZXdOYW1lOwogICAgICB0aGlzLl9vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRWaWV3OiBuLAogICAgICAgIHRhc2tWaWV3OiAhMCwKICAgICAgICBzY2hlZHVsZVZpZXc6ICEwLAogICAgICAgIHRlbXBsYXRlOiBsLmV4dGVuZCh7CiAgICAgICAgICBhbGxkYXk6IG51bGwsCiAgICAgICAgICB0aW1lOiBudWxsCiAgICAgICAgfSwgbC5waWNrKGUsICJ0ZW1wbGF0ZSIpIHx8IHt9KSwKICAgICAgICB3ZWVrOiBsLmV4dGVuZCh7fSwgbC5waWNrKGUsICJ3ZWVrIikgfHwge30pLAogICAgICAgIG1vbnRoOiBsLmV4dGVuZCh7fSwgbC5waWNrKGUsICJtb250aCIpIHx8IHt9KSwKICAgICAgICBjYWxlbmRhcnM6IFtdLAogICAgICAgIHVzZUNyZWF0aW9uUG9wdXA6ICExLAogICAgICAgIHVzZURldGFpbFBvcHVwOiAhMSwKICAgICAgICB0aW1lem9uZXM6IGUudGltZXpvbmVzIHx8IFtdLAogICAgICAgIGRpc2FibGVEYmxDbGljazogITEsCiAgICAgICAgZGlzYWJsZUNsaWNrOiAhMSwKICAgICAgICBpc1JlYWRPbmx5OiAhMQogICAgICB9LCBlKSwgdGhpcy5fb3B0aW9ucy53ZWVrID0gbC5leHRlbmQoewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAwLAogICAgICAgIHdvcmt3ZWVrOiAhMQogICAgICB9LCBsLnBpY2sodGhpcy5fb3B0aW9ucywgIndlZWsiKSB8fCB7fSksIHRoaXMuX29wdGlvbnMubW9udGggPSBsLmV4dGVuZCh7CiAgICAgICAgc3RhcnREYXlPZldlZWs6IDAsCiAgICAgICAgd29ya3dlZWs6ICExLAogICAgICAgIHNjaGVkdWxlRmlsdGVyOiBmdW5jdGlvbiBzY2hlZHVsZUZpbHRlcihlKSB7CiAgICAgICAgICByZXR1cm4gQm9vbGVhbihlLmlzVmlzaWJsZSkgJiYgKCJhbGxkYXkiID09PSBlLmNhdGVnb3J5IHx8ICJ0aW1lIiA9PT0gZS5jYXRlZ29yeSk7CiAgICAgICAgfQogICAgICB9LCBsLnBpY2soZSwgIm1vbnRoIikgfHwge30pLCB0aGlzLl9vcHRpb25zLmlzUmVhZE9ubHkgJiYgKHRoaXMuX29wdGlvbnMudXNlQ3JlYXRpb25Qb3B1cCA9ICExKSwgdGhpcy5fbGF5b3V0LmNvbnRyb2xsZXIgPSB0LCB0aGlzLl9zZXRBZGRpdGlvbmFsSW50ZXJuYWxPcHRpb25zKGUpLCB0aGlzLmNoYW5nZVZpZXcobiwgITApOwogICAgfSwgeS5wcm90b3R5cGUuX3NldEFkZGl0aW9uYWxJbnRlcm5hbE9wdGlvbnMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUudGltZXpvbmVzIHx8IFtdOwogICAgICBsLmZvckVhY2goZS50ZW1wbGF0ZSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBlICYmIG8ucmVnaXN0ZXJIZWxwZXIodCArICItdG1wbCIsIGUpOwogICAgICB9KSwgbC5mb3JFYWNoKGUuY2FsZW5kYXJzIHx8IFtdLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHRoaXMuc2V0Q2FsZW5kYXJDb2xvcihlLmlkLCBlLCAhMCk7CiAgICAgIH0sIHRoaXMpLCB0Lmxlbmd0aCAmJiBtLnNldE9mZnNldEJ5VGltZXpvbmVPcHRpb24odFswXS50aW1lem9uZU9mZnNldCk7CiAgICB9LCB5LnByb3RvdHlwZS5jcmVhdGVTY2hlZHVsZXMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLl9zZXRTY2hlZHVsZUNvbG9yKGUuY2FsZW5kYXJJZCwgZSk7CiAgICAgIH0sIHRoaXMpLCB0aGlzLl9jb250cm9sbGVyLmNyZWF0ZVNjaGVkdWxlcyhlLCB0KSwgdCB8fCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUuZ2V0U2NoZWR1bGUgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICByZXR1cm4gdGhpcy5fY29udHJvbGxlci5zY2hlZHVsZXMuc2luZ2xlKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgcmV0dXJuIG4uaWQgPT09IGUgJiYgbi5jYWxlbmRhcklkID09PSB0OwogICAgICB9KTsKICAgIH0sIHkucHJvdG90eXBlLnVwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQsIG4sIGwpIHsKICAgICAgdmFyIG8gPSB0aGlzLl9jb250cm9sbGVyLAogICAgICAgICAgaSA9IG8uc2NoZWR1bGVzLnNpbmdsZShmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBuLmlkID09PSBlICYmIG4uY2FsZW5kYXJJZCA9PT0gdDsKICAgICAgfSk7CiAgICAgIG4gJiYgaSAmJiAobiA9IHRoaXMuX2hhc0NoYW5nZWRDYWxlbmRhcihpLCBuKSA/IHRoaXMuX3NldFNjaGVkdWxlQ29sb3Iobi5jYWxlbmRhcklkLCBuKSA6IG4sIG8udXBkYXRlU2NoZWR1bGUoaSwgbiksIGwgfHwgdGhpcy5yZW5kZXIoKSk7CiAgICB9LCB5LnByb3RvdHlwZS5faGFzQ2hhbmdlZENhbGVuZGFyID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIGUgJiYgdC5jYWxlbmRhcklkICYmIGUuY2FsZW5kYXJJZCAhPT0gdC5jYWxlbmRhcklkOwogICAgfSwgeS5wcm90b3R5cGUuX3NldFNjaGVkdWxlQ29sb3IgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHRoaXMuX2NhbGVuZGFyQ29sb3JbZV07CiAgICAgIHJldHVybiBuICYmICh0LmNvbG9yID0gdC5jb2xvciB8fCBuLmNvbG9yLCB0LmJnQ29sb3IgPSB0LmJnQ29sb3IgfHwgbi5iZ0NvbG9yLCB0LmJvcmRlckNvbG9yID0gdC5ib3JkZXJDb2xvciB8fCBuLmJvcmRlckNvbG9yLCB0LmRyYWdCZ0NvbG9yID0gdC5kcmFnQmdDb2xvciB8fCBuLmRyYWdCZ0NvbG9yKSwgdDsKICAgIH0sIHkucHJvdG90eXBlLmRlbGV0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwgPSB0aGlzLl9jb250cm9sbGVyLAogICAgICAgICAgbyA9IGwuc2NoZWR1bGVzLnNpbmdsZShmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBuLmlkID09PSBlICYmIG4uY2FsZW5kYXJJZCA9PT0gdDsKICAgICAgfSk7CiAgICAgIG8gJiYgKGwuZGVsZXRlU2NoZWR1bGUobyksIG4gfHwgdGhpcy5yZW5kZXIoKSk7CiAgICB9LCB5LnByb3RvdHlwZS5fZ2V0V2Vla0RheVJhbmdlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sIGksIHIsIHM7CiAgICAgIHJldHVybiB0ID0gdCB8fCAwLCBvID0gKGUgPSBsLmlzRGF0ZShlKSA/IGUgOiBuZXcgaChlKSkuZ2V0RGF5KCksIGkgPSBuZXcgaChlKS5hZGREYXRlKC1vICsgdCksIHIgPSBuZXcgaChpKS5hZGREYXRlKDYpLCBvIDwgdCAmJiAoaSA9IG5ldyBoKGkpLmFkZERhdGUoLTcpLCByID0gbmV3IGgocikuYWRkRGF0ZSgtNykpLCBuICYmIChzID0gYS5yYW5nZShhLnN0YXJ0KGkpLCBhLmVuZChyKSwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSksIGkgPSAocyA9IGwuZmlsdGVyKHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICFhLmlzV2Vla2VuZChlLmdldERheSgpKTsKICAgICAgfSkpWzBdLCByID0gc1tzLmxlbmd0aCAtIDFdKSwgW2kgPSBhLnN0YXJ0KGkpLCByID0gYS5zdGFydChyKV07CiAgICB9LCB5LnByb3RvdHlwZS50b2dnbGVTY2hlZHVsZXMgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IHRoaXMuX2NvbnRyb2xsZXIuc2NoZWR1bGVzOwogICAgICBuID0gIWwuaXNFeGlzdHkobikgfHwgbiwgZSA9IGwuaXNBcnJheShlKSA/IGUgOiBbZV0sIG8uZWFjaChmdW5jdGlvbiAobikgewogICAgICAgIH5sLmluQXJyYXkobi5jYWxlbmRhcklkLCBlKSAmJiBuLnNldCgiaXNWaXNpYmxlIiwgIXQpOwogICAgICB9KSwgbiAmJiB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5fcmVxdWVzdFJlbmRlciAmJiBmLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9yZXF1ZXN0UmVuZGVyKSwgZSA/IHRoaXMuX3JlbmRlckZ1bmMoKSA6IHRoaXMuX3JlcXVlc3RSZW5kZXIgPSBmLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fcmVuZGVyRnVuYywgdGhpcyk7CiAgICB9LCB5LnByb3RvdHlwZS5fcmVuZGVyRnVuYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fcmVmcmVzaE1ldGhvZCAmJiB0aGlzLl9yZWZyZXNoTWV0aG9kKCksIHRoaXMuX2xheW91dCAmJiB0aGlzLl9sYXlvdXQucmVuZGVyKCksIHRoaXMuX3Njcm9sbFRvTm93TWV0aG9kICYmIHRoaXMuX3JlcXVlc3RTY3JvbGxUb05vdyAmJiB0aGlzLl9zY3JvbGxUb05vd01ldGhvZCgpLCB0aGlzLl9yZXF1ZXN0U2Nyb2xsVG9Ob3cgPSAhMSwgdGhpcy5fcmVxdWVzdFJlbmRlciA9IG51bGw7CiAgICB9LCB5LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX2NvbnRyb2xsZXIuY2xlYXJTY2hlZHVsZXMoKSwgdGhpcy5yZW5kZXIoZSk7CiAgICB9LCB5LnByb3RvdHlwZS5zY3JvbGxUb05vdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fc2Nyb2xsVG9Ob3dNZXRob2QgJiYgKHRoaXMuX3JlcXVlc3RTY3JvbGxUb05vdyA9ICEwKTsKICAgIH0sIHkucHJvdG90eXBlLnRvZGF5ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9yZW5kZXJEYXRlID0gYS5zdGFydCgpLCB0aGlzLl9zZXRWaWV3TmFtZSh0aGlzLl92aWV3TmFtZSksIHRoaXMubW92ZSgpLCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIG8sCiAgICAgICAgICByLAogICAgICAgICAgcywKICAgICAgICAgIGMsCiAgICAgICAgICB1LAogICAgICAgICAgZCwKICAgICAgICAgIHAgPSBpKGEuc3RhcnQodGhpcy5fcmVuZGVyRGF0ZSkpLAogICAgICAgICAgbSA9IHRoaXMuX3ZpZXdOYW1lLAogICAgICAgICAgZiA9IHRoaXMuX2dldEN1cnJlbnRWaWV3KCksCiAgICAgICAgICB5ID0gUzsKCiAgICAgIGUgPSBsLmlzRXhpc3R5KGUpID8gZSA6IDAsICJtb250aCIgPT09IG0gPyAociA9IGwucGljayh0aGlzLl9vcHRpb25zLCAibW9udGgiLCAic3RhcnREYXlPZldlZWsiKSB8fCAwLCBzID0gZyhsLnBpY2sodGhpcy5fb3B0aW9ucywgIm1vbnRoIiwgInZpc2libGVXZWVrc0NvdW50IikgfHwgMCwgNiksIGMgPSBsLnBpY2sodGhpcy5fb3B0aW9ucywgIm1vbnRoIiwgIndvcmt3ZWVrIikgfHwgITEsIHUgPSBsLnBpY2sodGhpcy5fb3B0aW9ucywgIm1vbnRoIiwgImlzQWx3YXlzNldlZWsiKSwgcyA/IChkID0gewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiByLAogICAgICAgIGlzQWx3YXlzNldlZWs6ICExLAogICAgICAgIHZpc2libGVXZWVrc0NvdW50OiBzLAogICAgICAgIHdvcmt3ZWVrOiBjCiAgICAgIH0sIHAuYWRkRGF0ZSg3ICogZSAqIGQudmlzaWJsZVdlZWtzQ291bnQpLCBvID0gYS5hcnIyZENhbGVuZGFyKHAuZCwgZCksIHkoZiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0LnJlbmRlck1vbnRoID0gbmV3IGgocC5kKTsKICAgICAgfSkpIDogKGQgPSB7CiAgICAgICAgc3RhcnREYXlPZldlZWs6IHIsCiAgICAgICAgaXNBbHdheXM2V2VlazogdSwKICAgICAgICB3b3Jrd2VlazogYwogICAgICB9LCBwLmFkZE1vbnRoKGUpLCBvID0gYS5hcnIyZENhbGVuZGFyKHAuZCwgZCksIHkoZiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB0LnJlbmRlck1vbnRoID0gbmV3IGgocC5kKTsKICAgICAgfSkpLCB0ID0gb1swXVswXSwgbiA9IG9bby5sZW5ndGggLSAxXVtvW28ubGVuZ3RoIC0gMV0ubGVuZ3RoIC0gMV0pIDogIndlZWsiID09PSBtID8gKHAuYWRkRGF0ZSg3ICogZSksIHIgPSBsLnBpY2sodGhpcy5fb3B0aW9ucywgIndlZWsiLCAic3RhcnREYXlPZldlZWsiKSB8fCAwLCBjID0gbC5waWNrKHRoaXMuX29wdGlvbnMsICJ3ZWVrIiwgIndvcmt3ZWVrIikgfHwgITEsIG8gPSB0aGlzLl9nZXRXZWVrRGF5UmFuZ2UocC5kLCByLCBjKSwgdCA9IG9bMF0sIG4gPSBvWzFdLCB5KGYsIGZ1bmN0aW9uIChlLCBsKSB7CiAgICAgICAgbC5yZW5kZXJTdGFydERhdGUgPSBuZXcgaCh0KSwgbC5yZW5kZXJFbmREYXRlID0gbmV3IGgobiksIGUuc2V0U3RhdGUoewogICAgICAgICAgY29sbGFwc2VkOiAhMAogICAgICAgIH0pOwogICAgICB9KSkgOiAiZGF5IiA9PT0gbSAmJiAocC5hZGREYXRlKGUpLCB0ID0gYS5zdGFydChwLmQpLCBuID0gYS5lbmQocC5kKSwgeShmLCBmdW5jdGlvbiAoZSwgbCkgewogICAgICAgIGwucmVuZGVyU3RhcnREYXRlID0gbmV3IGgodCksIGwucmVuZGVyRW5kRGF0ZSA9IG5ldyBoKG4pLCBlLnNldFN0YXRlKHsKICAgICAgICAgIGNvbGxhcHNlZDogITAKICAgICAgICB9KTsKICAgICAgfSkpLCB0aGlzLl9yZW5kZXJEYXRlID0gcC5kLCB0aGlzLl9yZW5kZXJSYW5nZSA9IHsKICAgICAgICBzdGFydDogdCwKICAgICAgICBlbmQ6IG4KICAgICAgfTsKICAgIH0sIHkucHJvdG90eXBlLnNldERhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICBsLmlzU3RyaW5nKGUpICYmIChlID0gYS5wYXJzZShlKSksIHRoaXMuX3JlbmRlckRhdGUgPSBuZXcgaChlKSwgdGhpcy5fc2V0Vmlld05hbWUodGhpcy5fdmlld05hbWUpLCB0aGlzLm1vdmUoMCksIHRoaXMucmVuZGVyKCk7CiAgICB9LCB5LnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLm1vdmUoMSksIHRoaXMucmVuZGVyKCk7CiAgICB9LCB5LnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLm1vdmUoLTEpLCB0aGlzLnJlbmRlcigpOwogICAgfSwgeS5wcm90b3R5cGUuX2dldEN1cnJlbnRWaWV3ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuX3ZpZXdOYW1lOwogICAgICByZXR1cm4gImRheSIgPT09IGUgJiYgKGUgPSAid2VlayIpLCBsLnBpY2sodGhpcy5fbGF5b3V0LmNoaWxkcmVuLml0ZW1zLCBlKTsKICAgIH0sIHkucHJvdG90eXBlLnNldENhbGVuZGFyQ29sb3IgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IHRoaXMuX2NhbGVuZGFyQ29sb3IsCiAgICAgICAgICBpID0gdGhpcy5fY29udHJvbGxlci5zY2hlZHVsZXMsCiAgICAgICAgICBhID0gb1tlXTsKICAgICAgbC5pc09iamVjdCh0KSB8fCBwLnRocm93RXJyb3IoIkNhbGVuZGFyI2NoYW5nZUNhbGVuZGFyQ29sb3IoKTogY29sb3Ig64qUIHtjb2xvcjogJycsIGJnQ29sb3I6ICcnfSDtmJXtg5zsl6zslbwg7ZWp64uI64ukLiIpLCBhID0gb1tlXSA9IGwuZXh0ZW5kKHsKICAgICAgICBjb2xvcjogIiMwMDAiLAogICAgICAgIGJnQ29sb3I6ICIjYTFiNTZjIiwKICAgICAgICBib3JkZXJDb2xvcjogIiNhMWI1NmMiLAogICAgICAgIGRyYWdCZ0NvbG9yOiAiI2ExYjU2YyIKICAgICAgfSwgdCksIGkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHQuY2FsZW5kYXJJZCA9PT0gZSAmJiAodC5jb2xvciA9IGEuY29sb3IsIHQuYmdDb2xvciA9IGEuYmdDb2xvciwgdC5ib3JkZXJDb2xvciA9IGEuYm9yZGVyQ29sb3IsIHQuZHJhZ0JnQ29sb3IgPSBhLmRyYWdCZ0NvbG9yKTsKICAgICAgfSksIG4gfHwgdGhpcy5yZW5kZXIoKTsKICAgIH0sIHkucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJjbGlja1NjaGVkdWxlIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25DbGlja01vcmUgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmZpcmUoImNsaWNrTW9yZSIsIGUpOwogICAgfSwgeS5wcm90b3R5cGUuX29uQ2xpY2tEYXluYW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJjbGlja0RheW5hbWUiLCBlKTsKICAgIH0sIHkucHJvdG90eXBlLl9vbkJlZm9yZUNyZWF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX29wdGlvbnMudXNlQ3JlYXRpb25Qb3B1cCAmJiAhZS51c2VDcmVhdGlvblBvcHVwICYmIHRoaXMuX3Nob3dDcmVhdGlvblBvcHVwID8gdGhpcy5fc2hvd0NyZWF0aW9uUG9wdXAoZSkgOiB0aGlzLmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25CZWZvcmVVcGRhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25CZWZvcmVEZWxldGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmZpcmUoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25BZnRlclJlbmRlclNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJhZnRlclJlbmRlclNjaGVkdWxlIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fb25DbGlja1RpbWV6b25lc0NvbGxhcHNlQnRuID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5maXJlKCJjbGlja1RpbWV6b25lc0NvbGxhcHNlQnRuIiwgZSk7CiAgICB9LCB5LnByb3RvdHlwZS5fdG9nZ2xlVmlld1NjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0aGlzLAogICAgICAgICAgbyA9IHQuaGFuZGxlciwKICAgICAgICAgIGkgPSBlID8gIm9uIiA6ICJvZmYiOwogICAgICBsLmZvckVhY2goby5jbGljaywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlW2ldKCJjbGlja1NjaGVkdWxlIiwgbi5fb25DbGljaywgbik7CiAgICAgIH0pLCBsLmZvckVhY2goby5kYXluYW1lLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGVbaV0oImNsaWNrRGF5bmFtZSIsIG4uX29uQ2xpY2tEYXluYW1lLCBuKTsKICAgICAgfSksIGwuZm9yRWFjaChvLmNyZWF0aW9uLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGVbaV0oImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgbi5fb25CZWZvcmVDcmVhdGUsIG4pLCBlW2ldKCJiZWZvcmVEZWxldGVTY2hlZHVsZSIsIG4uX29uQmVmb3JlRGVsZXRlLCBuKTsKICAgICAgfSksIGwuZm9yRWFjaChvLm1vdmUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZVtpXSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBuLl9vbkJlZm9yZVVwZGF0ZSwgbik7CiAgICAgIH0pLCBsLmZvckVhY2goby5yZXNpemUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZVtpXSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBuLl9vbkJlZm9yZVVwZGF0ZSwgbik7CiAgICAgIH0pLCB0W2ldKCJhZnRlclJlbmRlclNjaGVkdWxlIiwgbi5fb25BZnRlclJlbmRlclNjaGVkdWxlLCBuKSwgdFtpXSgiY2xpY2tUaW1lem9uZXNDb2xsYXBzZUJ0biIsIG4uX29uQ2xpY2tUaW1lem9uZXNDb2xsYXBzZUJ0biwgbiksIHRbaV0oImNsaWNrTW9yZSIsIG4uX29uQ2xpY2tNb3JlLCBuKTsKICAgIH0sIHkucHJvdG90eXBlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSB0aGlzLAogICAgICAgICAgbyA9IHRoaXMuX2xheW91dCwKICAgICAgICAgIGkgPSB0aGlzLl9jb250cm9sbGVyLAogICAgICAgICAgYSA9IHRoaXMuX2RyYWdIYW5kbGVyLAogICAgICAgICAgciA9IHRoaXMuX29wdGlvbnMsCiAgICAgICAgICBzID0gdGhpcy5fdmlld05hbWU7CiAgICAgICh0IHx8IHMgIT09IGUpICYmICh0aGlzLl9zZXRWaWV3TmFtZShlKSwgImRheSIgPT09IHMgJiYgKHMgPSAid2VlayIpLCAiZGF5IiA9PT0gZSAmJiAoZSA9ICJ3ZWVrIiksIG8uY2hpbGRyZW4uZG9XaGVuSGFzKHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbC5fdG9nZ2xlVmlld1NjaGVkdWxlKCExLCBlKTsKICAgICAgfSksIG8uY2xlYXIoKSwgIm1vbnRoIiA9PT0gZSA/IG4gPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICAgIHJldHVybiBkKGUsIHQsIG4sIGwpOwogICAgICB9KGksIG8uY29udGFpbmVyLCBhLCByKSA6ICJ3ZWVrIiAhPT0gZSAmJiAiZGF5IiAhPT0gZSB8fCAobiA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuIHUoZSwgdCwgbiwgbCwgbyk7CiAgICAgIH0oaSwgby5jb250YWluZXIsIGEsIHIsIHRoaXMuZ2V0Vmlld05hbWUoKSkpLCBvLmFkZENoaWxkKG4udmlldyksIG8uY2hpbGRyZW4uZG9XaGVuSGFzKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbC5fdG9nZ2xlVmlld1NjaGVkdWxlKCEwLCBlKTsKICAgICAgfSksIHRoaXMuX3JlZnJlc2hNZXRob2QgPSBuLnJlZnJlc2gsIHRoaXMuX3Njcm9sbFRvTm93TWV0aG9kID0gbi5zY3JvbGxUb05vdywgdGhpcy5fb3BlbkNyZWF0aW9uUG9wdXAgPSBuLm9wZW5DcmVhdGlvblBvcHVwLCB0aGlzLl9zaG93Q3JlYXRpb25Qb3B1cCA9IG4uc2hvd0NyZWF0aW9uUG9wdXAsIHRoaXMuX2hpZGVNb3JlVmlldyA9IG4uaGlkZU1vcmVWaWV3LCB0aGlzLm1vdmUoKSwgdGhpcy5yZW5kZXIoKSk7CiAgICB9LCB5LnByb3RvdHlwZS50b2dnbGVUYXNrVmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5fdmlld05hbWU7CiAgICAgIHRoaXMuX29wdGlvbnMudGFza1ZpZXcgPSBlLCB0aGlzLmNoYW5nZVZpZXcodCwgITApOwogICAgfSwgeS5wcm90b3R5cGUudG9nZ2xlU2NoZWR1bGVWaWV3ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLl92aWV3TmFtZTsKICAgICAgdGhpcy5fb3B0aW9ucy5zY2hlZHVsZVZpZXcgPSBlLCB0aGlzLmNoYW5nZVZpZXcodCwgITApOwogICAgfSwgeS5wcm90b3R5cGUuX3NldFZpZXdOYW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5fdmlld05hbWUgPSBlOwogICAgfSwgeS5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHJldHVybiB0aGlzLmdldFNjaGVkdWxlKGUsIHQpID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtc2NoZWR1bGUtaWQ9IicgKyBlICsgJyJdW2RhdGEtY2FsZW5kYXItaWQ9IicgKyB0ICsgJyJdJykgOiBudWxsOwogICAgfSwgeS5wcm90b3R5cGUuc2V0VGhlbWUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuX2NvbnRyb2xsZXIuc2V0VGhlbWUoZSk7CgogICAgICByZXR1cm4gdGhpcy5yZW5kZXIoITApLCB0OwogICAgfSwgeS5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGwuaXNPYmplY3QoZSkgJiYgIWwuaXNBcnJheShlKSA/IGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgICAgdGhpcy5fb3B0aW9uc1t0XVtuXSA9IGU7CiAgICAgICAgfSwgdGhpcykgOiB0aGlzLl9vcHRpb25zW3RdID0gZTsKICAgICAgfSwgdGhpcyksIHRoaXMuX3NldEFkZGl0aW9uYWxJbnRlcm5hbE9wdGlvbnMoZSksIHQgfHwgdGhpcy5jaGFuZ2VWaWV3KHRoaXMuX3ZpZXdOYW1lLCAhMCk7CiAgICB9LCB5LnByb3RvdHlwZS5nZXRPcHRpb25zID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fb3B0aW9uczsKICAgIH0sIHkucHJvdG90eXBlLmdldERhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJEYXRlOwogICAgfSwgeS5wcm90b3R5cGUuZ2V0RGF0ZVJhbmdlU3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJSYW5nZS5zdGFydDsKICAgIH0sIHkucHJvdG90eXBlLmdldERhdGVSYW5nZUVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlclJhbmdlLmVuZDsKICAgIH0sIHkucHJvdG90eXBlLmdldFZpZXdOYW1lID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5fdmlld05hbWU7CiAgICB9LCB5LnByb3RvdHlwZS5zZXRDYWxlbmRhcnMgPSBmdW5jdGlvbiAoZSkgewogICAgICBsLmZvckVhY2goZSB8fCBbXSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLnNldENhbGVuZGFyQ29sb3IoZS5pZCwgZSwgITApOwogICAgICB9LCB0aGlzKSwgdGhpcy5fY29udHJvbGxlci5zZXRDYWxlbmRhcnMoZSksIHRoaXMucmVuZGVyKCk7CiAgICB9LCB5LnByb3RvdHlwZS5vcGVuQ3JlYXRpb25Qb3B1cCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX29wZW5DcmVhdGlvblBvcHVwICYmIHRoaXMuX29wZW5DcmVhdGlvblBvcHVwKGUpOwogICAgfSwgeS5wcm90b3R5cGUuaGlkZU1vcmVWaWV3ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9oaWRlTW9yZVZpZXcgJiYgdGhpcy5faGlkZU1vcmVWaWV3KCk7CiAgICB9LCB5LnNldFRpbWV6b25lT2Zmc2V0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgbS5zZXRPZmZzZXQoZSk7CiAgICB9LCB5LnNldFRpbWV6b25lT2Zmc2V0Q2FsbGJhY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICBtLnNldE9mZnNldENhbGxiYWNrKGUpOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4oeSksIGUuZXhwb3J0cyA9IHk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMDsKICAgIHZhciBsID0gbigxMCk7CiAgICB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJibG9ja0hlbHBlck1pc3NpbmciLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHZhciBvID0gbi5pbnZlcnNlLAogICAgICAgICAgICBpID0gbi5mbjsKICAgICAgICBpZiAoITAgPT09IHQpIHJldHVybiBpKHRoaXMpOwogICAgICAgIGlmICghMSA9PT0gdCB8fCBudWxsID09IHQpIHJldHVybiBvKHRoaXMpOwogICAgICAgIGlmIChsLmlzQXJyYXkodCkpIHJldHVybiB0Lmxlbmd0aCA+IDAgPyAobi5pZHMgJiYgKG4uaWRzID0gW24ubmFtZV0pLCBlLmhlbHBlcnMuZWFjaCh0LCBuKSkgOiBvKHRoaXMpOwoKICAgICAgICBpZiAobi5kYXRhICYmIG4uaWRzKSB7CiAgICAgICAgICB2YXIgYSA9IGwuY3JlYXRlRnJhbWUobi5kYXRhKTsKICAgICAgICAgIGEuY29udGV4dFBhdGggPSBsLmFwcGVuZENvbnRleHRQYXRoKG4uZGF0YS5jb250ZXh0UGF0aCwgbi5uYW1lKSwgbiA9IHsKICAgICAgICAgICAgZGF0YTogYQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpKHQsIG4pOwogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAobCkgewogICAgICB0Ll9fZXNNb2R1bGUgPSAhMDsKICAgICAgdmFyIG8sCiAgICAgICAgICBpID0gbigxMCksCiAgICAgICAgICBhID0gbigxMiksCiAgICAgICAgICByID0gKG8gPSBhKSAmJiBvLl9fZXNNb2R1bGUgPyBvIDogewogICAgICAgIGRlZmF1bHQ6IG8KICAgICAgfTsKICAgICAgdC5kZWZhdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLnJlZ2lzdGVySGVscGVyKCJlYWNoIiwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmICghdCkgdGhyb3cgbmV3IHIuZGVmYXVsdCgiTXVzdCBwYXNzIGl0ZXJhdG9yIHRvICNlYWNoIik7CiAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICBvID0gdC5mbiwKICAgICAgICAgICAgICBhID0gdC5pbnZlcnNlLAogICAgICAgICAgICAgIHMgPSAwLAogICAgICAgICAgICAgIGMgPSAiIiwKICAgICAgICAgICAgICB1ID0gdm9pZCAwLAogICAgICAgICAgICAgIGQgPSB2b2lkIDA7CgogICAgICAgICAgZnVuY3Rpb24gaCh0LCBuLCBsKSB7CiAgICAgICAgICAgIHUgJiYgKHUua2V5ID0gdCwgdS5pbmRleCA9IG4sIHUuZmlyc3QgPSAwID09PSBuLCB1Lmxhc3QgPSAhIWwsIGQgJiYgKHUuY29udGV4dFBhdGggPSBkICsgdCkpLCBjICs9IG8oZVt0XSwgewogICAgICAgICAgICAgIGRhdGE6IHUsCiAgICAgICAgICAgICAgYmxvY2tQYXJhbXM6IGkuYmxvY2tQYXJhbXMoW2VbdF0sIHRdLCBbZCArIHQsIG51bGxdKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodC5kYXRhICYmIHQuaWRzICYmIChkID0gaS5hcHBlbmRDb250ZXh0UGF0aCh0LmRhdGEuY29udGV4dFBhdGgsIHQuaWRzWzBdKSArICIuIiksIGkuaXNGdW5jdGlvbihlKSAmJiAoZSA9IGUuY2FsbCh0aGlzKSksIHQuZGF0YSAmJiAodSA9IGkuY3JlYXRlRnJhbWUodC5kYXRhKSksIGUgJiYgIm9iamVjdCIgPT0gX3R5cGVvZihlKSkgaWYgKGkuaXNBcnJheShlKSkgZm9yICh2YXIgcCA9IGUubGVuZ3RoOyBzIDwgcDsgcysrKSB7CiAgICAgICAgICAgIHMgaW4gZSAmJiBoKHMsIHMsIHMgPT09IGUubGVuZ3RoIC0gMSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGwuU3ltYm9sICYmIGVbbC5TeW1ib2wuaXRlcmF0b3JdKSB7CiAgICAgICAgICAgIGZvciAodmFyIG0gPSBbXSwgZiA9IGVbbC5TeW1ib2wuaXRlcmF0b3JdKCksIGcgPSBmLm5leHQoKTsgIWcuZG9uZTsgZyA9IGYubmV4dCgpKSB7CiAgICAgICAgICAgICAgbS5wdXNoKGcudmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHAgPSAoZSA9IG0pLmxlbmd0aDsgcyA8IHA7IHMrKykgewogICAgICAgICAgICAgIGgocywgcywgcyA9PT0gZS5sZW5ndGggLSAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIG4gPSB2b2lkIDAsIE9iamVjdC5rZXlzKGUpLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdm9pZCAwICE9PSBuICYmIGgobiwgcyAtIDEpLCBuID0gZSwgcysrOwogICAgICAgICAgfSksIHZvaWQgMCAhPT0gbiAmJiBoKG4sIHMgLSAxLCAhMCk7CiAgICAgICAgICByZXR1cm4gMCA9PT0gcyAmJiAoYyA9IGEodGhpcykpLCBjOwogICAgICAgIH0pOwogICAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCwKICAgICAgICBvID0gbigxMiksCiAgICAgICAgaSA9IChsID0gbykgJiYgbC5fX2VzTW9kdWxlID8gbCA6IHsKICAgICAgZGVmYXVsdDogbAogICAgfTsKICAgIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGUucmVnaXN0ZXJIZWxwZXIoImhlbHBlck1pc3NpbmciLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKDEgIT09IGFyZ3VtZW50cy5sZW5ndGgpIHRocm93IG5ldyBpLmRlZmF1bHQoJ01pc3NpbmcgaGVscGVyOiAiJyArIGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0ubmFtZSArICciJyk7CiAgICAgIH0pOwogICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCwKICAgICAgICBvID0gbigxMCksCiAgICAgICAgaSA9IG4oMTIpLAogICAgICAgIGEgPSAobCA9IGkpICYmIGwuX19lc01vZHVsZSA/IGwgOiB7CiAgICAgIGRlZmF1bHQ6IGwKICAgIH07CiAgICB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJpZiIsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgaWYgKDIgIT0gYXJndW1lbnRzLmxlbmd0aCkgdGhyb3cgbmV3IGEuZGVmYXVsdCgiI2lmIHJlcXVpcmVzIGV4YWN0bHkgb25lIGFyZ3VtZW50Iik7CiAgICAgICAgcmV0dXJuIG8uaXNGdW5jdGlvbihlKSAmJiAoZSA9IGUuY2FsbCh0aGlzKSksICF0Lmhhc2guaW5jbHVkZVplcm8gJiYgIWUgfHwgby5pc0VtcHR5KGUpID8gdC5pbnZlcnNlKHRoaXMpIDogdC5mbih0aGlzKTsKICAgICAgfSksIGUucmVnaXN0ZXJIZWxwZXIoInVubGVzcyIsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgaWYgKDIgIT0gYXJndW1lbnRzLmxlbmd0aCkgdGhyb3cgbmV3IGEuZGVmYXVsdCgiI3VubGVzcyByZXF1aXJlcyBleGFjdGx5IG9uZSBhcmd1bWVudCIpOwogICAgICAgIHJldHVybiBlLmhlbHBlcnMuaWYuY2FsbCh0aGlzLCB0LCB7CiAgICAgICAgICBmbjogbi5pbnZlcnNlLAogICAgICAgICAgaW52ZXJzZTogbi5mbiwKICAgICAgICAgIGhhc2g6IG4uaGFzaAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmRlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgICBlLnJlZ2lzdGVySGVscGVyKCJsb2ciLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFt2b2lkIDBdLCBuID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSwgbCA9IDA7IGwgPCBhcmd1bWVudHMubGVuZ3RoIC0gMTsgbCsrKSB7CiAgICAgICAgICB0LnB1c2goYXJndW1lbnRzW2xdKTsKICAgICAgICB9CgogICAgICAgIHZhciBvID0gMTsKICAgICAgICBudWxsICE9IG4uaGFzaC5sZXZlbCA/IG8gPSBuLmhhc2gubGV2ZWwgOiBuLmRhdGEgJiYgbnVsbCAhPSBuLmRhdGEubGV2ZWwgJiYgKG8gPSBuLmRhdGEubGV2ZWwpLCB0WzBdID0gbywgZS5sb2cuYXBwbHkoZSwgdCk7CiAgICAgIH0pOwogICAgfSwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITAsIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGUucmVnaXN0ZXJIZWxwZXIoImxvb2t1cCIsIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgICAgcmV0dXJuIGUgPyBuLmxvb2t1cFByb3BlcnR5KGUsIHQpIDogZTsKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMDsKICAgIHZhciBsLAogICAgICAgIG8gPSBuKDEwKSwKICAgICAgICBpID0gbigxMiksCiAgICAgICAgYSA9IChsID0gaSkgJiYgbC5fX2VzTW9kdWxlID8gbCA6IHsKICAgICAgZGVmYXVsdDogbAogICAgfTsKICAgIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGUucmVnaXN0ZXJIZWxwZXIoIndpdGgiLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGlmICgyICE9IGFyZ3VtZW50cy5sZW5ndGgpIHRocm93IG5ldyBhLmRlZmF1bHQoIiN3aXRoIHJlcXVpcmVzIGV4YWN0bHkgb25lIGFyZ3VtZW50Iik7CiAgICAgICAgby5pc0Z1bmN0aW9uKGUpICYmIChlID0gZS5jYWxsKHRoaXMpKTsKICAgICAgICB2YXIgbiA9IHQuZm47CiAgICAgICAgaWYgKG8uaXNFbXB0eShlKSkgcmV0dXJuIHQuaW52ZXJzZSh0aGlzKTsKICAgICAgICB2YXIgbCA9IHQuZGF0YTsKICAgICAgICByZXR1cm4gdC5kYXRhICYmIHQuaWRzICYmICgobCA9IG8uY3JlYXRlRnJhbWUodC5kYXRhKSkuY29udGV4dFBhdGggPSBvLmFwcGVuZENvbnRleHRQYXRoKHQuZGF0YS5jb250ZXh0UGF0aCwgdC5pZHNbMF0pKSwgbihlLCB7CiAgICAgICAgICBkYXRhOiBsLAogICAgICAgICAgYmxvY2tQYXJhbXM6IG8uYmxvY2tQYXJhbXMoW2VdLCBbbCAmJiBsLmNvbnRleHRQYXRoXSkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC5yZWdpc3RlckRlZmF1bHREZWNvcmF0b3JzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaS5kZWZhdWx0KGUpOwogICAgfTsKICAgIHZhciBsLAogICAgICAgIG8gPSBuKDQ2KSwKICAgICAgICBpID0gKGwgPSBvKSAmJiBsLl9fZXNNb2R1bGUgPyBsIDogewogICAgICBkZWZhdWx0OiBsCiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITA7CiAgICB2YXIgbCA9IG4oMTApOwogICAgdC5kZWZhdWx0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZS5yZWdpc3RlckRlY29yYXRvcigiaW5saW5lIiwgZnVuY3Rpb24gKGUsIHQsIG4sIG8pIHsKICAgICAgICB2YXIgaSA9IGU7CiAgICAgICAgcmV0dXJuIHQucGFydGlhbHMgfHwgKHQucGFydGlhbHMgPSB7fSwgaSA9IGZ1bmN0aW9uIGkobywgX2kpIHsKICAgICAgICAgIHZhciBhID0gbi5wYXJ0aWFsczsKICAgICAgICAgIG4ucGFydGlhbHMgPSBsLmV4dGVuZCh7fSwgYSwgdC5wYXJ0aWFscyk7CiAgICAgICAgICB2YXIgciA9IGUobywgX2kpOwogICAgICAgICAgcmV0dXJuIG4ucGFydGlhbHMgPSBhLCByOwogICAgICAgIH0pLCB0LnBhcnRpYWxzW28uYXJnc1swXV0gPSBvLmZuLCBpOwogICAgICB9KTsKICAgIH0sIGUuZXhwb3J0cyA9IHQuZGVmYXVsdDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuX19lc01vZHVsZSA9ICEwLCB0LmNyZWF0ZU5ld0xvb2t1cE9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgZSA9IGFyZ3VtZW50cy5sZW5ndGgsIHQgPSBBcnJheShlKSwgbiA9IDA7IG4gPCBlOyBuKyspIHsKICAgICAgICB0W25dID0gYXJndW1lbnRzW25dOwogICAgICB9CgogICAgICByZXR1cm4gbC5leHRlbmQuYXBwbHkodm9pZCAwLCBbT2JqZWN0LmNyZWF0ZShudWxsKV0uY29uY2F0KHQpKTsKICAgIH07CiAgICB2YXIgbCA9IG4oMTApOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gbChlKSB7CiAgICAgIHRoaXMuc3RyaW5nID0gZTsKICAgIH0KCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgbC5wcm90b3R5cGUudG9TdHJpbmcgPSBsLnByb3RvdHlwZS50b0hUTUwgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAiIiArIHRoaXMuc3RyaW5nOwogICAgfSwgdC5kZWZhdWx0ID0gbCwgZS5leHBvcnRzID0gdC5kZWZhdWx0OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdC5fX2VzTW9kdWxlID0gITAsIHQuY2hlY2tSZXZpc2lvbiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZSAmJiBlWzBdIHx8IDEsCiAgICAgICAgICBuID0gci5DT01QSUxFUl9SRVZJU0lPTjsKICAgICAgaWYgKHQgPj0gci5MQVNUX0NPTVBBVElCTEVfQ09NUElMRVJfUkVWSVNJT04gJiYgdCA8PSByLkNPTVBJTEVSX1JFVklTSU9OKSByZXR1cm47CgogICAgICBpZiAodCA8IHIuTEFTVF9DT01QQVRJQkxFX0NPTVBJTEVSX1JFVklTSU9OKSB7CiAgICAgICAgdmFyIGwgPSByLlJFVklTSU9OX0NIQU5HRVNbbl0sCiAgICAgICAgICAgIG8gPSByLlJFVklTSU9OX0NIQU5HRVNbdF07CiAgICAgICAgdGhyb3cgbmV3IGEuZGVmYXVsdCgiVGVtcGxhdGUgd2FzIHByZWNvbXBpbGVkIHdpdGggYW4gb2xkZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gUGxlYXNlIHVwZGF0ZSB5b3VyIHByZWNvbXBpbGVyIHRvIGEgbmV3ZXIgdmVyc2lvbiAoIiArIGwgKyAiKSBvciBkb3duZ3JhZGUgeW91ciBydW50aW1lIHRvIGFuIG9sZGVyIHZlcnNpb24gKCIgKyBvICsgIikuIik7CiAgICAgIH0KCiAgICAgIHRocm93IG5ldyBhLmRlZmF1bHQoIlRlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGEgbmV3ZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gUGxlYXNlIHVwZGF0ZSB5b3VyIHJ1bnRpbWUgdG8gYSBuZXdlciB2ZXJzaW9uICgiICsgZVsxXSArICIpLiIpOwogICAgfSwgdC50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIGlmICghdCkgdGhyb3cgbmV3IGEuZGVmYXVsdCgiTm8gZW52aXJvbm1lbnQgcGFzc2VkIHRvIHRlbXBsYXRlIik7CiAgICAgIGlmICghZSB8fCAhZS5tYWluKSB0aHJvdyBuZXcgYS5kZWZhdWx0KCJVbmtub3duIHRlbXBsYXRlIG9iamVjdDogIiArIF90eXBlb2YoZSkpOwogICAgICBlLm1haW4uZGVjb3JhdG9yID0gZS5tYWluX2QsIHQuVk0uY2hlY2tSZXZpc2lvbihlLmNvbXBpbGVyKTsKICAgICAgdmFyIG4gPSBlLmNvbXBpbGVyICYmIDcgPT09IGUuY29tcGlsZXJbMF07CiAgICAgIHZhciBsID0gewogICAgICAgIHN0cmljdDogZnVuY3Rpb24gc3RyaWN0KGUsIHQsIG4pIHsKICAgICAgICAgIGlmICghZSB8fCAhKHQgaW4gZSkpIHRocm93IG5ldyBhLmRlZmF1bHQoJyInICsgdCArICciIG5vdCBkZWZpbmVkIGluICcgKyBlLCB7CiAgICAgICAgICAgIGxvYzogbgogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gZVt0XTsKICAgICAgICB9LAogICAgICAgIGxvb2t1cFByb3BlcnR5OiBmdW5jdGlvbiBsb29rdXBQcm9wZXJ0eShlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IGVbdF07CiAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuIHx8IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSB8fCB1LnJlc3VsdElzQWxsb3dlZChuLCBsLnByb3RvQWNjZXNzQ29udHJvbCwgdCkgPyBuIDogdm9pZCAwOwogICAgICAgIH0sCiAgICAgICAgbG9va3VwOiBmdW5jdGlvbiBsb29rdXAoZSwgdCkgewogICAgICAgICAgZm9yICh2YXIgbiA9IGUubGVuZ3RoLCBvID0gMDsgbyA8IG47IG8rKykgewogICAgICAgICAgICBpZiAobnVsbCAhPSAoZVtvXSAmJiBsLmxvb2t1cFByb3BlcnR5KGVbb10sIHQpKSkgcmV0dXJuIGVbb11bdF07CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBsYW1iZGE6IGZ1bmN0aW9uIGxhbWJkYShlLCB0KSB7CiAgICAgICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IGUuY2FsbCh0KSA6IGU7CiAgICAgICAgfSwKICAgICAgICBlc2NhcGVFeHByZXNzaW9uOiBvLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgaW52b2tlUGFydGlhbDogZnVuY3Rpb24gaW52b2tlUGFydGlhbChuLCBsLCBpKSB7CiAgICAgICAgICBpLmhhc2ggJiYgKGwgPSBvLmV4dGVuZCh7fSwgbCwgaS5oYXNoKSwgaS5pZHMgJiYgKGkuaWRzWzBdID0gITApKSwgbiA9IHQuVk0ucmVzb2x2ZVBhcnRpYWwuY2FsbCh0aGlzLCBuLCBsLCBpKTsKICAgICAgICAgIHZhciByID0gby5leHRlbmQoe30sIGksIHsKICAgICAgICAgICAgaG9va3M6IHRoaXMuaG9va3MsCiAgICAgICAgICAgIHByb3RvQWNjZXNzQ29udHJvbDogdGhpcy5wcm90b0FjY2Vzc0NvbnRyb2wKICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHMgPSB0LlZNLmludm9rZVBhcnRpYWwuY2FsbCh0aGlzLCBuLCBsLCByKTsKCiAgICAgICAgICBpZiAobnVsbCA9PSBzICYmIHQuY29tcGlsZSAmJiAoaS5wYXJ0aWFsc1tpLm5hbWVdID0gdC5jb21waWxlKG4sIGUuY29tcGlsZXJPcHRpb25zLCB0KSwgcyA9IGkucGFydGlhbHNbaS5uYW1lXShsLCByKSksIG51bGwgIT0gcykgewogICAgICAgICAgICBpZiAoaS5pbmRlbnQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBjID0gcy5zcGxpdCgiXG4iKSwgdSA9IDAsIGQgPSBjLmxlbmd0aDsgdSA8IGQgJiYgKGNbdV0gfHwgdSArIDEgIT09IGQpOyB1KyspIHsKICAgICAgICAgICAgICAgIGNbdV0gPSBpLmluZGVudCArIGNbdV07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzID0gYy5qb2luKCJcbiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICAgIH0KCiAgICAgICAgICB0aHJvdyBuZXcgYS5kZWZhdWx0KCJUaGUgcGFydGlhbCAiICsgaS5uYW1lICsgIiBjb3VsZCBub3QgYmUgY29tcGlsZWQgd2hlbiBydW5uaW5nIGluIHJ1bnRpbWUtb25seSBtb2RlIik7CiAgICAgICAgfSwKICAgICAgICBmbjogZnVuY3Rpb24gZm4odCkgewogICAgICAgICAgdmFyIG4gPSBlW3RdOwogICAgICAgICAgcmV0dXJuIG4uZGVjb3JhdG9yID0gZVt0ICsgIl9kIl0sIG47CiAgICAgICAgfSwKICAgICAgICBwcm9ncmFtczogW10sCiAgICAgICAgcHJvZ3JhbTogZnVuY3Rpb24gcHJvZ3JhbShlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgICB2YXIgaSA9IHRoaXMucHJvZ3JhbXNbZV0sCiAgICAgICAgICAgICAgYSA9IHRoaXMuZm4oZSk7CiAgICAgICAgICByZXR1cm4gdCB8fCBvIHx8IGwgfHwgbiA/IGkgPSBkKHRoaXMsIGUsIGEsIHQsIG4sIGwsIG8pIDogaSB8fCAoaSA9IHRoaXMucHJvZ3JhbXNbZV0gPSBkKHRoaXMsIGUsIGEpKSwgaTsKICAgICAgICB9LAogICAgICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoZSwgdCkgewogICAgICAgICAgZm9yICg7IGUgJiYgdC0tOykgewogICAgICAgICAgICBlID0gZS5fcGFyZW50OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlOwogICAgICAgIH0sCiAgICAgICAgbWVyZ2VJZk5lZWRlZDogZnVuY3Rpb24gbWVyZ2VJZk5lZWRlZChlLCB0KSB7CiAgICAgICAgICB2YXIgbiA9IGUgfHwgdDsKICAgICAgICAgIHJldHVybiBlICYmIHQgJiYgZSAhPT0gdCAmJiAobiA9IG8uZXh0ZW5kKHt9LCB0LCBlKSksIG47CiAgICAgICAgfSwKICAgICAgICBudWxsQ29udGV4dDogT2JqZWN0LnNlYWwoe30pLAogICAgICAgIG5vb3A6IHQuVk0ubm9vcCwKICAgICAgICBjb21waWxlckluZm86IGUuY29tcGlsZXIKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IHZvaWQgMCA9PT0gYXJndW1lbnRzWzFdID8ge30gOiBhcmd1bWVudHNbMV0sCiAgICAgICAgICAgIG8gPSBuLmRhdGE7CiAgICAgICAgaS5fc2V0dXAobiksICFuLnBhcnRpYWwgJiYgZS51c2VEYXRhICYmIChvID0gcCh0LCBvKSk7CiAgICAgICAgdmFyIGEgPSB2b2lkIDAsCiAgICAgICAgICAgIHIgPSBlLnVzZUJsb2NrUGFyYW1zID8gW10gOiB2b2lkIDA7CgogICAgICAgIGZ1bmN0aW9uIHModCkgewogICAgICAgICAgcmV0dXJuICIiICsgZS5tYWluKGwsIHQsIGwuaGVscGVycywgbC5wYXJ0aWFscywgbywgciwgYSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZS51c2VEZXB0aHMgJiYgKGEgPSBuLmRlcHRocyA/IHQgIT0gbi5kZXB0aHNbMF0gPyBbdF0uY29uY2F0KG4uZGVwdGhzKSA6IG4uZGVwdGhzIDogW3RdKSwgKHMgPSBtKGUubWFpbiwgcywgbCwgbi5kZXB0aHMgfHwgW10sIG8sIHIpKSh0LCBuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGkuaXNUb3AgPSAhMCwgaS5fc2V0dXAgPSBmdW5jdGlvbiAoaSkgewogICAgICAgIGlmIChpLnBhcnRpYWwpIGwucHJvdG9BY2Nlc3NDb250cm9sID0gaS5wcm90b0FjY2Vzc0NvbnRyb2wsIGwuaGVscGVycyA9IGkuaGVscGVycywgbC5wYXJ0aWFscyA9IGkucGFydGlhbHMsIGwuZGVjb3JhdG9ycyA9IGkuZGVjb3JhdG9ycywgbC5ob29rcyA9IGkuaG9va3M7ZWxzZSB7CiAgICAgICAgICB2YXIgYSA9IG8uZXh0ZW5kKHt9LCB0LmhlbHBlcnMsIGkuaGVscGVycyk7CiAgICAgICAgICAhZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgICAgT2JqZWN0LmtleXMoZSkuZm9yRWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHZhciBsID0gZVtuXTsKCiAgICAgICAgICAgICAgZVtuXSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IHQubG9va3VwUHJvcGVydHk7CiAgICAgICAgICAgICAgICByZXR1cm4gYy53cmFwSGVscGVyKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBvLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgbG9va3VwUHJvcGVydHk6IG4KICAgICAgICAgICAgICAgICAgfSwgZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KGwsIHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0oYSwgbCksIGwuaGVscGVycyA9IGEsIGUudXNlUGFydGlhbCAmJiAobC5wYXJ0aWFscyA9IGwubWVyZ2VJZk5lZWRlZChpLnBhcnRpYWxzLCB0LnBhcnRpYWxzKSksIChlLnVzZVBhcnRpYWwgfHwgZS51c2VEZWNvcmF0b3JzKSAmJiAobC5kZWNvcmF0b3JzID0gby5leHRlbmQoe30sIHQuZGVjb3JhdG9ycywgaS5kZWNvcmF0b3JzKSksIGwuaG9va3MgPSB7fSwgbC5wcm90b0FjY2Vzc0NvbnRyb2wgPSB1LmNyZWF0ZVByb3RvQWNjZXNzQ29udHJvbChpKTsKICAgICAgICAgIHZhciByID0gaS5hbGxvd0NhbGxzVG9IZWxwZXJNaXNzaW5nIHx8IG47CiAgICAgICAgICBzLm1vdmVIZWxwZXJUb0hvb2tzKGwsICJoZWxwZXJNaXNzaW5nIiwgciksIHMubW92ZUhlbHBlclRvSG9va3MobCwgImJsb2NrSGVscGVyTWlzc2luZyIsIHIpOwogICAgICAgIH0KICAgICAgfSwgaS5fY2hpbGQgPSBmdW5jdGlvbiAodCwgbiwgbywgaSkgewogICAgICAgIGlmIChlLnVzZUJsb2NrUGFyYW1zICYmICFvKSB0aHJvdyBuZXcgYS5kZWZhdWx0KCJtdXN0IHBhc3MgYmxvY2sgcGFyYW1zIik7CiAgICAgICAgaWYgKGUudXNlRGVwdGhzICYmICFpKSB0aHJvdyBuZXcgYS5kZWZhdWx0KCJtdXN0IHBhc3MgcGFyZW50IGRlcHRocyIpOwogICAgICAgIHJldHVybiBkKGwsIHQsIGVbdF0sIG4sIDAsIG8sIGkpOwogICAgICB9LCBpOwogICAgfSwgdC53cmFwUHJvZ3JhbSA9IGQsIHQucmVzb2x2ZVBhcnRpYWwgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICBlID8gZS5jYWxsIHx8IG4ubmFtZSB8fCAobi5uYW1lID0gZSwgZSA9IG4ucGFydGlhbHNbZV0pIDogZSA9ICJAcGFydGlhbC1ibG9jayIgPT09IG4ubmFtZSA/IG4uZGF0YVsicGFydGlhbC1ibG9jayJdIDogbi5wYXJ0aWFsc1tuLm5hbWVdOwogICAgICByZXR1cm4gZTsKICAgIH0sIHQuaW52b2tlUGFydGlhbCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHZhciBsID0gbi5kYXRhICYmIG4uZGF0YVsicGFydGlhbC1ibG9jayJdOwogICAgICBuLnBhcnRpYWwgPSAhMCwgbi5pZHMgJiYgKG4uZGF0YS5jb250ZXh0UGF0aCA9IG4uaWRzWzBdIHx8IG4uZGF0YS5jb250ZXh0UGF0aCk7CiAgICAgIHZhciBpID0gdm9pZCAwOwogICAgICBuLmZuICYmIG4uZm4gIT09IGggJiYgZnVuY3Rpb24gKCkgewogICAgICAgIG4uZGF0YSA9IHIuY3JlYXRlRnJhbWUobi5kYXRhKTsKICAgICAgICB2YXIgZSA9IG4uZm47CiAgICAgICAgaSA9IG4uZGF0YVsicGFydGlhbC1ibG9jayJdID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IHZvaWQgMCA9PT0gYXJndW1lbnRzWzFdID8ge30gOiBhcmd1bWVudHNbMV07CiAgICAgICAgICByZXR1cm4gbi5kYXRhID0gci5jcmVhdGVGcmFtZShuLmRhdGEpLCBuLmRhdGFbInBhcnRpYWwtYmxvY2siXSA9IGwsIGUodCwgbik7CiAgICAgICAgfSwgZS5wYXJ0aWFscyAmJiAobi5wYXJ0aWFscyA9IG8uZXh0ZW5kKHt9LCBuLnBhcnRpYWxzLCBlLnBhcnRpYWxzKSk7CiAgICAgIH0oKTsKICAgICAgdm9pZCAwID09PSBlICYmIGkgJiYgKGUgPSBpKTsKICAgICAgaWYgKHZvaWQgMCA9PT0gZSkgdGhyb3cgbmV3IGEuZGVmYXVsdCgiVGhlIHBhcnRpYWwgIiArIG4ubmFtZSArICIgY291bGQgbm90IGJlIGZvdW5kIik7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgRnVuY3Rpb24pIHJldHVybiBlKHQsIG4pOwogICAgfSwgdC5ub29wID0gaDsKCiAgICB2YXIgbCwKICAgICAgICBvID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUgJiYgZS5fX2VzTW9kdWxlKSByZXR1cm4gZTsKICAgICAgdmFyIHQgPSB7fTsKICAgICAgaWYgKG51bGwgIT0gZSkgZm9yICh2YXIgbiBpbiBlKSB7CiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG4pICYmICh0W25dID0gZVtuXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQuZGVmYXVsdCA9IGUsIHQ7CiAgICB9KG4oMTApKSwKICAgICAgICBpID0gbigxMiksCiAgICAgICAgYSA9IChsID0gaSkgJiYgbC5fX2VzTW9kdWxlID8gbCA6IHsKICAgICAgZGVmYXVsdDogbAogICAgfSwKICAgICAgICByID0gbigyMiksCiAgICAgICAgcyA9IG4oMjMpLAogICAgICAgIGMgPSBuKDUwKSwKICAgICAgICB1ID0gbigyNSk7CgogICAgZnVuY3Rpb24gZChlLCB0LCBuLCBsLCBvLCBpLCBhKSB7CiAgICAgIGZ1bmN0aW9uIHIodCkgewogICAgICAgIHZhciBvID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IHZvaWQgMCA9PT0gYXJndW1lbnRzWzFdID8ge30gOiBhcmd1bWVudHNbMV0sCiAgICAgICAgICAgIHIgPSBhOwogICAgICAgIHJldHVybiAhYSB8fCB0ID09IGFbMF0gfHwgdCA9PT0gZS5udWxsQ29udGV4dCAmJiBudWxsID09PSBhWzBdIHx8IChyID0gW3RdLmNvbmNhdChhKSksIG4oZSwgdCwgZS5oZWxwZXJzLCBlLnBhcnRpYWxzLCBvLmRhdGEgfHwgbCwgaSAmJiBbby5ibG9ja1BhcmFtc10uY29uY2F0KGkpLCByKTsKICAgICAgfQoKICAgICAgcmV0dXJuIChyID0gbShuLCByLCBlLCBhLCBsLCBpKSkucHJvZ3JhbSA9IHQsIHIuZGVwdGggPSBhID8gYS5sZW5ndGggOiAwLCByLmJsb2NrUGFyYW1zID0gbyB8fCAwLCByOwogICAgfQoKICAgIGZ1bmN0aW9uIGgoKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KCiAgICBmdW5jdGlvbiBwKGUsIHQpIHsKICAgICAgcmV0dXJuIHQgJiYgInJvb3QiIGluIHQgfHwgKCh0ID0gdCA/IHIuY3JlYXRlRnJhbWUodCkgOiB7fSkucm9vdCA9IGUpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIG0oZSwgdCwgbiwgbCwgaSwgYSkgewogICAgICBpZiAoZS5kZWNvcmF0b3IpIHsKICAgICAgICB2YXIgciA9IHt9OwogICAgICAgIHQgPSBlLmRlY29yYXRvcih0LCByLCBuLCBsICYmIGxbMF0sIGksIGEsIGwpLCBvLmV4dGVuZCh0LCByKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB0Ll9fZXNNb2R1bGUgPSAhMCwgdC53cmFwSGVscGVyID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHJldHVybiBlOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTsKICAgICAgICByZXR1cm4gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSA9IHQobiksIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKG4pIHsKICAgICAgdC5fX2VzTW9kdWxlID0gITAsIHQuZGVmYXVsdCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB2b2lkIDAgIT09IG4gPyBuIDogd2luZG93LAogICAgICAgICAgICBsID0gdC5IYW5kbGViYXJzOwoKICAgICAgICBlLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdC5IYW5kbGViYXJzID09PSBlICYmICh0LkhhbmRsZWJhcnMgPSBsKSwgZTsKICAgICAgICB9OwogICAgICB9LCBlLmV4cG9ydHMgPSB0LmRlZmF1bHQ7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpLAogICAgICAgIGEgPSBuKDEzKSwKICAgICAgICByID0gbig4KTsKCiAgICBmdW5jdGlvbiBzKGUsIHQpIHsKICAgICAgZSA9IGkuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIGUsIG8uY2xhc3NuYW1lKCJsYXlvdXQiKSksIHRoaXMuY29udGFpbmVyID0gZSwgdGhpcy5jaGlsZHJlbiA9IG5ldyBhKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUudmlld05hbWU7CiAgICAgIH0pLCB0aGlzLnRoZW1lID0gdCwgdGhpcy5hcHBseVRoZW1lKCk7CiAgICB9CgogICAgbC5pbmhlcml0KHMsIHIpLCBzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5kZXN0cm95KCk7CiAgICAgIH0pLCB0aGlzLmNoaWxkcmVuLmNsZWFyKCksIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9ICIiOwogICAgfSwgcy5wcm90b3R5cGUucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmNoaWxkcmVuLnJlbW92ZShlKTsKICAgIH0sIHMucHJvdG90eXBlLnRvZ2dsZUNoaWxkVmlldyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwgPSBbImFkZCIsICJyZW1vdmUiXTsKICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdCA9IGEuY29udGFpbmVyLCBuID0gTnVtYmVyKGEudmlld05hbWUgPT09IGUpLCBpW2xbbl0gKyAiQ2xhc3MiXSh0LCBvLmNsYXNzbmFtZSgiaGlkZGVuIikpOwogICAgICB9KTsKICAgIH0sIHMucHJvdG90eXBlLmFwcGx5VGhlbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5jb250YWluZXIuc3R5bGUsCiAgICAgICAgICB0ID0gdGhpcy50aGVtZS5jb21tb247CiAgICAgIGUuYmFja2dyb3VuZENvbG9yID0gdC5iYWNrZ3JvdW5kQ29sb3I7CiAgICB9LCBlLmV4cG9ydHMgPSBzOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDU0KSwKICAgICAgICBpID0gbig2MCksCiAgICAgICAgYSA9IG4oNjEpLAogICAgICAgIHIgPSBuKDYyKTsKCiAgICBmdW5jdGlvbiBzKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0W25dID0ge307CiAgICAgIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgIG9bbl0gPSBsLmJpbmQoZSwgdCk7CiAgICAgIH0pOwogICAgfQoKICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gbmV3IG8oZSk7CiAgICAgIHJldHVybiBzKGksIHQsICJDb3JlIiksIHMoYSwgdCwgIldlZWsiKSwgcyhyLCB0LCAiTW9udGgiKSwgdC5Db3JlLnRoZW1lID0gdC50aGVtZSwgdC5XZWVrLnRoZW1lID0gdC50aGVtZSwgdC5Nb250aC50aGVtZSA9IHQudGhlbWUsIHQ7CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDE0KSwKICAgICAgICBpID0gbigyOCksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oNSksCiAgICAgICAgcyA9IG4oNTcpOwoKICAgIGZ1bmN0aW9uIGMoZSkgewogICAgICBlID0gZSB8fCB7fSwgdGhpcy5ncm91cEZ1bmMgPSBlLmdyb3VwRnVuYyB8fCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gZS5tb2RlbDsKICAgICAgICByZXR1cm4gZS5tb2RlbC5pc0FsbERheSB8fCAidGltZSIgPT09IHQuY2F0ZWdvcnkgJiYgdC5lbmQgLSB0LnN0YXJ0ID4gYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSA/ICJhbGxkYXkiIDogdC5jYXRlZ29yeTsKICAgICAgfSwgdGhpcy5zY2hlZHVsZXMgPSByLmNyZWF0ZVNjaGVkdWxlQ29sbGVjdGlvbigpLCB0aGlzLmRhdGVNYXRyaXggPSB7fSwgdGhpcy50aGVtZSA9IG5ldyBzKGUudGhlbWUpLCB0aGlzLmNhbGVuZGFycyA9IFtdOwogICAgfQoKICAgIGMucHJvdG90eXBlLl9nZXRDb250YWluRGF0ZXNJblNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLmdldFN0YXJ0cygpLAogICAgICAgICAgbiA9IGUuZ2V0RW5kcygpLAogICAgICAgICAgbCA9IGEuc3RhcnQodCksCiAgICAgICAgICBvID0gMCA9PT0gYS5jb21wYXJlKHQsIG4pID8gbiA6IGEuY29udmVydFN0YXJ0RGF5VG9MYXN0RGF5KG4pLAogICAgICAgICAgaSA9IGEuZW5kKG8pOwogICAgICByZXR1cm4gYS5yYW5nZShsLCBpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKTsKICAgIH0sIGMucHJvdG90eXBlLmNyZWF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0gewogICAgICAgIGRhdGE6IGUKICAgICAgfTsKICAgICAgcmV0dXJuIHRoaXMuaW52b2tlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGwpID8gKG4gPSB0aGlzLmFkZFNjaGVkdWxlKG8uY3JlYXRlKGUpKSwgdCB8fCB0aGlzLmZpcmUoImNyZWF0ZWRTY2hlZHVsZSIsIG4pLCBuKSA6IG51bGw7CiAgICB9LCBjLnByb3RvdHlwZS5jcmVhdGVTY2hlZHVsZXMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHRoaXM7CiAgICAgIHJldHVybiBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBuLmNyZWF0ZVNjaGVkdWxlKGUsIHQpOwogICAgICB9KTsKICAgIH0sIGMucHJvdG90eXBlLnVwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4gPSB0LnN0YXJ0IHx8IGUuc3RhcnQsCiAgICAgICAgICBvID0gdC5lbmQgfHwgZS5lbmQ7CiAgICAgIHJldHVybiBbIm1pbGVzdG9uZSIsICJ0YXNrIiwgImFsbGRheSIsICJ0aW1lIl0uaW5kZXhPZigodCA9IHQgfHwge30pLmNhdGVnb3J5KSA+IC0xICYmIGUuc2V0KCJjYXRlZ29yeSIsIHQuY2F0ZWdvcnkpLCAiYWxsZGF5IiA9PT0gdC5jYXRlZ29yeSAmJiAodC5pc0FsbERheSA9ICEwKSwgbC5pc1VuZGVmaW5lZCh0LmlzQWxsRGF5KSB8fCBlLnNldCgiaXNBbGxEYXkiLCB0LmlzQWxsRGF5KSwgbC5pc1VuZGVmaW5lZCh0LmNhbGVuZGFySWQpIHx8IGUuc2V0KCJjYWxlbmRhcklkIiwgdC5jYWxlbmRhcklkKSwgdC50aXRsZSAmJiBlLnNldCgidGl0bGUiLCB0LnRpdGxlKSwgdC5ib2R5ICYmIGUuc2V0KCJib2R5IiwgdC5ib2R5KSwgKHQuc3RhcnQgfHwgdC5lbmQpICYmIChlLmlzQWxsRGF5ID8gZS5zZXRBbGxEYXlQZXJpb2QobiwgbykgOiBlLnNldFRpbWVQZXJpb2QobiwgbykpLCB0LmNvbG9yICYmIGUuc2V0KCJjb2xvciIsIHQuY29sb3IpLCB0LmJnQ29sb3IgJiYgZS5zZXQoImJnQ29sb3IiLCB0LmJnQ29sb3IpLCB0LmJvcmRlckNvbG9yICYmIGUuc2V0KCJib3JkZXJDb2xvciIsIHQuYm9yZGVyQ29sb3IpLCB0Lm9yaWdpbiAmJiBlLnNldCgib3JpZ2luIiwgdC5vcmlnaW4pLCBsLmlzVW5kZWZpbmVkKHQuaXNQZW5kaW5nKSB8fCBlLnNldCgiaXNQZW5kaW5nIiwgdC5pc1BlbmRpbmcpLCBsLmlzVW5kZWZpbmVkKHQuaXNGb2N1c2VkKSB8fCBlLnNldCgiaXNGb2N1c2VkIiwgdC5pc0ZvY3VzZWQpLCBsLmlzVW5kZWZpbmVkKHQuaXNSZWFkT25seSkgfHwgZS5zZXQoImlzUmVhZE9ubHkiLCB0LmlzUmVhZE9ubHkpLCB0LmxvY2F0aW9uICYmIGUuc2V0KCJsb2NhdGlvbiIsIHQubG9jYXRpb24pLCB0LnN0YXRlICYmIGUuc2V0KCJzdGF0ZSIsIHQuc3RhdGUpLCB0LnJhdyAmJiBlLnNldCgicmF3IiwgdC5yYXcpLCB0aGlzLl9yZW1vdmVGcm9tTWF0cml4KGUpLCB0aGlzLl9hZGRUb01hdHJpeChlKSwgdGhpcy5maXJlKCJ1cGRhdGVTY2hlZHVsZSIpLCBlOwogICAgfSwgYy5wcm90b3R5cGUuZGVsZXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gdGhpcy5fcmVtb3ZlRnJvbU1hdHJpeChlKSwgdGhpcy5zY2hlZHVsZXMucmVtb3ZlKGUpLCBlOwogICAgfSwgYy5wcm90b3R5cGUuX2FkZFRvTWF0cml4ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLmRhdGVNYXRyaXgsCiAgICAgICAgICBuID0gdGhpcy5fZ2V0Q29udGFpbkRhdGVzSW5TY2hlZHVsZShlKTsKCiAgICAgIGwuZm9yRWFjaChuLCBmdW5jdGlvbiAobikgewogICAgICAgIHZhciBvID0gYS5mb3JtYXQobiwgIllZWVlNTUREIik7CiAgICAgICAgKHRbb10gPSB0W29dIHx8IFtdKS5wdXNoKGwuc3RhbXAoZSkpOwogICAgICB9KTsKICAgIH0sIGMucHJvdG90eXBlLl9yZW1vdmVGcm9tTWF0cml4ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBsLnN0YW1wKGUpOwogICAgICBsLmZvckVhY2godGhpcy5kYXRlTWF0cml4LCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuID0gbC5pbkFycmF5KHQsIGUpOwogICAgICAgIH5uICYmIGUuc3BsaWNlKG4sIDEpOwogICAgICB9LCB0aGlzKTsKICAgIH0sIGMucHJvdG90eXBlLmFkZFNjaGVkdWxlID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIHRoaXMuc2NoZWR1bGVzLmFkZChlKSwgdGhpcy5fYWRkVG9NYXRyaXgoZSksIHQgfHwgdGhpcy5maXJlKCJhZGRlZFNjaGVkdWxlIiwgZSksIGU7CiAgICB9LCBjLnByb3RvdHlwZS5zcGxpdFNjaGVkdWxlQnlEYXRlUmFuZ2UgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IGEucmFuZ2UoYS5zdGFydChlKSwgYS5lbmQodCksIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLAogICAgICAgICAgaSA9IHRoaXMuZGF0ZU1hdHJpeCwKICAgICAgICAgIHMgPSB7fTsKICAgICAgcmV0dXJuIGwuZm9yRWFjaEFycmF5KG8sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG8gPSBhLmZvcm1hdChlLCAiWVlZWU1NREQiKSwKICAgICAgICAgICAgYyA9IGlbb107CiAgICAgICAgdCA9IHNbb10gPSByLmNyZWF0ZVNjaGVkdWxlQ29sbGVjdGlvbigpLCBjICYmIGMubGVuZ3RoICYmIGwuZm9yRWFjaEFycmF5KGMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBuLmRvV2hlbkhhcyhlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0LmFkZChlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KSwgczsKICAgIH0sIGMucHJvdG90eXBlLmZpbmRCeURhdGVSYW5nZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIHMsCiAgICAgICAgICBjID0gYS5yYW5nZShhLnN0YXJ0KGUpLCBhLmVuZCh0KSwgYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSksCiAgICAgICAgICB1ID0gdGhpcy5zY2hlZHVsZXMuaXRlbXMsCiAgICAgICAgICBkID0gdGhpcy5kYXRlTWF0cml4LAogICAgICAgICAgaCA9IGEuZm9ybWF0LAogICAgICAgICAgcCA9IHt9OwogICAgICByZXR1cm4gbC5mb3JFYWNoQXJyYXkoYywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBvID0gaChlLCAiWVlZWU1NREQiKSwgbiA9IGRbb10sIHMgPSBwW29dID0gci5jcmVhdGVTY2hlZHVsZUNvbGxlY3Rpb24oKSwgbiAmJiBuLmxlbmd0aCAmJiBzLmFkZC5hcHBseShzLCBsLm1hcChuLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGkuY3JlYXRlKHVbZV0pOwogICAgICAgIH0pKTsKICAgICAgfSksIHA7CiAgICB9LCBjLnByb3RvdHlwZS5jbGVhclNjaGVkdWxlcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kYXRlTWF0cml4ID0ge30sIHRoaXMuc2NoZWR1bGVzLmNsZWFyKCksIHRoaXMuZmlyZSgiY2xlYXJTY2hlZHVsZXMiKTsKICAgIH0sIGMucHJvdG90eXBlLnNldFRoZW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMudGhlbWUuc2V0U3R5bGVzKGUpOwogICAgfSwgYy5wcm90b3R5cGUuc2V0Q2FsZW5kYXJzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5jYWxlbmRhcnMgPSBlOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4oYyksIGUuZXhwb3J0cyA9IGM7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IGwuaXNFeGlzdHksCiAgICAgICAgaSA9IGwucGljaywKICAgICAgICBhID0gbC5pc0Z1bmN0aW9uLAogICAgICAgIHIgPSB7CiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGUsIHQpIHsKICAgICAgICB0aGlzW2VdICE9PSB0ICYmICh0aGlzW2VdID0gdCwgdGhpcy5fY2hhbmdlZCB8fCAodGhpcy5fY2hhbmdlZCA9IHt9KSwgdGhpcy5fY2hhbmdlZFtlXSA9ICEwLCB0aGlzLl9kaXJ0eSA9ICEwKTsKICAgICAgfSwKICAgICAgaXNEaXJ0eTogZnVuY3Rpb24gaXNEaXJ0eSgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9kaXJ0eTsKICAgICAgfSwKICAgICAgZGlydHk6IGZ1bmN0aW9uIGRpcnR5KGUpIHsKICAgICAgICAoZSA9ICFvKGUpIHx8IGUpIHx8ICh0aGlzLl9jaGFuZ2VkID0ge30pLCB0aGlzLl9kaXJ0eSA9IGU7CiAgICAgIH0sCiAgICAgIGRlbGV0ZVByb3A6IGZ1bmN0aW9uIGRlbGV0ZVByb3AoZSkgewogICAgICAgIGRlbGV0ZSB0aGlzW2VdLCB0aGlzLl9jaGFuZ2VkICYmIGRlbGV0ZSB0aGlzLl9jaGFuZ2VkW2VdOwogICAgICB9LAogICAgICBpc1Byb3BDaGFuZ2VkOiBmdW5jdGlvbiBpc1Byb3BDaGFuZ2VkKGUpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9jaGFuZ2VkICYmICEwID09PSB0aGlzLl9jaGFuZ2VkW2VdOwogICAgICB9LAogICAgICBtaXhpbjogZnVuY3Rpb24gbWl4aW4oZSkgewogICAgICAgIHZhciB0ID0gLyheX3xtaXhpbnx3cmFwKS87CiAgICAgICAgbC5mb3JFYWNoT3duUHJvcGVydGllcyhyLCBmdW5jdGlvbiAobiwgbCkgewogICAgICAgICAgdC50ZXN0KGwpIHx8IChlW2xdID0gcltsXSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHdyYXA6IGZ1bmN0aW9uIHdyYXAoZSwgdCwgbikgewogICAgICAgIHZhciBzLAogICAgICAgICAgICBjID0gci53cmFwOwogICAgICAgIGwuaXNPYmplY3QodCkgPyBsLmZvckVhY2hPd25Qcm9wZXJ0aWVzKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBjKGUsIG4sIHQpOwogICAgICAgIH0pIDogKG4gPSAhbyhuKSB8fCBuLCBlLl93cmFwcGVyIHx8IChlLl93cmFwcGVyID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSwKICAgICAgICAgICAgICAgIGwgPSBlLmFwcGx5KHRoaXMsIG4pOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlydHkgPSB0LCBsOwogICAgICAgICAgfTsKICAgICAgICB9KSwgbyhpKGUsIHQpKSAmJiBhKGVbdF0pICYmICFvKGkoZSwgdCwgIl93cmFwcGVkIikpICYmIChzID0gZVt0XSwgZVt0XSA9IGUuX3dyYXBwZXIocywgbiksIGVbdF0uX3dyYXBwZWQgPSAhMCkpOwogICAgICB9CiAgICB9OwogICAgZS5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsLAogICAgICAgIG8gPSBuKDQpLkRhdGUsCiAgICAgICAgaSA9IG4oMCksCiAgICAgICAgYSA9IC9eXHMqfFxzKiQvZywKICAgICAgICByID0gbigzKTsKICAgIGwgPSB7CiAgICAgIHRyaW06IGZ1bmN0aW9uIHRyaW0oZSkgewogICAgICAgIHJldHVybiBlLnJlcGxhY2UoYSwgIiIpOwogICAgICB9LAogICAgICB2YWxpZGF0b3JzOiB7CiAgICAgICAgcmVxdWlyZWQ6IGZ1bmN0aW9uIHJlcXVpcmVkKGUsIHQpIHsKICAgICAgICAgIHZhciBuID0gITA7CiAgICAgICAgICByZXR1cm4gaS5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBvOwogICAgICAgICAgICByZXR1cm4gbyA9IGVbdF0sIG4gPSAhaS5pc1VuZGVmaW5lZChvKSAmJiAiIiAhPT0gbC50cmltKG8pOwogICAgICAgICAgfSksIG47CiAgICAgICAgfSwKICAgICAgICBkYXRlUmFuZ2U6IGZ1bmN0aW9uIGRhdGVSYW5nZShlLCB0KSB7CiAgICAgICAgICB2YXIgbiwgbDsKICAgICAgICAgIHJldHVybiAhaS5pc0V4aXN0eShlKSB8fCAyICE9PSB0Lmxlbmd0aCB8fCAobiA9IG5ldyBvKGVbdFswXV0pLCBsID0gbmV3IG8oZVt0WzFdXSksICEoIXIuaXNWYWxpZChuKSB8fCAhci5pc1ZhbGlkKGwpKSAmJiAxICE9PSByLmNvbXBhcmUobiwgbCkpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaXNWYWxpZDogZnVuY3Rpb24gaXNWYWxpZCgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgdCA9IHRoaXMsCiAgICAgICAgICAgIG4gPSB0aGlzLmNvbnN0cnVjdG9yLnNjaGVtYSwKICAgICAgICAgICAgbyA9IGwudmFsaWRhdG9ycywKICAgICAgICAgICAgYSA9ICEwOwogICAgICAgIHJldHVybiAhbiB8fCAoaS5mb3JFYWNoKG4sIGZ1bmN0aW9uIChuLCBsKSB7CiAgICAgICAgICByZXR1cm4gIShlID0gb1tsXSkgfHwgKGEgPSBlKHQsIG4pKTsKICAgICAgICB9KSwgYSk7CiAgICAgIH0sCiAgICAgIHBhcmFtZXRlcml6ZTogZnVuY3Rpb24gcGFyYW1ldGVyaXplKCkgewogICAgICAgIHZhciBlID0ge30sCiAgICAgICAgICAgIHQgPSBpLmlzRnVuY3Rpb247CiAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCh0aGlzLCBmdW5jdGlvbiAobiwgbCkgewogICAgICAgICAgdChuKSB8fCAoZVtsXSA9IG4pOwogICAgICAgIH0pLCBlOwogICAgICB9LAogICAgICBtaXhpbjogZnVuY3Rpb24gbWl4aW4oZSkgewogICAgICAgIGkuZm9yRWFjaChsLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgIm1peGluIiAhPT0gbiAmJiAoZVtuXSA9IHQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCBlLmV4cG9ydHMgPSBsOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDU4KSwKICAgICAgICBpID0gbig1OSksCiAgICAgICAgYSA9IG4oNSk7CgogICAgZnVuY3Rpb24gcihlKSB7CiAgICAgIHZhciB0ID0gZSB8fCBvOwogICAgICB0aGlzLl9tYXAgPSBuZXcgbC5IYXNoTWFwKCksIHRoaXMuc2V0U3R5bGVzKHQpOwogICAgfQoKICAgIHIucHJvdG90eXBlLmdldFN0eWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX21hcC5nZXQoZSk7CiAgICB9LCByLnByb3RvdHlwZS5zZXRTdHlsZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0ge307CiAgICAgIHJldHVybiBuW2VdID0gdCwgMCA9PT0gdGhpcy5zZXRTdHlsZXMobikubGVuZ3RoOwogICAgfSwgci5wcm90b3R5cGUuc2V0U3R5bGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBbXTsKICAgICAgcmV0dXJuIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSwgbikgewogICAgICAgIGwuaXNVbmRlZmluZWQoaVtuXSkgPyB0LnB1c2gobikgOiAodGhpcy5fbWFwLnNldChuLCBlKSwgYS5zZXQodGhpcywgbiwgZSkpOwogICAgICB9LCB0aGlzKSwgbC5mb3JFYWNoKGksIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdGhpcy5nZXRTdHlsZSh0KSB8fCAodGhpcy5fbWFwLnNldCh0LCBlKSwgYS5zZXQodGhpcywgdCwgZSkpOwogICAgICB9LCB0aGlzKSwgdDsKICAgIH0sIHIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuX21hcC5rZXlzKCksCiAgICAgICAgICB0ID0ge307CgogICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiA9IGUuc3BsaXQoIi4iKVswXTsKICAgICAgICB0W25dIHx8ICh0W25dID0gbik7CiAgICAgIH0pLCBsLmZvckVhY2godCwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBkZWxldGUgdGhpc1tlXTsKICAgICAgfSwgdGhpcyksIHRoaXMuX21hcC5yZW1vdmVBbGwoKTsKICAgIH0sIGUuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBlLmV4cG9ydHMgPSB7CiAgICAgICJjb21tb24uYm9yZGVyIjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgImNvbW1vbi5iYWNrZ3JvdW5kQ29sb3IiOiAid2hpdGUiLAogICAgICAiY29tbW9uLmhvbGlkYXkuY29sb3IiOiAiI2ZmNDA0MCIsCiAgICAgICJjb21tb24uc2F0dXJkYXkuY29sb3IiOiAiIzMzMyIsCiAgICAgICJjb21tb24uZGF5bmFtZS5jb2xvciI6ICIjMzMzIiwKICAgICAgImNvbW1vbi50b2RheS5jb2xvciI6ICIjMzMzIiwKICAgICAgImNvbW1vbi5jcmVhdGlvbkd1aWRlLmJhY2tncm91bmRDb2xvciI6ICJyZ2JhKDgxLCA5MiwgMjMwLCAwLjA1KSIsCiAgICAgICJjb21tb24uY3JlYXRpb25HdWlkZS5ib3JkZXIiOiAiMXB4IHNvbGlkICM1MTVjZTYiLAogICAgICAibW9udGguZGF5bmFtZS5oZWlnaHQiOiAiMzFweCIsCiAgICAgICJtb250aC5kYXluYW1lLmJvcmRlckxlZnQiOiAibm9uZSIsCiAgICAgICJtb250aC5kYXluYW1lLnBhZGRpbmdMZWZ0IjogIjEwcHgiLAogICAgICAibW9udGguZGF5bmFtZS5wYWRkaW5nUmlnaHQiOiAiMCIsCiAgICAgICJtb250aC5kYXluYW1lLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIm1vbnRoLmRheW5hbWUuZm9udFNpemUiOiAiMTJweCIsCiAgICAgICJtb250aC5kYXluYW1lLmZvbnRXZWlnaHQiOiAibm9ybWFsIiwKICAgICAgIm1vbnRoLmRheW5hbWUudGV4dEFsaWduIjogImxlZnQiLAogICAgICAibW9udGguaG9saWRheUV4Y2VwdFRoaXNNb250aC5jb2xvciI6ICJyZ2JhKDI1NSwgNjQsIDY0LCAwLjQpIiwKICAgICAgIm1vbnRoLmRheUV4Y2VwdFRoaXNNb250aC5jb2xvciI6ICJyZ2JhKDUxLCA1MSwgNTEsIDAuNCkiLAogICAgICAibW9udGgud2Vla2VuZC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJtb250aC5kYXkuZm9udFNpemUiOiAiMTRweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5ib3JkZXJSYWRpdXMiOiAiMnB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLmhlaWdodCI6ICIyNHB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLm1hcmdpblRvcCI6ICIycHgiLAogICAgICAibW9udGguc2NoZWR1bGUubWFyZ2luTGVmdCI6ICI4cHgiLAogICAgICAibW9udGguc2NoZWR1bGUubWFyZ2luUmlnaHQiOiAiOHB4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LmJvcmRlciI6ICIxcHggc29saWQgI2Q1ZDVkNSIsCiAgICAgICJtb250aC5tb3JlVmlldy5ib3hTaGFkb3ciOiAiMCAycHggNnB4IDAgcmdiYSgwLCAwLCAwLCAwLjEpIiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LmJhY2tncm91bmRDb2xvciI6ICJ3aGl0ZSIsCiAgICAgICJtb250aC5tb3JlVmlldy5wYWRkaW5nQm90dG9tIjogIjE3cHgiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5oZWlnaHQiOiAiNDRweCIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLm1hcmdpbkJvdHRvbSI6ICIxMnB4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUuYm9yZGVyQm90dG9tIjogIm5vbmUiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5wYWRkaW5nIjogIjEycHggMTdweCAwIDE3cHgiLAogICAgICAibW9udGgubW9yZVZpZXdMaXN0LnBhZGRpbmciOiAiMCAxN3B4IiwKICAgICAgIndlZWsuZGF5bmFtZS5oZWlnaHQiOiAiNDJweCIsCiAgICAgICJ3ZWVrLmRheW5hbWUuYm9yZGVyVG9wIjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsuZGF5bmFtZS5ib3JkZXJCb3R0b20iOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay5kYXluYW1lLmJvcmRlckxlZnQiOiAibm9uZSIsCiAgICAgICJ3ZWVrLmRheW5hbWUucGFkZGluZ0xlZnQiOiAiMCIsCiAgICAgICJ3ZWVrLmRheW5hbWUuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXluYW1lLnRleHRBbGlnbiI6ICJsZWZ0IiwKICAgICAgIndlZWsudG9kYXkuY29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLnBhc3REYXkuY29sb3IiOiAiI2JiYiIsCiAgICAgICJ3ZWVrLnZwYW5lbFNwbGl0dGVyLmJvcmRlciI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnZwYW5lbFNwbGl0dGVyLmhlaWdodCI6ICIzcHgiLAogICAgICAid2Vlay5kYXlncmlkLmJvcmRlclJpZ2h0IjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsuZGF5Z3JpZC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLmRheWdyaWRMZWZ0LndpZHRoIjogIjcycHgiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLmRheWdyaWRMZWZ0LnBhZGRpbmdSaWdodCI6ICI4cHgiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRvZGF5LmJhY2tncm91bmRDb2xvciI6ICJyZ2JhKDgxLCA5MiwgMjMwLCAwLjA1KSIsCiAgICAgICJ3ZWVrLndlZWtlbmQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQud2lkdGgiOiAiNzJweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkTGVmdC5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkTGVmdC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkTGVmdC5mb250U2l6ZSI6ICIxMXB4IiwKICAgICAgIndlZWsudGltZWdyaWRPbmVIb3VyLmhlaWdodCI6ICI1MnB4IiwKICAgICAgIndlZWsudGltZWdyaWRIYWxmSG91ci5oZWlnaHQiOiAiMjZweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkSGFsZkhvdXIuYm9yZGVyQm90dG9tIjogIm5vbmUiLAogICAgICAid2Vlay50aW1lZ3JpZEhvcml6b250YWxMaW5lLmJvcmRlckJvdHRvbSI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkLnBhZGRpbmdSaWdodCI6ICI4cHgiLAogICAgICAid2Vlay50aW1lZ3JpZC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkU2NoZWR1bGUuYm9yZGVyUmFkaXVzIjogIjJweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkU2NoZWR1bGUucGFkZGluZ0xlZnQiOiAiMnB4IiwKICAgICAgIndlZWsuY3VycmVudFRpbWUuY29sb3IiOiAiIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lLmZvbnRTaXplIjogIjExcHgiLAogICAgICAid2Vlay5jdXJyZW50VGltZS5mb250V2VpZ2h0IjogIm5vcm1hbCIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lTGluZVBhc3QuYm9yZGVyIjogIjFweCBkYXNoZWQgIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lTGluZUJ1bGxldC5iYWNrZ3JvdW5kQ29sb3IiOiAiIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lTGluZVRvZGF5LmJvcmRlciI6ICIxcHggc29saWQgIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lTGluZUZ1dHVyZS5ib3JkZXIiOiAibm9uZSIsCiAgICAgICJ3ZWVrLmNyZWF0aW9uR3VpZGUuY29sb3IiOiAiIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmNyZWF0aW9uR3VpZGUuZm9udFNpemUiOiAiMTFweCIsCiAgICAgICJ3ZWVrLmNyZWF0aW9uR3VpZGUuZm9udFdlaWdodCI6ICJib2xkIiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLmJvcmRlclJhZGl1cyI6ICIycHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUuaGVpZ2h0IjogIjI0cHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUubWFyZ2luVG9wIjogIjJweCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5tYXJnaW5MZWZ0IjogIjhweCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5tYXJnaW5SaWdodCI6ICI4cHgiCiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZS5leHBvcnRzID0gewogICAgICAiY29tbW9uLmJvcmRlciI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJjb21tb24uYmFja2dyb3VuZENvbG9yIjogIndoaXRlIiwKICAgICAgImNvbW1vbi5ob2xpZGF5LmNvbG9yIjogIiNmZjQwNDAiLAogICAgICAiY29tbW9uLnNhdHVyZGF5LmNvbG9yIjogIiMzMzMiLAogICAgICAiY29tbW9uLmRheW5hbWUuY29sb3IiOiAiIzMzMyIsCiAgICAgICJjb21tb24udG9kYXkuY29sb3IiOiAiIzMzMyIsCiAgICAgICJjb21tb24uY3JlYXRpb25HdWlkZS5iYWNrZ3JvdW5kQ29sb3IiOiAicmdiYSg4MSwgOTIsIDIzMCwgMC4wNSkiLAogICAgICAiY29tbW9uLmNyZWF0aW9uR3VpZGUuYm9yZGVyIjogIjFweCBzb2xpZCAjNTE1Y2U2IiwKICAgICAgIm1vbnRoLmRheW5hbWUuaGVpZ2h0IjogIjMxcHgiLAogICAgICAibW9udGguZGF5bmFtZS5ib3JkZXJMZWZ0IjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIm1vbnRoLmRheW5hbWUucGFkZGluZ0xlZnQiOiAiMTBweCIsCiAgICAgICJtb250aC5kYXluYW1lLnBhZGRpbmdSaWdodCI6ICIxMHB4IiwKICAgICAgIm1vbnRoLmRheW5hbWUuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAibW9udGguZGF5bmFtZS5mb250U2l6ZSI6ICIxMnB4IiwKICAgICAgIm1vbnRoLmRheW5hbWUuZm9udFdlaWdodCI6ICJub3JtYWwiLAogICAgICAibW9udGguZGF5bmFtZS50ZXh0QWxpZ24iOiAibGVmdCIsCiAgICAgICJtb250aC5ob2xpZGF5RXhjZXB0VGhpc01vbnRoLmNvbG9yIjogInJnYmEoMjU1LCA2NCwgNjQsIDAuNCkiLAogICAgICAibW9udGguZGF5RXhjZXB0VGhpc01vbnRoLmNvbG9yIjogInJnYmEoNTEsIDUxLCA1MSwgMC40KSIsCiAgICAgICJtb250aC53ZWVrZW5kLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIm1vbnRoLmRheS5mb250U2l6ZSI6ICIxNHB4IiwKICAgICAgIm1vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cyI6ICIycHgiLAogICAgICAibW9udGguc2NoZWR1bGUuaGVpZ2h0IjogIjI0cHgiLAogICAgICAibW9udGguc2NoZWR1bGUubWFyZ2luVG9wIjogIjJweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5tYXJnaW5MZWZ0IjogIjhweCIsCiAgICAgICJtb250aC5zY2hlZHVsZS5tYXJnaW5SaWdodCI6ICI4cHgiLAogICAgICAibW9udGgubW9yZVZpZXcuYm9yZGVyIjogIjFweCBzb2xpZCAjZDVkNWQ1IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LmJveFNoYWRvdyI6ICIwIDJweCA2cHggMCByZ2JhKDAsIDAsIDAsIDAuMSkiLAogICAgICAibW9udGgubW9yZVZpZXcuYmFja2dyb3VuZENvbG9yIjogIndoaXRlIiwKICAgICAgIm1vbnRoLm1vcmVWaWV3LnBhZGRpbmdCb3R0b20iOiAiMTdweCIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLmhlaWdodCI6ICI0NHB4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUubWFyZ2luQm90dG9tIjogIjEycHgiLAogICAgICAibW9udGgubW9yZVZpZXdUaXRsZS5iYWNrZ3JvdW5kQ29sb3IiOiAiaW5oZXJpdCIsCiAgICAgICJtb250aC5tb3JlVmlld1RpdGxlLmJvcmRlckJvdHRvbSI6ICJub25lIiwKICAgICAgIm1vbnRoLm1vcmVWaWV3VGl0bGUucGFkZGluZyI6ICIxMnB4IDE3cHggMCAxN3B4IiwKICAgICAgIm1vbnRoLm1vcmVWaWV3TGlzdC5wYWRkaW5nIjogIjAgMTdweCIsCiAgICAgICJ3ZWVrLmRheW5hbWUuaGVpZ2h0IjogIjQycHgiLAogICAgICAid2Vlay5kYXluYW1lLmJvcmRlclRvcCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLmRheW5hbWUuYm9yZGVyQm90dG9tIjogIjFweCBzb2xpZCAjZTVlNWU1IiwKICAgICAgIndlZWsuZGF5bmFtZS5ib3JkZXJMZWZ0IjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXluYW1lLnBhZGRpbmdMZWZ0IjogIjAiLAogICAgICAid2Vlay5kYXluYW1lLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsuZGF5bmFtZS50ZXh0QWxpZ24iOiAibGVmdCIsCiAgICAgICJ3ZWVrLnRvZGF5LmNvbG9yIjogIiMzMzMiLAogICAgICAid2Vlay5wYXN0RGF5LmNvbG9yIjogIiNiYmIiLAogICAgICAid2Vlay52cGFuZWxTcGxpdHRlci5ib3JkZXIiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay52cGFuZWxTcGxpdHRlci5oZWlnaHQiOiAiM3B4IiwKICAgICAgIndlZWsuZGF5Z3JpZC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLmRheWdyaWQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC53aWR0aCI6ICI3MnB4IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay5kYXlncmlkTGVmdC5wYWRkaW5nUmlnaHQiOiAiOHB4IiwKICAgICAgIndlZWsuZGF5Z3JpZExlZnQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50b2RheS5iYWNrZ3JvdW5kQ29sb3IiOiAicmdiYSg4MSwgOTIsIDIzMCwgMC4wNSkiLAogICAgICAid2Vlay53ZWVrZW5kLmJhY2tncm91bmRDb2xvciI6ICJpbmhlcml0IiwKICAgICAgIndlZWsudGltZWdyaWRMZWZ0LndpZHRoIjogIjcycHgiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuYmFja2dyb3VuZENvbG9yIjogImluaGVyaXQiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuYm9yZGVyUmlnaHQiOiAiMXB4IHNvbGlkICNlNWU1ZTUiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnQuZm9udFNpemUiOiAiMTFweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkTGVmdFRpbWV6b25lTGFiZWwuaGVpZ2h0IjogIjQwcHgiLAogICAgICAid2Vlay50aW1lZ3JpZExlZnRBZGRpdGlvbmFsVGltZXpvbmUuYmFja2dyb3VuZENvbG9yIjogIndoaXRlIiwKICAgICAgIndlZWsudGltZWdyaWRPbmVIb3VyLmhlaWdodCI6ICI1MnB4IiwKICAgICAgIndlZWsudGltZWdyaWRIYWxmSG91ci5oZWlnaHQiOiAiMjZweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkSGFsZkhvdXIuYm9yZGVyQm90dG9tIjogIm5vbmUiLAogICAgICAid2Vlay50aW1lZ3JpZEhvcml6b250YWxMaW5lLmJvcmRlckJvdHRvbSI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkLnBhZGRpbmdSaWdodCI6ICI4cHgiLAogICAgICAid2Vlay50aW1lZ3JpZC5ib3JkZXJSaWdodCI6ICIxcHggc29saWQgI2U1ZTVlNSIsCiAgICAgICJ3ZWVrLnRpbWVncmlkU2NoZWR1bGUuYm9yZGVyUmFkaXVzIjogIjJweCIsCiAgICAgICJ3ZWVrLnRpbWVncmlkU2NoZWR1bGUucGFkZGluZ0xlZnQiOiAiMnB4IiwKICAgICAgIndlZWsuY3VycmVudFRpbWUuY29sb3IiOiAiIzUxNWNlNiIsCiAgICAgICJ3ZWVrLmN1cnJlbnRUaW1lLmZvbnRTaXplIjogIjExcHgiLAogICAgICAid2Vlay5jdXJyZW50VGltZS5mb250V2VpZ2h0IjogIm5vcm1hbCIsCiAgICAgICJ3ZWVrLnBhc3RUaW1lLmNvbG9yIjogIiNiYmIiLAogICAgICAid2Vlay5wYXN0VGltZS5mb250V2VpZ2h0IjogIm5vcm1hbCIsCiAgICAgICJ3ZWVrLmZ1dHVyZVRpbWUuY29sb3IiOiAiIzMzMyIsCiAgICAgICJ3ZWVrLmZ1dHVyZVRpbWUuZm9udFdlaWdodCI6ICJub3JtYWwiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVQYXN0LmJvcmRlciI6ICIxcHggZGFzaGVkICM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVCdWxsZXQuYmFja2dyb3VuZENvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVUb2RheS5ib3JkZXIiOiAiMXB4IHNvbGlkICM1MTVjZTYiLAogICAgICAid2Vlay5jdXJyZW50VGltZUxpbmVGdXR1cmUuYm9yZGVyIjogIm5vbmUiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmNvbG9yIjogIiM1MTVjZTYiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmZvbnRTaXplIjogIjExcHgiLAogICAgICAid2Vlay5jcmVhdGlvbkd1aWRlLmZvbnRXZWlnaHQiOiAiYm9sZCIsCiAgICAgICJ3ZWVrLmRheUdyaWRTY2hlZHVsZS5ib3JkZXJSYWRpdXMiOiAiMnB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLmhlaWdodCI6ICIyNHB4IiwKICAgICAgIndlZWsuZGF5R3JpZFNjaGVkdWxlLm1hcmdpblRvcCI6ICIycHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUubWFyZ2luTGVmdCI6ICI4cHgiLAogICAgICAid2Vlay5kYXlHcmlkU2NoZWR1bGUubWFyZ2luUmlnaHQiOiAiOHB4IgogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbC5mb3JFYWNoQXJyYXksCiAgICAgICAgaSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbig0KS5EYXRlLAogICAgICAgIHMgPSBuKDEzKSwKICAgICAgICBjID0gbigyOCksCiAgICAgICAgdSA9IHsKICAgICAgZ2V0Q29sbGlzaW9uR3JvdXA6IGZ1bmN0aW9uIGdldENvbGxpc2lvbkdyb3VwKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiA9IFtdLAogICAgICAgICAgICBhID0gITE7CiAgICAgICAgcmV0dXJuIGUubGVuZ3RoID8gKG5bMF0gPSBbbC5zdGFtcChlWzBdLnZhbHVlT2YoKSldLCBvKGUuc2xpY2UoMSksIGZ1bmN0aW9uIChyLCBzKSB7CiAgICAgICAgICBhID0gITEsIHQgPSBpLmFwcGx5KGUsIFswLCBzICsgMV0pLnJldmVyc2UoKSwgbyh0LCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gIXIuY29sbGlkZXNXaXRoKGUpIHx8IChhID0gITAsIG8obi5zbGljZSgwKS5yZXZlcnNlKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuICF+bC5pbkFycmF5KGwuc3RhbXAoZS52YWx1ZU9mKCkpLCB0KSB8fCAodC5wdXNoKGwuc3RhbXAoci52YWx1ZU9mKCkpKSwgITEpOwogICAgICAgICAgICB9KSwgITEpOwogICAgICAgICAgfSksIGEgfHwgbi5wdXNoKFtsLnN0YW1wKHIudmFsdWVPZigpKV0pOwogICAgICAgIH0pLCBuKSA6IG47CiAgICAgIH0sCiAgICAgIGdldExhc3RSb3dJbkNvbHVtbjogZnVuY3Rpb24gZ2V0TGFzdFJvd0luQ29sdW1uKGUsIHQpIHsKICAgICAgICBmb3IgKHZhciBuID0gZS5sZW5ndGg7IG4gPiAwOykgewogICAgICAgICAgaWYgKG4gLT0gMSwgIWwuaXNVbmRlZmluZWQoZVtuXVt0XSkpIHJldHVybiBuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICExOwogICAgICB9LAogICAgICBnZXRNYXRyaWNlczogZnVuY3Rpb24gZ2V0TWF0cmljZXMoZSwgdCkgewogICAgICAgIHZhciBuID0gW10sCiAgICAgICAgICAgIGkgPSB1LmdldExhc3RSb3dJbkNvbHVtbjsKICAgICAgICByZXR1cm4gbyh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGEgPSBbW11dOwogICAgICAgICAgbyh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICBmb3IgKHZhciBuLCBvLCByID0gZS5pdGVtc1t0XSwgcyA9IDAsIGMgPSAhMTsgIWM7KSB7CiAgICAgICAgICAgICAgITEgPT09IChvID0gaShhLCBzKSkgPyAoYVswXS5wdXNoKHIpLCBjID0gITApIDogci5jb2xsaWRlc1dpdGgoYVtvXVtzXSkgfHwgKG4gPSBvICsgMSwgbC5pc1VuZGVmaW5lZChhW25dKSAmJiAoYVtuXSA9IFtdKSwgYVtuXVtzXSA9IHIsIGMgPSAhMCksIHMgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgfSksIG4ucHVzaChhKTsKICAgICAgICB9KSwgbjsKICAgICAgfSwKICAgICAgZ2V0U2NoZWR1bGVJbkRhdGVSYW5nZUZpbHRlcjogZnVuY3Rpb24gZ2V0U2NoZWR1bGVJbkRhdGVSYW5nZUZpbHRlcihlLCB0KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB2YXIgbCA9IG4uZ2V0U3RhcnRzKCk7CiAgICAgICAgICByZXR1cm4gIShuLmdldEVuZHMoKSA8IGUgfHwgbCA+IHQpOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHBvc2l0aW9uVmlld01vZGVsczogZnVuY3Rpb24gcG9zaXRpb25WaWV3TW9kZWxzKGUsIHQsIG4sIGkpIHsKICAgICAgICB2YXIgciwgczsKICAgICAgICByID0gbC5tYXAoYS5yYW5nZShlLCB0LCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBhLmZvcm1hdChlLCAiWVlZWU1NREQiKTsKICAgICAgICB9KSwgbyhuLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbyhlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBvKGUsIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICAgICAgdmFyIG4sIG87CiAgICAgICAgICAgICAgZSAmJiAobiA9IGEuZm9ybWF0KGUuZ2V0U3RhcnRzKCksICJZWVlZTU1ERCIpLCBzID0gZS5oYXNNdWx0aURhdGVzID8gYS5lbmQoZS5nZXRFbmRzKCkpIDogYS5jb252ZXJ0U3RhcnREYXlUb0xhc3REYXkoZS5nZXRFbmRzKCkpLCBvID0gYS5yYW5nZShhLnN0YXJ0KGUuZ2V0U3RhcnRzKCkpLCBzLCBhLk1JTExJU0VDT05EU19QRVJfREFZKS5sZW5ndGgsIGUudG9wID0gdCwgZS5sZWZ0ID0gbC5pbkFycmF5KG4sIHIpLCBlLndpZHRoID0gbywgaSAmJiBpKGUpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgbGltaXRSZW5kZXJSYW5nZTogZnVuY3Rpb24gbGltaXRSZW5kZXJSYW5nZShlLCB0LCBuKSB7CiAgICAgICAgZnVuY3Rpb24gbChuKSB7CiAgICAgICAgICByZXR1cm4gbi5nZXRTdGFydHMoKSA8IGUgJiYgKG4uZXhjZWVkTGVmdCA9ICEwLCBuLnJlbmRlclN0YXJ0cyA9IG5ldyByKGUpKSwgbi5nZXRFbmRzKCkgPiB0ICYmIChuLmV4Y2VlZFJpZ2h0ID0gITAsIG4ucmVuZGVyRW5kcyA9IG5ldyByKHQpKSwgbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuLmNvbnN0cnVjdG9yID09PSBzID8gKG4uZWFjaChsKSwgbnVsbCkgOiBsKG4pOwogICAgICB9LAogICAgICBjb252ZXJ0VG9WaWV3TW9kZWw6IGZ1bmN0aW9uIGNvbnZlcnRUb1ZpZXdNb2RlbChlKSB7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgcmV0dXJuIHQgPSBuZXcgcyhmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGUuY2lkKCk7CiAgICAgICAgfSksIGUuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdC5hZGQoYy5jcmVhdGUoZSkpOwogICAgICAgIH0pLCB0OwogICAgICB9CiAgICB9OwogICAgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigxMyksCiAgICAgICAgaSA9IG4oMTUpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDQpLkRhdGUsCiAgICAgICAgcyA9IGEuTUlMTElTRUNPTkRTX1NDSEVEVUxFX01JTl9EVVJBVElPTiwKICAgICAgICBjID0gewogICAgICBnZW5lcmF0ZVRpbWVBcnJheUluUm93OiBmdW5jdGlvbiBnZW5lcmF0ZVRpbWVBcnJheUluUm93KGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgbywKICAgICAgICAgICAgaSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgYyA9IFtdLAogICAgICAgICAgICB1ID0gW10sCiAgICAgICAgICAgIGQgPSBNYXRoLm1heC5hcHBseShudWxsLCBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGUubGVuZ3RoOwogICAgICAgIH0pKTsKCiAgICAgICAgZm9yIChuID0gMTsgbiA8IGQ7IG4gKz0gMSkgewogICAgICAgICAgZm9yICh0ID0gMCwgbyA9IGwucGljayhlLCB0LCBuKTsgbzspIHsKICAgICAgICAgICAgaSA9IG8uZ2V0U3RhcnRzKCkuZ2V0VGltZSgpIC0gYS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgby52YWx1ZU9mKCkuZ29pbmdEdXJhdGlvbiksIHIgPSBvLmdldEVuZHMoKS5nZXRUaW1lKCkgKyBhLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCBvLnZhbHVlT2YoKS5jb21pbmdEdXJhdGlvbiksIE1hdGguYWJzKHIgLSBpKSA8IHMgJiYgKHIgKz0gcyksIHUucHVzaChbaSwgcl0pLCB0ICs9IDEsIG8gPSBsLnBpY2soZSwgdCwgbik7CiAgICAgICAgICB9CgogICAgICAgICAgYy5wdXNoKHUpLCB1ID0gW107CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYzsKICAgICAgfSwKICAgICAgaGFzQ29sbGlkZTogZnVuY3Rpb24gaGFzQ29sbGlkZShlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwsCiAgICAgICAgICAgIG8sCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMgPSBmdW5jdGlvbiBzKGUpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdFtlXTsKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICAgICAgYyA9IE1hdGguYWJzLAogICAgICAgICAgICB1ID0gaS5jb21wYXJlLm51bS5hc2M7CgogICAgICAgIHJldHVybiAhIWUubGVuZ3RoICYmIChsID0gYyhpLmJzZWFyY2goZSwgdCwgcygwKSwgdSkpLCBvID0gYyhpLmJzZWFyY2goZSwgdCwgcygxKSwgdSkpLCBhID0gYyhpLmJzZWFyY2goZSwgbiwgcygwKSwgdSkpLCByID0gYyhpLmJzZWFyY2goZSwgbiwgcygxKSwgdSkpLCAhKGwgPT09IG8gJiYgbyA9PT0gYSAmJiBhID09PSByKSk7CiAgICAgIH0sCiAgICAgIGdldENvbGxpZGVzOiBmdW5jdGlvbiBnZXRDb2xsaWRlcyhlKSB7CiAgICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciB0LCBuOwogICAgICAgICAgdCA9IGMuZ2VuZXJhdGVUaW1lQXJyYXlJblJvdyhlKSwgbiA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGwubWFwKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHJldHVybiBlLmxlbmd0aDsKICAgICAgICAgIH0pKSwgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUsIGwpIHsKICAgICAgICAgICAgICB2YXIgbywgaSwgcjsKICAgICAgICAgICAgICBpZiAoZSkgZm9yIChvID0gZS5nZXRTdGFydHMoKS5nZXRUaW1lKCksIGkgPSBlLmdldEVuZHMoKS5nZXRUaW1lKCksIE1hdGguYWJzKGkgLSBvKSA8IHMgJiYgKGkgKz0gcyksIG8gLT0gYS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgZS52YWx1ZU9mKCkuZ29pbmdEdXJhdGlvbiksIGkgKz0gYS5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgZS52YWx1ZU9mKCkuY29taW5nRHVyYXRpb24pLCBpIC09IDEsIHIgPSBsICsgMTsgciA8IG47IHIgKz0gMSkgewogICAgICAgICAgICAgICAgaWYgKGMuaGFzQ29sbGlkZSh0W3IgLSAxXSwgbywgaSkpIHsKICAgICAgICAgICAgICAgICAgZS5oYXNDb2xsaWRlID0gITA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGUuZXh0cmFTcGFjZSArPSAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZ2V0Vmlld01vZGVsRm9yVGltZVZpZXc6IGZ1bmN0aW9uIGdldFZpZXdNb2RlbEZvclRpbWVWaWV3KGUsIHQsIG4sIG8sIGkpIHsKICAgICAgICB2YXIgYSA9IHRoaXMsCiAgICAgICAgICAgIHIgPSB0aGlzLnNwbGl0U2NoZWR1bGVCeURhdGVSYW5nZShlLCB0LCBuKSwKICAgICAgICAgICAgcyA9IHt9LAogICAgICAgICAgICB1ID0gYy5fbWFrZUdldFZpZXdNb2RlbEZ1bmNGb3JUaW1lVmlldyhvLCBpKTsKCiAgICAgICAgcmV0dXJuIGwuZm9yRWFjaChyLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICBvID0gdShlKTsKICAgICAgICAgIG4gPSBhLkNvcmUuZ2V0Q29sbGlzaW9uR3JvdXAobyksIGwgPSBhLkNvcmUuZ2V0TWF0cmljZXMoZSwgbiksIGEuV2Vlay5nZXRDb2xsaWRlcyhsKSwgc1t0XSA9IGw7CiAgICAgICAgfSksIHM7CiAgICAgIH0sCiAgICAgIF9tYWtlR2V0Vmlld01vZGVsRnVuY0ZvclRpbWVWaWV3OiBmdW5jdGlvbiBfbWFrZUdldFZpZXdNb2RlbEZ1bmNGb3JUaW1lVmlldyhlLCB0KSB7CiAgICAgICAgcmV0dXJuIDAgPT09IGUgJiYgMjQgPT09IHQgPyBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGUuc29ydChpLmNvbXBhcmUuc2NoZWR1bGUuYXNjKTsKICAgICAgICB9IDogZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHJldHVybiBuLmZpbmQoYy5fbWFrZUhvdXJSYW5nZUZpbHRlcihlLCB0KSkuc29ydChpLmNvbXBhcmUuc2NoZWR1bGUuYXNjKTsKICAgICAgICB9OwogICAgICB9LAogICAgICBfbWFrZUhvdXJSYW5nZUZpbHRlcjogZnVuY3Rpb24gX21ha2VIb3VyUmFuZ2VGaWx0ZXIoZSwgdCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICAgICAgdmFyIGwgPSBuLm1vZGVsLnN0YXJ0LAogICAgICAgICAgICAgIG8gPSBuLm1vZGVsLmVuZCwKICAgICAgICAgICAgICBpID0gbC5nZXRGdWxsWWVhcigpLAogICAgICAgICAgICAgIGEgPSBsLmdldE1vbnRoKCksCiAgICAgICAgICAgICAgcyA9IGwuZ2V0RGF0ZSgpLAogICAgICAgICAgICAgIGMgPSBuZXcgcihpLCBhLCBzKS5zZXRIb3VycyhlKSwKICAgICAgICAgICAgICB1ID0gbmV3IHIoaSwgYSwgcykuc2V0SG91cnModCk7CiAgICAgICAgICByZXR1cm4gbCA+PSBjICYmIGwgPCB1IHx8IG8gPiBjICYmIG8gPD0gdSB8fCBsIDwgYyAmJiBvID4gYyB8fCBvID4gdSAmJiBsIDwgdTsKICAgICAgICB9OwogICAgICB9LAogICAgICBfYWRkTXVsdGlEYXRlc0luZm86IGZ1bmN0aW9uIF9hZGRNdWx0aURhdGVzSW5mbyhlKSB7CiAgICAgICAgZS5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCA9IGUubW9kZWw7CiAgICAgICAgICBlLmhhc011bHRpRGF0ZXMgPSAhMCwgZS5yZW5kZXJTdGFydHMgPSBhLnN0YXJ0KHQuZ2V0U3RhcnRzKCkpLCBlLnJlbmRlckVuZHMgPSBhLmNvbnZlcnRTdGFydERheVRvTGFzdERheSh0LmdldEVuZHMoKSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGdldFZpZXdNb2RlbEZvckFsbGRheVZpZXc6IGZ1bmN0aW9uIGdldFZpZXdNb2RlbEZvckFsbGRheVZpZXcoZSwgdCwgbikgewogICAgICAgIHZhciBsLAogICAgICAgICAgICBvLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gdGhpcy5Db3JlLAogICAgICAgICAgICBzID0gdGhpcy5XZWVrOwogICAgICAgIHJldHVybiBuICYmIG4ubGVuZ3RoID8gKHMuX2FkZE11bHRpRGF0ZXNJbmZvKG4pLCByLmxpbWl0UmVuZGVyUmFuZ2UoZSwgdCwgbiksIGwgPSBuLnNvcnQoaS5jb21wYXJlLnNjaGVkdWxlLmFzYyksIG8gPSByLmdldENvbGxpc2lvbkdyb3VwKGwpLCBhID0gci5nZXRNYXRyaWNlcyhuLCBvKSwgci5wb3NpdGlvblZpZXdNb2RlbHMoZSwgdCwgYSksIGEpIDogW107CiAgICAgIH0sCiAgICAgIGZpbmRCeURhdGVSYW5nZTogZnVuY3Rpb24gZmluZEJ5RGF0ZVJhbmdlKGUsIHQsIG4sIGksIGEpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgcywKICAgICAgICAgICAgYyA9IHRoaXMuQ29yZSwKICAgICAgICAgICAgdSA9IHRoaXMuV2VlaywKICAgICAgICAgICAgZCA9IGMuZ2V0U2NoZWR1bGVJbkRhdGVSYW5nZUZpbHRlcihlLCB0KSwKICAgICAgICAgICAgaCA9IGwucGx1Y2sobiwgIm5hbWUiKSwKICAgICAgICAgICAgcCA9IGwucGljayhhLCAiaG91clN0YXJ0IiksCiAgICAgICAgICAgIG0gPSBsLnBpY2soYSwgImhvdXJFbmQiKTsKICAgICAgICByZXR1cm4gaSA9IGkgfHwgW10sIGQgPSBvLmFuZC5hcHBseShudWxsLCBbZF0uY29uY2F0KGkpKSwgciA9IHRoaXMuc2NoZWR1bGVzLmZpbmQoZCksIHIgPSBjLmNvbnZlcnRUb1ZpZXdNb2RlbChyKSwgcyA9IHIuZ3JvdXBCeShoLCB0aGlzLmdyb3VwRnVuYyksIGwuZm9yRWFjaChuLCBmdW5jdGlvbiAobikgewogICAgICAgICAgdmFyIGwgPSBuLm5hbWU7CiAgICAgICAgICAiZGF5Z3JpZCIgPT09IG4udHlwZSA/IHNbbF0gPSB1LmdldFZpZXdNb2RlbEZvckFsbGRheVZpZXcoZSwgdCwgc1tsXSkgOiAidGltZWdyaWQiID09PSBuLnR5cGUgJiYgKHNbbF0gPSB1LmdldFZpZXdNb2RlbEZvclRpbWVWaWV3KGUsIHQsIHNbbF0sIHAsIG0pKTsKICAgICAgICB9KSwgczsKICAgICAgfSwKICAgICAgZ2V0RXhjZWVkRGF0ZTogZnVuY3Rpb24gZ2V0RXhjZWVkRGF0ZShlLCB0LCBuKSB7CiAgICAgICAgdmFyIG8gPSB7fTsKICAgICAgICByZXR1cm4gbC5mb3JFYWNoKG4sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCA9IGEuZm9ybWF0KGUsICJZWVlZTU1ERCIpOwogICAgICAgICAgb1t0XSA9IDA7CiAgICAgICAgfSksIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBuOwogICAgICAgICAgICAgICF0IHx8IHQudG9wIDwgZSB8fCAobiA9IGEucmFuZ2UodC5nZXRTdGFydHMoKSwgdC5nZXRFbmRzKCksIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLCBsLmZvckVhY2gobiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gYS5mb3JtYXQoZSwgIllZWVlNTUREIik7CiAgICAgICAgICAgICAgICBvW3RdICs9IDE7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBvOwogICAgICB9LAogICAgICBleGNsdWRlRXhjZWVkU2NoZWR1bGVzOiBmdW5jdGlvbiBleGNsdWRlRXhjZWVkU2NoZWR1bGVzKGUsIHQpIHsKICAgICAgICByZXR1cm4gZS5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLm1hcChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gZS5sZW5ndGggPiB0ID8gZS5maWx0ZXIoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZS50b3AgPCB0OwogICAgICAgICAgICB9LCB0aGlzKSA6IGU7CiAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQogICAgfTsKICAgIGUuZXhwb3J0cyA9IGM7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMTUpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEzKSwKICAgICAgICByID0gTWF0aC5tYXgsCiAgICAgICAgcyA9IHsKICAgICAgX29ubHlUaW1lRmlsdGVyOiBmdW5jdGlvbiBfb25seVRpbWVGaWx0ZXIoZSkgewogICAgICAgIHJldHVybiAhZS5tb2RlbC5pc0FsbERheSAmJiAhZS5oYXNNdWx0aURhdGVzOwogICAgICB9LAogICAgICBfb25seUFsbGRheUZpbHRlcjogZnVuY3Rpb24gX29ubHlBbGxkYXlGaWx0ZXIoZSkgewogICAgICAgIHJldHVybiBlLm1vZGVsLmlzQWxsRGF5IHx8IGUuaGFzTXVsdGlEYXRlczsKICAgICAgfSwKICAgICAgX3dlaWdodFRvcFZhbHVlOiBmdW5jdGlvbiBfd2VpZ2h0VG9wVmFsdWUoZSkgewogICAgICAgIGUudG9wID0gZS50b3AgfHwgMCwgZS50b3AgKz0gMTsKICAgICAgfSwKICAgICAgX2FkanVzdFJlbmRlclJhbmdlOiBmdW5jdGlvbiBfYWRqdXN0UmVuZGVyUmFuZ2UoZSwgdCwgbikgewogICAgICAgIHZhciBsID0gdGhpcy5Db3JlOwogICAgICAgIG4uZWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgKG4ubW9kZWwuaXNBbGxEYXkgfHwgbi5oYXNNdWx0aURhdGVzKSAmJiBsLmxpbWl0UmVuZGVyUmFuZ2UoZSwgdCwgbik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9nZXRBbGxkYXlNYXhUb3BJbmRleEF0WU1EOiBmdW5jdGlvbiBfZ2V0QWxsZGF5TWF4VG9wSW5kZXhBdFlNRChlLCB0KSB7CiAgICAgICAgdmFyIG4gPSB0aGlzLmRhdGVNYXRyaXgsCiAgICAgICAgICAgIG8gPSBbXTsKICAgICAgICByZXR1cm4gbC5mb3JFYWNoKG5bZV0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB0LmRvV2hlbkhhcyhlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBvLnB1c2goZS50b3ApOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIG8ubGVuZ3RoID4gMCA/IHIuYXBwbHkobnVsbCwgbykgOiAwOwogICAgICB9LAogICAgICBfYWRqdXN0VGltZVRvcEluZGV4OiBmdW5jdGlvbiBfYWRqdXN0VGltZVRvcEluZGV4KGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuTW9udGgsCiAgICAgICAgICAgIG4gPSB0Ll9nZXRBbGxkYXlNYXhUb3BJbmRleEF0WU1ELAogICAgICAgICAgICBhID0gZS5maW5kKHQuX29ubHlBbGxkYXlGaWx0ZXIpLAogICAgICAgICAgICByID0gZS5maW5kKHQuX29ubHlUaW1lRmlsdGVyKS5zb3J0KG8uY29tcGFyZS5zY2hlZHVsZS5hc2MpLAogICAgICAgICAgICBzID0ge307CiAgICAgICAgci5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCA9IGkuZm9ybWF0KGUuZ2V0U3RhcnRzKCksICJZWVlZTU1ERCIpLAogICAgICAgICAgICAgIG8gPSBzW3RdOwogICAgICAgICAgbC5pc1VuZGVmaW5lZChvKSAmJiAobyA9IHNbdF0gPSBuKHQsIGEpKSwgc1t0XSA9IGUudG9wID0gbyArIDE7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9zdGFja1RpbWVGcm9tVG9wOiBmdW5jdGlvbiBfc3RhY2tUaW1lRnJvbVRvcChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLk1vbnRoLAogICAgICAgICAgICBuID0gZS5maW5kKHQuX29ubHlBbGxkYXlGaWx0ZXIpLAogICAgICAgICAgICBhID0gZS5maW5kKHQuX29ubHlUaW1lRmlsdGVyKS5zb3J0KG8uY29tcGFyZS5zY2hlZHVsZS5hc2MpLAogICAgICAgICAgICBzID0ge30sCiAgICAgICAgICAgIGMgPSB0aGlzLmRhdGVNYXRyaXg7CiAgICAgICAgYS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCwKICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgIGEgPSBpLmZvcm1hdChlLmdldFN0YXJ0cygpLCAiWVlZWU1NREQiKSwKICAgICAgICAgICAgICB1ID0gc1thXTsKICAgICAgICAgIGlmIChsLmlzVW5kZWZpbmVkKHUpICYmICh1ID0gc1thXSA9IFtdLCBsLmZvckVhY2goY1thXSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgbi5kb1doZW5IYXMoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICB1LnB1c2goZS50b3ApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKSwgbC5pbkFycmF5KGUudG9wLCB1KSA+PSAwKSBmb3IgKHQgPSByLmFwcGx5KG51bGwsIHUpICsgMSwgbyA9IDE7IG8gPD0gdCAmJiAoZS50b3AgPSBvLCAhKGwuaW5BcnJheShlLnRvcCwgdSkgPCAwKSk7IG8gKz0gMSkgewogICAgICAgICAgICA7CiAgICAgICAgICB9CiAgICAgICAgICB1LnB1c2goZS50b3ApOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBfYWRkTXVsdGlEYXRlc0luZm86IGZ1bmN0aW9uIF9hZGRNdWx0aURhdGVzSW5mbyhlKSB7CiAgICAgICAgZS5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCA9IGUubW9kZWwsCiAgICAgICAgICAgICAgbiA9IHQuZ2V0U3RhcnRzKCksCiAgICAgICAgICAgICAgbCA9IHQuZ2V0RW5kcygpOwogICAgICAgICAgZS5oYXNNdWx0aURhdGVzID0gaS5oYXNNdWx0aURhdGVzKG4sIGwpLCAhdC5pc0FsbERheSAmJiBlLmhhc011bHRpRGF0ZXMgJiYgKGUucmVuZGVyU3RhcnRzID0gaS5zdGFydChuKSwgZS5yZW5kZXJFbmRzID0gaS5jb252ZXJ0U3RhcnREYXlUb0xhc3REYXkobCkpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBmaW5kQnlEYXRlUmFuZ2U6IGZ1bmN0aW9uIGZpbmRCeURhdGVSYW5nZShlLCB0LCBuLCBsKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIHUsCiAgICAgICAgICAgIGQgPSB0aGlzLkNvcmUsCiAgICAgICAgICAgIGggPSB0aGlzLk1vbnRoLAogICAgICAgICAgICBwID0gZC5nZXRTY2hlZHVsZUluRGF0ZVJhbmdlRmlsdGVyKGUsIHQpOwogICAgICAgIHJldHVybiBsID0gbCB8fCAhMSwgbiA9IG4gfHwgW10sIHAgPSBhLmFuZC5hcHBseShudWxsLCBbcF0uY29uY2F0KG4pKSwgaSA9IHRoaXMuc2NoZWR1bGVzLmZpbmQocCksIHIgPSBkLmNvbnZlcnRUb1ZpZXdNb2RlbChpKSwgaC5fYWRkTXVsdGlEYXRlc0luZm8ociksIGguX2FkanVzdFJlbmRlclJhbmdlKGUsIHQsIHIpLCBzID0gci5zb3J0KG8uY29tcGFyZS5zY2hlZHVsZS5hc2MpLCBjID0gZC5nZXRDb2xsaXNpb25Hcm91cChzKSwgdSA9IGQuZ2V0TWF0cmljZXMociwgYyksIGQucG9zaXRpb25WaWV3TW9kZWxzKGUsIHQsIHUsIGguX3dlaWdodFRvcFZhbHVlKSwgbCA/IGguX2FkanVzdFRpbWVUb3BJbmRleChyKSA6IGguX3N0YWNrVGltZUZyb21Ub3AociksIHU7CiAgICAgIH0KICAgIH07CiAgICBlLmV4cG9ydHMgPSBzOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpLAogICAgICAgIGEgPSBuKDUpLAogICAgICAgIHIgPSBuKDI5KSwKICAgICAgICBzID0gbigxMSksCiAgICAgICAgYyA9IG4oMTQpLAogICAgICAgIHUgPSBuKDY1KSwKICAgICAgICBkID0gbig2NiksCiAgICAgICAgaCA9IG4oNjgpLAogICAgICAgIHAgPSBuKDcyKSwKICAgICAgICBtID0gbigzMiksCiAgICAgICAgZiA9IG4oMzMpLAogICAgICAgIGcgPSBuKDgyKSwKICAgICAgICB5ID0gbig4MyksCiAgICAgICAgUyA9IG4oODUpLAogICAgICAgIF8gPSBuKDM0KSwKICAgICAgICBDID0gbig4NyksCiAgICAgICAgdiA9IG4oODkpLAogICAgICAgIEUgPSBuKDkwKSwKICAgICAgICB3ID0gbig5MiksCiAgICAgICAgUCA9IG4oOTUpLAogICAgICAgIGsgPSB7CiAgICAgIGNsaWNrOiB5LAogICAgICBjcmVhdGlvbjogUywKICAgICAgbW92ZTogXywKICAgICAgcmVzaXplOiBDCiAgICB9LAogICAgICAgIFIgPSB7CiAgICAgIGNsaWNrOiB2LAogICAgICBjcmVhdGlvbjogRSwKICAgICAgbW92ZTogdywKICAgICAgcmVzaXplOiBQCiAgICB9LAogICAgICAgIEkgPSBbewogICAgICBuYW1lOiAibWlsZXN0b25lIiwKICAgICAgdHlwZTogImRheWdyaWQiLAogICAgICBtaW5IZWlnaHQ6IDIwLAogICAgICBtYXhIZWlnaHQ6IDgwLAogICAgICBzaG93RXhwYW5kYWJsZUJ1dHRvbjogITAsCiAgICAgIG1heEV4cGFuZGFibGVIZWlnaHQ6IDIxMCwKICAgICAgaGFuZGxlcnM6IFsiY2xpY2siXSwKICAgICAgc2hvdzogITAKICAgIH0sIHsKICAgICAgbmFtZTogInRhc2siLAogICAgICB0eXBlOiAiZGF5Z3JpZCIsCiAgICAgIG1pbkhlaWdodDogNDAsCiAgICAgIG1heEhlaWdodDogMTIwLAogICAgICBzaG93RXhwYW5kYWJsZUJ1dHRvbjogITAsCiAgICAgIG1heEV4cGFuZGFibGVIZWlnaHQ6IDIxMCwKICAgICAgaGFuZGxlcnM6IFsiY2xpY2siLCAibW92ZSJdLAogICAgICBzaG93OiAhMAogICAgfSwgewogICAgICBuYW1lOiAiYWxsZGF5IiwKICAgICAgdHlwZTogImRheWdyaWQiLAogICAgICBtaW5IZWlnaHQ6IDMwLAogICAgICBtYXhIZWlnaHQ6IDgwLAogICAgICBzaG93RXhwYW5kYWJsZUJ1dHRvbjogITAsCiAgICAgIG1heEV4cGFuZGFibGVIZWlnaHQ6IDIxMCwKICAgICAgaGFuZGxlcnM6IFsiY2xpY2siLCAiY3JlYXRpb24iLCAibW92ZSIsICJyZXNpemUiXSwKICAgICAgc2hvdzogITAKICAgIH0sIHsKICAgICAgbmFtZTogInRpbWUiLAogICAgICB0eXBlOiAidGltZWdyaWQiLAogICAgICBhdXRvSGVpZ2h0OiAhMCwKICAgICAgaGFuZGxlcnM6IFsiY2xpY2siLCAiY3JlYXRpb24iLCAibW92ZSIsICJyZXNpemUiXSwKICAgICAgc2hvdzogITAKICAgIH1dOwoKICAgIGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChlLCB0LCBuLCB5LCBTKSB7CiAgICAgIHZhciBfLAogICAgICAgICAgQywKICAgICAgICAgIHYsCiAgICAgICAgICBFLAogICAgICAgICAgdywKICAgICAgICAgIFAsCiAgICAgICAgICBiLAogICAgICAgICAgRCwKICAgICAgICAgIEYsCiAgICAgICAgICB4LAogICAgICAgICAgWCwKICAgICAgICAgIE0sCiAgICAgICAgICBPLAogICAgICAgICAgVCwKICAgICAgICAgIEggPSBbXSwKICAgICAgICAgIEwgPSBbXSwKICAgICAgICAgIEIgPSB5LnRhc2tWaWV3LAogICAgICAgICAgQSA9IHkuc2NoZWR1bGVWaWV3LAogICAgICAgICAgViA9IHsKICAgICAgICBtaWxlc3RvbmU6IGwuaXNBcnJheShCKSA/IGwuaW5BcnJheSgibWlsZXN0b25lIiwgQikgPj0gMCA6IEIsCiAgICAgICAgdGFzazogbC5pc0FycmF5KEIpID8gbC5pbkFycmF5KCJ0YXNrIiwgQikgPj0gMCA6IEIsCiAgICAgICAgYWxsZGF5OiBsLmlzQXJyYXkoQSkgPyBsLmluQXJyYXkoImFsbGRheSIsIEEpID49IDAgOiBBLAogICAgICAgIHRpbWU6IGwuaXNBcnJheShBKSA/IGwuaW5BcnJheSgidGltZSIsIEEpID49IDAgOiBBCiAgICAgIH07CgogICAgICByZXR1cm4gbC5mb3JFYWNoKEksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBlLm5hbWU7CiAgICAgICAgZSA9IGwuZXh0ZW5kKHt9LCBlKSwgSC5wdXNoKGUpLCBlLnNob3cgPSBWW3RdLCBlLnNob3cgJiYgKEwubGVuZ3RoICYmIEwucHVzaCh7CiAgICAgICAgICBpc1NwbGl0dGVyOiAhMAogICAgICAgIH0pLCBMLnB1c2gobC5leHRlbmQoe30sIGUpKSk7CiAgICAgIH0pLCBMLmxlbmd0aCAmJiAoKEYgPSBMW0wubGVuZ3RoIC0gMV0pLmF1dG9IZWlnaHQgPSAhMCwgRi5tYXhIZWlnaHQgPSBudWxsLCBGLnNob3dFeHBhbmRhYmxlQnV0dG9uID0gITEsIGwuZm9yRWFjaChILCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBlLm5hbWUgIT09IEYubmFtZSB8fCAoZS5zaG93RXhwYW5kYWJsZUJ1dHRvbiA9ICExLCAhMSk7CiAgICAgIH0pKSwgbC5leHRlbmQoeS53ZWVrLCB7CiAgICAgICAgcGFuZWxzOiBICiAgICAgIH0pLCAoXyA9IG5ldyB1KG51bGwsIHkud2VlaywgdCwgSCwgUykpLmhhbmRsZXIgPSB7CiAgICAgICAgY2xpY2s6IHt9LAogICAgICAgIGRheW5hbWU6IHt9LAogICAgICAgIGNyZWF0aW9uOiB7fSwKICAgICAgICBtb3ZlOiB7fSwKICAgICAgICByZXNpemU6IHt9CiAgICAgIH0sIEMgPSBpLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBfLmNvbnRhaW5lciwgby5jbGFzc25hbWUoImRheW5hbWUtbGF5b3V0IikpLCB2ID0gbmV3IGQoeSwgQywgZS50aGVtZSksIF8uaGFuZGxlci5kYXluYW1lLmRhdGUgPSBuZXcgZyhuLCB2LCBlKSwgXy5hZGRDaGlsZCh2KSwgKEUgPSBpLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBfLmNvbnRhaW5lciwgby5jbGFzc25hbWUoInZsYXlvdXQtYXJlYSIpKSkuc3R5bGUuaGVpZ2h0ID0gaS5nZXRTaXplKF8uY29udGFpbmVyKVsxXSAtIHYuY29udGFpbmVyLm9mZnNldEhlaWdodCArICJweCIsIHcgPSBuZXcgcih7CiAgICAgICAgcGFuZWxzOiBMLAogICAgICAgIHBhbmVsSGVpZ2h0czogeS53ZWVrLnBhbmVsSGVpZ2h0cyB8fCBbXQogICAgICB9LCBFLCBlLnRoZW1lKSwgXy52TGF5b3V0ID0gdywgbC5mb3JFYWNoKEgsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIGkgPSB0Lm5hbWUsCiAgICAgICAgICAgIGEgPSB0LmhhbmRsZXJzOwogICAgICAgIHQuc2hvdyAmJiAoImRheWdyaWQiID09PSB0LnR5cGUgPyAoKG8gPSBuZXcgaChpLCB5LCB3LmdldFBhbmVsQnlOYW1lKHQubmFtZSkuY29udGFpbmVyLCBlLnRoZW1lKSkub24oImFmdGVyUmVuZGVyIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHcuZ2V0UGFuZWxCeU5hbWUoaSkuc2V0SGVpZ2h0KG51bGwsIGUuaGVpZ2h0KTsKICAgICAgICB9KSwgXy5hZGRDaGlsZChvKSwgbC5mb3JFYWNoKGEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB5LmlzUmVhZE9ubHkgJiYgImNsaWNrIiAhPT0gdCB8fCAoXy5oYW5kbGVyW3RdW2ldID0gbmV3IGtbdF0obiwgbywgZSwgeSksIG8uYWRkSGFuZGxlcih0LCBfLmhhbmRsZXJbdF1baV0sIHcuZ2V0UGFuZWxCeU5hbWUoaSkpKTsKICAgICAgICB9KSkgOiAidGltZWdyaWQiID09PSB0LnR5cGUgJiYgKG8gPSBuZXcgcChpLCB5LCB3LmdldFBhbmVsQnlOYW1lKGkpLmNvbnRhaW5lciwgUyksIF8uYWRkQ2hpbGQobyksIGwuZm9yRWFjaChhLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgeS5pc1JlYWRPbmx5ICYmICJjbGljayIgIT09IHQgfHwgKF8uaGFuZGxlclt0XVtpXSA9IG5ldyBSW3RdKG4sIG8sIGUsIHkpKTsKICAgICAgICB9KSwgby5vbigiY2xpY2tUaW1lem9uZXNDb2xsYXBzZWRCdG4iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZSA9ICFfLnN0YXRlLnRpbWV6b25lc0NvbGxhcHNlZDsKICAgICAgICAgIF8uc2V0U3RhdGUoewogICAgICAgICAgICB0aW1lem9uZXNDb2xsYXBzZWQ6IGUKICAgICAgICAgIH0pLCBzLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfLmludm9rZSgiY2xpY2tUaW1lem9uZXNDb2xsYXBzZUJ0biIsIGUpIHx8IF8ucmVuZGVyKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSkpOwogICAgICB9KSwgdy5vbigicmVzaXplIiwgZnVuY3Rpb24gKCkgewogICAgICAgIHMucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfLnJlbmRlcigpOwogICAgICAgIH0pOwogICAgICB9KSwgeS51c2VDcmVhdGlvblBvcHVwICYmIChQID0gbmV3IG0odCwgZS5jYWxlbmRhcnMsIHkudXNhZ2VTdGF0aXN0aWNzKSwgYiA9IGZ1bmN0aW9uIGIoZSkgewogICAgICAgIGwuZXh0ZW5kKGUsIHsKICAgICAgICAgIHVzZUNyZWF0aW9uUG9wdXA6ICEwCiAgICAgICAgfSksIGUuaXNBbGxEYXkgPyBfLmhhbmRsZXIuY3JlYXRpb24uYWxsZGF5LmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgZSkgOiBfLmhhbmRsZXIuY3JlYXRpb24udGltZS5maXJlKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGUpOwogICAgICB9LCBQLm9uKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGIpKSwgRCA9IGZ1bmN0aW9uIEQoZSkgewogICAgICAgIFAgJiYgUC5zZXRDYWxlbmRhcnMoZSk7CiAgICAgIH0sIGUub24oInNldENhbGVuZGFycyIsIEQpLCB5LnVzZURldGFpbFBvcHVwICYmICh4ID0gbmV3IGYodCwgZS5jYWxlbmRhcnMpLCBYID0gZnVuY3Rpb24gWCh0KSB7CiAgICAgICAgdmFyIG4gPSB0LnNjaGVkdWxlLmNhbGVuZGFySWQ7CiAgICAgICAgdC5jYWxlbmRhciA9IGEuZmluZChlLmNhbGVuZGFycywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmlkID09PSBuOwogICAgICAgIH0pLCB5LmlzUmVhZE9ubHkgJiYgKHQuc2NoZWR1bGUgPSBsLmV4dGVuZCh7fSwgdC5zY2hlZHVsZSwgewogICAgICAgICAgaXNSZWFkT25seTogITAKICAgICAgICB9KSksIHgucmVuZGVyKHQpOwogICAgICB9LCBNID0gZnVuY3Rpb24gTShlKSB7CiAgICAgICAgZS5pc0FsbERheSA/IF8uaGFuZGxlci5jcmVhdGlvbi5hbGxkYXkuZmlyZSgiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBlKSA6IF8uaGFuZGxlci5jcmVhdGlvbi50aW1lLmZpcmUoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgZSk7CiAgICAgIH0sIFQgPSBmdW5jdGlvbiBUKGUpIHsKICAgICAgICBlLmlzQWxsRGF5ID8gXy5oYW5kbGVyLm1vdmUuYWxsZGF5LmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgZSkgOiBfLmhhbmRsZXIubW92ZS50aW1lLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgZSk7CiAgICAgIH0sIGwuZm9yRWFjaChfLmhhbmRsZXIuY2xpY2ssIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5vbigiY2xpY2tTY2hlZHVsZSIsIFgpOwogICAgICB9KSwgeS51c2VDcmVhdGlvblBvcHVwID8gKE8gPSBmdW5jdGlvbiBPKHQpIHsKICAgICAgICB2YXIgbiA9IGUuY2FsZW5kYXJzOwogICAgICAgIHQuaXNFZGl0TW9kZSA9ICEwLCBQLnNldENhbGVuZGFycyhuKSwgUC5yZW5kZXIodCk7CiAgICAgIH0sIFAub24oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgVCksIHgub24oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgTykpIDogeC5vbigiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCBUKSwgeC5vbigiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBNKSksIF8ub24oImFmdGVyUmVuZGVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgIHcucmVmcmVzaCgpOwogICAgICB9KSwgXy5jb250cm9sbGVyID0gZS5XZWVrLCBfLl9iZWZvcmVEZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGwuZm9yRWFjaChfLmhhbmRsZXIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBsLmZvckVhY2goZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgZS5vZmYoKSwgZS5kZXN0cm95KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSwgeS51c2VDcmVhdGlvblBvcHVwICYmIChQLm9mZigiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCBiKSwgUC5kZXN0cm95KCkpLCB5LnVzZURldGFpbFBvcHVwICYmICh4Lm9mZigiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBNKSwgeC5kZXN0cm95KCkpLCBfLm9mZigpOwogICAgICB9LCB7CiAgICAgICAgdmlldzogXywKICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICAgICAgdmFyIGUgPSBfLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgICAgICB0ID0gaS5nZXRCQ1JlY3Qodi5jb250YWluZXIpLmhlaWdodDsKCiAgICAgICAgICB3LmNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBlIC0gdCArICJweCIsIHcucmVmcmVzaCgpOwogICAgICAgIH0sCiAgICAgICAgc2Nyb2xsVG9Ob3c6IGZ1bmN0aW9uIHNjcm9sbFRvTm93KCkgewogICAgICAgICAgXy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUuc2Nyb2xsVG9Ob3cgJiYgZS5zY3JvbGxUb05vdygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvcGVuQ3JlYXRpb25Qb3B1cDogZnVuY3Rpb24gb3BlbkNyZWF0aW9uUG9wdXAoZSkgewogICAgICAgICAgUCAmJiAoZS5pc0FsbERheSA/IF8uaGFuZGxlci5jcmVhdGlvbi5hbGxkYXkuaW52b2tlQ3JlYXRpb25DbGljayhjLmNyZWF0ZShlKSkgOiBfLmhhbmRsZXIuY3JlYXRpb24udGltZS5pbnZva2VDcmVhdGlvbkNsaWNrKGMuY3JlYXRlKGUpKSk7CiAgICAgICAgfSwKICAgICAgICBzaG93Q3JlYXRpb25Qb3B1cDogZnVuY3Rpb24gc2hvd0NyZWF0aW9uUG9wdXAodCkgewogICAgICAgICAgUCAmJiAoUC5zZXRDYWxlbmRhcnMoZS5jYWxlbmRhcnMpLCBQLnJlbmRlcih0KSk7CiAgICAgICAgfQogICAgICB9OwogICAgfTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig4KTsKCiAgICBmdW5jdGlvbiBzKGUsIHQsIG4pIHsKICAgICAgci5jYWxsKHRoaXMsIHQpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgaW5kZXg6IDAsCiAgICAgICAgbmFtZTogIjAiLAogICAgICAgIG1pbkhlaWdodDogMCwKICAgICAgICBtYXhIZWlnaHQ6IG51bGwsCiAgICAgICAgaGVpZ2h0OiBudWxsLAogICAgICAgIGlzU3BsaXR0ZXI6ICExLAogICAgICAgIGF1dG9IZWlnaHQ6ICExLAogICAgICAgIGNsYXNzTmFtZTogIiIKICAgICAgfSwgZSksIHRoaXMuaW5kZXggPSB0aGlzLm9wdGlvbnMuaW5kZXgsIHRoaXMubmFtZSA9IHRoaXMub3B0aW9ucy5uYW1lIHx8IFN0cmluZyh0aGlzLmluZGV4KSwgdGhpcy5pc0hlaWdodEZvcmNlZFNldCA9ICExLCB0aGlzLnRoZW1lID0gbiwgdGhpcy5faW5pdFBhbmVsKHRoaXMub3B0aW9ucywgdCk7CiAgICB9CgogICAgbC5pbmhlcml0KHMsIHIpLCBzLnByb3RvdHlwZS5pc1NwbGl0dGVyID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmlzU3BsaXR0ZXI7CiAgICB9LCBzLnByb3RvdHlwZS5zZXRNYXhIZWlnaHQgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLm9wdGlvbnMuYXV0b0hlaWdodCB8fCAodGhpcy5vcHRpb25zLm1heEhlaWdodCA9IGUpOwogICAgfSwgcy5wcm90b3R5cGUuc2V0SGVpZ2h0Rm9yY2VkU2V0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5pc0hlaWdodEZvcmNlZFNldCA9IGU7CiAgICB9LCBzLnByb3RvdHlwZS5nZXRIZWlnaHRGb3JjZWRTZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmlzSGVpZ2h0Rm9yY2VkU2V0OwogICAgfSwgcy5wcm90b3R5cGUuc2V0SGVpZ2h0ID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwgPSB0aGlzLm9wdGlvbnMubWF4SGVpZ2h0LAogICAgICAgICAgbyA9IHRoaXMub3B0aW9ucy5taW5IZWlnaHQsCiAgICAgICAgICBpID0gdGhpcy5vcHRpb25zLmF1dG9IZWlnaHQ7CiAgICAgIGUgPSBlIHx8IHRoaXMuY29udGFpbmVyLCAobiB8fCAhdGhpcy5pc0hlaWdodEZvcmNlZFNldCB8fCBpKSAmJiAobiA/IHRoaXMuaXNIZWlnaHRGb3JjZWRTZXQgPSAhMCA6IGwgJiYgKHQgPSBNYXRoLm1pbih0LCBsKSksIHQgPSBNYXRoLm1heChvLCB0KSwgZS5zdHlsZS5oZWlnaHQgPSB0ICsgInB4Iik7CiAgICB9LCBzLnByb3RvdHlwZS5nZXRSZXNpemVJbmZvQnlHcm93dGggPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ2V0SGVpZ2h0KCksCiAgICAgICAgICBuID0gdCArIGUsCiAgICAgICAgICBsID0gTWF0aC5tYXgoMCwgbiwgdGhpcy5vcHRpb25zLm1pbkhlaWdodCk7CiAgICAgIHJldHVybiBbbCwgdCAtIGxdOwogICAgfSwgcy5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gYS5nZXRTaXplKHRoaXMuY29udGFpbmVyKVsxXTsKICAgIH0sIHMucHJvdG90eXBlLmFkZENsYXNzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgYS5hZGRDbGFzcyh0aGlzLmNvbnRhaW5lciwgZSk7CiAgICB9LCBzLnByb3RvdHlwZS5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGEucmVtb3ZlQ2xhc3ModGhpcy5jb250YWluZXIsIGUpOwogICAgfSwgcy5wcm90b3R5cGUuX2luaXRQYW5lbCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuOwogICAgICBpZiAoYS5zZXREYXRhKHQsICJwYW5lbEluZGV4IiwgZS5pbmRleCksIGUuaXNTcGxpdHRlcikgcmV0dXJuIGEuYWRkQ2xhc3ModCwgby5jbGFzc25hbWUoInNwbGl0dGVyIikpLCB2b2lkIHRoaXMuYXBwbHlUaGVtZSgpOwogICAgICBlLmNsYXNzTmFtZSAmJiBhLmFkZENsYXNzKHQsIGUuY2xhc3NOYW1lKSwgZS5hdXRvSGVpZ2h0ID8gYS5zZXREYXRhKHQsICJhdXRvSGVpZ2h0IiwgITApIDogKG4gPSBpLmxpbWl0KGUuaGVpZ2h0IHx8IDAsIFtlLm1pbkhlaWdodF0sIFtlLm1heEhlaWdodCB8fCBlLmhlaWdodF0pLCBlLmhlaWdodCA9IG4sIHRoaXMuc2V0SGVpZ2h0KHQsIG4pKTsKICAgIH0sIHMucHJvdG90eXBlLmFwcGx5VGhlbWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlID0gdGhpcy5jb250YWluZXIuc3R5bGUsCiAgICAgICAgICB0ID0gdGhpcy50aGVtZTsKICAgICAgdCAmJiAoZS5ib3JkZXJUb3AgPSB0LndlZWsudnBhbmVsU3BsaXR0ZXIuYm9yZGVyIHx8IHQuY29tbW9uLmJvcmRlciwgZS5ib3JkZXJCb3R0b20gPSB0LndlZWsudnBhbmVsU3BsaXR0ZXIuYm9yZGVyIHx8IHQuY29tbW9uLmJvcmRlciwgZS5oZWlnaHQgPSB0LndlZWsudnBhbmVsU3BsaXR0ZXIuaGVpZ2h0KTsKICAgIH0sIGUuZXhwb3J0cyA9IHM7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMSksCiAgICAgICAgYSA9IG4oMyksCiAgICAgICAgciA9IG4oNCkuRGF0ZSwKICAgICAgICBzID0gbig4KTsKCiAgICBmdW5jdGlvbiBjKGUsIHQsIG4sIGMsIHUpIHsKICAgICAgdmFyIGQ7CiAgICAgIG4gPSBpLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBuKSwgcy5jYWxsKHRoaXMsIG4pLCBpLmFkZENsYXNzKG4sIG8uY2xhc3NuYW1lKCJ3ZWVrLWNvbnRhaW5lciIpKSwgZCA9IHRoaXMuX2dldFJlbmRlckRhdGVSYW5nZShuZXcgcigpKSwgdGhpcy5vcHRpb25zID0gbC5leHRlbmQoewogICAgICAgIHNjaGVkdWxlRmlsdGVyOiBbZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKGUuaXNWaXNpYmxlKTsKICAgICAgICB9XSwKICAgICAgICByZW5kZXJTdGFydERhdGU6IGEuZm9ybWF0KGQuc3RhcnQsICJZWVlZLU1NLUREIiksCiAgICAgICAgcmVuZGVyRW5kRGF0ZTogYS5mb3JtYXQoZC5lbmQsICJZWVlZLU1NLUREIiksCiAgICAgICAgbmFycm93V2Vla2VuZDogITEsCiAgICAgICAgc3RhcnREYXlPZldlZWs6IDAsCiAgICAgICAgd29ya3dlZWs6ICExLAogICAgICAgIHNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uOiAhMSwKICAgICAgICB0aW1lem9uZXNDb2xsYXBzZWQ6ICExLAogICAgICAgIGhvdXJTdGFydDogMCwKICAgICAgICBob3VyRW5kOiAyNAogICAgICB9LCB0KSwgdGhpcy5jb250cm9sbGVyID0gZSwgdGhpcy5wYW5lbHMgPSBjLCB0aGlzLnN0YXRlID0gewogICAgICAgIHRpbWV6b25lc0NvbGxhcHNlZDogdGhpcy5vcHRpb25zLnRpbWV6b25lc0NvbGxhcHNlZAogICAgICB9LCAiZGF5IiA9PT0gdSAmJiBmdW5jdGlvbiAoZSkgewogICAgICAgIGUud29ya3dlZWsgPSAhMTsKICAgICAgfSh0aGlzLm9wdGlvbnMpOwogICAgfQoKICAgIGwuaW5oZXJpdChjLCBzKSwgYy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSwKICAgICAgICAgIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICBzLAogICAgICAgICAgYyA9IHRoaXMsCiAgICAgICAgICB1ID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgZCA9IHUuc2NoZWR1bGVGaWx0ZXIsCiAgICAgICAgICBoID0gdS5uYXJyb3dXZWVrZW5kLAogICAgICAgICAgcCA9IHUuc3RhcnREYXlPZldlZWssCiAgICAgICAgICBtID0gdS53b3Jrd2VlaywKICAgICAgICAgIGYgPSB0aGlzLmNvbnRyb2xsZXIudGhlbWUgfHwge30sCiAgICAgICAgICBnID0gdGhpcy5zdGF0ZTsKICAgICAgZSA9IG5ldyByKHUucmVuZGVyU3RhcnREYXRlKSwgdCA9IG5ldyByKHUucmVuZGVyRW5kRGF0ZSksIHMgPSBhLnJhbmdlKGEuc3RhcnQoZSksIGEuZW5kKHQpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwgdS53b3Jrd2VlayAmJiBhLmNvbXBhcmUoZSwgdCkgJiYgKGUgPSAocyA9IGwuZmlsdGVyKHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuICFhLmlzV2Vla2VuZChlLmdldERheSgpKTsKICAgICAgfSkpWzBdLCB0ID0gc1tzLmxlbmd0aCAtIDFdKSwgbiA9IHRoaXMuY29udHJvbGxlci5maW5kQnlEYXRlUmFuZ2UoYS5zdGFydChlKSwgYS5lbmQodCksIHRoaXMucGFuZWxzLCBkLCB0aGlzLm9wdGlvbnMpLCBpID0gYS5nZXRHcmlkTGVmdEFuZFdpZHRoKHMubGVuZ3RoLCBoLCBwLCBtKSwgbyA9IHsKICAgICAgICBzY2hlZHVsZXNJbkRhdGVSYW5nZTogbiwKICAgICAgICByZW5kZXJTdGFydERhdGU6IGUsCiAgICAgICAgcmVuZGVyRW5kRGF0ZTogdCwKICAgICAgICBncmlkczogaSwKICAgICAgICByYW5nZTogcywKICAgICAgICB0aGVtZTogZiwKICAgICAgICBzdGF0ZTogZwogICAgICB9LCB0aGlzLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiA9IGwucGljayhlLm9wdGlvbnMsICJ2aWV3TmFtZSIpOwogICAgICAgIGUucmVuZGVyKG8pLCBuICYmICh0ID0gby5zY2hlZHVsZXNJbkRhdGVSYW5nZVtuXSwgbC5pc0FycmF5KHQpID8gYy5faW52b2tlQWZ0ZXJSZW5kZXJTY2hlZHVsZSh0KSA6IGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgYy5faW52b2tlQWZ0ZXJSZW5kZXJTY2hlZHVsZShlKTsKICAgICAgICB9KSk7CiAgICAgIH0pLCB0aGlzLmZpcmUoImFmdGVyUmVuZGVyIik7CiAgICB9LCBjLnByb3RvdHlwZS5faW52b2tlQWZ0ZXJSZW5kZXJTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpczsKICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBsLmZvckVhY2hBcnJheShlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbC5mb3JFYWNoQXJyYXkoZSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgZSAmJiB0LmZpcmUoImFmdGVyUmVuZGVyU2NoZWR1bGUiLCB7CiAgICAgICAgICAgICAgc2NoZWR1bGU6IGUubW9kZWwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBjLnByb3RvdHlwZS52aWV3TmFtZSA9ICJ3ZWVrIiwgYy5wcm90b3R5cGUuX2dldFJlbmRlckRhdGVSYW5nZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gYS5zdGFydChlKSwKICAgICAgICAgIG4gPSBuZXcgcihOdW1iZXIodCkpLAogICAgICAgICAgbCA9IG5ldyByKE51bWJlcih0KSk7CiAgICAgIHJldHVybiBuLnNldERhdGUobi5nZXREYXRlKCkgLSAzKSwgbC5zZXREYXRlKGwuZ2V0RGF0ZSgpICsgMyksIHsKICAgICAgICBzdGFydDogbiwKICAgICAgICBlbmQ6IGwKICAgICAgfTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKGMpLCBlLmV4cG9ydHMgPSBjOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDUpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDQpLkRhdGUsCiAgICAgICAgcyA9IG4oMSksCiAgICAgICAgYyA9IG4oOCksCiAgICAgICAgdSA9IG4oNjcpOwoKICAgIGZ1bmN0aW9uIGQoZSwgdCwgbikgewogICAgICB0ID0gcy5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgdCwgby5jbGFzc25hbWUoImRheW5hbWUtY29udGFpbmVyIikpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgZGF5bmFtZXM6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sCiAgICAgICAgdGltZXpvbmVzOiBlLnRpbWV6b25lcwogICAgICB9LCBlLndlZWspLCB0aGlzLnRoZW1lID0gbiwgYy5jYWxsKHRoaXMsIHQpLCB0aGlzLmFwcGx5VGhlbWUoKTsKICAgIH0KCiAgICBsLmluaGVyaXQoZCwgYyksIGQucHJvdG90eXBlLl9nZXRCYXNlVmlld01vZGVsID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnMuZGF5bmFtZXMsCiAgICAgICAgICBpID0gdGhpcy50aGVtZSwKICAgICAgICAgIHMgPSBuZXcgcigpLnRvTG9jYWxUaW1lKCk7CiAgICAgIHJldHVybiBsLm1hcChhLnJhbmdlKGEuc3RhcnQoZSksIGEuZW5kKHQpLCBhLk1JTExJU0VDT05EU19QRVJfREFZKSwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICB2YXIgbCA9IGUuZ2V0RGF5KCksCiAgICAgICAgICAgIHIgPSBhLmlzU2FtZURhdGUoZSwgcyksCiAgICAgICAgICAgIGMgPSBlIDwgcyAmJiAhcjsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZGF5OiBsLAogICAgICAgICAgZGF5TmFtZTogb1tsXSwKICAgICAgICAgIGlzVG9kYXk6IHIsCiAgICAgICAgICBkYXRlOiBlLmdldERhdGUoKSwKICAgICAgICAgIGxlZnQ6IG5bdF0gPyBuW3RdLmxlZnQgOiAwLAogICAgICAgICAgd2lkdGg6IG5bdF0gPyBuW3RdLndpZHRoIDogMCwKICAgICAgICAgIHJlbmRlckRhdGU6IGEuZm9ybWF0KGUsICJZWVlZLU1NLUREIiksCiAgICAgICAgICBjb2xvcjogdGhpcy5fZ2V0RGF5TmFtZUNvbG9yKGksIGwsIHIsIGMpCiAgICAgICAgfTsKICAgICAgfSwgdGhpcyk7CiAgICB9LCBkLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuX2dldEJhc2VWaWV3TW9kZWwoZS5yZW5kZXJTdGFydERhdGUsIGUucmVuZGVyRW5kRGF0ZSwgZS5ncmlkcyksCiAgICAgICAgICBuID0gZS5zdGF0ZS50aW1lem9uZXNDb2xsYXBzZWQsCiAgICAgICAgICBvID0gdGhpcy5fZ2V0U3R5bGVzKHRoaXMudGhlbWUsIG4pLAogICAgICAgICAgaSA9IGwuZXh0ZW5kKHt9LCB7CiAgICAgICAgZGF5TmFtZXM6IHQsCiAgICAgICAgc3R5bGVzOiBvCiAgICAgIH0pOwoKICAgICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gdShpKTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXREYXlOYW1lQ29sb3IgPSBmdW5jdGlvbiAoZSwgdCwgbiwgbCkgewogICAgICB2YXIgbyA9ICIiOwogICAgICByZXR1cm4gZSAmJiAobyA9IDAgPT09IHQgPyBlLmNvbW1vbi5ob2xpZGF5LmNvbG9yIDogbCA/IGUud2Vlay5wYXN0RGF5LmNvbG9yIHx8IGUuY29tbW9uLmRheW5hbWUuY29sb3IgOiA2ID09PSB0ID8gZS5jb21tb24uc2F0dXJkYXkuY29sb3IgOiBuID8gZS53ZWVrLnRvZGF5LmNvbG9yIHx8IGUuY29tbW9uLnRvZGF5LmNvbG9yIDogZS5jb21tb24uZGF5bmFtZS5jb2xvciksIG87CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0ge30sCiAgICAgICAgICBvID0gdGhpcy5vcHRpb25zLnRpbWV6b25lcy5sZW5ndGgsCiAgICAgICAgICBhID0gdDsKICAgICAgcmV0dXJuIGUgJiYgKGwuYm9yZGVyVG9wID0gZS53ZWVrLmRheW5hbWUuYm9yZGVyVG9wIHx8IGUuY29tbW9uLmJvcmRlciwgbC5ib3JkZXJCb3R0b20gPSBlLndlZWsuZGF5bmFtZS5ib3JkZXJCb3R0b20gfHwgZS5jb21tb24uYm9yZGVyLCBsLmJvcmRlckxlZnQgPSBlLndlZWsuZGF5bmFtZS5ib3JkZXJMZWZ0IHx8IGUuY29tbW9uLmJvcmRlciwgbC5wYWRkaW5nTGVmdCA9IGUud2Vlay5kYXluYW1lLnBhZGRpbmdMZWZ0LCBsLmJhY2tncm91bmRDb2xvciA9IGUud2Vlay5kYXluYW1lLmJhY2tncm91bmRDb2xvciwgbC5oZWlnaHQgPSBlLndlZWsuZGF5bmFtZS5oZWlnaHQsIGwudGV4dEFsaWduID0gZS53ZWVrLmRheW5hbWUudGV4dEFsaWduLCBsLm1hcmdpbkxlZnQgPSBlLndlZWsuZGF5Z3JpZExlZnQud2lkdGgsICFhICYmIG8gPiAxICYmIChuID0gaS5wYXJzZVVuaXQobC5tYXJnaW5MZWZ0KSwgbC5tYXJnaW5MZWZ0ID0gblswXSAqIG8gKyBuWzFdKSksIGw7CiAgICB9LCBkLnByb3RvdHlwZS5hcHBseVRoZW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuX2dldFN0eWxlcyh0aGlzLnRoZW1lKSwKICAgICAgICAgIHQgPSB0aGlzLmNvbnRhaW5lci5zdHlsZTsKCiAgICAgIHJldHVybiB0LmJvcmRlclRvcCA9IGUuYm9yZGVyVG9wLCB0LmJvcmRlckJvdHRvbSA9IGUuYm9yZGVyQm90dG9tLCB0LmhlaWdodCA9IGUuaGVpZ2h0LCB0LmJhY2tncm91bmRDb2xvciA9IGUuYmFja2dyb3VuZENvbG9yLCB0LnRleHRBbGlnbiA9IGUudGV4dEFsaWduLCB0OwogICAgfSwgZS5leHBvcnRzID0gZDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImRheW5hbWUgIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzVG9kYXkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgIiArIHUoKGgobiwgImhvbGlkYXkiKSB8fCB0ICYmIGgodCwgImhvbGlkYXkiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImRheSIpIDogdCwgewogICAgICAgICAgbmFtZTogImhvbGlkYXkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDc2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA5MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgZGF0YS1kYXRlPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAicmVuZGVyRGF0ZSIpIHx8IChudWxsICE9IHQgPyBoKHQsICJyZW5kZXJEYXRlIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInJlbmRlckRhdGUiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciXG4gICAgIHN0eWxlPSInICsgdSgoaChuLCAiY29tbW9uLXdpZHRoIikgfHwgdCAmJiBoKHQsICJjb21tb24td2lkdGgiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgIndpZHRoIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiY29tbW9uLXdpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICI7bGVmdDoiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDQwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBsaW5lLWhlaWdodDogIiArIHUoZCgoaSA9IChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInN0eWxlcyIpKSAmJiBoKGksICJoZWlnaHQiKSwgdCkpICsgIjsgYm9yZGVyLWxlZnQ6ICIgKyB1KGQoKGkgPSAoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzdHlsZXMiKSkgJiYgaChpLCAiYm9yZGVyTGVmdCIpLCB0KSkgKyAiOyBwYWRkaW5nLWxlZnQ6ICIgKyB1KGQoKGkgPSAoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzdHlsZXMiKSkgJiYgaChpLCAicGFkZGluZ0xlZnQiKSwgdCkpICsgJzsiPlxuICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDE3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAzMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkYXluYW1lLWRhdGUtYXJlYSIgc3R5bGU9ImNvbG9yOiAnICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDY0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA3MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7Ij5cbiAgICAgICAgJyArIChudWxsICE9IChpID0gKGgobiwgIndlZWtEYXluYW1lLXRtcGwiKSB8fCB0ICYmIGgodCwgIndlZWtEYXluYW1lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJ3ZWVrRGF5bmFtZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICA8L3NwYW4+XG48L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNDkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgInRvZGF5IjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgYyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gYyhuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBjKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2RheW5hbWUtbGVmdG1hcmdpbiIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAnICsgcyhlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBjKG8sICJyb290IikpICYmIGMoaSwgInN0eWxlcyIpKSAmJiBjKGksICJtYXJnaW5MZWZ0IiksIHQpKSArICc7Ij5cbicgKyAobnVsbCAhPSAoaSA9IGMobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IGModCwgImRheU5hbWVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig1KSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbigxKSwKICAgICAgICBzID0gbig0KS5EYXRlLAogICAgICAgIGMgPSBuKDgpLAogICAgICAgIHUgPSBuKDY5KSwKICAgICAgICBkID0gbig3MSksCiAgICAgICAgaCA9IG4oMTEpLAogICAgICAgIHAgPSBNYXRoLm1heCwKICAgICAgICBtID0gTWF0aC5taW47CgogICAgZnVuY3Rpb24gZihlLCB0LCBuLCBpKSB7CiAgICAgIG4gPSByLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBuLCBvLmNsYXNzbmFtZSgiZGF5Z3JpZC1sYXlvdXQiKSksIGMuY2FsbCh0aGlzLCBuKSwgZSA9IGUgfHwgImRheWdyaWQiLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgdmlld05hbWU6IGUsCiAgICAgICAgZGF5bmFtZXM6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sCiAgICAgICAgcmVuZGVyU3RhcnREYXRlOiAiIiwKICAgICAgICByZW5kZXJFbmREYXRlOiAiIiwKICAgICAgICBjb250YWluZXJCb3R0b21HdXR0ZXI6IDE4LAogICAgICAgIHNjaGVkdWxlSGVpZ2h0OiBwYXJzZUludChpLndlZWsuZGF5R3JpZFNjaGVkdWxlLmhlaWdodCwgMTApLAogICAgICAgIHNjaGVkdWxlR3V0dGVyOiBwYXJzZUludChpLndlZWsuZGF5R3JpZFNjaGVkdWxlLm1hcmdpblRvcCwgMTApLAogICAgICAgIHNjaGVkdWxlQ29udGFpbmVyVG9wOiAxLAogICAgICAgIHRpbWV6b25lczogdC50aW1lem9uZXMsCiAgICAgICAgaXNSZWFkT25seTogdC5pc1JlYWRPbmx5LAogICAgICAgIGdldFZpZXdNb2RlbEZ1bmM6IGZ1bmN0aW9uIGdldFZpZXdNb2RlbEZ1bmModCkgewogICAgICAgICAgcmV0dXJuIHQuc2NoZWR1bGVzSW5EYXRlUmFuZ2VbZV07CiAgICAgICAgfSwKICAgICAgICBzZXRWaWV3TW9kZWxGdW5jOiBmdW5jdGlvbiBzZXRWaWV3TW9kZWxGdW5jKHQsIG4pIHsKICAgICAgICAgIHQuc2NoZWR1bGVzSW5EYXRlUmFuZ2VbZV0gPSBuOwogICAgICAgIH0KICAgICAgfSwgdC53ZWVrKSwgdGhpcy5oYW5kbGVyID0ge30sIHRoaXMudlBhbmVsID0gbnVsbCwgdGhpcy5zdGF0ZS5jb2xsYXBzZWQgPSAhMDsKICAgIH0KCiAgICBmdW5jdGlvbiBnKGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIDAgPT09IGUgfHwgNiA9PT0gZSA/IG4ud2Vla2VuZEJhY2tncm91bmRDb2xvciA6IHQgPyBuLnRvZGF5QmFja2dyb3VuZENvbG9yIDogbi5iYWNrZ3JvdW5kQ29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24geShlLCB0KSB7CiAgICAgIHZhciBuOwogICAgICByZXR1cm4gbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5uYW1lID09PSB0ICYmIChuID0gZSk7CiAgICAgIH0pLCBuOwogICAgfQoKICAgIGwuaW5oZXJpdChmLCBjKSwgZi5wcm90b3R5cGUuZ2V0QmFzZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIG8gPSBuLmRheW5hbWVzLAogICAgICAgICAgaSA9IGUucmFuZ2UsCiAgICAgICAgICByID0gZS5ncmlkcywKICAgICAgICAgIGMgPSBuLmdldFZpZXdNb2RlbEZ1bmMoZSksCiAgICAgICAgICB1ID0ge30sCiAgICAgICAgICBkID0geShuLnBhbmVscywgbi52aWV3TmFtZSksCiAgICAgICAgICBoID0gdGhpcy5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsCiAgICAgICAgICBmID0gdGhpcy5zdGF0ZS5jb2xsYXBzZWQsCiAgICAgICAgICBTID0gISF0aGlzLnZQYW5lbCAmJiB0aGlzLnZQYW5lbC5nZXRIZWlnaHRGb3JjZWRTZXQoKSwKICAgICAgICAgIF8gPSBlLnN0YXRlLnRpbWV6b25lc0NvbGxhcHNlZCwKICAgICAgICAgIEMgPSB0aGlzLl9nZXRTdHlsZXMoZS50aGVtZSwgXyksCiAgICAgICAgICB2ID0gbmV3IHMoKS50b0xvY2FsVGltZSgpOwoKICAgICAgcmV0dXJuIGQuc2hvd0V4cGFuZGFibGVCdXR0b24gJiYgKFMgfHwgKGggPSBmID8gcChoLCBkLm1heEhlaWdodCkgOiBtKGgsIGQubWF4RXhwYW5kYWJsZUhlaWdodCkpLCB0ID0gTWF0aC5mbG9vcihoIC8gKG4uc2NoZWR1bGVIZWlnaHQgKyBuLnNjaGVkdWxlR3V0dGVyKSksIGYgJiYgKHUgPSB0aGlzLnBhcmVudC5jb250cm9sbGVyLmdldEV4Y2VlZERhdGUodCwgYywgZS5yYW5nZSksIGMgPSB0aGlzLnBhcmVudC5jb250cm9sbGVyLmV4Y2x1ZGVFeGNlZWRTY2hlZHVsZXMoYywgdCksIG4uc2V0Vmlld01vZGVsRnVuYyhlLCBjKSkpLCB7CiAgICAgICAgdmlld05hbWU6IG4udmlld05hbWUsCiAgICAgICAgcmFuZ2U6IGksCiAgICAgICAgZ3JpZHM6IHIsCiAgICAgICAgZGF5czogbC5tYXAoZS5yYW5nZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHZhciBsID0gdC5nZXREYXkoKSwKICAgICAgICAgICAgICBpID0gYS5mb3JtYXQodCwgIllZWVlNTUREIiksCiAgICAgICAgICAgICAgcyA9IGEuaXNTYW1lRGF0ZSh2LCB0KTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRheTogbCwKICAgICAgICAgICAgZGF5TmFtZTogb1tsXSwKICAgICAgICAgICAgaXNUb2RheTogcywKICAgICAgICAgICAgZGF0ZTogdC5nZXREYXRlKCksCiAgICAgICAgICAgIHJlbmRlckRhdGU6IGEuZm9ybWF0KHQsICJZWVlZLU1NLUREIiksCiAgICAgICAgICAgIGhpZGRlblNjaGVkdWxlczogdVtpXSB8fCAwLAogICAgICAgICAgICB3aWR0aDogcltuXSA/IHJbbl0ud2lkdGggOiAwLAogICAgICAgICAgICBsZWZ0OiByW25dID8gcltuXS5sZWZ0IDogMCwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBlLnJhbmdlLmxlbmd0aCA+IDEgPyBnKGwsIHMsIEMpIDogQy5iYWNrZ3JvdW5kQ29sb3IKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgZXhjZWVkRGF0ZTogdSwKICAgICAgICBzaG93RXhwYW5kYWJsZUJ1dHRvbjogZC5zaG93RXhwYW5kYWJsZUJ1dHRvbiwKICAgICAgICBjb2xsYXBzZWQ6IGYsCiAgICAgICAgY29sbGFwc2VCdG5JbmRleDogdGhpcy5zdGF0ZS5jbGlja2VkRXhwYW5kQnRuSW5kZXgsCiAgICAgICAgc3R5bGVzOiBDCiAgICAgIH07CiAgICB9LCBmLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBsID0gdGhpcy5jb250YWluZXIsCiAgICAgICAgICBpID0gdGhpcy5nZXRCYXNlVmlld01vZGVsKGUpLAogICAgICAgICAgYSA9IHRoaXMub3B0aW9ucy5zY2hlZHVsZUNvbnRhaW5lclRvcDsKICAgICAgbC5pbm5lckhUTUwgPSBkKGkpLCB0aGlzLmNoaWxkcmVuLmNsZWFyKCksIHQgPSBuZXcgdShuLCByLmZpbmQoby5jbGFzc25hbWUoIi5jb250YWluZXIiKSwgbCkpLCB0aGlzLmFkZENoaWxkKHQpLCB0Lm9uKCJhZnRlclJlbmRlciIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaS5oZWlnaHQgPSBlLm1pbkhlaWdodCArIGE7CiAgICAgIH0pLCB0aGlzLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LnJlbmRlcihlKTsKICAgICAgfSwgdGhpcyksIHRoaXMuZmlyZSgiYWZ0ZXJSZW5kZXIiLCBpKTsKICAgIH0sIGYucHJvdG90eXBlLl9iZWZvcmVEZXN0cm95ID0gZnVuY3Rpb24gKCkge30sIGYucHJvdG90eXBlLmFkZEhhbmRsZXIgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbCA9IHRoaXM7CiAgICAgIHRoaXMuaGFuZGxlcltlXSA9IHQsIHRoaXMudlBhbmVsID0gbiwgImNsaWNrIiA9PT0gZSAmJiAodC5vbigiZXhwYW5kIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGwuc2V0U3RhdGUoewogICAgICAgICAgY29sbGFwc2VkOiAhMQogICAgICAgIH0pOwogICAgICB9LCB0aGlzKSwgdC5vbigiY29sbGFwc2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgbC5zZXRTdGF0ZSh7CiAgICAgICAgICBjb2xsYXBzZWQ6ICEwCiAgICAgICAgfSk7CiAgICAgIH0sIHRoaXMpKTsKICAgIH0sIGYucHJvdG90eXBlLl9leHBhbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGgucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZQYW5lbCwKICAgICAgICAgICAgdCA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgbiA9IHkodC5wYW5lbHMsIHQudmlld05hbWUpOwogICAgICAgIGUuc2V0TWF4SGVpZ2h0KG4ubWF4RXhwYW5kYWJsZUhlaWdodCksIGUuc2V0SGVpZ2h0Rm9yY2VkU2V0KCExKSwgZS5zZXRIZWlnaHQobnVsbCwgbi5tYXhFeHBhbmRhYmxlSGVpZ2h0KSwgdGhpcy5wYXJlbnQgJiYgdGhpcy5wYXJlbnQucmVuZGVyKCk7CiAgICAgIH0sIHRoaXMpOwogICAgfSwgZi5wcm90b3R5cGUuX2NvbGxhcHNlID0gZnVuY3Rpb24gKCkgewogICAgICBoLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gdGhpcy52UGFuZWwsCiAgICAgICAgICAgIHQgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgIG4gPSB5KHQucGFuZWxzLCB0LnZpZXdOYW1lKTsKICAgICAgICBlLnNldE1heEhlaWdodChuLm1heEhlaWdodCksIGUuc2V0SGVpZ2h0Rm9yY2VkU2V0KCExKSwgZS5zZXRIZWlnaHQobnVsbCwgbi5taW5IZWlnaHQpLCB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5yZW5kZXIoKTsKICAgICAgfSwgdGhpcyk7CiAgICB9LCBmLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5zdGF0ZS5jb2xsYXBzZWQ7CiAgICAgIGMucHJvdG90eXBlLnNldFN0YXRlLmNhbGwodGhpcywgZSksIHRoaXMuc3RhdGUuY29sbGFwc2VkICE9PSB0ICYmICh0aGlzLnN0YXRlLmNvbGxhcHNlZCA/IHRoaXMuX2NvbGxhcHNlKCkgOiB0aGlzLl9leHBhbmQoKSk7CiAgICB9LCBmLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsID0ge30sCiAgICAgICAgICBvID0gdGhpcy5vcHRpb25zLnRpbWV6b25lcy5sZW5ndGgsCiAgICAgICAgICBhID0gdDsKICAgICAgcmV0dXJuIGUgJiYgKGwuYm9yZGVyUmlnaHQgPSBlLndlZWsuZGF5Z3JpZC5ib3JkZXJSaWdodCB8fCBlLmNvbW1vbi5ib3JkZXIsIGwudG9kYXlCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsudG9kYXkuYmFja2dyb3VuZENvbG9yLCBsLndlZWtlbmRCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsud2Vla2VuZC5iYWNrZ3JvdW5kQ29sb3IsIGwuYmFja2dyb3VuZENvbG9yID0gZS53ZWVrLmRheWdyaWQuYmFja2dyb3VuZENvbG9yLCBsLmxlZnRXaWR0aCA9IGUud2Vlay5kYXlncmlkTGVmdC53aWR0aCwgbC5sZWZ0QmFja2dyb3VuZENvbG9yID0gZS53ZWVrLmRheWdyaWRMZWZ0LmJhY2tncm91bmRDb2xvciwgbC5sZWZ0UGFkZGluZ1JpZ2h0ID0gZS53ZWVrLmRheWdyaWRMZWZ0LnBhZGRpbmdSaWdodCwgbC5sZWZ0Qm9yZGVyUmlnaHQgPSBlLndlZWsuZGF5Z3JpZExlZnQuYm9yZGVyUmlnaHQsICFhICYmIG8gPiAxICYmIChuID0gaS5wYXJzZVVuaXQobC5sZWZ0V2lkdGgpLCBsLmxlZnRXaWR0aCA9IG5bMF0gKiBvICsgblsxXSkpLCBsOwogICAgfSwgZS5leHBvcnRzID0gZjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigzMCksCiAgICAgICAgaSA9IG4oNzApLAogICAgICAgIGEgPSBNYXRoLm1heDsKCiAgICBmdW5jdGlvbiByKGUsIHQpIHsKICAgICAgby5jYWxsKHRoaXMsIGUsIHQpLCB0aGlzLmNvbGxhcHNlZCA9ICEwOwogICAgfQoKICAgIGwuaW5oZXJpdChyLCBvKSwgci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5jb250YWluZXI7CiAgICAgIHQgPSB0aGlzLmdldEJhc2VWaWV3TW9kZWwoZSksIG4uaW5uZXJIVE1MID0gaSh0KSwgdGhpcy5maXJlKCJhZnRlclJlbmRlciIsIHQpOwogICAgfSwgci5wcm90b3R5cGUuX2dldE1heFNjaGVkdWxlSW5EYXkgPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gYS5hcHBseShudWxsLCBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShudWxsLCBsLm1hcChlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGUubGVuZ3RoOwogICAgICAgIH0pKTsKICAgICAgfSkpOwogICAgfSwgci5wcm90b3R5cGUuX2dldE1pbkhlaWdodCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5vcHRpb25zOwogICAgICByZXR1cm4gZSAqIHQuc2NoZWR1bGVIZWlnaHQgKyAoZSAtIDEpICogdC5zY2hlZHVsZUd1dHRlcjsKICAgIH0sIHIucHJvdG90eXBlLmdldEJhc2VWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBpID0gbi5nZXRWaWV3TW9kZWxGdW5jKGUpLAogICAgICAgICAgYSA9IHRoaXMuX2dldE1heFNjaGVkdWxlSW5EYXkoaSksCiAgICAgICAgICByID0gdGhpcy5fZ2V0U3R5bGVzKGUudGhlbWUpOwoKICAgICAgcmV0dXJuIHQgPSBvLnByb3RvdHlwZS5nZXRCYXNlVmlld01vZGVsLmNhbGwodGhpcywgZSksIHQgPSBsLmV4dGVuZCh7CiAgICAgICAgbWluSGVpZ2h0OiB0aGlzLl9nZXRNaW5IZWlnaHQoYSksCiAgICAgICAgbWF0cmljZXM6IGksCiAgICAgICAgc2NoZWR1bGVDb250YWluZXJUb3A6IHRoaXMub3B0aW9ucy5zY2hlZHVsZUNvbnRhaW5lclRvcCwKICAgICAgICBtYXhTY2hlZHVsZUluRGF5OiBhLAogICAgICAgIGlzUmVhZE9ubHk6IG4uaXNSZWFkT25seSwKICAgICAgICBzdHlsZXM6IHIKICAgICAgfSwgdCk7CiAgICB9LCByLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB7fTsKICAgICAgcmV0dXJuIGUgJiYgKHQuYm9yZGVyUmFkaXVzID0gZS53ZWVrLmRheUdyaWRTY2hlZHVsZS5ib3JkZXJSYWRpdXMpLCB0OwogICAgfSwgZS5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI3LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuICJcbiAgICAiICsgKG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImVhY2giKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKTsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuICJcbiAgICAiICsgKG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpOwogICAgICB9LAogICAgICA0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJ1xuICAgIDxkaXYgZGF0YS1pZD0iJyArIGMoKGQobiwgInN0YW1wIikgfHwgdCAmJiBkKHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnIlxuICAgICAgICBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlLWJsb2NrXG4gICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiZXhjZWVkTGVmdCIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAgICAgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZFJpZ2h0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDcsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNzMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICBzdHlsZT0idG9wOicgKyBjKChkKG4sICJtdWx0aXBseSIpIHx8IHQgJiYgZCh0LCAibXVsdGlwbHkiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgInRvcCIpIDogdCwgKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVCbG9ja0hlaWdodCIpLCB7CiAgICAgICAgICBuYW1lOiAibXVsdGlwbHkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAicHg7XG4gICAgICAgICAgICAgICAgbGVmdDoiICsgYygoZChuLCAiZ3JpZC1sZWZ0IikgfHwgdCAmJiBkKHQsICJncmlkLWxlZnQiKSB8fCBzKS5jYWxsKHIsIHQsIChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImRhdGVzIiksIHsKICAgICAgICAgIG5hbWU6ICJncmlkLWxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDUxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiJTtcbiAgICAgICAgICAgICAgICB3aWR0aDoiICsgYygoZChuLCAiZ3JpZC13aWR0aCIpIHx8IHQgJiYgZCh0LCAiZ3JpZC13aWR0aCIpIHx8IHMpLmNhbGwociwgdCwgKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAiZGF0ZXMiKSwgewogICAgICAgICAgbmFtZTogImdyaWQtd2lkdGgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDUzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnJSI+XG4gICAgICAgIDxkaXYgZGF0YS1zY2hlZHVsZS1pZD0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTA2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxOTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICAgICAgc3R5bGU9ImhlaWdodDonICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgbGluZS1oZWlnaHQ6IiArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGJvcmRlci1yYWRpdXM6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiYm9yZGVyUmFkaXVzIiksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAiICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDM5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGl0bGUiIHRpdGxlPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJyI+JyArIChudWxsICE9IChpID0gKGQobiwgInNjaGVkdWxlLXRtcGwiKSB8fCB0ICYmIGQodCwgInNjaGVkdWxlLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic2NoZWR1bGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDg3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTEyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwociwgKGQobiwgIm9yIikgfHwgdCAmJiBkKHQsICJvciIpIHx8IHMpLmNhbGwociwgKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAiaXNSZWFkT25seSIpLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNSZWFkT25seSIpIDogaSwgewogICAgICAgICAgbmFtZTogIm9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDE1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMTkzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDQ1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIndlZWtkYXktZXhjZWVkLWxlZnQiOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA0NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LWV4Y2VlZC1yaWdodCI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE0NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE2MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LXNjaGVkdWxlLWZvY3VzZWQgIjsKICAgICAgfSwKICAgICAgMTE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDEzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDE1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHMobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gcyh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA4OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUgaGFuZGxlLXkiIHN0eWxlPSJsaW5lLWhlaWdodDonICsgcihlLmxhbWJkYSgoaSA9IG8gJiYgcyhvLCAicm9vdCIpKSAmJiBzKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAncHg7Ij4mbmJzcDs8L3NwYW4+JzsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlcyAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJjb2xsYXBzZWQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiY29sbGFwc2VkIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbGxhcHNlZCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyJzdHlsZT0idG9wOicgKyBjKGUubGFtYmRhKChpID0gbyAmJiB1KG8sICJyb290IikpICYmIHUoaSwgInNjaGVkdWxlQ29udGFpbmVyVG9wIiksIHQpKSArICdweDsiPlxuJyArIChudWxsICE9IChpID0gdShuLCAiZWFjaCIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibWF0cmljZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWdyaWQtbGluZSJcbiAgICAgICAgICAgICAgICBzdHlsZT0ibGVmdDonICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJsZWZ0IikgfHwgKG51bGwgIT0gdCA/IHUodCwgImxlZnQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAibGVmdCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDM2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IHdpZHRoOiIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIndpZHRoIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIndpZHRoIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIndpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYmFja2dyb3VuZC1jb2xvcjogIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiYmFja2dyb3VuZENvbG9yIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImJhY2tncm91bmRDb2xvciIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJiYWNrZ3JvdW5kQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA5NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSB1KG4sICJ1bmxlc3MiKS5jYWxsKHIsIG8gJiYgdShvLCAibGFzdCIpLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICAgICAgIj48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGJvcmRlci1yaWdodDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJib3JkZXJSaWdodCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImVhY2giKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJkYXlzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTcsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI3LAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAiY29sbGFwc2VkIiksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDY6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSBhKG4sICJpZiIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgImhpZGRlblNjaGVkdWxlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAzMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZXhjZWVkLWluLXdlZWsiIHN0eWxlPSJ6LWluZGV4OiAxOyByaWdodDonICsgYygodShuLCAiZ2V0UmlnaHQiKSB8fCB0ICYmIHUodCwgImdldFJpZ2h0IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJsZWZ0IikgOiB0LCBudWxsICE9IHQgPyB1KHQsICJ3aWR0aCIpIDogdCwgewogICAgICAgICAgbmFtZTogImdldFJpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogOTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICclOyIgZGF0YS1pbmRleD0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAia2V5IikgfHwgbyAmJiB1KG8sICJrZXkiKSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImtleSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDEzNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDE0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJ3ZWVrR3JpZEZvb3RlckV4Y2VlZC10bXBsIikgfHwgdCAmJiB1KHQsICJ3ZWVrR3JpZEZvb3RlckV4Y2VlZC10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJoaWRkZW5TY2hlZHVsZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ3ZWVrR3JpZEZvb3RlckV4Y2VlZC10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMTQ1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMTkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSAoYShuLCAiZmkiKSB8fCB0ICYmIGEodCwgImZpIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBvICYmIGEobywgImtleSIpLCAiPT09IiwgKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAiY29sbGFwc2VCdG5JbmRleCIpLCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEwLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMTA6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWNvbGxhcHNlLWJ0biIgc3R5bGU9InotaW5kZXg6IDE7IHJpZ2h0OicgKyBjKCh1KG4sICJnZXRSaWdodCIpIHx8IHQgJiYgdSh0LCAiZ2V0UmlnaHQiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImxlZnQiKSA6IHQsIG51bGwgIT0gdCA/IHUodCwgIndpZHRoIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZ2V0UmlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiA5NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDExNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyU7Ij4nICsgKG51bGwgIT0gKGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJjb2xsYXBzZUJ0blRpdGxlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiY29sbGFwc2VCdG5UaXRsZS10bXBsIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbGxhcHNlQnRuVGl0bGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDEyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDE0OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ2aWV3TmFtZSIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ2aWV3TmFtZSIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ2aWV3TmFtZSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIi1sZWZ0ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2xlZnQiIHN0eWxlPSJib3JkZXItcmlnaHQ6ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJsZWZ0Qm9yZGVyUmlnaHQiKSA6IGksIHQpKSArICI7IHdpZHRoOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibGVmdFdpZHRoIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibGVmdEJhY2tncm91bmRDb2xvciIpIDogaSwgdCkpICsgIjsgcGFkZGluZy1yaWdodDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxlZnRQYWRkaW5nUmlnaHQiKSA6IGksIHQpKSArICc7Ij5cbiAgICAnICsgKG51bGwgIT0gKGkgPSAoaChuLCAiZGF5R3JpZFRpdGxlLXRtcGwiKSB8fCB0ICYmIGgodCwgImRheUdyaWRUaXRsZS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJ2aWV3TmFtZSIpIDogdCwgewogICAgICAgICAgbmFtZTogImRheUdyaWRUaXRsZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICdcbjwvZGl2PlxuPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ2aWV3TmFtZSIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ2aWV3TmFtZSIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ2aWV3TmFtZSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIi1yaWdodCAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDQ1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA1OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdyaWdodCI+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGFpbmVyIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1ncmlkIj5cbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImRheXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic2hvd0V4cGFuZGFibGVCdXR0b24iKSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG4iOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oNSksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oNiksCiAgICAgICAgcyA9IG4oMyksCiAgICAgICAgYyA9IG4oNCksCiAgICAgICAgdSA9IG4oMTEpLAogICAgICAgIGQgPSBuKDgpLAogICAgICAgIGggPSBuKDczKSwKICAgICAgICBwID0gbig3NSksCiAgICAgICAgbSA9IG4oNzYpLAogICAgICAgIGYgPSBuKDc3KSwKICAgICAgICBnID0gbig3OCksCiAgICAgICAgeSA9IGMuRGF0ZTsKCiAgICBmdW5jdGlvbiBTKGUsIHQsIG4sIG8pIHsKICAgICAgdmFyIGEsCiAgICAgICAgICByLAogICAgICAgICAgYyA9IGUuaG91clN0YXJ0LAogICAgICAgICAgdSA9IGUuaG91ckVuZCwKICAgICAgICAgIGQgPSBuZXcgeShlLnJlbmRlckVuZERhdGUpLAogICAgICAgICAgaCA9IHBhcnNlSW50KG4gLyA2MCwgMTApLAogICAgICAgICAgcCA9IE1hdGguYWJzKG4gJSA2MCksCiAgICAgICAgICBtID0gbmV3IHkoKS50b0xvY2FsVGltZSgpLAogICAgICAgICAgZiA9IG0uZ2V0TWludXRlcygpLAogICAgICAgICAgZyA9IGwucmFuZ2UoMCwgMjQpLAogICAgICAgICAgUyA9IG51bGw7CiAgICAgIHJldHVybiAoaCA8IDAgfHwgLTAgPT09IGgpICYmIHAgPiAwICYmIChoIC09IDEpLCBpLnNoaWZ0QXJyYXkoZywgaCksIGkudGFrZUFycmF5KGcsIGMsIHUpLCBhID0gaS5zaGlmdEhvdXJzKG0uZ2V0SG91cnMoKSwgaCkgJSAyNCwgciA9IGwuaW5BcnJheShhLCBnKSwgdCAmJiAoZiA8IDIwID8gUyA9IGEgOiBmID4gNDAgJiYgKFMgPSBhICsgMSksIGwuaXNOdW1iZXIoUykgJiYgKFMgJT0gMjQpKSwgbC5tYXAoZywgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICB2YXIgbCwgaTsKICAgICAgICByZXR1cm4gdCAmJiBuIDw9IHIgfHwgZCA8IG0gJiYgIXMuaXNTYW1lRGF0ZShkLCBtKSA/IChsID0gby5wYXN0VGltZUNvbG9yLCBpID0gby5wYXN0VGltZUZvbnRXZWlnaHQpIDogKGwgPSBvLmZ1dHVyZVRpbWVDb2xvciwgaSA9IG8uZnV0dXJlVGltZUZvbnRXZWlnaHQpLCB7CiAgICAgICAgICBob3VyOiBlLAogICAgICAgICAgbWludXRlczogcCwKICAgICAgICAgIGhpZGRlbjogUyA9PT0gZSB8fCAwID09PSBuLAogICAgICAgICAgY29sb3I6IGwgfHwgIiIsCiAgICAgICAgICBmb250V2VpZ2h0OiBpIHx8ICIiCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gXyhlLCB0LCBuLCBpKSB7CiAgICAgIHZhciByID0gYS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2Iiwgbiwgby5jbGFzc25hbWUoInRpbWVncmlkLWNvbnRhaW5lciIpKSwKICAgICAgICAgIHMgPSBhLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBuLCBvLmNsYXNzbmFtZSgidGltZWdyaWQtc3RpY2t5LWNvbnRhaW5lciIpKTsKICAgICAgbi5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSIsIGUgPSBlIHx8ICJ0aW1lIiwgZC5jYWxsKHRoaXMsIHIpLCBsLmJyb3dzZXIuc2FmYXJpIHx8ICh0aGlzLl9hdXRvU2Nyb2xsID0gbmV3IHAocikpLCB0aGlzLnN0aWNreUNvbnRhaW5lciA9IHMsIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICB2aWV3TmFtZTogZSwKICAgICAgICByZW5kZXJTdGFydERhdGU6ICIiLAogICAgICAgIHJlbmRlckVuZERhdGU6ICIiLAogICAgICAgIGhvdXJTdGFydDogImRheSIgPT09IGkgPyA4IDogMCwKICAgICAgICBob3VyRW5kOiAiZGF5IiA9PT0gaSA/IDE4IDogMjQsCiAgICAgICAgdGltZXpvbmVzOiB0LnRpbWV6b25lcywKICAgICAgICBpc1JlYWRPbmx5OiB0LmlzUmVhZE9ubHksCiAgICAgICAgc2hvd1RpbWV6b25lQ29sbGFwc2VCdXR0b246ICExLAogICAgICAgIGNhbGVuZGFyVmlld05hbWU6IGkKICAgICAgfSwgdC53ZWVrKSwgdGhpcy5vcHRpb25zLnRpbWV6b25lcy5sZW5ndGggPCAxICYmICh0aGlzLm9wdGlvbnMudGltZXpvbmVzID0gW3sKICAgICAgICB0aW1lem9uZU9mZnNldDogYy5nZXRPZmZzZXQoKQogICAgICB9XSksIHRoaXMuaW50ZXJ2YWxJRCA9IDAsIHRoaXMudGltZXJJRCA9IDAsIHRoaXMuckFuaW1hdGlvbkZyYW1lSUQgPSAwLCB0aGlzLl9zY3JvbGxlZCA9ICExLCB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbCA9IG51bGwsIHRoaXMuX2NhY2hlSG91cnNMYWJlbHMgPSBudWxsLCB0aGlzLmF0dGFjaEV2ZW50KCk7CiAgICB9CgogICAgbC5pbmhlcml0KF8sIGQpLCBfLnByb3RvdHlwZS52aWV3TmFtZSA9ICJ0aW1lZ3JpZCIsIF8ucHJvdG90eXBlLl9iZWZvcmVEZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJRCksIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySUQpLCB1LmNhbmNlbEFuaW1GcmFtZSh0aGlzLnJBbmltYXRpb25GcmFtZUlEKSwgdGhpcy5fYXV0b1Njcm9sbCAmJiB0aGlzLl9hdXRvU2Nyb2xsLmRlc3Ryb3koKSwgci5vZmYodGhpcy5zdGlja3lDb250YWluZXIsICJjbGljayIsIHRoaXMuX29uQ2xpY2tTdGlja3lDb250YWluZXIsIHRoaXMpLCB0aGlzLl9hdXRvU2Nyb2xsID0gdGhpcy5ob3VybWFya2VycyA9IHRoaXMuaW50ZXJ2YWxJRCA9IHRoaXMudGltZXJJRCA9IHRoaXMuckFuaW1hdGlvbkZyYW1lSUQgPSB0aGlzLl9jYWNoZVBhcmVudFZpZXdNb2RlbCA9IHRoaXMuc3RpY2t5Q29udGFpbmVyID0gbnVsbDsKICAgIH0sIF8ucHJvdG90eXBlLl9nZXRUb3BQZXJjZW50QnlUaW1lID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgbyA9IHMucmF3KGUgfHwgbmV3IHkoKSksCiAgICAgICAgICBhID0gbC5yYW5nZShuLmhvdXJTdGFydCwgbi5ob3VyRW5kKS5sZW5ndGggKiBzLk1JTExJU0VDT05EU19QRVJfSE9VUiwKICAgICAgICAgIHIgPSBzLm1pbGxpc2Vjb25kc0Zyb20oImhvdXIiLCBvLmgpICsgcy5taWxsaXNlY29uZHNGcm9tKCJtaW51dGVzIiwgby5tKSArIHMubWlsbGlzZWNvbmRzRnJvbSgic2Vjb25kcyIsIG8ucykgKyBvLm1zOwogICAgICByZXR1cm4gdCA9IGkucmF0aW8oYSwgMTAwLCByKSwgdCAtPSBpLnJhdGlvKGEsIDEwMCwgcy5taWxsaXNlY29uZHNGcm9tKCJob3VyIiwgbi5ob3VyU3RhcnQpKSwgaS5saW1pdCh0LCBbMF0sIFsxMDBdKTsKICAgIH0sIF8ucHJvdG90eXBlLl9nZXRIb3VybWFya2VyVmlld01vZGVsID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8gPSAtMSwKICAgICAgICAgIGkgPSAtMSwKICAgICAgICAgIGEgPSBbXSwKICAgICAgICAgIHIgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICB1ID0gYy5nZXRPZmZzZXQoKSwKICAgICAgICAgIGQgPSByLnRpbWV6b25lczsKICAgICAgcmV0dXJuIGwuZm9yRWFjaChuLCBmdW5jdGlvbiAobiwgbCkgewogICAgICAgIHMuaXNTYW1lRGF0ZShlLCBuKSAmJiAobyA9IHRbbF0gPyB0W2xdLmxlZnQgOiAwLCBpID0gdFtsXSA/IHRbbF0ud2lkdGggOiAwKTsKICAgICAgfSksIGwuZm9yRWFjaChkLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBsID0gdC50aW1lem9uZU9mZnNldCArIHUsCiAgICAgICAgICAgIG8gPSBuZXcgeShlKTsKICAgICAgICBvLnNldE1pbnV0ZXMoby5nZXRNaW51dGVzKCkgKyBsKSwgbiA9IHMuZ2V0RGF0ZURpZmZlcmVuY2UobywgZSksIGEucHVzaCh7CiAgICAgICAgICBob3VybWFya2VyOiBvLAogICAgICAgICAgZGF0ZURpZmZlcmVuY2VTaWduOiBuIDwgMCA/ICItIiA6ICIrIiwKICAgICAgICAgIGRhdGVEaWZmZXJlbmNlOiBNYXRoLmFicyhuKQogICAgICAgIH0pOwogICAgICB9KSwgewogICAgICAgIGN1cnJlbnRIb3VyczogZS5nZXRIb3VycygpLAogICAgICAgIGhvdXJtYXJrZXJUb3A6IHRoaXMuX2dldFRvcFBlcmNlbnRCeVRpbWUoZSksCiAgICAgICAgaG91cm1hcmtlclRpbXpvbmVzOiBhLAogICAgICAgIHRvZGF5bWFya2VyTGVmdDogbywKICAgICAgICB0b2RheW1hcmtlcldpZHRoOiBpLAogICAgICAgIHRvZGF5bWFya2VyUmlnaHQ6IG8gKyBpCiAgICAgIH07CiAgICB9LCBfLnByb3RvdHlwZS5fZ2V0VGltZXpvbmVWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIGkgPSBjLmdldE9mZnNldCgpLAogICAgICAgICAgYSA9IG8udGltZXpvbmVzLAogICAgICAgICAgciA9IGEubGVuZ3RoLAogICAgICAgICAgdSA9IFtdLAogICAgICAgICAgZCA9IHQsCiAgICAgICAgICBoID0gZCA/IDEwMCA6IDEwMCAvIHIsCiAgICAgICAgICBwID0gbmV3IHkoKS50b0xvY2FsVGltZSgpLAogICAgICAgICAgbSA9IG4uZGlzcGxheVRpbWV6b25lTGFiZWxCYWNrZ3JvdW5kQ29sb3I7CiAgICAgIHJldHVybiBsLmZvckVhY2goYSwgZnVuY3Rpb24gKHQsIGwpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgYywKICAgICAgICAgICAgZiwKICAgICAgICAgICAgZyA9IG5ldyB5KHApOwogICAgICAgIHIgPSB0LnRpbWV6b25lT2Zmc2V0ICsgaSwgYyA9IFMobywgZSA+PSAwLCByLCBuKSwgZy5zZXRNaW51dGVzKGcuZ2V0TWludXRlcygpICsgciksIGYgPSBzLmdldERhdGVEaWZmZXJlbmNlKGcsIHApLCBsID4gMCAmJiAobSA9IG4uYWRkaXRpb25hbFRpbWV6b25lQmFja2dyb3VuZENvbG9yKSwgdS5wdXNoKHsKICAgICAgICAgIHRpbWVTbG90czogYywKICAgICAgICAgIGRpc3BsYXlMYWJlbDogdC5kaXNwbGF5TGFiZWwsCiAgICAgICAgICB0aW1lem9uZU9mZnNldDogdC50aW1lem9uZU9mZnNldCwKICAgICAgICAgIHRvb2x0aXA6IHQudG9vbHRpcCB8fCAiIiwKICAgICAgICAgIHdpZHRoOiBoLAogICAgICAgICAgbGVmdDogZCA/IDAgOiAoYS5sZW5ndGggLSBsIC0gMSkgKiBoLAogICAgICAgICAgaXNQcmltYXJ5OiAwID09PSBsLAogICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBtIHx8ICIiLAogICAgICAgICAgaGlkZGVuOiAwICE9PSBsICYmIGQsCiAgICAgICAgICBob3VybWFya2VyOiBnLAogICAgICAgICAgZGF0ZURpZmZlcmVuY2VTaWduOiBmIDwgMCA/ICItIiA6ICIrIiwKICAgICAgICAgIGRhdGVEaWZmZXJlbmNlOiBNYXRoLmFicyhmKQogICAgICAgIH0pOwogICAgICB9KSwgdTsKICAgIH0sIF8ucHJvdG90eXBlLl9nZXRCYXNlVmlld01vZGVsID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLmdyaWRzLAogICAgICAgICAgbiA9IGUucmFuZ2UsCiAgICAgICAgICBvID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgaSA9IHRoaXMuX2dldEhvdXJtYXJrZXJWaWV3TW9kZWwobmV3IHkoKS50b0xvY2FsVGltZSgpLCB0LCBuKSwKICAgICAgICAgIGEgPSBsLnBpY2soZSwgInN0YXRlIiwgInRpbWV6b25lc0NvbGxhcHNlZCIpLAogICAgICAgICAgciA9IHRoaXMuX2dldFN0eWxlcyhlLnRoZW1lLCBhKTsKCiAgICAgIHJldHVybiBsLmV4dGVuZChpLCB7CiAgICAgICAgdGltZXpvbmVzOiB0aGlzLl9nZXRUaW1lem9uZVZpZXdNb2RlbChpLnRvZGF5bWFya2VyTGVmdCwgYSwgciksCiAgICAgICAgaG91cnNMYWJlbHM6IFMobywgaS50b2RheW1hcmtlckxlZnQgPj0gMCwgMCwgciksCiAgICAgICAgc3R5bGVzOiByLAogICAgICAgIHNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uOiBsLnBpY2sobywgInNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uIiksCiAgICAgICAgdGltZXpvbmVzQ29sbGFwc2VkOiBhLAogICAgICAgIGlzRGF5VmlldzogImRheSIgPT09IG8uY2FsZW5kYXJWaWV3TmFtZSwKICAgICAgICBpc1dlZWtWaWV3OiAid2VlayIgPT09IG8uY2FsZW5kYXJWaWV3TmFtZSwKICAgICAgICBpc01vbnRoVmlldzogIm1vbnRoIiA9PT0gby5jYWxlbmRhclZpZXdOYW1lLAogICAgICAgIGhvdXJTdGFydDogby5ob3VyU3RhcnQsCiAgICAgICAgaG91ckVuZDogby5ob3VyRW5kCiAgICAgIH0pOwogICAgfSwgXy5wcm90b3R5cGUuX3JlbmRlckNoaWxkcmVuID0gZnVuY3Rpb24gKGUsIHQsIG4sIGkpIHsKICAgICAgdmFyIHIsCiAgICAgICAgICBjLAogICAgICAgICAgdSwKICAgICAgICAgIGQsCiAgICAgICAgICBwID0gdGhpcywKICAgICAgICAgIG0gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBmID0gcy5mb3JtYXQobmV3IHkoKSwgIllZWVlNTUREIiksCiAgICAgICAgICBnID0gMDsKICAgICAgbi5pbm5lckhUTUwgPSAiIiwgdGhpcy5jaGlsZHJlbi5jbGVhcigpLCBkID0gYS5nZXRTaXplKG4ucGFyZW50RWxlbWVudClbMV0sIGwuZm9yRWFjaChlLCBmdW5jdGlvbiAoZSwgbCkgewogICAgICAgIHUgPSBsID09PSBmLCByID0gewogICAgICAgICAgaW5kZXg6IGcsCiAgICAgICAgICBsZWZ0OiB0W2ddID8gdFtnXS5sZWZ0IDogMCwKICAgICAgICAgIHdpZHRoOiB0W2ddID8gdFtnXS53aWR0aCA6IDAsCiAgICAgICAgICB5bWQ6IGwsCiAgICAgICAgICBpc1RvZGF5OiB1LAogICAgICAgICAgaXNQZW5kaW5nOiBtLmlzUGVuZGluZywKICAgICAgICAgIGlzRm9jdXNlZDogbS5pc0ZvY3VzZWQsCiAgICAgICAgICBpc1JlYWRPbmx5OiBtLmlzUmVhZE9ubHksCiAgICAgICAgICBob3VyU3RhcnQ6IG0uaG91clN0YXJ0LAogICAgICAgICAgaG91ckVuZDogbS5ob3VyRW5kLAogICAgICAgICAgY2FsZW5kYXJWaWV3TmFtZTogbS5jYWxlbmRhclZpZXdOYW1lCiAgICAgICAgfSwgKGMgPSBuZXcgaChyLCBhLmFwcGVuZEhUTUxFbGVtZW50KCJkaXYiLCBuLCBvLmNsYXNzbmFtZSgidGltZS1kYXRlIikpLCBpKSkucmVuZGVyKGwsIGUsIGQpLCBwLmFkZENoaWxkKGMpLCBnICs9IDE7CiAgICAgIH0pOwogICAgfSwgXy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBuID0gZS5zY2hlZHVsZXNJbkRhdGVSYW5nZVt0LnZpZXdOYW1lXSwKICAgICAgICAgIGkgPSB0aGlzLmNvbnRhaW5lciwKICAgICAgICAgIHIgPSBlLmdyaWRzLAogICAgICAgICAgcyA9IHRoaXMuX2dldEJhc2VWaWV3TW9kZWwoZSksCiAgICAgICAgICBjID0gbC5rZXlzKG4pLmxlbmd0aDsKCiAgICAgIHRoaXMuX2NhY2hlUGFyZW50Vmlld01vZGVsID0gZSwgdGhpcy5fY2FjaGVIb3Vyc0xhYmVscyA9IHMuaG91cnNMYWJlbHMsIGMgJiYgKHMuc2hvd0hvdXJNYXJrZXIgPSBzLnRvZGF5bWFya2VyTGVmdCA+PSAwLCBpLmlubmVySFRNTCA9IG0ocyksIHRoaXMucmVuZGVyU3RpY2t5Q29udGFpbmVyKHMpLCB0aGlzLl9yZW5kZXJDaGlsZHJlbihuLCByLCBhLmZpbmQoby5jbGFzc25hbWUoIi50aW1lZ3JpZC1zY2hlZHVsZXMtY29udGFpbmVyIiksIGkpLCBlLnRoZW1lKSwgdGhpcy5faG91ckxhYmVscyA9IGEuZmluZCgidWwiLCBpKSwgdGhpcy5ob3VybWFya2VycyA9IGEuZmluZChvLmNsYXNzbmFtZSgiLnRpbWVncmlkLWhvdXJtYXJrZXIiKSwgaSwgITApLCB0aGlzLl9zY3JvbGxlZCB8fCAodGhpcy5fc2Nyb2xsZWQgPSAhMCwgdGhpcy5zY3JvbGxUb05vdygpKSk7CiAgICB9LCBfLnByb3RvdHlwZS5yZW5kZXJTdGlja3lDb250YWluZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuc3RpY2t5Q29udGFpbmVyOwogICAgICB0LmlubmVySFRNTCA9IGYoZSksIHQuc3R5bGUuZGlzcGxheSA9IGUudGltZXpvbmVzLmxlbmd0aCA+IDEgPyAiYmxvY2siIDogIm5vbmUiLCB0LnN0eWxlLndpZHRoID0gZS5zdHlsZXMubGVmdFdpZHRoLCB0LnN0eWxlLmhlaWdodCA9IGUuc3R5bGVzLmRpc3BsYXlUaW1lem9uZUxhYmVsSGVpZ2h0LCB0LnN0eWxlLmJvcmRlckJvdHRvbSA9IGUuc3R5bGVzLmxlZnRCb3JkZXJSaWdodDsKICAgIH0sIF8ucHJvdG90eXBlLnJlZnJlc2hIb3VybWFya2VyID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSwKICAgICAgICAgIHQgPSB0aGlzLmhvdXJtYXJrZXJzLAogICAgICAgICAgbiA9IHRoaXMuX2NhY2hlUGFyZW50Vmlld01vZGVsLAogICAgICAgICAgaSA9IHRoaXMuX2NhY2hlSG91cnNMYWJlbHMsCiAgICAgICAgICByID0gdGhpcy5yQW5pbWF0aW9uRnJhbWVJRDsKICAgICAgdCAmJiBuICYmICFyICYmIChlID0gdGhpcy5fZ2V0QmFzZVZpZXdNb2RlbChuKSwgdGhpcy5yQW5pbWF0aW9uRnJhbWVJRCA9IHUucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHIgPSAhMTsKICAgICAgICBsLmZvckVhY2goaSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHJldHVybiB0LmhpZGRlbiA9PT0gZS5ob3Vyc0xhYmVsc1tuXS5oaWRkZW4gfHwgKHIgPSAhMCwgITEpOwogICAgICAgIH0pLCByID8gdGhpcy5yZW5kZXIobikgOiBsLmZvckVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gYS5maW5kKG8uY2xhc3NuYW1lKCIudGltZWdyaWQtdG9kYXltYXJrZXIiKSwgdCksCiAgICAgICAgICAgICAgbCA9IGEuZmluZChvLmNsYXNzbmFtZSgiLnRpbWVncmlkLWhvdXJtYXJrZXItdGltZSIpLCB0KSwKICAgICAgICAgICAgICBpID0gYS5jbG9zZXN0KHQsIG8uY2xhc3NuYW1lKCIudGltZWdyaWQtdGltZXpvbmUiKSksCiAgICAgICAgICAgICAgciA9IGkgPyBhLmdldERhdGEoaSwgInRpbWV6b25lSW5kZXgiKSA6IDA7CiAgICAgICAgICB0LnN0eWxlLnRvcCA9IGUuaG91cm1hcmtlclRvcCArICIlIiwgbiAmJiAobi5zdHlsZS5kaXNwbGF5ID0gZS50b2RheW1hcmtlckxlZnQgPj0gMCA/ICJibG9jayIgOiAibm9uZSIpLCBsICYmIChsLmlubmVySFRNTCA9IGcoZS5ob3VybWFya2VyVGltem9uZXNbcl0pKTsKICAgICAgICB9KSwgdGhpcy5yQW5pbWF0aW9uRnJhbWVJRCA9IG51bGw7CiAgICAgIH0sIHRoaXMpKTsKICAgIH0sIF8ucHJvdG90eXBlLmF0dGFjaEV2ZW50ID0gZnVuY3Rpb24gKCkgewogICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJRCksIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySUQpLCB0aGlzLmludGVydmFsSUQgPSB0aGlzLnRpbWVySUQgPSB0aGlzLnJBbmltYXRpb25GcmFtZUlEID0gbnVsbCwgdGhpcy50aW1lcklEID0gc2V0VGltZW91dChsLmJpbmQodGhpcy5vblRpY2ssIHRoaXMpLCAxZTMgKiAoNjAgLSBuZXcgeSgpLmdldFNlY29uZHMoKSkpLCByLm9uKHRoaXMuc3RpY2t5Q29udGFpbmVyLCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrU3RpY2t5Q29udGFpbmVyLCB0aGlzKTsKICAgIH0sIF8ucHJvdG90eXBlLnNjcm9sbFRvTm93ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSwKICAgICAgICAgIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIF9vLAogICAgICAgICAgaSA9IHRoaXMuY29udGFpbmVyOwoKICAgICAgdGhpcy5ob3VybWFya2VycyAmJiB0aGlzLmhvdXJtYXJrZXJzLmxlbmd0aCAmJiAoZSA9IHRoaXMuaG91cm1hcmtlcnNbMF0ub2Zmc2V0VG9wLCB0ID0gdGhpcy5nZXRWaWV3Qm91bmQoKSwgbiA9IGUsIGwgPSB0LmhlaWdodCAvIDQsIDEwLCBfbyA9IGZ1bmN0aW9uIG8oKSB7CiAgICAgICAgbiA+IGUgLSBsID8gKG4gLT0gMTAsIGkuc2Nyb2xsVG9wID0gbiwgdS5yZXF1ZXN0QW5pbUZyYW1lKF9vKSkgOiBpLnNjcm9sbFRvcCA9IGUgLSBsOwogICAgICB9LCB1LnJlcXVlc3RBbmltRnJhbWUoX28pKTsKICAgIH0sIF8ucHJvdG90eXBlLm9uVGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy50aW1lcklEICYmIChjbGVhclRpbWVvdXQodGhpcy50aW1lcklEKSwgdGhpcy50aW1lcklEID0gbnVsbCksIHRoaXMuaW50ZXJ2YWxJRCB8fCAodGhpcy5pbnRlcnZhbElEID0gc2V0SW50ZXJ2YWwobC5iaW5kKHRoaXMub25UaWNrLCB0aGlzKSwgNmU0KSksIHRoaXMucmVmcmVzaEhvdXJtYXJrZXIoKTsKICAgIH0sIF8ucHJvdG90eXBlLl9nZXRTdHlsZXMgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSB7fSwKICAgICAgICAgIG8gPSB0aGlzLm9wdGlvbnMudGltZXpvbmVzLmxlbmd0aCwKICAgICAgICAgIGEgPSB0OwogICAgICByZXR1cm4gZSAmJiAobC5ib3JkZXJCb3R0b20gPSBlLndlZWsudGltZWdyaWRIb3Jpem9udGFsTGluZS5ib3JkZXJCb3R0b20gfHwgZS5jb21tb24uYm9yZGVyLCBsLmhhbGZIb3VyQm9yZGVyQm90dG9tID0gZS53ZWVrLnRpbWVncmlkSGFsZkhvdXIuYm9yZGVyQm90dG9tIHx8IGUuY29tbW9uLmJvcmRlciwgbC50b2RheUJhY2tncm91bmRDb2xvciA9IGUud2Vlay50b2RheS5iYWNrZ3JvdW5kQ29sb3IsIGwud2Vla2VuZEJhY2tncm91bmRDb2xvciA9IGUud2Vlay53ZWVrZW5kLmJhY2tncm91bmRDb2xvciwgbC5iYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsuZGF5Z3JpZC5iYWNrZ3JvdW5kQ29sb3IsIGwubGVmdFdpZHRoID0gZS53ZWVrLnRpbWVncmlkTGVmdC53aWR0aCwgbC5sZWZ0QmFja2dyb3VuZENvbG9yID0gZS53ZWVrLnRpbWVncmlkTGVmdC5iYWNrZ3JvdW5kQ29sb3IsIGwubGVmdEJvcmRlclJpZ2h0ID0gZS53ZWVrLnRpbWVncmlkTGVmdC5ib3JkZXJSaWdodCB8fCBlLmNvbW1vbi5ib3JkZXIsIGwubGVmdEZvbnRTaXplID0gZS53ZWVrLnRpbWVncmlkTGVmdC5mb250U2l6ZSwgbC50aW1lem9uZVdpZHRoID0gZS53ZWVrLnRpbWVncmlkTGVmdC53aWR0aCwgbC5hZGRpdGlvbmFsVGltZXpvbmVCYWNrZ3JvdW5kQ29sb3IgPSBlLndlZWsudGltZWdyaWRMZWZ0QWRkaXRpb25hbFRpbWV6b25lLmJhY2tncm91bmRDb2xvciB8fCBsLmxlZnRCYWNrZ3JvdW5kQ29sb3IsIGwuZGlzcGxheVRpbWV6b25lTGFiZWxIZWlnaHQgPSBlLndlZWsudGltZWdyaWRMZWZ0VGltZXpvbmVMYWJlbC5oZWlnaHQsIGwuZGlzcGxheVRpbWV6b25lTGFiZWxCYWNrZ3JvdW5kQ29sb3IgPSAiaW5oZXJpdCIgPT09IGUud2Vlay50aW1lZ3JpZExlZnQuYmFja2dyb3VuZENvbG9yID8gIndoaXRlIiA6IGUud2Vlay50aW1lZ3JpZExlZnQuYmFja2dyb3VuZENvbG9yLCBsLm9uZUhvdXJIZWlnaHQgPSBlLndlZWsudGltZWdyaWRPbmVIb3VyLmhlaWdodCwgbC5oYWxmSG91ckhlaWdodCA9IGUud2Vlay50aW1lZ3JpZEhhbGZIb3VyLmhlaWdodCwgbC5xdWF0ZXJIb3VySGVpZ2h0ID0gcGFyc2VJbnQobC5oYWxmSG91ckhlaWdodCwgMTApIC8gMiArICJweCIsIGwuY3VycmVudFRpbWVDb2xvciA9IGUud2Vlay5jdXJyZW50VGltZS5jb2xvciwgbC5jdXJyZW50VGltZUZvbnRTaXplID0gZS53ZWVrLmN1cnJlbnRUaW1lLmZvbnRTaXplLCBsLmN1cnJlbnRUaW1lRm9udFdlaWdodCA9IGUud2Vlay5jdXJyZW50VGltZS5mb250V2VpZ2h0LCBsLnBhc3RUaW1lQ29sb3IgPSBlLndlZWsucGFzdFRpbWUuY29sb3IsIGwucGFzdFRpbWVGb250V2VpZ2h0ID0gZS53ZWVrLnBhc3RUaW1lLmZvbnRXZWlnaHQsIGwuZnV0dXJlVGltZUNvbG9yID0gZS53ZWVrLmZ1dHVyZVRpbWUuY29sb3IsIGwuZnV0dXJlVGltZUZvbnRXZWlnaHQgPSBlLndlZWsuZnV0dXJlVGltZS5mb250V2VpZ2h0LCBsLmN1cnJlbnRUaW1lTGVmdEJvcmRlclRvcCA9IGUud2Vlay5jdXJyZW50VGltZUxpbmVQYXN0LmJvcmRlciwgbC5jdXJyZW50VGltZUJ1bGxldEJhY2tncm91bmRDb2xvciA9IGUud2Vlay5jdXJyZW50VGltZUxpbmVCdWxsZXQuYmFja2dyb3VuZENvbG9yLCBsLmN1cnJlbnRUaW1lVG9kYXlCb3JkZXJUb3AgPSBlLndlZWsuY3VycmVudFRpbWVMaW5lVG9kYXkuYm9yZGVyLCBsLmN1cnJlbnRUaW1lUmlnaHRCb3JkZXJUb3AgPSBlLndlZWsuY3VycmVudFRpbWVMaW5lRnV0dXJlLmJvcmRlciwgIWEgJiYgbyA+IDEgJiYgKG4gPSBpLnBhcnNlVW5pdChsLmxlZnRXaWR0aCksIGwubGVmdFdpZHRoID0gblswXSAqIG8gKyBuWzFdKSksIGw7CiAgICB9LCBfLnByb3RvdHlwZS5fb25DbGlja1N0aWNreUNvbnRhaW5lciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gci5nZXRFdmVudFRhcmdldChlKTsKICAgICAgYS5jbG9zZXN0KHQsIG8uY2xhc3NuYW1lKCIudGltZWdyaWQtdGltZXpvbmUtY2xvc2UtYnRuIikpICYmIHRoaXMuZmlyZSgiY2xpY2tUaW1lem9uZXNDb2xsYXBzZWRCdG4iKTsKICAgIH0sIGUuZXhwb3J0cyA9IF87CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oOCksCiAgICAgICAgcyA9IG4oNzQpLAogICAgICAgIGMgPSBsLmZvckVhY2hBcnJheSwKICAgICAgICB1ID0gaS5NSUxMSVNFQ09ORFNfU0NIRURVTEVfTUlOX0RVUkFUSU9OOwoKICAgIGZ1bmN0aW9uIGQoZSwgdCwgbikgewogICAgICByLmNhbGwodGhpcywgdCksIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBpbmRleDogMCwKICAgICAgICB3aWR0aDogMCwKICAgICAgICB5bWQ6ICIiLAogICAgICAgIGlzVG9kYXk6ICExLAogICAgICAgIHBlbmRpbmc6ICExLAogICAgICAgIGhvdXJTdGFydDogMCwKICAgICAgICBob3VyRW5kOiAyNCwKICAgICAgICBkZWZhdWx0TWFyZ2luQm90dG9tOiAyLAogICAgICAgIG1pbkhlaWdodDogMTguNSwKICAgICAgICBpc1JlYWRPbmx5OiAhMQogICAgICB9LCBlKSwgdGhpcy50aW1lVG1wbCA9IHMsIHRoaXMudGhlbWUgPSBuLCB0LnN0eWxlLndpZHRoID0gZS53aWR0aCArICIlIiwgdC5zdHlsZS5sZWZ0ID0gZS5sZWZ0ICsgIiUiLCB0aGlzLm9wdGlvbnMuaXNUb2RheSAmJiBhLmFkZENsYXNzKHRoaXMuY29udGFpbmVyLCBvLmNsYXNzbmFtZSgidG9kYXkiKSksIHRoaXMuYXBwbHlUaGVtZSgpOwogICAgfQoKICAgIGwuaW5oZXJpdChkLCByKSwgZC5wcm90b3R5cGUuX3BhcnNlRGF0ZUdyb3VwID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBwYXJzZUludChlLnN1YnN0cigwLCA0KSwgMTApLAogICAgICAgICAgbiA9IHBhcnNlSW50KGUuc3Vic3RyKDQsIDIpLCAxMCksCiAgICAgICAgICBsID0gcGFyc2VJbnQoZS5zdWJzdHIoNiwgMiksIDEwKSwKICAgICAgICAgIG8gPSBpLnN0YXJ0KCk7CiAgICAgIHJldHVybiBvLnNldEZ1bGxZZWFyKHQsIG4gLSAxLCBsKSwgaS5zdGFydChvKTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXRTY2hlZHVsZVZpZXdCb3VuZFggPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSBuZXcgRGF0ZSh0LnRvZGF5U3RhcnQuX2RhdGUpLmdldEhvdXJzKCksCiAgICAgICAgICBvID0gbmV3IERhdGUoZS5tb2RlbC5zdGFydC5fZGF0ZSkuZ2V0SG91cnMoKSwKICAgICAgICAgIGkgPSB0LmJhc2VXaWR0aCAqIChlLmV4dHJhU3BhY2UgKyAxKTsKICAgICAgcmV0dXJuIGUuaGFzQ29sbGlkZSB8fCAoaSA9IG51bGwpLCBuID0gMTAgKiAobyAtIGwpICsgMSwgewogICAgICAgIGxlZnQ6ICJkYXkiID09PSB0aGlzLm9wdGlvbnMuY2FsZW5kYXJWaWV3TmFtZSA/IG4gOiB0LmJhc2VMZWZ0W3QuY29sdW1uSW5kZXhdLAogICAgICAgIHdpZHRoOiBpCiAgICAgIH07CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0U2NoZWR1bGVWaWV3Qm91bmRZID0gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGEsCiAgICAgICAgICByID0gdC5iYXNlTVMsCiAgICAgICAgICBzID0gdC5iYXNlSGVpZ2h0LAogICAgICAgICAgYyA9ICExLAogICAgICAgICAgZCA9ICExLAogICAgICAgICAgaCA9IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIGUudmFsdWVPZigpLmdvaW5nRHVyYXRpb24pLAogICAgICAgICAgcCA9IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIGUudmFsdWVPZigpLmNvbWluZ0R1cmF0aW9uKSwKICAgICAgICAgIG0gPSBlLnZhbHVlT2YoKS5zdGFydCAtIGggLSB0LnRvZGF5U3RhcnQsCiAgICAgICAgICBmID0gdGhpcy5vcHRpb25zLmNhbGVuZGFyVmlld05hbWUsCiAgICAgICAgICBnID0gcyAqIG0gLyByLAogICAgICAgICAgeSA9IGUuZHVyYXRpb24oKTsKICAgICAgcmV0dXJuIG4gPSBzICogKCh5ID0geSA+IHUgPyB5IDogdSkgKyBoICsgcCkgLyByLCBsID0gcyAqIGggLyByLCBvID0gcyAqIHkgLyByLCBhID0gcyAqIHAgLyByLCBtIDwgMCAmJiAoZyA9IDAsIG4gKz0gcyAqIG0gLyByLCBjID0gITApLCBuICsgZyA+IHMgJiYgKG4gPSBzIC0gZywgZCA9ICEwKSwgewogICAgICAgIHRvcDogZywKICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KG4sIHRoaXMub3B0aW9ucy5taW5IZWlnaHQpIC0gdGhpcy5vcHRpb25zLmRlZmF1bHRNYXJnaW5Cb3R0b20sCiAgICAgICAgbW9kZWxEdXJhdGlvbkhlaWdodDogbywKICAgICAgICBnb2luZ0R1cmF0aW9uSGVpZ2h0OiBsLAogICAgICAgIGNvbWluZ0R1cmF0aW9uSGVpZ2h0OiBhLAogICAgICAgIGhhc0dvaW5nRHVyYXRpb246IGggPiAwLAogICAgICAgIGhhc0NvbWluZ0R1cmF0aW9uOiBwID4gMCwKICAgICAgICBjcm9wcGVkU3RhcnQ6IGMsCiAgICAgICAgY3JvcHBlZEVuZDogZCwKICAgICAgICBjYWxlbmRhclZpZXdOYW1lOiBmLAogICAgICAgIGlzRGF5VmlldzogImRheSIgPT09IGYsCiAgICAgICAgaXNXZWVrVmlldzogIndlZWsiID09PSBmLAogICAgICAgIGlzTW9udGhWaWV3OiAibW9udGgiID09PSBmLAogICAgICAgIGhvdXJTdGFydDogdGhpcy5vcHRpb25zLmhvdXJTdGFydCwKICAgICAgICBob3VyRW5kOiB0aGlzLm9wdGlvbnMuaG91ckVuZAogICAgICB9OwogICAgfSwgZC5wcm90b3R5cGUuZ2V0U2NoZWR1bGVWaWV3Qm91bmQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IHRoaXMuX2dldFNjaGVkdWxlVmlld0JvdW5kWChlLCB0KSwKICAgICAgICAgIG8gPSB0aGlzLl9nZXRTY2hlZHVsZVZpZXdCb3VuZFkoZSwgdCksCiAgICAgICAgICBpID0gZS5tb2RlbCwKICAgICAgICAgIGEgPSBsLnBpY2soaSwgImlzUmVhZE9ubHkiKSB8fCAhMSwKICAgICAgICAgIHIgPSBpLmlzRm9jdXNlZCA/ICIjZmZmZmZmIiA6IGkuYm9yZGVyQ29sb3I7CgogICAgICByZXR1cm4gciA9PT0gaS5iZ0NvbG9yICYmIChyID0gbnVsbCksIGwuZXh0ZW5kKHsKICAgICAgICBpc1JlYWRPbmx5OiBhLAogICAgICAgIHRyYXZlbEJvcmRlckNvbG9yOiByCiAgICAgIH0sIG4sIG8pOwogICAgfSwgZC5wcm90b3R5cGUuX2dldEJhc2VWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbywKICAgICAgICAgIGEsCiAgICAgICAgICByID0gdGhpcywKICAgICAgICAgIHMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICB1ID0gcy5ob3VyU3RhcnQsCiAgICAgICAgICBkID0gcy5ob3VyRW5kLAogICAgICAgICAgaCA9IHMuaXNSZWFkT25seTsKICAgICAgbiA9IG4gfHwgdGhpcy5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsIChvID0gdGhpcy5fcGFyc2VEYXRlR3JvdXAoZSkpLnNldEhvdXJzKHUpLCBhID0gaS5taWxsaXNlY29uZHNGcm9tKCJob3VyIiwgZCAtIHUpLCBjKHQsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsIGksIHMsIHU7CgogICAgICAgIGZvciAodCA9IE1hdGgubWF4LmFwcGx5KG51bGwsIGwubWFwKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gZS5sZW5ndGg7CiAgICAgICAgfSkpLCBpID0gMTAwIC8gdCwgcyA9IFtdLCB1ID0gMDsgdSA8IHQ7IHUgKz0gMSkgewogICAgICAgICAgc1t1XSA9IGkgKiB1OwogICAgICAgIH0KCiAgICAgICAgYyhlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgYyhlLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgZSAmJiAoYyA9IHIuZ2V0U2NoZWR1bGVWaWV3Qm91bmQoZSwgewogICAgICAgICAgICAgIHRvZGF5U3RhcnQ6IG8sCiAgICAgICAgICAgICAgYmFzZU1TOiBhLAogICAgICAgICAgICAgIGJhc2VMZWZ0OiBzLAogICAgICAgICAgICAgIGJhc2VXaWR0aDogaSwKICAgICAgICAgICAgICBiYXNlSGVpZ2h0OiBuLAogICAgICAgICAgICAgIGNvbHVtbkluZGV4OiB0LAogICAgICAgICAgICAgIGlzUmVhZE9ubHk6IGgKICAgICAgICAgICAgfSksIGwuZXh0ZW5kKGUsIGMpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sIGQucHJvdG90eXBlLmdldERhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9wYXJzZURhdGVHcm91cCh0aGlzLm9wdGlvbnMueW1kKTsKICAgIH0sIGQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIHRoaXMuX2dldEJhc2VWaWV3TW9kZWwoZSwgdCwgbiksIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMudGltZVRtcGwoewogICAgICAgIG1hdHJpY2VzOiB0LAogICAgICAgIHN0eWxlczogdGhpcy5fZ2V0U3R5bGVzKHRoaXMudGhlbWUpLAogICAgICAgIGlzUmVhZE9ubHk6IHRoaXMub3B0aW9ucy5pc1JlYWRPbmx5LAogICAgICAgIGNhbGVuZGFyVmlld05hbWU6IHRoaXMub3B0aW9ucy5jYWxlbmRhclZpZXdOYW1lCiAgICAgIH0pOwogICAgfSwgZC5wcm90b3R5cGUuX2dldFN0eWxlcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0ge30sCiAgICAgICAgICBuID0gdGhpcy5vcHRpb25zOwogICAgICByZXR1cm4gZSAmJiAodC5ib3JkZXJSaWdodCA9IGUud2Vlay50aW1lZ3JpZC5ib3JkZXJSaWdodCB8fCBlLmNvbW1vbi5ib3JkZXIsIHQubWFyZ2luUmlnaHQgPSBlLndlZWsudGltZWdyaWQucGFkZGluZ1JpZ2h0LCB0LmJvcmRlclJhZGl1cyA9IGUud2Vlay50aW1lZ3JpZFNjaGVkdWxlLmJvcmRlclJhZGl1cywgdC5wYWRkaW5nTGVmdCA9IGUud2Vlay50aW1lZ3JpZFNjaGVkdWxlLnBhZGRpbmdMZWZ0LCB0LmJhY2tncm91bmRDb2xvciA9IG4uaXNUb2RheSA/IGUud2Vlay50b2RheS5iYWNrZ3JvdW5kQ29sb3IgOiAiaW5oZXJpdCIpLCB0OwogICAgfSwgZC5wcm90b3R5cGUuYXBwbHlUaGVtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLmNvbnRhaW5lci5zdHlsZSwKICAgICAgICAgIHQgPSB0aGlzLl9nZXRTdHlsZXModGhpcy50aGVtZSk7CgogICAgICBlLmJvcmRlclJpZ2h0ID0gdC5ib3JkZXJSaWdodCwgZS5iYWNrZ3JvdW5kQ29sb3IgPSB0LmJhY2tncm91bmRDb2xvcjsKICAgIH0sIGUuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gInBhZGRpbmctdG9wOjUwcHgiOwogICAgICB9LAogICAgICAzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaTsKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IChlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9KShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4NCwKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgzLAogICAgICAgICAgICAgIGNvbHVtbjogMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg2LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MiwKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDY6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzUGVuZGluZyIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNTUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDEzMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciXG4gICAgICAgIGRhdGEtaWQ9IicgKyB1KChoKG4sICJzdGFtcCIpIHx8IHQgJiYgaCh0LCAic3RhbXAiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic3RhbXAiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDE3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAzMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyIgc3R5bGU9IicgKyB1KChoKG4sICJ0aW1lLXNjaGVkdWxlQmxvY2siKSB8fCB0ICYmIGgodCwgInRpbWUtc2NoZWR1bGVCbG9jayIpIHx8IHMpLmNhbGwociwgdCwgbnVsbCAhPSB0ID8gaCh0LCAiaXNEYXlWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidGltZS1zY2hlZHVsZUJsb2NrIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSAoaChuLCAiZmkiKSB8fCB0ICYmIGgodCwgImZpIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJsZWZ0IikgOiB0LCAiIT09IiwgMCwgewogICAgICAgICAgbmFtZTogImZpIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg5LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc0RheVZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDEzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE3LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICAgICAgICAgIHdpZHRoOiAxMDJweCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgIGRpc3BsYXk6aW5saW5lLWZsZXg7XG4gICAgICAgICAgICAgICAgei1pbmRleDo5OTtcbiAgICAgICAgICAgICI+XG4gICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA1cHg7aGVpZ2h0OiA1cHg7YmFja2dyb3VuZDogI0ZGM0YzRiAwJSAwJSBuby1yZXBlYXQgcGFkZGluZy1ib3g7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6NTAlO3Bvc2l0aW9uOnJlbGF0aXZlO3JpZ2h0OiA1cHg7dG9wOiA1cHgiPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBkYXRhLXNjaGVkdWxlLWlkPSInICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpZCIpIDogaSwgdCkpICsgJyIgZGF0YS1jYWxlbmRhci1pZD0iJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiY2FsZW5kYXJJZCIpIDogaSwgdCkpICsgJyJcbiAgICAgICAgICAgIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUgIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTYsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICAgICAgc3R5bGU9IlxuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDtcbiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwcHggMXB4IDVweCAjMDAwMDAwMjk7XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMjAsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzV2Vla1ZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzksCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAgICAgICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImN1c3RvbVN0eWxlIikgOiBpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQxLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGl0bGUtYXZhdGFyIiBzdHlsZT0iXG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNXZWVrVmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+JyArIHUoKGgobiwgInRpdGxlQXZhdGFyLXRtcGwiKSB8fCB0ICYmIGgodCwgInRpdGxlQXZhdGFyLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJ0aXRsZSIpIDogaSwgewogICAgICAgICAgbmFtZTogInRpdGxlQXZhdGFyLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAiPC9kaXY+XG4iICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaGFzR29pbmdEdXJhdGlvbiIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAidGltZS1zY2hlZHVsZS1jb250ZW50ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1zY2hlZHVsZS1jb250ZW50LXRpbWUiIHN0eWxlPSJcbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc0RheVZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMzEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDMzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYxLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJoYXNDb21pbmdEdXJhdGlvbiIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzNiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDk2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+XG4gICAgICAgICAgICAgICAgJyArIChudWxsICE9IChpID0gKGgobiwgInRpbWUtdG1wbCIpIHx8IHQgJiYgaCh0LCAidGltZS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYzLAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJmb250OiAxMHB4ICdTZWdvZSBVSSBTZW1pYm9sZCc7IGxldHRlci1zcGFjaW5nOiAwcHg7IGNvbG9yOlxuICAgICAgICAgICAgICAgICAgICAjNUI1QjVCICFpbXBvcnRhbnQ7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlXCI+IiArIHUoKGgobiwgImRpc3BsYXlQaG9uZS10bXBsIikgfHwgdCAmJiBoKHQsICJkaXNwbGF5UGhvbmUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJkaXNwbGF5UGhvbmUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NSwKICAgICAgICAgICAgICBjb2x1bW46IDY1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY1LAogICAgICAgICAgICAgIGNvbHVtbjogOTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICI8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJoYXNDb21pbmdEdXJhdGlvbiIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgzOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OCwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgPC9kaXY+XG4gICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgInVubGVzcyIpLmNhbGwociwgKGgobiwgIm9yIikgfHwgdCAmJiBoKHQsICJvciIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiY3JvcHBlZEVuZCIpIDogdCwgKGgobiwgIm9yIikgfHwgdCAmJiBoKHQsICJvciIpIHx8IHMpLmNhbGwociwgKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAiaXNSZWFkT25seSIpLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNSZWFkT25seSIpIDogaSwgewogICAgICAgICAgbmFtZTogIm9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogMzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODAsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIHsKICAgICAgICAgIG5hbWU6ICJvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MCwKICAgICAgICAgICAgICBjb2x1bW46IDE4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogNzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0MSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogODAsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgwLAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDc5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA5MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2stcGVuZGluZyI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJwYWRkaW5nTGVmdCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMTE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGhlaWdodDogMTA1cHggIWltcG9ydGFudDtcbiI7CiAgICAgIH0sCiAgICAgIDEzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gYShuLCAiaWYiKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJpc1dlZWtWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDE0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMTQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGhlaWdodDogNDJweCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICI7CiAgICAgIH0sCiAgICAgIDE2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiA3MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgInRpbWUtc2NoZWR1bGUtZm9jdXNlZCAiOwogICAgICB9LAogICAgICAxODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJvcmRlci1jb2xvcjoiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzI4Mzg3NyAwJSAwJSBuby1yZXBlYXQgcGFkZGluZy1ib3g7XG4iOwogICAgICB9LAogICAgICAyMDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiMyODM4Nzc7IGJvcmRlcjogMXB4IHNvbGlkICNGRjNGM0Y7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNGRkZGRkYgMCUgMCUgbm8tcmVwZWF0IHBhZGRpbmctYm94O1xuIjsKICAgICAgfSwKICAgICAgMjI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXhcbiI7CiAgICAgIH0sCiAgICAgIDI0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogNnB4O1xuICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogNnB4O1xuICAgICAgICAgICAgICAgICI7CiAgICAgIH0sCiAgICAgIDI2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAidGltZS1zY2hlZHVsZS1jb250ZW50ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLXNjaGVkdWxlLWNvbnRlbnQtdHJhdmVsLXRpbWUiIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImdvaW5nRHVyYXRpb25IZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiZ29pbmdEdXJhdGlvbkhlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJnb2luZ0R1cmF0aW9uSGVpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMTI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMTQ3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInB4O1xuIiArIChudWxsICE9IChpID0gdShuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJtb2RlbCIpIDogdCkgPyB1KGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjcsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDI5LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0OCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUyLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBkYXNoZWQgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAidHJhdmVsQm9yZGVyQ29sb3IiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAidHJhdmVsQm9yZGVyQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidHJhdmVsQm9yZGVyQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJnb2luZ0R1cmF0aW9uLXRtcGwiKSB8fCB0ICYmIHUodCwgImdvaW5nRHVyYXRpb24tdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJnb2luZ0R1cmF0aW9uLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDk2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMjc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGJvcmRlci1jb2xvcjoiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDI5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICBib3JkZXItY29sb3I6IiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAzMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDVweDtcbiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjtcbiI7CiAgICAgIH0sCiAgICAgIDMzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gYShuLCAiaWYiKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IHQgPyBhKHQsICJpc1dlZWtWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDM0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYxLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMzQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGhlaWdodDogNDJweDtcbiAgICAgICAgICAgICAgICAiOwogICAgICB9LAogICAgICAzNjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gImJvcmRlci1ib3R0b206IDFweCBkYXNoZWQgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJ0cmF2ZWxCb3JkZXJDb2xvciIpIHx8IChudWxsICE9IHQgPyBhKHQsICJ0cmF2ZWxCb3JkZXJDb2xvciIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJ0cmF2ZWxCb3JkZXJDb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDY3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogODgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAiOyI7CiAgICAgIH0sCiAgICAgIDM4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAidGltZS1zY2hlZHVsZS1jb250ZW50ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLXNjaGVkdWxlLWNvbnRlbnQtdHJhdmVsLXRpbWUiIHN0eWxlPSJcbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJpc0RheVZpZXciKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMzksIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDMzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDczLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQpID8gdShpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDQxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg0MywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NiwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzsiPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJjb21pbmdEdXJhdGlvbi10bXBsIikgfHwgdCAmJiB1KHQsICJjb21pbmdEdXJhdGlvbi10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImNvbWluZ0R1cmF0aW9uLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzYsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NiwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAzOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDVweDtcbiI7CiAgICAgIH0sCiAgICAgIDQxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0sCiAgICAgIDQzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAiOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICByID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2std3JhcCIgc3R5bGU9Im1hcmdpbi1yaWdodDogJyArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcih0LCAic3R5bGVzIikgOiB0KSA/IHIoaSwgIm1hcmdpblJpZ2h0IikgOiBpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gcihuLCAiaWYiKS5jYWxsKGEsIG51bGwgIT0gdCA/IHIodCwgImlzRGF5VmlldyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIj5cbicgKyAobnVsbCAhPSAoaSA9IHIobiwgImVhY2giKS5jYWxsKGEsIG51bGwgIT0gdCA/IHIodCwgIm1hdHJpY2VzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj4iOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGwgPSBuKDApLAogICAgICAgICAgbyA9IG4oNiksCiAgICAgICAgICBpID0gbigxKSwKICAgICAgICAgIGEgPSBuKDMxKTsKCiAgICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICAgIHRoaXMuY29udGFpbmVyID0gZSwgdGhpcy5fZGlyZWN0aW9uID0gci5ESVJFQ1RJT04uSU5TSURFLCB0aGlzLl9vZmZzZXQgPSAwLCB0aGlzLl9pbnRlcnZhbElEID0gMCwgby5vbihlLCB7CiAgICAgICAgICBtb3VzZWRvd246IHRoaXMuX29uTW91c2VEb3duCiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHIuRElSRUNUSU9OID0gewogICAgICAgIElOU0lERTogMCwKICAgICAgICBUT1A6IDEsCiAgICAgICAgUklHSFQ6IDIsCiAgICAgICAgQk9UVE9NOiAzLAogICAgICAgIExFRlQ6IDQKICAgICAgfSwgci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBvLm9mZih0aGlzLmNvbnRhaW5lciwgewogICAgICAgICAgbW91c2Vkb3duOiB0aGlzLl9vbk1vdXNlRG93biwKICAgICAgICAgIG1vdXNlbW92ZTogdGhpcy5fb25Nb3VzZU1vdmUsCiAgICAgICAgICBtb3VzZXVwOiB0aGlzLl9vbk1vdXNlVXAKICAgICAgICB9LCB0aGlzKSwgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWxJRCksIHRoaXMuX2ludGVydmFsSUQgPSB0aGlzLl9kaXJlY3Rpb24gPSB0aGlzLmNvbnRhaW5lciA9IG51bGw7CiAgICAgIH0sIHIucHJvdG90eXBlLl9nZXRFZGdlUG9zaXRpb25zID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdG9wOiBlLnRvcCwKICAgICAgICAgIHJpZ2h0OiBlLmxlZnQgKyBlLndpZHRoLAogICAgICAgICAgYm90dG9tOiBlLmJvdHRvbSwKICAgICAgICAgIGxlZnQ6IGUubGVmdAogICAgICAgIH07CiAgICAgIH0sIHIucHJvdG90eXBlLmdldFJlYWxTaXplID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgbCA9IGkuZ2V0Q29tcHV0ZWRTdHlsZShlKTsKICAgICAgICByZXR1cm4gdCA9IHBhcnNlRmxvYXQobC5nZXRQcm9wZXJ0eVZhbHVlKCJib3JkZXItdG9wLXdpZHRoIikpICsgcGFyc2VGbG9hdChsLmdldFByb3BlcnR5VmFsdWUoImJvcmRlci1ib3R0b20td2lkdGgiKSksIG4gPSBwYXJzZUZsb2F0KGwuZ2V0UHJvcGVydHlWYWx1ZSgicGFkZGluZy10b3AiKSkgKyBwYXJzZUZsb2F0KGwuZ2V0UHJvcGVydHlWYWx1ZSgicGFkZGluZy1ib3R0b20iKSksIFtlLmNsaWVudFdpZHRoICsgdCArIG4sIGUuY2xpZW50SGVpZ2h0ICsgdCArIG5dOwogICAgICB9LCByLnByb3RvdHlwZS5oYXNTY3JvbGxiYXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5nZXRSZWFsU2l6ZShlKTsKICAgICAgICByZXR1cm4gW2Uub2Zmc2V0V2lkdGggPiBNYXRoLmNlaWwodFswXSksIGUub2Zmc2V0SGVpZ2h0ID4gTWF0aC5jZWlsKHRbMV0pXTsKICAgICAgfSwgci5wcm90b3R5cGUuaXNPblNjcm9sbGJhciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgdmFyIG4gPSB0aGlzLmdldFJlYWxTaXplKGUpLAogICAgICAgICAgICBsID0gby5nZXRNb3VzZVBvc2l0aW9uKHQsIGUpOwogICAgICAgIHJldHVybiBuWzBdIC0gMiA8IGxbMF0gfHwgblsxXSAtIDIgPCBsWzFdOwogICAgICB9LCByLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgIDAgPT09IG8uZ2V0TW91c2VCdXR0b24oZSkgJiYgKGwuYnJvd3Nlci5tc2llICYmIHRoaXMuaXNPblNjcm9sbGJhcih0aGlzLmNvbnRhaW5lciwgZSkgfHwgKHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsSUQpLCB0aGlzLl9pbnRlcnZhbElEID0gd2luZG93LnNldEludGVydmFsKGwuYmluZCh0aGlzLl9vblRpY2ssIHRoaXMpLCAzMCksIG8ub24odCwgewogICAgICAgICAgbW91c2Vtb3ZlOiB0aGlzLl9vbk1vdXNlTW92ZSwKICAgICAgICAgIG1vdXNldXA6IHRoaXMuX29uTW91c2VVcAogICAgICAgIH0sIHRoaXMpKSk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbk1vdXNlTW92ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLl9nZXRFZGdlUG9zaXRpb25zKHRoaXMuY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSwKICAgICAgICAgICAgbiA9IGEubihvLmdldE1vdXNlUG9zaXRpb24oZSkpOwoKICAgICAgICBpZiAobi55ID49IHQudG9wICYmIG4ueSA8PSB0LmJvdHRvbSAmJiBuLnggPj0gdC5sZWZ0ICYmIG4ueCA8PSB0LnJpZ2h0KSB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5JTlNJREU7ZWxzZSB7CiAgICAgICAgICBpZiAobi55IDwgdC50b3ApIHJldHVybiB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5UT1AsIHZvaWQgKHRoaXMuX29mZnNldCA9IHQudG9wIC0gbi55KTsKICAgICAgICAgIGlmIChuLnkgPiB0LmJvdHRvbSkgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbiA9IHIuRElSRUNUSU9OLkJPVFRPTSwgdm9pZCAodGhpcy5fb2Zmc2V0ID0gbi55IC0gdC5ib3R0b20pOwogICAgICAgICAgaWYgKG4ueCA8IHQubGVmdCkgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbiA9IHIuRElSRUNUSU9OLkxFRlQsIHZvaWQgKHRoaXMuX29mZnNldCA9IHQubGVmdCAtIG4ueCk7CiAgICAgICAgICB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5SSUdIVCwgdGhpcy5fb2Zmc2V0ID0gbi54IC0gdC5yaWdodDsKICAgICAgICB9CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWxJRCksIHRoaXMuX2ludGVydmFsSUQgPSAwLCB0aGlzLl9kaXJlY3Rpb24gPSByLkRJUkVDVElPTi5JTlNJREUsIHRoaXMuX29mZnNldCA9IDAsIG8ub2ZmKHQsIHsKICAgICAgICAgIG1vdXNlbW92ZTogdGhpcy5fb25Nb3VzZU1vdmUsCiAgICAgICAgICBtb3VzZXVwOiB0aGlzLl9vbk1vdXNlVXAKICAgICAgICB9LCB0aGlzKTsKICAgICAgfSwgci5wcm90b3R5cGUuX29uVGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgdCwKICAgICAgICAgICAgbiA9IHRoaXMuX2RpcmVjdGlvbjsKICAgICAgICBpZiAobikgc3dpdGNoIChlID0gdGhpcy5jb250YWluZXIsIHQgPSBNYXRoLm1pbih0aGlzLl9vZmZzZXQsIDE1KSwgbikgewogICAgICAgICAgY2FzZSByLkRJUkVDVElPTi5UT1A6CiAgICAgICAgICAgIGUuc2Nyb2xsVG9wIC09IHQ7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2Ugci5ESVJFQ1RJT04uUklHSFQ6CiAgICAgICAgICAgIGUuc2Nyb2xsTGVmdCArPSB0OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIHIuRElSRUNUSU9OLkJPVFRPTToKICAgICAgICAgICAgZS5zY3JvbGxUb3AgKz0gdDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgZS5zY3JvbGxMZWZ0IC09IHQ7CiAgICAgICAgfQogICAgICB9LCBlLmV4cG9ydHMgPSByOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIGMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXY+XG4gICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDtmb250LXNpemU6ICcgKyByKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAibGVmdEZvbnRTaXplIikgOiBpLCB0KSkgKyAnIj5cbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImVhY2giKS5jYWxsKHMsIG51bGwgIT0gdCA/IHUodCwgInRpbWV6b25lcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iJyArIHIoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogYykgPyBhLmNhbGwocywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXJpZ2h0Ij5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHIoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogYykgPyBhLmNhbGwocywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWgtZ3JpZCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7Ij5cbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImVhY2giKS5jYWxsKHMsIG51bGwgIT0gdCA/IHUodCwgImhvdXJzTGFiZWxzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMywKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gYShuLCAiZWFjaCIpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgInRpbWVTbG90cyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBzdHlsZT0iZGlzcGxheTpibG9jazsgd2lkdGg6MTAlIj5cbiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDoyMHB4Ij5cbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJoZWlnaHQ6IDEwMCU7IGNvbG9yOiAjOTU5NTk1OyBmb250LXdlaWdodDogJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiZm9udFdlaWdodCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJmb250V2VpZ2h0IikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImZvbnRXZWlnaHQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICc7IGZvbnQ6IDEwcHg7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDo1cHg7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OmF1dG87bWFyZ2luLXJpZ2h0OmF1dG87XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI0RGREZERjt0ZXh0LWFsaWduOmxlZnQiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAidGltZWdyaWREaXNwbGF5UHJpbWFyeVRpbWUtdG1wbCIpIHx8IHQgJiYgdSh0LCAidGltZWdyaWREaXNwbGF5UHJpbWFyeVRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogInRpbWVncmlkRGlzcGxheVByaW1hcnlUaW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDk1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBzdHlsZT0iYm9yZGVyLXRvcDogMXB4IHNvbGlkICNFQUVBRUE7Ym9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjREZERkRGO2N1cnNvcjpwb2ludGVyIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogNDIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtc2NoZWR1bGVzLWNvbnRhaW5lciI+PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4nOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ncmlkbGluZSIgc3R5bGU9IndpZHRoOjEwJTtcbiAgICAgICAgICAgIGhlaWdodDo3NXZoO1xuICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjREZERkRGO1xuICAgICAgICAiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiA0MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ncmlkbGluZS1oYWxmIlxuICAgICAgICAgICAgICAgICAgICBzdHlsZT0iaGVpZ2h0OiAnICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImhhbGZIb3VySGVpZ2h0IiksIHQpKSArICI7IGJvcmRlci1ib3R0b206ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJCb3JkZXJCb3R0b20iKSwgdCkpICsgJzsiPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4nOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWxlZnQiIHN0eWxlPSJ3aWR0aDogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxlZnRXaWR0aCIpIDogaSwgdCkpICsgIjsgZm9udC1zaXplOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAibGVmdEZvbnRTaXplIikgOiBpLCB0KSkgKyAnOyI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJ0aW1lem9uZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg4LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L2Rpdj5cbjxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MCwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDkwLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtcmlnaHQiIHN0eWxlPSJtYXJnaW4tbGVmdDogJyArIHUoZCgoaSA9IChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInN0eWxlcyIpKSAmJiBoKGksICJsZWZ0V2lkdGgiKSwgdCkpICsgJzsiPlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5MSwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDkxLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaC1ncmlkIj5cbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImhvdXJzTGFiZWxzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDkyLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTA0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTA0LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtc2NoZWR1bGVzIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwNSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwNSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLXNjaGVkdWxlcy1jb250YWluZXIiPjwvZGl2PlxuICAgIDwvZGl2PlxuXG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAic2hvd0hvdXJNYXJrZXIiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMjUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwOCwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4iOwogICAgICB9LAogICAgICA4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC10aW1lem9uZSIgZGF0YS10aW1lem9uZS1pbmRleD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImluZGV4IikgfHwgbyAmJiBkKG8sICJpbmRleCIpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiaW5kZXgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA3MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDgwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyJcbiAgICAgICAgc3R5bGU9IicgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJoaWRkZW4iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDQ5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyB3aWR0aDogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIndpZHRoIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIndpZHRoIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIndpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiA5MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBsZWZ0OiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYm9yZGVyLXJpZ2h0OiAiICsgdShlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJsZWZ0Qm9yZGVyUmlnaHQiKSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgImJhY2tncm91bmRDb2xvciIpIHx8IChudWxsICE9IHQgPyBkKHQsICJiYWNrZ3JvdW5kQ29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiYmFja2dyb3VuZENvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMTc5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMTk4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPlxuJyArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImlzUHJpbWFyeSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTcsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU2LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4NiwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiZGlzcGxheTpub25lOyI7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICByID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIChudWxsICE9IChpID0gcihuLCAiZWFjaCIpLmNhbGwoYSwgbnVsbCAhPSB0ID8gcih0LCAidGltZVNsb3RzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSByKG4sICJpZiIpLmNhbGwoYSwgKGkgPSBvICYmIHIobywgInJvb3QiKSkgJiYgcihpLCAic2hvd0hvdXJNYXJrZXIiKSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjMsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcwLAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDEyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU4LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91ciJcbiAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKGUubGFtYmRhKChpID0gKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAic3R5bGVzIikpICYmIHUoaSwgIm9uZUhvdXJIZWlnaHQiKSwgdCkpICsgIjsgY29sb3I6ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImNvbG9yIikgfHwgKG51bGwgIT0gdCA/IHUodCwgImNvbG9yIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogNjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7IGZvbnQtd2VpZ2h0OiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJmb250V2VpZ2h0IikgfHwgKG51bGwgIT0gdCA/IHUodCwgImZvbnRXZWlnaHQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiZm9udFdlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDkwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogMTA0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9IicgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJoaWRkZW4iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjAsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJ0aW1lZ3JpZERpc3BsYXlQcmltYXlUaW1lLXRtcGwiKSB8fCB0ICYmIHUodCwgInRpbWVncmlkRGlzcGxheVByaW1heVRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogInRpbWVncmlkRGlzcGxheVByaW1heVRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogMTAxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICJkaXNwbGF5Om5vbmUiOwogICAgICB9LAogICAgICAxNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjQsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyIlxuICAgICAgICAgICAgc3R5bGU9InRvcDonICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImhvdXJtYXJrZXJUb3AiKSwgdCkpICsgIiU7IG1hcmdpbi10b3A6IGNhbGMoNnB4IC0gIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoYWxmSG91ckhlaWdodCIpLCB0KSkgKyAiKTsgaGVpZ2h0OiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImhhbGZIb3VySGVpZ2h0IiksIHQpKSArICc7Ij5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY2LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjYsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyLXRpbWUiXG4gICAgICAgICAgICAgICAgc3R5bGU9ImNvbG9yOiAnICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImN1cnJlbnRUaW1lQ29sb3IiKSwgdCkpICsgIjsgZm9udC1zaXplOiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImN1cnJlbnRUaW1lRm9udFNpemUiKSwgdCkpICsgIjsgZm9udC13ZWlnaHQ6ICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiY3VycmVudFRpbWVGb250V2VpZ2h0IiksIHQpKSArICciPlxuICAgICAgICAgICAgICAgICcgKyAobnVsbCAhPSAoaSA9IChkKG4sICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiKSB8fCB0ICYmIGQodCwgInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogNTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMTc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHIgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gKG51bGwgIT0gKGkgPSByKG4sICJlYWNoIikuY2FsbChhLCBudWxsICE9IHQgPyByKHQsICJ0aW1lU2xvdHMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzIsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc3LAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IHIobiwgImlmIikuY2FsbChhLCAoaSA9IG8gJiYgcihvLCAicm9vdCIpKSAmJiByKGksICJzaG93SG91ck1hcmtlciIpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIwLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OCwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKTsKICAgICAgfSwKICAgICAgMTg6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDczLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VyIlxuICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogJyArIGMoZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgdShvLCAicm9vdCIpKSAmJiB1KGksICJzdHlsZXMiKSkgJiYgdShpLCAib25lSG91ckhlaWdodCIpLCB0KSkgKyAiOyBjb2xvcjogIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzQsCiAgICAgICAgICAgICAgY29sdW1uOiA2NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NCwKICAgICAgICAgICAgICBjb2x1bW46IDc1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIjsgZm9udC13ZWlnaHQ6ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgImZvbnRXZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiZm9udFdlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJmb250V2VpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc0LAogICAgICAgICAgICAgIGNvbHVtbjogOTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnOyI+XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT0iJyArIChudWxsICE9IChpID0gdShuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImhpZGRlbiIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NSwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+JyArIChudWxsICE9IChpID0gKHUobiwgInRpbWVncmlkRGlzcGxheVRpbWUtdG1wbCIpIHx8IHQgJiYgdSh0LCAidGltZWdyaWREaXNwbGF5VGltZS10bXBsIikgfHwgcykuY2FsbChyLCB0LCB7CiAgICAgICAgICBuYW1lOiAidGltZWdyaWREaXNwbGF5VGltZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDc1LAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzUsCiAgICAgICAgICAgICAgY29sdW1uOiA5NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMjA6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc5LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlciJcbiAgICAgICAgICAgIHN0eWxlPSJ0b3A6JyArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJob3VybWFya2VyVG9wIiksIHQpKSArICIlOyBtYXJnaW4tdG9wOiBjYWxjKDZweCAtICIgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJIZWlnaHQiKSwgdCkpICsgIik7IGhlaWdodDogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoYWxmSG91ckhlaWdodCIpLCB0KSkgKyAnOyI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgxLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtaG91cm1hcmtlci10aW1lIlxuICAgICAgICAgICAgICAgIHN0eWxlPSJjb2xvcjogJyArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJjdXJyZW50VGltZUNvbG9yIiksIHQpKSArICI7IGZvbnQtc2l6ZTogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJjdXJyZW50VGltZUZvbnRTaXplIiksIHQpKSArICc7Ij5cbiAgICAgICAgICAgICAgICAnICsgKG51bGwgIT0gKGkgPSAoZChuLCAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIikgfHwgdCAmJiBkKHQsICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogODMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MywKICAgICAgICAgICAgICBjb2x1bW46IDUxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDIyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDkzLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOTMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ncmlkbGluZSIgc3R5bGU9ImhlaWdodDogJyArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJvbmVIb3VySGVpZ2h0IiksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKHIsIG8gJiYgZChvLCAibGFzdCIpLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5NiwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDk4LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOTgsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ncmlkbGluZS1oYWxmIlxuICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKHUoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiaGFsZkhvdXJIZWlnaHQiKSwgdCkpICsgIjsgYm9yZGVyLWJvdHRvbTogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoYWxmSG91ckJvcmRlckJvdHRvbSIpLCB0KSkgKyAnOyI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4nOwogICAgICB9LAogICAgICAyMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgIGJvcmRlci1ib3R0b206ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAiYm9yZGVyQm90dG9tIiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDksCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDksCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyIiBzdHlsZT0idG9wOicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJob3VybWFya2VyVG9wIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImhvdXJtYXJrZXJUb3AiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiaG91cm1hcmtlclRvcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDksCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMDksCiAgICAgICAgICAgICAgY29sdW1uOiA3OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICclIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExMCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExMCwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWhvdXJtYXJrZXItbGluZS1sZWZ0IlxuICAgICAgICAgICAgc3R5bGU9IndpZHRoOicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0b2RheW1hcmtlckxlZnQiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAidG9kYXltYXJrZXJMZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRvZGF5bWFya2VyTGVmdCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTEsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBib3JkZXItdG9wOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiY3VycmVudFRpbWVMZWZ0Qm9yZGVyVG9wIikgOiBpLCB0KSkgKyAnOyI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC10b2RheW1hcmtlciJcbiAgICAgICAgICAgIHN0eWxlPSJsZWZ0OicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0b2RheW1hcmtlckxlZnQiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAidG9kYXltYXJrZXJMZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRvZGF5bWFya2VyTGVmdCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiY3VycmVudFRpbWVCdWxsZXRCYWNrZ3JvdW5kQ29sb3IiKSA6IGksIHQpKSArICc7ICI+dG9kYXlcbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC1ob3VybWFya2VyLWxpbmUtdG9kYXkiXG4gICAgICAgICAgICBzdHlsZT0ibGVmdDonICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidG9kYXltYXJrZXJMZWZ0IikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvZGF5bWFya2VyTGVmdCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0b2RheW1hcmtlckxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTE2LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTE2LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgd2lkdGg6ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0b2RheW1hcmtlcldpZHRoIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvZGF5bWFya2VyV2lkdGgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidG9kYXltYXJrZXJXaWR0aCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA3MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBib3JkZXItdG9wOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiY3VycmVudFRpbWVUb2RheUJvcmRlclRvcCIpIDogaSwgdCkpICsgJzsiPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExOCwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExOCwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWVncmlkLWhvdXJtYXJrZXItbGluZS1yaWdodCJcbiAgICAgICAgICAgIHN0eWxlPSJsZWZ0OicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJ0b2RheW1hcmtlclJpZ2h0IikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRvZGF5bWFya2VyUmlnaHQiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidG9kYXltYXJrZXJSaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTksCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMTksCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBib3JkZXItdG9wOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAiY3VycmVudFRpbWVSaWdodEJvcmRlclRvcCIpIDogaSwgdCkpICsgJzsiPjwvZGl2PlxuICAgIDwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbnVsbCAhPSAoaSA9IGEobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAiaXNEYXlWaWV3IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDcsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyMywKICAgICAgICAgICAgICBjb2x1bW46IDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdGltZXpvbmUtbGFiZWwtY29udGFpbmVyIiBzdHlsZT0iJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImhpZGRlbiIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDEwMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJiYWNrZ3JvdW5kLWNvbG9yOiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiYmFja2dyb3VuZENvbG9yIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImJhY2tncm91bmRDb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJiYWNrZ3JvdW5kQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDEyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTM5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIjsgaGVpZ2h0OiAxMDAlOyB3aWR0aDogIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIndpZHRoIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIndpZHRoIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIndpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE3MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBsZWZ0OiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE4MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTg4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7IGZvbnQtc2l6ZTogIiArIHUoZCgoaSA9IChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInN0eWxlcyIpKSAmJiBoKGksICJsZWZ0Rm9udFNpemUiKSwgdCkpICsgIjsgYm9yZGVyLXJpZ2h0OiAiICsgdShkKChpID0gKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic3R5bGVzIikpICYmIGgoaSwgImxlZnRCb3JkZXJSaWdodCIpLCB0KSkgKyAnOyI+XG4gICAgPGRpdiB0aXRsZT0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInRvb2x0aXAiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAidG9vbHRpcCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0b29sdGlwIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNTAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZWdyaWQtdGltZXpvbmUtbGFiZWwtY2VsbCIgZGF0YS10aW1lem9uZT0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImRpc3BsYXlMYWJlbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJkaXNwbGF5TGFiZWwiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiZGlzcGxheUxhYmVsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA5NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyIgc3R5bGU9ImhlaWdodDogMTAwJTsgd2lkdGg6IDEwMCU7Ij5cbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCAoaChuLCAiYW5kIikgfHwgdCAmJiBoKHQsICJhbmQiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzUHJpbWFyeSIpIDogdCwgKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic2hvd1RpbWV6b25lQ29sbGFwc2VCdXR0b24iKSwgewogICAgICAgICAgbmFtZTogImFuZCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMTQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC10aW1lem9uZS1sYWJlbCI+JyArIChudWxsICE9IChpID0gKGgobiwgInRpbWV6b25lRGlzcGxheUxhYmVsLXRtcGwiKSB8fCB0ICYmIGgodCwgInRpbWV6b25lRGlzcGxheUxhYmVsLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgInRpbWV6b25lT2Zmc2V0IikgOiB0LCBudWxsICE9IHQgPyBoKHQsICJkaXNwbGF5TGFiZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lem9uZURpc3BsYXlMYWJlbC10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogNTkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiZGlzcGxheTpub25lOyI7CiAgICAgIH0sCiAgICAgIDQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lZ3JpZC10aW1lem9uZS1jbG9zZS1idG4iIHN0eWxlPSJib3JkZXI6IDFweCBzb2xpZCAjZGRkOyB0b3A6MnB4OyBib3R0b206IDJweDsgd2lkdGg6IDEwcHg7IGJvcmRlci1sZWZ0OiBub25lOyI+XG4gICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiAjNzc3OyBoZWlnaHQ6IGNhbGMoJyArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJkaXNwbGF5VGltZXpvbmVMYWJlbEhlaWdodCIpLCB0KSkgKyAiIC0gNnB4KTsgbGluZS1oZWlnaHQ6IGNhbGMoIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJkaXNwbGF5VGltZXpvbmVMYWJlbEhlaWdodCIpLCB0KSkgKyAnIC0gNnB4KTsiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJ0aW1lem9uZXNDb2xsYXBzZWQiKSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE1NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDk4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgImljLWFycm93LXJpZ2h0IjsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDEzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJpYy1hcnJvdy1sZWZ0IjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gcihuLCAiZWFjaCIpLmNhbGwoYSwgKHIobiwgInJldmVyc2UiKSB8fCB0ICYmIHIodCwgInJldmVyc2UiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwoYSwgbnVsbCAhPSB0ID8gcih0LCAidGltZXpvbmVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAicmV2ZXJzZSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAobnVsbCAhPSAoaSA9IChhKG4sICJ0aW1lZ3JpZEN1cnJlbnRUaW1lLXRtcGwiKSB8fCB0ICYmIGEodCwgInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogInRpbWVncmlkQ3VycmVudFRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4iOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgIGUuZXhwb3J0cyA9IHQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDE1MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTY0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgImhpZGUiOwogICAgICB9LAogICAgICAzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICByID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBzID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9IicgKyBjKF90eXBlb2YoaSA9IG51bGwgIT0gKGkgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiByKSA9PT0gcyA/IGkuY2FsbChhLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyBjKF90eXBlb2YoaSA9IG51bGwgIT0gKGkgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiByKSA9PT0gcyA/IGkuY2FsbChhLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDY0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnZHJvcGRvd24tbWVudS1pdGVtIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAiaWQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiaWQiKSA6IHQpKSA/IGkgOiByKSA9PT0gcyA/IGkuY2FsbChhLCB7CiAgICAgICAgICBuYW1lOiAiaWQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDUxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgImljb24gIiArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IHIpID09PSBzID8gaS5jYWxsKGEsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA3MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICdjYWxlbmRhci1kb3QiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAnICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAiYmdDb2xvciIpIHx8IChudWxsICE9IHQgPyB1KHQsICJiZ0NvbG9yIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogImJnQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAnIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoX3R5cGVvZihpID0gbnVsbCAhPSAoaSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IHIpID09PSBzID8gaS5jYWxsKGEsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA1MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICdjb250ZW50Ij4nICsgYyhfdHlwZW9mKGkgPSBudWxsICE9IChpID0gdShuLCAibmFtZSIpIHx8IChudWxsICE9IHQgPyB1KHQsICJuYW1lIikgOiB0KSkgPyBpIDogcikgPT09IHMgPyBpLmNhbGwoYSwgewogICAgICAgICAgbmFtZTogIm5hbWUiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDY4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPC9saT5cbiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDEzNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE0OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJwdWJsaWMiOwogICAgICB9LAogICAgICA3OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICByZXR1cm4gIiBjaGVja2VkIjsKICAgICAgfSwKICAgICAgOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgInN0YXRlIikgfHwgKG51bGwgIT0gdCA/IGEodCwgInN0YXRlIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogInN0YXRlIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogOTkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSk7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gcihuLCAicG9wdXBTdGF0ZUJ1c3ktdG1wbCIpIHx8IChudWxsICE9IHQgPyByKHQsICJwb3B1cFN0YXRlQnVzeS10bXBsIikgOiB0KSkgPyBhIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGEuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogInBvcHVwU3RhdGVCdXN5LXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDEzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gcihuLCAicG9wdXBVcGRhdGUtdG1wbCIpIHx8IChudWxsICE9IHQgPyByKHQsICJwb3B1cFVwZGF0ZS10bXBsIikgOiB0KSkgPyBhIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGEuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogInBvcHVwVXBkYXRlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAxNjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAxODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDE1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gcihuLCAicG9wdXBTYXZlLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gcih0LCAicG9wdXBTYXZlLXRtcGwiKSA6IHQpKSA/IGEgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gYS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBTYXZlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAxOTMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAyMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwIj5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1jb250YWluZXIiPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1zZWN0aW9uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImRyb3Bkb3duICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImNsb3NlICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogOTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDEwNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJzZWN0aW9uLWNhbGVuZGFyIiArIChudWxsICE9IChpID0gaChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAiY2FsZW5kYXJzIikgOiB0KSA/IGgoaSwgImxlbmd0aCIpIDogaSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDEyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMTc5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJidXR0b24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiZHJvcGRvd24tYnV0dG9uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLXNlY3Rpb24taXRlbSI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY2FsZW5kYXItZG90IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2VsZWN0ZWRDYWwiKSA6IHQpID8gaChpLCAiYmdDb2xvciIpIDogaSwgdCkpICsgJyI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxzcGFuIGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS1jYWxlbmRhciIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogNjYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDgwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNlbGVjdGVkQ2FsIikgOiB0KSA/IGgoaSwgIm5hbWUiKSA6IGksIHQpKSArICc8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnZHJvcGRvd24tYXJyb3ciPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPHVsIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkcm9wZG93bi1tZW51IiBzdHlsZT0iei1pbmRleDogJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInpJbmRleCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ6SW5kZXgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiekluZGV4IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA2OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj5cbicgKyAobnVsbCAhPSAoaSA9IGgobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImNhbGVuZGFycyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICA8L3VsPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zZWN0aW9uIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi10aXRsZSI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtdGl0bGUiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtdGl0bGUiIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiA2NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDc4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiIHBsYWNlaG9sZGVyPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAidGl0bGVQbGFjZWhvbGRlci10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRpdGxlUGxhY2Vob2xkZXItdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ0aXRsZVBsYWNlaG9sZGVyLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIiB2YWx1ZT0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInRpdGxlIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInRpdGxlIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInRpdGxlIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTM0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIxLAogICAgICAgICAgICAgIGNvbHVtbjogMTQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxidXR0b24gaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtcHJpdmF0ZSIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogNzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiYnV0dG9uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDg0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogOTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAic2VjdGlvbi1wcml2YXRlIiArIChudWxsICE9IChpID0gaChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc1ByaXZhdGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTEzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTY2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtcHJpdmF0ZSI+PC9zcGFuPlxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjcsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNywKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLXNlY3Rpb24iPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1zZWN0aW9uLWl0ZW0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogNTcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiA3MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWxvY2F0aW9uIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiAyNQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOSwKICAgICAgICAgICAgICBjb2x1bW46IDM5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1sb2NhdGlvbiI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS1sb2NhdGlvbiIgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDY3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogODEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCIgcGxhY2Vob2xkZXI9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJsb2NhdGlvblBsYWNlaG9sZGVyLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibG9jYXRpb25QbGFjZWhvbGRlci10bXBsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxvY2F0aW9uUGxhY2Vob2xkZXItdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDEwMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDEzMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciIHZhbHVlPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAibG9jYXRpb24iKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibG9jYXRpb24iKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAibG9jYXRpb24iLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMzLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzMsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1zZWN0aW9uIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM0LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM0LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1zdGFydC1kYXRlIj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM1LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzUsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNSwKICAgICAgICAgICAgICBjb2x1bW46IDQ4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM1LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtZGF0ZSI+PC9zcGFuPlxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS1zdGFydC1kYXRlIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogNjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzYsCiAgICAgICAgICAgICAgY29sdW1uOiA4MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50IiBwbGFjZWhvbGRlcj0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInN0YXJ0RGF0ZVBsYWNlaG9sZGVyLXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAic3RhcnREYXRlUGxhY2Vob2xkZXItdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJzdGFydERhdGVQbGFjZWhvbGRlci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogMTA1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogMTM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM3LAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzcsCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzdGFydHBpY2tlci1jb250YWluZXIiIHN0eWxlPSJtYXJnaW4tbGVmdDogLTFweDsgcG9zaXRpb246IHJlbGF0aXZlIj48L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzOSwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM5LAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1kYXRlLWRhc2giPi08L3NwYW4+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDAsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDAsCiAgICAgICAgICAgICAgY29sdW1uOiA1NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MCwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tZW5kLWRhdGUiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MSwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQxLAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDEsCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1kYXRlIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPGlucHV0IGlkPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NjaGVkdWxlLWVuZC1kYXRlIiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogNjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDIsCiAgICAgICAgICAgICAgY29sdW1uOiA4MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50IiBwbGFjZWhvbGRlcj0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImVuZERhdGVQbGFjZWhvbGRlci10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImVuZERhdGVQbGFjZWhvbGRlci10bXBsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImVuZERhdGVQbGFjZWhvbGRlci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogMTAzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogMTMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQzLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDMsCiAgICAgICAgICAgICAgY29sdW1uOiAzOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdlbmRwaWNrZXItY29udGFpbmVyIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IC0xcHg7IHBvc2l0aW9uOiByZWxhdGl2ZSI+PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDI0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbi1pdGVtICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1hbGxkYXkiPlxuICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzY2hlZHVsZS1hbGxkYXkiIHR5cGU9ImNoZWNrYm94IiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogODEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDYsCiAgICAgICAgICAgICAgY29sdW1uOiA5NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjaGVja2JveC1zcXVhcmUiJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImlzQWxsRGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDcsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogMTExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ2LAogICAgICAgICAgICAgIGNvbHVtbjogMTQyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJz5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDQ4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtY2hlY2tib3giPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ4LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDgsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSBfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAicG9wdXBJc0FsbERheS10bXBsIikgfHwgKG51bGwgIT0gdCA/IGgodCwgInBvcHVwSXNBbGxEYXktdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cElzQWxsRGF5LXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDgsCiAgICAgICAgICAgICAgY29sdW1uOiA1MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0OCwKICAgICAgICAgICAgICBjb2x1bW46IDc2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiKSArICc8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUxLAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImRyb3Bkb3duICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUxLAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiY2xvc2UgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUxLAogICAgICAgICAgICAgIGNvbHVtbjogOTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2VjdGlvbi1zdGF0ZSI+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImRyb3Bkb3duLWJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiA3OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLXNlY3Rpb24taXRlbSI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUzLAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MywKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLXN0YXRlIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogNDAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnc2NoZWR1bGUtc3RhdGUiIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA2MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDc3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJzdGF0ZSIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg5LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgxMSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTQsCiAgICAgICAgICAgICAgY29sdW1uOiA4NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDE0OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTUsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NSwKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2Ryb3Bkb3duLWFycm93Ij48L3NwYW4+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDx1bCBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTcsCiAgICAgICAgICAgICAgY29sdW1uOiAzNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkcm9wZG93bi1tZW51IiBzdHlsZT0iei1pbmRleDogJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInpJbmRleCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJ6SW5kZXgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiekluZGV4IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogNjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTcsCiAgICAgICAgICAgICAgY29sdW1uOiA3OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPlxuICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU4LAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTgsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1zZWN0aW9uLWl0ZW0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU4LAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTgsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdkcm9wZG93bi1tZW51LWl0ZW0iPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImljb24gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU5LAogICAgICAgICAgICAgIGNvbHVtbjogNDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiA2MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdub25lIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MCwKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgInBvcHVwU3RhdGVCdXN5LXRtcGwiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAicG9wdXBTdGF0ZUJ1c3ktdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cFN0YXRlQnVzeS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYwLAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjAsCiAgICAgICAgICAgICAgY29sdW1uOiA3NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAnPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgPGxpIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLXNlY3Rpb24taXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2Ryb3Bkb3duLW1lbnUtaXRlbSI+XG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MywKICAgICAgICAgICAgICBjb2x1bW46IDI5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYzLAogICAgICAgICAgICAgIGNvbHVtbjogNDMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjMsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MywKICAgICAgICAgICAgICBjb2x1bW46IDYyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ25vbmUiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjQsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSBfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAicG9wdXBTdGF0ZUZyZWUtdG1wbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJwb3B1cFN0YXRlRnJlZS10bXBsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInBvcHVwU3RhdGVGcmVlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjQsCiAgICAgICAgICAgICAgY29sdW1uOiA1MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NCwKICAgICAgICAgICAgICBjb2x1bW46IDc3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpID8gaSA6ICIiKSArICc8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgIDwvdWw+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8YnV0dG9uIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImJ1dHRvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDU4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWNsb3NlIj48c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY4LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjgsCiAgICAgICAgICAgICAgY29sdW1uOiA5OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDEwMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OCwKICAgICAgICAgICAgICBjb2x1bW46IDExNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1jbG9zZSI+PC9zcGFuPjwvYnV0dG9uPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tYnV0dG9uLXNhdmUiPjxidXR0b24gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDcwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiYnV0dG9uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDkxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTA1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgImNvbmZpcm0gIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTEzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY5LAogICAgICAgICAgICAgIGNvbHVtbjogMTI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLXNhdmUiPjxzcGFuPicgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJpc0VkaXRNb2RlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEzLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgxNSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAxNDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjksCiAgICAgICAgICAgICAgY29sdW1uOiAyMjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9zcGFuPjwvYnV0dG9uPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDEzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcxLAogICAgICAgICAgICAgIGNvbHVtbjogMjcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtYXJyb3ciIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzEsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLWFycm93ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MSwKICAgICAgICAgICAgICBjb2x1bW46IDczCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcxLAogICAgICAgICAgICAgIGNvbHVtbjogODcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnYXJyb3ctYm90dG9tIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcyLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzIsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1hcnJvdy1ib3JkZXIiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDczLAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzMsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1hcnJvdy1maWxsIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgdmFyIGwgPSBuKDcpOwogICAgZS5leHBvcnRzID0gKGwuZGVmYXVsdCB8fCBsKS50ZW1wbGF0ZSh7CiAgICAgIDE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogNDUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiA1OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1kZXRhaWwtaXRlbSI+PHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogOTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDExMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1sb2NhdGlvbi1iIj48L3NwYW4+PHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTU5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTczCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJwb3B1cERldGFpbExvY2F0aW9uLXRtcGwiKSB8fCB0ICYmIHUodCwgInBvcHVwRGV0YWlsTG9jYXRpb24tdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAic2NoZWR1bGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERldGFpbExvY2F0aW9uLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxODIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAyMjEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPjwvZGl2PiI7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA2NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1kZXRhaWwtaXRlbSI+PHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogOTcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDExNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDEzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1yZXBlYXQtYiI+PC9zcGFuPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDE3NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAicG9wdXBEZXRhaWxSZXBlYXQtdG1wbCIpIHx8IHQgJiYgdSh0LCAicG9wdXBEZXRhaWxSZXBlYXQtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAic2NoZWR1bGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERldGFpbFJlcGVhdC10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMTg2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMjIzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2Rpdj4iOwogICAgICB9LAogICAgICA1OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogNDYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1kZXRhaWwtaXRlbSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA3OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWRldGFpbC1pdGVtLWluZGVudCI+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDEzMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE1MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDE2NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy11c2VyLWIiPjwvc3Bhbj48c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTk1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMjA5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJwb3B1cERldGFpbFVzZXItdG1wbCIpIHx8IHQgJiYgZCh0LCAicG9wdXBEZXRhaWxVc2VyLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgInNjaGVkdWxlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAicG9wdXBEZXRhaWxVc2VyLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPjwvZGl2PiI7CiAgICAgIH0sCiAgICAgIDc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogNDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA1NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1kZXRhaWwtaXRlbSI+PHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogODgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDEwNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDEyMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdpYy1zdGF0ZS1iIj48L3NwYW4+PHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTUzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTY3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJwb3B1cERldGFpbFN0YXRlLXRtcGwiKSB8fCB0ICYmIHUodCwgInBvcHVwRGV0YWlsU3RhdGUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAic2NoZWR1bGUiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERldGFpbFN0YXRlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxNzYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAyMTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPjwvZGl2PiI7CiAgICAgIH0sCiAgICAgIDk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgICAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGV0YWlsLWl0ZW0iPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDY2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogODAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogOTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY2FsZW5kYXItZG90IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAic2NoZWR1bGUiKSA6IHQpID8gZChpLCAiYmdDb2xvciIpIDogaSwgdCkpICsgJyI+PC9zcGFuPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDE4MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDE5NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJjYWxlbmRhciIpIDogdCkgPyBkKGksICJuYW1lIikgOiBpLCB0KSkgKyAiPC9zcGFuPjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMTE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiA1NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJwb3B1cC1kZXRhaWwtaXRlbSAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDczCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogODcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGV0YWlsLWl0ZW0tc2VwYXJhdGUiPjxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDEyOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDE0MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSAodShuLCAicG9wdXBEZXRhaWxCb2R5LXRtcGwiKSB8fCB0ICYmIHUodCwgInBvcHVwRGV0YWlsQm9keS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJzY2hlZHVsZSIpIDogdCwgewogICAgICAgICAgbmFtZTogInBvcHVwRGV0YWlsQm9keS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMTUxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE4LAogICAgICAgICAgICAgIGNvbHVtbjogMTg2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2Rpdj4iOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9LAogICAgICAxNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tYnV0dG9uIj5cbiAgICAgIDxidXR0b24gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDIxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZWRpdCI+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDYwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiaWNvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjMsCiAgICAgICAgICAgICAgY29sdW1uOiA3OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDkzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLWVkaXQiPjwvc3Bhbj48c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTIyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTM2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2NvbnRlbnQiPicgKyAobnVsbCAhPSAoaSA9IF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJwb3B1cEVkaXQtdG1wbCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJwb3B1cEVkaXQtdG1wbCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cEVkaXQtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE0NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMywKICAgICAgICAgICAgICBjb2x1bW46IDE2NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAnPC9zcGFuPjwvYnV0dG9uPlxuICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC12ZXJ0aWNhbC1saW5lIj48L2Rpdj5cbiAgICAgIDxidXR0b24gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDIxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtZGVsZXRlIj48c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogNjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiA3NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDgxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI1LAogICAgICAgICAgICAgIGNvbHVtbjogOTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnaWMtZGVsZXRlIj48L3NwYW4+PHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDEyNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNSwKICAgICAgICAgICAgICBjb2x1bW46IDE0MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdjb250ZW50Ij4nICsgKG51bGwgIT0gKGkgPSBfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAicG9wdXBEZWxldGUtdG1wbCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJwb3B1cERlbGV0ZS10bXBsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogInBvcHVwRGVsZXRlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNDkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgPyBpIDogIiIpICsgIjwvc3Bhbj48L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDQ2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWRldGFpbCI+XG4gIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWNvbnRhaW5lciI+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzLAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtc2VjdGlvbiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdzZWN0aW9uLWhlYWRlciI+XG4gICAgICA8ZGl2PlxuICAgICAgICA8c3BhbiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAic2NoZWR1bGUtcHJpdmF0ZSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDUyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA2NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJpY29uICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ2ljLXByaXZhdGUiPjwvc3Bhbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NjaGVkdWxlLXRpdGxlIj4nICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJzwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAxOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAicG9wdXAtZGV0YWlsLWRhdGUgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA1MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNjQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnY29udGVudCI+JyArIChudWxsICE9IChpID0gKGgobiwgInBvcHVwRGV0YWlsRGF0ZS10bXBsIikgfHwgdCAmJiBoKHQsICJwb3B1cERldGFpbERhdGUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgImlzQWxsRGF5IikgOiBpLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAic3RhcnQiKSA6IGksIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJlbmQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJwb3B1cERldGFpbERhdGUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDE0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICc8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3NlY3Rpb24tZGV0YWlsIj5cbiAgICAgICAgJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJsb2NhdGlvbiIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMSwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAicmVjdXJyZW5jZVJ1bGUiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMjQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgImF0dGVuZGVlcyIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNzMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgICIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAic3RhdGUiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMjMyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImNhbGVuZGFyIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDksIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZSIpIDogdCkgPyBoKGksICJib2R5IikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDExLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMDYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgPC9kaXY+XG4iICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInNjaGVkdWxlIikgOiB0KSA/IGgoaSwgImlzUmVhZE9ubHkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDE1LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgIDwvZGl2PlxuICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiAxNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOSwKICAgICAgICAgICAgICBjb2x1bW46IDI4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLXRvcC1saW5lIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic2NoZWR1bGUiKSA6IHQpID8gaChpLCAiYmdDb2xvciIpIDogaSwgdCkpICsgJyI+PC9kaXY+XG4gIDxkaXYgaWQ9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMjUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAncG9wdXAtYXJyb3ciIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDU5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInBvcHVwLWFycm93ICIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDcxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnYXJyb3ctbGVmdCI+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMxLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzEsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdwb3B1cC1hcnJvdy1ib3JkZXIiPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMiwKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3BvcHVwLWFycm93LWZpbGwiPjwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpOwoKICAgIGZ1bmN0aW9uIGEoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy5kYXlOYW1lVmlldyA9IHQsIHRoaXMuYmFzZUNvbnRyb2xsZXIgPSBuLCBlLm9uKHsKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICBhLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5kYXlOYW1lVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLmRyYWdIYW5kbGVyID0gbnVsbDsKICAgIH0sIGEucHJvdG90eXBlLmNoZWNrRXhwZWN0Q29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuICEhaS5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIuZGF5bmFtZS1kYXRlLWFyZWEiKSk7CiAgICB9LCBhLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gZS50YXJnZXQsCiAgICAgICAgICBuID0gdGhpcy5jaGVja0V4cGVjdENvbmRpdGlvbih0KSwKICAgICAgICAgIGwgPSBpLmNsb3Nlc3QodCwgby5jbGFzc25hbWUoIi5kYXluYW1lIikpOwogICAgICBuICYmIGwgJiYgdGhpcy5maXJlKCJjbGlja0RheW5hbWUiLCB7CiAgICAgICAgZGF0ZTogaS5nZXREYXRhKGwsICJkYXRlIikKICAgICAgfSk7CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihhKSwgZS5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbigzNCk7CgogICAgZnVuY3Rpb24gcihlLCB0LCBuKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLnZpZXcgPSB0LCB0aGlzLmNvbnRyb2xsZXIgPSBuLCBlLm9uKHsKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICByLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy52aWV3ID0gdGhpcy5jb250cm9sbGVyID0gdGhpcy5kcmFnSGFuZGxlciA9IG51bGw7CiAgICB9LCByLnByb3RvdHlwZS5jaGVja0V4cGVjdENvbmRpdGlvbiA9IGEucHJvdG90eXBlLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24sIHIucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcywKICAgICAgICAgIGwgPSBlLnRhcmdldCwKICAgICAgICAgIGEgPSB0aGlzLmNoZWNrRXhwZWN0Q29uZGl0aW9uKGwpLAogICAgICAgICAgciA9IHRoaXMuY29udHJvbGxlci5zY2hlZHVsZXMsCiAgICAgICAgICBzID0gaS5jbG9zZXN0KGwsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1jb2xsYXBzZS1idG4iKSksCiAgICAgICAgICBjID0gaS5jbG9zZXN0KGwsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1leGNlZWQtaW4td2VlayIpKTsKCiAgICAgIGlmICh0aGlzLnZpZXcuY29udGFpbmVyLmNvbnRhaW5zKGwpKSB7CiAgICAgICAgaWYgKCFzKSByZXR1cm4gYyA/ICh0aGlzLnZpZXcuc2V0U3RhdGUoewogICAgICAgICAgY2xpY2tlZEV4cGFuZEJ0bkluZGV4OiBwYXJzZUludChpLmdldERhdGEoYywgImluZGV4IiksIDEwKQogICAgICAgIH0pLCB2b2lkIG4uZmlyZSgiZXhwYW5kIikpIDogdm9pZCAoYSAmJiBpLmNsb3Nlc3QobCwgby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlIikpICYmICh0ID0gaS5jbG9zZXN0KGwsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpKSwgci5kb1doZW5IYXMoaS5nZXREYXRhKHQsICJpZCIpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgbi5maXJlKCJjbGlja1NjaGVkdWxlIiwgewogICAgICAgICAgICBzY2hlZHVsZTogdCwKICAgICAgICAgICAgZXZlbnQ6IGUub3JpZ2luRXZlbnQKICAgICAgICAgIH0pOwogICAgICAgIH0pKSk7CiAgICAgICAgbi5maXJlKCJjb2xsYXBzZSIpOwogICAgICB9CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihyKSwgZS5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDMpLAogICAgICAgICAgYSA9IG4oMSksCiAgICAgICAgICByID0gbigxMSk7CgogICAgICBmdW5jdGlvbiBzKGUpIHsKICAgICAgICB0aGlzLmRheWdyaWRNb3ZlID0gZSwgdGhpcy5zY2hlZHVsZUNvbnRhaW5lciA9IG51bGwsIHRoaXMuX2RyYWdTdGFydFhJbmRleCA9IG51bGwsIHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbCwgdGhpcy5lbGVtZW50cyA9IG51bGwsIGUub24oewogICAgICAgICAgZHJhZ3N0YXJ0OiB0aGlzLl9vbkRyYWdTdGFydCwKICAgICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIGRyYWdlbmQ6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50LAogICAgICAgICAgY2xpY2s6IHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50CiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHMucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy5kYXlncmlkTW92ZS5vZmYodGhpcyksIHRoaXMuZGF5Z3JpZE1vdmUgPSB0aGlzLnNjaGVkdWxlQ29udGFpbmVyID0gdGhpcy5fZHJhZ1N0YXJ0WEluZGV4ID0gdGhpcy5lbGVtZW50cyA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbDsKICAgICAgfSwgcy5wcm90b3R5cGUuX2NsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcygpLCBhLnJlbW92ZSh0aGlzLmd1aWRlRWxlbWVudCksIGwuYnJvd3Nlci5tc2llIHx8IGEucmVtb3ZlQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgiZHJhZ2dpbmciKSksIHRoaXMuX2RyYWdTdGFydFhJbmRleCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuZ3VpZGVFbGVtZW50ID0gbnVsbDsKICAgICAgfSwgcy5wcm90b3R5cGUuX2hpZGVPcmlnaW5TY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBvLmNsYXNzbmFtZSgid2Vla2RheS1zY2hlZHVsZS1ibG9jay1kcmFnZ2luZy1kaW0iKSwKICAgICAgICAgICAgbiA9IGEuZmluZChvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSwgdGhpcy5kYXlncmlkTW92ZS52aWV3LmNvbnRhaW5lciwgITApOwogICAgICAgIHRoaXMuZWxlbWVudHMgPSBsLmZpbHRlcihuLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGEuZ2V0RGF0YSh0LCAiaWQiKSA9PT0gZTsKICAgICAgICB9KSwgbC5mb3JFYWNoKHRoaXMuZWxlbWVudHMsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBhLmFkZENsYXNzKGUsIHQpOwogICAgICAgIH0pOwogICAgICB9LCBzLnByb3RvdHlwZS5fc2hvd09yaWdpblNjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIik7CiAgICAgICAgbC5mb3JFYWNoKHRoaXMuZWxlbWVudHMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBhLnJlbW92ZUNsYXNzKHQsIGUpOwogICAgICAgIH0pOwogICAgICB9LCBzLnByb3RvdHlwZS5faGlnaGxpZ2h0U2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIHZhciBuID0gYS5maW5kKG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZSIpLCB0LCAhMCk7CiAgICAgICAgbC5mb3JFYWNoKG4sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0LnN0eWxlLm1hcmdpbiA9ICIwIiwgZS5pc0ZvY3VzZWQgfHwgKHQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZS5kcmFnQmdDb2xvciwgdC5zdHlsZS5ib3JkZXJMZWZ0Q29sb3IgPSBlLmJvcmRlckNvbG9yLCB0LnN0eWxlLmNvbG9yID0gIiNmZmZmZmYiKTsKICAgICAgICB9KTsKICAgICAgfSwgcy5wcm90b3R5cGUucmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgICAgdmFyIGkgPSB0aGlzLmd1aWRlRWxlbWVudDsKICAgICAgICByLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgaS5zdHlsZS5sZWZ0ID0gZSArICIlIiwgaS5zdHlsZS53aWR0aCA9IHQgKyAiJSIsIG4gPyBhLmFkZENsYXNzKGksIG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LWV4Y2VlZC1sZWZ0IikpIDogYS5yZW1vdmVDbGFzcyhpLCBvLmNsYXNzbmFtZSgid2Vla2RheS1leGNlZWQtbGVmdCIpKSwgbCA/IGEuYWRkQ2xhc3MoaSwgby5jbGFzc25hbWUoIndlZWtkYXktZXhjZWVkLXJpZ2h0IikpIDogYS5yZW1vdmVDbGFzcyhpLCBvLmNsYXNzbmFtZSgid2Vla2RheS1leGNlZWQtcmlnaHQiKSk7CiAgICAgICAgfSk7CiAgICAgIH0sIHMucHJvdG90eXBlLl9nZXRTY2hlZHVsZUJsb2NrRGF0YUZ1bmMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gZS5tb2RlbCwKICAgICAgICAgICAgbiA9IGUuZGF0ZXNJblJhbmdlLAogICAgICAgICAgICBsID0gZS5yYW5nZSwKICAgICAgICAgICAgbyA9IDEwMCAvIG4sCiAgICAgICAgICAgIGEgPSBpLnN0YXJ0KHQuc3RhcnQpLAogICAgICAgICAgICByID0gaS5lbmQodC5lbmQpLAogICAgICAgICAgICBzID0gaS5zdGFydChsWzBdKSwKICAgICAgICAgICAgYyA9IGkuZW5kKGxbbC5sZW5ndGggLSAxXSksCiAgICAgICAgICAgIHUgPSBNYXRoLmNlaWwoKGEuZ2V0VGltZSgpIC0gcy5nZXRUaW1lKCkpIC8gaS5NSUxMSVNFQ09ORFNfUEVSX0RBWSkgfHwgMCwKICAgICAgICAgICAgZCA9IE1hdGguY2VpbCgoci5nZXRUaW1lKCkgLSBjLmdldFRpbWUoKSkgLyBpLk1JTExJU0VDT05EU19QRVJfREFZKSB8fCAwOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYmFzZVdpZHRoUGVyY2VudDogbywKICAgICAgICAgICAgZnJvbUxlZnQ6IHUgKyBlLAogICAgICAgICAgICBmcm9tUmlnaHQ6IGQgKyBlCiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgIH0sIHMucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIG4sCiAgICAgICAgICAgIGkgPSB0aGlzLmRheWdyaWRNb3ZlLnZpZXcuY29udGFpbmVyLAogICAgICAgICAgICByID0gdGhpcy5ndWlkZUVsZW1lbnQgPSBlLnNjaGVkdWxlQmxvY2tFbGVtZW50LmNsb25lTm9kZSghMCk7CiAgICAgICAgbC5icm93c2VyLm1zaWUgfHwgYS5hZGRDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJkcmFnZ2luZyIpKSwgdGhpcy5faGlkZU9yaWdpblNjaGVkdWxlQmxvY2tzKFN0cmluZyhlLm1vZGVsLmNpZCgpKSksIG4gPSBhLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlcyIpLCBpKSwgYS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2Iiwgciwgby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtY292ZXIiKSksIG4uYXBwZW5kQ2hpbGQociksIHRoaXMuX2RyYWdTdGFydFhJbmRleCA9IGUueEluZGV4LCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9nZXRTY2hlZHVsZUJsb2NrRGF0YUZ1bmMoZSksIHRoaXMuX2hpZ2hsaWdodFNjaGVkdWxlQmxvY2tzKGUubW9kZWwsIHIpOwogICAgICB9LCBzLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgbCwKICAgICAgICAgICAgbywKICAgICAgICAgICAgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcywKICAgICAgICAgICAgYyA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgICAgdSA9IHRoaXMuX2RyYWdTdGFydFhJbmRleCwKICAgICAgICAgICAgZCA9IGUuZGF0ZXNJblJhbmdlLAogICAgICAgICAgICBoID0gZS5ncmlkczsKICAgICAgICBjICYmIChuID0gKHQgPSBjKGUueEluZGV4IC0gdSkpLmZyb21MZWZ0IDwgMCwgbCA9IHQuZnJvbVJpZ2h0ID4gMCwgaSA9IE1hdGgubWF4KDAsIHQuZnJvbUxlZnQpLCBvID0gLTEgKiB0LmZyb21MZWZ0ICsgKGQgKyB0LmZyb21SaWdodCksIGEgPSBuID8gbyArIHQuZnJvbUxlZnQgOiBvLCBhID0gbCA/IGEgLSB0LmZyb21SaWdodCA6IGEsIHIgPSBoW2ldID8gaFtpXS5sZWZ0IDogMCwgcyA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgICAgICBmb3IgKHZhciBsID0gMCwgbyA9IDAsIGkgPSBuLmxlbmd0aDsgbyA8IHQ7IG8gKz0gMSkgewogICAgICAgICAgICAoZSA9IChlICsgbykgJSBpKSA8IGkgJiYgKGwgKz0gbltlXSA/IG5bZV0ud2lkdGggOiAwKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbDsKICAgICAgICB9KGksIGEsIGgpLCB0aGlzLnJlZnJlc2hHdWlkZUVsZW1lbnQociwgcywgbiwgbCkpOwogICAgICB9LCBlLmV4cG9ydHMgPSBzOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbig1KSwKICAgICAgICByID0gbigxKSwKICAgICAgICBzID0gbig2KSwKICAgICAgICBjID0gbigxNyksCiAgICAgICAgdSA9IG4oODYpLAogICAgICAgIGQgPSBuKDQpLkRhdGUsCiAgICAgICAgaCA9IDMwMDsKCiAgICBmdW5jdGlvbiBwKGUsIHQsIG4sIGwpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudmlldyA9IHQsIHRoaXMuY29udHJvbGxlciA9IG4sIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwsIHRoaXMuZ3VpZGUgPSBuZXcgdSh0aGlzKSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMSwgdGhpcy5fZGlzYWJsZURibENsaWNrID0gbC5kaXNhYmxlRGJsQ2xpY2ssIHRoaXMuX2Rpc2FibGVDbGljayA9IGwuZGlzYWJsZUNsaWNrLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyksIGUub24oImNsaWNrIiwgdGhpcy5fb25DbGljaywgdGhpcyksIHRoaXMuX2Rpc2FibGVEYmxDbGljayA/IGggPSAwIDogcy5vbih0LmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyk7CiAgICB9CgogICAgcC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLnZpZXcgJiYgdGhpcy52aWV3LmNvbnRhaW5lciAmJiBzLm9mZih0aGlzLnZpZXcuY29udGFpbmVyLCAiZGJsY2xpY2siLCB0aGlzLl9vbkRibENsaWNrLCB0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMudmlldyA9IHRoaXMuY29udHJvbGxlciA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGw7CiAgICB9LCBwLnByb3RvdHlwZS5jaGVja0V4cGVjdGVkQ29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgaSA9IHIuZ2V0Q2xhc3MoZSkudHJpbSgpOwogICAgICByZXR1cm4gIXIuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktZXhjZWVkLWluLXdlZWsiKSkgJiYgIXIuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktY29sbGFwc2UtYnRuIikpICYmICFyLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLWJsb2NrIiksICEwKSAmJiAhKCEobiA9IHIuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGVzIikpKSAmJiBpICE9PSBvLmNsYXNzbmFtZSgid2Vla2RheS1zY2hlZHVsZXMiKSkgJiYgKGUgPSBuID8gbi5wYXJlbnROb2RlIDogZS5wYXJlbnROb2RlLCAhKCEodCA9IChpID0gci5nZXRDbGFzcyhlKSkubWF0Y2goby5kYXlncmlkLmdldFZpZXdJRFJlZ0V4cCkpIHx8IHQubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudmlldy5jaGlsZHJlbi5pdGVtcywgdFsxXSkpOwogICAgfSwgcC5wcm90b3R5cGUuX2NyZWF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCA9IGUucmFuZ2UsCiAgICAgICAgICBvID0gZS5kcmFnU3RhcnRYSW5kZXgsCiAgICAgICAgICBhID0gZS54SW5kZXg7CiAgICAgIGEgPCBvICYmIChvID0gYSArIG8sIG8gLT0gYSA9IG8gLSBhKSwgdCA9IG5ldyBkKGxbb10pLCBuID0gaS5lbmQobFthXSksIHRoaXMuZmlyZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgY2F0ZWdvcnk6IHRoaXMudmlldy5vcHRpb25zLnZpZXdOYW1lLAogICAgICAgIGlzQWxsRGF5OiAhMCwKICAgICAgICBzdGFydDogdCwKICAgICAgICBlbmQ6IG4sCiAgICAgICAgZ3VpZGU6IHRoaXMuZ3VpZGUsCiAgICAgICAgdHJpZ2dlckV2ZW50TmFtZTogZS50cmlnZ2VyRXZlbnQKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gZS50YXJnZXQ7CiAgICAgIHRoaXMuY2hlY2tFeHBlY3RlZENvbmRpdGlvbihsKSAmJiAodGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdCA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEodGhpcy52aWV3LCBlLm9yaWdpbkV2ZW50KSwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gdCwgbiA9IHQoZS5vcmlnaW5FdmVudCksIHRoaXMuZmlyZSgiZHJhZ3N0YXJ0IiwgbikpOwogICAgfSwgcC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYzsKICAgICAgbiAmJiAodCA9IG4oZS5vcmlnaW5FdmVudCksIHRoaXMuZmlyZSgiZHJhZyIsIHQpKTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGwgPSB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmM7CiAgICAgIGwgJiYgKHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCBuID0gbChlLm9yaWdpbkV2ZW50KSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUobiksIHRoaXMuZmlyZSh0IHx8ICJkcmFnZW5kIiwgbiksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwpOwogICAgfSwgcC5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpczsKICAgICAgdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGUudGFyZ2V0KSAmJiAhdGhpcy5fZGlzYWJsZUNsaWNrICYmICh0ID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0aGlzLnZpZXcsIGUub3JpZ2luRXZlbnQpLCBuID0gdChlLm9yaWdpbkV2ZW50KSwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMCwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgbC5fcmVxdWVzdE9uQ2xpY2sgJiYgKGwuZmlyZSgiY2xpY2siLCBuKSwgbC5fY3JlYXRlU2NoZWR1bGUobikpLCBsLl9yZXF1ZXN0T25DbGljayA9ICExOwogICAgICB9LCBoKSk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EYmxDbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICB0aGlzLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24oZS50YXJnZXQpICYmICh0ID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0aGlzLnZpZXcsIGUpKGUpLCB0aGlzLmZpcmUoImNsaWNrIiwgdCksIHRoaXMuX2NyZWF0ZVNjaGVkdWxlKHQpLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICExKTsKICAgIH0sIHAucHJvdG90eXBlLmludm9rZUNyZWF0aW9uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGFGcm9tRGF0ZSh0aGlzLnZpZXcsIGUuc3RhcnQpOwoKICAgICAgdGhpcy5maXJlKCJjbGljayIsIHQpLCB0aGlzLl9jcmVhdGVTY2hlZHVsZSh0KTsKICAgIH0sIGEubWl4aW4oYywgcCksIGwuQ3VzdG9tRXZlbnRzLm1peGluKHApLCBlLmV4cG9ydHMgPSBwOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDIpLAogICAgICAgIG8gPSBuKDEpLAogICAgICAgIGkgPSBuKDExKTsKCiAgICBmdW5jdGlvbiBhKGUpIHsKICAgICAgdGhpcy5jcmVhdGlvbiA9IGUsIHRoaXMuc2NoZWR1bGVDb250YWluZXIgPSBudWxsLCB0aGlzLmd1aWRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLCB0aGlzLmluaXRpYWxpemVHdWlkZUVsZW1lbnQoKSwgdGhpcy5hcHBseVRoZW1lKGUuY29udHJvbGxlci50aGVtZSksIGUub24oewogICAgICAgIGRyYWdzdGFydDogdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50LAogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBjbGljazogdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50CiAgICAgIH0sIHRoaXMpOwogICAgfQoKICAgIGEucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuY2xlYXJHdWlkZUVsZW1lbnQoKSwgdGhpcy5jcmVhdGlvbi5vZmYodGhpcyksIHRoaXMuY3JlYXRpb24gPSB0aGlzLnNjaGVkdWxlQ29udGFpbmVyID0gdGhpcy5ndWlkZUVsZW1lbnQgPSBudWxsOwogICAgfSwgYS5wcm90b3R5cGUuaW5pdGlhbGl6ZUd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgby5hZGRDbGFzcyh0aGlzLmd1aWRlRWxlbWVudCwgbC5jbGFzc25hbWUoImRheWdyaWQtZ3VpZGUtY3JlYXRpb24tYmxvY2siKSk7CiAgICB9LCBhLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudChlLCAhMCk7CiAgICB9LCBhLnByb3RvdHlwZS5fZ2V0R3VpZGVXaWR0aCA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAgIGZvciAodmFyIGwgPSAwLCBvID0gZTsgbyA8PSB0OyBvICs9IDEpIHsKICAgICAgICBsICs9IG5bb10gPyBuW29dLndpZHRoIDogMDsKICAgICAgfQoKICAgICAgcmV0dXJuIGw7CiAgICB9LCBhLnByb3RvdHlwZS5fcmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8gPSB0aGlzLmd1aWRlRWxlbWVudCwKICAgICAgICAgIGEgPSBlLAogICAgICAgICAgciA9IGEuZHJhZ1N0YXJ0WEluZGV4IDwgYS54SW5kZXggPyBhLmRyYWdTdGFydFhJbmRleCA6IGEueEluZGV4LAogICAgICAgICAgcyA9IGEuZHJhZ1N0YXJ0WEluZGV4IDwgYS54SW5kZXggPyBhLnhJbmRleCA6IGEuZHJhZ1N0YXJ0WEluZGV4OwoKICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICBvLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCBvLnN0eWxlLmxlZnQgPSBuICsgIiUiLCBvLnN0eWxlLndpZHRoID0gbCArICIlIjsKICAgICAgfQoKICAgICAgbiA9IGEuZ3JpZHNbcl0gPyBhLmdyaWRzW3JdLmxlZnQgOiAwLCBsID0gdGhpcy5fZ2V0R3VpZGVXaWR0aChyLCBzLCBhLmdyaWRzKSwgdCA/IGkucmVxdWVzdEFuaW1GcmFtZShjKSA6IGMoKTsKICAgIH0sIGEucHJvdG90eXBlLmNsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IHRoaXMuZ3VpZGVFbGVtZW50OwogICAgICBvLnJlbW92ZShlKSwgZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiLCBlLnN0eWxlLmxlZnQgPSAiIiwgZS5zdHlsZS53aWR0aCA9ICIiOwogICAgfSwgYS5wcm90b3R5cGUuX2NyZWF0ZUd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5jcmVhdGlvbi52aWV3LmNvbnRhaW5lcjsKICAgICAgby5maW5kKGwuY2xhc3NuYW1lKCIud2Vla2RheS1ncmlkIiksIHQpLmFwcGVuZENoaWxkKHRoaXMuZ3VpZGVFbGVtZW50KSwgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudChlKTsKICAgIH0sIGEucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9yZWZyZXNoR3VpZGVFbGVtZW50KGUpOwogICAgfSwgYS5wcm90b3R5cGUuYXBwbHlUaGVtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcy5ndWlkZUVsZW1lbnQuc3R5bGU7CiAgICAgIHQuYmFja2dyb3VuZENvbG9yID0gZS5jb21tb24uY3JlYXRpb25HdWlkZS5iYWNrZ3JvdW5kQ29sb3IsIHQuYm9yZGVyID0gZS5jb21tb24uY3JlYXRpb25HdWlkZS5ib3JkZXI7CiAgICB9LCBlLmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDUpLAogICAgICAgIHMgPSBuKDE3KSwKICAgICAgICBjID0gbig4OCksCiAgICAgICAgdSA9IG4oNCkuRGF0ZTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMudmlldyA9IHQsIHRoaXMuY29udHJvbGxlciA9IG4sIHRoaXMuX2RyYWdTdGFydCA9IG51bGwsIGUub24oewogICAgICAgIGRyYWdTdGFydDogdGhpcy5fb25EcmFnU3RhcnQKICAgICAgfSwgdGhpcyksIHRoaXMuZ3VpZGUgPSBuZXcgYyh0aGlzKTsKICAgIH0KCiAgICBkLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmd1aWRlLmRlc3Ryb3koKSwgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLnZpZXcgPSB0aGlzLmNvbnRyb2xsZXIgPSB0aGlzLmd1aWRlID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIH0sIGQucHJvdG90eXBlLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBhLmdldENsYXNzKGUpOwogICAgICByZXR1cm4gISF+bi5pbmRleE9mKG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUiKSkgJiYgISEoZSA9IGEuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXkiKSkpICYmICEoISh0ID0gKG4gPSBhLmdldENsYXNzKGUpKS5tYXRjaChvLmRheWdyaWQuZ2V0Vmlld0lEUmVnRXhwKSkgfHwgdC5sZW5ndGggPCAyKSAmJiBsLnBpY2sodGhpcy52aWV3LmNoaWxkcmVuLml0ZW1zLCB0WzFdKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGksCiAgICAgICAgICByLAogICAgICAgICAgcywKICAgICAgICAgIGMgPSBlLnRhcmdldCwKICAgICAgICAgIHUgPSB0aGlzLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24oYyksCiAgICAgICAgICBkID0gdGhpcy5jb250cm9sbGVyOwogICAgICB1ICYmICh0ID0gYS5jbG9zZXN0KGMsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpKSwgbiA9IGEuZ2V0RGF0YSh0LCAiaWQiKSwgKGkgPSBkLnNjaGVkdWxlcy5pdGVtc1tuXSkgJiYgKHIgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhKHRoaXMudmlldywgZS5vcmlnaW5FdmVudCksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHIsIHMgPSB0aGlzLl9kcmFnU3RhcnQgPSByKGUub3JpZ2luRXZlbnQpLCBsLmV4dGVuZChzLCB7CiAgICAgICAgc2NoZWR1bGVCbG9ja0VsZW1lbnQ6IHQsCiAgICAgICAgbW9kZWw6IGkKICAgICAgfSksIHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQsCiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyksIHRoaXMuZmlyZSgiZHJhZ3N0YXJ0IiwgcykpKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYzsKICAgICAgdCAmJiB0aGlzLmZpcmUoImRyYWciLCB0KGUub3JpZ2luRXZlbnQpKTsKICAgIH0sIGQucHJvdG90eXBlLl91cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IGUudGFyZ2V0TW9kZWwsCiAgICAgICAgICBsID0gZS54SW5kZXggLSBlLmRyYWdTdGFydFhJbmRleCwKICAgICAgICAgIG8gPSBuZXcgdShuLmVuZCk7CiAgICAgIG8gPSBvLmFkZERhdGUobCksIG8gPSBuZXcgdShyLm1heERhdGUoaS5lbmQobi5zdGFydCksIG8pKSwgdCA9IHIuZ2V0U2NoZWR1bGVDaGFuZ2VzKG4sIFsiZW5kIl0sIHsKICAgICAgICBlbmQ6IG8KICAgICAgfSksIHRoaXMuZmlyZSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IG4sCiAgICAgICAgY2hhbmdlczogdCwKICAgICAgICBzdGFydDogbi5nZXRTdGFydHMoKSwKICAgICAgICBlbmQ6IG8KICAgICAgfSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBpID0gdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jLAogICAgICAgICAgYSA9IHRoaXMuX2RyYWdTdGFydDsKICAgICAgaSAmJiBhICYmICh0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgbyA9IGkoZS5vcmlnaW5FdmVudCksIGwuZXh0ZW5kKG8sIHsKICAgICAgICB0YXJnZXRNb2RlbDogYS5tb2RlbAogICAgICB9KSwgbiB8fCB0aGlzLl91cGRhdGVTY2hlZHVsZShvKSwgdGhpcy5maXJlKHQgfHwgImRyYWdlbmQiLCBvKSwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbCk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX29uRHJhZ0VuZChlLCAiY2xpY2siLCAhMCk7CiAgICB9LCByLm1peGluKHMsIGQpLCBsLkN1c3RvbUV2ZW50cy5taXhpbihkKSwgZS5leHBvcnRzID0gZDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDEpLAogICAgICAgICAgYSA9IG4oMyksCiAgICAgICAgICByID0gbigxMSk7CgogICAgICBmdW5jdGlvbiBzKGUpIHsKICAgICAgICB0aGlzLnJlc2l6ZUhhbmRsZXIgPSBlLCB0aGlzLnNjaGVkdWxlQ29udGFpbmVyID0gbnVsbCwgdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gbnVsbCwgdGhpcy5ndWlkZUVsZW1lbnQgPSBudWxsLCB0aGlzLnNjaGVkdWxlQmxvY2tFbGVtZW50ID0gbnVsbCwgZS5vbih7CiAgICAgICAgICBkcmFnc3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0LAogICAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgICAgZHJhZ2VuZDogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQsCiAgICAgICAgICBjbGljazogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQoKICAgICAgcy5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jbGVhckd1aWRlRWxlbWVudCgpLCB0aGlzLnJlc2l6ZUhhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLnJlc2l6ZUhhbmRsZXIgPSB0aGlzLnNjaGVkdWxlQ29udGFpbmVyID0gdGhpcy5nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5ndWlkZUVsZW1lbnQgPSB0aGlzLnNjaGVkdWxlQmxvY2tFbGVtZW50ID0gbnVsbDsKICAgICAgfSwgcy5wcm90b3R5cGUuX2NsZWFyR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGkucmVtb3ZlKHRoaXMuZ3VpZGVFbGVtZW50KSwgbC5icm93c2VyLm1zaWUgfHwgaS5yZW1vdmVDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZy14IikpLCB0aGlzLnNjaGVkdWxlQmxvY2tFbGVtZW50ICYmIGkucmVtb3ZlQ2xhc3ModGhpcy5zY2hlZHVsZUJsb2NrRWxlbWVudCwgby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIikpLCB0aGlzLmdldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsOwogICAgICB9LCBzLnByb3RvdHlwZS5yZWZyZXNoR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuZ3VpZGVFbGVtZW50OwogICAgICAgIHIucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0LnN0eWxlLndpZHRoID0gZSArICIlIjsKICAgICAgICB9KTsKICAgICAgfSwgcy5wcm90b3R5cGUuZ2V0R3VpZGVFbGVtZW50V2lkdGhGdW5jID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IGUubW9kZWwsCiAgICAgICAgICAgIG4gPSB0aGlzLnJlc2l6ZUhhbmRsZXIudmlldy5vcHRpb25zLAogICAgICAgICAgICBsID0gTWF0aC5jZWlsKCh0LnN0YXJ0IC0gbi5yZW5kZXJTdGFydERhdGUpIC8gYS5NSUxMSVNFQ09ORFNfUEVSX0RBWSkgfHwgMCwKICAgICAgICAgICAgbyA9IGUuZ3JpZHM7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgdCA9IDAsCiAgICAgICAgICAgICAgbiA9IDAsCiAgICAgICAgICAgICAgaSA9IG8ubGVuZ3RoOwoKICAgICAgICAgIGZvciAodCArPSBvW2xdID8gb1tsXS53aWR0aCA6IDA7IG4gPCBpOyBuICs9IDEpIHsKICAgICAgICAgICAgbiA+IGwgJiYgbiA8PSBlICYmICh0ICs9IG9bbl0gPyBvW25dLndpZHRoIDogMCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfTsKICAgICAgfSwgcy5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgYSA9IHRoaXMucmVzaXplSGFuZGxlci52aWV3LmNvbnRhaW5lciwKICAgICAgICAgICAgciA9IHRoaXMuc2NoZWR1bGVCbG9ja0VsZW1lbnQgPSBlLnNjaGVkdWxlQmxvY2tFbGVtZW50LAogICAgICAgICAgICBzID0gdGhpcy5ndWlkZUVsZW1lbnQgPSByLmNsb25lTm9kZSghMCk7CiAgICAgICAgbC5icm93c2VyLm1zaWUgfHwgaS5hZGRDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZy14IikpLCBuID0gaS5maW5kKG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZXMiKSwgYSksIGkuYWRkQ2xhc3Mocywgby5jbGFzc25hbWUoImRheWdyaWQtZ3VpZGUtbW92ZSIpKSwgaS5hZGRDbGFzcyhyLCBvLmNsYXNzbmFtZSgid2Vla2RheS1zY2hlZHVsZS1ibG9jay1kcmFnZ2luZy1kaW0iKSksIG4uYXBwZW5kQ2hpbGQocyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuZ2V0R3VpZGVFbGVtZW50V2lkdGhGdW5jKGUpOwogICAgICB9LCBzLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhRnVuYzsKICAgICAgICB0ICYmIHRoaXMucmVmcmVzaEd1aWRlRWxlbWVudCh0KGUueEluZGV4KSk7CiAgICAgIH0sIGUuZXhwb3J0cyA9IHM7CiAgICB9KS5jYWxsKHRoaXMsIG4oOSkpOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDEpOwoKICAgIGZ1bmN0aW9uIGEoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy50aW1lR3JpZFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgZS5vbih7CiAgICAgICAgY2xpY2s6IHRoaXMuX29uQ2xpY2sKICAgICAgfSwgdGhpcyk7CiAgICB9CgogICAgYS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMudGltZUdyaWRWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IHRoaXMuZHJhZ0hhbmRsZXIgPSBudWxsOwogICAgfSwgYS5wcm90b3R5cGUuY2hlY2tFeHBlY3RDb25kaXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwgbjsKICAgICAgcmV0dXJuICEhKHQgPSBpLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi50aW1lLWRhdGUiKSkpICYmICEoIShuID0gaS5nZXRDbGFzcyh0KS5tYXRjaChvLnRpbWUuZ2V0Vmlld0lEUmVnRXhwKSkgfHwgbi5sZW5ndGggPCAyKSAmJiBsLnBpY2sodGhpcy50aW1lR3JpZFZpZXcuY2hpbGRyZW4uaXRlbXMsIE51bWJlcihuWzFdKSk7CiAgICB9LCBhLnByb3RvdHlwZS5fb25DbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgIG4gPSBlLnRhcmdldCwKICAgICAgICAgIGwgPSB0aGlzLmNoZWNrRXhwZWN0Q29uZGl0aW9uKG4pLAogICAgICAgICAgYSA9IGkuY2xvc2VzdChuLCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKSwKICAgICAgICAgIHIgPSB0aGlzLmJhc2VDb250cm9sbGVyLnNjaGVkdWxlczsKICAgICAgbCAmJiBhICYmIHIuZG9XaGVuSGFzKGkuZ2V0RGF0YShhLCAiaWQiKSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICB0LmZpcmUoImNsaWNrU2NoZWR1bGUiLCB7CiAgICAgICAgICBzY2hlZHVsZTogbiwKICAgICAgICAgIGV2ZW50OiBlLm9yaWdpbkV2ZW50CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4oYSksIGUuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMTUpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDEpLAogICAgICAgIHMgPSBuKDYpLAogICAgICAgIGMgPSBuKDUpLAogICAgICAgIHUgPSBuKDkxKSwKICAgICAgICBkID0gbig0KS5EYXRlLAogICAgICAgIGggPSBuKDE4KSwKICAgICAgICBwID0gMzAwOwoKICAgIGZ1bmN0aW9uIG0oZSwgdCwgbiwgbCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy50aW1lR3JpZFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgdGhpcy5ndWlkZSA9IG5ldyB1KHRoaXMpLCB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gbnVsbCwgdGhpcy5fZHJhZ1N0YXJ0ID0gbnVsbCwgdGhpcy5fcmVxdWVzdE9uQ2xpY2sgPSAhMSwgdGhpcy5fZGlzYWJsZURibENsaWNrID0gbC5kaXNhYmxlRGJsQ2xpY2ssIHRoaXMuX2Rpc2FibGVDbGljayA9IGwuZGlzYWJsZUNsaWNrLCBlLm9uKCJkcmFnU3RhcnQiLCB0aGlzLl9vbkRyYWdTdGFydCwgdGhpcyksIGUub24oImNsaWNrIiwgdGhpcy5fb25DbGljaywgdGhpcyksIHRoaXMuX2Rpc2FibGVEYmxDbGljayA/IHAgPSAwIDogcy5vbih0LmNvbnRhaW5lciwgImRibGNsaWNrIiwgdGhpcy5fb25EYmxDbGljaywgdGhpcyk7CiAgICB9CgogICAgbS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGUgPSB0aGlzLnRpbWVHcmlkVmlldzsKICAgICAgdGhpcy5ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCBlICYmIGUuY29udGFpbmVyICYmIHMub2ZmKGUuY29udGFpbmVyLCAiZGJsY2xpY2siLCB0aGlzLl9vbkRibENsaWNrLCB0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMudGltZUdyaWRWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9kcmFnU3RhcnQgPSB0aGlzLmd1aWRlID0gbnVsbDsKICAgIH0sIG0ucHJvdG90eXBlLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSByLmdldENsYXNzKGUpOwogICAgICByZXR1cm4gbiA9PT0gby5jbGFzc25hbWUoInRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jay13cmFwIikgJiYgKGUgPSBlLnBhcmVudE5vZGUsIG4gPSByLmdldENsYXNzKGUpKSwgISghKHQgPSBuLm1hdGNoKG8udGltZS5nZXRWaWV3SURSZWdFeHApKSB8fCB0Lmxlbmd0aCA8IDIpICYmIGwucGljayh0aGlzLnRpbWVHcmlkVmlldy5jaGlsZHJlbi5pdGVtcywgdFsxXSk7CiAgICB9LCBtLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICB2YXIgbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gZS50YXJnZXQsCiAgICAgICAgICBhID0gdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGkpOwogICAgICBhICYmIChsID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGEoYSksIG8gPSB0aGlzLl9kcmFnU3RhcnQgPSBsKGUub3JpZ2luRXZlbnQpLCBuICYmIG4obyksIHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuZmlyZSh0IHx8ICJ0aW1lQ3JlYXRpb25EcmFnc3RhcnQiLCBvKSk7CiAgICB9LCBtLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwsCiAgICAgICAgICBvID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYzsKICAgICAgbyAmJiAobCA9IG8oZS5vcmlnaW5FdmVudCksIG4gJiYgbihsKSwgdGhpcy5maXJlKHQgfHwgInRpbWVDcmVhdGlvbkRyYWciLCBsKSk7CiAgICB9LCBtLnByb3RvdHlwZS5fY3JlYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGksCiAgICAgICAgICByID0gZS5yZWxhdGVkVmlldywKICAgICAgICAgIHMgPSBlLmNyZWF0ZVJhbmdlLAogICAgICAgICAgdSA9IGUubmVhcmVzdEdyaWRUaW1lWSwKICAgICAgICAgIGggPSBlLm5lYXJlc3RHcmlkRW5kVGltZVkgPyBlLm5lYXJlc3RHcmlkRW5kVGltZVkgOiBuZXcgZCh1KS5hZGRNaW51dGVzKDMwKTsKICAgICAgcyB8fCAocyA9IFt1LCBoXSksIHQgPSBuZXcgZChyLmdldERhdGUoKSksIG4gPSBhLnN0YXJ0KHQpLCBsID0gYS5nZXRTdGFydE9mTmV4dERheSh0KSwgbyA9IGMubGltaXREYXRlKHNbMF0sIG4sIGwpLCBpID0gYy5saW1pdERhdGUoc1sxXSwgbiwgbCksIHRoaXMuZmlyZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgaXNBbGxEYXk6ICExLAogICAgICAgIHN0YXJ0OiBuZXcgZChvKSwKICAgICAgICBlbmQ6IG5ldyBkKGkpLAogICAgICAgIGd1aWRlOiB0aGlzLmd1aWRlLAogICAgICAgIHRyaWdnZXJFdmVudE5hbWU6IGUudHJpZ2dlckV2ZW50CiAgICAgIH0pOwogICAgfSwgbS5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gdGhpcywKICAgICAgICAgIG4gPSB0aGlzLl9kcmFnU3RhcnQ7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCB0aGlzLl9vbkRyYWcoZSwgInRpbWVDcmVhdGlvbkRyYWdlbmQiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBsID0gW24ubmVhcmVzdEdyaWRUaW1lWSwgZS5uZWFyZXN0R3JpZFRpbWVZXS5zb3J0KGkuY29tcGFyZS5udW0uYXNjKTsKICAgICAgICBsWzFdLmFkZE1pbnV0ZXMoMzApLCBlLmNyZWF0ZVJhbmdlID0gbCwgdC5fY3JlYXRlU2NoZWR1bGUoZSk7CiAgICAgIH0pLCB0aGlzLl9kcmFnU3RhcnQgPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gbnVsbDsKICAgIH0sIG0ucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIG8gPSB0aGlzOwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgKHQgPSB0aGlzLmNoZWNrRXhwZWN0ZWRDb25kaXRpb24oZS50YXJnZXQpKSAmJiAhdGhpcy5fZGlzYWJsZUNsaWNrICYmIChuID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YSh0KSwgbCA9IG4oZS5vcmlnaW5FdmVudCksIHRoaXMuX3JlcXVlc3RPbkNsaWNrID0gITAsIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIG8uX3JlcXVlc3RPbkNsaWNrICYmIChvLmZpcmUoInRpbWVDcmVhdGlvbkNsaWNrIiwgbCksIG8uX2NyZWF0ZVNjaGVkdWxlKGwpKSwgby5fcmVxdWVzdE9uQ2xpY2sgPSAhMTsKICAgICAgfSwgcCksIHRoaXMuX2RyYWdTdGFydCA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSBudWxsKTsKICAgIH0sIG0ucHJvdG90eXBlLl9vbkRibENsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgICh0ID0gdGhpcy5jaGVja0V4cGVjdGVkQ29uZGl0aW9uKGUudGFyZ2V0KSkgJiYgKG4gPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhKHQpKGUpLCB0aGlzLmZpcmUoInRpbWVDcmVhdGlvbkNsaWNrIiwgbiksIHRoaXMuX2NyZWF0ZVNjaGVkdWxlKG4pLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICExKTsKICAgIH0sIG0ucHJvdG90eXBlLmludm9rZUNyZWF0aW9uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBvID0gdGhpcy50aW1lR3JpZFZpZXcub3B0aW9ucywKICAgICAgICAgIGkgPSBhLnJhbmdlKG8ucmVuZGVyU3RhcnREYXRlLCBvLnJlbmRlckVuZERhdGUsIGEuTUlMTElTRUNPTkRTX1BFUl9EQVkpLAogICAgICAgICAgciA9IG8uaG91clN0YXJ0LAogICAgICAgICAgcyA9IGUuc3RhcnQ7CiAgICAgIGwuZm9yRWFjaChpLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgIGEuaXNTYW1lRGF0ZShlLCBzKSAmJiAobiA9IHRoaXMudGltZUdyaWRWaWV3LmNoaWxkcmVuLnRvQXJyYXkoKVt0XSk7CiAgICAgIH0sIHRoaXMpLCBuIHx8IChuID0gdGhpcy50aW1lR3JpZFZpZXcuY2hpbGRyZW4udG9BcnJheSgpWzBdKSwgdCA9IHRoaXMuX3JldHJpdmVTY2hlZHVsZURhdGFGcm9tRGF0ZShuLCBlLnN0YXJ0LCBlLmVuZCwgciksIHRoaXMuZmlyZSgidGltZUNyZWF0aW9uQ2xpY2siLCB0KSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUodCk7CiAgICB9LCBoLm1peGluKG0pLCBsLkN1c3RvbUV2ZW50cy5taXhpbihtKSwgZS5leHBvcnRzID0gbTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oNSksCiAgICAgICAgICBvID0gbigzKSwKICAgICAgICAgIGkgPSBuKDIpLAogICAgICAgICAgYSA9IG4oMSksCiAgICAgICAgICByID0gbigxMSksCiAgICAgICAgICBzID0gbig1KS5yYXRpbywKICAgICAgICAgIGMgPSBuKDQpLkRhdGUsCiAgICAgICAgICB1ID0gNjAgKiBvLk1JTExJU0VDT05EU19QRVJfTUlOVVRFUzsKCiAgICAgIGZ1bmN0aW9uIGQoZSkgewogICAgICAgIHRoaXMuZ3VpZGVFbGVtZW50ID0gdC5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgdGhpcy5ndWlkZVRpbWVFbGVtZW50ID0gYS5hcHBlbmRIVE1MRWxlbWVudCgic3BhbiIsIHRoaXMuZ3VpZGVFbGVtZW50LCBpLmNsYXNzbmFtZSgidGltZS1ndWlkZS1jcmVhdGlvbi1sYWJlbCIpKSwgYS5hZGRDbGFzcyh0aGlzLmd1aWRlRWxlbWVudCwgaS5jbGFzc25hbWUoInRpbWUtZ3VpZGUtY3JlYXRpb24iKSksIHRoaXMudGltZUNyZWF0aW9uID0gZSwgdGhpcy5fc3R5bGVVbml0ID0gbnVsbCwgdGhpcy5fc3R5bGVTdGFydCA9IG51bGwsIHRoaXMuX3N0eWxlRnVuYyA9IG51bGwsIGUub24oewogICAgICAgICAgdGltZUNyZWF0aW9uRHJhZ3N0YXJ0OiB0aGlzLl9jcmVhdGVHdWlkZUVsZW1lbnQsCiAgICAgICAgICB0aW1lQ3JlYXRpb25EcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgICB0aW1lQ3JlYXRpb25DbGljazogdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50CiAgICAgICAgfSwgdGhpcyksIHRoaXMuYXBwbHlUaGVtZShlLmJhc2VDb250cm9sbGVyLnRoZW1lKTsKICAgICAgfQoKICAgICAgZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmNsZWFyR3VpZGVFbGVtZW50KCksIHRoaXMudGltZUNyZWF0aW9uLm9mZih0aGlzKSwgdGhpcy50aW1lQ3JlYXRpb24gPSB0aGlzLl9zdHlsZVVuaXQgPSB0aGlzLl9zdHlsZVN0YXJ0ID0gdGhpcy5fc3R5bGVGdW5jID0gdGhpcy5ndWlkZUVsZW1lbnQgPSB0aGlzLmd1aWRlVGltZUVsZW1lbnQgPSBudWxsOwogICAgICB9LCBkLnByb3RvdHlwZS5jbGVhckd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuZ3VpZGVFbGVtZW50LAogICAgICAgICAgICB0ID0gdGhpcy5ndWlkZVRpbWVFbGVtZW50OwogICAgICAgIGEucmVtb3ZlKGUpLCByLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiLCBlLnN0eWxlLnRvcCA9ICIiLCBlLnN0eWxlLmhlaWdodCA9ICIiLCB0LmlubmVySFRNTCA9ICIiOwogICAgICAgIH0pOwogICAgICB9LCBkLnByb3RvdHlwZS5fcmVmcmVzaEd1aWRlRWxlbWVudCA9IGZ1bmN0aW9uIChlLCB0LCBuLCBsLCByKSB7CiAgICAgICAgdmFyIHMgPSB0aGlzLmd1aWRlRWxlbWVudCwKICAgICAgICAgICAgYyA9IHRoaXMuZ3VpZGVUaW1lRWxlbWVudDsKICAgICAgICBzLnN0eWxlLnRvcCA9IGUgKyAicHgiLCBzLnN0eWxlLmhlaWdodCA9IHQgKyAicHgiLCBzLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCBjLmlubmVySFRNTCA9IG8uZm9ybWF0KG4sICJISDptbSIpICsgIiAtICIgKyBvLmZvcm1hdChsLCAiSEg6bW0iKSwgciA/IGEucmVtb3ZlQ2xhc3MoYywgaS5jbGFzc25hbWUoInRpbWUtZ3VpZGUtYm90dG9tIikpIDogYS5hZGRDbGFzcyhjLCBpLmNsYXNzbmFtZSgidGltZS1ndWlkZS1ib3R0b20iKSk7CiAgICAgIH0sIGQucHJvdG90eXBlLl9nZXRVbml0RGF0YSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBlLm9wdGlvbnMsCiAgICAgICAgICAgIG4gPSBlLmdldFZpZXdCb3VuZCgpLmhlaWdodCwKICAgICAgICAgICAgbCA9IHQuaG91ckVuZCAtIHQuaG91clN0YXJ0LAogICAgICAgICAgICBpID0gby5wYXJzZSh0LnltZCksCiAgICAgICAgICAgIGEgPSBvLmdldFN0YXJ0T2ZOZXh0RGF5KGkpOwogICAgICAgIHJldHVybiBpLnNldEhvdXJzKDAsIDAsIDAsIDApLCBpLnNldEhvdXJzKHQuaG91clN0YXJ0KSwgW24sIGwsIGksIGEsIG4gLyBsXTsKICAgICAgfSwgZC5wcm90b3R5cGUuX2xpbWl0U3R5bGVEYXRhID0gZnVuY3Rpb24gKGUsIHQsIG4sIG8pIHsKICAgICAgICB2YXIgaSA9IHRoaXMuX3N0eWxlVW5pdDsKICAgICAgICByZXR1cm4gW2UgPSBsLmxpbWl0KGUsIFswXSwgW2lbMF1dKSwgdCA9IGwubGltaXQoZSArIHQsIFswXSwgW2lbMF1dKSAtIGUsIG4gPSBsLmxpbWl0RGF0ZShuLCBpWzJdLCBpWzNdKSwgbyA9IGwubGltaXREYXRlKG8sIGlbMl0sIGlbM10pXTsKICAgICAgfSwgZC5wcm90b3R5cGUuX2dldFN0eWxlRGF0YUZ1bmMgPSBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgICAgIHZhciBpID0gbiwKICAgICAgICAgICAgYSA9IG8uZW5kKG4pOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICAgICAgdmFyIG8gPSBuLm5lYXJlc3RHcmlkWSwKICAgICAgICAgICAgICByID0gbi5uZWFyZXN0R3JpZFRpbWVZLAogICAgICAgICAgICAgIHUgPSBuLm5lYXJlc3RHcmlkRW5kVGltZVkgfHwgbmV3IGMocikuYWRkTWludXRlcygzMCk7CiAgICAgICAgICByZXR1cm4gW2wubGltaXQocyh0LCBlLCBvKSwgWzBdLCBbZV0pLCBsLmxpbWl0RGF0ZShyLCBpLCBhKSwgbC5saW1pdERhdGUodSwgaSwgYSldOwogICAgICAgIH07CiAgICAgIH0sIGQucHJvdG90eXBlLl9jcmVhdGVHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuLAogICAgICAgICAgICBsLAogICAgICAgICAgICBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByLAogICAgICAgICAgICBzLAogICAgICAgICAgICBkLAogICAgICAgICAgICBoID0gZS5yZWxhdGVkVmlldywKICAgICAgICAgICAgcCA9IG8ubWlsbGlzZWNvbmRzRnJvbSgiaG91ciIsIGUuaG91clN0YXJ0KSB8fCAwOwogICAgICAgIHQgPSB0aGlzLl9zdHlsZVVuaXQgPSB0aGlzLl9nZXRVbml0RGF0YShoKSwgbiA9IHRoaXMuX3N0eWxlRnVuYyA9IHRoaXMuX2dldFN0eWxlRGF0YUZ1bmMuYXBwbHkodGhpcywgdCksIGwgPSB0aGlzLl9zdHlsZVN0YXJ0ID0gbihlKSwgcyA9IG5ldyBjKGxbMV0pLmFkZE1pbnV0ZXMoby5taW51dGVzRnJvbUhvdXJzKHApKSwgZCA9IG5ldyBjKGxbMl0pLmFkZE1pbnV0ZXMoby5taW51dGVzRnJvbUhvdXJzKHApKSwgYSA9IGxbMF0sIHIgPSB0WzRdICogKGQgLSBzKSAvIHUsIGkgPSB0aGlzLl9saW1pdFN0eWxlRGF0YShhLCByLCBzLCBkKSwgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudC5hcHBseSh0aGlzLCBpKSwgaC5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5ndWlkZUVsZW1lbnQpOwogICAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbiwKICAgICAgICAgICAgbCwKICAgICAgICAgICAgbyA9IHRoaXMuX3N0eWxlRnVuYywKICAgICAgICAgICAgaSA9IHRoaXMuX3N0eWxlVW5pdCwKICAgICAgICAgICAgYSA9IHRoaXMuX3N0eWxlU3RhcnQsCiAgICAgICAgICAgIHMgPSB0aGlzLl9yZWZyZXNoR3VpZGVFbGVtZW50LmJpbmQodGhpcyk7CgogICAgICAgIG8gJiYgaSAmJiBhICYmICh0ID0gaVs0XSAvIDIsIChuID0gbyhlKSlbMF0gPiBhWzBdID8gbCA9IHRoaXMuX2xpbWl0U3R5bGVEYXRhKGFbMF0sIG5bMF0gLSBhWzBdICsgdCwgYVsxXSwgbmV3IGMoblsxXSkuYWRkTWludXRlcygzMCkpIDogKGwgPSB0aGlzLl9saW1pdFN0eWxlRGF0YShuWzBdLCBhWzBdIC0gblswXSArIHQsIG5bMV0sIG5ldyBjKGFbMV0pLmFkZE1pbnV0ZXMoMzApKSkucHVzaCghMCksIHIucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzLmFwcGx5KG51bGwsIGwpOwogICAgICAgIH0pKTsKICAgICAgfSwgZC5wcm90b3R5cGUuYXBwbHlUaGVtZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmd1aWRlRWxlbWVudC5zdHlsZSwKICAgICAgICAgICAgbiA9IHRoaXMuZ3VpZGVUaW1lRWxlbWVudC5zdHlsZTsKICAgICAgICB0LmJhY2tncm91bmRDb2xvciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYmFja2dyb3VuZENvbG9yLCB0LmJvcmRlciA9IGUuY29tbW9uLmNyZWF0aW9uR3VpZGUuYm9yZGVyLCBuLmNvbG9yID0gZS53ZWVrLmNyZWF0aW9uR3VpZGUuY29sb3IsIG4uZm9udFNpemUgPSBlLndlZWsuY3JlYXRpb25HdWlkZS5mb250U2l6ZSwgbi5mb250V2VpZ2h0ID0gZS53ZWVrLmNyZWF0aW9uR3VpZGUuZm9udFdlaWdodDsKICAgICAgfSwgZS5leHBvcnRzID0gZDsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oNiksCiAgICAgICAgcyA9IG4oNCkuRGF0ZSwKICAgICAgICBjID0gbigxOCksCiAgICAgICAgdSA9IG4oOTMpOwoKICAgIGZ1bmN0aW9uIGQoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy50aW1lR3JpZFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwsIHRoaXMuX2RyYWdTdGFydCA9IG51bGwsIHRoaXMuX2d1aWRlID0gbmV3IHUodGhpcyksIGUub24oImRyYWdTdGFydCIsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKSwgZS5vbigibW91c2Vkb3duIiwgdGhpcy5fb25Nb3VzZURvd24sIHRoaXMpOwogICAgfQoKICAgIGQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuX2d1aWRlLmRlc3Ryb3koKSwgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZHJhZ0hhbmRsZXIgPSB0aGlzLnRpbWVHcmlkVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fZHJhZ1N0YXJ0ID0gdGhpcy5fZ3VpZGUgPSBudWxsOwogICAgfSwgZC5wcm90b3R5cGUuY2hlY2tFeHBlY3RDb25kaXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gISFhLmNsb3Nlc3QoZSwgby5jbGFzc25hbWUoIi50aW1lLXNjaGVkdWxlIikpICYmIHRoaXMuX2dldFRpbWVWaWV3KGUpOwogICAgfSwgZC5wcm90b3R5cGUuX2dldFRpbWVWaWV3ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gYS5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlIikpOwogICAgICByZXR1cm4gISFuICYmICEoISh0ID0gYS5nZXRDbGFzcyhuKS5tYXRjaChvLnRpbWUuZ2V0Vmlld0lEUmVnRXhwKSkgfHwgdC5sZW5ndGggPCAyKSAmJiBsLnBpY2sodGhpcy50aW1lR3JpZFZpZXcuY2hpbGRyZW4uaXRlbXMsIE51bWJlcih0WzFdKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGUudGFyZ2V0LAogICAgICAgICAgbiA9IHRoaXMuY2hlY2tFeHBlY3RDb25kaXRpb24odCksCiAgICAgICAgICBpID0gYS5jbG9zZXN0KHQsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrIikpOwogICAgICBuICYmIGkgJiYgbC5icm93c2VyLmZpcmVmb3ggJiYgci5wcmV2ZW50RGVmYXVsdChlLm9yaWdpbkV2ZW50KTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBpLAogICAgICAgICAgciA9IGUudGFyZ2V0LAogICAgICAgICAgcyA9IHRoaXMuY2hlY2tFeHBlY3RDb25kaXRpb24ociksCiAgICAgICAgICBjID0gYS5jbG9zZXN0KHIsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrIikpLAogICAgICAgICAgdSA9IHRoaXMuYmFzZUNvbnRyb2xsZXI7CiAgICAgIHMgJiYgYyAmJiAobCA9IGEuZ2V0RGF0YShjLCAiaWQiKSwgKGkgPSB1LnNjaGVkdWxlcy5pdGVtc1tsXSkuaXNSZWFkT25seSB8fCAodCA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9yZXRyaXZlU2NoZWR1bGVEYXRhKHMpLCBuID0gdGhpcy5fZHJhZ1N0YXJ0ID0gdChlLm9yaWdpbkV2ZW50LCB7CiAgICAgICAgdGFyZ2V0TW9kZWxJRDogbCwKICAgICAgICBtb2RlbDogaQogICAgICB9KSwgdGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgdGhpcy5maXJlKCJ0aW1lTW92ZURyYWdzdGFydCIsIG4pKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwsCiAgICAgICAgICBvID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgIGkgPSB0aGlzLl9nZXRUaW1lVmlldyhlLnRhcmdldCksCiAgICAgICAgICBhID0gdGhpcy5fZHJhZ1N0YXJ0OwoKICAgICAgaSAmJiBvICYmIGEgJiYgKGwgPSBvKGUub3JpZ2luRXZlbnQsIHsKICAgICAgICBjdXJyZW50VmlldzogaSwKICAgICAgICB0YXJnZXRNb2RlbElEOiBhLnRhcmdldE1vZGVsSUQKICAgICAgfSksIG4gJiYgbihsKSwgdGhpcy5maXJlKHQgfHwgInRpbWVNb3ZlRHJhZyIsIGwpKTsKICAgIH0sIGQucHJvdG90eXBlLl91cGRhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwgPSB0aGlzLmJhc2VDb250cm9sbGVyLAogICAgICAgICAgbyA9IGUudGFyZ2V0TW9kZWxJRCwKICAgICAgICAgIGEgPSBlLm5lYXJlc3RSYW5nZSwKICAgICAgICAgIHIgPSBhWzFdIC0gYVswXSwKICAgICAgICAgIGMgPSAwLAogICAgICAgICAgdSA9IGwuc2NoZWR1bGVzLml0ZW1zW29dLAogICAgICAgICAgZCA9IGUucmVsYXRlZFZpZXcsCiAgICAgICAgICBoID0gZS5jdXJyZW50VmlldzsKICAgICAgdSAmJiBoICYmIChyIC09IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIDMwKSwgdCA9IG5ldyBzKHUuZ2V0U3RhcnRzKCkpLmFkZE1pbGxpc2Vjb25kcyhyKSwgbiA9IG5ldyBzKHUuZ2V0RW5kcygpKS5hZGRNaWxsaXNlY29uZHMociksIGggJiYgKGMgPSBoLmdldERhdGUoKSAtIGQuZ2V0RGF0ZSgpKSwgdC5hZGRNaWxsaXNlY29uZHMoYyksIG4uYWRkTWlsbGlzZWNvbmRzKGMpLCB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiB1LAogICAgICAgIGNoYW5nZXM6IHsKICAgICAgICAgIHN0YXJ0OiB0LAogICAgICAgICAgZW5kOiBuCiAgICAgICAgfSwKICAgICAgICBzdGFydDogdCwKICAgICAgICBlbmQ6IG4KICAgICAgfSkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICBsID0gdGhpcy5fZ2V0VGltZVZpZXcoZS50YXJnZXQpLAogICAgICAgICAgbyA9IHRoaXMuX2RyYWdTdGFydDsKCiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kLAogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpLCBuICYmIG8gJiYgKCh0ID0gbihlLm9yaWdpbkV2ZW50LCB7CiAgICAgICAgY3VycmVudFZpZXc6IGwsCiAgICAgICAgdGFyZ2V0TW9kZWxJRDogby50YXJnZXRNb2RlbElECiAgICAgIH0pKS5yYW5nZSA9IFtvLnRpbWVZLCBuZXcgcyh0LnRpbWVZKS5hZGRNaW51dGVzKDMwKV0sIHQubmVhcmVzdFJhbmdlID0gW28ubmVhcmVzdEdyaWRUaW1lWSwgbmV3IHModC5uZWFyZXN0R3JpZFRpbWVZKS5hZGRNaW51dGVzKDMwKV0sIHRoaXMuX3VwZGF0ZVNjaGVkdWxlKHQpLCB0aGlzLmZpcmUoInRpbWVNb3ZlRHJhZ2VuZCIsIHQpKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgIGwgPSB0aGlzLl9kcmFnU3RhcnQ7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kLAogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpLCBuICYmIGwgJiYgKHQgPSBuKGUub3JpZ2luRXZlbnQsIHsKICAgICAgICB0YXJnZXRNb2RlbElEOiBsLnRhcmdldE1vZGVsSUQKICAgICAgfSksIHRoaXMuZmlyZSgidGltZU1vdmVDbGljayIsIHQpKTsKICAgIH0sIGMubWl4aW4oZCksIGwuQ3VzdG9tRXZlbnRzLm1peGluKGQpLCBlLmV4cG9ydHMgPSBkOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsID0gbigwKSwKICAgICAgICAgIG8gPSBuKDIpLAogICAgICAgICAgaSA9IG4oMSksCiAgICAgICAgICBhID0gbigxMSksCiAgICAgICAgICByID0gbig1KS5yYXRpbywKICAgICAgICAgIHMgPSBuKDE2KSwKICAgICAgICAgIGMgPSBuKDk0KSwKICAgICAgICAgIHUgPSBuKDQpLkRhdGUsCiAgICAgICAgICBkID0gbigxNCksCiAgICAgICAgICBoID0gbigzKSwKICAgICAgICAgIHAgPSBuKDUpLAogICAgICAgICAgbSA9IGguTUlMTElTRUNPTkRTX1NDSEVEVUxFX01JTl9EVVJBVElPTjsKCiAgICAgIGZ1bmN0aW9uIGYoZSkgewogICAgICAgIHRoaXMuX2d1aWRlTGF5ZXIgPSBudWxsLCB0aGlzLl9tb2RlbCA9IG51bGwsIHRoaXMuX3ZpZXdNb2RlbCA9IG51bGwsIHRoaXMuX2xhc3REcmFnID0gbnVsbCwgdGhpcy5ndWlkZUVsZW1lbnQgPSBudWxsLCB0aGlzLnRpbWVNb3ZlID0gZSwgdGhpcy5fY29udGFpbmVyID0gbnVsbCwgdGhpcy5fZ2V0VG9wRnVuYyA9IG51bGwsIHRoaXMuX3N0YXJ0R3JpZFkgPSAwLCB0aGlzLl9zdGFydFRvcFBpeGVsID0gMCwgZS5vbih7CiAgICAgICAgICB0aW1lTW92ZURyYWdzdGFydDogdGhpcy5fb25EcmFnU3RhcnQsCiAgICAgICAgICB0aW1lTW92ZURyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIHRpbWVNb3ZlRHJhZ2VuZDogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQsCiAgICAgICAgICB0aW1lTW92ZUNsaWNrOiB0aGlzLl9jbGVhckd1aWRlRWxlbWVudAogICAgICAgIH0sIHRoaXMpOwogICAgICB9CgogICAgICBmLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2NsZWFyR3VpZGVFbGVtZW50KCksIHRoaXMudGltZU1vdmUub2ZmKHRoaXMpLCB0aGlzLl9ndWlkZUxheWVyICYmIHRoaXMuX2d1aWRlTGF5ZXIuZGVzdHJveSgpLCB0aGlzLmd1aWRlRWxlbWVudCA9IHRoaXMudGltZU1vdmUgPSB0aGlzLl9jb250YWluZXIgPSB0aGlzLl9ndWlkZUxheWVyID0gdGhpcy5fbGFzdERyYWcgPSB0aGlzLl9nZXRUb3BGdW5jID0gdGhpcy5fc3RhcnRHcmlkWSA9IHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSB0aGlzLl92aWV3TW9kZWwgPSBudWxsOwogICAgICB9LCBmLnByb3RvdHlwZS5fY2xlYXJHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgbC5icm93c2VyLm1zaWUgfHwgaS5yZW1vdmVDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJkcmFnZ2luZyIpKSwgdGhpcy5fZ3VpZGVMYXllciAmJiB0aGlzLl9ndWlkZUxheWVyLmRlc3Ryb3koKSwgdGhpcy5fc2hvd09yaWdpblNjaGVkdWxlQmxvY2tzKCksIHRoaXMuZ3VpZGVFbGVtZW50ID0gdGhpcy5fZ2V0VG9wRnVuYyA9IHRoaXMuX2d1aWRlTGF5ZXIgPSB0aGlzLl9tb2RlbCA9IHRoaXMuX2xhc3REcmFnID0gdGhpcy5fc3RhcnRHcmlkWSA9IHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSB0aGlzLl92aWV3TW9kZWwgPSBudWxsOwogICAgICB9LCBmLnByb3RvdHlwZS5faGlkZU9yaWdpblNjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlID0gby5jbGFzc25hbWUoInRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jay1kcmFnZ2luZy1kaW0iKTsKICAgICAgICB0aGlzLmd1aWRlRWxlbWVudCAmJiBpLmFkZENsYXNzKHRoaXMuZ3VpZGVFbGVtZW50LCBlKTsKICAgICAgfSwgZi5wcm90b3R5cGUuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IG8uY2xhc3NuYW1lKCJ0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIik7CiAgICAgICAgdGhpcy5ndWlkZUVsZW1lbnQgJiYgaS5yZW1vdmVDbGFzcyh0aGlzLmd1aWRlRWxlbWVudCwgZSk7CiAgICAgIH0sIGYucHJvdG90eXBlLl9yZWZyZXNoR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbyA9IHRoaXM7CiAgICAgICAgYS5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG8uX2d1aWRlTGF5ZXIgJiYgKG8uX2d1aWRlTGF5ZXIuc2V0UG9zaXRpb24oMCwgZSksIG8uX2d1aWRlTGF5ZXIuc2V0Q29udGVudChjKGwuZXh0ZW5kKHsKICAgICAgICAgICAgbW9kZWw6IHQKICAgICAgICAgIH0sIG4pKSkpOwogICAgICAgIH0pOwogICAgICB9LCBmLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuLAogICAgICAgICAgICBhLAogICAgICAgICAgICByLAogICAgICAgICAgICBzID0gaS5jbG9zZXN0KGUudGFyZ2V0LCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKTsKICAgICAgICBzICYmICh0aGlzLl9zdGFydFRvcFBpeGVsID0gcGFyc2VGbG9hdChzLnN0eWxlLnRvcCksIHRoaXMuX3N0YXJ0R3JpZFkgPSBlLm5lYXJlc3RHcmlkWSwgdGhpcy5ndWlkZUVsZW1lbnQgPSBzLCB0aGlzLl9jb250YWluZXIgPSBlLnJlbGF0ZWRWaWV3LmNvbnRhaW5lciwgdGhpcy5fbW9kZWwgPSBsLmV4dGVuZChkLmNyZWF0ZShlLm1vZGVsKSwgZS5tb2RlbCksIG4gPSAobiA9IHRoaXMuX21vZGVsLmR1cmF0aW9uKCkpID4gbSA/IG4gOiBtLCB0ID0gKGEgPSBoLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCB0aGlzLl9tb2RlbC5nb2luZ0R1cmF0aW9uKSkgKyBuICsgKHIgPSBoLm1pbGxpc2Vjb25kc0Zyb20oIm1pbnV0ZXMiLCB0aGlzLl9tb2RlbC5jb21pbmdEdXJhdGlvbikpLCB0aGlzLl9sYXN0RHJhZyA9IGUsIHRoaXMuX3ZpZXdNb2RlbCA9IHsKICAgICAgICAgIGhhc0dvaW5nRHVyYXRpb246IGEgPiAwLAogICAgICAgICAgaGFzQ29taW5nRHVyYXRpb246IHIgPiAwLAogICAgICAgICAgZ29pbmdEdXJhdGlvbkhlaWdodDogcC5yYXRpbyh0LCBhLCAxMDApLAogICAgICAgICAgbW9kZWxEdXJhdGlvbkhlaWdodDogcC5yYXRpbyh0LCBuLCAxMDApLAogICAgICAgICAgY29taW5nRHVyYXRpb25IZWlnaHQ6IHAucmF0aW8odCwgciwgMTAwKQogICAgICAgIH0sIHRoaXMuX3Jlc2V0R3VpZGVMYXllcigpLCB0aGlzLl9oaWRlT3JpZ2luU2NoZWR1bGVCbG9ja3MoKSk7CiAgICAgIH0sIGYucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBhLAogICAgICAgICAgICBzID0gZS5jdXJyZW50VmlldywKICAgICAgICAgICAgYyA9IHMub3B0aW9ucywKICAgICAgICAgICAgZCA9IHMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LAogICAgICAgICAgICBwID0gcGFyc2VGbG9hdCh0aGlzLmd1aWRlRWxlbWVudC5zdHlsZS5oZWlnaHQpLAogICAgICAgICAgICBtID0gYy5ob3VyRW5kIC0gYy5ob3VyU3RhcnQsCiAgICAgICAgICAgIGYgPSBlLm5lYXJlc3RHcmlkWSAtIHRoaXMuX3N0YXJ0R3JpZFksCiAgICAgICAgICAgIGcgPSByKG0sIGQsIGYpLAogICAgICAgICAgICB5ID0gZS5uZWFyZXN0R3JpZFkgLSB0aGlzLl9sYXN0RHJhZy5uZWFyZXN0R3JpZFk7CiAgICAgICAgbC5icm93c2VyLm1zaWUgfHwgaS5hZGRDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJkcmFnZ2luZyIpKSwgdGhpcy5fY29udGFpbmVyICE9PSBzLmNvbnRhaW5lciAmJiAodGhpcy5fY29udGFpbmVyID0gcy5jb250YWluZXIsIHRoaXMuX3Jlc2V0R3VpZGVMYXllcigpKSwgYSA9IHRoaXMuX3N0YXJ0VG9wUGl4ZWwgKyBnLCBuID0gZCAtIHAsIGEgPSBNYXRoLm1heChhLCAwKSwgYSA9IE1hdGgubWluKGEsIG4pLCB0aGlzLl9tb2RlbC5zdGFydCA9IG5ldyB1KHRoaXMuX21vZGVsLmdldFN0YXJ0cygpKS5hZGRNaW51dGVzKGgubWludXRlc0Zyb21Ib3Vycyh5KSksIHRoaXMuX21vZGVsLmVuZCA9IG5ldyB1KHRoaXMuX21vZGVsLmdldEVuZHMoKSkuYWRkTWludXRlcyhoLm1pbnV0ZXNGcm9tSG91cnMoeSkpLCB0aGlzLl9sYXN0RHJhZyA9IGUsIHRoaXMuX3JlZnJlc2hHdWlkZUVsZW1lbnQoYSwgdGhpcy5fbW9kZWwsIHRoaXMuX3ZpZXdNb2RlbCk7CiAgICAgIH0sIGYucHJvdG90eXBlLl9yZXNldEd1aWRlTGF5ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fZ3VpZGVMYXllciAmJiAodGhpcy5fZ3VpZGVMYXllci5kZXN0cm95KCksIHRoaXMuX2d1aWRlTGF5ZXIgPSBudWxsKSwgdGhpcy5fZ3VpZGVMYXllciA9IG5ldyBzKG51bGwsIHRoaXMuX2NvbnRhaW5lciksIHRoaXMuX2d1aWRlTGF5ZXIuc2V0U2l6ZSh0aGlzLl9jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGgsIHRoaXMuZ3VpZGVFbGVtZW50LnN0eWxlLmhlaWdodCksIHRoaXMuX2d1aWRlTGF5ZXIuc2V0UG9zaXRpb24oMCwgdGhpcy5ndWlkZUVsZW1lbnQuc3R5bGUudG9wKSwgdGhpcy5fZ3VpZGVMYXllci5zZXRDb250ZW50KGMobC5leHRlbmQoewogICAgICAgICAgbW9kZWw6IHRoaXMuX21vZGVsCiAgICAgICAgfSwgdGhpcy5fdmlld01vZGVsKSkpLCB0aGlzLl9ndWlkZUxheWVyLnNob3coKTsKICAgICAgfSwgZS5leHBvcnRzID0gZjsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAyNAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAidGltZS1zY2hlZHVsZS1jb250ZW50ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1zY2hlZHVsZS1jb250ZW50LXRyYXZlbC10aW1lIiBzdHlsZT0iYm9yZGVyLWNvbG9yOicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItYm90dG9tOiAxcHggZGFzaGVkICIgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBoZWlnaHQ6ICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgImdvaW5nRHVyYXRpb25IZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiZ29pbmdEdXJhdGlvbkhlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJnb2luZ0R1cmF0aW9uSGVpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAyMDMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDIyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICclOyI+JyArIChudWxsICE9IChpID0gKGQobiwgImdvaW5nRHVyYXRpb24tdG1wbCIpIHx8IHQgJiYgZCh0LCAiZ29pbmdEdXJhdGlvbi10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImdvaW5nRHVyYXRpb24tdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjMwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiAyNjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4iOwogICAgICB9LAogICAgICAzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ0aW1lLXNjaGVkdWxlLWNvbnRlbnQgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA2MAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDc0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtc2NoZWR1bGUtY29udGVudC10cmF2ZWwtdGltZSIgc3R5bGU9ImJvcmRlci1jb2xvcjonICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjsgYm9yZGVyLXRvcDogMXB4IGRhc2hlZCAiICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgaGVpZ2h0OiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJjb21pbmdEdXJhdGlvbkhlaWdodCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJjb21pbmdEdXJhdGlvbkhlaWdodCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb21pbmdEdXJhdGlvbkhlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDIwMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDIyNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICclOyI+JyArIChudWxsICE9IChpID0gKGQobiwgImNvbWluZ0R1cmF0aW9uLXRtcGwiKSB8fCB0ICYmIGQodCwgImNvbWluZ0R1cmF0aW9uLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiY29taW5nRHVyYXRpb24tdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDIyOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDI1OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA1MgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICd0aW1lLXJlc2l6ZS1oYW5kbGUgaGFuZGxlLXgiPiZuYnNwOzwvZGl2Pic7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICB1ID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBkID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGggPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIgZGF0YS1pZD0iJyArIHUoKGgobiwgInN0YW1wIikgfHwgdCAmJiBoKHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDc2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnIiBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsiPlxuICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgInRpbWUtc2NoZWR1bGUgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiA0NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyLAogICAgICAgICAgICAgIGNvbHVtbjogNTgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAndGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLWZvY3VzZWQiIHN0eWxlPSJjb2xvcjogI2ZmZmZmZjsgYmFja2dyb3VuZC1jb2xvcjonICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJkcmFnQmdDb2xvciIpIDogaSwgdCkpICsgJzsiPlxuJyArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGgodCwgImhhc0dvaW5nRHVyYXRpb24iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDE1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMjQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3RpbWUtc2NoZWR1bGUtY29udGVudCIgc3R5bGU9ImhlaWdodDogJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIm1vZGVsRHVyYXRpb25IZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAibW9kZWxEdXJhdGlvbkhlaWdodCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJtb2RlbER1cmF0aW9uSGVpZ2h0IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiA3NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogOTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgYm9yZGVyLWNvbG9yOiIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAnOyI+XG4gICAgICAgICAgICAgICAgJyArIChudWxsICE9IChpID0gKGgobiwgInRpbWUtdG1wbCIpIHx8IHQgJiYgaCh0LCAidGltZS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICAgICAgPC9kaXY+XG4iICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaGFzQ29taW5nRHVyYXRpb24iKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgPC9kaXY+XG4gICAgIiArIChudWxsICE9IChpID0gaChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJjcm9wcGVkRW5kIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnXG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd0aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2stY292ZXIiPjwvZGl2PlxuPC9kaXY+XG4nOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oNCkuRGF0ZSwKICAgICAgICBzID0gbig1KSwKICAgICAgICBjID0gbigxOCksCiAgICAgICAgdSA9IG4oOTYpOwoKICAgIGZ1bmN0aW9uIGQoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy50aW1lR3JpZFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IG51bGwsIHRoaXMuX2RyYWdTdGFydCA9IG51bGwsIHRoaXMuX2d1aWRlID0gbmV3IHUodGhpcyksIGUub24oImRyYWdTdGFydCIsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKTsKICAgIH0KCiAgICBkLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9ndWlkZS5kZXN0cm95KCksIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmRyYWdIYW5kbGVyID0gdGhpcy50aW1lR3JpZFZpZXcgPSB0aGlzLmJhc2VDb250cm9sbGVyID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYyA9IHRoaXMuX2RyYWdTdGFydCA9IHRoaXMuX2d1aWRlID0gbnVsbDsKICAgIH0sIGQucHJvdG90eXBlLmNoZWNrRXhwZWN0Q29uZGl0aW9uID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsIG47CiAgICAgIHJldHVybiAhIWEuaGFzQ2xhc3MoZSwgby5jbGFzc25hbWUoInRpbWUtcmVzaXplLWhhbmRsZSIpKSAmJiAhISh0ID0gYS5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIudGltZS1kYXRlIikpKSAmJiAhKCEobiA9IGEuZ2V0Q2xhc3ModCkubWF0Y2goby50aW1lLmdldFZpZXdJRFJlZ0V4cCkpIHx8IG4ubGVuZ3RoIDwgMikgJiYgbC5waWNrKHRoaXMudGltZUdyaWRWaWV3LmNoaWxkcmVuLml0ZW1zLCBOdW1iZXIoblsxXSkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbCwKICAgICAgICAgIGkgPSBlLnRhcmdldCwKICAgICAgICAgIHIgPSB0aGlzLmNoZWNrRXhwZWN0Q29uZGl0aW9uKGkpLAogICAgICAgICAgcyA9IGEuY2xvc2VzdChpLCBvLmNsYXNzbmFtZSgiLnRpbWUtZGF0ZS1zY2hlZHVsZS1ibG9jayIpKSwKICAgICAgICAgIGMgPSB0aGlzLmJhc2VDb250cm9sbGVyOwogICAgICByICYmIHMgJiYgKHQgPSBhLmdldERhdGEocywgImlkIiksIG4gPSB0aGlzLl9nZXRTY2hlZHVsZURhdGFGdW5jID0gdGhpcy5fcmV0cml2ZVNjaGVkdWxlRGF0YShyKSwgbCA9IHRoaXMuX2RyYWdTdGFydCA9IG4oZS5vcmlnaW5FdmVudCwgewogICAgICAgIHRhcmdldE1vZGVsSUQ6IHQsCiAgICAgICAgc2NoZWR1bGU6IGMuc2NoZWR1bGVzLml0ZW1zW3RdCiAgICAgIH0pLCB0aGlzLmRyYWdIYW5kbGVyLm9uKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kLAogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpLCB0aGlzLmZpcmUoInRpbWVSZXNpemVEcmFnc3RhcnQiLCBsKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGwsCiAgICAgICAgICBvID0gdGhpcy5fZ2V0U2NoZWR1bGVEYXRhRnVuYywKICAgICAgICAgIGkgPSB0aGlzLl9kcmFnU3RhcnQ7CiAgICAgIG8gJiYgaSAmJiAobCA9IG8oZS5vcmlnaW5FdmVudCwgewogICAgICAgIHRhcmdldE1vZGVsSUQ6IGkudGFyZ2V0TW9kZWxJRAogICAgICB9KSwgbiAmJiBuKGwpLCB0aGlzLmZpcmUodCB8fCAidGltZVJlc2l6ZURyYWciLCBsKSk7CiAgICB9LCBkLnByb3RvdHlwZS5fdXBkYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbywKICAgICAgICAgIGEgPSB0aGlzLmJhc2VDb250cm9sbGVyLAogICAgICAgICAgYyA9IGUudGFyZ2V0TW9kZWxJRCwKICAgICAgICAgIHUgPSBlLm5lYXJlc3RSYW5nZSwKICAgICAgICAgIGQgPSB1WzFdIC0gdVswXSwKICAgICAgICAgIGggPSBhLnNjaGVkdWxlcy5pdGVtc1tjXSwKICAgICAgICAgIHAgPSBlLnJlbGF0ZWRWaWV3OwogICAgICBoICYmIChkIC09IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIDMwKSwgbCA9IG5ldyByKHAuZ2V0RGF0ZSgpKSwgdCA9IGkuZW5kKGwpLCAobiA9IG5ldyByKGguZ2V0RW5kcygpKS5hZGRNaWxsaXNlY29uZHMoZCkpID4gdCAmJiAobiA9IG5ldyByKHQpKSwgbi5nZXRUaW1lKCkgLSBoLmdldFN0YXJ0cygpLmdldFRpbWUoKSA8IGkubWlsbGlzZWNvbmRzRnJvbSgibWludXRlcyIsIDMwKSAmJiAobiA9IG5ldyByKGguZ2V0U3RhcnRzKCkpLmFkZE1pbnV0ZXMoMzApKSwgbyA9IHMuZ2V0U2NoZWR1bGVDaGFuZ2VzKGgsIFsiZW5kIl0sIHsKICAgICAgICBlbmQ6IG4KICAgICAgfSksIHRoaXMuZmlyZSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IGgsCiAgICAgICAgY2hhbmdlczogbywKICAgICAgICBzdGFydDogaC5nZXRTdGFydHMoKSwKICAgICAgICBlbmQ6IG4KICAgICAgfSkpOwogICAgfSwgZC5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMsCiAgICAgICAgICBsID0gdGhpcy5fZHJhZ1N0YXJ0OwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgbiAmJiBsICYmICgodCA9IG4oZS5vcmlnaW5FdmVudCwgewogICAgICAgIHRhcmdldE1vZGVsSUQ6IGwudGFyZ2V0TW9kZWxJRAogICAgICB9KSkucmFuZ2UgPSBbbC50aW1lWSwgbmV3IHIodC50aW1lWSkuYWRkTWludXRlcygzMCldLCB0Lm5lYXJlc3RSYW5nZSA9IFtsLm5lYXJlc3RHcmlkVGltZVksIHQubmVhcmVzdEdyaWRUaW1lWS5hZGRNaW51dGVzKDMwKV0sIHRoaXMuX3VwZGF0ZVNjaGVkdWxlKHQpLCB0aGlzLmZpcmUoInRpbWVSZXNpemVEcmFnZW5kIiwgdCksIHRoaXMuX2dldFNjaGVkdWxlRGF0YUZ1bmMgPSB0aGlzLl9kcmFnU3RhcnQgPSBudWxsKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBjbGljazogdGhpcy5fb25DbGljawogICAgICB9LCB0aGlzKSwgdGhpcy5maXJlKCJ0aW1lUmVzaXplQ2xpY2siKTsKICAgIH0sIGMubWl4aW4oZCksIGwuQ3VzdG9tRXZlbnRzLm1peGluKGQpLCBlLmV4cG9ydHMgPSBkOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBsID0gbigwKSwKICAgICAgICAgIG8gPSBuKDIpLAogICAgICAgICAgaSA9IG4oMSksCiAgICAgICAgICBhID0gbigxMSksCiAgICAgICAgICByID0gbig1KS5yYXRpbywKICAgICAgICAgIHMgPSBuKDMpOwoKICAgICAgZnVuY3Rpb24gYyhlKSB7CiAgICAgICAgdGhpcy5ndWlkZUVsZW1lbnQgPSBudWxsLCB0aGlzLnRpbWVSZXNpemUgPSBlLCB0aGlzLl9nZXRUb3BGdW5jID0gbnVsbCwgdGhpcy5fb3JpZ2luU2NoZWR1bGVFbGVtZW50ID0gbnVsbCwgdGhpcy5fc3RhcnRUb3BQaXhlbCA9IDAsIHRoaXMuX3N0YXJ0SGVpZ2h0UGl4ZWwgPSAwLCB0aGlzLl9zdGFydEdyaWRZID0gMCwgdGhpcy5fc2NoZWR1bGUgPSBudWxsLCBlLm9uKHsKICAgICAgICAgIHRpbWVSZXNpemVEcmFnc3RhcnQ6IHRoaXMuX29uRHJhZ1N0YXJ0LAogICAgICAgICAgdGltZVJlc2l6ZURyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIHRpbWVSZXNpemVEcmFnZW5kOiB0aGlzLl9jbGVhckd1aWRlRWxlbWVudCwKICAgICAgICAgIHRpbWVSZXNpemVDbGljazogdGhpcy5fY2xlYXJHdWlkZUVsZW1lbnQKICAgICAgICB9LCB0aGlzKTsKICAgICAgfQoKICAgICAgYy5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jbGVhckd1aWRlRWxlbWVudCgpLCB0aGlzLnRpbWVSZXNpemUub2ZmKHRoaXMpLCB0aGlzLmd1aWRlRWxlbWVudCA9IHRoaXMudGltZVJlc2l6ZSA9IHRoaXMuX2dldFRvcEZ1bmMgPSB0aGlzLl9vcmlnaW5TY2hlZHVsZUVsZW1lbnQgPSB0aGlzLl9zdGFydEhlaWdodFBpeGVsID0gdGhpcy5fc3RhcnRHcmlkWSA9IHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSBudWxsOwogICAgICB9LCBjLnByb3RvdHlwZS5fY2xlYXJHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLmd1aWRlRWxlbWVudCwKICAgICAgICAgICAgbiA9IHRoaXMuX29yaWdpblNjaGVkdWxlRWxlbWVudDsKICAgICAgICBsLmJyb3dzZXIubXNpZSB8fCBpLnJlbW92ZUNsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoInJlc2l6aW5nIikpLCBuICYmIChuLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKSwgaS5yZW1vdmUoZSksIHRoaXMuZ3VpZGVFbGVtZW50ID0gdGhpcy5fZ2V0VG9wRnVuYyA9IHRoaXMuX29yaWdpblNjaGVkdWxlRWxlbWVudCA9IHRoaXMuX3N0YXJ0SGVpZ2h0UGl4ZWwgPSB0aGlzLl9zdGFydEdyaWRZID0gdGhpcy5fc3RhcnRUb3BQaXhlbCA9IG51bGw7CiAgICAgIH0sIGMucHJvdG90eXBlLl9yZWZyZXNoR3VpZGVFbGVtZW50ID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgICB2YXIgbCwKICAgICAgICAgICAgciA9IHRoaXMuZ3VpZGVFbGVtZW50OwogICAgICAgIHIgJiYgKGwgPSBpLmZpbmQoby5jbGFzc25hbWUoIi50aW1lLXNjaGVkdWxlLWNvbnRlbnQtdGltZSIpLCByKSwgYS5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHIuc3R5bGUuaGVpZ2h0ID0gZSArICJweCIsIHIuc3R5bGUuZGlzcGxheSA9ICJibG9jayIsIGwgJiYgKGwuc3R5bGUuaGVpZ2h0ID0gbiArICJweCIsIGwuc3R5bGUubWluSGVpZ2h0ID0gdCArICJweCIpOwogICAgICAgIH0pKTsKICAgICAgfSwgYy5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgYSA9IGkuY2xvc2VzdChlLnRhcmdldCwgby5jbGFzc25hbWUoIi50aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2siKSksCiAgICAgICAgICAgIHIgPSBlLnNjaGVkdWxlOwogICAgICAgIGwuYnJvd3Nlci5tc2llIHx8IGkuYWRkQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgicmVzaXppbmciKSksIGEgJiYgciAmJiAodGhpcy5fc3RhcnRHcmlkWSA9IGUubmVhcmVzdEdyaWRZLCB0aGlzLl9zdGFydEhlaWdodFBpeGVsID0gcGFyc2VGbG9hdChhLnN0eWxlLmhlaWdodCksIHRoaXMuX3N0YXJ0VG9wUGl4ZWwgPSBwYXJzZUZsb2F0KGEuc3R5bGUudG9wKSwgdGhpcy5fb3JpZ2luU2NoZWR1bGVFbGVtZW50ID0gYSwgdGhpcy5fc2NoZWR1bGUgPSByLCBuID0gdGhpcy5ndWlkZUVsZW1lbnQgPSBhLmNsb25lTm9kZSghMCksIGkuYWRkQ2xhc3Mobiwgby5jbGFzc25hbWUoInRpbWUtZ3VpZGUtcmVzaXplIikpLCBhLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIsIGUucmVsYXRlZFZpZXcuY29udGFpbmVyLmFwcGVuZENoaWxkKG4pKTsKICAgICAgfSwgYy5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIG8sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGEgPSBlLnJlbGF0ZWRWaWV3LAogICAgICAgICAgICBjID0gYS5vcHRpb25zLAogICAgICAgICAgICB1ID0gYS5nZXRWaWV3Qm91bmQoKS5oZWlnaHQsCiAgICAgICAgICAgIGQgPSBjLmhvdXJFbmQgLSBjLmhvdXJTdGFydCwKICAgICAgICAgICAgaCA9IHRoaXMuZ3VpZGVFbGVtZW50LAogICAgICAgICAgICBwID0gcGFyc2VGbG9hdChoLnN0eWxlLnRvcCksCiAgICAgICAgICAgIG0gPSBlLm5lYXJlc3RHcmlkWSAtIHRoaXMuX3N0YXJ0R3JpZFksCiAgICAgICAgICAgIGYgPSByKGQsIHUsIG0pLAogICAgICAgICAgICBnID0gdGhpcy5fc2NoZWR1bGUuZ29pbmdEdXJhdGlvbiwKICAgICAgICAgICAgeSA9IHRoaXMuX3NjaGVkdWxlLmR1cmF0aW9uKCkgLyBzLk1JTExJU0VDT05EU19QRVJfTUlOVVRFUywKICAgICAgICAgICAgUyA9IHRoaXMuX3NjaGVkdWxlLmNvbWluZ0R1cmF0aW9uLAogICAgICAgICAgICBfID0gNjAgKiBkOwoKICAgICAgICBpID0gdGhpcy5fc3RhcnRIZWlnaHRQaXhlbCArIGYsIGwgPSBwICsgcihkLCB1LCAuNSksIG4gPSBsIC09IHRoaXMuX3N0YXJ0VG9wUGl4ZWwsIGwgKz0gcihfLCB1LCBnKSArIHIoXywgdSwgUyksIG8gPSB1IC0gcCwgaSA9IE1hdGgubWF4KGksIGwpLCBpID0gTWF0aC5taW4oaSwgbyksIHQgPSByKF8sIHUsIHkpICsgZiwgdGhpcy5fcmVmcmVzaEd1aWRlRWxlbWVudChpLCBuLCB0KTsKICAgICAgfSwgZS5leHBvcnRzID0gYzsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMTUpLAogICAgICAgIGEgPSBuKDMpLAogICAgICAgIHIgPSBuKDEpLAogICAgICAgIHMgPSBuKDUpLAogICAgICAgIGMgPSBuKDk4KSwKICAgICAgICB1ID0gbigxMDMpLAogICAgICAgIGQgPSBuKDEwNCksCiAgICAgICAgaCA9IG4oMTA3KSwKICAgICAgICBwID0gbigxMDkpLAogICAgICAgIG0gPSBuKDExMiksCiAgICAgICAgZiA9IG4oMzIpLAogICAgICAgIGcgPSBuKDMzKSwKICAgICAgICB5ID0gbigxNCk7CgogICAgZS5leHBvcnRzID0gZnVuY3Rpb24gKGUsIHQsIG4sIFMpIHsKICAgICAgdmFyIF8sIEMsIHYsIEUsIHcsIFAsIGssIFIsIEksIGIsIEQsIEYsIHgsIFgsIE0sIE87CgogICAgICByZXR1cm4gXyA9IHIuYXBwZW5kSFRNTEVsZW1lbnQoImRpdiIsIHQsIG8uY2xhc3NuYW1lKCJtb250aCIpKSwgQyA9IG5ldyBjKFMsIF8sIGUuTW9udGgpLCB2ID0gbmV3IG0oUy5tb250aCwgdCwgZS50aGVtZSksIHcgPSBuZXcgdShuLCBDLCBlKSwgUy5pc1JlYWRPbmx5IHx8IChQID0gbmV3IGQobiwgQywgZSwgUyksIGsgPSBuZXcgaChuLCBDLCBlKSwgUiA9IG5ldyBwKG4sIEMsIGUpKSwgSSA9IGZ1bmN0aW9uIEkoKSB7CiAgICAgICAgdiAmJiB2LmhpZGUoKTsKICAgICAgfSwgYiA9IGZ1bmN0aW9uIGIoKSB7CiAgICAgICAgdiAmJiB2LnJlZnJlc2goKTsKICAgICAgfSwgdy5vbigiY2xpY2tNb3JlIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IHQuZGF0ZSwKICAgICAgICAgICAgbyA9IHQudGFyZ2V0LAogICAgICAgICAgICByID0gbC5waWNrKGUuZmluZEJ5RGF0ZVJhbmdlKGEuc3RhcnQobiksIGEuZW5kKG4pKSwgdC55bWQpOwogICAgICAgIHIuaXRlbXMgPSBsLmZpbHRlcihyLml0ZW1zLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIFMubW9udGguc2NoZWR1bGVGaWx0ZXIoZS5tb2RlbCk7CiAgICAgICAgfSksIHIgJiYgci5sZW5ndGggJiYgKHYucmVuZGVyKGZ1bmN0aW9uIChlLCB0LCBuLCBsKSB7CiAgICAgICAgICByZXR1cm4gbi5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0ID0gZS5tb2RlbDsKICAgICAgICAgICAgZS5oYXNNdWx0aURhdGVzID0gYS5oYXNNdWx0aURhdGVzKHQuc3RhcnQsIHQuZW5kKTsKICAgICAgICAgIH0pLCB7CiAgICAgICAgICAgIHRhcmdldDogdCwKICAgICAgICAgICAgZGF0ZTogYS5mb3JtYXQoZSwgIllZWVkuTU0uREQiKSwKICAgICAgICAgICAgZGF5bmFtZTogbFtlLmdldERheSgpXSwKICAgICAgICAgICAgc2NoZWR1bGVzOiBuLnNvcnQoaS5jb21wYXJlLnNjaGVkdWxlLmFzYykKICAgICAgICAgIH07CiAgICAgICAgfShuLCBvLCByLCBDLm9wdGlvbnMuZGF5bmFtZXMpKSwgci5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBlICYmIEMuZmlyZSgiYWZ0ZXJSZW5kZXJTY2hlZHVsZSIsIHsKICAgICAgICAgICAgc2NoZWR1bGU6IGUubW9kZWwKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBDLmZpcmUoImNsaWNrTW9yZSIsIHsKICAgICAgICAgIGRhdGU6IHQuZGF0ZSwKICAgICAgICAgIHRhcmdldDogdi5nZXRNb3JlVmlld0VsZW1lbnQoKQogICAgICAgIH0pKTsKICAgICAgfSksIFMudXNlQ3JlYXRpb25Qb3B1cCAmJiAoRSA9IG5ldyBmKHQsIGUuY2FsZW5kYXJzLCBTLnVzYWdlU3RhdGlzdGljcyksIEQgPSBmdW5jdGlvbiBEKGUpIHsKICAgICAgICBQLmZpcmUoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgbC5leHRlbmQoZSwgewogICAgICAgICAgdXNlQ3JlYXRpb25Qb3B1cDogITAKICAgICAgICB9KSk7CiAgICAgIH0sIEUub24oImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgRCkpLCBTLnVzZURldGFpbFBvcHVwICYmICh4ID0gbmV3IGcodCwgZS5jYWxlbmRhcnMpLCBYID0gZnVuY3Rpb24gWCh0KSB7CiAgICAgICAgdmFyIG4gPSB0LnNjaGVkdWxlLmNhbGVuZGFySWQ7CiAgICAgICAgdC5jYWxlbmRhciA9IHMuZmluZChlLmNhbGVuZGFycywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmlkID09PSBuOwogICAgICAgIH0pLCBTLmlzUmVhZE9ubHkgJiYgKHQuc2NoZWR1bGUgPSBsLmV4dGVuZCh7fSwgdC5zY2hlZHVsZSwgewogICAgICAgICAgaXNSZWFkT25seTogITAKICAgICAgICB9KSksIHgucmVuZGVyKHQpOwogICAgICB9LCBNID0gZnVuY3Rpb24gTShlKSB7CiAgICAgICAgUCAmJiBQLmZpcmUoImJlZm9yZURlbGV0ZVNjaGVkdWxlIiwgZSk7CiAgICAgIH0sIE8gPSBmdW5jdGlvbiBPKGUpIHsKICAgICAgICBSLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgZSk7CiAgICAgIH0sIHcub24oImNsaWNrU2NoZWR1bGUiLCBYKSwgeC5vbigiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBNKSwgUy51c2VDcmVhdGlvblBvcHVwID8gKEYgPSBmdW5jdGlvbiBGKHQpIHsKICAgICAgICBFLnNldENhbGVuZGFycyhlLmNhbGVuZGFycyksIEUucmVuZGVyKHQpOwogICAgICB9LCBFLm9uKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIE8pLCB4Lm9uKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIEYpKSA6IHgub24oImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgTykpLCBlLm9uKCJjbGVhclNjaGVkdWxlcyIsIEkpLCBlLm9uKCJ1cGRhdGVTY2hlZHVsZSIsIGIpLCBSICYmIFIub24oIm1vbnRoTW92ZVN0YXJ0X2Zyb21fbW9yZWxheWVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgIHYuaGlkZSgpOwogICAgICB9KSwgQy5oYW5kbGVyID0gewogICAgICAgIGNsaWNrOiB7CiAgICAgICAgICBkZWZhdWx0OiB3CiAgICAgICAgfQogICAgICB9LCBTLmlzUmVhZE9ubHkgfHwgKEMuaGFuZGxlciA9IGwuZXh0ZW5kKEMuaGFuZGxlciwgewogICAgICAgIGNyZWF0aW9uOiB7CiAgICAgICAgICBkZWZhdWx0OiBQCiAgICAgICAgfSwKICAgICAgICByZXNpemU6IHsKICAgICAgICAgIGRlZmF1bHQ6IGsKICAgICAgICB9LAogICAgICAgIG1vdmU6IHsKICAgICAgICAgIGRlZmF1bHQ6IFIKICAgICAgICB9CiAgICAgIH0pKSwgQy5fYmVmb3JlRGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2LmRlc3Ryb3koKSwgZS5vZmYoImNsZWFyU2NoZWR1bGVzIiwgSSksIGUub2ZmKCJ1cGRhdGVTY2hlZHVsZSIsIGIpLCBsLmZvckVhY2goQy5oYW5kbGVyLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgbC5mb3JFYWNoKGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGUub2ZmKCksIGUuZGVzdHJveSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIFMudXNlQ3JlYXRpb25Qb3B1cCAmJiBTLnVzZURldGFpbFBvcHVwICYmIEUub2ZmKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGIpLCBTLnVzZUNyZWF0aW9uUG9wdXAgJiYgKFAgJiYgUC5vZmYoImJlZm9yZUNyZWF0ZVNjaGVkdWxlIiwgdm9pZCAwKSwgRS5vZmYoInNhdmVTY2hlZHVsZSIsIEQpLCBFLmRlc3Ryb3koKSksIFMudXNlRGV0YWlsUG9wdXAgJiYgKHcub2ZmKCJjbGlja1NjaGVkdWxlIiwgWCksIHgub2ZmKCJiZWZvcmVVcGRhdGVTY2hlZHVsZSIsIGIpLCB4Lm9mZigiYmVmb3JlRGVsZXRlU2NoZWR1bGUiLCBNKSwgeC5kZXN0cm95KCkpOwogICAgICB9LCBDLmNvbnRyb2xsZXIgPSBlLk1vbnRoLCB7CiAgICAgICAgdmlldzogQywKICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICAgICAgQy52TGF5b3V0LnJlZnJlc2goKTsKICAgICAgICB9LAogICAgICAgIG9wZW5DcmVhdGlvblBvcHVwOiBmdW5jdGlvbiBvcGVuQ3JlYXRpb25Qb3B1cChlKSB7CiAgICAgICAgICBFICYmIFAgJiYgUC5pbnZva2VDcmVhdGlvbkNsaWNrKHkuY3JlYXRlKGUpKTsKICAgICAgICB9LAogICAgICAgIHNob3dDcmVhdGlvblBvcHVwOiBmdW5jdGlvbiBzaG93Q3JlYXRpb25Qb3B1cCh0KSB7CiAgICAgICAgICBFICYmIChFLnNldENhbGVuZGFycyhlLmNhbGVuZGFycyksIEUucmVuZGVyKHQpKTsKICAgICAgICB9LAogICAgICAgIGhpZGVNb3JlVmlldzogZnVuY3Rpb24gaGlkZU1vcmVWaWV3KCkgewogICAgICAgICAgdiAmJiB2LmhpZGUoKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9OwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDQpLkRhdGUsCiAgICAgICAgcyA9IG4oOTkpLAogICAgICAgIGMgPSBuKDgpLAogICAgICAgIHUgPSBuKDI5KSwKICAgICAgICBkID0gbigxMDApLAogICAgICAgIGggPSBNYXRoLm1pbjsKCiAgICBmdW5jdGlvbiBwKGUsIHQsIG4pIHsKICAgICAgdmFyIG8sCiAgICAgICAgICBhID0gbiA/IG4udGhlbWUgOiBudWxsOwogICAgICBvID0gKGUgPSBlIHx8IHt9KSA/IGUubW9udGggOiB7fSwgYy5jYWxsKHRoaXMsIHQpLCB0aGlzLmNvbnRyb2xsZXIgPSBuLCB0aGlzLnZMYXlvdXQgPSBuZXcgdSh7CiAgICAgICAgcGFuZWxzOiBbewogICAgICAgICAgaGVpZ2h0OiBwYXJzZUludChuLnRoZW1lLm1vbnRoLmRheW5hbWUuaGVpZ2h0LCAxMCkgfHwgNDIKICAgICAgICB9LCB7CiAgICAgICAgICBhdXRvSGVpZ2h0OiAhMAogICAgICAgIH1dCiAgICAgIH0sIHQsIGEpLCB0aGlzLm9wdGlvbnMgPSBsLmV4dGVuZCh7CiAgICAgICAgc2NoZWR1bGVGaWx0ZXI6IGZ1bmN0aW9uIHNjaGVkdWxlRmlsdGVyKGUpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKGUuaXNWaXNpYmxlKTsKICAgICAgICB9LAogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAwLAogICAgICAgIHJlbmRlck1vbnRoOiAiMjAxOC0wMSIsCiAgICAgICAgZGF5bmFtZXM6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sCiAgICAgICAgbmFycm93V2Vla2VuZDogITEsCiAgICAgICAgdmlzaWJsZVdlZWtzQ291bnQ6IG51bGwsCiAgICAgICAgaXNBbHdheXM2V2VlazogITAsCiAgICAgICAgaXNSZWFkT25seTogZS5pc1JlYWRPbmx5LAogICAgICAgIGdyaWQ6IHsKICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICBoZWlnaHQ6IDM0CiAgICAgICAgICB9LAogICAgICAgICAgZm9vdGVyOiB7CiAgICAgICAgICAgIGhlaWdodDogMwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgbyksIHRoaXMub3B0aW9ucy5ncmlkLmhlYWRlciA9IGwuZXh0ZW5kKHsKICAgICAgICBoZWlnaHQ6IDM0CiAgICAgIH0sIGwucGljayhvLCAiZ3JpZCIsICJoZWFkZXIiKSksIHRoaXMub3B0aW9ucy5ncmlkLmZvb3RlciA9IGwuZXh0ZW5kKHsKICAgICAgICBoZWlnaHQ6IDMKICAgICAgfSwgbC5waWNrKG8sICJncmlkIiwgImZvb3RlciIpKSwgdGhpcy5ncmlkcyA9IGkuZ2V0R3JpZExlZnRBbmRXaWR0aCh0aGlzLm9wdGlvbnMuZGF5bmFtZXMubGVuZ3RoLCB0aGlzLm9wdGlvbnMubmFycm93V2Vla2VuZCwgdGhpcy5vcHRpb25zLnN0YXJ0RGF5T2ZXZWVrKTsKICAgIH0KCiAgICBsLmluaGVyaXQocCwgYyksIHAucHJvdG90eXBlLnZpZXdOYW1lID0gIm1vbnRoIiwgcC5wcm90b3R5cGUuX2dldE1vbnRoQ2FsZW5kYXIgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBuZXcgcihlKSwKICAgICAgICAgIGwgPSB0aGlzLm9wdGlvbnMuc3RhcnREYXlPZldlZWsgfHwgMCwKICAgICAgICAgIG8gPSBoKHRoaXMub3B0aW9ucy52aXNpYmxlV2Vla3NDb3VudCB8fCAwLCA2KSwKICAgICAgICAgIGEgPSB0aGlzLm9wdGlvbnMud29ya3dlZWsgfHwgITE7CiAgICAgIHJldHVybiB0ID0gdGhpcy5vcHRpb25zLnZpc2libGVXZWVrc0NvdW50ID8gewogICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiBsLAogICAgICAgIGlzQWx3YXlzNldlZWs6ICExLAogICAgICAgIHZpc2libGVXZWVrc0NvdW50OiBvLAogICAgICAgIHdvcmt3ZWVrOiBhCiAgICAgIH0gOiB7CiAgICAgICAgc3RhcnREYXlPZldlZWs6IGwsCiAgICAgICAgaXNBbHdheXM2V2VlazogdGhpcy5vcHRpb25zLmlzQWx3YXlzNldlZWssCiAgICAgICAgd29ya3dlZWs6IGEKICAgICAgfSwgaS5hcnIyZENhbGVuZGFyKG4sIHQpOwogICAgfSwgcC5wcm90b3R5cGUuX3JlbmRlckNoaWxkcmVuID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICAgdmFyIGkgPSB0aGlzLAogICAgICAgICAgcyA9IDEwMCAvIHQubGVuZ3RoLAogICAgICAgICAgYyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIHUgPSBjLnJlbmRlck1vbnRoLAogICAgICAgICAgaCA9IGMubmFycm93V2Vla2VuZCwKICAgICAgICAgIHAgPSBjLnN0YXJ0RGF5T2ZXZWVrLAogICAgICAgICAgbSA9IGMudmlzaWJsZVdlZWtzQ291bnQsCiAgICAgICAgICBmID0gYy52aXNpYmxlU2NoZWR1bGVDb3VudCwKICAgICAgICAgIGcgPSBjLmdyaWQsCiAgICAgICAgICB5ID0gYy5pc1JlYWRPbmx5OwogICAgICBlLmlubmVySFRNTCA9ICIiLCB0aGlzLmNoaWxkcmVuLmNsZWFyKCksIGwuZm9yRWFjaCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBsLAogICAgICAgICAgICBjLAogICAgICAgICAgICBTID0gbmV3IHIodFswXSksCiAgICAgICAgICAgIF8gPSBuZXcgcih0W3QubGVuZ3RoIC0gMV0pOwoKICAgICAgICBsID0gYS5hcHBlbmRIVE1MRWxlbWVudCgiZGl2IiwgZSwgby5jbGFzc25hbWUoIm1vbnRoLXdlZWstaXRlbSIpKSwgYyA9IG5ldyBkKHsKICAgICAgICAgIHJlbmRlck1vbnRoOiB1LAogICAgICAgICAgaGVpZ2h0UGVyY2VudDogcywKICAgICAgICAgIHJlbmRlclN0YXJ0RGF0ZTogUywKICAgICAgICAgIHJlbmRlckVuZERhdGU6IF8sCiAgICAgICAgICBuYXJyb3dXZWVrZW5kOiBoLAogICAgICAgICAgc3RhcnREYXlPZldlZWs6IHAsCiAgICAgICAgICB2aXNpYmxlV2Vla3NDb3VudDogbSwKICAgICAgICAgIHZpc2libGVTY2hlZHVsZUNvdW50OiBmLAogICAgICAgICAgZ3JpZDogZywKICAgICAgICAgIHNjaGVkdWxlSGVpZ2h0OiBwYXJzZUludChuLm1vbnRoLnNjaGVkdWxlLmhlaWdodCwgMTApLAogICAgICAgICAgc2NoZWR1bGVHdXR0ZXI6IHBhcnNlSW50KG4ubW9udGguc2NoZWR1bGUubWFyZ2luVG9wLCAxMCksCiAgICAgICAgICBpc1JlYWRPbmx5OiB5CiAgICAgICAgfSwgbCksIGkuYWRkQ2hpbGQoYyk7CiAgICAgIH0pOwogICAgfSwgcC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSwKICAgICAgICAgIHQsCiAgICAgICAgICBuLAogICAgICAgICAgbyA9IHRoaXMsCiAgICAgICAgICBhID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgciA9IHRoaXMudkxheW91dCwKICAgICAgICAgIGMgPSB0aGlzLmNvbnRyb2xsZXIsCiAgICAgICAgICB1ID0gYS5kYXluYW1lcywKICAgICAgICAgIGQgPSBhLndvcmt3ZWVrLAogICAgICAgICAgaCA9IHRoaXMuX2dldE1vbnRoQ2FsZW5kYXIoYS5yZW5kZXJNb250aCksCiAgICAgICAgICBwID0gYS5zY2hlZHVsZUZpbHRlciwKICAgICAgICAgIG0gPSBjID8gYy50aGVtZSA6IG51bGwsCiAgICAgICAgICBmID0gdGhpcy5fZ2V0U3R5bGVzKG0pOwoKICAgICAgZSA9IHRoaXMuZ3JpZHMgPSBpLmdldEdyaWRMZWZ0QW5kV2lkdGgoYS5kYXluYW1lcy5sZW5ndGgsIGEubmFycm93V2Vla2VuZCwgYS5zdGFydERheU9mV2VlayksIHQgPSBsLm1hcChsLnJhbmdlKGEuc3RhcnREYXlPZldlZWssIDcpLmNvbmNhdChsLnJhbmdlKDcpKS5zbGljZSgwLCA3KSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZGF5OiB0LAogICAgICAgICAgbGFiZWw6IHVbdF0sCiAgICAgICAgICB3aWR0aDogZVtuXSA/IGVbbl0ud2lkdGggOiAwLAogICAgICAgICAgbGVmdDogZVtuXSA/IGVbbl0ubGVmdCA6IDAsCiAgICAgICAgICBjb2xvcjogdGhpcy5fZ2V0RGF5TmFtZUNvbG9yKG0sIHQpCiAgICAgICAgfTsKICAgICAgfSwgdGhpcyksIGQgJiYgKGUgPSB0aGlzLmdyaWRzID0gaS5nZXRHcmlkTGVmdEFuZFdpZHRoKDUsIGEubmFycm93V2Vla2VuZCwgYS5zdGFydERheU9mV2VlaywgZCksIHQgPSBsLmZpbHRlcih0LCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiAhaS5pc1dlZWtlbmQoZS5kYXkpOwogICAgICB9KSwgbC5mb3JFYWNoKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdC53aWR0aCA9IGVbbl0gPyBlW25dLndpZHRoIDogMCwgdC5sZWZ0ID0gZVtuXSA/IGVbbl0ubGVmdCA6IDA7CiAgICAgIH0pKSwgbiA9IHsKICAgICAgICBkYXluYW1lczogdCwKICAgICAgICBzdHlsZXM6IGYKICAgICAgfSwgci5wYW5lbHNbMF0uY29udGFpbmVyLmlubmVySFRNTCA9IHMobiksIHRoaXMuX3JlbmRlckNoaWxkcmVuKHIucGFuZWxzWzFdLmNvbnRhaW5lciwgaCwgbSksIG4ucGFuZWxIZWlnaHQgPSByLnBhbmVsc1sxXS5nZXRIZWlnaHQoKSwgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGwgPSBpLnN0YXJ0KHQub3B0aW9ucy5yZW5kZXJTdGFydERhdGUpLAogICAgICAgICAgICBhID0gaS5zdGFydCh0Lm9wdGlvbnMucmVuZGVyRW5kRGF0ZSksCiAgICAgICAgICAgIHIgPSBjLmZpbmRCeURhdGVSYW5nZShpLnN0YXJ0KGwpLCBpLmVuZChhKSwgcCksCiAgICAgICAgICAgIHMgPSB7CiAgICAgICAgICBldmVudHNJbkRhdGVSYW5nZTogciwKICAgICAgICAgIHJhbmdlOiBpLnJhbmdlKGkuc3RhcnQobCksIGkuZW5kKGEpLCBpLk1JTExJU0VDT05EU19QRVJfREFZKS5zbGljZSgwLCBlLmxlbmd0aCksCiAgICAgICAgICBncmlkczogZSwKICAgICAgICAgIHBhbmVsSGVpZ2h0OiBuLnBhbmVsSGVpZ2h0LAogICAgICAgICAgdGhlbWU6IG0KICAgICAgICB9OwogICAgICAgIHQucmVuZGVyKHMpLCBvLl9pbnZva2VBZnRlclJlbmRlclNjaGVkdWxlKHIpOwogICAgICB9KTsKICAgIH0sIHAucHJvdG90eXBlLl9pbnZva2VBZnRlclJlbmRlclNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSB0aGlzOwogICAgICBsLmZvckVhY2hBcnJheShlLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGwuZm9yRWFjaEFycmF5KGUsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBsLmZvckVhY2hBcnJheShlLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlICYmICFlLmhpZGRlbiAmJiB0LmZpcmUoImFmdGVyUmVuZGVyU2NoZWR1bGUiLCB7CiAgICAgICAgICAgICAgc2NoZWR1bGU6IGUubW9kZWwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0ge307CiAgICAgIHJldHVybiBlICYmICh0ID0gZS5tb250aC5kYXluYW1lLCBuLmJvcmRlclRvcCA9IHQuYm9yZGVyVG9wIHx8IGUuY29tbW9uLmJvcmRlciwgbi5ib3JkZXJMZWZ0ID0gdC5ib3JkZXJMZWZ0IHx8IGUuY29tbW9uLmJvcmRlciwgbi5oZWlnaHQgPSB0LmhlaWdodCwgbi5wYWRkaW5nTGVmdCA9IHQucGFkZGluZ0xlZnQsIG4ucGFkZGluZ1JpZ2h0ID0gdC5wYWRkaW5nUmlnaHQsIG4uZm9udFNpemUgPSB0LmZvbnRTaXplLCBuLmJhY2tncm91bmRDb2xvciA9IHQuYmFja2dyb3VuZENvbG9yLCBuLmZvbnRXZWlnaHQgPSB0LmZvbnRXZWlnaHQsIG4udGV4dEFsaWduID0gdC50ZXh0QWxpZ24pLCBuOwogICAgfSwgcC5wcm90b3R5cGUuX2dldERheU5hbWVDb2xvciA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gIiI7CiAgICAgIHJldHVybiBlICYmIChuID0gMCA9PT0gdCA/IGUuY29tbW9uLmhvbGlkYXkuY29sb3IgOiA2ID09PSB0ID8gZS5jb21tb24uc2F0dXJkYXkuY29sb3IgOiBlLmNvbW1vbi5kYXluYW1lLmNvbG9yKSwgbjsKICAgIH0sIGUuZXhwb3J0cyA9IHA7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICA8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLWRheW5hbWUtaXRlbSJcbiAgICAgICAgIHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgICAgICAgd2lkdGg6ICcgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIndpZHRoIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIndpZHRoIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIndpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTtcbiAgICAgICAgICAgICAgICBsZWZ0OiAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJsZWZ0IikgfHwgKG51bGwgIT0gdCA/IGQodCwgImxlZnQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAibGVmdCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMjIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIiU7XG4gICAgICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgInBhZGRpbmdMZWZ0IiksIHQpKSArICI7XG4gICAgICAgICAgICAgICAgcGFkZGluZy1yaWdodDogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJwYWRkaW5nUmlnaHQiKSwgdCkpICsgIjtcbiAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogIiArIGModSgoaSA9IChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInN0eWxlcyIpKSAmJiBkKGksICJoZWlnaHQiKSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwociwgbyAmJiBkKG8sICJsYXN0IiksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgICAgICAgICAgICAgIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKChkKG4sICJob2xpZGF5IikgfHwgdCAmJiBkKHQsICJob2xpZGF5IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJkYXkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJob2xpZGF5IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAzNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyIgc3R5bGU9ImNvbG9yOiAnICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJjb2xvciIpIHx8IChudWxsICE9IHQgPyBkKHQsICJjb2xvciIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNSwKICAgICAgICAgICAgICBjb2x1bW46IDUyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogNjEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnOyI+XG4gICAgICAgICAgICAnICsgKG51bGwgIT0gKGkgPSAoZChuLCAibW9udGhEYXluYW1lLXRtcGwiKSB8fCB0ICYmIGQodCwgIm1vbnRoRGF5bmFtZS10bXBsIikgfHwgcykuY2FsbChyLCB0LCB7CiAgICAgICAgICBuYW1lOiAibW9udGhEYXluYW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDQwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuICAgICAgICA8L3NwYW4+XG4gICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgIGJvcmRlci1yaWdodDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJib3JkZXJMZWZ0IiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBjID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1kYXluYW1lIlxuICAgIHN0eWxlPSJib3JkZXItdG9wOiAnICsgcyhjKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAiYm9yZGVyVG9wIikgOiBpLCB0KSkgKyAiOyBoZWlnaHQ6ICIgKyBzKGMobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHUodCwgInN0eWxlcyIpIDogdCkgPyB1KGksICJoZWlnaHQiKSA6IGksIHQpKSArICI7IGZvbnQtc2l6ZTogIiArIHMoYyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImZvbnRTaXplIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgcyhjKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAiYmFja2dyb3VuZENvbG9yIikgOiBpLCB0KSkgKyAiOyB0ZXh0LWFsaWduOiAiICsgcyhjKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAidGV4dEFsaWduIikgOiBpLCB0KSkgKyAiOyBmb250LXdlaWdodDogIiArIHMoYyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImZvbnRXZWlnaHQiKSA6IGksIHQpKSArICc7Ij5cbicgKyAobnVsbCAhPSAoaSA9IHUobiwgImVhY2giKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImRheW5hbWVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiA5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDUpLAogICAgICAgIGEgPSBuKDEpLAogICAgICAgIHIgPSBuKDgpLAogICAgICAgIHMgPSBuKDMwKSwKICAgICAgICBjID0gbigxMDEpLAogICAgICAgIHUgPSBuKDEwMiksCiAgICAgICAgZCA9IE1hdGguZmxvb3IsCiAgICAgICAgaCA9IE1hdGgubWluOwoKICAgIGZ1bmN0aW9uIHAoZSwgdCkgewogICAgICBzLmNhbGwodGhpcywgZSwgdCksIHQuc3R5bGUuaGVpZ2h0ID0gZS5oZWlnaHRQZXJjZW50ICsgIiUiOwogICAgfQoKICAgIGwuaW5oZXJpdChwLCBzKSwgcC5wcm90b3R5cGUuZ2V0Vmlld0JvdW5kID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gci5wcm90b3R5cGUuZ2V0Vmlld0JvdW5kLmNhbGwodGhpcyk7CiAgICB9LCBwLnByb3RvdHlwZS5fZ2V0UmVuZGVyTGltaXRJbmRleCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiA9IHRoaXMub3B0aW9ucywKICAgICAgICAgIG8gPSBlIHx8IHRoaXMuZ2V0Vmlld0JvdW5kKCkuaGVpZ2h0LAogICAgICAgICAgaSA9IGwucGljayhuLCAiZ3JpZCIsICJoZWFkZXIiLCAiaGVpZ2h0IikgfHwgMCwKICAgICAgICAgIGEgPSBsLnBpY2sobiwgImdyaWQiLCAiZm9vdGVyIiwgImhlaWdodCIpIHx8IDAsCiAgICAgICAgICByID0gbi52aXNpYmxlU2NoZWR1bGVDb3VudCB8fCAwOwogICAgICByZXR1cm4gdCA9IGQoKG8gLT0gaSArIGEpIC8gKG4uc2NoZWR1bGVIZWlnaHQgKyBuLnNjaGVkdWxlR3V0dGVyKSksIHIgfHwgKHIgPSB0KSwgaCh0LCByKTsKICAgIH0sIHAucHJvdG90eXBlLmdldEJhc2VWaWV3TW9kZWwgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBvID0gbC5waWNrKG4sICJncmlkIiwgImhlYWRlciIsICJoZWlnaHQiKSB8fCAwLAogICAgICAgICAgaSA9IGwucGljayhuLCAiZ3JpZCIsICJmb290ZXIiLCAiaGVpZ2h0IikgfHwgMCwKICAgICAgICAgIGEgPSB0aGlzLl9nZXRSZW5kZXJMaW1pdEluZGV4KCkgKyAxLAogICAgICAgICAgciA9IHRoaXMuZ2V0RXhjZWVkRGF0ZShhLCBlLmV2ZW50c0luRGF0ZVJhbmdlLCBlLnJhbmdlKSwKICAgICAgICAgIGMgPSB0aGlzLl9nZXRTdHlsZXMoZS50aGVtZSk7CgogICAgICByZXR1cm4gZSA9IGwuZXh0ZW5kKHsKICAgICAgICBleGNlZWREYXRlOiByCiAgICAgIH0sIGUpLCB0ID0gcy5wcm90b3R5cGUuZ2V0QmFzZVZpZXdNb2RlbC5jYWxsKHRoaXMsIGUpLCB0ID0gbC5leHRlbmQoewogICAgICAgIG1hdHJpY2VzOiBlLmV2ZW50c0luRGF0ZVJhbmdlLAogICAgICAgIGdyaWRIZWFkZXJIZWlnaHQ6IG8sCiAgICAgICAgZ3JpZEZvb3RlckhlaWdodDogaSwKICAgICAgICByZW5kZXJMaW1pdElkeDogYSwKICAgICAgICBpc1JlYWRPbmx5OiBuLmlzUmVhZE9ubHksCiAgICAgICAgc3R5bGVzOiBjCiAgICAgIH0sIHQpOwogICAgfSwgcC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgciwKICAgICAgICAgIGQsCiAgICAgICAgICBoLAogICAgICAgICAgcCA9IHRoaXMuY29udGFpbmVyLAogICAgICAgICAgbSA9IHRoaXMuZ2V0QmFzZVZpZXdNb2RlbChlKTsKICAgICAgdGhpcy5vcHRpb25zLnZpc2libGVXZWVrc0NvdW50IHx8IChuID0gbS5kYXRlcywgciA9IHRoaXMub3B0aW9ucy5yZW5kZXJNb250aCwgZCA9IGUudGhlbWUsIGggPSByLmdldE1vbnRoKCkgKyAxLCBsLmZvckVhY2gobiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdCA9IGUubW9udGggIT09IGg7CiAgICAgICAgZS5pc090aGVyTW9udGggPSB0LCB0ICYmIChlLmNvbG9yID0gcy5wcm90b3R5cGUuX2dldERheU5hbWVDb2xvcihkLCBlLmRheSwgZS5pc1RvZGF5LCB0KSk7CiAgICAgIH0pKSwgcC5pbm5lckhUTUwgPSBjKG0pLCAodCA9IGEuZmluZChvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGVzIiksIHApKSAmJiAodC5pbm5lckhUTUwgPSB1KG0pLCBpLnNldEF1dG9FbGxpcHNpcyhvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtdGl0bGUiKSwgcCwgITApKTsKICAgIH0sIHAucHJvdG90eXBlLl9iZWZvcmVEZXN0cm95ID0gZnVuY3Rpb24gKCkge30sIHAucHJvdG90eXBlLl9nZXRTdHlsZXMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHt9OwogICAgICByZXR1cm4gZSAmJiAodC5ib3JkZXJUb3AgPSBlLmNvbW1vbi5ib3JkZXIsIHQuYm9yZGVyTGVmdCA9IGUuY29tbW9uLmJvcmRlciwgdC5mb250U2l6ZSA9IGUubW9udGguZGF5LmZvbnRTaXplLCB0LmJvcmRlclJhZGl1cyA9IGUubW9udGguc2NoZWR1bGUuYm9yZGVyUmFkaXVzLCB0Lm1hcmdpbkxlZnQgPSBlLm1vbnRoLnNjaGVkdWxlLm1hcmdpbkxlZnQsIHQubWFyZ2luUmlnaHQgPSBlLm1vbnRoLnNjaGVkdWxlLm1hcmdpblJpZ2h0LCB0LnNjaGVkdWxlQnVsbGV0VG9wID0gdGhpcy5vcHRpb25zLnNjaGVkdWxlSGVpZ2h0IC8gMyksIHQ7CiAgICB9LCBlLmV4cG9ydHMgPSBwOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDMwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktZ3JpZC1saW5lICIgKyB1KChkKG4sICJob2xpZGF5IikgfHwgdCAmJiBkKHQsICJob2xpZGF5IikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJkYXkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJob2xpZGF5IiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArIChudWxsICE9IChpID0gKGQobiwgImZpIikgfHwgdCAmJiBkKHQsICJmaSIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiZGF0ZSIpIDogdCwgIiE9PSIsIDEsIHsKICAgICAgICAgIG5hbWU6ICJmaSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDYzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJpc1RvZGF5IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDQsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE2MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImlzT3RoZXJNb250aCIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg2LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTYxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICBzdHlsZT0id2lkdGg6JyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGQobiwgIndpZHRoIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIndpZHRoIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIndpZHRoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiJTsgbGVmdDoiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAibGVmdCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJsZWZ0IikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImxlZnQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDM4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA0NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICIlOyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiYmFja2dyb3VuZENvbG9yIikgfHwgKG51bGwgIT0gdCA/IGQodCwgImJhY2tncm91bmRDb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJiYWNrZ3JvdW5kQ29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOCwKICAgICAgICAgICAgICBjb2x1bW46IDY3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA4NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICI7IGZvbnQtc2l6ZTogIiArIHUoZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiZm9udFNpemUiKSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwociwgbyAmJiBkKG8sICJsYXN0IiksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDgsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICAiPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDM0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZ3JpZC1oZWFkZXIiPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiAnICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gZChuLCAiY29sb3IiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiY29sb3IiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiY29sb3IiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAzMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJzsiPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJtb250aEdyaWRIZWFkZXItdG1wbCIpIHx8IHQgJiYgZCh0LCAibW9udGhHcmlkSGVhZGVyLXRtcGwiKSB8fCBzKS5jYWxsKHIsIHQsIHsKICAgICAgICAgIG5hbWU6ICJtb250aEdyaWRIZWFkZXItdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDQ0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImhpZGRlblNjaGVkdWxlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE5LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1ncmlkLWZvb3RlciI+XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT0iY29sb3I6ICcgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJjb2xvciIpIHx8IChudWxsICE9IHQgPyBkKHQsICJjb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDMyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnOyI+JyArIChudWxsICE9IChpID0gKGQobiwgIm1vbnRoR3JpZEZvb3Rlci10bXBsIikgfHwgdCAmJiBkKHQsICJtb250aEdyaWRGb290ZXItdG1wbCIpIHx8IHMpLmNhbGwociwgdCwgewogICAgICAgICAgbmFtZTogIm1vbnRoR3JpZEZvb3Rlci10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogNDQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAiaGlkZGVuU2NoZWR1bGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEyLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDk4CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIm5lYXItbW9udGgtZGF5IjsKICAgICAgfSwKICAgICAgNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDE0OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ0b2RheSI7CiAgICAgIH0sCiAgICAgIDY6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgIiArIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTgyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxOTYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogaSkgKyAiZXh0cmEtZGF0ZSI7CiAgICAgIH0sCiAgICAgIDg6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgIGJvcmRlci1yaWdodDoiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgImJvcmRlckxlZnQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDEwOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMjkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LWV4Y2VlZC1pbi1tb250aCIgZGF0YS15bWQ9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgInltZCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJ5bWQiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAieW1kIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogNzgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA4NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICciPicgKyAobnVsbCAhPSAoaSA9ICh1KG4sICJtb250aEdyaWRIZWFkZXJFeGNlZWQtdG1wbCIpIHx8IHQgJiYgdSh0LCAibW9udGhHcmlkSGVhZGVyRXhjZWVkLXRtcGwiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImhpZGRlblNjaGVkdWxlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogIm1vbnRoR3JpZEhlYWRlckV4Y2VlZC10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogODcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxMzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuIjsKICAgICAgfSwKICAgICAgMTI6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiAyOQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDQzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZXhjZWVkLWluLW1vbnRoIiBkYXRhLXltZD0iJyArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAieW1kIikgfHwgKG51bGwgIT0gdCA/IHUodCwgInltZCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJ5bWQiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA3OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDg1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJyI+JyArIChudWxsICE9IChpID0gKHUobiwgIm1vbnRoR3JpZEZvb3RlckV4Y2VlZC10bXBsIikgfHwgdCAmJiB1KHQsICJtb250aEdyaWRGb290ZXJFeGNlZWQtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiaGlkZGVuU2NoZWR1bGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAibW9udGhHcmlkRm9vdGVyRXhjZWVkLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjIsCiAgICAgICAgICAgICAgY29sdW1uOiA4NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMiwKICAgICAgICAgICAgICBjb2x1bW46IDEzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktYm9yZGVyIlxuICAgIHN0eWxlPSJcbiAgICBib3JkZXItdG9wOiAnICsgYyhlLmxhbWJkYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAic3R5bGVzIikgOiB0KSA/IHUoaSwgImJvcmRlclRvcCIpIDogaSwgdCkpICsgJztcbiI+PC9kaXY+XG48ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktZ3JpZCI+XG4nICsgKG51bGwgIT0gKGkgPSB1KG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJkYXRlcyIpIDogdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnPC9kaXY+XG48ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZXMiPjwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImVhY2giKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB0LCB7CiAgICAgICAgICBuYW1lOiAiZWFjaCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogODAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICAyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaTsKICAgICAgICByZXR1cm4gIlxuIiArIChudWxsICE9IChpID0gKGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH0pKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImVhY2giLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc5LAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpOwogICAgICAgIHJldHVybiAiXG4iICsgKG51bGwgIT0gKGkgPSAoZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfSkobiwgImlmIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3OCwKICAgICAgICAgICAgICBjb2x1bW46IDkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDQ6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICJcbiIgKyAobnVsbCAhPSAoaSA9IChhKG4sICJmaSIpIHx8IHQgJiYgYSh0LCAiZmkiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgInRvcCIpIDogdCwgIjwiLCAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJyZW5kZXJMaW1pdElkeCIpLCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDc3LAogICAgICAgICAgICAgIGNvbHVtbjogMTMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIik7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJzxkaXYgZGF0YS1pZD0iJyArIGMoKHUobiwgInN0YW1wIikgfHwgdCAmJiB1KHQsICJzdGFtcCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzdGFtcCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2LAogICAgICAgICAgICAgIGNvbHVtbjogMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNiwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnIlxuICAgICAgICAgY2xhc3M9IicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZS1ibG9ja1xuICAgICAgICAgICAgICAgICIgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZS1ibG9jay0iICsgYygodShuLCAic3RhbXAiKSB8fCB0ICYmIHUodCwgInN0YW1wIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInN0YW1wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiA1MwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogNjgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICJcbiAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IHUobiwgImlmIikuY2FsbChyLCBudWxsICE9IHQgPyB1KHQsICJleGNlZWRMZWZ0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDYsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA5LAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4gICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSB1KG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gdSh0LCAiZXhjZWVkUmlnaHQiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDczCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgIHN0eWxlPSInICsgYygodShuLCAibW9udGgtc2NoZWR1bGVCbG9jayIpIHx8IHQgJiYgdSh0LCAibW9udGgtc2NoZWR1bGVCbG9jayIpIHx8IHMpLmNhbGwociwgdCwgKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAiZGF0ZXMiKSwgKGkgPSBvICYmIHUobywgInJvb3QiKSkgJiYgdShpLCAic2NoZWR1bGVCbG9ja0hlaWdodCIpLCAoaSA9IG8gJiYgdShvLCAicm9vdCIpKSAmJiB1KGksICJncmlkSGVhZGVySGVpZ2h0IiksIHsKICAgICAgICAgIG5hbWU6ICJtb250aC1zY2hlZHVsZUJsb2NrIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDExLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSArICI7XG4gICAgICAgICAgICAgICAgbWFyZ2luLXRvcDoiICsgYyhlLmxhbWJkYSgoaSA9IG8gJiYgdShvLCAicm9vdCIpKSAmJiB1KGksICJzY2hlZHVsZUJsb2NrR3V0dGVyIiksIHQpKSArICdweCI+XG4nICsgKG51bGwgIT0gKGkgPSAodShuLCAiZmkiKSB8fCB0ICYmIHUodCwgImZpIikgfHwgcykuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gdSh0LCAibW9kZWwiKSA6IHQpID8gdShpLCAiaXNBbGxEYXkiKSA6IGksICJ8fCIsIG51bGwgIT0gdCA/IHUodCwgImhhc011bHRpRGF0ZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJmaSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTAsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDIzLCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICA2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGkgPSBudWxsICE9IChpID0gYShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBhKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBpIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGkuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LWV4Y2VlZC1sZWZ0IjsKICAgICAgfSwKICAgICAgODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMzIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiA0NgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICJ3ZWVrZGF5LWV4Y2VlZC1yaWdodCI7CiAgICAgIH0sCiAgICAgIDEwOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubGFtYmRhLAogICAgICAgICAgICBzID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBjID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHUgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgPGRpdiBkYXRhLXNjaGVkdWxlLWlkPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpZCIpIDogaSwgdCkpICsgJyIgZGF0YS1jYWxlbmRhci1pZD0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY2FsZW5kYXJJZCIpIDogaSwgdCkpICsgJyIgY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHUpID8gYS5jYWxsKGMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogOTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZSAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwoYywgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMjMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAxOTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnIlxuICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6JyArIHMocigoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiIgKyBzKHIoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgcyhyKChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImJvcmRlclJhZGl1cyIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRMZWZ0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKGMsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZFJpZ2h0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxNSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTksCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMSwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwoYywgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxNywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTksIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIyLAogICAgICAgICAgICAgIGNvbHVtbjogMTYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAyMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAgICAgICAgICIgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImN1c3RvbVN0eWxlIikgOiBpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyOCwKICAgICAgICAgICAgICBjb2x1bW46IDI1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMzkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICAgIGRhdGEtdGl0bGU9IicgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgInRpdGxlIikgOiBpLCB0KSkgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAoZChuLCAiYWxsZGF5LXRtcGwiKSB8fCB0ICYmIGQodCwgImFsbGRheS10bXBsIikgfHwgdSkuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImFsbGRheS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI5LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjksCiAgICAgICAgICAgICAgY29sdW1uOiA3MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgICAgICAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKGMsIChkKG4sICJvciIpIHx8IHQgJiYgZCh0LCAib3IiKSB8fCB1KS5jYWxsKGMsIChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImlzUmVhZE9ubHkiKSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzUmVhZE9ubHkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDIyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogNjAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzMCwKICAgICAgICAgICAgICBjb2x1bW46IDE5NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAxMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTQ2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMTYwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIndlZWtkYXktc2NoZWR1bGUtZm9jdXNlZCAiOwogICAgICB9LAogICAgICAxMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAibWFyZ2luTGVmdCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMTU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogIiArIGUuZXNjYXBlRXhwcmVzc2lvbihlLmxhbWJkYSgoaSA9IChpID0gbyAmJiBhKG8sICJyb290IikpICYmIGEoaSwgInN0eWxlcyIpKSAmJiBhKGksICJtYXJnaW5SaWdodCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMTc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDE5OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgIGNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDIxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHMobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gcyh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBhLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzAsCiAgICAgICAgICAgICAgY29sdW1uOiA4OQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUgaGFuZGxlLXkiIHN0eWxlPSJsaW5lLWhlaWdodDogJyArIHIoZS5sYW1iZGEoKGkgPSBvICYmIHMobywgInJvb3QiKSkgJiYgcyhpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgJ3B4OyI+Jm5ic3A7PC9zcGFuPic7CiAgICAgIH0sCiAgICAgIDIzOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGEobiwgImZpIikgfHwgdCAmJiBhKHQsICJmaSIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImNhdGVnb3J5IikgOiBpLCAiPT09IiwgInRpbWUiLCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDI0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgzMywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzMsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3NCwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIDI0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IGUubGFtYmRhLAogICAgICAgICAgICBzID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBjID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHUgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGQgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gJyAgICAgICAgICAgICAgICA8ZGl2IGRhdGEtc2NoZWR1bGUtaWQ9IicgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlkIikgOiBpLCB0KSkgKyAnIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjYWxlbmRhcklkIikgOiBpLCB0KSkgKyAnIiBjbGFzcz0iJyArIHMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogdSkgPyBhLmNhbGwoYywgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAxMTQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZSAiICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDEzMQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNCwKICAgICAgICAgICAgICBjb2x1bW46IDE0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpbWUiXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6JyArIHMocigoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiIgKyBzKHIoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyAiICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNiwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS1idWxsZXQiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0idG9wOiAnICsgcyhyKChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgInNjaGVkdWxlQnVsbGV0VG9wIiksIHQpKSArICJweDtcbiIgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChjLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDI1LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgyNywgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMzgsCiAgICAgICAgICAgICAgY29sdW1uOiAyOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXG4gICAgICAgICAgICAgICAgICAgID48L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgcygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiB1KSA/IGEuY2FsbChjLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NSwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJcbicgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChjLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDI5LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSgzMSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiAyOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MiwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRpdGxlPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJyI+JyArIChudWxsICE9IChpID0gKGQobiwgInRpbWUtdG1wbCIpIHx8IHQgJiYgZCh0LCAidGltZS10bXBsIikgfHwgdSkuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDUzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU0LAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMjU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmXG4iOwogICAgICB9LAogICAgICAyNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDoiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIlxuIjsKICAgICAgfSwKICAgICAgMjk6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBhKHQsICJtb2RlbCIpIDogdCkgPyBhKGksICJjb2xvciIpIDogaSwgdCkpICsgIlxuIjsKICAgICAgfSwKICAgICAgMzE6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjojMzMzO1xuIjsKICAgICAgfSwKICAgICAgMzM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGMgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgdSA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBkYXRhLXNjaGVkdWxlLWlkPSInICsgcyhyKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpZCIpIDogaSwgdCkpICsgJyIgZGF0YS1jYWxlbmRhci1pZD0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY2FsZW5kYXJJZCIpIDogaSwgdCkpICsgJyIgY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHUpID8gYS5jYWxsKGMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMTAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMTE0CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUgIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKGMsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMTMxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDU3LAogICAgICAgICAgICAgIGNvbHVtbjogMjAwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDonICsgcyhyKChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgbGluZS1oZWlnaHQ6IiArIHMocigoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGJvcmRlci1yYWRpdXM6ICIgKyBzKHIoKGkgPSAoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzdHlsZXMiKSkgJiYgZChpLCAiYm9yZGVyUmFkaXVzIiksIHQpKSArICI7XG4iICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKGMsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZExlZnQiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDM0LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1OSwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYxLAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGQobiwgInVubGVzcyIpLmNhbGwoYywgbnVsbCAhPSB0ID8gZCh0LCAiZXhjZWVkUmlnaHQiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDM2LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MiwKICAgICAgICAgICAgICBjb2x1bW46IDIwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY0LAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAobnVsbCAhPSAoaSA9IGQobiwgImlmIikuY2FsbChjLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaXNGb2N1c2VkIikgOiBpLCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDM4LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg0MCwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNjUsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2OSwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgICAgICAgICAgICAgICAgICIgKyBzKHIobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImN1c3RvbVN0eWxlIikgOiBpLCB0KSkgKyAnIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBzKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IGQobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gZCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHUpID8gYS5jYWxsKGMsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcxLAogICAgICAgICAgICAgIGNvbHVtbjogMzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNzEsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpdGxlIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10aXRsZT0iJyArIHMocihudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAidGl0bGUiKSA6IGksIHQpKSArICciPicgKyAobnVsbCAhPSAoaSA9IChkKG4sICJzY2hlZHVsZS10bXBsIikgfHwgdCAmJiBkKHQsICJzY2hlZHVsZS10bXBsIikgfHwgdSkuY2FsbChjLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInNjaGVkdWxlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNzIsCiAgICAgICAgICAgICAgY29sdW1uOiA2NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3MiwKICAgICAgICAgICAgICBjb2x1bW46IDkwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiI7CiAgICAgIH0sCiAgICAgIDM0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAibWFyZ2luTGVmdCIpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgMzY6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEoKGkgPSAoaSA9IG8gJiYgYShvLCAicm9vdCIpKSAmJiBhKGksICJzdHlsZXMiKSkgJiYgYShpLCAibWFyZ2luUmlnaHQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDM4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYm9yZGVyLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiO1xuIjsKICAgICAgfSwKICAgICAgNDA6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIGNvbXBpbGVyOiBbOCwgIj49IDQuMy4wIl0sCiAgICAgIG1haW46IGZ1bmN0aW9uIG1haW4oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSBhKG4sICJlYWNoIikuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAibWF0cmljZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4MSwKICAgICAgICAgICAgICBjb2x1bW46IDExCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiI7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigzKSwKICAgICAgICBhID0gbigxKTsKCiAgICBmdW5jdGlvbiByKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMubW9udGhWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIGUub24oewogICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrCiAgICAgIH0sIHRoaXMpOwogICAgfQoKICAgIHIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLm1vbnRoVmlldyA9IHRoaXMuYmFzZUNvbnRyb2xsZXIgPSB0aGlzLmRyYWdIYW5kbGVyID0gbnVsbDsKICAgIH0sIHIucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcywKICAgICAgICAgIGwgPSB0aGlzLmJhc2VDb250cm9sbGVyLnNjaGVkdWxlcywKICAgICAgICAgIHIgPSBhLmNsb3Nlc3QoZS50YXJnZXQsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpKSB8fCBhLmNsb3Nlc3QoZS50YXJnZXQsIG8uY2xhc3NuYW1lKCIubW9udGgtbW9yZS1zY2hlZHVsZSIpKTsKICAgICAgKHQgPSBhLmNsb3Nlc3QoZS50YXJnZXQsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1leGNlZWQtaW4tbW9udGgiKSkpICYmIG4uZmlyZSgiY2xpY2tNb3JlIiwgewogICAgICAgIGRhdGU6IGkucGFyc2UoYS5nZXREYXRhKHQsICJ5bWQiKSksCiAgICAgICAgdGFyZ2V0OiB0LAogICAgICAgIHltZDogYS5nZXREYXRhKHQsICJ5bWQiKQogICAgICB9KSwgciAmJiBsLmRvV2hlbkhhcyhhLmdldERhdGEociwgImlkIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgbi5maXJlKCJjbGlja1NjaGVkdWxlIiwgewogICAgICAgICAgc2NoZWR1bGU6IHQsCiAgICAgICAgICBldmVudDogZS5vcmlnaW5FdmVudAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sIGwuQ3VzdG9tRXZlbnRzLm1peGluKHIpLCBlLmV4cG9ydHMgPSByOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGwgPSBuKDApLAogICAgICAgIG8gPSBuKDIpLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDE1KSwKICAgICAgICByID0gbigxKSwKICAgICAgICBzID0gbig2KSwKICAgICAgICBjID0gbigxOSksCiAgICAgICAgdSA9IG4oMTA1KSwKICAgICAgICBkID0gbig0KS5EYXRlLAogICAgICAgIGggPSAzMDA7CgogICAgZnVuY3Rpb24gcChlLCB0LCBuLCBsKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIgPSBlLCB0aGlzLm1vbnRoVmlldyA9IHQsIHRoaXMuYmFzZUNvbnRyb2xsZXIgPSBuLCB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IG51bGwsIHRoaXMuX2NhY2hlID0gbnVsbCwgdGhpcy5ndWlkZSA9IG5ldyB1KHRoaXMpLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICExLCB0aGlzLl9kaXNhYmxlRGJsQ2xpY2sgPSBsLmRpc2FibGVEYmxDbGljaywgdGhpcy5fZGlzYWJsZUNsaWNrID0gbC5kaXNhYmxlQ2xpY2ssIGUub24oImRyYWdTdGFydCIsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKSwgZS5vbigiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKSwgdGhpcy5fZGlzYWJsZURibENsaWNrID8gaCA9IDAgOiBzLm9uKHQuY29udGFpbmVyLCAiZGJsY2xpY2siLCB0aGlzLl9vbkRibENsaWNrLCB0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtKGUpIHsKICAgICAgcmV0dXJuIHIuY2xvc2VzdChlLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktZ3JpZCIpKSAmJiAhci5jbG9zZXN0KGUsIG8uY2xhc3NuYW1lKCIud2Vla2RheS1leGNlZWQtaW4tbW9udGgiKSk7CiAgICB9CgogICAgcC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlci5vZmYodGhpcyksIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLm1vbnRoVmlldyAmJiB0aGlzLm1vbnRoVmlldy5jb250YWluZXIgJiYgcy5vZmYodGhpcy5tb250aFZpZXcuY29udGFpbmVyLCAiZGJsY2xpY2siLCB0aGlzLl9vbkRibENsaWNrLCB0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMubW9udGhWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gdGhpcy5fY2FjaGUgPSB0aGlzLmd1aWRlID0gbnVsbDsKICAgIH0sIHAucHJvdG90eXBlLl9jcmVhdGVTY2hlZHVsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuZmlyZSgiYmVmb3JlQ3JlYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgaXNBbGxEYXk6IGUuaXNBbGxEYXksCiAgICAgICAgc3RhcnQ6IGUuc3RhcnQsCiAgICAgICAgZW5kOiBlLmVuZCwKICAgICAgICBndWlkZTogdGhpcy5ndWlkZS5ndWlkZSwKICAgICAgICB0cmlnZ2VyRXZlbnROYW1lOiBlLnRyaWdnZXJFdmVudAogICAgICB9KTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0OwogICAgICBtKGUudGFyZ2V0KSAmJiAodGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSBjKHRoaXMubW9udGhWaWV3KSwgdCA9IHRoaXMuZ2V0U2NoZWR1bGVEYXRhKGUub3JpZ2luRXZlbnQpLCB0aGlzLl9jYWNoZSA9IHsKICAgICAgICBzdGFydDogbmV3IGQodC5kYXRlKQogICAgICB9LCB0aGlzLmZpcmUoIm1vbnRoQ3JlYXRpb25EcmFnc3RhcnQiLCB0KSk7CiAgICB9LCBwLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHRoaXMuZ2V0U2NoZWR1bGVEYXRhICYmICh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpICYmIHRoaXMuZmlyZSgibW9udGhDcmVhdGlvbkRyYWciLCB0KTsKICAgIH0sIHAucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpcy5fY2FjaGU7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCB0aGlzLmdldFNjaGVkdWxlRGF0YSAmJiAoKHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSkgJiYgKGwuZW5kID0gbmV3IGQodC5kYXRlKSwgbC5pc0FsbERheSA9ICEwLCBuID0gW2wuc3RhcnQsIGwuZW5kXS5zb3J0KGEuY29tcGFyZS5udW0uYXNjKSwgbC5zdGFydCA9IG5ldyBkKG5bMF0pLCBsLmVuZCA9IGkuZW5kKG5bMV0pLCB0aGlzLl9jcmVhdGVTY2hlZHVsZShsKSksIHRoaXMuZmlyZSgibW9udGhDcmVhdGlvbkRyYWdlbmQiLCB0KSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSB0aGlzLl9jYWNoZSA9IG51bGwpOwogICAgfSwgcC5wcm90b3R5cGUuX29uRGJsQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwgbjsKICAgICAgbShlLnRhcmdldCkgJiYgKHQgPSBjKHRoaXMubW9udGhWaWV3KShlKSwgdGhpcy5maXJlKCJtb250aENyZWF0aW9uQ2xpY2siLCB0KSwgbiA9IHRoaXMuX2FkanVzdFN0YXJ0QW5kRW5kVGltZShuZXcgZCh0LmRhdGUpLCBuZXcgZCh0LmRhdGUpKSwgdGhpcy5fY3JlYXRlU2NoZWR1bGUoewogICAgICAgIHN0YXJ0OiBuLnN0YXJ0LAogICAgICAgIGVuZDogbi5lbmQsCiAgICAgICAgaXNBbGxEYXk6ICExLAogICAgICAgIHRyaWdnZXJFdmVudDogdC50cmlnZ2VyRXZlbnQKICAgICAgfSksIHRoaXMuX3JlcXVlc3RPbkNsaWNrID0gITEpOwogICAgfSwgcC5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsID0gdGhpczsKICAgICAgbShlLnRhcmdldCkgJiYgIXRoaXMuX2Rpc2FibGVDbGljayAmJiAodCA9IGModGhpcy5tb250aFZpZXcpKGUub3JpZ2luRXZlbnQpLCB0aGlzLl9yZXF1ZXN0T25DbGljayA9ICEwLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBsLl9yZXF1ZXN0T25DbGljayAmJiAobC5maXJlKCJtb250aENyZWF0aW9uQ2xpY2siLCB0KSwgbiA9IGwuX2FkanVzdFN0YXJ0QW5kRW5kVGltZShuZXcgZCh0LmRhdGUpLCBuZXcgZCh0LmRhdGUpKSwgbC5fY3JlYXRlU2NoZWR1bGUoewogICAgICAgICAgc3RhcnQ6IG4uc3RhcnQsCiAgICAgICAgICBlbmQ6IG4uZW5kLAogICAgICAgICAgaXNBbGxEYXk6ICExLAogICAgICAgICAgdHJpZ2dlckV2ZW50OiB0LnRyaWdnZXJFdmVudAogICAgICAgIH0pKSwgbC5fcmVxdWVzdE9uQ2xpY2sgPSAhMTsKICAgICAgfSwgaCkpOwogICAgfSwgcC5wcm90b3R5cGUuX2FkanVzdFN0YXJ0QW5kRW5kVGltZSA9IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBuID0gbmV3IGQoKSwKICAgICAgICAgIGwgPSBuLmdldEhvdXJzKCksCiAgICAgICAgICBvID0gbi5nZXRNaW51dGVzKCk7CiAgICAgIHJldHVybiBvID0gbyA8PSAzMCA/IDAgOiAzMCwgZS5zZXRIb3VycyhsLCBvLCAwLCAwKSwgdC5zZXRIb3VycyhsICsgMSwgbywgMCwgMCksIHsKICAgICAgICBzdGFydDogZSwKICAgICAgICBlbmQ6IHQKICAgICAgfTsKICAgIH0sIHAucHJvdG90eXBlLmludm9rZUNyZWF0aW9uQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHsKICAgICAgICBtb2RlbDogZQogICAgICB9OwogICAgICB0aGlzLmZpcmUoIm1vbnRoQ3JlYXRpb25DbGljayIsIHQpLCB0aGlzLl9jcmVhdGVTY2hlZHVsZSh7CiAgICAgICAgc3RhcnQ6IGUuc3RhcnQsCiAgICAgICAgZW5kOiBlLmVuZCwKICAgICAgICBpc0FsbERheTogZS5pc0FsbERheSwKICAgICAgICB0cmlnZ2VyRXZlbnQ6ICJtYW51YWwiCiAgICAgIH0pOwogICAgfSwgbC5DdXN0b21FdmVudHMubWl4aW4ocCksIGUuZXhwb3J0cyA9IHA7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMzUpOwoKICAgIGZ1bmN0aW9uIG8oZSkgewogICAgICB0aGlzLm1vbnRoQ3JlYXRpb24gPSBlLCB0aGlzLmd1aWRlID0gbnVsbCwgZS5vbih7CiAgICAgICAgbW9udGhDcmVhdGlvbkRyYWdzdGFydDogdGhpcy5fY3JlYXRlR3VpZGVFbGVtZW50LAogICAgICAgIG1vbnRoQ3JlYXRpb25EcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgbW9udGhDcmVhdGlvbkRyYWdlbmQ6IHRoaXMuX29uRHJhZ0VuZCwKICAgICAgICBtb250aENyZWF0aW9uQ2xpY2s6IHRoaXMuX2NyZWF0ZUd1aWRlRWxlbWVudAogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICBvLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLm1vbnRoQ3JlYXRpb24ub2ZmKHRoaXMpLCB0aGlzLmd1aWRlICYmIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmd1aWRlID0gdGhpcy5tb250aENyZWF0aW9uID0gbnVsbDsKICAgIH0sIG8ucHJvdG90eXBlLl9jcmVhdGVHdWlkZUVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLmd1aWRlID0gbmV3IGwoewogICAgICAgIGlzQ3JlYXRpb25Nb2RlOiAhMCwKICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICB0b3A6IDAKICAgICAgfSwgdGhpcy5tb250aENyZWF0aW9uLm1vbnRoVmlldyksIHRoaXMuZ3VpZGUuc3RhcnQoZSk7CiAgICB9LCBvLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5ndWlkZS51cGRhdGUoZS54LCBlLnkpOwogICAgfSwgby5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5ndWlkZSA9IG51bGw7CiAgICB9LCBlLmV4cG9ydHMgPSBvOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7CiAgICB2YXIgbCA9IG4oNyk7CiAgICBlLmV4cG9ydHMgPSAobC5kZWZhdWx0IHx8IGwpLnRlbXBsYXRlKHsKICAgICAgMTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxhbWJkYSwKICAgICAgICAgICAgYyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHIoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gYyhuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBjKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogZS5ob29rcy5oZWxwZXJNaXNzaW5nKSA/IGEuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMywKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDMsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1jcmVhdGlvbi1ndWlkZSIgc3R5bGU9ImJvcmRlcjogJyArIHIocyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYyh0LCAic3R5bGVzIikgOiB0KSA/IGMoaSwgImJvcmRlciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjogIiArIHIocyhudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYyh0LCAic3R5bGVzIikgOiB0KSA/IGMoaSwgImJhY2tncm91bmRDb2xvciIpIDogaSwgdCkpICsgJzsiPjwvZGl2PlxuJzsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZSJcbiAgICAgICAgc3R5bGU9ImhlaWdodDogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlSGVpZ2h0IikgOiBpLCB0KSkgKyAiOyBsaW5lLWhlaWdodDogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlSGVpZ2h0IikgOiBpLCB0KSkgKyAiOyBtYXJnaW4tdG9wOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAic2NoZWR1bGVHdXR0ZXIiKSA6IGksIHQpKSArICI7IGJvcmRlci1yYWRpdXM6IiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImJvcmRlclJhZGl1cyIpIDogaSwgdCkpICsgIjsgbWFyZ2luLWxlZnQ6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJtYXJnaW5MZWZ0IikgOiBpLCB0KSkgKyAiOyBtYXJnaW4tcmlnaHQ6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJtYXJnaW5SaWdodCIpIDogaSwgdCkpICsgIjtcbiAgICAgICAgICAgIGNvbG9yOiIgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJjb2xvciIpIHx8IChudWxsICE9IHQgPyBoKHQsICJjb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJjb2xvciIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMTgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNywKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIjtib3JkZXItY29sb3I6IiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImJvcmRlckNvbG9yIikgfHwgKG51bGwgIT0gdCA/IGgodCwgImJvcmRlckNvbG9yIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImJvcmRlckNvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA0MQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogNTYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiO2JhY2tncm91bmQtY29sb3I6IiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgImJnQ29sb3IiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiYmdDb2xvciIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJiZ0NvbG9yIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiA3NAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogODUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnIj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDgsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogMzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiaXNBbGxEYXkiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oNiwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogOSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEzLAogICAgICAgICAgICAgIGNvbHVtbjogMTkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTUsCiAgICAgICAgICAgICAgY29sdW1uOiAzNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXJlc2l6ZS1oYW5kbGUgaGFuZGxlLXkiIHN0eWxlPSJsaW5lLWhlaWdodDogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlSGVpZ2h0IikgOiBpLCB0KSkgKyAnOyI+Jm5ic3A7PC9kaXY+XG4gICAgPC9kaXY+XG4nOwogICAgICB9LAogICAgICA0OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IChhKG4sICJhbGxkYXktdG1wbCIpIHx8IHQgJiYgYSh0LCAiYWxsZGF5LXRtcGwiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHQsIHsKICAgICAgICAgIG5hbWU6ICJhbGxkYXktdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEwLAogICAgICAgICAgICAgIGNvbHVtbjogMzgKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4iOwogICAgICB9LAogICAgICA2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IChhKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGEodCwgInRpbWUtdG1wbCIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgdCwgewogICAgICAgICAgbmFtZTogInRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMzYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiXG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDI2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLWd1aWRlLWJsb2NrIiBzdHlsZT0idG9wOicgKyBjKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChhID0gbnVsbCAhPSAoYSA9IHUobiwgInRvcCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJ0b3AiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAidG9wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiA1NgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNjMKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAiO2hlaWdodDoiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJoZWlnaHQiKSB8fCAobnVsbCAhPSB0ID8gdSh0LCAiaGVpZ2h0IikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogImhlaWdodCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDgxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJztkaXNwbGF5Om5vbmUiPlxuJyArIChudWxsICE9IChpID0gdShuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gdCA/IHUodCwgImlzQ3JlYXRpb25Nb2RlIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiaWYiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDEsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDMsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE3LAogICAgICAgICAgICAgIGNvbHVtbjogMTEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9kaXY+XG4iOwogICAgICB9LAogICAgICB1c2VEYXRhOiAhMAogICAgfSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMiksCiAgICAgICAgaSA9IG4oMyksCiAgICAgICAgYSA9IG4oMSksCiAgICAgICAgciA9IG4oMTkpLAogICAgICAgIHMgPSBuKDEwOCksCiAgICAgICAgYyA9IG4oNCkuRGF0ZSwKICAgICAgICB1ID0gbig1KTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgdGhpcy5kcmFnSGFuZGxlciA9IGUsIHRoaXMubW9udGhWaWV3ID0gdCwgdGhpcy5iYXNlQ29udHJvbGxlciA9IG4sIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gbnVsbCwgdGhpcy5fY2FjaGUgPSBudWxsLCB0aGlzLmd1aWRlID0gbmV3IHModGhpcyksIGUub24oImRyYWdTdGFydCIsIHRoaXMuX29uRHJhZ1N0YXJ0LCB0aGlzKTsKICAgIH0KCiAgICBkLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih0aGlzKSwgdGhpcy5kcmFnSGFuZGxlciA9IHRoaXMubW9udGhWaWV3ID0gdGhpcy5iYXNlQ29udHJvbGxlciA9IG51bGw7CiAgICB9LCBkLnByb3RvdHlwZS5fdXBkYXRlU2NoZWR1bGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGkuZW5kKG5ldyBjKGUuZW5kKSksCiAgICAgICAgICBuID0gZS5zY2hlZHVsZSwKICAgICAgICAgIGwgPSB1LmdldFNjaGVkdWxlQ2hhbmdlcyhuLCBbImVuZCJdLCB7CiAgICAgICAgZW5kOiB0CiAgICAgIH0pOwogICAgICB0aGlzLmZpcmUoImJlZm9yZVVwZGF0ZVNjaGVkdWxlIiwgewogICAgICAgIHNjaGVkdWxlOiBuLAogICAgICAgIGNoYW5nZXM6IGwsCiAgICAgICAgc3RhcnQ6IG5ldyBjKG4uZ2V0U3RhcnRzKCkpLAogICAgICAgIGVuZDogdAogICAgICB9KTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGwsCiAgICAgICAgICBpID0gZS50YXJnZXQ7CiAgICAgIGEuaGFzQ2xhc3MoaSwgby5jbGFzc25hbWUoIndlZWtkYXktcmVzaXplLWhhbmRsZSIpKSAmJiAoaSA9IGEuY2xvc2VzdChpLCBvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2siKSkpICYmICh0ID0gYS5nZXREYXRhKGksICJpZCIpLCBuID0gdGhpcy5iYXNlQ29udHJvbGxlci5zY2hlZHVsZXMuaXRlbXNbdF0sIHRoaXMuZHJhZ0hhbmRsZXIub24oewogICAgICAgIGRyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICBkcmFnRW5kOiB0aGlzLl9vbkRyYWdFbmQKICAgICAgfSwgdGhpcyksIHRoaXMuZ2V0U2NoZWR1bGVEYXRhID0gcih0aGlzLm1vbnRoVmlldyksIChsID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpLnRhcmdldCA9IGksIGwubW9kZWwgPSBuLCB0aGlzLl9jYWNoZSA9IHsKICAgICAgICBzY2hlZHVsZTogbiwKICAgICAgICB0YXJnZXQ6IGksCiAgICAgICAgc3RhcnQ6IG5ldyBjKGwuZGF0ZSkKICAgICAgfSwgdGhpcy5maXJlKCJtb250aFJlc2l6ZURyYWdzdGFydCIsIGwpKTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdDsKICAgICAgdGhpcy5nZXRTY2hlZHVsZURhdGEgJiYgKHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSkgJiYgdGhpcy5maXJlKCJtb250aFJlc2l6ZURyYWciLCB0KTsKICAgIH0sIGQucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4sCiAgICAgICAgICBsLAogICAgICAgICAgbyA9IHRoaXMuX2NhY2hlOwogICAgICB0aGlzLmRyYWdIYW5kbGVyLm9mZih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgJiYgKCh0ID0gdGhpcy5nZXRTY2hlZHVsZURhdGEoZS5vcmlnaW5FdmVudCkpICYmIChuID0gbmV3IGMoby5zY2hlZHVsZS5nZXRTdGFydHMoKSksIGwgPSBuZXcgYyh0LmRhdGUpLCBvLmVuZCA9IGwsIG4gPD0gby5lbmQgJiYgdGhpcy5fdXBkYXRlU2NoZWR1bGUobykpLCB0aGlzLmZpcmUoIm1vbnRoUmVzaXplRHJhZ2VuZCIsIHQpLCB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IHRoaXMuX2NhY2hlID0gbnVsbCk7CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbihkKSwgZS5leHBvcnRzID0gZDsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDEpLAogICAgICAgICAgYSA9IG4oMzUpOwoKICAgICAgZnVuY3Rpb24gcihlKSB7CiAgICAgICAgdGhpcy5tb250aFJlc2l6ZSA9IGUsIHRoaXMuZWxlbWVudHMgPSBudWxsLCB0aGlzLmd1aWRlID0gbnVsbCwgZS5vbih7CiAgICAgICAgICBtb250aFJlc2l6ZURyYWdzdGFydDogdGhpcy5fb25EcmFnU3RhcnQsCiAgICAgICAgICBtb250aFJlc2l6ZURyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIG1vbnRoUmVzaXplRHJhZ2VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgICAgfSwgdGhpcyk7CiAgICAgIH0KCiAgICAgIHIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5tb250aFJlc2l6ZS5vZmYodGhpcyksIHRoaXMuZ3VpZGUuZGVzdHJveSgpLCB0aGlzLmd1aWRlID0gdGhpcy5tb250aFJlc2l6ZSA9IG51bGw7CiAgICAgIH0sIHIucHJvdG90eXBlLl9oaWRlU2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHRoaXMuZWxlbWVudHMgPSBpLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLSIgKyBlKSwgdGhpcy5tb250aFJlc2l6ZS5tb250aFZpZXcuY29udGFpbmVyLCAhMCksIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0pOwogICAgICB9LCByLnByb3RvdHlwZS5fc2hvd1NjaGVkdWxlQmxvY2tzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgZS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICB9KTsKICAgICAgfSwgci5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aGlzLmd1aWRlID0gbmV3IGEoewogICAgICAgICAgaXNSZXNpemVNb2RlOiAhMAogICAgICAgIH0sIHRoaXMubW9udGhSZXNpemUubW9udGhWaWV3KSwgdGhpcy5ndWlkZS5zdGFydChlKSwgdGhpcy5faGlkZVNjaGVkdWxlQmxvY2tzKGUubW9kZWwuY2lkKCkpLCBsLmJyb3dzZXIubXNpZSB8fCBpLmFkZENsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoInJlc2l6aW5nLXgiKSk7CiAgICAgIH0sIHIucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHRoaXMuZ3VpZGUudXBkYXRlKGUueCwgZS55KTsKICAgICAgfSwgci5wcm90b3R5cGUuX29uRHJhZ0VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9zaG93U2NoZWR1bGVCbG9ja3MoKSwgdGhpcy5ndWlkZS5kZXN0cm95KCksIHRoaXMuZWxlbWVudHMgPSB0aGlzLmd1aWRlID0gbnVsbCwgbC5icm93c2VyLm1zaWUgfHwgaS5yZW1vdmVDbGFzcyh0LmRvY3VtZW50LmJvZHksIG8uY2xhc3NuYW1lKCJyZXNpemluZy14IikpOwogICAgICB9LCBlLmV4cG9ydHMgPSByOwogICAgfSkuY2FsbCh0aGlzLCBuKDkpKTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbigxKSwKICAgICAgICBhID0gbigzKSwKICAgICAgICByID0gbigxOSksCiAgICAgICAgcyA9IG4oMTEwKSwKICAgICAgICBjID0gbig0KS5EYXRlOwoKICAgIGZ1bmN0aW9uIHUoZSwgdCwgbikgewogICAgICB0aGlzLmRyYWdIYW5kbGVyID0gZSwgdGhpcy5tb250aFZpZXcgPSB0LCB0aGlzLmJhc2VDb250cm9sbGVyID0gbiwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSBudWxsLCB0aGlzLl9jYWNoZSA9IG51bGwsIHRoaXMuZ3VpZGUgPSBuZXcgcyh0aGlzKSwgZS5vbigiZHJhZ1N0YXJ0IiwgdGhpcy5fb25EcmFnU3RhcnQsIHRoaXMpOwogICAgfQoKICAgIHUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHRoaXMpLCB0aGlzLmRyYWdIYW5kbGVyID0gdGhpcy5tb250aFZpZXcgPSB0aGlzLmJhc2VDb250cm9sbGVyID0gbnVsbDsKICAgIH0sIHUucHJvdG90eXBlLnVwZGF0ZVNjaGVkdWxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBlLm1vZGVsLAogICAgICAgICAgbiA9IHQuZHVyYXRpb24oKSwKICAgICAgICAgIGwgPSBhLnJhdyh0LnN0YXJ0KSwKICAgICAgICAgIG8gPSBuZXcgYyhlLmVuZCksCiAgICAgICAgICBpID0gbmV3IGMobyk7CiAgICAgIGkuc2V0SG91cnMobC5oLCBsLm0sIGwucywgbC5tcyksIHRoaXMuZmlyZSgiYmVmb3JlVXBkYXRlU2NoZWR1bGUiLCB7CiAgICAgICAgc2NoZWR1bGU6IHQsCiAgICAgICAgY2hhbmdlczogewogICAgICAgICAgc3RhcnQ6IGksCiAgICAgICAgICBlbmQ6IG5ldyBjKGkpLmFkZE1pbGxpc2Vjb25kcyhuKQogICAgICAgIH0sCiAgICAgICAgc3RhcnQ6IGksCiAgICAgICAgZW5kOiBuZXcgYyhpKS5hZGRNaWxsaXNlY29uZHMobikKICAgICAgfSk7CiAgICB9LCB1LnByb3RvdHlwZS5nZXRNb250aFNjaGVkdWxlQmxvY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IG8uY2xhc3NuYW1lKCIud2Vla2RheS1zY2hlZHVsZS1ibG9jayIpOwogICAgICByZXR1cm4gaS5jbG9zZXN0KGUsIHQpOwogICAgfSwgdS5wcm90b3R5cGUuZ2V0TW9yZUxheWVyU2NoZWR1bGVCbG9jayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0ID0gby5jbGFzc25hbWUoIi5tb250aC1tb3JlLXNjaGVkdWxlIik7CiAgICAgIHJldHVybiBpLmNsb3Nlc3QoZSwgdCk7CiAgICB9LCB1LnByb3RvdHlwZS5oYXNQZXJtaXNzaW9uVG9IYW5kbGUgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCwKICAgICAgICAgIG4gPSBudWxsOwogICAgICByZXR1cm4gaS5oYXNDbGFzcyhlLCBvLmNsYXNzbmFtZSgid2Vla2RheS1yZXNpemUtaGFuZGxlIikpID8gbnVsbCA6ICgodCA9IHRoaXMuZ2V0TW9udGhTY2hlZHVsZUJsb2NrKGUpKSA/IG4gPSBpLmdldERhdGEodCwgImlkIikgOiAodCA9IHRoaXMuZ2V0TW9yZUxheWVyU2NoZWR1bGVCbG9jayhlKSkgJiYgKG4gPSBpLmdldERhdGEodCwgImlkIiksIHRoaXMuZmlyZSgibW9udGhNb3ZlU3RhcnRfZnJvbV9tb3JlbGF5ZXIiKSksIG4pOwogICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gZS50YXJnZXQsCiAgICAgICAgICBsID0gdGhpcy5oYXNQZXJtaXNzaW9uVG9IYW5kbGUobiksCiAgICAgICAgICBvID0gdGhpcy5iYXNlQ29udHJvbGxlci5zY2hlZHVsZXMuaXRlbXNbbF07CiAgICAgIGwgJiYgbyAmJiAhby5pc1JlYWRPbmx5ICYmICFvLmlzUGVuZGluZyAmJiAodGhpcy5kcmFnSGFuZGxlci5vbih7CiAgICAgICAgZHJhZzogdGhpcy5fb25EcmFnLAogICAgICAgIGRyYWdFbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICB9LCB0aGlzKSwgdGhpcy5nZXRTY2hlZHVsZURhdGEgPSByKHRoaXMubW9udGhWaWV3KSwgKHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSkub3JpZ2luRXZlbnQgPSBlLm9yaWdpbkV2ZW50LCB0LnRhcmdldCA9IHRoaXMuZ2V0TW9udGhTY2hlZHVsZUJsb2NrKG4pLCB0Lm1vZGVsID0gbywgdGhpcy5fY2FjaGUgPSB7CiAgICAgICAgbW9kZWw6IG8sCiAgICAgICAgdGFyZ2V0OiBuLAogICAgICAgIHN0YXJ0OiBuZXcgYyhOdW1iZXIodC5kYXRlKSkKICAgICAgfSwgdGhpcy5maXJlKCJtb250aE1vdmVEcmFnc3RhcnQiLCB0KSk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQ7CiAgICAgIHRoaXMuZ2V0U2NoZWR1bGVEYXRhICYmICh0ID0gbC5leHRlbmQoewogICAgICAgIG9yaWdpbkV2ZW50OiBlLm9yaWdpbkV2ZW50CiAgICAgIH0sIHRoaXMuZ2V0U2NoZWR1bGVEYXRhKGUub3JpZ2luRXZlbnQpKSkgJiYgdGhpcy5maXJlKCJtb250aE1vdmVEcmFnIiwgdCk7CiAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuID0gdGhpcy5fY2FjaGU7CiAgICAgIHRoaXMuZHJhZ0hhbmRsZXIub2ZmKHsKICAgICAgICBkcmFnOiB0aGlzLl9vbkRyYWcsCiAgICAgICAgZHJhZ0VuZDogdGhpcy5fb25EcmFnRW5kCiAgICAgIH0sIHRoaXMpLCB0aGlzLmdldFNjaGVkdWxlRGF0YSAmJiAoKHQgPSB0aGlzLmdldFNjaGVkdWxlRGF0YShlLm9yaWdpbkV2ZW50KSkgJiYgKG4uZW5kID0gbmV3IGModC5kYXRlKSwgdGhpcy51cGRhdGVTY2hlZHVsZShuKSksIHRoaXMuZmlyZSgibW9udGhNb3ZlRHJhZ2VuZCIsIHQpLCB0aGlzLmdldFNjaGVkdWxlRGF0YSA9IHRoaXMuX2NhY2hlID0gbnVsbCk7CiAgICB9LCBsLkN1c3RvbUV2ZW50cy5taXhpbih1KSwgZS5leHBvcnRzID0gdTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgICBvID0gbigyKSwKICAgICAgICAgIGkgPSBuKDEpLAogICAgICAgICAgYSA9IG4oNiksCiAgICAgICAgICByID0gbigxNiksCiAgICAgICAgICBzID0gbigxMTEpLAogICAgICAgICAgYyA9IG4oMTQpOwoKICAgICAgZnVuY3Rpb24gdShlKSB7CiAgICAgICAgdGhpcy5tb250aE1vdmUgPSBlLCB0aGlzLmVsZW1lbnRzID0gbnVsbCwgdGhpcy5sYXllciA9IG51bGwsIGUub24oewogICAgICAgICAgbW9udGhNb3ZlRHJhZ3N0YXJ0OiB0aGlzLl9vbkRyYWdTdGFydCwKICAgICAgICAgIG1vbnRoTW92ZURyYWc6IHRoaXMuX29uRHJhZywKICAgICAgICAgIG1vbnRoTW92ZURyYWdlbmQ6IHRoaXMuX29uRHJhZ0VuZAogICAgICAgIH0sIHRoaXMpOwogICAgICB9CgogICAgICB1LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMubW9udGhNb3ZlLm9mZih0aGlzKSwgdGhpcy5fY2xlYXJHcmlkQmdDb2xvcigpLCB0aGlzLmxheWVyICYmIHRoaXMubGF5ZXIuZGVzdHJveSgpLCB0aGlzLmVsZW1lbnQgJiYgaS5yZW1vdmUodGhpcy5lbGVtZW50KSwgdGhpcy5tb250aE1vdmUgPSB0aGlzLmVsZW1lbnRzID0gdGhpcy5sYXllciA9IG51bGw7CiAgICAgIH0sIHUucHJvdG90eXBlLl9oaWRlT3JpZ2luU2NoZWR1bGVCbG9ja3MgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gby5jbGFzc25hbWUoIndlZWtkYXktc2NoZWR1bGUtYmxvY2stZHJhZ2dpbmctZGltIik7CiAgICAgICAgdGhpcy5lbGVtZW50cyA9IGkuZmluZChvLmNsYXNzbmFtZSgiLndlZWtkYXktc2NoZWR1bGUtYmxvY2stIiArIGUpLCB0aGlzLm1vbnRoTW92ZS5tb250aFZpZXcuY29udGFpbmVyLCAhMCksIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaS5hZGRDbGFzcyhlLCB0KTsKICAgICAgICB9KTsKICAgICAgfSwgdS5wcm90b3R5cGUuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSA9IG8uY2xhc3NuYW1lKCJ3ZWVrZGF5LXNjaGVkdWxlLWJsb2NrLWRyYWdnaW5nLWRpbSIpOwogICAgICAgIGwuZm9yRWFjaCh0aGlzLmVsZW1lbnRzLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgaS5yZW1vdmVDbGFzcyh0LCBlKTsKICAgICAgICB9KTsKICAgICAgfSwgdS5wcm90b3R5cGUuX2NsZWFyR3JpZEJnQ29sb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSBvLmNsYXNzbmFtZSgiLndlZWtkYXktZmlsbGVkIiksCiAgICAgICAgICAgIHQgPSBvLmNsYXNzbmFtZSgid2Vla2RheS1maWxsZWQiKSwKICAgICAgICAgICAgbiA9IGkuZmluZChlLCB0aGlzLm1vbnRoTW92ZS5tb250aFZpZXcuY29udGFpbmVyKTsKICAgICAgICBuICYmIGkucmVtb3ZlQ2xhc3MobiwgdCk7CiAgICAgIH0sIHUucHJvdG90eXBlLl91cGRhdGVHcmlkQmdDb2xvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHQgPSBpLmZpbmQoby5jbGFzc25hbWUoIi53ZWVrZGF5LWdyaWQtbGluZSIpLCB0aGlzLm1vbnRoTW92ZS5tb250aFZpZXcuY29udGFpbmVyLCAhMCksCiAgICAgICAgICAgIG4gPSBvLmNsYXNzbmFtZSgid2Vla2RheS1maWxsZWQiKSwKICAgICAgICAgICAgbCA9IGUueCArIGUuc2l6ZVggKiBlLnk7CiAgICAgICAgdGhpcy5fY2xlYXJHcmlkQmdDb2xvcigpLCB0ICYmIHRbbF0gJiYgaS5hZGRDbGFzcyh0W2xdLCBuKTsKICAgICAgfSwgdS5wcm90b3R5cGUuX29uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbiA9IHRoaXMubW9udGhNb3ZlLm1vbnRoVmlldywKICAgICAgICAgICAgdSA9IG4uY2hpbGRyZW4uc2luZ2xlKCksCiAgICAgICAgICAgIGQgPSB1Lm9wdGlvbnMsCiAgICAgICAgICAgIGggPSAxMDAgLyB1LmdldFJlbmRlckRhdGVSYW5nZSgpLmxlbmd0aCwKICAgICAgICAgICAgcCA9IGQuc2NoZWR1bGVHdXR0ZXIgKyBkLnNjaGVkdWxlSGVpZ2h0LAogICAgICAgICAgICBtID0gbi5jb250YWluZXIsCiAgICAgICAgICAgIGYgPSBhLmdldE1vdXNlUG9zaXRpb24oZS5vcmlnaW5FdmVudCwgbSksCiAgICAgICAgICAgIGcgPSBlLm1vZGVsLAogICAgICAgICAgICB5ID0gbmV3IHIobnVsbCwgbSk7CiAgICAgICAgdGhpcy5faGlkZU9yaWdpblNjaGVkdWxlQmxvY2tzKGcuY2lkKCkpLCB0aGlzLmxheWVyID0geSwgeS5zZXRTaXplKGggKyAiJSIsIHApLCB5LnNldFBvc2l0aW9uKGZbMF0sIGZbMV0pLCB5LnNldENvbnRlbnQocyh7CiAgICAgICAgICBtb2RlbDogbC5leHRlbmQoYy5jcmVhdGUoZyksIGcpLAogICAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICAgIHNjaGVkdWxlSGVpZ2h0OiBkLnNjaGVkdWxlSGVpZ2h0LAogICAgICAgICAgICBzY2hlZHVsZUJ1bGxldFRvcDogZC5zY2hlZHVsZUhlaWdodCAvIDMsCiAgICAgICAgICAgIGJvcmRlclJhZGl1czogbi5jb250cm9sbGVyLnRoZW1lLm1vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cwogICAgICAgICAgfQogICAgICAgIH0pKSwgeS5zaG93KCksIGwuYnJvd3Nlci5tc2llIHx8IGkuYWRkQ2xhc3ModC5kb2N1bWVudC5ib2R5LCBvLmNsYXNzbmFtZSgiZHJhZ2dpbmciKSk7CiAgICAgIH0sIHUucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0ID0gdGhpcy5tb250aE1vdmUubW9udGhWaWV3LmNvbnRhaW5lciwKICAgICAgICAgICAgbiA9IGEuZ2V0TW91c2VQb3NpdGlvbihlLm9yaWdpbkV2ZW50LCB0KTsKICAgICAgICB0aGlzLl91cGRhdGVHcmlkQmdDb2xvcihlKSwgdGhpcy5sYXllciAmJiB0aGlzLmxheWVyLnNldFBvc2l0aW9uKG5bMF0sIG5bMV0pOwogICAgICB9LCB1LnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX3Nob3dPcmlnaW5TY2hlZHVsZUJsb2NrcygpLCBsLmJyb3dzZXIubXNpZSB8fCBpLnJlbW92ZUNsYXNzKHQuZG9jdW1lbnQuYm9keSwgby5jbGFzc25hbWUoImRyYWdnaW5nIikpLCB0aGlzLl9jbGVhckdyaWRCZ0NvbG9yKCksIHRoaXMubGF5ZXIuZGVzdHJveSgpLCB0aGlzLmxheWVyID0gbnVsbDsKICAgICAgfSwgZS5leHBvcnRzID0gdTsKICAgIH0pLmNhbGwodGhpcywgbig5KSk7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgYm9yZGVyLWxlZnQ6M3B4IHNvbGlkICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAiO1xuICAgICAgICAgICAgIjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnICAgIDxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSB1KG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IHUodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDE3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE0LAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZS1idWxsZXQgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gdShuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyB1KHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiA1NQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNCwKICAgICAgICAgICAgICBjb2x1bW46IDY5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtYnVsbGV0LWZvY3VzZWQiIHN0eWxlPSJ0b3A6ICcgKyBjKGUubGFtYmRhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyB1KHQsICJzdHlsZXMiKSA6IHQpID8gdShpLCAic2NoZWR1bGVCdWxsZXRUb3AiKSA6IGksIHQpKSArICdweDsiPjwvc3Bhbj5cbic7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGUuZXNjYXBlRXhwcmVzc2lvbigiZnVuY3Rpb24iID09IHR5cGVvZiAoaSA9IG51bGwgIT0gKGkgPSBhKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGEodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGkgOiBlLmhvb2tzLmhlbHBlck1pc3NpbmcpID8gaS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDExMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDEyNAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBpKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpdGxlLWZvY3VzZWQiJzsKICAgICAgfSwKICAgICAgNzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IChhKG4sICJhbGxkYXktdG1wbCIpIHx8IHQgJiYgYSh0LCAiYWxsZGF5LXRtcGwiKSB8fCBlLmhvb2tzLmhlbHBlck1pc3NpbmcpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiYWxsZGF5LXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTgsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIjsKICAgICAgfSwKICAgICAgOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICIgKyAobnVsbCAhPSAoaSA9IChhKG4sICJ0aW1lLXRtcGwiKSB8fCB0ICYmIGEodCwgInRpbWUtdG1wbCIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJ0aW1lLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyMCwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIlxuIjsKICAgICAgfSwKICAgICAgY29tcGlsZXI6IFs4LCAiPj0gNC4zLjAiXSwKICAgICAgbWFpbjogZnVuY3Rpb24gbWFpbihlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9ICJmdW5jdGlvbiIsCiAgICAgICAgICAgIHUgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIGQgPSBlLmxhbWJkYSwKICAgICAgICAgICAgaCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAibW9udGgtZ3VpZGUgIiArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAzOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxLAogICAgICAgICAgICAgIGNvbHVtbjogNTIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtZ3VpZGUtZm9jdXNlZCJcbiAgICAgc3R5bGU9InRvcDogLTUwJTtcbiAgICAgICAgICAgIGxlZnQ6IC01MCU7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjonICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJkcmFnQmdDb2xvciIpIDogaSwgdCkpICsgIjtcbiAgICAgICAgICAgIGhlaWdodDoiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAic2NoZWR1bGVIZWlnaHQiKSA6IGksIHQpKSArICJweDtcbiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJzY2hlZHVsZUhlaWdodCIpIDogaSwgdCkpICsgInB4O1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImJvcmRlclJhZGl1cyIpIDogaSwgdCkpICsgIjtcbiIgKyAobnVsbCAhPSAoaSA9IGgobiwgImlmIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNBbGxEYXkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAxMgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDE5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJyI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJ1bmxlc3MiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0FsbERheSIpIDogaSwgewogICAgICAgICAgbmFtZTogInVubGVzcyIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTMsCiAgICAgICAgICAgICAgY29sdW1uOiA0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE1LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAnICAgIDxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAibW9udGgtbW92ZS1ndWlkZSAiICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNiwKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIndlZWtkYXktc2NoZWR1bGUtdGl0bGUgIiArIChudWxsICE9IChpID0gaChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaXNBbGxEYXkiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJ1bmxlc3MiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDUsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5ub29wLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDE2LAogICAgICAgICAgICAgIGNvbHVtbjogODQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMTYsCiAgICAgICAgICAgICAgY29sdW1uOiAxNjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPlxuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0FsbERheSIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSg3LCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUucHJvZ3JhbSg5LCBvLCAwKSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxNywKICAgICAgICAgICAgICBjb2x1bW46IDgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjEsCiAgICAgICAgICAgICAgY29sdW1uOiAxNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICcgICAgPC9kaXY+XG48L2Rpdj5cbjxkaXYgY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNCwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMjYKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtZ3VpZGUtY292ZXIiIHN0eWxlPSJoZWlnaHQ6JyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInNjaGVkdWxlSGVpZ2h0IikgOiBpLCB0KSkgKyAicHg7IGJvcmRlci1yYWRpdXM6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJib3JkZXJSYWRpdXMiKSA6IGksIHQpKSArICc7Ij48L2Rpdj5cbic7CiAgICAgIH0sCiAgICAgIHVzZURhdGE6ICEwCiAgICB9KTsKICB9LCBmdW5jdGlvbiAoZSwgdCwgbikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsID0gbigwKSwKICAgICAgICBvID0gbigyKSwKICAgICAgICBpID0gbig2KSwKICAgICAgICBhID0gbigxKSwKICAgICAgICByID0gbig4KSwKICAgICAgICBzID0gbigxNiksCiAgICAgICAgYyA9IG4oNSksCiAgICAgICAgdSA9IG4oMTEzKTsKCiAgICBmdW5jdGlvbiBkKGUsIHQsIG4pIHsKICAgICAgci5jYWxsKHRoaXMsIHQpLCB0aGlzLmxheWVyID0gbmV3IHMobnVsbCwgdCksIHRoaXMuX3ZpZXdNb2RlbCA9IG51bGwsIHRoaXMub3B0aW9ucyA9IGwuZXh0ZW5kKHsKICAgICAgICBtb3JlTGF5ZXJTaXplOiB7CiAgICAgICAgICB3aWR0aDogbnVsbCwKICAgICAgICAgIGhlaWdodDogbnVsbAogICAgICAgIH0sCiAgICAgICAgc2NoZWR1bGVIZWlnaHQ6IHBhcnNlSW50KG4ubW9udGguc2NoZWR1bGUuaGVpZ2h0LCAxMCkgfHwgMTgsCiAgICAgICAgc2NoZWR1bGVHdXR0ZXI6IHBhcnNlSW50KG4ubW9udGguc2NoZWR1bGUubWFyZ2luVG9wLCAxMCkgfHwgMiwKICAgICAgICBzY2hlZHVsZUJ1bGxldFRvcDogKHBhcnNlSW50KG4ubW9udGguc2NoZWR1bGUuaGVpZ2h0LCAxMCkgfHwgMTgpIC8gMywKICAgICAgICBib3JkZXJSYWRpdXM6IG4ubW9udGguc2NoZWR1bGUuYm9yZGVyUmFkaXVzCiAgICAgIH0sIGUpLCB0aGlzLnRoZW1lID0gbiwgaS5vbih0LCAiY2xpY2siLCB0aGlzLl9vbkNsaWNrLCB0aGlzKTsKICAgIH0KCiAgICBsLmluaGVyaXQoZCwgciksIGQucHJvdG90eXBlLl9vbkNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIHQgPSBpLmdldEV2ZW50VGFyZ2V0KGUpLAogICAgICAgICAgbiA9IG8uY2xhc3NuYW1lKCJtb250aC1tb3JlLWNsb3NlIik7CiAgICAgIChhLmhhc0NsYXNzKHQsIG4pIHx8IGEuY2xvc2VzdCh0LCAiLiIgKyBuKSkgJiYgdGhpcy5oaWRlKCk7CiAgICB9LCBkLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IGkuZ2V0RXZlbnRUYXJnZXQoZSk7CiAgICAgIGEuY2xvc2VzdCh0LCBvLmNsYXNzbmFtZSgiLm1vbnRoLW1vcmUiKSkgfHwgdGhpcy5oaWRlKCk7CiAgICB9LCBkLnByb3RvdHlwZS5fZ2V0UmVuZGVyUG9zaXRpb24gPSBmdW5jdGlvbiAoZSwgdCkgewogICAgICB2YXIgbiA9IGkuZ2V0TW91c2VQb3NpdGlvbih7CiAgICAgICAgY2xpZW50WDogYS5nZXRQb3NpdGlvbihlKVswXSwKICAgICAgICBjbGllbnRZOiBhLmdldFBvc2l0aW9uKHQpWzFdCiAgICAgIH0sIHRoaXMuY29udGFpbmVyKSwKICAgICAgICAgIGwgPSBhLmdldFNpemUodGhpcy5jb250YWluZXIpLAogICAgICAgICAgbyA9IG5bMF0gLSA1LAogICAgICAgICAgciA9IG5bMV0gLSA1OwogICAgICByZXR1cm4gW28gPSBjLnJhdGlvKGxbMF0sIDEwMCwgbyksIHIgPSBjLnJhdGlvKGxbMV0sIDEwMCwgcildOwogICAgfSwgZC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5sYXllci5kZXN0cm95KCksIHRoaXMubGF5ZXIgPSBudWxsLCBpLm9mZih0aGlzLmNvbnRhaW5lciwgImNsaWNrIiwgdGhpcy5fb25DbGljaywgdGhpcyksIGkub2ZmKGRvY3VtZW50LmJvZHksICJtb3VzZWRvd24iLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyksIHIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTsKICAgIH0sIGQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIHIsCiAgICAgICAgICBzLAogICAgICAgICAgYyA9IGEuY2xvc2VzdChlLnRhcmdldCwgby5jbGFzc25hbWUoIi53ZWVrZGF5LWdyaWQtbGluZSIpKSwKICAgICAgICAgIGQgPSBhLmNsb3Nlc3QoYywgby5jbGFzc25hbWUoIi5tb250aC13ZWVrLWl0ZW0iKSksCiAgICAgICAgICBoID0gdGhpcy5sYXllciwKICAgICAgICAgIHAgPSB0aGlzLAogICAgICAgICAgbSA9IHRoaXMuX2dldFJlbmRlclBvc2l0aW9uKGMsIGQpLAogICAgICAgICAgZiA9IGEuZ2V0U2l6ZShkKVsxXSArIDEwLAogICAgICAgICAgZyA9IGMub2Zmc2V0V2lkdGggKyAxMCwKICAgICAgICAgIHkgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBTID0geS5tb3JlTGF5ZXJTaXplLAogICAgICAgICAgXyA9IHRoaXMuX2dldFN0eWxlcyh0aGlzLnRoZW1lKSwKICAgICAgICAgIEMgPSAiIiwKICAgICAgICAgIHYgPSBhLmdldFNpemUodGhpcy5jb250YWluZXIpLAogICAgICAgICAgRSA9IG1bMF0sCiAgICAgICAgICB3ID0gbVsxXTsKCiAgICAgIHRoaXMuX3ZpZXdNb2RlbCA9IGwuZXh0ZW5kKGUsIHsKICAgICAgICBzY2hlZHVsZUd1dHRlcjogeS5zY2hlZHVsZUd1dHRlciwKICAgICAgICBzY2hlZHVsZUhlaWdodDogeS5zY2hlZHVsZUhlaWdodCwKICAgICAgICBzY2hlZHVsZUJ1bGxldFRvcDogeS5zY2hlZHVsZUJ1bGxldFRvcCwKICAgICAgICBib3JkZXJSYWRpdXM6IHkuYm9yZGVyUmFkaXVzLAogICAgICAgIHN0eWxlczogXwogICAgICB9KSwgZyA9IE1hdGgubWF4KGcsIDI4MCksIEMgPSBwYXJzZUludChfLnRpdGxlSGVpZ2h0LCAxMCksIEMgKz0gcGFyc2VJbnQoXy50aXRsZU1hcmdpbkJvdHRvbSwgMTApLCBlLnNjaGVkdWxlcy5sZW5ndGggPD0gMTAgPyBDICs9ICh5LnNjaGVkdWxlR3V0dGVyICsgeS5zY2hlZHVsZUhlaWdodCkgKiBlLnNjaGVkdWxlcy5sZW5ndGggOiBDICs9IDEwICogKHkuc2NoZWR1bGVHdXR0ZXIgKyB5LnNjaGVkdWxlSGVpZ2h0KSwgQyArPSBwYXJzZUludChfLnBhZGRpbmdCb3R0b20sIDEwKSwgQyArPSA1LCBTLndpZHRoICYmIChnID0gUy53aWR0aCksIFMuaGVpZ2h0ICYmIChDID0gUy5oZWlnaHQpLCAoaXNOYU4oQykgfHwgQyA8IGYpICYmIChDID0gZiksIGguc2V0Q29udGVudCh1KGUpKSwgdCA9IEUgKiB2WzBdIC8gMTAwLCBuID0gdyAqIHZbMV0gLyAxMDAsIHIgPSB0ICsgZyA+PSB2WzBdLCBzID0gbiArIEMgPj0gdlsxXSwgRSArPSAiJSIsIHcgKz0gIiUiLCByICYmIHMgPyBoLnNldExUUkIoewogICAgICAgIHJpZ2h0OiAwLAogICAgICAgIGJvdHRvbTogMAogICAgICB9KSA6ICFyICYmIHMgPyBoLnNldExUUkIoewogICAgICAgIGxlZnQ6IEUsCiAgICAgICAgYm90dG9tOiAwCiAgICAgIH0pIDogciAmJiAhcyA/IGguc2V0TFRSQih7CiAgICAgICAgcmlnaHQ6IDAsCiAgICAgICAgdG9wOiB3CiAgICAgIH0pIDogaC5zZXRQb3NpdGlvbihFLCB3KSwgaC5zZXRTaXplKGcsIEMpLCBoLnNob3coKSwgbC5kZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgaS5vbihkb2N1bWVudC5ib2R5LCAibW91c2Vkb3duIiwgcC5fb25Nb3VzZURvd24sIHApOwogICAgICB9KSgpOwogICAgfSwgZC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5sYXllci5oaWRlKCksIGkub2ZmKGRvY3VtZW50LmJvZHksICJtb3VzZWRvd24iLCB0aGlzLl9vbk1vdXNlRG93biwgdGhpcyk7CiAgICB9LCBkLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl92aWV3TW9kZWwgJiYgdGhpcy5sYXllci5zZXRDb250ZW50KHUodGhpcy5fdmlld01vZGVsKSk7CiAgICB9LCBkLnByb3RvdHlwZS5nZXRNb3JlVmlld0VsZW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhLmZpbmQoby5jbGFzc25hbWUoIi5tb250aC1tb3JlIiksIHRoaXMubGF5ZXIuY29udGFpbmVyKTsKICAgIH0sIGQucHJvdG90eXBlLl9nZXRTdHlsZXMgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdCA9IHt9LAogICAgICAgICAgbiA9ICIiOwogICAgICByZXR1cm4gZSAmJiAodC5ib3JkZXIgPSBlLm1vbnRoLm1vcmVWaWV3LmJvcmRlciB8fCBlLmNvbW1vbi5ib3JkZXIsIHQuYm94U2hhZG93ID0gZS5tb250aC5tb3JlVmlldy5ib3hTaGFkb3csIHQuYmFja2dyb3VuZENvbG9yID0gZS5tb250aC5tb3JlVmlldy5iYWNrZ3JvdW5kQ29sb3IgfHwgZS5jb21tb24uYmFja2dyb3VuZENvbG9yLCB0LnBhZGRpbmdCb3R0b20gPSBlLm1vbnRoLm1vcmVWaWV3LnBhZGRpbmdCb3R0b20sIHQudGl0bGVIZWlnaHQgPSBlLm1vbnRoLm1vcmVWaWV3VGl0bGUuaGVpZ2h0LCB0LnRpdGxlTWFyZ2luQm90dG9tID0gZS5tb250aC5tb3JlVmlld1RpdGxlLm1hcmdpbkJvdHRvbSwgdC50aXRsZUJhY2tncm91bmRDb2xvciA9IGUubW9udGgubW9yZVZpZXdUaXRsZS5iYWNrZ3JvdW5kQ29sb3IsIHQudGl0bGVCb3JkZXJCb3R0b20gPSBlLm1vbnRoLm1vcmVWaWV3VGl0bGUuYm9yZGVyQm90dG9tLCB0LnRpdGxlUGFkZGluZyA9IGUubW9udGgubW9yZVZpZXdUaXRsZS5wYWRkaW5nLCB0Lmxpc3RQYWRkaW5nID0gZS5tb250aC5tb3JlVmlld0xpc3QucGFkZGluZywgbiA9ICJjYWxjKDEwMCUiLCBwYXJzZUludCh0LnRpdGxlSGVpZ2h0LCAxMCkgJiYgKG4gKz0gIiAtICIgKyB0LnRpdGxlSGVpZ2h0KSwgcGFyc2VJbnQodC50aXRsZU1hcmdpbkJvdHRvbSwgMTApICYmIChuICs9ICIgLSAiICsgdC50aXRsZU1hcmdpbkJvdHRvbSksIG4gKz0gIikiLCB0Lmxpc3RIZWlnaHQgPSBuKSwgdDsKICAgIH0sIGUuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgIHZhciBsID0gbig3KTsKICAgIGUuZXhwb3J0cyA9IChsLmRlZmF1bHQgfHwgbCkudGVtcGxhdGUoewogICAgICAxOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBudWxsICE9IChpID0gKGEobiwgImZpIikgfHwgdCAmJiBhKHQsICJmaSIpIHx8IGUuaG9va3MuaGVscGVyTWlzc2luZykuY2FsbChudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImlzQWxsRGF5IikgOiBpLCAifHwiLCBudWxsICE9IHQgPyBhKHQsICJoYXNNdWx0aURhdGVzIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAiZmkiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBmbjogZS5wcm9ncmFtKDIsIG8sIDApLAogICAgICAgICAgaW52ZXJzZTogZS5wcm9ncmFtKDcsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDksCiAgICAgICAgICAgICAgY29sdW1uOiA4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDY1LAogICAgICAgICAgICAgIGNvbHVtbjogMTUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIjsKICAgICAgfSwKICAgICAgMjogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIHIgPSBudWxsICE9IHQgPyB0IDogZS5udWxsQ29udGV4dCB8fCB7fSwKICAgICAgICAgICAgcyA9IGUuaG9va3MuaGVscGVyTWlzc2luZywKICAgICAgICAgICAgYyA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgdSA9IGUubGFtYmRhLAogICAgICAgICAgICBkID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGRhdGEtaWQ9IicgKyBjKChkKG4sICJzdGFtcCIpIHx8IHQgJiYgZCh0LCAic3RhbXAiKSB8fCBzKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAic3RhbXAiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTAsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMCwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgKyAnIlxuICAgICAgICAgICAgICAgIGRhdGEtc2NoZWR1bGUtaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlkIikgOiBpLCB0KSkgKyAnIiBkYXRhLWNhbGVuZGFyLWlkPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjYWxlbmRhcklkIikgOiBpLCB0KSkgKyAnIlxuICAgICAgICAgICAgICAgIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDIzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogMzcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAibW9udGgtbW9yZS1zY2hlZHVsZSAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDU3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEyLAogICAgICAgICAgICAgIGNvbHVtbjogNzEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAibW9udGgtbW9yZS1hbGxkYXkgIiArIGMoImZ1bmN0aW9uIiA9PSB0eXBlb2YgKGEgPSBudWxsICE9IChhID0gZChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBkKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTIsCiAgICAgICAgICAgICAgY29sdW1uOiA4OQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxMiwKICAgICAgICAgICAgICBjb2x1bW46IDEwMwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLXRpdGxlIlxuICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6ICcgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBsaW5lLWhlaWdodDogIiArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IG1hcmdpbi10b3A6ICIgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVHdXR0ZXIiKSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgYyh1KChpID0gbyAmJiBkKG8sICJyb290IikpICYmIGQoaSwgImJvcmRlclJhZGl1cyIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oNSwgbywgMCksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMTQsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAxOCwKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICAgICAgICAgICAgICAgICAgIiArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiY3VzdG9tU3R5bGUiKSA6IGksIHQpKSArICciPlxuICAgICAgICAgICAgICAgICAgICAnICsgKG51bGwgIT0gKGkgPSAoZChuLCAiYWxsZGF5LXRtcGwiKSB8fCB0ICYmIGQodCwgImFsbGRheS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogImFsbGRheS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIwLAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjAsCiAgICAgICAgICAgICAgY29sdW1uOiA0MwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICJcbiAgICAgICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgMzogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1sZWZ0OjNweCBzb2xpZCAiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDU6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sYW1iZGEsCiAgICAgICAgICAgIHIgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHMgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiOyBiYWNrZ3JvdW5kLWNvbG9yOiIgKyByKGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IHModCwgIm1vZGVsIikgOiB0KSA/IHMoaSwgImJnQ29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1sZWZ0OjNweCBzb2xpZCAiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJib3JkZXJDb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG51bGwgIT0gKGkgPSAoYShuLCAiZmkiKSB8fCB0ICYmIGEodCwgImZpIikgfHwgZS5ob29rcy5oZWxwZXJNaXNzaW5nKS5jYWxsKG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LCBudWxsICE9IChpID0gbnVsbCAhPSB0ID8gYSh0LCAibW9kZWwiKSA6IHQpID8gYShpLCAiY2F0ZWdvcnkiKSA6IGksICI9PT0iLCAidGltZSIsIHsKICAgICAgICAgIG5hbWU6ICJmaSIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTcsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDIzLAogICAgICAgICAgICAgIGNvbHVtbjogMTIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjQsCiAgICAgICAgICAgICAgY29sdW1uOiAxOQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiOwogICAgICB9LAogICAgICA4OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICB1ID0gZS5sYW1iZGEsCiAgICAgICAgICAgIGQgPSAiZnVuY3Rpb24iLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICcgICAgICAgICAgICAgICAgPGRpdiBkYXRhLWlkPSInICsgYygoaChuLCAic3RhbXAiKSB8fCB0ICYmIGgodCwgInN0YW1wIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInN0YW1wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI0LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjQsCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS1zY2hlZHVsZS1pZD0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPSInICsgYyhfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGQgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDQxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgIm1vbnRoLW1vcmUtc2NoZWR1bGUgIiArIGMoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBkID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogNjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjYsCiAgICAgICAgICAgICAgY29sdW1uOiA3NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICJ3ZWVrZGF5LXNjaGVkdWxlICIgKyBjKF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gZCA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAyNiwKICAgICAgICAgICAgICBjb2x1bW46IDkyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDI2LAogICAgICAgICAgICAgIGNvbHVtbjogMTA2CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ3dlZWtkYXktc2NoZWR1bGUtdGltZSJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogJyArIGModSgoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiAiICsgYyh1KChpID0gbyAmJiBoKG8sICJyb290IikpICYmIGgoaSwgInNjaGVkdWxlSGVpZ2h0IiksIHQpKSArICJweDsgbWFyZ2luLXRvcDogIiArIGModSgoaSA9IG8gJiYgaChvLCAicm9vdCIpKSAmJiBoKGksICJzY2hlZHVsZUd1dHRlciIpLCB0KSkgKyAicHg7IiArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAibW9kZWwiKSA6IHQpID8gaChpLCAiY3VzdG9tU3R5bGUiKSA6IGksIHQpKSArICciPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJyArIGMoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBkID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDI4LAogICAgICAgICAgICAgIGNvbHVtbjogMzMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMjgsCiAgICAgICAgICAgICAgY29sdW1uOiA0NwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICd3ZWVrZGF5LXNjaGVkdWxlLWJ1bGxldCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ0b3A6ICcgKyBjKHUoKGkgPSBvICYmIGgobywgInJvb3QiKSkgJiYgaChpLCAic2NoZWR1bGVCdWxsZXRUb3AiKSwgdCkpICsgInB4O1xuIiArIChudWxsICE9IChpID0gaChuLCAiaWYiKS5jYWxsKHIsIG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJpc0ZvY3VzZWQiKSA6IGksIHsKICAgICAgICAgIG5hbWU6ICJpZiIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGZuOiBlLnByb2dyYW0oOSwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTEsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDMwLAogICAgICAgICAgICAgIGNvbHVtbjogMjgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogMzQsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IicgKyBjKF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gZCA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiAzNSwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDM1LAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSInICsgKG51bGwgIT0gKGkgPSBoKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgIm1vZGVsIikgOiB0KSA/IGgoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxMywgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMTUsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDM2LAogICAgICAgICAgICAgIGNvbHVtbjogMzEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDEsCiAgICAgICAgICAgICAgY29sdW1uOiAzNQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRpdGxlPSInICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCkgPyBoKGksICJ0aXRsZSIpIDogaSwgdCkpICsgJyI+JyArIChudWxsICE9IChpID0gKGgobiwgInRpbWUtdG1wbCIpIHx8IHQgJiYgaCh0LCAidGltZS10bXBsIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInRpbWUtdG1wbCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0MiwKICAgICAgICAgICAgICBjb2x1bW46IDUzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQyLAogICAgICAgICAgICAgIGNvbHVtbjogNzQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pKSA/IGkgOiAiIikgKyAiPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgOTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmZmZmZcbiI7CiAgICAgIH0sCiAgICAgIDExOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImJvcmRlckNvbG9yIikgOiBpLCB0KSkgKyAiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsKICAgICAgfSwKICAgICAgMTM6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICIgKyBlLmVzY2FwZUV4cHJlc3Npb24oZS5sYW1iZGEobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGEodCwgIm1vZGVsIikgOiB0KSA/IGEoaSwgImNvbG9yIikgOiBpLCB0KSkgKyAiXG4iOwogICAgICB9LAogICAgICAxNTogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiMzMzM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsKICAgICAgfSwKICAgICAgMTc6IGZ1bmN0aW9uIF8oZSwgdCwgbiwgbCwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhLAogICAgICAgICAgICByID0gbnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sCiAgICAgICAgICAgIHMgPSBlLmhvb2tzLmhlbHBlck1pc3NpbmcsCiAgICAgICAgICAgIGMgPSBlLmVzY2FwZUV4cHJlc3Npb24sCiAgICAgICAgICAgIHUgPSBlLmxhbWJkYSwKICAgICAgICAgICAgZCA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAnPGRpdiBkYXRhLWlkPSInICsgYygoZChuLCAic3RhbXAiKSB8fCB0ICYmIGQodCwgInN0YW1wIikgfHwgcykuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCwgewogICAgICAgICAgbmFtZTogInN0YW1wIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ1LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNDUsCiAgICAgICAgICAgICAgY29sdW1uOiA0NQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpICsgJyJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS1zY2hlZHVsZS1pZD0iJyArIGModShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQpID8gZChpLCAiaWQiKSA6IGksIHQpKSArICciIGRhdGEtY2FsZW5kYXItaWQ9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImNhbGVuZGFySWQiKSA6IGksIHQpKSArICciXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDI3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNDEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAibW9udGgtbW9yZS1zY2hlZHVsZSAiICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDYxCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogNzUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAid2Vla2RheS1zY2hlZHVsZSAiICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxOCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDcsCiAgICAgICAgICAgICAgY29sdW1uOiA5MgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0NywKICAgICAgICAgICAgICBjb2x1bW46IDE2MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICciXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6JyArIGModSgoaSA9IG8gJiYgZChvLCAicm9vdCIpKSAmJiBkKGksICJzY2hlZHVsZUhlaWdodCIpLCB0KSkgKyAicHg7IGxpbmUtaGVpZ2h0OiIgKyBjKHUoKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic2NoZWR1bGVIZWlnaHQiKSwgdCkpICsgInB4OyBib3JkZXItcmFkaXVzOiAiICsgYyh1KChpID0gKGkgPSBvICYmIGQobywgInJvb3QiKSkgJiYgZChpLCAic3R5bGVzIikpICYmIGQoaSwgImJvcmRlclJhZGl1cyIpLCB0KSkgKyAiO1xuIiArIChudWxsICE9IChpID0gZChuLCAidW5sZXNzIikuY2FsbChyLCBudWxsICE9IHQgPyBkKHQsICJleGNlZWRMZWZ0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyMCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNDksCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1MSwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJ1bmxlc3MiKS5jYWxsKHIsIG51bGwgIT0gdCA/IGQodCwgImV4Y2VlZFJpZ2h0IikgOiB0LCB7CiAgICAgICAgICBuYW1lOiAidW5sZXNzIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyMiwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLm5vb3AsCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNTIsCiAgICAgICAgICAgICAgY29sdW1uOiAyMAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA1NCwKICAgICAgICAgICAgICBjb2x1bW46IDMxCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgKG51bGwgIT0gKGkgPSBkKG4sICJpZiIpLmNhbGwociwgbnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgImlzRm9jdXNlZCIpIDogaSwgewogICAgICAgICAgbmFtZTogImlmIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgyNCwgbywgMCksCiAgICAgICAgICBpbnZlcnNlOiBlLnByb2dyYW0oMjYsIG8sIDApLAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDU1LAogICAgICAgICAgICAgIGNvbHVtbjogMjAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNTksCiAgICAgICAgICAgICAgY29sdW1uOiAyNwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICIgICAgICAgICAgICAgICAgICAgICAgICAiICsgYyh1KG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBkKHQsICJtb2RlbCIpIDogdCkgPyBkKGksICJjdXN0b21TdHlsZSIpIDogaSwgdCkpICsgJyI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSInICsgYygiZnVuY3Rpb24iID09IHR5cGVvZiAoYSA9IG51bGwgIT0gKGEgPSBkKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGQodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2MSwKICAgICAgICAgICAgICBjb2x1bW46IDMzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDYxLAogICAgICAgICAgICAgIGNvbHVtbjogNDcKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnd2Vla2RheS1zY2hlZHVsZS10aXRsZSJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGl0bGU9IicgKyBjKHUobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGQodCwgIm1vZGVsIikgOiB0KSA/IGQoaSwgInRpdGxlIikgOiBpLCB0KSkgKyAnIj4nICsgKG51bGwgIT0gKGkgPSAoZChuLCAic2NoZWR1bGUtdG1wbCIpIHx8IHQgJiYgZCh0LCAic2NoZWR1bGUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gZCh0LCAibW9kZWwiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJzY2hlZHVsZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDYyLAogICAgICAgICAgICAgIGNvbHVtbjogNjUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNjIsCiAgICAgICAgICAgICAgY29sdW1uOiA5MAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpID8gaSA6ICIiKSArICI8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4iOwogICAgICB9LAogICAgICAxODogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZS5lc2NhcGVFeHByZXNzaW9uKCJmdW5jdGlvbiIgPT0gdHlwZW9mIChpID0gbnVsbCAhPSAoaSA9IGEobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gYSh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gaSA6IGUuaG9va3MuaGVscGVyTWlzc2luZykgPyBpLmNhbGwobnVsbCAhPSB0ID8gdCA6IGUubnVsbENvbnRleHQgfHwge30sIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMTE1CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDQ3LAogICAgICAgICAgICAgIGNvbHVtbjogMTI5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGkpICsgIndlZWtkYXktc2NoZWR1bGUtZm9jdXNlZCAiOwogICAgICB9LAogICAgICAyMDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxvb2t1cFByb3BlcnR5IHx8IGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gZVt0XTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gIiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgIm1hcmdpbkxlZnQiKSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDIyOiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAiICsgZS5lc2NhcGVFeHByZXNzaW9uKGUubGFtYmRhKChpID0gKGkgPSBvICYmIGEobywgInJvb3QiKSkgJiYgYShpLCAic3R5bGVzIikpICYmIGEoaSwgIm1hcmdpblJpZ2h0IiksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICAyNDogZnVuY3Rpb24gXyhlLCB0LCBuLCBsLCBvKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGEgPSBlLmxhbWJkYSwKICAgICAgICAgICAgciA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgcyA9IGUubG9va3VwUHJvcGVydHkgfHwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgdCkpIHJldHVybiBlW3RdOwogICAgICAgIH07CgogICAgICAgIHJldHVybiAiICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7IGJhY2tncm91bmQtY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiY29sb3IiKSA6IGksIHQpKSArICI7IGJvcmRlci1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjtcbiI7CiAgICAgIH0sCiAgICAgIDI2OiBmdW5jdGlvbiBfKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSA9IGUubGFtYmRhLAogICAgICAgICAgICByID0gZS5lc2NhcGVFeHByZXNzaW9uLAogICAgICAgICAgICBzID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICIgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJjb2xvciIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjoiICsgcihhKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBzKHQsICJtb2RlbCIpIDogdCkgPyBzKGksICJiZ0NvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItY29sb3I6IiArIHIoYShudWxsICE9IChpID0gbnVsbCAhPSB0ID8gcyh0LCAibW9kZWwiKSA6IHQpID8gcyhpLCAiYm9yZGVyQ29sb3IiKSA6IGksIHQpKSArICI7XG4iOwogICAgICB9LAogICAgICBjb21waWxlcjogWzgsICI+PSA0LjMuMCJdLAogICAgICBtYWluOiBmdW5jdGlvbiBtYWluKGUsIHQsIG4sIGwsIG8pIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgciA9IG51bGwgIT0gdCA/IHQgOiBlLm51bGxDb250ZXh0IHx8IHt9LAogICAgICAgICAgICBzID0gZS5ob29rcy5oZWxwZXJNaXNzaW5nLAogICAgICAgICAgICBjID0gImZ1bmN0aW9uIiwKICAgICAgICAgICAgdSA9IGUuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgICAgICAgZCA9IGUubGFtYmRhLAogICAgICAgICAgICBoID0gZS5sb29rdXBQcm9wZXJ0eSB8fCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCB0KSkgcmV0dXJuIGVbdF07CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMSwKICAgICAgICAgICAgICBjb2x1bW46IDEyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDEsCiAgICAgICAgICAgICAgY29sdW1uOiAyNgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1tb3JlIiBzdHlsZT0icGFkZGluZy1ib3R0b206ICcgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJwYWRkaW5nQm90dG9tIikgOiBpLCB0KSkgKyAiOyBib3JkZXI6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJib3JkZXIiKSA6IGksIHQpKSArICI7IGJveC1zaGFkb3c6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJib3hTaGFkb3ciKSA6IGksIHQpKSArICI7IGJhY2tncm91bmQtY29sb3I6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJiYWNrZ3JvdW5kQ29sb3IiKSA6IGksIHQpKSArICc7Ij5cbiAgICA8ZGl2IGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogMiwKICAgICAgICAgICAgICBjb2x1bW46IDE2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDIsCiAgICAgICAgICAgICAgY29sdW1uOiAzMAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1tb3JlLXRpdGxlIlxuICAgICAgICBzdHlsZT0iaGVpZ2h0OiAnICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAidGl0bGVIZWlnaHQiKSA6IGksIHQpKSArICI7IG1hcmdpbi1ib3R0b206ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJ0aXRsZU1hcmdpbkJvdHRvbSIpIDogaSwgdCkpICsgIjsgYmFja2dyb3VuZC1jb2xvcjogIiArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgInRpdGxlQmFja2dyb3VuZENvbG9yIikgOiBpLCB0KSkgKyAiOyBib3JkZXItYm90dG9tOiAiICsgdShkKG51bGwgIT0gKGkgPSBudWxsICE9IHQgPyBoKHQsICJzdHlsZXMiKSA6IHQpID8gaChpLCAidGl0bGVCb3JkZXJCb3R0b20iKSA6IGksIHQpKSArICI7IHBhZGRpbmc6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJ0aXRsZVBhZGRpbmciKSA6IGksIHQpKSArICc7Ij5cbiAgICAgICAgPHNwYW4gY2xhc3M9IicgKyB1KF90eXBlb2YoYSA9IG51bGwgIT0gKGEgPSBoKG4sICJDU1NfUFJFRklYIikgfHwgKG51bGwgIT0gdCA/IGgodCwgIkNTU19QUkVGSVgiKSA6IHQpKSA/IGEgOiBzKSA9PT0gYyA/IGEuY2FsbChyLCB7CiAgICAgICAgICBuYW1lOiAiQ1NTX1BSRUZJWCIsCiAgICAgICAgICBoYXNoOiB7fSwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMjEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW5kOiB7CiAgICAgICAgICAgICAgbGluZTogNCwKICAgICAgICAgICAgICBjb2x1bW46IDM1CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSA6IGEpICsgJ21vbnRoLW1vcmUtdGl0bGUtZGF0ZSI+JyArIChudWxsICE9IChpID0gKGgobiwgIm1vbnRoTW9yZVRpdGxlRGF0ZS10bXBsIikgfHwgdCAmJiBoKHQsICJtb250aE1vcmVUaXRsZURhdGUtdG1wbCIpIHx8IHMpLmNhbGwociwgbnVsbCAhPSB0ID8gaCh0LCAiZGF0ZSIpIDogdCwgbnVsbCAhPSB0ID8gaCh0LCAiZGF5bmFtZSIpIDogdCwgewogICAgICAgICAgbmFtZTogIm1vbnRoTW9yZVRpdGxlRGF0ZS10bXBsIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDQsCiAgICAgICAgICAgICAgY29sdW1uOiA1OAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA0LAogICAgICAgICAgICAgIGNvbHVtbjogMTAwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgJzwvc3Bhbj5cbiAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSInICsgdShfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAiQ1NTX1BSRUZJWCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJDU1NfUFJFRklYIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIkNTU19QUkVGSVgiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDM3CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA1MQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSArICdtb250aC1tb3JlLWNsb3NlIj4nICsgKG51bGwgIT0gKGkgPSBfdHlwZW9mKGEgPSBudWxsICE9IChhID0gaChuLCAibW9udGhNb3JlQ2xvc2UtdG1wbCIpIHx8IChudWxsICE9IHQgPyBoKHQsICJtb250aE1vcmVDbG9zZS10bXBsIikgOiB0KSkgPyBhIDogcykgPT09IGMgPyBhLmNhbGwociwgewogICAgICAgICAgbmFtZTogIm1vbnRoTW9yZUNsb3NlLXRtcGwiLAogICAgICAgICAgaGFzaDoge30sCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgbG9jOiB7CiAgICAgICAgICAgIHN0YXJ0OiB7CiAgICAgICAgICAgICAgbGluZTogNSwKICAgICAgICAgICAgICBjb2x1bW46IDY5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuZDogewogICAgICAgICAgICAgIGxpbmU6IDUsCiAgICAgICAgICAgICAgY29sdW1uOiA5NAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkgOiBhKSA/IGkgOiAiIikgKyAnPC9idXR0b24+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iJyArIHUoX3R5cGVvZihhID0gbnVsbCAhPSAoYSA9IGgobiwgIkNTU19QUkVGSVgiKSB8fCAobnVsbCAhPSB0ID8gaCh0LCAiQ1NTX1BSRUZJWCIpIDogdCkpID8gYSA6IHMpID09PSBjID8gYS5jYWxsKHIsIHsKICAgICAgICAgIG5hbWU6ICJDU1NfUFJFRklYIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZGF0YTogbywKICAgICAgICAgIGxvYzogewogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgIGxpbmU6IDcsCiAgICAgICAgICAgICAgY29sdW1uOiAxNgogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA3LAogICAgICAgICAgICAgIGNvbHVtbjogMzAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pIDogYSkgKyAnbW9udGgtbW9yZS1saXN0IiBzdHlsZT0icGFkZGluZzogJyArIHUoZChudWxsICE9IChpID0gbnVsbCAhPSB0ID8gaCh0LCAic3R5bGVzIikgOiB0KSA/IGgoaSwgImxpc3RQYWRkaW5nIikgOiBpLCB0KSkgKyAiOyBoZWlnaHQ6ICIgKyB1KGQobnVsbCAhPSAoaSA9IG51bGwgIT0gdCA/IGgodCwgInN0eWxlcyIpIDogdCkgPyBoKGksICJsaXN0SGVpZ2h0IikgOiBpLCB0KSkgKyAnOyI+XG4nICsgKG51bGwgIT0gKGkgPSBoKG4sICJlYWNoIikuY2FsbChyLCBudWxsICE9IHQgPyBoKHQsICJzY2hlZHVsZXMiKSA6IHQsIHsKICAgICAgICAgIG5hbWU6ICJlYWNoIiwKICAgICAgICAgIGhhc2g6IHt9LAogICAgICAgICAgZm46IGUucHJvZ3JhbSgxLCBvLCAwKSwKICAgICAgICAgIGludmVyc2U6IGUubm9vcCwKICAgICAgICAgIGRhdGE6IG8sCiAgICAgICAgICBsb2M6IHsKICAgICAgICAgICAgc3RhcnQ6IHsKICAgICAgICAgICAgICBsaW5lOiA4LAogICAgICAgICAgICAgIGNvbHVtbjogOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICBsaW5lOiA2NiwKICAgICAgICAgICAgICBjb2x1bW46IDE3CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSkgPyBpIDogIiIpICsgIiAgICA8L2Rpdj5cbjwvZGl2PlxuIjsKICAgICAgfSwKICAgICAgdXNlRGF0YTogITAKICAgIH0pOwogIH0sIGZ1bmN0aW9uIChlLCB0LCBuKSB7fSwgZnVuY3Rpb24gKGUsIHQsIG4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbCA9IG4oMCksCiAgICAgICAgbyA9IG4oMjApLAogICAgICAgIGkgPSBuKDMpLAogICAgICAgIGEgPSBuKDUpLAogICAgICAgIHIgPSBuKDIpLAogICAgICAgIHMgPSBNYXRoLm1heCwKICAgICAgICBjID0gewogICAgICBzdGFtcDogZnVuY3Rpb24gc3RhbXAoZSkgewogICAgICAgIHJldHVybiBsLnN0YW1wKGUpOwogICAgICB9LAogICAgICBlcXVhbDogZnVuY3Rpb24gZXF1YWwoZSwgdCkgewogICAgICAgIHJldHVybiBlID09PSB0OwogICAgICB9LAogICAgICBvcjogZnVuY3Rpb24gb3IoZSwgdCkgewogICAgICAgIHJldHVybiBlIHx8IHQ7CiAgICAgIH0sCiAgICAgIGFuZDogZnVuY3Rpb24gYW5kKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSAmJiB0OwogICAgICB9LAogICAgICBmaTogZnVuY3Rpb24gZmkoZSwgdCwgbiwgbCkgewogICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgY2FzZSAiPT0iOgogICAgICAgICAgICByZXR1cm4gZSA9PSBuID8gbC5mbih0aGlzKSA6IGwuaW52ZXJzZSh0aGlzKTsKCiAgICAgICAgICBjYXNlICI9PT0iOgogICAgICAgICAgICByZXR1cm4gZSA9PT0gbiA/IGwuZm4odGhpcykgOiBsLmludmVyc2UodGhpcyk7CgogICAgICAgICAgY2FzZSAiIT09IjoKICAgICAgICAgICAgcmV0dXJuIGUgIT09IG4gPyBsLmZuKHRoaXMpIDogbC5pbnZlcnNlKHRoaXMpOwoKICAgICAgICAgIGNhc2UgIjwiOgogICAgICAgICAgICByZXR1cm4gZSA8IG4gPyBsLmZuKHRoaXMpIDogbC5pbnZlcnNlKHRoaXMpOwoKICAgICAgICAgIGNhc2UgInx8IjoKICAgICAgICAgICAgcmV0dXJuIGUgfHwgbiA/IGwuZm4odGhpcykgOiBsLmludmVyc2UodGhpcyk7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgbWF0Y2ggb3BlcmF0aW9uIik7CiAgICAgICAgfQogICAgICB9LAogICAgICBoaG1tOiBmdW5jdGlvbiBoaG1tKGUpIHsKICAgICAgICByZXR1cm4gaS5mb3JtYXQoZSwgIkhIOm1tIik7CiAgICAgIH0sCiAgICAgICJjb21tb24td2lkdGgiOiBmdW5jdGlvbiBjb21tb25XaWR0aChlKSB7CiAgICAgICAgcmV0dXJuIHUoZSwgIiUiLCAid2lkdGgiKTsKICAgICAgfSwKICAgICAgImdyaWQtbGVmdCI6IGZ1bmN0aW9uIGdyaWRMZWZ0KGUsIHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICAgIHJldHVybiB0W2UubGVmdF0gPyB0W2UubGVmdF0ubGVmdCA6IDA7CiAgICAgICAgfShlLCB0KTsKICAgICAgfSwKICAgICAgImdyaWQtd2lkdGgiOiBmdW5jdGlvbiBncmlkV2lkdGgoZSwgdCkgewogICAgICAgIHJldHVybiBkKGUsIHQpOwogICAgICB9LAogICAgICAidGltZS1zY2hlZHVsZUJsb2NrIjogZnVuY3Rpb24gdGltZVNjaGVkdWxlQmxvY2soZSwgdCkgewogICAgICAgIHZhciBuID0gdShlLnRvcCwgInB4IiwgInRvcCIpLAogICAgICAgICAgICBsID0gdShlLmxlZnQsIHQgPyAiJSIgOiAicHgiLCAibGVmdCIpLAogICAgICAgICAgICBvID0gdShlLndpZHRoLCAiJSIsICJ3aWR0aCIpLAogICAgICAgICAgICBpID0gdShlLmhlaWdodCwgInB4IiwgImhlaWdodCIpLAogICAgICAgICAgICBhID0gbmV3IERhdGUoZS5tb2RlbC5zdGFydC5fZGF0ZSkuZ2V0SG91cnMoKSA+IGUuaG91clN0YXJ0ID8gIiIgOiAiZGlzcGxheTpub25lIjsKICAgICAgICByZXR1cm4gdCA/IFtsLCBhXS5qb2luKCI7IikgOiBbbiwgbCwgbywgaSwgYV0uam9pbigiOyIpOwogICAgICB9LAogICAgICAibW9udGgtc2NoZWR1bGVCbG9jayI6IGZ1bmN0aW9uIG1vbnRoU2NoZWR1bGVCbG9jayhlLCB0LCBuLCBsKSB7CiAgICAgICAgcmV0dXJuIFt1KChlLnRvcCAtIDEpICogbiArIGwsICJweCIsICJ0b3AiKSwgdSh0W2UubGVmdF0gPyB0W2UubGVmdF0ubGVmdCA6IDAsICIlIiwgImxlZnQiKSwgdShkKGUsIHQpLCAiJSIsICJ3aWR0aCIpLCB1KGUuaGVpZ2h0LCAicHgiLCAiaGVpZ2h0IildLmpvaW4oIjsiKTsKICAgICAgfSwKICAgICAgaG9saWRheTogZnVuY3Rpb24gaG9saWRheShlKSB7CiAgICAgICAgdmFyIHQgPSAiIjsKICAgICAgICByZXR1cm4gMCA9PT0gZSAmJiAodCA9IHIuY2xhc3NuYW1lKCJob2xpZGF5LXN1biIpKSwgNiA9PT0gZSAmJiAodCA9IHIuY2xhc3NuYW1lKCJob2xpZGF5LXNhdCIpKSwgdDsKICAgICAgfSwKICAgICAgYWRkOiBmdW5jdGlvbiBhZGQoZSwgdCkgewogICAgICAgIHJldHVybiBlICsgdDsKICAgICAgfSwKICAgICAgbXVsdGlwbHk6IGZ1bmN0aW9uIG11bHRpcGx5KGUsIHQpIHsKICAgICAgICByZXR1cm4gZSAqIHQ7CiAgICAgIH0sCiAgICAgIGRpdmlkZTogZnVuY3Rpb24gZGl2aWRlKGUsIHQpIHsKICAgICAgICByZXR1cm4gZSAvIHQ7CiAgICAgIH0sCiAgICAgIHN1YnRyYWN0OiBmdW5jdGlvbiBzdWJ0cmFjdChlLCB0KSB7CiAgICAgICAgcmV0dXJuIGUgLSB0OwogICAgICB9LAogICAgICBnZXRSaWdodDogZnVuY3Rpb24gZ2V0UmlnaHQoZSwgdCkgewogICAgICAgIHJldHVybiBzKDAsIDEwMCAtIChlICsgdCkpOwogICAgICB9LAogICAgICBDU1NfUFJFRklYOiBmdW5jdGlvbiBDU1NfUFJFRklYKCkgewogICAgICAgIHJldHVybiByLmNzc1ByZWZpeDsKICAgICAgfSwKICAgICAgcmV2ZXJzZTogZnVuY3Rpb24gcmV2ZXJzZShlKSB7CiAgICAgICAgcmV0dXJuIGUuc2xpY2UoKS5yZXZlcnNlKCk7CiAgICAgIH0sCiAgICAgICJtaWxlc3RvbmUtdG1wbCI6IGZ1bmN0aW9uIG1pbGVzdG9uZVRtcGwoZSkgewogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyByLmNsYXNzbmFtZSgiaWNvbiIpICsgIiAiICsgci5jbGFzc25hbWUoImljLW1pbGVzdG9uZSIpICsgJyI+PC9zcGFuPjxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAnICsgZS5iZ0NvbG9yICsgJyI+JyArIGEuc3RyaXBUYWdzKGUudGl0bGUpICsgIjwvc3Bhbj4iOwogICAgICB9LAogICAgICAibWlsZXN0b25lVGl0bGUtdG1wbCI6IGZ1bmN0aW9uIG1pbGVzdG9uZVRpdGxlVG1wbCgpIHsKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgci5jbGFzc25hbWUoImxlZnQtY29udGVudCIpICsgJyI+TWlsZXN0b25lPC9zcGFuPic7CiAgICAgIH0sCiAgICAgICJ0YXNrLXRtcGwiOiBmdW5jdGlvbiB0YXNrVG1wbChlKSB7CiAgICAgICAgcmV0dXJuICIjIiArIGUudGl0bGU7CiAgICAgIH0sCiAgICAgICJ0YXNrVGl0bGUtdG1wbCI6IGZ1bmN0aW9uIHRhc2tUaXRsZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHIuY2xhc3NuYW1lKCJsZWZ0LWNvbnRlbnQiKSArICciPlRhc2s8L3NwYW4+JzsKICAgICAgfSwKICAgICAgImFsbGRheVRpdGxlLXRtcGwiOiBmdW5jdGlvbiBhbGxkYXlUaXRsZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHIuY2xhc3NuYW1lKCJsZWZ0LWNvbnRlbnQiKSArICciPkFsbCBEYXk8L3NwYW4+JzsKICAgICAgfSwKICAgICAgImFsbGRheS10bXBsIjogZnVuY3Rpb24gYWxsZGF5VG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGEuc3RyaXBUYWdzKGUudGl0bGUpOwogICAgICB9LAogICAgICAidGltZS10bXBsIjogZnVuY3Rpb24gdGltZVRtcGwoZSkgewogICAgICAgIHJldHVybiBhLnN0cmlwVGFncyhlLnRpdGxlKTsKICAgICAgfSwKICAgICAgImdvaW5nRHVyYXRpb24tdG1wbCI6IGZ1bmN0aW9uIGdvaW5nRHVyYXRpb25UbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IGUuZ29pbmdEdXJhdGlvbiwKICAgICAgICAgICAgbiA9IHBhcnNlSW50KHQgLyA2MCwgMTApLAogICAgICAgICAgICBsID0gdCAlIDYwOwogICAgICAgIHJldHVybiAiR29pbmdUaW1lICIgKyBpLmxlYWRpbmdaZXJvKG4sIDIpICsgIjoiICsgaS5sZWFkaW5nWmVybyhsLCAyKTsKICAgICAgfSwKICAgICAgImNvbWluZ0R1cmF0aW9uLXRtcGwiOiBmdW5jdGlvbiBjb21pbmdEdXJhdGlvblRtcGwoZSkgewogICAgICAgIHZhciB0ID0gZS5nb2luZ0R1cmF0aW9uLAogICAgICAgICAgICBuID0gcGFyc2VJbnQodCAvIDYwLCAxMCksCiAgICAgICAgICAgIGwgPSB0ICUgNjA7CiAgICAgICAgcmV0dXJuICJDb21pbmdUaW1lICIgKyBpLmxlYWRpbmdaZXJvKG4sIDIpICsgIjoiICsgaS5sZWFkaW5nWmVybyhsLCAyKTsKICAgICAgfSwKICAgICAgImRpc3BsYXlQaG9uZS10bXBsIjogZnVuY3Rpb24gZGlzcGxheVBob25lVG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGUucmF3LnBob25lX251bWJlciB8fCAiIjsKICAgICAgfSwKICAgICAgIm1vbnRoTW9yZVRpdGxlRGF0ZS10bXBsIjogZnVuY3Rpb24gbW9udGhNb3JlVGl0bGVEYXRlVG1wbChlLCB0KSB7CiAgICAgICAgdmFyIG4gPSByLmNsYXNzbmFtZSgibW9udGgtbW9yZS10aXRsZS1kYXkiKSwKICAgICAgICAgICAgbyA9IHIuY2xhc3NuYW1lKCJtb250aC1tb3JlLXRpdGxlLWRheS1sYWJlbCIpOwogICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IicgKyBuICsgJyI+JyArIGwucGljayhlLnNwbGl0KCIuIiksIDIpICsgJzwvc3Bhbj4gPHNwYW4gY2xhc3M9IicgKyBvICsgJyI+JyArIHQgKyAiPC9zcGFuPiI7CiAgICAgIH0sCiAgICAgICJtb250aE1vcmVDbG9zZS10bXBsIjogZnVuY3Rpb24gbW9udGhNb3JlQ2xvc2VUbXBsKCkgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfSwKICAgICAgIm1vbnRoR3JpZEhlYWRlci10bXBsIjogZnVuY3Rpb24gbW9udGhHcmlkSGVhZGVyVG1wbChlKSB7CiAgICAgICAgdmFyIHQgPSBwYXJzZUludChlLmRhdGUuc3BsaXQoIi0iKVsyXSwgMTApLAogICAgICAgICAgICBuID0gW107CiAgICAgICAgcmV0dXJuIG4ucHVzaChyLmNsYXNzbmFtZSgid2Vla2RheS1ncmlkLWRhdGUiKSksIGUuaXNUb2RheSAmJiBuLnB1c2goci5jbGFzc25hbWUoIndlZWtkYXktZ3JpZC1kYXRlLWRlY29yYXRvciIpKSwgJzxzcGFuIGNsYXNzPSInICsgbi5qb2luKCIgIikgKyAnIj4nICsgdCArICI8L3NwYW4+IjsKICAgICAgfSwKICAgICAgIm1vbnRoR3JpZEhlYWRlckV4Y2VlZC10bXBsIjogZnVuY3Rpb24gbW9udGhHcmlkSGVhZGVyRXhjZWVkVG1wbChlKSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHIuY2xhc3NuYW1lKCJ3ZWVrZGF5LWdyaWQtbW9yZS1zY2hlZHVsZXMiKSArICciPicgKyBlICsgIiBtb3JlPC9zcGFuPiI7CiAgICAgIH0sCiAgICAgICJtb250aEdyaWRGb290ZXItdG1wbCI6IGZ1bmN0aW9uIG1vbnRoR3JpZEZvb3RlclRtcGwoKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9LAogICAgICAibW9udGhHcmlkRm9vdGVyRXhjZWVkLXRtcGwiOiBmdW5jdGlvbiBtb250aEdyaWRGb290ZXJFeGNlZWRUbXBsKGUpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0sCiAgICAgICJtb250aERheW5hbWUtdG1wbCI6IGZ1bmN0aW9uIG1vbnRoRGF5bmFtZVRtcGwoZSkgewogICAgICAgIHJldHVybiBlLmxhYmVsOwogICAgICB9LAogICAgICAid2Vla0RheW5hbWUtdG1wbCI6IGZ1bmN0aW9uIHdlZWtEYXluYW1lVG1wbChlKSB7CiAgICAgICAgdmFyIHQgPSByLmNsYXNzbmFtZSgiZGF5bmFtZS1kYXRlIiksCiAgICAgICAgICAgIG4gPSByLmNsYXNzbmFtZSgiZGF5bmFtZS1uYW1lIik7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIHQgKyAnIj4nICsgZS5kYXRlICsgJzwvc3Bhbj4mbmJzcDsmbmJzcDs8c3BhbiBjbGFzcz0iJyArIG4gKyAnIj4nICsgZS5kYXlOYW1lICsgIjwvc3Bhbj4iOwogICAgICB9LAogICAgICAid2Vla0dyaWRGb290ZXJFeGNlZWQtdG1wbCI6IGZ1bmN0aW9uIHdlZWtHcmlkRm9vdGVyRXhjZWVkVG1wbChlKSB7CiAgICAgICAgcmV0dXJuICIrIiArIGU7CiAgICAgIH0sCiAgICAgICJkYXlHcmlkVGl0bGUtdG1wbCI6IGZ1bmN0aW9uIGRheUdyaWRUaXRsZVRtcGwoZSkgewogICAgICAgIHZhciB0ID0gby5oZWxwZXJzW2UgKyAiVGl0bGUtdG1wbCJdOwogICAgICAgIHJldHVybiB0ID8gdChlKSA6IGU7CiAgICAgIH0sCiAgICAgICJzY2hlZHVsZS10bXBsIjogZnVuY3Rpb24gc2NoZWR1bGVUbXBsKGUpIHsKICAgICAgICB2YXIgdCA9IG8uaGVscGVyc1tlLmNhdGVnb3J5ICsgIi10bXBsIl07CiAgICAgICAgcmV0dXJuIHQgPyB0KGUpIDogIiI7CiAgICAgIH0sCiAgICAgICJjb2xsYXBzZUJ0blRpdGxlLXRtcGwiOiBmdW5jdGlvbiBjb2xsYXBzZUJ0blRpdGxlVG1wbCgpIHsKICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSInICsgci5jbGFzc25hbWUoImljb24iKSArICIgIiArIHIuY2xhc3NuYW1lKCJpYy1hcnJvdy1zb2xpZC10b3AiKSArICciPjwvc3Bhbj4nOwogICAgICB9LAogICAgICAidGltZXpvbmVEaXNwbGF5TGFiZWwtdG1wbCI6IGZ1bmN0aW9uIHRpbWV6b25lRGlzcGxheUxhYmVsVG1wbChlLCB0KSB7CiAgICAgICAgdmFyIG4sIG8sIGE7CiAgICAgICAgcmV0dXJuIGwuaXNVbmRlZmluZWQodCkgJiYgKG4gPSBlIDwgMCA/ICItIiA6ICIrIiwgbyA9IE1hdGguYWJzKHBhcnNlSW50KGUgLyA2MCwgMTApKSwgYSA9IE1hdGguYWJzKGUgJSA2MCksIHQgPSBuICsgaS5sZWFkaW5nWmVybyhvLCAyKSArICI6IiArIGkubGVhZGluZ1plcm8oYSwgMikpLCB0OwogICAgICB9LAogICAgICAidGltZWdyaWREaXNwbGF5UHJpbWF5VGltZS10bXBsIjogZnVuY3Rpb24gdGltZWdyaWREaXNwbGF5UHJpbWF5VGltZVRtcGwoZSkgewogICAgICAgIHJldHVybiBvLmhlbHBlcnNbInRpbWVncmlkRGlzcGxheVByaW1hcnlUaW1lLXRtcGwiXShlKTsKICAgICAgfSwKICAgICAgInRpbWVncmlkRGlzcGxheVByaW1hcnlUaW1lLXRtcGwiOiBmdW5jdGlvbiB0aW1lZ3JpZERpc3BsYXlQcmltYXJ5VGltZVRtcGwoZSkgewogICAgICAgIHZhciB0ID0gZS5ob3VyLAogICAgICAgICAgICBuID0gdCA+PSAxMiA/ICJwbSIgOiAiYW0iOwogICAgICAgIHJldHVybiB0ID4gMTIgJiYgKHQgLT0gMTIpLCB0ICsgIiAiICsgbjsKICAgICAgfSwKICAgICAgInRpbWVncmlkRGlzcGxheVRpbWUtdG1wbCI6IGZ1bmN0aW9uIHRpbWVncmlkRGlzcGxheVRpbWVUbXBsKGUpIHsKICAgICAgICByZXR1cm4gaS5sZWFkaW5nWmVybyhlLmhvdXIsIDIpICsgIjoiICsgaS5sZWFkaW5nWmVybyhlLm1pbnV0ZXMsIDIpOwogICAgICB9LAogICAgICAidGltZWdyaWRDdXJyZW50VGltZS10bXBsIjogZnVuY3Rpb24gdGltZWdyaWRDdXJyZW50VGltZVRtcGwoZSkgewogICAgICAgIHZhciB0ID0gW107CiAgICAgICAgcmV0dXJuIGUuZGF0ZURpZmZlcmVuY2UgJiYgdC5wdXNoKCJbIiArIGUuZGF0ZURpZmZlcmVuY2VTaWduICsgZS5kYXRlRGlmZmVyZW5jZSArICJdPGJyPiIpLCB0LnB1c2goaS5mb3JtYXQoZS5ob3VybWFya2VyLCAiSEg6bW0iKSksIHQuam9pbigiIik7CiAgICAgIH0sCiAgICAgICJwb3B1cElzQWxsRGF5LXRtcGwiOiBmdW5jdGlvbiBwb3B1cElzQWxsRGF5VG1wbCgpIHsKICAgICAgICByZXR1cm4gIkFsbCBkYXkiOwogICAgICB9LAogICAgICAicG9wdXBTdGF0ZUZyZWUtdG1wbCI6IGZ1bmN0aW9uIHBvcHVwU3RhdGVGcmVlVG1wbCgpIHsKICAgICAgICByZXR1cm4gIkZyZWUiOwogICAgICB9LAogICAgICAicG9wdXBTdGF0ZUJ1c3ktdG1wbCI6IGZ1bmN0aW9uIHBvcHVwU3RhdGVCdXN5VG1wbCgpIHsKICAgICAgICByZXR1cm4gIkJ1c3kiOwogICAgICB9LAogICAgICAidGl0bGVQbGFjZWhvbGRlci10bXBsIjogZnVuY3Rpb24gdGl0bGVQbGFjZWhvbGRlclRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJTdWJqZWN0IjsKICAgICAgfSwKICAgICAgImxvY2F0aW9uUGxhY2Vob2xkZXItdG1wbCI6IGZ1bmN0aW9uIGxvY2F0aW9uUGxhY2Vob2xkZXJUbXBsKCkgewogICAgICAgIHJldHVybiAiTG9jYXRpb24iOwogICAgICB9LAogICAgICAic3RhcnREYXRlUGxhY2Vob2xkZXItdG1wbCI6IGZ1bmN0aW9uIHN0YXJ0RGF0ZVBsYWNlaG9sZGVyVG1wbCgpIHsKICAgICAgICByZXR1cm4gIlN0YXJ0IGRhdGUiOwogICAgICB9LAogICAgICAiZW5kRGF0ZVBsYWNlaG9sZGVyLXRtcGwiOiBmdW5jdGlvbiBlbmREYXRlUGxhY2Vob2xkZXJUbXBsKCkgewogICAgICAgIHJldHVybiAiRW5kIGRhdGUiOwogICAgICB9LAogICAgICAicG9wdXBTYXZlLXRtcGwiOiBmdW5jdGlvbiBwb3B1cFNhdmVUbXBsKCkgewogICAgICAgIHJldHVybiAiU2F2ZSI7CiAgICAgIH0sCiAgICAgICJwb3B1cFVwZGF0ZS10bXBsIjogZnVuY3Rpb24gcG9wdXBVcGRhdGVUbXBsKCkgewogICAgICAgIHJldHVybiAiVXBkYXRlIjsKICAgICAgfSwKICAgICAgInBvcHVwRGV0YWlsRGF0ZS10bXBsIjogZnVuY3Rpb24gcG9wdXBEZXRhaWxEYXRlVG1wbChlLCB0LCBuKSB7CiAgICAgICAgdmFyIGwgPSBpLmlzU2FtZURhdGUodCwgbiksCiAgICAgICAgICAgIG8gPSAobCA/ICIiIDogIllZWVkuTU0uREQgIikgKyAiaGg6bW0gdHQiOwogICAgICAgIHJldHVybiBlID8gaS5mb3JtYXQodCwgIllZWVkuTU0uREQiKSArIChsID8gIiIgOiAiIC0gIiArIGkuZm9ybWF0KG4sICJZWVlZLk1NLkREIikpIDogaS5mb3JtYXQodCwgIllZWVkuTU0uREQgaGg6bW0gdHQiKSArICIgLSAiICsgaS5mb3JtYXQobiwgbyk7CiAgICAgIH0sCiAgICAgICJwb3B1cERldGFpbExvY2F0aW9uLXRtcGwiOiBmdW5jdGlvbiBwb3B1cERldGFpbExvY2F0aW9uVG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGUubG9jYXRpb247CiAgICAgIH0sCiAgICAgICJwb3B1cERldGFpbFVzZXItdG1wbCI6IGZ1bmN0aW9uIHBvcHVwRGV0YWlsVXNlclRtcGwoZSkgewogICAgICAgIHJldHVybiAoZS5hdHRlbmRlZXMgfHwgW10pLmpvaW4oIiwgIik7CiAgICAgIH0sCiAgICAgICJwb3B1cERldGFpbFN0YXRlLXRtcGwiOiBmdW5jdGlvbiBwb3B1cERldGFpbFN0YXRlVG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGUuc3RhdGUgfHwgIkJ1c3kiOwogICAgICB9LAogICAgICAicG9wdXBEZXRhaWxSZXBlYXQtdG1wbCI6IGZ1bmN0aW9uIHBvcHVwRGV0YWlsUmVwZWF0VG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGUucmVjdXJyZW5jZVJ1bGU7CiAgICAgIH0sCiAgICAgICJwb3B1cERldGFpbEJvZHktdG1wbCI6IGZ1bmN0aW9uIHBvcHVwRGV0YWlsQm9keVRtcGwoZSkgewogICAgICAgIHJldHVybiBlLmJvZHk7CiAgICAgIH0sCiAgICAgICJwb3B1cEVkaXQtdG1wbCI6IGZ1bmN0aW9uIHBvcHVwRWRpdFRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJFZGl0IjsKICAgICAgfSwKICAgICAgInBvcHVwRGVsZXRlLXRtcGwiOiBmdW5jdGlvbiBwb3B1cERlbGV0ZVRtcGwoKSB7CiAgICAgICAgcmV0dXJuICJEZWxldGUiOwogICAgICB9LAogICAgICAidGl0bGVBdmF0YXItdG1wbCI6IGZ1bmN0aW9uIHRpdGxlQXZhdGFyVG1wbChlKSB7CiAgICAgICAgcmV0dXJuIGUuc3BsaXQoIiAiKS5zbGljZSgwLCAxKS5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBlLmNoYXJBdCgwKTsKICAgICAgICB9KS5qb2luKCIiKS50b1VwcGVyQ2FzZSgpOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIHUoZSwgdCwgbikgewogICAgICByZXR1cm4gbiA9IG4gfHwgIiIsIGwuaXNOdW1iZXIoZSkgPyBuICsgIjoiICsgZSArIHQgOiBuICsgIjphdXRvIjsKICAgIH0KCiAgICBmdW5jdGlvbiBkKGUsIHQpIHsKICAgICAgZm9yICh2YXIgbiwgbCA9IDAsIG8gPSAwLCBpID0gdC5sZW5ndGg7IG8gPCBlLndpZHRoOyBvICs9IDEpIHsKICAgICAgICBuID0gKGUubGVmdCArIG8pICUgaSwgKG4gKz0gcGFyc2VJbnQoKGUubGVmdCArIG8pIC8gaSwgMTApKSA8IGkgJiYgKGwgKz0gdFtuXSA/IHRbbl0ud2lkdGggOiAwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAgby5yZWdpc3RlckhlbHBlcihjKTsKICB9XSk7Cn0pOw=="},null]}