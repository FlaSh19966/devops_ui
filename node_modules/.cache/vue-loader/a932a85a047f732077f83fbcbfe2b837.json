{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue","mtime":1663910265482},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOw0KaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7DQppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7DQppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsNCmltcG9ydCBzaWRlYmFyaXRlbXMgZnJvbSAiLi4vTGF5b3V0L1NpZGVCYXJJdGVtIjsNCmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsNCmltcG9ydCB7IGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsNCg0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJwZXJtaXNzaW9ucyIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBNdWx0aXNlbGVjdCwNCiAgfSwNCiAgICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sDQoNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgdXNlcjogW10sDQogICAgICByb2xlczogW10sDQogICAgICBwYWdlX25vOiAxLA0KICAgICAgcGVyX3BhZ2U6IDEwLA0KICAgICAgc2VsZWN0ZWRfcm9sZTogIiIsDQogICAgICBzZWxlY3RlZF9wZXJtaXNzaW9uczogW10sDQogICAgICByb2xlX2xpc3Q6IFtdLA0KICAgICAgY29tcGxldGVfcm9sZV9saXN0OiBbXSwNCiAgICAgIHBlcm1pc3Npb25zX2xpc3Q6IFtdLA0KICAgICAgcG9ydGFsX3Blcm1pc3Npb25zX2xpc3Q6IFtdLA0KICAgICAgYm90X3Blcm1pc3Npb25zX2xpc3Q6IFtdLA0KICAgICAgaW50ZW50bGlzdDogW10sDQogICAgICBjaGVja2VkX2xpc3Q6IFtdLA0KICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsDQogICAgICB0b3RhbF9wYWdlczogbnVsbCwNCiAgICAgIHVzZXJfdHlwZTogIlBvcnRhbCIsDQogICAgICBtZW51X2xpc3RfZnJvbV9hcGk6IG51bGwsDQogICAgICBzcGlubmVyT246IGZhbHNlLA0KICAgICAgY29tcGFueWlkOg0KICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiINCiAgICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKQ0KICAgICAgICAgIDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICBjb21wYW55bmFtZToNCiAgICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iDQogICAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKQ0KICAgICAgICAgIDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgIHVzZXJfcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsDQogICAgICAvL2hhcnNoDQogICAgICBwYWdlX2FycmF5OiBbXSwNCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwNCiAgICAgIHBvcnRhbF9yb2xlczogW10sDQogICAgICBib3Rfcm9sZXM6IFtdLA0KICAgICAgaXNTaG93X3BvcnRhbF9yb2xlczogdHJ1ZSwNCiAgICAgIGlzU2hvd19ib3Rfcm9sZXM6IGZhbHNlLA0KICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLA0KICAgICAgc2VsZWN0X3JvbGVfbmFtZV9kaXNhYmxlOiBmYWxzZSwNCiAgICAgIGZpbHRlcl91c2VyX3R5cGU6ICJQb3J0YWwiLA0KICAgICAgdXNlcl90eXBlX2NoYW5nZTogdHJ1ZSwgDQogICAgfTsNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBwZXJtaXNzaW9uc190aXRsZSgpIHsNCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgew0KICAgICAgICByZXR1cm4gdGhpcy50bHQoJ3BvcnRhbF9tZW51X2xhYmVsJyk7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiKSB7DQogICAgICAgIHJldHVybiB0aGlzLnRsdCgnYm90X2ludGVudF9sYWJlbCcpOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2hlY2tfcG9ydGFsX2JvdF9yb2xlX2xlbmd0aCgpIHsNCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIiAmJiB0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIiAmJiB0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiICYmIHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiICYmIHRoaXMuYm90X3JvbGVzLmxlbmd0aCA9PSAwKSB7DQogICAgICAgIC8vY29uc29sZS5sb2coImVtcGx0eSBib3QiKQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSwNCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHZhciB2bSA9IHRoaXM7DQogICAgLy8gLy9jb25zb2xlLmxvZyh0aGlzLnBhZ2Vfbm8pOw0KICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgew0KICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsNCiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsNCiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOw0KICAgICAgfQ0KICAgIH0pOw0KICAgICQoIiNpbnRlbnRtb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgdm0uY2xlYXJfZmllbGRzKCk7DQogICAgICAvLyB2bS51c2VyX3R5cGUgPSAiUG9ydGFsIjsNCiAgICAgIHZtLnVzZXJfdHlwZV9jaGFuZ2UgPSB0cnVlDQogICAgICB2bS5zZWxlY3Rfcm9sZV9uYW1lX2Rpc2FibGUgPSBmYWxzZQ0KICAgIH0pOw0KICAgICQoInNlbGVjdCAuZm9ybS1jb250cm9sIikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkge30pOw0KICB9LA0KICB3YXRjaDp7DQogICAgICAgIHNlYXJjaF9uYW1lKCl7DQogICAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKXsNCiAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpew0KICAgICAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBmaWx0ZXJfdXNlcl90eXBlKCl7DQogICAgICAgICAgaWYodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKXsNCiAgICAgICAgICAgIHRoaXMuaXNTaG93X3BvcnRhbF9yb2xlcyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLmlzU2hvd19ib3Rfcm9sZXMgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMudXNlcl90eXBlID0gIlBvcnRhbCINCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCkNCiAgICAgICAgICB9ZWxzZSBpZiggdGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJCb3QiKXsNCiAgICAgICAgICAgIHRoaXMuaXNTaG93X2JvdF9yb2xlcyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMudXNlcl90eXBlID0gIkJvdCINCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICB9LA0KICBtZXRob2RzOiB7DQogICAgY2xlYXJfc2VhcmNoX25hbWUoKXsNCiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsNCiAgICB9LA0KICAgIHJlbW92ZV9zZWxlY3RlZF9wZXJtaXNzaW9uKHJlbW92ZWRPcHRpb24sIGlkKXsNCiAgICAgIGlmIChyZW1vdmVkT3B0aW9uLnN1Yl9tZW51ID09ICJEYXNoYm9hcmQiKXsNCiAgICAgICAgdG9hc3RyLndhcm5pbmcodGhpcy50bHQoJ3Blcm1pc3Npb25fY2Fubm90X3JlbW92ZV9zZWxlY3RfbXNnJykpOw0KICAgICAgICB0aGlzLmFkZF9zZWxlY3RlZF9wZXJtaXNzaW9uKHJlbW92ZWRPcHRpb24uc3ViX21lbnUpOw0KICAgICAgfQ0KICAgIH0sDQogICAgYWRkX3NlbGVjdGVkX3Blcm1pc3Npb24ocmVtb3ZlZE9wdGlvbil7DQogICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnVuc2hpZnQoew0KICAgICAgICBzdWJfbWVudTogcmVtb3ZlZE9wdGlvbiwNCiAgICAgIH0pDQogICAgfSwNCiAgICBsb2FkX3Blcm1pc3Npb24oKXsNCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsNCiAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgIHRoaXMucG9ydGFsX3JvbGVzID0gW107DQogICAgICB0aGlzLmJvdF9yb2xlcyA9IFtdOw0KICAgICAgdGhpcy5wZXJtaXNzaW9uc19saXN0ID1bXTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsNCiAgICAgIHRoaXMuaW50ZW50bGlzdCA9IFtdDQogICAgICB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0ID0gW107DQogICAgICB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0ID0gW107DQogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7DQogICAgICBpZiAoDQogICAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikgJiYNCiAgICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iDQogICAgICApIHsNCiAgICAgICAgdG9hc3RyLndhcm5pbmcodGhpcy50bHQoJ3Blcm1pc3Npb25fc2VsZWN0X2NvbXBhbnlfbmFtZV9tc2cnKSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOw0KICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsNCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLmNvbXBhbnluYW1lICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5yb2xlX3VybCgpLA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgaXNTaG93OiB0cnVlLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIC8vIC8vY29uc29sZS5sb2cocmVzcG9uc2UsIi0tPmxvYWQgcGVybWlzc2lvbnMiKQ0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7DQogICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOw0KICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlX2xpc3QocmVzcG9uc2UuZGF0YS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsNCiAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsDQogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLA0KICAgICAgICAgICAgdGltZXI6MzAwMCwgICAgIA0KICAgICAgICAgIH0pOw0KICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsNCiAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwNCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdub19kYXRhX3RleHQnKSwNCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICANCiAgICAgICAgICAgIHRvYXN0OnRydWUsDQogICAgICAgICAgICBwb3NpdGlvbjoidG9wLWVuZCIsDQogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsICAgDQogICAgICAgICAgfSk7ICANCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KDQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGlzRHJvcGRvd246IHRydWUsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLmRhdGFbMF0uQm90Lmxlbmd0aCwiLS0+cGVybWlzc2lvbiB1cmwiKQ0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7DQogICAgICAgICAgICAgIHRoaXMuY29tcGxldGVfcm9sZV9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOw0KICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhWzBdLlBvcnRhbC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmRhdGFbMF0uUG9ydGFsLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLnBvcnRhbF9yb2xlcy5wdXNoKA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGFbMF0uUG9ydGFsW2ldDQogICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhWzBdLkJvdC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmRhdGFbMF0uQm90Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLmJvdF9yb2xlcy5wdXNoKA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGFbMF0uQm90W2ldDQogICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsNCiAgICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLA0KICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLA0KICAgICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsNCiAgICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdub19kYXRhX3RleHQnKSwNCiAgICAgICAgICAgICAgdGltZXI6MzAwMCwgDQogICAgICAgICAgICAgIHRvYXN0OnRydWUsDQogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgIH0pOyAgDQogICAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KDQogICAgICAgICAgIA0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfcGVybWlzc2lvbnNfdXJsKCksDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICBpc0dldE1lbnU6IHRydWUsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7DQogICAgICAgICAgICAgIHRoaXMubWVudV9saXN0X2Zyb21fYXBpID0gcmVzcG9uc2UuZGF0YS5kYXRhLk1lbnU7DQogICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5NZW51Ow0KICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhtZXNzYWdlKTsNCiAgICAgICAgICAgIGxldCBtZW51ID0ge307DQogICAgICAgICAgICBsZXQgbWFpbl9tZW51X2xpc3QgPSBtZXNzYWdlLmZpbHRlcigoYXJyKSA9PiAoYXJyLklzTWFzdGVyTWVudSA9PSB0cnVlKSAmJiAoYXJyLkVuYWJsZWQgPT0gdHJ1ZSkpOw0KICAgICAgICAgICAgbGV0IG1haW5fbWVudV9saXN0X2ZpbHRlcmVkID0gW10NCiAgICAgICAgICAgIGxldCBzdWJfbWVudV9saXN0ID0gbWVzc2FnZS5maWx0ZXIoKGFycikgPT4gKGFyci5IYXNTdWJNZW51cyA9PSBmYWxzZSkgJiYgKGFyci5FbmFibGVkID09IHRydWUpICYmIChhcnIuSXNTdWJNZW51ID09IHRydWUpKTsNCg0KICAgICAgICAgICAgZm9yIChsZXQgaSA9MCwgbiA9IG1haW5fbWVudV9saXN0Lmxlbmd0aDsgaSA8IG47IGkgKz0gMSkgew0KICAgICAgICAgICAgICBsZXQgbWVudUZpbHRlciA9IHNpZGViYXJpdGVtcy5maWx0ZXIoKHNpZGViYXIpID0+IHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAgICAgICAgIHNpZGViYXIubmFtZSA9PT0gbWFpbl9tZW51X2xpc3RbaV0uTWVudUl0ZW0gJiYgQm9vbGVhbihzaWRlYmFyLnN2Z19odG1sKQ0KICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgaWYgKG1lbnVGaWx0ZXIubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgbWFpbl9tZW51X2xpc3RfZmlsdGVyZWQucHVzaChtZW51RmlsdGVyWzBdKTsNCiAgICAgICAgICAgICAgICAgIG1lbnVbbWVudUZpbHRlclswXS5uYW1lXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG1lbnVGaWx0ZXJbMF0ubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgbWVudV9saXN0OiBbXQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKG1haW5fbWVudV9saXN0W2ldLkhhc1N1Yk1lbnVzID09IGZhbHNlKXsNCiAgICAgICAgICAgICAgICAgICAgICBtZW51W21lbnVGaWx0ZXJbMF0ubmFtZV0ubWVudV9saXN0LnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViX21lbnU6IG1lbnVGaWx0ZXJbMF0ubmFtZQ0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwLCBuID0gc3ViX21lbnVfbGlzdC5sZW5ndGg7IGkgPCBuOyBpICs9IDEpew0KICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIChzaWRlYmFyaXRlbXNbal0ubmFtZSA9PT0gc3ViX21lbnVfbGlzdFtpXS5NZW51SXRlbSkgJiYNCiAgICAgICAgICAgICAgICAgIChCb29sZWFuKHNpZGViYXJpdGVtc1tqXS5wYWdlX3BhdGggJiYgc2lkZWJhcml0ZW1zW2pdLm1hc3Rlcl9tZW51ID09PSBzdWJfbWVudV9saXN0W2ldLk1hc3Rlck1lbnUpKQ0KICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhzaWRlYmFyaXRlbXNbal0ubmFtZSkNCiAgICAgICAgICAgICAgICAgIGxldCB0ZW1wX3ZhciA9IHsNCiAgICAgICAgICAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBtZW51W3N1Yl9tZW51X2xpc3RbaV0uTWFzdGVyTWVudV0ubWVudV9saXN0LnB1c2godGVtcF92YXIpDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhlKTsNCiAgICAgICAgICAgICAgLy8gZGVidWdnZXI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtZW51ID0gT2JqZWN0LnZhbHVlcyhtZW51KQ0KICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhtZW51KTsNCiAgICAgICAgICAgIC8vIG1lbnUgPSBbXTsNCiAgICAgICAgICAgIC8vIHZhciB0aXRsZSA9IFtdOw0KICAgICAgICAgICAgLy8gdmFyIHN1Ym1lbnVzID0gW107DQogICAgICAgICAgICAvLyBmb3IgKGxldCBpID0gMCwgbiA9IHJlc3BvbnNlLmRhdGEuTWVudS5sZW5ndGg7IGkgPCBuOyBpICs9IDEpIHsNCiAgICAgICAgICAgIC8vICAgaWYgKA0KICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuTWVudVtpXS5IYXNTdWJNZW51cyA9PSBmYWxzZSAmJg0KICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuTWVudVtpXS5Jc01hc3Rlck1lbnUNCiAgICAgICAgICAgIC8vICAgKSB7DQogICAgICAgICAgICAvLyAgICAgZm9yICh2YXIgaiBpbiBzaWRlYmFyaXRlbXMpIHsNCiAgICAgICAgICAgIC8vICAgICAgIGlmIChzaWRlYmFyaXRlbXNbal0ubmFtZSA9PT0gcmVzcG9uc2UuZGF0YS5NZW51W2ldLk1lbnVJdGVtKSB7DQogICAgICAgICAgICAvLyAgICAgICAgIHRpdGxlID0gc2lkZWJhcml0ZW1zW2pdLm5hbWU7DQogICAgICAgICAgICAvLyAgICAgICAgIHN1Ym1lbnVzLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZSwNCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1lbnVbaV0uRW5hYmxlZCkgew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMucHVzaCh7DQogICAgICAgICAgICAvLyAgICAgICAgICAgICBzdWJfbWVudTogc2lkZWJhcml0ZW1zW2pdLm5hbWUsDQogICAgICAgICAgICAvLyAgICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICAgIH0NCiAgICAgICAgICAgIC8vICAgICAgIH0NCiAgICAgICAgICAgIC8vICAgICB9DQogICAgICAgICAgICAvLyAgIH0gZWxzZSBpZiAoDQogICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLkhhc1N1Yk1lbnVzID09IHRydWUgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSXNNYXN0ZXJNZW51DQogICAgICAgICAgICAvLyAgICkgew0KICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAvLyAgICAgICBpZiAoc2lkZWJhcml0ZW1zW2pdLm5hbWUgPT09IHJlc3BvbnNlLmRhdGEuTWVudVtpXS5NZW51SXRlbSkgew0KICAgICAgICAgICAgLy8gICAgICAgICB0aXRsZSA9IHNpZGViYXJpdGVtc1tqXS5uYW1lOw0KICAgICAgICAgICAgLy8gICAgICAgfQ0KICAgICAgICAgICAgLy8gICAgIH0NCiAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmICgNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSGFzU3ViTWVudXMgPT0gZmFsc2UgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSXNTdWJNZW51DQogICAgICAgICAgICAvLyAgICkgew0KICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAvLyAgICAgICBpZiAoc2lkZWJhcml0ZW1zW2pdLm5hbWUgPT09IHJlc3BvbnNlLmRhdGEuTWVudVtpXS5NZW51SXRlbSkgew0KICAgICAgICAgICAgLy8gICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NZW51W2ldLkVuYWJsZWQpIHsNCiAgICAgICAgICAgIC8vICAgICAgICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lLA0KICAgICAgICAgICAgLy8gICAgICAgICAgIH0pOw0KICAgICAgICAgICAgLy8gICAgICAgICB9DQogICAgICAgICAgICAvLyAgICAgICAgIHN1Ym1lbnVzLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZSwNCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICB9DQogICAgICAgICAgICAvLyAgICAgfQ0KICAgICAgICAgICAgLy8gICB9DQogICAgICAgICAgICAvLyAgIGlmIChpID09PSBuIC0gMSkgew0KICAgICAgICAgICAgLy8gICAgIG1lbnUucHVzaCh7DQogICAgICAgICAgICAvLyAgICAgICB0aXRsZTogdGl0bGUsDQogICAgICAgICAgICAvLyAgICAgICBtZW51X2xpc3Q6IHN1Ym1lbnVzLA0KICAgICAgICAgICAgLy8gICAgIH0pOw0KICAgICAgICAgICAgLy8gICAgIHRpdGxlID0gW107DQogICAgICAgICAgICAvLyAgICAgc3VibWVudXMgPSBbXTsNCiAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmICgNCiAgICAgICAgICAgIC8vICAgICBpIDwgbiAtIDEgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaSArIDFdLkhhc1N1Yk1lbnVzID09IHRydWUgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaSArIDFdLklzTWFzdGVyTWVudQ0KICAgICAgICAgICAgLy8gICApIHsNCiAgICAgICAgICAgIC8vICAgICBtZW51LnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgdGl0bGU6IHRpdGxlLA0KICAgICAgICAgICAgLy8gICAgICAgbWVudV9saXN0OiBzdWJtZW51cywNCiAgICAgICAgICAgIC8vICAgICB9KTsNCiAgICAgICAgICAgIC8vICAgICB0aXRsZSA9IFtdOw0KICAgICAgICAgICAgLy8gICAgIHN1Ym1lbnVzID0gW107DQogICAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAgIC8vIH0NCiAgICAgICAgICAgIC8vIC8vY29uc29sZS5sb2cobWVudSk7DQogICAgICAgICAgICB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0ID0gbWVudTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwNCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwNCiAgICAgICAgICAgICAgdGltZXI6MzAwMCwgICAgIA0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdHlwZTogImluZm8iLA0KICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICAgIHRpbWVyOjMwMDAsIA0KICAgICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsICAgIA0KICAgICAgICAgICAgfSk7ICANCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJwb3J0YWwgcGVybWlzc2lvbnMgdXJsIikNCiAgICAgICAgICAgIA0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KA0KICAgICAgICAgIGFwaV9jYWxscy5nZXRfdGFza19saXN0KCksDQogICAgICAgICAgew0KICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgaXNHZXRNZW51OiB0cnVlLA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfQ0KICAgICAgICApDQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpew0KICAgICAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJnZXQgdGFzayBsaXN0IikNCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhKSB7DQogICAgICAgICAgICAgIHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QucHVzaCh7DQogICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YVtpXSwNCiAgICAgICAgICAgICAgICB0b19iZV9kaXNwbGF5ZWQ6IHJlc3BvbnNlLmRhdGEuZGF0YVtpXSwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdFsNCiAgICAgICAgICAgICAgICBpDQogICAgICAgICAgICAgIF0udG9fYmVfZGlzcGxheWVkID0gdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdFtpXS50b19iZV9kaXNwbGF5ZWQNCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXy9nLCAiICIpDQogICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCkNCiAgICAgICAgICAgICAgICAuc3BsaXQoIiAiKQ0KICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzLnN1YnN0cmluZygxKSkNCiAgICAgICAgICAgICAgICAuam9pbigiICIpOw0KICAgICAgICAgICAgICB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0Ww0KICAgICAgICAgICAgICAgIGkNCiAgICAgICAgICAgICAgXS50b19iZV9kaXNwbGF5ZWQgPSB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0Ww0KICAgICAgICAgICAgICAgIGkNCiAgICAgICAgICAgICAgXS50b19iZV9kaXNwbGF5ZWQucmVwbGFjZSgvRm9ybS9nLCAiIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnVwZGF0ZV9ib3Rfcm9sZXMoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsDQogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksDQogICAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwNCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdub19kYXRhX3RleHQnKSwNCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICANCiAgICAgICAgICAgIHRvYXN0OnRydWUsDQogICAgICAgICAgICBwb3NpdGlvbjoidG9wLWVuZCIsDQogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsICAgDQogICAgICAgICAgICB9KTsgIA0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLA0KICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLA0KICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgICANCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgLy9jb25zb2xlLmxvZyhlKTsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8DQogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgKSB7DQogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICBpZih0aGlzLmZpbHRlcl91c2VyX3R5cGUgPT0gIlBvcnRhbCIpew0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGlzU2hvdzogdGhpcy5pc1Nob3dfcG9ydGFsX3JvbGVzLA0KICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7DQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKXsNCiAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSAsICJwb3J0YWwgcGVybWlzc2lvbnMgdXJsIikNCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhOw0KICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKChtZW51bGlzdCkgPT4gew0KICAgICAgICAgICAgICAgICAgaWYgKG1lbnVsaXN0LkVuYWJsZWQgJiYgIW1lbnVsaXN0Lkhhc1N1Yk1lbnVzKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBwZXJtaXNzaW9ucykgew0KICAgICAgICAgICAgICAgICAgcGVybV9saXN0LnB1c2gocGVybWlzc2lvbnNbal0uTWVudUl0ZW0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgdXNlcl9yb2xlOiBsaXN0W2ldLlJvbGUsDQogICAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLA0KICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1fbGlzdCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24oMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsDQogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksDQogICAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICANCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwNCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLA0KICAgICAgICAgICAgICB0aW1lcjozMDAwLCANCiAgICAgICAgICAgICAgdG9hc3Q6dHJ1ZSwNCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwNCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLCAgIA0KICAgICAgICAgICAgfSk7ICANCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAgIA0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KA0KICAgICAgICAgIGFwaV9jYWxscy5zaG93X2ludGVudF91cmwoKSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICBnZXRfaW50ZW50czogdHJ1ZSwNCiAgICAgICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIiwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0NCiAgICAgICAgKQ0KICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IA0KICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7DQogICAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSAsICJwb3J0YWwgcGVybWlzc2lvbnMgdXJsIikNCiAgICAgICAgICAgICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCJzaG93IGludGVudCB1cmwiKQ0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLmludGVudGxpc3QucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIC8vIHBlcm1pc3Npb25zOiByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgLy8gdG9fYmVfZGlzcGxheWVkOiByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YVtpXSwNCiAgICAgICAgICAgICAgICAgICAgdG9fYmVfZGlzcGxheWVkOiByZXNwb25zZS5kYXRhLmRhdGFbaV0sDQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsNCiAgICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwNCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLA0KICAgICAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICANCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgDQogICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgcG9zaXRpb246InRvcC1lbmQiLA0KICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLCAgIA0KICAgICAgICAgICAgICB9KTsgIA0KICAgICAgICAgICAgfSAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpDQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0sDQogICAgc3ZnX2VuYWJsZSh2YWx1ZSkgew0KICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNlbGVjdGVkX3JvbGUpIHsNCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfcm9sZVtpXS5zdWJfbWVudSA9PSB2YWx1ZSkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gImRpc3BsYXk6bm9uZSI7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHNlbGVjdGVkX3JvbGVzKGluZGV4KSB7DQogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsNCiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7DQogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLnJvbGVzOw0KICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsNCiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsNCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgew0KICAgICAgICAgIGxldCB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKHRoaXMucm9sZXNbaW5kZXhdKTsNCiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMucm9sZXNbaW5kZXhdOw0KICAgICAgICAgIGlmICh2YWxfaW5kZXggPT0gLTEpIHsNCiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGVtcCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7DQogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsNCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgc2VsZWN0YWxsLmNoZWNrZWQgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKHJvbGVzKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gcm9sZS5yb2xlICE9PSBpbmRleDsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHJvbGVfbW9kYWwodHlwZSkgew0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIC8vIGRlYnVnZ2VyOw0KICAgICAgLy8gaWYodHlwZSA9PSAndG9nZ2xlJyl7DQogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT09IG51bGwpIHsNCiAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGVpdGhlciBvZiB0aGUgVXNlciBUeXBlcyIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5yb2xlX2xpc3QgPSB0aGlzLmNvbXBsZXRlX3JvbGVfbGlzdFt0aGlzLnVzZXJfdHlwZV07DQogICAgICB9DQogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsNCiAgICAgICAgaWYgKHRoaXMucG9ydGFsX3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLnJvbGVfbGlzdCA9IHRoaXMuY29tcGxldGVfcm9sZV9saXN0WyJQb3J0YWwiXTsNCiAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgncGVybWlzc2lvbl9ub19yb2xlc19wb3J0YWxfdHlwZV9tc2cnKSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsNCiAgICAgICAgaWYgKHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLnJvbGVfbGlzdCA9IHRoaXMuY29tcGxldGVfcm9sZV9saXN0WyJCb3QiXTsNCiAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIFR5cGU6ICJBY3Rpb25zIiwNCiAgICAgICAgICAgICAgRGV0YWlsczogdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIFR5cGU6ICJJbnRlbnRzIiwNCiAgICAgICAgICAgICAgRGV0YWlsczogdGhpcy5pbnRlbnRsaXN0LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICBdOw0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSAiIjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBTd2FsLmZpcmUoew0KICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3Blcm1pc3Npb25fbm9fcm9sZXNfYm90X3R5cGVfbXNnJyksDQogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwNCiAgICAgICAgICAgIHRpbWVyOiA2MDAwLA0KICAgICAgICAgIH0pOw0KICAgICAgICAgIC8vIHRvYXN0ci53YXJuaW5nKCJObyBSb2xlcyBBZGRlZCBmb3IgQm90IFVzZXIgVHlwZS4gUGxlYXNlIEFkZCBhIFJvbGUgZnJvbSB0aGUgJ1JvbGVzJyBQYWdlIHRvIGNvbnRpbnVlIGFkZGluZyBQZXJtaXNzaW9ucy4iKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgDQogICAgICBpZiAodHlwZSA9PSAib3BlbiIpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZF9yb2xlID0gIiI7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsNCiAgICAgICAgdGhpcy51c2VyX3R5cGVfY2hhbmdlID0gZmFsc2U7DQogICAgICAgIC8vIGlmICh0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPiAwIHx8IHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgaWYgKHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAvLyB0aGlzLmNsZWFyX2ZpZWxkcygpDQogICAgICAgICAgJCgiI2ludGVudG1vZGFsIikubW9kYWwoInNob3ciKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvLyB0b2FzdHIuZXJyb3IoDQogICAgICAgICAgLy8gICAiUGxlYXNlIEFkZCBhIFJvbGUgZnJvbSB0aGUgJ1JvbGVzJyBQYWdlIHRvIGNvbnRpbnVlIGFkZGluZyBQZXJtaXNzaW9ucyINCiAgICAgICAgICAvLyApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBkZWxldGVfc2VsZWN0ZWQoKSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgbGV0IHJvbGVsaXN0ID0gW10sDQogICAgICAgIHJlc3RyaWN0aW9ubGlzdCA9IFtdOw0KICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnJvbGVzKSB7DQogICAgICAgIHJvbGVsaXN0LnB1c2godGhpcy5yb2xlc1tpbmRleF0ucm9sZSk7DQogICAgICAgIHJlc3RyaWN0aW9ubGlzdC5wdXNoKHRoaXMucm9sZXNbaW5kZXhdLnBlcm1pc3Npb25zKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuZGVsZXRlX3Fuc19hcGkocm9sZWxpc3QsIHJlc3RyaWN0aW9ubGlzdCk7DQogICAgfSwNCiAgICBkZWxldGVfcm9sZShpbmRleCkgew0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICB9LA0KICAgIGVkaXRfbW9kYWwoaW5kZXgpIHsNCiAgICAgIHRoaXMudXNlcl90eXBlX2NoYW5nZSA9IGZhbHNlOw0KICAgICAgdGhpcy5zZWxlY3Rfcm9sZV9uYW1lX2Rpc2FibGUgPSB0cnVlOw0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3BvcnRhbF9ib3giKS5kaXNhYmxlZCA9IHRydWU7DQogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjYm90X2JveCIpLmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcm9sZSA9IHRoaXMucm9sZXNbaW5kZXhdLnVzZXJfcm9sZTsNCiAgICAgIC8vIC8vY29uc29sZS5sb2codGhpcy5yb2xlc1tpbmRleF0udXNlcl9yb2xlKTsNCiAgICAgIHRoaXMudXNlcl90eXBlID0gdGhpcy5yb2xlc1tpbmRleF0udXNlci5yZXBsYWNlKCIgVXNlciIsICIiKTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsNCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiQm90Iikgew0KICAgICAgICAvLyB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSBbDQogICAgICAgICAgew0KICAgICAgICAgICAgVHlwZTogIkFjdGlvbnMiLA0KICAgICAgICAgICAgRGV0YWlsczogdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdCwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIFR5cGU6ICJJbnRlbnRzIiwNCiAgICAgICAgICAgIERldGFpbHM6IHRoaXMuaW50ZW50bGlzdCwNCiAgICAgICAgICB9LA0KICAgICAgICBdOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgew0KICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgfQ0KICAgICAgZm9yICh2YXIgaiBpbiB0aGlzLnJvbGVzW2luZGV4XS5wZXJtaXNzaW9ucykgew0KICAgICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsNCiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnB1c2goew0KICAgICAgICAgICAgcGVybWlzc2lvbnM6IHRoaXMucm9sZXNbaW5kZXhdLm9yaWdpbmFsX3Blcm1pc3Npb25zW2pdLA0KICAgICAgICAgICAgdG9fYmVfZGlzcGxheWVkOiB0aGlzLnJvbGVzW2luZGV4XS5wZXJtaXNzaW9uc1tqXSwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgew0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMucHVzaCh7DQogICAgICAgICAgICBzdWJfbWVudTogdGhpcy5yb2xlc1tpbmRleF0ucGVybWlzc2lvbnNbal0sDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMucm9sZV9saXN0ID0gdGhpcy5jb21wbGV0ZV9yb2xlX2xpc3RbdGhpcy51c2VyX3R5cGVdOw0KICAgIH0sDQogICAgcGFnZV9yZXF1aXJlKHBhZ2UpIHsNCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgew0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsNCiAgICAgICAgICBpZiAodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKXsNCiAgICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgew0KICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7DQogICAgICAgICAgICAvLyB0aGlzLnBhZ2Vfbm8gPSBwYWdlOw0KICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOw0KICAgICAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcm9sZTogdGhpcy51c2VyX3JvbGUsDQogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICAgICAgICBpc1Nob3c6IHRoaXMuaXNTaG93X3BvcnRhbF9yb2xlcywNCiAgICAgICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLA0KICAgICAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpew0KICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZyhyZXNwb25zZSAsICJwb3J0YWwgcGVybSIpDQogICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsNCiAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7DQogICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLlJvbGVQZXJtaXNzaW9uRGF0YTsNCiAgICAgICAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gbGlzdCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKChtZW51bGlzdCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChtZW51bGlzdC5FbmFibGVkICYmICFtZW51bGlzdC5IYXNTdWJNZW51cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbnVsaXN0Lk1lbnVJdGVtOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBwZXJtX2xpc3QgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBwZXJtaXNzaW9ucykgew0KICAgICAgICAgICAgICAgICAgICAgIHBlcm1fbGlzdC5wdXNoKHBlcm1pc3Npb25zW2pdLk1lbnVJdGVtKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogbGlzdFtpXS5Sb2xlLA0KICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IGxpc3RbaV0uVXNlclR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1fbGlzdCwNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7DQogICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLA0KICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwNCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICANCiAgICAgICAgICB9KTsNCiAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7DQogICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdub19kYXRhX3RleHQnKSwNCiAgICAgICAgICAgICAgdGltZXI6MzAwMCwgDQogICAgICAgICAgICAgIHRvYXN0OnRydWUsDQogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgICAgDQogICAgICAgICAgfSk7ICANCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9KSAgICAgDQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsdGVyX3VzZXJfdHlwZSA9PSAiQm90Iikgew0KICAgICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsNCiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGF4aW9zDQogICAgICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgICAgIGFwaV9jYWxscy5hZGRfZWRpdF9ib3Rfcm9sZSgpLA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgICAgIGlzU2hvdzogdGhpcy5pc1Nob3dfYm90X3JvbGVzLA0KICAgICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsDQogICAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGEpIHsNCiAgICAgICAgICAgICAgICAgIC8vIGxldCBib3RSb2xlcyA9IHRoaXMuYm90X3JvbGVzLm1hcCgoeyByb2xlIH0pID0+IHsNCiAgICAgICAgICAgICAgICAgIC8vICAgcmV0dXJuIHJvbGU7DQogICAgICAgICAgICAgICAgICAvLyB9KTsNCiAgICAgICAgICAgICAgICAgIC8vIGlmIChib3RSb2xlcy5pbmNsdWRlcyhpKSkgew0KICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYm90X3JvbGVzLmluY2x1ZGVzKGkpKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucm9sZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgdXNlcjogIkJvdCBVc2VyIiwNCiAgICAgICAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IGAke2l9YCwNCiAgICAgICAgICAgICAgICAgICAgICBpbnB1dF9lbmFibGU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0ubWFwKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL18vZywgIiAiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoIiAiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgIC5qb2luKCIgIik7DQogICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxfcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0sDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImVycm9yIiwNCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgDQogICAgICAgICAgfSk7DQogICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImluZm8iLA0KICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLA0KICAgICAgICAgICAgdGltZXI6MzAwMCwgIA0KICAgICAgICAgICAgdG9hc3Q6dHJ1ZSwNCiAgICAgICAgICAgIHBvc2l0aW9uOiJ0b3AtZW5kIiwNCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgDQogICAgICAgICAgfSk7ICANCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgICANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQ0KICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsNCiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7DQogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsNCiAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgLnBvc3QoDQogICAgICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfcGVybWlzc2lvbnNfdXJsKCksDQogICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwNCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLA0KICAgICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwNCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICApDQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgICAgLy8gLy9jb25zb2xlLmxvZygicGVybWlzc2lvbiIgLCByZXNwb25zZSkNCiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERQ0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5Sb2xlUGVybWlzc2lvbkRhdGE7DQogICAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsNCiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsNCiAgICAgICAgICAgICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IGxpc3RbaV0uTWVudS5maWx0ZXIoKG1lbnVsaXN0KSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChtZW51bGlzdC5FbmFibGVkICYmICFtZW51bGlzdC5IYXNTdWJNZW51cykgew0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHBlcm1pc3Npb25zKSB7DQogICAgICAgICAgICAgICAgICAgIHBlcm1fbGlzdC5wdXNoKHBlcm1pc3Npb25zW2pdLk1lbnVJdGVtKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIHRoaXMucm9sZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogbGlzdFtpXS5Sb2xlLA0KICAgICAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLA0KICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogcGVybV9saXN0LA0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImVycm9yIiwNCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgDQogICAgICAgICAgfSk7DQogICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImluZm8iLA0KICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICAgIHRpbWVyOjMwMDAsIA0KICAgICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsICAgDQogICAgICAgICAgfSk7ICANCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyBlbHNlIGlmKHJlc3BvbnNlLmRhdGEuTVNHPT0nTm8gUmVzdWx0cyBGb3VuZCcpew0KICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiTm8gcm9sZSBmb3VuZCIpOw0KICAgICAgICAgICAgICAvLyAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAvLyAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsNCiAgICAgICAgICAgICAgLy8gICAgIH0sIDI1MDApOw0KICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgIC8vIGVsc2UgaWYocmVzcG9uc2UuZGF0YS5NU0c9PSdJbnRybmFsIFNlcnZlciBFcnJvcicpew0KICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgLy8gICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy4kcm91dGVyLmdvKCk7DQogICAgICAgICAgICAgIC8vICAgICB9LCAyNTAwKTsNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBzYXZlX3JvbGUoKSB7DQogICAgICBpZiAodGhpcy5zZWxlY3RlZF9yb2xlID09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMubGVuZ3RoID09IDApIHsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RlZF9yb2xlID09ICJBZG1pbiIpIHsNCiAgICAgICAgdGhpcy5jbGVhcl9maWVsZHMoKTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsNCiAgICAgICAgdmFyIHNlbGVjdGVkX21lbnUgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zKSB7DQogICAgICAgICAgc2VsZWN0ZWRfbWVudS5wdXNoKHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnNbaV0uc3ViX21lbnUpOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5tZW51X2xpc3RfZnJvbV9hcGkpIHsNCiAgICAgICAgICBpZiAoc2VsZWN0ZWRfbWVudS5pbmNsdWRlcyh0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaVtpXS5NZW51SXRlbSkpDQogICAgICAgICAgICB0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaVtpXS5FbmFibGVkID0gdHJ1ZTsNCiAgICAgICAgICBlbHNlIHRoaXMubWVudV9saXN0X2Zyb21fYXBpW2ldLkVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGlzRWRpdDogdHJ1ZSwNCiAgICAgICAgICAgICAgcm9sZV9uYW1lOiB0aGlzLnNlbGVjdGVkX3JvbGUsDQogICAgICAgICAgICAgIHVzZXJfdHlwZTogdGhpcy51c2VyX3R5cGUgKyAiIFVzZXIiLA0KICAgICAgICAgICAgICBtZW51OiB0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICApDQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImVycm9yIiwNCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgDQogICAgICAgICAgfSk7DQogICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgdHlwZTogImluZm8iLA0KICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICAgIHRpbWVyOjMwMDAsIA0KICAgICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsICAgIA0KICAgICAgICAgIH0pOyAgDQogICAgICAgIH0NCiAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFUl9ST0xFX0VESVRFRF9TVUNDRVNTRlVMTFlfMjAwMi5NU0dfQ09ERSkgew0KICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0aGlzLnRsdCgncGVybWlzc2lvbl91cGRhdGVkX2Zvcl9sb2dpbl9tc2cxJykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOw0KICAgICAgICAgICAgdGhpcy5sb2FkX3Blcm1pc3Npb24oKTsNCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaCgoZSkgPT4gew0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQ0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnc2F2ZV9wZXJtaXNzaW9ucycpDQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiKSB7DQogICAgICAgIHZhciBzZWxlY3RlZF9tZW51ID0gW107DQogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucykgew0KICAgICAgICAgIHNlbGVjdGVkX21lbnUucHVzaCh0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zW2ldLnBlcm1pc3Npb25zKTsNCiAgICAgICAgfQ0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLmFkZF9lZGl0X2JvdF9yb2xlKCksDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICBib3Rfcm9sZV9uYW1lOiB0aGlzLnNlbGVjdGVkX3JvbGUsDQogICAgICAgICAgICAgIHBlcm1pc3Npb25fbGlzdDogc2VsZWN0ZWRfbWVudSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICApDQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsNCiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3ModGhpcy50bHQoJ3Blcm1pc3Npb25fdXBkYXRlZF9mb3JfbG9naW5fbXNnMicpKTsNCiAgICAgICAgICAgICAgdGhpcy5sb2FkX3Blcm1pc3Npb24oKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgew0KICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3Blcm1pc3Npb25faW50ZXJuYWxfc2VydmVyX21zZycpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7DQogICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgDQogICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgcG9zaXRpb246InRvcC1lbmQiLA0KICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLCAgIA0KICAgICAgICAgIH0pOyAgDQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdzYXZlX3Blcm1pc3Npb25zJykNCiAgICAgIH0NCiAgICB9LA0KICAgIGVkaXRfcmVzdHJpY3Rpb25zKGluZGV4KSB7DQogICAgICBpZiAodGhpcy5yb2xlc1tpbmRleF0udXNlciAhPSAiIikgew0KICAgICAgICB0aGlzLnJvbGVzW2luZGV4XS5pbnB1dF9lbmFibGUgPSAhdGhpcy5yb2xlc1tpbmRleF0uaW5wdXRfZW5hYmxlOw0KICAgICAgfQ0KICAgICAgdGhpcy5lZGl0ID0gdHJ1ZTsNCiAgICB9LA0KICAgIHVwZGF0ZV9saXN0KHJlc3BvbnNlKSB7DQogICAgICAvLyB0aGlzLnJvbGVzID0gW107DQogICAgICB2YXIgaW5wdXQ7DQogICAgICAvLyAvL2NvbnNvbGUubG9nKHJlc3BvbnNlLCdyZXNwb25zZXMnKTsNCiAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKQ0KICAgICAgaWYgKHJlc3BvbnNlLnJlc3RyaWN0aW9ubGlzdFswXSAhPSBudWxsKSB7DQogICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLnJlc3RyaWN0aW9ubGlzdCkgew0KICAgICAgICBpZiAocmVzcG9uc2UucmVzdHJpY3Rpb25saXN0W2ldID09ICIiKSB7DQogICAgICAgICAgaW5wdXQgPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlucHV0ID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHsNCiAgICAgICAgICB1c2VyOiByZXNwb25zZS5yZXN0cmljdGlvbmxpc3RbaV0sDQogICAgICAgICAgcm9sZTogcmVzcG9uc2Uucm9sZWxpc3RbaV0sDQogICAgICAgICAgaW5wdXRfZW5hYmxlOiBpbnB1dCwNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB1cGRhdGVfYm90X3JvbGVzKCkgew0KICAgICAgaWYgKHRoaXMuZmlsdGVyX3VzZXJfdHlwZSA9PSAiQm90Iil7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QoDQogICAgICAgICAgICBhcGlfY2FsbHMuYWRkX2VkaXRfYm90X3JvbGUoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGlzU2hvdzogdGhpcy5pc1Nob3dfYm90X3JvbGVzLA0KICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpew0KICAgICAgICAgICAgIA0KICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsNCiAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhKSB7DQogICAgICAgICAgICAgIC8vIGxldCBib3RSb2xlcyA9IHRoaXMuYm90X3JvbGVzLm1hcCgoeyByb2xlIH0pID0+IHsNCiAgICAgICAgICAgICAgLy8gICByZXR1cm4gcm9sZTsNCiAgICAgICAgICAgICAgLy8gfSk7DQogICAgICAgICAgICAgIC8vIGlmIChib3RSb2xlcy5pbmNsdWRlcyhpKSkgew0KICAgICAgICAgICAgICBpZiAodGhpcy5ib3Rfcm9sZXMuaW5jbHVkZXMoaSkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgdXNlcjogIkJvdCBVc2VyIiwNCiAgICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogYCR7aX1gLA0KICAgICAgICAgICAgICAgICAgaW5wdXRfZW5hYmxlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0ubWFwKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcw0KICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9fL2csICIgIikNCiAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCgiICIpDQogICAgICAgICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vic3RyaW5nKDEpKQ0KICAgICAgICAgICAgICAgICAgICAgIC5qb2luKCIgIik7DQogICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Blcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhW2ldLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7DQogICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLA0KICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX2ludGVybmFsX3NlcnZlcl9tc2cnKSwNCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICANCiAgICAgICAgICB9KTsNCiAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7DQogICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbm9fZGF0YV90ZXh0JyksDQogICAgICAgICAgICB0aW1lcjozMDAwLCAgDQogICAgICAgICAgICB0b2FzdDp0cnVlLA0KICAgICAgICAgICAgcG9zaXRpb246InRvcC1lbmQiLA0KICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLA0KICAgICAgICAgIH0pOyAgDQoNCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgICAgU3dhbCh7DQogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsDQogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOw0KICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsNCiAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsNCiAgICAgIGlmIChpbmRleCA9PSB0aGlzLnBhZ2Vfbm8pIHsNCiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGNsZWFyX2ZpZWxkcygpIHsNCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNwb3J0YWxfYm94IikuZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNib3RfYm94IikuZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcm9sZSA9ICIiOw0KICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucyA9IFtdOw0KICAgICAgJCgiI2ludGVudG1vZGFsIikubW9kYWwoImhpZGUiKTsNCiAgICB9LA0KICAgIGNhbGxzZWFyY2goKSB7DQogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsNCiAgICAgICAgdGhpcy5zZWFyY2hfcHJvZHVjdCgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2VhcmNoX3Byb2R1Y3QoKSB7DQogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgew0KICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QoDQogICAgICAgICAgICBhcGlfY2FsbHMucG9ydGFsX3Blcm1pc3Npb25zX3VybCgpLA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwNCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsDQogICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwNCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsDQogICAgICAgICAgICAgIHBhZ2Vfbm86IDEsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhOw0KICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOw0KICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOw0KICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxOw0KICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgICAgdGhpcy5yb2xlcyA9IFtdOw0KICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKChtZW51bGlzdCkgPT4gew0KICAgICAgICAgICAgICAgICAgaWYgKG1lbnVsaXN0LkVuYWJsZWQgJiYgIW1lbnVsaXN0Lkhhc1N1Yk1lbnVzKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBwZXJtaXNzaW9ucykgew0KICAgICAgICAgICAgICAgICAgcGVybV9saXN0LnB1c2gocGVybWlzc2lvbnNbal0uTWVudUl0ZW0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgdXNlcl9yb2xlOiBsaXN0W2ldLlJvbGUsDQogICAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLA0KICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1fbGlzdCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgew0KICAgICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoInBlcm1pc3Npb25fbm9fcm9sZV9mb3VuZF9tc2ciKSwNCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsDQogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsDQogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLA0KICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciINCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIA0KICAgICAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKSB7DQogICAgICAgICAgICAgIFN3YWwoew0KICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgicGVybWlzc2lvbl9pbnRlcm5hbF9zZXJ2ZXJfbXNnMiIpLA0KICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwNCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICApDQogICAgICAgICAgICANCiAgICAgICAgIA0KICAgICAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBTd2FsKHsNCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwNCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywNCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsDQogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIg0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgncGVybWlzc2lvbl9kYXRhX2Zvcl9zZWFyY2hfbXNnJykpOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7DQogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsNCiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7DQogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOw0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsNCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7DQogICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgew0KICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX25vICsgMzsgaSsrKSB7DQogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOw0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOw0KICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOw0KICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDM7IGkgPD0gcGFnZV9ubyArIDM7IGkrKykgew0KICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOw0KICAgICAgfQ0KICAgIH0sDQogIH0sDQp9Ow0K"},null]}