{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Campaigns/WhatsappBroadcast.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Campaigns/WhatsappBroadcast.vue","mtime":1663910265454},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7CiAgZnJlZXplX3BvcnRhbCwKICBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwsCiAgY2xvc2VfbW9kYWwsCn0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gInZ1ZS1waG9uZS1udW1iZXItaW5wdXQiOwppbXBvcnQgInZ1ZS1waG9uZS1udW1iZXItaW5wdXQvZGlzdC92dWUtcGhvbmUtbnVtYmVyLWlucHV0LmNzcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIldoYXRzYXBwQnJvYWRjYXN0UGFnZSIsCiAgY29tcG9uZW50czogewogICAgVnVlRWRpdG9yLAogICAgTXVsdGlzZWxlY3QsCiAgICBWdWVQaG9uZU51bWJlcklucHV0LAogIH0sCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCwgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsLCBjbG9zZV9tb2RhbF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGJyb2FkY2FzdF9saXN0OiBbXSwKICAgICAgc2VhcmNoX3RlbXBsYXRlX25hbWU6ICcnLAogICAgICBzZWxlY3RfdGVtcGxhdGVfbGlzdDpbXSwKICAgICAgcGVuY2lsX3N2ZzoKICAgICAgICAnIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUuNTQ2IiBoZWlnaHQ9IjE1LjQ2MSIgdmlld0JveD0iMCAwIDE1LjU0NiAxNS40NjEiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiM5ZTllOWU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03NDcuODg4IC0zNTYuNzY5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik03NTkuNDE2LDM1Ni43NjlhMi4zNTgsMi4zNTgsMCwwLDEsMS43NzcuNjYyYy41MzQuNTEzLDEuMDcyLDEuMDI1LDEuNTY3LDEuNTc1YTIuMywyLjMsMCwwLDEtLjA3MSwzLjMyNWMtMi43MzYsMi43Ni01LjQ5NCw1LjUtOC4yMzgsOC4yNTFhMS4zODEsMS4zODEsMCwwLDEtLjc1OC4yODhjLS43MTkuMTc0LTEuNDI5LjM3OS0yLjE0NC41NzItLjkzMi4yNTEtMS44NjIuNS0yLjc5NS43NTEtLjYuMTU4LS45ODktLjIxMy0uODMyLS44MDdxLjY4OS0yLjU5NSwxLjQwNi01LjE4MmExLjE2NCwxLjE2NCwwLDAsMSwuMjg5LS40ODdxNC4wOTEtNC4xMDcsOC4yLTguMkEyLjI2NSwyLjI2NSwwLDAsMSw3NTkuNDE2LDM1Ni43NjlabS0xLjk4OSwyLjk1Ni02LjU0LDYuNTM4LDMuMDI1LDMuMDI0LDYuNTM4LTYuNTM3Wm00LjAyMywyLjE2NWMuMTE4LS4xMzUuMjI1LS4yNjkuMzQzLS4zOTJhMS4xMzQsMS4xMzQsMCwwLDAsMC0xLjczNGMtLjQ2LS40NjYtLjkyNi0uOTI1LTEuMzg4LTEuMzlhMS4xNjYsMS4xNjYsMCwwLDAtLjg2MS0uMzY4Yy0uNTc4LDAtLjg4MS40LTEuMjE0Ljc2Wm0tMTIuMDg0LDguODYzLDMuMi0uODYzLTIuMzM3LTIuMzMxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTgxMy45NDIsNDIyLjZsLS43ODktLjgsMy44MjEtMy44MTkuNzg0LjhaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTkuNjQ4IC01NS45NDcpIi8+PC9nPjwvc3ZnPicsCiAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIG5hbWU6ICIiLAogICAgICB0ZW1wbGF0ZWxpc3Q6IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBjdXJyZW50X2Jyb2FkY2FzdDoge30sCiAgICAgIG9sZF9icm9hZGNhc3RfbmFtZTogIiIsCiAgICAgIGN1cnJlbnRfYnJvYWRjYXN0X2hpZ2hsaWdodF9uYW1lOiAiIiwKICAgICAgaXNFZGl0QnJvYWRjYXN0OiBmYWxzZSwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTAsCiAgICAgIGJyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3Q6IGZhbHNlLAogICAgICBlZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3Q6IGZhbHNlLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgY29udGFjdHNfbGlzdDogW10sCiAgICAgIHNlbGVjdF9jdXN0b21lcl9saXN0OiBbXSwKICAgICAgY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uOiAxLAogICAgICBjb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uOiAxLAogICAgICB0ZW1wbGF0ZV9saXN0X3BhZ2luYXRpb246IDEsCiAgICAgIHRlbXBsYXRlX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb246IDEsCiAgICAgIGNvbnRhY3RzX2xpc3RfcGFnaW5hdGlvbl9jb3VudDogMCwKICAgICAgY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbl9jb3VudDogMCwKICAgICAgdGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uX2NvdW50OiAwLAogICAgICB0ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50OiAwLAogICAgICBzZWFyY2hfY3VzdG9tZXI6ICIiLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBzZWFyY2hfbmFtZTogIiIsCiAgICB9OwogIH0sCiAgcHJvcHM6IHsKICAgIGlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZTogQm9vbGVhbiwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5nZXRfZGF0YSgpOwogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9PSAiIikgewogICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSB0cnVlOwogICAgICB9CiAgICB9LAogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDIwMDApOwogICAgdGhpcy5nZXRfZGF0YSgpOwogICAgLy8gICBpZiAodGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUgPT09IGZhbHNlKSB7CiAgICB0aGlzLmxvYWRfY3VzdG9tZXJfbGlzdCgpOwogICAgdGhpcy5nZXRfdGVtcGxhdGVfZGF0YSgpOwogICAgLy8gICB9CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbGlzdF9pZCIpOwogICAgZWwub253aGVlbCA9IHRoaXMuaGFuZGxlV2hlZWw7CiAgICBjb25zdCBlbDEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjdGVtcGxhdGVfbGlzdF9pZCIpOwogICAgZWwxLm9ud2hlZWwgPSB0aGlzLmhhbmRsZVdoZWVsX3RlbXBsYXRlOwogIH0sCiAgbWV0aG9kczogewogICAgbmFtZVdpdGhOdW1iZXIoeyBwcm9maWxlX25hbWUsIHdoYXRzYXBwX3Bob25lX251bWJlciB9KSB7CiAgICAgIHJldHVybiBgJHtwcm9maWxlX25hbWV9IDogJHt3aGF0c2FwcF9waG9uZV9udW1iZXJ9YDsKICAgIH0sCiAgICBoYW5kbGVXaGVlbChldmVudCwgZGF0YSwgZnVuYykgewogICAgICBpZiAoZXZlbnQuZGVsdGFZID4gMCkgewogICAgICAgIGlmKHRoaXMuc2VhcmNoX2N1c3RvbWVyICE9ICIiKXsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uIDwgdGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50CiAgICAgICAgICApewogICAgICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gKz0gMTsKICAgICAgICAgICAgdGhpcy5zZWFyY2hfY3VzdG9tZXJfbGlzdCh0aGlzLnNlYXJjaF9jdXN0b21lciwgJ3Njcm9sbCcpOwogICAgICAgICAgfQogICAgICAgIH1lbHNlIGlmICgKICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uIDwgdGhpcy5jb250YWN0c19saXN0X3BhZ2luYXRpb25fY291bnQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uICs9IDE7CiAgICAgICAgICB0aGlzLmxvYWRfY3VzdG9tZXJfbGlzdCgnc2Nyb2xsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlV2hlZWxfdGVtcGxhdGUoZXZlbnQsIGRhdGEsIGZ1bmMpIHsKICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDApIHsKICAgICAgICBpZih0aGlzLnNlYXJjaF90ZW1wbGF0ZV9uYW1lICE9ICIiKXsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uIDwgdGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50CiAgICAgICAgICApewogICAgICAgICAgICB0aGlzLnRlbXBsYXRlX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24gKz0gMTsKICAgICAgICAgICAgdGhpcy5zZWFyY2hfdGVtcGxhdGUodGhpcy5zZWFyY2hfdGVtcGxhdGVfbmFtZSwgJ3Njcm9sbCcpOwogICAgICAgICAgfQogICAgICAgIH1lbHNlIGlmICgKICAgICAgICAgIHRoaXMudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uIDwgdGhpcy50ZW1wbGF0ZV9saXN0X3BhZ2luYXRpb25fY291bnQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uICs9IDE7CiAgICAgICAgICB0aGlzLmdldF90ZW1wbGF0ZV9kYXRhKCdzY3JvbGwnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuYnJvYWRjYXN0czsKICAgICAgICAgICAgICBpZiAodGhpcy5icm9hZGNhc3RfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dfYnJvYWRjYXN0KDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbigxKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNFZGl0QnJvYWRjYXN0ID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVfVVVJRCgpIHsKICAgICAgdmFyIGR0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciB1dWlkID0gInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCIucmVwbGFjZSgKICAgICAgICAvW3h5XS9nLAogICAgICAgIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICB2YXIgciA9IChkdCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgICBkdCA9IE1hdGguZmxvb3IoZHQgLyAxNik7CiAgICAgICAgICByZXR1cm4gKGMgPT0gIngiID8gciA6IChyICYgMHgzKSB8IDB4OCkudG9TdHJpbmcoMTYpOwogICAgICAgIH0KICAgICAgKTsKICAgICAgcmV0dXJuIHV1aWQ7CiAgICB9LAogICAgc2F2ZV90ZW1wbGF0ZSgpIHsKICAgICAgaWYgKHRoaXMubmFtZSA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoIkJyb2FkY2FzdCBuYW1lIGNhbm5vdCBiZSBibGFuay4iKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5zZWxlY3RfY3VzdG9tZXJfbGlzdC5sZW5ndGggPCAyKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiTWluaW11bSB0d28gY29udGFjdHMgcmVxdWlyZWQgdG8gY3JlYXRlIGEgYnJvYWRjYXN0LiIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICAgIGJyb2FkY2FzdDogewogICAgICAgICAgICAgIGlkOiB0aGlzLmNyZWF0ZV9VVUlEKCksCiAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLAogICAgICAgICAgICAgIGNvbnRhY3RzOiB0aGlzLnNlbGVjdF9jdXN0b21lcl9saXN0LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgICQoIiNhZGRicm9hZGNhc3Rtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiQnJvYWRjYXN0IGRhdGEgYWRkZWQgc3VjY2Vzc2Z1bGx5IiksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICB0aGlzLmdldF9kYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5TVUZGSUNJRU5UX1dIQVRTQVBQX0JST0FEQ0FTVF9JTkZPUk1BVElPTi5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICApIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJNaW5pbXVtIHR3byBjb250YWN0cyByZXF1aXJlZCB0byBjcmVhdGUgYSBicm9hZGNhc3QiKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB0aGlzLmNsb3NlX21vZGFsKCJyZXNfbl9pbnRfc2F2ZSIpOwogICAgfSwKICAgIGVkaXRfdGVtcGxhdGVfZGV0YWlscygpIHsKICAgICAgaWYgKCF0aGlzLmlzRWRpdEJyb2FkY2FzdCkgewogICAgICAgIHRoaXMuaXNFZGl0QnJvYWRjYXN0ID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzRWRpdEJyb2FkY2FzdCA9IGZhbHNlOwogICAgICAgIHRoaXMuZ2V0X2RhdGEoKTsKICAgICAgICB0aGlzLmVkaXRfYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgZWRpdF9icm9hZGNhc3QoKSB7CiAgICAgIGlmICh0aGlzLmN1cnJlbnRfYnJvYWRjYXN0Lm5hbWUgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJCcm9hZGNhc3QgbmFtZSBjYW5ub3QgYmUgYmxhbmsiKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5jb250YWN0cy5sZW5ndGggPCAyKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiTWluaW11bSB0d28gY29udGFjdHMgcmVxdWlyZWQgZm9yIGEgYnJvYWRjYXN0LiIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVkaXRfYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9icm9hZGNhc3RzKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgYnJvYWRjYXN0OiB7CiAgICAgICAgICAgICAgaWQ6IHRoaXMuY3VycmVudF9icm9hZGNhc3QuaWQsCiAgICAgICAgICAgICAgbmFtZTogdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5uYW1lLAogICAgICAgICAgICAgIGNvbnRhY3RzOiB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0LmNvbnRhY3RzLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgICQoIiNhZGRicm9hZGNhc3Rtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiQnJvYWRjYXN0IGRhdGEgZWRpdGVkIHN1Y2Nlc3NmdWxseSIpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgICAgICAgICAgdGhpcy5nZXRfZGF0YSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PQogICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlNVRkZJQ0lFTlRfV0hBVFNBUFBfQlJPQURDQVNUX0lORk9STUFUSU9OLk1TR19DT0RFCiAgICAgICAgICApIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiTWluaW11bSB0d28gY29udGFjdHMgcmVxdWlyZWQgZm9yIGEgYnJvYWRjYXN0IiksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaXNFZGl0QnJvYWRjYXN0ID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkX2N1c3RvbWVyX2xpc3QodHlwZSkgewogICAgICBpZih0eXBlICE9PSAnc2Nyb2xsJyl7CiAgICAgICAgdGhpcy5jb250YWN0c19saXN0X3BhZ2luYXRpb24gPSAxOwogICAgICB9CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGdldF9jb250YWN0c19saXN0OiB0cnVlLAogICAgICAgICAgICBwZXJfcGFnZTogNSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5jb250YWN0c19saXN0X3BhZ2luYXRpb24sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmKHR5cGUgIT09ICdzY3JvbGwnKXsKICAgICAgICAgICAgdGhpcy5jb250YWN0c19saXN0ID0gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0c19saXN0KSB7CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0c19saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzX2xpc3RbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9wYWdpbmF0aW9uX2NvdW50ID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9fQ09OVEFDVFNfREFUQV9BVkFJTEFCTEUuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJzb21lX2Vycm9yX21zZyIpLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHNlYXJjaF9jdXN0b21lcl9saXN0KHF1ZXJ5LCB0eXBlKSB7CiAgICAgIGlmIChxdWVyeSAhPSAiIikgewogICAgICAgIGlmKHR5cGUgIT09ICdzY3JvbGwnKXsKICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdF9zZWFyY2hfcGFnaW5hdGlvbiA9IDE7CiAgICAgICAgfQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZ2V0X2NvbnRhY3RzX2xpc3Q6IHRydWUsCiAgICAgICAgICAgICAgc2VhcmNoX2tleTogcXVlcnksCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IDUsCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmKHR5cGUgIT09ICdzY3JvbGwnKXsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PQogICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzX2xpc3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdHNfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0c19saXN0W2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0c19saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50ID0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19DT05UQUNUU19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RzX2xpc3QgPSBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkX2N1c3RvbWVyX2xpc3QoKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfYnJvYWRjYXN0KCkgewogICAgICB2YXIgbGlzdCA9IFtdOwogICAgICBpZiAodGhpcy5zZWxlY3RfdGVtcGxhdGVfbGlzdC5sZW5ndGggIT0gMCkgewogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5zZWxlY3RfdGVtcGxhdGVfbGlzdCkgewogICAgICAgICAgbGlzdC5wdXNoKHRoaXMuc2VsZWN0X3RlbXBsYXRlX2xpc3RbaV0udGVtcGxhdGVfaWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgiUGxlYXNlIHNlbGVjdCBhdGxlYXN0IG9uZSB0ZW1wbGF0ZSIpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgICAgcHVibGlzaF90ZW1wbGF0ZTogdHJ1ZSwKICAgICAgICAgICAgICBzZW5kX3RvOiAnYnJvYWRjYXN0JywKICAgICAgICAgICAgICBicm9hZGNhc3RfaWRzOiBbdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5pZF0sCiAgICAgICAgICAgICAgdGVtcGxhdGVfaWQ6IGxpc3QsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0NPTlRBQ1RfTElTVC5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfTUVESUFfU0VORF9GQUlMVVJFLk1TR19DT0RFID09PQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCJ0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCIpLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoInRpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZyIpLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2ciKSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCJlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2ciKSwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXR0aW5ncyIsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7IFN1YnNjcmlwdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuU0VORElOR19URU1QTEFURS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoInNlbmRfdGVtcGxhdGVfc2VudF9tc2ciKSwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICAkKCIjc2VuZHRlbXBsYXRlIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIHRoaXMuY2xvc2VfbW9kYWwoInNlbmRfYnJvYWRjYXN0Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIHZhbGlkYXRlX2Jyb2FkY2FzdF9uYW1lKCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgaXNfdW5pcXVlOiB0cnVlLAogICAgICAgICAgICBicm9hZGNhc3RfbmFtZTogdGhpcy5uYW1lLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX1NVQ0NFU1MuTVNHX0NPREUgPT09CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5uYW1lICE9ICIiKSB7CiAgICAgICAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAvLyAiMXB4IHNvbGlkIGdyZWVuIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BTFJFQURZX0VYSVNULk1TR19DT0RFID09PQogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmJyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAgICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfYnJvYWRjYXN0X25hbWUoKSB7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfYnJvYWRjYXN0cygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICBpc191bmlxdWU6IHRydWUsCiAgICAgICAgICAgIGJyb2FkY2FzdF9uYW1lOiB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0Lm5hbWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5TVEFUVVNfU1VDQ0VTUy5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy5lZGl0X2Jyb2FkY2FzdF9uYW1lX2FscmVhZHlfZXhpc3QgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9icm9hZGNhc3QubmFtZSAhPSAiIikgewogICAgICAgICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0X3RlbXBsYXRlX25hbWVfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAgIC8vICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQUxSRUFEWV9FWElTVC5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICApIHsKICAgICAgICAgICAgaWYgKHRoaXMub2xkX2Jyb2FkY2FzdF9uYW1lID09IHRoaXMuY3VycmVudF9icm9hZGNhc3QubmFtZSkgewogICAgICAgICAgICAgIHRoaXMuZWRpdF9icm9hZGNhc3RfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZWRpdF9icm9hZGNhc3RfbmFtZV9hbHJlYWR5X2V4aXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAgICIxcHggc29saWQgcmVkIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgc2VsZWN0ZWRfYnJvYWRjYXN0KHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5icm9hZGNhc3RfbGlzdCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMuYnJvYWRjYXN0X2xpc3RbaV0uaWQpOwogICAgICAgICAgfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjIiArIFtpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwogICAgICAgICAgaWYgKHNlbGVjdGFsbC5jaGVja2VkKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcigoaWQpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGlkICE9IHZhbHVlOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX2Jyb2FkY2FzdCgpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA8IDEpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJTZWxlY3QgYXRsZWFzdCBvbmUgdGVtcGxhdGUgdG8gZGVsZXRlLiIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9icm9hZGNhc3RzKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgaXNfZGVsZXRlOiB0cnVlLAogICAgICAgICAgICBicm9hZGNhc3RfaWRzOiB0aGlzLmNoZWNrZWRfbGlzdCwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgdGhpcy5nZXRfZGF0YSgpOwogICAgICAgICAgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09CiAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiQnJvYWRjYXN0IERlbGV0ZWQgU3VjY2Vzc2Z1bGx5IiksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09CiAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9PUEVSQVRJT04uTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgicXVlcnlfZXhlY3V0ZWRfbXNnIiksCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGdldF90ZW1wbGF0ZV9kYXRhKHR5cGUpewogICAgICBpZih0eXBlICE9PSdzY3JvbGwnKXsKICAgICAgICB0aGlzLnRlbXBsYXRlX2xpc3RfcGFnaW5hdGlvbiA9IDE7CiAgICAgIH0KICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgcGFnZV9ubzogNSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZih0eXBlICE9PSAnc2Nyb2xsJyl7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXMpIHsKICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS50ZW1wbGF0ZXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVfbGlzdF9wYWdpbmF0aW9uX2NvdW50ID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0KICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9fV0hBVFNBUFBfVEVNUExBVEUuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGdldF9kYXRhKCkgewogICAgICB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0ID0ge307CiAgICAgIC8vIEdldCBTYXZlZCBUZW1wbGF0ZXMKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PQogICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgdGhpcy5icm9hZGNhc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5icm9hZGNhc3RzOwogICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgaWYgKHRoaXMuYnJvYWRjYXN0X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHRoaXMuc2hvd19icm9hZGNhc3QoMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CgogICAgICAgICAgICB0aGlzLmlzRWRpdEJyb2FkY2FzdCA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PQogICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBzZWFyY2hfdGVtcGxhdGUocXVlcnksIHR5cGUpewogICAgICBpZihxdWVyeSAhPSAiIil7CiAgICAgICAgaWYodHlwZSAhPT0gJ3Njcm9sbCcpewogICAgICAgICAgdGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uID0gMTsKICAgICAgICB9CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnRlbXBsYXRlX2xpc3Rfc2VhcmNoX3BhZ2luYXRpb24sCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgICBzZWFyY2hfa2V5OiBxdWVyeSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZih0eXBlICE9PSAnc2Nyb2xsJyl7CiAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZWxpc3QgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLnRlbXBsYXRlcykgewogICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZWxpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEudGVtcGxhdGVzW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZV9saXN0X3NlYXJjaF9wYWdpbmF0aW9uX2NvdW50ID0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuZ2V0X3RlbXBsYXRlX2RhdGEoKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2Jyb2FkY2FzdHMoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09CiAgICAgICAgICAgICAgICB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5icm9hZGNhc3RfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5icm9hZGNhc3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5icm9hZGNhc3RzOwogICAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuYnJvYWRjYXN0X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dfYnJvYWRjYXN0KDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CgogICAgICAgICAgICAgICAgdGhpcy5pc0VkaXRCcm9hZGNhc3QgPSBmYWxzZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PQogICAgICAgICAgICAgICAgdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9fV0hBVFNBUFBfVEVNUExBVEUuTVNHX0NPREUKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgc2VhcmNoX2tleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuYnJvYWRjYXN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgICB0aGlzLmlzRWRpdEJyb2FkY2FzdCA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJyb2FkY2FzdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmJyb2FkY2FzdHM7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5icm9hZGNhc3RfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd19icm9hZGNhc3QoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24oMSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYXBpX3N0YXR1c19jb2RlLk5PX1dIQVRTQVBQX1RFTVBMQVRFLk1TR19DT0RFID09PQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJyb2FkY2FzdF9saXN0ID0gW107CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgc2hvd19icm9hZGNhc3QoaW5kZXgpIHsKICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdCA9IEpTT04ucGFyc2UoCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5icm9hZGNhc3RfbGlzdFtpbmRleF0pCiAgICAgICk7CiAgICAgIHRoaXMub2xkX2Jyb2FkY2FzdF9uYW1lID0gdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5uYW1lOwogICAgICB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0X2hpZ2hsaWdodF9uYW1lID0gdGhpcy5jdXJyZW50X2Jyb2FkY2FzdC5uYW1lOwogICAgICB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0X2luZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuaXNFZGl0QnJvYWRjYXN0ID0gZmFsc2U7CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKSB7CiAgICAgICAgdGhpcy5zZWxlY3RfY3VzdG9tZXJfbGlzdCA9IFtdOwogICAgICAgIHRoaXMubmFtZSA9ICIiOwogICAgICAgIHRoaXMub2xkX2Jyb2FkY2FzdF9uYW1lID0gIiI7CiAgICAgICAgdGhpcy5jdXJyZW50X2Jyb2FkY2FzdCA9IHt9OwogICAgICAgIHRoaXMuY3VycmVudF9icm9hZGNhc3RfaGlnaGxpZ2h0X25hbWUgPSAiIgogICAgICAgIHRoaXMuYnJvYWRjYXN0X25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZW1wbGF0ZV9uYW1lX2FkZF9pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2N1cnJlbnRfdGVtcGxhdGVfYWN0aXZlKGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUudGFibGUoaW5kZXgsIHRoaXMuYnJvYWRjYXN0X2xpc3RbaW5kZXhdLCB0aGlzLmN1cnJlbnRfYnJvYWRjYXN0KTsKICAgICAgaWYgKEJvb2xlYW4odGhpcy5icm9hZGNhc3RfbGlzdFtpbmRleF0pID09PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYnJvYWRjYXN0X2xpc3RbaW5kZXhdLm5hbWUgPT09IHRoaXMuY3VycmVudF9icm9hZGNhc3RfaGlnaGxpZ2h0X25hbWUKICAgICAgICAgID8gImN1cnJlbnQtYWN0aXZlLXRlbXBsYXRlIgogICAgICAgICAgOiBudWxsOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},null]}