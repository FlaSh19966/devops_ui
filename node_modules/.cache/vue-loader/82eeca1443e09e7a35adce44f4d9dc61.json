{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/analytics/components/NewDonut.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/analytics/components/NewDonut.vue","mtime":1643027096188},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLyogLmxhYmVsLXRleHQgewogICAgZm9udC1zaXplOiAxMnB4OwogICAgZmlsbDogIzM5MzkzOTsKfQoubGFiZWwtbGluZSB7CiAgICBzdHJva2Utd2lkdGg6IDE7CiAgICBzdHJva2U6ICMzOTM5Mzk7Cn0KLmxhYmVsIGNpcmNsZSB7CiAgICBkaXNwbGF5OiBub25lOwp9ICovCg=="},{"version":3,"sources":["NewDonut.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"NewDonut.vue","sourceRoot":"src/portal/analytics/components","sourcesContent":["<template>\n  <div id=\"chart\">\n  <!-- <svg width=\"700\" height=\"3000\" id=\"svg\" /> -->\n\n<svg id=\"newpie\">\n    <g id=\"canvas\">\n        <g id=\"art\" />\n        <g id=\"labels\" /></g>\n</svg>\n  </div>\n</template>\n\n<script>\nconst d3 = require(\"d3-3\");\nexport default {\n    name: \"NewDonut\",\n    props: {\n    data: Array,\n    xKey: String,\n    yKey: String,\n    currency_key: String,\n  },\n  mounted () {\n    var vm = this;\n    this.data.sort(function(a, b) {\n        return b[vm.yKey] - a[vm.yKey];\n    });\n    var sum_yval = 0\n    for( let i = 0; i < this.data.length; i++) {\n        sum_yval = sum_yval +  this.data[i][this.yKey]\n    }\n    for(let i = 0; i < this.data.length; i++){\n        this.data[i].Share = ((this.data[i][this.yKey] / sum_yval) * 100).toFixed(2)+'%';\n        // this.data[i]\n    }\n\n    // this.data = data;\n    // this.xKey = \"label\";\n    // this.yKey = \"instances\";\n    // con\n    var svg = d3.select(\"#newpie\");\n    var canvas = d3.select(\"#canvas\");\n    var art = d3.select(\"#art\");\n    var labels = d3.select(\"#labels\");\n\n    // Create the pie layout function.\n    // This function will add convenience\n    // data to our existing data, like \n    // the start angle and end angle\n    // for each data element.\n    var jhw_pie = d3.layout.pie()\n    jhw_pie.value(function (d, i) {\n        // Tells the layout function what\n        // property of our data object to\n        // use as the value.\n        return d[vm.yKey];\n    });\n\n    // Store our chart dimensions\n    var cDim = {\n            height: 500,\n            width: 900,\n            innerRadius: 140,\n            outerRadius: 190,\n            labelRadius: 195\n        }\n\n    // Set the size of our SVG element\n    svg.attr({\n        height: cDim.height,\n        width: cDim.width\n    });\n\n    // This translate property moves the origin of the group's coordinate\n    // space to the center of the SVG element, saving us translating every\n    // coordinate individually. \n    canvas.attr(\"transform\", \"translate(\" + (cDim.width / 2.18) + \",\" + (cDim.width / 3.4) + \")\");\n\n    var pied_data = jhw_pie(this.data);\n\n    // The pied_arc function we make here will calculate the path\n    // information for each wedge based on the data set. This is \n    // used in the \"d\" attribute.\n    var    pied_arc = d3.svg.arc()\n            .innerRadius(140)\n            .outerRadius(190)\n            .cornerRadius(6.5)\n            .padAngle(0.01);\n\n    // This is an ordinal scale that returns 10 predefined colors.\n    // It is part of d3 core.\n    // var pied_colors = d3.scale.category20();\n    // var pied_colors =   d3.scale.ordinal()\n\t// .range([\"#EA3379\", \"#00C7E6\", \"#3FBC11\", \"#FBB317\", \"#5d62b5\", \"#29c3be\", \"#f1726e\", \"#62b58f\", \"#d0743c\",\"#ca0020\",\"#f4a582\",\"#92c5de\",\"#0571b0\", \"#d3fe14\", \"#fec7f8\", \"#0b7b3e\", \"#0bf0e9\",'#E666B3', '#33991A', '#CC9999', '#B3B31A', '#00E680',\n    //         '#FF9AA2', '#FFB7B2', '#FFDAC1', '#B5EAD7', '#63d2a8', \"#225a4b\", \"#e5df73\", '#6666FF','#ff0000\t','#a2798f','#d7c6cf','#e88758','#b13a15','#6d3656','#fffa90','#a4ffaa','#a6cbff','#8500f9','#b077ba','\t#765284','#984b67','#9c624e','#feb8ff','#9be3bd','#775934','#008385','#6a2ca1','#e60e68','#ff6d01','#fee9d3'\n    //         ]);\n    var pied_colors =   d3.scale.ordinal()\n\t.range([\"#FBB317\",\"#FF9750\",\"#3FBC11\",\"#00C7E6\",\"#EA3379\",\"#0165fc\",\"#41fdfe\",\"#24a0ed\",\"#1ac1dd\",\"#7df9ff\",\"#3f00ff\",\"#08ff08\",\"#aeff6e\",\"#56fca2\",\"#45cea2\",\"#06c2ac\",\"#fe6700\",\"#ff3503\",\"#d90166\",\"#be03fd\",\"#ad0afd\",\"#6600ff\",\"#d01c1f\",\"#f1172f\",\"#fff600\",\"#fcd116\",\"#cfff04\",\"#ffc324\",\"#f4c430\",\"#FE7D68\",\"#710193\",\n            \"#0492C2\",\"#9897A9\",\"#632A0D\",\"#9A794E\",\"#151E3D\",\"#59788D\",\"#1E456E\",\"#016064\",\"#48AAAD\",\"#7E7D9C\",\"#303150\",\"#609D9E\",\"#287E9E\",\"#E4A834\",\"#028910\",\n            \"#373737\",\"#6C626D\",\"#584D5B\",\"#4D4C5C\"]);\n    // Let's start drawing the arcs.\n    var enteringArcs = art.selectAll(\".wedge\").data(pied_data).enter();\n\n    enteringArcs.append(\"path\")\n        .attr(\"class\", \"wedge\")\n        .attr(\"id\", function(d, i) {\n            return  i;\n        })\n        // .attr(\"d\", pied_arc)\n        .attr(\"fill\", function (d, i) { \n        return pied_colors(i);\n        })\n        .transition()\n            .delay(function(d,i) {\n            return i *150; })\n            .duration(3800)\n        \t.attrTween('d', function(d) {\n\t\t    var i = d3.interpolate(d.startAngle+0.1, d.endAngle);\n            return function(t) {\n                d.endAngle = i(t); \n                return pied_arc(d)\n                }\n            })\n            .attr(\"d\", pied_arc)\n        // .transition()\n        //     .duration(function(d, i) {\n        //         return i * 100;\n        //     }).duration(1200)\n        //     .attrTween('d', function(d) {\n        //     var i = d3.interpolate(d.startAngle+0.1, d.endAngle);\n        //     return function(t) {\n        //         d.endAngle = i(t);\n        //     return pied_arc.arc(d);\n        //     }\n        // });\n\n    setTimeout(() => {\n    // Now we'll draw our label lines, etc.\n    var enteringLabels = labels.selectAll(\".label\").data(pied_data).enter();\n    var labelGroups = enteringLabels.append(\"g\").attr(\"class\", \"label\");\n    labelGroups.append(\"circle\").attr({\n        x: 0,\n        y: 0,\n        r: 2,\n        fill: \"#000\",\n        transform: function (d, i) {\n        var centroid = pied_arc.centroid(d);\n            return \"translate(\" + pied_arc.centroid(d) + \")\";\n        },\n            'class': \"label-circle\"\n    });\n\n    // \"When am I ever going to use this?\" I said in \n    // 10th grade trig.\n    var textLines = labelGroups.append(\"line\").attr({\n        x1: function (d, i) {\n            // return pied_arc.centroid(d)[0];\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var x = Math.cos(midAngle) * cDim.outerRadius;\n            return x;\n        },\n        y1: function (d, i) {\n            // return pied_arc.centroid(d)[1];\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var y = Math.sin(midAngle) * cDim.outerRadius;\n            return y;\n        },\n        x2: function (d, i) {\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var x = Math.cos(midAngle) * (cDim.labelRadius);\n            return x;\n        },\n        y2: function (d, i) {\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n        var y = Math.sin(midAngle) * cDim.labelRadius;\n            return y;\n        },\n            'class': \"label-line\"\n    });\n\n    var textLabels = labelGroups.append(\"text\").attr({\n        x: function (d, i) {\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var x = Math.cos(midAngle) * cDim.labelRadius;\n            var sign = (x > 0) ? 1 : -1\n            var labelX = x + (5 * sign)\n            return labelX;\n        },\n        y: function (d, i) {\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var y = Math.sin(midAngle) * cDim.labelRadius;\n            return y;\n        },\n            'text-anchor': function (d, i) {\n            var centroid = pied_arc.centroid(d);\n            var midAngle = Math.atan2(centroid[1], centroid[0]);\n            var x = Math.cos(midAngle) * cDim.labelRadius;\n            return (x > 0) ? \"start\" : \"end\";\n        },\n            'class': 'label-text'\n    }).text(function (d) {\n        if(d.data[vm.xKey].length > 15){\n            return d.data[vm.xKey].substring(0,15) + '...'\n        } else {\n            return d.data[vm.xKey]\n        }\n\n    });\n\n    var alpha = 0.5;\n    var spacing = 12;\n\n    function relax() {\n        var again = false;\n        textLabels.each(function (d, i) {\n        var  a = this;\n        var   da = d3.select(a);\n        var  y1 = da.attr(\"y\");\n            textLabels.each(function (d, j) {\n            var  b = this;\n                // a & b are the same element and don't collide.\n                if (a == b) return;\n            var db = d3.select(b);\n                // a & b are on opposite sides of the chart and\n                // don't collide\n                if (da.attr(\"text-anchor\") != db.attr(\"text-anchor\")) return;\n                // Now let's calculate the distance between\n                // these elements. \n            var  y2 = db.attr(\"y\");\n            var   deltaY = y1 - y2;\n                \n                // Our spacing is greater than our specified spacing,\n                // so they don't collide.\n                if (Math.abs(deltaY) > spacing) return;\n                \n                // If the labels collide, we'll push each \n                // of the two labels up and down a little bit.\n                again = true;\n            var  sign = deltaY > 0 ? 1 : -1;\n            var  adjust = sign * alpha;\n                da.attr(\"y\",+y1 + adjust);\n                db.attr(\"y\",+y2 - adjust);\n            });\n        });\n        // Adjust our line leaders here\n        // so that they follow the labels. \n        if(again) {\n        var labelElements = textLabels[0];\n            textLines.attr(\"y2\",function(d,i) {\n            var  labelForLine = d3.select(labelElements[i]);\n                return labelForLine.attr(\"y\");\n            });\n            setTimeout(relax,20)\n        }\n\n        var tooltip = \n            d3.select(\"#chart\").append(\"div\").attr(\"class\", \"toolTip\")\n        d3.selectAll(\".wedge\").on(\"mouseover\", function(d,i) {\n            var x = d3.select(this).attr('id');\n            // console.log(d);\n            // console.log(x,vm.data[x]);\n             d3.select(this).style(\"fill\", d3.rgb(pied_colors(i)).brighter(.61));\n            tooltip\n                .style(\"left\", d3.event.pageX - 40 + \"px\")\n                .style(\"top\", d3.event.pageY - 70 + \"px\")\n                .style(\"display\", \"inline-block\")\n                .html((vm.data[x][vm.xKey]) + \"<br>\"  + vm.currency_key + ' ' + ((Number.isInteger(vm.data[x][vm.yKey])) ? (vm.data[x][vm.yKey]) : (vm.data[x][vm.yKey]).toFixed(2)));\n        });\n\n        d3.selectAll(\".wedge\").on(\"mouseout\", function(d,i) {\n            d3.select(this).style(\"fill\", pied_colors(i));\n            tooltip.style(\"display\", \"none\"); // hide tooltip for that element\n        });\n\n        d3.selectAll(\".wedge\").on(\"mousemove\", function(d) {\n            tooltip\n            .style(\"top\", d3.event.layerY + 10 + \"px\") \n            .style(\"left\", d3.event.layerX + 10 + \"px\"); \n        });\n\n    } \n\n    relax();\n\n    d3.selectAll('.label text, .art path').call(toolTip);\n    function toolTip(selection) {\n\n                // add tooltip (svg circle element) when mouse enters label or slice\n                selection.on('mouseenter', function (data,i) {\n                    // console.log(i,data);\n                    art.append('text')\n                        .attr('class', 'toolCircle')\n                        .attr('dy', -15) // hard-coded. can adjust this to adjust text vertical alignment in tooltip\n                        .html(toolTipHTML(data)) // add text to the circle.\n                        .style('font-size', '.9em')\n                        .style('text-anchor', 'middle'); // centres text in tooltip\n\n                    art.append('circle')\n                        .attr('class', 'toolCircle')\n                        .attr('r', 320 * 0.40) // radius of tooltip circle\n                        .style('fill', pied_colors(i)) // colour based on category mouse is over\n                        .style('fill-opacity', 0.45);\n\n                });\n\n                // remove the tooltip when mouse leaves the slice/label\n                selection.on('mouseout', function () {\n                    d3.selectAll('.toolCircle').remove();\n                });\n        }\n        \n         function toolTipHTML(data) {\n                // console.log(data);\n                var tip = '',\n                    i   = 0;\n\n                for (var key in data.data) {\n                    // if value is a number, format it as a percentage\n                    var value =  data.data[key];\n                    // leave off 'dy' attr for first tspan so the 'dy' attr on text element works. The 'dy' attr on\n                    // tspan effectively imitates a line break.\n                    if((key === vm.xKey) || (key === vm.yKey) || (key === \"Share\")){\n                        // if (key === vm.yKey){\n                            if (i === 0) tip += '<tspan x=\"0\">' + key + ': ' + ((key === vm.yKey)? vm.currency_key+ ' ' + value : value) + '</tspan>';\n                            else tip += '<tspan x=\"0\" dy=\"1.2em\">' + key + ': ' + value + '</tspan>';\n                            i++;\n                        // } else if(key === vm.xKey){\n                        //     if (i === 0) tip += '<tspan x=\"0\">' + key + ': ' + value + '('+  ')' + '</tspan>';\n                        //     else tip += '<tspan x=\"0\" dy=\"1.2em\">' + key + ': ' + value + '</tspan>';\n                        //     i++;\n                        // } \n\n\n                    }\n                }\n\n                return tip;\n            }\n        }, 1400);\n\n\n    }\n}\n</script>\n<style>\n/* .label-text {\n    font-size: 12px;\n    fill: #393939;\n}\n.label-line {\n    stroke-width: 1;\n    stroke: #393939;\n}\n.label circle {\n    display: none;\n} */\n</style>"]}]}