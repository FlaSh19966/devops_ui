{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Apps/Scheduler.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Apps/Scheduler.vue","mtime":1643027096156},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7DQppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOw0KaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOw0KaW1wb3J0IHN3YWwgZnJvbSAic3dlZXRhbGVydDIiOw0KLy8gaW1wb3J0IFRpbWVQaWNrZXIgZnJvbSAiYW50LWRlc2lnbi12dWUvbGliL3RpbWUtcGlja2VyIjsNCmltcG9ydCBDYWxlbmRhciBmcm9tICIuLi8uLi8uLi8uLi8uLi9wdWJsaWMvanMvdHVpLWNhbGVuZGFyLm1pbi5qcyI7DQppbXBvcnQgRGF0ZVBpY2tlciBmcm9tICJ0dWktZGF0ZS1waWNrZXIiOw0KaW1wb3J0ICJ0dWktZGF0ZS1waWNrZXIvZGlzdC90dWktZGF0ZS1waWNrZXIuY3NzIjsNCmltcG9ydCAiLi4vLi4vLi4vLi4vLi4vcHVibGljL2Nzcy9zZWdvZS11aS5jc3MiDQppbXBvcnQgIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9jc3MvdHVpLWNhbGVuZGFyLm1pbi5jc3MiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiU2NoZWR1bGVyIiwNCiAgZGF0YSAoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGNhbGVuZGFySW5zdGFuY2U6IG51bGwsDQogICAgICBjdXJyZW50X2NhbGVuZGFyX3ZpZXc6ICdkYXknLA0KICAgICAgc2hvd19zcGlubmVyOiBmYWxzZSwNCiAgICAgIHNlbGVjdGVkX3RpbWU6ICIiLA0KICAgICAgZGlzcGxheV9zZWxlY3RlZF90aW1lOiAiIiwNCiAgICAgIHNjaGVkdWxlZF90aW1lOiAiIiwNCiAgICAgIHNlbGVjdGVkX2RhdGU6ICIiLA0KICAgICAgcGF0aWVudF9uYW1lOiAiIiwNCiAgICAgIHZpc2l0b3JfbnVtYmVyOiAiIiwNCiAgICAgIHZpc2l0X3JlYXNvbjogIiIsDQogICAgICB2aXNpdG9yX3N5bXB0b21zOiAiIiwNCiAgICAgIHNjaGVkdWxlX2xpc3Q6IFtdLA0KICAgICAgc2VsZWN0ZWRfc2NoZWR1bGVfaWQ6ICIiLA0KICAgICAgc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdDogIiIsDQogICAgICBpc0VkaXQ6IGZhbHNlLA0KICAgICAgc3Bpbm5lck9uOiBmYWxzZSwNCiAgICAgIHBob25lX251bWJlcl92YWxpZGl0eTogL1wrWzAtOV17OSwxNH0kLywNCiAgICAgIGZ1bGxfdGltZV9zbG90czogW10sDQogICAgICB0aW1lX3Nsb3RzOiBbXSwNCiAgICAgIHNlbGVjdGVkX3RpbWVfc2xvdDogIiIsDQogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLA0KICAgICAgc2NoZWR1bGluZ19jb250YWN0X251bWJlcjogIiIsDQogICAgICBmaWxlX2xhYmVsOiAiQ2hvb3NlIEZpbGUiLA0KICAgICAgd2Vla19kYXlzOiBbDQogICAgICAgICJNb25kYXkiLA0KICAgICAgICAiVHVlc2RheSIsDQogICAgICAgICJXZWRuZXNkYXkiLA0KICAgICAgICAiVGh1cnNkYXkiLA0KICAgICAgICAiRnJpZGF5IiwNCiAgICAgICAgIlNhdHVyZGF5IiwNCiAgICAgICAgIlN1bmRheSINCiAgICAgIF0sDQogICAgICBkYXlzSW5Nb250aDogW10sDQogICAgICBhY3RpdmVNb250aFllYXI6ICcnLA0KICAgICAgY3N2X2ZpbGU6ICIiLA0KICAgICAgc2NoX3ZvaWNlX2dyZWV0aW5nczogIiIsDQogICAgICBzY2hfc21zX2dyZWV0aW5nczogIiIsDQogICAgICBzaG93X2NoZWNrX2FuZF9jaGFuZ2Vfc3RhdHVzOiB0cnVlLA0KICAgICAgdXNlcl90eXBlOiBudWxsLA0KICAgICAgdmlzaXRfc3RhdHVzX2RhdGE6IG51bGwsDQogICAgICB2aXNpdF9zdGF0dXNfY29tcGFyaXNvbl9kYXRhOiBbXSwNCiAgICAgIGRhaWx5X2RhdGU6ICIiLA0KICAgICAgaXNSZXNjaGVkdWxlOiB0cnVlLA0KICAgICAgZGF0ZXBpY2tlckluc3RhbmNlOiBudWxsLA0KICAgICAgbmV3X3NlbGVjdGVkX2RhdGU6ICIiLA0KICAgICAgY2FsbF9yZW1pbmRlcl9ocnM6IE51bWJlciwNCiAgICAgIGNhbGxfcmVtaW5kZXJfbWluczogTnVtYmVyLA0KICAgICAgZWRpdF9zY2hlZHVsaW5nOiBmYWxzZSwNCiAgICAgIHRlbXBfZGF0YTogIiIsDQogICAgICBpc0FwcG9pbnRtZW50Q29uZmlybWVkOiBmYWxzZSwNCiAgICAgIGFwcG9pbnRtZW50U3RhdHVzOiAiIiwNCiAgICAgIHZpc2l0U3RhdHVzOiAiIiwNCiAgICAgIEFwcG9pbnRtZW50SUQ6ICcnLA0KICAgICAgaXNSZXNjaGVkdWxldGltZTogZmFsc2UsDQogICAgICB0ZW1wX25hbWU6ICIiLA0KICAgICAgdGVtcF9yZWFzb246ICIiLA0KICAgICAgdGVtcF9zeW1wdG9tczogIiIsDQogICAgICB0ZW1wX2FwcG9pbnRtZW50X2RhdGU6ICIiLA0KICAgICAgdGVtcF9hcHBvaW50bWVudF90aW1lOiAiIiwNCiAgICAgIHRlbXBfdGltZV9zbG90czogW10sDQogICAgICBjb21wYW55aWQ6ICIiLA0KICAgICAgY29tcGFueW5hbWU6ICIiLA0KICAgICAgc3VwcG9ydF9udW1iZXJzX2xpc3Q6IFtdLA0KICAgICAgZmlsbGVkX3RpbWVfc2xvdHNfc2VsZWN0ZWRfZGF0ZTpbXQ0KICAgIH07DQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICAvLyBUaW1lUGlja2VyDQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgdmFsaWRQaG9uZU51bWJlciAoKSB7DQogICAgICBpZiAodGhpcy5waG9uZV9udW1iZXJfdmFsaWRpdHkudGVzdCh0aGlzLnNjaGVkdWxpbmdfY29udGFjdF9udW1iZXIucmVwbGFjZSgvXHMrL2csICcnKSkpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gIlBsZWFzZSBlbnRlciBhIHZhbGlkIHBob25lIG51bWJlciBpbiB0aGUgZm9ybWF0OiArQ291bnRyeUNvZGUgTnVtYmVyIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGNyZWF0ZU1vZGFsVGl0bGUgKCkgew0KICAgICAgcmV0dXJuIHRoaXMucGF0aWVudF9uYW1lLnNwbGl0KCcgJykuc2xpY2UoMCwgMSkubWFwKHdvcmQgPT4gd29yZC5jaGFyQXQoMCkpLmpvaW4oJycpLnRvVXBwZXJDYXNlKCkNCiAgICB9LA0KICAgIHRpbWVTbG90c0xpc3QgKCkgew0KICAgICAgbGV0IGxpc3QgPSBbXTsNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDIzOyBpICs9IDEpIHsNCiAgICAgICAgbGlzdC5wdXNoKHsNCiAgICAgICAgICBkaXNwbGF5OiBtb21lbnQoaSwgWydoJ10pLmZvcm1hdCgnaDptbSBBJyksDQogICAgICAgICAgdmFsdWU6IG1vbWVudChpLCBbJ2gnXSkuZm9ybWF0KCdIOm1tJykNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIHJldHVybiBsaXN0Ow0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBjdXJyZW50X2NhbGVuZGFyX3ZpZXcgKG5ld1ZhbCkgew0KICAgICAgdGhpcy50b2dnbGVfdmlldyhuZXdWYWwpDQogICAgfQ0KICB9LA0KICBjcmVhdGVkICgpIHsNCiAgICBpZiAoDQogICAgICAhdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpICYmDQogICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiINCiAgICApIHsNCiAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2Ugc2VsZWN0IGEgY29tcGFueSBuYW1lIGZyb20gdGhlIGRyb3Bkb3duIik7DQogICAgICBheGlvcw0KICAgICAgICAucG9zdChhcGlfY2FsbHMubG9hZF9zdXBwb3J0X3VybCgpLCB7DQogICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICBzaG93X3N1cGVyYWRtaW46ICJUcnVlIiwNCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgaXNTaG93OiAiVHJ1ZSINCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgIHRoaXMuc3VwcG9ydF9udW1iZXJzX2xpc3QgPSByZXNwb25zZS5kYXRhWzBdLm1hcChudW1iZXIgPT4gbnVtYmVyWyJDb250YWN0TnVtYmVyIl0pOw0KICAgICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgew0KICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7DQogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7DQogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsNCiAgICB9DQogICAgaWYgKA0KICAgICAgdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpIHx8DQogICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSAhPSAiU3VwZXJBZG1pbiINCiAgICApIHsNCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KGFwaV9jYWxscy5sb2FkX3N1cHBvcnRfdXJsKCksIHsNCiAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICBpc1Nob3c6ICJUcnVlIg0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgdGhpcy5zdXBwb3J0X251bWJlcnNfbGlzdCA9IHJlc3BvbnNlLmRhdGFbMF0ubWFwKG51bWJlciA9PiBudW1iZXJbIkNvbnRhY3ROdW1iZXIiXSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCAoKSB7DQogICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgIHZhciB2bSA9IHRoaXM7DQogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlID0gbmV3IENhbGVuZGFyKCIjY2FsZW5kYXIiLCB7DQogICAgICBkZWZhdWx0VmlldzogImRheSIsDQogICAgICB0YXNrVmlldzogZmFsc2UsDQogICAgICBzY2hlZHVsZVZpZXc6IFsidGltZSJdLA0KICAgICAgdGhlbWU6IHsNCiAgICAgICAgJ21vbnRoLmRheW5hbWUudGV4dEFsaWduJzogJ2NlbnRlcicsDQogICAgICAgICdtb250aC5kYXluYW1lLnRleHRUcmFuc2Zvcm0nOiAndXBwZXJjYXNlJywNCiAgICAgICAgJ3dlZWsuZGF5bmFtZS5ib3JkZXJMZWZ0JzogJzFweCBzb2xpZCAjREZERkRGJywNCiAgICAgICAgJ21vbnRoLnNjaGVkdWxlLmJvcmRlclJhZGl1cyc6ICcycHgnLA0KICAgICAgICAnbW9udGguc2NoZWR1bGUubWFyZ2luVG9wJzogJzJweCcsDQogICAgICAgICdtb250aC5zY2hlZHVsZS5tYXJnaW5MZWZ0JzogJzhweCcsDQogICAgICAgICdtb250aC5zY2hlZHVsZS5tYXJnaW5SaWdodCc6ICc4cHgnLA0KICAgICAgICAnd2Vlay5kYXlncmlkLmJhY2tncm91bmRDb2xvcic6ICdub25lJywNCiAgICAgICAgJ3dlZWsuZGF5bmFtZS50ZXh0QWxpZ24nOiAnY2VudGVyJywNCiAgICAgICAgJ3dlZWsuZGF5bmFtZS50ZXh0VHJhbnNmb3JtJzogJ3VwcGVyY2FzZScsDQogICAgICAgICd3ZWVrLnRpbWVncmlkSG9yaXpvbnRhbExpbmUuYm9yZGVyQm90dG9tJzogJzFweCBkYXNoZWQgI0YxRjFGMScsDQogICAgICAgICd3ZWVrLnRpbWVncmlkLmJvcmRlclJpZ2h0JzogJzFweCBzb2xpZCAjREZERkRGJywNCiAgICAgIH0sDQogICAgICB0ZW1wbGF0ZTogew0KICAgICAgICBtb250aEdyaWRIZWFkZXI6IGZ1bmN0aW9uIChkYXlNb2RlbCkgew0KICAgICAgICAgIHZhciBkYXRlID0gbW9tZW50KGRheU1vZGVsLmRhdGUsIFsnWVlZWS1NTS1ERCddKS5mb3JtYXQoJ0REJyk7DQogICAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBbJ3R1aS1mdWxsLWNhbGVuZGFyLXdlZWtkYXktZ3JpZC1kYXRlICddOw0KDQogICAgICAgICAgaWYgKGRheU1vZGVsLmlzVG9kYXkpIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZXMucHVzaCgndHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1ncmlkLWRhdGUtZGVjb3JhdG9yJyk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iJyArIGNsYXNzTmFtZXMuam9pbignICcpICsgJyI+JyArIGRhdGUgKyAnPC9zcGFuPic7DQogICAgICAgIH0sDQogICAgICAgIG1vbnRoRGF5bmFtZTogZnVuY3Rpb24gKG1vZGVsKSB7DQogICAgICAgICAgcmV0dXJuIGA8c3BhbiBzdHlsZT0iY29sb3I6Izk1OTU5NSI+JHsobW9kZWwubGFiZWwpLnRvU3RyaW5nKCkudG9Mb2NhbGVVcHBlckNhc2UoKX08L3NwYW4+YDsNCiAgICAgICAgfSwNCiAgICAgICAgd2Vla0RheW5hbWU6IGZ1bmN0aW9uIChtb2RlbCkgew0KICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9InR1aS1mdWxsLWNhbGVuZGFyLWRheW5hbWUtZGF0ZSI+PC9zcGFuPiZuYnNwOyZuYnNwOzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1kYXluYW1lLW5hbWUiPicgKyBtb2RlbC5kYXlOYW1lLnRvTG9jYWxlVXBwZXJDYXNlKCkgKyAnPC9zcGFuPic7DQogICAgICAgIH0sDQogICAgICB9LA0KICAgICAgdXNlQ3JlYXRpb25Qb3B1cDogZmFsc2UsDQogICAgICB1c2VEZXRhaWxQb3B1cDogZmFsc2UNCiAgICB9KTsNCiAgICB0aGlzLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9ICJkYXkiDQogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJjbGlja0RheW5hbWUiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKHZtLmNhbGVuZGFySW5zdGFuY2UuZ2V0Vmlld05hbWUoKSA9PT0gIndlZWsiKSB7DQogICAgICAgIHZtLmNhbGVuZGFySW5zdGFuY2Uuc2V0RGF0ZShuZXcgRGF0ZShlLmRhdGUpKTsNCiAgICAgICAgdm0uY2FsZW5kYXJJbnN0YW5jZS5jaGFuZ2VWaWV3KCJkYXkiLCB0cnVlKTsNCiAgICAgICAgdGhpcy5jdXJyZW50X2NhbGVuZGFyX3ZpZXcgPSAiZGF5Ig0KICAgICAgICB2bS5zZXRSZW5kZXJSYW5nZVRleHQoKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2Uub24oImFmdGVyUmVuZGVyU2NoZWR1bGUiLCBmdW5jdGlvbiAoZSkgew0KICAgIH0pOw0KICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7DQogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJiZWZvcmVDcmVhdGVTY2hlZHVsZSIsIGUgPT4gew0KICAgICAgdGhpcy5uZXdfc2NoZWR1bGUoZS5zdGFydC5fZGF0ZSk7DQogICAgICBlLmd1aWRlLmNsZWFyR3VpZGVFbGVtZW50KCk7DQogICAgfSk7DQogICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm9uKCJjbGlja1NjaGVkdWxlIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICBpZiAoZXZlbnQuc2NoZWR1bGUucmF3LmlzSG9saWRheSkgew0KICAgICAgICB0b2FzdHIuZXJyb3IoDQogICAgICAgICAgIllvdSBjYW5ub3QgZW50ZXIgYSBzY2hlZHVsZSBmb3IgdGhpcyBkYXRlLiBcbiBSZWFzb246ICIgKw0KICAgICAgICAgIGV2ZW50LnNjaGVkdWxlLnJhdy5yZWFzb24NCiAgICAgICAgKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBzY2hlZHVsZSA9IGV2ZW50LnNjaGVkdWxlOw0KICAgICAgICB2bS5wYXRpZW50X25hbWUgPSBzY2hlZHVsZS50aXRsZTsNCiAgICAgICAgdm0udmlzaXRfcmVhc29uID0gc2NoZWR1bGUucmF3LnJlYXNvbjsNCiAgICAgICAgdm0udmlzaXRvcl9zeW1wdG9tcyA9IHNjaGVkdWxlLnJhdy5zeW1wdG9tczsNCiAgICAgICAgdm0udmlzaXRvcl9udW1iZXIgPSBzY2hlZHVsZS5yYXcucGhvbmVfbnVtYmVyOw0KICAgICAgICBsZXQgc2VsZWN0ZWRfdGltZSA9DQogICAgICAgICAgc2NoZWR1bGUucmF3LnN0YXJ0ICsgIi0iICsgc2NoZWR1bGUucmF3LmVuZDsNCiAgICAgICAgbGV0IHNlbGVjdGVkX3RpbWVfc3RhcnQgPSBtb21lbnQoc2NoZWR1bGUucmF3LnN0YXJ0LCBbJ0hIOm1tJ10pLmZvcm1hdCgnaGg6bW0gQScpOw0KICAgICAgICBsZXQgc2VsZWN0ZWRfdGltZV9lbmQgPSBtb21lbnQoc2NoZWR1bGUucmF3LmVuZCwgWydISDptbSddKS5mb3JtYXQoJ2hoOm1tIEEnKTsNCiAgICAgICAgdm0uZGlzcGxheV9zZWxlY3RlZF90aW1lID0gYCR7c2VsZWN0ZWRfdGltZV9zdGFydH0gLSAke3NlbGVjdGVkX3RpbWVfZW5kfWA7DQogICAgICAgIHZtLnNlbGVjdGVkX3NjaGVkdWxlX2lkID0gc2NoZWR1bGUuaWQ7DQogICAgICAgIHZtLnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3QgPSBzY2hlZHVsZS5yYXcudmlzaXRfc2xvdDsNCiAgICAgICAgdm0uZ2V0X3RpbWVfc2xvdHMoDQogICAgICAgICAgc2NoZWR1bGUuc3RhcnQuX2RhdGUsDQogICAgICAgICAgIiNzY2hlZHVsZV9kZXRhaWxzIiwNCiAgICAgICAgICBzZWxlY3RlZF90aW1lDQogICAgICAgICk7DQogICAgICAgIHZtLmFwcG9pbnRtZW50U3RhdHVzID0gc2NoZWR1bGUucmF3LmFwcG9pbnRtZW50X3N0YXR1czsNCiAgICAgICAgdm0uQXBwb2ludG1lbnRJRCA9IHNjaGVkdWxlLnJhdy5hcHBvaW50bWVudF9pZDsNCiAgICAgICAgdm0udmlzaXRTdGF0dXMgPSBzY2hlZHVsZS5yYXcudmlzaXRfc3RhdHVzDQogICAgICAgIHZtLm9wZW5DaGVja0FuZENoYW5nZVN0YXR1c01vZGFsKHNjaGVkdWxlLnJhdy5hcHBvaW50bWVudF9pZCwgc2NoZWR1bGUuc3RhcnQuX2RhdGUpDQogICAgICB9DQogICAgfSk7DQoNCiAgICB0aGlzLnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpDQoNCiAgICAkKCIjc2NoZWR1bGVfZGV0YWlscyIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCAoKSA9PiB7DQogICAgICBpZiAoIXZtLmVkaXRfc2NoZWR1bGluZykgew0KICAgICAgICB2bS5wYXRpZW50X25hbWUgPSAiIjsNCiAgICAgICAgdm0udmlzaXRfcmVhc29uID0gIiI7DQogICAgICAgIHZtLnZpc2l0b3Jfc3ltcHRvbXMgPSAiIjsNCiAgICAgICAgdm0udmlzaXRvcl9udW1iZXIgPSAiIjsNCiAgICAgICAgdm0uc2VsZWN0ZWRfdGltZSA9ICIiOw0KICAgICAgICB2bS5pc0VkaXQgPSBmYWxzZTsNCiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfaWQgPSAiIjsNCiAgICAgICAgdm0uc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdCA9ICIiOw0KICAgICAgICB2bS5pc1Jlc2NoZWR1bGV0aW1lID0gZmFsc2U7DQogICAgICAgIHZtLmVkaXRfc2NoZWR1bGluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgICQoIiNzY2hlZHVsZV9jcmVhdGUiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgKCkgPT4gew0KICAgICAgdm0ucGF0aWVudF9uYW1lID0gIiI7DQogICAgICB2bS52aXNpdF9yZWFzb24gPSAiIjsNCiAgICAgIHZtLnZpc2l0b3Jfc3ltcHRvbXMgPSAiIjsNCiAgICAgIHZtLnZpc2l0b3JfbnVtYmVyID0gIiI7DQogICAgICB2bS5zZWxlY3RlZF90aW1lID0gIiI7DQogICAgfSk7DQogICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgKCkgPT4gew0KICAgICAgdm0uc2NoZWR1bGluZ19jb250YWN0X251bWJlciA9ICIiOw0KICAgICAgdm0uc2NoX3ZvaWNlX2dyZWV0aW5ncyA9ICIiOw0KICAgICAgdm0uc2NoX3Ntc19ncmVldGluZ3MgPSAiIjsNCiAgICAgIHZtLmNzdl9maWxlID0gIiI7DQogICAgICB2bS5maWxlX2xhYmVsID0gIkNob29zZSBGaWxlIjsNCiAgICB9KTsNCg0KICAgIHZhciB4LCBpLCBqLCBsLCBsbCwgc2VsRWxtbnQsIGEsIGIsIGMsIHZtID0gdGhpczsNCiAgICAvKmxvb2sgZm9yIGFueSBlbGVtZW50cyB3aXRoIHRoZSBjbGFzcyAiY3VzdG9tLXNjaGVkdWxlci1zZWxlY3QiOiovDQogICAgeCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImN1c3RvbS1zY2hlZHVsZXItc2VsZWN0Iik7DQogICAgbCA9IHgubGVuZ3RoOw0KICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHsNCiAgICAgIHNlbEVsbW50ID0geFtpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2VsZWN0IilbMF07DQogICAgICBsbCA9IHNlbEVsbW50Lmxlbmd0aDsNCiAgICAgIC8qZm9yIGVhY2ggZWxlbWVudCwgY3JlYXRlIGEgbmV3IERJViB0aGF0IHdpbGwgYWN0IGFzIHRoZSBzZWxlY3RlZCBpdGVtOiovDQogICAgICBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7DQogICAgICBhLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic2VsZWN0LXNlbGVjdGVkIik7DQogICAgICBhLmlubmVySFRNTCA9IHNlbEVsbW50Lm9wdGlvbnNbc2VsRWxtbnQuc2VsZWN0ZWRJbmRleF0uaW5uZXJIVE1MOw0KICAgICAgeFtpXS5hcHBlbmRDaGlsZChhKTsNCiAgICAgIC8qZm9yIGVhY2ggZWxlbWVudCwgY3JlYXRlIGEgbmV3IERJViB0aGF0IHdpbGwgY29udGFpbiB0aGUgb3B0aW9uIGxpc3Q6Ki8NCiAgICAgIGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsNCiAgICAgIGIuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzZWxlY3QtaXRlbXMgc2VsZWN0LWhpZGUiKTsNCiAgICAgIGZvciAoaiA9IDE7IGogPCBsbDsgaisrKSB7DQogICAgICAgIC8qZm9yIGVhY2ggb3B0aW9uIGluIHRoZSBvcmlnaW5hbCBzZWxlY3QgZWxlbWVudCwNCiAgICAgICAgY3JlYXRlIGEgbmV3IERJViB0aGF0IHdpbGwgYWN0IGFzIGFuIG9wdGlvbiBpdGVtOiovDQogICAgICAgIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKTsNCiAgICAgICAgYy5pbm5lckhUTUwgPSBzZWxFbG1udC5vcHRpb25zW2pdLmlubmVySFRNTDsNCiAgICAgICAgYy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgLyp3aGVuIGFuIGl0ZW0gaXMgY2xpY2tlZCwgdXBkYXRlIHRoZSBvcmlnaW5hbCBzZWxlY3QgYm94LA0KICAgICAgICAgIGFuZCB0aGUgc2VsZWN0ZWQgaXRlbToqLw0KICAgICAgICAgIHZhciB5LCBpLCBrLCBzLCBoLCBzbCwgeWw7DQogICAgICAgICAgcyA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZWxlY3QiKVswXTsNCiAgICAgICAgICBzbCA9IHMubGVuZ3RoOw0KICAgICAgICAgIGggPSB0aGlzLnBhcmVudE5vZGUucHJldmlvdXNTaWJsaW5nOw0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzbDsgaSsrKSB7DQogICAgICAgICAgICBpZiAocy5vcHRpb25zW2ldLmlubmVySFRNTCA9PSB0aGlzLmlubmVySFRNTCkgew0KICAgICAgICAgICAgICBzLnNlbGVjdGVkSW5kZXggPSBpOw0KICAgICAgICAgICAgICBoLmlubmVySFRNTCA9IHRoaXMuaW5uZXJIVE1MOw0KICAgICAgICAgICAgICB5ID0gdGhpcy5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInNhbWUtYXMtc2VsZWN0ZWQiKTsNCiAgICAgICAgICAgICAgeWwgPSB5Lmxlbmd0aDsNCiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IHlsOyBrKyspIHsNCiAgICAgICAgICAgICAgICB5W2tdLnJlbW92ZUF0dHJpYnV0ZSgiY2xhc3MiKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic2FtZS1hcy1zZWxlY3RlZCIpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgaC5jbGljaygpOw0KICAgICAgICAgIHZtLmN1cnJlbnRfY2FsZW5kYXJfdmlldyA9IHNlbEVsbW50LnZhbHVlDQogICAgICAgIH0pOw0KICAgICAgICBiLmFwcGVuZENoaWxkKGMpOw0KICAgICAgfQ0KICAgICAgeFtpXS5hcHBlbmRDaGlsZChiKTsNCiAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAvKndoZW4gdGhlIHNlbGVjdCBib3ggaXMgY2xpY2tlZCwgY2xvc2UgYW55IG90aGVyIHNlbGVjdCBib3hlcywNCiAgICAgICAgYW5kIG9wZW4vY2xvc2UgdGhlIGN1cnJlbnQgc2VsZWN0IGJveDoqLw0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICBjbG9zZUFsbFNlbGVjdCh0aGlzKTsNCiAgICAgICAgdGhpcy5uZXh0U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCJzZWxlY3QtaGlkZSIpOw0KICAgICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoInNlbGVjdC1hcnJvdy1hY3RpdmUiKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgICBmdW5jdGlvbiBjbG9zZUFsbFNlbGVjdCAoZWxtbnQpIHsNCiAgICAgIC8qYSBmdW5jdGlvbiB0aGF0IHdpbGwgY2xvc2UgYWxsIHNlbGVjdCBib3hlcyBpbiB0aGUgZG9jdW1lbnQsDQogICAgICBleGNlcHQgdGhlIGN1cnJlbnQgc2VsZWN0IGJveDoqLw0KICAgICAgdmFyIHgsIHksIGksIHhsLCB5bCwgYXJyTm8gPSBbXTsNCiAgICAgIHggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWxlY3QtaXRlbXMiKTsNCiAgICAgIHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJzZWxlY3Qtc2VsZWN0ZWQiKTsNCiAgICAgIHhsID0geC5sZW5ndGg7DQogICAgICB5bCA9IHkubGVuZ3RoOw0KICAgICAgZm9yIChpID0gMDsgaSA8IHlsOyBpKyspIHsNCiAgICAgICAgaWYgKGVsbW50ID09IHlbaV0pIHsNCiAgICAgICAgICBhcnJOby5wdXNoKGkpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgeVtpXS5jbGFzc0xpc3QucmVtb3ZlKCJzZWxlY3QtYXJyb3ctYWN0aXZlIik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGZvciAoaSA9IDA7IGkgPCB4bDsgaSsrKSB7DQogICAgICAgIGlmIChhcnJOby5pbmRleE9mKGkpKSB7DQogICAgICAgICAgeFtpXS5jbGFzc0xpc3QuYWRkKCJzZWxlY3QtaGlkZSIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIC8qaWYgdGhlIHVzZXIgY2xpY2tzIGFueXdoZXJlIG91dHNpZGUgdGhlIHNlbGVjdCBib3gsDQogICAgdGhlbiBjbG9zZSBhbGwgc2VsZWN0IGJveGVzOiovDQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjbG9zZUFsbFNlbGVjdCk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBvcGVuX3NjaGVkdWxpbmdfbW9kYWwgKCkgew0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgdGhpcy5lZGl0X3NjaGVkdWxpbmcgPSBmYWxzZTsNCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsaW5nX3NldHRpbmdzX3VybCgpLCB7DQogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICBnZXRTY2hlZHVsaW5nSW5mbzogdHJ1ZQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICByZXNwb25zZS5kYXRhICE9IG51bGwgJiYNCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvICE9IHVuZGVmaW5lZA0KICAgICAgICAgICkgew0KICAgICAgICAgICAgdGhpcy5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyID0NCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ucGhvbmVfbnVtYmVyOw0KICAgICAgICAgICAgdGhpcy5zY2hfdm9pY2VfZ3JlZXRpbmdzID0gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8udm9pY2VfdGV4dDsNCiAgICAgICAgICAgIHRoaXMuc2NoX3Ntc19ncmVldGluZ3MgPSByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5zbXNfdGV4dDsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby5ldGFfdG9fY2FsbCA9PSBudWxsKSB7DQogICAgICAgICAgICAgIHRoaXMuY2FsbF9yZW1pbmRlcl9taW5zID0NCiAgICAgICAgICAgICAgICAxNTsNCiAgICAgICAgICAgICAgdGhpcy5jYWxsX3JlbWluZGVyX2hycyA9DQogICAgICAgICAgICAgICAgMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICB0aGlzLmNhbGxfcmVtaW5kZXJfbWlucyA9DQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uZXRhX3RvX2NhbGwubWludXRlczsNCiAgICAgICAgICAgICAgdGhpcy5jYWxsX3JlbWluZGVyX2hycyA9DQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uZXRhX3RvX2NhbGwuaG91cnM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnNlbGVjdGVkX3RpbWVfc2xvdCA9IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLnRpbWVfc2xvdCAhPT0gbnVsbCA/IHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLnRpbWVfc2xvdCA6ICIiDQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLkhvbGlkYXlfbGlzdF9maWxlX25hbWUgPT0gIiIgfHwNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uSG9saWRheV9saXN0X2ZpbGVfbmFtZSA9PSBudWxsDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIC8vIHRoaXMuZmlsZV9sYWJlbCA9DQogICAgICAgICAgICAgIC8vICAgcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8uSG9saWRheV9saXN0X2ZpbGVfbmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5TY2hlZHVsaW5nX2luZm8ud29ya2luZ19ocnMpIHsNCiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2Zyb21fIiArIGkpLnZhbHVlID0NCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mby53b3JraW5nX2hyc1tpXS5TdGFydFRpbWU7DQogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN0b18iICsgaSkudmFsdWUgPQ0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvLndvcmtpbmdfaHJzW2ldLkVuZFRpbWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJzaG93Iik7DQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goZXJyID0+IHsNCiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnIpOw0KICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgJCgiI3NjaGVkdWxpbmdfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOw0KICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgZ2V0X3RpbWVfc2xvdHMgKHN0YXJ0X2RhdGUsIHR5cGUsIHNlbGVjdGVkX3RpbWUsIGlzX3Jlc2NoZWR1bGluZykgew0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgdGhpcy5lZGl0X3NjaGVkdWxpbmcgPSBpc19yZXNjaGVkdWxpbmcgPT09ICJpc19yZXNjaGVkdWxpbmciOw0KICAgICAgaWYgKGlzX3Jlc2NoZWR1bGluZyA9PT0gImlzX3Jlc2NoZWR1bGluZyIpIHsNCiAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIikNCiAgICAgIH0NCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV91cmwoKSwgew0KICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwNCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgRGF0ZTogbW9tZW50KHN0YXJ0X2RhdGUpLmZvcm1hdCgnWVlZWS1NTS1EJyksDQogICAgICAgICAgYXBwb2ludG1lbnRfZGF0ZTogbW9tZW50KHN0YXJ0X2RhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09IG51bGwpIHsNCiAgICAgICAgICB9IGVsc2UgaWYgKA0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiDQogICAgICAgICAgKSB7DQogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7DQogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzID0gW107DQogICAgICAgICAgICAgIHZhciBnZXRfZnVsbF9zbG90X2xpc3QgPSB0cnVlOw0KICAgICAgICAgICAgICB2YXIgdGVtcF9zdGFydF9kYXRlID0gbmV3IERhdGUoc3RhcnRfZGF0ZSk7DQogICAgICAgICAgICAgIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSA+IGR0LmdldEZ1bGxZZWFyKCkpIHsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSA9PSBkdC5nZXRGdWxsWWVhcigpKSB7DQogICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRNb250aCgpID4gZHQuZ2V0TW9udGgoKSkgew0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldE1vbnRoKCkgPT0gZHQuZ2V0TW9udGgoKSkgew0KICAgICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXREYXRlKCkgPiBkdC5nZXREYXRlKCkpIHsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA9PSBkdC5nZXREYXRlKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgZ2V0X2Z1bGxfc2xvdF9saXN0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIGlmIChtb21lbnQoc3RhcnRfZGF0ZSkuZGlmZihtb21lbnQoKSwgImRheSIpIDw9IDApIHsNCiAgICAgICAgICAgICAgLy8gICBnZXRfZnVsbF9zbG90X2xpc3QgPSBmYWxzZTsNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgICBpZiAoZ2V0X2Z1bGxfc2xvdF9saXN0KSB7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90cykgew0KICAgICAgICAgICAgICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXSwNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXQ0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgICBkdC5nZXRIb3VycygpIDwNCiAgICAgICAgICAgICAgICAgICAgICBOdW1iZXIoDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLnNwbGl0KCI6IilbMF0NCiAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICkgeyAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzFdDQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHMpIHsNCiAgICAgICAgICAgICAgICAvLyAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goew0KICAgICAgICAgICAgICAgIC8vICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXSwNCiAgICAgICAgICAgICAgICAvLyAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAgIC8vICAgICAgIHJlc3BvbnNlLmRhdGEuYXZhaWxhYmxlX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVswXSwNCiAgICAgICAgICAgICAgICAvLyAgICAgICByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0NCiAgICAgICAgICAgICAgICAvLyAgICAgKQ0KICAgICAgICAgICAgICAgIC8vICAgfSk7DQogICAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChCb29sZWFuKHNlbGVjdGVkX3RpbWUpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5pc0VkaXQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX3RpbWUgPSBzZWxlY3RlZF90aW1lOw0KICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkX3RpbWUgPSB0aGlzLmdlbmVyYXRlX3RpbWUoDQogICAgICAgICAgICAgICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMV0NCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgIHRoaXMudGltZV9zbG90cyA9IFtdOw0KICAgICAgICAgICAgICAgIC8vIHRoaXMudGltZV9zbG90cy5wdXNoKHsNCiAgICAgICAgICAgICAgICAvLyAgIHZhbHVlOiBzZWxlY3RlZF90aW1lLA0KICAgICAgICAgICAgICAgIC8vICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgICAgLy8gICAgIHNlbGVjdGVkX3RpbWUuc3BsaXQoIi0iKVsxXQ0KICAgICAgICAgICAgICAgIC8vICAgKQ0KICAgICAgICAgICAgICAgIC8vIH0pDQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmZ1bGxfdGltZV9zbG90cykgew0KICAgICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoDQogICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0udmFsdWUNCiAgICAgICAgICAgICAgICAgICAgKSA9PSAtMSB8fCB0aGlzLnNlbGVjdGVkX3RpbWUgPT0gdGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0udmFsdWUNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVfc2xvdHMucHVzaCh0aGlzLmZ1bGxfdGltZV9zbG90c1tpXSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy5mdWxsX3RpbWVfc2xvdHMpIHsNCiAgICAgICAgICAgICAgICAvLyAgIHRoaXMudGltZV9zbG90cy5wdXNoKHRoaXMuZnVsbF90aW1lX3Nsb3RzW2ldKTsNCiAgICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIUJvb2xlYW4oc2VsZWN0ZWRfdGltZSkpIHsNCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90cy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICAgdGhpcy50aW1lX3Nsb3RzID0gdGhpcy5mdWxsX3RpbWVfc2xvdHM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgdGhpcy50aW1lX3Nsb3RzID0gW107DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuZnVsbF90aW1lX3Nsb3RzKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICkgPT0gLTENCiAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lX3Nsb3RzLnB1c2godGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAvLyAgdGhpcy50aW1lX3Nsb3RzID0gcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90czsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHRoaXMudGltZV9zbG90cy5sZW5ndGggPT09IDAgJiYgdHlwZSA9PSAnc2NoZWR1bGVfZGV0YWlscycpIHsNCiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ05vIEZyZWUgU2xvdHMgZm9yIHRoaXMgRGF0ZScpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJCh0eXBlKS5tb2RhbCgic2hvdyIpOw0KICAgICAgICAgICAgICAgIHRoaXMudGVtcF9uYW1lID0gdGhpcy5wYXRpZW50X25hbWU7DQogICAgICAgICAgICAgICAgdGhpcy50ZW1wX3JlYXNvbiA9IHRoaXMudmlzaXRfcmVhc29uOw0KICAgICAgICAgICAgICAgIHRoaXMudGVtcF9zeW1wdG9tcyA9IHRoaXMudmlzaXRvcl9zeW1wdG9tczsNCiAgICAgICAgICAgICAgICB0aGlzLnRlbXBfYXBwb2ludG1lbnRfdGltZSA9IHRoaXMuc2VsZWN0ZWRfdGltZTsNCiAgICAgICAgICAgICAgICB0aGlzLmlzUmVzY2hlZHVsZSA9IHRydWU7DQogICAgICAgICAgICAgICAgdmFyIG5EYXRlID0gbmV3IERhdGUoDQogICAgICAgICAgICAgICAgICBzdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgKw0KICAgICAgICAgICAgICAgICAgIi0iICsNCiAgICAgICAgICAgICAgICAgIChzdGFydF9kYXRlLmdldE1vbnRoKCkgPCA5DQogICAgICAgICAgICAgICAgICAgID8gIjAiICsgKHN0YXJ0X2RhdGUuZ2V0TW9udGgoKSArIDEpDQogICAgICAgICAgICAgICAgICAgIDogc3RhcnRfZGF0ZS5nZXRNb250aCgpICsgMSkgKw0KICAgICAgICAgICAgICAgICAgIi0iICsNCiAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGUuZ2V0RGF0ZSgpDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB0aGlzLnRlbXBfZGF0YSA9IG5EYXRlOw0KICAgICAgICAgICAgICAgIHRoaXMucHJldmlvdXNfdmlzaXRfZGF0ZSA9IG5EYXRlOw0KICAgICAgICAgICAgICAgIHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlID0gbW9tZW50KG5EYXRlKS5mb3JtYXQoIk1NLURELVlZWVkiKTsNCiAgICAgICAgICAgICAgICB2YXIgbWlkYXRlID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGVwaWNrZXJJbnN0YW5jZSA9IG5ldyBEYXRlUGlja2VyKCIjZGF0ZXBpY2tlciIsIHsNCiAgICAgICAgICAgICAgICAgIGRhdGU6IG5EYXRlLA0KICAgICAgICAgICAgICAgICAgbWluRGF0ZTogbWlkYXRlLA0KICAgICAgICAgICAgICAgICAgaW5wdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogIiNkYXRlcGlja2VyLWlucHV0IiwNCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAieXl5eS1NTS1kZCINCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICBzZXRSYW5nZXM6IChbDQogICAgICAgICAgICAgICAgICAgIFtuZXcgRGF0ZSgpLCBuZXcgRGF0ZSgyMDUwLCAxMiwgMTIpXSwNCiAgICAgICAgICAgICAgICAgIF0pDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgdmFyIHZtID0gdGhpczsNCiAgICAgICAgICAgICAgICB0aGlzLmRhdGVwaWNrZXJJbnN0YW5jZS5vbigiY2xvc2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAvL3ZhciB4PSBuRGF0ZQ0KICAgICAgICAgICAgICAgICAgdm0uY2hlY2tkYXRlKCk7DQogICAgICAgICAgICAgICAgICAvLyAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAvLyB9LCAxMDAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7DQogICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBzYW1wbGVfaG9saWRheSAoKSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOw0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgYXhpb3Moew0KICAgICAgICBtZXRob2Q6ICJwb3N0IiwNCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuaG9saWRheV9maWxlX2Rvd25sb2FkKCksDQogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLA0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgIH0sDQogICAgICAgIGRhdGE6IHsNCiAgICAgICAgICBpc0hvbGlkYXlGaWxlOiB0cnVlLA0KICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwNCiAgICAgICAgfQ0KICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7DQogICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIGZpbGUiKXsNCiAgICAgICAgICBzd2FsLmZpcmUoew0KICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwNCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsDQogICAgICAgICAgICB0aW1lcjogMjUwMA0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7DQogICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOw0KICAgICAgICBsaW5rLmhyZWYgPSB1cmw7DQogICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJob2xpZGF5U2FtcGxlRmlsZS5jc3YiKTsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsNCiAgICAgICAgbGluay5jbGljaygpOw0KICAgICAgICB9DQogICAgICB9KS5jYXRjaCgoZSk9PiB7DQogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7DQogICAgICAgIHN3YWwuZmlyZSh7DQogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwNCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLA0KICAgICAgICAgIHRpbWVyOiAyNTAwDQogICAgICAgIH0pOw0KICAgICAgICBpZiAoDQogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICkgew0KICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgZmlsZWlucHV0IChlKSB7DQogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsNCiAgICAgIGlmIChmaWxlc1swXS5zaXplIDwgMTAwMDAwMCkgew0KICAgICAgICBpZiAoZmlsZXNbMF0ubmFtZS5pbmNsdWRlcygiY3N2IikpIHsNCiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSBmaWxlc1swXS5uYW1lOw0KICAgICAgICAgIHRoaXMuY3JlYXRlQ1NWKGZpbGVzWzBdKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdG9hc3RyLmVycm9yKCJVcGxvYWQgb25seSAuY3N2IGZpbGUgd2l0aCBzaXplIGxlc3MgdGhhbiAxTUIiKTsNCiAgICAgIH0NCiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47DQogICAgfSwNCiAgICBjcmVhdGVDU1YgKGZpbGUsIHR5cGUpIHsNCiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gew0KICAgICAgICB0aGlzLmNzdl9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07DQogICAgICB9Ow0KICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7DQogICAgfSwNCiAgICBzZW5kX3NjaGVkdWxpbmcgKCkgew0KICAgICAgdmFyIHdvcmtpbmdfaHJzID0ge307DQogICAgICBmb3IgKHZhciBpIGluIHRoaXMud2Vla19kYXlzKSB7DQogICAgICAgIHdvcmtpbmdfaHJzW3RoaXMud2Vla19kYXlzW2ldXSA9IHsNCiAgICAgICAgICBTdGFydFRpbWU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNmcm9tXyIgKyB0aGlzLndlZWtfZGF5c1tpXSkudmFsdWUsDQogICAgICAgICAgRW5kVGltZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3RvXyIgKyB0aGlzLndlZWtfZGF5c1tpXSkudmFsdWUNCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICAgIC8vIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiQWRtaW4iKSB7DQogICAgICBpZiAoDQogICAgICAgIHRoaXMuc2NoX3ZvaWNlX2dyZWV0aW5ncyAhPSAiIiAmJg0KICAgICAgICB0aGlzLnNjaF9zbXNfZ3JlZXRpbmdzICE9ICIiICYmDQogICAgICAgIHRoaXMuc2VsZWN0ZWRfdGltZV9zbG90ICE9ICIiICYmDQogICAgICAgIHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlciAhPSAiIiAmJiANCiAgICAgICAgdGhpcy52YWxpZFBob25lTnVtYmVyID09IHRydWUNCiAgICAgICkgew0KICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxpbmdfc2V0dGluZ3NfdXJsKCksIHsNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgIGdldFNjaGVkdWxpbmdJbmZvOiBmYWxzZSwNCiAgICAgICAgICAgIGlzdXBkYXRlOiB0cnVlLA0KICAgICAgICAgICAgLy8gdXBkYXRlQ29udGFjdDogdHJ1ZSwNCiAgICAgICAgICAgIENvbnRhY3ROdW1iZXI6IHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlciwNCiAgICAgICAgICAgIHRpbWVzbG90OiBOdW1iZXIodGhpcy5zZWxlY3RlZF90aW1lX3Nsb3QpLA0KICAgICAgICAgICAgd29ya2luZ19ocnM6IHdvcmtpbmdfaHJzLA0KICAgICAgICAgICAgaXN1cGRhdGVIb2xpZGF5OiB0aGlzLmNzdl9maWxlICE9ICIiID8gdHJ1ZSA6IGZhbHNlLA0KICAgICAgICAgICAgaG9saWRheV9saXN0X2ZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsLA0KICAgICAgICAgICAgaG9saWRheV9saXN0X2ZpbGVfZGF0YToNCiAgICAgICAgICAgICAgdGhpcy5jc3ZfZmlsZSA9PSAiIiA/IG51bGwgOiB0aGlzLmNzdl9maWxlLA0KICAgICAgICAgICAgdm9pY2V0ZXh0OiB0aGlzLnNjaF92b2ljZV9ncmVldGluZ3MsDQogICAgICAgICAgICBzbXN0ZXh0OiB0aGlzLnNjaF9zbXNfZ3JlZXRpbmdzLA0KICAgICAgICAgICAgZXRhX3RvX2NhbGw6IHsNCiAgICAgICAgICAgICAgaG91cnM6IE51bWJlcih0aGlzLmNhbGxfcmVtaW5kZXJfaHJzKSwNCiAgICAgICAgICAgICAgbWludXRlczogTnVtYmVyKHRoaXMuY2FsbF9yZW1pbmRlcl9taW5zKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sew0KICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgIH0sDQogICAgICAgICAgfSkNCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsaW5nX21vZGFsIikNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmDQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubXNnID09ICJTY2hlZHVsaW5nIGluZm8gdXBkYXRlZCINCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygNCiAgICAgICAgICAgICAgICAiWW91ciBzY2hlZHVsaW5nIGluZm9ybWF0aW9uIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICB0aGlzLnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpDQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnZhbGlkIEhlYWRlciIpIHsNCiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKA0KICAgICAgICAgICAgICAgICJQbGVhc2UgZW50ZXIgeW91ciBoZWFkZXJzIGFzIHByb3ZpZGVkIGluIHRoZSBzYW1wbGUgZmlsZSBiZWxvdy4iDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICIiKSB7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJoaWRlIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICAkKCIjc2NoZWR1bGluZ19tb2RhbCIpLm1vZGFsKCJoaWRlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAodGhpcy52YWxpZFBob25lTnVtYmVyICE9IHRydWUgICYmIHRoaXMuc2NoZWR1bGluZ19jb250YWN0X251bWJlciAhPSAiIil7DQogICAgICAgICAgdG9hc3RyLmVycm9yKCJNb2JpbGUgbnVtYmVyIGlzIGludmFsaWQsIHBsZWFzZSBlbnRlciBpbiBmb3JtYXQ6ICsgQ291bnRyeUNvZGUgTnVtYmVyIik7DQogICAgICAgIH1lbHNlew0KICAgICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyB9DQogICAgICAvLyBlbHNlIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsNCiAgICAgIC8vICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgLy8gICBheGlvcw0KICAgICAgLy8gICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsaW5nX3NldHRpbmdzX3VybCgpLCB7DQogICAgICAvLyAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLA0KICAgICAgLy8gICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsDQogICAgICAvLyAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgLy8gICAgICAgZ2V0U2NoZWR1bGluZ0luZm86IGZhbHNlLA0KICAgICAgLy8gICAgICAgaXN1cGRhdGU6IHRydWUsDQogICAgICAvLyAgICAgICB2b2ljZXRleHQ6IHRoaXMuc2NoX3ZvaWNlX2dyZWV0aW5ncywNCiAgICAgIC8vICAgICAgIHNtc3RleHQ6IHRoaXMuc2NoX3Ntc19ncmVldGluZ3MsDQogICAgICAvLyAgICAgICB1cGRhdGVDb250YWN0OiB0cnVlLA0KICAgICAgLy8gICAgICAgQ29udGFjdE51bWJlcjogdGhpcy5zY2hlZHVsaW5nX2NvbnRhY3RfbnVtYmVyLA0KICAgICAgLy8gICAgICAgZXRhX3RvX2NhbGw6IHsNCiAgICAgIC8vICAgICAgICAgaG91cnM6IE51bWJlcih0aGlzLmNhbGxfcmVtaW5kZXJfaHJzKSwNCiAgICAgIC8vICAgICAgICAgbWludXRlczogTnVtYmVyKHRoaXMuY2FsbF9yZW1pbmRlcl9taW5zKQ0KICAgICAgLy8gICAgICAgfQ0KICAgICAgLy8gICAgIH0pDQogICAgICAvLyAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgLy8gICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgIC8vICAgICAgIHRoaXMuaGlkZV9tb2RhbCgic2NoZWR1bGluZ19tb2RhbCIpDQogICAgICAvLyAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIlNjaGVkdWxpbmcgaW5mbyB1cGRhdGVkIikgew0KICAgICAgLy8gICAgICAgICB0b2FzdHIuc3VjY2VzcygNCiAgICAgIC8vICAgICAgICAgICAiWW91ciBzY2hlZHVsaW5nIGdyZWV0aW5ncyBoYXMgYmVlbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseSINCiAgICAgIC8vICAgICAgICAgKTsNCiAgICAgIC8vICAgICAgICAgdGhpcy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKQ0KICAgICAgLy8gICAgICAgfQ0KICAgICAgLy8gICAgIH0pOw0KICAgICAgLy8gfQ0KICAgIH0sDQogICAgZ2VuZXJhdGVfdGltZSAoc3RhcnRfdGltZSwgZW5kX3RpbWUpIHsNCiAgICAgIHZhciBzdGFydCA9IG1vbWVudChzdGFydF90aW1lLCBbImhoOm1tIl0pLmZvcm1hdCgiaGg6bW0gQSIpDQogICAgICB2YXIgZW5kID0gbW9tZW50KGVuZF90aW1lLCBbImhoOm1tIl0pLmZvcm1hdCgiaGg6bW0gQSIpDQoNCiAgICAgIHJldHVybiBgJHtzdGFydH0tJHtlbmR9YDsNCiAgICB9LA0KICAgIG5ld19zY2hlZHVsZSAoc3RhcnREYXRlKSB7DQogICAgICBsZXQgc2NoZWR1bGVEYXRlID0gJycNCiAgICAgIGlmIChtb21lbnQoc3RhcnREYXRlLCAnWVlZWS1NTS1ERCcsIHRydWUpLmlzVmFsaWQoKSkgew0KICAgICAgICBzY2hlZHVsZURhdGUgPSBzdGFydERhdGUNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNjaGVkdWxlRGF0ZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkNCiAgICAgIH0NCg0KICAgICAgbGV0IGhvbGlkYXlfZGF0ZSA9IHRoaXMuc2NoZWR1bGVfbGlzdC5maWx0ZXIoc2NoZWR1bGUgPT4gew0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgIG1vbWVudChzY2hlZHVsZS5zdGFydCkuZm9ybWF0KCJZWVlZIE1NTU0gREQiKSA9PQ0KICAgICAgICAgIG1vbWVudChzY2hlZHVsZURhdGUpLmZvcm1hdCgiWVlZWSBNTU1NIEREIikgJiYNCiAgICAgICAgICBzY2hlZHVsZS5yYXcuaXNIb2xpZGF5ID09IHRydWUNCiAgICAgICAgKTsNCiAgICAgIH0pOw0KICAgICAgbGV0IHRvZGF5X3RpbWUgPSBuZXcgRGF0ZSgpOw0KICAgICAgbGV0IHN0YXJ0X3RpbWUgPSBzY2hlZHVsZURhdGU7DQogICAgICB0aGlzLnNlbGVjdGVkX2RhdGUgPSBzdGFydF90aW1lOw0KICAgICAgc3RhcnRfdGltZS5zZXRIb3VycygwLCAwLCAwLCAwKTsNCiAgICAgIGlmICgNCiAgICAgICAgdGhpcy5kYXRlX2NvbmRpdGlvbih0b2RheV90aW1lLCBzdGFydF90aW1lKSAmJg0KICAgICAgICBob2xpZGF5X2RhdGUubGVuZ3RoID09IDAgJiYNCiAgICAgICAgbW9tZW50KHN0YXJ0X3RpbWUpLmZvcm1hdCgiZGRkZCIpICE9ICJTdW5kYXkiDQogICAgICApIHsNCiAgICAgICAgdGhpcy5nZXRfdGltZV9zbG90cyhzY2hlZHVsZURhdGUsICIjc2NoZWR1bGVfY3JlYXRlIik7DQogICAgICB9IGVsc2UgaWYgKGhvbGlkYXlfZGF0ZS5sZW5ndGggPiAwKSB7DQogICAgICAgIHRvYXN0ci5lcnJvcigNCiAgICAgICAgICAiWW91IGNhbm5vdCBlbnRlciBhIHNjaGVkdWxlIGZvciB0aGlzIGRhdGUuIFxuIFJlYXNvbjogIiArDQogICAgICAgICAgaG9saWRheV9kYXRlWzBdLnJhdy5yZWFzb24NCiAgICAgICAgKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICB9DQogICAgfSwNCiAgICBjcmVhdGVfYXBwb2ludG1lbnQgKCkgew0KICAgICAgY29uc3QgcmVnZXggPSAvXCtbMC05XXs5LDE0fSQvOw0KICAgICAgY29uc3QgeCA9IHRoaXMudmlzaXRvcl9udW1iZXIucmVwbGFjZSgvXHMrL2csICcnKTsNCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICBpZiAoDQogICAgICAgIC8vIHRoaXMudmlzaXRfcmVhc29uID09ICIiIHx8DQogICAgICAgIC8vIHRoaXMudmlzaXRvcl9zeW1wdG9tcyA9PSAiIiB8fA0KICAgICAgICB0aGlzLnBhdGllbnRfbmFtZSA9PSAiIiB8fA0KICAgICAgICB0aGlzLnZpc2l0b3JfbnVtYmVyID09ICIiIHx8DQogICAgICAgIHRoaXMuc2VsZWN0ZWRfdGltZSA9PSAiIg0KICAgICAgKSB7DQogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBpZiAoIXJlZ2V4LnRlc3QoeCkpIHsNCiAgICAgICAgdG9hc3RyLmVycm9yKCJNb2JpbGUgbnVtYmVyIGlzIGludmFsaWQsIHBsZWFzZSBlbnRlciBpbiBmb3JtYXQ6ICsgQ291bnRyeUNvZGUgTnVtYmVyIik7DQogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFZGl0KSB7DQogICAgICAgIGxldCBhcHBvaW50bWVudF9wYXlsb2FkID0gew0KICAgICAgICAgIFZpc2l0b3JOYW1lOiB0aGlzLnBhdGllbnRfbmFtZSwNCiAgICAgICAgICBWaXNpdFJlYXNvbjogdGhpcy52aXNpdF9yZWFzb24sDQogICAgICAgICAgU3ltcHRvbXM6IHRoaXMudmlzaXRvcl9zeW1wdG9tcywNCiAgICAgICAgICBWaXNpdFNsb3Q6IHRoaXMuc2VsZWN0ZWRfdGltZSwNCiAgICAgICAgICBQaG9uZU51bWJlcjogdGhpcy52aXNpdG9yX251bWJlciwNCiAgICAgICAgICBWaXNpdERhdGU6IHRoaXMuc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdC5zcGxpdCgiICIpWzBdDQogICAgICAgIH07DQogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfZWRpdF9kZWxldGVfdXJsKCksIHsNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgIGRhdGU6IHRoaXMuc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdC5zcGxpdCgiICIpWzBdLA0KICAgICAgICAgICAgaXNfZWRpdDogdGhpcy5pc0VkaXQsDQogICAgICAgICAgICBhcHBvaW50bWVudF9pZDogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV9pZCwNCiAgICAgICAgICAgIGFwcG9pbnRtZW50X2luZm86IGFwcG9pbnRtZW50X3BheWxvYWQNCiAgICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubXNnICE9IHVuZGVmaW5lZCAmJg0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1zZyA9PSAiRWRpdCBBcHBvaW50bWVudCINCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciBhcHBvaW50bWVudCBoYXMgYmVlbiBlZGl0ZWQgc3VjY2Vzc2Z1bGx5LiIpOw0KICAgICAgICAgICAgICB0aGlzLmhpZGVfbW9kYWwoInNjaGVkdWxlX2NyZWF0ZSIpDQogICAgICAgICAgICAgIHRoaXMudXBkYXRlX3NjaGVkdWxlc19saXN0KCkNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsNCiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7DQogICAgICAgICAgICB0aGlzLmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKQ0KICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9hcHBvaW50bWVudF91cmwoKSwgew0KICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLA0KICAgICAgICAgICAgdmlzaXRvcl9uYW1lOiB0aGlzLnBhdGllbnRfbmFtZSwNCiAgICAgICAgICAgIHZpc2l0X3JlYXNvbjogdGhpcy52aXNpdF9yZWFzb24sDQogICAgICAgICAgICBzeW1wdG9tczogdGhpcy52aXNpdG9yX3N5bXB0b21zLA0KICAgICAgICAgICAgdmlzaXRfc2xvdDogdGhpcy5zZWxlY3RlZF90aW1lLA0KICAgICAgICAgICAgdmlzaXRfZGF0ZTogJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZQ0KICAgICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tc2cgIT0gdW5kZWZpbmVkICYmDQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubXNnID09ICJBcHBvaW50bWVudCBBZGRlZCBTdWNjZXNzZnVsbHkiDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gY3JlYXRlZCBzdWNjZXNzZnVsbHkuIik7DQogICAgICAgICAgICAgIHRoaXMuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIikNCiAgICAgICAgICAgICAgdGhpcy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKQ0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgew0KICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICB0aGlzLmhpZGVfbW9kYWwoInNjaGVkdWxlX2NyZWF0ZSIpDQogICAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goZSA9PiB7DQogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9jcmVhdGUiKQ0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGRlbGV0ZV9hcHBvaW50bWVudCAoKSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgc3dhbA0KICAgICAgICAuZmlyZSh7DQogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwNCiAgICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwNCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwNCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwNCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLA0KICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISINCiAgICAgICAgfSkNCiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7DQogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgICAucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfZWRpdF9kZWxldGVfdXJsKCksIHsNCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICBkYXRlOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX3Zpc2l0X3Nsb3Quc3BsaXQoIiAiKVswXSwNCiAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9pZDogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV9pZA0KICAgICAgICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0aGlzLmhpZGVfbW9kYWwoInNjaGVkdWxlX2RldGFpbHMiKQ0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiRGVsZXRlZCBTdWNjZXNzZnVsbHkiKSB7DQogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygNCiAgICAgICAgICAgICAgICAgICAgIllvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gZGVsZXRlZCBzdWNjZXNzZnVsbHkuIg0KICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlX3NjaGVkdWxlc19saXN0KCkNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7DQogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICAgIHRoaXMuaGlkZV9tb2RhbCgic2NoZWR1bGVfZGV0YWlscyIpDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSwNCiAgICByZW5kZXJfc2NoZWR1bGUgKGRhdGEpIHsNCiAgICAgIGxldCBzY2hlZHVsZSA9IFtdOw0KICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7DQogICAgICAgIGZvciAodmFyIGogaW4gZGF0YVtpXSkgew0KICAgICAgICAgIGlmIChqID09ICJIb2xpZGF5Iikgew0KICAgICAgICAgICAgc2NoZWR1bGUucHVzaCh7DQogICAgICAgICAgICAgIGlkOiBqLA0KICAgICAgICAgICAgICBjYWxlbmRhcklkOiAiMSIsDQogICAgICAgICAgICAgIHRpdGxlOiAiSG9saWRheSIsDQogICAgICAgICAgICAgIGNhdGVnb3J5OiAidGltZSIsDQogICAgICAgICAgICAgIGR1ZURhdGVDbGFzczogIiIsDQogICAgICAgICAgICAgIHJhdzogew0KICAgICAgICAgICAgICAgIHJlYXNvbjogZGF0YVtpXVtqXS5SZWFzb24sDQogICAgICAgICAgICAgICAgaXNIb2xpZGF5OiB0cnVlDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnNldF90aW1lX2ludGVydmFscyhpLCAiMDA6MDAiKSwNCiAgICAgICAgICAgICAgZW5kOiB0aGlzLnNldF90aW1lX2ludGVydmFscyhpLCAiMjM6NTkiKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNjaGVkdWxlLnB1c2goew0KICAgICAgICAgICAgICBpZDogaiwNCiAgICAgICAgICAgICAgY2FsZW5kYXJJZDogIjEiLA0KICAgICAgICAgICAgICB0aXRsZTogZGF0YVtpXVtqXS5WaXNpdG9yTmFtZSwNCiAgICAgICAgICAgICAgLy90aXRsZTogdGhpcy5jYWxlbmRhckluc3RhbmNlLnRlbXBsYXRlKCksDQogICAgICAgICAgICAgIGNhdGVnb3J5OiAidGltZSIsDQogICAgICAgICAgICAgIGR1ZURhdGVDbGFzczogIiIsDQogICAgICAgICAgICAgIHJhdzogew0KICAgICAgICAgICAgICAgIHBob25lX251bWJlcjogZGF0YVtpXVtqXS5QaG9uZU51bWJlciwNCiAgICAgICAgICAgICAgICByZWFzb246IGRhdGFbaV1bal0uVmlzaXRSZWFzb24sDQogICAgICAgICAgICAgICAgc3ltcHRvbXM6IGRhdGFbaV1bal0uU3ltcHRvbXMsDQogICAgICAgICAgICAgICAgdmlzaXRfc2xvdDogZGF0YVtpXVtqXS5WaXNpdFNsb3QsDQogICAgICAgICAgICAgICAgc3RhcnQ6IGRhdGFbaV1bal0uVmlzaXRTbG90LnNwbGl0KCIgIilbMV0uc3BsaXQoIi0iKVswXSwNCiAgICAgICAgICAgICAgICBlbmQ6IGRhdGFbaV1bal0uVmlzaXRTbG90LnNwbGl0KCIgIilbMV0uc3BsaXQoIi0iKVsxXSwNCiAgICAgICAgICAgICAgICBpc0hvbGlkYXk6IGZhbHNlLA0KICAgICAgICAgICAgICAgIGFwcG9pbnRtZW50X3N0YXR1czogZGF0YVtpXVtqXS5BcHBvaW50bWVudFN0YXR1cywNCiAgICAgICAgICAgICAgICB2aXNpdF9zdGF0dXM6IGRhdGFbaV1bal0uVmlzaXRTdGF0dXMsDQogICAgICAgICAgICAgICAgYXBwb2ludG1lbnRfaWQ6IGoNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgc3RhcnQ6IHRoaXMuc2V0X3RpbWVfaW50ZXJ2YWxzKA0KICAgICAgICAgICAgICAgIGRhdGFbaV1bal0uVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sDQogICAgICAgICAgICAgICAgZGF0YVtpXVtqXS5WaXNpdFNsb3Quc3BsaXQoIiAiKVsxXS5zcGxpdCgiLSIpWzBdDQogICAgICAgICAgICAgICksDQogICAgICAgICAgICAgIGVuZDogZGF0YVtpXVtqXS5WaXNpdFNsb3Quc3BsaXQoIiAiKVsxXS5zcGxpdCgiLSIpWzFdID09ICIwMDowMCINCiAgICAgICAgICAgICAgPyB0aGlzLnNldF90aW1lX2ludGVydmFscygNCiAgICAgICAgICAgICAgICAgIGRhdGFbaV1bal0uVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sDQogICAgICAgICAgICAgICAgICAiMjM6NTkiDQogICAgICAgICAgICAgICAgKTp0aGlzLnNldF90aW1lX2ludGVydmFscygNCiAgICAgICAgICAgICAgICAgIGRhdGFbaV1bal0uVmlzaXRTbG90LnNwbGl0KCIgIilbMF0sDQogICAgICAgICAgICAgICAgICBkYXRhW2ldW2pdLlZpc2l0U2xvdC5zcGxpdCgiICIpWzFdLnNwbGl0KCItIilbMV0NCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMuc2NoZWR1bGVfbGlzdCA9IHNjaGVkdWxlOw0KICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLmNsZWFyKCkNCiAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5jcmVhdGVTY2hlZHVsZXMoc2NoZWR1bGUpOw0KICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLnJlbmRlcigpOw0KICAgIH0sDQogICAgc2V0UmVuZGVyUmFuZ2VUZXh0ICgpIHsNCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICB2YXIgcmVuZGVyUmFuZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVuZGVyUmFuZ2UiKTsNCiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldE9wdGlvbnMoKTsNCiAgICAgIHZhciB2aWV3TmFtZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXRWaWV3TmFtZSgpOw0KICAgICAgdmFyIGh0bWwgPSBbXTsNCiAgICAgIGlmICgNCiAgICAgICAgKHZpZXdOYW1lID09PSAibW9udGgiICYmDQogICAgICAgICAgKCFvcHRpb25zLm1vbnRoLnZpc2libGVXZWVrc0NvdW50IHx8DQogICAgICAgICAgICBvcHRpb25zLm1vbnRoLnZpc2libGVXZWVrc0NvdW50ID4gNCkNCiAgICAgICAgICB8fCB2aWV3TmFtZSA9PT0gImRheSIpDQogICAgICApIHsNCiAgICAgICAgaHRtbC5wdXNoKA0KICAgICAgICAgIG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSkuZm9ybWF0KA0KICAgICAgICAgICAgIk1NTU0gWVlZWSINCiAgICAgICAgICApDQogICAgICAgICk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsZXQgc3RhcnREYXRlID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGVSYW5nZVN0YXJ0KCkuZ2V0VGltZSgpDQogICAgICAgIGxldCBlbmREYXRlID0gdGhpcy5jYWxlbmRhckluc3RhbmNlLmdldERhdGVSYW5nZUVuZCgpLmdldFRpbWUoKQ0KDQogICAgICAgIGlmIChtb21lbnQoZW5kRGF0ZSkuc3VidHJhY3Qoc3RhcnREYXRlLCAneWVhcicpKSB7DQogICAgICAgICAgaHRtbC5wdXNoKA0KICAgICAgICAgICAgYCR7bW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJEIE1NTU0gWVlZWSIpfSB0byAke21vbWVudChlbmREYXRlKS5mb3JtYXQoIkQgTU1NTSBZWVlZIil9YA0KICAgICAgICAgICk7DQogICAgICAgIH0gZWxzZSBpZiAobW9tZW50KGVuZERhdGUpLnN1YnRyYWN0KHN0YXJ0RGF0ZSwgJ21vbnRoJykpIHsNCiAgICAgICAgICBodG1sLnB1c2goDQogICAgICAgICAgICBgJHttb21lbnQoc3RhcnREYXRlKS5mb3JtYXQoIkQgTU1NTSIpfSB0byAke21vbWVudChlbmREYXRlKS5mb3JtYXQoIkQgTU1NTSBZWVlZIil9YA0KICAgICAgICAgICk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaHRtbC5wdXNoKA0KICAgICAgICAgICAgYCR7bW9tZW50KHN0YXJ0RGF0ZSkuZm9ybWF0KCJEIil9IHRvICR7bW9tZW50KGVuZERhdGUpLmZvcm1hdCgiRCBNTU1NIFlZWVkiKX1gDQogICAgICAgICAgKTsNCiAgICAgICAgfQ0KDQogICAgICB9DQogICAgICB0aGlzLmdlbmVyYXRlX2RheXNfaW5fbW9udGgobW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoJ0QnKSwgbW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoJ01NTU0nKSwgbW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoIllZWVkiKSkNCiAgICAgIHJlbmRlclJhbmdlLmlubmVySFRNTCA9IGh0bWwuam9pbigiIik7DQogICAgICB0aGlzLmRhaWx5X2RhdGUgPSByZW5kZXJSYW5nZS5pbm5lckhUTUw7DQogICAgfSwNCiAgICBkYXRlX2NvbmRpdGlvbiAoZnJvbV9vYmplY3QsIHRvX29iamVjdCkgew0KICAgICAgaWYgKGZyb21fb2JqZWN0ICE9PSBudWxsICYmIHRvX29iamVjdCAhPT0gbnVsbCkgew0KICAgICAgICBpZiAodG9fb2JqZWN0LmdldEZ1bGxZZWFyKCkgPiBmcm9tX29iamVjdC5nZXRGdWxsWWVhcigpKSB7DQogICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAodG9fb2JqZWN0LmdldEZ1bGxZZWFyKCkgPT0gZnJvbV9vYmplY3QuZ2V0RnVsbFllYXIoKSkgew0KICAgICAgICAgIGlmICh0b19vYmplY3QuZ2V0TW9udGgoKSA+IGZyb21fb2JqZWN0LmdldE1vbnRoKCkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgIH0gZWxzZSBpZiAodG9fb2JqZWN0LmdldE1vbnRoKCkgPT0gZnJvbV9vYmplY3QuZ2V0TW9udGgoKSkgew0KICAgICAgICAgICAgaWYgKE51bWJlcih0b19vYmplY3QuZ2V0RGF0ZSgpKSA+PSBOdW1iZXIoZnJvbV9vYmplY3QuZ2V0RGF0ZSgpKSkgew0KICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsNCiAgICAgIH0gZWxzZSBpZiAoZnJvbV9vYmplY3QgPT09IG51bGwgJiYgdG9fb2JqZWN0ID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICAgIHRvZ2dsZV92aWV3ICh0eXBlKSB7DQogICAgICBpZiAodHlwZSA9PSAiZGF5Iikgew0KICAgICAgICB0aGlzLnNob3dfY2hlY2tfYW5kX2NoYW5nZV9zdGF0dXMgPSB0cnVlOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5zaG93X2NoZWNrX2FuZF9jaGFuZ2Vfc3RhdHVzID0gZmFsc2U7DQogICAgICB9DQogICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuY2hhbmdlVmlldyh0eXBlLCB0cnVlKTsNCiAgICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7DQogICAgfSwNCiAgICBzd2l0Y2hfY2FsZW5kYXIgKHR5cGUsIGRhdGUpIHsNCiAgICAgIGlmICh0eXBlID09ICJ0b2RheSIpIHsNCiAgICAgICAgdGhpcy5jdXJyZW50X2NhbGVuZGFyX3ZpZXcgPSAiZGF5IjsNCiAgICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLnRvZGF5KCk7DQogICAgICAgIC8vIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7DQogICAgICB9IGVsc2UgaWYgKA0KICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJ3ZWVrIiB8fA0KICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJkYXkiDQogICAgICApIHsNCiAgICAgICAgaWYgKHR5cGUgPT0gIm5leHQiKSB7DQogICAgICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm5leHQoKTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJwcmV2Iikgew0KICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5wcmV2KCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodHlwZSA9PSAiY3VzdG9tIikgew0KICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5zZXREYXRlKG5ldyBEYXRlKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuc2V0RGF0ZShkYXRlKSkpDQogICAgICAgIH0NCiAgICAgICAgLy8gdGhpcy5zZXRSZW5kZXJSYW5nZVRleHQoKTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5jYWxlbmRhckluc3RhbmNlLl92aWV3TmFtZSA9PSAibW9udGgiKSB7DQogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsNCiAgICAgICAgaWYgKHR5cGUgPT0gIm5leHQiKSB7DQogICAgICAgICAgdGhpcy5jYWxlbmRhckluc3RhbmNlLm5leHQoKTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJwcmV2Iikgew0KICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5wcmV2KCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsNCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9pbmZvX3VybCgpLCB7DQogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICBmaXJzdF9kYXk6IHRoaXMubW9udGhfcmFuZ2UoInN0YXJ0X3RpbWUiKSwNCiAgICAgICAgICBsYXN0X2RheTogdGhpcy5tb250aF9yYW5nZSgiZW5kX3RpbWUiKQ0KICAgICAgICB9LA0KICAgICAgew0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgIHRoaXMucmVuZGVyX3NjaGVkdWxlKHJlc3BvbnNlLmRhdGEuU2NoZWR1bGluZ19pbmZvKTsNCiAgICAgICAgfSk7DQogICAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOw0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICB9LA0KICAgIG1vbnRoX3JhbmdlICh0eXBlKSB7DQogICAgICBsZXQgdGltZSA9IG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSk7DQogICAgICB0aW1lID0gbW9tZW50KHRpbWUpLmRheXNJbk1vbnRoKCk7DQogICAgICBpZiAodHlwZSA9PSAic3RhcnRfdGltZSIpIHsNCiAgICAgICAgbGV0IHN0YXJ0X3RpbWUgPSBudWxsOw0KICAgICAgICBpZih0aGlzLmNhbGVuZGFySW5zdGFuY2UuX3ZpZXdOYW1lID09ICJ3ZWVrIil7DQogICAgICAgICAgc3RhcnRfdGltZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fcmVuZGVyUmFuZ2Uuc3RhcnQuX2RhdGUNCiAgICAgICAgfWVsc2Ugew0KICAgICAgICAgIHN0YXJ0X3RpbWUgPSBuZXcgRGF0ZSgNCiAgICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuX2RhdGUuZ2V0RnVsbFllYXIoKSwNCiAgICAgICAgICAgIHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuX2RhdGUuZ2V0TW9udGgoKSwNCiAgICAgICAgICAgIDENCiAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICAgIHN0YXJ0X3RpbWUgPQ0KICAgICAgICAgIHN0YXJ0X3RpbWUuZ2V0RnVsbFllYXIoKSArDQogICAgICAgICAgIi0iICsNCiAgICAgICAgICAoc3RhcnRfdGltZS5nZXRNb250aCgpIDwgOQ0KICAgICAgICAgICAgPyAiMCIgKyAoc3RhcnRfdGltZS5nZXRNb250aCgpICsgMSkNCiAgICAgICAgICAgIDogc3RhcnRfdGltZS5nZXRNb250aCgpICsgMSkgKw0KICAgICAgICAgICItIiArDQogICAgICAgICAgKHN0YXJ0X3RpbWUuZ2V0RGF0ZSgpIDwgMTANCiAgICAgICAgICAgID8gIjAiICsgc3RhcnRfdGltZS5nZXREYXRlKCkNCiAgICAgICAgICAgIDogc3RhcnRfdGltZS5nZXREYXRlKCkpOw0KICAgICAgICByZXR1cm4gc3RhcnRfdGltZTsNCiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiZW5kX3RpbWUiKSB7DQogICAgICAgIGxldCBlbmRfdGltZSA9IG51bGw7DQogICAgICAgIGlmKHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fdmlld05hbWUgPT0gIndlZWsiKXsNCiAgICAgICAgICBlbmRfdGltZSA9IHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5fcmVuZGVyUmFuZ2UuZW5kLl9kYXRlDQogICAgICAgIH1lbHNlIHsNCiAgICAgICAgICAgIGVuZF90aW1lID0gbmV3IERhdGUoDQogICAgICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLl9kYXRlLmdldEZ1bGxZZWFyKCksDQogICAgICAgICAgICB0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLl9kYXRlLmdldE1vbnRoKCksDQogICAgICAgICAgICB0aW1lDQogICAgICAgICAgKTsNCiAgICAgICAgfQ0KICAgICAgICBlbmRfdGltZSA9DQogICAgICAgICAgZW5kX3RpbWUuZ2V0RnVsbFllYXIoKSArDQogICAgICAgICAgIi0iICsNCiAgICAgICAgICAoZW5kX3RpbWUuZ2V0TW9udGgoKSA8IDkNCiAgICAgICAgICAgID8gIjAiICsgKGVuZF90aW1lLmdldE1vbnRoKCkgKyAxKQ0KICAgICAgICAgICAgOiBlbmRfdGltZS5nZXRNb250aCgpICsgMSkgKw0KICAgICAgICAgICItIiArDQogICAgICAgICAgKGVuZF90aW1lLmdldERhdGUoKSA8IDEwDQogICAgICAgICAgICA/ICIwIiArIGVuZF90aW1lLmdldERhdGUoKQ0KICAgICAgICAgICAgOiBlbmRfdGltZS5nZXREYXRlKCkpOw0KICAgICAgICByZXR1cm4gZW5kX3RpbWU7DQogICAgICB9DQogICAgfSwNCiAgICBnZW5lcmF0ZV9kYXlzX2luX21vbnRoIChkYXksIG1vbnRoLCB5ZWFyKSB7DQogICAgICBsZXQgdG90YWxfZGF5cyA9IG1vbWVudChgJHttb250aH0gJHt5ZWFyfWAsIFsnTU1NTSBZWVlZJ10pLmRheXNJbk1vbnRoKCkNCiAgICAgIHRoaXMuZGF5c0luTW9udGggPSBbXQ0KICAgICAgZm9yIChsZXQgaSA9IDEsIG4gPSB0b3RhbF9kYXlzOyBpIDw9IG47IGkrKykgew0KICAgICAgICB0aGlzLmRheXNJbk1vbnRoLnB1c2goew0KICAgICAgICAgIGRheTogbW9tZW50KGAke2l9ICR7bW9udGh9ICR7eWVhcn1gLCBbJ0QgTU1NTSBZWVlZJ10pLmZvcm1hdCgnZGQnKSwNCiAgICAgICAgICBkYXRlOiBpLA0KICAgICAgICAgIGlzX2FjdGl2ZTogbW9tZW50KGAke2RheX0gJHttb250aH0gJHt5ZWFyfWAsIFsnRCBNTU1NIFlZWVknXSkuaXNTYW1lKG1vbWVudChgJHtpfSAke21vbnRofSAke3llYXJ9YCwgWydEIE1NTU0gWVlZWSddKSwgJ2RheScpDQogICAgICAgIH0pDQogICAgICB9DQogICAgfSwNCiAgICBzZXRfdGltZV9pbnRlcnZhbHMgKHllYXIsIHRpbWUpIHsNCiAgICAgIHZhciB2bSA9IG5ldyBEYXRlKA0KICAgICAgICB5ZWFyLnNwbGl0KCItIilbMF0sDQogICAgICAgIHllYXIuc3BsaXQoIi0iKVsxXSAtIDEsDQogICAgICAgIHllYXIuc3BsaXQoIi0iKVsyXSwNCiAgICAgICAgdGltZS5zcGxpdCgiOiIpWzBdLA0KICAgICAgICB0aW1lLnNwbGl0KCI6IilbMV0NCiAgICAgICk7DQogICAgICB2bSA9IG1vbWVudCh2bSkuZm9ybWF0KCk7DQogICAgICByZXR1cm4gdm07DQogICAgfSwNCiAgICBvcGVuQ2hlY2tBbmRDaGFuZ2VTdGF0dXNNb2RhbCAoQXBwb2ludG1lbnRJRCwgc2NoZWR1bGVEYXRlKSB7DQogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICAvLyB2YXIgZGF0ZVRvU2VuZCA9IG1vbWVudCh0aGlzLmNhbGVuZGFySW5zdGFuY2UuZ2V0RGF0ZSgpLmdldFRpbWUoKSkuZm9ybWF0KA0KICAgICAgLy8gICAiWVlZWS1NTS1ERCINCiAgICAgIC8vICk7DQoNCiAgICAgIHZhciBkYXRlVG9TZW5kID0gbW9tZW50KHNjaGVkdWxlRGF0ZSkuZm9ybWF0KA0KICAgICAgICAiWVlZWS1NTS1ERCINCiAgICAgICk7DQoNCiAgICAgIC8vIHZhciBkYXRlb2JqID0gbmV3IERhdGUobW9tZW50KHRoaXMuY2FsZW5kYXJJbnN0YW5jZS5nZXREYXRlKCkuZ2V0VGltZSgpKS5mb3JtYXQoIk1NTU0gREQsIFlZWVkiKSk7DQogICAgICBheGlvcw0KICAgICAgICAucG9zdChhcGlfY2FsbHMudmlzaXRfc3RhdHVzX2luZm8oKSwgew0KICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwNCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgZGF0ZTogZGF0ZVRvU2VuZCwNCiAgICAgICAgICBpc19nZXQ6IHRydWUNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5sZW5ndGggIT0gMCkgew0KICAgICAgICAgICAgbGV0IGFwcG9pbnRtZW50RmlsdGVyID0gcmVzcG9uc2UuZGF0YS5kYXRhLmZpbHRlcihhcHB0ID0+IHsNCiAgICAgICAgICAgICAgcmV0dXJuIGFwcHRbIkFwcG9pbnRtZW50SUQiXSA9PSBBcHBvaW50bWVudElEDQogICAgICAgICAgICB9KQ0KDQogICAgICAgICAgICBpZiAoYXBwb2ludG1lbnRGaWx0ZXIubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgIHRoaXMudmlzaXRTdGF0dXMgPSBhcHBvaW50bWVudEZpbHRlclswXVsiVmlzaXRTdGF0dXMiXQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOw0KICAgICAgICAgICAgdmFyIGNvbmZpcm1lZF9hcHB0ID0gW107DQogICAgICAgICAgICB2YXIgbm9uZV9hcHB0ID0gW107DQogICAgICAgICAgICB2YXIgcmVzY2hlZHVsZV9hcHB0ID0gW107DQogICAgICAgICAgICB2YXIgZGVsZXRlZF9hcHB0ID0gW107DQoNCiAgICAgICAgICAgIC8vIHRoaXMudmlzaXRfc3RhdHVzX2NvbXBhcmlzb25fZGF0YSA9IHRoaXMudmlzaXRfc3RhdHVzX2RhdGEuc2xpY2UoKTsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc2NoZWR1bGVfbGlzdC5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgIC8vIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkNvbXBhcmVWaXNpdFN0YXR1cyJdID0NCiAgICAgICAgICAgICAgICAvLyAgIHJlc3BvbnNlLmRhdGEuZGF0YVtpXS5WaXNpdFN0YXR1czsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudElEID09PSB0aGlzLnNjaGVkdWxlX2xpc3Rbal0uaWQpIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkFwcG9pbnRtZW50U3RhdHVzIl0gPSB0aGlzLnNjaGVkdWxlX2xpc3Rbal0ucmF3LmFwcG9pbnRtZW50X3N0YXR1cw0KICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkFwcG9pbnRtZW50U3RhdHVzIl0gPT09ICdjb25maXJtZWQnKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1lZF9hcHB0LnB1c2godGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXSkNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJBcHBvaW50bWVudFN0YXR1cyJdID09PSAnbm9uZScpIHsNCiAgICAgICAgICAgICAgICAgICAgbm9uZV9hcHB0LnB1c2godGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXSkNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldWyJBcHBvaW50bWVudFN0YXR1cyJdID09PSAncmVzY2hlZHVsZWQnKSB7DQogICAgICAgICAgICAgICAgICAgIHJlc2NoZWR1bGVfYXBwdC5wdXNoKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0pDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAodGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXVsiQXBwb2ludG1lbnRTdGF0dXMiXSA9PT0gJ2RlbGV0ZWQnKSB7DQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRfYXBwdC5wdXNoKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0pDQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhID0gW107DQogICAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSBub25lX2FwcHQ7DQogICAgICAgICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSArPSBjb25maXJtZWRfYXBwdDsNCiAgICAgICAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhICs9IHJlc2NoZWR1bGVfYXBwdDsNCiAgICAgICAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhICs9IGRlbGV0ZWRfYXBwdDsNCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyB0aGlzLnZpc2l0X3N0YXR1c19jb21wYXJpc29uX2RhdGEucHVzaChyZXNwb25zZS5kYXRhLmRhdGFbaV0pOw0KICAgICAgICAgICAgICAgIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV1bIkNvbXBhcmVWaXNpdFN0YXR1cyJdID0NCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YVtpXS5WaXNpdFN0YXR1czsNCg0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhID0gW107DQogICAgICAgICAgICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhID0gdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5jb25jYXQobm9uZV9hcHB0LCBjb25maXJtZWRfYXBwdCwgcmVzY2hlZHVsZV9hcHB0LCBkZWxldGVkX2FwcHQpOw0KICAgICAgICAgICAgLy8gIHRoaXMudmlzaXRfc3RhdHVzX2RhdGEuY29uY2F0KCBjb25maXJtZWRfYXBwdCk7DQogICAgICAgICAgICAvLyAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5jb25jYXQocmVzY2hlZHVsZV9hcHB0KTsNCiAgICAgICAgICAgIC8vICB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmNvbmNhdChkZWxldGVkX2FwcHQpOw0KDQogICAgICAgICAgICAvLyAkKCcjcGF0aWVudGRhdGFtb2RlbCcpLm1vZGFsKCdzaG93Jyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09PSAnTm8gQXBwb2ludG1lbnRzIFNjaGVkdWxlZCcgfHwgcmVzcG9uc2UuZGF0YS5kYXRhLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy52aXNpdF9zdGF0dXNfZGF0YSA9IFtdOw0KICAgICAgICAgICAgc3dhbA0KICAgICAgICAgICAgICAuZmlyZSh7DQogICAgICAgICAgICAgICAgdGV4dDogIk5vIEFwcG9pbnRtZW50cyBoYXZlIGJlZW4gc2NoZWR1bGVkIGZvciAiICsgIiAiICsgdGhpcy5kYWlseV9kYXRlLA0KICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwNCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLA0KICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiT2theSINCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLmhpZGVfbW9kYWwoJ3BhdGllbnRkYXRhbW9kZWwnKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KDQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaChlcnIgPT4gew0KICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKQ0KICAgICAgICB9KQ0KICAgICAgICA7DQogICAgfSwNCiAgICBjaGFuZ2VTaW5nbGVWaXNpdFN0YXR1cygpew0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIHZhciBkYXRlVG9TZW5kID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsNCiAgICAgIHZhciBmb3JtTGVuZ3RoID0gdGhpcy52aXNpdF9zdGF0dXNfZGF0YS5sZW5ndGg7DQogICAgICB2YXIgYXJyYXkgPSBbXTsNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybUxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmKHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRJRCA9PT0gdGhpcy5BcHBvaW50bWVudElEKXsNCiAgICAgICAgYXJyYXkucHVzaCh7DQogICAgICAgICAgICBBcHBvaW50bWVudElEOiB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLkFwcG9pbnRtZW50SUQsDQogICAgICAgICAgICBWaXNpdG9yTmFtZTogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdG9yTmFtZSwNCiAgICAgICAgICAgIFZpc2l0U2xvdDogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5WaXNpdFNsb3QsDQogICAgICAgICAgICBBcHBvaW50bWVudFN0YXR1czogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudFN0YXR1cywNCiAgICAgICAgICAgIFZpc2l0U3RhdHVzOiB0aGlzLnZpc2l0U3RhdHVzDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChhcnJheS5sZW5ndGggPiAwKSB7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnZpc2l0X3N0YXR1c19pbmZvKCksIHsNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgIHJlc3BvbnNlX3Zpc2l0X3N0YXR1czogYXJyYXksDQogICAgICAgICAgICBpc19lZGl0OiB0cnVlLA0KICAgICAgICAgICAgZGF0ZTogZGF0ZVRvU2VuZA0KICAgICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiVmlzaXQgU3RhdHVzIEVkaXRlZCIpIHsNCiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIlZpc2l0IFN0YXR1cyBDaGFuZ2VkIFN1Y2Nlc3NmdWxseSIpDQogICAgICAgICAgICAgIHRoaXMuaGlkZV9tb2RhbCgncGF0aWVudGRhdGFtb2RlbCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZCIpDQogICAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZCIpDQogICAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCiAgICBjaGFuZ2VWaXNpdFN0YXR1cyAoKSB7DQogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIGRhdGVUb1NlbmQgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOw0KICAgICAgdmFyIGZvcm1MZW5ndGggPSB0aGlzLnZpc2l0X3N0YXR1c19kYXRhLmxlbmd0aDsNCiAgICAgIHZhciBhcnJheSA9IFtdOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JtTGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKA0KICAgICAgICAgIHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQ29tcGFyZVZpc2l0U3RhdHVzID09PQ0KICAgICAgICAgIHRoaXMudmlzaXRTdGF0dXMNCiAgICAgICAgICAvLyB0aGlzLnZpc2l0X3N0YXR1c19kYXRhW2ldLlZpc2l0U3RhdHVzDQogICAgICAgICkgew0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGFycmF5LnB1c2goew0KICAgICAgICAgICAgQXBwb2ludG1lbnRJRDogdGhpcy52aXNpdF9zdGF0dXNfZGF0YVtpXS5BcHBvaW50bWVudElELA0KICAgICAgICAgICAgVmlzaXRvck5hbWU6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRvck5hbWUsDQogICAgICAgICAgICBWaXNpdFNsb3Q6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRTbG90LA0KICAgICAgICAgICAgQXBwb2ludG1lbnRTdGF0dXM6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uQXBwb2ludG1lbnRTdGF0dXMsDQogICAgICAgICAgICBWaXNpdFN0YXR1czogdGhpcy52aXNpdFN0YXR1cw0KICAgICAgICAgICAgLy8gVmlzaXRTdGF0dXM6IHRoaXMudmlzaXRfc3RhdHVzX2RhdGFbaV0uVmlzaXRTdGF0dXMNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdChhcGlfY2FsbHMudmlzaXRfc3RhdHVzX2luZm8oKSwgew0KICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgcmVzcG9uc2VfdmlzaXRfc3RhdHVzOiBhcnJheSwNCiAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsDQogICAgICAgICAgICBkYXRlOiBkYXRlVG9TZW5kDQogICAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJWaXNpdCBTdGF0dXMgRWRpdGVkIikgew0KICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiVmlzaXQgU3RhdHVzIENoYW5nZWQgU3VjY2Vzc2Z1bGx5IikNCiAgICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCdwYXRpZW50ZGF0YW1vZGVsJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIikNCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGNvbmZpcm1SZXNjaGVkdWxlICgpIHsNCiAgICAgIGNvbnN0IGlzX2ludmFsaWQgPSAobW9tZW50KHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlLCBbJ01NLURELVlZWVknXSkNCiAgICAgICAgLmRpZmYobW9tZW50KCQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWUsIFsnWVlZWS1NTS1ERCddKSwgImRheSIpID09PSAwKQ0KICAgICAgICAmJiAodGhpcy50ZW1wX2FwcG9pbnRtZW50X3RpbWUgPT0gdGhpcy5zZWxlY3RlZF90aW1lKTsNCiAgICAgIGlmIChpc19pbnZhbGlkKSB7DQogICAgICAgIHN3YWwNCiAgICAgICAgICAuZmlyZSh7DQogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgICB0ZXh0OiAiSXQgbG9va3MgbGlrZSB5b3UgaGF2ZSBub3QgbWFkZSBhbnkgY2hhbmdlIHRvIHRoZSBhcHBvaW50bWVudCBkYXRlIGFuZCBhcHBvaW50bWVudCB0aW1lIiwNCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLA0KICAgICAgICAgICAgdGltZXI6OTAwMCwNCiAgICAgICAgICB9KS50aGVuKHJlc3VsdCA9PiB7DQogICAgICAgICAgfSk7DQogICAgICB9DQogICAgICBpZiAoDQogICAgICAgIHRoaXMuZmlsbGVkX3RpbWVfc2xvdHNfc2VsZWN0ZWRfZGF0ZS5pbmNsdWRlcyh0aGlzLnNlbGVjdGVkX3RpbWUpIHx8IHRoaXMuc2VsZWN0ZWRfdGltZSA9PSAiIg0KICAgICAgKSB7DQogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgcmVxdWlyZWQgZmllbGRzLiIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgICB2YXIgZGF0ZVNlbGVjdGVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRhdGVwaWNrZXItaW5wdXQiKS52YWx1ZTsNCiAgICAgICAgdmFyIHByZXZpb3VzRGF0ZSA9IG1vbWVudCh0aGlzLnRlbXBfYXBwb2ludG1lbnRfZGF0ZSwgWydNTS1ERC1ZWVlZJ10pLmZvcm1hdCgnWVlZWS1NTS1ERCcpOw0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy5yZXNjaGVkdWxlX2FwcG9pbnRtZW50KCksIHsNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLA0KICAgICAgICAgICAgdmlzaXRvcl9uYW1lOiB0aGlzLnBhdGllbnRfbmFtZSwNCiAgICAgICAgICAgIHZpc2l0X3JlYXNvbjogdGhpcy52aXNpdF9yZWFzb24sDQogICAgICAgICAgICB2aXNpdF9zbG90OiB0aGlzLnNlbGVjdGVkX3RpbWUsDQogICAgICAgICAgICBzeW1wdG9tczogdGhpcy52aXNpdG9yX3N5bXB0b21zLA0KICAgICAgICAgICAgdmlzaXRfZGF0ZTogZGF0ZVNlbGVjdGVkLA0KICAgICAgICAgICAgcHJldmlvdXNfdmlzaXRfZGF0ZTogcHJldmlvdXNEYXRlLA0KICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICBhcHBvaW50bWVudF9pZDogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV9pZA0KICAgICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgLy8gdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsaW5nX21vZGFsIikNCiAgICAgICAgICAgIHRoaXMuZWRpdF9zY2hlZHVsaW5nID0gZmFsc2UNCiAgICAgICAgICAgIHRoaXMuaGlkZV9tb2RhbCgic2NoZWR1bGVfY3JlYXRlIikNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiQXBwb2ludG1lbnQgUmVzY2hlZHVsZWQgU3VjY2Vzc2Z1bGx5Iikgew0KICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiQXBwb2ludG1lbnQgSGFzIEJlZW4gUmVzY2hlZHVsZWQgU3VjY2Vzc2Z1bGx5Iik7DQogICAgICAgICAgICAgIHRoaXMudXBkYXRlX3NjaGVkdWxlc19saXN0KCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWV0aGluZyBXZW50IFdyb25nIik7DQogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOw0KICAgICAgICAgICAgICB9LCAxMDAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJTb21lIEVycm9yIE9jY3VycmVkIik7DQogICAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCiAgICBrZWVwY2hlY2tpbmdkYXRlICgpIHsNCiAgICAgIHZhciB2bSA9IHRoaXM7DQogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICB0aGlzLmRhdGVwaWNrZXJJbnN0YW5jZS5vbigiY2xvc2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIC8vIHZtLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICAgIHZtLmNoZWNrZGF0ZSgpOw0KICAgICAgfSk7DQogICAgfSwNCiAgICBjaGVja2RhdGUgKCkgew0KICAgICAgLy9ldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIGR0ID0gbmV3IERhdGUoKTsNCiAgICAgIGlmICh0aGlzLmRhdGVfY29uZGl0aW9uKGR0LCBuZXcgRGF0ZSgkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlKSkpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZF9kYXRlID0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZTsNCiAgICAgICAgdmFyIHN0YXJ0X2RhdGUgPSAkKCIjZGF0ZXBpY2tlci1pbnB1dCIpWzBdLnZhbHVlOw0KICAgICAgICB2YXIgc2VsZWN0ZWRfdGltZSA9IHRoaXMuc2VsZWN0ZWRfdGltZQ0KICAgICAgICB2YXIgdGltZSA9DQogICAgICAgICAgZHQuZ2V0SG91cnMoKSArICI6IiArIGR0LmdldE1pbnV0ZXMoKSArICI6IiArIGR0LmdldFNlY29uZHMoKTsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdChhcGlfY2FsbHMuc2NoZWR1bGVfdXJsKCksIHsNCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLnZpc2l0b3JfbnVtYmVyLA0KICAgICAgICAgICAgRGF0ZTogdGhpcy5zZWxlY3RlZF9kYXRlLA0KICAgICAgICAgICAgYXBwb2ludG1lbnRfZGF0ZTogdGhpcy5zZWxlY3RlZF9kYXRlLA0KICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbA0KICAgICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgdGhpcy5uZXdfc2VsZWN0ZWRfZGF0ZSA9ICQoIiNkYXRlcGlja2VyLWlucHV0IilbMF0udmFsdWU7DQogICAgICAgICAgICAvLyAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMuc2VsZWN0ZWRfZGF0ZTsNCg0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gbnVsbCkgew0KICAgICAgICAgICAgfSBlbHNlIGlmICgNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIlBsZWFzZSB1cGRhdGUgeW91ciBzY2hlZHVsZXIgc2V0dGluZ3MiDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgdXBkYXRlIHlvdXIgc2NoZWR1bGVyIHNldHRpbmdzIik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubXNnID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAvLyBpZiAocmVzcG9uc2UuZGF0YS5GdWxsVGltZVNsb3QgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIC8vICAgdmFyIGR0ID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgICAgLy8gICB0aGlzLmZ1bGxfdGltZV9zbG90cyA9IFtdOw0KICAgICAgICAgICAgICAvLyAgIHRoaXMudGltZV9zbG90cyA9IFtdOw0KICAgICAgICAgICAgICAvLyAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy5mdWxsX3RpbWVfc2xvdHMpIHsNCiAgICAgICAgICAgICAgLy8gICAvLyAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgIC8vICAgLy8gICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLkZ1bGxUaW1lU2xvdFtpXSwNCiAgICAgICAgICAgICAgLy8gICAvLyAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAvLyAgIC8vICAgICAgIHJlc3BvbnNlLmRhdGEuRnVsbFRpbWVTbG90W2ldLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgIC8vICAgLy8gICAgICAgcmVzcG9uc2UuZGF0YS5GdWxsVGltZVNsb3RbaV0uc3BsaXQoIi0iKVsxXQ0KICAgICAgICAgICAgICAvLyAgIC8vICAgICApDQogICAgICAgICAgICAgIC8vICAgLy8gICAgIH0pOw0KICAgICAgICAgICAgICAvLyAgIC8vICAgaWYgKA0KICAgICAgICAgICAgICAvLyAgIC8vICAgICByZXNwb25zZS5kYXRhLkF2YWlsYWJsZVRpbWVTbG90LmluZGV4T2YoDQogICAgICAgICAgICAgIC8vICAgLy8gICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0udmFsdWUNCiAgICAgICAgICAgICAgLy8gICAvLyAgICAgKSA9PSAtMQ0KICAgICAgICAgICAgICAvLyAgIC8vICAgKSB7DQogICAgICAgICAgICAgIC8vICAgLy8gICAgIHRoaXMudGltZV9zbG90cy5wdXNoKHRoaXMuZnVsbF90aW1lX3Nsb3RzW2ldKTsNCiAgICAgICAgICAgICAgLy8gICAvLyAgIH0NCiAgICAgICAgICAgICAgLy8gICAvLyB9DQogICAgICAgICAgICAgIC8vICAgICBmb3IodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90cyl7DQogICAgICAgICAgICAgIC8vICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goew0KICAgICAgICAgICAgICAvLyAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLA0KICAgICAgICAgICAgICAvLyAgICAgICAgIHRleHQ6IHRoaXMuZ2VuZXJhdGVfdGltZSgNCiAgICAgICAgICAgICAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5hdmFpbGFibGVfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzFdDQogICAgICAgICAgICAgIC8vICAgICAgICAgKQ0KICAgICAgICAgICAgICAvLyAgICAgICB9KQ0KICAgICAgICAgICAgICAvLyAgICAgfQ0KICAgICAgICAgICAgICAvLyAgICAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMuc2VsZWN0ZWRfZGF0ZQ0KDQogICAgICAgICAgICAgIC8vIH0NCg0KICAgICAgICAgICAgICB0aGlzLmlzUmVzY2hlZHVsZXRpbWUgPSB0cnVlOw0KICAgICAgICAgICAgICB0aGlzLmZ1bGxfdGltZV9zbG90cyA9IFtdOw0KICAgICAgICAgICAgICB0aGlzLnRpbWVfc2xvdHMgPSBbXTsNCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMgPSBbXTsNCiAgICAgICAgICAgICAgICB2YXIgZ2V0X2Z1bGxfc2xvdF9saXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB2YXIgdGVtcF9zdGFydF9kYXRlID0gbmV3IERhdGUoc3RhcnRfZGF0ZSk7DQogICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRGdWxsWWVhcigpID4gZHQuZ2V0RnVsbFllYXIoKSkgew0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgPT0gZHQuZ2V0RnVsbFllYXIoKSkgew0KICAgICAgICAgICAgICAgICAgaWYgKHRlbXBfc3RhcnRfZGF0ZS5nZXRNb250aCgpID4gZHQuZ2V0TW9udGgoKSkgew0KICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0TW9udGgoKSA9PSBkdC5nZXRNb250aCgpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wX3N0YXJ0X2RhdGUuZ2V0RGF0ZSgpID4gZHQuZ2V0RGF0ZSgpKSB7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcF9zdGFydF9kYXRlLmdldERhdGUoKSA9PSBkdC5nZXREYXRlKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICBnZXRfZnVsbF9zbG90X2xpc3QgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoZ2V0X2Z1bGxfc2xvdF9saXN0KSB7DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXSwNCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmdlbmVyYXRlX3RpbWUoDQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZ1bGxfdGltZV9zbG90c1tpXS5zcGxpdCgiLSIpWzBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0uc3BsaXQoIi0iKVsxXQ0KICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICAgIGR0LmdldEhvdXJzKCkgPA0KICAgICAgICAgICAgICAgICAgICAgIE51bWJlcigNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXQ0KICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcmVzcG9uc2UuZGF0YS5mdWxsX3RpbWVfc2xvdHNbaV0sDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLmdlbmVyYXRlX3RpbWUoDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZnVsbF90aW1lX3Nsb3RzW2ldLnNwbGl0KCItIilbMV0NCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBpZiAoc2VsZWN0ZWRfdGltZSAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAvLyAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgLy8gICB0aGlzLnNlbGVjdGVkX3RpbWUgPSBzZWxlY3RlZF90aW1lOw0KICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zY2hlZHVsZWRfdGltZSA9IHRoaXMuZ2VuZXJhdGVfdGltZSgNCiAgICAgICAgICAgICAgICAvLyAgICAgc2VsZWN0ZWRfdGltZS5zcGxpdCgiLSIpWzBdLA0KICAgICAgICAgICAgICAgIC8vICAgICBzZWxlY3RlZF90aW1lLnNwbGl0KCItIilbMV0NCiAgICAgICAgICAgICAgICAvLyAgICk7DQogICAgICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChzZWxlY3RlZF90aW1lID09IHVuZGVmaW5lZCkgew0KDQogICAgICAgICAgICAgICAgdGhpcy5maWxsZWRfdGltZV9zbG90c19zZWxlY3RlZF9kYXRlID0gcmVzcG9uc2UuZGF0YS5maWxsZWRfdGltZV9zbG90czsNCg0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLnRpbWVfc2xvdHMgPSB0aGlzLmZ1bGxfdGltZV9zbG90czsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgdGhpcy50aW1lX3Nsb3RzID0gW107DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuZnVsbF90aW1lX3Nsb3RzKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZpbGxlZF90aW1lX3Nsb3RzLmluZGV4T2YoDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZ1bGxfdGltZV9zbG90c1tpXS52YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICkgPT0gLTENCiAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgdGhpcy50aW1lX3Nsb3RzLnB1c2godGhpcy5mdWxsX3RpbWVfc2xvdHNbaV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAvLyB0aGlzLnRpbWVfc2xvdHMgPSByZXNwb25zZS5kYXRhLmF2YWlsYWJsZV90aW1lX3Nsb3RzOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvL30NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgQSBWYWxpZCBEYXRlIik7DQogICAgICAgIHRoaXMuZGF0ZXBpY2tlckluc3RhbmNlLm9wZW4oKTsNCiAgICAgICAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMubmV3X3NlbGVjdGVkX2RhdGU7DQogICAgICB9DQogICAgfSwNCiAgICBzZW5kX3JlbWluZGVyIChBcHBvaW50bWVudElEKSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgc3dhbA0KICAgICAgICAuZmlyZSh7DQogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwNCiAgICAgICAgICB0ZXh0OiAiIFlvdSB3YW50IHRvIFNlbmQgdGhlIFJlbWluZGVyIiwNCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwNCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwNCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLA0KICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBTZW5kISEiDQogICAgICAgIH0pDQogICAgICAgIC50aGVuKHJlc3VsdCA9PiB7DQogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgew0KICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgICAgICAgLy8gdmFyIHRvZGF5c19kYXRlID0gdGhpcy5kYWlseV9kYXRlOw0KICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSh0aGlzLnRlbXBfYXBwb2ludG1lbnRfZGF0ZSk7DQogICAgICAgICAgICB2YXIgcHJldmlvdXNEYXRlID0NCiAgICAgICAgICAgICAgZC5nZXRGdWxsWWVhcigpICsgIi0iICsgKGQuZ2V0TW9udGgoKSArIDEpICsgIi0iICsgZC5nZXREYXRlKCk7DQogICAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgICAucG9zdChhcGlfY2FsbHMuc2VuZF9yZW1pbmRlcigpLCB7DQogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9pZDogQXBwb2ludG1lbnRJRCwNCiAgICAgICAgICAgICAgICBkYXRlOiBwcmV2aW91c0RhdGUsDQogICAgICAgICAgICAgICAgdmlzaXRfc2xvdDogdGhpcy5kaXNwbGF5X3NlbGVjdGVkX3RpbWUNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7DQogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2VzcyA9PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiTm90aWZpY2F0aW9uIEhhcyBiZWVuIHNlbnQiKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN1Y2Nlc3MgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiQ291bGQgTm90IFNlbmQgTm90aWZpY2F0aW9uIikNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgY29uZmlybUFwcG9pbnRtZW50ICgpIHsNCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICBjb25zdCBpc19pbnZhbGlkID0gbW9tZW50KCkuZGlmZihtb21lbnQoYCR7dGhpcy50ZW1wX2FwcG9pbnRtZW50X3RpbWV9ICR7dGhpcy50ZW1wX2FwcG9pbnRtZW50X2RhdGV9YCwgWydISDptbSBNTS1ERC1ZWVlZJ10pLCAibWludXRlIikgPj0gMDsNCiAgICAgIC8vIGlmICgodGhpcy50ZW1wX2FwcG9pbnRtZW50X2RhdGUgIT0gJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSkgfHwgdGhpcy50ZW1wX2FwcG9pbnRtZW50X3RpbWUgIT0gdGhpcy5zZWxlY3RlZF90aW1lKSB7DQogICAgICBpZiAoaXNfaW52YWxpZCkgew0KICAgICAgICBzd2FsDQogICAgICAgICAgLmZpcmUoew0KICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLA0KICAgICAgICAgICAgdGV4dDogIkl0IGxvb2tzIGxpa2UgeW91IGhhdmUgbWFkZSBjaGFuZ2UgdG8gdGhlIGFwcG9pbnRtZW50IGRhdGUgYW5kIGFwcG9pbnRtZW50IHRpbWUsIHNvIHBsZWFzZSByZXNjaGVkdWxlIHRoZSBhcHBvaW50bWVudCBmaXJzdCIsDQogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwNCiAgICAgICAgICAgIHRpbWVyOjUwMDAsDQogICAgICAgICAgfSkudGhlbihyZXN1bHQgPT4gew0KICAgICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIHN3YWwNCiAgICAgICAgICAuZmlyZSh7DQogICAgICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLA0KICAgICAgICAgICAgdGV4dDogIiBZb3Ugd2FudCB0byBDb25maXJtIHRoZSBBcHBwb2ludG1lbnQ/IFRoaXMgd2lsbCBzZW5kIGEgbWVzc2FnZSB0byB0aGUgcGF0aWVudCIsDQogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsDQogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLA0KICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsDQogICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLA0KICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIg0KICAgICAgICAgIH0pDQogICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHsNCiAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsNCiAgICAgICAgICAgICAgaWYgKCh0aGlzLnRlbXBfbmFtZSAhPSB0aGlzLnBhdGllbnRfbmFtZSkgfHwgKHRoaXMudGVtcF9yZWFzb24gIT0gdGhpcy52aXNpdF9yZWFzb24pIHx8ICh0aGlzLnRlbXBfc3ltcHRvbXMgIT0gdGhpcy52aXNpdG9yX3N5bXB0b21zKSkgew0KICAgICAgICAgICAgICAgIC8vIGFsZXJ0KCJIaSIpOw0KICAgICAgICAgICAgICAgIGxldCBhcHBvaW50bWVudF9wYXlsb2FkID0gew0KICAgICAgICAgICAgICAgICAgVmlzaXRvck5hbWU6IHRoaXMucGF0aWVudF9uYW1lLA0KICAgICAgICAgICAgICAgICAgVmlzaXRSZWFzb246IHRoaXMudmlzaXRfcmVhc29uLA0KICAgICAgICAgICAgICAgICAgU3ltcHRvbXM6IHRoaXMudmlzaXRvcl9zeW1wdG9tcywNCiAgICAgICAgICAgICAgICAgIFZpc2l0U2xvdDogdGhpcy5zZWxlY3RlZF90aW1lLA0KICAgICAgICAgICAgICAgICAgUGhvbmVOdW1iZXI6IHRoaXMudmlzaXRvcl9udW1iZXIsDQogICAgICAgICAgICAgICAgICBWaXNpdERhdGU6IHRoaXMuc2VsZWN0ZWRfc2NoZWR1bGVfdmlzaXRfc2xvdC5zcGxpdCgiICIpWzBdDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7DQogICAgICAgICAgICAgICAgYXhpb3MNCiAgICAgICAgICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy5zY2hlZHVsZV9lZGl0X2RlbGV0ZV91cmwoKSwgew0KICAgICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogdGhpcy5zZWxlY3RlZF9zY2hlZHVsZV92aXNpdF9zbG90LnNwbGl0KCIgIilbMF0sDQogICAgICAgICAgICAgICAgICAgIGlzX2VkaXQ6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX2lkLA0KICAgICAgICAgICAgICAgICAgICBhcHBvaW50bWVudF9pbmZvOiBhcHBvaW50bWVudF9wYXlsb2FkDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tc2cgIT0gdW5kZWZpbmVkICYmDQogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tc2cgPT0gIkVkaXQgQXBwb2ludG1lbnQiDQogICAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIGFwcG9pbnRtZW50IGhhcyBiZWVuIGVkaXRlZCBzdWNjZXNzZnVsbHkuIik7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsNCiAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICAgICAgICAgICAgICAgICQoIiNzY2hlZHVsZV9kZXRhaWxzIikubW9kYWwoImhpZGUiKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgICAgICAgJCgiI3NjaGVkdWxlX2RldGFpbHMiKS5tb2RhbCgiaGlkZSIpOw0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOw0KICAgICAgICAgICAgICB2YXIgZGF0ZVNlbGVjdGVkID0gbW9tZW50KHRoaXMudGVtcF9hcHBvaW50bWVudF9kYXRlLCBbJ01NLURELVlZWVknXSkuZm9ybWF0KCdZWVlZLU1NLUREJyk7DQogICAgICAgICAgICAgIHZhciBEYXRlMSA9IHRoaXMucHJldmlvdXNfdmlzaXRfZGF0ZTsNCiAgICAgICAgICAgICAgdmFyIHByZXZpb3VzRGF0ZSA9IG1vbWVudChEYXRlMSkuZm9ybWF0KCdZWVlZLU1NLUREJyk7DQogICAgICAgICAgICAgIGF4aW9zDQogICAgICAgICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLmNvbmZpcm1fYXBwb2ludG1lbnQoKSwgew0KICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICAgICAgICBwaG9uZV9udW1iZXI6IHRoaXMudmlzaXRvcl9udW1iZXIsDQogICAgICAgICAgICAgICAgICB2aXNpdG9yX25hbWU6IHRoaXMucGF0aWVudF9uYW1lLA0KICAgICAgICAgICAgICAgICAgdmlzaXRfcmVhc29uOiB0aGlzLnZpc2l0X3JlYXNvbiwNCiAgICAgICAgICAgICAgICAgIHZpc2l0X3Nsb3Q6IHRoaXMuc2VsZWN0ZWRfdGltZSwNCiAgICAgICAgICAgICAgICAgIHN5bXB0b21zOiB0aGlzLnZpc2l0b3Jfc3ltcHRvbXMsDQogICAgICAgICAgICAgICAgICB2aXNpdF9kYXRlOiBkYXRlU2VsZWN0ZWQsDQogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgICAgIGFwcG9pbnRtZW50X2lkOiB0aGlzLnNlbGVjdGVkX3NjaGVkdWxlX2lkLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlX21vZGFsKCJzY2hlZHVsZV9kZXRhaWxzIikNCiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiQXBwb2ludG1lbnQgQ29uZmlybWVkIFN1Y2Nlc3NmdWxseSIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIkFwcG9pbnRtZW50IGhhcyBiZWVuIENvbmZpcm1lZCIpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZV9zY2hlZHVsZXNfbGlzdCgpDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PSAiQXBwb2ludG1lbnQgQ29uZmlybWF0aW9uIEZhaWxlZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIkFwcG9pbnRtZW50IENvbmZpcm1hdGlvbiBGYWlsZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVfc2NoZWR1bGVzX2xpc3QoKQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tc2cgPT0gIkFuIEVycm9yIE9jY3VycmVkIikgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWV0aGluZyBXZW50IFdyb25nIik7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlX3NjaGVkdWxlc19saXN0KCkNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgY2FuY2VsX3Jlc2NoZWR1bGUgKCkgew0KICAgICAgdGhpcy5pc1Jlc2NoZWR1bGUgPSAhdGhpcy5pc1Jlc2NoZWR1bGU7DQogICAgICAvLyAgJCgiI2RhdGVwaWNrZXItaW5wdXQiKVswXS52YWx1ZSA9IHRoaXMudGVtcF9kYXRhOw0KDQogICAgfSwNCiAgICBjb252ZXJ0X2Nhc2luZyAodGV4dCkgew0KICAgICAgaWYgKHRleHQgPT09ICdub25lJykgew0KICAgICAgICB0ZXh0ID0gJ3NjaGVkdWxlZCcNCiAgICAgIH0NCiAgICAgIHRleHQgPSB0ZXh0LnRvU3RyaW5nKCk7DQogICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cd1xTKi9nLA0KICAgICAgICBmdW5jdGlvbiAodHh0KSB7DQogICAgICAgICAgcmV0dXJuIHR4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArDQogICAgICAgICAgICB0eHQuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIH0pOw0KICAgICAgcmV0dXJuIHR4dDsNCiAgICB9LA0KICAgIGhpZGVfbW9kYWwgKGlkKSB7DQogICAgICAkKGAjJHtpZH1gKS5tb2RhbCgnaGlkZScpDQogICAgfSwNCiAgICB1cGRhdGVfc2NoZWR1bGVzX2xpc3QgKCkgew0KICAgICAgYXhpb3MNCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnNjaGVkdWxlX2luZm9fdXJsKCksIHsNCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgIGZpcnN0X2RheTogdGhpcy5tb250aF9yYW5nZSgic3RhcnRfdGltZSIpLA0KICAgICAgICAgIGxhc3RfZGF5OiB0aGlzLm1vbnRoX3JhbmdlKCJlbmRfdGltZSIpDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLnJlbmRlcl9zY2hlZHVsZShyZXNwb25zZS5kYXRhLlNjaGVkdWxpbmdfaW5mbyk7DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlKTsNCiAgICAgICAgfSk7DQogICAgICBheGlvcw0KICAgICAgICAucG9zdChhcGlfY2FsbHMuc2NoZWR1bGluZ19zZXR0aW5nc191cmwoKSwgew0KICAgICAgICAgIGdldFRpbWVTbG90OiB0cnVlLA0KICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwNCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwNCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgIC8vIGdldFNjaGVkdWxpbmdJbmZvOiB0cnVlLA0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuZnVsbF90aW1lX3Nsb3RzID0gW10NCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgew0KICAgICAgICAgICAgICBsZXQgc3BsaXRfc3RyaW5ncyA9IHJlc3BvbnNlLmRhdGFbaV0uc3BsaXQoIi0iKTsNCiAgICAgICAgICAgICAgdGhpcy5mdWxsX3RpbWVfc2xvdHMucHVzaCh7DQogICAgICAgICAgICAgICAgdmFsdWU6IHJlc3BvbnNlLmRhdGFbaV0sDQogICAgICAgICAgICAgICAgdGV4dDogdGhpcy5nZW5lcmF0ZV90aW1lKA0KICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YVtpXS5zcGxpdCgiLSIpWzBdLA0KICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YVtpXS5zcGxpdCgiLSIpWzFdDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaChlID0+IHsNCiAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOw0KICAgICAgICB9KTsNCiAgICB9DQogIH0NCn07DQo="},null]}