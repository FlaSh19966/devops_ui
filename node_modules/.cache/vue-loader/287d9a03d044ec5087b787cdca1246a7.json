{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/WhatsappNewpage.vue","mtime":1663910265482},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgU29ja2V0LCBQcmVzZW5jZSB9IGZyb20gInBob2VuaXgiOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gInZ1ZS1waG9uZS1udW1iZXItaW5wdXQiOwppbXBvcnQgc3dhbCBmcm9tICdzd2VldGFsZXJ0Mic7CmltcG9ydCBFbW9qaVBpY2tlciBmcm9tICJ2dWUtZW1vamktcGlja2VyIjsKaW1wb3J0IHsgY2xvc2VfbW9kYWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIldoYXRzQXBwQ2hhdE5ld3BhZ2UiLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0LAogICAgVnVlUGhvbmVOdW1iZXJJbnB1dCwKICAgIEVtb2ppUGlja2VyCiAgfSwKICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGN1cnJlbnRfcGFnZV9ubzoxLAogICAgICBsYXRlc3RfcGFnZV9ubzoxLAogICAgICBzaG93X3NwaW5uZXI6IGZhbHNlLAogICAgICBoaXN0b3J5OiBbXSwKICAgICAgY29udGFjdF9saXN0OiBbXSwKICAgICAgb2xkQ3Vyc29yUG9zaXRpb246IG51bGwsCiAgICAgIGlucHV0OiAiIiwKICAgICAgc2VhcmNoOiAiIiwKICAgICAgc2Nyb2xsX3RvcF9jYWxsZWQ6ZmFsc2UsCiAgICAgIHNob3dFbW9qaVBpY2tlcjogZmFsc2UsCiAgICAgIHNlYXJjaGVkX21lc3NhZ2U6W10sCiAgICAgIHBob25lbm86IG51bGwsCiAgICAgIGN1c3RvbWVyX25hbWU6ICIiLAogICAgICBjaGF0X2RldGFpbHM6IFtdLAogICAgICBzZWFyY2hfdmFsdWU6ICIiLAogICAgICBpc19zZWFyY2hfZGl2X29wZW46ZmFsc2UsCiAgICAgIHNlYXJjaF9tZXNzYWdlX3ZhbHVlOiIiLAogICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgY29tcGFueV9uYW1lOnRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsIAogICAgICBzZXNzaW9uX3Rva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICBpbml0aWFsX21lc3NhZ2VfbG9hZDogZmFsc2UsCiAgICAgIGlzX3Byb2ZpbGVfc2V0dXA6IGZhbHNlLAogICAgICBtZXNzYWdlX3BhZ2luYXRpb246IHsKICAgICAgICBpc19zY3JvbGxfdXA6IGZhbHNlLAogICAgICAgIGlzX3Njcm9sbF9kb3duOnRydWUsCiAgICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICAgIHBhZ2Vfbm86IDEsCiAgICAgICAgdG90YWxfcmVjb3JkczogMTAsCiAgICAgICAgcGFnZV9yZWNvcmRfZmV0Y2hlZDogW10KICAgICAgfSwKICAgICAgaXNfcGFnaW5hdGVkX2NhbGw6IGZhbHNlLAogICAgICBkZWZhdWx0X3doYXRzYXBwX3N0YXR1czogJ0hleSB0aGVyZSEgSSBhbSB1c2luZyB3aGF0c2FwcCcsCiAgICAgIGVkaXRfc3RhdHVzOiBmYWxzZSwKICAgICAgc2Nyb2xsX3NwaW5uZXJfY2hhdDogZmFsc2UsCiAgICAgIHNob3dfc2VuZF9tZXNzYWdlOiBmYWxzZSwKICAgICAgaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQ6IGZhbHNlLAogICAgICBpc19zaG93X21lc3NhZ2VfZGlzYWJsZWQ6IHRydWUsCiAgICAgIHdoYXRzYXBwX3Byb2ZpbGUgOiB7fSwKICAgICAgZWRpdF9lbWFpbDogZmFsc2UsCiAgICAgIGVkaXRfYWRkcmVzczogZmFsc2UsCiAgICAgIGVkaXRfZGVzY3JpcHRpb246IGZhbHNlLAogICAgICBlZGl0X3dlYnNpdGU6IGZhbHNlLAogICAgICB0b2dnbGVNb2RhbDpmYWxzZSwKICAgICAgdG9nZ2xlTW9kYWwyOmZhbHNlLAogICAgICBzZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkOm51bGwsCiAgICAgIGVtYWlsX2FkZHJlc3M6ICcnLAogICAgICBidXNpbmVzc19hZGRyZXNzOiAnJywKICAgICAgZGVzY3JpcHRpb24gOiAnJywKICAgICAgd2Vic2l0ZV91cmwgOiAnJywKICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICBjaGFubmVsOiBudWxsLAogICAgICBjaGF0X3NvY2tldDogbnVsbCwKICAgICAgc3VwcG9ydF9jaGFubmVsOiBudWxsLAogICAgICBtZXNzYWdlX3RvX3NlbmQ6IG51bGwsCiAgICAgIHdoYXRzYXBwX3N0YXR1cyA6ICcnLAogICAgICBpbmRleF91cGRhdGU6bnVsbCwKICAgICAgc2Vjb25kX3dlYnNpdGUgOmZhbHNlLAogICAgICBzZWxlY3RlZF9maWxlcyA6JycsCiAgICAgIG1vdXNlX2hvdmVyX3RleHQgOiBmYWxzZSwKICAgICAgdmVydGljYWxfdHlwZXMgOiBbJ0F1dG9tb3RpdmUnLCdCZWF1dHknLCAnU3BhIGFuZCBTYWxvbicsJ0Nsb3RoaW5nIGFuZCBBcHBhcmVsJywnRWR1Y2F0aW9uJywKICAgICAgICAgICAgICAnRW50ZXJ0YWlubWVudCcsJ0V2ZW50IFBsYW5uaW5nIGFuZCBTZXJ2aWNlJywnRmluYW5jZSBhbmQgQmFua2luZycsJ0Zvb2QgYW5kIEdyb2NlcnknCiAgICAgICAgICAgICAgLCdQdWJsaWMgU2VydmljZScsJ0hvdGVsIGFuZCBMb2RnaW5nJywnTWVkaWNhbCBhbmQgSGVhbHRoJywnTm9uLXByb2ZpdCcsCiAgICAgICAgICAgICAgJ1Byb2Zlc3Npb25hbCBTZXJ2aWNlcycsJ1Nob3BwaW5nIGFuZCBSZXRhaWwnLCdUcmF2ZWwgYW5kIFRyYW5zcG9ydGF0aW9uJywnUmVzdGF1cmFudCcsJ090aGVyJ10sCiAgICAgIGN1cnJlbnRfY29udGFjdF9udW1iZXI6IG51bGwsCiAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjpudWxsLAogICAgICBpc19jb250YWN0X2xpc3QgOiBmYWxzZSwKICAgICAgY3VycmVudF9jb250YWN0X2luZGV4OiBudWxsLAogICAgICBzZWFyY2hfaW5fY29udGFjdF9saXN0OiAnJywKICAgICAgYWxsX2NvbnRhY3RfbGlzdCA6IFtdLAogICAgICBzdGFydF9uZXdfY29udl9kYXRhIDogewogICAgICAgIHN0YXJ0X25ld19jb252OiBmYWxzZSwKICAgICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogdHJ1ZQogICAgICB9LAogICAgICBhbGxfY29udGFjdF9wYWdpbmF0aW9uOnsKICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMCwKICAgICAgfSwKICAgICAgc2VuZF9hdHRhY2htZW50X2RldGFpbDogewogICAgICAgIG1lZGlhX2ZpbGVfbmFtZTogbnVsbCwKICAgICAgICBtZWRpYV9maWxlOiBudWxsLAogICAgICAgIHNob3dfcHJldmlldzogZmFsc2UsCiAgICAgICAgbWVkaWFfY29udGVudF90eXBlOiBudWxsLAogICAgICAgIG1lZGlhX3R5cGU6IG51bGwsCiAgICAgICAgc2VuZF9tZWRpYTogdHJ1ZSwKICAgICAgICBkb2N1bWVudF9jb250ZW50OiBudWxsLAogICAgICAgIG1lZGlhX2NhcHRpb246IG51bGwKICAgICAgfSwKICAgICAgY3VycmVudF9mdWxsc2NyZWVuX2ltYWdlX3NyYzogbnVsbCwKICAgICAgYWRkX25ld19jb250YWN0OiB7CiAgICAgICAgcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICAgIGlzX2FkZF9jb250YWN0OiB0cnVlLAogICAgICAgIGNvbnRhY3RfbmFtZTogbnVsbCwKICAgICAgICBmb3JtYXR0ZWROdW1iZXI6IG51bGwKICAgICAgfSwKICAgICAgYWRkX25ld19jb250YWN0X2Zvcm1hdHRlZF9waG9uZV9udW1iZXI6IG51bGwsCiAgICAgIGZpbGVfZXh0ZW5zaW9uczogewogICAgICAgIGFsbF9hbGxvd2VkX2ZpbGVfZXh0ZW5zaW9uczogWyJpbWFnZS9wbmciLCJpbWFnZS9qcGVnIiwgImFwcGxpY2F0aW9uL3BkZiIsICJ0ZXh0L3BsYWluIiwgImFwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCIsICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsICJhcHBsaWNhdGlvbi9tc3dvcmQiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLCAidGV4dC9jc3YiXSwKICAgICAgICBpbWFnZV9maWxlX2V4dGVuc2lvbnM6IFsiaW1hZ2UvcG5nIiwgImltYWdlL2pwZWciXSwKICAgICAgICBkb2N1bWVudF9maWxlX2V4dGVuc2lvbnM6IFsiYXBwbGljYXRpb24vcGRmIiwgInRleHQvcGxhaW4iLCAiYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsIiwgImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsICJhcHBsaWNhdGlvbi9tc3dvcmQiLCAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLCAidGV4dC9jc3YiXQogICAgICB9LAogICAgICB3aGF0c2FwcF90ZW1wbGF0ZXM6IHsKICAgICAgICB0ZW1wbGF0ZXNfbGlzdDogW10sCiAgICAgICAgcGFnaW5hdGlvbl9kYXRhOiB7CiAgICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgdG90YWxfcmVjb3JkczogMTAsCiAgICAgICAgfSwKICAgICAgICBzZWxlY3RlZF90ZW1wbGF0ZTogbnVsbCwKICAgICAgICBwcmV2aWV3X3RlbXBsYXRlX2RhdGE6IG51bGwKICAgICAgfSwKICAgICAgY29udGFjdF9jc3Y6IHsKICAgICAgICBmaWxlX2xhYmVsOiAnQ2hvb3NlIEZpbGUnLAogICAgICAgIGZpbGVfY29udGVudDogbnVsbCwKICAgICAgICBmaWxlX3NlbGVjdGVkOiBmYWxzZQogICAgICB9LAogICAgICB3aGF0c2FwcF9mb3JtYXRfZGljdCA6IHsgCiAgICAgICAgIioiOlsnPHN0cm9uZz4nLCc8L3N0cm9uZz4nXSwKICAgICAgICAiXyI6Wyc8aT4nLCc8L2k+J10sCiAgICAgICAgIn4iOlsnPHM+JywnPC9zPiddLAogICAgICAgICJgYGAiOlsnPHR0PicsJzwvdHQ+J10KICAgICAgfSwKICAgICAgd2hhdHNhcHBfZm9ybWF0aW5nX2xpc3QgOiBbIioiLCJfIiwifiIsImBgYCJdLAogICAgICBzaG93X3Byb2ZpbGVfZGl2IDogZmFsc2UKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLy8gdG90YWxfcGFnZXNfbG9hZGVkKCkgewogICAgLy8gICBpZiAoKHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBhZ2Vfbm8gKiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSkgPj0gdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcykgewogICAgLy8gICAgIHJldHVybiB0cnVlOwogICAgLy8gICB9CiAgICAvLyAgIHJldHVybiBmYWxzZTsKICAgIC8vIH0sCiAgICBtZXNzYWdlX3RleHRfYm94X3BsYWNlaG9sZGVyKCkgewogICAgICByZXR1cm4gIlNlbmQgYSBtZXNzYWdlIHRvIHVzZXIiCiAgICB9LAogICAgcmV0dXJuVmFsdWVzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGxlZ2VuZDonY2FuY2VsX2J0bicKICAgICAgfQogICAgfSwKICAgIHRvdGFsX2NvbnRhY3RfbG9hZGVkKCl7CiAgICAgIGlmICgodGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gKiB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UpID49IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHRyYW5zaXRpb25fZGF0YSgpewogICAgICByZXR1cm57CiAgICAgICAgICAgICAgICAgIGNvdW50cnlTZWxlY3RvckxhYmVsOmAke3RoaXMudGx0KCdjb3VudHJ5X2NvZGUnKX1gICwKICAgICAgICAgICAgICAgICAgcGhvbmVOdW1iZXJMYWJlbDogYCR7dGhpcy50bHQoJ3Bob25lX251bWJlcicpfWAsIAogICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgICAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJykgIAogICAgICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2hpZGUnKSAgCiAgICAgICAgICAgIHRoaXMuaXNfb3BlbiA9IGZhbHNlOwogICAgICAgICAgICBuZXh0KCk7CiAgfSwKICAgYmVmb3JlUm91dGVFbnRlcih0bywgZnJvbSwgbmV4dCkgewogICAgICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2Rpc3Bvc2UnKSAgCiAgICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpICAKICAgCiAgICAgICAgICAgIG5leHQoKTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmdldF9jb250YWN0X2xpc3QodHJ1ZSk7CiAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgIGNvbnN0IHZtID0gdGhpczsKICAgICQod2luZG93KS5iaW5kKCdtb3VzZXdoZWVsJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50Lm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSkKICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSA+PSAwKSB7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IHRydWU7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF9kb3duID0gZmFsc2U7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IGZhbHNlOwogICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9IHRydWU7CiAgICAgICAgdGhpcy5zY3JvbGxfdG9wX2NhbGxlZCA9IGZhbHNlOwoKICAgICAgfQogICAgICB2bS5pc19wYWdpbmF0ZWRfY2FsbCA9IGZhbHNlCiAgICB9KTsKICAgIC8vIHZhciBsYXN0U2Nyb2xsVG9wID0gMDsKICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAvLyAgICJzY3JvbGwiLAogICAgLy8gICBmdW5jdGlvbiAoZXYpIHsKICAgIC8vICAgICBpZiAoZXYudGFyZ2V0LmlkID09PSAic2Nyb2xsaW5nLWRpdi13aGF0c2FwcCIpIHsKICAgIC8vICAgICAgIGNvbnNvbGUubG9nKGV2KQogICAgLy8gICAgICAgdmFyIHN0ID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7IC8vIENyZWRpdHM6ICJodHRwczovL2dpdGh1Yi5jb20vcWVyZW15L3NvL2Jsb2IvbWFzdGVyL3NvLmRvbS5qcyNMNDI2IgogICAgLy8gICAgICAgaWYgKHN0ID4gbGFzdFNjcm9sbFRvcCl7CiAgICAvLyAgICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKICAgIC8vICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCJTY3JvbGxpbmcgVXAiKQogICAgLy8gICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGxhc3RTY3JvbGxUb3AgPSBzdCA8PSAwID8gMCA6IHN0OwoKICAgIC8vICAgICAgIC8vIHZtLnNjcm9sbFBvc2l0aW9uID0gZXYudGFyZ2V0WyJzY3JvbGxUb3AiXTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0sCiAgICAvLyAgIHRydWUKICAgIC8vICk7CiAgICAkKCIjc2hvd0ltYWdlTW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2bS5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gbnVsbDsKICAgIH0pOwogICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZtLmVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKTsKICAgIH0pOwoKICAgIC8vIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSwgCiAgICAvLyB7CiAgICAvLyAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgIC8vICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiAiMTAwIiwKICAgIC8vICAgdGVzdDogYnRvYSgidGVzdF9wYXJhbWF0ZXIiKQogICAgLy8gfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgIC8vIHRoaXMuY2hhdF9ncm91cF9uYW1lID0gcmVzcG9uc2UuZGF0YS5jaGF0X2dyb3VwX25hbWU7CiAgICAgIC8vIHRoaXMubGl2ZV9jaGF0X3Rva2VuID0gcmVzcG9uc2UuZGF0YS50b2tlbjsKICAgICAgLy8gdGhpcy5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgICAvLyB0aGlzLmNoYXRfc29ja2V0ID0gbmV3IFNvY2tldCgKICAgICAgLy8gICBwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsCiAgICAgIC8vICAgewogICAgICAvLyAgICAgcGFyYW1zOiB7CiAgICAgIC8vICAgICAgIHdoYXRzYXBwOiAidHJ1ZSIsCiAgICAgIC8vICAgICAgIGVsaXhpcl90b2tlbiA6IHJlc3BvbnNlLmRhdGEuZWxpeGlyX3Rva2VuLAogICAgICAvLyAgICAgICB0b2tlbjogdGhpcy5zZXNzaW9uX3Rva2VuLAogICAgICAvLyAgICAgICB1c2VybmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIC8vICAgICB9LAogICAgICAvLyAgIH0KICAgICAgLy8gKTsKICAgICAgdGhpcy5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQoCiAgICAgICAgcHJvY2Vzcy5lbnYuVlVFX0FQUF9MSVZFX0NIQVRfV0VCU09DS0VUX0VORFBPSU5ULAogICAgICAgIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICB3aGF0c2FwcDogInRydWUiLAogICAgICAgICAgICBqd3Q6IHRoaXMuJHNlc3Npb24uZ2V0KCJhdCIpLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICk7CiAgICAgIHRoaXMuY2hhdF9zb2NrZXQuY29ubmVjdCgpOwogICAgICBsZXQgY29tcGFueV9pZCA9ICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgdGhpcy5jaGFubmVsID0gdGhpcy5jaGF0X3NvY2tldC5jaGFubmVsKAogICAgICAgICJ3aGF0c2FwcDoiICsgY29tcGFueV9pZAogICAgICApOwogICAgICB0aGlzLmNoYW5uZWwuam9pbigpOwogICAgICB0aGlzLmNoYW5uZWwub24oIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgKHJlcykgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlcykKICAgICAgICBpZihyZXMuY29tcGFueV9pZCA9PT0gY29tcGFueV9pZCl7CiAgICAgICAgICAvLyBpZighcmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygidXNlciBib3QgY29udmVyc2F0aW9uIikKICAgICAgICAgICAgbGV0IGNvbnRhY3RfaW5kZXggPSB0aGlzLmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoKGl0ZW0pID0+IHtyZXR1cm4gaXRlbS53aGF0c2FwcF9waG9uZV9udW1iZXIgPT09IHJlcy53aGF0c2FwcF9waG9uZV9udW1iZXJ9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKHJlcy5CT1RSZXNwb25zZSA9PSB1bmRlZmluZWQpewogICAgICAgICAgICAvLyBsZXQgbGF0ZXN0X21lc3NhZ2U7CiAgICAgICAgICAgIC8vIGlmKHJlcy5pc19ib3RfY29udmVyc2F0aW9uX3JlYWx0aW1lKXsKICAgICAgICAgICAgLy8gICBsZXQgaXNfdGV4dCA9ICByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gaXRlbS50ZXh0ICE9IG51bGwpLAogICAgICAgICAgICAvLyAgIGlzX3Byb2R1Y3QgPSByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gKGl0ZW0udGV4dCA9PSBudWxsICYmIGl0ZW0ucHJvZHVjdHMpKTsKICAgICAgICAgICAgLy8gICBpZihCb29sZWFuKGlzX3RleHQpKSB7CiAgICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9IGlzX3RleHQudGV4dDsKICAgICAgICAgICAgLy8gICB9IGVsc2UgaWYoQm9vbGVhbihpc19wcm9kdWN0KSkgewogICAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSAiUHJvZHVjdCBib3QgcmVzcG9uc2UiCiAgICAgICAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gICAgIGxhdGVzdF9tZXNzYWdlID0gbnVsbAogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgLy8gICBsYXRlc3RfbWVzc2FnZSA9IHJlcy53aGF0c2FwcF9tZXNzYWdlOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcywgImVsc2UiLCBjb250YWN0X2luZGV4KQogICAgICAgICAgICAgIGlmIChjb250YWN0X2luZGV4ICE9IC0xKXsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSByZXMud2hhdHNhcHBfbWVzc2FnZTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0ubmV3X21lc3NhZ2VfY291bnQgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSB0aGlzLmFycmF5X21vdmUodGhpcy5jb250YWN0X2xpc3QsIGNvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYodGhpcy5jaGVja19jdXJyZW50X251bWJlcihyZXMpKXsgCiAgICAgICAgICAgICAgICBsZXQgY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CiAgICAgICAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgICBpZih0aGlzLmhpc3RvcnkubWFwKGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZSkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogW10sCiAgICAgICAgICAgICAgICAgICJVc2VyUXVlcnkiOiByZXMud2hhdHNhcHBfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV9kYXRlIjogYm90X3Jlc3BvbnNlX2RhdGUsIAogICAgICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwgCiAgICAgICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X2RhdGUiOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgIlVzZXJRdWVyeV9EYXRlVGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsZXQgbGF0ZXN0X21lc3NhZ2UsCiAgICAgICAgICAgICAgaXNfdGV4dCA9ICByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gaXRlbS50ZXh0ICE9IG51bGwpLAogICAgICAgICAgICAgIGlzX3Byb2R1Y3QgPSByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gKGl0ZW0udGV4dCA9PSBudWxsICYmIGl0ZW0ucHJvZHVjdHMpKTsKICAgICAgICAgICAgICBpZihCb29sZWFuKGlzX3RleHQpKSB7CiAgICAgICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9IGlzX3RleHQudGV4dDsKICAgICAgICAgICAgICB9IGVsc2UgaWYoQm9vbGVhbihpc19wcm9kdWN0KSkgewogICAgICAgICAgICAgICAgbGF0ZXN0X21lc3NhZ2UgPSAiUHJvZHVjdCBib3QgcmVzcG9uc2UiCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gbnVsbAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY29udGFjdF9pbmRleCAhPSAtMSl7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gbGF0ZXN0X21lc3NhZ2U7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLm5ld19tZXNzYWdlX2NvdW50ID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2luZGV4LCAwKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZih0aGlzLmNoZWNrX2N1cnJlbnRfbnVtYmVyKHJlcykpeyAKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgICAgICAgIGxldCBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKICAgICAgICAgICAgICAgIGlmKHRoaXMuaGlzdG9yeS5tYXAoaXRlbSA9PiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX2RhdGUiXSA9IGJvdF9yZXNwb25zZV9kYXRlOyAKICAgICAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX3RpbWUiXSA9IGN1cnJlbnRfdGltZXN0YW1wOyAKICAgICAgICAgICAgICAgIHJlc1sidXNlcl9xdWVyeV9kYXRlIl0gPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgICByZXNbInVzZXJfcXVlcnlfdGltZSJdID0gY3VycmVudF90aW1lc3RhbXA7CiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChyZXMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgLy8gICBjb25zb2xlLmxvZygicmVhbHRpbWUgY29udmVyc2F0aW9uIikKICAgICAgICAgIC8vIH0KICAgICAgICB9CiAgICAgIH0pCiAgICAvLyB9KQogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF92YWx1ZShuZXdWYWx1ZSkgewogICAgICAvLyBjb25zb2xlLmxvZyhuZXdWYWx1ZSkKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpICB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgICAgICBpc19nZXRfY29udGFjdHM6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAoKHRoaXMuYXBpX3N0YXR1c19jb2RlLkNPTlRBQ1RTX05PVF9GT1VORC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKQogICAgICAgICAgICAgfHwgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpKSB7CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgfWVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdldF9jb250YWN0X2xpc3QoZmFsc2UpOwogICAgICB9CiAgICB9LAoKICAgIHNlYXJjaF9tZXNzYWdlX3ZhbHVlKG5ld1ZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSAhPSAiIikgIHsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOnRydWUsCiAgICAgICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgIHNlYXJjaF9zdHJpbmc6IG5ld1ZhbHVlLAogICAgICAgICAgICAgIAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCh0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hlZF9tZXNzYWdlID0gW107CiAgICAgICAgICAgIH1lbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKXsKICAgICAgICAgICAgICB0aGlzLnNlYXJjaGVkX21lc3NhZ2UgPSByZXNwb25zZS5kYXRhLmRhdGEuc2VhcmNoX3Jlc3VsdDsKCiAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9IGVsc2V7CiAgICAgICAgdGhpcy5zZWFyY2hlZF9tZXNzYWdlID0gW10KICAgICAgfQogICAgfSwKICAgIC8vIHRvZ2dsZU1vZGFsKG5ld1ZhbHVlKXsKICAgIC8vICAgaWYobmV3VmFsdWUpewogICAgLy8gICAgIGNvbnNvbGUubG9nKCJuZXcgdmFsdWUiICwgbmV3VmFsdWUpOwogICAgLy8gICAgIHRvZ2dsZURyb3Bkb3duKCk7CiAgICAvLyAgIH0KCiAgICAvLyB9LAogICAgLy8gdG9nZ2xlTW9kYWw6IHsKICAgIC8vICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHZhbCwgb2xkVmFsKSB7CiAgICAvLyAgICAgICBpZih2YWwpewogICAgLy8gICAgIGNvbnNvbGUubG9nKCJuZXcgdmFsdWUiICwgdmFsICwgb2xkVmFsKTsKICAgIC8vICAgICB0aGlzLnRvZ2dsZURyb3Bkb3duKCk7CiAgICAvLyAgIH0vLyBjYWxsIGl0IGluIHRoZSBjb250ZXh0IG9mIHlvdXIgY29tcG9uZW50IG9iamVjdAogICAgLy8gICAgfSwKICAgIC8vICAgIGRlZXA6IHRydWUKICAgIC8vIH0sCiAgICBzZWFyY2hfaW5fY29udGFjdF9saXN0KG5ld1ZhbHVlKXsKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpICB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLmFsbF9jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICAgICAgfWVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLmFsbF9jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICB9CiAgICB9LAogICAgJ3doYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSc6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gKG5ld1ZhbCwgb2xkVmFsKXsKICAgICAgICBpZihCb29sZWFuKG5ld1ZhbCkpewogICAgICAgICAgdmFyIGN1cnJlbnRfdGVtcGxhdGUgPSB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdC5maW5kKChpdGVtKSA9PiBpdGVtLnRlbXBsYXRlX2lkID09IG5ld1ZhbCk7CiAgICAgICAgICB2YXIgdGVtcGxhdGVfaWQgPSBuZXdWYWw7CiAgICAgICAgICB2YXIgdmFyaWFibGVfZGljdCA9IGN1cnJlbnRfdGVtcGxhdGUudmFyaWFibGVfZGljdDsKICAgICAgICAgIHZhciBpc19wYXJlbnRfdGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICAgIGF4aW9zLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF90ZW1wbGF0ZSgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiBmYWxzZSwKICAgICAgICAgICAgICBpc19wcmV2aWV3OiB0cnVlLAogICAgICAgICAgICAgIGlzX3BhcmVudF90ZW1wbGF0ZTogaXNfcGFyZW50X3RlbXBsYXRlLAogICAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB0ZW1wbGF0ZV9pZCwKICAgICAgICAgICAgICB2YXJpYWJsZV9kaWN0OiB2YXJpYWJsZV9kaWN0LAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVVNFUl9MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiA0MDAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIiwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOicjMzA4NWQ2JywKICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnJyksCiAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJywKICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7bmFtZTogJ1NldHRpbmdzJyxwYXJhbXM6e1N1YnNjcmlwdGlvbjp0cnVlfX0pOyAgICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgIGhpZ2hsaWdodF90ZXh0KHVzZXJRdWVyeSl7CiAgICAgIGxldCBjbGFzc25hbWUgPSAiIgogICAgICBpZih1c2VyUXVlcnkgPT09dGhpcy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkKXsKICAgICAgICBjbGFzc25hbWUgPSAiYWRkLWhpZ2hsaWdodCIKICAgICAgICByZXR1cm4gY2xhc3NuYW1lCiAgICAgIH0KICAgICAgcmV0dXJuIGNsYXNzbmFtZQogICAgfSwKICAgIHJlZnJlc2hQb3BvdmVyKCl7CiAgICAgICAgIGlmKHRoaXMuaXNfb3BlbiA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuaXNfb3BlbiA9PT0gZmFsc2UpewogICAgICAgICAgICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpCiAgICAKICAgICAgICAgIAoKICAgICAgICAgIC8vICQoJyNwb3BvdmVyJykucG9wb3Zlcignc2hvdycpCiAgICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3Zlcih7CiAgICAgICAgICAgICAgaHRtbDogdHJ1ZSwKICAgICAgICAgICAgICB0aXRsZTogYCR7dGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfbGVnZW5kJyl9YCwKICAgICAgICAgICAgICBjb250ZW50OiBgPHNwYW4gc3R5bGU9J2NvbG9yOiMyNWFmMDI7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+ICR7dGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfY29udGFjdF9vbl93aGF0c2FwcCcpfSA8L3NwYW4+IDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9J2NvbG9yOiNmZjQ3NDc7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+ICR7dGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfY29udGFjdF9ub3Rfb25fd2hhdHNhcHAnKX08L3NwYW4+IDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9J2NvbG9yOiNmZmMzNDc7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+ICR7dGhpcy50bHQoJ3doYXRzYXBwX3dlYnZpZXdfY29udGFjdF9kb250X2tub3dfb25fd2hhdHNhcHAnKX08L3NwYW4+YCwKICAgICAgICAgICAgICAKICAgICAgICAgICAgfSkKICAgICAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdzaG93JykgIAogICAgICAgICAgICB0aGlzLmlzX29wZW4gPSB0cnVlOwogICAgICAgICAgCiAgICAgICAgfWVsc2V7CiAgICAgICAgCiAgICAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJykgIAogICAgICAgICAgICAkKCcjcG9wb3ZlcicpLnBvcG92ZXIoJ2hpZGUnKSAgCiAgICAgICAgICAgIHRoaXMuaXNfb3BlbiA9IGZhbHNlOwogICAgICAgICAgCiAgICAgICAgfQogICAgICB9LAogICAgICBjbG9zZU1vZGVsKGUpewogICAgICAgIC8vY29uc29sZS5sb2coZS50YXJnZXQuY2xhc3NMaXN0ICwgIiBjYWxsaW5nIG1vZGFsIikKICAgICAgICBpZighZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdsZWdlbmRfd2hhdHNhcHAnKSl7CiAgICAgICAgIAogICAgICAgICAgJCgnI3BvcG92ZXInKS5wb3BvdmVyKCdkaXNwb3NlJykgIAogICAgICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpICAKICAgICAgICAgICAgICB0aGlzLmlzX29wZW4gPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gaWYoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZHJvcGRvd25NZW51QnV0dG9uT25lJykpewogICAgICAgICAKICAgICAgICAvLyB9CiAgICAgICAgICBpZighZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJidG4iKSAmJiAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJiaS10aHJlZS1kb3RzLXZlcnRpY2FsIikgJiYgIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiY3VzdG9tZXItbmFtZSIpICYmICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImJ0biIpKXsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiwiYmVmb3JlIGNsb3NpbmcgbW9kYWwiKQogICAgICAgICAgICBsZXQgZHJvcGRvd25QYXJlbnQyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGFyZW50MicpCiAgICAgICAgICAgIGxldCBkcm9wZG93bk1lbnUyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudTInKQogICAgICAgICAgICBsZXQgZHJvcGRvd25NZW51QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudUJ1dHRvbjInKQogICAgICAgICAgICBsZXQgZHJvcGRvd25QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQnKQogICAgICAgICAgICBsZXQgZHJvcGRvd25NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudScpCiAgICAgICAgICAgIGxldCBkcm9wZG93bk1lbnVCdXR0b25PbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uT25lJykKICAgICAgICAgICAgCiAgICAgICAgICAKICAgICAgICAgCiAgICAgICAgICAgIGlmKGRyb3Bkb3duUGFyZW50MiAmJiBkcm9wZG93bk1lbnUyICYmIGRyb3Bkb3duTWVudUJ1dHRvbiAmJiB0aGlzLnRvZ2dsZU1vZGFsMil7CiAgICAgICAgICAgICAgICAgZHJvcGRvd25QYXJlbnQyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgICBkcm9wZG93bk1lbnUyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgICBkcm9wZG93bk1lbnVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKQogICAgICAgICAgICAgIGRyb3Bkb3duTWVudTIucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKQogICAgICAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwyID0gZmFsc2UKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMudG9nZ2xlTW9kYWwyICwgImFmdGVyIGNsb3NpbmcgbW9kYWwgLS0tLS0tLS0iKQoKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihkcm9wZG93bk1lbnUgJiYgZHJvcGRvd25QYXJlbnQgJiYgZHJvcGRvd25NZW51QnV0dG9uT25lICYmIHRoaXMudG9nZ2xlTW9kYWwpewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCItLS0iICwgImluc2lkZSBkcm9wZG93biIpCiAgICAgICAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgIGRyb3Bkb3duUGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJykKICAgICAgICAgICAgZHJvcGRvd25NZW51LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7JykKICAgICAgICAgICAgdGhpcy50b2dnbGVNb2RhbCA9IGZhbHNlCiAgICAgIAogICAgICAgICAgfQogICAgICAgICAKICAgICAgICB9CiAgICAgCiAgICAgIH0sCiAgICBvcGVuU2VhcmNoRGl2KCl7CiAgICAgIHRoaXMuaXNfc2VhcmNoX2Rpdl9vcGVuPXRydWUKICAgICAgbGV0IGNoYXRfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRfZGl2Jyk7CiAgICAgIGNoYXRfZGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbC1zbS04JykKICAgICAgY2hhdF9kaXYuY2xhc3NMaXN0LmFkZCgnY29sLXNtLTQnKQogICAgICBsZXQgc2VhcmNoX2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hfZGl2Jyk7CiAgICAgIHNlYXJjaF9kaXYuc3R5bGUuZGlzcGxheSA9ICJmbGV4IgoKCiAgICAgIGxldCBib3RfbXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI21zZy1kaXYiKQogICAgICBib3RfbXNnLmZvckVhY2goZWxlbT0+ewogICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgicmVzcG9uc2l2ZS13aWR0aCIpICAgICAgIAogICAgICB9KQogICAgICAKICAgICAgbGV0IHByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIikKICAgICAgcHJldmlld19idG4uZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtc20tMTEiKSAgICAgICAKICAgICAgfSkKICAgICAgIGxldCBib3RfY2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5ib3QtcmVzcCIpCiAgICAgIGJvdF9jYXJkLmZvckVhY2goZWxlbT0+ewogICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgiY29sLTciKSAgICAgICAKICAgICAgfSkKICAgICAgbGV0IGVtb2ppX2ZpbGVzaGFyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbW9qaV9maWxlc2hhcmUnKTsKICAgICAgaWYoZW1vamlfZmlsZXNoYXJlKXsKCiAgICAgICAgZW1vamlfZmlsZXNoYXJlLnN0eWxlLndpZHRoID0gIjE5JSIKICAgICAgfQoKICAgIH0sCiAgICBjbG9zZVNlYXJjaERpdigpewogICAgICAgICAgICB0aGlzLmlzX3NlYXJjaF9kaXZfb3Blbj1mYWxzZQogICAgICBsZXQgY2hhdF9kaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdF9kaXYnKTsKICAgICAgY2hhdF9kaXYuY2xhc3NMaXN0LmFkZCgnY29sLXNtLTgnKQogICAgICBjaGF0X2Rpdi5jbGFzc0xpc3QucmVtb3ZlKCdjb2wtc20tNCcpCiAgICAgIGxldCBzZWFyY2hfZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaF9kaXYnKTsKICAgICAgc2VhcmNoX2Rpdi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiCiAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZSA9IFtdCiAgICAgIHRoaXMuc2VhcmNoX21lc3NhZ2VfdmFsdWU9IiIKICAgICAgdGhpcy5zZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkID0gbnVsbAoKICAgICAgbGV0IGJvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpCiAgICAgIGJvdF9tc2cuZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJyZXNwb25zaXZlLXdpZHRoIikgICAgICAgCiAgICAgIH0pCiAgICAgICAgbGV0IHByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIikKICAgICAgcHJldmlld19idG4uZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJjb2wtc20tMTEiKSAgICAgICAKICAgICAgfSkKICAgICAgbGV0IGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIikKICAgICAgYm90X2NhcmQuZm9yRWFjaChlbGVtPT57CiAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLXJ1bi0tLSIpCiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJjb2wtNyIpICAgICAgIAogICAgICB9KQogICAgICAgIGxldCBlbW9qaV9maWxlc2hhcmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1vamlfZmlsZXNoYXJlJyk7CiAgICAgIGlmKGVtb2ppX2ZpbGVzaGFyZSl7CgogICAgICAgIGVtb2ppX2ZpbGVzaGFyZS5zdHlsZS53aWR0aCA9ICI4JSIKICAgICAgfQogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICAodGhpcy5oaXN0b3J5ID0gW10pLCAodGhpcy5waG9uZW5vID0gbnVsbCk7CiAgICAgIHRoaXMuY3VzdG9tZXJfbmFtZSA9ICIiOwogICAgICB0aGlzLmNoYXRfZGV0YWlscyA9IFtdOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wZXJfcGFnZSA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vID0gMTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkID0gW107CiAgICAgIHRoaXMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBudWxsOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UgPSAxMDsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9CiAgICB9LAogICAgcmVzZXRfY3Vyc29yX3Bvc2l0aW9uKCkgewogICAgICB0aGlzLm9sZEN1cnNvclBvc2l0aW9uID0gbnVsbDsKICAgIH0sCiAgICB0b2dnbGVFbW9qaVBpY2tlcigpewogICAgICB0aGlzLnNob3dFbW9qaVBpY2tlciA9ICF0aGlzLnNob3dFbW9qaVBpY2tlcjsKICAgIH0sCiAgICBhcHBlbmRfb25fY2hhdChlbW9qaSwgaWQpIHsKICAgICAgdmFyIHRleHRhcmVhID0gdGhpcy4kcmVmcy50ZXh0YXJlYTsKICAgICAgbGV0IGNoYXRfdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2hhdHNhcHBfdGV4dF9pbnB1dF9ib3gnKS52YWx1ZTsKICAgICAgdmFyIGN1cnNvclBvcyA9IHRleHRhcmVhLnNlbGVjdGlvbkVuZDsKICAgICAgLy8gdmFyIGN1cnNvclBvc2l0aW9uID0gdGV4dGFyZWEuc2VsZWN0aW9uRW5kCiAgICAgIC8vIGxldCB2ID0gJCgiIyIgKyBpZCkudmFsKCk7CiAgICAgIGlmICh0aGlzLm9sZEN1cnNvclBvc2l0aW9uKSB7CiAgICAgICAgdmFyIHRleHRCZWZvcmUgPSBjaGF0X3ZhbHVlLnN1YnN0cmluZygwLCB0aGlzLm9sZEN1cnNvclBvc2l0aW9uKTsKICAgICAgICB2YXIgdGV4dEFmdGVyID0gY2hhdF92YWx1ZS5zdWJzdHJpbmcodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiwgY2hhdF92YWx1ZS5sZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXh0QmVmb3JlID0gY2hhdF92YWx1ZS5zdWJzdHJpbmcoMCwgY3Vyc29yUG9zKTsKICAgICAgICB2YXIgdGV4dEFmdGVyID0gY2hhdF92YWx1ZS5zdWJzdHJpbmcoY3Vyc29yUG9zLCBjaGF0X3ZhbHVlLmxlbmd0aCk7CiAgICAgIH0KICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgICF0aGlzLm9sZEN1cnNvclBvc2l0aW9uCiAgICAgICAgPyAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IGN1cnNvclBvcyArIDIpCiAgICAgICAgOiAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IHRoaXMub2xkQ3Vyc29yUG9zaXRpb24gKyAyKTsKICAgIH0sCiAgICBnZXRfaGlzdG9yeV9kYXRhKHdoYXRzYXBwX25vLCB1c2VyX25hbWUsIGNvbnRhY3RfaW5kZXgsIGNvbnRhY3QpIHsKICAgICAgLy8gY29uc29sZS5sb2coInJ1bm5uIikKICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIHRoaXMuY3VzdG9tZXJfbmFtZSA9IHRoaXMuZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lKGNvbnRhY3QpOwogICAgICAvLyB0aGlzLmN1c3RvbWVyX25hbWUgPSB1c2VyX25hbWU7CiAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciA9IHdoYXRzYXBwX25vOwogICAgICB0aGlzLnNob3dfc2VuZF9tZXNzYWdlID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gY29udGFjdF9pbmRleDsKICAgICAgdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0uaXNfbmV3X25vdGlmaWNhdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSBmYWxzZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZ2V0X2J5X3doYXRzYXBwX3Bob25lX251bWJlcjogdHJ1ZSwKICAgICAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHdoYXRzYXBwX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IDEsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NlbmRfbWVzc2FnZSA9IHRydWU7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhID0gY29udGFjdDsKICAgICAgICAgICAgdGhpcy5waG9uZW5vID0gd2hhdHNhcHBfbm87CiAgICAgICAgICB9ZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CiAgICAgICAgICAgIHRoaXMuaGlzdG9yeSA9IHRoaXMuZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2UocmVzcG9uc2UuZGF0YS5kYXRhLmNoYXRfaGlzdG9yeSk7CiAgICAgICAgICAgIHRoaXMucGhvbmVubyA9IHJlc3BvbnNlLmRhdGEuZGF0YS53aGF0c2FwcF9waG9uZV9udW1iZXIgfHwgd2hhdHNhcHBfbm87CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucGhvbmVubywgdGhpcy5jb250YWN0X2xpc3QpOwogICAgICAgICAgICBsZXQgY29udGFjdF9saXN0X2luZGV4ID0gdGhpcy5jb250YWN0X2xpc3QuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS53aGF0c2FwcF9waG9uZV9udW1iZXIgPT0gdGhpcy5waG9uZW5vKTsKICAgICAgICAgICAgaWYoY29udGFjdF9saXN0X2luZGV4ID49IDEpewogICAgICAgICAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2xpc3RfaW5kZXgsIDApOwogICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID1jb250YWN0X2xpc3RfaW5kZXg7CiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID0gdGhpcy5waG9uZW5vOwogICAgICAgICAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfbGlzdF9pbmRleF0uaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmN1cnJlbnRfcGFnZV9ubyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlOwogICAgICAgICAgICB0aGlzLmxhdGVzdF9wYWdlX25vID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2U7CgogICAgICAgICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09PSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSl7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlc19sb2FkZWQgPSB0cnVlCiAgICAgICAgICAKICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZWxzZSIpCiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCA9IGZhbHNlICAgICAgICAgICAgIAogICAgICAKICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZyh0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCkKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfZG93bigpOwogICAgICAgICAgICAgIHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuY2hhdFNjcm9sbE1lc3NhZ2VzKHRydWUpOwogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX3RvcF9jYWxsZWQ9ZmFsc2UKICAgICAgICAgICAgfSwgNDAwKTsKICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8gZ2V0X3NlYXJjaGVkX2NoYXRfaW50ZXJtZWRpYXRlX2Z1bmN0aW9uKHRpbWUpewogICAgLy8gICBjb25zb2xlLmxvZyh0aW1lICwgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyKQogICAgLy8gICB0aGlzLmdldF9zZWFyY2hlZF9jaGF0X2RhdGEoIHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciAsdGltZSkKICAgCiAgICAvLyB9LAogICAgLy8gaGlnaGxpZ2h0X3RleHQoKXsKICAgIC8vICAgICAgICB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQgPSB0aGlzLnNlYXJjaGVkX21lc3NhZ2VbaW5kZXhdLnNlYXJjaF90ZXh0CiAgICAvLyAgICAgICAgICAgbGV0IHRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjdGV4dCIpCiAgICAgICAgICAgICAgCiAgICAvLyAgICAgICAgICAgdGV4dC5mb3JFYWNoKGVsZW09PnsKICAgIC8vICAgICAgICAgICAgIGlmKGVsZW0udGV4dENvbnRlbnQudHJpbSgpID09PSBzZWFyY2hlZF9tZXNzYWdlX3NlbGVjdGVkLnRyaW0oKSl7CiAgICAvLyAgICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnYWRkX2hpZ2hsaWdodCcpCiAgICAvLyAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJnb3RjaGEgaW5zaWRlIGlmIiAsIGVsZW0uY2xhc3NMaXN0ICwgc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCkKICAgIC8vICAgICAgICAgICAgIH0KICAgIC8vICAgICAgICAgICB9KTsKICAgIC8vIH0sCiAgICAgZ2V0X3NlYXJjaGVkX2NoYXRfZGF0YSh3aGF0c2FwcF9ubyx0aW1lICwgaW5kZXgpIHsKICAgICAgLy8gY29uc29sZS5sb2coImluZGV4IixpbmRleCkKICAgICAgLy8gdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAvLyB0aGlzLmN1c3RvbWVyX25hbWUgPSB0aGlzLmdldF9jb250YWN0X2Rpc3BsYXlfbmFtZShjb250YWN0KTsKICAgICAgLy8gLy8gdGhpcy5jdXN0b21lcl9uYW1lID0gdXNlcl9uYW1lOwogICAgICAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB3aGF0c2FwcF9ubzsKICAgICAgdGhpcy5zaG93X3NlbmRfbWVzc2FnZSA9IGZhbHNlOwogICAgICAvLyB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IGNvbnRhY3RfaW5kZXg7CiAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSBmYWxzZTsKICAgICAgLy8gdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB3aGF0c2FwcF9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgICAgICBpc19nZXRfc2VhcmNoOnRydWUsCiAgICAgICAgICAgIG1lc3NhZ2VfZGF0ZXRpbWU6IHRpbWUKCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgLy8gY29uc29sZS5sb2coInJhbm5uIik7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdGhpcy5zaG93X3NlbmRfbWVzc2FnZSA9IHRydWU7CiAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgLy8gICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPSB0cnVlOwogICAgICAgICAgICAvLyAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhID0gY29udGFjdDsKICAgICAgICAgICAgLy8gdGhpcy5waG9uZW5vID0gd2hhdHNhcHBfbm87CiAgICAgICAgICB9ZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmhpc3RvcnkgLCAiYmVmb3JlIikKICAgICAgICAgICAgLy8gdGhpcy5oaXN0b3J5ID0gIiI7CiAgICAgICAgICAgIC8vIGRlYnVnZ2VyOwogICAgICAgICAgICB0aGlzLmhpc3RvcnkgPSB0aGlzLmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0X2hpc3RvcnkpOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRfcGFnZV9ubyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlOwogICAgICAgICAgICB0aGlzLmxhdGVzdF9wYWdlX25vID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2U7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudF9wYWdlX25vICwgImN1cnJlbnQgc2V0IikKICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZCA9IFtyZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZV0KICAgICAgICAgICAgLy8gdGhpcy5waG9uZW5vID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Bob25lX251bWJlciB8fCB3aGF0c2FwcF9ubzsKICAgICAgICAgICAgLy8gLy8gY29uc29sZS5sb2codGhpcy5waG9uZW5vLCB0aGlzLmNvbnRhY3RfbGlzdCk7CiAgICAgICAgICAgIC8vIGxldCBjb250YWN0X2xpc3RfaW5kZXggPSB0aGlzLmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLndoYXRzYXBwX3Bob25lX251bWJlciA9PSB0aGlzLnBob25lbm8pOwogICAgICAgICAgICAvLyBpZihjb250YWN0X2xpc3RfaW5kZXggPj0gMSl7CiAgICAgICAgICAgIC8vICAgLy8gdGhpcy5jb250YWN0X2xpc3QgPSB0aGlzLmFycmF5X21vdmUodGhpcy5jb250YWN0X2xpc3QsIGNvbnRhY3RfbGlzdF9pbmRleCwgMCk7CiAgICAgICAgICAgIC8vICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPWNvbnRhY3RfbGlzdF9pbmRleDsKICAgICAgICAgICAgLy8gICB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB0aGlzLnBob25lbm87CiAgICAgICAgICAgIC8vICAgLy8gdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9saXN0X2luZGV4XS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlCiAgICAgICAgICAgICAgdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLmNoYXRTY3JvbGxNZXNzYWdlcyhmYWxzZSk7CiAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoZWRfbWVzc2FnZV9zZWxlY3RlZCA9IHRoaXMuc2VhcmNoZWRfbWVzc2FnZVtpbmRleF0uc2VhcmNoX3RleHQKICAgICAgICAgICAgICAvLyAgY29uc29sZS5sb2codGhpcy5zZWFyY2hlZF9tZXNzYWdlW2luZGV4XSAsICJpbmRleCIgLCBpbmRleCk7CiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09PSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24ucGFnZSl7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaWYiKQogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlc19sb2FkZWQgPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbF90b3BfY2FsbGVkPXRydWUKICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZWxzZSIpCiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzX2xvYWRlZCA9IGZhbHNlICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfdG9wX2NhbGxlZD1mYWxzZQogICAgICAgICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlCiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgLy8gbGV0IHRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjdGV4dCIpCiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgLy8gdGV4dC5mb3JFYWNoKGVsZW09PnsKICAgICAgICAgICAgICAvLyAgIGlmKGVsZW0udGV4dENvbnRlbnQudHJpbSgpID09PSB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQudHJpbSgpKXsKICAgICAgICAgICAgICAvLyAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdhZGRfaGlnaGxpZ2h0JykKICAgICAgICAgICAgICAvLyAgICAgY29uc29sZS5sb2coImdvdGNoYSBpbnNpZGUgaWYiICwgZWxlbS5jbGFzc0xpc3QgLCB0aGlzLnNlYXJjaGVkX21lc3NhZ2Vfc2VsZWN0ZWQpCiAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZF9tc2cgPSB0aGlzLnNlYXJjaGVkX21lc3NhZ2VbaW5kZXhdLmRhdGVfdGltZTsKICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkX2RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdGVkX21zZykKICAgICAgICAgICAgICBpZihzZWxlY3RlZF9kaXYpe3NlbGVjdGVkX2Rpdi5zY3JvbGxJbnRvVmlldyh7YmVoYXZpb3I6ICJzbW9vdGgifSl9CiAgICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKHNlbGVjdGVkX2RpdiAsIHNlbGVjdGVkX21zZyApOwoKICAgICAgICAgICAgfSwgNDAwKTsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlLCdlZWVlZScpOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZ2V0X2NvbnRhY3RfbGlzdChlbmFibGVfYm90X3Jlc3BvbnNlcykgewogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLAogICAgICAgICAgewogICAgICAgICAgICBpc19nZXRfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW5hYmxlX2JvdF9yZXNwb25zZV9hbGw6IGVuYWJsZV9ib3RfcmVzcG9uc2VzCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgodGhpcy5hcGlfc3RhdHVzX2NvZGUuQ09OVEFDVFNfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpCiAgICAgICAgICAgICB8fCAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkpIHsKICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH1lbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKXsKICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHM7CiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgLy8gdGhpcy5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmNvbnRhY3RzOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgc2Nyb2xsX2Rvd24oKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCItLS0tc2Nyb2xsbGwiKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKICAgICAgICBpZiAoQm9vbGVhbihjb250YWluZXIuc2Nyb2xsSGVpZ2h0KSkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gY29uc29sZS5sb2coImhlcmUgc2NyIik7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyggY29udGFpbmVyLnNjcm9sbFRvcCAsICBjb250YWluZXIuc2Nyb2xsSGVpZ2h0KTsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0IC0gNTAwOwogICAgICAgIH0sIDEwMCkKICAgICAgICAvLyB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgfQogICAgICB9LCAxMDApOyAKICAgIH0sCiAgICBzY3JvbGxfdG9wKCkgewogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5tZXNzYWdlLXRhYmxlLXNjcm9sbCIpOwogICAgICAgIGlmIChCb29sZWFuKGNvbnRhaW5lci5zY3JvbGxIZWlnaHQpKSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodCowLjAxNTsKICAgICAgICB9LCAxMDApCiAgICAgICAgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgIH0KICAgICAgfSwgMTAwKTsgCiAgICB9LAogICAgc2Nyb2xsX21pZGRsZSgpIHsKICAgICAgLy8gY29uc29sZS5sb2coIm1pZGRsZSBydW5uaW5nIikKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKICAgICAgICBpZiAoQm9vbGVhbihjb250YWluZXIuc2Nyb2xsSGVpZ2h0KSkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQqMC4yNTsKICAgICAgICB9LCAxMDApCiAgICAgICAgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgIH0KICAgICAgfSwgMTAwKTsgCiAgICB9LAogICAgc2Nyb2xsX2Rvd25fZWZmZWN0KCkgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm1lc3NhZ2UtdGFibGUtc2Nyb2xsIik7CiAgICAgIC8vIGNvbnNvbGUubG9nKGNvbnRhaW5lcik7CiAgICAgIGlmIChCb29sZWFuKGNvbnRhaW5lcikpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSAxMDsKICAgICAgICB9LCAwKQogICAgICAgIC8vIHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgcHJvZHVjdF92YXJpYXRpb24ocHJvZHVjdHNfbGlzdCkgewogICAgICBsZXQgbmV3X3Byb2R1Y3RfbGlzdCA9IFtdOwogICAgICBmb3IgKGxldCBpIGluIHByb2R1Y3RzX2xpc3QpIHsKICAgICAgICBsZXQgY29tcG9uZW50cyA9IHByb2R1Y3RzX2xpc3RbaV0udGVtcGxhdGUuY29tcG9uZW50czsKICAgICAgICBsZXQgdGVtcCA9IHt9OwogICAgICAgIHRyeSB7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaiBpbiBjb21wb25lbnRzKSB7CiAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgIHRlbXBbImltZ191cmwiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS5pbWFnZS5saW5rOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGogPT0gMSkgewoKICAgICAgICAgICAgdGVtcFsidGl0bGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS50ZXh0OwogICAgICAgICAgICBpZihjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMubGVuZ3RoID09IDIpIHsKICAgICAgICAgICAgICB0ZW1wWyJwcmljZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7CiAgICAgICAgICAgICAgdGVtcFsidmFyaWF0aW9uIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsKICAgICAgICAgICAgfSAKICAgICAgICAgICAgaWYoY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAzKSB7IAogICAgICAgICAgICAgIHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7IAogICAgICAgICAgICAgIHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMl0udGV4dAogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy5sZW5ndGggPT0gMyA/IHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7IHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDogbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaiA9PSAyKSB7CiAgICAgICAgICAgIHRlbXBbInVybCJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzBdLnRleHQ7CiAgICAgICAgICAgIHRlbXBbInR5cGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy50eXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgfQogICAgICAgIG5ld19wcm9kdWN0X2xpc3QucHVzaCh0ZW1wKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3X3Byb2R1Y3RfbGlzdDsKICAgIH0sCiAgICBjaGVja19pbWFnZV90eXBlKGltYWdlKSB7CiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGltYWdlICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBpbWFnZS5zcmM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB0cmltX2NhcmRfZGVzY3JpcHRpb24odGV4dCkgewogICAgICBpZiAoQm9vbGVhbih0ZXh0KSl7CiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwKSB7CiAgICAgICAgICBsZXQgc3RyaW5nX3RleHQgPSB0ZXh0LnN1YnN0cmluZygwLCA4MCkgKyAiLi4uIjsKICAgICAgICAgIHJldHVybiBzdHJpbmdfdGV4dDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICAgIH0KICAgIH0sCiAgICBsYXRlc3RfYm90X3RleHQodGV4dCkgewogICAgICBpZighQm9vbGVhbih0ZXh0KSl7CiAgICAgICAgcmV0dXJuICJDdXN0b20gYm90IFJlc3BvbnNlIgogICAgICB9CiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDM1KSB7CiAgICAgICAgcmV0dXJuIGAke3RleHQuc3Vic3RyaW5nKDAsIDM1KX0uLi5gOwogICAgICB9CiAgICAgIHJldHVybiB0ZXh0OwogICAgfSwKICAgIHNlYXJjaF9jb250YWN0X2xpc3QoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF92YWx1ZSA9PSAiIikgewogICAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RfbGlzdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgbmV3X3ZhbCA9IHRoaXMuc2VhcmNoX3ZhbHVlOwogICAgICAgIGlmIChuZXdfdmFsICE9IHRoaXMuc2VhcmNoX3ZhbHVlKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlYXJjaF92YWx1ZSk7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBpc19nZXRfYWxsX2NvbnRhY3RzOiB0cnVlLAogICAgICAgICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgICAgc2VhcmNoX3N0cmluZzogdGhpcy5zZWFyY2hfdmFsdWUsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkNPTlRBQ1RTX05PVF9GT1VORC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb250YWN0czsKICAgICAgICAgICAgICB9ZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9OT1RfRk9VTkQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5jb250YWN0X2xpc3Q7CiAgICAgIH0KICAgIH0sCiAgICBjaGF0U2Nyb2xsTWVzc2FnZXMoc2Nyb2xsX2Rvd24pIHsKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCk7CiAgICAgIGlmICh0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID09PSB0cnVlKSB7CiAgICAgICAgaWYodGhpcy5pc19zZWFyY2hfZGl2X29wZW4pewogICAgICAgICAgbGV0IGJvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpCiAgICAgIGJvdF9tc2cuZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJyZXNwb25zaXZlLXdpZHRoIikgICAgICAgCiAgICAgIH0pCiAgICAgIAogICAgICBsZXQgcHJldmlld19idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjcHJldmlldy1idG4iKQogICAgICBwcmV2aWV3X2J0bi5mb3JFYWNoKGVsZW09PnsKICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoImNvbC1zbS0xMSIpICAgICAgIAogICAgICB9KQogICAgICAgbGV0IGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIikKICAgICAgYm90X2NhcmQuZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCJjb2wtNyIpICAgICAgIAogICAgICB9KQogICAgICAgIH1lbHNlewogICAgICAgICAgbGV0IGJvdF9tc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbXNnLWRpdiIpCiAgICAgIGJvdF9tc2cuZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJyZXNwb25zaXZlLXdpZHRoIikgICAgICAgCiAgICAgIH0pCiAgICAgICAgbGV0IHByZXZpZXdfYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3ByZXZpZXctYnRuIikKICAgICAgcHJldmlld19idG4uZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJjb2wtc20tMTEiKSAgICAgICAKICAgICAgfSkKICAgICAgbGV0IGJvdF9jYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmJvdC1yZXNwIikKICAgICAgYm90X2NhcmQuZm9yRWFjaChlbGVtPT57CiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJjb2wtNyIpICAgICAgIAogICAgICB9KQogICAgICAgIH0KICAgICAgICBsZXQgY29udGFpbmVyX2Rpdl9zY3JvbGxfdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICAgICAgICJtZXNzYWdlLXRhYmxlLXNjcm9sbCIKICAgICAgICApWzBdLnNjcm9sbFRvcDsKICAgICAgIGxldCBjb250YWluZXJfZGl2X3Njcm9sbF9oZWlnaHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgIm1lc3NhZ2UtdGFibGUtc2Nyb2xsIgogICAgICAgIClbMF0uc2Nyb2xsSGVpZ2h0IC0gNDkzOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2Nyb2xsX3RvcF9jYWxsZWQgLCAidG9wIik7CiAgICAgIC8vICAgY29uc29sZS5sb2codGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAsICJwYWdpbmF0ZWQgY2FsbCB2YXIgIikKICAgICAgICAvLyBjb25zb2xlLmxvZyhjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPCAyMCAsIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9PT0gdHJ1ZSAsICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICwgIXRoaXMudG90YWxfcGFnZXNfbG9hZGVkICwgImNoZWNrIGZvciB1cCIpCiAgICAgIC8vICBjb25zb2xlLmxvZyhjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPiBjb250YWluZXJfZGl2X3Njcm9sbF9oZWlnaHQgLCB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9PT0gdHJ1ZSAsICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICwgdGhpcy5jdXJyZW50X3BhZ2Vfbm8gPiAxICwgImNoZWNrIGZvciBkb3duIikKCiAgICAgICAgaWYgKGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA8IDIwICYmIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9PT0gdHJ1ZSAmJiAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAmJiAhdGhpcy50b3RhbF9wYWdlc19sb2FkZWQpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCBwYWdpbmF0ZWQiLCB0aGlzLmN1cnJlbnRfcGFnZV9ubykKICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSB0cnVlOwogICAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGdldF9ieV93aGF0c2FwcF9waG9uZV9udW1iZXI6IHRydWUsCiAgICAgICAgICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5jdXJyZW50X3BhZ2Vfbm8gKyAxLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLmluY2x1ZGVzKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSkgewogICAgICAgICAgICAgICAgICBsZXQgbmV3X2RhdGEgPSB0aGlzLmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0X2hpc3RvcnkpOwogICAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkgPSBuZXdfZGF0YS5jb25jYXQodGhpcy5oaXN0b3J5KTsKICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5wdXNoKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5oaXN0b3J5KTsKICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT09IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKXsKICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXNfbG9hZGVkID0gdHJ1ZQogICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXNfbG9hZGVkID0gZmFsc2UgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3BhZ2Vfbm8gKz0gMTsKICAgICAgICAgICAgICAgICAgaWYoc2Nyb2xsX2Rvd24gPT0gdHJ1ZSB8fCB0eXBlb2Yoc2Nyb2xsX2Rvd24pID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX21pZGRsZSgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2Nyb2xsX2Rvd25fZWZmZWN0KCkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewoKICAgICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH1lbHNlIGlmKGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA+IGNvbnRhaW5lcl9kaXZfc2Nyb2xsX2hlaWdodCAmJiB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfZG93biA9PT0gdHJ1ZSAmJiAhdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCAmJiB0aGlzLmxhdGVzdF9wYWdlX25vID4gMSl7CiAgICAgICAgICAgdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgICB0aGlzLnNjcm9sbF9zcGlubmVyX2NoYXQgPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgZ2V0X2J5X3doYXRzYXBwX3Bob25lX251bWJlcjogdHJ1ZSwKICAgICAgICAgICAgICAgIHdoYXRzYXBwX2NvbnRhY3RfbnVtYmVyOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICAgICAgICBwYWdlX25vOiAgdGhpcy5sYXRlc3RfcGFnZV9ubyAtIDEsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCA9IGZhbHNlOwogICAgICAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLmluY2x1ZGVzKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi5wYWdlKSkgewogICAgICAgICAgICAgICAgICBsZXQgbmV3X2RhdGEgPSB0aGlzLmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlLmRhdGEuZGF0YS5jaGF0X2hpc3RvcnkpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLmhpc3RvcnkgPSBuZXdfZGF0YS5jb25jYXQodGhpcy5oaXN0b3J5KTsKICAgICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5ID0gdGhpcy5oaXN0b3J5LmNvbmNhdChuZXdfZGF0YSk7CgogICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkLnB1c2gocmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnBhZ2UpOwogICAgICAgICAgICAgICAgICAgdGhpcy5sYXRlc3RfcGFnZV9ubyA9IHRoaXMubGF0ZXN0X3BhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCItLS0iICwgdGhpcy5zY3JvbGxfdG9wX2NhbGxlZCkKICAgICAgICAgICAgICAgICAgLy8gICAgaWYodGhpcy5zY3JvbGxfdG9wX2NhbGxlZCl7CiAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5zY3JvbGxfdG9wKCk7CiAgICAgICAgICAgICAgICAgIC8vIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgaWYoc2Nyb2xsX2Rvd24gPT0gdHJ1ZSB8fCB0eXBlb2Yoc2Nyb2xsX2Rvd24pID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZG93biIpCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuc2Nyb2xsX2Rvd25fZWZmZWN0KCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfdG9wX2NhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgfSwxMDApCiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewoKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNob3dfcHJvZmlsZV9zZXR1cCgpIHsKICAgICAgdGhpcy5pc19wcm9maWxlX3NldHVwID0gIXRoaXMuaXNfcHJvZmlsZV9zZXR1cDsKICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICB9LAogICAgc2hvd19hbGxfY29udGFjdHMoKXsKICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignZGlzcG9zZScpICAKICAgICAgICAgICQoJyNwb3BvdmVyJykucG9wb3ZlcignaGlkZScpICAKICAgICAgdGhpcy5pc19vcGVuID0gZmFsc2U7CiAgICAgIHRoaXMuaXNfcHJvZmlsZV9zZXR1cCA9ICF0aGlzLmlzX3Byb2ZpbGVfc2V0dXA7CiAgICAgIHRoaXMuaXNfY29udGFjdF9saXN0ID0gIXRoaXMuaXNfY29udGFjdF9saXN0OwogICAgICB0aGlzLmdldF9hbGxfY29udGFjdF9saXN0KCk7CiAgICB9LAogICAgdG9nZ2xlRHJvcGRvd24oKXsKICAgICAgIGxldCBkcm9wZG93blBhcmVudDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQyJykKICAgICAgICAgICAgbGV0IGRyb3Bkb3duTWVudTIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51MicpCiAgICAgICAgICAgIGxldCBkcm9wZG93bk1lbnVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uMicpCiAgICAgICAgIGRyb3Bkb3duUGFyZW50Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgICAgZHJvcGRvd25NZW51Mi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgICAgZHJvcGRvd25NZW51QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJykKICAgICAgICAgICAgICBkcm9wZG93bk1lbnUyLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7JykKICAgICAgICAgICAgICB0aGlzLnRvZ2dsZU1vZGFsMiA9IGZhbHNlCiAgICAgICAgICAgIGxldCBkcm9wZG93blBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudCcpCiAgICAgICAgICAgIGxldCBkcm9wZG93bk1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51JykKICAgICAgICAgICAgbGV0IGRyb3Bkb3duTWVudUJ1dHRvbk9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b25PbmUnKQoKICAgICAgaWYodGhpcy50b2dnbGVNb2RhbCl7CiAgICAgIGRyb3Bkb3duUGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51QnV0dG9uT25lLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZCcsICd0cnVlJykKICAgICAgZHJvcGRvd25NZW51LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyB3aWxsLWNoYW5nZTogdHJhbnNmb3JtOyB0b3A6IDBweDsgbGVmdDogMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDU1cHgsIDU4cHgsIDBweCk7JykKICAgCiAgICAgIH1lbHNlewogICAgICBkcm9wZG93blBhcmVudC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duTWVudS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgIGRyb3Bkb3duTWVudUJ1dHRvbk9uZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZXhwYW5kZWQnLCAndHJ1ZScpCiAgICAgIGRyb3Bkb3duTWVudS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpCiAgIAogICAgICB9CiAgICAgCiAgICAgICAgIHRoaXMudG9nZ2xlTW9kYWwgPSAhdGhpcy50b2dnbGVNb2RhbAogICAgfSwKICAgIHRvZ2dsZVRlbXBsYXRlKCl7CiAgICAgICAgICBsZXQgZHJvcGRvd25QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QYXJlbnQnKQogICAgICAgICAgICBsZXQgZHJvcGRvd25NZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duTWVudScpCiAgICAgICAgICAgIGxldCBkcm9wZG93bk1lbnVCdXR0b25PbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25NZW51QnV0dG9uT25lJykKICAgICAgICAgICAgCiAgICAgICAgZHJvcGRvd25NZW51LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgZHJvcGRvd25QYXJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgICBkcm9wZG93bk1lbnVCdXR0b25PbmUucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkJywgJ3RydWUnKQogICAgICAgICAgICBkcm9wZG93bk1lbnUucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScsICdwb3NpdGlvbjogYWJzb2x1dGU7IHdpbGwtY2hhbmdlOiB0cmFuc2Zvcm07IHRvcDogMHB4OyBsZWZ0OiAwcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNTVweCwgNThweCwgMHB4KTsnKQogICAgICAgICAgICB0aGlzLnRvZ2dsZU1vZGFsID0gZmFsc2UKICAgICAgICAgICAgbGV0IGRyb3Bkb3duUGFyZW50MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blBhcmVudDInKQogICAgICAgICAgICBsZXQgZHJvcGRvd25NZW51MiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnUyJykKICAgICAgICAgICAgbGV0IGRyb3Bkb3duTWVudUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93bk1lbnVCdXR0b24yJykKICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiAsICJkZWNpZGluZyB2YWx1ZSIpCiAgICAgIGlmKHRoaXMudG9nZ2xlTW9kYWwyKXsKICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMudG9nZ2xlTW9kYWwyKQogICAgICBkcm9wZG93blBhcmVudDIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICBkcm9wZG93bk1lbnUyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJykKICAgICAgZHJvcGRvd25NZW51Mi5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpCiAgICAgIHRoaXMudG9nZ2xlTW9kYWwyPWZhbHNlCiAgICAgIC8vY29uc29sZS5sb2codGhpcy50b2dnbGVNb2RhbDIsImFmdGVyIGRlY2lkaW5nIik7CiAgICAgIH1lbHNlewogICAgICBkcm9wZG93blBhcmVudDIuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICBkcm9wZG93bk1lbnUyLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgZHJvcGRvd25NZW51QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJykKICAgICAgZHJvcGRvd25NZW51Mi5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg1NXB4LCA1OHB4LCAwcHgpOycpCiAgICAgIHRoaXMudG9nZ2xlTW9kYWwyPXRydWUKICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnRvZ2dsZU1vZGFsMiwiYWZ0ZXIgZGVjaWRpbmciKTsKICAgICAgfQogICAgIAogICAgICAgICAKICAgIH0sCiAgICBmb3JtYXRfaGlzdG9yeV9yZXNwb25zZShyZXNwb25zZSkgewogICAgICBsZXQgY29uX2RhdGUgPSAiIjsKICAgICAgZm9yIChsZXQgaSBpbiByZXNwb25zZSkgewogICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgIGNvbl9kYXRlID0gcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgfQogICAgICAgIGlmIChjb25fZGF0ZSA9PSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZSAmJiBpICE9IDApIHsKICAgICAgICAgIHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbl9kYXRlID0gcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0sCiAgICBzZW5kX21lc3NhZ2VfdG9fdXNlcigpIHsKICAgICAgaWYoQm9vbGVhbih0aGlzLm1lc3NhZ2VfdG9fc2VuZCk9PT0gZmFsc2UgJiYgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGxldCBjdXJyZW50X3RpbWVzdGFtcCA9ICBuZXcgRGF0ZSgpLAogICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpCiAgICAgICAgaWYodGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSB0cnVlKXsKICAgICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5jb21wYW55X2lkID0gdGhpcy5jb21wYW55X2lkOwogICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmNvbXBhbnlfbmFtZSA9IHRoaXMuY29tcGFueV9uYW1lOwogICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLndoYXRzYXBwX2NvbnRhY3RfbnVtYmVyID0gdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyOwogICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmRvY3VtZW50X2NvbnRlbnQgPSBudWxsOwogICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NhcHRpb24gPSB0aGlzLm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZW5kX2F0dGFjaG1lbnQiKS52YWx1ZSA9ICcnOwogICAgICAgICAgICBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9NRURJQV9TRU5EX1NVQ0NFU1NGVUxMWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKXsKICAgICAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlID0gW107CiAgICAgICAgICAgICAgaWYodGhpcy5maWxlX2V4dGVuc2lvbnMuZG9jdW1lbnRfZmlsZV9leHRlbnNpb25zLmluY2x1ZGVzKHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUpKXsKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZSA9IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAidGV4dCI6IG51bGwsIAogICAgICAgICAgICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICAgICAgICAgICJhdHRhY2htZW50IiA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgOiBgaHR0cHM6Ly9zdG9yYWdlLmNlbnNlLmFpLyR7dGhpcy5jb21wYW55X2lkfS9XaGF0c2FwcE1lZGlhLyR7dGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGVfbmFtZX1gCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZih0aGlzLmZpbGVfZXh0ZW5zaW9ucy5pbWFnZV9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXModGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZSkpewogICAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlID0gWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogbnVsbCwgCiAgICAgICAgICAgICAgICAgICAgICAicmVjaXBpZW50X2lkIjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgImltYWdlIiA6IHJlc3BvbnNlLmRhdGEuZmlsZV9saW5rCiAgICAgICAgICAgICAgICAgICAgfSwgCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKICAgICAgICAgICAgICBpZih0aGlzLmhpc3RvcnkubWFwKGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZSkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogYm90X3Jlc3BvbnNlLAogICAgICAgICAgICAgICAgICAidXNlcl9xdWVyeV90aW1lIjpjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgIlVzZXJRdWVyeSI6ICIiLAogICAgICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwgCiAgICAgICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfdGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLCAKICAgICAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAgICAgIkNoYXRfRGF0ZXRpbWUiOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFt0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IHRoaXMubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCwgMCk7CiAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgICAvLyB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfZG93bigpOwogICAgICAgICAgICB9IGVsc2UgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfTUVESUFfU0VORF9GQUlMVVJFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHRyeSBhZ2FpbiIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1VTRVJfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5NRVNTQUdFX1NFTkRJTkdfTElNSVRfUkVBQ0hFRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOicjMzA4NWQ2JywKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZycpLAogICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJywKICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICdTZXR0aW5ncycscGFyYW1zOntTdWJzY3JpcHRpb246dHJ1ZX19KTsgICAgIAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX1dIQVRTQVBQX0NPTlRBQ1QuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX05VTUJFUl9OT05FLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5URVhUX0lTX05PTkUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk1JU1NJTkdfTUVESUFfSU5GT1JNQVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgaWYodGhpcy5tZXNzYWdlX3RvX3NlbmQudHJpbSgpICE9PSAiIil7CgogICAgCiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIHNlbmRfbWVzc2FnZTogdHJ1ZSwKICAgICAgICB0ZXh0OiB0aGlzLm1lc3NhZ2VfdG9fc2VuZCwKICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICB9LAogICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVEVYVF9TRU5EX1NVQ0NFU1NGVUxMWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKXsKICAgICAgICAgIGlmKHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udil7CiAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLCAKICAgICAgICAgICAgICBjaGF0X2RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpLCAKICAgICAgICAgICAgICBkYXRlOiBjdXJyZW50X2RhdGUsIAogICAgICAgICAgICAgIHRpbWU6IGAke2N1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCl9OiR7Y3VycmVudF90aW1lc3RhbXAuZ2V0VVRDTWludXRlcygpfWAKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdC51bnNoaWZ0KAogICAgICAgICAgICAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhCiAgICAgICAgICAgICkKICAgICAgICAgICAgdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICBpZih0aGlzLmhpc3RvcnkubWFwKGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZSkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICJCT1RSZXNwb25zZSI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgInRleHQiOiB0aGlzLm1lc3NhZ2VfdG9fc2VuZCwgCiAgICAgICAgICAgICAgICAgICJyZWNpcGllbnRfaWQiOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIKICAgICAgICAgICAgICAgIH0sIAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6Y3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgIlVzZXJRdWVyeSI6ICIiLAogICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfZGF0ZSI6IGJvdF9yZXNwb25zZV9kYXRlLCAKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwgCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAiQ2hhdF9EYXRldGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgKTsKICAgICAgICAgIHRoaXMuc2Nyb2xsX2Rvd24oKTsKICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W3RoaXMuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHRoaXMuYXJyYXlfbW92ZSh0aGlzLmNvbnRhY3RfbGlzdCwgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfVVNFUl9MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZF9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA0MDAwLAogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6JyMzMDg1ZDYnLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICdTZXR0aW5ncycscGFyYW1zOntTdWJzY3JpcHRpb246dHJ1ZX19KTsgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9XSEFUU0FQUF9DT05UQUNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9XSEFUU0FQUF9DT05UQUNULk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9OVU1CRVJfTk9ORS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLlRFWFRfSVNfTk9ORS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk1JU1NJTkdfTUVESUFfSU5GT1JNQVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5hcGlfZXJyb3JfY2hlY2tzKGUucmVzcG9uc2UpCiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICB9KQogICAgICB9ZWxzZXsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0aGlzLm1lc3NhZ2VfdG9fc2VuZCA9IG51bGwKICAgICAgICByZXR1cm4KICAgICAgfQogICAgfSwKICAgIGVkaXRfd2Vic2l0ZV92YWx1ZShpbmRleCl7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gaW5kZXg7CiAgICAgIHRoaXMuZWRpdF93ZWJzaXRlID0gdHJ1ZTsKICAgIH0sCiAgICBnZXRfcHJvZmlsZV9kZXRhaWxzKCl7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5lZGl0X2VtYWlsID1mYWxzZTsKICAgICAgdGhpcy5lZGl0X2FkZHJlc3MgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X2Rlc2NyaXB0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF93ZWJzaXRlID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9zdGF0dXMgPSBmYWxzZTsKICAgICAgdGhpcy5pbmRleF91cGRhdGUgPSBudWxsIDsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZ2V0OnRydWUKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF9wcm9maWxlID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Byb2ZpbGU7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF9wcm9maWxlID0gcmVzcG9uc2UuZGF0YS5kYXRhLndoYXRzYXBwX3Byb2ZpbGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlX3Byb2ZpbGVfZGV0YWlscygpewogICAgICB0aGlzLmVkaXRfZW1haWwgPWZhbHNlOwogICAgICB0aGlzLmVkaXRfYWRkcmVzcyA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfZGVzY3JpcHRpb24gPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3dlYnNpdGUgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X3N0YXR1cyA9IGZhbHNlOwogICAgICB0aGlzLmluZGV4X3VwZGF0ZSA9IG51bGwgOwogICAgICBpZiAodGhpcy53aGF0c2FwcF9wcm9maWxlLndlYnNpdGVzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgdGhpcy5zZWNvbmRfd2Vic2l0ZSA9IHRydWU7IAogICAgICB9CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZWRpdDp0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9wcm9maWxlOnRoaXMud2hhdHNhcHBfcHJvZmlsZQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBsZXQgcmVzcCA9IHJlc3BvbnNlLmRhdGEudXBkYXRlX3Jlc3BvbnNlOwogICAgICAgICAgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfUFJPRklMRV9FRElUX1NVQ0NFU1NGVUwuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfRURJVF9VTlNVQ0NFU1NGVUwuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnd2hhdHNhcHBfcHJvZmlsZV9lZGl0ZWRfdW5zdWNjZXNzJyksCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZV9wcm9maWxlX2ltYWdlKGUpewogICAgICB0aGlzLnNlbGVjdGVkX2ZpbGVzID0gZS50YXJnZXQuZmlsZXNbMF07CiAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ZpbGVzLnR5cGUgPT0gJ2ltYWdlL3BuZycgfHwgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICdpbWFnZS9qcGcnIHx8IHRoaXMuc2VsZWN0ZWRfZmlsZXMudHlwZSA9PSAnaW1hZ2UvanBlZycgICkgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkX2ZpbGVzLnNpemUgPiA1MDk3MTUyKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNpemUgc2hvdWxkIGJlIGxlc3MgdGhhbiA1TUIiLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjAwMAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ZpbGVzID0nJzsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBsZXQgZmlsZV90b191cGxvYWQgPSB0aGlzLnNlbGVjdGVkX2ZpbGVzOwogICAgICAgIHZhciBwcm9maWxlX2ltZyA9IHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBwaG90bzpmaWxlX3RvX3VwbG9hZCwKICAgICAgICAgICAgd2FfcGhvbmVfbnVtYmVyOiB0aGlzLndoYXRzYXBwX3Byb2ZpbGUud2hhdHNhcHBfcGhvbmVfbnVtYmVyCiAgICAgICAgICB9CiAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeShwcm9maWxlX2ltZyk7CiAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZmQuYXBwZW5kKAogICAgICAgICAgJ3Bob3RvJywKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfZmlsZXMKICAgICAgICApCiAgICAgICAgZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX3Byb2ZpbGUoKSxmZCwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBsZXQgcmVzcCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuVVBEQVRFRF9XSEFUU0FQUF9QUk9GSUxFX1BIT1RPLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0gZWxzZSBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5QRU5ESU5HX1dIQVRTQVBQX1BST0ZJTEVfUEhPVE9fVVBEQVRJT04uTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX1BST0ZJTEVfUElDVFVSRV9VTkRFUl9SRVNPTFVUSU9OLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH1lbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9QSE9UT19VUERBVElPTl9GQUlMRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KQogICAgICAgICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0gICAgICAKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH1lbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNwZWNpZmljIGZvcm1hdGUoanBnIGpwZWcgcG5nKSIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHJlbW92ZV9wcm9maWxlX2ltYWdlKCl7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfcmVtb3ZlX3Bob3RvOnRydWUKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9QUk9GSUxFX1BIT1RPX1JFTU9WRUQuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5GQUlMRURfV0hBVFNBUFBfUFJPRklMRV9QSE9UT19SRU1PVkFMLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgY29ubmVjdF9lbGl4aXJfc29ja2V0KCl7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSx7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogIjEwMCIKICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgICAvLyB0aGlzLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgICAgIC8vIHRoaXMubGl2ZV9jaGF0X3Rva2VuID0gcmVzcG9uc2UuZGF0YS50b2tlbjsKICAgICAgICAvLyB0aGlzLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAgICAgdGhpcy5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQoCiAgICAgICAgICBwcm9jZXNzLmVudi5WVUVfQVBQX0xJVkVfQ0hBVF9XRUJTT0NLRVRfRU5EUE9JTlQsCiAgICAgICAgICB7CiAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgIHdoYXRzYXBwOiAidHJ1ZSIsCiAgICAgICAgICAgICAgdG9rZW4gOiByZXNwb25zZS5kYXRhLnRva2VuCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgICB0aGlzLmNoYXRfc29ja2V0LmNvbm5lY3QoKTsKICAgICAgICB0aGlzLmNoYW5uZWwgPSB0aGlzLmNoYXRfc29ja2V0LmNoYW5uZWwoCiAgICAgICAgICAid2hhdHNhcHA6IiArIHJlc3BvbnNlLmRhdGEud2hhdHNhcHBfdG9waWMKICAgICAgICApOwogICAgICAgIHRoaXMuY2hhbm5lbC5qb2luKCk7CiAgICAgICAgdGhpcy5jaGFubmVsLm9uKCJuZXdfd2hhdHNhcHBfbWVzc2FnZSIsIChyZXMpID0+IHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJuZXdfd2hhdHNhcHBfbWVzc2FnZSIsIHJlcykKICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGVuYWJsZV9zZW5kaW5nX21lc3NhZ2VzX2Zvcl91c2VyKCl7CiAgICAgIGF4aW9zLnBvc3QoYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwgewogICAgICAgIHVwZGF0ZV9ib3RfcmVzcG9uc2U6IHRydWUsCiAgICAgICAgd2hhdHNhcHBfY29udGFjdF9udW1iZXI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICBib3RfcmVzcG9uc2U6IGZhbHNlLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICB9LAogICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgaWYodGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID09PSB0cnVlKXsKCiAgICAgICAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFt0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleF0uaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5jb250YWN0X2xpc3QsIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4LCB0aGlzLmNvbnRhY3RfbGlzdFt0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleF0pOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAvLyB0aGlzLiRyZWZzWyJtZXNzYWdlX3NlbmRpbmdfdGV4dGJveCJdLmZvY3VzKCk7CiAgICAgICAgICB9KQogICAgICAgIH0gZWxzZSBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgaWYodGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID09PSB0cnVlKXsKICAgICAgICAgICAgdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W3RoaXMuY3VycmVudF9jb250YWN0X2luZGV4XS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmNvbnRhY3RfbGlzdCwgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIHRoaXMuY29udGFjdF9saXN0W3RoaXMuY3VycmVudF9jb250YWN0X2luZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIC8vIHRoaXMuJHJlZnNbIm1lc3NhZ2Vfc2VuZGluZ190ZXh0Ym94Il0uZm9jdXMoKTsKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKXsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2RiX29wZXJhdGlvbl91bnN1Y2Nlc3MnKSwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk1FU1NBR0VfU0VORElOR19MSU1JVF9SRUFDSEVELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6JyMzMDg1ZDYnLAogICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbm93X21zZycpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCdlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9sYXRlcl9tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICdTZXR0aW5ncycscGFyYW1zOntTdWJzY3JpcHRpb246dHJ1ZX19KTsgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOjI1MDAKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICB9KQogICAgfSwgCiAgICBleHBhbmRfdGV4dGJveChpZCwga2V5KSB7CiAgICAgIGlmIChpZCAhPSAnI2J1c2luZXNzX2FkZHJlc3MnKSB7CiAgICAgICAgdGhpcy5jYWxsc2VhcmNoKCk7CiAgICAgIH1lbHNlewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+ewogICAgICAgICAgbGV0IHNjcm9sbF9oZWlnaHQgPWUudGFyZ2V0LnNjcm9sbEhlaWdodDsKICAgICAgICAgIHRleHRhcmVhLnN0eWxlLmhlaWdodCA9IGAke3Njcm9sbF9oZWlnaHR9cHhgCiAgICAgICAgfSk7CiAgICAgICAgfSwxMCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgdGhpcy51cGRhdGVfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X251bWJlcihyZXMpewogICAgICByZXR1cm4gcmVzLndoYXRzYXBwX3Bob25lX251bWJlciA9PT0gdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID8gdHJ1ZSA6IGZhbHNlOwogICAgfSwKICAgIGZvcm1hdF91c2VyX3F1ZXJ5X2RhdGUodXNlcl9xdWVyeV9kYXRlLCBpbmRleCl7CiAgICAgIC8vIGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKHRoaXMuaGlzdG9yeVtpbmRleC0xXSkpCiAgICAgIGlmKHRoaXMuaGlzdG9yeVtpbmRleC0xXS51c2VyX3F1ZXJ5X2RhdGUgPT0gdXNlcl9xdWVyeV9kYXRlKXsKICAgICAgICByZXR1cm4gIiIKICAgICAgfQogICAgICByZXR1cm4gdXNlcl9xdWVyeV9kYXRlCiAgICB9LAogICAgZ2V0X2FsbF9jb250YWN0X2xpc3QoKSB7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5DT05UQUNUU19OT1RfRk9VTkQuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH1lbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5hbGxfY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbnRhY3RzOwogICAgICAgICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgfWVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIC8vRE9ORQogICAgbmV3X2NvbnRhY3RfbGlzdCgpIHsKICAgICAgIGxldCBzY3JvbGxlciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FsbC1jb250YWN0LWxpc3QnKVswXS5zY3JvbGxUb3A7CiAgICAgICBpZiAoc2Nyb2xsZXIgPiAxMjAgJiYgIXRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgJiYgIXRoaXMudG90YWxfY29udGFjdF9sb2FkZWQpIHsKICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gdHJ1ZTsKICAgICAgICB0aGlzLnNjcm9sbF9zcGlubmVyX2NoYXQgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyArIDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkNPTlRBQ1RTX05PVF9GT1VORC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHMubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hbGxfY29udGFjdF9saXN0ID0gdGhpcy5hbGxfY29udGFjdF9saXN0LmNvbmNhdChyZXNwb25zZS5kYXRhLmRhdGEuY29udGFjdHMpOwogICAgICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICs9IDE7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfWVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfTk9UX0ZPVU5ELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNjcm9sbF9zcGlubmVyX2NoYXQgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSwKICAgIGFycmF5X21vdmUoYXJyLCBvbGRfaW5kZXgsIG5ld19pbmRleCkgewogICAgICBpZiAobmV3X2luZGV4ID49IGFyci5sZW5ndGgpIHsKICAgICAgICAgIHZhciBrID0gbmV3X2luZGV4IC0gYXJyLmxlbmd0aCArIDE7CiAgICAgICAgICB3aGlsZSAoay0tKSB7CiAgICAgICAgICAgICAgYXJyLnB1c2godW5kZWZpbmVkKTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBhcnIuc3BsaWNlKG5ld19pbmRleCwgMCwgYXJyLnNwbGljZShvbGRfaW5kZXgsIDEpWzBdKTsKICAgICAgcmV0dXJuIGFycjsgLy8gZm9yIHRlc3RpbmcKICAgIH0sCiAgICBmb3JtYXRVc2VyUXVlcnlUaW1lKHVzZXJfcXVlcnlfdGltZSx2YWwpeyAgCiAgICAgIC8vIGlmICh2YWwgPT0gdW5kZWZpbmVkKSB7CiAgICAgIC8vICAgcmV0dXJuIG5ldyBEYXRlKHVzZXJfcXVlcnlfdGltZSkudG9Mb2NhbGVUaW1lU3RyaW5nKG5hdmlnYXRvci5sYW5ndWFnZSwgewogICAgICAvLyAgIGhvdXI6ICcyLWRpZ2l0JywKICAgICAgLy8gICBtaW51dGU6JzItZGlnaXQnCiAgICAgIC8vICAgfSkKICAgICAgLy8gfWVsc2V7CiAgICAgICAgcmV0dXJuIG1vbWVudC51dGModXNlcl9xdWVyeV90aW1lKS5sb2NhbCgpLmZvcm1hdCgiaDptbSBhIik7CiAgICAgIAogICAgICAvLyByZXR1cm4gdXNlcl9xdWVyeV90aW1lCiAgICB9LAogICAgaXNfYWN0aXZlX2NoYXQoaW5kZXgpIHsKICAgICAgaWYoaW5kZXggPT09IHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4KSB7CiAgICAgICAgcmV0dXJuICJiYWNrZ3JvdW5kOiAjZjBmOGZmIgogICAgICB9IGVsc2UgaWYodGhpcy5jb250YWN0X2xpc3RbaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gfHwgZmFsc2UpewogICAgICAgIHJldHVybiAiYmFja2dyb3VuZDogIzQ3YTg4NDMzIgogICAgICB9CiAgICAgIHJldHVybiAiYmFja2dyb3VuZDogI2ZmZmZmZiIKICAgIH0sCiAgICBmb3JtYXRDb250YWN0TGFzdE1lc3NhZ2VEYXRlKGRhdGUsIHRpbWUpIHsKICAgICAgaWYobW9tZW50KGRhdGUpLmlzU2FtZShEYXRlLm5vdygpLCAnZGF5JykpewogICAgICAgIHJldHVybiBuZXcgRGF0ZShgJHtkYXRlfSAke3RpbWV9WmApLnRvTG9jYWxlVGltZVN0cmluZyhuYXZpZ2F0b3IubGFuZ3VhZ2UsIHsKICAgICAgICBob3VyOiAnMi1kaWdpdCcsCiAgICAgICAgbWludXRlOicyLWRpZ2l0JwogICAgICB9KQogICAgICB9IAogICAgICByZXR1cm4gZGF0ZQogICAgfSwKICAgIGZvcm1hdFNlYXJjaGVkRGF0ZShkYXRlLCkgewogICAgICB2YXIgcmVzcG9uc2VEYXRlID0gbW9tZW50KGRhdGUpLmZvcm1hdCgnREQvTU0vWVlZWScpOwogICAgICAgIHJldHVybiByZXNwb25zZURhdGU7CiAgICB9LAogICAgY2hlY2tfcHJldmlvdXNfbWVzc2FnZV9kYXRlX3NhbWUoaW5kZXgpewogICAgICAvLyBjb25zb2xlLmxvZyhpbmRleCkKICAgICAgcmV0dXJuIHRydWU7IAogICAgICAvLyBpZihpbmRleCA9PSAwKSB7CiAgICAgIC8vICAgcmV0dXJuIHRydWU7IAogICAgICAvLyB9CiAgICAgIC8vIHJldHVybiB0aGlzLmhpc3RvcnlbaW5kZXgtMV0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gdGhpcy5oaXN0b3J5W2luZGV4XS5ib3RfcmVzcG9uc2VfZGF0ZSA/IHRydWUgOiBmYWxzZTsgCiAgICB9LAogICAgcHJvY2Vzc19hdHRhY2htZW50X2ZpbGUoZSkgewogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZpbGVfZXh0ZW5zaW9ucy5hbGxfYWxsb3dlZF9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoZmlsZXNbMF0udHlwZSkpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUgPSBmaWxlc1swXS50eXBlOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5kb2N1bWVudF9jb250ZW50ID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlc1swXSk7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IHRydWU7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX3R5cGUgPSB0aGlzLmZpbGVfZXh0ZW5zaW9ucy5pbWFnZV9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoZmlsZXNbMF0udHlwZSkgPyAnaW1hZ2UnOiAnZG9jdW1lbnQnOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jYXB0aW9uID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgdGhpcy5jcmVhdGVBdHRhY2htZW50KGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiUGxlYXNlIFNlbGVjdCBhIHByb3BlciBkb2N1bWVudCBvciBpbWFnZSBoYXZpbmcgdGhlIGNvcnJlY3QgZmlsZXR5cGUiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgfSkKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUF0dGFjaG1lbnQoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2ZpbGUgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWctcHJldmlldyIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltZy1wcmV2aWV3IikuaW5uZXJIVE1MID0gJzxpbWcgY2xhc3M9ImN1c3RvbS1kaXNwbGF5LWltYWdlIiBzdHlsZT0ibWF4LXdpZHRoOjk4JTtoZWlnaHQ6NDkwcHg7IHBhZGRpbmc6IDEuNXJlbTttYXJnaW4tbGVmdDogYXV0bzsgbWFyZ2luLXJpZ2h0OiBhdXRvOyIgc3JjPSInICsgdGhpcy5yZXN1bHQgKyAnIiAvPic7CiAgICAgIH0pOyAgICAKICAgIH0sCiAgICBpc19yZXNwb25zZV9pbWFnZShkYXRhKXsKICAgICAgaWYoZGF0YS50ZW1wbGF0ZSA9PSBudWxsICYmIGRhdGEudGV4dCA9PSBudWxsICYmIEJvb2xlYW4oZGF0YS5pbWFnZSkhPSBudWxsKXsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaXNfcmVzcG9uc2VfZG9jdW1lbnQoZGF0YSl7CiAgICAgIGlmKGRhdGEudGVtcGxhdGUgPT0gbnVsbCAmJiBkYXRhLnRleHQgPT0gbnVsbCAmJiBkYXRhLmltYWdlPT0gbnVsbCAmJiBCb29sZWFuKGRhdGEuYXR0YWNobWVudCkgIT0gbnVsbCl7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHNob3dfaW1hZ2VfZnVsbHNjcmVlbihpbWdfc3JjKXsKICAgICAgJCgiI3Nob3dJbWFnZU1vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gaW1nX3NyYzsKICAgIH0sCiAgICBhZGRfbmV3X2NvbnRhY3RfbW9kYWwoKXsKICAgICAgLy8gY29uc29sZS5sb2coImFkZCBuZXcgY29udGFjdC1hZGRDb250YWN0TW9kYWwiKQogICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICBzYXZlX25ld19jb250YWN0KCkgewogICAgICBpZih0aGlzLmFkZF9uZXdfY29udGFjdC5jb250YWN0X25hbWUgPT0gbnVsbCB8fCB0aGlzLmFkZF9uZXdfY29udGFjdC5waG9uZV9udW1iZXIgPT0gbnVsbCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6ICJGaWxsIGRldGFpbHMiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhIHZhbGlkIGNvbnRhY3QgbnVtYmVyIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgfSkKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9pZCA9IHRoaXMuY29tcGFueV9pZDsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9uYW1lID0gdGhpcy5jb21wYW55X25hbWU7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgLnBvc3QoCiAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSx0aGlzLmFkZF9uZXdfY29udGFjdCwKICAgICAgICB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLldIQVRTQVBQX0NPTlRBQ1RfQURERURfU1VDQ0VTU0ZVTExZLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogIkNvbnRhY3QgQWRkZWQgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgfSkKICAgICAgICAgICQoIiNhZGRDb250YWN0TW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgdGhpcy5jbGVhcl9hZGRfY29udGFjdCgpOwogICAgICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgICB9IGVsc2UgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfQ09OVEFDVF9BTFJFQURZX0VYSVNULk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICB0ZXh0OiAiUHJvdmlkZWQgbnVtYmVyIGFscmVhZHkgZXhpc3RzIGluIGNvbnRhY3RzIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pCiAgICAgIH0gZWxzZSBpZih0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9DT05UQUNUX1FVRVJZX0VSUk9SLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICB9KQogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goKGUpID0+IHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pCiAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJfYWRkX2NvbnRhY3QoKXsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QgPSB7CiAgICAgICAgcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICAgIGlzX2FkZF9jb250YWN0OiB0cnVlLAogICAgICAgIGNvbnRhY3RfbmFtZTogbnVsbCwKICAgICAgICBmb3JtYXR0ZWROdW1iZXI6IG51bGwKICAgICAgfQogICAgfSwKICAgIGRvd25sb2FkX2RvY3VtZW50KGF0dGFjaG1lbnQpewogICAgICAvLyBjb25zb2xlLmxvZyhhdHRhY2htZW50KQogICAgICB2YXIgYVRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgYVRhZy5zZXRBdHRyaWJ1dGUoJ2lkJywnYWJjZGVmZycpOwogICAgICBhVGFnLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCAnZG93bmxvYWQnKTsKICAgICAgYVRhZy5zZXRBdHRyaWJ1dGUoJ2hyZWYnLGF0dGFjaG1lbnQubGluayk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCJfYmxhbmsiKTsKICAgICAgYVRhZy5jbGljaygpOwoKICAgICAgLy8gY29uc3QgYmxvYiA9IG5ldyBCbG9iKFthdHRhY2htZW50LmxpbmtdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9wZGYnIH0pCiAgICAgIC8vIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgICAgLy8gbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKQogICAgICAvLyBsaW5rLmRvd25sb2FkID0gYXR0YWNobWVudC5maWxlbmFtZQogICAgICAvLyBsaW5rLmNsaWNrKCkKICAgICAgLy8gVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpCiAgICAgIC8vIGxpbmsuY2xpY2soKTsKICAgIH0sCiAgICBvcGVuX3NlbmRfdGVtcGxhdGVfdG9fdXNlcigpewogICAgICB0aGlzLnJldHJpZXZlX2FsbF90ZW1wbGF0ZXMoKTsKICAgICAgJCgiI3NlbmRUZW1wbGF0ZU1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICByZXRyaWV2ZV9hbGxfdGVtcGxhdGVzKCl7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHt9OwogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSBbXTsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEudGVtcGxhdGVzOwogICAgICAgICAgICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5wYWdpbmF0aW9uX2RhdGEubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMucGFnaW5hdGlvbl9kYXRhLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICB9IGVsc2UgaWYodGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9fV0hBVFNBUFBfVEVNUExBVEUuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgc2VuZF90ZW1wbGF0ZV90b19jdXN0b21lcigpewogICAgICBheGlvcwogICAgICAucG9zdCgKICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICB7CiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZV9pZDogdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUsCiAgICAgICAgICBjb250YWN0c19saXN0OiBbdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyXSwKICAgICAgICAgIHB1Ymxpc2hfdGVtcGxhdGU6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UgLCAicmVzIikKICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuTUVTU0FHRV9TRU5ESU5HX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOicjMzA4NWQ2JywKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2VtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2cnKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgnZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnJyksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJywKICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHtuYW1lOiAnU2V0dGluZ3MnLHBhcmFtczp7U3Vic2NyaXB0aW9uOnRydWV9fSk7ICAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuU0VORElOR19URU1QTEFURS5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnc2VuZF90ZW1wbGF0ZV9zZW50X21zZycpLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLS0iICwgcmVzcG9uc2UuZGF0YSkKICAgICAgICAgIC8vIGNvbnN0IHRlbXBsYXRlID0gIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0LmZpbmQoKGl0ZW0pID0+IGl0ZW0udGVtcGxhdGVfaWQgPT0gdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2codGVtcGxhdGUudmFyaWFibGVfZGljdCwgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyKTsKICAgICAgICAgIAogICAgICAgICAgbGV0IGN1cnJlbnRfdGltZXN0YW1wID0gIG5ldyBEYXRlKCksCiAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKQogICAgICAgICAgbGV0IGJvdF9yZXNwb25zZSA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICJ0ZXh0IjogbnVsbCwgCiAgICAgICAgICAgICAgInR5cGUiOiAidGVtcGxhdGUiLAogICAgICAgICAgICAgICJyZWNpcGllbnRfaWQiOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICAgInRlbXBsYXRlIjogdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMucHJldmlld190ZW1wbGF0ZV9kYXRhLmJvZHkKICAgICAgICAgICAgfQogICAgICAgICAgXTsKICAgICAgICAgIGlmKHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udil7CiAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgLy8gdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YS5sYXN0X2JvdF9yZXNwb25zZSA9IHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLm1lc3NhZ2VfdG9fc2VuZCwgCiAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwgCiAgICAgICAgICAgICAgZGF0ZTogY3VycmVudF9kYXRlLCAKICAgICAgICAgICAgICB0aW1lOiBgJHtjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENIb3VycygpfToke2N1cnJlbnRfdGltZXN0YW1wLmdldFVUQ01pbnV0ZXMoKX1gCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QudW5zaGlmdCgKICAgICAgICAgICAgICB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YQogICAgICAgICAgICApCiAgICAgICAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2coYm90X3Jlc3BvbnNlKQogICAgICAgICAgbGV0IGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwogICAgICAgICAgaWYodGhpcy5oaXN0b3J5Lm1hcChpdGVtID0+IGl0ZW0uYm90X3Jlc3BvbnNlX2RhdGUgPT0gYm90X3Jlc3BvbnNlX2RhdGUpLmxlbmd0aCA+IDApewogICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5oaXN0b3J5LnB1c2goCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAiQk9UUmVzcG9uc2UiOiBib3RfcmVzcG9uc2UsCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfdGltZSI6Y3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgIlVzZXJRdWVyeSI6ICIiLAogICAgICAgICAgICAgICJib3RfcmVzcG9uc2VfZGF0ZSI6IGJvdF9yZXNwb25zZV9kYXRlLCAKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwgCiAgICAgICAgICAgICAgInVzZXJfcXVlcnlfZGF0ZSI6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAiQ2hhdF9EYXRldGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgKTsKICAgICAgICAgIHRoaXMuc2Nyb2xsX2Rvd24oKTsKICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W3RoaXMuY3VycmVudF9jb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHRoaXMuYXJyYXlfbW92ZSh0aGlzLmNvbnRhY3RfbGlzdCwgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSAwOwogICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9IGZhbHNlOwogICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUgPSBudWxsIDsKICAgICAgICAgICQoIiNzZW5kVGVtcGxhdGVNb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5XSEFUU0FQUF9VU0VSX0xJTUlUX1JFQUNIRUQuTVNHX0NPREUgPT09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZCcpLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd0aWVyX3NwZWNpZmljX3VzZXJfbGltaXRfcmVhY2hlZF9tc2cnKSwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuV0hBVFNBUFBfT1BUX09VVF9DT05UQUNUUy5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnQWxsX2NvbnRhY3RzX2hhdmVfb3B0ZWRfb3V0X29mX2dldHRpbmdfdGVtcGxhdGVzJyksCiAgICAgICAgICAgIHR5cGU6ICJlcm9vciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgfWVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICkgewogICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgZ2V0X2NvbnRhY3RfZGlzcGxheV9uYW1lKGNvbnRhY3QpewogICAgICBpZihjb250YWN0LmNvbnRhY3RfbmFtZSkgcmV0dXJuIGNvbnRhY3QuY29udGFjdF9uYW1lIAogICAgICBpZihjb250YWN0LnByb2ZpbGVfbmFtZSkgcmV0dXJuIGNvbnRhY3QucHJvZmlsZV9uYW1lCiAgICAgIHJldHVybiBjb250YWN0LndoYXRzYXBwX3Bob25lX251bWJlcgogICAgfSwKICAgIG9wZW5faW1wb3J0X2Zyb21fY3N2X21vZGFsKCl7CiAgICAgICQoIiNhZGRDb250YWN0TW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAkKCIjaW1wb3J0Q29udGFjdENTVk1vZGFsIikubW9kYWwoInNob3ciKTsKICAgIH0sCiAgICBmaWxlX2lucHV0X2NvbnRhY3RzX2NzdihlKXsKICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzWzBdLnR5cGUgPT0gJ3RleHQvY3N2Jyl7CiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsID0gZS50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfY29udGVudCA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9zZWxlY3RlZCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYSBwcm9wZXIgZG9jdW1lbnQgaGF2aW5nIENTViBmaWxldHlwZSIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KQogICAgICB9CiAgICB9LAogICAgZmlsZV9zdWJtaXRfdXBsb2FkX2NvbnRhY3RzKCkgewogICAgICBpZiAoJCgiI2lucHV0R3JvdXBVcGxvYWRGaWxlY3N2IikudmFsKCkgPT0gJycpIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJPb3BzISIsCiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhIENTViBmaWxlIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgdXNlcl9kZXRhaWxzID0gewogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIH0pOwogICAgICBjb25zdCBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmZC5hcHBlbmQoCiAgICAgICAgImZpbGUiLAogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9jb250ZW50LAogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9sYWJlbAogICAgICApOwogICAgICAvLyBmZC5hcHBlbmQoImpzb24iLCBibG9iKTsKICAgICAgZmQuYXBwZW5kKCJjb21wYW55X2lkIiwgdGhpcy5jb21wYW55X2lkKTsKICAgICAgZmQuYXBwZW5kKCJjb21wYW55X25hbWUiLCB0aGlzLmNvbXBhbnlfbmFtZSk7CiAgICAgIGZkLmFwcGVuZCgiZW1haWwiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwpOwogICAgICBheGlvcwogICAgICAucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfaW1wb3J0X2NvbnRhY3RzKCksIGZkLCB7CiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgfSwKICAgICAgfSkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkZJTEVfVVBMT0FELk1TR19DT0RFID09PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICB0ZXh0OiAiTXVsdGlwbGUgY29udGFjdHMgYXJlIGJlaW5nIGFkZGVkLiBZb3Ugd2lsbCByZWNlaXZlIGEgbWFpbCB3aGVuIHRoZSBwcm9jZXNzaW5nIGlzIGZpbmlzaGVkLiIsCiAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgfSBlbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLklOQ09SUkVDVF9GSUxFX0ZPUk1BVC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbmNvcnJlY3QgRmlsZSBGb3JtYXQhIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIGRpZmZlcmVudCBjc3YgZmlsZSB3aGljaCBtYXRjaGVzIHRoZSBzYW1wbGUgZmlsZSBzdHJ1Y3R1cmUiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgfSkKICAgICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIGVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKXsKICAgICAgdGhpcy5jb250YWN0X2NzdiA9IHsKICAgICAgICBmaWxlX2xhYmVsOiAnQ2hvb3NlIEZpbGUnLAogICAgICAgIGZpbGVfY29udGVudDogbnVsbCwKICAgICAgICBmaWxlX3NlbGVjdGVkOiBmYWxzZQogICAgICB9OwogICAgICAkKCIjaW5wdXRHcm91cFVwbG9hZEZpbGVjc3YiKS52YWwoJycpOwogICAgfSwKICAgIGRvd25sb2FkX3NhbXBsZV9jb250YWN0X2ZpbGUoKXsKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzYW1wbGVfZmlsZTogIndoYXRzYXBwX2NvbnRhY3RzIiwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIH0sCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgfSwKICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jb21wYW55bmFtZSkKICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgInRlc3QuY3N2Iik7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT25GaWxlRG93bmxvYWQgPSBmYWxzZTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAoKICAgIHRleHRib3hfaGVpZ2h0KGlkLGtleSl7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMyAmJiAhZXZlbnQuc2hpZnRLZXkpewogICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHRoaXMuc2VuZF9tZXNzYWdlX3RvX3VzZXIoKTsKICAgICAgfWVsc2V7CiAgICAgICAgdmFyIHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7CiAgICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT57CiAgICAgICAgICBsZXQgc2Nyb2xsX2hlaWdodCA9ZS50YXJnZXQuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgaWYgKHNjcm9sbF9oZWlnaHQgPiA2MCkgewogICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5vdmVyZmxvdyA9ICdhdXRvJwogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbicKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNsb3NlX2RvY3VtZW50X3ByZXZpZXcoKXsKICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsID0gewogICAgICAgIG1lZGlhX2ZpbGVfbmFtZTogbnVsbCwKICAgICAgICBtZWRpYV9maWxlOiBudWxsLAogICAgICAgIHNob3dfcHJldmlldzogZmFsc2UsCiAgICAgICAgbWVkaWFfY29udGVudF90eXBlOiBudWxsLAogICAgICAgIG1lZGlhX3R5cGU6IG51bGwsCiAgICAgICAgc2VuZF9tZWRpYTogdHJ1ZSwKICAgICAgICBkb2N1bWVudF9jb250ZW50OiBudWxsLAogICAgICAgIG1lZGlhX2NhcHRpb246IG51bGwKICAgICAgfTsKICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VuZF9hdHRhY2htZW50IikudmFsdWUgPSAnJzsKICAgIH0sCiAgICB3aGF0c2FwcF9tZXNzYWdlX2Zvcm1hdGluZyhhKXsKICAgICAgZm9yIChsZXQgaT0gMCA7aTx0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0Lmxlbmd0aDtpKysgKXsKICAgICAgICBsZXQgY250ID0gMDsKICAgICAgICBsZXQgcG9zMSA9IC0xOwogICAgICAgIHdoaWxlKGNudCA8IGEubGVuZ3RoKXsKICAgICAgICAgIHBvczEgPSBhLmluZGV4T2YodGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXSxwb3MxKzEpCiAgICAgICAgICBpZihwb3MxID09IC0xKXsKICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVwbGFjZV9maXJzdF9jaGFyID0gYS5zdWJzdHJpbmcoMCwgcG9zMSkgKyB0aGlzLndoYXRzYXBwX2Zvcm1hdF9kaWN0W3RoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV1dWzBdICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnN1YnN0cmluZyhwb3MxICsgMSkKICAgICAgICAgIGEgPXJlcGxhY2VfZmlyc3RfY2hhcjsKICAgICAgICAgIGxldCBwb3MyID0gYS5pbmRleE9mKHRoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV0pCiAgICAgICAgICBsZXQgcmVwbGFjZV9zZWNvbmRfY2hhciA9IGEuc3Vic3RyaW5nKDAsIHBvczIpICsgdGhpcy53aGF0c2FwcF9mb3JtYXRfZGljdFt0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldXVsxXSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zdWJzdHJpbmcocG9zMiArIDEpOwogICAgICAgICAgYSA9IHJlcGxhY2Vfc2Vjb25kX2NoYXIKICAgICAgICAgIHBvczEgPSBwb3MyOwogICAgICAgICAgY250ID0gcG9zMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgZm9ybWF0VXNlclF1ZXJ5KFVzZXJRdWVyeSl7CiAgICAgIGlmKFVzZXJRdWVyeSAmJiBVc2VyUXVlcnkuc3RhcnRzV2l0aCgnLycpKXsKICAgICAgICB0cnkgewogICAgICAgICAgbGV0IGpzb25fc3RhcnQgPSBVc2VyUXVlcnkuaW5kZXhPZigneycpLAogICAgICAgICAganNvbl9lbmQgPSBVc2VyUXVlcnkuaW5kZXhPZignfScpKzEsCiAgICAgICAgICBqc29uX2RhdGEgPSBKU09OLnBhcnNlKFVzZXJRdWVyeS5zdWJzdHJpbmcoanNvbl9zdGFydCwganNvbl9lbmQpKTsKICAgICAgICAgIHJldHVybiBgSWQ6ICR7anNvbl9kYXRhLm9yZGVyX2lkfWA7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiBVc2VyUXVlcnkKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIFVzZXJRdWVyeQogICAgfSwKICAgIGdldF9vcmRlcl90ZW1wbGF0ZV9mb3JtYXR0ZWRfdGV4dChjdXJyZW50X2JvdF9yZXNwb25zZSl7CiAgICAgIC8vIGNvbnNvbGUubG9nKGN1cnJlbnRfYm90X3Jlc3BvbnNlKTsKICAgICAgcmV0dXJuIHRoaXMud2hhdHNhcHBfbWVzc2FnZV9mb3JtYXRpbmcoY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKChpdGVtKSA9PiBpdGVtLnR5cGUgPT0nQk9EWScpLnRleHQpOwogICAgfSwKICAgIGNoZWNrX2J1dHRvbl9pbl9vcmRlcl90ZW1wbGF0ZShjdXJyZW50X2JvdF9yZXNwb25zZSl7CiAgICAgIGxldCBjaGVja19idXR0b25zID0gY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKChpdGVtKSA9PiBpdGVtLnR5cGUgPT0gJ0JVVFRPTlMnKTsKICAgICAgaWYoQm9vbGVhbihjaGVja19idXR0b25zKSl7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGdldF9vcmRlcl90ZW1wbGF0ZV9idXR0b25fdXJsKGN1cnJlbnRfYm90X3Jlc3BvbnNlLCBrZXkpewogICAgICByZXR1cm4gY3VycmVudF9ib3RfcmVzcG9uc2UudGVtcGxhdGUuY29tcG9uZW50cy5maW5kKChpdGVtKSA9PiBpdGVtLnR5cGUgPT0nQlVUVE9OUycpLmJ1dHRvbnMuZmluZCgoaXRlbSkgPT4gaXRlbS50eXBlID09ICdVUkwnKVtrZXldCiAgICB9LAogICAgY2hlY2tfaGVpZ2h0KGlkLGtleSl7CiAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICBpZiAodGV4dGFyZWEuc2Nyb2xsVG9wID4gOTApewogICAgICAgIHRoaXMuc2hvd19wcm9maWxlX2RpdiA9IHRydWU7CiAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBgNTI1cHhgOwogICAgICB9ZWxzZXsKICAgICAgICB0ZXh0YXJlYS5zdHlsZS5oZWlnaHQgPSBgNDg1cHhgOwogICAgICAgIHRoaXMuc2hvd19wcm9maWxlX2RpdiA9IGZhbHNlOyAgCiAgICAgIH0KICAgIH0KCiAgfSwKICBiZWZvcmVEZXN0cm95KCl7CiAgICB0aGlzLmNoYW5uZWwubGVhdmUoKTsgCiAgICB0aGlzLmNoYXRfc29ja2V0LmRpc2Nvbm5lY3QoKTsKICB9Cn07Cg=="},null]}