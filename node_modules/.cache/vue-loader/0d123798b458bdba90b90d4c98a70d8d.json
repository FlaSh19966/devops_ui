{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/analytics/components/GroupedBarChart.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/analytics/components/GroupedBarChart.vue","mtime":1643027096188},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi8qIC54Z3JvdXBlZCBwYXRoewogICAgZGlzcGxheTogbm9uZTsKfQouYmFja2dyb3VuZC1jb2xvciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibHVlOwp9ICovCg=="},{"version":3,"sources":["GroupedBarChart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0tBA;AACA;AACA;AACA;AACA;AACA","file":"GroupedBarChart.vue","sourceRoot":"src/portal/analytics/components","sourcesContent":["<template>\n<div style=\"display:flex\">\n  <div id=\"grouped_bar_chart\" >\n  </div>\n <div id=\"legend_div\"></div>\n\n  <!-- <svg width=\"700\" height=\"3000\" id=\"svg\" /> -->\n\n<!-- <svg id=\"newpie\">\n    <g id=\"canvas\">\n    <g id=\"art\" />\n    <g id=\"labels\" /></g>\n</svg> -->\n</div>\n</template>\n\n<script>\nconst d3 = require(\"d3-3\");\nexport default {\n    name: \"GroupedBar\",\n    props: {\n    data: Array,\n    xKey: String,\n    yKey: String,\n    primary_col: String,  \n    secondary_col: String,\n    currency_key: String\n\n  },\n  mounted () {\n      var vm = this;\n      var margin = {top: 20, right: 150, bottom: 200, left: 40},\n            width = 960 - margin.left - margin.right,\n            height = 710 - margin.top - margin.bottom;\n\n        var x0 = d3.scale.ordinal()\n            .rangeRoundBands([0, width], 0.1);\n\n        var x1 = d3.scale.ordinal();\n\n        var y = d3.scale.linear()\n            .range([height-80, 0]);\n\n        var xAxis = d3.svg.axis()\n            .scale(x0)\n            .tickSize(0)\n            .orient(\"bottom\");\n\n        var yAxis = d3.svg.axis()\n            .scale(y)\n            .orient(\"left\")\n            .tickFormat(d3.format(\"s\"))\n\n        // var color = d3.scale.ordinal()\n        //     .range([\"#ca0020\",\"#f4a582\",\"#d5d5d5\",\"#92c5de\",\"#0571b0\",\"#0519b0\"]);\n\n        // var color = d3.scale.ordinal()\n        //     .range([\"#5d62b5\", \"#29c3be\", \"#f1726e\", \"#fbc53f\", \"#62b58f\", \"#d0743c\", \"#ff8c00\",\"#ca0020\",\"#f4a582\",\"#d5d5d5\",\"#92c5de\",\"#0571b0\",\"#0519b0\"]);\n\n        // var color = d3.scale.ordinal()\n        //     .range([\"#3FBC11\",\"#FF9750\", \"#5d62b5\", \"#29c3be\", \"#f1726e\", \"#fbc53f\", \"#62b58f\", \"#d0743c\",\"#ca0020\",\"#f4a582\",\"#92c5de\",\"#0571b0\", \"#d3fe14\", \"#fec7f8\", \"#0b7b3e\", \"#0bf0e9\",'#E666B3', '#33991A', '#CC9999', '#B3B31A', '#00E680',\n        //     '#FF9AA2', '#FFB7B2', '#FFDAC1', '#B5EAD7', '#63d2a8', \"#225a4b\", \"#e5df73\", '#6666FF','#ff0000\t','#a2798f','#d7c6cf','#e88758','#b13a15','#6d3656','#fffa90','#a4ffaa','#a6cbff','#8500f9','#b077ba','\t#765284','#984b67','#9c624e','#feb8ff','#9be3bd','#775934','#008385','#6a2ca1','#e60e68','#ff6d01','#fee9d3'\n        // ]);\n\n        var color = d3.scale.ordinal()\n            .range([\"#FBB317\",\"#FF9750\",\"#3FBC11\",\"#00C7E6\",\"#EA3379\",\"#0165fc\",\"#41fdfe\",\"#24a0ed\",\"#1ac1dd\",\"#7df9ff\",\"#3f00ff\",\"#08ff08\",\"#aeff6e\",\"#56fca2\",\"#45cea2\",\"#06c2ac\",\"#fe6700\",\"#ff3503\",\"#d90166\",\"#be03fd\",\"#ad0afd\",\"#6600ff\",\"#d01c1f\",\"#f1172f\",\"#fff600\",\"#fcd116\",\"#cfff04\",\"#ffc324\",\"#f4c430\",\"#FE7D68\",\"#710193\",\n            \"#0492C2\",\"#9897A9\",\"#632A0D\",\"#9A794E\",\"#151E3D\",\"#59788D\",\"#1E456E\",\"#016064\",\"#48AAAD\",\"#7E7D9C\",\"#303150\",\"#609D9E\",\"#287E9E\",\"#E4A834\",\"#028910\",\n            \"#373737\",\"#6C626D\",\"#584D5B\",\"#4D4C5C\"]);\n        // var color = d3.scale.category10();\n\n        var svg = d3.select('#grouped_bar_chart').append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n              .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n        // d3.json(\"data.json\", function(error, data) {\n\n        var data = [\n            {\n                \"categorie\": \"Student\", \n                \"values\": [\n                    {\n                        \"value\": 0, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 4, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 12, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 0, \n                        \"rate\": \"Tremendously\"\n                    },\n                    {\n                        \"value\": 10, \n                        \"rate\": \"Not so much\"\n                    }\n                ]\n            }, \n             {\n                \"categorie\": \"Student12345\", \n                \"values\": [\n                    {\n                        \"value\": 0, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 4, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 12, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 0, \n                        \"rate\": \"Tremendously\"\n                    },\n                    {\n                        \"value\": 10, \n                        \"rate\": \"Not so much\"\n                    }\n                ]\n            }, \n            {\n                \"categorie\": \"Liberal Profession\", \n                \"values\": [\n                    {\n                        \"value\": 1, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 21, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 13, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 18, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Tremendously\"\n                    },\n                    {\n                        \"value\": 20, \n                        \"rate\": \"Not so much\"\n                    }\n                ]\n            }, \n            {\n                \"categorie\": \"Salaried Staff\", \n                \"values\": [\n                    {\n                        \"value\": 3, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 22, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 15, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 3, \n                        \"rate\": \"Tremendously\"\n                    }\n                ]\n            }, \n            {\n                \"categorie\": \"Employee\", \n                \"values\": [\n                    {\n                        \"value\": 12, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 7, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 18, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 13, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Tremendously\"\n                    }\n                ]\n            }, \n            {\n                \"categorie\": \"Craftsman\", \n                \"values\": [\n                    {\n                        \"value\": 6, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 15, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 9, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 12, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 3, \n                        \"rate\": \"Tremendously\"\n                    }\n                ]\n            }, \n            {\n                \"categorie\": \"Inactive\", \n                \"values\": [\n                    {\n                        \"value\": 6, \n                        \"rate\": \"Not at all\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Not very much\"\n                    }, \n                    {\n                        \"value\": 6, \n                        \"rate\": \"Medium\"\n                    }, \n                    {\n                        \"value\": 2, \n                        \"rate\": \"Very much\"\n                    }, \n                    {\n                        \"value\": 3, \n                        \"rate\": \"Tremendously\"\n                    }\n                ]\n            }\n        ]\n\n        // var sampledata = [{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":4333,\"Outcome\":\"Impairment/Damage\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":2502,\"Outcome\":\"Hospitalization - Initial or Prolonged\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":369,\"Outcome\":\"Death\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":122,\"Outcome\":\"Disability\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":38,\"Outcome\":\"Life-Threatening\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":4,\"Outcome\":\"Congenital Anomaly\"},{\"Drug Name\":\"HUMIRA\",\"Unique Patient Count\":2,\"Outcome\":\"Required Intervention to Prevent Permanent\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":2580,\"Outcome\":\"Impairment/Damage\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":1619,\"Outcome\":\"Hospitalization - Initial or Prolonged\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":489,\"Outcome\":\"Death\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":43,\"Outcome\":\"Life-Threatening\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":27,\"Outcome\":\"Disability\"},{\"Drug Name\":\"XARELTO\",\"Unique Patient Count\":1,\"Outcome\":\"Congenital Anomaly\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":2165,\"Outcome\":\"Hospitalization - Initial or Prolonged\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":1604,\"Outcome\":\"Impairment/Damage\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":658,\"Outcome\":\"Death\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":25,\"Outcome\":\"Life-Threatening\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":20,\"Outcome\":\"Disability\"},{\"Drug Name\":\"REVLIMID\",\"Unique Patient Count\":5,\"Outcome\":\"Congenital Anomaly\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":2090,\"Outcome\":\"Impairment/Damage\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":443,\"Outcome\":\"Hospitalization - Initial or Prolonged\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":58,\"Outcome\":\"Disability\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":51,\"Outcome\":\"Death\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":21,\"Outcome\":\"Life-Threatening\"},{\"Drug Name\":\"ENBREL\",\"Unique Patient Count\":1,\"Outcome\":\"Required Intervention to Prevent Permanent\"}]\n        // console.log(this.data);\n        var map = this.data.reduce((r, i) => ((r[i[vm.primary_col]] = r[i[vm.primary_col]] || []).push({\n            date : i[vm.secondary_col],\n            sales: i[vm.yKey]\n             // i\n        }), r), {});\n        var entries = Object.entries(map);\n        const second_data = [];\n        for(let i =0; i < entries.length; i++) {\n            second_data.push({\n            categorie : entries[i][0],\n            values: [],\n            })\n            for(let j =0 ; j < entries[i][1].length; j++) {\n            second_data[i].values.push({\n                rate: entries[i][1][j].date,\n                value: entries[i][1][j].sales,\n                category: entries[i][0]\n            })\n            }\n        }\n        data = [];\n        data = second_data;\n        // console.log(data);\n        var categoriesNames,rateNames       \n        var categoriesNamesFull = data.map(function(d) { return d.categorie; });\n        // var categoriesNames = data.map(function(d) { return d.categorie; });\n        // var rateNames = data[0].values.map(function(d) { return d.rate; });\n        // console.log(rateNames,categoriesNames);\n        var isScrollDisplayed =  false,\n        numBars = 4;\n        var marginOverview = {top: 30, right: 10, bottom: 20, left: 70};\n        var heightOverview = 80 - marginOverview.top - marginOverview.bottom;\n        if(categoriesNamesFull.length > 5 ) { isScrollDisplayed = true; }\n        categoriesNames = data.map(function(d) { return d.categorie; });\n        rateNames       = data[2].values.map(function(d) { return d.rate; });\n\n        // console.log(rateNames);\n        // for(let i = 0; i < data.length; i++){\n            \n        // }\n        let key_data_temp = [],\n        key_data_temp_length = [];\n        for(let i = 0; i < data.length; i++){\n            // console.log(data[i].values.map(function(d) { return d.rate; }))\n            // console.log(d3.keys(data[i].values))\n            key_data_temp.push(data[i].values.map(function(d) { return d.rate; }))\n            key_data_temp_length.push(d3.keys(data[i]).slice(1).length)\n        }\n        // console.log(key_data_temp);\n        let key_data_temp_2 = [];\n        for(let i =0; i < key_data_temp.length; i++){\n            for(let j = 0; j < key_data_temp[i].length; j++){\n                key_data_temp_2.push(key_data_temp[i][j])\n            }\n        }\n        var xyz = key_data_temp_2.reduce(function(a,b){\n        if(a.indexOf(b) < 0 ) a.push(b);\n        return a;\n        }, [])\n        // console.log(xyz, 'HERE FOR DISTINCT')\n        rateNames = xyz;\n        // console.log(isScrollDisplayed);\n        if(isScrollDisplayed) {\n            // categoriesNames = data.slice(0,numBars).map(function(d) { return d.categorie; });\n            // rateNames       = data[0].values.map(function(d) { return d.rate; });\n            x0.domain(categoriesNames.slice(0,numBars));\n            x1.domain(rateNames).rangeRoundBands([0, x0.rangeBand()]); \n        } else {\n            // categoriesNames = data.map(function(d) { return d.categorie; });\n            // rateNames = data[0].values.map(function(d) { return d.rate; });\n            x0.domain(categoriesNames);\n            x1.domain(rateNames).rangeRoundBands([0, x0.rangeBand()]); \n        }\n        y.domain([0, d3.max(data, function(categorie) { return d3.max(categorie.values, function(d) { return d.value; }); })]);\n\n        // if(data.length > 2) {\n        //     svg.append(\"g\")\n        //     .style(\"font-size\", \"12px\")\n        //     .attr(\"class\", \"xgrouped\")\n        //     .style('opacity','0')\n        //     .attr(\"transform\", \"translate(0,\" + height + \")\")\n        //     .call(xAxis)\n        //     d3.selectAll(\"text\")\n        //     .attr(\"y\", 0)\n        //     .attr(\"x\", -10)\n        //     .attr(\"dy\", \".35em\")\n        //     .attr(\"transform\", \"rotate(-70)\")\n        //     .style(\"text-anchor\", \"end\");  \n        // } else {\n            svg.append(\"g\")\n            .attr(\"class\", \"xgrouped\")\n            .style('opacity','0')\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis)\n            d3.selectAll(\".tick text\")\n            .call(wrap, 10)\n            function wrap(text, width) {\n            text.each(function() {\n              var text = d3.select(this),\n                  words = text.text().split(/\\s+/).reverse(),\n                  word,\n                  line = [],\n                  lineNumber = 0,\n                //   lineHeight = 0.6, // ems\n                  lineHeight = 1.1, // ems\n                  y = text.attr(\"y\"),\n                  dy = parseFloat(text.attr(\"dy\")),\n                  tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n              while (word = words.pop()) {\n                line.push(word);\n                tspan.text(line.join(\" \"));\n                if (tspan.node().getComputedTextLength() > width) {\n                  line.pop();\n                  tspan.text(line.join(\" \"));\n                  line = [word];\n                  tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word)\n              \n                }\n              }\n            });\n          }\n        // }\n\n        svg.append(\"g\")\n        // .attr(\"transform\", \"translate(0,30)\")\n            .attr(\"class\", \"y axis\")\n            .style('opacity','0')\n            .call(yAxis)\n        // .append(\"text\")\n        //     .attr(\"transform\", \"rotate(-90)\")\n        //     .attr(\"y\", 6)\n        //     .attr(\"dy\", \".71em\")\n        //     .style(\"text-anchor\", \"end\")\n        //     .style('font-weight','bold')\n        //     .text(\"Value\");\n\n        svg.select('.y').transition().duration(500).delay(function(d,i){ return 1300 + 100 * i; }).style('opacity','1');\n        svg.select('.xgrouped').transition().duration(100).delay(function(d,i){ return 1300 + 100 * i; }).style('opacity','1');\n        var tooltip = d3.select(\".card-body\").append(\"div\").attr(\"class\", \"toolTip\");\n\n        if(isScrollDisplayed) {\n\n            var slice = svg.selectAll(\".slice\")\n                .data(data.slice(0,numBars))\n                .enter()\n                .append(\"svg\")\n                .attr(\"class\",\"group\")\n                .append(\"g\")\n                .attr(\"class\", \"g\")\n                .attr(\"id\", function(d) { return d.categorie })\n                .attr(\"transform\",function(d) { return \"translate(\" + x0(d.categorie) + \",0)\"; })\n\n            slice.selectAll(\"rect\")\n                .data(function(d) { return d.values; })\n                .enter().append(\"rect\")\n                .attr(\"width\", x1.rangeBand())\n                .attr(\"class\", \".bar-positive-stack\")\n                // .attr(\"id\", guidGenerator())\n                .attr(\"x\", function(d) {  return x1(d.rate); })\n                .style(\"fill\", function(d) { return color(d.rate) })\n                .attr(\"y\", function(d) { return y(0); })\n                .attr(\"height\", function(d) { return  y(0); })\n                // .attr(\"y\", function(d) { return y(d.value); })\n                // .attr(\"height\", function(d) { return height - y(d.value); })\n                .on(\"mouseover\", function(d) {\n                    d3.select(this).style(\"fill\", d3.rgb(color(d.rate)).brighter(1));\n                    var x = d3.select(this).attr('id');\n                    tooltip\n                    .style(\"left\", event.pageX - 315 + \"px\")\n                    .style(\"top\", event.pageY - 170 + \"px\")\n                    .style(\"display\", \"inline-block\")\n                    .html( \"<em> <b>\" + d.category + \" </b> </em> <br>\" + d.rate + \"<br>\" + vm.currency_key + ' ' + ((Number.isInteger(d.value)) ? d.value :  d.value.toFixed(2)));\n                })\n                .on(\"mouseout\", function(d) {\n                    tooltip.style(\"display\", \"none\");\n                    d3.select(this).style(\"fill\", color(d.rate));\n                });\n\n            slice.selectAll(\"rect\")\n            .transition()\n            .delay(function (d) {return Math.random()*1000;})\n            .duration(1000)\n            .attr(\"y\", function(d) { if(d.value === 0){return 0;} else { return y(d.value);} })\n            .attr(\"height\", function(d) {  if(d.value === 0){return 0;} else {return height - y(d.value); }});\n\n            var xOverview = d3.scale.ordinal()\n                .domain(data.map(function (d) { return d.label; }))\n                .range([0, width], .2);\n            var yOverview = d3.scale.linear().range([heightOverview, 0]);\n            yOverview.domain(y.domain());\n\n            var displayed = d3.scale.quantize()\n                    .domain([0, width])\n                    .range(d3.range(data.length));\n                    svg.append(\"g\").append(\"rect\")\n                    .attr(\"transform\", \"translate(5, \" + (height+5) + \")\")\n                    .attr(\"class\", \"mover\")\n                    .attr(\"x\", 0)\n                    .attr(\"y\", 0)\n                    .attr(\"rx\",5)\n                    .attr(\"ry\",10)\n                    .attr(\"height\", 10)\n                    .attr(\"width\",Math.round(parseFloat(numBars * width)/data.length))\n                    .attr(\"pointer-events\", \"all\")\n                    .attr(\"cursor\", \"ew-resize\")\n                    .call(d3.behavior.drag().on(\"drag\", display));\n        }  else {\n                var slice = svg.selectAll(\".slice\")\n                .data(data)\n                .enter()\n                .append(\"svg\")\n                // .attr(\"\")\n                .append(\"g\")\n                .attr(\"class\", \"g\")\n                .attr(\"id\", function(d) { return d.categorie })\n                .attr(\"transform\",function(d) { return \"translate(\" + x0(d.categorie) + \",0)\"; })\n\n            slice.selectAll(\"rect\")\n                .data(function(d) { return d.values; })\n                .enter().append(\"rect\")\n                .attr(\"width\", x1.rangeBand())\n                // .attr(\"id\", guidGenerator())\n                .attr(\"x\", function(d) { return x1(d.rate); })\n                .style(\"fill\", function(d) { return color(d.rate) })\n                .attr(\"y\", function(d) { return y(0); })\n                .attr(\"height\", function(d) { return y(0); })\n                // .attr(\"y\", function(d) { return y(d.value); })\n                // .attr(\"height\", function(d) { return height - y(d.value); })\n                .on(\"mouseover\", function(d) {\n                    d3.select(this).style(\"fill\", d3.rgb(color(d.rate)).brighter(1));\n                    var x = d3.select(this).attr('id');\n                    // console.log(d)\n                    tooltip\n                    .style(\"left\", event.pageX - 315 + \"px\")\n                    .style(\"top\", event.pageY - 170 + \"px\")\n                    .style(\"display\", \"inline-block\")\n                    .html( \"<em> <b>\" + d.category + \" </b> </em> <br>\" + d.rate + \"<br>\"+ vm.currency_key + ' '  + ((Number.isInteger(d.value)) ? d.value :  d.value.toFixed(2)));\n                    // .html( d.rate + \"<br>\"  + d.value);\n                })\n                .on(\"mouseout\", function(d) {\n                    tooltip.style(\"display\", \"none\");\n                    d3.select(this).style(\"fill\", color(d.rate));\n                });\n        }\n        slice.selectAll(\"rect\")\n            .transition()\n            .delay(function (d) {return Math.random()*1000;})\n            .duration(1000)\n            .attr(\"y\", function(d) { return y(d.value); })\n            .attr(\"height\", function(d) { return height - y(d.value); });\n\n        // slice.selectAll(\"rect\")\n        // .transition()\n        // .delay((d,i)=> i * 150)\n        // .duration(800)\n        // .attr(\"y\", function(d) {return y(d.value); })\n        \n        //Legend\n        var legend_div = d3.select(\"#legend_div\").append(\"svg\").style(\"width\",\"200%\").style(\"height\",\"250%\");\n        var legend_g =  legend_div.append(\"g\").attr(\"transform\", \"translate(0,0)\");\n        // var legend = svg.selectAll(\".legend\")\n        var legend =  legend_g.append(\"g\")\n            .attr(\"font-family\", \"sans-serif\")\n            .attr(\"font-size\", 10)\n            .attr(\"text-anchor\", \"end\")\n            .selectAll(\"g\")\n            // .data(data[1].values.map(function(d) { return d.rate; }))\n            .data(rateNames)\n            .enter().append(\"g\")\n            // .attr(\"class\", \"legend\")\n            .attr(\"transform\", function(d,i) { return \"translate(0,\" + i * 20 + \")\"; })\n            .style(\"opacity\",\"1\");\n\n        legend.append(\"rect\")\n            .attr(\"x\", 0)\n            .attr(\"width\", 18)\n            .attr(\"height\", 18)\n            .style(\"fill\", function(d) { return color(d); });\n\n        legend.append(\"text\")\n            .attr(\"x\", 25)\n            .attr(\"y\", 9)\n            .attr(\"dy\", \".35em\")\n            .attr(\"class\", \"legend_text\")\n            .style(\"text-anchor\", \"start\")\n            .text(function(d) {\n                // return d.toUpperCase();\n                if(d.length > 25){\n                 return d.substring(0,25).toUpperCase()+'...';\n                } else {\n                 return d.toUpperCase()\n                }\n            })\n        d3.selectAll('.legend_text').call(show_long_labels);\n        function show_long_labels(selection) {\n            selection.on('mouseenter', function (d,i) { \n            // var tooltip = \n            // d3.select(\"#stackedbarnontime\").append(\"div\").attr(\"class\", \"toolTip\")\n                if(d.length > 25){\n                  tooltip\n                    .style(\"left\", d3.event.pageX - 400 + \"px\")\n                    .style(\"top\", d3.event.pageY - 290 + \"px\")\n                    .style(\"display\", \"inline-block\")\n                    .html(d.toUpperCase());\n            }\n            });\n\n            selection.on(\"mouseout\", function(d,i) {\n                // d3.selectAll(\".toolTip\").remove();\n                tooltip.style(\"display\", \"none\"); // hide tooltip for that element\n            });\n\n            selection.on(\"mousemove\", function(d) {\n                tooltip\n                .style(\"top\", d3.event.layerY + 100 + \"px\") \n                .style(\"left\", d3.event.layerX - 210 + \"px\"); \n            });\n        }\n\n        \n        legend.transition().duration(500).delay(function(d,i){ return 1300 + 100 * i; }).style(\"opacity\",\"1\");\n\n        // var hoverdata = $(\"#Student\");\n        // hoverdata.mouseover (function() {\n        //     console.log(\"Hello\")\n        //     hoverdata.addClass(\"background-color\")\n        // });\n\n    function display () {\n     // debugger;\n        var xy = parseInt(d3.select(this).attr(\"x\")),\n            nx = xy + d3.event.dx,\n            w = parseInt(d3.select(this).attr(\"width\")),\n            f, nf, new_data, rects;\n\n        if ( nx < 0 || nx + w > width ) return;\n\n        d3.select(this).attr(\"x\", nx);\n\n        f = displayed(xy);\n        nf = displayed(nx);\n\n        if ( f === nf ) return;\n\n        new_data = data.slice(nf, nf + numBars);\n\n        x0.domain(new_data.map(function (d) { return d.categorie; }));\n\n        // x0.domain(categoriesNames);\n        // x1.domain(rateNames).rangeRoundBands([0, x0.rangeBand()]); \n        // d3.selectAll(\".x axis\").remove();\n\n        if(numBars > 4 ){\n            // svg.append(\"g\")\n            //     .style(\"font\", \"10px times\")\n            //     .attr(\"class\", \"xgrouped\")\n            //     .attr(\"transform\", \"translate(0,\" + height + \")\")\n            svg.selectAll(\".xgrouped\")\n            //  .style(\"font\", \"10px times\")\n            // svg.append(\"g\")\n                // .attr(\"class\", \"xgrouped\")\n                // .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis)\n            .selectAll(\"text\")\n            .attr(\"y\", 0)\n            .attr(\"x\", -10)\n            .attr(\"dy\", \".35em\")\n            .attr(\"transform\", \"rotate(-70)\")\n            .style(\"text-anchor\", \"end\")         \n            } else {\n            // svg.append(\"g\")\n            // .attr(\"class\", \"xgrouped\")\n            // .attr(\"transform\", \"translate(0,\" + height + \")\")\n             svg.selectAll(\".xgrouped\")\n            //    svg.append(\"g\")\n            // .attr(\"class\", \"xgrouped\")\n            // .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis)\n            .selectAll(\".tick text\")\n            .call(wrap, 10)\n            function wrap(text, width) {\n            text.each(function() {\n              var text = d3.select(this),\n                  words = text.text().split(/\\s+/).reverse(),\n                  word,\n                  line = [],\n                  lineNumber = 0,\n                //   lineHeight = 0.6, // ems\n                  lineHeight = 1.1, // ems\n                  y = text.attr(\"y\"),\n                  dy = parseFloat(text.attr(\"dy\")),\n                  tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n              while (word = words.pop()) {\n                line.push(word);\n                tspan.text(line.join(\" \"));\n                if (tspan.node().getComputedTextLength() > width) {\n                  line.pop();\n                  tspan.text(line.join(\" \"));\n                  line = [word];\n                  tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word)\n              \n                }\n              }\n            });\n          }\n        }\n        // d3.selectAll(\".xgrouped\").remove();\n        d3.selectAll(\".group\").remove();\n        d3.selectAll(\".bar-positive-stack\").remove();\n        d3.selectAll(\".g\").remove();\n        // rects = svg.selectAll(\".bar-positive-stack\")\n        // .data(new_data, function (d) {return d.label; });\n        //   rects.attr(\"x\", function (d) { return x(d.data.State); });\n\n            // rects\n            var slice = svg.selectAll(\".slice\")\n                .data(new_data)\n                .enter()\n                .append(\"svg\")\n                .attr(\"class\",\"group\")\n                .append(\"g\")\n                .attr(\"class\", \"g\")\n                .attr(\"id\", function(d) { return d.categorie })\n                .attr(\"transform\",function(d) { return \"translate(\" + x0(d.categorie) + \",0)\"; })\n\n            \n            slice.selectAll(\"rect\")\n                .data(function(d) { return d.values; })\n                .enter().append(\"rect\")\n                .attr(\"width\", x1.rangeBand())\n                .attr(\"class\", \".bar-positive-stack\")\n                // .attr(\"id\", guidGenerator())\n                .attr(\"x\", function(d) { return x1(d.rate); })\n                .style(\"fill\", function(d) { return color(d.rate) })\n                // .attr(\"y\", function(d) { return y(0); })\n                // .attr(\"height\", function(d) { return height - y(0); })\n                .attr(\"y\", function(d) { return y(d.value); })\n                .attr(\"height\", function(d) { return height - y(d.value); })\n                .on(\"mouseover\", function(d) {\n                    // console.log(d);\n                    d3.select(this).style(\"fill\", d3.rgb(color(d.rate)).brighter(1));\n                    var x = d3.select(this).attr('id');\n                    tooltip\n                    .style(\"left\", event.pageX - 315 + \"px\")\n                    .style(\"top\", event.pageY - 170 + \"px\")\n                    .style(\"display\", \"inline-block\")\n                    .html( \"<em> <b>\" + d.category + \" </b> </em> <br>\" + d.rate + \"<br>\"+ vm.currency_key + ' '  + ((Number.isInteger(d.value)) ? d.value :  d.value.toFixed(2)));\n                    // .html( d.rate + \"<br>\"  + d.value);\n                })\n                .on(\"mouseout\", function(d) {\n                    tooltip.style(\"display\", \"none\");\n                    d3.select(this).style(\"fill\", color(d.rate));\n                });\n        // rects.exit   ().remove();\n    };\n\n  }\n}\n</script>\n<style>\n/* .xgrouped path{\n    display: none;\n}\n.background-color {\n    background-color: blue;\n} */\n</style>"]}]}