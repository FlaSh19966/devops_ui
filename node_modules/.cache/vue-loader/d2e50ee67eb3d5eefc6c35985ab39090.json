{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/AddRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/AddRole.vue","mtime":1663910265478},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBtaXhpbnM6IFtjbG9zZV9tb2RhbF0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjaGVja2VkVXNlcjpmYWxzZSwKICAgICAgY2hlY2tlZF9saXN0OiBbXSwKICAgICAgcm9sZV9uYW1lczogIiIsCiAgICAgIGRlbGV0ZV9saXN0OiBbXSwKICAgICAgcm9sZV9uYW1lOiBbXSwKICAgICAgdXNlcl90eXBlX2xpc3Q6IFtdLAogICAgICB1c2VyX3R5cGU6ICJQb3J0YWwgVXNlciIsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgdG90YWxfcGFnZXM6IDAsCiAgICAgIGFkZF9lZGl0OiAidHJ1ZSIsCiAgICAgIG9sZF9yb2xlX25hbWU6ICIiLAogICAgICBkZWxldGVfbGlzdDogW10sCiAgICAgIC8vaGFyc2gKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgJCgiI3VzZXJtb2RlbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICB2bS5hZGRfZWRpdCA9ICJ0cnVlIjsKICAgICAgdm0udXNlcl90eXBlID0gIlBvcnRhbCBVc2VyIjsKICAgICAgdm0ucm9sZV9uYW1lcyA9ICIiOwogICAgfSk7CiAgfSwKICBjcmVhdGVkKCkgewogIHRoaXMubG9hZF9yb2xlKCk7CiAgfSwKICB3YXRjaDp7CiAgICAgICAgc2VhcmNoX25hbWUoKXsKICAgICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIil7CiAgICAgICAgICB0aGlzLmxvYWRfcm9sZSgpOwogICAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpewogICAgICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgY2xlYXJfc2VhcmNoX25hbWUoKXsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGxvYWRfcm9sZSgpewogICAgICB0aGlzLnNwaW5uZXJPbj10cnVlOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgIHRoaXMuYWRkX2VkaXQ9ICJ0cnVlIjsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICBheGlvcwogICAgICAucG9zdCgKICAgICAgICBhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLAogICAgICAgIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgaXNTaG93OiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICApCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuc3Bpbm5lck9uPWZhbHNlOwogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpewogICAgICAgICAgdGhpcy5vcmdhbml6ZV9yb2xlcyhyZXNwb25zZS5kYXRhKTsKICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICAKICAgICAgICAgIH0pOwogICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICB0aW1lcjozMDAwLCAgCiAgICAgICAgICAgIHRvYXN0OnRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiJ0b3AtZW5kIiwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLCAgCiAgICAgICAgICB9KTsgIAogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgY2hlY2tfbGlzdF9hcnJheShpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHZhciByb2xlX2xlbmd0aCA9IHRoaXMucm9sZV9uYW1lLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvbGVfbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goaSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tlZF9saXN0LmluY2x1ZGVzKGluZGV4KSkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKGluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwogICAgICAgICAgaWYgKHNlbGVjdGFsbC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgICAgc2VsZWN0YWxsLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKChyb2xlKSA9PiB7CiAgICAgICAgICAgIHJldHVybiByb2xlICE9PSBpbmRleDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGVkaXRfcm9sZShpbmRleCkgewogICAgICB0aGlzLm9sZF9yb2xlX25hbWUgPSB0aGlzLnJvbGVfbmFtZVtpbmRleF07CiAgICAgIHRoaXMucm9sZV9uYW1lcyA9IHRoaXMucm9sZV9uYW1lW2luZGV4XTsKICAgICAgdGhpcy51c2VyX3R5cGUgPSB0aGlzLnVzZXJfdHlwZV9saXN0W2luZGV4XTsKICAgICAgdGhpcy5hZGRfZWRpdCA9ICJmYWxzZSI7CiAgICB9LAogICAgZGVsZXRlX3JvbGUoaW5kZXgpIHsKICAgICAgdGhpcy5kZWxldGVfbGlzdCA9IFtdOwogICAgICB0aGlzLmRlbGV0ZV9saXN0LnB1c2godGhpcy5yb2xlX25hbWVbaW5kZXhdKTsKICAgICAgKHRoaXMucm9sZV9uYW1lcyA9IHRoaXMucm9sZV9uYW1lW2luZGV4XSksCiAgICAgICAgKHRoaXMudXNlcl90eXBlID0gdGhpcy51c2VyX3R5cGVfbGlzdFtpbmRleF0pOwogICAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYWRkX3JvbGVfZGVsZXRlX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX25vX3JldmVydF9tc2cnKSwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfc3dhbF9kZWxldGVfbXNnJyksCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgaWYocmVzdWx0LmRpc21pc3MgPT09J2NhbmNlbCcpewogICAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgICAgICB9ZWxzZSBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIGRlbGV0ZV9yb2xlczogWwogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUm9sZTogdGhpcy5yb2xlX25hbWVzLAogICAgICAgICAgICAgICAgICAgIFVzZXJUeXBlOiB0aGlzLnVzZXJfdHlwZSwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBpc0RlbGV0ZTogdHJ1ZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VU0VSX1JPTEVTX0RFTEVURURfU1VDQ0VTU0ZVTExZXzIwMDIuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYWRkX3JvbGVfc3dhbF9kZWxldGVkX21zZycpLAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfeW91cl9yb2xlX2RlbGV0ZWRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6InN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZigodGhpcy5yb2xlX25hbWUubGVuZ3RoID09PSAxICYmIAogICAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0Lmxlbmd0aCA9PT0gMSkgJiYKICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID4gMSl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFUl9FWElTVC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV91c2VyX2V4aXN0X2dpdmVuX3JvbGVfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOjI1MDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCkKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBkZWxldGVfbXVsdGlwbGVfcm9sZSgpIHsKICAgICAgdGhpcy5kZWxldGVfbGlzdCA9IFtdOwogICAgICB2YXIgbGVuID0gdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5jaGVja2VkX2xpc3RbaV07CiAgICAgICAgdGhpcy5kZWxldGVfbGlzdC5wdXNoKHsKICAgICAgICAgIFJvbGU6IHRoaXMucm9sZV9uYW1lW2luZGV4XSwKICAgICAgICAgIFVzZXJUeXBlOiB0aGlzLnVzZXJfdHlwZV9saXN0W2luZGV4XSwKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodGhpcy5kZWxldGVfbGlzdC5sZW5ndGggIT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2FkZF9yb2xlX3N3YWxfZGVsZXRlX21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX25vX3JldmVydF9tc2cyJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9zd2FsX2RlbGV0ZV9tc2cyJyksCiAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZihyZXN1bHQuZGlzbWlzcyA9PT0nY2FuY2VsJyl7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgICAgIH1lbHNlIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGRlbGV0ZV9yb2xlczogdGhpcy5kZWxldGVfbGlzdCwKICAgICAgICAgICAgICAgICAgaXNEZWxldGU6IHRydWUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlVTRVJfUk9MRVNfREVMRVRFRF9TVUNDRVNTRlVMTFlfMjAwMi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2FkZF9yb2xlX3N3YWxfZGVsZXRlZF9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV95b3VyX3JvbGVfZGVsZXRlZF9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6InN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaWYodGhpcy5kZWxldGVfbGlzdC5sZW5ndGggPT09IHRoaXMucm9sZV9uYW1lLmxlbmd0aCAmJiAKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPjEpewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcm9sZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFUl9FWElTVC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2FkZF9yb2xlX3VzZXJfZXhpc3RfZ2l2ZW5fcm9sZV9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOjI1MDAsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcm9sZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9saXN0ID0gW107CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdhZGRfcm9sZV9ub19yb2xlX3NlbGVjdGVkX21zZycpLAogICAgICAgICAgdGV4dDoiIiwKICAgICAgICAgIHR5cGU6ImVycm9yIiwKICAgICAgICAgIHRpbWVyOjIwMDAsCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfcm9sZXMoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLmFkZF9lZGl0ID09ICJ0cnVlIikgewogICAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PT0gbnVsbCkgewogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9zZWxlY3RfdXNlcl90eXBlX21zZycpKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZV9uYW1lcyA9PSAiIikgewogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9lbnRlcl9yb2xlX21zZycpKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZV9uYW1lcy50b0xvY2FsZUxvd2VyQ2FzZSgpID09ICJhZG1pbiIpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnYWRkX3JvbGVfY2Fubm90X2FkZF9yb2xlX21zZycpKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZV9uYW1lcy50b0xvY2FsZUxvd2VyQ2FzZSgpID09ICJzdXBlcmFkbWluY2Vuc2UiKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX2Nhbm5vdF9hZGRfcm9sZV9zdXBlcl9hZG1pbl9tc2cnKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIFVzZXIiKXsKICAgICAgICAgICAgdGhpcy5yb2xlX25hbWVzPXRoaXMucm9sZV9uYW1lcy50b0xvY2FsZUxvd2VyQ2FzZSgpLmluY2x1ZGVzKCJzdXBwb3J0Iik/ICJzdXBwb3J0IGFnZW50IjogdGhpcy5yb2xlX25hbWVzOwogICAgICAgICAgfQogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICB1c2VyX3R5cGU6IHRoaXMudXNlcl90eXBlLAogICAgICAgICAgICAgICAgcm9sZV9uYW1lOiB0aGlzLnJvbGVfbmFtZXMsCiAgICAgICAgICAgICAgICBpc0luc2VydDogdHJ1ZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICBpZigKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VU0VSX1JPTEVfU0VUX0FMUkVBRFlfRVhJU1RTXzIwMDIuTVNHX0NPREUgJiYKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUgJiYKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFICYmCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VQRVJfQURNSU5fRVhJU1RTX0VSUk9SLk1TR19DT0RFKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VU0VSX1JPTEVfU0VUX1NVQ0NFU1NGVUxMWV8yMDAyLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoeyAKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfYWRkZWRfc3VjY2Vzc2Z1bF9tc2cnKSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6MjAwMCwgCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlVTRVJfUk9MRV9TRVRfQUxSRUFEWV9FWElTVFNfMjAwMi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7IAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfYWxyZWFkeV9leGlzdHNfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGltZXI6MjAwMCwgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVUEVSX0FETUlOX0VYSVNUU19FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7IAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfc3VwZXJfYWRtaW5fcm9sZV9jYW5ub3RfYWRkX21zZycpLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOjIwMDAsIAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgICAgICB0aW1lcjozMDAwLCAgICAgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnc2F2ZV9hbmRfY2xvc2VfYnRuJykKICAgICAgICB9CiAgICAgIH1lbHNlIGlmICh0aGlzLmFkZF9lZGl0ID09ICJmYWxzZSIpIHsKICAgICAgICBpZiAodGhpcy5yb2xlX25hbWVzID09ICIiKSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX2VudGVyX3JvbGVfbXNnMicpKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZV9uYW1lcy50b0xvY2FsZUxvd2VyQ2FzZSgpID09ICJhZG1pbiIpIHsKICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnYWRkX3JvbGVfY2Fubm90X2FkZF9yb2xlX21zZzInKSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJvbGVfbmFtZXMudG9Mb2NhbGVMb3dlckNhc2UoKSA9PSAic3VwZXJhZG1pbmNlbnNlIikgewogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9jYW5ub3RfYWRkX3JvbGVfc3VwZXJfYWRtaW5fbXNnMicpKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCBVc2VyIil7CiAgICAgICAgICAgIHRoaXMucm9sZV9uYW1lcz10aGlzLnJvbGVfbmFtZXMudG9Mb2NhbGVMb3dlckNhc2UoKS5pbmNsdWRlcygic3VwcG9ydCIpPyAic3VwcG9ydCBhZ2VudCI6IHRoaXMucm9sZV9uYW1lczsKICAgICAgICAgIH0KICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5tYWluX3JvbGVfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgdXNlcl90eXBlOiB0aGlzLnVzZXJfdHlwZSwKICAgICAgICAgICAgICAgIHJvbGVfbmFtZTogdGhpcy5yb2xlX25hbWVzLAogICAgICAgICAgICAgICAgb2xkX3JvbGVfbmFtZTogdGhpcy5vbGRfcm9sZV9uYW1lLAogICAgICAgICAgICAgICAgaXNFZGl0OiB0cnVlLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuYWRkX2VkaXQgPSAidHJ1ZSI7CiAgICAgICAgICAgICAgaWYoCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFUl9ST0xFX1NFVF9BTFJFQURZX0VYSVNUU18yMDAyLk1TR19DT0RFICYmCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFICYmCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSAgJiYKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5TVVBFUl9BRE1JTl9FWElTVFNfRVJST1IuTVNHX0NPREUpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VU0VSX1JPTEVfRURJVEVEX1NVQ0NFU1NGVUxMWV8yMDAyLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoeyAKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfZWRpdGVkX3N1Y2Nlc3NmdWxfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOjIwMDAsIAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0gIAogICAgICAgICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFUl9ST0xFX1NFVF9BTFJFQURZX0VYSVNUU18yMDAyLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsgCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9hbHJlYWR5X2V4aXN0c19tc2cyJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGltZXI6MjAwMCwgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VQRVJfQURNSU5fRVhJU1RTX0VSUk9SLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsgCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9zdXBlcl9hZG1pbl9tc2cyJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGltZXI6MjAwMCwgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKXsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICAgICAgdGltZXI6MzAwMCwgICAgIAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnc2F2ZV9hbmRfY2xvc2VfYnRuJykKICAgICAgICAgIH0KICAgICAgfWVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09IG51bGwpIHsKICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9zZWxlY3RfdXNlcl90eXBlX21zZzInKSk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX2NoYW5nZShwYWdlbm8pIHsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgdGhpcy5kZWxldGVfbGlzdCA9IFtdOwogICAgICB0aGlzLmFkZF9lZGl0PSAidHJ1ZSI7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgaWYgKHBhZ2VubyA9PSAwIHx8IHBhZ2VubyA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2VubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZW5vOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLm1haW5fcm9sZV91cmwoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgIT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSApIHsKICAgICAgICAgICAgICAgIHRoaXMub3JnYW5pemVfcm9sZXMocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX25vX3JvbGVfZm91bmRfbXNnJykpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnMycpKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlbm87CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMubWFpbl9yb2xlX3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgICBzZWFyY2hzdHJpbmc6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9yZ2FuaXplX3JvbGVzKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX25vX3JvbGVfZm91bmRfbXNnJykpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZzMnKSk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcm9sZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3JnYW5pemVfcm9sZXMocm9sZXNfbGlzdCkgewogICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcm9sZXNfbGlzdC5udW1iZXJfb2Zfcm93czsKICAgICAgdGhpcy5yb2xlX25hbWUgPSBbXTsKICAgICAgdGhpcy51c2VyX3R5cGVfbGlzdCA9IFtdOwogICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcm9sZXNfbGlzdC5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UgPT0gdW5kZWZpbmVkID8gMCA6IHJvbGVzX2xpc3QucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICB2YXIgcG9ydGFsX2xlbiA9IHJvbGVzX2xpc3QuZGF0YS5Qb3J0YWwubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvcnRhbF9sZW47IGkrKykgewogICAgICAgIHRoaXMudXNlcl90eXBlX2xpc3QucHVzaCgiUG9ydGFsIFVzZXIiKTsKICAgICAgICB0aGlzLnJvbGVfbmFtZS5wdXNoKHJvbGVzX2xpc3QuZGF0YS5Qb3J0YWxbaV0pOwogICAgICB9CiAgICAgIHZhciBib3RfbGVuID0gcm9sZXNfbGlzdC5kYXRhLkJvdC5sZW5ndGg7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm90X2xlbjsgaSsrKSB7CiAgICAgICAgdGhpcy51c2VyX3R5cGVfbGlzdC5wdXNoKCJCb3QgVXNlciIpOwogICAgICAgIHRoaXMucm9sZV9uYW1lLnB1c2gocm9sZXNfbGlzdC5kYXRhLkJvdFtpXSk7CiAgICAgIH0KICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICB0aGlzLnNlYXJjaF9wcm9kdWN0KCk7CiAgICAgIH0KICAgIH0sCiAgICBzZWFyY2hfcHJvZHVjdCgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuZGVsZXRlX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLmFkZF9lZGl0PSAidHJ1ZSI7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5tYWluX3JvbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFICYmCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICAgICAgICAgIHRoaXMub3JnYW5pemVfcm9sZXMocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX25vX3JvbGVfZm91bmRfbXNnJykpOwogICAgICAgICAgICAgIHRoaXMubG9hZF9yb2xlKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnYWRkX3JvbGVfaW50ZXJuYWxfc2VydmVyX21zZzMnKSk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX3JvbGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICAgICBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2FkZF9yb2xlX2RhdGFfZm9yX3NlYXJjaF9tc2cnKSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},null]}