{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue","mtime":1661252053823},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgQ291bnRyaWVzIGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvQ291bnRyaWVzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgZmluZ2VycHJpbnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9maW5nZXJwcmludCI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IHsgc3RyaW5nVHlwZUFubm90YXRpb24gfSBmcm9tICJAYmFiZWwvdHlwZXMiOwppbXBvcnQgeyBzdHJpbmdpZnkgfSBmcm9tICJxdWVyeXN0cmluZyI7CmltcG9ydCB7IFNvY2tldCB9IGZyb20gInBob2VuaXgtc29ja2V0IjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gInZ1ZS1waG9uZS1udW1iZXItaW5wdXQiOwppbXBvcnQgInZ1ZS1waG9uZS1udW1iZXItaW5wdXQvZGlzdC92dWUtcGhvbmUtbnVtYmVyLWlucHV0LmNzcyI7CmltcG9ydCBQYXNzd29yZFZhbGlkYXRvciBmcm9tICIuLi9QYWdlcy9QYXNzd29yZFZhbGlkYXRvci52dWUiOwppbXBvcnQgcGFnZV9ndWlkZSBmcm9tICJAL3BvcnRhbC9taXhpbnMvcGFnZV9ndWlkZS5qcyI7CmltcG9ydCBwYXRoIGZyb20gInBhdGgiOwoKZXhwb3J0IGRlZmF1bHQgewogIGJlZm9yZVJvdXRlRW50ZXIodG8sIGZyb20sIG5leHQpIHsKICAgIGNvbnNvbGUubG9nKCdXZWxjb21lIHRvIHRoZSBzd2FtcCEnKTsKICAgIG5leHQoKTsKICB9LAogIG1peGluczogW3BhZ2VfZ3VpZGVdLAogIHByb3BzOiBbInRpdGxlIl0sCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgICBWdWVQaG9uZU51bWJlcklucHV0LAogICAgUGFzc3dvcmRWYWxpZGF0b3IKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpc19vcGVuOnRydWUsCiAgICAgIGludGVudF9kYXRhOiBudWxsLAogICAgICBjYWxsZGF0YTogIiIsCiAgICAgIG5ld19wYXNzd29yZDogIiIsCiAgICAgIG9sZF9wYXNzd29yZDogIiIsCiAgICAgIGNvbmZpcm1fcGFzc3dvcmQ6ICIiLAogICAgICBjb3JyZWN0X3Bhc3N3b3JkOiBmYWxzZSwKICAgICAgY29tcGFueV9uYW1lOiBudWxsLAogICAgICBjb21wYW55X2lkX3NlbGVjdGVkOiBudWxsLAogICAgICBjb21wYW5pZXM6IFtdLAogICAgICBjb3VudHJ5X2xpc3Q6IG51bGwsCiAgICAgIGNvbXBhbnlfaWQ6IFtdLAogICAgICB1c2VyX2NvbXBhbnk6IG51bGwsCiAgICAgIHRpY2tldHNfYmFyX2FjY2VzczogZmFsc2UsCiAgICAgIGludml0ZV9jb21wYW55X2VtYWlsOiBudWxsLAogICAgICBpbnZpdGVfY29tcGFueV9uYW1lOiBudWxsLAogICAgICBvbGRfZmlsZV9uYW1lOiBudWxsLAogICAgICBmaWxlX2xhYmVsOiAiQ2hvb3NlIGZpbGUiLAogICAgICBpc3N1ZTogIiIsCiAgICAgIGlzc3VlX2Rlc2NyaXB0aW9uOiAiIiwKICAgICAgaW1nX2ZpbGU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBwaG90b19pbWdfdXJsOiAiIiwKICAgICAgZXhpc3RpbmdfZmlsZV9uYW1lOiBudWxsLAogICAgICB1c2VyX2NvdW50cnlfbmFtZTogewogICAgICAgIGNvZGU6ICIiLAogICAgICAgIG5hbWU6ICIiCiAgICAgIH0sCiAgICAgIHVzZXJfcGhvbmVfbnVtYmVyOiB0aGlzLiRzZXNzaW9uLmhhcygiUGhvbmVOdW1iZXIiKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlBob25lTnVtYmVyIikKICAgICAgICA6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnBob25lX25vCiAgICAgICAgOiAiIiwKICAgICAgdXNlcl9maXJzdF9uYW1lOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckZpcnN0TmFtZSIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckZpcnN0TmFtZSIpCiAgICAgICAgOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lCiAgICAgICAgOiAiIiwKICAgICAgdXNlcl9sYXN0X25hbWU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VyTGFzdE5hbWUiKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJMYXN0TmFtZSIpCiAgICAgICAgOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5sYXN0X25hbWUKICAgICAgICA6ICIiLAogICAgICBjb21wYW55X3NlbGVjdGVkOiB0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueU5hbWUiKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIikKICAgICAgICA6ICJTZWxlY3QgQSBDb21wYW55IiwKICAgICAgdXNlcl9jb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZQogICAgICAgIDogIiIsCiAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgIDogIiIsCiAgICAgIHVzZXJfY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZAogICAgICAgIDogIiIsCiAgICAgIHVzZXJfcm9sZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZQogICAgICAgIDogIiIsCiAgICAgIHVzZXJfdHlwZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucmVnaXN0cmF0aW9uX3R5cGUKICAgICAgICA6ICIiLAogICAgICBwaG9uZV9udW1iZXJfdmFsaWRpdHk6IC9cK1swLTldezksMTR9JC8sCiAgICAgIHJlZ19wd2Q6IC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXGQpKD89LipbI0AkISUqPyZdKVtBLVphLXpcZCNAJCElKj8mXXs4LH0vLAogICAgICByZWdfZW1haWw6IC9eKFswLTlhLXpBLVpdKFstLlx3XSpbMC05YS16QS1aXSkqQChbMC05YS16QS1aXVstXHddKlswLTlhLXpBLVpdXC4pK1thLXpBLVpdezIsOX0pJC8sCiAgICAgIG5vdGlmaWNhdGlvbnM6IFtdLAogICAgICB0b19zaG93X25vdGlmaWNhdGlvbnM6IGZhbHNlLAogICAgICBzb2NrZXQ6IG51bGwsCiAgICAgIHNjaGVkdWxlcl9jaGFubmVsOiBudWxsLAogICAgICB0cmFpbmluZ19jaGFubmVsOiBudWxsLAogICAgICBwaG9uZU51bWJlcjogbnVsbCwKICAgICAgdG91cl9ndWlkZV9pY29uOiByZXF1aXJlKCJAL3BvcnRhbC9hc3NldHMvaW1nL2luZm9faWNvbi5zdmciKSwKICAgICAgZGlzYWJsZV9uYXZiYXI6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZhbGlkT2xkUGFzc3dvcmQoKSB7CiAgICAgIGlmICh0aGlzLnJlZ19wd2QudGVzdCh0aGlzLm9sZF9wYXNzd29yZCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYCR7dGhpcy50bHQoJ2ludmFsaWRfcGFzc3dvcmQnKX1gOwogICAgICB9CiAgICB9LAogICAgdmFsaWRQYXNzd29yZCgpIHsKICAgICAgaWYgKHRoaXMucmVnX3B3ZC50ZXN0KHRoaXMubmV3X3Bhc3N3b3JkKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBgJHt0aGlzLnRsdCgnaW52YWxpZF9wYXNzd29yZCcpfWA7CiAgICAgIH0KICAgIH0sCiAgICB2YWxpZENvbmZpcm1QYXNzd29yZCgpIHsKICAgICAgaWYgKHRoaXMuY29uZmlybV9wYXNzd29yZCA9PSB0aGlzLm5ld19wYXNzd29yZCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBgJHt0aGlzLnRsdCgncGFzc19ub19tYXRjaCcpfWA7CiAgICAgIH0KICAgIH0sCiAgICAvLyB2YWxpZFBob25lTnVtYmVyKCkgewogICAgLy8gICBpZiAoCiAgICAvLyAgICAgdGhpcy5waG9uZV9udW1iZXJfdmFsaWRpdHkudGVzdCgKICAgIC8vICAgICAgIHRoaXMudXNlcl9waG9uZV9udW1iZXIucmVwbGFjZSgvXHMrL2csICIiKQogICAgLy8gICAgICkKICAgIC8vICAgKSB7CiAgICAvLyAgICAgcmV0dXJuIHRydWU7CiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgcmV0dXJuICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBwaG9uZSBudW1iZXIgaW4gdGhlIGZvcm1hdDogK0NvdW50cnlDb2RlIE51bWJlciI7CiAgICAvLyAgIH0KICAgIC8vIH0sCiAgICB1bnNlZW5fbm90aWZpY2F0aW9ucygpIHsKICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIXRoaXMubm90aWZpY2F0aW9uc1tpXS5pc19jbGVhcikgewogICAgICAgICAgY291bnQrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGNvdW50OwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuY291bnRyeV9saXN0ID0gQ291bnRyaWVzOwogICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJwaG90b19pbWdfdXJsIikpIHsKICAgICAgdGhpcy5waG90b19pbWdfdXJsID0gdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgicGhvdG9faW1nX3VybCIpCiAgICAgICAgOiAiIjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucGhvdG9faW1nX3VybCA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnBob3RvX2ltZ191cmwKICAgICAgICA6ICIiOwogICAgfQogICAgaWYgKAogICAgICB0aGlzLiRzZXNzaW9uLmhhcygiY291bnRyeV9uYW1lIikgJiYKICAgICAgdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICApIHsKICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlID0gdGhpcy4kc2Vzc2lvbi5nZXQoImNvdW50cnlfbmFtZSIpOwogICAgICBsZXQgc2VsZWN0X2NvdW50cnkgPSB0aGlzLmNvdW50cnlfbGlzdC5maWx0ZXIoY291bnRyeSA9PiB7CiAgICAgICAgcmV0dXJuIGNvdW50cnkuY29kZSA9PSB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGU7CiAgICAgIH0pOwogICAgICB0aGlzLnVzZXJfY291bnRyeV9uYW1lLm5hbWUgPSBzZWxlY3RfY291bnRyeVswXS5uYW1lOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlID0gdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY291bnRyeV9uYW1lCiAgICAgICAgOiAiIjsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb3VudHJ5X25hbWUgPT0gbnVsbCkgewogICAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZSA9ICIiOwogICAgICB9CiAgICAgIGlmICh0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBzZWxlY3RfY291bnRyeSA9IHRoaXMuY291bnRyeV9saXN0LmZpbHRlcihjb3VudHJ5ID0+IHsKICAgICAgICAgIHJldHVybiBjb3VudHJ5LmNvZGUgPT0gdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlOwogICAgICAgIH0pOwogICAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUubmFtZSA9CiAgICAgICAgICBzZWxlY3RfY291bnRyeVswXSA9PT0gdW5kZWZpbmVkID8gIiIgOiBzZWxlY3RfY291bnRyeVswXS5uYW1lOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy51c2VyX3JvbGUgPT0gIkFkbWluIikgewogICAgICB0aGlzLmNvbXBhbnlfc2VsZWN0ZWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUKICAgICAgICA6ICIiOwogICAgfQogICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmNvbXBhbnlfbGlzdF91cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIHRoaXMuY29tcGFuaWVzID0gcmVzcG9uc2UuZGF0YS5kYXRhWzBdOwogICAgICAgICAgdGhpcy5jb21wYW55X2lkID0gcmVzcG9uc2UuZGF0YS5kYXRhWzFdOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHRoaXMudXNlcl9maXJzdF9uYW1lID09IG51bGwgfHwgdGhpcy51c2VyX2ZpcnN0X25hbWUgPT0gIiIpIHsKICAgICAgdGhpcy51c2VyX2ZpcnN0X25hbWUgPSAiRmlyc3QiOwogICAgICB0aGlzLnVzZXJfbGFzdF9uYW1lID0gIkxhc3QiOwogICAgICB0aGlzLiRzZXNzaW9uLnNldCgiVXNlckZpcnN0TmFtZSIsIHRoaXMudXNlcl9maXJzdF9uYW1lKTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJMYXN0TmFtZSIsIHRoaXMudXNlcl9sYXN0X25hbWUpOwogICAgfQogICAgdmFyIG1lbnVzID0gdGhpcy4kc2Vzc2lvbi5oYXMoIkNoYXRib3RNZW51IikKICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKQogICAgICA6IFtdOwogICAgdmFyIHRpY2tldF9hY2Nlc3MgPSBtZW51cy5maWx0ZXIobWVudSA9PiB7CiAgICAgIHJldHVybiBtZW51Lm1haW5fbWVudS5uYW1lID09ICJUaWNrZXRzIjsKICAgIH0pOwogICAgaWYgKHRpY2tldF9hY2Nlc3MubGVuZ3RoID09IDApIHsKICAgICAgdGhpcy50aWNrZXRzX2Jhcl9hY2Nlc3MgPSBmYWxzZTsKICAgIH0gZWxzZSBpZiAodGlja2V0X2FjY2Vzcy5sZW5ndGggPT0gMSkgewogICAgICB0aGlzLnRpY2tldHNfYmFyX2FjY2VzcyA9IHRydWU7CiAgICB9CgogICAgdmFyIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gZmFsc2U7CgogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBtZW51cy5sZW5ndGg7IGkgPCBuOyBpICs9IDEpIHsKICAgICAgZm9yIChsZXQgaiA9IDAsIGwgPSBtZW51c1tpXS5zdWJfbWVudV9saXN0Lmxlbmd0aDsgaiA8IGw7IGogKz0gMSkgewogICAgICAgIGlmIChtZW51c1tpXS5zdWJfbWVudV9saXN0W2pdLm5hbWUgPT0gIlNjaGVkdWxlciIpIHsKICAgICAgICAgIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5zb2NrZXQgPSBuZXcgU29ja2V0KAogICAgICBwcm9jZXNzLmVudi5WVUVfQVBQX1BVU0hfTk9USUZJQ0FUSU9OU19XRUJTT0NLRVRfRU5EUE9JTlQsCiAgICAgIHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIG5vdGlmaWNhdGlvbl90ZXN0OiB0cnVlCiAgICAgICAgfQogICAgICB9CiAgICApOwogICAgdGhpcy5zb2NrZXQuY29ubmVjdCgpOwogICAgaWYgKEJvb2xlYW4obm90aWZpY2F0aW9uc19hY2Nlc3MpKSB7CiAgICAgIHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zID0gdHJ1ZTsKICAgICAgLy9Ob3RpZmljYXRpb24KICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbCA9IHRoaXMuc29ja2V0LmNoYW5uZWwoCiAgICAgICAgIm5vdGlmaWNhdGlvbl9jaGFubmVsOiIgKyB0aGlzLnVzZXJfY29tcGFueV9pZAogICAgICApOwogICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmpvaW4oKTsKICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vbigic2hvd19ub3RpZmljYXRpb25zIiwgcmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5pc19yZXNwb25zZSkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSByZXNwb25zZS5kYXRhLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMucHVzaChyZXNwb25zZS5kYXRhW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vZmYoInNob3dfbm90aWZpY2F0aW9ucyIpOwogICAgICB9KTsKICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vbigibmV3X25vdGlmaWNhdGlvbiIsIHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLnNob3dfbm90aWZpY2F0aW9ucyhyZXNwb25zZS5kYXRhKTsKICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMudW5zaGlmdChyZXNwb25zZS5kYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwucHVzaCgic2hvd19ub3RpZmljYXRpb25zIiwgewogICAgICAgIG5lZWRfbm90aWZpY2F0aW9uczogdHJ1ZSwKICAgICAgICBlbWFpbF9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIH0pOwogICAgfQogICAgdGhpcy50cmFpbmluZ19jaGFubmVsID0gdGhpcy5zb2NrZXQuY2hhbm5lbCgKICAgICAgInRyYWluaW5nX25vdGlmaWNhdGlvbl9jaGFubmVsOiIgKyB0aGlzLnVzZXJfY29tcGFueV9pZAogICAgKTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5qb2luKCk7CiAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwub24oInNob3dfbm90aWZpY2F0aW9ucyIsIHJlc3BvbnNlID0+IHsKICAgICAgaWYgKHJlc3BvbnNlLmlzX3Jlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gcmVzcG9uc2UuZGF0YS5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9ucy5wdXNoKHsKICAgICAgICAgICAgZGF0ZTogbW9tZW50KHJlc3BvbnNlLmRhdGFbaV0uSW5pdGlhdGVkT24sIFsiWVlZWS1NTS1ERCJdKS5mb3JtYXQoCiAgICAgICAgICAgICAgIkRvIE1NTSBZWVlZIgogICAgICAgICAgICApLAogICAgICAgICAgICAuLi5yZXNwb25zZS5kYXRhW2ldCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLm9mZigic2hvd19ub3RpZmljYXRpb25zIik7CiAgICB9KTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5vbigibmV3X25vdGlmaWNhdGlvbiIsIHJlc3BvbnNlID0+IHsKICAgICAgdGhpcy5zaG93X25vdGlmaWNhdGlvbnMocmVzcG9uc2UuZGF0YSk7CiAgICAgIHRoaXMubm90aWZpY2F0aW9ucy51bnNoaWZ0KHsKICAgICAgICBkYXRlOiBtb21lbnQocmVzcG9uc2UuZGF0YS5Jbml0aWF0ZWRPbiwgWyJZWVlZLU1NLUREIl0pLmZvcm1hdCgKICAgICAgICAgICJEbyBNTU0gWVlZWSIKICAgICAgICApLAogICAgICAgIC4uLnJlc3BvbnNlLmRhdGEKICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAgIG5lZWRfbm90aWZpY2F0aW9uczogdHJ1ZSwKICAgICAgZW1haWxfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgfSk7CiAgfSwKICBtb3VudGVkKCkgewogICAgYnVzLiRvbigiTGF5b3V0SGVscERhdGEiLCBkYXRhUGcgPT4gewogICAgICB0aGlzLmNhbGxkYXRhID0gZGF0YVBnOwogICAgfSk7CiAgICAvLyBidXMuJG9uKCdUYWJzTGF5b3V0SW5mbycsKGRhdGFGb3J0YWJzKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFGb3J0YWJzLCJkYXRhIG9mIHRhYiBwYW5lIik7CiAgICAvLyAgICAgICAgIHRoaXMuY2FsbGRhdGEgPSBkYXRhRm9ydGFiczsKICAgIC8vIH0pCiAgICBidXMuJG9uKCJzZW5kIGNvbXBhbnkgYXR0cmlidXRlcyIsICgpID0+IHsKICAgICAgYnVzLiRlbWl0KAogICAgICAgICJjb21wYW55IG5hbWUgYW5kIGNvbXBhbnkgaWQiLAogICAgICAgIHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIHRoaXMuY29tcGFueV9pZF9zZWxlY3RlZAogICAgICApOwogICAgfSk7CiAgICAvLyByZWZyZXNoUG9wb3ZlcigpOwoKICAgIHRoaXMuJHJvb3QuJG9uKCJzaWduX291dCIsICgpID0+IHsKICAgICAgdGhpcy5zaWdub3V0X2FwaSgpOwogICAgfSk7CiAgICAkKCIuZHJvcGRvd24tdG9nZ2xlIikuZHJvcGRvd24oKTsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiU2V0dGluZ1RvcG5hdmJhckRpc2FibGUiKSA9PSB0cnVlKSB7CiAgICAgIHRoaXMuZGlzYWJsZV9uYXZiYXIgPSB0cnVlOwogICAgfQogICAgdGhpcy4kcm9vdC4kb24oIkRhc2hib2FyZFNpZGViYXJEaXNhYmxlIiwgZGF0YSA9PiB7CiAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy5kaXNhYmxlX25hdmJhciA9IHRydWU7CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuZGlzYWJsZV9uYXZiYXIgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgfSwKICAvL1NlZSB0b20KICBtZXRob2RzOiB7CiAgICBsaXN0ZW5fZGF0YSgpIHsKICAgICAgdGhpcy5jYWxsZGF0YSA9IHRoaXMuJHJvdXRlLnBhdGg7CiAgICAgIC8vdGhpcy5jb21wX25hbWUgPSB0aGlzLiRyb3V0ZS5uYW1lOwogICAgICAvLyBFbWl0dGluZyBhIGN1c3RvbS1ldmVudCB2aWEgdGhlIEV2ZW50IEJ1cwogICAgICBidXMuJGVtaXQoIkVtaXR0aW5nX2RhdGEiLCB0aGlzLmNhbGxkYXRhKTsKICAgIH0sCiAgICBjaGVja19wYXNzd29yZChjb3JyZWN0UGFzc3dvcmQpIHsKICAgICAgdGhpcy5jb3JyZWN0X3Bhc3N3b3JkID0gY29ycmVjdFBhc3N3b3JkOwogICAgfSwKICAgIGVkaXRJbWFnZShlKSB7CiAgICAgIGNvbnN0IGltYWdlID0gZS50YXJnZXQuZmlsZXNbMF07CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGltYWdlKTsKICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgIHRoaXMucHJldmlld0ltYWdlID0gZS50YXJnZXQucmVzdWx0OwogICAgICAgIGlmICh0aGlzLnBob3RvX2ltZ191cmwpIHsKICAgICAgICAgIHRoaXMuZXhpc3RpbmdfZmlsZV9uYW1lID0gdGhpcy5waG90b19pbWdfdXJsLnNwbGl0KCIvIilbNF07CiAgICAgICAgfQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5lZGl0X3Byb2ZpbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIHVwbG9hZF9waG90bzogIlRydWUiLAogICAgICAgICAgICAgIHByb2ZpbGVfaW1hZ2U6IHRoaXMucHJldmlld0ltYWdlLnNwbGl0KCJiYXNlNjQsIilbMV0sCiAgICAgICAgICAgICAgZmlsZV9uYW1lOiBpbWFnZS5uYW1lLAogICAgICAgICAgICAgIGV4aXN0aW5nX2ZpbGVfbmFtZTogdGhpcy5leGlzdGluZ19maWxlX25hbWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLlBIT1RPX1VQTE9BRC5NU0dfQ09ERSA9PT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoYCR7dGhpcy50bHQoJ3Bob3RvX3VwbG9hZGVkX3N1Y2Nlc3NmdWxseScpfWApOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJwaG90b19pbWdfdXJsIiwgcmVzcG9uc2UuZGF0YS5JbWFnZVVybCk7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB9LCA1MDAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcoCiAgICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgndG9hc3Rlcl9maWxlX25hbWVfYWxyZWFkeV9leGlzdHMnKX1gCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH07CiAgICB9LAogICAgY3JlYXRlSW1hZ2UoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgIHRoaXMuYmxvZy5pbWdfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICByYWlzZV90aWNrZXQoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLiRyb3V0ZS5uYW1lID09ICJUaWNrZXRzIikgewogICAgICAgICQoIiN0aWNrZXRtb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogIlRpY2tldHMiLAogICAgICAgICAgcHJvcHM6IHRydWUsCiAgICAgICAgICBwYXJhbXM6IHsgcmFpc2VfdGlja2V0OiAiVHJ1ZSIgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY2xlYXJfZmllbGRzKCkgewogICAgICB0aGlzLmltZ19maWxlID0gIiI7CiAgICAgIHRoaXMuZmlsZV9sYWJlbCA9IGAke3RoaXMudGx0KCdjaG9vc2VfZmlsZScpfWA7CiAgICAgIHRoaXMuaXNzdWUgPSAiIjsKICAgICAgdGhpcy5pc3N1ZV9kZXNjcmlwdGlvbiA9ICIiOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgfSwKICAgIGVtYWlsX2NsYXNzKCkgewogICAgICBpZiAodGhpcy5yZWdfZW1haWwudGVzdCh0aGlzLmludml0ZV9jb21wYW55X2VtYWlsKSkgewogICAgICAgIHJldHVybiBgJHt0aGlzLnRsdCgnaXNfdmFsaWQnKX1gOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBgJHt0aGlzLnRsdCgnaXNfaW52YWxpZCcpfWA7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0X3Byb2ZpbGVfYXBpKCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBpZiAoIUJvb2xlYW4odGhpcy5waG9uZU51bWJlcikpIHsKICAgICAgICB0b2FzdHIud2FybmluZyhgJHt0aGlzLnRsdCgnZW50ZXJfdmFsaWRfcGhvbmVfbnVtYmVyJyl9YCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMucGhvbmVOdW1iZXIuaXNWYWxpZCAhPSB0cnVlKSB7CiAgICAgICAgdG9hc3RyLndhcm5pbmcoYCR7dGhpcy50bHQoJ2VudGVyX3ZhbGlkX3Bob25lX251bWJlcicpfWApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoCiAgICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlICE9IG51bGwgJiYKICAgICAgICB0aGlzLnVzZXJfZmlyc3RfbmFtZSAhPSAiIiAmJgogICAgICAgIHRoaXMudXNlcl9maXJzdF9uYW1lICE9ICJGIiAmJgogICAgICAgIHRoaXMudXNlcl9sYXN0X25hbWUgIT0gIiIgJiYKICAgICAgICB0aGlzLnVzZXJfbGFzdF9uYW1lICE9ICJMIgogICAgICAgIC8vdGhpcy52YWxpZFBob25lTnVtYmVyID09PSB0cnVlCiAgICAgICkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5lZGl0X3Byb2ZpbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGZpcnN0X25hbWU6IHRoaXMudXNlcl9maXJzdF9uYW1lLAogICAgICAgICAgICAgIGxhc3RfbmFtZTogdGhpcy51c2VyX2xhc3RfbmFtZSwKICAgICAgICAgICAgICBjb3VudHJ5X25hbWU6IHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZSwKICAgICAgICAgICAgICBwaG9uZV9udW1iZXI6IHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlBST0ZJTEVfVVBEQVRFRC5NU0dfQ09ERSkgewogICAgICAgICAgICAgIC8vIFN3YWwoewogICAgICAgICAgICAgIC8vICAgICB0aXRsZTogIlVwZGF0ZWQgU3VjY2Vzc2Z1bGx5ISEiLAogICAgICAgICAgICAgIC8vICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgLy8gICAgIHRleHQ6ICJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIiwKICAgICAgICAgICAgICAvLyAgICAgdGltZXI6MjAwMCwKICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKGAke3RoaXMudGx0KCdwcm9maWxlX3VwZGF0ZWRfc3VjY2Vzc2Z1bGx5Jyl9YCk7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJGaXJzdE5hbWUiLCB0aGlzLnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJMYXN0TmFtZSIsIHRoaXMudXNlcl9sYXN0X25hbWUpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJjb3VudHJ5X25hbWUiLCB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KAogICAgICAgICAgICAgICAgIlBob25lTnVtYmVyIiwKICAgICAgICAgICAgICAgIHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgiI2VkaXRfcHJvZmlsZV9tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoYCR7dGhpcy50bHQoJ2VudGVyX2FsbF9yZXF1aXJlZF9maWVsZHMnKX1gKTsKICAgICAgfQogICAgfSwKICAgIGNvbXBhbnlfY2hhbmdlZChjb21wYW55KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmIChjb21wYW55ICE9IHRoaXMuY29tcGFueV9zZWxlY3RlZCkgewogICAgICAgIHRoaXMuY29tcGFueV9zZWxlY3RlZCA9IGNvbXBhbnk7CiAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55TmFtZSIpKSB7CiAgICAgICAgICB0aGlzLiRzZXNzaW9uLnJlbW92ZSgiQ29tcGFueU5hbWUiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkNvbXBhbnlOYW1lIiwgdGhpcy5jb21wYW55X3NlbGVjdGVkKTsKICAgICAgICBpZiAodGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpKSB7CiAgICAgICAgICB0aGlzLiRzZXNzaW9uLnJlbW92ZSgiQ29tcGFueUlkIik7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KAogICAgICAgICAgIkNvbXBhbnlJZCIsCiAgICAgICAgICB0aGlzLmNvbXBhbnlfaWRbdGhpcy5jb21wYW5pZXMuaW5kZXhPZih0aGlzLmNvbXBhbnlfc2VsZWN0ZWQpXQogICAgICAgICk7CiAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfbmV3X3Bhc3N3b3JkKCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5vbGRfcGFzc3dvcmQgIT0gIiIgJiYKICAgICAgICB0aGlzLmNvcnJlY3RfcGFzc3dvcmQgPT0gdHJ1ZSAmJgogICAgICAgIHRoaXMudmFsaWRDb25maXJtUGFzc3dvcmQgPT0gdHJ1ZQogICAgICApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgdGV4dDogYCR7dGhpcy50bHQoJ3dhaXRfd2hpbGVfd2Vfc3VibWl0X2RldGFpbHMnKX1gLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImluZm8iCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLm5ld19wYXNzd29yZF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBvbGRfcGFzc3dvcmQ6IHRoaXMub2xkX3Bhc3N3b3JkLAogICAgICAgICAgICAgIG5ld19wYXNzd29yZDogdGhpcy5uZXdfcGFzc3dvcmQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGRhdGU6IGRhdGUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuUEFTU1dPUkRfSU5DT1JSRUNUXzEwMzEuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoYCR7dGhpcy50bHQoJ2luY29ycmVjdF9wYXNzd29yZCcpfWApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuUEFTU1dPUkRfUkVTRVRfU1VDQ0VTU0ZVTF8xMDI4Lk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoCiAgICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgncGFzc3dvcmRfdXBkYXRlZF9zdWNjZXNzZnVsbHknKX1gCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAkKCIjY2hhbmdlX3Bhc3N3b3JkX21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5QQVNTV09SRF9TSU1JTEFSLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgnY2Fubm90X3NldF9vbGRfcGFzc3dvcmQnKX1gLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLk9MRF9QQVNTV09SRF9OT1RfTUFUQ0guTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IGAke3RoaXMudGx0KCdvbGRfcGFzc19ub19tYXRjaCcpfWAsCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub2xkX3Bhc3N3b3JkID0gIiI7CiAgICAgICAgICAgIHRoaXMubmV3X3Bhc3N3b3JkID0gIiI7CiAgICAgICAgICAgIHRoaXMuY29uZmlybV9wYXNzd29yZCA9ICIiOwogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKGAke3RoaXMudGx0KCdlbnRlcl9hbGxfcmVxdWlyZWRfZmllbGRzJyl9YCk7CiAgICAgIH0KICAgIH0sCiAgICBwYXNzd29yZF90b2dnbGUoaWQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICBpZiAocGFzc3dvcmQudHlwZSA9PSAidGV4dCIpIHsKICAgICAgICBwYXNzd29yZC50eXBlID0gInBhc3N3b3JkIjsKICAgICAgfSBlbHNlIGlmIChwYXNzd29yZC50eXBlID09ICJwYXNzd29yZCIpIHsKICAgICAgICBwYXNzd29yZC50eXBlID0gInRleHQiOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlX3N1cGVyYWRtaW4oZXZ0KSB7CiAgICAgIGlmIChldnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuY29tcGFueV9uYW1lID0gZXZ0OwogICAgICAgIHRoaXMuY29tcGFueV9pZF9zZWxlY3RlZCA9IHRoaXMuY29tcGFueV9pZFt0aGlzLmNvbXBhbmllcy5pbmRleE9mKGV2dCldOwogICAgICAgIGJ1cy4kZW1pdCgiY29tcGFueSBhdHRyaWJ1dGVzIHVwZGF0ZWQiLCAiVHJ1ZSIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9pbnZpdGUoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLmludml0ZV9jb21wYW55X25hbWUgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoYCR7dGhpcy50bHQoJ2VudGVyX2FsbF9yZXF1aXJlZF9maWVsZHMnKX1gKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnJlZ19lbWFpbC50ZXN0KHRoaXMuaW52aXRlX2NvbXBhbnlfZW1haWwpID09IGZhbHNlKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKGAke3RoaXMudGx0KCdlbnRlcl92YWxpZF9lbWFpbCcpfWApOwogICAgICB9IGVsc2UgewogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnJlZmVycmFsc191cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgaW52aXRlZF9jb21wYW55X25hbWU6IHRoaXMuaW52aXRlX2NvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBpbnZpdGVkX2NvbXBhbnlfZW1haWw6IHRoaXMuaW52aXRlX2NvbXBhbnlfZW1haWwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNQUlMX1NFTlRfU1VDQ0VTU0ZVTExZLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgYnVzLiRlbWl0KCJpbnZpdGVfdXBkYXRlIiwgImxvYWRlcl9vbiIpOwogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQoIiNpbnZpdGVfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICB0aGlzLmludml0ZV9jb21wYW55X25hbWUgPSAiIjsKICAgICAgICAgICAgdGhpcy5pbnZpdGVfY29tcGFueV9lbWFpbCA9ICIiOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzaWdub3V0X2FwaSgpIHsKICAgICAgYnVzLiRlbWl0KCJMb2dvdXQgaGFzIGJlZW4gY2xpY2tlZCIsICJUcnVlIik7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5jbGVhcl9hY2Nlc3NfdG9rZW5fdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLmV4ZWN1dGVfc2lnbm91dCgpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZXhlY3V0ZV9zaWdub3V0KCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZXhlY3V0ZV9zaWdub3V0KCkgewogICAgICBsZXQgaXNfc3VwZXJfYWRtaW4gPSB0aGlzLiRzZXNzaW9uLmdldCgiaXNfc3VwZXJfYWRtaW4iKTsKICAgICAgaWYgKGlzX3N1cGVyX2FkbWluKSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuc3VwZXJfYWRtaW5fbG9nb3V0KCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoInJ0Iil9YAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VU0VSX0xPR0dFRF9PVVRfMTAzMi5NU0dfQ09ERSB8fAogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVE9LRU5fSU5WQUxJRF8wMDAxLk1TR19DT0RFIHx8CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0NSRURFTlRJQUxTXzAwMDUuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgICAucG9zdChhcGlfY2FsbHMuc3VwZXJfYWRtaW5fYm90X2xvZ291dCgpLCB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICBpZiAodGhpcy50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIkNsZWFyX1JlZnJlc2hfVG9rZW5fSW50ZXJ2YWwiLCB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJfaW50ZXJ2YWw6IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnN1cGVyX2FkbWluX2JvdF9sb2dvdXQoKSwgewogICAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJDbGVhcl9SZWZyZXNoX1Rva2VuX0ludGVydmFsIiwgewogICAgICAgICAgICAgICAgICAgIGNsZWFyX2ludGVydmFsOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwogICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5kZXN0cm95KCk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuc2lnbm91dF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgicnQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlVTRVJfTE9HR0VEX09VVF8xMDMyLk1TR19DT0RFIHx8CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5UT0tFTl9JTlZBTElEXzAwMDEuTVNHX0NPREUgfHwKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVkFMSURfQ1JFREVOVElBTFNfMDAwNS5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIkNsZWFyX1JlZnJlc2hfVG9rZW5fSW50ZXJ2YWwiLCB7CiAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpOwogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy8gdXBkYXRlX25vdGlmaWNhdGlvbnNfbGlzdCgpIHsKICAgIC8vICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAvLyAgICAgbmVlZF9ub3RpZmljYXRpb25zOiB0cnVlLAogICAgLy8gICAgIGVtYWlsX2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgIH0pOwogICAgLy8gfSwKICAgIHNlZW5fYWxsX25vdGlmaWNhdGlvbnMoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGxldCBsYXN0X2luZGV4ID0gdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aCAtIDE7CiAgICAgIGlmIChsYXN0X2luZGV4ID49IDApIHsKICAgICAgICBpZiAodGhpcy5zY2hlZHVsZXJfY2hhbm5lbCkgewogICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fc2VlbiIsIHsKICAgICAgICAgICAgcmVxX2lkOiB0aGlzLm5vdGlmaWNhdGlvbnNbbGFzdF9pbmRleF0uaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy50cmFpbmluZ19jaGFubmVsKSB7CiAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwucHVzaCgibm90aWZpY2F0aW9uX3NlZW4iLCB7CiAgICAgICAgICAgIHJlcV9pZDogdGhpcy5ub3RpZmljYXRpb25zW2xhc3RfaW5kZXhdLmlkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9hbGxfbm90aWZpY2F0aW9ucygpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGxldCByZXFfbGlzdF9jbGVhcmVkID0gW107CiAgICAgIGxldCBub3RpZmljYXRpb25zX3RlbXBfbGlzdCA9IHRoaXMubm90aWZpY2F0aW9uczsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG5vdGlmaWNhdGlvbnNfdGVtcF9saXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBub3RpZmljYXRpb25zX3RlbXBfbGlzdFtpXSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbnNbaV0uTm90aWZpY2F0aW9uaWQpIHsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcV9saXN0X2NsZWFyZWQucHVzaChub3RpZmljYXRpb25zX3RlbXBfbGlzdFtpXS5pZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zX3RlbXBfbGlzdC5maWx0ZXIoCiAgICAgICAgbm90aWZpY2F0aW9uID0+IHJlcV9saXN0X2NsZWFyZWQuaW5jbHVkZXMobm90aWZpY2F0aW9uLmlkKSA9PT0gZmFsc2UKICAgICAgKTsKICAgIH0sCiAgICBjbGVhcl9zaW5nbGVfbm90aWZpY2F0aW9uKHJlcV9pZCwgaW5kZXgpIHsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGlmIChyZXFfaWQgIT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5ub3RpZmljYXRpb25zW2luZGV4XS5Ob3RpZmljYXRpb25pZCkgewogICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgcmVxX2lkOiByZXFfaWQKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwucHVzaCgibm90aWZpY2F0aW9uX2NsZWFyZWQiLCB7CiAgICAgICAgICAgIHJlcV9pZDogcmVxX2lkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X25vdGlmaWNhdGlvbnMoZGF0YSkgewogICAgICBpZiAoZGF0YSAhPSAxKSB7CiAgICAgICAgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQpIHsKICAgICAgICAgIHZhciBkYXRlOwogICAgICAgICAgdmFyIG1vbnRoTmFtZXMgPSBbCiAgICAgICAgICAgICJKYW4iLAogICAgICAgICAgICAiRmViIiwKICAgICAgICAgICAgIk1hciIsCiAgICAgICAgICAgICJBcHIiLAogICAgICAgICAgICAiTWF5IiwKICAgICAgICAgICAgIkp1biIsCiAgICAgICAgICAgICJKdWwiLAogICAgICAgICAgICAiQXVnIiwKICAgICAgICAgICAgIlNlcCIsCiAgICAgICAgICAgICJPY3QiLAogICAgICAgICAgICAiTm92IiwKICAgICAgICAgICAgIkRlYyIKICAgICAgICAgIF07CiAgICAgICAgICBkYXRlID0KICAgICAgICAgICAgZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVsyXSArCiAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgIG1vbnRoTmFtZXNbZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVsxXSAtIDFdICsKICAgICAgICAgICAgIiAiICsKICAgICAgICAgICAgZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVswXTsKICAgICAgICAgIHZhciB0aW1lOwogICAgICAgICAgZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF07CiAgICAgICAgICBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA8IDEyKSB7CiAgICAgICAgICAgIHRpbWUgPQogICAgICAgICAgICAgIE51bWJlcihkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSArICI6MDAgYW0iOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdID09IDEyKSB7CiAgICAgICAgICAgIHRpbWUgPSAiMTI6MDAgcG0iOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA+IDEyICYmCiAgICAgICAgICAgIGRhdGEudmlzaXRfc2xvdC5zcGxpdCgiLSIpWzBdLnNwbGl0KCI6IilbMF0gPCAyNAogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRpbWUgPQogICAgICAgICAgICAgIE51bWJlcihkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSAtCiAgICAgICAgICAgICAgMTIgKwogICAgICAgICAgICAgICI6MDAgcG0iOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdID09IDI0KSB7CiAgICAgICAgICAgIHRpbWUgPSAiMTI6MDAgYW0iOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQgPT0gIkFwcG9pbnRtZW50IERlbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICBkYXRhLnZpc2l0b3JfbmFtZSArCiAgICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgnaGFzX2NhbmNlbGxlZF9hcHBvaW50bWVudF9zY2hlZHVsZV9vbicpfWAgKwogICAgICAgICAgICAgICAgZGF0ZSArCiAgICAgICAgICAgICAgICAiIGF0ICIgKwogICAgICAgICAgICAgICAgdGltZQogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLk5vdGlmaWNhdGlvbmlkID09ICJBcHBvaW50bWVudCBDb25maXJtZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIGRhdGEudmlzaXRvcl9uYW1lICsKICAgICAgICAgICAgICAgIGAke3RoaXMudGx0KCdoYXNfY29uZmlybWVkX2FwcG9pbnRtZW50X3NjaGVkdWxlX29uJyl9YCArCiAgICAgICAgICAgICAgICBkYXRlICsKICAgICAgICAgICAgICAgICIgYXQgIiArCiAgICAgICAgICAgICAgICB0aW1lCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQgPT0gIkFwcG9pbnRtZW50IFJlc2NoZWR1bGVkIikgewogICAgICAgICAgICB0b2FzdHIud2FybmluZygKICAgICAgICAgICAgICBkYXRhLnZpc2l0b3JfbmFtZSArCiAgICAgICAgICAgICAgIGAke3RoaXMudGx0KCdoYXNfcmVzY2hlZHVsZWRfYXBwb2ludG1lbnRfb24nKX1gICsKICAgICAgICAgICAgICAgIGRhdGUgKwogICAgICAgICAgICAgICAgIiBhdCAiICsKICAgICAgICAgICAgICAgIHRpbWUKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5Ob3RpZmljYXRpb25pZCA9PSAiQXBwb2ludG1lbnQgU2NoZWR1bGVkIikgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygKICAgICAgICAgICAgICBkYXRhLnZpc2l0b3JfbmFtZSArCiAgICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgnaGFzX2JlZW5fc2NoZWR1bGVkX2FuX2FwcG9pbnRtZW50X29uJyl9YCArCiAgICAgICAgICAgICAgICBkYXRlICsKICAgICAgICAgICAgICAgICIgYXQgIiArCiAgICAgICAgICAgICAgICB0aW1lCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLk1vZGVsVHlwZSA9PSAiSW50ZW50LERpYWxvZ3VlIikgewogICAgICAgICAgdmFyIGRhdGU7CiAgICAgICAgICBkYXRlID0gbW9tZW50KGRhdGEuSW5pdGlhdGVkT24sIFsiWVlZWS1NTS1ERCJdKS5mb3JtYXQoIkRvIE1NTSBZWVlZIik7CiAgICAgICAgICBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiRmFpbGVkIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICAgYCR7dGhpcy50bHQoJ3RyYWluaW5nX29mX21vZGVsX29uJyl9ICR7ZGF0ZX0gJHt0aGlzLnRsdCgnZmFpbGVkX2NvbnRhY3RfYWRtaW4nKX1gCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIkNvbXBsZXRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoCiAgICAgICAgICAgICAgYCR7dGhpcy50bHQoJ3RyYWluaW5nX29mX25ld19tb2RlbF9pbml0aWF0ZWQnKX0gJHtkYXRlfSAke3RoaXMudGx0KCdoYXNfYmVlbl9jb21wbGV0ZWRfc3VjY2Vzc2Z1bGx5Jyl9YAogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLlRyYWluaW5nU3RhdHVzID09ICJTdGFydGVkIikgewogICAgICAgICAgICB0b2FzdHIuaW5mbygKICAgICAgICAgICAgICBgJHt0aGlzLnRsdCgnbmV3X3JlcV9mb3JfdHJhaW5pbmdfaW5pdGlhdGVkJyl9ICR7ZGF0ZX0uYAogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5Nb2RlbFR5cGUpIHsKICAgICAgICAgIHZhciBkYXRlOwogICAgICAgICAgZGF0ZSA9IG1vbWVudChkYXRhLkluaXRpYXRlZE9uLCBbIllZWVktTU0tREQiXSkuZm9ybWF0KCJEbyBNTU0gWVlZWSIpOwogICAgICAgICAgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIkZhaWxlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKAogICAgICAgICAgICAgIGAke3RoaXMudGx0KCd0cmFpbmluZ19vZicpfSAke2RhdGEuTW9kZWxUeXBlfSAke3RoaXMudGx0KCdtb2RlbF9vbicpfSAke2RhdGV9ICR7dGhpcy50bHQoJ2ZhaWxlZF9jb250YWN0X2FkbWluJyl9YAogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLlRyYWluaW5nU3RhdHVzID09ICJDb21wbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIGAke3RoaXMudGx0KCd0cmFpbmluZ19vZl9uZXcnKX0gJHtkYXRhLk1vZGVsVHlwZX0gJHt0aGlzLnRsdCgnbW9kZWxfaW5pdGlhdGVkX29uJyl9ICR7ZGF0ZX0gJHt0aGlzLnRsdCgnaGFzX2JlZW5fY29tcGxldGVkX3N1Y2Nlc3NmdWxseScpfWAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiU3RhcnRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmluZm8oCiAgICAgICAgICAgICAgYCR7dGhpcy50bHQoJ25ld19yZXFfZm9yX3RyYWluaW5nJyl9ICR7ZGF0YS5Nb2RlbFR5cGV9ICR7dGhpcy50bHQoJ21vZGVsX2hhc19iZWVuX2luaXRpYXRlZF9vbicpfSAke2RhdGV9LmAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdGFydF90b3VyKCkgewogICAgICB0aGlzLiRyb290LiRlbWl0KCJzaG93X3RvdXJfZ3VpZGUiLCB0cnVlKTsKICAgIH0sCiAgICBnZW5lcmF0ZV9lbWFpbF93aXphcmQobW9kZWxUeXBlLCBpbml0aWF0ZWRPbikgewogICAgICBsZXQgdXNlcm5hbWUgPSBgJHt0aGlzLnVzZXJfZmlyc3RfbmFtZX0gJHt0aGlzLnVzZXJfbGFzdF9uYW1lfWA7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICBpZiAobW9kZWxUeXBlID09ICJJbnRlbnQsRGlhbG9ndWUiKSB7CiAgICAgICAgYS5ocmVmID0gYG1haWx0bzphZG1pbkBjZW5zZS5haT9zdWJqZWN0PSR7dGhpcy50bHQoJ2NoYXRib3RfbW9kZWxfdHJhaW5pbmdfZmFpbGVkX29uJyl9ICR7aW5pdGlhdGVkT259LiZib2R5PSR7dGhpcy50bHQoJ2hpX2NlbnNlX3RlYW0nKX0sJTBEJTBBLCAke3RoaXMudGx0KCdjaGF0Ym90X2ZhaWxlZF9hZG1pbl93aWxsX2xvb2snKX0uJTBEJTBBJHt0aGlzLnRsdCgndGhhbmtzJyl9LCUwRCUwQSR7dXNlcm5hbWV9YDsKICAgICAgfSBlbHNlIHsKICAgICAgICBhLmhyZWYgPSBgbWFpbHRvOmFkbWluQGNlbnNlLmFpP3N1YmplY3Q9JHttb2RlbFR5cGV9ICR7dGhpcy50bHQoJ21vZGVsX3RyYWluaW5nX2ZhaWxlZF9vbicpfSAke2luaXRpYXRlZE9ufS4mYm9keT0ke3RoaXMudGx0KCdoaV9jZW5zZV90ZWFtJyl9LCUwRCUwQSwgJHt0aGlzLnRsdCgndGhlJyl9ICR7bW9kZWxUeXBlfSAke3RoaXMudGx0KCdjaGF0Ym90X2ZhaWxlZF9hZG1pbl93aWxsX2xvb2snKX0uJTBEJTBBJHt0aGlzLnRsdCgndGhhbmtzJyl9LCUwRCUwQSR7dXNlcm5hbWV9YDsKICAgICAgfQogICAgICBhLmNsaWNrKCk7CiAgICB9LAogICAgcGFnZV9yZWRpcmVjdCgpIHsKICAgICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUgIT09ICJEYXNoYm9hcmQiKSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAiRGFzaGJvYXJkIiB9KTsKICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJjaGFuZ2Vfc2lkZWJhcl9tYWluX21lbnUiLCAiRGFzaGJvYXJkIik7CiAgICAgIH0KICAgIH0sCiAgICB0b3BuYXZiYXJfZGlzYWJsZSgpIHsKICAgICAgaWYgKHRoaXMuZGlzYWJsZV9uYXZiYXIgPT09IHRydWUpIHsKICAgICAgICByZXR1cm4gInBvaW50ZXItZXZlbnRzOm5vbmU7IjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0KICB9LAoKCn07Cg=="},null]}