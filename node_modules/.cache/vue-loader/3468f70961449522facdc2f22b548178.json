{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue","mtime":1660042032563},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCB7IHRzT2JqZWN0S2V5d29yZCB9IGZyb20gIkBiYWJlbC90eXBlcyI7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQWRkVGFza1BhZ2UiLAogIG1peGluczogWwogICAgZnJlZXplX3BvcnRhbCwKICAgIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwKICBdLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlucHV0X2xpc3Q6IHsKICAgICAgICB0YXNrX25hbWU6ICIiLAogICAgICAgIGludGVudDogIiIsCiAgICAgICAgZmllbGRzOiBbXSwKICAgICAgICBxdWVzdGlvbjogIiIsCiAgICAgICAgcXVlc3Rpb25faWQ6ICIiLAogICAgICB9LAogICAgICB0b3RhbF9wYWdlczogMSwKICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICBwYWdlX25vOiAxLAogICAgICBxdWVzdGlvbl90ZXh0OiBmYWxzZSwKICAgICAgcXVlc3Rpb25fZW50ZXJlZDogIiIsCiAgICAgIGludGVudGxpc3Q6IFtdLAogICAgICB0YXNrX2xpc3Q6IFtdLAogICAgICBvcmlnaW5hbF9pbnRlbnRfbGlzdDogW10sCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgIHF1ZXN0aW9uc19saXN0OiBbXSwKICAgICAgLy8gaGFyc2gKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgdGFza190eXBlOiAiRGVmYXVsdCIsCiAgICAgIHRhc2tfdHlwZXM6IFsiRW1haWwiLCAiU01TIiwgIkRlZmF1bHQiXSwKICAgICAgZW1haWxfdG9fdXNlcjogdHJ1ZSwKICAgICAgYWRkX2N1c3RvbXNfZW1haWw6IHRydWUsCiAgICAgIG5ld19jdXN0b21fZW1haWw6IG51bGwsCiAgICAgIGN1c3RvbV9lbWFpbHM6IFtdLAogICAgICBlbWFpbF90aXRsZTogbnVsbCwKICAgICAgZW1haWxfYm9keTogbnVsbCwKICAgICAgZW1haWxfdmFyaWFibGVzOiBbXSwKICAgICAgc21zX3RvX3VzZXI6IHRydWUsCiAgICAgIGFkZF9jdXN0b21zX251bWJlcjogdHJ1ZSwKICAgICAgbmV3X2N1c3RvbV9udW1iZXI6IG51bGwsCiAgICAgIGN1c3RvbV9udW1iZXI6IFtdLAogICAgICBzbXNfYm9keTogbnVsbCwKICAgICAgc21zX3ZhcmlibGVzOiBbXSwKICAgICAgc2VsZWN0ZWRfdGFzazogbnVsbCwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOmZhbHNlLAogICAgICAvLyAtLS0tCiAgICAgIGNvbXBhbnlpZDoKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpCiAgICAgICAgICA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55bmFtZToKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIikKICAgICAgICAgIDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgdmFyaWFibGU6ICJ7e25hbWV9fSIsCiAgICAgIHByZXZpZXc6IGZhbHNlLAogICAgICBkZWxldGVfdGFza19pZHM6IFtdLAogICAgICBib2R5X2NvbnRlbnQ6IGBIaSB7e25hbWV9fSwKICAgICAgICBZb3UgYXJlIHJlY2VpdmluZyB0aGlzIGVtYWlsIGJlY2F1c2UgeW91IChvciBzb21lb25lIGVsc2UpIGhhdmUgcmVxdWVzdGVkIHRvIHJlc2V0IHRoZSBwYXNzd29yZCBvZiB7e25hbWV9fSBhY2NvdW50LgogICAgICAgIFBsZWFzZSBjbGljayBvbiB0aGUgZm9sbG93aW5nIGxpbmssIG9yIHBhc3RlIHRoaXMgaW50byB5b3VyIGJyb3dzZXIgdG8gY29tcGxldGUgdGhlIHByb2Nlc3M6CiAgICAgICAgaHR0cHM6Ly9jZW5zZS5haS9jaGFuZ2UtcGFzc3dvcmQKICAgICAgICBJZiB5b3UgZGlkIG5vdCByZXF1ZXN0IHRoaXMsIHBsZWFzZSBpZ25vcmUgdGhpcyBlbWFpbCBhbmQgeW91ciBwYXNzd29yZCB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuCgogICAgICAgIFJlZ2FyZHMsCiAgICAgICAgQWRtaW5gLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRfdGFzaygpOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5lclRyYWluaW5nUGFnZURpc2FibGVkIiwgKGRhdGEpID0+ewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSkKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjdGFza21vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmNsZWFyX2ZpZWxkcygpOwogICAgfSk7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgIC8vICQoJ2RpdjppbnB1dCcpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRfdGFzaygpewogICAgICBpZighdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKXsKICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoJ3Nob3cnKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGxvYWRfdGFzaygpIHsKICAgICAgaWYgKAogICAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikgJiYKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgKSB7CiAgICAgICAgdG9hc3RyLndhcm5pbmcoIlBsZWFzZSBzZWxlY3QgYSBjb21wYW55IG5hbWUgZnJvbSB0aGUgZHJvcGRvd24iKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuc2hvd19pbnRlbnRfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBnZXRfaW50ZW50czogdHJ1ZSwKICAgICAgICAgICAgc2hvd2ludGVudDogIlRydWUiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgLy8gICB0aGlzLmludGVudGxpc3QucHVzaCgKICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKQogICAgICAgICAgLy8gICApOwogICAgICAgICAgLy8gfQogICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdC5wdXNoKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGFbaV0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc1Nob3c6IHRydWUsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgLy8gY29uc29sZS5sb2coIk1BaU4gTElTVCIsIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KTsKICAgICAgICAgIHRoaXMudGFza19saXN0ID0gW107CiAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSA9PSAiZGVmYXVsdCIpIHsKICAgICAgICAgICAgICBsZXQgZGVzYyA9IFtdOwogICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlcykgewogICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgUXVlc3Rpb25JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5TbG90TmFtZSwKICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0LAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYywKICAgICAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgICAgICBUYXNrX1R5cGU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlID09ICJFbWFpbCIpIHsKICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIEludGVudDogIk5vbmUiLAogICAgICAgICAgICAgICAgLy8gSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrRGV0YWlscywKICAgICAgICAgICAgICAgIFRhc2tfSWQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tJRCwKICAgICAgICAgICAgICAgIFRhc2tfVHlwZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUgPT0gIlNNUyIpIHsKICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIEludGVudDogIk5vbmUiLAogICAgICAgICAgICAgICAgLy8gSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrRGV0YWlscywKICAgICAgICAgICAgICAgIFRhc2tfSWQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tJRCwKICAgICAgICAgICAgICAgIFRhc2tfVHlwZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0pIHsKICAgICAgICAgICAgICBsZXQgZGVzYyA9IFtdOwogICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlcykgewogICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgUXVlc3Rpb25JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5TbG90TmFtZSwKICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0LAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYywKICAgICAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgICAgICBUYXNrX1R5cGU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygidGFzayBpZCIpOwogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lEKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5vcmlnaW5hbF9pbnRlbnRfbGlzdCA9IHRoaXMudGFza19saXN0OwogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5vcmlnaW5hbF9pbnRlbnRfbGlzdCk7CiAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KSB7CiAgICAgICAgICAvLyAgIGxldCBkZXNjID0gW107CiAgICAgICAgICAvLyAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlcykgewogICAgICAgICAgLy8gICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAvLyAgICAgICBUZXh0OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlRleHQKICAgICAgICAgIC8vICAgICB9KTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgLy8gICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgLy8gICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAvLyAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAvLyAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgLy8gICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgLy8gICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSwKICAgICAgICAgIC8vICAgICB9KTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gfQogICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGFkZF9xdWVzdGlvbih0eXBlLCBpbmRleCkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgIGlmICh0aGlzLmlzRWRpdCA9PSB0cnVlKXsKICAgICAgICAgIHZhciBjb3VudCA9IHRoaXMucXVlc3Rpb25zX2xpc3QubGVuZ3RoICsgMjsgICAgICAgICAgCiAgICAgICAgICB0aGlzLnF1ZXN0aW9uc19saXN0LnB1c2goewogICAgICAgICAgVGV4dDogIiIsCiAgICAgICAgICBRdWVzdGlvbklkOiAiUXVlc3Rpb25fTnVtYmVyXyIgKyBjb3VudCArICJfIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICwKICAgICAgICB9KTsKICAgICAgICAgIGNvdW50ID0gY291bnQgKyAxOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICB0aGlzLnF1ZXN0aW9uc19saXN0LnB1c2goewogICAgICAgICAgVGV4dDogIiIsCiAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLnF1ZXN0aW9uc19saXN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfZW1haWwodHlwZSwgaW5kZXgpIHsKICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICB0aGlzLmN1c3RvbV9lbWFpbHMucHVzaCh0aGlzLm5ld19jdXN0b21fZW1haWwpOwogICAgICAgIHRoaXMubmV3X2N1c3RvbV9lbWFpbCA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuY3VzdG9tX2VtYWlscy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgYWRkX251bWJlcih0eXBlLCBpbmRleCkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIiAmJiBldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIHRoaXMuY3VzdG9tX251bWJlci5wdXNoKHRoaXMubmV3X2N1c3RvbV9udW1iZXIpOwogICAgICAgIHRoaXMubmV3X2N1c3RvbV9udW1iZXIgPSBudWxsOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICB0aGlzLmN1c3RvbV9udW1iZXIuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGludGVudF9zZWxlY3RlZF9hcGkoKSB7fSwKICAgIGVkaXRfbW9kYWwoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBpbmRleCA9IHRoaXMuc2VsZWN0ZWRfdGFzazsKICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlOwogICAgICB0aGlzLnByZXZpZXcgPSBmYWxzZTsKICAgICAgLy8gdGhpcy50YXNrX3R5cGUgPSBCb29sZWFuKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGUpCiAgICAgIC8vICAgPyB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlCiAgICAgIC8vICAgOiAiRGVmYXVsdCIKICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LmludGVudCA9IHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQ7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza05hbWU7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uWzBdLlRleHQ7CiAgICAgIC8vIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnNwbGljZSgwLCAxKTsKICAgICAgLy8gZm9yICh2YXIgaiBpbiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbikgewogICAgICAvLyAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbltqXSk7CiAgICAgIC8vIH0KICAgIH0sCiAgICBzZWxlY3RlZF90YXNrcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGhpcy50YXNrX2xpc3Q7CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKGluZGV4KTsKICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7CiAgICAgICAgICBsZXQgdmFsX2luZGV4ID0gdGhpcy5jaGVja2VkX2xpc3QuaW5kZXhPZihpbmRleCk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5zcGxpY2UodmFsX2luZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhZGRfZWRpdF90YXNrcygpIHsKICAgICAgaWYgKHRoaXMudGFza190eXBlID09ICJEZWZhdWx0IikgewogICAgICAgIHZhciBlbXB0eV9xdWVzdGlvbnMgPSB0aGlzLnF1ZXN0aW9uc19saXN0LmZpbHRlcigocXVlc3Rpb24pID0+IHsKICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5UZXh0ID09ICIiOwogICAgICAgIH0pOwogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMuZW1wdHlfZmllbGRzX2NoZWNrKCkgJiYKICAgICAgICAgICh0aGlzLnF1ZXN0aW9uc19saXN0Lmxlbmd0aCA9PSAwIHx8IGVtcHR5X3F1ZXN0aW9ucy5sZW5ndGggPT0gMCkKICAgICAgICApIHsKICAgICAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5maWVsZHMucHVzaCh7CiAgICAgICAgICAvLyAgIFRleHQ6IHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbgogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHRoaXMucXVlc3Rpb25zX2xpc3QpIHsKICAgICAgICAgIC8vICAgdGhpcy5pbnB1dF9saXN0LmZpZWxkcy5wdXNoKHRoaXMucXVlc3Rpb25zX2xpc3RbaV0pOwogICAgICAgICAgLy8gfQogICAgICAgICAgaWYgKHRoaXMuaXNFZGl0ID09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGVkaXRfb2JqZWN0ID0ge307CiAgICAgICAgICAgIHZhciBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhID0ge307CiAgICAgICAgICAgIGxldCBpID0gMTsKICAgICAgICAgICAgdmFyIHRhc2txdWVzdGlvbiA9IFtdOwogICAgICAgICAgICB0YXNrcXVlc3Rpb24ucHVzaCh7CiAgICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgICAgVGV4dDogdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWRpdF9vYmplY3RbdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uX2lkXSA9CiAgICAgICAgICAgICAgdGFza3F1ZXN0aW9uWzBdOwogICAgICAgICAgICBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhW3RoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbl9pZF0gPSB7CiAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgIGZyb21fZW50aXR5OiBmYWxzZSwKICAgICAgICAgICAgICBpbnRlbnQ6IHRydWUsCiAgICAgICAgICAgICAgbm90X2ludGVudDogZmFsc2UsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZvciAoaSA9IDI7IGkgPCB0aGlzLnF1ZXN0aW9uc19saXN0Lmxlbmd0aCArIDI7IGkrKykgewogICAgICAgICAgICAgIHRhc2txdWVzdGlvbi5wdXNoKHsKICAgICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgICAgVGV4dDogdGhpcy5xdWVzdGlvbnNfbGlzdFtpIC0gMl0uVGV4dCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBlZGl0X29iamVjdFt0aGlzLnF1ZXN0aW9uc19saXN0W2ktMl0uUXVlc3Rpb25JZF0gPQogICAgICAgICAgICAgICAgdGFza3F1ZXN0aW9uW2kgLSAxXTsKICAgICAgICAgICAgICBlZGl0X3Nsb3RfbWFwcGluZ19kYXRhW3RoaXMucXVlc3Rpb25zX2xpc3RbaS0yXS5RdWVzdGlvbklkXSA9IHsKICAgICAgICAgICAgICAgIGZyb21fdGV4dDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZyb21fZW50aXR5OiBmYWxzZSwKICAgICAgICAgICAgICAgIGludGVudDogdHJ1ZSwKICAgICAgICAgICAgICAgIG5vdF9pbnRlbnQ6IGZhbHNlLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIlRoaXMgaXMgdGhlIEVESVQgb2JqZWN0IiwgZWRpdF9vYmplY3QpOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wdXQoCiAgICAgICAgICAgICAgICBhcGlfY2FsbHMudGFza19saXN0X3VybCgpLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmlucHV0X2xpc3QuaW50ZW50LAogICAgICAgICAgICAgICAgICB0YXNrX2RldGFpbHM6IGVkaXRfb2JqZWN0LAogICAgICAgICAgICAgICAgICB0YXNrX2lkOiB0aGlzLnRhc2tfbGlzdFt0aGlzLnNlbGVjdGVkX3Rhc2tdLlRhc2tfSWQsCiAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAvLyB0YXNrX2RldGFpbHM6IHRoaXMuaW5wdXRfbGlzdC5maWVsZHMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiVGFzayBFZGl0IikgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgICAgICAgIlRoZSBzYXZlZCBjaGFuZ2VzIHdvdWxkIGJlIHJlZmxlY3RlZCBvbmNlIHRoZSBtb2RlbCBpcyB0cmFpbmVkLiIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRWRpdCA9PSBmYWxzZSkgewogICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgICAgdmFyIHNsb3RfbWFwcGluZ19kYXRhID0ge307CiAgICAgICAgICAgIGxldCBpID0gMTsKICAgICAgICAgIHZhciB0YXNrcXVlc3Rpb24gPSBbXTsKICAgICAgICAgIHRhc2txdWVzdGlvbi5wdXNoKHsKICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgIFRleHQ6IHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiwKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHVuaXF1ZV9rZXkgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSA7CiAgICAgICAgICBvYmplY3RbIlF1ZXN0aW9uX051bWJlcl8xIiArICJfIiArIHVuaXF1ZV9rZXldID0gdGFza3F1ZXN0aW9uWzBdOwogICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGFbIlF1ZXN0aW9uX051bWJlcl8xIiArICJfIiArIHVuaXF1ZV9rZXldID0gewogICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgIGZyb21fZW50aXR5OiBmYWxzZSwKICAgICAgICAgICAgaW50ZW50OiB0cnVlLAogICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZSwKICAgICAgICAgIH07CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgdGhpcy5xdWVzdGlvbnNfbGlzdC5sZW5ndGggKyAyOyBpKyspIHsKICAgICAgICAgICAgdGFza3F1ZXN0aW9uLnB1c2goewogICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgIFRleHQ6IHRoaXMucXVlc3Rpb25zX2xpc3RbaSAtIDJdLlRleHQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgdW5pcXVlX2tleV8yID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgOyAKICAgICAgICAgICAgb2JqZWN0WyJRdWVzdGlvbl9OdW1iZXJfIiArIGkgKyAiXyIgKyB1bmlxdWVfa2V5XzJdID0KICAgICAgICAgICAgICB0YXNrcXVlc3Rpb25baSAtIDFdOwogICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YVsiUXVlc3Rpb25fTnVtYmVyXyIgKyBpICsgIl8iICsgdW5pcXVlX2tleV8yXSA9IHsKICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IGZhbHNlLAogICAgICAgICAgICAgIGludGVudDogdHJ1ZSwKICAgICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJUaGlzIGlzIHRoZSBvYmplY3QiLCBvYmplY3QpOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5pbnB1dF9saXN0LmludGVudCwKICAgICAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgICAgIC8vIHRhc2tfZGV0YWlsczogdGhpcy5pbnB1dF9saXN0LmZpZWxkcywKICAgICAgICAgICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGE6IHNsb3RfbWFwcGluZ19kYXRhLAogICAgICAgICAgICAgICAgICB0YXNrX25hbWU6IHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlRhc2sgQWRkZWQiKSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhc2sgaGFzIGJlZW4gYWRkZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX3R5cGUgPT0gIkVtYWlsIikgewogICAgICAgIHZhciBvYmplY3QgPSB7fTsKICAgICAgICB2YXIgYWxsb2sgPSB0cnVlOwogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMuZW1haWxfdGl0bGUgPT0gbnVsbCB8fAogICAgICAgICAgdGhpcy5lbWFpbF90aXRsZSA9PSAiIiB8fAogICAgICAgICAgdGhpcy5lbWFpbF9ib2R5ID09IG51bGwgfHwKICAgICAgICAgIHRoaXMuZW1haWxfYm9keSA9PSAiIgogICAgICAgICkgewogICAgICAgICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gaWYodGhpcy5hZGRfY3VzdG9tc19lbWFpbCYmdGhpcy5jdXN0b21fZW1haWxzLmxlbmd0aD09MCl7CiAgICAgICAgLy8gICBhbGxvayA9IGZhbHNlOwogICAgICAgIC8vIH0KICAgICAgICBpZiAodGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9PSAiIikgewogICAgICAgICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbWFpbF92YXJpYWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHRoaXMuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uID09ICIiIHx8CiAgICAgICAgICAgICAgdGhpcy5lbWFpbF92YXJpYWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gbnVsbCB8fAogICAgICAgICAgICAgIHRoaXMuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uID09ICIgIgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChhbGxvaykgewogICAgICAgICAgb2JqZWN0WyJzdWJqZWN0Il0gPSB0aGlzLmVtYWlsX3RpdGxlOwogICAgICAgICAgb2JqZWN0WyJib2R5Il0gPSB0aGlzLmVtYWlsX2JvZHk7CiAgICAgICAgICBvYmplY3RbInVzZXJfZW1haWwiXSA9IHRoaXMuZW1haWxfdG9fdXNlcjsKICAgICAgICAgIG9iamVjdFsiY3VzdG9tX2VtYWlscyJdID0gdGhpcy5jdXN0b21fZW1haWxzOwogICAgICAgICAgb2JqZWN0WyJlbWFpbF92YXJpYWJsZXMiXSA9IHRoaXMuZW1haWxfdmFyaWFibGVzOwoKICAgICAgICAgIGlmICh0aGlzLmlzRWRpdCA9PSBmYWxzZSkgewogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLm9wZW5fZm9ybV90YXNrcygpLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmlucHV0X2xpc3QuaW50ZW50LAogICAgICAgICAgICAgICAgICB0YXNrX25hbWU6IHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUsCiAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogIkVtYWlsIiwKICAgICAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKChyZXNwb25zZS5kYXRhID0gIlRhc2sgQWRkZWQiKSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRWRpdCA9PSB0cnVlKSB7CiAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgLnB1dCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5pbnB1dF9saXN0LmludGVudCwKICAgICAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgICAgICB0YXNrX3R5cGU6ICJFbWFpbCIsCiAgICAgICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogb2JqZWN0LAogICAgICAgICAgICAgICAgICB0YXNrX2lkOiB0aGlzLnRhc2tfbGlzdFt0aGlzLnNlbGVjdGVkX3Rhc2tdLlRhc2tfSWQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKChyZXNwb25zZS5kYXRhID0gIlRhc2sgRWRpdCIpKSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhc2sgaGFzIGJlZW4gZWRpdGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX3R5cGUgPT0gIlNNUyIpIHsKICAgICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgICAgdmFyIGFsbG9rID0gdHJ1ZTsKICAgICAgICBpZiAodGhpcy5zbXNfYm9keSA9PSBudWxsIHx8IHRoaXMuc21zX2JvZHkgPT0gIiIpIHsKICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIGlmKHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyJiZ0aGlzLmN1c3RvbV9udW1iZXIubGVuZ3RoPT0wKXsKICAgICAgICAvLyAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgLy8gfQogICAgICAgIGlmICh0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID09ICIiKSB7CiAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zbXNfdmFyaWJsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNtc192YXJpYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiIgfHwKICAgICAgICAgICAgICB0aGlzLnNtc192YXJpYmxlc1tpXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSBudWxsIHx8CiAgICAgICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiAiCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFsbG9rKSB7CiAgICAgICAgICBvYmplY3RbImJvZHkiXSA9IHRoaXMuc21zX2JvZHk7CiAgICAgICAgICBvYmplY3RbInVzZXJfbnVtYmVyIl0gPSB0aGlzLnNtc190b191c2VyOwogICAgICAgICAgb2JqZWN0WyJjdXN0b21fbnVtYmVycyJdID0gdGhpcy5jdXN0b21fbnVtYmVyOwogICAgICAgICAgb2JqZWN0WyJzbXNfdmFyaWFibGVzIl0gPSB0aGlzLnNtc192YXJpYmxlczsKCiAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIHRhc2tfbmFtZTogdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSwKICAgICAgICAgICAgICAgICAgdGFza190eXBlOiAiU01TIiwKICAgICAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKChyZXNwb25zZS5kYXRhID0gIlRhc2sgQWRkZWQiKSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRWRpdCA9PSB0cnVlKSB7CiAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgLnB1dCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIHRhc2tfbmFtZTogdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSwKICAgICAgICAgICAgICAgICAgdGFza190eXBlOiAiU01TIiwKICAgICAgICAgICAgICAgICAgdGFza19kZXRhaWxzOiBvYmplY3QsCiAgICAgICAgICAgICAgICAgIHRhc2tfaWQ6IHRoaXMudGFza19saXN0W3RoaXMuc2VsZWN0ZWRfdGFza10uVGFza19JZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoKHJlc3BvbnNlLmRhdGEgPSAiVGFzayBFZGl0IikpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFzayBoYXMgYmVlbiBlZGl0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3NlbGVjdGVkKCkgewogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJObyB0YXNrIHNlbGVjdGVkISIsCiAgICAgICAgICB0ZXh0OiAiIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRlbGV0ZV90YXNrX2lkcyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdkZWxldGUgdGFzaycpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coaS5UYXNrX0lkKTsKICAgICAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzLnB1c2goCiAgICAgICAgICAgIHRoaXMudGFza19saXN0W3RoaXMuY2hlY2tlZF9saXN0W2ldXS5UYXNrX0lkCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmRlbGV0ZV90YXNrX2lkcyk7CiAgICAgICAgdGhpcy5kZWxldGVfdGFza3NfYXBpKCk7CiAgICAgICAgLy8gbGV0IHF1ZXN0aW9ubGlzdCA9IFtdLGRlbGV0ZV90YXNrX2lkcwogICAgICAgIC8vICAgcmVzcG9uc2VsaXN0ID0gW10sCiAgICAgICAgLy8gICBpbnRlbnRsaXN0ID0gW10sCiAgICAgICAgLy8gICBzb3VyY2VsaXN0ID0gW107CiAgICAgICAgLy8gZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgIC8vICAgcXVlc3Rpb25saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucXVlc3Rpb24pOwogICAgICAgIC8vICAgcmVzcG9uc2VsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucmVzcG9uc2UpOwogICAgICAgIC8vICAgc291cmNlbGlzdC5wdXNoKHRoaXMuY2hlY2tlZF9saXN0W2ldLnNvdXJjZSk7CiAgICAgICAgLy8gICBpbnRlbnRsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0uaW50ZW50KTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gdGhpcy5kZWxldGVfdGFza3NfYXBpKHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0LCBpbnRlbnRsaXN0KTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9zaW5nbGUoaW5kZXgpIHsKICAgICAgLy8gbGV0IGludGVudHMgPSBbXTsKICAgICAgLy8gaW50ZW50cy5wdXNoKHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQpOwogICAgICAvLyBjb25zb2xlLmxvZyhpbmRleCk7CiAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzID0gW107CiAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzLnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfSWQpOwogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmRlbGV0ZV90YXNrX2lkcyk7CiAgICAgIHRoaXMuZGVsZXRlX3Rhc2tzX2FwaSgpOwogICAgICAvLyBjb25zb2xlLmxvZygiZGVsZXRlIHNpbmdsZSIpCiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0lkKQogICAgfSwKICAgIGRlbGV0ZV90YXNrc19hcGkoKSB7CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUgaXQhIiwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLmRlbGV0ZSgKICAgICAgICAgICAgICBhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgICAgICAgICAgICAgIC5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICB0YXNrX2lkczogdGhpcy5kZWxldGVfdGFza19pZHMsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJGYWlsdXJlIikgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJGYWlsZWQgdG8gZGVsZXRlIHRhc2suIik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJUYXNrIHdhcyBkZWxldGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyBheGlvcwogICAgICAgICAgLy8gICAuZGVsZXRlKGFwaV9jYWxscy50YXNrX2xpc3RfdXJsKCksIHsKICAgICAgICAgIC8vICAgICBkYXRhOiB7CiAgICAgICAgICAvLyAgICAgICBpbnRlbnRzOiBpbnRlbnRzLAogICAgICAgICAgLy8gICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgLy8gICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAvLyAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgLy8gICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uCiAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgLy8gICB9LCB7CiAgICAgICAgICAvLyAgIGhlYWRlcnM6IHsKICAgICAgICAgIC8vICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIC8vICAgfSwKICAgICAgICAgIC8vIH0pCiAgICAgICAgICAvLyAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiVGFzayhzKSBEZWxldGVkIikgewogICAgICAgICAgLy8gICAgICAgU3dhbC5maXJlKAogICAgICAgICAgLy8gICAgICAgICAiRGVsZXRlZCEiLAogICAgICAgICAgLy8gICAgICAgICAiWW91ciB0YXNrKHMpIGhhdmUgYmVlbiBkZWxldGVkLiIsCiAgICAgICAgICAvLyAgICAgICAgICJzdWNjZXNzIgogICAgICAgICAgLy8gICAgICAgKTsKICAgICAgICAgIC8vICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgIC8vICAgICAgIH0sIDI1MDApOwogICAgICAgICAgLy8gICAgIH0KICAgICAgICAgIC8vICAgfSkKICAgICAgICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgLy8gICAgIGlmICgKICAgICAgICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgIC8vICAgICApIHsKICAgICAgICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgLy8gICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGVtcHR5X2ZpZWxkc19jaGVjaygpIHsKICAgICAgaWYgKAogICAgICAgIHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPT0gIiIgfHwKICAgICAgICB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID09ICIiIHx8CiAgICAgICAgdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uID09ICIiCiAgICAgICkgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgZmllbGRzIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy5pbnB1dF9saXN0LmZpZWxkcykgewogICAgICAgIC8vICAgaWYgKAogICAgICAgIC8vICAgICB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID09ICIiIHx8CiAgICAgICAgLy8gICAgIHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPT0gIiIgfHwKICAgICAgICAvLyAgICAgdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uID09ICIiCiAgICAgICAgLy8gICApIHsKICAgICAgICAvLyAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSBmaWVsZHMiKTsKICAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vICAgfSBlbHNlIGlmICh0aGlzLmlucHV0X2xpc3QuZmllbGRzW2ldLnZhbHVlID09ICIiKSB7CiAgICAgICAgLy8gICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgZmllbGRzIik7CiAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAvLyAgIH0gZWxzZSBpZiAoCiAgICAgICAgLy8gICAgIGkgPT0gdGhpcy5pbnB1dF9saXN0LmZpZWxkcy5sZW5ndGggLSAxICYmCiAgICAgICAgLy8gICAgIHRoaXMuaW5wdXRfbGlzdC5maWVsZHNbaV0udmFsdWUgIT0gIiIKICAgICAgICAvLyAgICkgewogICAgICAgIC8vICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAvLyAgIH0KICAgICAgICAvLyB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9maWVsZHMoKSB7CiAgICAgIHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPSAiIjsKICAgICAgdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9ICIiOwogICAgICB0aGlzLmlucHV0X2xpc3QuZmllbGRzID0gW107CiAgICAgIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9ICIiOwogICAgICB0aGlzLnF1ZXN0aW9uc19saXN0ID0gW107CiAgICAgIHRoaXMuaXNFZGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucHJldmlldyA9IGZhbHNlOwogICAgICB0aGlzLnF1ZXN0aW9uX3RleHQgPSBmYWxzZTsKICAgICAgdGhpcy50YXNrX2xpc3RbdGhpcy5zZWxlY3RlZF90YXNrXSA9IHRoaXMub3JpZ2luYWxfaW50ZW50X2xpc3RbCiAgICAgICAgdGhpcy5zZWxlY3RlZF90YXNrCiAgICAgIF07CiAgICB9LAogICAgY2FsbHNlYXJjaCgpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgdGhpcy5zZWFyY2hfcHJvZHVjdCgpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoX3Byb2R1Y3QoKSB7CiAgICAgIC8vIGlmKHRoaXMuc2VhcmNoX2J5IT0nJyl7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgLy8gc2VhcmNoYnk6IHRoaXMuc2VhcmNoX2J5LAogICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnBhZ2Vjb3VudCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICAgICAgICAgIHRoaXMudGFza19saXN0ID0gW107CiAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbF9pbnRlbnRfbGlzdCA9IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0OwogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgICAgIGxldCBkZXNjID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBUZXh0OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlRleHQsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRlc2MubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgVGFza05hbWU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tOYW1lLAogICAgICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IGRlc2MsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFRhc2tzIEZvdW5kIikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiTm8gVGFzayBGb3VuZCIpOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiRW50ZXIgcHJvcGVyIGRhdGEgZm9yIHNlYXJjaGluZyIpOwogICAgICB9CiAgICAgIC8vIH1lbHNlewogICAgICAvLyAgIHRvYXN0ci5lcnJvcigiU2VsZWN0IGhlYWRlciBmb3Igc2VhcmNoaW5nIik7CiAgICAgIC8vIH0KICAgIH0sCiAgICBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBpc1Nob3c6IHRydWUsCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdCA9IFtdOwogICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxfaW50ZW50X2xpc3QgPSByZXNwb25zZS5kYXRhLlRhc2tzTGlzdDsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KSB7CiAgICAgICAgICAgICAgICBsZXQgZGVzYyA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0LAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgIEludGVudDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uSW50ZW50LAogICAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGlmIChwYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlbm87CiAgICAgICAgICB9CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMudGFza19saXN0X3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgICAgLy8gc2VhcmNoYnk6IHRoaXMuc2VhcmNoX2J5LAogICAgICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgICAgICBwYWdlX25vOiBwYWdlLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnBhZ2Vjb3VudCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbF9pbnRlbnRfbGlzdCA9IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0OwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdCkgewogICAgICAgICAgICAgICAgICBsZXQgZGVzYyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0LAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IGRlc2MsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludHJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfbXNnX3RvX3VzZXIoKSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX2VtYWlsIHx8CiAgICAgICAgKCF0aGlzLmFkZF9jdXN0b21zX2VtYWlsICYmICF0aGlzLmVtYWlsX3RvX3VzZXIpCiAgICAgICkgewogICAgICAgIHRoaXMuZW1haWxfdG9fdXNlciA9ICF0aGlzLmVtYWlsX3RvX3VzZXI7CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuYWRkX2N1c3RvbXNfZW1haWwgJiYgdGhpcy5lbWFpbF90b191c2VyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdHlwZSBvZiByZWNpcGllbnQiKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfbXNnX3RvX2N1c3RvbV91c2VyKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5lbWFpbF90b191c2VyIHx8CiAgICAgICAgKCF0aGlzLmFkZF9jdXN0b21zX2VtYWlsICYmICF0aGlzLmVtYWlsX3RvX3VzZXIpCiAgICAgICkgewogICAgICAgIHRoaXMuYWRkX2N1c3RvbXNfZW1haWwgPSAhdGhpcy5hZGRfY3VzdG9tc19lbWFpbDsKICAgICAgfSBlbHNlIGlmICh0aGlzLmFkZF9jdXN0b21zX2VtYWlsICYmICF0aGlzLmVtYWlsX3RvX3VzZXIpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHNlbGVjdCBhdGxlYXN0IG9uZSB0eXBlIG9mIHJlY2lwaWVudCIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9zbXNfdG9fdXNlcigpIHsKICAgICAgaWYgKAogICAgICAgIHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyIHx8CiAgICAgICAgKCF0aGlzLmFkZF9jdXN0b21zX251bWJlciAmJiAhdGhpcy5zbXNfdG9fdXNlcikKICAgICAgKSB7CiAgICAgICAgdGhpcy5zbXNfdG9fdXNlciA9ICF0aGlzLnNtc190b191c2VyOwogICAgICB9IGVsc2UgaWYgKCF0aGlzLmFkZF9jdXN0b21zX251bWJlciAmJiB0aGlzLnNtc190b191c2VyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdHlwZSBvZiByZWNpcGllbnQiKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfc21zX3RvX2N1c3RvbV91c2VyKCkgewogICAgICBpZiAodGhpcy5zbXNfdG9fdXNlciB8fCAoIXRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyICYmICF0aGlzLnNtc190b191c2VyKSkgewogICAgICAgIHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyID0gIXRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyICYmICF0aGlzLnNtc190b191c2VyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdHlwZSBvZiByZWNpcGllbnQiKTsKICAgICAgfQogICAgfSwKICAgIGNoZWNrZm9yZW1haWx2YXJpYWJsZXMoKSB7CiAgICAgIHZhciBhcnJTdHIxID0gdGhpcy5lbWFpbF9ib2R5LnNwbGl0KCJ7eyIpOwogICAgICB2YXIgYXJyU3RyMiA9IFtdOwogICAgICB2YXIgbmV3X3Zhcl9saXN0ID0gW107CiAgICAgIHZhciBuZXdfdmFyX2FjdGlvbiA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFyclN0cjEubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJyU3RyMVtpXS5pbmNsdWRlcygifX0iKSkgewogICAgICAgICAgYXJyU3RyMi5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwogICAgICAgICAgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pID09IC0xKSB7CiAgICAgICAgICAgIG5ld192YXJfbGlzdC5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwogICAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJhZGQiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChuZXdfdmFyX2xpc3QuaW5kZXhPZih0aGlzLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9uYW1lKSA+IC0xKSB7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvblsKICAgICAgICAgICAgbmV3X3Zhcl9saXN0LmluZGV4T2YodGhpcy5lbWFpbF92YXJpYWJsZXNbaV0udmFyaWFibGVfbmFtZSkKICAgICAgICAgIF0gPSAia2VlcCI7CiAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgIG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX25hbWUpID09IC0xCiAgICAgICAgKSB7CiAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaCh0aGlzLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9uYW1lKTsKICAgICAgICAgIG5ld192YXJfYWN0aW9uLnB1c2goInJlbW92ZSIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld192YXJfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChuZXdfdmFyX2FjdGlvbltpXSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5lbWFpbF92YXJpYWJsZXMucHVzaCh7CiAgICAgICAgICAgIHZhcmlhYmxlX25hbWU6IG5ld192YXJfbGlzdFtpXSwKICAgICAgICAgICAgdmFyaWFibGVfZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKG5ld192YXJfYWN0aW9uW2ldID09ICJyZW1vdmUiKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVtYWlsX3ZhcmlhYmxlc1tqXS52YXJpYWJsZV9uYW1lID09IG5ld192YXJfbGlzdFtpXSkgewogICAgICAgICAgICAgIHRoaXMuZW1haWxfdmFyaWFibGVzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNoZWNrZm9yc21zdmFyaWFibGVzKCkgewogICAgICAvLyBzbXNfdmFyaWJsZXMKICAgICAgdmFyIGFyclN0cjEgPSB0aGlzLnNtc19ib2R5LnNwbGl0KCJ7eyIpOwogICAgICB2YXIgYXJyU3RyMiA9IFtdOwogICAgICB2YXIgbmV3X3Zhcl9saXN0ID0gW107CiAgICAgIHZhciBuZXdfdmFyX2FjdGlvbiA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGFyclN0cjEubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJyU3RyMVtpXS5pbmNsdWRlcygifX0iKSkgewogICAgICAgICAgYXJyU3RyMi5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwogICAgICAgICAgaWYgKG5ld192YXJfbGlzdC5pbmRleE9mKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pID09IC0xKSB7CiAgICAgICAgICAgIG5ld192YXJfbGlzdC5wdXNoKGFyclN0cjFbaV0uc3BsaXQoIn19IilbMF0pOwogICAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJhZGQiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNtc192YXJpYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChuZXdfdmFyX2xpc3QuaW5kZXhPZih0aGlzLnNtc192YXJpYmxlc1tpXS52YXJpYWJsZV9uYW1lKSA+IC0xKSB7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvblsKICAgICAgICAgICAgbmV3X3Zhcl9saXN0LmluZGV4T2YodGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfbmFtZSkKICAgICAgICAgIF0gPSAia2VlcCI7CiAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgIG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuc21zX3ZhcmlibGVzW2ldLnZhcmlhYmxlX25hbWUpID09IC0xCiAgICAgICAgKSB7CiAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaCh0aGlzLnNtc192YXJpYmxlc1tpXS52YXJpYWJsZV9uYW1lKTsKICAgICAgICAgIG5ld192YXJfYWN0aW9uLnB1c2goInJlbW92ZSIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld192YXJfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChuZXdfdmFyX2FjdGlvbltpXSA9PSAiYWRkIikgewogICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXMucHVzaCh7CiAgICAgICAgICAgIHZhcmlhYmxlX25hbWU6IG5ld192YXJfbGlzdFtpXSwKICAgICAgICAgICAgdmFyaWFibGVfZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKG5ld192YXJfYWN0aW9uW2ldID09ICJyZW1vdmUiKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuc21zX3ZhcmlibGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNtc192YXJpYmxlc1tqXS52YXJpYWJsZV9uYW1lID09IG5ld192YXJfbGlzdFtpXSkgewogICAgICAgICAgICAgIHRoaXMuc21zX3ZhcmlibGVzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5wcmV2aWV3KGluZGV4KSB7CiAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgICB0aGlzLnRhc2tfdHlwZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGU7CiAgICAgIC8vIHRoaXMucHJldmlldyA9IHRydWU7CiAgICAgIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKICAgICAgdGhpcy5wcmV2aWV3ID0gZmFsc2U7CiAgICAgIHRoaXMuc2VsZWN0ZWRfdGFzayA9IGluZGV4OwogICAgICB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tOYW1lOwogICAgICBpZiAoCiAgICAgICAgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSA9PSAiZGVmYXVsdCIgfHwKICAgICAgICAhQm9vbGVhbih0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlKQogICAgICApIHsKICAgICAgICB0aGlzLnRhc2tfdHlwZSA9ICJEZWZhdWx0IjsKICAgICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLkludGVudDsKICAgICAgICB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSB0aGlzLnRhc2tfbGlzdFsKICAgICAgICAgIGluZGV4CiAgICAgICAgXS5UYXNrX0Rlc2NyaXB0aW9uWzBdLlRleHQ7CiAgICAgICAgdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uX2lkID0gdGhpcy50YXNrX2xpc3RbCiAgICAgICAgICBpbmRleAogICAgICAgIF0uVGFza19EZXNjcmlwdGlvblswXS5RdWVzdGlvbklkOwogICAgICAgIGZvciAoCiAgICAgICAgICB2YXIgaiA9IDE7CiAgICAgICAgICBqIDwgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24ubGVuZ3RoOwogICAgICAgICAgaisrCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnF1ZXN0aW9uc19saXN0LnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb25bal0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlID09ICJFbWFpbCIpIHsKICAgICAgICAvLyB0aGlzLmN1c3RvbV9lbWFpbHMgPSB0aGlzLmdldGRhdGFzb2JzKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHMpOwogICAgICAgIC8vIHRoaXMuY3VzdG9tX2VtYWlscyA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHM7CiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jdXN0b21fZW1haWxzKTsKICAgICAgICB0aGlzLmN1c3RvbV9lbWFpbHMgPSBbXTsKICAgICAgICBmb3IgKAogICAgICAgICAgbGV0IGkgPSAwOwogICAgICAgICAgaSA8IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHMubGVuZ3RoOwogICAgICAgICAgaSsrCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLmN1c3RvbV9lbWFpbHMucHVzaCgKICAgICAgICAgICAgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uY3VzdG9tX2VtYWlsc1tpXQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5lbWFpbF90aXRsZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnN1YmplY3Q7CiAgICAgICAgdGhpcy5lbWFpbF9ib2R5ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uYm9keTsKICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uZW1haWxfdmFyaWFibGVzKSB7CiAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5wdXNoKHsKICAgICAgICAgICAgdmFyaWFibGVfbmFtZTogdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24KICAgICAgICAgICAgICAuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX25hbWUsCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbgogICAgICAgICAgICAgIC5lbWFpbF92YXJpYWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSA9PSAiU01TIikgewogICAgICAgIHRoaXMuY3VzdG9tX251bWJlciA9IFtdOwogICAgICAgIGZvciAoCiAgICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgICBpIDwgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uY3VzdG9tX251bWJlcnMubGVuZ3RoOwogICAgICAgICAgaSsrCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLmN1c3RvbV9udW1iZXIucHVzaCgKICAgICAgICAgICAgdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uY3VzdG9tX251bWJlcnNbaV0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHRoaXMuc21zX2JvZHkgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5ib2R5OwogICAgICAgIHRoaXMuc21zX3ZhcmlibGVzID0gW107CiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zbXNfdmFyaWFibGVzKSB7CiAgICAgICAgICB0aGlzLnNtc192YXJpYmxlcy5wdXNoKHsKICAgICAgICAgICAgdmFyaWFibGVfbmFtZTogdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uc21zX3ZhcmlhYmxlc1sKICAgICAgICAgICAgICBpCiAgICAgICAgICAgIF0udmFyaWFibGVfbmFtZSwKICAgICAgICAgICAgdmFyaWFibGVfZGVzY3JpcHRpb246IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uCiAgICAgICAgICAgICAgLnNtc192YXJpYWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gdGhpcy5pc0VkaXQgPSB0cnVlOwogICAgICAvLyB0aGlzLnRhc2tfdHlwZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGU7CiAgICAgIC8vIHRoaXMucHJldmlldyA9IHRydWU7CiAgICAgIC8vIHRoaXMuc2VsZWN0ZWRfdGFzayA9IGluZGV4OwogICAgICAvLyB0aGlzLnRhc2tfdHlwZSA9ICdEZWZhdWx0JzsKICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LmludGVudCA9IHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQ7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza05hbWU7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uWzBdLlRleHQ7CiAgICAgIC8vIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnNwbGljZSgwLCAxKTsKICAgICAgLy8gZm9yICh2YXIgaj0xO2o8dGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24ubGVuZ3RoO2orKykgewogICAgICAvLyAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbltqXSk7CiAgICAgIC8vIH0KICAgICAgLy8gY29uc29sZS5sb2codGhpcy50YXNrX2xpc3RbaW5kZXhdKTsKICAgIH0sCiAgICAvLyBnZXRkYXRhc29icyhkYXRhKXsKICAgIC8vICAgdmFyIHg7CiAgICAvLyAgIGNvbnNvbGUubG9nKGRhdGEseCk7CiAgICAvLyAgIHg9ZGF0YTsKICAgIC8vICAgY29uc29sZS5sb2coZGF0YSx4KTsKICAgIC8vICAgcmV0dXJuIHg7CiAgICAvLyB9LAogIH0sCn07Cg=="},null]}