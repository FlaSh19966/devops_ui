{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Layout/TopNavbar.vue","mtime":1643027096176},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgQ291bnRyaWVzIGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvQ291bnRyaWVzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgZmluZ2VycHJpbnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9maW5nZXJwcmludCI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IHsgc3RyaW5nVHlwZUFubm90YXRpb24gfSBmcm9tICJAYmFiZWwvdHlwZXMiOwppbXBvcnQgeyBzdHJpbmdpZnkgfSBmcm9tICJxdWVyeXN0cmluZyI7CmltcG9ydCB7IFNvY2tldCB9IGZyb20gInBob2VuaXgtc29ja2V0IjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gJ3Z1ZS1waG9uZS1udW1iZXItaW5wdXQnOwppbXBvcnQgJ3Z1ZS1waG9uZS1udW1iZXItaW5wdXQvZGlzdC92dWUtcGhvbmUtbnVtYmVyLWlucHV0LmNzcyc7CmltcG9ydCBQYXNzd29yZFZhbGlkYXRvciBmcm9tICIuLi9QYWdlcy9QYXNzd29yZFZhbGlkYXRvci52dWUiOwppbXBvcnQgcGFnZV9ndWlkZSBmcm9tICJAL3BvcnRhbC9taXhpbnMvcGFnZV9ndWlkZS5qcyI7CmltcG9ydCBwYXRoIGZyb20gInBhdGgiOwoKZXhwb3J0IGRlZmF1bHQgewogIG1peGluczogW3BhZ2VfZ3VpZGVdLAogIHByb3BzOiBbInRpdGxlIl0sCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgICBWdWVQaG9uZU51bWJlcklucHV0LAogICAgUGFzc3dvcmRWYWxpZGF0b3IKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpbnRlbnRfZGF0YTogbnVsbCwKICAgICAgY2FsbGRhdGE6ICIiLAogICAgICBuZXdfcGFzc3dvcmQ6ICIiLAogICAgICBvbGRfcGFzc3dvcmQ6ICIiLAogICAgICBjb25maXJtX3Bhc3N3b3JkOiAiIiwKICAgICAgY29ycmVjdF9wYXNzd29yZDogZmFsc2UsCiAgICAgIGNvbXBhbnlfbmFtZTogbnVsbCwKICAgICAgY29tcGFueV9pZF9zZWxlY3RlZDogbnVsbCwKICAgICAgY29tcGFuaWVzOiBbXSwKICAgICAgY291bnRyeV9saXN0OiBudWxsLAogICAgICBjb21wYW55X2lkOiBbXSwKICAgICAgdXNlcl9jb21wYW55OiBudWxsLAogICAgICB0aWNrZXRzX2Jhcl9hY2Nlc3M6IGZhbHNlLAogICAgICBpbnZpdGVfY29tcGFueV9lbWFpbDogbnVsbCwKICAgICAgaW52aXRlX2NvbXBhbnlfbmFtZTogbnVsbCwKICAgICAgb2xkX2ZpbGVfbmFtZTogbnVsbCwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgaXNzdWU6ICIiLAogICAgICBpc3N1ZV9kZXNjcmlwdGlvbjogIiIsCiAgICAgIGltZ19maWxlOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgcGhvdG9faW1nX3VybDogIiIsCiAgICAgIGV4aXN0aW5nX2ZpbGVfbmFtZTogbnVsbCwKICAgICAgdXNlcl9jb3VudHJ5X25hbWU6IHsKICAgICAgICBjb2RlOiAiIiwKICAgICAgICBuYW1lOiAiIgogICAgICB9LAogICAgICB1c2VyX3Bob25lX251bWJlcjogdGhpcy4kc2Vzc2lvbi5oYXMoIlBob25lTnVtYmVyIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJQaG9uZU51bWJlciIpCiAgICAgICAgOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5waG9uZV9ubwogICAgICAgIDogIiIsCiAgICAgIHVzZXJfZmlyc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJGaXJzdE5hbWUiKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJGaXJzdE5hbWUiKQogICAgICAgIDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZmlyc3RfbmFtZQogICAgICAgIDogIiIsCiAgICAgIHVzZXJfbGFzdF9uYW1lOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckxhc3ROYW1lIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VyTGFzdE5hbWUiKQogICAgICAgIDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGFzdF9uYW1lCiAgICAgICAgOiAiIiwKICAgICAgY29tcGFueV9zZWxlY3RlZDogdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlOYW1lIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpCiAgICAgICAgOiAiU2VsZWN0IEEgQ29tcGFueSIsCiAgICAgIHVzZXJfY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUKICAgICAgICA6ICIiLAogICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5oYXMoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICA6ICIiLAogICAgICB1c2VyX2NvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQKICAgICAgICA6ICIiLAogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUKICAgICAgICA6ICIiLAogICAgICB1c2VyX3R5cGU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJlZ2lzdHJhdGlvbl90eXBlCiAgICAgICAgOiAiIiwKICAgICAgcGhvbmVfbnVtYmVyX3ZhbGlkaXR5OiAvXCtbMC05XXs5LDE0fSQvLAogICAgICByZWdfcHdkOiAvXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlxkKSg/PS4qWyNAJCElKj8mXSlbQS1aYS16XGQjQCQhJSo/Jl17OCx9LywKICAgICAgcmVnX2VtYWlsOiAvXihbMC05YS16QS1aXShbLS5cd10qWzAtOWEtekEtWl0pKkAoWzAtOWEtekEtWl1bLVx3XSpbMC05YS16QS1aXVwuKStbYS16QS1aXXsyLDl9KSQvLAogICAgICBub3RpZmljYXRpb25zOiBbXSwKICAgICAgdG9fc2hvd19ub3RpZmljYXRpb25zOiBmYWxzZSwKICAgICAgc29ja2V0OiBudWxsLAogICAgICBzY2hlZHVsZXJfY2hhbm5lbDogbnVsbCwKICAgICAgdHJhaW5pbmdfY2hhbm5lbDogbnVsbCwKICAgICAgcGhvbmVOdW1iZXI6IG51bGwsCiAgICAgIHRvdXJfZ3VpZGVfaWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9pbmZvX2ljb24uc3ZnIikKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgdmFsaWRPbGRQYXNzd29yZCgpIHsKICAgICAgaWYgKHRoaXMucmVnX3B3ZC50ZXN0KHRoaXMub2xkX3Bhc3N3b3JkKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiUGFzc3dvcmQgbXVzdCBjb250YWluIG1pbmltdW0gOCBjaGFyYWN0ZXJzLCBhdGxlYXN0IDEgVXBwZXJDYXNlIEFscGhhYmV0LCAxIExvd2VyQ2FzZSBBbHBoYWJldCwgMSBOdW1iZXIgYW5kIDEgU3BlY2lhbCBDaGFyYWN0ZXIiOwogICAgICB9CiAgICB9LAogICAgdmFsaWRQYXNzd29yZCgpIHsKICAgICAgaWYgKHRoaXMucmVnX3B3ZC50ZXN0KHRoaXMubmV3X3Bhc3N3b3JkKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiUGFzc3dvcmQgbXVzdCBjb250YWluIG1pbmltdW0gOCBjaGFyYWN0ZXJzLCBhdGxlYXN0IDEgVXBwZXJDYXNlIEFscGhhYmV0LCAxIExvd2VyQ2FzZSBBbHBoYWJldCwgMSBOdW1iZXIgYW5kIDEgU3BlY2lhbCBDaGFyYWN0ZXIiOwogICAgICB9CiAgICB9LAogICAgdmFsaWRDb25maXJtUGFzc3dvcmQoKSB7CiAgICAgIGlmICh0aGlzLmNvbmZpcm1fcGFzc3dvcmQgPT0gdGhpcy5uZXdfcGFzc3dvcmQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIlBhc3N3b3JkcyBkbyBub3QgbWF0Y2giOwogICAgICB9CiAgICB9LAogICAgLy8gdmFsaWRQaG9uZU51bWJlcigpIHsKICAgIC8vICAgaWYgKAogICAgLy8gICAgIHRoaXMucGhvbmVfbnVtYmVyX3ZhbGlkaXR5LnRlc3QoCiAgICAvLyAgICAgICB0aGlzLnVzZXJfcGhvbmVfbnVtYmVyLnJlcGxhY2UoL1xzKy9nLCAiIikKICAgIC8vICAgICApCiAgICAvLyAgICkgewogICAgLy8gICAgIHJldHVybiB0cnVlOwogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyIGluIHRoZSBmb3JtYXQ6ICtDb3VudHJ5Q29kZSBOdW1iZXIiOwogICAgLy8gICB9CiAgICAvLyB9LAogICAgdW5zZWVuX25vdGlmaWNhdGlvbnMoKSB7CiAgICAgIGxldCBjb3VudCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCF0aGlzLm5vdGlmaWNhdGlvbnNbaV0uaXNfY2xlYXIpIHsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjb3VudDsKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmNvdW50cnlfbGlzdCA9IENvdW50cmllczsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygicGhvdG9faW1nX3VybCIpKSB7CiAgICAgIHRoaXMucGhvdG9faW1nX3VybCA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoInBob3RvX2ltZ191cmwiKQogICAgICAgIDogIiI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnBob3RvX2ltZ191cmwgPSB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5waG90b19pbWdfdXJsCiAgICAgICAgOiAiIjsKICAgIH0KICAgIGlmICgKICAgICAgdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpICYmCiAgICAgIHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgKSB7CiAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJjb3VudHJ5X25hbWUiKTsKICAgICAgbGV0IHNlbGVjdF9jb3VudHJ5ID0gdGhpcy5jb3VudHJ5X2xpc3QuZmlsdGVyKGNvdW50cnkgPT4gewogICAgICAgIHJldHVybiBjb3VudHJ5LmNvZGUgPT0gdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlOwogICAgICB9KTsKICAgICAgdGhpcy51c2VyX2NvdW50cnlfbmFtZS5uYW1lID0gc2VsZWN0X2NvdW50cnlbMF0ubmFtZTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZSA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZQogICAgICAgIDogIiI7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY291bnRyeV9uYW1lID09IG51bGwpIHsKICAgICAgICB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUgPSAiIjsKICAgICAgfQogICAgICBpZiAodGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlLmxlbmd0aCA+IDApIHsKICAgICAgICBsZXQgc2VsZWN0X2NvdW50cnkgPSB0aGlzLmNvdW50cnlfbGlzdC5maWx0ZXIoY291bnRyeSA9PiB7CiAgICAgICAgICByZXR1cm4gY291bnRyeS5jb2RlID09IHRoaXMudXNlcl9jb3VudHJ5X25hbWUuY29kZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnVzZXJfY291bnRyeV9uYW1lLm5hbWUgPSBzZWxlY3RfY291bnRyeVswXS5uYW1lOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy51c2VyX3JvbGUgPT0gIkFkbWluIikgewogICAgICB0aGlzLmNvbXBhbnlfc2VsZWN0ZWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUKICAgICAgICA6ICIiOwogICAgfQogICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmNvbXBhbnlfbGlzdF91cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLmNvbXBhbmllcyA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICB0aGlzLmNvbXBhbnlfaWQgPSByZXNwb25zZS5kYXRhWzFdOwogICAgICAgIH0pOwogICAgfQogICAgaWYgKHRoaXMudXNlcl9maXJzdF9uYW1lID09IG51bGwgfHwgdGhpcy51c2VyX2ZpcnN0X25hbWUgPT0gIiIpIHsKICAgICAgdGhpcy51c2VyX2ZpcnN0X25hbWUgPSAiRmlyc3QiOwogICAgICB0aGlzLnVzZXJfbGFzdF9uYW1lID0gIkxhc3QiOwogICAgICB0aGlzLiRzZXNzaW9uLnNldCgiVXNlckZpcnN0TmFtZSIsIHRoaXMudXNlcl9maXJzdF9uYW1lKTsKICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJMYXN0TmFtZSIsIHRoaXMudXNlcl9sYXN0X25hbWUpOwogICAgfQogICAgdmFyIG1lbnVzID0gdGhpcy4kc2Vzc2lvbi5oYXMoIkNoYXRib3RNZW51IikKICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKQogICAgICA6IFtdOwogICAgdmFyIHRpY2tldF9hY2Nlc3MgPSBtZW51cy5maWx0ZXIobWVudSA9PiB7CiAgICAgIHJldHVybiBtZW51Lm1haW5fbWVudS5uYW1lID09ICJUaWNrZXRzIjsKICAgIH0pOwogICAgaWYgKHRpY2tldF9hY2Nlc3MubGVuZ3RoID09IDApIHsKICAgICAgdGhpcy50aWNrZXRzX2Jhcl9hY2Nlc3MgPSBmYWxzZTsKICAgIH0gZWxzZSBpZiAodGlja2V0X2FjY2Vzcy5sZW5ndGggPT0gMSkgewogICAgICB0aGlzLnRpY2tldHNfYmFyX2FjY2VzcyA9IHRydWU7CiAgICB9CgogICAgdmFyIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gZmFsc2U7CgogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBtZW51cy5sZW5ndGg7IGkgPCBuOyBpICs9IDEpIHsKICAgICAgZm9yIChsZXQgaiA9IDAsIGwgPSBtZW51c1tpXS5zdWJfbWVudV9saXN0Lmxlbmd0aDsgaiA8IGw7IGogKz0gMSkgewogICAgICAgIGlmIChtZW51c1tpXS5zdWJfbWVudV9saXN0W2pdLm5hbWUgPT0gIlNjaGVkdWxlciIpIHsKICAgICAgICAgIG5vdGlmaWNhdGlvbnNfYWNjZXNzID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5zb2NrZXQgPSBuZXcgU29ja2V0KAogICAgICBwcm9jZXNzLmVudi5WVUVfQVBQX1BVU0hfTk9USUZJQ0FUSU9OU19XRUJTT0NLRVRfRU5EUE9JTlQsCiAgICAgIHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIG5vdGlmaWNhdGlvbl90ZXN0OiB0cnVlCiAgICAgICAgfQogICAgICB9CiAgICApOwogICAgdGhpcy5zb2NrZXQuY29ubmVjdCgpOwogICAgaWYgKEJvb2xlYW4obm90aWZpY2F0aW9uc19hY2Nlc3MpKSB7CiAgICAgIHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zID0gdHJ1ZTsKICAgICAgLy9Ob3RpZmljYXRpb24KICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbCA9IHRoaXMuc29ja2V0LmNoYW5uZWwoCiAgICAgICAgIm5vdGlmaWNhdGlvbl9jaGFubmVsOiIgKyB0aGlzLnVzZXJfY29tcGFueV9pZAogICAgICApOwogICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmpvaW4oKTsKICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vbigic2hvd19ub3RpZmljYXRpb25zIiwgcmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5pc19yZXNwb25zZSkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSByZXNwb25zZS5kYXRhLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMucHVzaChyZXNwb25zZS5kYXRhW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vZmYoInNob3dfbm90aWZpY2F0aW9ucyIpOwogICAgICB9KTsKICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5vbigibmV3X25vdGlmaWNhdGlvbiIsIHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLnNob3dfbm90aWZpY2F0aW9ucyhyZXNwb25zZS5kYXRhKTsKICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMudW5zaGlmdChyZXNwb25zZS5kYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwucHVzaCgic2hvd19ub3RpZmljYXRpb25zIiwgewogICAgICAgIG5lZWRfbm90aWZpY2F0aW9uczogdHJ1ZSwKICAgICAgICBlbWFpbF9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgIH0pOwogICAgfQogICAgdGhpcy50cmFpbmluZ19jaGFubmVsID0gdGhpcy5zb2NrZXQuY2hhbm5lbCgKICAgICAgInRyYWluaW5nX25vdGlmaWNhdGlvbl9jaGFubmVsOiIgKyB0aGlzLnVzZXJfY29tcGFueV9pZAogICAgKTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5qb2luKCk7CiAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwub24oInNob3dfbm90aWZpY2F0aW9ucyIsIHJlc3BvbnNlID0+IHsKICAgICAgaWYgKHJlc3BvbnNlLmlzX3Jlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gcmVzcG9uc2UuZGF0YS5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9ucy5wdXNoKHsKICAgICAgICAgICAgZGF0ZTogbW9tZW50KHJlc3BvbnNlLmRhdGFbaV0uSW5pdGlhdGVkT24sIFsiWVlZWS1NTS1ERCJdKS5mb3JtYXQoCiAgICAgICAgICAgICAgIkRvIE1NTSBZWVlZIgogICAgICAgICAgICApLAogICAgICAgICAgICAuLi5yZXNwb25zZS5kYXRhW2ldCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLm9mZigic2hvd19ub3RpZmljYXRpb25zIik7CiAgICB9KTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5vbigibmV3X25vdGlmaWNhdGlvbiIsIHJlc3BvbnNlID0+IHsKICAgICAgdGhpcy5zaG93X25vdGlmaWNhdGlvbnMocmVzcG9uc2UuZGF0YSk7CiAgICAgIHRoaXMubm90aWZpY2F0aW9ucy51bnNoaWZ0KHsKICAgICAgICBkYXRlOiBtb21lbnQocmVzcG9uc2UuZGF0YS5Jbml0aWF0ZWRPbiwgWyJZWVlZLU1NLUREIl0pLmZvcm1hdCgKICAgICAgICAgICJEbyBNTU0gWVlZWSIKICAgICAgICApLAogICAgICAgIC4uLnJlc3BvbnNlLmRhdGEKICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAgIG5lZWRfbm90aWZpY2F0aW9uczogdHJ1ZSwKICAgICAgZW1haWxfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgfSk7CiAgfSwKICBtb3VudGVkKCkgewogICAgYnVzLiRvbigiTGF5b3V0SGVscERhdGEiLCBkYXRhUGcgPT4gewogICAgICB0aGlzLmNhbGxkYXRhID0gZGF0YVBnOwogICAgfSk7CiAgICAvLyBidXMuJG9uKCdUYWJzTGF5b3V0SW5mbycsKGRhdGFGb3J0YWJzKSA9PiB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFGb3J0YWJzLCJkYXRhIG9mIHRhYiBwYW5lIik7CiAgICAvLyAgICAgICAgIHRoaXMuY2FsbGRhdGEgPSBkYXRhRm9ydGFiczsKICAgIC8vIH0pCiAgICBidXMuJG9uKCJzZW5kIGNvbXBhbnkgYXR0cmlidXRlcyIsICgpID0+IHsKICAgICAgYnVzLiRlbWl0KAogICAgICAgICJjb21wYW55IG5hbWUgYW5kIGNvbXBhbnkgaWQiLAogICAgICAgIHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgIHRoaXMuY29tcGFueV9pZF9zZWxlY3RlZAogICAgICApOwogICAgfSk7CgogICAgdGhpcy4kcm9vdC4kb24oInNpZ25fb3V0IiwgKCkgPT4gewogICAgICB0aGlzLnNpZ25vdXRfYXBpKCk7CiAgICB9KTsKICAgICQoIi5kcm9wZG93bi10b2dnbGUiKS5kcm9wZG93bigpOwogIH0sCiAgbWV0aG9kczogewogICAgbGlzdGVuX2RhdGEoKSB7CiAgICAgIHRoaXMuY2FsbGRhdGEgPSB0aGlzLiRyb3V0ZS5wYXRoOwogICAgICAvL3RoaXMuY29tcF9uYW1lID0gdGhpcy4kcm91dGUubmFtZTsKICAgICAgLy8gRW1pdHRpbmcgYSBjdXN0b20tZXZlbnQgdmlhIHRoZSBFdmVudCBCdXMKICAgICAgYnVzLiRlbWl0KCJFbWl0dGluZ19kYXRhIiwgdGhpcy5jYWxsZGF0YSk7CiAgICB9LAogICAgY2hlY2tfcGFzc3dvcmQoY29ycmVjdFBhc3N3b3JkKSB7CiAgICAgIHRoaXMuY29ycmVjdF9wYXNzd29yZCA9IGNvcnJlY3RQYXNzd29yZDsKICAgIH0sCiAgICBlZGl0SW1hZ2UoZSkgewogICAgICBjb25zdCBpbWFnZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbWFnZSk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgICAgICB0aGlzLnByZXZpZXdJbWFnZSA9IGUudGFyZ2V0LnJlc3VsdDsKICAgICAgICBpZiAodGhpcy5waG90b19pbWdfdXJsKSB7CiAgICAgICAgICB0aGlzLmV4aXN0aW5nX2ZpbGVfbmFtZSA9IHRoaXMucGhvdG9faW1nX3VybC5zcGxpdCgiLyIpWzRdOwogICAgICAgIH0KICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuZWRpdF9wcm9maWxlX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgdXBsb2FkX3Bob3RvOiAiVHJ1ZSIsCiAgICAgICAgICAgICAgcHJvZmlsZV9pbWFnZTogdGhpcy5wcmV2aWV3SW1hZ2Uuc3BsaXQoImJhc2U2NCwiKVsxXSwKICAgICAgICAgICAgICBmaWxlX25hbWU6IGltYWdlLm5hbWUsCiAgICAgICAgICAgICAgZXhpc3RpbmdfZmlsZV9uYW1lOiB0aGlzLmV4aXN0aW5nX2ZpbGVfbmFtZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJQaG90byBVcGxvYWRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgcGhvdG8gaGFzIGJlZW4gdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoInBob3RvX2ltZ191cmwiLCByZXNwb25zZS5kYXRhLkltYWdlVXJsKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDUwMDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcoCiAgICAgICAgICAgICAgICAiVGhpcyBmaWxlIG5hbWUgYWxyZWFkeSBleGlzdHMuUGxlYXNlIHJlbmFtZSB0aGUgZmlsZSIKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiRXJyb3Igb2NjdXJlZCB3aGlsZSB1cGxvYWRpbmcgZmlsZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfTsKICAgIH0sCiAgICBjcmVhdGVJbWFnZShmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIub25sb2FkID0gZSA9PiB7CiAgICAgICAgdGhpcy5ibG9nLmltZ19maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIHJhaXNlX3RpY2tldCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaWYgKHRoaXMuJHJvdXRlLm5hbWUgPT0gIlRpY2tldHMiKSB7CiAgICAgICAgJCgiI3RpY2tldG1vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAiVGlja2V0cyIsCiAgICAgICAgICBwcm9wczogdHJ1ZSwKICAgICAgICAgIHBhcmFtczogeyByYWlzZV90aWNrZXQ6ICJUcnVlIiB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9maWVsZHMoKSB7CiAgICAgIHRoaXMuaW1nX2ZpbGUgPSAiIjsKICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgdGhpcy5pc3N1ZSA9ICIiOwogICAgICB0aGlzLmlzc3VlX2Rlc2NyaXB0aW9uID0gIiI7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICB9LAogICAgZW1haWxfY2xhc3MoKSB7CiAgICAgIGlmICh0aGlzLnJlZ19lbWFpbC50ZXN0KHRoaXMuaW52aXRlX2NvbXBhbnlfZW1haWwpKSB7CiAgICAgICAgcmV0dXJuICJpcy12YWxpZCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJpcy1pbnZhbGlkIjsKICAgICAgfQogICAgfSwKICAgIGVkaXRfcHJvZmlsZV9hcGkoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICghQm9vbGVhbih0aGlzLnBob25lTnVtYmVyKSkgewogICAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBQaG9uZSBOdW1iZXIiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5waG9uZU51bWJlci5pc1ZhbGlkICE9IHRydWUpIHsKICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIGVudGVyIGEgdmFsaWQgUGhvbmUgTnVtYmVyIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICgKICAgICAgICB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUgIT0gbnVsbCAmJgogICAgICAgIHRoaXMudXNlcl9maXJzdF9uYW1lICE9ICIiICYmCiAgICAgICAgdGhpcy51c2VyX2ZpcnN0X25hbWUgIT0gIkYiICYmCiAgICAgICAgdGhpcy51c2VyX2xhc3RfbmFtZSAhPSAiIiAmJgogICAgICAgIHRoaXMudXNlcl9sYXN0X25hbWUgIT0gIkwiCiAgICAgICAgLy90aGlzLnZhbGlkUGhvbmVOdW1iZXIgPT09IHRydWUKICAgICAgKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmVkaXRfcHJvZmlsZV91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgZmlyc3RfbmFtZTogdGhpcy51c2VyX2ZpcnN0X25hbWUsCiAgICAgICAgICAgICAgbGFzdF9uYW1lOiB0aGlzLnVzZXJfbGFzdF9uYW1lLAogICAgICAgICAgICAgIGNvdW50cnlfbmFtZTogdGhpcy51c2VyX2NvdW50cnlfbmFtZS5jb2RlLAogICAgICAgICAgICAgIHBob25lX251bWJlcjogdGhpcy5waG9uZU51bWJlci5mb3JtYXR0ZWROdW1iZXIsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiUHJvZmlsZSBVcGRhdGVkIikgewogICAgICAgICAgICAgIC8vIFN3YWwoewogICAgICAgICAgICAgIC8vICAgICB0aXRsZTogIlVwZGF0ZWQgU3VjY2Vzc2Z1bGx5ISEiLAogICAgICAgICAgICAgIC8vICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgLy8gICAgIHRleHQ6ICJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIiwKICAgICAgICAgICAgICAvLyAgICAgdGltZXI6MjAwMCwKICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJGaXJzdE5hbWUiLCB0aGlzLnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlVzZXJMYXN0TmFtZSIsIHRoaXMudXNlcl9sYXN0X25hbWUpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJjb3VudHJ5X25hbWUiLCB0aGlzLnVzZXJfY291bnRyeV9uYW1lLmNvZGUpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJQaG9uZU51bWJlciIsIHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQoIiNlZGl0X3Byb2ZpbGVfbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCBmaWVsZHMiKTsKICAgICAgfQogICAgfSwKICAgIGNvbXBhbnlfY2hhbmdlZChjb21wYW55KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmIChjb21wYW55ICE9IHRoaXMuY29tcGFueV9zZWxlY3RlZCkgewogICAgICAgIHRoaXMuY29tcGFueV9zZWxlY3RlZCA9IGNvbXBhbnk7CiAgICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55TmFtZSIpKSB7CiAgICAgICAgICB0aGlzLiRzZXNzaW9uLnJlbW92ZSgiQ29tcGFueU5hbWUiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIkNvbXBhbnlOYW1lIiwgdGhpcy5jb21wYW55X3NlbGVjdGVkKTsKICAgICAgICBpZiAodGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpKSB7CiAgICAgICAgICB0aGlzLiRzZXNzaW9uLnJlbW92ZSgiQ29tcGFueUlkIik7CiAgICAgICAgfQogICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KAogICAgICAgICAgIkNvbXBhbnlJZCIsCiAgICAgICAgICB0aGlzLmNvbXBhbnlfaWRbdGhpcy5jb21wYW5pZXMuaW5kZXhPZih0aGlzLmNvbXBhbnlfc2VsZWN0ZWQpXQogICAgICAgICk7CiAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfbmV3X3Bhc3N3b3JkKCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5vbGRfcGFzc3dvcmQgIT0gIiIgJiYKICAgICAgICB0aGlzLmNvcnJlY3RfcGFzc3dvcmQgPT0gdHJ1ZSAmJgogICAgICAgIHRoaXMudmFsaWRDb25maXJtUGFzc3dvcmQgPT0gdHJ1ZQogICAgICApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIHN1Ym1pdCB5b3VyIGRldGFpbHMiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdHlwZTogImluZm8iCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLm5ld19wYXNzd29yZF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBvbGRfcGFzc3dvcmQ6IHRoaXMub2xkX3Bhc3N3b3JkLAogICAgICAgICAgICAgIG5ld19wYXNzd29yZDogdGhpcy5uZXdfcGFzc3dvcmQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGRhdGU6IGRhdGUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJQYXNzd29yZCBJbmNvcnJlY3QiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJZb3VyIG9sZCBwYXNzd29yZCBpcyBpbmNvcnJlY3QiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJQYXNzd29yZCBSZXNldCIpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygKICAgICAgICAgICAgICAgICJZb3VyIHBhc3N3b3JkIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LiBOb3cgeW91IGNhbiBsb2dpbiB3aXRoIHRoZSBuZXcgcGFzc3dvcmQiCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAkKCIjY2hhbmdlX3Bhc3N3b3JkX21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT09ICJQYXNzd29yZCBJcyBTaW1pbGFyIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAgICAgIllvdSBjYW5ub3Qgc2V0IGEgcGFzc3dvcmQgd2hpY2ggd2FzIG9uZSBvZiB5b3VyIG9sZCBwYXNzd29yZHMuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PT0gIk9MRCBQQVNTV09SRCBET0VTTidUIE1BVENIIikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgb2xkIHBhc3N3b3JkIGRvZXMgbm90IG1hdGNoZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vbGRfcGFzc3dvcmQgPSAiIjsKICAgICAgICAgICAgdGhpcy5uZXdfcGFzc3dvcmQgPSAiIjsKICAgICAgICAgICAgdGhpcy5jb25maXJtX3Bhc3N3b3JkID0gIiI7CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBFbnRlciBhbGwgcmVxdWlyZWQgZmllbGRzIik7CiAgICAgIH0KICAgIH0sCiAgICBwYXNzd29yZF90b2dnbGUoaWQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICBpZiAocGFzc3dvcmQudHlwZSA9PSAidGV4dCIpIHsKICAgICAgICBwYXNzd29yZC50eXBlID0gInBhc3N3b3JkIjsKICAgICAgfSBlbHNlIGlmIChwYXNzd29yZC50eXBlID09ICJwYXNzd29yZCIpIHsKICAgICAgICBwYXNzd29yZC50eXBlID0gInRleHQiOwogICAgICB9CiAgICB9LAogICAgdXBkYXRlX3N1cGVyYWRtaW4oZXZ0KSB7CiAgICAgIGlmIChldnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuY29tcGFueV9uYW1lID0gZXZ0OwogICAgICAgIHRoaXMuY29tcGFueV9pZF9zZWxlY3RlZCA9IHRoaXMuY29tcGFueV9pZFt0aGlzLmNvbXBhbmllcy5pbmRleE9mKGV2dCldOwogICAgICAgIGJ1cy4kZW1pdCgiY29tcGFueSBhdHRyaWJ1dGVzIHVwZGF0ZWQiLCAiVHJ1ZSIpOwogICAgICB9CiAgICB9LAogICAgc2VuZF9pbnZpdGUoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLmludml0ZV9jb21wYW55X25hbWUgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcyIpOwogICAgICB9IGVsc2UgaWYgKHRoaXMucmVnX2VtYWlsLnRlc3QodGhpcy5pbnZpdGVfY29tcGFueV9lbWFpbCkgPT0gZmFsc2UpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMucmVmZXJyYWxzX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgaW52aXRlZF9jb21wYW55X25hbWU6IHRoaXMuaW52aXRlX2NvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBpbnZpdGVkX2NvbXBhbnlfZW1haWw6IHRoaXMuaW52aXRlX2NvbXBhbnlfZW1haWwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJFbWFpbCBzZW50IHN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICBidXMuJGVtaXQoImludml0ZV91cGRhdGUiLCAibG9hZGVyX29uIik7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgiI2ludml0ZV9tb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIHRoaXMuaW52aXRlX2NvbXBhbnlfbmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLmludml0ZV9jb21wYW55X2VtYWlsID0gIiI7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNpZ25vdXRfYXBpKCkgewogICAgICBidXMuJGVtaXQoIkxvZ291dCBoYXMgYmVlbiBjbGlja2VkIiwgIlRydWUiKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmNsZWFyX2FjY2Vzc190b2tlbl91cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLmV4ZWN1dGVfc2lnbm91dCgpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZXhlY3V0ZV9zaWdub3V0KCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZXhlY3V0ZV9zaWdub3V0KCkgewogICAgICBsZXQgaXNfc3VwZXJfYWRtaW4gPSB0aGlzLiRzZXNzaW9uLmdldCgiaXNfc3VwZXJfYWRtaW4iKTsKICAgICAgaWYgKGlzX3N1cGVyX2FkbWluKSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuc3VwZXJfYWRtaW5fbG9nb3V0KCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJydCIpfWAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPT0gIlNpZ25lZCBPdXQhIiB8fAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPT0gInNpZ24gb3V0IiB8fAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPT0gInRva2VuIGludmFsaWQiIHx8CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9PSAiSW52YWxpZCBDcmVkZW50aWFscyIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdXBlcl9hZG1pbl9ib3RfbG9nb3V0KCksIHsKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgICAgICAgICAgICAgIC5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICBpZiAodGhpcy50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIkNsZWFyX1JlZnJlc2hfVG9rZW5fSW50ZXJ2YWwiLCB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJfaW50ZXJ2YWw6IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnN1cGVyX2FkbWluX2JvdF9sb2dvdXQoKSwgewogICAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvX3Nob3dfbm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgICAgICBjbGVhcl9pbnRlcnZhbDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICAgICAgYnVzLiRlbWl0KCJEaXNhYmxlIHRoZSBib3QgY2hhdCBub3ciLCAiVHJ1ZSIsICJMb2dnZWRvdXQiKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJDbGVhcl9SZWZyZXNoX1Rva2VuX0ludGVydmFsIiwgewogICAgICAgICAgICAgICAgICAgIGNsZWFyX2ludGVydmFsOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwogICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlcl9jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5kZXN0cm95KCk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGJ1cy4kZW1pdCgiTG9nZ2VkIG91dCIsICJUcnVlIik7CiAgICAgICAgICAgIGJ1cy4kZW1pdCgiRGlzYWJsZSB0aGUgYm90IGNoYXQgbm93IiwgIlRydWUiLCAiTG9nZ2Vkb3V0Iik7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiAiTG9naW4iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuc2lnbm91dF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoInJ0Iil9YAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9PSAiU2lnbmVkIE91dCEiIHx8CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9PSAic2lnbiBvdXQiIHx8CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9PSAidG9rZW4gaW52YWxpZCIgfHwKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhID09ICJJbnZhbGlkIENyZWRlbnRpYWxzIgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAodGhpcy50b19zaG93X25vdGlmaWNhdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVyX2NoYW5uZWwubGVhdmUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy50cmFpbmluZ19jaGFubmVsLmxlYXZlKCk7CiAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiQ2xlYXJfUmVmcmVzaF9Ub2tlbl9JbnRlcnZhbCIsIHsKICAgICAgICAgICAgICAgIGNsZWFyX2ludGVydmFsOiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnVzLiRlbWl0KCJMb2dnZWQgb3V0IiwgIlRydWUiKTsKICAgICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwogICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dpbiIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMudG9fc2hvd19ub3RpZmljYXRpb25zKSB7CiAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5sZWF2ZSgpOwogICAgICAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpOwogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBidXMuJGVtaXQoIkxvZ2dlZCBvdXQiLCAiVHJ1ZSIpOwogICAgICAgICAgICBidXMuJGVtaXQoIkRpc2FibGUgdGhlIGJvdCBjaGF0IG5vdyIsICJUcnVlIiwgIkxvZ2dlZG91dCIpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogIkxvZ2luIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy8gdXBkYXRlX25vdGlmaWNhdGlvbnNfbGlzdCgpIHsKICAgIC8vICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJzaG93X25vdGlmaWNhdGlvbnMiLCB7CiAgICAvLyAgICAgbmVlZF9ub3RpZmljYXRpb25zOiB0cnVlLAogICAgLy8gICAgIGVtYWlsX2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgIH0pOwogICAgLy8gfSwKICAgIHNlZW5fYWxsX25vdGlmaWNhdGlvbnMoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGxldCBsYXN0X2luZGV4ID0gdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aCAtIDE7CiAgICAgIGlmIChsYXN0X2luZGV4ID49IDApIHsKICAgICAgICBpZiAodGhpcy5zY2hlZHVsZXJfY2hhbm5lbCkgewogICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fc2VlbiIsIHsKICAgICAgICAgICAgcmVxX2lkOiB0aGlzLm5vdGlmaWNhdGlvbnNbbGFzdF9pbmRleF0uaWQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy50cmFpbmluZ19jaGFubmVsKSB7CiAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwucHVzaCgibm90aWZpY2F0aW9uX3NlZW4iLCB7CiAgICAgICAgICAgIHJlcV9pZDogdGhpcy5ub3RpZmljYXRpb25zW2xhc3RfaW5kZXhdLmlkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9hbGxfbm90aWZpY2F0aW9ucygpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGxldCByZXFfbGlzdF9jbGVhcmVkID0gW107CiAgICAgIGxldCBub3RpZmljYXRpb25zX3RlbXBfbGlzdCA9IHRoaXMubm90aWZpY2F0aW9uczsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG5vdGlmaWNhdGlvbnNfdGVtcF9saXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBub3RpZmljYXRpb25zX3RlbXBfbGlzdFtpXSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbnNbaV0uTm90aWZpY2F0aW9uaWQpIHsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudHJhaW5pbmdfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgICByZXFfaWQ6IHRoaXMubm90aWZpY2F0aW9uc1tpXS5pZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcV9saXN0X2NsZWFyZWQucHVzaChub3RpZmljYXRpb25zX3RlbXBfbGlzdFtpXS5pZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zX3RlbXBfbGlzdC5maWx0ZXIoCiAgICAgICAgbm90aWZpY2F0aW9uID0+IHJlcV9saXN0X2NsZWFyZWQuaW5jbHVkZXMobm90aWZpY2F0aW9uLmlkKSA9PT0gZmFsc2UKICAgICAgKTsKICAgIH0sCiAgICBjbGVhcl9zaW5nbGVfbm90aWZpY2F0aW9uKHJlcV9pZCwgaW5kZXgpIHsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGlmIChyZXFfaWQgIT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5ub3RpZmljYXRpb25zW2luZGV4XS5Ob3RpZmljYXRpb25pZCkgewogICAgICAgICAgdGhpcy5zY2hlZHVsZXJfY2hhbm5lbC5wdXNoKCJub3RpZmljYXRpb25fY2xlYXJlZCIsIHsKICAgICAgICAgICAgcmVxX2lkOiByZXFfaWQKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRyYWluaW5nX2NoYW5uZWwucHVzaCgibm90aWZpY2F0aW9uX2NsZWFyZWQiLCB7CiAgICAgICAgICAgIHJlcV9pZDogcmVxX2lkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93X25vdGlmaWNhdGlvbnMoZGF0YSkgewogICAgICBpZiAoZGF0YSAhPSAxKSB7CiAgICAgICAgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQpIHsKICAgICAgICAgIHZhciBkYXRlOwogICAgICAgICAgdmFyIG1vbnRoTmFtZXMgPSBbCiAgICAgICAgICAgICJKYW4iLAogICAgICAgICAgICAiRmViIiwKICAgICAgICAgICAgIk1hciIsCiAgICAgICAgICAgICJBcHIiLAogICAgICAgICAgICAiTWF5IiwKICAgICAgICAgICAgIkp1biIsCiAgICAgICAgICAgICJKdWwiLAogICAgICAgICAgICAiQXVnIiwKICAgICAgICAgICAgIlNlcCIsCiAgICAgICAgICAgICJPY3QiLAogICAgICAgICAgICAiTm92IiwKICAgICAgICAgICAgIkRlYyIKICAgICAgICAgIF07CiAgICAgICAgICBkYXRlID0KICAgICAgICAgICAgZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVsyXSArCiAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgIG1vbnRoTmFtZXNbZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVsxXSAtIDFdICsKICAgICAgICAgICAgIiAiICsKICAgICAgICAgICAgZGF0YS52aXNpdF9kYXRlLnNwbGl0KCIgIilbMF0uc3BsaXQoIi0iKVswXTsKICAgICAgICAgIHZhciB0aW1lOwogICAgICAgICAgZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF07CiAgICAgICAgICBpZiAoZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA8IDEyKSB7CiAgICAgICAgICAgIHRpbWUgPQogICAgICAgICAgICAgIE51bWJlcihkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSArICI6MDAgYW0iOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdID09IDEyKSB7CiAgICAgICAgICAgIHRpbWUgPSAiMTI6MDAgcG0iOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgZGF0YS52aXNpdF9zbG90LnNwbGl0KCItIilbMF0uc3BsaXQoIjoiKVswXSA+IDEyICYmCiAgICAgICAgICAgIGRhdGEudmlzaXRfc2xvdC5zcGxpdCgiLSIpWzBdLnNwbGl0KCI6IilbMF0gPCAyNAogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRpbWUgPQogICAgICAgICAgICAgIE51bWJlcihkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdKSAtCiAgICAgICAgICAgICAgMTIgKwogICAgICAgICAgICAgICI6MDAgcG0iOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnZpc2l0X3Nsb3Quc3BsaXQoIi0iKVswXS5zcGxpdCgiOiIpWzBdID09IDI0KSB7CiAgICAgICAgICAgIHRpbWUgPSAiMTI6MDAgYW0iOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQgPT0gIkFwcG9pbnRtZW50IERlbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICBkYXRhLnZpc2l0b3JfbmFtZSArCiAgICAgICAgICAgICAgICAiIGhhcyBjYW5jZWxsZWQgYW4gYXBwb2ludG1lbnQgc2NoZWR1bGVkIG9uICIgKwogICAgICAgICAgICAgICAgZGF0ZSArCiAgICAgICAgICAgICAgICAiIGF0ICIgKwogICAgICAgICAgICAgICAgdGltZQogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLk5vdGlmaWNhdGlvbmlkID09ICJBcHBvaW50bWVudCBDb25maXJtZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIGRhdGEudmlzaXRvcl9uYW1lICsKICAgICAgICAgICAgICAgICIgaGFzIGNvbmZpcm1lZCBhbiBhcHBvaW50bWVudCBzY2hlZHVsZWQgb24gIiArCiAgICAgICAgICAgICAgICBkYXRlICsKICAgICAgICAgICAgICAgICIgYXQgIiArCiAgICAgICAgICAgICAgICB0aW1lCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuTm90aWZpY2F0aW9uaWQgPT0gIkFwcG9pbnRtZW50IFJlc2NoZWR1bGVkIikgewogICAgICAgICAgICB0b2FzdHIud2FybmluZygKICAgICAgICAgICAgICBkYXRhLnZpc2l0b3JfbmFtZSArCiAgICAgICAgICAgICAgICAiIGhhcyByZWNoZWR1bGVkIGFuIGFwcG9pbnRtZW50IG9uICIgKwogICAgICAgICAgICAgICAgZGF0ZSArCiAgICAgICAgICAgICAgICAiIGF0ICIgKwogICAgICAgICAgICAgICAgdGltZQogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLk5vdGlmaWNhdGlvbmlkID09ICJBcHBvaW50bWVudCBTY2hlZHVsZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIGRhdGEudmlzaXRvcl9uYW1lICsKICAgICAgICAgICAgICAgICIgaGFzIGJlZW4gc2NoZWR1bGVkIGFuIGFwcG9pbnRtZW50IG9uICIgKwogICAgICAgICAgICAgICAgZGF0ZSArCiAgICAgICAgICAgICAgICAiIGF0ICIgKwogICAgICAgICAgICAgICAgdGltZQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZGF0YS5Nb2RlbFR5cGUgPT0gIkludGVudCxEaWFsb2d1ZSIpIHsKICAgICAgICAgIHZhciBkYXRlOwogICAgICAgICAgZGF0ZSA9IG1vbWVudChkYXRhLkluaXRpYXRlZE9uLCBbIllZWVktTU0tREQiXSkuZm9ybWF0KCJEbyBNTU0gWVlZWSIpOwogICAgICAgICAgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIkZhaWxlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKAogICAgICAgICAgICAgIGBUaGUgdHJhaW5pbmcgb2YgbW9kZWwgb24gJHtkYXRlfSBoYXMgZmFpbGVkLiBLaW5kbHkgY29udGFjdCB0aGUgQWRtaW5pc3RyYXRvciBmb3IgZnVydGhlciBkZXRhaWxzLmAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiQ29tcGxldGVkIikgewogICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygKICAgICAgICAgICAgICBgVGhlIHRyYWluaW5nIG9mIGEgbmV3IG1vZGVsIGluaXRpYXRlZCBvbiAke2RhdGV9IGhhcyBiZWVuIGNvbXBsZXRlZCBzdWNjZXNmdWxseS5gCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuVHJhaW5pbmdTdGF0dXMgPT0gIlN0YXJ0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5pbmZvKAogICAgICAgICAgICAgIGBBIG5ldyByZXF1ZXN0IGZvciB0cmFpbmluZyBvZiBtb2RlbCBoYXMgYmVlbiBpbml0aWF0ZWQgb24gJHtkYXRlfS5gCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLk1vZGVsVHlwZSkgewogICAgICAgICAgdmFyIGRhdGU7CiAgICAgICAgICBkYXRlID0gbW9tZW50KGRhdGEuSW5pdGlhdGVkT24sIFsiWVlZWS1NTS1ERCJdKS5mb3JtYXQoIkRvIE1NTSBZWVlZIik7CiAgICAgICAgICBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiRmFpbGVkIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICAgYFRoZSB0cmFpbmluZyBvZiAke2RhdGEuTW9kZWxUeXBlfSBtb2RlbCBvbiAke2RhdGV9IGhhcyBmYWlsZWQuIEtpbmRseSBjb250YWN0IHRoZSBBZG1pbmlzdHJhdG9yIGZvciBmdXJ0aGVyIGRldGFpbHMuYAogICAgICAgICAgICApOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhLlRyYWluaW5nU3RhdHVzID09ICJDb21wbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKAogICAgICAgICAgICAgIGBUaGUgdHJhaW5pbmcgb2YgYSBuZXcgJHtkYXRhLk1vZGVsVHlwZX0gbW9kZWwgaW5pdGlhdGVkIG9uICR7ZGF0ZX0gaGFzIGJlZW4gY29tcGxldGVkIHN1Y2Nlc2Z1bGx5LmAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5UcmFpbmluZ1N0YXR1cyA9PSAiU3RhcnRlZCIpIHsKICAgICAgICAgICAgdG9hc3RyLmluZm8oCiAgICAgICAgICAgICAgYEEgbmV3IHJlcXVlc3QgZm9yIHRyYWluaW5nIG9mICR7ZGF0YS5Nb2RlbFR5cGV9IG1vZGVsIGhhcyBiZWVuIGluaXRpYXRlZCBvbiAke2RhdGV9LmAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdGFydF90b3VyKCkgewogICAgICB0aGlzLiRyb290LiRlbWl0KCJzaG93X3RvdXJfZ3VpZGUiLCB0cnVlKTsKICAgIH0sCiAgICBnZW5lcmF0ZV9lbWFpbF93aXphcmQobW9kZWxUeXBlLCBpbml0aWF0ZWRPbikgewogICAgICBsZXQgdXNlcm5hbWUgPSBgJHt0aGlzLnVzZXJfZmlyc3RfbmFtZX0gJHt0aGlzLnVzZXJfbGFzdF9uYW1lfWA7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICBpZiAobW9kZWxUeXBlID09ICJJbnRlbnQsRGlhbG9ndWUiKSB7CiAgICAgICAgYS5ocmVmID0gYG1haWx0bzphZG1pbkBjZW5zZS5haT9zdWJqZWN0PUNoYXRib3QgbW9kZWwgdHJhaW5pbmcgZmFpbGVkIG9uICR7aW5pdGlhdGVkT259LiZib2R5PUhpIENlbnNlIFRlYW0sJTBEJTBBLCBUaGUgY2hhdGJvdCBtb2RlbCB0cmFpbmluZyBoYXMgZmFpbGVkLiBUaGUgU3lzdGVtIEFkbWluIHdpbGwgbG9vayBpbnRvIHRoaXMgYW5kIGdldCBiYWNrIHRvIHlvdS4lMEQlMEFUaGFua3MsJTBEJTBBJHt1c2VybmFtZX1gOwogICAgICB9IGVsc2UgewogICAgICAgIGEuaHJlZiA9IGBtYWlsdG86YWRtaW5AY2Vuc2UuYWk/c3ViamVjdD0ke21vZGVsVHlwZX0gbW9kZWwgdHJhaW5pbmcgZmFpbGVkIG9uICR7aW5pdGlhdGVkT259LiZib2R5PUhpIENlbnNlIFRlYW0sJTBEJTBBLCBUaGUgJHttb2RlbFR5cGV9IG1vZGVsIHRyYWluaW5nIGhhcyBmYWlsZWQuIFRoZSBTeXN0ZW0gQWRtaW4gd2lsbCBsb29rIGludG8gdGhpcyBhbmQgZ2V0IGJhY2sgdG8geW91LiUwRCUwQVRoYW5rcywlMEQlMEEke3VzZXJuYW1lfWA7CiAgICAgIH0KICAgICAgYS5jbGljaygpOwogICAgfQogIH0KfTsK"},null]}