{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue","mtime":1663910265462},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgLCBjbG9zZV9tb2RhbH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKaW1wb3J0IHN3YWwgZnJvbSAnc3dlZXRhbGVydDInOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJOZXJUcmFpbmluZ1BhZ2UiLAogIG1peGluczogWwogICAgZnJlZXplX3BvcnRhbCwKICAgIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwKICAgIGNsb3NlX21vZGFsCiAgXSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc3ViX2VudGl0aWVzOiB7CiAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgZW5kOiAwLAogICAgICAgIHZhbHVlOiAiIiwKICAgICAgICBlbnRpdHk6ICIiLAogICAgICB9LAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgcGFnZW5vOiAiIiwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGRyb3BfZG93bl9zZWxlY3Q6ICIiLAogICAgICB3b3JkX3NlbGVjdGVkOiBmYWxzZSwKICAgICAgaGlnaGxpZ2h0ZWRfdGV4dDogIiIsCiAgICAgIHN0YXRlbWVudHM6IFtdLAogICAgICBzZWxlY3RlZF9zdGF0ZW1lbnQ6ICIiLAogICAgICBzdGF0ZW1lbnRfYXJyYXk6IFtdLAogICAgICBtYXN0ZXJfc3RhdGVtZW50c19saXN0OiBbXSwKICAgICAgY3VycmVudF9wYWdlOiAxLAogICAgICBkb25lX2VudGl0aWVzOiBbXSwKICAgICAgZW50aXRpZXNfbGlzdDogW10sCiAgICAgIGVudGl0aWVzX2xpc3Rfc3RyaW5nOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgY3N2X2ZpbGU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICB3b3JkX2luZm86IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBidWZmZXJfd29yZF9saXN0OiBbXSwKICAgICAgZGVsZXRlX25lcl90YWdzOiBbXSwKICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgbm90VHJhaW5lZFF1ZXN0aW9uczogW10sCiAgICAgIGluZm9faWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9pbmZvX2ljb24uc3ZnIiksCiAgICAgIG5ld19zdGF0ZW1lbnQ6ICIiLAogICAgICBlZGl0X3N0YXRlbWVudDogIiIsCiAgICAgIHdhbnRfc3RhdHVzOiB0cnVlLAogICAgICBuZXJfbW9kZWxfaW5wcm9ncmVzczogZmFsc2UsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWQ6IG51bGwsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOmZhbHNlCiAgICB9OwogIH0sCiAgY29tcG9uZW50czoge30sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgLy8gYXhpb3MKICAgIC8vICAgLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWcoKSwgewogICAgLy8gICAgIHBhcmFtczogewogICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgIC8vICAgICB9LAogICAgLy8gICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgIH0sCiAgICAvLyAgIH0pCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAvLyAgICAgICB0aGlzLndvcmRfaW5mbyA9IHJlc3BvbnNlLmRhdGE7CiAgICAvLyAgICAgICB0aGlzLmJ1ZmZlcl93b3JkX2xpc3QgPSByZXNwb25zZS5kYXRhOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgICAgIHRoaXMuY2hlY2tfbmVyX21vZGVsX3N0YXR1cygpOwogICAgLy8gYXhpb3MKICAgIC8vICAgLnBvc3QoCiAgICAvLyAgICAgYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICBnZXRfdGFnZ2VkX3N0YXRlbWVudHM6IHRydWUsCiAgICAvLyAgICAgfSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICB9CiAgICAvLyAgICkKICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT09IG51bGwpIHsKICAgIC8vICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTmVyIFRhZyBDb21wbGV0ZWQiKSB7CiAgICAvLyAgICAgICAgIC8vIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOwogICAgLy8gICAgICAgICB0aGlzLm5vdFRyYWluZWRRdWVzdGlvbnMgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFzc2lnbiBOZXIgVGFnIikgewogICAgLy8gICAgICAgLy8gICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgLy8gfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAvLyAgICAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAvLyB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgIC8vICAgICAgIC8vICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgIC8vIH0KICAgIC8vICAgICB9CiAgICAvLyAgIH0pCiAgICAvLyAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICkgewogICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5lclRyYWluaW5nUGFnZURpc2FibGVkIiwgKGRhdGEpID0+ewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSkKICAgICQoJ1tkYXRhLXRvZ2dsZT0icG9wb3ZlciJdJykKICAgICAgLnBvcG92ZXIoewogICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgY29udGVudDogJCgiI3BvcG92ZXJfY29udGVudCIpLAogICAgICB9KQogICAgICAub24oInNob3cuYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuYWRkQ2xhc3MoImQtYmxvY2siKTsKICAgICAgfSkKICAgICAgLm9uKCJzaG93bi5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkge30pCiAgICAgIC5vbigiaGlkZS5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ub25lIik7CiAgICAgIH0pOwogICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmNzcygiekluZGV4IiwgOTk5OSk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgICB0aGlzLiRyb290LiRvbigic2VuZF9tb2RlbF9zdGF0dXMiLCBkYXRhID0+ewogICAgICBpZiAoZGF0YSA9PSB0cnVlKXsKICAgICAgICB0aGlzLmNoZWNrX25lcl9tb2RlbF9zdGF0dXMoKTsKICAgICAgfQogICAgfSk7CiAgIAogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIAogICAgCgogIH0sCiAgbWV0aG9kczogewogICAgdXBsb2FkX25lcl9maWxlKCl7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgICQoIiN1cGxvYWRfY3N2X2ZpbGUiKS5tb2RhbCgnc2hvdycpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9uZXJfc3RhdGVtbmVudCgpewogICAgICBpZighdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKXsKICAgICAgICAkKCIjc3RhdGVtZW50bW9kYWwiKS5tb2RhbCgnc2hvdycpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9uZXJfdGFnKCl7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgnc2hvdycpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRfbmVyX3N0YXRlbWVudHMoKXsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWcoKSwgewogICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICB9LAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMud29yZF9pbmZvID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICB0aGlzLmJ1ZmZlcl93b3JkX2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdTX05PVF9GT1VORC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICBzd2FsLmZpcmUoewogICAgICAgICAgICAgIHR5cGU6J3dhcm5pbmcnLAogICAgICAgICAgICAgIHRleHQ6J05vIG5lciB0YWdzIGZvdW5kJywKICAgICAgICAgICAgICB0b2FzdDp0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLndvcmRfaW5mbyA9IFtdOwogICAgICAgICAgICB0aGlzLmJ1ZmZlcl93b3JkX2xpc3QgPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAucG9zdCgKICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZ2V0X2FsbF9uZXJfc3RhdGVtZW50czogdHJ1ZSwKICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICApCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZSk7CiAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgdGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FTU0lHTi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIHN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgdHlwZTond2FybmluZycsCiAgICAgICAgICAgICAgdGV4dDonTm8gRGF0YSBBdmFpbGFibGUnLAogICAgICAgICAgICAgIHRvYXN0OnRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aXRsZTogIkVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgc2VydmVyIGVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZSgpewogICAgICB0aGlzLm5ld19zdGF0ZW1lbnQgPSAiIjsKICAgICAgdGhpcy5lZGl0X3N0YXRlbWVudCA9ICIiOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQgPSBudWxsOwogICAgICB0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nID0gIiI7CiAgICB9LAogICAgYXNzaWduX3ZhcmlhYmxlKGluZGV4KXsKICAgICAgdGhpcy5lZGl0X3N0YXRlbWVudCA9IHRoaXMuc3RhdGVtZW50c1tpbmRleF0uU3RhdGVtZW50OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOwogICAgfSwKICAgIGNoZWNrX25lcl9tb2RlbF9zdGF0dXMoKXsKICAgIHRoaXMubW9kZWxfc3RhdHVzID0gdGhpcy4kc2Vzc2lvbi5nZXQoIk1vZGVsU3RhdHVzIik7CiAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKXsKICAgIHRoaXMubmVyX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgIH0KICAgIGVsc2UgaWYgKEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMubmVyX21vZGVsKSA9PT0gdHJ1ZSl7CiAgICAgaWYodGhpcy5tb2RlbF9zdGF0dXMubmVyX21vZGVsID09ICJJblByb2dyZXNzIil7CiAgICAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gdHJ1ZTsKICAgICB9CiAgICAgZWxzZXsKICAgICAgIHRoaXMubmVyX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICB9CiAgICB9CiAgICBlbHNlewogICAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7IAogICAgfQogICAgfSwKICAgIHNob3dfbW9kZWxfcHJvZ3Jlc3MoaW5kZXgpewogICAgICBpZih0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID09IHRydWUpewogICAgICAgICBpZiAoaW5kZXggPT0gJ3N0eWxlJyl7CiAgICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmKGluZGV4ID09ICd0aXRsZScpewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnRsdCgnbmVyX3BhZ2VfdHJhaW5pbmdfcHJvZ3Jlc3NfbXNnJyk7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZXsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIGFkZF9zdGF0ZW1lbnQoKSB7CiAgIAogICAgICBpZiAodGhpcy5uZXdfc3RhdGVtZW50LnRyaW0oKSA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX2VudGVyX3N0YXRlbWVudF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy5hZGRfbmVyX3N0YXRlbWVudCgpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBuZXdfc3RhdGVtZW50OiB0aGlzLm5ld19zdGF0ZW1lbnQsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3N0YXRlbWVudF9hZGRlZF9tc2cnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgIAogICAgICAgICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuQUREX1NUQVRFTUVOVF9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfd3JvbmdfbXNnJyksCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJTdGF0ZW1lbnQgYWxyZWFkeSBleGlzdHMiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3N0YXRlbWVudF9hbHJlYWR5X2V4aXN0c19tc2cnKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdhZGRfc3RhdGVtZW50X2J0bicpCiAgICAgIH0KICAgIH0sCiAgICBlZGl0X3N0YXRlbWVudHMoKSB7CiAgICAgIGlmKHRoaXMuZWRpdF9zdGF0ZW1lbnQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkLlN0YXRlbWVudCl7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9tb2RpZnlfc3RhdGVtZW50X21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJzdGF0ZW1lbnQgaW5kZXggYmVmb3JlLS0tIiwgdGhpcy5jdXJyZW50X3NlbGVjdGVkKTsKICAgICAgICB2YXIgdmFsaWRfc3RhdGVtZW50ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXJyZW50X3NlbGVjdGVkKTsKICAgICAgICB2YXIga2V5ID0gdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuSXNUYWdDb21wbGV0ZWQgPSAiTk8iOwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5TdGF0ZW1lbnQgPSB0aGlzLmVkaXRfc3RhdGVtZW50OwogICAgICAgIHZhbGlkX3N0YXRlbWVudC5UYWcgPSBbXTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC53b3Jkc19saXN0OwogICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKHsKICAgICAgICAgIFtrZXldOiB2YWxpZF9zdGF0ZW1lbnQsCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnRhZ19zZW50ZW5jZXNfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIG5lcl90YWdfc3RhdGVtZW50OiBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2VfdGFnX3N1Ym1pdF9tc2cnKSwKICAgICAgICAgICAgICAgIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgdGltZXI6IDU1MDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMucGFnZV9yZXF1aXJlKDEpOwogICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnNvbGUubG9nKCItLS0iKQogICAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgnZWRpdF9idG4nKQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3RhZ3MoaW5kZXgpIHsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfcmV2ZXJ0X21zZycpLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9zd2FsX2RlbGV0ZV9tc2cnKSwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgJCgiI2V4YW1wbGVNb2RhbENlbnRlciIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICB0aGlzLmRlbGV0ZV9uZXJfdGFncy5wdXNoKHRoaXMud29yZF9pbmZvW2luZGV4XSk7CiAgICAgICAgICB0aGlzLndvcmRfaW5mby5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLmRlbGV0ZV9uZXJfdGFncygpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHRhZ19uYW1lOiB0aGlzLmRlbGV0ZV9uZXJfdGFncywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3ModGhpcy50bHQoJ25lcl9wYWdlX3RhZ19yZW1vdmVkX21zZycpKTsKICAgICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9uZXJfdGFncyA9IFtdOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgICAgICAvLyB9LCA1MDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX3BhZ2Vfc29tZV9lcnJvcl9tc2cxJykpOwogICAgICAgICAgICAgICAgdGhpcy5kZWxldGVfbmVyX3RhZ3MgPSBbXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9zb21lX2Vycm9yX21zZzInKSk7CiAgICAgICAgICAgICAgdGhpcy5kZWxldGVfbmVyX3RhZ3MgPSBbXTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzdGFydF90YWdnaW5nKCkgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBnZXRUYWc6IGZhbHNlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19TVEFUVVMuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX3BhZ2VfdGFnc19hbGVydF9tc2cnKSk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfU1RBVFVTLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgLy8gfSwgMTUwMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICB0aGlzLnRsdCgnbmVyX3BhZ2VfdGFnc19hbGVydF9tc2cxJykKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICAgdGhpcy50bHQoJ25lcl9wYWdlX3RhZ3NfYWxlcnRfbXNnMycpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICB0aGlzLnNlYXJjaF9uZXJfc3RhdG1lbnRfcGFnZV9jaGFuZ2UoKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgZ2V0X2FsbF9uZXJfc3RhdGVtZW50czogdHJ1ZSwKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuTkVSX1RBR19BTEwuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLmRhdGEucmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICAgICAgdGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FTU0lHTi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyX3NlYXJjaF9uYW1lKCkgewogICAgICB0aGlzLnNlYXJjaF9uYW1lID0gIiI7CiAgICAgIHRoaXMucGFnZV9yZXF1aXJlKDEpOwogICAgfSwKICAgIHNlYXJjaF9uZXJfc3RhdG1lbnQoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKXsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnBhZ2Vfbm8gPSAxCiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF90ZXJtOiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSl7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5kYXRhLnJlc3BvbnNlKTsKICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQUxMLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuZGF0YS5yZXNwb25zZSk7CiAgICAgICAgICAgICAgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FTU0lHTi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEEuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICBwb3NpdGlvbjoidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9ub19uZXJfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gMTsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gMTsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gCiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc2VhcmNoX2FsZXJ0X21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuO30KICAgIH0sCiAgICBzZWFyY2hfbmVyX3N0YXRtZW50X3BhZ2VfY2hhbmdlKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIil7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF90ZXJtOiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FMTC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRfc3RhdGVtZW50cyhyZXNwb25zZS5kYXRhLlJlc3BvbnNlKTsKICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLk5FUl9UQUdfQVNTSUdOLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gMTsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBbXTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gMTsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB9IAogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3NlYXJjaF9hbGVydF9tc2cyJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47fQogICAgfSwKICAgIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSAzOyBpIDw9IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX3N0YXRlbWVudHMoc3RhdGVtZW50cykgewogICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gW107CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc3RhdGVtZW50cyk7CiAgICAgIGZvciAodmFyIGkgaW4gc3RhdGVtZW50cykgewogICAgICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZW1lbnRzW2ldKVswXTsKCiAgICAgICAgaWYgKHN0YXRlbWVudHNbaV1ba2V5XS5Jc1RhZ0NvbXBsZXRlZCAhPSAiWUVTIikgewogICAgICAgICAgdmFyIGtleSA9IE9iamVjdC5rZXlzKHN0YXRlbWVudHNbaV0pWzBdOwogICAgICAgICAgCiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QucHVzaChzdGF0ZW1lbnRzW2ldW2tleV0pOwoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFsKICAgICAgICAgICAgaQogICAgICAgICAgXS53b3Jkc19saXN0ID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlN0YXRlbWVudC5zcGxpdCgiICIpOwoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5rZXkgPSBrZXk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZW1lbnRzW2ldW2tleV0uSXNUYWdDb21wbGV0ZWQgIT0gIk5PIikgewogICAgICAgICAgdmFyIGtleSA9IE9iamVjdC5rZXlzKHN0YXRlbWVudHNbaV0pWzBdOwogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0LnB1c2goc3RhdGVtZW50c1tpXVtrZXldKTsKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFsKICAgICAgICAgICAgaQogICAgICAgICAgXS53b3Jkc19saXN0ID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlN0YXRlbWVudC5zcGxpdCgiICIpOwoKICAgICAgICAgIGxldCBkZXNjID0gW107CiAgICAgICAgICB2YXIgdmFsdWVzOwogICAgICAgICAgdmFyIGluZGV4OwoKICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZy5sZW5ndGg7IGErKykgewogICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXSAhPSAiTyIpIHsKICAgICAgICAgICAgICB2YXIgY2hlY2sgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmluZGV4T2YoCiAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdCiAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uaW5jbHVkZXMoIkItIikpIHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJjdXJyZW50IiwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXSk7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygibmV4dCIsIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYSArIDFdKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIGNoZWNrIDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZy5sZW5ndGggLSAxICYmCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0uaW5jbHVkZXMoIkktIikKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJpbmRleCIsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgd29yZF90eXBlOiB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLnNsaWNlKDIpLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIC8vIC8vY29uc29sZS5sb2coZGVzYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLmluY2x1ZGVzKCJJLSIpKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmluZGV4T2YoCiAgICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpbmRleCA9IGE7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXS5pbmNsdWRlcygiSS0iKQogICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPQogICAgICAgICAgICAgICAgICAgICAgdmFsdWVzICsKICAgICAgICAgICAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyArCiAgICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMiksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlcyA9CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzICsKICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgd29yZF90eXBlOiB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLnNsaWNlKDIpLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldWyJzZWxlY3RlZF9saXN0Il0gPSBkZXNjOwoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5rZXkgPSBrZXk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2godGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldKTsKICAgICAgfQogICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAvL2NvbnNvbGUubG9nKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdCAsICJNc3RlciBzdGF0ZW1lbnRzIGxvYWRlZCIpCiAgICAgIC8vY29uc29sZS5sb2codGhpcy5zdGF0ZW1lbnRzICwgIiBzdGF0ZW1lbnRzIGxvYWRlZCIpCiAgICB9LAogICAgbG9hZF9wb3BvdmVyKHRhcmdldCkgewogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKTsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImxlZnQiLCB0YXJnZXQuY2xpZW50WCk7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJ0b3AiLCB0YXJnZXQuY2xpZW50WSsgd2luZG93LnBhZ2VZT2Zmc2V0KTsKICAgIH0sCiAgICBzZWxlY3RlZF90ZXh0KGluZGV4KSB7CiAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkgIT0gIiIgJiYKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpLnNwbGl0KCIgIikuam9pbigiIikgIT0gIiIKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpLnRyaW0oKTsKICAgICAgICAgIHRoaXMud29yZF9zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3N0YXRlbWVudCA9IHRoaXMuc3RhdGVtZW50c1tpbmRleF0uU3RhdGVtZW50OwogICAgICAgICAgdGhpcy5sb2FkX3BvcG92ZXIoZXZlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmhpZ2hsaWdodGVkX3RleHQgPSAiIjsKICAgICAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7CiAgICAgICAgZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkudGV4dDsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZV9zdGF0ZW1lbnRzKGVudGl0eSkgewogICAgICB2YXIgd29yZHNfbGlzdCA9IGVudGl0eS52YWx1ZS5zcGxpdCgiICIpOwogICAgICB2YXIgdGFncyA9IFtdOwogICAgICBmb3IgKHZhciBpIGluIHRoaXMuc3RhdGVtZW50cykgewogICAgICAgIHZhciBtYXN0ZXJfd29yZHNfbGlzdCA9IHRoaXMuc3RhdGVtZW50c1tpXS5TdGF0ZW1lbnQuc3BsaXQoIiAiKTsKICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLnNlbGVjdGVkX2xpc3QgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uc2VsZWN0ZWRfbGlzdCA9IFtdOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgICAgZm9yICh2YXIgaiBpbiBtYXN0ZXJfd29yZHNfbGlzdCkgewogICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnLnB1c2goIiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zdGF0ZW1lbnRzW2ldLlN0YXRlbWVudCA9PSB0aGlzLnNlbGVjdGVkX3N0YXRlbWVudCkgewogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLklzVGFnQ29tcGxldGVkID0gIk5PIjsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5zZWxlY3RlZF9saXN0LnB1c2goewogICAgICAgICAgICB0ZXh0OiBlbnRpdHkudmFsdWUsCiAgICAgICAgICAgIHdvcmRfdHlwZTogZW50aXR5LmVudGl0eSwKICAgICAgICAgIH0pOwogICAgICAgICAgZm9yICh2YXIgaiBpbiBtYXN0ZXJfd29yZHNfbGlzdCkgewogICAgICAgICAgICBpZiAod29yZHNfbGlzdC5pbmNsdWRlcyhtYXN0ZXJfd29yZHNfbGlzdFtqXSkpIHsKICAgICAgICAgICAgICB2YXIgaW5kZXggPSB3b3Jkc19saXN0LmluZGV4T2YobWFzdGVyX3dvcmRzX2xpc3Rbal0pOwogICAgICAgICAgICAgIGlmIChpbmRleCA9PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID0gIkItIiArIGVudGl0eS5lbnRpdHk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5UYWdbal0gPSAiSS0iICsgZW50aXR5LmVudGl0eTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5UYWdbal0gPT0gIiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5UYWdbal0gPSAiTyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZW50aXR5KHZhbHVlMSwgdmFsdWUyKSB7CiAgICAgIGZvciAodmFyIGkgaW4gZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW4pIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW5baV0uc3R5bGUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5jaGlsZHJlbltpXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIjsKICAgICAgICAgIGV2ZW50LnRhcmdldC5jaGlsZHJlblswXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPT0gInllbGxvdyIpIHsKICAgICAgICBldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJ5ZWxsb3ciOwogICAgICAgIHZhciBmbGFnID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuZG9uZV9lbnRpdGllcy5sZW5ndGggIT0gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRvbmVfZW50aXRpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRoaXMuZG9uZV9lbnRpdGllc1tpXS52YWx1ZSA9PSB2YWx1ZTEpIHsKICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZmxhZyA9PSBmYWxzZSkgewogICAgICAgICAgdGhpcy53b3JkX3NlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnZhbHVlID0gdmFsdWUxOwogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRfYXJyYXkgPSB2YWx1ZTI7CiAgICAgICAgICB2YXIgam9pbnQgPSB0aGlzLnN0YXRlbWVudF9hcnJheS5qb2luKCk7CiAgICAgICAgICB2YXIgYSA9IGpvaW50Lmxhc3RJbmRleE9mKHZhbHVlMSk7CiAgICAgICAgICB2YXIgYiA9IHZhbHVlMS5sZW5ndGggKyBhIC0gMjsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnN0YXJ0ID0gYTsKICAgICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLmVuZCA9IGI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2F2ZV9zdGF0ZW1lbnQoaW5kZXgpIHsKICAgICAgaWYodGhpcy5zdGF0ZW1lbnRzW2luZGV4XS5UYWcubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV9hZGRfdGFnc19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfWVsc2UgewogICAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgICB2YXIgdmFsaWRfc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XTsKICAgICAgICAvLyBjb25zb2xlLmxvZygiYmVmb3JlLS0tIiwgdGhpcy5zdGF0ZW1lbnRzW2luZGV4XSk7CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgdmFsaWRfc3RhdGVtZW50LklzVGFnQ29tcGxldGVkID0gIllFUyI7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQud29yZHNfbGlzdDsKICAgICAgICBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QucHVzaCh7CiAgICAgICAgICBba2V5XTogdmFsaWRfc3RhdGVtZW50LAogICAgICAgIH0pOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJzaW5ndWxhciBmaW5hbCIsZmluYWxfc3RhdGVtZW50c19saXN0KTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV90YWdzX3N1Ym1pdF9tc2cnKSwKICAgICAgICAgICAgICAgIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gdGhpcy5wYWdlX3JlcXVpcmUoMSk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHN1Ym1pdF9uZXJfbW9kZWwoKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICB2YXIgdmFsaWRfbGlzdCA9IHRoaXMuc3RhdGVtZW50cy5maWx0ZXIoKHN0YXRlbWVudCkgPT4gewogICAgICAgIHJldHVybiBzdGF0ZW1lbnQuSXNUYWdDb21wbGV0ZWQgIT0gIiI7CiAgICAgIH0pOwogICAgICBpZiAodmFsaWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKAogICAgICAgICAgdGhpcy50bHQoJ25lcl9wYWdlX3N1Ym1pdF9hbGVydF9tc2cnKQogICAgICAgICk7CiAgICAgIH0gZWxzZSBpZiAodmFsaWRfbGlzdC5sZW5ndGggPCA1ICYmIHRoaXMuc3RhdGVtZW50cy5sZW5ndGggPiA1KSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3VibWl0X2FsZXJ0X21zZzEnKQogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiB2YWxpZF9saXN0KSB7CiAgICAgICAgICB2YXIga2V5ID0gdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5zZWxlY3RlZF9saXN0OwogICAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0ud29yZHNfbGlzdDsKICAgICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgW2tleV06IHZhbGlkX2xpc3RbaV0sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2coZmluYWxfc3RhdGVtZW50c19saXN0KTsKICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KSB7CiAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTsKICAgICAgICB9CiAgICAgICAgLy8gYXhpb3MKICAgICAgICAvLyAgIC5wb3N0KAogICAgICAgIC8vICAgICBhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwKICAgICAgICAvLyAgICAgewogICAgICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIC8vICAgICAgIG5lcl90YWdfc3RhdGVtZW50OiBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QsCiAgICAgICAgLy8gICAgIH0sCiAgICAgICAgLy8gICAgIHsKICAgICAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAvLyAgICAgICB9LAogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICApCiAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuc3VjY2VzcygiQWxsIHlvdXIgdGFncyBoYXZlIGJlZW4gc3VibWl0dGVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgIC8vICAgICAgIH0sIDIwMDApOwogICAgICAgIC8vICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICAvLyAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICAvLyAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7CiAgICAgICAgLy8gICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICB9KQogICAgICAgIC8vICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAvLyAgIH0pOwogICAgICB9CiAgICB9LAogICAgcmVtb3ZlX3RhZyhpbmRleCkgewogICAgICBpZih0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX25vX3RhZ3NfbXNnJyksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9wYWdlX3N3YWxfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ25lcl9wYWdlX3VudGFnX3N0YXRlbWVudF9tc2cnKSwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2Vfc3dhbF9kZWxldGVfbXNnJyksCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgaWYgKHJlc3VsdC5kaXNtaXNzKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc3RhdGVtZW50c1tpbmRleF0uSXNUYWdDb21wbGV0ZWQgPSAiTk8iOwogICAgICAgIHRoaXMuc3RhdGVtZW50c1tpbmRleF0uVGFnID0gW107CiAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2luZGV4XS5zZWxlY3RlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy4kc2V0KHRoaXMuc3RhdGVtZW50cywgaW5kZXgsIHRoaXMuc3RhdGVtZW50c1tpbmRleF0pOwoKICAgICAgICB2YXIgZmluYWxfc3RhdGVtZW50c19saXN0ID0gW107CiAgICAgICAgdmFyIHZhbGlkX3N0YXRlbWVudCA9IHRoaXMuc3RhdGVtZW50c1tpbmRleF07CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQud29yZHNfbGlzdDsKICAgICAgICBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QucHVzaCh7CiAgICAgICAgICBba2V5XTogdmFsaWRfc3RhdGVtZW50LAogICAgICAgIH0pOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJzaW5ndWxhciBmaW5hbCIsZmluYWxfc3RhdGVtZW50c19saXN0KTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV90YWdfcmVtb3ZlZF9tc2cnKSwKICAgICAgICAgICAgICAgIC8vIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgLy8gcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZW50aXR5X3NlbGVjdGVkKHdvcmQpIHsKICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCAhPSAiIikgewogICAgICAgIHRoaXMuc3ViX2VudGl0aWVzLnZhbHVlID0gdGhpcy5oaWdobGlnaHRlZF90ZXh0OwogICAgICB9CiAgICAgIHZhciBwb3BvdmVyX2lkID0KICAgICAgICBldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuaWQ7CiAgICAgIC8vIHRoaXMud29yZF9zZWxlY3RlZCA9IGZhbHNlOwogICAgICB0aGlzLnN1Yl9lbnRpdGllcy5lbnRpdHkgPSB0aGlzLmRyb3BfZG93bl9zZWxlY3Q7CiAgICAgIHRoaXMuZG9uZV9lbnRpdGllcy5wdXNoKHRoaXMuc3ViX2VudGl0aWVzKTsKICAgICAgJCgiIyIgKyBwb3BvdmVyX2lkKS5wb3BvdmVyKCJoaWRlIik7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgdGhpcy5kcm9wX2Rvd25fc2VsZWN0ID0gIiI7CiAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dCA9ICIiOwogICAgICB0aGlzLnVwZGF0ZV9zdGF0ZW1lbnRzKHRoaXMuc3ViX2VudGl0aWVzKTsKICAgICAgdGhpcy5zdWJfZW50aXRpZXMgPSB7fTsKICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSkgewogICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpOwogICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQoZSkgewogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgLy9jb25zb2xlLmxvZyhmaWxlcykKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPCAxMDAwMDAwKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgZmlsZXNbMF0ubmFtZS5pbmNsdWRlcygiY3N2IikgfHwKICAgICAgICAgIGZpbGVzWzBdLm5hbWUuaW5jbHVkZXMoInR4dCIpIHx8CiAgICAgICAgICBmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJ4bHMiKSB8fAogICAgICAgICAgZmlsZXNbMF0udHlwZS5pbmNsdWRlcygidGV4dCIpCiAgICAgICAgKSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuZmlsZV9sYWJlbCkKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgICB0aGlzLmNyZWF0ZUNTVihmaWxlc1swXSk7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuZmlsZV9sYWJlbCkKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9maWxlX3NpemVfYWxlcnQnKSk7CiAgICAgIH0KICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHJldHVybjsKICAgIH0sCiAgICBjcmVhdGVDU1YoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgdGhpcy5jc3ZfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0IilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIHNlbmRfY3N2KCkgewogICAgICAvL2NvbnNvbGUubG9nKCQoIiNpbnB1dEdyb3VwRmlsZTAxIikudmFsKCkpCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICgkKCIjaW5wdXRHcm91cEZpbGUwMSIpLnZhbCgpID09ICcnKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX3BhZ2VfaW5wdXRfZmllbGRfbXNnJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2VfdXBsb2FkX2ZpbGVfbXNnJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIC8vY29uc29sZS5sb2codGhpcy5maWxlX2xhYmVsKQogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnVwbG9hZF9uZXJfZmlsZV91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZmlsZV9kYXRhOiB0aGlzLmNzdl9maWxlLAogICAgICAgICAgICAgIGZpbGVfbmFtZTogdGhpcy5maWxlX2xhYmVsLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5FUlJPUl9VUExPQUQuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9lcnJvcl91cGxvYWRfYWxlcnQnKSk7CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZT0iIjsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX1NUQVRVUy5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICAgICB0aGlzLnRsdCgnbmVyX3BhZ2VfdGFnc19hc3NpZ25fbXNnJykKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWU9IiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5WQUxJRF9IRUFESU5HLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX3BhZ2VfaW52YWxpZF9oZWFkZXJfbXNnJykpOwogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWU9IiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hcGlfc3RhdHVzX2NvZGUuRkFJTEVEX1RPX0FERF9UQUdTLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiVW5rbm93biBUYWdzIGZvdW5kISBTdGF0ZW1lbnRzIGhhcyBiZWVuIHVwbG9hZGVkLCBQbGVhc2UgdGFnIHRoZSBzdGF0ZW1lbnRzIG1hbnVhbGx5LiIpCiAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfcGFnZV90YWdzX2ZvdW5kX2FsZXJ0X21zZycpLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgdGltZXI6IDEwMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWU9IiI7CiAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgICAgIC8vIH0sIDI1MDApOyAKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5JTkNPUlJFQ1RfRklMRV9GT1JNQVQuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCduZXJfcGFnZV9maWxlX2Zvcm1hdF9tc2cnKSk7CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZT0iIjsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0ZJTEVfVFlQRS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ25lcl9wYWdlX2ZpbGVfdHlwZV9tc2cnKSk7CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZT0iIjsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5GSUxFX1VQTE9BRC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0aGlzLnRsdCgnbmVyX3BhZ2VfdXBsb2FkX3N1Y2Nlc3NfYWxlcnRfbXNnJykpOwogICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgICAgIC8vIH0sIDI1MDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAvLyAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgIC8vICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgLy8gICAgICJEdWUgdG8gc29tZSBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IsIHdlIHdlcmUgdW5hYmxlIHRvIHByb2Nlc3MgdGhpcyByZXF1ZXN0LiBQbGVhc2UgdHJ5IGxhdGVyLiIKICAgICAgICAgICAgLy8gICApOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICQoIiN1cGxvYWRfY3N2X2ZpbGUiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jbG9zZV9tb2RhbCgndXBsb2FkX2J0bicpCiAgICAgICAgfQogICAgfSwKICAgIGNvbW1hX3RvX2xpc3QoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3BhZ2VfbmVyX3RhZ19tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuZW50aXRpZXNfbGlzdCA9IHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcuc3BsaXQoIiwiKTsKICAgICAgaWYgKHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgIT0gIiIpIHsKICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYWRkX25lcl90YWcoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdGFnbGlzdDogdGhpcy5lbnRpdGllc19saXN0LAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5ORVJfVEFHX0FERC5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0aGlzLnRsdCgnbmVyX3BhZ2VfdGFnX2FkZGVkX2FsZXJ0X21zZycpKTsKICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9RVUVSWS5NU0dfQ09ERSA9PSByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUpewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IAogICAgICAgICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnbmVyX3BhZ2Vfc29tZV9lcnJvcl9hbGVydDInKSk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZGVsZXRlX25lcl90YWdzLmxlbmd0aCA+IDApIHsKICAgICAgICAvLyBheGlvcwogICAgICAgIC8vICAgLnBvc3QoYXBpX2NhbGxzLmRlbGV0ZV9uZXJfdGFncygpLCB7CiAgICAgICAgLy8gICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgLy8gICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIC8vICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIC8vICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAvLyAgICAgdGFnX25hbWU6IHRoaXMuZGVsZXRlX25lcl90YWdzLAogICAgICAgIC8vICAgfSkKICAgICAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YWcgaGFzIGJlZW4gcmVtb3ZlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgLy8gICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAvLyAgICAgICB9LCAyNTAwKTsKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgIC8vIH0sIDI1MDApOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlX25lcihpbmRleCkgewogICAgICAvLyBjb25zb2xlLmxvZygic3RhdGVtZW50cyBsZW5ndGgiLHRoaXMuc3RhdGVtZW50cy5sZW5ndGgpOwogICAgICB2YXIgZGVsZXRlX3N0YXRlbWVudF9saXN0ID0gW107CiAgICAgIHZhciB2YWxpZF9saXN0ID0gdGhpcy5zdGF0ZW1lbnRzLmZpbHRlcigoc3RhdGVtZW50KSA9PiB7CiAgICAgICAgcmV0dXJuIHN0YXRlbWVudC5TdGF0ZW1lbnQgPT0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XS5TdGF0ZW1lbnQ7CiAgICAgIH0pOwogICAgICAvLyBjb25zb2xlLmxvZyh2YWxpZF9saXN0KTsKICAgICAgZm9yICh2YXIgaSBpbiB2YWxpZF9saXN0KSB7CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX2xpc3RbaV0ua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0W2ldLndvcmRzX2xpc3Q7CiAgICAgICAgZGVsZXRlX3N0YXRlbWVudF9saXN0LnB1c2goewogICAgICAgICAgW2tleV06IHZhbGlkX2xpc3RbaV0sCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgLy8gY29uc29sZS5sb2coZGVsZXRlX3N0YXRlbWVudF9saXN0KTsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9zd2FsX2FsZXJ0X21zZycpLAogICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfc3dhbF9yZXZlcnRfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl9zd2FsX2NvbmZpcm1fbXNnJyksCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5kZWxldGVfbmVyKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0bWVudDogZGVsZXRlX3N0YXRlbWVudF9saXN0LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUgPT0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAvLyB0b2FzdHIuc3VjY2VzcygiWW91ciBORVIgdGFnIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3RhZ19kZWxldGVfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiA1NTAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKCh0aGlzLnN0YXRlbWVudHMubGVuZ3RoID09PSAxICYmIAogICAgICAgICAgICAgICAgICBkZWxldGVfc3RhdGVtZW50X2xpc3QubGVuZ3RoID09PSAxKSAmJgogICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPiAxKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5jbGVhcl9maWVsZHMoKTsKICAgICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgICAgICAvLyB9LCAxNTAwKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdGVkX3N0YXRlbWVudHMoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09ICJhbGwiKSB7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB2YXIgcm9sZV9sZW5ndGggPSB0aGlzLnN0YXRlbWVudHMubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9sZV9sZW5ndGg7IGkrKykgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaCh0aGlzLnN0YXRlbWVudHNbaV0pOwogICAgICAgIH0KICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuY2hlY2tlZF9saXN0KQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tlZF9saXN0LmluY2x1ZGVzKGluZGV4KSkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMuc3RhdGVtZW50c1tpbmRleF0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKHJvbGUpPT4gewogICAgICAgICAgICByZXR1cm4gcm9sZSAhPT0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9uZXJfbXVsdGlwbGUoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc3RhdGVtZW50cywic3RhdGVtZW50cyBpbiBkZWxldGUgZnVuY3Rpb24iKQogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QsIk1hc3RlciBzdGF0ZW1lbnRzIGluIGRlbGV0ZSBmdW5jdGlvbiIpCiAgICAgIAogICAgICB2YXIgbnVtID0gdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoOwogICAgICB2YXIgbXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0ID0gW107CiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9ub19zdGF0ZW1lbnRfYWxlcnRfbXNnJyksCiAgICAgICAgICB0ZXh0OiAiIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgbGV0IGRsdF9saXN0PVtdOwogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaGVja2VkX2xpc3QpIHsKICAgICAgICAgIC8vIHZhciB2YWxpZF9saXN0ID0gdGhpcy5zdGF0ZW1lbnRzLmZpbHRlcigoc3RhdGVtZW50KSA9PiB7CgogICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmV0dXJuIHN0YXRlbWVudC5TdGF0ZW1lbnQgPT0gdGhpcy5jaGVja2VkX2xpc3RbaV0uU3RhdGVtZW50OwogICAgICAgICAgLy8gfSk7CiAgICAgICAgICAKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbGlkX2xpc3QsImxpc3QiKQogICAgICAgICAgCiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWxpZF9saXN0WzBdLCJsaXN0IikKICAgICAgICAgIHZhciBrZXkgPSB0aGlzLmNoZWNrZWRfbGlzdFtpXS5rZXk7CiAgICAgICAgICBkbHRfbGlzdC5wdXNoKGtleSkKICAgICAgICAgIAoKICAgICAgICAgIG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5wdXNoKHsgW2tleV06IHRoaXMuY2hlY2tlZF9saXN0W2ldIH0pOwogICAgIAogICAgICAgICAgCiAgICAgICAgfQogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9zd2FsX2FsZXJ0X21zZzInKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfc3dhbF9yZXZlcnRfbXNnMicpLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX3N3YWxfY29uZmlybV9tc2cyJyksCiAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5kZWxldGVfbmVyKCksCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgICAgICAgICAgICAgIC5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICBuZXJfdGFnX3N0YXRtZW50OiBtdWx0aXBsZV9kZWxldGVfc3RhdGVtZW50X2xpc3QsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFID09IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnbmVyX3RhZ19kZWxldGVfbXNnMicpLAogICAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogNTUwMCwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGlmKG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5sZW5ndGggPT09IHRoaXMuc3RhdGVtZW50cy5sZW5ndGggJiYgCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID4xKXsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHRoaXMucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhcl9maWVsZHMoKTsKICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiUkFOTk5OIikKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAgICAgLy8gfSwgMTUwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyX2ZpZWxkcygpOwogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgdHJhaW5fbmVyX21vZGVsKCkgewogICAgICBpZighdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKXsKICAgICAgaWYgKHRoaXMubm90VHJhaW5lZFF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnbmVyX3NldHVwX3RyYW5zbGF0ZV9tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCduZXJfdHJhaW5pbmdfdGltZV9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ25lcl90cmFpbl9lbnRpdHlfbW9kZWxfbXNnJyksCiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgnbmVyX2dvX2JhY2tfbXNnJyksCiAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnN0YXRlbWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyBheGlvcwogICAgICAgICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5ub3RpZnlfc3VwZXJhZG1pbl91cmwoKSwgewogICAgICAgICAgICAvLyAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIC8vICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAvLyAgICAgbm90aWZ5X3R5cGU6ICJOZXJNb2RlbCIsCiAgICAgICAgICAgIC8vICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIC8vICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAvLyAgICAgc3ViamVjdDogIk5vdGlmaWNhdGlvbiB0byB0cmFpbiB0aGUgbmVyIG1vZGVsIiwKICAgICAgICAgICAgLy8gICAgIGJvZHk6CiAgICAgICAgICAgIC8vICAgICAgIHRoaXMuY29tcGFueW5hbWUgKwogICAgICAgICAgICAvLyAgICAgICAiaGFzIHJlcXVlc3RlZCB0byB0cmFpbiB0aGUgbmVyIG1vZGVsIG9mIGVudGl0aWVzLiIsCiAgICAgICAgICAgIC8vICAgfSkKICAgICAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgLy8gICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEuTXNnKTsKICAgICAgICAgICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiQSBtYWlsIGhhcyBiZWVuIHNlbnQgdG8geW91ciBlbWFpbCIpIHsKICAgICAgICAgICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MoCiAgICAgICAgICAgIC8vICAgICAgICAgIllvdXIgTmVyICBtb2RlbCBpcyBzdWNjZXNzZnVsbHkgc2NoZWR1bGVkIGZvciBmdXJ0aGVyIHRyYWluaW5nLiIKICAgICAgICAgICAgLy8gICAgICAgKTsKICAgICAgICAgICAgLy8gICAgICAgdGhpcy5uZXdfcXVlc3Rpb25zID0gMDsKICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdChhcGlfY2FsbHMudHJhaW5fbmVyX21vZGVscygpLCB7CiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBjb21wYW55X2RldGFpbHM6IHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikKICAgICAgICAgICAgICAgICAgICAuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAvLyBlcG9jaHM6IDEwMCwKICAgICAgICAgICAgICAgIC8vIGJhdGNoX3NpemU6IDY0CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMud2FudF9zdGF0dXMgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLHRoaXMud2FudF9zdGF0dXMpOwogICAgICAgICAgICAgICAgdGhpcy5jaGVja19uZXJfbW9kZWxfc3RhdHVzKCk7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSAyMDAwMDExMSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ25lcl9pbnRlcm5hbF9zZXJ2ZXJfYWxlcnQyJykpOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJUaGVyZSBhcmUgbm8gdGFncyB0byB0cmFpbi4gUGxlYXNlIGFkZCBzb21lIHRhZ3MgYW5kIik7CiAgICAgICAgICAgIC8vIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICB0aGlzLnRsdCgnbmVyX25vX3RhZ3NfdHJhaW5fbXNnJykKICAgICAgICApOwogICAgICB9fWVsc2V7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIGNsZWFyX2ZpZWxkcygpIHsKICAgICAgdGhpcy53b3JkX2luZm8gPSB0aGlzLmJ1ZmZlcl93b3JkX2xpc3Q7CiAgICAgIHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgPSAiIjsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGUoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICB1cmw6IGFwaV9jYWxscy5maWxlX2Rvd25sb2FkKCksCiAgICAgICAgcmVzcG9uc2VUeXBlOiAiYmxvYiIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc2FtcGxlX2ZpbGU6ICJuZXIiLAogICAgICAgIH0sCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgfSwKICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ25lcl9kb3dubG9hZF9zYW1wbGVfYWxlcnQnKSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jb21wYW55bmFtZSkKICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgdGhpcy5jb21wYW55X25hbWUgKyAiTmVyRmlsZS5jc3YiKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCduZXJfZG93bmxvYWRfc2FtcGxlX2FsZXJ0MicpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogIH0sCn07Cg=="},null]}