{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/EmailTemplates.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/EmailTemplates.vue","mtime":1645594423491},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IHN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiRW1haWxUZW1wbGF0ZVBhZ2UiLAogIGNvbXBvbmVudHM6IHsKICAgIFZ1ZUVkaXRvciwKICAgIE11bHRpc2VsZWN0LAogIH0sCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWxdLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwZW5jaWxfc3ZnOgogICAgICAgICcgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVfbmFtZTogIiIsCiAgICAgIHNhdmVfc21zOiAiIiwKICAgICAgc2F2ZV9lbWFpbDogIiIsCiAgICAgIGlzX3NtczogZmFsc2UsCiAgICAgIGlzX2VtYWlsOiB0cnVlLAogICAgICBzYXZlX3N1YmplY3Q6ICIiLAogICAgICBpc19wdWJsaXNoX2VtYWlsOiB0cnVlLAogICAgICBpc19wdWJsaXNoX3NtczogdHJ1ZSwKICAgICAgaXNfZWRpdF9zbXM6IGZhbHNlLAogICAgICBpc19lZGl0X2VtYWlsOiB0cnVlLAogICAgICB2ZXJpZmljYXRpb25fc3RhdHVzOiBudWxsLAogICAgICB0ZW1wbGF0ZWxpc3Q6IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBjdXN0b21Ub29sYmFyOiBbCiAgICAgICAgWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwKICAgICAgICBbeyBhbGlnbjogW10gfV0sCiAgICAgICAgW3sgY29sb3I6IFtdIH0sIHsgYmFja2dyb3VuZDogW10gfV0sCiAgICAgICAgW3sgbGlzdDogIm9yZGVyZWQiIH0sIHsgbGlzdDogImJ1bGxldCIgfV0sCiAgICAgICAgWyJsaW5rIl0sCiAgICAgIF0sCiAgICAgIHF1aWxsOiAiIiwKICAgICAgcXVpbGxfZWRpdDogIiIsCiAgICAgIHNsb3RfdmFyaWFibGU6e30sCiAgICAgIGN1cnJlbnRfdGVtcGxhdGU6IFtdLAogICAgICBvbGRfdGVtcGxhdGVfbmFtZTogIiIsCiAgICAgIGlzRWRpdFRlbXBsYXRlOiBmYWxzZSwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTAsCiAgICAgIGltYWdlX2ZpbGU6IG51bGwsCiAgICAgIGltYWdlX2ZpbGVfMjogbnVsbCwKICAgICAgaXNfaW1hZ2VfbmVlZGVkOiAibm9uZSIsCiAgICAgIGlzX2VkaXRfaW1hZ2VfbmVlZGVkOiAibm9uZSIsCiAgICAgIGVtYWlsX3N1YmplY3Q6ICIiLAogICAgICByZWdfdXJsOgogICAgICAgIC9odHRwczpcL1wvWyh3d3dcLik/YS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIoWy1hLXpBLVowLTlAOiVfXCsufiM/JlwvXC89XSopL2ksCiAgICAgIGlzX2VkaXRfcmVnX3VybDoKICAgICAgICAvaHR0cHM6XC9cL1sod3d3XC4pP2EtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fVwuW2Etel17Miw2fVxiKFstYS16QS1aMC05QDolX1wrLn4jPyZcL1wvPV0qKS9pLAogICAgICBpbWdfcmVkaXJlY3RfdXJsOiAiIiwKICAgICAgZWRpdF9pbWdfcmVkaXJlY3RfdXJsOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgZWRpdGVkX2ZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIHByZXZpZXdfdGVtcGxhdGVfZGF0YTogIiIsCiAgICAgIHRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdDogZmFsc2UsCiAgICAgIGVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0OiBmYWxzZSwKICAgICAgcGFnZV9hcnJheTogW10sCiAgICAgIHNlbmRfZW1haWxfYWxsX2N1c3RvbWVyOiB0cnVlLAogICAgICBjdXN0b21lcnNfbGlzdDogW10sCiAgICAgIHNwZWNpZmljX2N1c3RvbWVyX2xpc3Q6IFtdLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOiBmYWxzZSwKICAgICAgZW1haWxfcmVnOgogICAgICAgIC9eKChbXjw+KClbXF1cXC4sOzpcc0BcIl0rKFwuW148PigpW1xdXFwuLDs6XHNAXCJdKykqKXwoXCIuK1wiKSlAKChcW1swLTldezEsM31cLlswLTldezEsM31cLlswLTldezEsM31cLlswLTldezEsM31cXSl8KChbYS16QS1aXC0wLTldK1wuKStbYS16QS1aXXsyLH0pKSQvLAogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBpc19ub3RpZmljYXRpb25fdGVtcGxhdGU6IEJvb2xlYW4sCiAgfSwKICB3YXRjaDogewogICAgLy8gaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlKCkgewogICAgLy8gICBjb25zb2xlLmxvZyh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSk7CiAgICAvLyB9LAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZhbGlkVVJMKCkgewogICAgICBpZiAodGhpcy5yZWdfdXJsLnRlc3QodGhpcy5pbWdfcmVkaXJlY3RfdXJsKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHZhbGlkX2VkaXRfVVJMKCkgewogICAgICBpZiAodGhpcy5pc19lZGl0X3JlZ191cmwudGVzdCh0aGlzLmVkaXRfaW1nX3JlZGlyZWN0X3VybCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgfSwKICBjcmVhdGVkKCkgewogICAgaWYgKHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWU7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMzAwMCk7CiAgICAgdGhpcy4kcm9vdC4kb24oIlZhcmlhbnRzRGlzYWJsZWQiLCAoZGF0YSkgPT57CiAgICAgIGlmKGRhdGE9PT10cnVlKXsKICAgICAgICB0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQgPSB0cnVlOwogICAgICB9CiAgICB9KQogICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwogICAgaWYgKHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlID09PSBmYWxzZSl7CiAgICAgIHRoaXMubG9hZF9jdXN0b21lcl9saXN0KCk7CiAgICB9CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICB0aGlzLmlzX3NtcyA9IGZhbHNlOwogICAgICB0aGlzLmlzX2VtYWlsID0gdHJ1ZTsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5lZGl0b3IoKTsKICAgIGlmICh0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSA9PT0gdHJ1ZSl7CiAgICAgIHRoaXMubG9hZF9zbG90X3ZhcmlhYmxlKCk7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2FkX3Nsb3RfdmFyaWFibGUoKXsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl9kaWFsb2dfdHJlZSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXRfc2xvdF92YXJpYWJsZTogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJTdWNjZXNzIikgewogICAgICAgICAgICB0aGlzLnNsb3RfdmFyaWFibGUgPSB7fTsKICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEuc2xvdHNfbGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gcmVzcG9uc2UuZGF0YS5zbG90c19saXN0W2luZGV4XTsKICAgICAgICAgICAgICB0aGlzLnNsb3RfdmFyaWFibGVbZWxlbWVudF0gPSAneycgKyBlbGVtZW50ICsgJ30nOwogICAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmluc2VydF92YXJpYWJsZSgncXVpbGwnLCB0aGlzLnNsb3RfdmFyaWFibGUpOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiA1MDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5pbnNlcnRfdmFyaWFibGUoJ3F1aWxsJywgdGhpcy5zbG90X3ZhcmlhYmxlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBlZGl0b3IoKXsKICAgICAgdGhpcy5xdWlsbCA9IG5ldyBRdWlsbCgiI2VkaXRvciIsIHsKICAgICAgICBtb2R1bGVzOiB7CiAgICAgICAgICB0b29sYmFyOiBbCiAgICAgICAgICAgIFsiYm9sZCIsICJpdGFsaWMiLCAidW5kZXJsaW5lIl0sCiAgICAgICAgICAgIFsibGluayJdLAogICAgICAgICAgICBbeyBhbGlnbjogW10gfV0sCiAgICAgICAgICAgIFt7IGNvbG9yOiBbXSB9LCB7IGJhY2tncm91bmQ6IFtdIH1dLAogICAgICAgICAgICBbeyBsaXN0OiAib3JkZXJlZCIgfSwgeyBsaXN0OiAiYnVsbGV0IiB9XSwKICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICAgICB0aGVtZTogInNub3ciLAogICAgICB9KTsKICAgICAgdGhpcy5xdWlsbC5vbigidGV4dC1jaGFuZ2UiLCAoKSA9PiB7CiAgICAgICAgdGhpcy4kZW1pdCgKICAgICAgICAgICJpbnB1dCIsCiAgICAgICAgICB0aGlzLnF1aWxsLmdldFRleHQoKSA/IHRoaXMucXVpbGwucm9vdC5pbm5lckhUTUwgOiAiIgogICAgICAgICk7CiAgICAgICAgdGhpcy5zYXZlX2VtYWlsID0gdGhpcy5xdWlsbC5nZXRUZXh0KCkgPyB0aGlzLnF1aWxsLnJvb3QuaW5uZXJIVE1MIDogIiI7CiAgICAgIH0pOwogICAgfSwKICAgIGVkaXRfZWRpdG9yKCl7CiAgICAgIHRoaXMucXVpbGxfZWRpdCA9IG5ldyBRdWlsbCgiI2VkaXRfZWRpdG9yIiwgewogICAgICBtb2R1bGVzOiB7CiAgICAgICAgdG9vbGJhcjogWwogICAgICAgICAgWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwKICAgICAgICAgIFsibGluayJdLAogICAgICAgICAgW3sgYWxpZ246IFtdIH1dLAogICAgICAgICAgW3sgY29sb3I6IFtdIH0sIHsgYmFja2dyb3VuZDogW10gfV0sCiAgICAgICAgICBbeyBsaXN0OiAib3JkZXJlZCIgfSwgeyBsaXN0OiAiYnVsbGV0IiB9XSwKICAgICAgICBdLAogICAgICB9LAogICAgICB0aGVtZTogInNub3ciLAogICAgfSk7CiAgICB0aGlzLnF1aWxsX2VkaXQub24oInRleHQtY2hhbmdlIiwgKCkgPT4gewogICAgICB0aGlzLiRlbWl0KAogICAgICAgICJpbnB1dCIsCiAgICAgICAgdGhpcy5xdWlsbF9lZGl0LmdldFRleHQoKSA/IHRoaXMucXVpbGxfZWRpdC5yb290LmlubmVySFRNTCA6ICIiCiAgICAgICk7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZS5lbWFpbCA9IHRoaXMucXVpbGxfZWRpdC5nZXRUZXh0KCkgPyB0aGlzLnF1aWxsX2VkaXQucm9vdC5pbm5lckhUTUwgOiAiIjsKICAgIH0pOwogICAgdGhpcy5xdWlsbF9lZGl0LnJvb3QuaW5uZXJIVE1MID0gdGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsOwogICAgdGhpcy5pbnNlcnRfdmFyaWFibGUoJ3F1aWxsX2VkaXQnLCB0aGlzLnNsb3RfdmFyaWFibGUpOwogICAgfSwKICAgIGluc2VydF92YXJpYWJsZSh2YWwsIHNsb3RfdmFyaWFibGUpewogICAgICBpZiAodGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUgPT09IHRydWUpewogICAgICAgIGNvbnN0IGRyb3BEb3duSXRlbXMgPSB7CiAgICAgICAgJ05vIHNsb3QgdmFyaWFibGUnOiAnJywKICAgICAgICB9CiAgICAgICAgY29uc3QgbXlEcm9wRG93biA9IG5ldyBRdWlsbFRvb2xiYXJEcm9wRG93bih7CiAgICAgICAgICAgIGxhYmVsOiAiSW5zZXJ0IFZhcmlhYmxlIiwKICAgICAgICAgICAgcmVtZW1iZXJTZWxlY3Rpb246IGZhbHNlLAogICAgICAgICAgICBpZDogImRyb3Bkb3duX2lkIgogICAgICAgIH0pCiAgICAgICAgaWYoT2JqZWN0LmVudHJpZXMoc2xvdF92YXJpYWJsZSkubGVuZ3RoID09PSAwICYmIHNsb3RfdmFyaWFibGUuY29uc3RydWN0b3IgPT09IE9iamVjdCl7CiAgICAgICAgICBteURyb3BEb3duLnNldEl0ZW1zKGRyb3BEb3duSXRlbXMpOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgIG15RHJvcERvd24uc2V0SXRlbXMoc2xvdF92YXJpYWJsZSk7CiAgICAgICAgfQogICAgICAgIG15RHJvcERvd24ub25TZWxlY3QgPSBmdW5jdGlvbihsYWJlbCwgdmFsdWUsIHF1aWxsKSB7CiAgICAgICAgICAgIGNvbnN0IHsgaW5kZXgsIGxlbmd0aCB9ID0gcXVpbGwuc2VsZWN0aW9uLnNhdmVkUmFuZ2UKICAgICAgICAgICAgcXVpbGwuZGVsZXRlVGV4dChpbmRleCwgbGVuZ3RoKQogICAgICAgICAgICBxdWlsbC5pbnNlcnRUZXh0KGluZGV4LCB2YWx1ZSkKICAgICAgICAgICAgcXVpbGwuc2V0U2VsZWN0aW9uKGluZGV4ICsgdmFsdWUubGVuZ3RoKQogICAgICAgIH0KICAgICAgICBteURyb3BEb3duLmF0dGFjaCh0aGlzLnF1aWxsKQogICAgICAgIGlmICh2YWwgPT09ICdxdWlsbF9lZGl0Jyl7CiAgICAgICAgICBteURyb3BEb3duLmF0dGFjaCh0aGlzLnF1aWxsX2VkaXQpCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYWRkVGFnKG5ld1RhZykgewogICAgICB2YXIgdGFnX2xpc3QgPSBbXTsKICAgICAgdGFnX2xpc3QgPSBuZXdUYWcuc3BsaXQoIiwiKTsKICAgICAgaWYgKHRhZ19saXN0Lmxlbmd0aCA+IDIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgYWRkIHZhbGlkIHRhZyIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIHRpbWVyOiA0NTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZW1haWwgPSB0YWdfbGlzdFswXTsKICAgICAgICB2YXIgY3VzdG9tZXJfbmFtZSA9IEJvb2xlYW4odGFnX2xpc3RbMV0pID8gdGFnX2xpc3RbMV0gOiAiICI7CiAgICAgICAgaWYgKCF0aGlzLmVtYWlsX3JlZy50ZXN0KGVtYWlsKSkgewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgdGltZXI6IDQ1MDAsCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgdGFnID0gewogICAgICAgIGN1c3RvbWVyX25hbWU6IGN1c3RvbWVyX25hbWUsCiAgICAgICAgZW1haWw6IGVtYWlsLAogICAgICB9OwogICAgICB0aGlzLmN1c3RvbWVyc19saXN0LnB1c2godGFnKTsKICAgICAgdGhpcy5zcGVjaWZpY19jdXN0b21lcl9saXN0LnB1c2godGFnKTsKICAgIH0sCiAgICBsb2FkX2N1c3RvbWVyX2xpc3QoKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5zZW5kX29mZmVyX3RvX2N1c3RvbWVycygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBnZXRfY3VzdG9tZXJzX2xpc3Q6IHRydWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJzX2xpc3QgPSByZXNwb25zZS5kYXRhLmN1c3RvbWVyc19saXN0OwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZW1haWxfdmVyaWZpY2F0aW9uX3N0YXR1cygpIHsKICAgICAgaWYoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCl7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5wcm9kdWN0X3NldHRpbmdzKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19lbWFpbF92ZXJpZmljYXRpb25fc3RhdHVzOiB0cnVlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgIT0gIiIgJiYKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgIT0gIkludGVybmFsIHNlcnZlciBFcnJvciIKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLnZlcmlmaWNhdGlvbl9zdGF0dXMgPSByZXNwb25zZS5kYXRhLnZlcmlmaWNhdGlvbl9zdGF0dXM7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudmVyaWZpY2F0aW9uX3N0YXR1cyk7CiAgICAgICAgICAgIGlmICh0aGlzLnZlcmlmaWNhdGlvbl9zdGF0dXMgPT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgLy8gaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHVibGlzaF90ZW1wbGF0ZV9idG4iKS5kaXNhYmxlZCkgewogICAgICAgICAgICAgICQoIiNzZW5kZW1haWwiKS5tb2RhbCgic2hvdyIpOwogICAgICAgICAgICAgIHRoaXMubG9hZF9jdXN0b21lcl9saXN0KCk7CiAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIkl0IHNlZW1zIGFzIGlmIHlvdXIgU2VuZGVyIEVtYWlsIGhhcyBub3QgYmVlbiBjb25maWd1cmVkIHlldCwgcGxlYXNlIGdvIHRoZSBTZXR0aW5ncyBUYWIgYW5kIGNvbmZpZ3VyZSBpdCB1bmRlciBFbWFpbCBDb25maWd1cmF0aW9uLiIsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICB0aW1lcjogMTMwMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIik7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSwKICAgIHZhbGlkYXRlX3RlbXBsYXRlX25hbWUoKSB7CiAgICAgIGF4aW9zLnBvc3QoCiAgICAgICAgYXBpX2NhbGxzLnRlbXBsYXRlX3Byb21vdGlvbmFsX2VtYWlsKCksCiAgICAgICAgewogICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgIGlzX3RlbXBsYXRlX3ByZXNlbnQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgIHRlbXBsYXRlX25hbWU6IHRoaXMudGVtcGxhdGVfbmFtZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICApCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT57CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJOb3QgRXhpc3RzIikgewogICAgICAgICAgICB0aGlzLnRlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPW51bGw7CiAgICAgICAgICAgIGlmKHRoaXMudGVtcGxhdGVfbmFtZSAhPSAiIil7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBbHJlYWR5IEV4aXN0cyIpIHsKICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVtcGxhdGVfbmFtZV9hZGRfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAiMXB4IHNvbGlkIHJlZCI7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHZhbGlkYXRlX2VkaXRfdGVtcGxhdGVfbmFtZSgpIHsKICAgICAgYXhpb3MucG9zdCgKICAgICAgICBhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfZW1haWwoKSwKICAgICAgICB7CiAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgaXNfdGVtcGxhdGVfcHJlc2VudDogdHJ1ZSwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgKQogICAgICAudGhlbigocmVzcG9uc2UpID0+ewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm90IEV4aXN0cyIpIHsKICAgICAgICAgICAgdGhpcy5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdF90ZW1wbGF0ZV9uYW1lX2lkIikuc3R5bGUuYm9yZGVyID1udWxsOwogICAgICAgICAgICBpZih0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZSAhPSAiIil7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQWxyZWFkeSBFeGlzdHMiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm9sZF90ZW1wbGF0ZV9uYW1lID09IHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lKXsKICAgICAgICAgICAgICB0aGlzLmVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9bnVsbDsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgdGhpcy5lZGl0X3RlbXBsYXRlX25hbWVfYWxyZWFkeV9leGlzdCA9IHRydWU7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRfdGVtcGxhdGVfbmFtZV9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHByZXZpZXdfdGVtcGxhdGUoKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX3ByZXZpZXc6IHRydWUsCiAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQsCiAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIC8vIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgIC8vICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgLy8gICB0aGlzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlKTsKICAgICAgICAgIC8vICAgaWYgKHJlc3BvbnNlLmRhdGEgPT09ICJEQiBPUEVSQVRJT04gVU5TVUNDRVNTRlVMIikgewogICAgICAgICAgLy8gICAgIHRoaXMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAvLyAgICAgcmV0dXJuOwogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyAgIHRoaXMudGVtcGxhdGVsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgLy8gICBpZiAodGhpcy50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8gICAgIC8vIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGVsaXN0WzBdOwogICAgICAgICAgLy8gICAgIHRoaXMuc2hvd190ZW1wbGF0ZSgwKTsKICAgICAgICAgIC8vICAgfQogICAgICAgICAgLy8gICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICAvLyB9CiAgICAgICAgICAvLyB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEgPSByZXNwb25zZS5kYXRhLlRlbXBsYXRlOwogICAgICAgICAgICAkKCIjcHJldmlld190ZW1wbGF0ZV92aXNpYmxlIikubW9kYWwoInNob3ciKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHNlbmRfZW1haWxfY29uZmlybV9wcm9tcHRfdGV4dChhbGxfY3VzdG9tZXIpIHsKICAgICAgaWYgKGFsbF9jdXN0b21lcikgewogICAgICAgIHJldHVybiAiWW91IGFyZSBhYm91dCB0byBzZW5kIGJ1bGsgZS1tYWlscy4iOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiWW91IGFyZSBhYm91dCB0byBzZW5kIGUtbWFpbHMgdG8gc3BlY2lmaWMgY3VzdG9tZXJzLiI7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX2VtYWlsKCkgewogICAgICBpZiAoIXRoaXMuc2VuZF9lbWFpbF9hbGxfY3VzdG9tZXIpIHsKICAgICAgICBpZighQm9vbGVhbih0aGlzLnNwZWNpZmljX2N1c3RvbWVyX2xpc3QubGVuZ3RoID4gMCkpewogICAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgZW1haWwiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdGltZXI6IDUwMDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICB9CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6dGhpcy5zZW5kX2VtYWlsX2NvbmZpcm1fcHJvbXB0X3RleHQodGhpcy5zZW5kX2VtYWlsX2FsbF9jdXN0b21lciksCiAgICAgICAgdGV4dDoiUGxlYXNlIGNvbmZpcm0iLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgdHlwZTond2FybmluZycsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEhIiwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgJCgiI3NlbmRlbWFpbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMuc2VuZF9vZmZlcl90b19jdXN0b21lcnMoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHNlbmRfZW1haWw6IHRydWUsCiAgICAgICAgICAgICAgICBzZW5kX2VtYWlsX2FsbF9jdXN0b21lcjogdGhpcy5zZW5kX2VtYWlsX2FsbF9jdXN0b21lciwKICAgICAgICAgICAgICAgIHNwZWNpZmljX2N1c3RvbWVyX2xpc3Q6CiAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZF9lbWFpbF9hbGxfY3VzdG9tZXIgIT0gdHJ1ZQogICAgICAgICAgICAgICAgICAgID8gdGhpcy5zcGVjaWZpY19jdXN0b21lcl9saXN0CiAgICAgICAgICAgICAgICAgICAgOiBbXSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT09ICJTZW5kaW5nIEVtYWlsIikgewogICAgICAgICAgICAgICAgICAvLyB0aGlzLnNhdmVfc3ViamVjdCA9ICIiOwogICAgICAgICAgICAgICAgICAvLyAkKCIjcHVibGlzaHRlbXBsYXRlbW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiRW1haWwgaXMgYmVpbmcgIHNlbnQgc3VjY2Vzc2Z1bGx5LiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiA1MDAwLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgICQoIiNzZW5kZW1haWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYocmVzcG9uc2UuZGF0YS5NU0cgPT09ICJQbGVhc2UgdXBncmFkZSB5b3VyIHBsYW4gdG8gc2VuZCBlbWFpbHMiKSB7CiAgICAgICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBgUGxlYXNlIHVwZ3JhZGUgeW91ciBwbGFuIHRvIHNlbmQgZW1haWxzLmAsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOicjMzA4NWQ2JywKICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnVXBncmFkZSBOb3cnLAogICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ0xhdGVyJywKICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI2QzMycsCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHtuYW1lOiAnU2V0dGluZ3MnLHBhcmFtczp7U3Vic2NyaXB0aW9uOnRydWV9fSk7ICAgICAKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgc2VsZWN0ZWRfdGVtcGxhdGVzKHZhbHVlKSB7CiAgICAgIGlmKHZhbHVlID09ICJhbGwiKXsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50ZW1wbGF0ZWxpc3QpIHsKICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMudGVtcGxhdGVsaXN0W2ldLnRlbXBsYXRlX2lkKTsKICAgICAgICAgIH0KICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICQoIiMiK1tpXSkucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICAkKCIjc2VsZWN0YWxsIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH1lbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICB9CgogICAgICB9ZWxzZXsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godmFsdWUpOwogICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50LnRhcmdldC5jaGVja2VkKXsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQpIHsKICAgICAgICAgICAgc2VsZWN0YWxsLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKCh0ZW1wbGF0ZXNfaWQpID0+IHsKICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlc19pZCAhPSB2YWx1ZTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvYWRfdGVtcGxhdGVzKCkgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfZW1haWwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlKTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT09ICJEQiBPUEVSQVRJT04gVU5TVUNDRVNTRlVMIikgewogICAgICAgICAgICAgIHRoaXMudGVtcGxhdGVsaXN0ID0gW107CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVsaXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIC8vIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGVsaXN0WzBdOwogICAgICAgICAgICAgIHRoaXMuc2hvd190ZW1wbGF0ZSgwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGZpbGVpbnB1dDEoZSkgewogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9wbmciIHx8IGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IGFuIEltYWdlIG9mIHR5cGUgUE5HIG9yIEpQRUciLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2UoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBmaWxlaW5wdXQyKGUpIHsKICAgICAgbGV0IGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2VkaXRlZF9pbWFnZV9uYW1lID0gdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbDsKICAgICAgICB0aGlzLmVkaXRlZF9maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlMihmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhbiBJbWFnZSBvZiB0eXBlIFBORyBvciBKUEVHIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUltYWdlMihmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgdGhpcy5pbWFnZV9maWxlXzIgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgY3JlYXRlX1VVSUQoKSB7CiAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICB2YXIgdXVpZCA9ICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoCiAgICAgICAgL1t4eV0vZywKICAgICAgICBmdW5jdGlvbiAoYykgewogICAgICAgICAgdmFyIHIgPSAoZHQgKyBNYXRoLnJhbmRvbSgpICogMTYpICUgMTYgfCAwOwogICAgICAgICAgZHQgPSBNYXRoLmZsb29yKGR0IC8gMTYpOwogICAgICAgICAgcmV0dXJuIChjID09ICJ4IiA/IHIgOiAociAmIDB4MykgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgICB9CiAgICAgICk7CiAgICAgIHJldHVybiB1dWlkOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICB9CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gIkRCIE9QRVJBVElPTiBVTlNVQ0NFU1NGVUwiKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZWxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3RlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZWxpc3RbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuaXNFZGl0VGVtcGxhdGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSAzOyBpIDw9IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX3RlbXBsYXRlKCkgewogICAgICBpZiAodGhpcy50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFRlbXBsYXRlIG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID09IHRydWUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJUZW1wbGF0ZSBuYW1lIGFscmVhZHkgZXhpc3QsIFBsZWFzZSBlbnRlciBkaWZmZXJlbnQgbmFtZSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lbWFpbF9zdWJqZWN0ID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIHRoZSBzdWJqZWN0IGZvciBlbWFpbCIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19zbXMgPT0gdHJ1ZSAmJiB0aGlzLnNhdmVfc21zID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFNtcyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc19lbWFpbCA9PSB0cnVlICYmIHRoaXMuc2F2ZV9lbWFpbCA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhbiBFbWFpbCBCb2R5IiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzX2VtYWlsID09IGZhbHNlICYmIHRoaXMuaXNfc21zID09IGZhbHNlKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBhbiBvcHRpb24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuaXNfaW1hZ2VfbmVlZGVkID09ICJ5ZXMiICYmCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0RmlsZSIpLnZhbHVlID09ICIiCiAgICAgICkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBjaG9vc2UgYW4gaW1hZ2UiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfaW1hZ2VfbmVlZGVkID09ICJ5ZXMiICYmICF0aGlzLnZhbGlkVVJMKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIHZhbGlkIFVSTCBsaW5rIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgdXVpZCA9IHRoaXMuY3JlYXRlX1VVSUQoKTsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgIHRleHQ6IGBZb3Ugd2FudCB0byBhZGQgdGhpcyB0ZW1wbGF0ZT9gLAogICAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEiLAogICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHdhaXQgd2hpbGUgd2UgYXJlIHN1Ym1pdHRpbmcgeW91ciBkZXRhaWxzLi4uIiwKICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB1dWlkLAogICAgICAgICAgICAgICAgICB0ZW1wbGF0ZV9uYW1lOiB0aGlzLnRlbXBsYXRlX25hbWUsCiAgICAgICAgICAgICAgICAgIHNhdmVfZW1haWw6IHRoaXMuaXNfZW1haWwgPT0gdHJ1ZSA/IHRoaXMuc2F2ZV9lbWFpbCA6IG51bGwsCiAgICAgICAgICAgICAgICAgIHNhdmVfc21zOiB0aGlzLmlzX3NtcyA9PSB0cnVlID8gdGhpcy5zYXZlX3NtcyA6IG51bGwsCiAgICAgICAgICAgICAgICAgIGVtYWlsX3N1YmplY3Q6IHRoaXMuZW1haWxfc3ViamVjdCwKICAgICAgICAgICAgICAgICAgZW1haWxfaW1nX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc19pbWFnZV9uZWVkZWQgPT09ICJub25lIiA/IG51bGwgOiB0aGlzLmltYWdlX2ZpbGUsCiAgICAgICAgICAgICAgICAgIGVtYWlsX2ltZ19uYW1lOiB0aGlzLmZpbGVfbGFiZWwsCiAgICAgICAgICAgICAgICAgIGVtYWlsX2ltZ19saW5rOiB0aGlzLmltZ19yZWRpcmVjdF91cmwsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICJUZW1wbGF0ZSBkYXRhIGFkZGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgICAgICAgICAgICAgJCgiI3RlbXBsYXRlbW9kZWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkR1cGxpY2F0ZSBpbWFnZSIpIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiSW1hZ2UgYWxyZWFkeSBmb3VuZC4gUGxlYXNlIHVwbG9hZCBhbm90aGVyIGltYWdlIG9yIHJlbmFtZSBpdC4iLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZWRpdF90ZW1wbGF0ZSgpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9uYW1lID09ICIiKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFRlbXBsYXRlIG5hbWUiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZWRpdF90ZW1wbGF0ZV9uYW1lX2FscmVhZHlfZXhpc3QgPT0gdHJ1ZSkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlRlbXBsYXRlIG5hbWUgYWxyZWFkeSBleGlzdCwgUGxlYXNlIGVudGVyIGRpZmZlcmVudCBuYW1lIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRfdGVtcGxhdGUuc3ViamVjdCA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciB0aGUgc3ViamVjdCBmb3IgZW1haWwiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuaXNfZWRpdF9zbXMgPT0gdHJ1ZSAmJgogICAgICAgICh0aGlzLmN1cnJlbnRfdGVtcGxhdGUuc21zID09IG51bGwgfHwgdGhpcy5jdXJyZW50X3RlbXBsYXRlLnNtcyA9PSAiIikKICAgICAgKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIFNtcyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5pc19lZGl0X2VtYWlsID09IHRydWUgJiYKICAgICAgICAodGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsID09IG51bGwgfHwKICAgICAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZS5lbWFpbCA9PSAiIikKICAgICAgKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGFuIEVtYWlsIEJvZHkiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfZWRpdF9lbWFpbCA9PSBmYWxzZSAmJiB0aGlzLmlzX2VkaXRfc21zID09IGZhbHNlKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBhbiBvcHRpb24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPT0gInllcyIgJiYgIXRoaXMudmFsaWRfZWRpdF9VUkwpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgZW50ZXIgdmFsaWQgVVJMIGxpbmsiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPT0gInllcyIgJiYKICAgICAgICB0aGlzLmVkaXRlZF9maWxlX2xhYmVsID09ICJDaG9vc2UgZmlsZSIgJiYKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRGaWxlMiIpLnZhbHVlID09ICIiCiAgICAgICkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBDaG9vc2UgYW4gSW1hZ2UiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIGFyZSBzdWJtaXR0aW5nIHlvdXIgZGV0YWlscy4uLiIsCiAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICB9KTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy50ZW1wbGF0ZV9wcm9tb3Rpb25hbF9lbWFpbCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgICBpc19ub3RpZmljYXRpb246IHRoaXMuaXNfbm90aWZpY2F0aW9uX3RlbXBsYXRlLAogICAgICAgICAgICAgIHRlbXBsYXRlX2lkOiB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaWQsCiAgICAgICAgICAgICAgdGVtcGxhdGVfbmFtZTogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX25hbWUsCiAgICAgICAgICAgICAgZW1haWxfc3ViamVjdDogdGhpcy5jdXJyZW50X3RlbXBsYXRlLnN1YmplY3QsCiAgICAgICAgICAgICAgc2F2ZV9lbWFpbDoKICAgICAgICAgICAgICAgIHRoaXMuaXNfZWRpdF9lbWFpbCA9PSB0cnVlID8gdGhpcy5jdXJyZW50X3RlbXBsYXRlLmVtYWlsIDogbnVsbCwKICAgICAgICAgICAgICBzYXZlX3NtczoKICAgICAgICAgICAgICAgIHRoaXMuaXNfZWRpdF9zbXMgPT0gdHJ1ZSA/IHRoaXMuY3VycmVudF90ZW1wbGF0ZS5zbXMgOiBudWxsLAogICAgICAgICAgICAgIGVtYWlsX2ltZ19maWxlOgogICAgICAgICAgICAgICAgdGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9PT0gIm5vbmUiID8gbnVsbCA6IHRoaXMuaW1hZ2VfZmlsZV8yLAogICAgICAgICAgICAgIGVtYWlsX2ltZ19uYW1lOgogICAgICAgICAgICAgICAgdGhpcy5pc19lZGl0X2ltYWdlX25lZWRlZCA9PT0gIm5vbmUiCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwsCiAgICAgICAgICAgICAgZW1haWxfaW1nX2xpbms6CiAgICAgICAgICAgICAgICB0aGlzLmlzX2VkaXRfaW1hZ2VfbmVlZGVkID09PSAibm9uZSIKICAgICAgICAgICAgICAgICAgPyBudWxsCiAgICAgICAgICAgICAgICAgIDogdGhpcy5lZGl0X2ltZ19yZWRpcmVjdF91cmwsCiAgICAgICAgICAgICAgaXNfaW1hZ2VfZWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwgIT0gdGhpcy5vbGRfZWRpdGVkX2ltYWdlX25hbWUKICAgICAgICAgICAgICAgICAgPyB0cnVlCiAgICAgICAgICAgICAgICAgIDogZmFsc2UsCiAgICAgICAgICAgICAgaXNfaW1hZ2VfcHJlc2VudDoKICAgICAgICAgICAgICAgIHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPT09ICJub25lIiA/IGZhbHNlIDogdHJ1ZSwKICAgICAgICAgICAgICBvbGRfaW1hZ2U6CiAgICAgICAgICAgICAgICB0aGlzLm9sZF9lZGl0ZWRfaW1hZ2VfbmFtZSA9PSAiQ2hvb3NlIEZpbGUiCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMub2xkX2VkaXRlZF9pbWFnZV9uYW1lLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiVGVtcGxhdGUgZGF0YSBlZGl0ZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0RmlsZTIiKS52YWx1ZSA9ICIiOwogICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX3RlbXBsYXRlcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6ICJTb21lIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIk5vIHRlbXBsYXRlcyBzZWxlY3RlZCEiLAogICAgICAgICAgdGV4dDogIiIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICB0ZXh0OiAiIFlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIHRlbXBsYXRlPyIsCiAgICAgICAgICB0eXBlOiAicXVlc3Rpb24iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBDb25maXJtISIsCiAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlX3RlbXBsYXRlcyh0aGlzLmNoZWNrZWRfbGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfdGVtcGxhdGVzKGNoZWNrZWRfbGlzdCkgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMudGVtcGxhdGVfcHJvbW90aW9uYWxfZW1haWwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19kZWxldGU6IHRydWUsCiAgICAgICAgICAgIHRlbXBsYXRlX2xpc3Q6IGNoZWNrZWRfbGlzdCwKICAgICAgICAgICAgaXNfbm90aWZpY2F0aW9uOiB0aGlzLmlzX25vdGlmaWNhdGlvbl90ZW1wbGF0ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkRlbGV0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGV4dDogIlRlbXBsYXRlIGRhdGEgZGVsZXRlZCBzdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICB0aGlzLmxvYWRfdGVtcGxhdGVzKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgc2hvd190ZW1wbGF0ZShpbmRleCkgewogICAgICB0aGlzLmlzRWRpdFRlbXBsYXRlID0gZmFsc2U7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdKSk7CiAgICAgIHRoaXMub2xkX3RlbXBsYXRlX25hbWUgPSB0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfbmFtZTsKICAgICAgdGhpcy5jdXJyZW50X3RlbXBsYXRlX2luZGV4ID0gaW5kZXg7CiAgICAgIGlmIChCb29sZWFuKHRoaXMuY3VycmVudF90ZW1wbGF0ZS50ZW1wbGF0ZV9pbWFnZV9uYW1lKSA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuaXNfZWRpdF9pbWFnZV9uZWVkZWQgPSAieWVzIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzX2VkaXRfaW1hZ2VfbmVlZGVkID0gIm5vbmUiOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0uZW1haWwgIT0gbnVsbCkgewogICAgICAgIHRoaXMuaXNfZWRpdF9lbWFpbCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc19lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XS5zbXMgIT0gbnVsbCkgewogICAgICAgIHRoaXMuaXNfZWRpdF9zbXMgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNfZWRpdF9zbXMgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoQm9vbGVhbih0aGlzLmN1cnJlbnRfdGVtcGxhdGUudGVtcGxhdGVfaW1hZ2VfbmFtZSkgPT09IHRydWUpIHsKICAgICAgICB0aGlzLmVkaXRlZF9maWxlX2xhYmVsID0gdGhpcy5jdXJyZW50X3RlbXBsYXRlLnRlbXBsYXRlX2ltYWdlX25hbWU7CiAgICAgICAgdGhpcy5vbGRfZWRpdGVkX2ltYWdlX25hbWUgPSB0aGlzLmVkaXRlZF9maWxlX2xhYmVsOwogICAgICAgIHRoaXMuZWRpdF9pbWdfcmVkaXJlY3RfdXJsID0gdGhpcy5jdXJyZW50X3RlbXBsYXRlLmltYWdlX3JlZGlyZWN0X3VybDsKICAgICAgICBpZiAodGhpcy5lZGl0ZWRfZmlsZV9sYWJlbCA9PSAiIikgewogICAgICAgICAgdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZWRpdGVkX2ZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIHRoaXMub2xkX2VkaXRlZF9pbWFnZV9uYW1lID0gdGhpcy5lZGl0ZWRfZmlsZV9sYWJlbDsKICAgICAgICB0aGlzLmVkaXRfaW1nX3JlZGlyZWN0X3VybCA9ICIiOwogICAgICB9CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgIHRoaXMuc2VuZF9lbWFpbF9hbGxfY3VzdG9tZXIgPSB0cnVlOwogICAgICAgIHRoaXMucXVpbGwuc2V0VGV4dCgiIik7CiAgICAgICAgdGhpcy5jdXN0b21lcnNfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc3BlY2lmaWNfY3VzdG9tZXJfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc2F2ZV9zbXMgPSAiIjsKICAgICAgICB0aGlzLnNhdmVfZW1haWwgPSAiIjsKICAgICAgICB0aGlzLnRlbXBsYXRlX25hbWUgPSAiIjsKICAgICAgICB0aGlzLm9sZF90ZW1wbGF0ZV9uYW1lID0gIiI7CiAgICAgICAgdGhpcy5pc19lbWFpbCA9IHRydWU7CiAgICAgICAgdGhpcy5pc19zbXMgPSBmYWxzZTsKICAgICAgICB0aGlzLnNhdmVfc3ViamVjdCA9ICIiOwogICAgICAgIHRoaXMuaXNfcHVibGlzaF9lbWFpbCA9IHRydWU7CiAgICAgICAgdGhpcy52ZXJpZmljYXRpb25fc3RhdHVzID0gbnVsbDsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIHRoaXMuaW1nX3JlZGlyZWN0X3VybCA9ICIiOwogICAgICAgIHRoaXMuZW1haWxfc3ViamVjdCA9ICIiOwogICAgICAgIHRoaXMuaXNfaW1hZ2VfbmVlZGVkID0gIm5vbmUiOwogICAgICAgIHRoaXMudGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlbXBsYXRlX25hbWVfYWRkX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgfWVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIAogICAgfSwKICAgIGVkaXRfdGVtcGxhdGVfZGV0YWlscygpIHsKICAgICAgaWYgKCF0aGlzLmlzRWRpdFRlbXBsYXRlKSB7CiAgICAgICAgdGhpcy5pc0VkaXRUZW1wbGF0ZSA9IHRydWU7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmVkaXRfZWRpdG9yKCk7CiAgICAgICAgfSwgMTAwMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRUZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgIHRoaXMubG9hZF90ZW1wbGF0ZXMoKTsKICAgICAgICB0aGlzLmVkaXRfdGVtcGxhdGVfbmFtZV9hbHJlYWR5X2V4aXN0ID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X3RlbXBsYXRlX2FjdGl2ZShpbmRleCkgewogICAgICAvLyBjb25zb2xlLnRhYmxlKGluZGV4LCB0aGlzLnRlbXBsYXRlbGlzdFtpbmRleF0sIHRoaXMuY3VycmVudF90ZW1wbGF0ZSk7CiAgICAgIGlmIChCb29sZWFuKHRoaXMudGVtcGxhdGVsaXN0W2luZGV4XSkgPT09IHRydWUpIHsKICAgICAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZWxpc3RbaW5kZXhdLnRlbXBsYXRlX25hbWUgPT09CiAgICAgICAgICB0aGlzLm9sZF90ZW1wbGF0ZV9uYW1lCiAgICAgICAgICA/ICJjdXJyZW50LWFjdGl2ZS10ZW1wbGF0ZSIKICAgICAgICAgIDogbnVsbDsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},null]}