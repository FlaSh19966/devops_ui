{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue","mtime":1645594423479},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IFJlc3BvbnNlQm90IGZyb20gIi4uL0RhdGEgSW5wdXRzL1Jlc3BvbnNlQm90IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgRW1vamlQaWNrZXIgZnJvbSAndnVlLWVtb2ppLXBpY2tlcicKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQm90Q29uZmlndXJhdGlvbiIsCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgICBSZXNwb25zZUJvdCwKICAgIGRyYWdnYWJsZSwKICAgIEVtb2ppUGlja2VyCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaW5wdXQ6ICcnLAogICAgICBzZWFyY2g6ICcnLAogICAgICBiaWdfc3Bpbm5lcjogZmFsc2UsCiAgICAgIGJvdF9ncmVldGluZ3M6IFtdLAogICAgICBib3RfYmFja2dyb3VuZF90eXBlOiAibm9uZSIsCiAgICAgIHJlc2V0X2ljb25fcGF0aDogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9yZXNldF9pY29uLnN2ZyIpLAogICAgICBpc19QcmVtaXVtOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICBkZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlOiBbCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLmJ1dHRvbl90aGVtZSIsCiAgICAgICAgICB2YWx1ZTogIiMyNzM2NzkiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLmJvdF90aGVtZSIsCiAgICAgICAgICB2YWx1ZTogIiMyNzM2NzkiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUiLAogICAgICAgICAgdmFsdWU6ICIjMjczNjc5IiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yIiwKICAgICAgICAgIHZhbHVlOiAiIzI3MzY3OSIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3IiLAogICAgICAgICAgdmFsdWU6ICIjMjczNjc5IgogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgbmFtZTogImJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UiLAogICAgICAgIC8vICAgdmFsdWU6ICJ0cnVlIiwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3RfYnV0dG9uc19hbGlnbm1lbnQiLAogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgbmFtZTogIkNlbnRlciIsCiAgICAgICAgICAgIHZhbHVlOiAiY2VudGVyIiwKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nIiwKICAgICAgICAgIHZhbHVlOiAiMyIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyIsCiAgICAgICAgICB2YWx1ZTogIjUiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9oZWFkZXJfYmFja2dyb3VuZCIsCiAgICAgICAgICB2YWx1ZTogIiNmZmZmZmYiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9oZWFkZXJfYWxpZ25tZW50IiwKICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgIG5hbWU6ICJDZW50ZXIiLAogICAgICAgICAgICB2YWx1ZTogImNlbnRlciIsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9hbGlnbm1lbnQiLAogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgbmFtZTogIlJpZ2h0IiwKICAgICAgICAgICAgdmFsdWU6ICJyaWdodCIsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZToiYm90X2hvcml6b250YWxfcG9zaXRpb24iLAogICAgICAgICAgdmFsdWU6MzAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiJib3RfdmVydGljYWxfcG9zaXRpb24iLAogICAgICAgICAgdmFsdWU6MTIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2ZvbnRfc3R5bGUiLAogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgbmFtZTogIlJvYm90byIsCiAgICAgICAgICAgIHZhbHVlOiAiUm9ib3RvIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9mb250X2NvbG9yX3NlbmRlciIsCiAgICAgICAgICB2YWx1ZTogIiNmZmZmZmYiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2ZvbnRfY29sb3JfcmVjZWl2ZXIiLAogICAgICAgICAgdmFsdWU6ICIjMDAwMDAwIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9mb250X2NvbG9yX2J1dHRvbnMiLAogICAgICAgICAgdmFsdWU6ICIjZmZmZmZmIgogICAgICAgIH0KICAgICAgXSwKICAgICAgaXNfYmdfaW1hZ2VfY2hhbmdlZDogZmFsc2UsCiAgICAgIGJvdF9oZWFkZXJfYmFja2dyb3VuZDogIiIsCiAgICAgIGJvdF9oZWFkZXJfYWxpZ25tZW50OiBudWxsLAogICAgICBib3RfZm9udF9zdHlsZTogJycsCiAgICAgIGJvdF9mb250X2NvbG9yX3NlbmRlcjogJycsCiAgICAgIGJvdF9mb250X2NvbG9yX3JlY2VpdmVyOiAnJywKICAgICAgYm90X2ZvbnRfY29sb3JfYnV0dG9uczogJycsCiAgICAgIGJvdF9mb250X29wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiQXJpYWwiLAogICAgICAgICAgdmFsdWU6ICJhcmlhbCxzYW5zLXNlcmlmIiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJSb2JvdG8iLAogICAgICAgICAgdmFsdWU6ICJSb2JvdG8iLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIk9wZW4gU2FucyIsCiAgICAgICAgICB2YWx1ZTogIk9wZW4gU2FucyIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiVGltZXMgTmV3IFJvbWFuIiwKICAgICAgICAgIHZhbHVlOiAiVGltZXMgTmV3IFJvbWFuIiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJHZW9yZ2lhIiwKICAgICAgICAgIHZhbHVlOiAiR2VvcmdpYSIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiTWljcm9zb2Z0IEpoZW5nSGVpIiwKICAgICAgICAgIHZhbHVlOiAiJ01pY3Jvc29mdCBKaGVuZ0hlaScsIFNhbnMtc2VyaWYiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIk1lcnJpd2VhdGhlciIsCiAgICAgICAgICB2YWx1ZTogIidNZXJyaXdlYXRoZXInLCBTYW5zLXNlcmlmIiwKICAgICAgICB9LAogICAgICBdLAogICAgICBib3RfaG9yaXpvbnRhbF9wb3NpdGlvbjozMCwKICAgICAgYm90X3ZlcnRpY2FsX3Bvc2l0aW9uOjEyLAogICAgICBib3RfYWxpZ25tZW50OnsKICAgICAgICAgIHZhbHVlOiAicmlnaHQiLAogICAgICAgICAgbmFtZTogIlJpZ2h0IiwKICAgICAgICB9LAogICAgICBib3RfYWxpZ25tZW50X29wdGlvbnM6WwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJMZWZ0IiwKICAgICAgICAgIHZhbHVlOiAibGVmdCIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogInJpZ2h0IiwKICAgICAgICAgIG5hbWU6ICJSaWdodCIsCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgYm90X2hlYWRlcl9hbGlnbm1lbnRfb3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJDZW50ZXIiLAogICAgICAgICAgdmFsdWU6ICJjZW50ZXIiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIkxlZnQiLAogICAgICAgICAgdmFsdWU6ICJsZWZ0IiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHZhbHVlOiAicmlnaHQiLAogICAgICAgICAgbmFtZTogIlJpZ2h0IiwKICAgICAgICB9LAogICAgICBdLAogICAgICBib3RfYnV0dG9uc19hbGlnbm1lbnRfb3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJDZW50ZXIiLAogICAgICAgICAgdmFsdWU6ICJjZW50ZXIiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIkxlZnQiLAogICAgICAgICAgdmFsdWU6ICJmbGV4LXN0YXJ0IiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHZhbHVlOiAiZmxleC1lbmQiLAogICAgICAgICAgbmFtZTogIlJpZ2h0IiwKICAgICAgICB9LAogICAgICBdLAogICAgICBib3RfYnV0dG9uc19hbGlnbm1lbnQ6IHt9LAogICAgICBpbWFnZV9maWxlXzI6IG51bGwsCiAgICAgIGltYWdlX2ZpbGVfMzogbnVsbCwKICAgICAgd2lkZ2V0X2J1dHRvbnNfZGV0YWlsczogW10sCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWxfMjogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbF8zOiAiQ2hvb3NlIGZpbGUiLAogICAgICBib3Rfc3R5bGluZzogewogICAgICAgIGJvdF90aGVtZTogIiIsCiAgICAgICAgYnV0dG9uX2JvcmRlcl90aGVtZTogIiIsCiAgICAgICAgdXNlcl9tc2dfZm9udF9jb2xvcjogIiIsCiAgICAgICAgYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3I6ICIiLAogICAgICAgIGJ1dHRvbl90aGVtZTogIiIsCiAgICAgICAgaG9yaXpvbnRhbF9zcGFjaW5nOiAiIiwKICAgICAgICB2ZXJ0aWNhbF9zcGFjaW5nOiAiIiwKICAgICAgICBpc19wb3dlcmVkX2J5X2NlbnNlOiB0cnVlLAogICAgICAgIGJvdF9vcGVuX2J5X2RlZmF1bHQ6IGZhbHNlLAogICAgICAgIGJvdF9zaG93bl9vbl93ZWJzaXRlOiBmYWxzZSwKICAgICAgICBzaG93X2JvdF9oaXN0b3J5OiB0cnVlLAogICAgICB9LAogICAgICBpbnRlbnRsaXN0OiBbXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgbG9hZF9ib3RfcHJldmlldzogZmFsc2UsCiAgICAgIGRyYWdfYnV0dG9uczogZmFsc2UsCiAgICAgIGRyYWdfZ3JlZXRpbmdzOiBmYWxzZSwKICAgICAgZGVmYXVsdF9yZXRhaWxfZ3JlZXRpbmdzOiBbIi9vcmRlcl9yZXR1cm4iLCAib3JkZXJfcmV0dXJuIl0sCiAgICAgIHZlcmlmeV9ib3Rfc2V0dGluZ3M6IFtdLAogICAgICB2ZXJpZnlfY2hlY2s6IGZhbHNlLAogICAgICBncmVldGluZ3Nfa2V5OiAwLAogICAgICBidXR0b25zX2tleTogMAogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBmcm9tX3NldHVwOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICBib3RfYmFja2dyb3VuZF90eXBlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIGlmIChuZXdWYWwgPT09ICJub25lIikgewogICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zID0gIkNob29zZSBGaWxlIjsKICAgICAgICB0aGlzLmltYWdlX2ZpbGVfMyA9IG51bGw7CiAgICAgICAgdGhpcy5pc19iZ19pbWFnZV9jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAvLyB0aGlzLm9sZF9pbWFnZV9uYW1lXzMgPSBudWxsOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAzIikudmFsdWUgPSAiIjsKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIHRoaXMuZ2V0X2ludGVudHMoKTsKICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGJvdF9hbGlnbm1lbnRfdGV4dCgpewogICAgICByZXR1cm4gdGhpcy5ib3RfYWxpZ25tZW50Lm5hbWU7CiAgICB9LAogICAgc2V0dXBfY3NzKCkgewogICAgICBpZih0aGlzLmZyb21fc2V0dXAgPT0gdHJ1ZSl7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICItLWRhc2gtY29udC1tYXJnaW4iOiAiMHB4IiwKICAgICAgICAgICItLWRhc2gtY29udC1wYWRkaW5nIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtbWFyZ2luIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1ib3JkZXIiOiAibm9uZSIsCiAgICAgICAgICAiLS1jYXJkLWJvZHktcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1oZWFkZXItcGFkZGluZyI6ICIyMHB4IDBweCIsCiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIGRyYWdPcHRpb25zR3JlZXRpbmdzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGFuaW1hdGlvbjogMjAwLAogICAgICAgIGdyb3VwOiAiZGVzY3JpcHRpb24iLAogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgICBnaG9zdENsYXNzOiAiZ2hvc3QiLAogICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAyMDAsCiAgICAgICAgZm9yY2VGYWxsYmFjazogdHJ1ZSwKICAgICAgfTsKICAgIH0sCiAgICBkcmFnT3B0aW9uc0J1dHRvbnMoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYW5pbWF0aW9uOiAyMDAsCiAgICAgICAgZ3JvdXA6ICJkZXNjcmlwdGlvbiIsCiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlLAogICAgICAgIGdob3N0Q2xhc3M6ICJnaG9zdCIsCiAgICAgICAgc2Nyb2xsU2Vuc2l0aXZpdHk6IDIwMCwKICAgICAgICBmb3JjZUZhbGxiYWNrOiB0cnVlLAogICAgICB9OwogICAgfSwKICB9LAogIG1vdW50ZWQoKSB7CiAgICAkKCIjcHJldmlld19ib3RfdmlzaWJsZSIpLm9uKCJzaG93LmJzLm1vZGFsIiwgKCkgPT4gewogICAgICB0aGlzLmxvYWRfYm90X3ByZXZpZXcgPSB0cnVlOwogICAgfSk7CiAgICAkKCIjcHJldmlld19ib3RfdmlzaWJsZSIpLm9uKCJoaWRlLmJzLm1vZGFsIiwgKCkgPT4gewogICAgICB0aGlzLmxvYWRfYm90X3ByZXZpZXcgPSBmYWxzZTsKICAgIH0pOwogICAgdGhpcy4kcm9vdC4kZW1pdCgiY2hhbmdlX3NpZGViYXJfbWFpbl9tZW51IiwgIlNpbXVsYXRlIEludGVyYWN0aW9uIik7CiAgfSwKICBiZWZvcmVSb3V0ZUxlYXZlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgY2hlY2sgPSBmYWxzZTsKICAgIGlmICh0aGlzLnZlcmlmeV9jaGVjaykgewogICAgICBpZiAoCiAgICAgICAgKHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5CZ0ltYWdlTmFtZSA9PSB0aGlzLmZpbGVfbGFiZWxfMyB8fCAKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQmdJbWFnZU5hbWUgPT0gIiIgKSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RGb250LkZvbnRDb2xvckJ1dHRvbnMgPT0gdGhpcy5ib3RfZm9udF9jb2xvcl9idXR0b25zICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEZvbnQuRm9udENvbG9yUmVjZWl2ZXIgPT0gdGhpcy5ib3RfZm9udF9jb2xvcl9yZWNlaXZlciAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RGb250LkZvbnRDb2xvclNlbmRlciA9PSB0aGlzLmJvdF9mb250X2NvbG9yX3NlbmRlciAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RGb250LkZvbnRTdHlsZSA9PSB0aGlzLmJvdF9mb250X3N0eWxlICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEltYWdlTmFtZSA9PSB0aGlzLmZpbGVfbGFiZWxfMiAmJiAKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90T3BlbkJ5RGVmYXVsdCA9PSB0aGlzLmJvdF9zdHlsaW5nLmJvdF9vcGVuX2J5X2RlZmF1bHQgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90U2hvd25PbldlYnNpdGUgPT0gdGhpcy5ib3Rfc3R5bGluZy5ib3Rfc2hvd25fb25fd2Vic2l0ZSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Jc1Bvd2VyZWRCeUNlbnNlID09IHRoaXMuYm90X3N0eWxpbmcuaXNfcG93ZXJlZF9ieV9jZW5zZSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RTdHlsaW5nLnZhbHVlID09IHRoaXMuYm90X2J1dHRvbnNfYWxpZ25tZW50LnZhbHVlICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdFRoZW1lID09IHRoaXMuYm90X3N0eWxpbmcuYm90X3RoZW1lICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLlVzZXJNZXNzYWdlRm9udENvbG9yID09IHRoaXMuYm90X3N0eWxpbmcudXNlcl9tc2dfZm9udF9jb2xvciAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RSZXNwb25zZUZvbnRDb2xvciA9PSB0aGlzLmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJ1dHRvbkJvcmRlclRoZW1lID09IHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5CdXR0b25TdHlsaW5nLmhvcml6b250YWwgPT0gdGhpcy5ib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmcgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQnV0dG9uU3R5bGluZy52ZXJ0aWNhbCA9PSB0aGlzLmJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmcgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQnV0dG9uVGhlbWUgPT0gdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fdGhlbWUgJiYgCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkhlYWRlclN0eWxpbmcudmFsdWUgPT0gdGhpcy5ib3RfaGVhZGVyX2FsaWdubWVudC52YWx1ZSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5IZWFkZXJUaGVtZSA9PSB0aGlzLmJvdF9oZWFkZXJfYmFja2dyb3VuZCAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5JbWFnZU5hbWUgPT0gdGhpcy5maWxlX2xhYmVsICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLldpZGdldFBvc2l0aW9uLnZlcnRpY2FsID09IHRoaXMuYm90X3ZlcnRpY2FsX3Bvc2l0aW9uICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLldpZGdldFBvc2l0aW9uLmhvcml6b250YWwgPT0gdGhpcy5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5TaG93Qm90SGlzdG9yeSA9PSB0aGlzLmJvdF9zdHlsaW5nLnNob3dfYm90X2hpc3RvcnkgICAgICAgICAKICAgICAgKQogICAgICAgIHsKICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNoZWNrKSB7CiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIklmIHlvdSBoYXZlIG1hZGUgYW55IGNoYW5nZXMgaW4gdGhlIEJvdCBDb25maWd1cmF0aW9uIHNldHRpbmdzIHBsZWFzZSBzYXZlIHRoZW0gZmlyc3QsIGVsc2UgdGhleSB3aWxsIGRpc2NhcmRlZCEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJTYXZlIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAiQ2FuY2VsIiwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgdGhpcy51cGxvYWRfaW1hZ2UoKTsKICAgICAgICAgIHRoaXMuc3VibWl0X2dyZWV0aW5ncygpOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgIG5leHQoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgbmV4dCgpOwogICAgfQogIH0sCiAgZGlyZWN0aXZlczogewogICAgZm9jdXM6IHsKICAgICAgaW5zZXJ0ZWQoZWwpIHsKICAgICAgICBlbC5mb2N1cygpCiAgICAgIH0sCiAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgZ3JlZXRpbmdfZW1vamlfb2ZmKGlkKXsKICAgICAgICAkKGAjZW1vamlfJHtpZH1gKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaScpOwogICAgfSwKICAgIGdyZWV0aW5nX2Vtb2ppX29uKGlkKXsKICAgICAgICAkKGAjZW1vamlfJHtpZH1gKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaScpOwogICAgfSwKICAgIGJ1dHRvbl9lbW9qaV9vZmYoaWQpewogICAgICAkKGAjZW1vamlfdGl0bGVfJHtpZH1gKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaV9idG5fdGl0bGUnKTsKICAgIH0sCiAgICBidXR0b25fZW1vamlfb24oaWQpewogICAgICAkKGAjZW1vamlfdGl0bGVfJHtpZH1gKS50b2dnbGVDbGFzcygndmlzaWJsZV9lbW9qaV9idG5fdGl0bGUnKTsKICAgIH0sCiAgICBhcHBlbmQoZW1vamksIGlkKSB7IAogICAgICBmb3IodmFyIGkgPSAwOyBpPCB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoOyBpKyspewogICAgICAgICAgaWYodGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmlkID09PSBpZCl7CiAgICAgICAgICAgIHZhciBjdXJzb3JQb3MgPSAkKCcjJyArIGlkKS5wcm9wKCJzZWxlY3Rpb25TdGFydCIpOwogICAgICAgICAgICBsZXQgdiA9ICQoJyMnICsgaWQpLnZhbCgpOwogICAgICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IHYuc3Vic3RyaW5nKDAsICBjdXJzb3JQb3MgKTsKICAgICAgICAgICAgdmFyIHRleHRBZnRlciAgPSB2LnN1YnN0cmluZyggY3Vyc29yUG9zLCB2Lmxlbmd0aCApOwogICAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3NbaV0udGV4dCA9IHRleHRCZWZvcmUgKyBlbW9qaSArIHRleHRBZnRlcjsKICAgICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFwcGVuZF9vbl90aXRsZShlbW9qaSwgaWQpewogICAgICBmb3IodmFyIGkgPSAwOyBpPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspewogICAgICAgICAgaWYodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLmlkID09PSBpZCl7CiAgICAgICAgICAgIHZhciBjdXJzb3JQb3MgPSAkKCcjJyArIGlkKS5wcm9wKCJzZWxlY3Rpb25TdGFydCIpOwogICAgICAgICAgICBsZXQgdiA9ICQoJyMnICsgaWQpLnZhbCgpOwogICAgICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IHYuc3Vic3RyaW5nKDAsICBjdXJzb3JQb3MgKTsKICAgICAgICAgICAgdmFyIHRleHRBZnRlciAgPSB2LnN1YnN0cmluZyggY3Vyc29yUG9zLCB2Lmxlbmd0aCApOwogICAgICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0udGl0bGUgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZXRfaW50ZW50cygpIHsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5zaG93X2ludGVudF91cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZihBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdC5wdXNoKAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YVtpXQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGFkZF9ib3RfZ3JlZXRpbmdzKCkgewogICAgICBsZXQgbmV4dF9pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5wdXNoKHsKICAgICAgICB0ZXh0OiBudWxsLAogICAgICAgIGlkOiBuZXh0X2lkLAogICAgICAgIHZpc2libGU6IHRydWUKICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX2dyZWV0aW5nKGluZGV4KSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoID09PSAxICYmCiAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmxlbmd0aCA+IDAKICAgICAgKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiQXRsZWFzdCBvbmUgR3JlZXRpbmcgaXMgcmVxdWlyZWQgdG8gYWRkIGJ1dHRvbnMiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCB0ZW1wX2luZGV4ID0gbnVsbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmlkID09IGluZGV4KSB7CiAgICAgICAgICB0ZW1wX2luZGV4ID0gaTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLnNwbGljZSh0ZW1wX2luZGV4LCAxKTsKICAgIH0sCiAgICBnZXRfd2lkZ2V0X3NldHRpbmdzKCkgewogICAgICB0aGlzLmJvdF9ncmVldGluZ3MgPSBbXTsKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIC8vIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscyA9IFtdOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnRpdGxlID0gcmVzcG9uc2UuZGF0YS5XaWRnZXRUaXRsZTsKICAgICAgICAgIHRoaXMub2xkX3dpZGdldF90aXRsZSA9IHRoaXMudGl0bGU7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSByZXNwb25zZS5kYXRhLkltYWdlTmFtZTsKICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF8yID0gcmVzcG9uc2UuZGF0YS5Cb3RJbWFnZU5hbWU7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfMyA9IHJlc3BvbnNlLmRhdGEuQmdJbWFnZU5hbWU7CiAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF90aGVtZSA9CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuQm90VGhlbWUubGVuZ3RoIDwgNgogICAgICAgICAgICAgID8gKAogICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLkJvdFRoZW1lICsKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5Cb3RUaGVtZS5zbGljZSgxLCByZXNwb25zZS5kYXRhLkJvdFRoZW1lLmxlbmd0aCkKICAgICAgICAgICAgICAgICkuc3Vic3RyKDAsIDcpCiAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLkJvdFRoZW1lOwogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZSAhPSBudWxsKXsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZS5sZW5ndGggPCA2CiAgICAgICAgICAgICAgPyAoCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUgKwogICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lLnNsaWNlKDEsIHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUubGVuZ3RoKQogICAgICAgICAgICAgICAgKS5zdWJzdHIoMCwgNykKICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWU7CiAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZS5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gImJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUiKVswXS52YWx1ZQogICAgICAgICAgfQogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciAhPSBudWxsKXsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuVXNlck1lc3NhZ2VGb250Q29sb3IubGVuZ3RoIDwgNgogICAgICAgICAgICAgICAgPyAoCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciArCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvci5zbGljZSgxLCByZXNwb25zZS5kYXRhLlVzZXJNZXNzYWdlRm9udENvbG9yLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgKS5zdWJzdHIoMCwgNykKICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvcjsKICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudXNlcl9tc2dfZm9udF9jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZS5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gImJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IiKVswXS52YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yICE9IG51bGwpewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3IgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3IubGVuZ3RoIDwgNgogICAgICAgICAgICAgICAgPyAoCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvciArCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvci5zbGljZSgxLCByZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgKS5zdWJzdHIoMCwgNykKICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuZGF0YS5Cb3RSZXNwb25zZUZvbnRDb2xvcjsKICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2ZvbnRfY29sb3IgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUuZmlsdGVyKChpdGVtKSA9PiBpdGVtLm5hbWUgPT09ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciIpWzBdLnZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lID0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5CdXR0b25UaGVtZS5sZW5ndGggPCA2CiAgICAgICAgICAgICAgPyAoCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuQnV0dG9uVGhlbWUgKwogICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLkJ1dHRvblRoZW1lLnNsaWNlKAogICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5CdXR0b25UaGVtZS5sZW5ndGgKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKS5zdWJzdHIoMCwgNykKICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuQnV0dG9uVGhlbWU7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Cb3RHcmVldGluZ3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MgPSByZXNwb25zZS5kYXRhLkJvdEdyZWV0aW5nczsKICAgICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzID0gdGhpcy5ib3RfZ3JlZXRpbmdzWwogICAgICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggLSAxCiAgICAgICAgICAgIF0uYnV0dG9uczsKICAgICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLm1hcCgoY3YsIGluZCwgYXJyKSA9PiB7CiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuYm90X2dyZWV0aW5nc1tpbmRdLmJ1dHRvbnM7CiAgICAgICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzW2luZF0uaWQgPSB0aGlzLmdlbmVyYXRlVVVJRCgpOwogICAgICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1tpbmRdLnZpc2libGUgPSB0aGlzLmJvdF9ncmVldGluZ3NbaW5kXS52aXNpYmxlICE9PSB1bmRlZmluZWQgPyAgdGhpcy5ib3RfZ3JlZXRpbmdzW2luZF0udmlzaWJsZSA6IHRydWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS5pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbCiAgICAgICAgICAgICAgICAvLyAgIGkKICAgICAgICAgICAgICAgIC8vIF0udmFsdWUgPSB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0udmFsdWUucmVwbGFjZSgKICAgICAgICAgICAgICAgIC8vICAgdGhpcy5jb21wYW55aWQgKyAiXyIsCiAgICAgICAgICAgICAgICAvLyAgICIiCiAgICAgICAgICAgICAgICAvLyApOwogICAgICAgICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzWwogICAgICAgICAgICAgICAgICBpCiAgICAgICAgICAgICAgICBdLnZhbHVlID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlOwogICAgICAgICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzWwogICAgICAgICAgICAgICAgICBpCiAgICAgICAgICAgICAgICBdLnZhbHVlID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlLnJlcGxhY2UoIi8iLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm90X2ZvbnRfc3R5bGUgPSByZXNwb25zZS5kYXRhLkJvdEZvbnQuRm9udFN0eWxlOwogICAgICAgICAgdGhpcy5ib3RfZm9udF9jb2xvcl9zZW5kZXIgPSByZXNwb25zZS5kYXRhLkJvdEZvbnQuRm9udENvbG9yU2VuZGVyOwogICAgICAgICAgdGhpcy5ib3RfZm9udF9jb2xvcl9yZWNlaXZlciA9IHJlc3BvbnNlLmRhdGEuQm90Rm9udC5Gb250Q29sb3JSZWNlaXZlcjsKICAgICAgICAgIHRoaXMuYm90X2ZvbnRfY29sb3JfYnV0dG9ucyA9IHJlc3BvbnNlLmRhdGEuQm90Rm9udC5Gb250Q29sb3JCdXR0b25zOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuQnV0dG9uU3R5bGluZykgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmhvcml6b250YWxfc3BhY2luZyA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLmhvcml6b250YWw7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLnZlcnRpY2FsOwogICAgICAgICAgfQogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5XaWRnZXRQb3NpdGlvbil7CiAgICAgICAgICAgIHRoaXMuYm90X2FsaWdubWVudCA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0UG9zaXRpb24uYWxpZ247CiAgICAgICAgICAgIHRoaXMuYm90X3ZlcnRpY2FsX3Bvc2l0aW9uID0gcmVzcG9uc2UuZGF0YS5XaWRnZXRQb3NpdGlvbi52ZXJ0aWNhbDsKICAgICAgICAgICAgdGhpcy5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiA9IHJlc3BvbnNlLmRhdGEuV2lkZ2V0UG9zaXRpb24uaG9yaXpvbnRhbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLkJvdFN0eWxpbmcpIHsKICAgICAgICAgICAgdGhpcy5ib3RfYnV0dG9uc19hbGlnbm1lbnQgPSByZXNwb25zZS5kYXRhLkJvdFN0eWxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5IZWFkZXJTdHlsaW5nKSB7CiAgICAgICAgICAgIHRoaXMuYm90X2hlYWRlcl9hbGlnbm1lbnQgPSByZXNwb25zZS5kYXRhLkhlYWRlclN0eWxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5IZWFkZXJUaGVtZSkgewogICAgICAgICAgICB0aGlzLmJvdF9oZWFkZXJfYmFja2dyb3VuZCA9IHJlc3BvbnNlLmRhdGEuSGVhZGVyVGhlbWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsXzMgIT0gIiIpIHsKICAgICAgICAgICAgdGhpcy5ib3RfYmFja2dyb3VuZF90eXBlID0gImltYWdlIjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsID09ICIiKSB7CiAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzIgPSB0aGlzLmZpbGVfbGFiZWxfMjsKICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWxfMiA9PSAiIiB8fCB0aGlzLmZpbGVfbGFiZWxfMiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV8zID0gdGhpcy5maWxlX2xhYmVsXzM7CiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsXzMgPT0gIiIgfHwgdGhpcy5maWxlX2xhYmVsXzMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X29wZW5fYnlfZGVmYXVsdCA9IHJlc3BvbnNlLmRhdGEuQm90T3BlbkJ5RGVmYXVsdDsKICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuaXNfcG93ZXJlZF9ieV9jZW5zZSA9IHJlc3BvbnNlLmRhdGEuSXNQb3dlcmVkQnlDZW5zZSA9PT0gdW5kZWZpbmVkID8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UgOiByZXNwb25zZS5kYXRhLklzUG93ZXJlZEJ5Q2Vuc2U7CiAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF9zaG93bl9vbl93ZWJzaXRlID0gKCByZXNwb25zZS5kYXRhLkJvdFNob3duT25XZWJzaXRlID09IG51bGwgfHwgcmVzcG9uc2UuZGF0YS5Cb3RTaG93bk9uV2Vic2l0ZSA9PSB1bmRlZmluZWQgKSA/IHRydWUgOiByZXNwb25zZS5kYXRhLkJvdFNob3duT25XZWJzaXRlOwogICAgICAgICAgbGV0IGNoYXRfcGFyYW1zID0gewogICAgICAgICAgICBsb2dvOiByZXNwb25zZS5kYXRhLkltYWdlVXJsLAogICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5XaWRnZXRUaXRsZSwKICAgICAgICAgICAgYnV0dG9uX3RoZW1lOiByZXNwb25zZS5kYXRhLkJ1dHRvblRoZW1lLAogICAgICAgICAgICBib3RfdGhlbWU6IHJlc3BvbnNlLmRhdGEuQm90VGhlbWUsCiAgICAgICAgICAgIGJ1dHRvbl9ib3JkZXJfdGhlbWU6IHJlc3BvbnNlLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUsCiAgICAgICAgICAgIHVzZXJfbXNnX2ZvbnRfY29sb3I6IHJlc3BvbnNlLmRhdGEuVXNlck1lc3NhZ2VGb250Q29sb3IsCiAgICAgICAgICAgIGJvdF9yZXNwb25zZV9mb250X2NvbG9yOiByZXNwb25zZS5kYXRhLkJvdFJlc3BvbnNlRm9udENvbG9yLAogICAgICAgICAgICBib3RfaWNvbjogcmVzcG9uc2UuZGF0YS5Cb3RJbWFnZVVybCwKICAgICAgICAgICAgYm90X2JhY2tncm91bmRfaW1hZ2U6IHJlc3BvbnNlLmRhdGEuQmdJbWFnZVVybCwKICAgICAgICAgICAgYnV0dG9uX2hvcml6b250YWxfc3BhY2luZzogcmVzcG9uc2UuZGF0YS5CdXR0b25TdHlsaW5nLmhvcml6b250YWwsCiAgICAgICAgICAgIGJ1dHRvbl92ZXJ0aWNhbF9zcGFjaW5nOiByZXNwb25zZS5kYXRhLkJ1dHRvblN0eWxpbmcudmVydGljYWwsCiAgICAgICAgICAgIGJ1dHRvbl9hbGlnbm1lbnQ6IHJlc3BvbnNlLmRhdGEuQm90U3R5bGluZywKICAgICAgICAgICAgaXNfcG93ZXJlZF9ieV9jZW5zZTogcmVzcG9uc2UuZGF0YS5Jc1Bvd2VyZWRCeUNlbnNlLAogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJDaGF0Qm90SW1hZ2VQYXJhbWV0ZXJzIiwgY2hhdF9wYXJhbXMpOwogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0gcmVzcG9uc2UuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZSA9PT0gbnVsbCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgOiByZXNwb25zZS5kYXRhLkJ1dHRvbkJvcmRlclRoZW1lOwogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yID0gcmVzcG9uc2UuZGF0YS5Vc2VyTWVzc2FnZUZvbnRDb2xvciA9PT0gbnVsbCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IgOiByZXNwb25zZS5kYXRhLlVzZXJNZXNzYWdlRm9udENvbG9yOwogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciA9IHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3IgPT09IG51bGwgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciA6IHJlc3BvbnNlLmRhdGEuQm90UmVzcG9uc2VGb250Q29sb3I7CiAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnNob3dfYm90X2hpc3RvcnkgPSByZXNwb25zZS5kYXRhLlNob3dCb3RIaXN0b3J5ID09PSB1bmRlZmluZWQgPyB0cnVlIDogcmVzcG9uc2UuZGF0YS5TaG93Qm90SGlzdG9yeTsKICAgICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAvLyB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90R3JlZXRpbmdzW3RoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggLSAxXS5idXR0b25zID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzOwogICAgICAgICAgdGhpcy52ZXJpZnlfY2hlY2sgPSB0cnVlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnZlcmlmeV9jaGVjayA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICByZXNldF90b19kZWZhdWx0KHZhbHVlKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVtpXS5uYW1lID09PSB2YWx1ZSkgewogICAgICAgICAgaWYgKHZhbHVlID09PSAiYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl90aGVtZSA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVsKICAgICAgICAgICAgICBpCiAgICAgICAgICAgIF0udmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAiYm90X3N0eWxpbmcuYm90X3RoZW1lIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF90aGVtZSA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVsKICAgICAgICAgICAgICBpCiAgICAgICAgICAgIF0udmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAiYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSIpIHsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy51c2VyX21zZ19mb250X2NvbG9yIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfbXNnX2ZvbnRfY29sb3IgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbCiAgICAgICAgICAgICAgaQogICAgICAgICAgICBdLnZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9mb250X2NvbG9yID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmciKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy52ZXJ0aWNhbF9zcGFjaW5nIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmcgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbCiAgICAgICAgICAgICAgaQogICAgICAgICAgICBdLnZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpc1t2YWx1ZV0gPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbaV0udmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhZGRfYnV0dG9uc19mb3Jfd2lkZ2V0KCkgewogICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIkF0bGVhc3Qgb25lIGdyZWV0aW5nIGlzIHJlcXVpcmVkIHRvIGFkZCBidXR0b24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCB0ZW1wX2lkID0gdGhpcy5nZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLnB1c2goewogICAgICAgIHRpdGxlOiBudWxsLAogICAgICAgIHZhbHVlOiB0aGlzLmludGVudGxpc3RbMF0sCiAgICAgICAgaWQ6IHRlbXBfaWQsCiAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX3dpZGdldF9idXR0b24oYnV0dG9uX2RldCkgewogICAgICBpZiAoYnV0dG9uX2RldC5kaXNhYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlRoaXMgaXMgYSBEZWZhdWx0IEJ1dHRvbi4gWW91IGNhbm5vdCBEZWxldGUgaXQhIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHRlbXBfaW5kZXggPSBudWxsOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLmlkID09IGJ1dHRvbl9kZXQuaWQpIHsKICAgICAgICAgICAgdGVtcF9pbmRleCA9IGk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5zcGxpY2UodGVtcF9pbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQoZSkgewogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgYW4gSW1hZ2Ugb2YgdHlwZSBQTkcgb3IgSlBFRyIpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0MihlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIGxlc3MgdGhhbiAyTUIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9wbmciIHx8IGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV8yID0gdGhpcy5maWxlX2xhYmVsXzI7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzIgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UyKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgYW4gSW1hZ2Ugb2YgdHlwZSBQTkcgb3IgSlBFRyIpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0MyhlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIGxlc3MgdGhhbiAyTUIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9wbmciIHx8IGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICghdGhpcy5pc19iZ19pbWFnZV9jaGFuZ2VkKSB7CiAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzMgPSB0aGlzLmZpbGVfbGFiZWxfMzsKICAgICAgICB9CiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzMgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UzKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgYW4gSW1hZ2Ugb2YgdHlwZSBQTkcgb3IgSlBFRyIpOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2UoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBjcmVhdGVJbWFnZTIoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZV8yID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGNyZWF0ZUltYWdlMyhmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgdGhpcy5pbWFnZV9maWxlXzMgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgdXBsb2FkX2ltYWdlKCkgewogICAgICBpZih0aGlzLmJvdF92ZXJ0aWNhbF9wb3NpdGlvbiA+IDE1MCl7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiWW91IGNhbiBub3Qgc2VsZWN0IHZlcnRpY2FsIHBvc2l0aW9uIGZyb20gYm90dG9tIGdyZWF0ZXIgdGhhbiAxNTAgcGl4ZWwiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYodGhpcy5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiA+IDMyKXsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJZb3UgY2FuIG5vdCBzZWxlY3QgaG9yaXpvbnRhbCBwb3NpdGlvbiBncmVhdGVyIHRoYW4gMzIgcGl4ZWwiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYm90X2hlYWRlcl9hbGlnbm1lbnQgPT09IG51bGwpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IEhlYWRlciBBbGlnbm1lbnQiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJvdF9idXR0b25zX2FsaWdubWVudCA9PT0gbnVsbCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBTZWxlY3QgQnV0dG9ucyBBbGlnbm1lbnQiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgIT0gdGhpcy5vbGRfaW1hZ2VfbmFtZSAmJgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPT0gIiIKICAgICAgKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IEEgRmlsZSIpOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lICYmCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9PSAiIgogICAgICApIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBTZWxlY3QgQSBGaWxlIik7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5maWxlX2xhYmVsICE9IHRoaXMub2xkX2ltYWdlX25hbWUgJiYKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID09ICIiCiAgICAgICkgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIFNlbGVjdCBBIEZpbGUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy53aWRnZXRfc2V0dGluZ191cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIHdpZGdldF90aXRsZTogdGhpcy50aXRsZSwKICAgICAgICAgICAgICBpc0ltYWdlRWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgIGlzQm90SW1hZ2VFZGl0OgogICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzIgIT0gdGhpcy5vbGRfaW1hZ2VfbmFtZV8yID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgIGltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbCwKICAgICAgICAgICAgICB3aWRnZXRfaW1hZ2U6IHRoaXMuaW1hZ2VfZmlsZSwKICAgICAgICAgICAgICBvbGRfaW1hZ2VfbmFtZToKICAgICAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPT0gIkNob29zZSBGaWxlIgogICAgICAgICAgICAgICAgICA/IG51bGwKICAgICAgICAgICAgICAgICAgOiB0aGlzLm9sZF9pbWFnZV9uYW1lLAogICAgICAgICAgICAgIGlzRWRpdDogdHJ1ZSwKCiAgICAgICAgICAgICAgYm90X2ltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbF8yLAogICAgICAgICAgICAgIG9sZF9ib3RfaW1hZ2VfbmFtZToKICAgICAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMiA9PSAiQ2hvb3NlIEZpbGUiCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMub2xkX2ltYWdlX25hbWVfMiwKICAgICAgICAgICAgICBib3RfaW1hZ2U6IHRoaXMuaW1hZ2VfZmlsZV8yLAogICAgICAgICAgICAgIG9sZF9iZ19pbWFnZV9uYW1lOgogICAgICAgICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV8zID09ICJDaG9vc2UgRmlsZSIgJiYKICAgICAgICAgICAgICAgICF0aGlzLmlzX2JnX2ltYWdlX2NoYW5nZWQKICAgICAgICAgICAgICAgICAgPyBudWxsCiAgICAgICAgICAgICAgICAgIDogdGhpcy5vbGRfaW1hZ2VfbmFtZV8zLAogICAgICAgICAgICAgIGJnX2ltYWdlOgogICAgICAgICAgICAgICAgdGhpcy5ib3RfYmFja2dyb3VuZF90eXBlID09PSAibm9uZSIKICAgICAgICAgICAgICAgICAgPyAiTm9faW1hZ2UiCiAgICAgICAgICAgICAgICAgIDogdGhpcy5pbWFnZV9maWxlXzMsCiAgICAgICAgICAgICAgYmdfaW1hZ2VfbmFtZTogdGhpcy5maWxlX2xhYmVsXzMsCiAgICAgICAgICAgICAgaXNCZ0ltYWdlRWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zICE9IHRoaXMub2xkX2ltYWdlX25hbWVfMyB8fAogICAgICAgICAgICAgICAgdGhpcy5ib3RfYmFja2dyb3VuZF90eXBlID09PSAibm9uZSIKICAgICAgICAgICAgICAgICAgPyB0cnVlCiAgICAgICAgICAgICAgICAgIDogZmFsc2UsCiAgICAgICAgICAgICAgaGVhZGVyX3RoZW1lOiB0aGlzLmJvdF9oZWFkZXJfYmFja2dyb3VuZCwKICAgICAgICAgICAgICBoZWFkZXJfY3VzdG9tX3N0eWxlOiB0aGlzLmJvdF9oZWFkZXJfYWxpZ25tZW50LAogICAgICAgICAgICAgIGJvdF90aGVtZTogdGhpcy5ib3Rfc3R5bGluZy5ib3RfdGhlbWUsCiAgICAgICAgICAgICAgYnV0dG9uX2JvcmRlcl90aGVtZTogdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lLAogICAgICAgICAgICAgIHVzZXJfbXNnX2ZvbnRfY29sb3I6IHRoaXMuYm90X3N0eWxpbmcudXNlcl9tc2dfZm9udF9jb2xvciwKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZm9udF9jb2xvcjogdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfZm9udF9jb2xvciwKICAgICAgICAgICAgICBidXR0b25fdGhlbWU6IHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lLAogICAgICAgICAgICAgIGJvdF9jdXN0b21fc3R5bGU6IHRoaXMuYm90X2J1dHRvbnNfYWxpZ25tZW50LAogICAgICAgICAgICAgIGJvdF9mb250OiB7CiAgICAgICAgICAgICAgICBGb250U3R5bGU6IHRoaXMuYm90X2ZvbnRfc3R5bGUsCiAgICAgICAgICAgICAgICBGb250Q29sb3JTZW5kZXI6IHRoaXMuYm90X2ZvbnRfY29sb3Jfc2VuZGVyLAogICAgICAgICAgICAgICAgRm9udENvbG9yUmVjZWl2ZXI6IHRoaXMuYm90X2ZvbnRfY29sb3JfcmVjZWl2ZXIsCiAgICAgICAgICAgICAgICBGb250Q29sb3JCdXR0b25zOiB0aGlzLmJvdF9mb250X2NvbG9yX2J1dHRvbnMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJvdF9wb3NpdGlvbjogewogICAgICAgICAgICAgICAgYWxpZ246IHRoaXMuYm90X2FsaWdubWVudCwKICAgICAgICAgICAgICAgIHZlcnRpY2FsOiB0aGlzLmJvdF92ZXJ0aWNhbF9wb3NpdGlvbiwKICAgICAgICAgICAgICAgIGhvcml6b250YWw6IHRoaXMuYm90X2hvcml6b250YWxfcG9zaXRpb24sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBidXR0b25fY3VzdG9tX3N0eWxlOiB7CiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogdGhpcy5ib3Rfc3R5bGluZy52ZXJ0aWNhbF9zcGFjaW5nLAogICAgICAgICAgICAgICAgaG9yaXpvbnRhbDogdGhpcy5ib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmcsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBib3Rfb3Blbl9ieV9kZWZhdWx0OiB0aGlzLmJvdF9zdHlsaW5nLmJvdF9vcGVuX2J5X2RlZmF1bHQsCiAgICAgICAgICAgICAgYm90X3Nob3duX29uX3dlYnNpdGU6IHRoaXMuYm90X3N0eWxpbmcuYm90X3Nob3duX29uX3dlYnNpdGUsCiAgICAgICAgICAgICAgaXNfcG93ZXJlZF9ieV9jZW5zZTogdGhpcy5ib3Rfc3R5bGluZy5pc19wb3dlcmVkX2J5X2NlbnNlLAogICAgICAgICAgICAgIHNob3dfYm90X2hpc3Rvcnk6IHRoaXMuYm90X3N0eWxpbmcuc2hvd19ib3RfaGlzdG9yeSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiRHVwbGljYXRlIGltYWdlIikgewogICAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICAvLyAgICJJbWFnZSBhbHJlYWR5IGZvdW5kLiBQbGVhc2UgdXBsb2FkIGFub3RoZXIgaW1hZ2Ugb3IgcmVuYW1lIGl0LiIKICAgICAgICAgICAgICAvLyApOwogICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAgICAgIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJXaWRnZXQgU2V0dGluZ3MgYWRkZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgU2V0dGluZ3MgaGF2ZSBiZWVuIFVwZGF0ZWQgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc3VibWl0X2dyZWV0aW5ncygpIHsKICAgICAgIGZvcihsZXQgZGF0YT0wO2RhdGE8IHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5sZW5ndGg7ZGF0YSsrKXsKICAgICAgICAgIGlmKHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tkYXRhXS50aXRsZS5sZW5ndGggPiAyMCkKICAgICAgICAgIHsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiVGl0bGUgb2YgYnV0dG9uIHNob3VsZCBub3QgYmUgbW9yZSB0aGFuIDIwIGNoYXJhY3RlciIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgIHRpbWVyOiA1MDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgfQogICAgICB2YXIgaW50ZW50X3ZhbHMgPSB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMuZmlsdGVyKAogICAgICAgICh2YWwpID0+IHZhbC52YWx1ZSA9PT0gbnVsbCB8fCB2YWwudGl0bGUgPT09IG51bGwKICAgICAgKTsKICAgICAgaWYgKGludGVudF92YWxzLmxlbmd0aCA+IDApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IEludGVudCBmb3IgYSBidXR0b24iLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgd2lkZ2V0X2RldGFpbHMgPSBKU09OLnBhcnNlKAogICAgICAgIEpTT04uc3RyaW5naWZ5KHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscykKICAgICAgKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aWRnZXRfZGV0YWlscy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlID0KICAgICAgICAvLyAgICIvIiArIHRoaXMuY29tcGFueWlkICsgIl8iICsgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWUgPQogICAgICAgICAgIi8iICsgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgLy8gaWYgKHRoaXMuZGVmYXVsdF9yZXRhaWxfZ3JlZXRpbmdzLmluY2x1ZGVzKHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlKSkgewogICAgICAgIC8vICAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWUgPSAiLyIgKyAgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAvLyAgIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlID0KICAgICAgICAvLyAgICAgIi8iICsgdGhpcy5jb21wYW55aWQgKyAiXyIgKyB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZTsKICAgICAgICAvLyB9CiAgICAgIH0KICAgICAgaWYgKHdpZGdldF9kZXRhaWxzLmxlbmd0aCA+IDApIHsKICAgICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGZvciAobGV0IGk9MDsgaSA8IHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuYm90X2dyZWV0aW5nc1tpXS5idXR0b25zOyAKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1sKICAgICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aCAtIDEKICAgICAgICAgIF0uYnV0dG9ucyA9IHdpZGdldF9kZXRhaWxzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MucHVzaCh7CiAgICAgICAgICAgIGJ1dHRvbnM6IHdpZGdldF9kZXRhaWxzLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGVkaXRfZ3JlZXRpbmdzOiB0cnVlLAogICAgICAgICAgICBib3RfZ3JlZXRpbmdzOiB0aGlzLmJvdF9ncmVldGluZ3MsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIldpZGdldCBTZXR0aW5ncyBhZGRlZCBzdWNjZXNzZnVsbHkiKSB7IAogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBTZXR0aW5ncyBoYXZlIGJlZW4gVXBkYXRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmdldF93aWRnZXRfc2V0dGluZ3MoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZ2VuZXJhdGVVVUlEKCkgewogICAgICAvLyBQdWJsaWMgRG9tYWluL01JVAogICAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyAvL1RpbWVzdGFtcAogICAgICB2YXIgZDIgPQogICAgICAgIChwZXJmb3JtYW5jZSAmJiBwZXJmb3JtYW5jZS5ub3cgJiYgcGVyZm9ybWFuY2Uubm93KCkgKiAxMDAwKSB8fCAwOyAvL1RpbWUgaW4gbWljcm9zZWNvbmRzIHNpbmNlIHBhZ2UtbG9hZCBvciAwIGlmIHVuc3VwcG9ydGVkCiAgICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKAogICAgICAgIC9beHldL2csCiAgICAgICAgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2OyAvL3JhbmRvbSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxNgogICAgICAgICAgaWYgKGQgPiAwKSB7CiAgICAgICAgICAgIC8vVXNlIHRpbWVzdGFtcCB1bnRpbCBkZXBsZXRlZAogICAgICAgICAgICByID0gKGQgKyByKSAlIDE2IHwgMDsKICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgaWYgc3VwcG9ydGVkCiAgICAgICAgICAgIHIgPSAoZDIgKyByKSAlIDE2IHwgMDsKICAgICAgICAgICAgZDIgPSBNYXRoLmZsb29yKGQyIC8gMTYpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIChjID09PSAieCIgPyByIDogKHIgJiAweDMpIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgICAgfQogICAgICApOwogICAgfSwKICAgIGNoZWNrX2FjdGl2ZV9idG5fZm9yX2dyZWV0aW5nKGlkKSB7CiAgICAgIGxldCBidG5fZ3JlZXRpbmdzX3N0YXR1cyA9IHRoaXMuZ2V0X2J0bl9ncmVldGluZ192aXNpYmxlX3N0YXR1cygpOwogICAgICBpZigoYnRuX2dyZWV0aW5nc19zdGF0dXNbMF0gPT09IHRydWUpICYmIChidG5fZ3JlZXRpbmdzX3N0YXR1c1sxXSA9PT0gZmFsc2UpKXsKICAgICAgICB0aGlzLm9uZV9ncmVldGluZ19zd2FsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1t0aGlzLmJvdF9ncmVldGluZ3MuZmluZEluZGV4KGkgPT4gaS5pZCA9PT0gaWQpXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZ3JlZXRpbmdzX2tleSArPTE7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2hlY2tfb25lX2dyZWV0aW5nX2VuYWJsZWQoaWQpewogICAgICBsZXQgYnRuX2dyZWV0aW5nc19zdGF0dXMgPSB0aGlzLmdldF9idG5fZ3JlZXRpbmdfdmlzaWJsZV9zdGF0dXMoKTsKICAgICAgaWYoKGJ0bl9ncmVldGluZ3Nfc3RhdHVzWzBdID09PSB0cnVlKSAmJiAoYnRuX2dyZWV0aW5nc19zdGF0dXNbMV0gPT09IGZhbHNlKSl7CiAgICAgICAgdGhpcy5vbmVfZ3JlZXRpbmdfc3dhbCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLmZpbmRJbmRleChpID0+IGkuaWQgPT09IGlkKV0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy5idXR0b25zX2tleSArPTE7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2V0X2J0bl9ncmVldGluZ192aXNpYmxlX3N0YXR1cygpewogICAgICByZXR1cm4gW3RoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5tYXAoaXRlbSA9PiB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmlzaWJsZQogICAgICB9KS5pbmNsdWRlcyh0cnVlKSwgCiAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5tYXAoaXRlbSA9PiB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmlzaWJsZQogICAgICB9KS5pbmNsdWRlcyh0cnVlKV07CiAgICB9LAogICAgb25lX2dyZWV0aW5nX3N3YWwoKXsKICAgICAgc3dhbCh7CiAgICAgICAgdGV4dDogIkF0bGVhc3Qgb25lIGdyZWV0aW5nIGlzIHJlcXVpcmVkIGZvciBhIGJ1dHRvbiB0byBiZSB2aXNpYmxlISEiLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgdGltZXI6IDU1MDAsCiAgICAgIH0pOwogICAgfQogIH0sCn07Cgo="},null]}