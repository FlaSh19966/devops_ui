{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Settings/Miscellaneous.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Settings/Miscellaneous.vue","mtime":1643027096180},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBWdWUgZnJvbSAidnVlIjsKaW1wb3J0IEpzb25FeGNlbCBmcm9tICJ2dWUtanNvbi1leGNlbCI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBWb2Vycm9UYWdzSW5wdXQgZnJvbSAiQHZvZXJyby92dWUtdGFnc2lucHV0IjsKaW1wb3J0ICJAdm9lcnJvL3Z1ZS10YWdzaW5wdXQvZGlzdC9zdHlsZS5jc3MiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBCaWxsaW5nIGZyb20gIi4uL0FjY291bnQvQmlsbGluZy52dWUiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmltcG9ydCBGZWVkYmFjayBmcm9tICIuL0ZlZWRiYWNrLnZ1ZSI7CmltcG9ydCBJbnRlZ3JhdGlvbkxheW91dCBmcm9tICIuLi9JbnRlZ3JhdGlvbnMvSW50ZWdyYXRpb25MYXlvdXQudnVlIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwppbXBvcnQgVnVlUGhvbmVOdW1iZXJJbnB1dCBmcm9tICd2dWUtcGhvbmUtbnVtYmVyLWlucHV0JzsKaW1wb3J0ICd2dWUtcGhvbmUtbnVtYmVyLWlucHV0L2Rpc3QvdnVlLXBob25lLW51bWJlci1pbnB1dC5jc3MnOwppbXBvcnQgeyBidXMgfSBmcm9tICJAL3BvcnRhbC9tYWluIjsKClZ1ZS5jb21wb25lbnQoImRvd25sb2FkRXhjZWwiLCBKc29uRXhjZWwpOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk1pc2NlbGxhbmVvdXNQYWdlIiwKICBtaXhpbnM6IFtmcmVlemVfcG9ydGFsLCBzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWxdLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0LAogICAgInRhZ3MtaW5wdXQiOiBWb2Vycm9UYWdzSW5wdXQsCiAgICBCaWxsaW5nLAogICAgRmVlZGJhY2ssCiAgICBJbnRlZ3JhdGlvbkxheW91dCwKICAgIFZ1ZVBob25lTnVtYmVySW5wdXQsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlld19jb21wb25lbnRfbmFtZTogIm90aGVycyIsCiAgICAgIC8vIHN0YXJ0X2dyZWV0aW5nczogIiIsCiAgICAgIC8vIGVuZF9ncmVldGluZ3M6ICIiLAogICAgICB0aXRsZTogIiIsCiAgICAgIGltYWdlX2ZpbGU6IG51bGwsCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIHNlbmRlcjogbnVsbCwKICAgICAgc3ViamVjdDogbnVsbCwKICAgICAgZW1haWxfYm9keTogbnVsbCwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgbXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdDogW10sCiAgICAgIHBob25lTnVtYmVyOiBudWxsLAogICAgICBjb250YWN0X3VzX3Bob25lX251bWJlcjogbnVsbCwKICAgICAgY29udGFjdF91c19lbWFpbDogIiIsCiAgICAgIGVtYWlsX3ZhbGlkaXR5OgogICAgICAgIC9eKFswLTlhLXpBLVpdKFstLlx3XSpbMC05YS16QS1aXSkqQChbMC05YS16QS1aXVstXHddKlswLTlhLXpBLVpdXC4pK1thLXpBLVpdezIsOX0pJC8sCiAgICAgIGlzX3JldGFpbDogZmFsc2UsCiAgICAgIG9sZF9pbWFnZV9uYW1lOiBudWxsLAogICAgICBzcGlubmVyT24xOiBmYWxzZSwKICAgICAgc3Bpbm5lck9uMjogZmFsc2UsCiAgICAgIGJpZ19zcGlubmVyOiBmYWxzZSwKICAgICAgdHJhaW5lZF9kaWFsb2d1ZV9tb2RlbHM6IG51bGwsCiAgICAgIHRyYWluZWRfaW50ZW50X21vZGVsczogbnVsbCwKICAgICAgY3VycmVudF9saWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICB0cmFpbmVkX25lcl9tb2RlbHM6IG51bGwsCiAgICAgIGRpc2FibGVfYnRuX2V4cGlyZWQ6ZmFsc2UsCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIGlmICh0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQogICAgLy8gYXhpb3MKICAgIC8vICAgLnBvc3QoCiAgICAvLyAgICAgYXBpX2NhbGxzLnR3aWxpb19ncmVldGluZ3MoKSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAvLyAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgaXNTaG93OiB0cnVlCiAgICAvLyAgICAgfSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfQogICAgLy8gICApCiAgICAvLyAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgIC8vICAgICB0aGlzLnN0YXJ0X2dyZWV0aW5ncyA9IHJlc3BvbnNlLmRhdGEuZ3JlZXRpbmc7CiAgICAvLyAgICAgdGhpcy5lbmRfZ3JlZXRpbmdzID0gcmVzcG9uc2UuZGF0YS5idXN5OwogICAgLy8gICB9KQogICAgLy8gICAuY2F0Y2goZSA9PiB7CiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICkgewogICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJHNlc3Npb24uc2V0KCJDdXJyZW50QWN0aXZlVGFiRm9ySGVscCIsIHRoaXMudmlld19jb21wb25lbnRfbmFtZSkKICAgIC8vY29uc29sZS5sb2codGhpcy52aWV3X2NvbXBvbmVudF9uYW1lLCJjb21wIG5hbWUiKTsKICAgICAgYnVzLiRvbigiQ3VycmVudEFjdGl2ZVRhYiIsIChkYXRhKSA9PiB7CiAgICAgICAgaWYoZGF0YSA9PT0gdGhpcy4kcm91dGUuZnVsbFBhdGgpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coIkhlbGxvIix0aGlzLiRyb3V0ZSk7CiAgICAgICAgICByZXR1cm4gdGhpcy52aWV3X2NvbXBvbmVudF9uYW1lOwogICAgICAgICAgLy8gYnVzLiRlbWl0KCJDdXJycmVudEFjdGl2ZVRhYlJlc3BvbnNlIiwgdGhpcy52aWV3X2NvbXBvbmVudF9uYW1lKQogICAgICAgIH0KICAgICAgfSk7CiAgICBpZih0aGlzLmlzX3JldGFpbCAhPSB0cnVlKXsKICAgICAgdGhpcy5sb2FkX3Byb2R1Y3Rfc2V0dGluZ3MoKTsKICAgIH0KICAgIGxldCBib3RfdGVtcGxhdGVzX2RhdGEgPSB0aGlzLiRzZXNzaW9uLmdldCgiQm90VGVtcGxhdGVzIik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJvdF90ZW1wbGF0ZXNfZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBpZiAoCiAgICAgICAgYm90X3RlbXBsYXRlc19kYXRhW2ldLmRvbWFpbiA9PT0gIlJldGFpbCIgJiYKICAgICAgICBib3RfdGVtcGxhdGVzX2RhdGFbaV0uc3Vic2NyaWJlZCA9PT0gdHJ1ZQogICAgICApIHsKICAgICAgICB0aGlzLmlzX3JldGFpbCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk1pc2NlbGxhbmVvdXNQYWdlRGlzYWJsZWQiLCAoZGF0YSkgPT4gewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbigiYWNjb3VudFBhZ2UiLCAoZGF0YSkgPT4gewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgICQoIiNhY2NvdW50cy10YWIiKS5jbGljaygpOwogICAgICAgIHRoaXMudmlld19jb21wb25lbnRfbmFtZSA9ICJhY2NvdW50cyI7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5pbml0aWFsaXplX3Rvb2x0aXBzKCk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgdGhpcy5nZXRfdHJhaW5lZF9kaWFsb2d1ZV9tb2RlbHMoKTsKICAgIHRoaXMuZ2V0X3RyYWluZWRfaW50ZW50X21vZGVscygpOwogICAgdGhpcy5nZXRfdHJhaW5lZF9uZXJfbW9kZWxzKCk7CiAgICB0aGlzLmdldF9jb21wYW55X2xvZ28oKTsKICAKICBpZiAodGhpcy4kcm91dGUucGFyYW1zLlN1YnNjcmlwdGlvbiA9PT0gdHJ1ZSkgewogICAgICAkKCIjYWNjb3VudHMtdGFiIikuY2xpY2soKTsKICAgICAgdGhpcy52aWV3X2NvbXBvbmVudF9uYW1lID0gImFjY291bnRzIjsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICB2YWxpZEVtYWlsKCkgewogICAgICBpZiAodGhpcy5jb250YWN0X3VzX2VtYWlsICE9IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5lbWFpbF92YWxpZGl0eS50ZXN0KHRoaXMuY29udGFjdF91c19lbWFpbCkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gIlBsZWFzZSBlbnRlciBhIHZhbGlkIEVtYWlsIEFkZHJlc3MiOwogICAgICAgIH0KICAgICAgfQogIH0KfSwKICB3YXRjaDogewogICAgdmlld19jb21wb25lbnRfbmFtZShuZXdWYWwpIHsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQ3VycmVudEFjdGl2ZVRhYkZvckhlbHAiLCBuZXdWYWwpCiAgICAgIH0sCiAgICBib3RfYmFja2dyb3VuZF90eXBlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIGlmIChuZXdWYWwgPT09ICJub25lIikgewogICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zID0gIkNob29zZSBGaWxlIjsKICAgICAgICB0aGlzLmltYWdlX2ZpbGVfMyA9IG51bGw7CiAgICAgICAgdGhpcy5pc19iZ19pbWFnZV9jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAvLyB0aGlzLm9sZF9pbWFnZV9uYW1lXzMgPSBudWxsOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAzIikudmFsdWUgPSAiIjsKICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZ2VuZXJhdGVVVUlEKCkgewogICAgICAvLyBQdWJsaWMgRG9tYWluL01JVAogICAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyAvL1RpbWVzdGFtcAogICAgICB2YXIgZDIgPQogICAgICAgIChwZXJmb3JtYW5jZSAmJiBwZXJmb3JtYW5jZS5ub3cgJiYgcGVyZm9ybWFuY2Uubm93KCkgKiAxMDAwKSB8fCAwOyAvL1RpbWUgaW4gbWljcm9zZWNvbmRzIHNpbmNlIHBhZ2UtbG9hZCBvciAwIGlmIHVuc3VwcG9ydGVkCiAgICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKAogICAgICAgIC9beHldL2csCiAgICAgICAgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHZhciByID0gTWF0aC5yYW5kb20oKSAqIDE2OyAvL3JhbmRvbSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxNgogICAgICAgICAgaWYgKGQgPiAwKSB7CiAgICAgICAgICAgIC8vVXNlIHRpbWVzdGFtcCB1bnRpbCBkZXBsZXRlZAogICAgICAgICAgICByID0gKGQgKyByKSAlIDE2IHwgMDsKICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIG1pY3Jvc2Vjb25kcyBzaW5jZSBwYWdlLWxvYWQgaWYgc3VwcG9ydGVkCiAgICAgICAgICAgIHIgPSAoZDIgKyByKSAlIDE2IHwgMDsKICAgICAgICAgICAgZDIgPSBNYXRoLmZsb29yKGQyIC8gMTYpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIChjID09PSAieCIgPyByIDogKHIgJiAweDMpIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgICAgfQogICAgICApOwogICAgfSwKICAgIHRyaW1fbW9kZWxfbmFtZSh2YWwxKSB7CiAgICAgIGlmICh2YWwxLmxlbmd0aCA+IDYpIHsKICAgICAgICBsZXQgc3RyMSA9IHZhbDEuc3Vic3RyaW5nKDAsIDMpICsgIi4uLiI7CiAgICAgICAgcmV0dXJuIHN0cjE7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbDE7CiAgICB9LAogICAgbG9hZF9wcm9kdWN0X3NldHRpbmdzKCkgewogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5wcm9kdWN0X3NldHRpbmdzKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vbl9yZXRhaWw6IHRydWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhICE9ICIiICYmCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgIT0gbnVsbCAmJgogICAgICAgICAgICByZXNwb25zZS5kYXRhICE9ICJJbnRlcm5hbCBzZXJ2ZXIgRXJyb3IiCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy5jb250YWN0X3VzX2VtYWlsID0gcmVzcG9uc2UuZGF0YS5kZXRhaWxzLmNvbnRhY3RfaGVscF9lbWFpbDsKICAgICAgICAgICAgdGhpcy5jb250YWN0X3VzX3Bob25lX251bWJlciA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kZXRhaWxzLmNvbnRhY3RfdXNfcGhvbmVfbnVtYmVyOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIik7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRfY29tcGFueV9sb2dvKCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLnVwbG9hZF9jb21wYW55X2xvZ28oKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSByZXNwb25zZS5kYXRhLmNvbXBhbnlfaW1hZ2VfdXJsCiAgICAgICAgICAgIC5zcGxpdCgiLyIpCiAgICAgICAgICAgIC5yZXZlcnNlKClbMF07CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSBkZWNvZGVVUkkodGhpcy5maWxlX2xhYmVsKTsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsID09ICIiKSB7CiAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dF9jb21wYW55X2ZpbGUiKS52YWx1ZSA9ICIiOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgdXBsb2FkX2NvbXBhbnlfbG9nb19maWxlKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5maWxlX2xhYmVsID09IHRoaXMub2xkX2ltYWdlX25hbWUgfHwKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRfY29tcGFueV9maWxlIikudmFsdWUgPT0gIiIKICAgICAgKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFNlbGVjdCBhIEZpbGUiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnVwbG9hZF9jb21wYW55X2xvZ28oKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaW1hZ2VfbmFtZTogdGhpcy5maWxlX2xhYmVsLAogICAgICAgICAgICAgIGNvbXBhbnlfbG9nb19maWxlOiB0aGlzLmltYWdlX2ZpbGUsCiAgICAgICAgICAgICAgaXNfaW1hZ2VfZWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgICAgICAgIG9sZF9pbWFnZV9uYW1lOgogICAgICAgICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZSA9PSAiQ2hvb3NlIEZpbGUiCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMub2xkX2ltYWdlX25hbWUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmdldF9jb21wYW55X2xvZ28oKTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJEdXBsaWNhdGUgaW1hZ2UiKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0X2NvbXBhbnlfZmlsZSIpLnZhbHVlID0gIiI7CiAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKAogICAgICAgICAgICAgIC8vICAgIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIgogICAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiSW1hZ2UgYWxyZWFkeSBmb3VuZC4gUGxlYXNlIHVwbG9hZCBhbm90aGVyIGltYWdlIG9yIHJlbmFtZSBpdC4iLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuTVNHID09ICJDb21wYW55IExvZ28gVXBsb2FkZWQgU3VjY2Vzc2Z1bGx5IgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJDb21wYW55IExvZ28gaGF2ZSBiZWVuIFVwbG9hZGVkIFN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRfY29tcGFueV9maWxlIikudmFsdWUgPSAiIjsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZ2V0X2NvbXBhbnlfbG9nbygpOwogICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjb25maWd1cmVfcHJvZHVjdF9zZXR0aW5ncygpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaWYgKHRoaXMudmFsaWRFbWFpbCAhPSB0cnVlKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgRW1haWwgQWRkcmVzcyIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCFCb29sZWFuKHRoaXMucGhvbmVOdW1iZXIpKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgUGhvbmUgTnVtYmVyIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBob25lTnVtYmVyLmlzVmFsaWQgIT0gdHJ1ZSkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhIHZhbGlkIFBob25lIE51bWJlciIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZW1haWxfcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vbl9yZXRhaWw6IHRydWUsCiAgICAgICAgICAgIGVtYWlsX3JlcXVpcmVkOiB7CiAgICAgICAgICAgICAgY29udGFjdF9oZWxwX2VtYWlsOiB0aGlzLmNvbnRhY3RfdXNfZW1haWwsCiAgICAgICAgICAgICAgY29udGFjdF91c19waG9uZV9udW1iZXI6IHRoaXMucGhvbmVOdW1iZXIuZm9ybWF0dGVkTnVtYmVyLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJZb3VyIGNoYW5nZXMgaGF2ZSBiZWVuIHNhdmVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiA0MDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICB0aGlzLmxvYWRfcHJvZHVjdF9zZXR0aW5ncygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZC4iKTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGJ1dHRvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAodGhpcy5tdWx0aXBsZV9sYW5ndWFnZV9saXN0Lmxlbmd0aCAhPSAwKSB7CiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFtpbmRleF0uRW5hYmxlZCA9PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gImJ1dHRvbl9lbmFibGVkIjsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFtpbmRleF0uRW5hYmxlZCA9PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuICJidXR0b25fZGlzYWJsZWQiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gImJ1dHRvbl9kaXNhYmxlZCI7CiAgICAgIH0KICAgIH0sCiAgICBtdWx0aXBsZV9sYW5ndWFnZV9zdHlsZSgpIHt9LAogICAgbXVsdGlwbGVfbGFuZ3VhZ2VfYXBpKGxhbmd1YWdlLCBpbmRleCkgewogICAgICBsZXQgYnV0dG9uX2NsYXNzOwogICAgICBpZiAobGFuZ3VhZ2UgIT0gImFsbCIpIHsKICAgICAgICBidXR0b25fY2xhc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsYW5ndWFnZSArICJfYnV0dG9uIikuY2xhc3NMaXN0OwogICAgICAgIGlmIChidXR0b25fY2xhc3MuY29udGFpbnMoImJ1dHRvbl9kaXNhYmxlZCIpKSB7CiAgICAgICAgICBidXR0b25fY2xhc3MucmVtb3ZlKCJidXR0b25fZGlzYWJsZWQiKTsKICAgICAgICAgIGJ1dHRvbl9jbGFzcy5hZGQoImJ1dHRvbl9lbmFibGVkIik7CiAgICAgICAgICB0aGlzLm11bHRpcGxlX2xhbmd1YWdlX2xpc3RbaW5kZXhdLkVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5sYW5ndWFnZV9zdXBwb3J0X2FwaSgpOwogICAgICAgIH0gZWxzZSBpZiAoYnV0dG9uX2NsYXNzLmNvbnRhaW5zKCJidXR0b25fZW5hYmxlZCIpKSB7CiAgICAgICAgICBidXR0b25fY2xhc3MucmVtb3ZlKCJidXR0b25fZW5hYmxlZCIpOwogICAgICAgICAgYnV0dG9uX2NsYXNzLmFkZCgiYnV0dG9uX2Rpc2FibGVkIik7CiAgICAgICAgICB0aGlzLm11bHRpcGxlX2xhbmd1YWdlX2xpc3RbaW5kZXhdLkVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMubGFuZ3VhZ2Vfc3VwcG9ydF9hcGkoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2UgPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIGRvY3VtZW50CiAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZCgiZW5nbGlzaF9idXR0b24iKQogICAgICAgICAgICAuY2xhc3NMaXN0LmFkZCgiYnV0dG9uX2VuYWJsZWQiKTsKICAgICAgICAgIGRvY3VtZW50CiAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZCgiZW5nbGlzaF9idXR0b24iKQogICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZSgiYnV0dG9uX2Rpc2FibGVkIik7CiAgICAgICAgICBkb2N1bWVudAogICAgICAgICAgICAuZ2V0RWxlbWVudEJ5SWQoImhpbmRpX2J1dHRvbiIpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJidXR0b25fZW5hYmxlZCIpOwogICAgICAgICAgZG9jdW1lbnQKICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKCJoaW5kaV9idXR0b24iKQogICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZSgiYnV0dG9uX2Rpc2FibGVkIik7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFswXS5FbmFibGVkICYmCiAgICAgICAgICAgIHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFsxXS5FbmFibGVkCiAgICAgICAgICApIHsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5tdWx0aXBsZV9sYW5ndWFnZV9saXN0KSB7CiAgICAgICAgICAgICAgdGhpcy5tdWx0aXBsZV9sYW5ndWFnZV9saXN0W2ldLkVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2Vfc3VwcG9ydF9hcGkoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgZG9jdW1lbnQKICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKCJlbmdsaXNoX2J1dHRvbiIpCiAgICAgICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKCJidXR0b25fZW5hYmxlZCIpOwogICAgICAgICAgZG9jdW1lbnQKICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKCJlbmdsaXNoX2J1dHRvbiIpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJidXR0b25fZGlzYWJsZWQiKTsKICAgICAgICAgIGRvY3VtZW50CiAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZCgiaGluZGlfYnV0dG9uIikKICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoImJ1dHRvbl9lbmFibGVkIik7CiAgICAgICAgICBkb2N1bWVudAogICAgICAgICAgICAuZ2V0RWxlbWVudEJ5SWQoImhpbmRpX2J1dHRvbiIpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJidXR0b25fZGlzYWJsZWQiKTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgIXRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFswXS5FbmFibGVkICYmCiAgICAgICAgICAgICF0aGlzLm11bHRpcGxlX2xhbmd1YWdlX2xpc3RbMV0uRW5hYmxlZAogICAgICAgICAgKSB7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdCkgewogICAgICAgICAgICAgIHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdFtpXS5FbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5sYW5ndWFnZV9zdXBwb3J0X2FwaSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdF90cmFpbmVkX2RpYWxvZ3VlX21vZGVsKGluZGV4KSB7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgIGxldCBjYWxsX2FwaSA9IHRydWU7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWluZWRfZGlhbG9ndWVfbW9kZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAodGhpcy50cmFpbmVkX2RpYWxvZ3VlX21vZGVsc1tpbmRleF0uYWN0aXZlKSB7CiAgICAgICAgICAgIGNhbGxfYXBpID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2FsbF9hcGkpIHsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgIkRvIHlvdSB3YW50IHRvIHNldCAiICsKICAgICAgICAgICAgICB0aGlzLmNvbXBhbnluYW1lICsKICAgICAgICAgICAgICAiIFYiICsKICAgICAgICAgICAgICAodGhpcy50cmFpbmVkX2RpYWxvZ3VlX21vZGVscy5sZW5ndGggLSBpbmRleCkgKwogICAgICAgICAgICAgICIgYXMgeW91ciBjdXJyZW50IHRyYWluZWQgbW9kZWwgPyIsCiAgICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEiLAogICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgICAgICAgIC8vIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgLy8gICB0ZXh0OiAiUGxlYXNlIHdhaXQgd2hpbGUgd2Ugc3VibWl0IHlvdXIgcmVxdWVzdCIsCiAgICAgICAgICAgICAgLy8gICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAvLyAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAvLyAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIC8vICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLnJldmVydF9tb2RlbHMoKSwKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfZGV0YWlsczogewogICAgICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWxlOiB0aGlzLnRyYWluZWRfZGlhbG9ndWVfbW9kZWxzW2luZGV4XS5GaWxlTmFtZSwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiTW9kZWwgVXBkYXRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0X3N1Y2Nlc3MpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRfc3VjY2Vzcy52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRfdHJhaW5lZF9kaWFsb2d1ZV9tb2RlbHMoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sICAKICAgIHNlbGVjdF90cmFpbmVkX2ludGVudF9tb2RlbChpbmRleCkgewogICAgICBpZighdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKXsKICAgICAgICBsZXQgY2FsbF9hcGkgPSB0cnVlOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50cmFpbmVkX2ludGVudF9tb2RlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLnRyYWluZWRfaW50ZW50X21vZGVsc1tpbmRleF0uYWN0aXZlKSB7CiAgICAgICAgICAgIGNhbGxfYXBpID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2FsbF9hcGkpIHsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgIkRvIHlvdSB3YW50IHRvIHNldCAiICsKICAgICAgICAgICAgICB0aGlzLmNvbXBhbnluYW1lICsKICAgICAgICAgICAgICAiIFYiICsKICAgICAgICAgICAgICAodGhpcy50cmFpbmVkX2ludGVudF9tb2RlbHMubGVuZ3RoIC0gaW5kZXgpICsKICAgICAgICAgICAgICAiIGFzIHlvdXIgY3VycmVudCB0cmFpbmVkIG1vZGVsID8iLAogICAgICAgICAgICB0eXBlOiAicXVlc3Rpb24iLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIENvbmZpcm0hIiwKICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgICAgICAgICAvLyBTd2FsLmZpcmUoewogICAgICAgICAgICAgIC8vICAgdGV4dDogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIHN1Ym1pdCB5b3VyIHJlcXVlc3QiLAogICAgICAgICAgICAgIC8vICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgLy8gICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgLy8gICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAvLyAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgICAgIGFwaV9jYWxscy50cmFpbl9pbnRlbnRfbW9kZWwoKSwKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgRmlsZU5hbWU6IHRoaXMudHJhaW5lZF9pbnRlbnRfbW9kZWxzW2luZGV4XS5GaWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICBpc0NoYW5nZU1vZGVsVmVyc2lvbjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRfdHJhaW5lZF9pbnRlbnRfbW9kZWxzKCk7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiTW9kZWwgVXBkYXRlZCBTdWNjZXNzZnVsbHkiLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCwgUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0X3RyYWluZWRfbmVyX21vZGVsKGluZGV4KSB7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgIGxldCBjYWxsX2FwaSA9IHRydWU7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWluZWRfbmVyX21vZGVscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHRoaXMudHJhaW5lZF9uZXJfbW9kZWxzW2luZGV4XS5hY3RpdmUpIHsKICAgICAgICAgICAgY2FsbF9hcGkgPSBmYWxzZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsX2FwaSkgewogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAiRG8geW91IHdhbnQgdG8gc2V0ICIgKwogICAgICAgICAgICAgIHRoaXMuY29tcGFueW5hbWUgKwogICAgICAgICAgICAgICIgViIgKwogICAgICAgICAgICAgICh0aGlzLnRyYWluZWRfbmVyX21vZGVscy5sZW5ndGggLSBpbmRleCkgKwogICAgICAgICAgICAgICIgYXMgeW91ciBjdXJyZW50IHRyYWluZWQgbW9kZWwgPyIsCiAgICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgQ29uZmlybSEiLAogICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgICAgICAgIC8vIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgLy8gICB0ZXh0OiAiUGxlYXNlIHdhaXQgd2hpbGUgd2Ugc3VibWl0IHlvdXIgcmVxdWVzdCIsCiAgICAgICAgICAgICAgLy8gICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAvLyAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAvLyAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIC8vICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLnJldmVydF9uZXJfbW9kZWxzKCksCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfZGV0YWlsczogewogICAgICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWxlOiB0aGlzLnRyYWluZWRfbmVyX21vZGVsc1tpbmRleF0uRmlsZU5hbWUsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gIlJldmVydCBTdWNjZXNzZnVsIikgewogICAgICAgICAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogIk1vZGVsIFVwZGF0ZWQgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdF9zdWNjZXNzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAocmVzdWx0X3N1Y2Nlc3MudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRfdHJhaW5lZF9uZXJfbW9kZWxzKCk7CiAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCwgUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgZ2V0X3RyYWluZWRfZGlhbG9ndWVfbW9kZWxzKCkgewogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy51c2VfbW9kZWwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHsgZGF0YSB9KSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnRyYWluZWRfZGlhbG9ndWVfbW9kZWxzID0gZGF0YS5tb2RlbHMubWFwKChtb2RlbCkgPT4gewogICAgICAgICAgICBtb2RlbC5jcmVhdGVkX2F0ID0gbW9tZW50CiAgICAgICAgICAgICAgLnVuaXgobW9kZWwuY3JlYXRlZF9hdCkKICAgICAgICAgICAgICAuZm9ybWF0KCJEbyBNTU0gWVkiKTsKICAgICAgICAgICAgcmV0dXJuIG1vZGVsOwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZ2V0X3RyYWluZWRfbmVyX21vZGVscygpIHsKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLmdldCgKICAgICAgICAgIGFwaV9jYWxscy5yZXZlcnRfbmVyX21vZGVscygpLAogICAgICAgICAgewogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHJldmVydF9jb21wYW55X2lkOgogICAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgcmV2ZXJ0X2NvbXBhbnlfbmFtZToKICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgaXNTaG93OiB0cnVlLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHsKICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudHJhaW5lZF9uZXJfbW9kZWxzID0gZGF0YS5tb2RlbF9kYXRhLm1hcCgobW9kZWwpID0+IHsKICAgICAgICAgICAgbW9kZWwuY3JlYXRlZF9hdCA9IG1vbWVudCgKICAgICAgICAgICAgICBtb2RlbC5jcmVhdGVkX2F0LAogICAgICAgICAgICAgICJZWVlZTU1EREhIbW1zcyIKICAgICAgICAgICAgKS5mb3JtYXQoIkRvIE1NTSBZWSIpOwogICAgICAgICAgICByZXR1cm4gbW9kZWw7CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRfdHJhaW5lZF9pbnRlbnRfbW9kZWxzKCkgewogICAgICB0aGlzLmJpZ19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy50cmFpbl9pbnRlbnRfbW9kZWwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzR2V0TW9kZWxzOiB0cnVlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHsKICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgdGhpcy50cmFpbmVkX2ludGVudF9tb2RlbHMgPSBkYXRhLm1vZGVscy5tYXAoKG1vZGVsKSA9PiB7CiAgICAgICAgICAgIG1vZGVsLmNyZWF0ZWRfYXQgPSBtb21lbnQoCiAgICAgICAgICAgICAgbW9kZWwuY3JlYXRlZF9hdCwKICAgICAgICAgICAgICAiWVlZWU1NRERISG1tc3MiCiAgICAgICAgICAgICkuZm9ybWF0KCJEbyBNTU0gWVkiKTsKICAgICAgICAgICAgcmV0dXJuIG1vZGVsOwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8gYWRkX21haWwoKSB7CiAgICAvLyAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAvLyAgIGF4aW9zCiAgICAvLyAgICAgLnBvc3QoCiAgICAvLyAgICAgICBhcGlfY2FsbHMubm90aWZ5X3N1cGVyYWRtaW5fdXJsKCksCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgLy8gICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgICBzZW5kdG86IHRoaXMuc2VuZGVyLAogICAgLy8gICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICBib2R5OiB0aGlzLmVtYWlsX2JvZHksCiAgICAvLyAgICAgICAgIHN1YmplY3Q6IHRoaXMuc3ViamVjdCwKICAgIC8vICAgICAgICAgYmluZGVtYWlsOiAiRmFsc2UiLAogICAgLy8gICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucwogICAgLy8gICAgICAgfSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgIH0KICAgIC8vICAgICApCiAgICAvLyAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MocmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuY2F0Y2goZSA9PiB7CiAgICAvLyAgICAgICBpZiAoCiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICApIHsKICAgIC8vICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KTsKICAgIC8vIH0sCiAgICBsYW5ndWFnZV9zdXBwb3J0X2FwaSgpIHsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMubXVsdGlwbGVfbGFuZ3VhZ2Vfc3VwcG9ydF91cmwoKSwgewogICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGxhbmd1YWdlX3N1cHBvcnQ6IHRoaXMubXVsdGlwbGVfbGFuZ3VhZ2VfbGlzdCwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGZpbGVpbnB1dChlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgY29tcGFueSBsb2dvIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgU2VsZWN0IGFuIEltYWdlIG9mIHR5cGUgUE5HIG9yIEpQRUciLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlSW1hZ2UoZmlsZSwgdHlwZSkgewogICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBkb3dubG9hZF9zZGsoZGF0YV90eXBlKSB7CiAgICAgIGlmIChkYXRhX3R5cGUgPT0gImxpY2Vuc2Vfa2V5IikgewogICAgICAgIHRoaXMuc3Bpbm5lck9uMSA9IHRydWU7CiAgICAgICAgYXhpb3MoewogICAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgICB1cmw6IGFwaV9jYWxscy5nZXRfbGljZW5zZV9rZXkoKSwKICAgICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICB9LAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIGRhdGFfdHlwZSArICIudHh0Iik7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24xID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24yID0gdHJ1ZTsKICAgICAgICBheGlvcyh7CiAgICAgICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWRfdXJsKCksCiAgICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgZG93bmxvYWRfc2RrX3R5cGU6IGRhdGFfdHlwZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgfSwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24yID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIGZpbGUiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKAogICAgICAgICAgICAgICAgIkR1ZSB0byBzb21lIGludGVybmFsIGVycm9yLCBub3QgYWJsZSB0byBkb3dubG9hZCB0aGUgZmlsZSIKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgZGF0YV90eXBlICsgIl9TREsuemlwIik7CiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24yID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICAiRHVlIHRvIHNvbWUgaW50ZXJuYWwgZXJyb3IsIG5vdCBhYmxlIHRvIGRvd25sb2FkIHRoZSBmaWxlIgogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY29weV93aWRnZXRfY29kZSgpIHsKICAgICAgdGhpcy4kcmVmcy53aWRnZXRfdGV4dGFyZWEuc2VsZWN0KCk7CiAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7CiAgICAgICQoIiNjb3B5X2NvZGVfdG9vbHRpcCIpLnRvb2x0aXAoInNob3ciKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgJCgiI2NvcHlfY29kZV90b29sdGlwIikudG9vbHRpcCgiZGlzcG9zZSIpOwogICAgICAgIHRoaXMuaW5pdGlhbGl6ZV90b29sdGlwcygpOwogICAgICB9LCA1MDAwKTsKICAgIH0sCiAgICBjb3B5X3V1aWRfY29kZSgpIHsKICAgICAgdGhpcy4kcmVmcy51dWlkX3RleHRhcmVhMS5zZWxlY3QoKTsKICAgICAgdGhpcy4kcmVmcy51dWlkX3RleHRhcmVhMi5zZWxlY3QoKTsKICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoImNvcHkiKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgJCgiI2NvcHlfY29kZV90b29sdGlwIikudG9vbHRpcCgiZGlzcG9zZSIpOwogICAgICAgIHRoaXMuaW5pdGlhbGl6ZV90b29sdGlwcygpOwogICAgICB9LCA1MDAwKTsKICAgIH0sCiAgICBpbml0aWFsaXplX3Rvb2x0aXBzKCkgewogICAgICAkKCdbZGF0YS10b29sdGlwPSJ0b29sdGlwIl0nKS50b29sdGlwKHsKICAgICAgICB0cmlnZ2VyOiAibWFudWFsIiwKICAgICAgfSk7CiAgICB9LAogICAgY29weV9saWNlbnNlX2tleSgpIHsKICAgICAgdGhpcy4kcmVmcy5saWNlbnNlX2tleV90ZXh0YXJlYS5zZWxlY3QoKTsKICAgICAgdGhpcy4kcmVmcy5saWNlbnNlX2tleV90ZXh0YXJlYS5zZXRTZWxlY3Rpb25SYW5nZSgwLCA5OTk5OSk7CiAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7CiAgICAgICQoIiNjb3B5X2xpY25zZV9rZXlfdG9vbHRpcCIpLnRvb2x0aXAoInNob3ciKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgJCgiI2NvcHlfbGljbnNlX2tleV90b29sdGlwIikudG9vbHRpcCgiZGlzcG9zZSIpOwogICAgICAgIHRoaXMuaW5pdGlhbGl6ZV90b29sdGlwcygpOwogICAgICB9LCA1MDAwKTsKICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZSgpIHt9LAogIH0sCn07Cg=="},null]}