{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue","mtime":1663910265446},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGNvdW50cmllcyBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0NvdW50cmllcyI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBBcmVhQ2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9BcmVhQ2hhcnQudnVlIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7Ci8vIGltcG9ydCB7IFN0cmlwZUNoZWNrb3V0IH0gZnJvbSAiQHZ1ZS1zdHJpcGUvdnVlLXN0cmlwZSI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IHsgdXBkYXRlX3NpZGViYXJfbWVudSwgdXBkYXRlX3Jlc3RyaWN0aW9uX2xpc3R9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJpbGxpbmciLAogIGNvbXBvbmVudHM6IHsKICAgIEFyZWFDaGFydCwKICAgIE11bHRpc2VsZWN0LAogICAgLy8gU3RyaXBlQ2hlY2tvdXQsCiAgfSwKICBtaXhpbnM6IFsKICAgIHVwZGF0ZV9zaWRlYmFyX21lbnUsCiAgICB1cGRhdGVfcmVzdHJpY3Rpb25fbGlzdAogIF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHNlbGVjdF9zdWJzY3JpcHRpb25fcGxhbjogWyJTaWx2ZXIiLCAiR29sZCIsICJQbGFudGludW0iLCAiRW50ZXJwcmlzZSJdLAogICAgICBzZWxlY3RlZF9zdWJzY3JpcHRpb246ICIiLAogICAgICBzdWJzY3JpcHRpb25faWQ6ICIiLAogICAgICBwbGFuX2lkOiAiIiwKICAgICAgY3VzdG9tZXJfaWQ6ICIiLAogICAgICBwbGFuX3BlcmlvZDogWyJNb250aGx5IiwgIlllYXJseSJdLAogICAgICBzZWxlY3RlZF9wZXJpb2Q6ICIiLAogICAgICBvcmRlcl9pZDogIiIsCiAgICAgIGFtb3VudDogIiIsCiAgICAgIHBheV9zdWNjZXNzX2RhdGE6IHt9LAogICAgICBzdWJzY3JpcHRpb25fYnRuX2Rpc2FibGU6IGZhbHNlLAogICAgICBjb3VudHJ5X2xpc3Q6IGNvdW50cmllcywKICAgICAgcGF5bWVudGlkOiAiIiwKICAgICAgYmFyQ2hhcnQ6ICIiLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IFsiI2U2N2UyMiIsICIjMTZhMDg1IiwgIiMyOTgwYjkiXSwKICAgICAgbGFiZWxzOiBbCiAgICAgICAgIkV4Y2hhbmdlIG9mIE1lc3NhZ2VzIiwKICAgICAgICAiRXhlY3V0aW9uIG9mIFRhc2tzIiwKICAgICAgICAiQXVkaW8vVmlkZW8gSW50ZXJhY3Rpb24iLAogICAgICAgICJTdG9yYWdlIiwKICAgICAgXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY291bnRyeV9uYW1lOiAiIiwKICAgICAgcGF5bWVudF9jdXJyZW5jeTogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3RvcF91cDogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjogIiIsCiAgICAgIElOUjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDogWzUwLCAxMDAsIDIwMCwgNTAwXSwKICAgICAgY29tbW9uX2N1cnJlbmN5OiBbXSwKICAgICAgY3VycmVuY3lfYW1vdW50OiBudWxsLAogICAgICB0b3BfdXBfYW1vdW50OiBudWxsLAogICAgICBwaWVjaGFydF9kYXRhOiBbXSwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgY29uY3VycmVudF91c2Vyc19tb250aDogIiIsCiAgICAgIENvbmN1cnJlbnRfVXNlcnNfRGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgZGF0YTogW10sCiAgICAgIH0sCiAgICAgIG1vbnRoczogWwogICAgICAgICJKYW4iLAogICAgICAgICJGZWIiLAogICAgICAgICJNYXIiLAogICAgICAgICJBcHIiLAogICAgICAgICJNYXkiLAogICAgICAgICJKdW5lIiwKICAgICAgICAiSnVseSIsCiAgICAgICAgIkF1ZyIsCiAgICAgICAgIlNlcHQiLAogICAgICAgICJPY3QiLAogICAgICAgICJOb3YiLAogICAgICAgICJEZWMiLAogICAgICBdLAogICAgICBpbnZvaWNlX2RldGFpbHM6IFtdLAogICAgICBpbnZvaWNlX2RldGFpbHNfY29weTogW10sCiAgICAgIHRvdGFsX3llYXI6IFtdLAogICAgICB5ZWFyX3NlbGVjdGVkOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgLy9oYXJzaAogICAgICBjb21tb25fY3VycmVuY3kyOiBbXSwKICAgICAgSU5SMjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDI6IFsxMDAsIDMwMCwgNTAwXSwKICAgICAgcmV0YWlsX3Nob3BpZnlfY29tcGFueTogZmFsc2UsCiAgICAgIC8vIGFkZG9uX3BsYW5zOiBbCiAgICAgIC8vICAgewogICAgICAvLyAgICAgICAiVHlwZSI6ICJTbXNBZGRPbiIsCiAgICAgIC8vICAgICAgICJQcmljZSI6IDE1LjAsCiAgICAgIC8vICAgICAgICJTZXJ2aWNlIjogIlNNUyIsCiAgICAgIC8vICAgICAgICJQcmljZU9wdGlvbnMiOiBbCiAgICAgIC8vICAgICAgICAgICB7CiAgICAgIC8vICAgICAgICAgICAgICAgInByaWNlIjogMTUuMCwKICAgICAgLy8gICAgICAgICAgICAgICAiY3VycmVuY3kiOiAidXNkIiwKICAgICAgLy8gICAgICAgICAgICAgICAiaWQiOiAiMTI0MjU2NDgzMjU0MTQzNTM0MTMyMzUyMzQxMzQiLAogICAgICAvLyAgICAgICAgICAgICAgICJ0eXBlIjogInVzIiwKICAgICAgLy8gICAgICAgICAgICAgICAiY291bnQiOiAxMDAwLAogICAgICAvLyAgICAgICAgICAgICAgICJrZXkiOiAic21zX2NvdW50LmFkZF9vbi51cyIsCiAgICAgIC8vICAgICAgICAgICAgICAgImxhYmVsIjogIiQxNSAoMTAwMCBzbXMgZm9yIFVTIHJlZ2lvbikiCiAgICAgIC8vICAgICAgICAgICB9LAogICAgICAvLyAgICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAgICJwcmljZSI6IDE1LjAsCiAgICAgIC8vICAgICAgICAgICAgICAgImN1cnJlbmN5IjogInVzZCIsCiAgICAgIC8vICAgICAgICAgICAgICAgImlkIjogIjEyNDI1NjQ4MzI1NDE0MzUzNDEzMjM1MjM0MTM0IiwKICAgICAgLy8gICAgICAgICAgICAgICAidHlwZSI6ICJub25fdXMiLAogICAgICAvLyAgICAgICAgICAgICAgICJjb3VudCI6IDUwMCwKICAgICAgLy8gICAgICAgICAgICAgICAia2V5IjogInNtc19jb3VudC5hZGRfb24ubm9uX3VzIiwKICAgICAgLy8gICAgICAgICAgICAgICAibGFiZWwiOiAiJDE1ICg1MDAgc21zIGZvciBOb24tVVMgcmVnaW9uKSIKICAgICAgLy8gICAgICAgICAgIH0KICAgICAgLy8gICAgICAgXSwKICAgICAgLy8gICAgICAgIk9wdGlvbnMiOiBbCiAgICAgIC8vICAgICAgICAgICB7CiAgICAgIC8vICAgICAgICAgICAgICAgInR5cGUiOiAidXMiLAogICAgICAvLyAgICAgICAgICAgICAgICJjb3VudCI6IDEwMDAKICAgICAgLy8gICAgICAgICAgIH0sCiAgICAgIC8vICAgICAgICAgICB7CiAgICAgIC8vICAgICAgICAgICAgICAgInR5cGUiOiAibm9uX3VzIiwKICAgICAgLy8gICAgICAgICAgICAgICAiY291bnQiOiA1MDAKICAgICAgLy8gICAgICAgICAgIH0KICAgICAgLy8gICAgICAgXSwKICAgICAgLy8gICAgICAgIklzQWN0aXZlIjogdHJ1ZSwKICAgICAgLy8gICAgICAgIklzQWRkT24iOiB0cnVlCiAgICAgIC8vICAgfSwKICAgICAgLy8gICB7CiAgICAgIC8vICAgICAgICJUeXBlIjogIkNvbnZlcnNhdGlvbkFkZE9uIiwKICAgICAgLy8gICAgICAgIlNlcnZpY2UiOiAiV2hhdHNhcHBDb252ZXJzYXRpb24iLAogICAgICAvLyAgICAgICAiUHJpY2VPcHRpb25zIjogWwogICAgICAvLyAgICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAgICJwcmljZSI6IDI5LjAsCiAgICAgIC8vICAgICAgICAgICAgICAgImN1cnJlbmN5IjogInVzZCIsCiAgICAgIC8vICAgICAgICAgICAgICAgImlkIjogIjEyNDI1NjQ4MzI1NDE0MzUzNDEzMjM1MjM0MTM0IiwKICAgICAgLy8gICAgICAgICAgICAgICAidHlwZSI6ICJjb252ZXJzYXRpb25zIiwKICAgICAgLy8gICAgICAgICAgICAgICAiY291bnQiOiAyMDAwLAogICAgICAvLyAgICAgICAgICAgICAgICJrZXkiOiAid2hhdHNhcHBfY29udmVyc2F0aW9uc19jb3VudC5hZGRfb24iLAogICAgICAvLyAgICAgICAgICAgICAgICJsYWJlbCI6ICIkMjkgKDIwMDAgY29udmVyc2F0aW9ucykiCiAgICAgIC8vICAgICAgICAgICB9LAogICAgICAvLyAgICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAgICJwcmljZSI6IDIwMDAuMCwKICAgICAgLy8gICAgICAgICAgICAgICAiY3VycmVuY3kiOiAiaW5yIiwKICAgICAgLy8gICAgICAgICAgICAgICAiaWQiOiAiMTI0MjU2NDgzMjU0MTQzNjM0NTI5MjA4NDUyMzQiLAogICAgICAvLyAgICAgICAgICAgICAgICJ0eXBlIjogImNvbnZlcnNhdGlvbnMiLAogICAgICAvLyAgICAgICAgICAgICAgICJjb3VudCI6IDIwMDAsCiAgICAgIC8vICAgICAgICAgICAgICAgImtleSI6ICJ3aGF0c2FwcF9jb252ZXJzYXRpb25zX2NvdW50LmFkZF9vbiIsCiAgICAgIC8vICAgICAgICAgICAgICAgImxhYmVsIjogIuKCuTIwMDAgKDIwMDAgY29udmVyc2F0aW9ucykiCiAgICAgIC8vICAgICAgICAgICB9CiAgICAgIC8vICAgICAgIF0sCiAgICAgIC8vICAgICAgICJJc0FjdGl2ZSI6IHRydWUsCiAgICAgIC8vICAgICAgICJJc0FkZE9uIjogdHJ1ZQogICAgICAvLyAgIH0KICAgICAgLy8gXSwKCiAgICAgIC8vIHBsYW5zOiBbCiAgICAgIC8vIHsKICAgICAgLy8gICAgICJUeXBlIiA6ICJTdGFydGVyIiwKICAgICAgLy8gICAgICJJc0FjdGl2ZSIgOiB0cnVlLAogICAgICAvLyAgICAgIlByaWNlT3B0aW9ucyIgOiBbIAogICAgICAvLyAgICAgICAgIHsKICAgICAgLy8gICAgICAgICAgICAgInByaWNlIiA6IDI5LjAsCiAgICAgIC8vICAgICAgICAgICAgICJjdXJyZW5jeSIgOiAidXNkIiwKICAgICAgLy8gICAgICAgICAgICAgInByaWNlX2lkIiA6ICJwcmljZV8xSnpaeTJHVFo3SmRtVnVzeVVxak90ajciLAogICAgICAvLyAgICAgICAgICAgICAibmlja25hbWUiIDogIlN0YXJ0ZXItVGVzdCIsCiAgICAgIC8vICAgICAgICAgICAgICJsYWJlbCIgOiAiJDI5L21vbnRoIiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogIm1vbnRobHkiCiAgICAgIC8vICAgICAgICAgfSwgCiAgICAgIC8vICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAicHJpY2UiIDogMjAwMC4wLAogICAgICAvLyAgICAgICAgICAgICAiY3VycmVuY3kiIDogImluciIsCiAgICAgIC8vICAgICAgICAgICAgICJwcmljZV9pZCIgOiAicHJpY2VfMUtkWU9QR1RaN0pkbVZ1c0RZdFQzcnk4IiwKICAgICAgLy8gICAgICAgICAgICAgIm5pY2tuYW1lIiA6ICJTdGFydGVyLVRlc3QtSU5SIiwKICAgICAgLy8gICAgICAgICAgICAgImxhYmVsIiA6ICLigrkyMDAwL21vbnRoIiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogIm1vbnRobHkiCiAgICAgIC8vICAgICAgICAgfSwgCiAgICAgIC8vICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAicHJpY2UiIDogMjkwLjAsCiAgICAgIC8vICAgICAgICAgICAgICJjdXJyZW5jeSIgOiAidXNkIiwKICAgICAgLy8gICAgICAgICAgICAgInByaWNlX2lkIiA6ICJwcmljZV8xSzI4akpHVFo3SmRtVnVzYUhoSzR0T0YiLAogICAgICAvLyAgICAgICAgICAgICAibmlja25hbWUiIDogIlN0YXJ0ZXItVGVzdC1ZZWFybHkiLAogICAgICAvLyAgICAgICAgICAgICAibGFiZWwiIDogIiQyOTAveWVhcmx5IiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogInllYXJseSIKICAgICAgLy8gICAgICAgICB9LCAKICAgICAgLy8gICAgICAgICB7CiAgICAgIC8vICAgICAgICAgICAgICJwcmljZSIgOiAyMDAwMC4wLAogICAgICAvLyAgICAgICAgICAgICAiY3VycmVuY3kiIDogImluciIsCiAgICAgIC8vICAgICAgICAgICAgICJwcmljZV9pZCIgOiAicHJpY2VfMUtkWVQ0R1RaN0pkbVZ1c1k0bkVUR0hIIiwKICAgICAgLy8gICAgICAgICAgICAgIm5pY2tuYW1lIiA6ICJTdGFydGVyLVRlc3QtWWVhcmx5LUlOUiIsCiAgICAgIC8vICAgICAgICAgICAgICJsYWJlbCIgOiAi4oK5MjAwMDAveWVhcmx5IiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogInllYXJseSIKICAgICAgLy8gICAgICAgICB9CiAgICAgIC8vICAgICBdLCAgICAKICAgICAgLy8gfSwKICAgICAgLy8gewogICAgICAvLyAgICAgIlR5cGUiIDogIlByZW1pdW0iLAogICAgICAvLyAgICAgIlByaWNlT3B0aW9ucyIgOiBbIAogICAgICAvLyAgICAgICAgIHsKICAgICAgLy8gICAgICAgICAgICAgInByaWNlIiA6IDk5LjAsCiAgICAgIC8vICAgICAgICAgICAgICJjdXJyZW5jeSIgOiAidXNkIiwKICAgICAgLy8gICAgICAgICAgICAgInByaWNlX2lkIiA6ICJwcmljZV8xSnpaeWpHVFo3SmRtVnVzMktIZEw4WEUiLAogICAgICAvLyAgICAgICAgICAgICAibmlja25hbWUiIDogIlByZW1pdW0tVGVzdCIsCiAgICAgIC8vICAgICAgICAgICAgICJsYWJlbCIgOiAiJDk5L21vbnRoIiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogIm1vbnRobHkiCiAgICAgIC8vICAgICAgICAgfSwgCiAgICAgIC8vICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAicHJpY2UiIDogNzAwMC4wLAogICAgICAvLyAgICAgICAgICAgICAiY3VycmVuY3kiIDogImluciIsCiAgICAgIC8vICAgICAgICAgICAgICJwcmljZV9pZCIgOiAicHJpY2VfMUtkWVNFR1RaN0pkbVZ1c1p3S1RBVVY2IiwKICAgICAgLy8gICAgICAgICAgICAgIm5pY2tuYW1lIiA6ICJQcmVtaXVtLVRlc3QtSU5SIiwKICAgICAgLy8gICAgICAgICAgICAgImxhYmVsIiA6ICLigrk3MDAwL21vbnRoIiwKICAgICAgLy8gICAgICAgICAgICAgInR5cGUiIDogIm1vbnRobHkiCiAgICAgIC8vICAgICAgICAgfSwgCiAgICAgIC8vICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAicHJpY2UiIDogOTkwLjAsCiAgICAgIC8vICAgICAgICAgICAgICJjdXJyZW5jeSIgOiAidXNkIiwKICAgICAgLy8gICAgICAgICAgICAgInByaWNlX2lkIiA6ICJwcmljZV8xSzI4aFRHVFo3SmRtVnVzMXdXY3Q5UFQiLAogICAgICAvLyAgICAgICAgICAgICAibmlja25hbWUiIDogIlByZW1pdW0tVGVzdC1ZZWFybHkiLAogICAgICAvLyAgICAgICAgICAgICAibGFiZWwiIDogIiQ5OTAveWVhciIsCiAgICAgIC8vICAgICAgICAgICAgICJ0eXBlIiA6ICJ5ZWFybHkiCiAgICAgIC8vICAgICAgICAgfSwgCiAgICAgIC8vICAgICAgICAgewogICAgICAvLyAgICAgICAgICAgICAicHJpY2UiIDogNzAwMDAuMCwKICAgICAgLy8gICAgICAgICAgICAgImN1cnJlbmN5IiA6ICJpbnIiLAogICAgICAvLyAgICAgICAgICAgICAicHJpY2VfaWQiIDogInByaWNlXzFLZFlUWkdUWjdKZG1WdXNTSkljRUdueiIsCiAgICAgIC8vICAgICAgICAgICAgICJuaWNrbmFtZSIgOiAiUHJlbWl1bS1UZXN0LVllYXJseS1JTlIiLAogICAgICAvLyAgICAgICAgICAgICAibGFiZWwiIDogIuKCuTcwMDAwL3llYXIiLAogICAgICAvLyAgICAgICAgICAgICAidHlwZSIgOiAieWVhcmx5IgogICAgICAvLyAgICAgICAgIH0KICAgICAgLy8gICAgIF0sCiAgICAgIC8vIH1dLAogICAgICByZXRhaWxfc2hvcGlmeV9zdWJzY3JpcHRpb25fcGxhbnM6IFsKICAgICAgICAvLyB7CiAgICAgICAgLy8gICBuYW1lOiAiRnJlZSIsCiAgICAgICAgLy8gICBpc19jaGFyZ2VhYmxlOiBmYWxzZSwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJTdGFydGVyIiwKICAgICAgICAgIGxhYmVsOiJTdGFydGVyICgkMjkvbW9udGggb3IgJDI5MC95ZWFyKSIsCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDI5LAogICAgICAgICAgYW5udWFsX2NoYXJnZTogewogICAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiAyNC4xNywKICAgICAgICAgICAgYWN0dWFsX2NoYXJnZTogMjkwLAogICAgICAgICAgfSwKICAgICAgICAgIGN1cnJlbmN5OiAidXNkIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIlByZW1pdW0iLAogICAgICAgICAgbGFiZWw6ICJQcmVtaXVtICgkOTkvbW9udGggb3IgJDk5MC95ZWFyKSIsIAogICAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICAgIG1vbnRobHlfY2hhcmdlOiA5OSwKICAgICAgICAgIGFubnVhbF9jaGFyZ2U6IHsKICAgICAgICAgICAgcGVyX21vbnRoX2VmZmVjdGl2ZTogODIuNSwKICAgICAgICAgICAgYWN0dWFsX2NoYXJnZTogOTkwLAogICAgICAgICAgfSwKICAgICAgICAgIGN1cnJlbmN5OiAidXNkIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIlN0YXJ0ZXIiLAogICAgICAgICAgbGFiZWw6IlN0YXJ0ZXIgKOKCuTIwMDAvbW9udGggb3Ig4oK5MjAwMDAveWVhcikiLAogICAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICAgIG1vbnRobHlfY2hhcmdlOiAyMDAwLAogICAgICAgICAgYW5udWFsX2NoYXJnZTogewogICAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiAyNC4xNywKICAgICAgICAgICAgYWN0dWFsX2NoYXJnZTogMjAwMDAsCiAgICAgICAgICB9LAogICAgICAgICAgIGN1cnJlbmN5OiAiaW5yIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIlByZW1pdW0iLAogICAgICAgICAgbGFiZWw6ICJQcmVtaXVtICjigrk3MDAwL21vbnRoIG9yIOKCuTcwMDAwL3llYXIpIiwgCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDcwMDAsCiAgICAgICAgICBhbm51YWxfY2hhcmdlOiB7CiAgICAgICAgICAgIHBlcl9tb250aF9lZmZlY3RpdmU6IDgyLjUsCiAgICAgICAgICAgIGFjdHVhbF9jaGFyZ2U6IDcwMDAwLAogICAgICAgICAgfSwKICAgICAgICAgIGN1cnJlbmN5OiAiaW5yIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIldoYXRzQXBwIiwKICAgICAgICAgIGxhYmVsOiAiV2hhdHNBcHAgKCQyOS9tb250aCkiLCAKICAgICAgICAgIGlzX2NoYXJnZWFibGU6IHRydWUsCiAgICAgICAgICBtb250aGx5X2NoYXJnZTogMjksCiAgICAgICAgICBjdXJyZW5jeTogInVzZCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJXaGF0c0FwcCIsCiAgICAgICAgICBsYWJlbDogIldoYXRzQXBwICjigrkyMDAwL21vbnRoKSIsIAogICAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICAgIG1vbnRobHlfY2hhcmdlOiAyMDAwLAogICAgICAgICAgY3VycmVuY3k6ICJpbnIiCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgcmV0YWlsX3BsYW5fY3VycmVudDogbnVsbCwKICAgICAgcGF5bWVudF90eXBlczogWyJBbm51YWwiLCAiTW9udGhseSJdLAogICAgICByZXRhaWxfcGF5bWVudF90eXBlOiBudWxsLAogICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zOiBudWxsLAogICAgICBzdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHM6IHt9LAogICAgICBzdHJpcGVfYWRkb25fcGxhbnM6IFtdLAogICAgICBzaG93X3N1YnNjcmlwdGlvbjpmYWxzZSwKICAgICAgc2VsZWN0ZWRfYWRkb25fcGxhbjogbnVsbCwKICAgICAgaGlkZV9idXR0b246J0ZyZWUnLAogICAgICBjcmVkaXRzX2JhbGFuY2U6IG51bGwsCiAgICAgIHJldGFpbF93ZWJfZnJhbWV3b3JrOiB0aGlzLiRzZXNzaW9uLmdldCgicmV0YWlsX3dlYl9mcmFtZXdvcmsiKSwKICAgICAgc2hvcF9iYXNlX2N1cnJlbmN5OiAndXNkJywKICAgICAgYWNjZXB0YWJsZV9zaG9wX2Jhc2VfY3VycmVuY2llczogWydJTlInLCAnVVNEJywgJ2lucicsICd1c2QnXSwKICAgICAgc3RyaXBlX2FkZG9uX3R5cGU6IFtdLAogICAgICBzZWxlY3RlZF9hZGRvbl90eXBlOiBudWxsLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7IAogICAgdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yayA9IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpOwogICAgdGhpcy5jb3VudHJ5X2xpc3QgPSBjb3VudHJpZXM7CiAgICBpZiAoCiAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikgJiYKICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iCiAgICApIHsKICAgICAgdG9hc3RyLndhcm5pbmcodGx0KCdiaWxsaW5nX3NlbGVjdF9jb21wYW55X25hbWVfbXNnJykpOwogICAgfQogICAgaWYgKHRoaXMudXNlcl9yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICBpZiAodGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpKSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55TmFtZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQ7CiAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgfQogICAgaWYgKAogICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY291bnRyeV9uYW1lID09ICIiICYmCiAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiY291bnRyeV9uYW1lIikKICAgICkgewogICAgfSBlbHNlIHsKICAgICAgYXhpb3MKICAgICAgICAuZ2V0KGFwaV9jYWxscy5iaWxsaW5nX2ludm9pY2UoKSwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdGhpcy50b3RhbF95ZWFyID0gcmVzcG9uc2UuZGF0YS5kYXRhLlllYXJMaXN0OwogICAgICAgICAgICAgIHRoaXMueWVhcl9zZWxlY3RlZCA9IHRoaXMudG90YWxfeWVhclswXTsgICAgICAgICAKICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CgogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5iaWxsaW5nX2ludm9pY2UoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGRvd25sb2FkX2ZpbGU6IGZhbHNlLAogICAgICAgICAgICB5ZWFyOiB0aGlzLnllYXJfc2VsZWN0ZWQsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLmludm9pY2VfZGV0YWlscyA9IHJlc3BvbnNlLmRhdGEuZGF0YS5CdWNrZXRfbGlzdDsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW52b2ljZV9kZXRhaWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLmludm9pY2VfZGV0YWlsc19jb3B5W2ldID0gdGhpcy5pbnZvaWNlX2RldGFpbHNbaV0uc2xpY2UoOCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaW52b2ljZV9kZXRhaWxzX2NvcHkpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlLCdycicpOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBsZXQgaXNfc2hvcGlmeSA9IHRoaXMucmV0YWlsX3dlYl9mcmFtZXdvcms7CiAgICBpZiAoQm9vbGVhbihpc19zaG9waWZ5KSAmJiBpc19zaG9waWZ5ID09PSAic2hvcGlmeSIpIHsKICAgICAgdGhpcy5yZXRhaWxfc2hvcGlmeV9jb21wYW55ID0gdHJ1ZTsKICAgIH0KICAgIHRoaXMuZ2V0X3Nob3BfYmFzZV9jdXJyZW5jeSgpOwogICAgdGhpcy5jaGVja19hZGRvbnNfYmFsYW5jZSgpOwogIH0sCiAgIHdhdGNoOiB7CiAgICBzZWxlY3RlZF9hZGRvbl9wbGFuKCl7CiAgICAgIHRoaXMuc3RyaXBlX2FkZG9uX3R5cGUgPSBbXTsKICAgICAgdGhpcy5zZWxlY3RlZF9hZGRvbl90eXBlPSBudWxsOwogICAgICBpZih0aGlzLnNlbGVjdGVkX2FkZG9uX3BsYW4gIT09IG51bGwpewogICAgICAgIHRoaXMuc3RyaXBlX2FkZG9uX3R5cGUgPSB0aGlzLnNlbGVjdGVkX2FkZG9uX3BsYW4uT3B0aW9uczsKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZCgpIHsgCgogICAgdGhpcy5nZXRfcGxhbnNfZnJvbV9kYigpOyAvLyBHZXQgcGxhbnMgZnJvbSBkYgogICAgdGhpcy5nZXRfYWRkb25fZGV0YWlscygpOyAvLyBHZXQgQWRkIE9ucyBmcm9tIGNlbnNlIGRiCiAgICB0aGlzLmdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCk7IC8vIGdldCBzdWJzY3JpcHRpb24gZGV0YWlscyBmcm9tIGNlbnNlX2RiCiAgICBpZiAoCiAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb3VudHJ5X25hbWUgPT0gIiIgJiYKICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKQogICAgKSB7CiAgICAgICQoIiNjb3VudHJ5bW9kYWwiKQogICAgICAgIC5tb2RhbCh7CiAgICAgICAgICBiYWNrZHJvcDogInN0YXRpYyIsCiAgICAgICAgfSkKICAgICAgICAub24oImhpZGRlbi5icy5tb2RhbCIsIChlKSA9PiB7CiAgICAgICAgICBpZiAoIXRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKSkgewogICAgICAgICAgICAkKCIjY291bnRyeW1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9ib3QvZGFzaGJvYXJkIik7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoImNoYW5nZV9zaWRlYmFyX21haW5fbWVudSIsICJEYXNoYm9hcmQiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBjaGVja19yZXRhaWxfcGF5bWVudF90eXBlX2Rpc2FibGVkKCkgewogICAgICBpZiAoCiAgICAgICAgQm9vbGVhbih0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQpICYmCiAgICAgICAgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUgPT09IGZhbHNlCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICByZXRhaWxfcGF5bWVudF9wbGFjZWhvbGRlcigpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tfcmV0YWlsX3BheW1lbnRfdHlwZV9kaXNhYmxlZCkgewogICAgICAgIHJldHVybiB0aGlzLnRsdCgnbm9fYmlsbGluZ19jeWNsZV9tc2cnKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy50bHQoJ3BpY2tfb25lX21zZycpOwogICAgfSwKICAgIGN1cnJlbnRfcmV0YWlsX3BsYW5fY2hhcmdlcygpIHsKICAgICAgLy8gaWYodGhpcy5yZXRhaWxfc2hvcGlmeV9jb21wYW55KSB7CiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCkKICAgICAgICA/IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlCiAgICAgICAgICA/IGAkJHt0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubW9udGhseV9jaGFyZ2V9L21vbnRoICBvciAkJHt0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuYW5udWFsX2NoYXJnZS5wZXJfbW9udGhfZWZmZWN0aXZlfS9tb250aCBiaWxsZWQgYXQgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmFubnVhbF9jaGFyZ2UuYWN0dWFsX2NoYXJnZX0gb25jZSBwZXIgeWVhcmAKICAgICAgICAgIDogbnVsbAogICAgICAgIDogbnVsbDsKICAgICAgLy8gfSBlbHNlIHsKICAgICAgLy8gICByZXR1cm4gQm9vbGVhbih0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQpCiAgICAgIC8vICAgPyB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZQogICAgICAvLyAgICAgPyBgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm1vbnRobHlfY2hhcmdlfS9tb250aGAKICAgICAgLy8gICAgIDogbnVsbAogICAgICAvLyAgIDogbnVsbDsKICAgICAgLy8gfQogICAgfSwKICAgIGNoZWNrX3JldGFpbF9zaG9waWZ5X2Zvcm1fdmFsaWRhdGlvbnMoKSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQgIT09IG51bGwgJiYKICAgICAgICB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgIT09IG51bGwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ICE9PSBudWxsICYmCiAgICAgICAgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlID09IG51bGwgJiYKICAgICAgICB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGZpcnN0X3N0ZXAoKSB7CiAgICAgIGlmKHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucykgewogICAgICAgIHJldHVybiB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMuZmlsdGVyKHBsYW5zID0+IHBsYW5zLlR5cGUgIT09ICdGcmVlJykubWFwKHBsYW5zID0+IHBsYW5zLlR5cGUpOwogICAgICB9ZWxzZSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAogICAgcmV0YWlsX3Nob3BpZnlfc3Vic2NyaXB0aW9uX3BsYW5zX2N1c3RvbV9jdXJyZW5jeSgpewogICAgICBpZih0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnNfZGV0YWlscy5zdWJzY3JpcHRpb25fdHlwZSAhPT0gJ1ByZW1pdW0nKXsKICAgICAgICByZXR1cm4gdGhpcy5yZXRhaWxfc2hvcGlmeV9zdWJzY3JpcHRpb25fcGxhbnMuZmlsdGVyKChpdGVtKSA9PiBpdGVtLmN1cnJlbmN5ID09PSB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeSkKICAgICAgfWVsc2UgewogICAgICAgIHJldHVybiB0aGlzLnJldGFpbF9zaG9waWZ5X3N1YnNjcmlwdGlvbl9wbGFucy5maWx0ZXIoKGl0ZW0pID0+IChpdGVtLmN1cnJlbmN5ID09PSB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeSAmJiAoaXRlbS5uYW1lID09PSAiU3RhcnRlciIgfHwgaXRlbS5uYW1lID09PSAiV2hhdHNBcHAiKSApICkKICAgICAgfQogICAgfSwKICAgIC8vIHJldGFpbF9zaG9waWZ5X3N1YnNjcmlwdGlvbl9wbGFuc19jaGVja19jdXJyZW50cGxhbigpewogICAgLy8gICBpZih0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnNfZGV0YWlscy5zdWJzY3JpcHRpb25fdHlwZSAhPT0gJ1ByZW1pdW0nKXsKICAgIC8vICAgICByZXR1cm4gdGhpcy5yZXRhaWxfc2hvcGlmeV9zdWJzY3JpcHRpb25fcGxhbnMKICAgIC8vICAgfWVsc2V7CiAgICAvLyAgICAgcmV0dXJuIHRoaXMucmV0YWlsX3Nob3BpZnlfc3Vic2NyaXB0aW9uX3BsYW5zLmZpbHRlcigoaXRlbSkgPT4gIGl0ZW0ubmFtZSA9PT0gIlN0YXJ0ZXIiKQogICAgLy8gICB9CiAgICAvLyB9LAogICAgc2Vjb25kX3N0ZXAoKXsKICAgICAgdmFyIHRlbXAgPSBbXQogICAgICBpZih0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMgJiYgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50KSB7CiAgICAgICAgdGVtcCA9IHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucy5maWx0ZXIocGxhbnMgPT4gcGxhbnMuVHlwZSA9PSB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQpOwogICAgICAgIHZhciBzb3J0ZWQgPSAgKHRlbXBbMF0uUHJpY2VPcHRpb25zKS5maWx0ZXIoYWJjID0+ICBhYmMuY3VycmVuY3kgPT09IHRoaXMuc2hvcF9iYXNlX2N1cnJlbmN5KTsKICAgICAgICByZXR1cm4gc29ydGVkOwogICAgICB9CiAgICAgIHJldHVybiB0ZW1wOwogICAgfSwKICAgIGZpcnN0X3N0ZXBfYWRkb25fcGxhbnMoKXsKICAgICAgaWYodGhpcy5zdHJpcGVfYWRkb25fcGxhbnMpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHJpcGVfYWRkb25fcGxhbnMubWFwKHBsYW5zID0+IHBsYW5zLlR5cGUpOwogICAgICB9CiAgICB9LAogICAgc2Vjb25kX3N0ZXBfYWRkb25fcGxhbnMoKXsKICAgICAgLy8gY29uc29sZS5sb2coInNlbGVjdGVkX2FkZG9uX3BsYW4iLHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbik7CiAgICAgIGlmKHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbikgewogICAgICAgIHZhciBjaGVjayA9IHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhblsnUHJpY2VPcHRpb25zJ10uZmlsdGVyKHBsYW4gPT4gcGxhbi5jdXJyZW5jeSA9PSB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeSk7CiAgICAgICAgcmV0dXJuIGNoZWNrOwogICAgICB9CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICByZXRhaWxfcGF5bWVudF90eXBlcygpewogICAgIAogICAgICBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ID09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5wYXltZW50X3R5cGVzOwogICAgICB9ZWxzZSBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm5hbWUgPT0gdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHMuc3Vic2NyaXB0aW9uX3R5cGUpIHsKICAgICAgICAgbGV0IHN1Yl90eXBlID0gdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHMuc3Vic2NyaXB0aW9uX3BlcmlvZCA9PSAnWWVhcmx5Jz8nQW5udWFsJzogJ01vbnRobHknCiAgICAgICAgcmV0dXJuIHRoaXMucGF5bWVudF90eXBlcy5maWx0ZXIoKGl0ZW0pPT4gaXRlbSAhPSBzdWJfdHlwZSk7IAogICAgICB9ZWxzZSBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm5hbWUgPT0gJ1doYXRzQXBwJyl7CiAgICAgICAgcmV0dXJuIHRoaXMucGF5bWVudF90eXBlcy5maWx0ZXIoKGl0ZW0pPT4gaXRlbSAhPSAnQW5udWFsJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGF5bWVudF90eXBlczsKICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogIC8vIG5hbWVXaXRoTGFuZyAoeyB0eXBlLCBjb3VudCB9KSB7CiAgLy8gICByZXR1cm4gYCR7dHlwZX0gJHt0aGlzLnNlbGVjdGVkX2FkZG9uX3BsYW4uU2VydmljZX1bJHtjb3VudH1dYAogIC8vIH0sCiAgLy8gbmFtZXdpdGhQcmljZSh7bmFtZSxQcmljZX0pewogIC8vICAgcmV0dXJuIGAke25hbWV9ICgkJHtQcmljZX0pYAogIC8vIH0sCiAgc2hvd19zd2FsX25vdGlmaWNhdGlvbigpewogICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX3N3YWxfYWxlcnRfbXNnJyksCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYmlsbGluZ191bnN1YnNjcmliZV9wbGFuX21zZycpLAogICAgICAgICAgaWNvbjogJ3dhcm5pbmcnLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogJyMzMDg1ZDYnLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICcjZDMzJywKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnYmlsbGluZ19zd2FsX3llc19idG4nKQogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlID09IHRydWUpIHsKICAgICAgICAgIHRoaXMudXBkYXRlX3N1YnNjcmlwdGlvbl9wbGFuX2ZyZWUoKQogICAgICAgICAgU3dhbC5maXJlKAogICAgICAgICAgIHRoaXMudGx0KCdiaWxsaW5nX3N3YWxfdW5zdWJzY3JpYmVkX21zZycpLAogICAgICAgICAgIHRoaXMudGx0KCdiaWxsaW5nX3N1YnNjcmliZV9jYW5jZWxfbXNnJyksCiAgICAgICAgICAgICdzdWNjZXNzJwogICAgICAgICAgKQogICAgICAgIH0KICAgICAgfSkKICB9LAogIGdldF9zdWJzY3JpcHRpb25fdmFsaWRfdGlsbChzdWJfZGF0ZSl7CiAgICAgIHJldHVybiBtb21lbnQudXRjKHN1Yl9kYXRlKS5mb3JtYXQoIkRvIE1NTU0gWVlZWSIpOwogIH0sCiAgdXBkYXRlX3N1YnNjcmlwdGlvbl9wbGFuX2ZyZWUoKXsKICAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICB1bnN1YnNjcmliZV9wbGFuOiB0cnVlLCAgICAKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKQogICAgICAgICAgewogICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5Vc2VyTWVudTsKICAgICAgICAgICAgdGhpcy51cGRhdGVfc2lkZWJhcl9tZW51KG1lc3NhZ2UpOwogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTaWRlQmFyTWVudVVwZGF0ZWQiLCB0cnVlKTsKICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKCJ1cGRhdGUgc3VjY2Vzc2Z1bGx5IikKICAgICAgICAgICAgdGhpcy51cGRhdGVfcmVzdHJpY3Rpb25fbGlzdChyZXNwb25zZS5kYXRhLmRhdGEuUmVzdHJpY3Rpb25MaXN0LCByZXNwb25zZS5kYXRhLmRhdGEuU3Vic2NyaWJlZFBsYW4pCiAgICAgICAgICAgIHRoaXMuZ2V0X2N1cnJlbnRfc3Vic2NyaXB0aW9uX2RldGFpbHMoKQogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgiL2JvdC9zdWJzY3JpcHRpb24tcmVuZXdhbCIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgLy8gdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX29jY3VycmVkX21zZzknKSwKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICB9LAogIGdldF9wbGFuc19mcm9tX2RiKCkgewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgZ2V0X3BsYW5zX2Zyb21fZGI6IHRydWUsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKQogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb24gPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19lcnJvcl9vY2N1cnJlZF9tc2cyJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICB9LAogIGdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCkgewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgZ2V0X2FjdGl2ZV9wbGFuOiB0cnVlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkKICAgICAgICAgIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zX2RldGFpbHMgPSByZXNwb25zZS5kYXRhLmRhdGEuRGF0YS5jdXJyZW50X3N1YnNjcmlwdGlvbjsKICAgICAgICAgICAgdGhpcy5oaWRlX2J1dHRvbiA9IHJlc3BvbnNlLmRhdGEuZGF0YS5EYXRhLmN1cnJlbnRfc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogICAgICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzID0gW107CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6cmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlICwnZWVlJyk7CiAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfZXJyb3Jfb2NjdXJyZWRfbXNnMicpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgfSwKICAvLyBnZXRfY3VycmVudF9zdWJzY3JpcHRpb24oKSB7CiAgLy8gICBheGlvcwogIC8vICAgICAucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAvLyAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAvLyAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgLy8gICAgICAgaXNfZ2V0OiB0cnVlLAogIC8vICAgICB9KQogIC8vICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAvLyAgICAgICAvLyBjb25zb2xlLmxvZygiQ1VSUkVOVCBQTEFOIERFVEFJTFMiLHJlc3BvbnNlKTsKICAvLyAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSBudWxsKSB7CiAgLy8gICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgLy8gICAgICAgICBTd2FsKHsKICAvLyAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX25vX2FjdGl2ZV9zdWJzY3JpcHRpb25fbXNnMScpLAogIC8vICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogIC8vICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAvLyAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogIC8vICAgICAgICAgICB0aW1lcjogMjAwMCwKICAvLyAgICAgICAgIH0pOwogIC8vICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkN1cnJlbnQgU3Vic2NyaXB0aW9uIFBsYW4iKSB7CiAgLy8gICAgICAgICB0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9CiAgLy8gICAgICAgICAgIHJlc3BvbnNlLmRhdGEuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogIC8vICAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJpb2QgPSByZXNwb25zZS5kYXRhLnN1YnNjcmlwdGlvbi5wZXJpb2Q7CiAgLy8gICAgICAgICB0aGlzLmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5jdXN0b21lcl9pZDsKICAvLyAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gZmFsc2U7CiAgLy8gICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gQWN0aXZlIFN1YnNjcmlwdGlvbiBwbGFuIGZvdW5kIikgewogIC8vICAgICAgICAgdGhpcy5jdXN0b21lcl9pZCA9IHJlc3BvbnNlLmRhdGEuY3VzdG9tZXJfaWQ7CiAgLy8gICAgICAgICBTd2FsKHsKICAvLyAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX25vX2FjdGl2ZV9zdWJzY3JpcHRpb25fbXNnMicpLAogIC8vICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgLy8gICAgICAgICAgIHRvYXN0OiB0cnVlLAogIC8vICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgLy8gICAgICAgICAgIHRpbWVyOiAyMDAwLAogIC8vICAgICAgICAgfSk7CiAgLy8gICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgLy8gICAgICAgfQogIC8vICAgICB9KQogIC8vICAgICAuY2F0Y2goKGUpID0+IHsKICAvLyAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogIC8vICAgICAgIGlmICgKICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAvLyAgICAgICApIHsKICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgLy8gICAgICAgfQogIC8vICAgICB9KTsKICAvLyB9LAogIGNoZWNrX2FkZG9uc19iYWxhbmNlKCkgewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgYXhpb3MucG9zdCgKICAgICAgYXBpX2NhbGxzLmNoZWNrX2FkZG9uc19iYWxhbmNlKCksCiAgICAgIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY2hlY2tfYmFsYW5jZTogdHJ1ZQogICAgICB9LAogICAgICB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICApCiAgICAudGhlbigocmVzcG9uc2UpID0+ewogICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuQ0hFQ0tfQkFMQU5DRS5NU0dfQ09ERSl7CiAgICAgICAgaWYoQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGEuY3JlZGl0cy5zbXNfY291bnQpID09IHRydWUpIHsKICAgICAgICAgIHZhciBzbXNfY291bnQgPSByZXNwb25zZS5kYXRhLmRhdGEuY3JlZGl0cy5zbXNfY291bnQ7CiAgICAgICAgICB0aGlzLmNyZWRpdHNfYmFsYW5jZSA9IHNtc19jb3VudDsKICAgICAgICAgIC8vIHRoaXMuY3JlZGl0c19iYWxhbmNlID0gdGhpcy50bHQoJ2N1cnJlbnRfc21zX2NyZWRpdF90ZXh0JykgKyAiPHN0cm9uZz4gIisgdGhpcy50bHQoJ2N1cnJlbnRfc21zX2NyZWRpdF90ZXh0MicpICsgIjogIiArIHNtc19jb3VudC51cyArICIgfCAiICsgdGhpcy50bHQoJ2N1cnJlbnRfc21zX2NyZWRpdF90ZXh0MycpICsgIjogIiArIHNtc19jb3VudC5ub25fdXMgKyAiPC9zdHJvbmc+IgogICAgICAgIH1lbHNlIHsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGdldF9hZGRvbl9kZXRhaWxzKCkgewogICAgYXhpb3MKICAgICAgLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgIGdldF9hZGRfb25zOiB0cnVlLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19BRERfT05TX0ZPVU5ELk1TR19DT0RFKSB7CiAgICAgICAgICB0aGlzLnN0cmlwZV9hZGRvbl9wbGFucyA9IFtdOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKXsgCiAgICAgICAgICBpZiAoQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGEpICE9IGZhbHNlICkgewogICAgICAgICAgICB0aGlzLnN0cmlwZV9hZGRvbl9wbGFucyA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIH0KICAgICAgfSAgZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6cmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICB0ZXh0OnJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19lcnJvcl9vY2N1cnJlZF9tc2czJyksCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIH0pOwogICAgICB9KTsKICB9LAogIC8vIGdldF9zdWJzY3JpcHRpb25fZGV0YWlscygpIHsKICAvLyAgIGF4aW9zCiAgLy8gICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAvLyAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAvLyAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgLy8gICAgICAgZ2V0X3BsYW5zOiB0cnVlLAogIC8vICAgICB9KQogIC8vICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAvLyAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAvLyAgICAgICBpZiAoCiAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiICYmCiAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLkRhdGEuZGF0YS5sZW5ndGggPiAwCiAgLy8gICAgICAgKSB7CiAgLy8gICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMgPSByZXNwb25zZS5kYXRhLkRhdGEuZGF0YTsKICAvLyAgICAgICB9IGVsc2UgewogIC8vICAgICAgICAgdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zID0gW107CiAgLy8gICAgICAgfQogIC8vICAgICB9KQogIC8vICAgICAuY2F0Y2goKGUpID0+IHsKICAvLyAgICAgICBjb25zb2xlLmxvZyhlKTsKICAvLyAgICAgICBTd2FsLmZpcmUoewogIC8vICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX29jY3VycmVkX21zZzQnKSwKICAvLyAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgLy8gICAgICAgfSk7CiAgLy8gICAgIH0pOwogIC8vIH0sCiAgY2FuY2VsX3N1YnNjcmlwdGlvbigpIHsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgIGlzX2NhbmNlbDogdHJ1ZSwKICAgICAgICBzdWJzY3JpcHRpb25faWQ6IHRoaXMuc3Vic2NyaXB0aW9uX2lkLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUJTQ1JJUFRJT05fQ0FOQ0VMX1NVQ0NFU1MuTVNHX0NPREUpIHsKICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGNyZWF0ZV9jdXN0b21lcigpIHsKICAgIGlmICh0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9PSAiIiB8fCB0aGlzLnNlbGVjdGVkX3BlcmlvZCA9PSAiIikgewogICAgICBTd2FsKHsKICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ2JpbGxpbmdfc3Vic2NyaWJlX3BsYW5fcGVyaW9kX21zZycpLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgcGVyaW9kID0gdGhpcy5zZWxlY3RlZF9wZXJpb2QudG9Mb3dlckNhc2UoKTsKICAgIGZvciAodmFyIGkgaW4gdGhpcy5zdWJzY3JpcHRpb25fcGxhbnMpIHsKICAgICAgaWYgKHBlcmlvZCA9PSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5wZXJpb2QpIHsKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9PSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pdGVtLm5hbWUKICAgICAgICApIHsKICAgICAgICAgIHRoaXMucGxhbl9pZCA9IHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zW2ldLmlkOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIlBMQU4gTkFNRToiLCB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pdGVtLm5hbWUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIlBMQU4gSUQ6IiwgdGhpcy5zdWJzY3JpcHRpb25fcGxhbnNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHRoaXMucGxhbl9pZCA9PSAiIikgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfcGxhbl9ub3RfZm91bmRfbXNnJyksCiAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYmlsbGluZ19jb250YWN0X2NlbnNlX2FkbWluX21zZycpLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmN1c3RvbWVyX2lkID09ICIiKSB7CiAgICAgIHZhciBjdXN0X2RhdGEgPSB7CiAgICAgICAgbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb250YWN0OiAiIiwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIG5vdGVzOiB7IEV4dHJhOiAiRGV0YWlscyByZWxhdGVkIHRvIGN1c3RvbWVyIiB9LAogICAgICB9OwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjcmVhdGVfY3VzdG9tZXJfaWQ6IHRydWUsCiAgICAgICAgICBkYXRhOiBjdXN0X2RhdGEsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlNUQVRVU19TVUNDRVNTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHZhciBjdXN0b21lcl9kZXRhaWwgPSByZXNwb25zZS5kYXRhLmRhdGEuQ3VzdG9tZXJfRGV0YWlsOwogICAgICAgICAgICB0aGlzLmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5kYXRhLkN1c3RvbWVyX0RldGFpbC5pZDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImN1c3RvbWVyIGlkIix0aGlzLmN1c3RvbWVyX2lkKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVfc3Vic2NyaXB0aW9uKHRoaXMucGxhbl9pZCwgdGhpcy5jdXN0b21lcl9pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX2NyZWF0aW5nX2N1c3RfaWRfbXNnJyksCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY3JlYXRlX3N1YnNjcmlwdGlvbih0aGlzLnBsYW5faWQsIHRoaXMuY3VzdG9tZXJfaWQpOwogICAgfQogIH0sCiAgY3JlYXRlX3N1YnNjcmlwdGlvbihwbGFuX2lkLCBjdXN0b21lcl9pZCkgewogICAgdmFyIHN1Yl9kYXRhID0gewogICAgICBwbGFuX2lkOiBwbGFuX2lkLAogICAgICBjdXN0b21lcl9pZDogY3VzdG9tZXJfaWQsCiAgICB9OwogICAgYXhpb3MKICAgICAgLnBvc3QoYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLCB7CiAgICAgICAgY3JlYXRlX3N1YnNjcmlwdGlvbjogdHJ1ZSwKICAgICAgICBkYXRhOiBzdWJfZGF0YSwKICAgICAgfSkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX1NVQ0NFU1MuTVNHX0NPREUgKSB7CiAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9pZCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5TdWJzY3JpcHRpb25fRGV0YWlsLmlkOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIlN1YnNjcmlwdGlvbiBpZCIsIHJlc3BvbnNlKTsKICAgICAgICAgIHRoaXMuc3RhcnRfcGF5bWVudCh0aGlzLnN1YnNjcmlwdGlvbl9pZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfaW50ZXJuYWxfc2VydmVyX21zZzMnKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2JpbGxpbmdfZXJyb3JfY3JlYXRpbmdfc3Vic2NyaXB0aW9uX21zZycpLAogICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICkgewogICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogIH0sCiAgc3RhcnRfcGF5bWVudChzdWJzY3JpcHRpb25faWQpIHsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAvLyBzdGFydF9wYXltZW50KCl7CiAgICAvLyAgIHZhciB2bSA9IHRoaXM7CiAgICAvLyAgIHZhciBkYXRhID0gewogICAgLy8gICAgIG9yZGVyX2Ftb3VudDogNTAwMDAsCiAgICAvLyAgICAgb3JkZXJfY3VycmVuY3k6ICdJTlInLAogICAgLy8gICAgIG9yZGVyX3JlY2VpcHQ6ICdvcmRlcl9yY3B0aWRfMTEnLAogICAgLy8gICAgIHBheW1lbnRfY2FwdHVyZTogMSwKICAgIC8vICAgICBub3RlczogeydTaGlwcGluZyBhZGRyZXNzJzogJ0JvbW1hbmFoYWxsaSwgQmFuZ2Fsb3JlJ30KICAgIC8vICAgfQogICAgLy8gICBheGlvcy4KICAgIC8vICAgICBwb3N0KAogICAgLy8gICAgICAgYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLAogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBnZW5lcmF0ZV9vcmRlcl9pZDogdHJ1ZSwKICAgIC8vICAgICAgICAgZGF0YTogZGF0YQogICAgLy8gICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuTVNHID09ICJPcmRlciBJRCBjcmVhdGVkIil7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEuT3JkZXJfRGV0YWlsKTsKICAgIC8vICAgICAgICAgdm0ub3JkZXJfaWQgPSByZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbC5pZDsKICAgIC8vICAgICAgICAgdm0uYW1vdW50ID0gcmVzcG9uc2UuZGF0YS5PcmRlcl9EZXRhaWwuYW1vdW50OwogICAgLy8gICAgICAgICBjb25zb2xlLmxvZygicmVhY2hlZCIpOwogICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgIGtleTogcHJvY2Vzcy5lbnYuVlVFX0FQUF9SQVpPUlBBWV9LRVksIC8vIEVudGVyIHRoZSBLZXkgSUQgZ2VuZXJhdGVkIGZyb20gdGhlIERhc2hib2FyZAogICAgICBzdWJzY3JpcHRpb25faWQ6IHN1YnNjcmlwdGlvbl9pZCwgLy8gWW91IGRvbnQgbmVlZCBhbW91bnQvY3VycmVuY3kvb3JkZXJfaWQgd2hlbiBzdWJtaXR0aW5nIHN1YnNjcmlwdGlvbiBpZAogICAgICAvLyAiYW1vdW50IjogdGhpcy5hbW91bnQsIC8vIEFtb3VudCBpcyBpbiBjdXJyZW5jeSBzdWJ1bml0cy4gRGVmYXVsdCBjdXJyZW5jeSBpcyBJTlIuIEhlbmNlLCA1MDAwMCByZWZlcnMgdG8gNTAwMDAgcGFpc2UKICAgICAgLy8gImN1cnJlbmN5IjogIklOUiIsCiAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgIGRlc2NyaXB0aW9uOiAiVGVzdCBUcmFuc2FjdGlvbiIsCiAgICAgIGltYWdlOiByZXF1aXJlKCJAL3BvcnRhbC9hc3NldHMvaW1nL2NlbnNlX2xvZ28ucG5nIiksCiAgICAgIC8vICJvcmRlcl9pZCI6IHRoaXMub3JkZXJfaWQsIC8vVGhpcyBpcyBhIHNhbXBsZSBPcmRlciBJRC4gUGFzcyB0aGUgYGlkYCBvYnRhaW5lZCBpbiB0aGUgcmVzcG9uc2Ugb2YgU3RlcCAxCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJGSU5BTCBQQVkiLCByZXNwb25zZSk7CiAgICAgICAgdmFyIHJhem9ycGF5X3BheW1lbnRfaWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwogICAgICAgIC8vIHZhciByYXpvcnBheV9vcmRlcl9pZCA9IHJlc3BvbnNlLnJhem9ycGF5X29yZGVyX2lkOwogICAgICAgIHZhciByYXpvcnBheV9zdWJzY3JpcHRpb25faWQgPSByZXNwb25zZS5yYXpvcnBheV9zdWJzY3JpcHRpb25faWQ7CiAgICAgICAgdmFyIHJhem9ycGF5X3NpZ25hdHVyZSA9IHJlc3BvbnNlLnJhem9ycGF5X3NpZ25hdHVyZTsKICAgICAgICB2bS5wYXlfc3VjY2Vzc19kYXRhID0ge307CiAgICAgICAgdm0ucGF5X3N1Y2Nlc3NfZGF0YSA9IHsKICAgICAgICAgIHJhem9ycGF5X3BheW1lbnRfaWQ6IHJhem9ycGF5X3BheW1lbnRfaWQsCiAgICAgICAgICAvLyByYXpvcnBheV9vcmRlcl9pZDogcmF6b3JwYXlfb3JkZXJfaWQsCiAgICAgICAgICByYXpvcnBheV9zdWJzY3JpcHRpb25faWQ6IHJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZCwKICAgICAgICAgIHJhem9ycGF5X3NpZ25hdHVyZTogcmF6b3JwYXlfc2lnbmF0dXJlLAogICAgICAgICAgcmF6b3JwYXlfY3VzdG9tZXJfaWQ6IHZtLmN1c3RvbWVyX2lkLAogICAgICAgICAgLy8gb3JkZXJfaWQ6IHRoaXMub3JkZXJfaWQsCiAgICAgICAgICBzdWJzY3JpcHRpb25fc3RhdHVzOiAiYWN0aXZlIiwKICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZDogdm0uc3Vic2NyaXB0aW9uX2lkLAogICAgICAgICAgcGxhbl9pZDogdm0ucGxhbl9pZCwKICAgICAgICAgIHN1YnNjcmlwdGlvbl90eXBlOiB2bS5zZWxlY3RlZF9zdWJzY3JpcHRpb24sCiAgICAgICAgICBzdWJzY3JpcHRpb25fcGVyaW9kOiB2bS5zZWxlY3RlZF9wZXJpb2QsCiAgICAgICAgfTsKICAgICAgICAvLyBjb25zb2xlLmxvZygiUEFZTUVOVCBTVUNDRVNTIERBVEEiLHZtLnBheV9zdWNjZXNzX2RhdGEpOwogICAgICAgIGlmIChPYmplY3Qua2V5cyh2bS5wYXlfc3VjY2Vzc19kYXRhKS5sZW5ndGggIT0gMCkgewogICAgICAgICAgdm0uYWRkX2RldGFpbHNfdG9fc2VydmVyKHZtLnBheV9zdWNjZXNzX2RhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZGlkIG5vdCBzdWNjZWVkIik7CiAgICAgICAgfQogICAgICB9LAogICAgICAvLyAicHJlZmlsbCI6IHsKICAgICAgLy8gICAgICJuYW1lIjogIkdhdXJhdiBLdW1hciIsCiAgICAgIC8vICAgICAiZW1haWwiOiAiZ2F1cmF2Lmt1bWFyQGV4YW1wbGUuY29tIiwKICAgICAgLy8gICAgICJjb250YWN0IjogIis5MTk4NzY1NDMyMTAiCiAgICAgIC8vIH0sCiAgICAgIG5vdGVzOiB7CiAgICAgICAgYWRkcmVzczogIlJhem9ycGF5IENvcnBvcmF0ZSBPZmZpY2UiLAogICAgICB9LAogICAgICB0aGVtZTogewogICAgICAgIGNvbG9yOiAiIzMzOTljYyIsCiAgICAgIH0sCiAgICB9OwogICAgdmFyIHJ6cDEgPSBuZXcgUmF6b3JwYXkob3B0aW9ucyk7CiAgICByenAxLm9uKCJwYXltZW50LmZhaWxlZCIsIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAvLyBjb25zb2xlLmxvZygiZXJyb3IiLCByZXNwb25zZSk7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLmNvZGUpOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5kZXNjcmlwdGlvbik7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLnNvdXJjZSk7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLnN0ZXApOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5yZWFzb24pOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5tZXRhZGF0YS5vcmRlcl9pZCk7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLm1ldGFkYXRhLnBheW1lbnRfaWQpOwogICAgfSk7CiAgICByenAxLm9wZW4oKTsKICAgIC8vIH0KICAgIC8vIH0pCiAgICAvLyAuY2F0Y2goKGUpID0+IHsKICAgIC8vICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICBpZiAoCiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgKSB7CiAgICAvLyAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgfSwKICBhZGRfZGV0YWlsc190b19zZXJ2ZXIoZGF0YSkgewogICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICB2ZXJpZnlfc3Vic2NyaXB0aW9uOiB0cnVlLAogICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1VCU0NSSVBUSU9OX1ZFUklGSUNBVElPTl9TVUNDRVNTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19zdWJzY3JpcHRpb25fcmVnaXN0ZXJfbXNnJyksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXlfc3VjY2Vzc19kYXRhID0ge307CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfaW50ZXJuYWxfc2VydmVyX21zZzQnKSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX29jY3VyX3N1YnNjcmlwdGlvbl9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGF5X3N1Y2Nlc3NfZGF0YSA9IHt9OwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICB9LAogIC8vIHRvZ2dsZV9jaGFuZ2UodmFsdWUpIHsKICAvLyAgIGlmICh2YWx1ZSA9PSAiSU5SIikgewogIC8vICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeSA9IHRoaXMuSU5SOwogIC8vICAgfSBlbHNlIHsKICAvLyAgICAgdGhpcy5jb21tb25fY3VycmVuY3kgPSB0aGlzLlVTRDsKICAvLyAgIH0KICAvLyAgIGlmICh2YWx1ZSA9PSAiSU5SIikgewogIC8vICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeTIgPSB0aGlzLklOUjI7CiAgLy8gICB9IGVsc2UgewogIC8vICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeTIgPSB0aGlzLlVTRDI7CiAgLy8gICB9CiAgLy8gfSwKICBkb3dubG9hZF9pbnZvaWNlKG51bSkgewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgYXhpb3MoewogICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgdXJsOiBhcGlfY2FsbHMuYmlsbGluZ19pbnZvaWNlKCksCiAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICBkYXRhOiB7CiAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBkb3dubG9hZF9maWxlOiB0cnVlLAogICAgICAgIGZpbGVfbmFtZTogdGhpcy5pbnZvaWNlX2RldGFpbHNbbnVtXSwKICAgICAgfSwKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICB9LAogICAgfSkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgIHRoaXMudGx0KCdiaWxsaW5nX2Rvd25sb2FkX2ludm9pY2VfbXNnJykKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGEuZGF0YV0pKTsKICAgICAgICAgIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgIkFzaGlzaCIgKyAiLnBkZiIpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGNhbGxfcGF5bWVudCh0eXBlKSB7CiAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAvLyBjb25zb2xlLmxvZyhkKTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICB2YXIgb3B0aW9ucyA9IHt9OwogICAgaWYgKHR5cGUgPT0gImNvdW50cnlfc2VsZWN0ZWQiKSB7CiAgICAgIGlmICh0aGlzLmNvdW50cnlfbmFtZS5jb2RlID09ICIiKSB7CiAgICAgICAgYWxlcnQodGhpcy50bHQoJ2JpbGxpbmdfc2VsZWN0X2NvdW50cnlfbXNnJykpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5lZGl0X3Byb2ZpbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGZpcnN0X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lLAogICAgICAgICAgICAgIGxhc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxhc3RfbmFtZSwKICAgICAgICAgICAgICBjb3VudHJ5X25hbWU6IHRoaXMuY291bnRyeV9uYW1lLmNvZGUsCiAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucGhvbmVfbm8sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuUFJPRklMRV9VUERBVEVELk1TR19DT0RFICkgewogICAgICAgICAgICAgIC8vICAgU3dhbCh7CiAgICAgICAgICAgICAgLy8gICB0aXRsZTogIlVwZGF0ZWQgU3VjY2Vzc2Z1bGx5ISEiLAogICAgICAgICAgICAgIC8vICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIC8vICAgdGV4dDogIllvdXIgcHJvZmlsZSBoYXMgYmVlbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4iLAogICAgICAgICAgICAgIC8vICAgdGltZXI6MjAwMCwKICAgICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2Vzcyh0aGlzLnRsdCgnYmlsbGluZ19wcm9maWxlX3VwZGF0ZWRfbXNnJykpOwogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJjb3VudHJ5X25hbWUiLCB0aGlzLmNvdW50cnlfbmFtZS5jb2RlKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQoIiNjb3VudHJ5bW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pbm5lclRleHQgPT0gIlBheSIpIHsKICAgICAgaWYgKHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwID09ICIiKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdiaWxsaW5nX3NlbGVjdF9hbW91bnRfbXNnMScpKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwLnNsaWNlKDIsIC0xMCk7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCAqIDExODsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cDsKICAgICAgICBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgLz0gNzA7CiAgICAgICAgfQogICAgICAgIHBheV9hbW91bnQodGhpcy5jdXJyZW5jeV9hbW91bnQsIHRoaXMucGF5bWVudF9jdXJyZW5jeSwgIlRvcCBVcCIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAuc2xpY2UoMik7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCAqIDEwMDsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cDsKCiAgICAgICAgcGF5X2Ftb3VudCh0aGlzLmN1cnJlbmN5X2Ftb3VudCwgdGhpcy5wYXltZW50X2N1cnJlbmN5LCAiVG9wIFVwIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlubmVyVGV4dCA9PSAiU3Vic2NyaWJlIikgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGlmICh0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnYmlsbGluZ19zZWxlY3RfYW1vdW50X21zZzInKSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPQogICAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMiwgLTEwKTsKICAgICAgICB0aGlzLmN1cnJlbmN5X2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uICogMTE4OwogICAgICAgIHRoaXMudG9wX3VwX2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uOwogICAgICAgIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICAgIHRoaXMudG9wX3VwX2Ftb3VudCAvPSA3MDsKICAgICAgICB9CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19zdWJzY3JpcHRpb25fdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIFBsYW5BbW91bnQ6IHRoaXMudG9wX3VwX2Ftb3VudCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCkgewogICAgICAgICAgICAgIHBheV9hbW91bnQocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCwgIiIsICJTdWJzY3JpYmUiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLkVycm9yKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEuRXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPQogICAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMik7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiAqIDEwMDsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19zdWJzY3JpcHRpb25fdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X2JvdG5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIFBsYW5BbW91bnQ6IHRoaXMuY3VycmVuY3lfYW1vdW50LAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLlN1YnNjcmlwdGlvbklkKSB7CiAgICAgICAgICAgICAgcGF5X2Ftb3VudChyZXNwb25zZS5kYXRhLlN1YnNjcmlwdGlvbklkLCAiIiwgIlN1YnNjcmliZSIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuRXJyb3IpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UuZGF0YS5FcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcGF5X2Ftb3VudChhbW91bnQsIGN1cnJlbmN5X3R5cGUsIHBheW1lbnRfdHlwZSkgewogICAgICBpZiAocGF5bWVudF90eXBlID09ICJTdWJzY3JpYmUiKSB7CiAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgIGtleTogInJ6cF90ZXN0X1NuRFRhUG5uY2ZsaUR0IiwKICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZDogYW1vdW50LCAvL1RoaXMgaXMgYWN0dWFsbHkgc3Vic2NyaXB0aW9uIElECiAgICAgICAgICAvLyBzdWJzY3JpcHRpb25fY2FyZF9jaGFuZ2U6IDEsCiAgICAgICAgICBuYW1lOiAiQ2Vuc2UgQUkiLAogICAgICAgICAgZGVzY3JpcHRpb246ICJJbnN0aWxsIEludGVsbGlnZW5jZSIsCiAgICAgICAgICBpbWFnZTogIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIiwgLy8gQ09NUEFOWSBMT0dPCiAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZCk7CiAgICAgICAgICAgIC8vIHZhciBjb250YWN0ID0gJCgnI2NvbnRhY3RbdHlwZT0idGVsIl0nKS52YWx1ZTsKICAgICAgICAgICAgLy8gdmFyIGVtYWlsID0gJCgnI2VtYWlsW3R5cGU9ImVtYWlsIl0nKS52YWx1ZTsKICAgICAgICAgICAgdm0ucGF5bWVudGlkID0gcmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZDsKICAgICAgICAgICAgdm0udmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uID0gIiI7CiAgICAgICAgICB9LAogICAgICAgICAgcHJlZmlsbDogewogICAgICAgICAgICBuYW1lOiAiIiwgLy8gcGFzcyBjdXN0b21lciBuYW1lCiAgICAgICAgICAgIGVtYWlsOiAiIiwgLy8gY3VzdG9tZXIgZW1haWwKICAgICAgICAgICAgY29udGFjdDogIiIsIC8vY3VzdG9tZXIgcGhvbmUgbm8uCiAgICAgICAgICB9LAogICAgICAgICAgbm90ZXM6IHsKICAgICAgICAgICAgYWRkcmVzczogImFkZHJlc3MiLCAvL2N1c3RvbWVyIGFkZHJlc3MKICAgICAgICAgIH0sCiAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICBjb2xvcjogIiMyODM3NzciLCAvLyBzY3JlZW4gY29sb3IKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgICBsb2FkX2NoZWNrb3V0KCk7CiAgICAgIH0gZWxzZSBpZiAocGF5bWVudF90eXBlID09ICJQYXkiKSB7CiAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgIGtleTogInJ6cF90ZXN0X1NuRFRhUG5uY2ZsaUR0IiwKICAgICAgICAgIGFtb3VudDogYW1vdW50LCAvLyBFeGFtcGxlOiAyMDAwIHBhaXNlID0gSU5SIDIwCiAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3lfdHlwZSwKICAgICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkluc3RpbGwgSW50ZWxsaWdlbmNlIiwKICAgICAgICAgIGltYWdlOiAiL2ltZy9jZW5zZV9pbWFnZS5wbmciLCAvLyBDT01QQU5ZIExPR08KCiAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZCk7CiAgICAgICAgICAgIHZhciBjb250YWN0ID0gJCgnI2NvbnRhY3RbdHlwZT0idGVsIl0nKS52YWx1ZTsKICAgICAgICAgICAgdmFyIGVtYWlsID0gJCgnI2VtYWlsW3R5cGU9ImVtYWlsIl0nKS52YWx1ZTsKICAgICAgICAgICAgdm0ucGF5bWVudGlkID0gcmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZDsKICAgICAgICAgICAgdm0udmFsdWVfY3VycmVuY3lfdG9wX3VwID0gIiI7CiAgICAgICAgICB9LAogICAgICAgICAgcHJlZmlsbDogewogICAgICAgICAgICBuYW1lOiAiIiwgLy8gcGFzcyBjdXN0b21lciBuYW1lCiAgICAgICAgICAgIGVtYWlsOiAiIiwgLy8gY3VzdG9tZXIgZW1haWwKICAgICAgICAgICAgY29udGFjdDogIiIsIC8vY3VzdG9tZXIgcGhvbmUgbm8uCiAgICAgICAgICB9LAogICAgICAgICAgbm90ZXM6IHsKICAgICAgICAgICAgYWRkcmVzczogImFkZHJlc3MiLCAvL2N1c3RvbWVyIGFkZHJlc3MKICAgICAgICAgIH0sCiAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICBjb2xvcjogIiMyODM3NzciLCAvLyBzY3JlZW4gY29sb3IKICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgICAgICBsb2FkX2NoZWNrb3V0KCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGxvYWRfY2hlY2tvdXQoKSB7CiAgICAgIHZhciByenAxID0gbmV3IFJhem9ycGF5KG9wdGlvbnMpOwogICAgICByenAxLm9wZW4oKTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0KICB9LAogIGNoZWNrX3JldGFpbF9wbGFuKHZhbHVlLCBpZCkgewogICAgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlID0gbnVsbDsKICB9LAogIHN1YnNjcmliZV9yZXRhaWxfcGxhbigpIHsKICAgIC8vIGxldCBzdWJzY3JpcHRpb25fZGF0YSA9IHsKICAgIC8vICAgc3Vic2NyaXB0aW9uX3BsYW46IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCwKICAgIC8vICAgYmlsbGluZ19jeWNsZTogdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlLAogICAgLy8gfTsKICAgIGlmICh0aGlzLmNoZWNrX3JldGFpbF9zaG9waWZ5X2Zvcm1fdmFsaWRhdGlvbnMpIHsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdWJzY3JpYmVfc2hvcGlmeV9iaWxsaW5nKCksIHsKICAgICAgICAgIHN1YnNjcmlwdGlvbl9wbGFuOiB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQsCiAgICAgICAgICBiaWxsaW5nX2N5Y2xlOiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGlzX3BhaWRfcGxhbjogdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU1RBVFVTX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPT0gIkFubnVhbCIpIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBCb29sZWFuKHJlc3BvbnNlLmRhdGEuZGF0YSkgJiYKICAgICAgICAgICAgICAgIEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEuYXBwU3Vic2NyaXB0aW9uQ3JlYXRlKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOgogICAgICAgICAgICAgICAgICAgIHRoaXMudGx0KCdiaWxsaW5nX3JlZGlyZWN0X3Nob3BpZnlfbWVyY2hhbnRfbXNnJyksCiAgICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPQogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhLmFwcFN1YnNjcmlwdGlvbkNyZWF0ZS5jb25maXJtYXRpb25Vcmw7CiAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIkRhc2hib2FyZFNpZGViYXJEaXNhYmxlIixmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiU2V0dGluZ1RvcG5hdmJhckRpc2FibGUiLGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXRhaWxfcGF5bWVudF90eXBlID09ICJNb250aGx5IikgewogICAgICAgICAgICAgIGlmIChCb29sZWFuKHJlc3BvbnNlLmRhdGEuZGF0YS5jb25maXJtYXRpb25fdXJsKSkgewogICAgICAgICAgICAgICAgLy8gU3dhbCh7CiAgICAgICAgICAgICAgICAvLyAgIHRpdGxlOiAiUGxlYXNlIHdhaXQgd2hpbGUgd2UgcmVkaXJlY3QgWW91IHRvIHRoZSBTaG9waWZ5IE1lcmNoYW50IFVJISIsCiAgICAgICAgICAgICAgICAvLyAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgLy8gICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAvLyAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgLy8gICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJEYXNoYm9hcmRTaWRlYmFyRGlzYWJsZSIsZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlNldHRpbmdUb3BuYXZiYXJEaXNhYmxlIixmYWxzZSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UuZGF0YS5kYXRhLmNvbmZpcm1hdGlvbl91cmw7CiAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19lcnJvcl9vY2N1cnJlZF9tc2c1JyksCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdiaWxsaW5nX3N3YWxfdHJ5X2FnYWluX21zZzEnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfc3dhbF9zdWNjZXNzX21zZycpLAogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2JpbGxpbmdfc3Vic2NyaWJlX2ZyZWVfcGxhbl9tc2cnKSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgIHRpdGxlOnJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OnJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfZXJyb3Jfb2NjdXJyZWRfbXNnNicpLAogICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnYmlsbGluZ19zd2FsX3RyeV9hZ2Fpbl9tc2cyJyksCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfc2VsZWN0X2FsbF9yZXF1aXJlZF92YWx1ZV9tc2cnKSwKICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICB0aW1lcjozMDAwCiAgICAgIH0pOwogICAgfQogIH0sCiAgc3VibWl0X3N0cmlwZV9jaGVja291dCgpIHsKICAgIGlmKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCAhPT0gbnVsbCAmJiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgIT09IG51bGwpewogICAgICAvLyBsZXQgY2hvc2VuX3BsYW5fZGF0YSA9IHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZT09PSJNb250aGx5IiB8fCB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubmFtZT09PSJXaGF0c0FwcCIgPyB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMuZmluZCgoaXRlbSA9PiAoaXRlbS5hbW91bnQvMTAwID09PSB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubW9udGhseV9jaGFyZ2UpICYmIChpdGVtLmN1cnJlbmN5ID09PSB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeSkpKSAgOiB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMuZmluZCgoaXRlbSA9PiAoaXRlbS5hbW91bnQvMTAwID09PSB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuYW5udWFsX2NoYXJnZS5hY3R1YWxfY2hhcmdlKSAmJiAgKGl0ZW0uY3VycmVuY3kgPT09IHRoaXMuc2hvcF9iYXNlX2N1cnJlbmN5KSkpIAogICAgICAvLyBjb25zb2xlLmxvZygicmV0YWlsX3BheW1lbnRfdHlwZSIsdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlKTsKICAgICAgCiAgICAgIHZhciBjaG9zZW5fcGxhbl9kYXRhID0gewogICAgICAgICJwbGFuX25hbWUiIDogdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LAogICAgICAgICJ0eXBlIjogdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlLnR5cGUsCiAgICAgICAgIm5pY2tuYW1lIiA6IHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZS5uaWNrbmFtZSwKICAgICAgICAicHJpY2UiIDogdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlLnByaWNlLAogICAgICAgICJjdXJyZW5jeSI6IHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZS5jdXJyZW5jeSwKICAgICAgICAiaWQiOiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUucHJpY2VfaWQKICAgICAgfQogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgICAgZ2VuZXJhdGVfbmV3X3JlcXVlc3Q6IHRydWUsCiAgICAgICAgICBjaG9zZW5fcGxhbl9kYXRhOiBjaG9zZW5fcGxhbl9kYXRhLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICByZXF1ZXN0X3R5cGU6ICJQbGFuIiwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJEYXNoYm9hcmRTaWRlYmFyRGlzYWJsZSIsZmFsc2UpOwogICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoIlNldHRpbmdUb3BuYXZiYXJEaXNhYmxlIixmYWxzZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAvLyB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfZXJyb3Jfb2NjdXJyZWRfbXNnNycpLAogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX29jY3VycmVkX21zZzgnKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfWVsc2UgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2JpbGxpbmdfc2VsZWN0X2FsbF9maWVsZF9tc2cnKSwKICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0sCiAgc3VibWl0X3N0cmlwZV9hZGRvbl9jaGVja291dCgpIHsKICAgIGlmKHRoaXMuc2VsZWN0ZWRfYWRkb25fdHlwZSA9PT0gbnVsbCB8fHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbiA9PT0gbnVsbCApewogICAgU3dhbCh7CiAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX3NlbGVjdF9hbGxfZmllbGRfbXNnMScpLAogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGNob3Nlbl9wbGFuX2RhdGEgPSB7CiAgICAgICJwbGFuX25hbWUiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl9wbGFuLlR5cGUgLAogICAgICAicHJpY2UiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl90eXBlLnByaWNlLAogICAgICAiY3VycmVuY3kiOiB0aGlzLnNlbGVjdGVkX2FkZG9uX3R5cGUuY3VycmVuY3ksCiAgICAgICJpZCI6IHRoaXMuc2VsZWN0ZWRfYWRkb25fdHlwZS5wcmljZV9pZAogICAgfQoKICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgICBnZW5lcmF0ZV9uZXdfcmVxdWVzdDogdHJ1ZSwKICAgICAgICAgIGNob3Nlbl9wbGFuX2RhdGE6IGNob3Nlbl9wbGFuX2RhdGEsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIHJlcXVlc3RfdHlwZTogIkFkZE9uIgogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgLy8gdGl0bGU6IHRoaXMudGx0KCdiaWxsaW5nX2Vycm9yX29jY3VycmVkX21zZzknKSwKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnYmlsbGluZ19lcnJvcl9vY2N1cnJlZF9tc2cxMCcpLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgfSwKICBnZXRfc2hvcF9iYXNlX2N1cnJlbmN5KCl7CiAgICBheGlvcwogICAgICAucG9zdCgKICAgICAgICBhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLAogICAgICAgIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGlzX2dldDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGxldCB3ZWJfZnJhbWV3b3JrID0gdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yazsKICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSAhPSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUgJiYKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeSA9IHJlc3BvbnNlLmRhdGEuZGF0YVt3ZWJfZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10uYmFzZV9jdXJyZW5jeS52YWx1ZTsKICAgICAgICAgIHRoaXMuc2hvcF9iYXNlX2N1cnJlbmN5ID0gdGhpcy5hY2NlcHRhYmxlX3Nob3BfYmFzZV9jdXJyZW5jaWVzLmluY2x1ZGVzKHRoaXMuc2hvcF9iYXNlX2N1cnJlbmN5KSA/ICB0aGlzLnNob3BfYmFzZV9jdXJyZW5jeS50b0xvd2VyQ2FzZSgpIDogJ3VzZCcKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5zaG9wX2Jhc2VfY3VycmVuY3kgPSAndXNkJzsKICAgICAgfSkKICB9LAogIH0sCn07Cg=="},null]}