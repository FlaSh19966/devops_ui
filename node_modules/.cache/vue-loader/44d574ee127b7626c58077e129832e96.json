{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/WhatsappChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/WhatsappChat.vue","mtime":1659334208864},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IHsgU29ja2V0LCBQcmVzZW5jZSB9IGZyb20gInBob2VuaXgiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBWdWVQaG9uZU51bWJlcklucHV0IGZyb20gInZ1ZS1waG9uZS1udW1iZXItaW5wdXQiOwppbXBvcnQgc3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiV2hhdHNBcHBDaGF0IiwKICBjb21wb25lbnRzOiB7CiAgICBNdWx0aXNlbGVjdCwKICAgIFZ1ZVBob25lTnVtYmVySW5wdXQKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93X3NwaW5uZXI6IGZhbHNlLAogICAgICBoaXN0b3J5OiBbXSwKICAgICAgY29udGFjdF9saXN0OiBbXSwKICAgICAgcGhvbmVubzogbnVsbCwKICAgICAgY3VzdG9tZXJfbmFtZTogIiIsCiAgICAgIGNoYXRfZGV0YWlsczogW10sCiAgICAgIHNlYXJjaF92YWx1ZTogIiIsCiAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIHNlc3Npb25fdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgIGluaXRpYWxfbWVzc2FnZV9sb2FkOiBmYWxzZSwKICAgICAgaXNfcHJvZmlsZV9zZXR1cDogZmFsc2UsCiAgICAgIG1lc3NhZ2VfcGFnaW5hdGlvbjogewogICAgICAgIGlzX3Njcm9sbF91cDogZmFsc2UsCiAgICAgICAgcGVyX3BhZ2U6IDUsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9yZWNvcmRzOiAxMCwKICAgICAgICBwYWdlX3JlY29yZF9mZXRjaGVkOiBbXQogICAgICB9LAogICAgICBpc19wYWdpbmF0ZWRfY2FsbDogZmFsc2UsCiAgICAgIGRlZmF1bHRfd2hhdHNhcHBfc3RhdHVzOiAiSGV5IHRoZXJlISBJIGFtIHVzaW5nIHdoYXRzYXBwIiwKICAgICAgZWRpdF9zdGF0dXM6IGZhbHNlLAogICAgICBzY3JvbGxfc3Bpbm5lcl9jaGF0OiBmYWxzZSwKICAgICAgc2hvd19zZW5kX21lc3NhZ2U6IGZhbHNlLAogICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogZmFsc2UsCiAgICAgIGlzX3Nob3dfbWVzc2FnZV9kaXNhYmxlZDogdHJ1ZSwKICAgICAgd2hhdHNhcHBfcHJvZmlsZTogIiIsCiAgICAgIGVkaXRfZW1haWw6IGZhbHNlLAogICAgICBlZGl0X2FkZHJlc3M6IGZhbHNlLAogICAgICBlZGl0X2Rlc2NyaXB0aW9uOiBmYWxzZSwKICAgICAgZWRpdF93ZWJzaXRlOiBmYWxzZSwKICAgICAgZW1haWxfYWRkcmVzczogIiIsCiAgICAgIGJ1c2luZXNzX2FkZHJlc3M6ICIiLAogICAgICBkZXNjcmlwdGlvbjogIiIsCiAgICAgIHdlYnNpdGVfdXJsOiAiIiwKICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICBjaGFubmVsOiBudWxsLAogICAgICBjaGF0X3NvY2tldDogbnVsbCwKICAgICAgc3VwcG9ydF9jaGFubmVsOiBudWxsLAogICAgICBtZXNzYWdlX3RvX3NlbmQ6IG51bGwsCiAgICAgIHdoYXRzYXBwX3N0YXR1czogIiIsCiAgICAgIGluZGV4X3VwZGF0ZTogbnVsbCwKICAgICAgc2Vjb25kX3dlYnNpdGU6IGZhbHNlLAogICAgICBzZWxlY3RlZF9maWxlczogIiIsCiAgICAgIG1vdXNlX2hvdmVyX3RleHQ6IGZhbHNlLAogICAgICB2ZXJ0aWNhbF90eXBlczogWwogICAgICAgICJBdXRvbW90aXZlIiwKICAgICAgICAiQmVhdXR5IiwKICAgICAgICAiU3BhIGFuZCBTYWxvbiIsCiAgICAgICAgIkNsb3RoaW5nIGFuZCBBcHBhcmVsIiwKICAgICAgICAiRWR1Y2F0aW9uIiwKICAgICAgICAiRW50ZXJ0YWlubWVudCIsCiAgICAgICAgIkV2ZW50IFBsYW5uaW5nIGFuZCBTZXJ2aWNlIiwKICAgICAgICAiRmluYW5jZSBhbmQgQmFua2luZyIsCiAgICAgICAgIkZvb2QgYW5kIEdyb2NlcnkiLAogICAgICAgICJQdWJsaWMgU2VydmljZSIsCiAgICAgICAgIkhvdGVsIGFuZCBMb2RnaW5nIiwKICAgICAgICAiTWVkaWNhbCBhbmQgSGVhbHRoIiwKICAgICAgICAiTm9uLXByb2ZpdCIsCiAgICAgICAgIlByb2Zlc3Npb25hbCBTZXJ2aWNlcyIsCiAgICAgICAgIlNob3BwaW5nIGFuZCBSZXRhaWwiLAogICAgICAgICJUcmF2ZWwgYW5kIFRyYW5zcG9ydGF0aW9uIiwKICAgICAgICAiUmVzdGF1cmFudCIsCiAgICAgICAgIk90aGVyIgogICAgICBdLAogICAgICBjdXJyZW50X2NvbnRhY3RfbnVtYmVyOiBudWxsLAogICAgICBpc19jb250YWN0X2xpc3Q6IGZhbHNlLAogICAgICBjdXJyZW50X2NvbnRhY3RfaW5kZXg6IG51bGwsCiAgICAgIHNlYXJjaF9pbl9jb250YWN0X2xpc3Q6ICIiLAogICAgICBhbGxfY29udGFjdF9saXN0OiBbXSwKICAgICAgc3RhcnRfbmV3X2NvbnZfZGF0YTogewogICAgICAgIHN0YXJ0X25ld19jb252OiBmYWxzZSwKICAgICAgICBpc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZDogZmFsc2UKICAgICAgfSwKICAgICAgYWxsX2NvbnRhY3RfcGFnaW5hdGlvbjogewogICAgICAgIHBlcl9wYWdlOiAxMCwKICAgICAgICBwYWdlX25vOiAxLAogICAgICAgIHRvdGFsX3JlY29yZHM6IDEwCiAgICAgIH0sCiAgICAgIHNlbmRfYXR0YWNobWVudF9kZXRhaWw6IHsKICAgICAgICBtZWRpYV9maWxlX25hbWU6IG51bGwsCiAgICAgICAgbWVkaWFfZmlsZTogbnVsbCwKICAgICAgICBzaG93X3ByZXZpZXc6IGZhbHNlLAogICAgICAgIG1lZGlhX2NvbnRlbnRfdHlwZTogbnVsbCwKICAgICAgICBtZWRpYV90eXBlOiBudWxsLAogICAgICAgIHNlbmRfbWVkaWE6IHRydWUsCiAgICAgICAgZG9jdW1lbnRfY29udGVudDogbnVsbCwKICAgICAgICBtZWRpYV9jYXB0aW9uOiBudWxsCiAgICAgIH0sCiAgICAgIGN1cnJlbnRfZnVsbHNjcmVlbl9pbWFnZV9zcmM6IG51bGwsCiAgICAgIGFkZF9uZXdfY29udGFjdDogewogICAgICAgIHBob25lX251bWJlcjogbnVsbCwKICAgICAgICBpc19hZGRfY29udGFjdDogdHJ1ZSwKICAgICAgICBjb250YWN0X25hbWU6IG51bGwsCiAgICAgICAgZm9ybWF0dGVkTnVtYmVyOiBudWxsCiAgICAgIH0sCiAgICAgIGFkZF9uZXdfY29udGFjdF9mb3JtYXR0ZWRfcGhvbmVfbnVtYmVyOiBudWxsLAogICAgICBmaWxlX2V4dGVuc2lvbnM6IHsKICAgICAgICBhbGxfYWxsb3dlZF9maWxlX2V4dGVuc2lvbnM6IFsKICAgICAgICAgICJpbWFnZS9wbmciLAogICAgICAgICAgImltYWdlL2pwZWciLAogICAgICAgICAgImFwcGxpY2F0aW9uL3BkZiIsCiAgICAgICAgICAidGV4dC9wbGFpbiIsCiAgICAgICAgICAiYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsIiwKICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCIsCiAgICAgICAgICAiYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQiLAogICAgICAgICAgImFwcGxpY2F0aW9uL21zd29yZCIsCiAgICAgICAgICAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQiLAogICAgICAgICAgInRleHQvY3N2IgogICAgICAgIF0sCiAgICAgICAgaW1hZ2VfZmlsZV9leHRlbnNpb25zOiBbImltYWdlL3BuZyIsICJpbWFnZS9qcGVnIl0sCiAgICAgICAgZG9jdW1lbnRfZmlsZV9leHRlbnNpb25zOiBbCiAgICAgICAgICAiYXBwbGljYXRpb24vcGRmIiwKICAgICAgICAgICJ0ZXh0L3BsYWluIiwKICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwiLAogICAgICAgICAgImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IiwKICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCIsCiAgICAgICAgICAiYXBwbGljYXRpb24vbXN3b3JkIiwKICAgICAgICAgICJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCIsCiAgICAgICAgICAidGV4dC9jc3YiCiAgICAgICAgXQogICAgICB9LAogICAgICB3aGF0c2FwcF90ZW1wbGF0ZXM6IHsKICAgICAgICB0ZW1wbGF0ZXNfbGlzdDogW10sCiAgICAgICAgcGFnaW5hdGlvbl9kYXRhOiB7CiAgICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgdG90YWxfcmVjb3JkczogMTAKICAgICAgICB9LAogICAgICAgIHNlbGVjdGVkX3RlbXBsYXRlOiBudWxsLAogICAgICAgIHByZXZpZXdfdGVtcGxhdGVfZGF0YTogbnVsbAogICAgICB9LAogICAgICBjb250YWN0X2NzdjogewogICAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgRmlsZSIsCiAgICAgICAgZmlsZV9jb250ZW50OiBudWxsLAogICAgICAgIGZpbGVfc2VsZWN0ZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIHdoYXRzYXBwX2Zvcm1hdF9kaWN0OiB7CiAgICAgICAgIioiOiBbIjxzdHJvbmc+IiwgIjwvc3Ryb25nPiJdLAogICAgICAgIF86IFsiPGk+IiwgIjwvaT4iXSwKICAgICAgICAifiI6IFsiPHM+IiwgIjwvcz4iXSwKICAgICAgICAiYGBgIjogWyI8dHQ+IiwgIjwvdHQ+Il0KICAgICAgfSwKICAgICAgd2hhdHNhcHBfZm9ybWF0aW5nX2xpc3Q6IFsiKiIsICJfIiwgIn4iLCAiYGBgIl0KICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgdG90YWxfcGFnZXNfbG9hZGVkKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyAqIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlID49CiAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcwogICAgICApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgbWVzc2FnZV90ZXh0X2JveF9wbGFjZWhvbGRlcigpIHsKICAgICAgcmV0dXJuICJTZW5kIGEgbWVzc2FnZSB0byB1c2VyIjsKICAgIH0sCiAgICB0b3RhbF9jb250YWN0X2xvYWRlZCgpIHsKICAgICAgaWYgKAogICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wYWdlX25vICoKICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSA+PQogICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi50b3RhbF9yZWNvcmRzCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmdldF9jb250YWN0X2xpc3QodHJ1ZSk7CiAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgIGNvbnN0IHZtID0gdGhpczsKICAgICQod2luZG93KS5iaW5kKCJtb3VzZXdoZWVsIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSA+PSAwKSB7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0ubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKICAgIC8vIHZhciBsYXN0U2Nyb2xsVG9wID0gMDsKICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAvLyAgICJzY3JvbGwiLAogICAgLy8gICBmdW5jdGlvbiAoZXYpIHsKICAgIC8vICAgICBpZiAoZXYudGFyZ2V0LmlkID09PSAic2Nyb2xsaW5nLWRpdi13aGF0c2FwcCIpIHsKICAgIC8vICAgICAgIGNvbnNvbGUubG9nKGV2KQogICAgLy8gICAgICAgdmFyIHN0ID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7IC8vIENyZWRpdHM6ICJodHRwczovL2dpdGh1Yi5jb20vcWVyZW15L3NvL2Jsb2IvbWFzdGVyL3NvLmRvbS5qcyNMNDI2IgogICAgLy8gICAgICAgaWYgKHN0ID4gbGFzdFNjcm9sbFRvcCl7CiAgICAvLyAgICAgICAgIHZtLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPSBmYWxzZTsKICAgIC8vICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCJTY3JvbGxpbmcgVXAiKQogICAgLy8gICAgICAgICB2bS5tZXNzYWdlX3BhZ2luYXRpb24uaXNfc2Nyb2xsX3VwID0gdHJ1ZTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGxhc3RTY3JvbGxUb3AgPSBzdCA8PSAwID8gMCA6IHN0OwoKICAgIC8vICAgICAgIC8vIHZtLnNjcm9sbFBvc2l0aW9uID0gZXYudGFyZ2V0WyJzY3JvbGxUb3AiXTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0sCiAgICAvLyAgIHRydWUKICAgIC8vICk7CiAgICAkKCIjc2hvd0ltYWdlTW9kYWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24oZSkgewogICAgICB2bS5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gbnVsbDsKICAgIH0pOwogICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbihlKSB7CiAgICAgIHZtLmVtcHR5X3VwbG9hZF9jc3ZfY29udGFjdHMoKTsKICAgIH0pOwogICAgJCgnW2RhdGEtdG9nZ2xlPSJwb3BvdmVyIl0nKS5wb3BvdmVyKHsKICAgICAgaHRtbDogdHJ1ZSwKICAgICAgdGl0bGU6ICJMZWdlbmQgZm9yIENvbnRhY3RzIiwKICAgICAgY29udGVudDogYDxzcGFuIHN0eWxlPSdjb2xvcjojMjVhZjAyO2ZvbnQtc2l6ZTogbGFyZ2VyOyc+JiN4MjVDRjs8L3NwYW4+IDxzcGFuPiAgVGhpcyBjb250YWN0IGlzIG9uIHdoYXRzYXBwPC9zcGFuPiA8YnI+CiAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0nY29sb3I6I2ZmNDc0Nztmb250LXNpemU6IGxhcmdlcjsnPiYjeDI1Q0Y7PC9zcGFuPiA8c3Bhbj4gVGhpcyBjb250YWN0IGlzIG5vdCBvbiB3aGF0c2FwcDwvc3Bhbj4gPGJyPgogICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9J2NvbG9yOiNmZmMzNDc7Zm9udC1zaXplOiBsYXJnZXI7Jz4mI3gyNUNGOzwvc3Bhbj4gPHNwYW4+IFdlIGRvbid0IGtub3cgeWV0IHdoZXRoZXIgdGhpcyBjb250YWN0IGlzIG9uIHdoYXRzYXBwPC9zcGFuPmAKICAgIH0pOwogICAgYXhpb3MucG9zdChhcGlfY2FsbHMuaW5pdGlhbGl6ZV93aGF0c2FwcF90b3BpYygpLCAKICAgIHsKICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6ICIxMDAiLAogICAgICB0ZXN0OiBidG9hKCJ0ZXN0X3BhcmFtYXRlciIpCiAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSkKICAgICAgLy8gdGhpcy5jaGF0X2dyb3VwX25hbWUgPSByZXNwb25zZS5kYXRhLmNoYXRfZ3JvdXBfbmFtZTsKICAgICAgLy8gdGhpcy5saXZlX2NoYXRfdG9rZW4gPSByZXNwb25zZS5kYXRhLnRva2VuOwogICAgICAvLyB0aGlzLmxpdmVfY2hhdF9vbiA9IHRydWU7CiAgICAgIHRoaXMuY2hhdF9zb2NrZXQgPSBuZXcgU29ja2V0KAogICAgICAgIHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwKICAgICAgICB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgd2hhdHNhcHA6ICJ0cnVlIiwKICAgICAgICAgICAgZWxpeGlyX3Rva2VuIDogcmVzcG9uc2UuZGF0YS5lbGl4aXJfdG9rZW4sCiAgICAgICAgICAgIHRva2VuOiB0aGlzLnNlc3Npb25fdG9rZW4sCiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICApOwogICAgICB0aGlzLmNoYXRfc29ja2V0LmNvbm5lY3QoKTsKICAgICAgdGhpcy5jaGFubmVsID0gdGhpcy5jaGF0X3NvY2tldC5jaGFubmVsKAogICAgICAgICJ3aGF0c2FwcDoiICsgdGhpcy5jb21wYW55X2lkCiAgICAgICk7CiAgICAgIHRoaXMuY2hhbm5lbC5qb2luKCk7CiAgICAgIHRoaXMuY2hhbm5lbC5vbigibmV3X3doYXRzYXBwX21lc3NhZ2UiLCAocmVzKSA9PiB7CiAgICAgICAgaWYocmVzLmNvbXBhbnlfaWQgPT09IHRoaXMuY29tcGFueV9pZCl7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAvLyBpZighcmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygidXNlciBib3QgY29udmVyc2F0aW9uIikKICAgICAgICAgICAgbGV0IGNvbnRhY3RfaW5kZXggPSB0aGlzLmNvbnRhY3RfbGlzdC5maW5kSW5kZXgoKGl0ZW0pID0+IHtyZXR1cm4gaXRlbS53aGF0c2FwcF9waG9uZV9udW1iZXIgPT09IHJlcy53aGF0c2FwcF9waG9uZV9udW1iZXJ9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCFyZXMuaXNfYm90X2NvbnZlcnNhdGlvbl9yZWFsdGltZSl7CiAgICAgICAgICAgIC8vIGxldCBsYXRlc3RfbWVzc2FnZTsKICAgICAgICAgICAgLy8gaWYocmVzLmlzX2JvdF9jb252ZXJzYXRpb25fcmVhbHRpbWUpewogICAgICAgICAgICAvLyAgIGxldCBpc190ZXh0ID0gIHJlcy5CT1RSZXNwb25zZS5maW5kKChpdGVtKSA9PiBpdGVtLnRleHQgIT0gbnVsbCksCiAgICAgICAgICAgIC8vICAgaXNfcHJvZHVjdCA9IHJlcy5CT1RSZXNwb25zZS5maW5kKChpdGVtKSA9PiAoaXRlbS50ZXh0ID09IG51bGwgJiYgaXRlbS5wcm9kdWN0cykpOwogICAgICAgICAgICAvLyAgIGlmKEJvb2xlYW4oaXNfdGV4dCkpIHsKICAgICAgICAgICAgLy8gICAgIGxhdGVzdF9tZXNzYWdlID0gaXNfdGV4dC50ZXh0OwogICAgICAgICAgICAvLyAgIH0gZWxzZSBpZihCb29sZWFuKGlzX3Byb2R1Y3QpKSB7CiAgICAgICAgICAgIC8vICAgICBsYXRlc3RfbWVzc2FnZSA9ICJQcm9kdWN0IGJvdCByZXNwb25zZSIKICAgICAgICAgICAgLy8gICB9IGVsc2UgewogICAgICAgICAgICAvLyAgICAgbGF0ZXN0X21lc3NhZ2UgPSBudWxsCiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcywgImVsc2UiLCBjb250YWN0X2luZGV4KQogICAgICAgICAgICAgIGlmIChjb250YWN0X2luZGV4ICE9IC0xKXsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmxhc3RfYm90X3Jlc3BvbnNlLnRleHQgPSByZXMud2hhdHNhcHBfbWVzc2FnZTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3RbY29udGFjdF9pbmRleF0ubmV3X21lc3NhZ2VfY291bnQgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSB0aGlzLmFycmF5X21vdmUodGhpcy5jb250YWN0X2xpc3QsIGNvbnRhY3RfaW5kZXgsIDApOwogICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYodGhpcy5jaGVja19jdXJyZW50X251bWJlcihyZXMpKXsgCiAgICAgICAgICAgICAgICBsZXQgY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgY3VycmVudF9kYXRlID0gbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyk7CiAgICAgICAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgICBpZih0aGlzLmhpc3RvcnkubWFwKGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZSkubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaCgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIkJPVFJlc3BvbnNlIjogW10sCiAgICAgICAgICAgICAgICAgICJVc2VyUXVlcnkiOiByZXMud2hhdHNhcHBfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV9kYXRlIjogYm90X3Jlc3BvbnNlX2RhdGUsIAogICAgICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwgCiAgICAgICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X2RhdGUiOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgIlVzZXJRdWVyeV9EYXRlVGltZSI6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsZXQgbGF0ZXN0X21lc3NhZ2UsCiAgICAgICAgICAgICAgaXNfdGV4dCA9ICByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gaXRlbS50ZXh0ICE9IG51bGwpLAogICAgICAgICAgICAgIGlzX3Byb2R1Y3QgPSByZXMuQk9UUmVzcG9uc2UuZmluZCgoaXRlbSkgPT4gKGl0ZW0udGV4dCA9PSBudWxsICYmIGl0ZW0ucHJvZHVjdHMpKTsKICAgICAgICAgICAgICBpZihCb29sZWFuKGlzX3RleHQpKSB7CiAgICAgICAgICAgICAgICBsYXRlc3RfbWVzc2FnZSA9IGlzX3RleHQudGV4dDsKICAgICAgICAgICAgICB9IGVsc2UgaWYoQm9vbGVhbihpc19wcm9kdWN0KSkgewogICAgICAgICAgICAgICAgbGF0ZXN0X21lc3NhZ2UgPSAiUHJvZHVjdCBib3QgcmVzcG9uc2UiCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhdGVzdF9tZXNzYWdlID0gbnVsbAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY29udGFjdF9pbmRleCAhPSAtMSl7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gbGF0ZXN0X21lc3NhZ2U7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0W2NvbnRhY3RfaW5kZXhdLm5ld19tZXNzYWdlX2NvdW50ID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2luZGV4LCAwKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZih0aGlzLmNoZWNrX2N1cnJlbnRfbnVtYmVyKHJlcykpeyAKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50X3RpbWVzdGFtcCA9IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsKICAgICAgICAgICAgICAgIGxldCBib3RfcmVzcG9uc2VfZGF0ZSA9IGN1cnJlbnRfZGF0ZTsKICAgICAgICAgICAgICAgIGlmKHRoaXMuaGlzdG9yeS5tYXAoaXRlbSA9PiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlKS5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX2RhdGUiXSA9IGJvdF9yZXNwb25zZV9kYXRlOyAKICAgICAgICAgICAgICAgIHJlc1siYm90X3Jlc3BvbnNlX3RpbWUiXSA9IGN1cnJlbnRfdGltZXN0YW1wOyAKICAgICAgICAgICAgICAgIHJlc1sidXNlcl9xdWVyeV9kYXRlIl0gPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgICByZXNbInVzZXJfcXVlcnlfdGltZSJdID0gY3VycmVudF90aW1lc3RhbXA7CiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkucHVzaChyZXMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgLy8gICBjb25zb2xlLmxvZygicmVhbHRpbWUgY29udmVyc2F0aW9uIikKICAgICAgICAgIC8vIH0KICAgICAgICB9CiAgICAgIH0pCiAgICB9KQogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF92YWx1ZShuZXdWYWx1ZSkgewogICAgICBpZiAobmV3VmFsdWUgIT0gIiIgJiYgbmV3VmFsdWUubGVuZ3RoID4gMikgewogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBzZWFyY2hfc3RyaW5nOiBuZXdWYWx1ZSwKICAgICAgICAgICAgICBpc19nZXRfY29udGFjdHM6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhID09ICJObyBjb250YWN0cyBmb3VuZCIgfHwKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhID09ICJEYXRhIG5vdCBmb3VuZCIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5nZXRfY29udGFjdF9saXN0KGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9pbl9jb250YWN0X2xpc3QobmV3VmFsdWUpIHsKICAgICAgaWYgKG5ld1ZhbHVlICE9ICIiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDIpIHsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgc2VhcmNoX3N0cmluZzogbmV3VmFsdWUsCiAgICAgICAgICAgICAgaXNfZ2V0X2FsbF9jb250YWN0czogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm8gY29udGFjdHMgZm91bmQiKSB7CiAgICAgICAgICAgICAgdGhpcy5hbGxfY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5hbGxfY29udGFjdF9saXN0ID0gcmVzcG9uc2UuZGF0YS5jb250YWN0czsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdldF9hbGxfY29udGFjdF9saXN0KCk7CiAgICAgIH0KICAgIH0sCiAgICAid2hhdHNhcHBfdGVtcGxhdGVzLnNlbGVjdGVkX3RlbXBsYXRlIjogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIGlmIChCb29sZWFuKG5ld1ZhbCkpIHsKICAgICAgICAgIHZhciBjdXJyZW50X3RlbXBsYXRlID0gdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QuZmluZCgKICAgICAgICAgICAgaXRlbSA9PiBpdGVtLnRlbXBsYXRlX2lkID09IG5ld1ZhbAogICAgICAgICAgKTsKICAgICAgICAgIHZhciB0ZW1wbGF0ZV9pZCA9IG5ld1ZhbDsKICAgICAgICAgIHZhciB2YXJpYWJsZV9kaWN0ID0gY3VycmVudF90ZW1wbGF0ZS52YXJpYWJsZV9kaWN0OwogICAgICAgICAgdmFyIGlzX3BhcmVudF90ZW1wbGF0ZSA9IGZhbHNlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX3RlbXBsYXRlKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBpc19wcmV2aWV3OiB0cnVlLAogICAgICAgICAgICAgICAgaXNfcGFyZW50X3RlbXBsYXRlOiBpc19wYXJlbnRfdGVtcGxhdGUsCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZV9pZDogdGVtcGxhdGVfaWQsCiAgICAgICAgICAgICAgICB2YXJpYWJsZV9kaWN0OiB2YXJpYWJsZV9kaWN0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgICAgIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnByZXZpZXdfdGVtcGxhdGVfZGF0YSA9CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuYm9keTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgKHRoaXMuaGlzdG9yeSA9IFtdKSwgKHRoaXMucGhvbmVubyA9IG51bGwpOwogICAgICB0aGlzLmN1c3RvbWVyX25hbWUgPSAiIjsKICAgICAgdGhpcy5jaGF0X2RldGFpbHMgPSBbXTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UgPSA1OwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX25vID0gMTsKICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5wYWdlX3JlY29yZF9mZXRjaGVkID0gW107CiAgICAgIHRoaXMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBudWxsOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGVyX3BhZ2UgPSAxMDsKICAgICAgdGhpcy5hbGxfY29udGFjdF9wYWdpbmF0aW9uLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9IDEwOwogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9OwogICAgfSwKICAgIGdldF9oaXN0b3J5X2RhdGEod2hhdHNhcHBfbm8sIHVzZXJfbmFtZSwgY29udGFjdF9pbmRleCwgY29udGFjdCkgewogICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgdGhpcy5jdXN0b21lcl9uYW1lID0gdGhpcy5nZXRfY29udGFjdF9kaXNwbGF5X25hbWUoY29udGFjdCk7CiAgICAgIC8vIHRoaXMuY3VzdG9tZXJfbmFtZSA9IHVzZXJfbmFtZTsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyID0gd2hhdHNhcHBfbm87CiAgICAgIHRoaXMuc2hvd19zZW5kX21lc3NhZ2UgPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBjb250YWN0X2luZGV4OwogICAgICB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2luZGV4XS5pc19uZXdfbm90aWZpY2F0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBnZXRfYnlfd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiB0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9waG9uZV9udW1iZXI6IHdoYXRzYXBwX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IDEKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zZW5kX21lc3NhZ2UgPSB0cnVlOwogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkRhdGEgbm90IGZvdW5kIikgewogICAgICAgICAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEgPSBjb250YWN0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuaGlzdG9yeSA9IHRoaXMuZm9ybWF0X2hpc3RvcnlfcmVzcG9uc2UoCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmNoYXRfaGlzdG9yeQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5waG9uZW5vID0gcmVzcG9uc2UuZGF0YS53aGF0c2FwcF9waG9uZV9udW1iZXIgfHwgd2hhdHNhcHBfbm87CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5waG9uZW5vLCB0aGlzLmNvbnRhY3RfbGlzdCk7CiAgICAgICAgICAgICAgbGV0IGNvbnRhY3RfbGlzdF9pbmRleCA9IHRoaXMuY29udGFjdF9saXN0LmZpbmRJbmRleCgKICAgICAgICAgICAgICAgIGl0ZW0gPT4gaXRlbS53aGF0c2FwcF9waG9uZV9udW1iZXIgPT0gdGhpcy5waG9uZW5vCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBpZiAoY29udGFjdF9saXN0X2luZGV4ID49IDEpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKHRoaXMuY29udGFjdF9saXN0LCBjb250YWN0X2xpc3RfaW5kZXgsIDApOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXggPSBjb250YWN0X2xpc3RfaW5kZXg7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIgPSB0aGlzLnBob25lbm87CiAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbnRhY3RfbGlzdFtjb250YWN0X2xpc3RfaW5kZXhdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnRvdGFsX3JlY29yZHMgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS50b3RhbF9jaGF0X2hpc3Rvcnk7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxfbWVzc2FnZV9sb2FkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLmlzX3Njcm9sbF91cCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmNoYXRTY3JvbGxNZXNzYWdlcyh0cnVlKTsKICAgICAgICAgICAgICB9LCA0MDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRfY29udGFjdF9saXN0KGVuYWJsZV9ib3RfcmVzcG9uc2VzKSB7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGlzX2dldF9jb250YWN0czogdHJ1ZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBlbmFibGVfYm90X3Jlc3BvbnNlX2FsbDogZW5hYmxlX2JvdF9yZXNwb25zZXMKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9PSAiTm8gY29udGFjdHMgZm91bmQiIHx8CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPT0gIkRhdGEgbm90IGZvdW5kIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gW107CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgLy8gdGhpcy5jb250YWN0X2xpc3QgPSByZXNwb25zZS5kYXRhLmNvbnRhY3RzOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHNjcm9sbF9kb3duKCkgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm1lc3NhZ2UtdGFibGUtc2Nyb2xsIik7CiAgICAgIC8vIGNvbnNvbGUubG9nKGNvbnRhaW5lcik7CiAgICAgIGlmIChCb29sZWFuKGNvbnRhaW5lcikpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAgIH0sIDEwMCk7CiAgICAgICAgLy8gdGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBzY3JvbGxfZG93bl9lZmZlY3QoKSB7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubWVzc2FnZS10YWJsZS1zY3JvbGwiKTsKICAgICAgLy8gY29uc29sZS5sb2coY29udGFpbmVyKTsKICAgICAgaWYgKEJvb2xlYW4oY29udGFpbmVyKSkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IDEwOwogICAgICAgIH0sIDApOwogICAgICAgIC8vIHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgcHJvZHVjdF92YXJpYXRpb24ocHJvZHVjdHNfbGlzdCkgewogICAgICBsZXQgbmV3X3Byb2R1Y3RfbGlzdCA9IFtdOwogICAgICBmb3IgKGxldCBpIGluIHByb2R1Y3RzX2xpc3QpIHsKICAgICAgICBsZXQgY29tcG9uZW50cyA9IHByb2R1Y3RzX2xpc3RbaV0udGVtcGxhdGUuY29tcG9uZW50czsKICAgICAgICBsZXQgdGVtcCA9IHt9OwogICAgICAgIHRyeSB7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaiBpbiBjb21wb25lbnRzKSB7CiAgICAgICAgICBpZiAoaiA9PSAwKSB7CiAgICAgICAgICAgIHRlbXBbImltZ191cmwiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS5pbWFnZS5saW5rOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGogPT0gMSkgewoKICAgICAgICAgICAgdGVtcFsidGl0bGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVyc1swXS50ZXh0OwogICAgICAgICAgICBpZihjb21wb25lbnRzW2pdLnBhcmFtZXRlcnMubGVuZ3RoID09IDIpIHsKICAgICAgICAgICAgICB0ZW1wWyJwcmljZSJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7CiAgICAgICAgICAgICAgdGVtcFsidmFyaWF0aW9uIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDsKICAgICAgICAgICAgfSAKICAgICAgICAgICAgaWYoY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAzKSB7IAogICAgICAgICAgICAgIHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7IAogICAgICAgICAgICAgIHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMl0udGV4dAogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy5sZW5ndGggPT0gMyA/IHRlbXBbInZhcmlhdGlvbiJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzFdLnRleHQ7IHRlbXBbInByaWNlIl0gPSBjb21wb25lbnRzW2pdLnBhcmFtZXRlcnNbMV0udGV4dDogbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaiA9PSAyKSB7CiAgICAgICAgICAgIHRlbXBbInVybCJdID0gY29tcG9uZW50c1tqXS5wYXJhbWV0ZXJzWzBdLnRleHQ7CiAgICAgICAgICAgIHRlbXBbInR5cGUiXSA9IGNvbXBvbmVudHNbal0ucGFyYW1ldGVycy50eXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBkZWJ1Z2dlcgogICAgICAgIH0KICAgICAgICBuZXdfcHJvZHVjdF9saXN0LnB1c2godGVtcCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ld19wcm9kdWN0X2xpc3Q7CiAgICB9LAogICAgY2hlY2tfaW1hZ2VfdHlwZShpbWFnZSkgewogICAgICBpZiAodHlwZW9mIGltYWdlID09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuIGltYWdlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpbWFnZSAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gaW1hZ2Uuc3JjOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgdHJpbV9jYXJkX2Rlc2NyaXB0aW9uKHRleHQpIHsKICAgICAgaWYgKEJvb2xlYW4odGV4dCkpIHsKICAgICAgICBpZiAodGV4dC5sZW5ndGggPiAxMDApIHsKICAgICAgICAgIGxldCBzdHJpbmdfdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIDgwKSArICIuLi4iOwogICAgICAgICAgcmV0dXJuIHN0cmluZ190ZXh0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGV4dDsKICAgICAgfQogICAgfSwKICAgIGxhdGVzdF9ib3RfdGV4dCh0ZXh0KSB7CiAgICAgIGlmICghQm9vbGVhbih0ZXh0KSkgewogICAgICAgIHJldHVybiAiQ3VzdG9tIGJvdCBSZXNwb25zZSI7CiAgICAgIH0KICAgICAgaWYgKHRleHQubGVuZ3RoID4gMzUpIHsKICAgICAgICByZXR1cm4gYCR7dGV4dC5zdWJzdHJpbmcoMCwgMzUpfS4uLmA7CiAgICAgIH0KICAgICAgcmV0dXJuIHRleHQ7CiAgICB9LAogICAgc2VhcmNoX2NvbnRhY3RfbGlzdCgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX3ZhbHVlID09ICIiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFjdF9saXN0OwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBuZXdfdmFsID0gdGhpcy5zZWFyY2hfdmFsdWU7CiAgICAgICAgaWYgKG5ld192YWwgIT0gdGhpcy5zZWFyY2hfdmFsdWUpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VhcmNoX3ZhbHVlKTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgICBzZWFyY2hfc3RyaW5nOiB0aGlzLnNlYXJjaF92YWx1ZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFjdF9saXN0OwogICAgICB9CiAgICB9LAogICAgY2hhdFNjcm9sbE1lc3NhZ2VzKHNjcm9sbF9kb3duKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaW5pdGlhbF9tZXNzYWdlX2xvYWQpOwogICAgICBpZiAodGhpcy5pbml0aWFsX21lc3NhZ2VfbG9hZCA9PT0gdHJ1ZSkgewogICAgICAgIGxldCBjb250YWluZXJfZGl2X3Njcm9sbF90b3AgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgIm1lc3NhZ2UtdGFibGUtc2Nyb2xsIgogICAgICAgIClbMF0uc2Nyb2xsVG9wOwogICAgICAgIGlmICgKICAgICAgICAgIGNvbnRhaW5lcl9kaXZfc2Nyb2xsX3RvcCA8IDUwICYmCiAgICAgICAgICB0aGlzLm1lc3NhZ2VfcGFnaW5hdGlvbi5pc19zY3JvbGxfdXAgPT09IHRydWUgJiYKICAgICAgICAgICF0aGlzLmlzX3BhZ2luYXRlZF9jYWxsICYmCiAgICAgICAgICAhdGhpcy50b3RhbF9wYWdlc19sb2FkZWQKICAgICAgICApIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJhcGkgY2FsbCBwYWdpbmF0ZWQiKQogICAgICAgICAgdGhpcy5pc19wYWdpbmF0ZWRfY2FsbCA9IHRydWU7CiAgICAgICAgICB0aGlzLnNjcm9sbF9zcGlubmVyX2NoYXQgPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgZ2V0X2J5X3doYXRzYXBwX3Bob25lX251bWJlcjogdHJ1ZSwKICAgICAgICAgICAgICAgIHdoYXRzYXBwX3Bob25lX251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMubWVzc2FnZV9wYWdpbmF0aW9uLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyArIDEKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAhdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5pbmNsdWRlcygKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5wYWdlX25vCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBsZXQgbmV3X2RhdGEgPSB0aGlzLmZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKAogICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmNoYXRfaGlzdG9yeQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHRoaXMuaGlzdG9yeSA9IG5ld19kYXRhLmNvbmNhdCh0aGlzLmhpc3RvcnkpOwogICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9yZWNvcmRfZmV0Y2hlZC5wdXNoKAogICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnBhZ2Vfbm8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmhpc3RvcnkpOwogICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3BhZ2luYXRpb24ucGFnZV9ubyArPSAxOwogICAgICAgICAgICAgICAgaWYgKHNjcm9sbF9kb3duID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxfZG93bigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy5zY3JvbGxfZG93bl9lZmZlY3QoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzaG93X3Byb2ZpbGVfc2V0dXAoKSB7CiAgICAgIHRoaXMuaXNfcHJvZmlsZV9zZXR1cCA9ICF0aGlzLmlzX3Byb2ZpbGVfc2V0dXA7CiAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgfSwKICAgIHNob3dfYWxsX2NvbnRhY3RzKCkgewogICAgICB0aGlzLmlzX3Byb2ZpbGVfc2V0dXAgPSAhdGhpcy5pc19wcm9maWxlX3NldHVwOwogICAgICB0aGlzLmlzX2NvbnRhY3RfbGlzdCA9ICF0aGlzLmlzX2NvbnRhY3RfbGlzdDsKICAgICAgdGhpcy5nZXRfYWxsX2NvbnRhY3RfbGlzdCgpOwogICAgfSwKICAgIGZvcm1hdF9oaXN0b3J5X3Jlc3BvbnNlKHJlc3BvbnNlKSB7CiAgICAgIGxldCBjb25fZGF0ZSA9ICIiOwogICAgICBmb3IgKGxldCBpIGluIHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgY29uX2RhdGUgPSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbl9kYXRlID09IHJlc3BvbnNlW2ldLmJvdF9yZXNwb25zZV9kYXRlICYmIGkgIT0gMCkgewogICAgICAgICAgcmVzcG9uc2VbaV0uYm90X3Jlc3BvbnNlX2RhdGUgPSAiIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uX2RhdGUgPSByZXNwb25zZVtpXS5ib3RfcmVzcG9uc2VfZGF0ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgfSwKICAgIHNlbmRfbWVzc2FnZV90b191c2VyKCkgewogICAgICBpZiAoCiAgICAgICAgQm9vbGVhbih0aGlzLm1lc3NhZ2VfdG9fc2VuZCkgPT09IGZhbHNlICYmCiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSBmYWxzZQogICAgICApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBsZXQgY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLAogICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICBpZiAodGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLnNob3dfcHJldmlldyA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmNvbXBhbnlfaWQgPSB0aGlzLmNvbXBhbnlfaWQ7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLmNvbXBhbnlfbmFtZSA9IHRoaXMuY29tcGFueV9uYW1lOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC53aGF0c2FwcF9jb250YWN0X251bWJlciA9IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlcjsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuZG9jdW1lbnRfY29udGVudCA9IG51bGw7CiAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NhcHRpb24gPSB0aGlzLm1lc3NhZ2VfdG9fc2VuZDsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbCwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIldoYXRzYXBwIG1lZGlhIHNlbnQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIGxldCBib3RfcmVzcG9uc2UgPSBbXTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmZpbGVfZXh0ZW5zaW9ucy5pbWFnZV9maWxlX2V4dGVuc2lvbnMuaW5jbHVkZXMoCiAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZSA9IFsKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRleHQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50X2lkOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIsCiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHsKICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb246IHRoaXMubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICAgICAgICAgICAgbGluazogcmVzcG9uc2UuZGF0YS5maWxlX2xpbmsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9leHRlbnNpb25zLmRvY3VtZW50X2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcygKICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kX2F0dGFjaG1lbnRfZGV0YWlsLm1lZGlhX2NvbnRlbnRfdHlwZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlID0gWwogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogbnVsbCwKICAgICAgICAgICAgICAgICAgICByZWNpcGllbnRfaWQ6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICAgICAgICBpbWFnZTogYGh0dHBzOi8vc3RvcmFnZS5jZW5zZS5haS8ke3RoaXMuY29tcGFueV9pZH0vV2hhdHNhcHBNZWRpYS8ke3RoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWV9YAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlX2RhdGUgPSBjdXJyZW50X2RhdGU7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5Lm1hcCgKICAgICAgICAgICAgICAgICAgaXRlbSA9PiBpdGVtLmJvdF9yZXNwb25zZV9kYXRlID09IGJvdF9yZXNwb25zZV9kYXRlCiAgICAgICAgICAgICAgICApLmxlbmd0aCA+IDAKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgICAgIEJPVFJlc3BvbnNlOiBib3RfcmVzcG9uc2UsCiAgICAgICAgICAgICAgICB1c2VyX3F1ZXJ5X3RpbWU6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgVXNlclF1ZXJ5OiAiIiwKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV9kYXRlOiBib3RfcmVzcG9uc2VfZGF0ZSwKICAgICAgICAgICAgICAgIGJvdF9yZXNwb25zZV90aW1lOiBjdXJyZW50X3RpbWVzdGFtcCwKICAgICAgICAgICAgICAgIHVzZXJfcXVlcnlfZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICAgQ2hhdF9EYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsX2Rvd24oKTsKICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4CiAgICAgICAgICAgICAgXS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSB0aGlzLmFycmF5X21vdmUoCiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCwKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4LAogICAgICAgICAgICAgICAgMAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiVGllciBzcGVjaWZpYyB1c2VyIGxpbWl0IHJlYWNoZWQiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIldoYXRzYXBwIG1lZGlhIHNlbmQgZmFpbHVyZSIpIHsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHRyeSBhZ2FpbiIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCJlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnIiksCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnIiksCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiCiAgICAgICAgICAgICAgfSkudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiU2V0dGluZ3MiLAogICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyBTdWJzY3JpcHRpb246IHRydWUgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBzZW5kX21lc3NhZ2U6IHRydWUsCiAgICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIldoYXRzYXBwIG1lc3NhZ2Ugc2VudCBzdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYpIHsKICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy5tZXNzYWdlX3RvX3NlbmQsCiAgICAgICAgICAgICAgICBjaGF0X2RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgICAgdGltZTogYCR7Y3VycmVudF90aW1lc3RhbXAuZ2V0VVRDSG91cnMoKX06JHtjdXJyZW50X3RpbWVzdGFtcC5nZXRVVENNaW51dGVzKCl9YAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QudW5zaGlmdCh0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5zdGFydF9uZXdfY29udl9kYXRhLnN0YXJ0X25ld19jb252ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5Lm1hcCgKICAgICAgICAgICAgICAgIGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZQogICAgICAgICAgICAgICkubGVuZ3RoID4gMAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgICBCT1RSZXNwb25zZTogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLm1lc3NhZ2VfdG9fc2VuZCwKICAgICAgICAgICAgICAgICAgcmVjaXBpZW50X2lkOiB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X3RpbWUiOmN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgICJVc2VyUXVlcnkiOiAiIiwKICAgICAgICAgICAgICAiYm90X3Jlc3BvbnNlX2RhdGUiOiBib3RfcmVzcG9uc2VfZGF0ZSwgCiAgICAgICAgICAgICAgImJvdF9yZXNwb25zZV90aW1lIjogY3VycmVudF90aW1lc3RhbXAsIAogICAgICAgICAgICAgICJ1c2VyX3F1ZXJ5X2RhdGUiOiBjdXJyZW50X2RhdGUsCiAgICAgICAgICAgICAgIkNoYXRfRGF0ZXRpbWUiOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICk7CiAgICAgICAgICB0aGlzLnNjcm9sbF9kb3duKCk7CiAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdFt0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleF0ubGFzdF9ib3RfcmVzcG9uc2UudGV4dCA9IHRoaXMubWVzc2FnZV90b19zZW5kOwogICAgICAgICAgdGhpcy5jb250YWN0X2xpc3QgPSB0aGlzLmFycmF5X21vdmUodGhpcy5jb250YWN0X2xpc3QsIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4LCAwKTsKICAgICAgICAgIHRoaXMubWVzc2FnZV90b19zZW5kID0gbnVsbDsKICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICB9IGVsc2UgaWYgKCByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIlRpZXIgc3BlY2lmaWMgdXNlciBsaW1pdCByZWFjaGVkIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCJlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnIiksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZyIpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgICAgfSkudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICBuYW1lOiAiU2V0dGluZ3MiLAogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgU3Vic2NyaXB0aW9uOiB0cnVlIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiT29wcyIsCiAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSwKICAgIGVkaXRfd2Vic2l0ZV92YWx1ZShpbmRleCkgewogICAgICB0aGlzLmluZGV4X3VwZGF0ZSA9IGluZGV4OwogICAgICB0aGlzLmVkaXRfd2Vic2l0ZSA9IHRydWU7CiAgICB9LAogICAgZ2V0X3Byb2ZpbGVfZGV0YWlscygpIHsKICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSB0cnVlOwogICAgICB0aGlzLmVkaXRfZW1haWwgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X2FkZHJlc3MgPSBmYWxzZTsKICAgICAgdGhpcy5lZGl0X2Rlc2NyaXB0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF93ZWJzaXRlID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9zdGF0dXMgPSBmYWxzZTsKICAgICAgdGhpcy5pbmRleF91cGRhdGUgPSBudWxsOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX3Byb2ZpbGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXQ6IHRydWUKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB0aGlzLndoYXRzYXBwX3Byb2ZpbGUgPSByZXNwb25zZS5kYXRhLndoYXRzYXBwX3Byb2ZpbGU7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlX3Byb2ZpbGVfZGV0YWlscygpIHsKICAgICAgdGhpcy5lZGl0X2VtYWlsID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9hZGRyZXNzID0gZmFsc2U7CiAgICAgIHRoaXMuZWRpdF9kZXNjcmlwdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfd2Vic2l0ZSA9IGZhbHNlOwogICAgICB0aGlzLmVkaXRfc3RhdHVzID0gZmFsc2U7CiAgICAgIHRoaXMuaW5kZXhfdXBkYXRlID0gbnVsbDsKICAgICAgaWYgKHRoaXMud2hhdHNhcHBfcHJvZmlsZS53ZWJzaXRlcy5sZW5ndGggPT0gMikgewogICAgICAgIHRoaXMuc2Vjb25kX3dlYnNpdGUgPSB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgaXNfZWRpdDogdHJ1ZSwKICAgICAgICAgICAgd2hhdHNhcHBfcHJvZmlsZTogdGhpcy53aGF0c2FwcF9wcm9maWxlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgbGV0IHJlc3AgPSByZXNwb25zZS5kYXRhLnVwZGF0ZV9yZXNwb25zZTsKICAgICAgICAgIGlmIChyZXNwID09ICJlZGl0IHN1Y2Nlc3NmdWwiKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRyZSB2YWxpZCBkYXRhIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZV9wcm9maWxlX2ltYWdlKGUpIHsKICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcyA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICJpbWFnZS9wbmciIHx8CiAgICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICJpbWFnZS9qcGciIHx8CiAgICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcy50eXBlID09ICJpbWFnZS9qcGVnIgogICAgICApIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZF9maWxlcy5zaXplID4gNTA5NzE1MikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIHNob3VsZCBiZSBsZXNzIHRoYW4gNU1CIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9maWxlcyA9ICIiOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZmlsZV90b191cGxvYWQgPSB0aGlzLnNlbGVjdGVkX2ZpbGVzOwogICAgICAgIHZhciBwcm9maWxlX2ltZyA9IHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICBwaG90bzogZmlsZV90b191cGxvYWQsCiAgICAgICAgICB3YV9waG9uZV9udW1iZXI6IHRoaXMud2hhdHNhcHBfcHJvZmlsZS53aGF0c2FwcF9waG9uZV9udW1iZXIKICAgICAgICB9OwogICAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkocHJvZmlsZV9pbWcpOwogICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7CiAgICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICB9KTsKICAgICAgICBjb25zdCBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZkLmFwcGVuZCgicGhvdG8iLCB0aGlzLnNlbGVjdGVkX2ZpbGVzKTsKICAgICAgICBmZC5hcHBlbmQoImpzb24iLCBibG9iKTsKICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9wcm9maWxlKCksIGZkLCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICBsZXQgcmVzcCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIGlmIChyZXNwID09ICJQaG90byB1cGRhdGluZyBzdWNjZXNzZnVsIikgewogICAgICAgICAgICAgIHRoaXMuZ2V0X3Byb2ZpbGVfZGV0YWlscygpOwogICAgICAgICAgfSBlbHNlIGlmKHJlc3AgPT0gIlBob3RvIHVwZGF0aW5nIHVuc3VjY2Vzc2Z1bCIpewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZCwgcGxlYXNlIHRyeSBhZ2FpbiEiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYocmVzcCA9PSAiUGxlYXNlIHVwbG9hZCBKUEcgaW1hZ2Ugb2YgcmVzb2x1dGlvbiBncmVhdGVyIHRoYW4gMTkyIHBpeGVsICogMTkyIHBpeGVsIil7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdXBsb2FkIEpQRyBpbWFnZSBvZiByZXNvbHV0aW9uIGdyZWF0ZXIgdGhhbiAxOTIgcGl4ZWwgKiAxOTIgcGl4ZWwiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3AgPT0gIkNhbm5vdCB1cGRhdGUgcGhvdG8geWV0Iil7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cnJlZCwgcGxlYXNlIHRyeSBhZ2FpbiEiLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwID09ICJDYW5ub3QgdXBkYXRlIHBob3RvIHlldCIpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgICAgICJZb3UgY2Fubm90IHVwZGF0ZSB0aGUgcHJvZmlsZSBwaWN0dXJlIHlldCwgcGxlYXNlIHRyeSBhZ2FpbiBsYXRlciIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNwZWNpZmljIGZvcm1hdGUoanBnIGpwZWcgcG5nKSIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDIwMDAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHJlbW92ZV9wcm9maWxlX2ltYWdlKCkgewogICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfcHJvZmlsZSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX3JlbW92ZV9waG90bzogdHJ1ZQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09PSAiUGhvdG8gcmVtb3ZlZCIpIHsKICAgICAgICAgICAgdGhpcy5nZXRfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gIlBob3RvIHJlbW92YWwgdW5zdWNjZXNzZnVsIikgewogICAgICAgICAgICB0aGlzLmdldF9wcm9maWxlX2RldGFpbHMoKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBjb25uZWN0X2VsaXhpcl9zb2NrZXQoKSB7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLmluaXRpYWxpemVfd2hhdHNhcHBfdG9waWMoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgd2hhdHNhcHBfcGhvbmVfbnVtYmVyOiAiMTAwIgogICAgICAgIH0pCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpCiAgICAgICAgICAvLyB0aGlzLmNoYXRfZ3JvdXBfbmFtZSA9IHJlc3BvbnNlLmRhdGEuY2hhdF9ncm91cF9uYW1lOwogICAgICAgICAgLy8gdGhpcy5saXZlX2NoYXRfdG9rZW4gPSByZXNwb25zZS5kYXRhLnRva2VuOwogICAgICAgICAgLy8gdGhpcy5saXZlX2NoYXRfb24gPSB0cnVlOwogICAgICAgICAgdGhpcy5jaGF0X3NvY2tldCA9IG5ldyBTb2NrZXQoCiAgICAgICAgICAgIHByb2Nlc3MuZW52LlZVRV9BUFBfTElWRV9DSEFUX1dFQlNPQ0tFVF9FTkRQT0lOVCwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgd2hhdHNhcHA6ICJ0cnVlIiwKICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5kYXRhLnRva2VuCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApOwogICAgICAgICAgdGhpcy5jaGF0X3NvY2tldC5jb25uZWN0KCk7CiAgICAgICAgICB0aGlzLmNoYW5uZWwgPSB0aGlzLmNoYXRfc29ja2V0LmNoYW5uZWwoCiAgICAgICAgICAgICJ3aGF0c2FwcDoiICsgcmVzcG9uc2UuZGF0YS53aGF0c2FwcF90b3BpYwogICAgICAgICAgKTsKICAgICAgICAgIHRoaXMuY2hhbm5lbC5qb2luKCk7CiAgICAgICAgICB0aGlzLmNoYW5uZWwub24oIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgcmVzID0+IHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIm5ld193aGF0c2FwcF9tZXNzYWdlIiwgcmVzKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZW5hYmxlX3NlbmRpbmdfbWVzc2FnZXNfZm9yX3VzZXIoKSB7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLAogICAgICAgICAgewogICAgICAgICAgICB1cGRhdGVfYm90X3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICB3aGF0c2FwcF9jb250YWN0X251bWJlcjogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICBib3RfcmVzcG9uc2U6IGZhbHNlLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlfaWQKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuc3RhcnRfbmV3X2NvbnYgPT09IHRydWUpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXJ0X25ld19jb252X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0WwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgKICAgICAgICAgICAgICBdLmlzX21lc3NhZ2Vfc2VuZGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLiRzZXQoCiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhY3RfbGlzdCwKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4LAogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3RbdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXhdCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcmVmc1sibWVzc2FnZV9zZW5kaW5nX3RleHRib3giXS5mb2N1cygpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICJGYWlsdXJlIikgewogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIkVycm9yIikgewogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiCiAgICAgICAgICApIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIHRleHQ6ICJNZXNzYWdlIFNlbmRpbmcgTGltaXQgUmVhY2hlZCIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX25vd19tc2ciKSwKICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgiZW1haWxfdGVtcF9zd2FsX3VwZ3JhZGVfbGF0ZXJfbXNnIiksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIgogICAgICAgICAgICB9KS50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICJTZXR0aW5ncyIsCiAgICAgICAgICAgICAgICAgIHBhcmFtczogeyBTdWJzY3JpcHRpb246IHRydWUgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIH0pOwogICAgfSwKICAgIGV4cGFuZF90ZXh0Ym94KGlkLCBrZXkpIHsKICAgICAgaWYgKGlkICE9ICIjYnVzaW5lc3NfYWRkcmVzcyIpIHsKICAgICAgICB0aGlzLmNhbGxzZWFyY2goKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgICAgdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGUgPT4gewogICAgICAgICAgICBsZXQgc2Nyb2xsX2hlaWdodCA9IGUudGFyZ2V0LnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gYCR7c2Nyb2xsX2hlaWdodH1weGA7CiAgICAgICAgICB9KTsKICAgICAgICB9LCAxMCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgdGhpcy51cGRhdGVfcHJvZmlsZV9kZXRhaWxzKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X251bWJlcihyZXMpIHsKICAgICAgcmV0dXJuIHJlcy53aGF0c2FwcF9waG9uZV9udW1iZXIgPT09IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlcgogICAgICAgID8gdHJ1ZQogICAgICAgIDogZmFsc2U7CiAgICB9LAogICAgZm9ybWF0X3VzZXJfcXVlcnlfZGF0ZSh1c2VyX3F1ZXJ5X2RhdGUsIGluZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKE9iamVjdC5rZXlzKHRoaXMuaGlzdG9yeVtpbmRleC0xXSkpCiAgICAgIGlmICh0aGlzLmhpc3RvcnlbaW5kZXggLSAxXS51c2VyX3F1ZXJ5X2RhdGUgPT0gdXNlcl9xdWVyeV9kYXRlKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICAgIHJldHVybiB1c2VyX3F1ZXJ5X2RhdGU7CiAgICB9LAogICAgZ2V0X2FsbF9jb250YWN0X2xpc3QoKSB7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy53aGF0c2FwcF9jaGF0KCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfbGlzdCA9IHJlc3BvbnNlLmRhdGEuY29udGFjdHM7CiAgICAgICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24udG90YWxfcmVjb3JkcyA9CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudG90YWxfY29udGFjdHM7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICB0aGlzLnNob3dfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgbmV3X2NvbnRhY3RfbGlzdCgpIHsKICAgICAgbGV0IHNjcm9sbGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiYWxsLWNvbnRhY3QtbGlzdCIpWzBdCiAgICAgICAgLnNjcm9sbFRvcDsKICAgICAgaWYgKAogICAgICAgIHNjcm9sbGVyID4gMTIwICYmCiAgICAgICAgIXRoaXMuaXNfcGFnaW5hdGVkX2NhbGwgJiYKICAgICAgICAhdGhpcy50b3RhbF9jb250YWN0X2xvYWRlZAogICAgICApIHsKICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gdHJ1ZTsKICAgICAgICB0aGlzLnNjcm9sbF9zcGlubmVyX2NoYXQgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX2NoYXQoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGlzX2dldF9hbGxfY29udGFjdHM6IHRydWUsCiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMuYWxsX2NvbnRhY3RfcGFnaW5hdGlvbi5wZXJfcGFnZSwKICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyArIDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsX3NwaW5uZXJfY2hhdCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzX3BhZ2luYXRlZF9jYWxsID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuYWxsX2NvbnRhY3RfbGlzdCA9IHRoaXMuYWxsX2NvbnRhY3RfbGlzdC5jb25jYXQoCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5jb250YWN0cwogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLmFsbF9jb250YWN0X3BhZ2luYXRpb24ucGFnZV9ubyArPSAxOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgdGhpcy5zY3JvbGxfc3Bpbm5lcl9jaGF0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhcnJheV9tb3ZlKGFyciwgb2xkX2luZGV4LCBuZXdfaW5kZXgpIHsKICAgICAgaWYgKG5ld19pbmRleCA+PSBhcnIubGVuZ3RoKSB7CiAgICAgICAgdmFyIGsgPSBuZXdfaW5kZXggLSBhcnIubGVuZ3RoICsgMTsKICAgICAgICB3aGlsZSAoay0tKSB7CiAgICAgICAgICBhcnIucHVzaCh1bmRlZmluZWQpOwogICAgICAgIH0KICAgICAgfQogICAgICBhcnIuc3BsaWNlKG5ld19pbmRleCwgMCwgYXJyLnNwbGljZShvbGRfaW5kZXgsIDEpWzBdKTsKICAgICAgcmV0dXJuIGFycjsgLy8gZm9yIHRlc3RpbmcKICAgIH0sCiAgICBmb3JtYXRVc2VyUXVlcnlUaW1lKHVzZXJfcXVlcnlfdGltZSkgewogICAgICByZXR1cm4gbmV3IERhdGUodXNlcl9xdWVyeV90aW1lKS50b0xvY2FsZVRpbWVTdHJpbmcobmF2aWdhdG9yLmxhbmd1YWdlLCB7CiAgICAgICAgaG91cjogIjItZGlnaXQiLAogICAgICAgIG1pbnV0ZTogIjItZGlnaXQiCiAgICAgIH0pOwogICAgICAvLyByZXR1cm4gdXNlcl9xdWVyeV90aW1lCiAgICB9LAogICAgaXNfYWN0aXZlX2NoYXQoaW5kZXgpIHsKICAgICAgaWYoaW5kZXggPT09IHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4KSB7CiAgICAgICAgcmV0dXJuICJiYWNrZ3JvdW5kOiAjZjBmOGZmIgogICAgICB9IGVsc2UgaWYodGhpcy5jb250YWN0X2xpc3RbaW5kZXhdLmlzX25ld19ub3RpZmljYXRpb24gfHwgZmFsc2UpewogICAgICAgIHJldHVybiAiYmFja2dyb3VuZDogIzQ3YTg4NDMzIgogICAgICB9CiAgICAgIHJldHVybiAiYmFja2dyb3VuZDogI2ZmZmZmZiIKICAgIH0sCiAgICBmb3JtYXRDb250YWN0TGFzdE1lc3NhZ2VEYXRlKGRhdGUsIHRpbWUpIHsKICAgICAgaWYgKG1vbWVudChkYXRlKS5pc1NhbWUoRGF0ZS5ub3coKSwgImRheSIpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGAke2RhdGV9ICR7dGltZX1aYCkudG9Mb2NhbGVUaW1lU3RyaW5nKAogICAgICAgICAgbmF2aWdhdG9yLmxhbmd1YWdlLAogICAgICAgICAgewogICAgICAgICAgICBob3VyOiAiMi1kaWdpdCIsCiAgICAgICAgICAgIG1pbnV0ZTogIjItZGlnaXQiCiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gZGF0ZTsKICAgIH0sCiAgICBjaGVja19wcmV2aW91c19tZXNzYWdlX2RhdGVfc2FtZShpbmRleCkgewogICAgICAvLyBjb25zb2xlLmxvZyhpbmRleCkKICAgICAgcmV0dXJuIHRydWU7CiAgICAgIC8vIGlmKGluZGV4ID09IDApIHsKICAgICAgLy8gICByZXR1cm4gdHJ1ZTsKICAgICAgLy8gfQogICAgICAvLyByZXR1cm4gdGhpcy5oaXN0b3J5W2luZGV4LTFdLmJvdF9yZXNwb25zZV9kYXRlID09IHRoaXMuaGlzdG9yeVtpbmRleF0uYm90X3Jlc3BvbnNlX2RhdGUgPyB0cnVlIDogZmFsc2U7CiAgICB9LAogICAgcHJvY2Vzc19hdHRhY2htZW50X2ZpbGUoZSkgewogICAgICBsZXQgZmlsZXMgPSBlLnRhcmdldC5maWxlcyB8fCBlLmRhdGFUcmFuc2Zlci5maWxlczsKICAgICAgaWYgKGZpbGVzWzBdLnNpemUgPiAyMDk3MTUyKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiVXBsb2FkIGltYWdlIHdpdGggc2l6ZSBsZXNzIHRoYW4gMk1CIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKAogICAgICAgIHRoaXMuZmlsZV9leHRlbnNpb25zLmFsbF9hbGxvd2VkX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcyhmaWxlc1swXS50eXBlKQogICAgICApIHsKICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlX25hbWUgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9jb250ZW50X3R5cGUgPSBmaWxlc1swXS50eXBlOwogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5kb2N1bWVudF9jb250ZW50ID0gVVJMLmNyZWF0ZU9iamVjdFVSTCgKICAgICAgICAgIGZpbGVzWzBdCiAgICAgICAgKTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwuc2hvd19wcmV2aWV3ID0gdHJ1ZTsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfdHlwZSA9IHRoaXMuZmlsZV9leHRlbnNpb25zLmltYWdlX2ZpbGVfZXh0ZW5zaW9ucy5pbmNsdWRlcygKICAgICAgICAgIGZpbGVzWzBdLnR5cGUKICAgICAgICApCiAgICAgICAgICA/ICJpbWFnZSIKICAgICAgICAgIDogImRvY3VtZW50IjsKICAgICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwubWVkaWFfY2FwdGlvbiA9IHRoaXMubWVzc2FnZV90b19zZW5kOwogICAgICAgIHRoaXMuY3JlYXRlQXR0YWNobWVudChmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZToKICAgICAgICAgICAgIlBsZWFzZSBTZWxlY3QgYSBwcm9wZXIgZG9jdW1lbnQgb3IgaW1hZ2UgaGF2aW5nIHRoZSBjb3JyZWN0IGZpbGV0eXBlIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlQXR0YWNobWVudChmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5tZWRpYV9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KAogICAgICAgICAgImJhc2U2NCwiCiAgICAgICAgKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltZy1wcmV2aWV3Iikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1nLXByZXZpZXciKS5pbm5lckhUTUwgPQogICAgICAgICAgJzxpbWcgY2xhc3M9ImN1c3RvbS1kaXNwbGF5LWltYWdlIiBzdHlsZT0ibWF4LXdpZHRoOjEwMCU7aGVpZ2h0OjUwMHB4OyBwYWRkaW5nOiAxcmVtO21hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87IiBzcmM9IicgKwogICAgICAgICAgdGhpcy5yZXN1bHQgKwogICAgICAgICAgJyIgLz4nOwogICAgICB9KTsKICAgIH0sCiAgICBpc19yZXNwb25zZV9pbWFnZShkYXRhKSB7CiAgICAgIGlmICgKICAgICAgICBkYXRhLnRlbXBsYXRlID09IG51bGwgJiYKICAgICAgICBkYXRhLnRleHQgPT0gbnVsbCAmJgogICAgICAgIEJvb2xlYW4oZGF0YS5pbWFnZSkgIT0gbnVsbAogICAgICApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaXNfcmVzcG9uc2VfZG9jdW1lbnQoZGF0YSkgewogICAgICBpZiAoCiAgICAgICAgZGF0YS50ZW1wbGF0ZSA9PSBudWxsICYmCiAgICAgICAgZGF0YS50ZXh0ID09IG51bGwgJiYKICAgICAgICBkYXRhLmltYWdlID09IG51bGwgJiYKICAgICAgICBCb29sZWFuKGRhdGEuYXR0YWNobWVudCkgIT0gbnVsbAogICAgICApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgc2hvd19pbWFnZV9mdWxsc2NyZWVuKGltZ19zcmMpIHsKICAgICAgJCgiI3Nob3dJbWFnZU1vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy5jdXJyZW50X2Z1bGxzY3JlZW5faW1hZ2Vfc3JjID0gaW1nX3NyYzsKICAgIH0sCiAgICBhZGRfbmV3X2NvbnRhY3RfbW9kYWwoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJhZGQgbmV3IGNvbnRhY3QtYWRkQ29udGFjdE1vZGFsIikKICAgICAgJCgiI2FkZENvbnRhY3RNb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICB9LAogICAgc2F2ZV9uZXdfY29udGFjdCgpIHsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9pZCA9IHRoaXMuY29tcGFueV9pZDsKICAgICAgdGhpcy5hZGRfbmV3X2NvbnRhY3QuY29tcGFueV9uYW1lID0gdGhpcy5jb21wYW55X25hbWU7CiAgICAgIHRoaXMuc2hvd19zcGlubmVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMud2hhdHNhcHBfY2hhdCgpLCB0aGlzLmFkZF9uZXdfY29udGFjdCwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIldoYXRzYXBwIENvbnRhY3QgQWRkZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRleHQ6ICJDb250YWN0IEFkZGVkIFN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgdGhpcy5jbGVhcl9hZGRfY29udGFjdCgpOwogICAgICAgICAgICB0aGlzLmdldF9hbGxfY29udGFjdF9saXN0KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0KICAgICAgICAgICAgIlByb3ZpZGVkIG51bWJlciBhbHJlYWR5IGV4aXN0cyBpbiBjb250YWN0cyIKICAgICAgICAgICkgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgICAgICB0ZXh0OiAiQ29udGFjdCBBbHJlYWR5IEV4aXN0cyIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgICAgIHRleHQ6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0aXRsZTogIk9vcHMhIiwKICAgICAgICAgICAgdGV4dDogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5zaG93X3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGNsZWFyX2FkZF9jb250YWN0KCkgewogICAgICB0aGlzLmFkZF9uZXdfY29udGFjdCA9IHsKICAgICAgICBwaG9uZV9udW1iZXI6IG51bGwsCiAgICAgICAgaXNfYWRkX2NvbnRhY3Q6IHRydWUsCiAgICAgICAgY29udGFjdF9uYW1lOiBudWxsLAogICAgICAgIGZvcm1hdHRlZE51bWJlcjogbnVsbAogICAgICB9OwogICAgfSwKICAgIGRvd25sb2FkX2RvY3VtZW50KGF0dGFjaG1lbnQpIHsKICAgICAgLy8gY29uc29sZS5sb2coYXR0YWNobWVudCkKICAgICAgdmFyIGFUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJpZCIsICJhYmNkZWZnIik7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJkb3dubG9hZCIpOwogICAgICBhVGFnLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGF0dGFjaG1lbnQubGluayk7CiAgICAgIGFUYWcuc2V0QXR0cmlidXRlKCJ0YXJnZXQiLCAiX2JsYW5rIik7CiAgICAgIGFUYWcuY2xpY2soKTsKCiAgICAgIC8vIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYXR0YWNobWVudC5saW5rXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vcGRmJyB9KQogICAgICAvLyBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpCiAgICAgIC8vIGxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikKICAgICAgLy8gbGluay5kb3dubG9hZCA9IGF0dGFjaG1lbnQuZmlsZW5hbWUKICAgICAgLy8gbGluay5jbGljaygpCiAgICAgIC8vIFVSTC5yZXZva2VPYmplY3RVUkwobGluay5ocmVmKQogICAgICAvLyBsaW5rLmNsaWNrKCk7CiAgICB9LAogICAgb3Blbl9zZW5kX3RlbXBsYXRlX3RvX3VzZXIoKSB7CiAgICAgIHRoaXMucmV0cmlldmVfYWxsX3RlbXBsYXRlcygpOwogICAgICAkKCIjc2VuZFRlbXBsYXRlTW9kYWwiKS5tb2RhbCgic2hvdyIpOwogICAgfSwKICAgIHJldHJpZXZlX2FsbF90ZW1wbGF0ZXMoKSB7CiAgICAgIHRoaXMuY3VycmVudF90ZW1wbGF0ZSA9IHt9OwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueV9uYW1lLAogICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgIGlzX25vdGlmaWNhdGlvbjogdGhpcy5pc19ub3RpZmljYXRpb25fdGVtcGxhdGUsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnRlbXBsYXRlc19saXN0ID0gW107CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJObyBXaGF0c2FwcCBUZW1wbGF0ZSBpbiBkYXRhYmFzZSIpIHsKICAgICAgICAgICAgICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdCA9IFtdOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnRlbXBsYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QgPSByZXNwb25zZS5kYXRhLnRlbXBsYXRlczsKICAgICAgICAgICAgICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5wYWdpbmF0aW9uX2RhdGEubnVtYmVyX29mX3Jvd3MgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5wYWdlX2NvdW50OwogICAgICAgICAgICAgIHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnBhZ2luYXRpb25fZGF0YS50b3RhbF9wYWdlcyA9IE1hdGguY2VpbCgKICAgICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAvLyBpZiAodGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIC8vICAgdGhpcy5zaG93X3RlbXBsYXRlKDApOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAvLyB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cmVkIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHNlbmRfdGVtcGxhdGVfdG9fY3VzdG9tZXIoKSB7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfdGVtcGxhdGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55X2lkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICBpc19ub3RpZmljYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZV9pZDogdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUsCiAgICAgICAgICAgIGNvbnRhY3RzX2xpc3Q6IFt0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXJdLAogICAgICAgICAgICBwdWJsaXNoX3RlbXBsYXRlOiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAiU2VsZWN0ZWQgdGVtcGxhdGUgbm90IGZvdW5kIGluIGRiIikgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiSW5zdWZmaWNpZW50IGNyZWRpdHMiLAogICAgICAgICAgICB0ZXh0OiAiWW91IGhhdmUgbm8gY3JlZGl0cyBsZWZ0IHRvIHNlbmQgdGVtcGxhdGUgdG8gTm9uLVVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJUaWVyIHNwZWNpZmljIHVzZXIgbGltaXQgcmVhY2hlZCIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3RpZXJfc3BlY2lmaWNfdXNlcl9saW1pdF9yZWFjaGVkJyksCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndGllcl9zcGVjaWZpY191c2VyX2xpbWl0X3JlYWNoZWRfbXNnJyksCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJObyBjcmVkaXRzIGxlZnQgZm9yIHRlbXBsYXRlIHRvIG5vbiB1cyIKICAgICAgICApIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkluc3VmZmljaWVudCBjcmVkaXRzIiwKICAgICAgICAgICAgdGV4dDogIllvdSBoYXZlIG5vIGNyZWRpdHMgbGVmdCB0byBzZW5kIHRlbXBsYXRlIHRvIE5vbi1VUyByZWdpb24sIFlvdSBjYW4gcHVyY2hhc2UgQ2Vuc2UgQWRkIE9ucyB0byBjb250aW51ZSBzZW5kaW5nIHRlbXBsYXRlIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAidGVtcGxhdGUgaXMgYmVpbmcgc2VudCIpIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlRlbXBsYXRlIGlzIGJlaW5nIHNlbnQiLAogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgLy8gY29uc3QgdGVtcGxhdGUgPSAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMudGVtcGxhdGVzX2xpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS50ZW1wbGF0ZV9pZCA9PSB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5zZWxlY3RlZF90ZW1wbGF0ZSk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wbGF0ZS52YXJpYWJsZV9kaWN0LCB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIpOwogICAgICAgICAgCiAgICAgICAgICBsZXQgY3VycmVudF90aW1lc3RhbXAgPSAgbmV3IERhdGUoKSwKICAgICAgICAgIGN1cnJlbnRfZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCcpCiAgICAgICAgICBsZXQgYm90X3Jlc3BvbnNlID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgInRleHQiOiBudWxsLCAKICAgICAgICAgICAgICAidHlwZSI6ICJ0ZW1wbGF0ZSIsCiAgICAgICAgICAgICAgInJlY2lwaWVudF9pZCI6IHRoaXMuY3VycmVudF9jb250YWN0X251bWJlciwKICAgICAgICAgICAgICAidGVtcGxhdGUiOiB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy5wcmV2aWV3X3RlbXBsYXRlX2RhdGEKICAgICAgICAgICAgfQogICAgICAgICAgXTsKICAgICAgICAgIGlmKHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udil7CiAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuY2hhdF9kYXRldGltZSA9IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgLy8gdGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEuaXNfbWVzc2FnZV9zZW5kaW5nX2VuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgIHRoaXMubmV3X2NvbnZfY29udGFjdF9kYXRhLmxhc3RfYm90X3Jlc3BvbnNlID0gewogICAgICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLCAKICAgICAgICAgICAgICBjaGF0X2RhdGV0aW1lOiBjdXJyZW50X3RpbWVzdGFtcC50b0lTT1N0cmluZygpLCAKICAgICAgICAgICAgICBkYXRlOiBjdXJyZW50X2RhdGUsIAogICAgICAgICAgICAgIHRpbWU6IGAke2N1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCl9OiR7Y3VycmVudF90aW1lc3RhbXAuZ2V0VVRDTWludXRlcygpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJTZWxlY3RlZCB0ZW1wbGF0ZSBub3QgZm91bmQgaW4gZGIiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiSW5zdWZmaWNpZW50IGNyZWRpdHMiLAogICAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgICAiWW91IGhhdmUgbm8gY3JlZGl0cyBsZWZ0IHRvIHNlbmQgdGVtcGxhdGUgdG8gTm9uLVVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIk5vIGNyZWRpdHMgbGVmdCBmb3IgdGVtcGxhdGUgdG8gbm9uIHVzIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiSW5zdWZmaWNpZW50IGNyZWRpdHMiLAogICAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgICAiWW91IGhhdmUgbm8gY3JlZGl0cyBsZWZ0IHRvIHNlbmQgdGVtcGxhdGUgdG8gTm9uLVVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAidGVtcGxhdGUgaXMgYmVpbmcgc2VudCIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJUZW1wbGF0ZSBpcyBiZWluZyBzZW50IiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBjb25zdCB0ZW1wbGF0ZSA9ICB0aGlzLndoYXRzYXBwX3RlbXBsYXRlcy50ZW1wbGF0ZXNfbGlzdC5maW5kKChpdGVtKSA9PiBpdGVtLnRlbXBsYXRlX2lkID09IHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnNlbGVjdGVkX3RlbXBsYXRlKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wbGF0ZS52YXJpYWJsZV9kaWN0LCB0aGlzLmN1cnJlbnRfY29udGFjdF9udW1iZXIpOwoKICAgICAgICAgICAgbGV0IGN1cnJlbnRfdGltZXN0YW1wID0gbmV3IERhdGUoKSwKICAgICAgICAgICAgICBjdXJyZW50X2RhdGUgPSBtb21lbnQoKS5mb3JtYXQoIllZWVktTU0tREQiKTsKICAgICAgICAgICAgbGV0IGJvdF9yZXNwb25zZSA9IFsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiBudWxsLAogICAgICAgICAgICAgICAgdHlwZTogInRlbXBsYXRlIiwKICAgICAgICAgICAgICAgIHJlY2lwaWVudF9pZDogdGhpcy5jdXJyZW50X2NvbnRhY3RfbnVtYmVyLAogICAgICAgICAgICAgICAgdGVtcGxhdGU6IHRoaXMud2hhdHNhcHBfdGVtcGxhdGVzLnByZXZpZXdfdGVtcGxhdGVfZGF0YQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udikgewogICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4ID0gMDsKICAgICAgICAgICAgICB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YS5jaGF0X2RhdGV0aW1lID0gY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKTsKICAgICAgICAgICAgICAvLyB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YS5pc19tZXNzYWdlX3NlbmRpbmdfZW5hYmxlZCA9IHRydWUKICAgICAgICAgICAgICB0aGlzLm5ld19jb252X2NvbnRhY3RfZGF0YS5sYXN0X2JvdF9yZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZV90b19zZW5kLAogICAgICAgICAgICAgICAgY2hhdF9kYXRldGltZTogY3VycmVudF90aW1lc3RhbXAudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIGRhdGU6IGN1cnJlbnRfZGF0ZSwKICAgICAgICAgICAgICAgIHRpbWU6IGAke2N1cnJlbnRfdGltZXN0YW1wLmdldFVUQ0hvdXJzKCl9OiR7Y3VycmVudF90aW1lc3RhbXAuZ2V0VVRDTWludXRlcygpfWAKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0LnVuc2hpZnQodGhpcy5uZXdfY29udl9jb250YWN0X2RhdGEpOwogICAgICAgICAgICAgIHRoaXMuc3RhcnRfbmV3X2NvbnZfZGF0YS5zdGFydF9uZXdfY29udiA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGJvdF9yZXNwb25zZSkKICAgICAgICAgICAgbGV0IGJvdF9yZXNwb25zZV9kYXRlID0gY3VycmVudF9kYXRlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5Lm1hcCgKICAgICAgICAgICAgICAgIGl0ZW0gPT4gaXRlbS5ib3RfcmVzcG9uc2VfZGF0ZSA9PSBib3RfcmVzcG9uc2VfZGF0ZQogICAgICAgICAgICAgICkubGVuZ3RoID4gMAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZSA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaGlzdG9yeS5wdXNoKHsKICAgICAgICAgICAgICBCT1RSZXNwb25zZTogYm90X3Jlc3BvbnNlLAogICAgICAgICAgICAgIHVzZXJfcXVlcnlfdGltZTogY3VycmVudF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgVXNlclF1ZXJ5OiAiIiwKICAgICAgICAgICAgICBib3RfcmVzcG9uc2VfZGF0ZTogYm90X3Jlc3BvbnNlX2RhdGUsCiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX3RpbWU6IGN1cnJlbnRfdGltZXN0YW1wLAogICAgICAgICAgICAgIHVzZXJfcXVlcnlfZGF0ZTogY3VycmVudF9kYXRlLAogICAgICAgICAgICAgIENoYXRfRGF0ZXRpbWU6IGN1cnJlbnRfdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsX2Rvd24oKTsKICAgICAgICAgICAgdGhpcy5jb250YWN0X2xpc3RbCiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X2NvbnRhY3RfaW5kZXgKICAgICAgICAgICAgXS5sYXN0X2JvdF9yZXNwb25zZS50ZXh0ID0gdGhpcy5tZXNzYWdlX3RvX3NlbmQ7CiAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0ID0gdGhpcy5hcnJheV9tb3ZlKAogICAgICAgICAgICAgIHRoaXMuY29udGFjdF9saXN0LAogICAgICAgICAgICAgIHRoaXMuY3VycmVudF9jb250YWN0X2luZGV4LAogICAgICAgICAgICAgIDAKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlX3RvX3NlbmQgPSBudWxsOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRfY29udGFjdF9pbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuc2VuZF9hdHRhY2htZW50X2RldGFpbC5zaG93X3ByZXZpZXcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy53aGF0c2FwcF90ZW1wbGF0ZXMuc2VsZWN0ZWRfdGVtcGxhdGUgPSBudWxsOwogICAgICAgICAgICAkKCIjc2VuZFRlbXBsYXRlTW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlID09ICJObyBjcmVkaXRzIGxlZnQgdG8gc2VuZCB0ZW1wbGF0ZSIKICAgICAgICAgICkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIkluc3VmZmljaWVudCBjcmVkaXRzIiwKICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgIllvdSBoYXZlIG5vIGNyZWRpdHMgbGVmdCB0byBzZW5kIHRlbXBsYXRlIHRvIFVTIHJlZ2lvbiwgWW91IGNhbiBwdXJjaGFzZSBDZW5zZSBBZGQgT25zIHRvIGNvbnRpbnVlIHNlbmRpbmcgdGVtcGxhdGUiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk1lc3NhZ2UgU2VuZGluZyBMaW1pdCBSZWFjaGVkIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0ZXh0OiAiTWVzc2FnZSBTZW5kaW5nIExpbWl0IFJlYWNoZWQiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCJlbWFpbF90ZW1wX3N3YWxfdXBncmFkZV9ub3dfbXNnIiksCiAgICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoImVtYWlsX3RlbXBfc3dhbF91cGdyYWRlX2xhdGVyX21zZyIpLAogICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIKICAgICAgICAgICAgfSkudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICBuYW1lOiAiU2V0dGluZ3MiLAogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgU3Vic2NyaXB0aW9uOiB0cnVlIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiU29tZSBlcnJvciBvY2N1cmVkIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGdldF9jb250YWN0X2Rpc3BsYXlfbmFtZShjb250YWN0KSB7CiAgICAgIGlmIChjb250YWN0LmNvbnRhY3RfbmFtZSkgcmV0dXJuIGNvbnRhY3QuY29udGFjdF9uYW1lOwogICAgICBpZiAoY29udGFjdC5wcm9maWxlX25hbWUpIHJldHVybiBjb250YWN0LnByb2ZpbGVfbmFtZTsKICAgICAgcmV0dXJuIGNvbnRhY3Qud2hhdHNhcHBfcGhvbmVfbnVtYmVyOwogICAgfSwKICAgIG9wZW5faW1wb3J0X2Zyb21fY3N2X21vZGFsKCkgewogICAgICAkKCIjYWRkQ29udGFjdE1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgJCgiI2ltcG9ydENvbnRhY3RDU1ZNb2RhbCIpLm1vZGFsKCJzaG93Iik7CiAgICB9LAogICAgZmlsZV9pbnB1dF9jb250YWN0c19jc3YoZSkgewogICAgICBpZiAoZS50YXJnZXQuZmlsZXNbMF0udHlwZSA9PSAidGV4dC9jc3YiKSB7CiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsID0gZS50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNvbnRhY3RfY3N2LmZpbGVfY29udGVudCA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgIHRoaXMuY29udGFjdF9jc3YuZmlsZV9zZWxlY3RlZCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYSBwcm9wZXIgZG9jdW1lbnQgaGF2aW5nIENTViBmaWxldHlwZSIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGZpbGVfc3VibWl0X3VwbG9hZF9jb250YWN0cygpIHsKICAgICAgaWYgKCQoIiNpbnB1dEdyb3VwVXBsb2FkRmlsZWNzdiIpLnZhbCgpID09ICIiKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiT29wcyEiLAogICAgICAgICAgdGV4dDogIlBsZWFzZSBTZWxlY3QgYSBDU1YgZmlsZSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgdXNlcl9kZXRhaWxzID0gewogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5CiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgfSk7CiAgICAgIGNvbnN0IGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIGZkLmFwcGVuZCgKICAgICAgICAiZmlsZSIsCiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2NvbnRlbnQsCiAgICAgICAgdGhpcy5jb250YWN0X2Nzdi5maWxlX2xhYmVsCiAgICAgICk7CiAgICAgIC8vIGZkLmFwcGVuZCgianNvbiIsIGJsb2IpOwogICAgICBmZC5hcHBlbmQoImNvbXBhbnlpZCIsIHRoaXMuY29tcGFueV9pZCk7CiAgICAgIGZkLmFwcGVuZCgiY29tcGFueW5hbWUiLCB0aGlzLmNvbXBhbnlfbmFtZSk7CiAgICAgIGZkLmFwcGVuZCgiZW1haWwiLCB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwpOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy53aGF0c2FwcF9pbXBvcnRfY29udGFjdHMoKSwgZmQsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAgICJNdWx0aXBsZSBjb250YWN0cyBhcmUgYmVpbmcgYWRkZWQuIFlvdSB3aWxsIHJlY2VpdmUgYSBtYWlsIHdoZW4gdGhlIHByb2Nlc3NpbmcgaXMgZmluaXNoZWQuIiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAiRmFpbHVyZSIpIHsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJJbmNvcnJlY3QgRmlsZSBGb3JtYXQhIiwKICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgIlBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIGRpZmZlcmVudCBjc3YgZmlsZSB3aGljaCBtYXRjaGVzIHRoZSBzYW1wbGUgZmlsZSBzdHJ1Y3R1cmUiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAiRXJyb3IiKSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCEiLAogICAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgdHJ5IGFnYWluLiIsCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIHN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQhIiwKICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBlbXB0eV91cGxvYWRfY3N2X2NvbnRhY3RzKCkgewogICAgICB0aGlzLmNvbnRhY3RfY3N2ID0gewogICAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgRmlsZSIsCiAgICAgICAgZmlsZV9jb250ZW50OiBudWxsLAogICAgICAgIGZpbGVfc2VsZWN0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICAgICQoIiNpbnB1dEdyb3VwVXBsb2FkRmlsZWNzdiIpLnZhbCgiIik7CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlX2NvbnRhY3RfZmlsZSgpIHsKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzYW1wbGVfZmlsZTogIndoYXRzYXBwX2NvbnRhY3RzIiwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgIH0KICAgICAgfSkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIGZpbGUiKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5jb21wYW55bmFtZSkKICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgInRlc3QuY3N2Iik7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLiBQbGVhc2UgVHJ5IEFnYWluIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAoKICAgIHRleHRib3hfaGVpZ2h0KGlkLCBrZXkpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmICFldmVudC5zaGlmdEtleSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdGhpcy5zZW5kX21lc3NhZ2VfdG9fdXNlcigpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgIHRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBlID0+IHsKICAgICAgICAgIGxldCBzY3JvbGxfaGVpZ2h0ID0gZS50YXJnZXQuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgaWYgKHNjcm9sbF9oZWlnaHQgPiA2MCkgewogICAgICAgICAgICB0ZXh0YXJlYS5zdHlsZS5vdmVyZmxvdyA9ICJhdXRvIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRhcmVhLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjbG9zZV9kb2N1bWVudF9wcmV2aWV3KCkgewogICAgICB0aGlzLnNlbmRfYXR0YWNobWVudF9kZXRhaWwgPSB7CiAgICAgICAgbWVkaWFfZmlsZV9uYW1lOiBudWxsLAogICAgICAgIG1lZGlhX2ZpbGU6IG51bGwsCiAgICAgICAgc2hvd19wcmV2aWV3OiBmYWxzZSwKICAgICAgICBtZWRpYV9jb250ZW50X3R5cGU6IG51bGwsCiAgICAgICAgbWVkaWFfdHlwZTogbnVsbCwKICAgICAgICBzZW5kX21lZGlhOiB0cnVlLAogICAgICAgIGRvY3VtZW50X2NvbnRlbnQ6IG51bGwsCiAgICAgICAgbWVkaWFfY2FwdGlvbjogbnVsbAogICAgICB9OwogICAgfSwKICAgIHdoYXRzYXBwX21lc3NhZ2VfZm9ybWF0aW5nKGEpewogICAgICBmb3IgKGxldCBpPSAwIDtpPHRoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3QubGVuZ3RoO2krKyApewogICAgICAgIGxldCBjbnQgPSAwOwogICAgICAgIGxldCBwb3MxID0gLTE7CiAgICAgICAgd2hpbGUoY250IDwgYS5sZW5ndGgpewogICAgICAgICAgcG9zMSA9IGEuaW5kZXhPZih0aGlzLndoYXRzYXBwX2Zvcm1hdGluZ19saXN0W2ldLHBvczErMSkKICAgICAgICAgIGlmKHBvczEgPT0gLTEpewogICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByZXBsYWNlX2ZpcnN0X2NoYXIgPSBhLnN1YnN0cmluZygwLCBwb3MxKSArIHRoaXMud2hhdHNhcHBfZm9ybWF0X2RpY3RbdGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXV1bMF0gKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc3Vic3RyaW5nKHBvczEgKyAxKQogICAgICAgICAgYSA9cmVwbGFjZV9maXJzdF9jaGFyOwogICAgICAgICAgbGV0IHBvczIgPSBhLmluZGV4T2YodGhpcy53aGF0c2FwcF9mb3JtYXRpbmdfbGlzdFtpXSkKICAgICAgICAgIGxldCByZXBsYWNlX3NlY29uZF9jaGFyID0gYS5zdWJzdHJpbmcoMCwgcG9zMikgKyB0aGlzLndoYXRzYXBwX2Zvcm1hdF9kaWN0W3RoaXMud2hhdHNhcHBfZm9ybWF0aW5nX2xpc3RbaV1dWzFdICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnN1YnN0cmluZyhwb3MyICsgMSk7CiAgICAgICAgICBhID0gcmVwbGFjZV9zZWNvbmRfY2hhcgogICAgICAgICAgcG9zMSA9IHBvczI7CiAgICAgICAgICBjbnQgPSBwb3MyOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYTsKICAgIH0sCiAgICBmb3JtYXRVc2VyUXVlcnkoVXNlclF1ZXJ5KXsKICAgICAgaWYoVXNlclF1ZXJ5LnN0YXJ0c1dpdGgoJy8nKSl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGxldCBqc29uX3N0YXJ0ID0gVXNlclF1ZXJ5LmluZGV4T2YoJ3snKSwKICAgICAgICAgIGpzb25fZW5kID0gVXNlclF1ZXJ5LmluZGV4T2YoJ30nKSsxLAogICAgICAgICAganNvbl9kYXRhID0gSlNPTi5wYXJzZShVc2VyUXVlcnkuc3Vic3RyaW5nKGpzb25fc3RhcnQsIGpzb25fZW5kKSk7CiAgICAgICAgICByZXR1cm4gYElkOiAke2pzb25fZGF0YS5vcmRlcl9pZH1gOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4gVXNlclF1ZXJ5CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBVc2VyUXVlcnkKICAgIH0sCiAgICBnZXRfb3JkZXJfdGVtcGxhdGVfZm9ybWF0dGVkX3RleHQoY3VycmVudF9ib3RfcmVzcG9uc2UpewogICAgICByZXR1cm4gdGhpcy53aGF0c2FwcF9tZXNzYWdlX2Zvcm1hdGluZyhjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PSdCT0RZJykudGV4dCk7CiAgICB9LAogICAgY2hlY2tfYnV0dG9uX2luX29yZGVyX3RlbXBsYXRlKGN1cnJlbnRfYm90X3Jlc3BvbnNlKXsKICAgICAgbGV0IGNoZWNrX2J1dHRvbnMgPSBjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PSAnQlVUVE9OUycpOwogICAgICBpZihCb29sZWFuKGNoZWNrX2J1dHRvbnMpKXsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgZ2V0X29yZGVyX3RlbXBsYXRlX2J1dHRvbl91cmwoY3VycmVudF9ib3RfcmVzcG9uc2UsIGtleSl7CiAgICAgIHJldHVybiBjdXJyZW50X2JvdF9yZXNwb25zZS50ZW1wbGF0ZS5jb21wb25lbnRzLmZpbmQoKGl0ZW0pID0+IGl0ZW0udHlwZSA9PSdCVVRUT05TJykuYnV0dG9ucy5maW5kKChpdGVtKSA9PiBpdGVtLnR5cGUgPT0gJ1VSTCcpW2tleV0KICAgIH0KCiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5jaGFubmVsLmxlYXZlKCk7CiAgICB0aGlzLmNoYXRfc29ja2V0LmRpc2Nvbm5lY3QoKTsKICB9Cn07Cg=="},null]}