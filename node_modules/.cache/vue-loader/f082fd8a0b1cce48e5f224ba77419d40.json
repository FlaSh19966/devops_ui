{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/AddTasks.vue","mtime":1643027096168},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCB7IHRzT2JqZWN0S2V5d29yZCB9IGZyb20gIkBiYWJlbC90eXBlcyI7CmltcG9ydCB7IGZyZWV6ZV9wb3J0YWwsc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQWRkVGFza1BhZ2UiLAogIG1peGluczogWwogICAgZnJlZXplX3BvcnRhbCwKICAgIHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCwKICBdLAogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlucHV0X2xpc3Q6IHsKICAgICAgICB0YXNrX25hbWU6ICIiLAogICAgICAgIGludGVudDogIiIsCiAgICAgICAgZmllbGRzOiBbXSwKICAgICAgICBxdWVzdGlvbjogIiIsCiAgICAgICAgcXVlc3Rpb25faWQ6ICIiLAogICAgICB9LAogICAgICB0b3RhbF9wYWdlczogMSwKICAgICAgcGVyX3BhZ2U6IDEwLAogICAgICBwYWdlX25vOiAxLAogICAgICBxdWVzdGlvbl90ZXh0OiBmYWxzZSwKICAgICAgcXVlc3Rpb25fZW50ZXJlZDogIiIsCiAgICAgIGludGVudGxpc3Q6IFtdLAogICAgICB0YXNrX2xpc3Q6IFtdLAogICAgICBvcmlnaW5hbF9pbnRlbnRfbGlzdDogW10sCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGlzRWRpdDogZmFsc2UsCiAgICAgIHF1ZXN0aW9uc19saXN0OiBbXSwKICAgICAgLy8gaGFyc2gKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgdGFza190eXBlOiAiRGVmYXVsdCIsCiAgICAgIHRhc2tfdHlwZXM6IFsiRW1haWwiLCAiU01TIiwgIkRlZmF1bHQiXSwKICAgICAgZW1haWxfdG9fdXNlcjogdHJ1ZSwKICAgICAgYWRkX2N1c3RvbXNfZW1haWw6IHRydWUsCiAgICAgIG5ld19jdXN0b21fZW1haWw6IG51bGwsCiAgICAgIGN1c3RvbV9lbWFpbHM6IFtdLAogICAgICBlbWFpbF90aXRsZTogbnVsbCwKICAgICAgZW1haWxfYm9keTogbnVsbCwKICAgICAgZW1haWxfdmFyaWFibGVzOiBbXSwKICAgICAgc21zX3RvX3VzZXI6IHRydWUsCiAgICAgIGFkZF9jdXN0b21zX251bWJlcjogdHJ1ZSwKICAgICAgbmV3X2N1c3RvbV9udW1iZXI6IG51bGwsCiAgICAgIGN1c3RvbV9udW1iZXI6IFtdLAogICAgICBzbXNfYm9keTogbnVsbCwKICAgICAgc21zX3ZhcmlibGVzOiBbXSwKICAgICAgc2VsZWN0ZWRfdGFzazogbnVsbCwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOmZhbHNlLAogICAgICAvLyAtLS0tCiAgICAgIGNvbXBhbnlpZDoKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpCiAgICAgICAgICA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICBjb21wYW55bmFtZToKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIikKICAgICAgICAgIDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgdmFyaWFibGU6ICJ7e25hbWV9fSIsCiAgICAgIHByZXZpZXc6IGZhbHNlLAogICAgICBkZWxldGVfdGFza19pZHM6IFtdLAogICAgICBib2R5X2NvbnRlbnQ6IGBIaSB7e25hbWV9fSwKICAgICAgICBZb3UgYXJlIHJlY2VpdmluZyB0aGlzIGVtYWlsIGJlY2F1c2UgeW91IChvciBzb21lb25lIGVsc2UpIGhhdmUgcmVxdWVzdGVkIHRvIHJlc2V0IHRoZSBwYXNzd29yZCBvZiB7e25hbWV9fSBhY2NvdW50LgogICAgICAgIFBsZWFzZSBjbGljayBvbiB0aGUgZm9sbG93aW5nIGxpbmssIG9yIHBhc3RlIHRoaXMgaW50byB5b3VyIGJyb3dzZXIgdG8gY29tcGxldGUgdGhlIHByb2Nlc3M6CiAgICAgICAgaHR0cHM6Ly9jZW5zZS5haS9jaGFuZ2UtcGFzc3dvcmQKICAgICAgICBJZiB5b3UgZGlkIG5vdCByZXF1ZXN0IHRoaXMsIHBsZWFzZSBpZ25vcmUgdGhpcyBlbWFpbCBhbmQgeW91ciBwYXNzd29yZCB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuCgogICAgICAgIFJlZ2FyZHMsCiAgICAgICAgQWRtaW5gLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRfdGFzaygpOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5lclRyYWluaW5nUGFnZURpc2FibGVkIiwgKGRhdGEpID0+ewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSkKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjdGFza21vZGFsIikub24oImhpZGRlbi5icy5tb2RhbCIsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZtLmNsZWFyX2ZpZWxkcygpOwogICAgfSk7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgIC8vICQoJ2RpdjppbnB1dCcpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoX25hbWUoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09PSAiIikgewogICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRfdGFzaygpewogICAgICBpZighdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkKXsKICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoJ3Nob3cnKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGxvYWRfdGFzaygpIHsKICAgICAgaWYgKAogICAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikgJiYKICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICAgKSB7CiAgICAgICAgdG9hc3RyLndhcm5pbmcoIlBsZWFzZSBzZWxlY3QgYSBjb21wYW55IG5hbWUgZnJvbSB0aGUgZHJvcGRvd24iKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuc2hvd19pbnRlbnRfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZ2V0X2ludGVudHM6IHRydWUsCiAgICAgICAgICAgIHNob3dpbnRlbnQ6ICJUcnVlIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAvLyBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIC8vICAgdGhpcy5pbnRlbnRsaXN0LnB1c2goCiAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIikKICAgICAgICAgIC8vICAgKTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICB0aGlzLmludGVudGxpc3QucHVzaCgKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhW2ldCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLm9wZW5fZm9ybV90YXNrcygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiTUFpTiBMSVNUIiwgcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpOwogICAgICAgICAgdGhpcy50YXNrX2xpc3QgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlID09ICJkZWZhdWx0IikgewogICAgICAgICAgICAgIGxldCBkZXNjID0gW107CiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICBRdWVzdGlvbklkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlNsb3ROYW1lLAogICAgICAgICAgICAgICAgICBUZXh0OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlRleHQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGRlc2MubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgICAgVGFza05hbWU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tOYW1lLAogICAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgICAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgICAgICAgICAgIFRhc2tfVHlwZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUgPT0gIkVtYWlsIikgewogICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgSW50ZW50OiAiTm9uZSIsCiAgICAgICAgICAgICAgICAvLyBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tEZXRhaWxzLAogICAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSA9PSAiU01TIikgewogICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgSW50ZW50OiAiTm9uZSIsCiAgICAgICAgICAgICAgICAvLyBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgIFRhc2tfRGVzY3JpcHRpb246IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tEZXRhaWxzLAogICAgICAgICAgICAgICAgVGFza19JZDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza0lELAogICAgICAgICAgICAgICAgVGFza19UeXBlOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrVHlwZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXSkgewogICAgICAgICAgICAgIGxldCBkZXNjID0gW107CiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICBRdWVzdGlvbklkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlNsb3ROYW1lLAogICAgICAgICAgICAgICAgICBUZXh0OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzW2pdLlRleHQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGRlc2MubGVuZ3RoICE9IDApIHsKICAgICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgICAgVGFza05hbWU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tOYW1lLAogICAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgICAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgICAgICAgICAgIFRhc2tfVHlwZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza1R5cGUsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJ0YXNrIGlkIik7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9yaWdpbmFsX2ludGVudF9saXN0ID0gdGhpcy50YXNrX2xpc3Q7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm9yaWdpbmFsX2ludGVudF9saXN0KTsKICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgIC8vICAgbGV0IGRlc2MgPSBbXTsKICAgICAgICAgIC8vICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAvLyAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgIC8vICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dAogICAgICAgICAgLy8gICAgIH0pOwogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAvLyAgICAgdGhpcy50YXNrX2xpc3QucHVzaCh7CiAgICAgICAgICAvLyAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgIC8vICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgIC8vICAgICAgIFRhc2tfRGVzY3JpcHRpb246IGRlc2MsCiAgICAgICAgICAvLyAgICAgICBUYXNrX0lkOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrSUQsCiAgICAgICAgICAvLyAgICAgICBUYXNrX1R5cGU6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlRhc2tUeXBlLAogICAgICAgICAgLy8gICAgIH0pOwogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyB9CiAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgYWRkX3F1ZXN0aW9uKHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFZGl0ID09IHRydWUpewogICAgICAgICAgdmFyIGNvdW50ID0gdGhpcy5xdWVzdGlvbnNfbGlzdC5sZW5ndGggKyAyOyAgICAgICAgICAKICAgICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh7CiAgICAgICAgICBUZXh0OiAiIiwKICAgICAgICAgIFF1ZXN0aW9uSWQ6ICJRdWVzdGlvbl9OdW1iZXJfIiArIGNvdW50ICsgIl8iICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgLAogICAgICAgIH0pOwogICAgICAgICAgY291bnQgPSBjb3VudCArIDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3QucHVzaCh7CiAgICAgICAgICBUZXh0OiAiIiwKICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMucXVlc3Rpb25zX2xpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGFkZF9lbWFpbCh0eXBlLCBpbmRleCkgewogICAgICBpZiAodHlwZSA9PSAiYWRkIikgewogICAgICAgIHRoaXMuY3VzdG9tX2VtYWlscy5wdXNoKHRoaXMubmV3X2N1c3RvbV9lbWFpbCk7CiAgICAgICAgdGhpcy5uZXdfY3VzdG9tX2VtYWlsID0gbnVsbDsKICAgICAgfSBlbHNlIGlmICh0eXBlID09ICJyZW1vdmUiKSB7CiAgICAgICAgdGhpcy5jdXN0b21fZW1haWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRfbnVtYmVyKHR5cGUsIGluZGV4KSB7CiAgICAgIGlmICh0eXBlID09ICJhZGQiICYmIGV2ZW50LmtleUNvZGUgPT09IDEzKSB7CiAgICAgICAgdGhpcy5jdXN0b21fbnVtYmVyLnB1c2godGhpcy5uZXdfY3VzdG9tX251bWJlcik7CiAgICAgICAgdGhpcy5uZXdfY3VzdG9tX251bWJlciA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuY3VzdG9tX251bWJlci5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgaW50ZW50X3NlbGVjdGVkX2FwaSgpIHt9LAogICAgZWRpdF9tb2RhbCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3RlZF90YXNrOwogICAgICB0aGlzLmlzRWRpdCA9IHRydWU7CiAgICAgIHRoaXMucHJldmlldyA9IGZhbHNlOwogICAgICAvLyB0aGlzLnRhc2tfdHlwZSA9IEJvb2xlYW4odGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSkKICAgICAgLy8gICA/IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGUKICAgICAgLy8gICA6ICJEZWZhdWx0IgogICAgICAvLyB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLkludGVudDsKICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrTmFtZTsKICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb25bMF0uVGV4dDsKICAgICAgLy8gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uc3BsaWNlKDAsIDEpOwogICAgICAvLyBmb3IgKHZhciBqIGluIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uKSB7CiAgICAgIC8vICAgdGhpcy5xdWVzdGlvbnNfbGlzdC5wdXNoKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uW2pdKTsKICAgICAgLy8gfQogICAgfSwKICAgIHNlbGVjdGVkX3Rhc2tzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0aGlzLnRhc2tfbGlzdDsKICAgICAgICB9IGVsc2UgaWYgKCFldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2goaW5kZXgpOwogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIGxldCB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKGluZGV4KTsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnNwbGljZSh2YWxfaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGFkZF9lZGl0X3Rhc2tzKCkgewogICAgICBpZiAodGhpcy50YXNrX3R5cGUgPT0gIkRlZmF1bHQiKSB7CiAgICAgICAgdmFyIGVtcHR5X3F1ZXN0aW9ucyA9IHRoaXMucXVlc3Rpb25zX2xpc3QuZmlsdGVyKChxdWVzdGlvbikgPT4gewogICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLlRleHQgPT0gIiI7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKAogICAgICAgICAgdGhpcy5lbXB0eV9maWVsZHNfY2hlY2soKSAmJgogICAgICAgICAgKHRoaXMucXVlc3Rpb25zX2xpc3QubGVuZ3RoID09IDAgfHwgZW1wdHlfcXVlc3Rpb25zLmxlbmd0aCA9PSAwKQogICAgICAgICkgewogICAgICAgICAgLy8gdGhpcy5pbnB1dF9saXN0LmZpZWxkcy5wdXNoKHsKICAgICAgICAgIC8vICAgVGV4dDogdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uCiAgICAgICAgICAvLyB9KTsKICAgICAgICAgIC8vIGZvciAodmFyIGkgaW4gdGhpcy5xdWVzdGlvbnNfbGlzdCkgewogICAgICAgICAgLy8gICB0aGlzLmlucHV0X2xpc3QuZmllbGRzLnB1c2godGhpcy5xdWVzdGlvbnNfbGlzdFtpXSk7CiAgICAgICAgICAvLyB9CiAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZWRpdF9vYmplY3QgPSB7fTsKICAgICAgICAgICAgdmFyIGVkaXRfc2xvdF9tYXBwaW5nX2RhdGEgPSB7fTsKICAgICAgICAgICAgbGV0IGkgPSAxOwogICAgICAgICAgICB2YXIgdGFza3F1ZXN0aW9uID0gW107CiAgICAgICAgICAgIHRhc2txdWVzdGlvbi5wdXNoKHsKICAgICAgICAgICAgICBUeXBlOiAiQXNrIiwKICAgICAgICAgICAgICBUZXh0OiB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24sCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlZGl0X29iamVjdFt0aGlzLmlucHV0X2xpc3QucXVlc3Rpb25faWRdID0KICAgICAgICAgICAgICB0YXNrcXVlc3Rpb25bMF07CiAgICAgICAgICAgIGVkaXRfc2xvdF9tYXBwaW5nX2RhdGFbdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uX2lkXSA9IHsKICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IGZhbHNlLAogICAgICAgICAgICAgIGludGVudDogdHJ1ZSwKICAgICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZm9yIChpID0gMjsgaSA8IHRoaXMucXVlc3Rpb25zX2xpc3QubGVuZ3RoICsgMjsgaSsrKSB7CiAgICAgICAgICAgICAgdGFza3F1ZXN0aW9uLnB1c2goewogICAgICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgICAgICBUZXh0OiB0aGlzLnF1ZXN0aW9uc19saXN0W2kgLSAyXS5UZXh0LAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGVkaXRfb2JqZWN0W3RoaXMucXVlc3Rpb25zX2xpc3RbaS0yXS5RdWVzdGlvbklkXSA9CiAgICAgICAgICAgICAgICB0YXNrcXVlc3Rpb25baSAtIDFdOwogICAgICAgICAgICAgIGVkaXRfc2xvdF9tYXBwaW5nX2RhdGFbdGhpcy5xdWVzdGlvbnNfbGlzdFtpLTJdLlF1ZXN0aW9uSWRdID0gewogICAgICAgICAgICAgICAgZnJvbV90ZXh0OiB0cnVlLAogICAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IGZhbHNlLAogICAgICAgICAgICAgICAgaW50ZW50OiB0cnVlLAogICAgICAgICAgICAgICAgbm90X2ludGVudDogZmFsc2UsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiVGhpcyBpcyB0aGUgRURJVCBvYmplY3QiLCBlZGl0X29iamVjdCk7CiAgICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgICAgLnB1dCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy50YXNrX2xpc3RfdXJsKCksCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmlucHV0X2xpc3QuaW50ZW50LAogICAgICAgICAgICAgICAgICB0YXNrX2RldGFpbHM6IGVkaXRfb2JqZWN0LAogICAgICAgICAgICAgICAgICB0YXNrX2lkOiB0aGlzLnRhc2tfbGlzdFt0aGlzLnNlbGVjdGVkX3Rhc2tdLlRhc2tfSWQsCiAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgICAvLyB0YXNrX2RldGFpbHM6IHRoaXMuaW5wdXRfbGlzdC5maWVsZHMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiVGFzayBFZGl0IikgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgICAgICAgIlRoZSBzYXZlZCBjaGFuZ2VzIHdvdWxkIGJlIHJlZmxlY3RlZCBvbmNlIHRoZSBtb2RlbCBpcyB0cmFpbmVkLiIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRWRpdCA9PSBmYWxzZSkgewogICAgICAgICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgICAgdmFyIHNsb3RfbWFwcGluZ19kYXRhID0ge307CiAgICAgICAgICAgIGxldCBpID0gMTsKICAgICAgICAgIHZhciB0YXNrcXVlc3Rpb24gPSBbXTsKICAgICAgICAgIHRhc2txdWVzdGlvbi5wdXNoKHsKICAgICAgICAgICAgVHlwZTogIkFzayIsCiAgICAgICAgICAgIFRleHQ6IHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiwKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHVuaXF1ZV9rZXkgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSA7CiAgICAgICAgICBvYmplY3RbIlF1ZXN0aW9uX051bWJlcl8xIiArICJfIiArIHVuaXF1ZV9rZXldID0gdGFza3F1ZXN0aW9uWzBdOwogICAgICAgICAgc2xvdF9tYXBwaW5nX2RhdGFbIlF1ZXN0aW9uX051bWJlcl8xIiArICJfIiArIHVuaXF1ZV9rZXldID0gewogICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgIGZyb21fZW50aXR5OiBmYWxzZSwKICAgICAgICAgICAgaW50ZW50OiB0cnVlLAogICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZSwKICAgICAgICAgIH07CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgdGhpcy5xdWVzdGlvbnNfbGlzdC5sZW5ndGggKyAyOyBpKyspIHsKICAgICAgICAgICAgdGFza3F1ZXN0aW9uLnB1c2goewogICAgICAgICAgICAgIFR5cGU6ICJBc2siLAogICAgICAgICAgICAgIFRleHQ6IHRoaXMucXVlc3Rpb25zX2xpc3RbaSAtIDJdLlRleHQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgdW5pcXVlX2tleV8yID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgOyAKICAgICAgICAgICAgb2JqZWN0WyJRdWVzdGlvbl9OdW1iZXJfIiArIGkgKyAiXyIgKyB1bmlxdWVfa2V5XzJdID0KICAgICAgICAgICAgICB0YXNrcXVlc3Rpb25baSAtIDFdOwogICAgICAgICAgICBzbG90X21hcHBpbmdfZGF0YVsiUXVlc3Rpb25fTnVtYmVyXyIgKyBpICsgIl8iICsgdW5pcXVlX2tleV8yXSA9IHsKICAgICAgICAgICAgICBmcm9tX3RleHQ6IHRydWUsCiAgICAgICAgICAgICAgZnJvbV9lbnRpdHk6IGZhbHNlLAogICAgICAgICAgICAgIGludGVudDogdHJ1ZSwKICAgICAgICAgICAgICBub3RfaW50ZW50OiBmYWxzZSwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJUaGlzIGlzIHRoZSBvYmplY3QiLCBvYmplY3QpOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLnRhc2tfbGlzdF91cmwoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQsCiAgICAgICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogb2JqZWN0LAogICAgICAgICAgICAgICAgICAvLyB0YXNrX2RldGFpbHM6IHRoaXMuaW5wdXRfbGlzdC5maWVsZHMsCiAgICAgICAgICAgICAgICAgIHNsb3RfbWFwcGluZ19kYXRhOiBzbG90X21hcHBpbmdfZGF0YSwKICAgICAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJUYXNrIEFkZGVkIikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgZW50ZXIgYWxsIHRoZSByZXF1aXJlZCBmaWVsZHMuIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMudGFza190eXBlID09ICJFbWFpbCIpIHsKICAgICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgICAgdmFyIGFsbG9rID0gdHJ1ZTsKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLmVtYWlsX3RpdGxlID09IG51bGwgfHwKICAgICAgICAgIHRoaXMuZW1haWxfdGl0bGUgPT0gIiIgfHwKICAgICAgICAgIHRoaXMuZW1haWxfYm9keSA9PSBudWxsIHx8CiAgICAgICAgICB0aGlzLmVtYWlsX2JvZHkgPT0gIiIKICAgICAgICApIHsKICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIGlmKHRoaXMuYWRkX2N1c3RvbXNfZW1haWwmJnRoaXMuY3VzdG9tX2VtYWlscy5sZW5ndGg9PTApewogICAgICAgIC8vICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICAvLyB9CiAgICAgICAgaWYgKHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmVtYWlsX3ZhcmlhYmxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW1haWxfdmFyaWFibGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSAiIiB8fAogICAgICAgICAgICAgIHRoaXMuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uID09IG51bGwgfHwKICAgICAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSAiICIKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgYWxsb2sgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYWxsb2spIHsKICAgICAgICAgIG9iamVjdFsic3ViamVjdCJdID0gdGhpcy5lbWFpbF90aXRsZTsKICAgICAgICAgIG9iamVjdFsiYm9keSJdID0gdGhpcy5lbWFpbF9ib2R5OwogICAgICAgICAgb2JqZWN0WyJ1c2VyX2VtYWlsIl0gPSB0aGlzLmVtYWlsX3RvX3VzZXI7CiAgICAgICAgICBvYmplY3RbImN1c3RvbV9lbWFpbHMiXSA9IHRoaXMuY3VzdG9tX2VtYWlsczsKICAgICAgICAgIG9iamVjdFsiZW1haWxfdmFyaWFibGVzIl0gPSB0aGlzLmVtYWlsX3ZhcmlhYmxlczsKCiAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQsCiAgICAgICAgICAgICAgICAgIHRhc2tfbmFtZTogdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSwKICAgICAgICAgICAgICAgICAgdGFza190eXBlOiAiRW1haWwiLAogICAgICAgICAgICAgICAgICB0YXNrX2RldGFpbHM6IG9iamVjdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoKHJlc3BvbnNlLmRhdGEgPSAiVGFzayBBZGRlZCIpKSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhc2sgaGFzIGJlZW4gYWRkZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICAgICQoIiN0YXNrbW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNFZGl0ID09IHRydWUpIHsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucHV0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLm9wZW5fZm9ybV90YXNrcygpLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIGludGVudDogdGhpcy5pbnB1dF9saXN0LmludGVudCwKICAgICAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgICAgICB0YXNrX3R5cGU6ICJFbWFpbCIsCiAgICAgICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogb2JqZWN0LAogICAgICAgICAgICAgICAgICB0YXNrX2lkOiB0aGlzLnRhc2tfbGlzdFt0aGlzLnNlbGVjdGVkX3Rhc2tdLlRhc2tfSWQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKChyZXNwb25zZS5kYXRhID0gIlRhc2sgRWRpdCIpKSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHRhc2sgaGFzIGJlZW4gZWRpdGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3Rhc2soKTsKICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcy4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX3R5cGUgPT0gIlNNUyIpIHsKICAgICAgICB2YXIgb2JqZWN0ID0ge307CiAgICAgICAgdmFyIGFsbG9rID0gdHJ1ZTsKICAgICAgICBpZiAodGhpcy5zbXNfYm9keSA9PSBudWxsIHx8IHRoaXMuc21zX2JvZHkgPT0gIiIpIHsKICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIGlmKHRoaXMuYWRkX2N1c3RvbXNfbnVtYmVyJiZ0aGlzLmN1c3RvbV9udW1iZXIubGVuZ3RoPT0wKXsKICAgICAgICAvLyAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgLy8gfQogICAgICAgIGlmICh0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID09ICIiKSB7CiAgICAgICAgICBhbGxvayA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zbXNfdmFyaWJsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNtc192YXJpYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiIgfHwKICAgICAgICAgICAgICB0aGlzLnNtc192YXJpYmxlc1tpXS52YXJpYWJsZV9kZXNjcmlwdGlvbiA9PSBudWxsIHx8CiAgICAgICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfZGVzY3JpcHRpb24gPT0gIiAiCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIGFsbG9rID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFsbG9rKSB7CiAgICAgICAgICBvYmplY3RbImJvZHkiXSA9IHRoaXMuc21zX2JvZHk7CiAgICAgICAgICBvYmplY3RbInVzZXJfbnVtYmVyIl0gPSB0aGlzLnNtc190b191c2VyOwogICAgICAgICAgb2JqZWN0WyJjdXN0b21fbnVtYmVycyJdID0gdGhpcy5jdXN0b21fbnVtYmVyOwogICAgICAgICAgb2JqZWN0WyJzbXNfdmFyaWFibGVzIl0gPSB0aGlzLnNtc192YXJpYmxlczsKCiAgICAgICAgICBpZiAodGhpcy5pc0VkaXQgPT0gZmFsc2UpIHsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICB0YXNrX25hbWU6IHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUsCiAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogIlNNUyIsCiAgICAgICAgICAgICAgICAgIHRhc2tfZGV0YWlsczogb2JqZWN0LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIGlmICgocmVzcG9uc2UuZGF0YSA9ICJUYXNrIEFkZGVkIikpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFzayBoYXMgYmVlbiBhZGRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0VkaXQgPT0gdHJ1ZSkgewogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wdXQoCiAgICAgICAgICAgICAgICBhcGlfY2FsbHMub3Blbl9mb3JtX3Rhc2tzKCksCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgdGFza19uYW1lOiB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lLAogICAgICAgICAgICAgICAgICB0YXNrX3R5cGU6ICJTTVMiLAogICAgICAgICAgICAgICAgICB0YXNrX2RldGFpbHM6IG9iamVjdCwKICAgICAgICAgICAgICAgICAgdGFza19pZDogdGhpcy50YXNrX2xpc3RbdGhpcy5zZWxlY3RlZF90YXNrXS5UYXNrX0lkLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIGlmICgocmVzcG9uc2UuZGF0YSA9ICJUYXNrIEVkaXQiKSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiWW91ciB0YXNrIGhhcyBiZWVuIGVkaXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgJCgiI3Rhc2ttb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfc2VsZWN0ZWQoKSB7CiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIk5vIHRhc2sgc2VsZWN0ZWQhIiwKICAgICAgICAgIHRleHQ6ICIiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGVsZXRlX3Rhc2tfaWRzID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2RlbGV0ZSB0YXNrJyk7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhpLlRhc2tfSWQpOwogICAgICAgICAgdGhpcy5kZWxldGVfdGFza19pZHMucHVzaCgKICAgICAgICAgICAgdGhpcy50YXNrX2xpc3RbdGhpcy5jaGVja2VkX2xpc3RbaV1dLlRhc2tfSWQKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZGVsZXRlX3Rhc2tfaWRzKTsKICAgICAgICB0aGlzLmRlbGV0ZV90YXNrc19hcGkoKTsKICAgICAgICAvLyBsZXQgcXVlc3Rpb25saXN0ID0gW10sZGVsZXRlX3Rhc2tfaWRzCiAgICAgICAgLy8gICByZXNwb25zZWxpc3QgPSBbXSwKICAgICAgICAvLyAgIGludGVudGxpc3QgPSBbXSwKICAgICAgICAvLyAgIHNvdXJjZWxpc3QgPSBbXTsKICAgICAgICAvLyBmb3IgKHZhciBpIGluIHRoaXMuY2hlY2tlZF9saXN0KSB7CiAgICAgICAgLy8gICBxdWVzdGlvbmxpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXS5xdWVzdGlvbik7CiAgICAgICAgLy8gICByZXNwb25zZWxpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXS5yZXNwb25zZSk7CiAgICAgICAgLy8gICBzb3VyY2VsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0uc291cmNlKTsKICAgICAgICAvLyAgIGludGVudGxpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXS5pbnRlbnQpOwogICAgICAgIC8vIH0KICAgICAgICAvLyB0aGlzLmRlbGV0ZV90YXNrc19hcGkocXVlc3Rpb25saXN0LCByZXNwb25zZWxpc3QsIHNvdXJjZWxpc3QsIGludGVudGxpc3QpOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlX3NpbmdsZShpbmRleCkgewogICAgICAvLyBsZXQgaW50ZW50cyA9IFtdOwogICAgICAvLyBpbnRlbnRzLnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLkludGVudCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGluZGV4KTsKICAgICAgdGhpcy5kZWxldGVfdGFza19pZHMgPSBbXTsKICAgICAgdGhpcy5kZWxldGVfdGFza19pZHMucHVzaCh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19JZCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZGVsZXRlX3Rhc2tfaWRzKTsKICAgICAgdGhpcy5kZWxldGVfdGFza3NfYXBpKCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJkZWxldGUgc2luZ2xlIikKICAgICAgLy8gY29uc29sZS5sb2codGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfSWQpCiAgICB9LAogICAgZGVsZXRlX3Rhc2tzX2FwaSgpIHsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgIHRleHQ6ICJZb3Ugd29uJ3QgYmUgYWJsZSB0byByZXZlcnQgdGhpcyEiLAogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIGRlbGV0ZSBpdCEiLAogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAuZGVsZXRlKAogICAgICAgICAgICAgIGFwaV9jYWxscy5vcGVuX2Zvcm1fdGFza3MoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgICAgICAgICAgICAgIC5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICB0YXNrX2lkczogdGhpcy5kZWxldGVfdGFza19pZHMsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09ICJGYWlsdXJlIikgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJGYWlsZWQgdG8gZGVsZXRlIHRhc2suIik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJUYXNrIHdhcyBkZWxldGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAvLyBheGlvcwogICAgICAgICAgLy8gICAuZGVsZXRlKGFwaV9jYWxscy50YXNrX2xpc3RfdXJsKCksIHsKICAgICAgICAgIC8vICAgICBkYXRhOiB7CiAgICAgICAgICAvLyAgICAgICBpbnRlbnRzOiBpbnRlbnRzLAogICAgICAgICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIC8vICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbgogICAgICAgICAgLy8gICAgIH0KICAgICAgICAgIC8vICAgfSwgewogICAgICAgICAgLy8gICBoZWFkZXJzOiB7CiAgICAgICAgICAvLyAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAvLyAgIH0sCiAgICAgICAgICAvLyB9KQogICAgICAgICAgLy8gICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlRhc2socykgRGVsZXRlZCIpIHsKICAgICAgICAgIC8vICAgICAgIFN3YWwuZmlyZSgKICAgICAgICAgIC8vICAgICAgICAgIkRlbGV0ZWQhIiwKICAgICAgICAgIC8vICAgICAgICAgIllvdXIgdGFzayhzKSBoYXZlIGJlZW4gZGVsZXRlZC4iLAogICAgICAgICAgLy8gICAgICAgICAic3VjY2VzcyIKICAgICAgICAgIC8vICAgICAgICk7CiAgICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIC8vICAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAvLyAgICAgICB9LCAyNTAwKTsKICAgICAgICAgIC8vICAgICB9CiAgICAgICAgICAvLyAgIH0pCiAgICAgICAgICAvLyAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIC8vICAgICBpZiAoCiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAvLyAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAvLyAgICAgKSB7CiAgICAgICAgICAvLyAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgLy8gICAgIH0KICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlbXB0eV9maWVsZHNfY2hlY2soKSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID09ICIiIHx8CiAgICAgICAgdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9PSAiIiB8fAogICAgICAgIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9PSAiIgogICAgICApIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIGZpZWxkcyIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAvLyBmb3IgKHZhciBpIGluIHRoaXMuaW5wdXRfbGlzdC5maWVsZHMpIHsKICAgICAgICAvLyAgIGlmICgKICAgICAgICAvLyAgICAgdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9PSAiIiB8fAogICAgICAgIC8vICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID09ICIiIHx8CiAgICAgICAgLy8gICAgIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbiA9PSAiIgogICAgICAgIC8vICAgKSB7CiAgICAgICAgLy8gICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGVudGVyIGFsbCB0aGUgZmllbGRzIik7CiAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAvLyAgIH0gZWxzZSBpZiAodGhpcy5pbnB1dF9saXN0LmZpZWxkc1tpXS52YWx1ZSA9PSAiIikgewogICAgICAgIC8vICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBlbnRlciBhbGwgdGhlIGZpZWxkcyIpOwogICAgICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgLy8gICB9IGVsc2UgaWYgKAogICAgICAgIC8vICAgICBpID09IHRoaXMuaW5wdXRfbGlzdC5maWVsZHMubGVuZ3RoIC0gMSAmJgogICAgICAgIC8vICAgICB0aGlzLmlucHV0X2xpc3QuZmllbGRzW2ldLnZhbHVlICE9ICIiCiAgICAgICAgLy8gICApIHsKICAgICAgICAvLyAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfQogICAgICB9CiAgICB9LAogICAgY2xlYXJfZmllbGRzKCkgewogICAgICB0aGlzLmlucHV0X2xpc3QuaW50ZW50ID0gIiI7CiAgICAgIHRoaXMuaW5wdXRfbGlzdC50YXNrX25hbWUgPSAiIjsKICAgICAgdGhpcy5pbnB1dF9saXN0LmZpZWxkcyA9IFtdOwogICAgICB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSAiIjsKICAgICAgdGhpcy5xdWVzdGlvbnNfbGlzdCA9IFtdOwogICAgICB0aGlzLmlzRWRpdCA9IGZhbHNlOwogICAgICB0aGlzLnByZXZpZXcgPSBmYWxzZTsKICAgICAgdGhpcy5xdWVzdGlvbl90ZXh0ID0gZmFsc2U7CiAgICAgIHRoaXMudGFza19saXN0W3RoaXMuc2VsZWN0ZWRfdGFza10gPSB0aGlzLm9yaWdpbmFsX2ludGVudF9saXN0WwogICAgICAgIHRoaXMuc2VsZWN0ZWRfdGFzawogICAgICBdOwogICAgfSwKICAgIGNhbGxzZWFyY2goKSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgewogICAgICAgIHRoaXMuc2VhcmNoX3Byb2R1Y3QoKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9wcm9kdWN0KCkgewogICAgICAvLyBpZih0aGlzLnNlYXJjaF9ieSE9JycpewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy50YXNrX2xpc3RfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAvLyBzZWFyY2hieTogdGhpcy5zZWFyY2hfYnksCiAgICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIHBhZ2Vfbm86IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnZWNvdW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IDE7CiAgICAgICAgICAgICAgdGhpcy50YXNrX2xpc3QgPSBbXTsKICAgICAgICAgICAgICB0aGlzLm9yaWdpbmFsX2ludGVudF9saXN0ID0gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3Q7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdCkgewogICAgICAgICAgICAgICAgbGV0IGRlc2MgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlcykgewogICAgICAgICAgICAgICAgICBkZXNjLnB1c2goewogICAgICAgICAgICAgICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dCwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBJbnRlbnQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLkludGVudCwKICAgICAgICAgICAgICAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAgICAgICAgICAgVGFza19EZXNjcmlwdGlvbjogZGVzYywKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gVGFza3MgRm91bmQiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJObyBUYXNrIEZvdW5kIik7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF90YXNrKCk7CiAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJFbnRlciBwcm9wZXIgZGF0YSBmb3Igc2VhcmNoaW5nIik7CiAgICAgIH0KICAgICAgLy8gfWVsc2V7CiAgICAgIC8vICAgdG9hc3RyLmVycm9yKCJTZWxlY3QgaGVhZGVyIGZvciBzZWFyY2hpbmciKTsKICAgICAgLy8gfQogICAgfSwKICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMudGFza19saXN0X3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBpc1Nob3c6IHRydWUsCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRhc2tfbGlzdCA9IFtdOwogICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxfaW50ZW50X2xpc3QgPSByZXNwb25zZS5kYXRhLlRhc2tzTGlzdDsKICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0KSB7CiAgICAgICAgICAgICAgICBsZXQgZGVzYyA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgVGV4dDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVXR0ZXJhbmNlc1tqXS5UZXh0LAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkZXNjLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgIEludGVudDogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uSW50ZW50LAogICAgICAgICAgICAgICAgICAgIFRhc2tOYW1lOiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5UYXNrTmFtZSwKICAgICAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIGlmIChwYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlbm87CiAgICAgICAgICB9CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMudGFza19saXN0X3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vIHNlYXJjaGJ5OiB0aGlzLnNlYXJjaF9ieSwKICAgICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogcGFnZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5wYWdlY291bnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgICAgICAgdGhpcy50YXNrX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxfaW50ZW50X2xpc3QgPSByZXNwb25zZS5kYXRhLlRhc2tzTGlzdDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3QpIHsKICAgICAgICAgICAgICAgICAgbGV0IGRlc2MgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5VdHRlcmFuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIFRleHQ6IHJlc3BvbnNlLmRhdGEuVGFza3NMaXN0W2ldLlV0dGVyYW5jZXNbal0uVGV4dCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZGVzYy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudGFza19saXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgSW50ZW50OiByZXNwb25zZS5kYXRhLlRhc2tzTGlzdFtpXS5JbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgICBUYXNrTmFtZTogcmVzcG9uc2UuZGF0YS5UYXNrc0xpc3RbaV0uVGFza05hbWUsCiAgICAgICAgICAgICAgICAgICAgICBUYXNrX0Rlc2NyaXB0aW9uOiBkZXNjLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdGFzaygpOwogICAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7CiAgICAgIHRoaXMucGFnZV9hcnJheSA9IFtdOwogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDM7IGkgPD0gcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX21zZ190b191c2VyKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5hZGRfY3VzdG9tc19lbWFpbCB8fAogICAgICAgICghdGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiAhdGhpcy5lbWFpbF90b191c2VyKQogICAgICApIHsKICAgICAgICB0aGlzLmVtYWlsX3RvX3VzZXIgPSAhdGhpcy5lbWFpbF90b191c2VyOwogICAgICB9IGVsc2UgaWYgKCF0aGlzLmFkZF9jdXN0b21zX2VtYWlsICYmIHRoaXMuZW1haWxfdG9fdXNlcikgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGF0bGVhc3Qgb25lIHR5cGUgb2YgcmVjaXBpZW50Iik7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX21zZ190b19jdXN0b21fdXNlcigpIHsKICAgICAgaWYgKAogICAgICAgIHRoaXMuZW1haWxfdG9fdXNlciB8fAogICAgICAgICghdGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiAhdGhpcy5lbWFpbF90b191c2VyKQogICAgICApIHsKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX2VtYWlsID0gIXRoaXMuYWRkX2N1c3RvbXNfZW1haWw7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hZGRfY3VzdG9tc19lbWFpbCAmJiAhdGhpcy5lbWFpbF90b191c2VyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYXRsZWFzdCBvbmUgdHlwZSBvZiByZWNpcGllbnQiKTsKICAgICAgfQogICAgfSwKICAgIHNlbmRfc21zX3RvX3VzZXIoKSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX251bWJlciB8fAogICAgICAgICghdGhpcy5hZGRfY3VzdG9tc19udW1iZXIgJiYgIXRoaXMuc21zX3RvX3VzZXIpCiAgICAgICkgewogICAgICAgIHRoaXMuc21zX3RvX3VzZXIgPSAhdGhpcy5zbXNfdG9fdXNlcjsKICAgICAgfSBlbHNlIGlmICghdGhpcy5hZGRfY3VzdG9tc19udW1iZXIgJiYgdGhpcy5zbXNfdG9fdXNlcikgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGF0bGVhc3Qgb25lIHR5cGUgb2YgcmVjaXBpZW50Iik7CiAgICAgIH0KICAgIH0sCiAgICBzZW5kX3Ntc190b19jdXN0b21fdXNlcigpIHsKICAgICAgaWYgKHRoaXMuc21zX3RvX3VzZXIgfHwgKCF0aGlzLmFkZF9jdXN0b21zX251bWJlciAmJiAhdGhpcy5zbXNfdG9fdXNlcikpIHsKICAgICAgICB0aGlzLmFkZF9jdXN0b21zX251bWJlciA9ICF0aGlzLmFkZF9jdXN0b21zX251bWJlcjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmFkZF9jdXN0b21zX251bWJlciAmJiAhdGhpcy5zbXNfdG9fdXNlcikgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGF0bGVhc3Qgb25lIHR5cGUgb2YgcmVjaXBpZW50Iik7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja2ZvcmVtYWlsdmFyaWFibGVzKCkgewogICAgICB2YXIgYXJyU3RyMSA9IHRoaXMuZW1haWxfYm9keS5zcGxpdCgie3siKTsKICAgICAgdmFyIGFyclN0cjIgPSBbXTsKICAgICAgdmFyIG5ld192YXJfbGlzdCA9IFtdOwogICAgICB2YXIgbmV3X3Zhcl9hY3Rpb24gPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcnJTdHIxLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGFyclN0cjFbaV0uaW5jbHVkZXMoIn19IikpIHsKICAgICAgICAgIGFyclN0cjIucHVzaChhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKTsKICAgICAgICAgIGlmIChuZXdfdmFyX2xpc3QuaW5kZXhPZihhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKSA9PSAtMSkgewogICAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaChhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKTsKICAgICAgICAgICAgbmV3X3Zhcl9hY3Rpb24ucHVzaCgiYWRkIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbWFpbF92YXJpYWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9saXN0LmluZGV4T2YodGhpcy5lbWFpbF92YXJpYWJsZXNbaV0udmFyaWFibGVfbmFtZSkgPiAtMSkgewogICAgICAgICAgbmV3X3Zhcl9hY3Rpb25bCiAgICAgICAgICAgIG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX25hbWUpCiAgICAgICAgICBdID0gImtlZXAiOwogICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICBuZXdfdmFyX2xpc3QuaW5kZXhPZih0aGlzLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9uYW1lKSA9PSAtMQogICAgICAgICkgewogICAgICAgICAgbmV3X3Zhcl9saXN0LnB1c2godGhpcy5lbWFpbF92YXJpYWJsZXNbaV0udmFyaWFibGVfbmFtZSk7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJyZW1vdmUiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdfdmFyX2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9hY3Rpb25baV0gPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuZW1haWxfdmFyaWFibGVzLnB1c2goewogICAgICAgICAgICB2YXJpYWJsZV9uYW1lOiBuZXdfdmFyX2xpc3RbaV0sCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChuZXdfdmFyX2FjdGlvbltpXSA9PSAicmVtb3ZlIikgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAodGhpcy5lbWFpbF92YXJpYWJsZXNbal0udmFyaWFibGVfbmFtZSA9PSBuZXdfdmFyX2xpc3RbaV0pIHsKICAgICAgICAgICAgICB0aGlzLmVtYWlsX3ZhcmlhYmxlcy5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjaGVja2ZvcnNtc3ZhcmlhYmxlcygpIHsKICAgICAgLy8gc21zX3ZhcmlibGVzCiAgICAgIHZhciBhcnJTdHIxID0gdGhpcy5zbXNfYm9keS5zcGxpdCgie3siKTsKICAgICAgdmFyIGFyclN0cjIgPSBbXTsKICAgICAgdmFyIG5ld192YXJfbGlzdCA9IFtdOwogICAgICB2YXIgbmV3X3Zhcl9hY3Rpb24gPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBhcnJTdHIxLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGFyclN0cjFbaV0uaW5jbHVkZXMoIn19IikpIHsKICAgICAgICAgIGFyclN0cjIucHVzaChhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKTsKICAgICAgICAgIGlmIChuZXdfdmFyX2xpc3QuaW5kZXhPZihhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKSA9PSAtMSkgewogICAgICAgICAgICBuZXdfdmFyX2xpc3QucHVzaChhcnJTdHIxW2ldLnNwbGl0KCJ9fSIpWzBdKTsKICAgICAgICAgICAgbmV3X3Zhcl9hY3Rpb24ucHVzaCgiYWRkIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zbXNfdmFyaWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9saXN0LmluZGV4T2YodGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfbmFtZSkgPiAtMSkgewogICAgICAgICAgbmV3X3Zhcl9hY3Rpb25bCiAgICAgICAgICAgIG5ld192YXJfbGlzdC5pbmRleE9mKHRoaXMuc21zX3ZhcmlibGVzW2ldLnZhcmlhYmxlX25hbWUpCiAgICAgICAgICBdID0gImtlZXAiOwogICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICBuZXdfdmFyX2xpc3QuaW5kZXhPZih0aGlzLnNtc192YXJpYmxlc1tpXS52YXJpYWJsZV9uYW1lKSA9PSAtMQogICAgICAgICkgewogICAgICAgICAgbmV3X3Zhcl9saXN0LnB1c2godGhpcy5zbXNfdmFyaWJsZXNbaV0udmFyaWFibGVfbmFtZSk7CiAgICAgICAgICBuZXdfdmFyX2FjdGlvbi5wdXNoKCJyZW1vdmUiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdfdmFyX2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobmV3X3Zhcl9hY3Rpb25baV0gPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuc21zX3ZhcmlibGVzLnB1c2goewogICAgICAgICAgICB2YXJpYWJsZV9uYW1lOiBuZXdfdmFyX2xpc3RbaV0sCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChuZXdfdmFyX2FjdGlvbltpXSA9PSAicmVtb3ZlIikgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLnNtc192YXJpYmxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAodGhpcy5zbXNfdmFyaWJsZXNbal0udmFyaWFibGVfbmFtZSA9PSBuZXdfdmFyX2xpc3RbaV0pIHsKICAgICAgICAgICAgICB0aGlzLnNtc192YXJpYmxlcy5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcGVucHJldmlldyhpbmRleCkgewogICAgICAkKCIjdGFza21vZGFsIikubW9kYWwoInNob3ciKTsKICAgICAgdGhpcy50YXNrX3R5cGUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlOwogICAgICAvLyB0aGlzLnByZXZpZXcgPSB0cnVlOwogICAgICB0aGlzLmlzRWRpdCA9IHRydWU7CiAgICAgIHRoaXMucHJldmlldyA9IGZhbHNlOwogICAgICB0aGlzLnNlbGVjdGVkX3Rhc2sgPSBpbmRleDsKICAgICAgdGhpcy5pbnB1dF9saXN0LnRhc2tfbmFtZSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrTmFtZTsKICAgICAgaWYgKAogICAgICAgIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGUgPT0gImRlZmF1bHQiIHx8CiAgICAgICAgIUJvb2xlYW4odGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSkKICAgICAgKSB7CiAgICAgICAgdGhpcy50YXNrX3R5cGUgPSAiRGVmYXVsdCI7CiAgICAgICAgdGhpcy5pbnB1dF9saXN0LmludGVudCA9IHRoaXMudGFza19saXN0W2luZGV4XS5JbnRlbnQ7CiAgICAgICAgdGhpcy5pbnB1dF9saXN0LnF1ZXN0aW9uID0gdGhpcy50YXNrX2xpc3RbCiAgICAgICAgICBpbmRleAogICAgICAgIF0uVGFza19EZXNjcmlwdGlvblswXS5UZXh0OwogICAgICAgIHRoaXMuaW5wdXRfbGlzdC5xdWVzdGlvbl9pZCA9IHRoaXMudGFza19saXN0WwogICAgICAgICAgaW5kZXgKICAgICAgICBdLlRhc2tfRGVzY3JpcHRpb25bMF0uUXVlc3Rpb25JZDsKICAgICAgICBmb3IgKAogICAgICAgICAgdmFyIGogPSAxOwogICAgICAgICAgaiA8IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmxlbmd0aDsKICAgICAgICAgIGorKwogICAgICAgICkgewogICAgICAgICAgdGhpcy5xdWVzdGlvbnNfbGlzdC5wdXNoKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uW2pdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfVHlwZSA9PSAiRW1haWwiKSB7CiAgICAgICAgLy8gdGhpcy5jdXN0b21fZW1haWxzID0gdGhpcy5nZXRkYXRhc29icyh0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5jdXN0b21fZW1haWxzKTsKICAgICAgICAvLyB0aGlzLmN1c3RvbV9lbWFpbHMgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5jdXN0b21fZW1haWxzOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY3VzdG9tX2VtYWlscyk7CiAgICAgICAgdGhpcy5jdXN0b21fZW1haWxzID0gW107CiAgICAgICAgZm9yICgKICAgICAgICAgIGxldCBpID0gMDsKICAgICAgICAgIGkgPCB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5jdXN0b21fZW1haWxzLmxlbmd0aDsKICAgICAgICAgIGkrKwogICAgICAgICkgewogICAgICAgICAgdGhpcy5jdXN0b21fZW1haWxzLnB1c2goCiAgICAgICAgICAgIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9lbWFpbHNbaV0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZW1haWxfdGl0bGUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zdWJqZWN0OwogICAgICAgIHRoaXMuZW1haWxfYm9keSA9IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmJvZHk7CiAgICAgICAgdGhpcy5lbWFpbF92YXJpYWJsZXMgPSBbXTsKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmVtYWlsX3ZhcmlhYmxlcykgewogICAgICAgICAgdGhpcy5lbWFpbF92YXJpYWJsZXMucHVzaCh7CiAgICAgICAgICAgIHZhcmlhYmxlX25hbWU6IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uCiAgICAgICAgICAgICAgLmVtYWlsX3ZhcmlhYmxlc1tpXS52YXJpYWJsZV9uYW1lLAogICAgICAgICAgICB2YXJpYWJsZV9kZXNjcmlwdGlvbjogdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24KICAgICAgICAgICAgICAuZW1haWxfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX1R5cGUgPT0gIlNNUyIpIHsKICAgICAgICB0aGlzLmN1c3RvbV9udW1iZXIgPSBbXTsKICAgICAgICBmb3IgKAogICAgICAgICAgbGV0IGkgPSAwOwogICAgICAgICAgaSA8IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9udW1iZXJzLmxlbmd0aDsKICAgICAgICAgIGkrKwogICAgICAgICkgewogICAgICAgICAgdGhpcy5jdXN0b21fbnVtYmVyLnB1c2goCiAgICAgICAgICAgIHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmN1c3RvbV9udW1iZXJzW2ldCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB0aGlzLnNtc19ib2R5ID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uYm9keTsKICAgICAgICB0aGlzLnNtc192YXJpYmxlcyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb24uc21zX3ZhcmlhYmxlcykgewogICAgICAgICAgdGhpcy5zbXNfdmFyaWJsZXMucHVzaCh7CiAgICAgICAgICAgIHZhcmlhYmxlX25hbWU6IHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLnNtc192YXJpYWJsZXNbCiAgICAgICAgICAgICAgaQogICAgICAgICAgICBdLnZhcmlhYmxlX25hbWUsCiAgICAgICAgICAgIHZhcmlhYmxlX2Rlc2NyaXB0aW9uOiB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbgogICAgICAgICAgICAgIC5zbXNfdmFyaWFibGVzW2ldLnZhcmlhYmxlX2Rlc2NyaXB0aW9uLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHRoaXMuaXNFZGl0ID0gdHJ1ZTsKICAgICAgLy8gdGhpcy50YXNrX3R5cGUgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19UeXBlOwogICAgICAvLyB0aGlzLnByZXZpZXcgPSB0cnVlOwogICAgICAvLyB0aGlzLnNlbGVjdGVkX3Rhc2sgPSBpbmRleDsKICAgICAgLy8gdGhpcy50YXNrX3R5cGUgPSAnRGVmYXVsdCc7CiAgICAgIC8vIHRoaXMuaW5wdXRfbGlzdC5pbnRlbnQgPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uSW50ZW50OwogICAgICAvLyB0aGlzLmlucHV0X2xpc3QudGFza19uYW1lID0gdGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tOYW1lOwogICAgICAvLyB0aGlzLmlucHV0X2xpc3QucXVlc3Rpb24gPSB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvblswXS5UZXh0OwogICAgICAvLyB0aGlzLnRhc2tfbGlzdFtpbmRleF0uVGFza19EZXNjcmlwdGlvbi5zcGxpY2UoMCwgMSk7CiAgICAgIC8vIGZvciAodmFyIGo9MTtqPHRoaXMudGFza19saXN0W2luZGV4XS5UYXNrX0Rlc2NyaXB0aW9uLmxlbmd0aDtqKyspIHsKICAgICAgLy8gICB0aGlzLnF1ZXN0aW9uc19saXN0LnB1c2godGhpcy50YXNrX2xpc3RbaW5kZXhdLlRhc2tfRGVzY3JpcHRpb25bal0pOwogICAgICAvLyB9CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudGFza19saXN0W2luZGV4XSk7CiAgICB9LAogICAgLy8gZ2V0ZGF0YXNvYnMoZGF0YSl7CiAgICAvLyAgIHZhciB4OwogICAgLy8gICBjb25zb2xlLmxvZyhkYXRhLHgpOwogICAgLy8gICB4PWRhdGE7CiAgICAvLyAgIGNvbnNvbGUubG9nKGRhdGEseCk7CiAgICAvLyAgIHJldHVybiB4OwogICAgLy8gfSwKICB9LAp9Owo="},null]}