{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/NER.vue","mtime":1645594423487},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWx9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk5lclRyYWluaW5nUGFnZSIsCiAgbWl4aW5zOiBbCiAgICBmcmVlemVfcG9ydGFsLAogICAgc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsCiAgXSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc3ViX2VudGl0aWVzOiB7CiAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgZW5kOiAwLAogICAgICAgIHZhbHVlOiAiIiwKICAgICAgICBlbnRpdHk6ICIiLAogICAgICB9LAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHRvdGFsX3BhZ2VzOiBudWxsLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgcGFnZW5vOiAiIiwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGRyb3BfZG93bl9zZWxlY3Q6ICIiLAogICAgICB3b3JkX3NlbGVjdGVkOiBmYWxzZSwKICAgICAgaGlnaGxpZ2h0ZWRfdGV4dDogIiIsCiAgICAgIHN0YXRlbWVudHM6IFtdLAogICAgICBzZWxlY3RlZF9zdGF0ZW1lbnQ6ICIiLAogICAgICBzdGF0ZW1lbnRfYXJyYXk6IFtdLAogICAgICBtYXN0ZXJfc3RhdGVtZW50c19saXN0OiBbXSwKICAgICAgY3VycmVudF9wYWdlOiAxLAogICAgICBkb25lX2VudGl0aWVzOiBbXSwKICAgICAgZW50aXRpZXNfbGlzdDogW10sCiAgICAgIGVudGl0aWVzX2xpc3Rfc3RyaW5nOiAiIiwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgY3N2X2ZpbGU6ICIiLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICB3b3JkX2luZm86IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBidWZmZXJfd29yZF9saXN0OiBbXSwKICAgICAgZGVsZXRlX25lcl90YWdzOiBbXSwKICAgICAgcm9sZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUsCiAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgbm90VHJhaW5lZFF1ZXN0aW9uczogW10sCiAgICAgIGluZm9faWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9pbmZvX2ljb24uc3ZnIiksCiAgICAgIG5ld19zdGF0ZW1lbnQ6ICIiLAogICAgICBlZGl0X3N0YXRlbWVudDogIiIsCiAgICAgIHdhbnRfc3RhdHVzOiB0cnVlLAogICAgICBuZXJfbW9kZWxfaW5wcm9ncmVzczogZmFsc2UsCiAgICAgIGN1cnJlbnRfc2VsZWN0ZWQ6IG51bGwsCiAgICAgIHNlYXJjaF9uYW1lOiAiIiwKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBkaXNhYmxlX2J0bl9leHBpcmVkOmZhbHNlCiAgICB9OwogIH0sCiAgY29tcG9uZW50czoge30sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgLy8gYXhpb3MKICAgIC8vICAgLmdldChhcGlfY2FsbHMuZ2V0X25lcl90YWcoKSwgewogICAgLy8gICAgIHBhcmFtczogewogICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAvLyAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgIC8vICAgICB9LAogICAgLy8gICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgIH0sCiAgICAvLyAgIH0pCiAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAvLyAgICAgICB0aGlzLndvcmRfaW5mbyA9IHJlc3BvbnNlLmRhdGE7CiAgICAvLyAgICAgICB0aGlzLmJ1ZmZlcl93b3JkX2xpc3QgPSByZXNwb25zZS5kYXRhOwogICAgLy8gICAgIH0KICAgIC8vICAgfSk7CiAgICAgIHRoaXMuY2hlY2tfbmVyX21vZGVsX3N0YXR1cygpOwogICAgLy8gYXhpb3MKICAgIC8vICAgLnBvc3QoCiAgICAvLyAgICAgYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAvLyAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgIC8vICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICBnZXRfdGFnZ2VkX3N0YXRlbWVudHM6IHRydWUsCiAgICAvLyAgICAgfSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICB9CiAgICAvLyAgICkKICAgIC8vICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT09IG51bGwpIHsKICAgIC8vICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTmVyIFRhZyBDb21wbGV0ZWQiKSB7CiAgICAvLyAgICAgICAgIC8vIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOwogICAgLy8gICAgICAgICB0aGlzLm5vdFRyYWluZWRRdWVzdGlvbnMgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFzc2lnbiBOZXIgVGFnIikgewogICAgLy8gICAgICAgLy8gICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgLy8gfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAvLyAgICAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAvLyB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgIC8vICAgICAgIC8vICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgIC8vICAgICAgIC8vIH0KICAgIC8vICAgICB9CiAgICAvLyAgIH0pCiAgICAvLyAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICkgewogICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICB0aGlzLmZyZWV6ZV9wb3J0YWwoKTsKICAgIH0sIDEwMDApOwogICAgdGhpcy4kcm9vdC4kb24oIk5lclRyYWluaW5nUGFnZURpc2FibGVkIiwgKGRhdGEpID0+ewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5kaXNhYmxlX2J0bl9leHBpcmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSkKICAgICQoJ1tkYXRhLXRvZ2dsZT0icG9wb3ZlciJdJykKICAgICAgLnBvcG92ZXIoewogICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgY29udGVudDogJCgiI3BvcG92ZXJfY29udGVudCIpLAogICAgICB9KQogICAgICAub24oInNob3cuYnMucG9wb3ZlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIjcG9wb3Zlcl9jb250ZW50IikuYWRkQ2xhc3MoImQtYmxvY2siKTsKICAgICAgfSkKICAgICAgLm9uKCJzaG93bi5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkge30pCiAgICAgIC5vbigiaGlkZS5icy5wb3BvdmVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgICQoIiNwb3BvdmVyX2NvbnRlbnQiKS5hZGRDbGFzcygiZC1ub25lIik7CiAgICAgIH0pOwogICAgJCgiI3BvcG92ZXJfY29udGVudCIpLmNzcygiekluZGV4IiwgOTk5OSk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgICB0aGlzLiRyb290LiRvbigic2VuZF9tb2RlbF9zdGF0dXMiLCBkYXRhID0+ewogICAgICBpZiAoZGF0YSA9PSB0cnVlKXsKICAgICAgICB0aGlzLmNoZWNrX25lcl9tb2RlbF9zdGF0dXMoKTsKICAgICAgfQogICAgfSkKICB9LAogIHdhdGNoOiB7CiAgICBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICB1cGxvYWRfbmVyX2ZpbGUoKXsKICAgICAgaWYoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCl7CiAgICAgICAgJCgiI3VwbG9hZF9jc3ZfZmlsZSIpLm1vZGFsKCdzaG93JykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgYWRkX25lcl9zdGF0ZW1uZW50KCl7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICAgICQoIiNzdGF0ZW1lbnRtb2RhbCIpLm1vZGFsKCdzaG93JykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgYWRkX25lcl90YWcoKXsKICAgICAgaWYoIXRoaXMuZGlzYWJsZV9idG5fZXhwaXJlZCl7CiAgICAgICAgJCgiI2V4YW1wbGVNb2RhbENlbnRlciIpLm1vZGFsKCdzaG93JykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9LAogICAgbG9hZF9uZXJfc3RhdGVtZW50cygpewogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAuZ2V0KGFwaV9jYWxscy5nZXRfbmVyX3RhZygpLCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICB9LAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLndvcmRfaW5mbyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIHRoaXMuYnVmZmVyX3dvcmRfbGlzdCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAucG9zdCgKICAgICAgICBhcGlfY2FsbHMubG9hZF90YWdfdXJsKCksCiAgICAgICAgewogICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGdldF9hbGxfbmVyX3N0YXRlbWVudHM6IHRydWUsCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgKQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBbGwgTmVyIFRhZ3MiKSB7CiAgICAgICAgICAgIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOwogICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgdGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5SZXNwb25zZTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFzc2lnbiBOZXIgVGFnIikgewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0gCiAgICAgICAgfWVsc2V7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGUoKXsKICAgICAgdGhpcy5uZXdfc3RhdGVtZW50ID0gIiI7CiAgICAgIHRoaXMuZWRpdF9zdGF0ZW1lbnQgPSAiIjsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkID0gbnVsbDsKICAgICAgdGhpcy5lbnRpdGllc19saXN0X3N0cmluZyA9ICIiOwogICAgfSwKICAgIGFzc2lnbl92YXJpYWJsZShpbmRleCl7CiAgICAgIHRoaXMuZWRpdF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlN0YXRlbWVudDsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkID0gdGhpcy5zdGF0ZW1lbnRzW2luZGV4XTsKICAgIH0sCiAgICBjaGVja19uZXJfbW9kZWxfc3RhdHVzKCl7CiAgICB0aGlzLm1vZGVsX3N0YXR1cyA9IHRoaXMuJHNlc3Npb24uZ2V0KCJNb2RlbFN0YXR1cyIpOwogICAgaWYgKHRoaXMubW9kZWxfc3RhdHVzID09ICJObyBGYWlsdXJlIil7CiAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICB9CiAgICBlbHNlIGlmIChCb29sZWFuKHRoaXMubW9kZWxfc3RhdHVzLm5lcl9tb2RlbCkgPT09IHRydWUpewogICAgIGlmKHRoaXMubW9kZWxfc3RhdHVzLm5lcl9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIpewogICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IHRydWU7CiAgICAgfQogICAgIGVsc2V7CiAgICAgICB0aGlzLm5lcl9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7CiAgICAgfQogICAgfQogICAgZWxzZXsKICAgICAgdGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9IGZhbHNlOyAKICAgIH0KICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KXsKICAgICAgaWYodGhpcy5uZXJfbW9kZWxfaW5wcm9ncmVzcyA9PSB0cnVlKXsKICAgICAgICAgaWYgKGluZGV4ID09ICdzdHlsZScpewogICAgICAgICAgICByZXR1cm4gImN1cnNvcjogbm90LWFsbG93ZWQiOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZihpbmRleCA9PSAndGl0bGUnKXsKICAgICAgICAgICAgICByZXR1cm4gIlRyYWluaW5nIGluIFByb2dyZXNzKFRoaXMgcHJvY2VzcyBtaWdodCB0YWtlIGFyb3VuZCA0NSBtaW5zIHRvIGZpbmlzaCkgIjsKICAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAogICAgYWRkX3N0YXRlbWVudCgpIHsKICAgICAgaWYgKHRoaXMubmV3X3N0YXRlbWVudCA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBhIFN0YXRlbWVudCBmaXJzdCIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHdhaXQgd2hpbGUgd2UgYXJlIHN1Ym1pdHRpbmcgeW91ciBkZXRhaWxzLi4uIiwKICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIH0pOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoYXBpX2NhbGxzLmFkZF9uZXJfc3RhdGVtZW50KCksIHsKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBuZXdfc3RhdGVtZW50OiB0aGlzLm5ld19zdGF0ZW1lbnQsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogIk5FUiBTdGF0ZW1lbnQgYWRkZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgJCgiI3N0YXRlbWVudG1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgICAgICAgLy8gdGhpcy5wYWdlX3JlcXVpcmUoMSk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJFcnJvciB3aGlsZSBhZGRpbmcgc3RhdGVtZW50IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJTb21ldGhpbmcgd2VudCB3cm9uZyIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZWRpdF9zdGF0ZW1lbnRzKCkgewogICAgICBpZih0aGlzLmVkaXRfc3RhdGVtZW50ID09IHRoaXMuY3VycmVudF9zZWxlY3RlZC5TdGF0ZW1lbnQpewogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIG1vZGlmeSB0aGUgc3RhdGVtZW50IGZpcnN0IiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgICAvLyBjb25zb2xlLmxvZygic3RhdGVtZW50IGluZGV4IGJlZm9yZS0tLSIsIHRoaXMuY3VycmVudF9zZWxlY3RlZCk7CiAgICAgICAgdmFyIHZhbGlkX3N0YXRlbWVudCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY3VycmVudF9zZWxlY3RlZCk7CiAgICAgICAgdmFyIGtleSA9IHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgdmFsaWRfc3RhdGVtZW50LklzVGFnQ29tcGxldGVkID0gIk5PIjsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuU3RhdGVtZW50ID0gdGhpcy5lZGl0X3N0YXRlbWVudDsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuVGFnID0gW107CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC5zZWxlY3RlZF9saXN0OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQud29yZHNfbGlzdDsKICAgICAgICBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QucHVzaCh7CiAgICAgICAgICBba2V5XTogdmFsaWRfc3RhdGVtZW50LAogICAgICAgIH0pOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy50YWdfc2VudGVuY2VzX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgdGFncyBoYXZlIGJlZW4gc3VibWl0dGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVyOiA1NTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICQoIiNlZGl0c3RhdGVtZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVfdGFncyhpbmRleCkgewogICAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAiQXJlIHlvdSBzdXJlPyIsCiAgICAgICAgdGV4dDogIllvdSB3b24ndCBiZSBhYmxlIHRvIHJldmVydCB0aGlzISIsCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgRGVsZXRlISEiLAogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZGVsZXRlX25lcl90YWdzLnB1c2godGhpcy53b3JkX2luZm9baW5kZXhdKTsKICAgICAgICAgIHRoaXMud29yZF9pbmZvLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMuZGVsZXRlX25lcl90YWdzKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHRhZ19uYW1lOiB0aGlzLmRlbGV0ZV9uZXJfdGFncywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFnIGhhcyBiZWVuIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5LiIpOwogICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlX25lcl90YWdzID0gW107CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAgIC8vIH0sIDUwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2Fpbi4iKTsKICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlX25lcl90YWdzID0gW107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2Fpbi4iKTsKICAgICAgICAgICAgICB0aGlzLmRlbGV0ZV9uZXJfdGFncyA9IFtdOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHN0YXJ0X3RhZ2dpbmcoKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBnZXRUYWc6IGZhbHNlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5lciBUYWcgSW5Db21wbGV0ZWQiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIGNvbXBsZXRlIHRoZSB0YWdzIHdoaWNoIGFyZSBhc3NpZ25lZCB0byB5b3UuIik7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBc3NpZ24gTmVyIFRhZyIpIHsKICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX25lcl9zdGF0ZW1lbnRzKCk7CiAgICAgICAgICAgIC8vIH0sIDE1MDApOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICAiVGhlcmUgaXMgbm8gZGF0YSBhdmFpbGFibGUuIFBsZWFzZSB1cGxvYWQgdGhlIGRhdGEgdG8gdGFnLiIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICAgIkR1ZSB0byBzb21lIGludGVybmFsIHNlcnZlciBlcnJvciwgd2Ugd2VyZSB1bmFibGUgdG8gcHJvY2VzcyB0aGlzIHJlcXVlc3QuIFBsZWFzZSB0cnkgbGF0ZXIuIgogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlKHBhZ2UpIHsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuc2VhcmNoX25lcl9zdGF0bWVudF9wYWdlX2NoYW5nZSgpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgZ2V0X2FsbF9uZXJfc3RhdGVtZW50czogdHJ1ZSwKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFsbCBOZXIgVGFncyIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gW107CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMudG90YWxfcGFnZXMgPSBNYXRoLmNlaWwodGhpcy5udW1iZXJfb2Zfcm93cyAvIHRoaXMucGVyX3BhZ2UpOwogICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICAgICAgdGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zID0gcmVzcG9uc2UuZGF0YS5SZXNwb25zZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFzc2lnbiBOZXIgVGFnIikgewogICAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgICB0aGlzLnBhZ2VfcmVxdWlyZSgxKTsKICAgIH0sCiAgICBzZWFyY2hfbmVyX3N0YXRtZW50KCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIil7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy5wYWdlX25vID0gMQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmxvYWRfdGFnX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgc2VhcmNoX3Rlcm06IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJBbGwgTmVyIFRhZ3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX3N0YXRlbWVudHMocmVzcG9uc2UuZGF0YS5SZXNwb25zZSk7CiAgICAgICAgICAgICAgLy8gdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQXNzaWduIE5lciBUYWciKSB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gRGF0YSBBdmFpbGFibGUiKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICBwb3NpdGlvbjoidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJObyBEYXRhIEZvdW5kIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSAxOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSAxOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gCiAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSB0eXBlIHNvbWV0aGluZyBpbiB0aGUgc2VhcmNoIGJhciIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47fQogICAgfSwKICAgIHNlYXJjaF9uZXJfc3RhdG1lbnRfcGFnZV9jaGFuZ2UoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKXsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5sb2FkX3RhZ191cmwoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgIHNlYXJjaF90ZXJtOiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQWxsIE5lciBUYWdzIikgewogICAgICAgICAgICAgIHRoaXMubG9hZF9zdGF0ZW1lbnRzKHJlc3BvbnNlLmRhdGEuUmVzcG9uc2UpOwogICAgICAgICAgICAgIC8vIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkFzc2lnbiBOZXIgVGFnIikgewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIERhdGEgQXZhaWxhYmxlIikgewogICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSAxOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSA9PSAiSW50ZXJuYWwgU2VydmVyIEVycm9yIikgewogICAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cyA9IFtdOwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSAxOwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIH0gCiAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSB0eXBlIHNvbWV0aGluZyBpbiB0aGUgc2VhcmNoIGJhciIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47fQogICAgfSwKICAgIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSAzOyBpIDw9IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX3N0YXRlbWVudHMoc3RhdGVtZW50cykgewogICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgdGhpcy5zdGF0ZW1lbnRzID0gW107CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc3RhdGVtZW50cyk7CiAgICAgIGZvciAodmFyIGkgaW4gc3RhdGVtZW50cykgewogICAgICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZW1lbnRzW2ldKVswXTsKCiAgICAgICAgaWYgKHN0YXRlbWVudHNbaV1ba2V5XS5Jc1RhZ0NvbXBsZXRlZCAhPSAiWUVTIikgewogICAgICAgICAgdmFyIGtleSA9IE9iamVjdC5rZXlzKHN0YXRlbWVudHNbaV0pWzBdOwoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdC5wdXNoKHN0YXRlbWVudHNbaV1ba2V5XSk7CgogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0WwogICAgICAgICAgICBpCiAgICAgICAgICBdLndvcmRzX2xpc3QgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CgogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLmtleSA9IGtleTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlbWVudHNbaV1ba2V5XS5Jc1RhZ0NvbXBsZXRlZCAhPSAiTk8iKSB7CiAgICAgICAgICB2YXIga2V5ID0gT2JqZWN0LmtleXMoc3RhdGVtZW50c1tpXSlbMF07CiAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3QucHVzaChzdGF0ZW1lbnRzW2ldW2tleV0pOwogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0WwogICAgICAgICAgICBpCiAgICAgICAgICBdLndvcmRzX2xpc3QgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CgogICAgICAgICAgbGV0IGRlc2MgPSBbXTsKICAgICAgICAgIHZhciB2YWx1ZXM7CiAgICAgICAgICB2YXIgaW5kZXg7CgogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdICE9ICJPIikgewogICAgICAgICAgICAgIHZhciBjaGVjayA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWcuaW5kZXhPZigKICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0KICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5pbmNsdWRlcygiQi0iKSkgewogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImN1cnJlbnQiLCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdKTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJuZXh0IiwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYSArIDFdICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgY2hlY2sgPCB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmxlbmd0aCAtIDEgJiYKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXS5pbmNsdWRlcygiSS0iKQogICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGE7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImluZGV4IiwgaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGE7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMiksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGVzYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBhOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogdmFsdWVzLAogICAgICAgICAgICAgICAgICAgIHdvcmRfdHlwZTogdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thXS5zbGljZSgyKSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLmluY2x1ZGVzKCJJLSIpKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hlY2sgPSB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnLmluZGV4T2YoCiAgICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpbmRleCA9IGE7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLlRhZ1thICsgMV0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2EgKyAxXS5pbmNsdWRlcygiSS0iKQogICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPQogICAgICAgICAgICAgICAgICAgICAgdmFsdWVzICsKICAgICAgICAgICAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0ud29yZHNfbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyArCiAgICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldLndvcmRzX2xpc3RbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIGRlc2MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICB3b3JkX3R5cGU6IHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5UYWdbYV0uc2xpY2UoMiksCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlcyA9CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzICsKICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS53b3Jkc19saXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgZGVzYy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB2YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgd29yZF90eXBlOiB0aGlzLm1hc3Rlcl9zdGF0ZW1lbnRzX2xpc3RbaV0uVGFnW2FdLnNsaWNlKDIpLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgICB2YWx1ZXMgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldWyJzZWxlY3RlZF9saXN0Il0gPSBkZXNjOwoKICAgICAgICAgIHRoaXMubWFzdGVyX3N0YXRlbWVudHNfbGlzdFtpXS5rZXkgPSBrZXk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2godGhpcy5tYXN0ZXJfc3RhdGVtZW50c19saXN0W2ldKTsKICAgICAgfQogICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgfSwKICAgIGxvYWRfcG9wb3Zlcih0YXJnZXQpIHsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsKICAgICAgJCgiLnBvcG92ZXJEaXYiKS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7CiAgICAgICQoIi5wb3BvdmVyRGl2IikuY3NzKCJsZWZ0IiwgdGFyZ2V0LmNsaWVudFgpOwogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygidG9wIiwgdGFyZ2V0LmNsaWVudFkrIHdpbmRvdy5wYWdlWU9mZnNldCk7CiAgICB9LAogICAgc2VsZWN0ZWRfdGV4dChpbmRleCkgewogICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikgewogICAgICAgIGlmICgKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpICE9ICIiICYmCiAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKS5zcGxpdCgiICIpLmpvaW4oIiIpICE9ICIiCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLmhpZ2hsaWdodGVkX3RleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKS50cmltKCk7CiAgICAgICAgICB0aGlzLndvcmRfc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlN0YXRlbWVudDsKICAgICAgICAgIHRoaXMubG9hZF9wb3BvdmVyKGV2ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5oaWdobGlnaHRlZF90ZXh0ID0gIiI7CiAgICAgICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICAgIGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpLnRleHQ7CiAgICAgIH0KICAgIH0sCiAgICB1cGRhdGVfc3RhdGVtZW50cyhlbnRpdHkpIHsKICAgICAgdmFyIHdvcmRzX2xpc3QgPSBlbnRpdHkudmFsdWUuc3BsaXQoIiAiKTsKICAgICAgdmFyIHRhZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnN0YXRlbWVudHMpIHsKICAgICAgICB2YXIgbWFzdGVyX3dvcmRzX2xpc3QgPSB0aGlzLnN0YXRlbWVudHNbaV0uU3RhdGVtZW50LnNwbGl0KCIgIik7CiAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5zZWxlY3RlZF9saXN0ID09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLnNlbGVjdGVkX2xpc3QgPSBbXTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5UYWcubGVuZ3RoID09IDApIHsKICAgICAgICAgIGZvciAodmFyIGogaW4gbWFzdGVyX3dvcmRzX2xpc3QpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLlRhZy5wdXNoKCIiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RhdGVtZW50c1tpXS5TdGF0ZW1lbnQgPT0gdGhpcy5zZWxlY3RlZF9zdGF0ZW1lbnQpIHsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50c1tpXS5Jc1RhZ0NvbXBsZXRlZCA9ICJOTyI7CiAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uc2VsZWN0ZWRfbGlzdC5wdXNoKHsKICAgICAgICAgICAgdGV4dDogZW50aXR5LnZhbHVlLAogICAgICAgICAgICB3b3JkX3R5cGU6IGVudGl0eS5lbnRpdHksCiAgICAgICAgICB9KTsKICAgICAgICAgIGZvciAodmFyIGogaW4gbWFzdGVyX3dvcmRzX2xpc3QpIHsKICAgICAgICAgICAgaWYgKHdvcmRzX2xpc3QuaW5jbHVkZXMobWFzdGVyX3dvcmRzX2xpc3Rbal0pKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gd29yZHNfbGlzdC5pbmRleE9mKG1hc3Rlcl93b3Jkc19saXN0W2pdKTsKICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZW1lbnRzW2ldLlRhZ1tqXSA9ICJCLSIgKyBlbnRpdHkuZW50aXR5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID0gIkktIiArIGVudGl0eS5lbnRpdHk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID09ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlbWVudHNbaV0uVGFnW2pdID0gIk8iOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGVudGl0eSh2YWx1ZTEsIHZhbHVlMikgewogICAgICBmb3IgKHZhciBpIGluIGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuW2ldLnN0eWxlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2hpbGRyZW5baV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiI7CiAgICAgICAgICBldmVudC50YXJnZXQuY2hpbGRyZW5bMF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChldmVudC50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID09ICJ5ZWxsb3ciKSB7CiAgICAgICAgZXZlbnQudGFyZ2V0LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIGV2ZW50LnRhcmdldC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAieWVsbG93IjsKICAgICAgICB2YXIgZmxhZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLmRvbmVfZW50aXRpZXMubGVuZ3RoICE9IDApIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kb25lX2VudGl0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRvbmVfZW50aXRpZXNbaV0udmFsdWUgPT0gdmFsdWUxKSB7CiAgICAgICAgICAgICAgZmxhZyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZsYWcgPT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMud29yZF9zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy52YWx1ZSA9IHZhbHVlMTsKICAgICAgICAgIHRoaXMuc3RhdGVtZW50X2FycmF5ID0gdmFsdWUyOwogICAgICAgICAgdmFyIGpvaW50ID0gdGhpcy5zdGF0ZW1lbnRfYXJyYXkuam9pbigpOwogICAgICAgICAgdmFyIGEgPSBqb2ludC5sYXN0SW5kZXhPZih2YWx1ZTEpOwogICAgICAgICAgdmFyIGIgPSB2YWx1ZTEubGVuZ3RoICsgYSAtIDI7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy5zdGFydCA9IGE7CiAgICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy5lbmQgPSBiOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNhdmVfc3RhdGVtZW50KGluZGV4KSB7CiAgICAgIGlmKHRoaXMuc3RhdGVtZW50c1tpbmRleF0uVGFnLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIGFkZCBzb21lIHRhZ3MgZmlyc3QiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9ZWxzZSB7CiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgIHZhciB2YWxpZF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJiZWZvcmUtLS0iLCB0aGlzLnN0YXRlbWVudHNbaW5kZXhdKTsKICAgICAgICB2YXIga2V5ID0gdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICB2YWxpZF9zdGF0ZW1lbnQuSXNUYWdDb21wbGV0ZWQgPSAiWUVTIjsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LnNlbGVjdGVkX2xpc3Q7CiAgICAgICAgZGVsZXRlIHZhbGlkX3N0YXRlbWVudC53b3Jkc19saXN0OwogICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKHsKICAgICAgICAgIFtrZXldOiB2YWxpZF9zdGF0ZW1lbnQsCiAgICAgICAgfSk7CiAgICAgICAgLy8gY29uc29sZS5sb2coInNpbmd1bGFyIGZpbmFsIixmaW5hbF9zdGF0ZW1lbnRzX2xpc3QpOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy50YWdfc2VudGVuY2VzX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbmVyX3RhZ19zdGF0ZW1lbnQ6IGZpbmFsX3N0YXRlbWVudHNfbGlzdCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiUXVlcnkgRXhlY3V0ZWQgU3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogIllvdXIgdGFncyBoYXZlIGJlZW4gc3VibWl0dGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vIHRoaXMucGFnZV9yZXF1aXJlKDEpOwogICAgICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzdWJtaXRfbmVyX21vZGVsKCkgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIHZhciBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QgPSBbXTsKICAgICAgdmFyIHZhbGlkX2xpc3QgPSB0aGlzLnN0YXRlbWVudHMuZmlsdGVyKChzdGF0ZW1lbnQpID0+IHsKICAgICAgICByZXR1cm4gc3RhdGVtZW50LklzVGFnQ29tcGxldGVkICE9ICIiOwogICAgICB9KTsKICAgICAgaWYgKHZhbGlkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICJZb3UgaGF2ZSBub3QgdGFnZ2VkIGFueSBzdGF0ZW1lbnQuIFBsZWFzZSBjb21wbGV0ZSBhbmQgc2VuZCByZXF1ZXN0IGFnYWluLiIKICAgICAgICApOwogICAgICB9IGVsc2UgaWYgKHZhbGlkX2xpc3QubGVuZ3RoIDwgNSAmJiB0aGlzLnN0YXRlbWVudHMubGVuZ3RoID4gNSkgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgdG9hc3RyLmVycm9yKAogICAgICAgICAgIllvdSBoYXZlIHRvIHRhZyBtaW5pbXVtIDUgc3RhdGVtZW50cy4gUGxlYXNlIGNvbXBsZXRlIGFuZCBzZW5kIHJlcXVlc3QgYWdhaW4uIgogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiB2YWxpZF9saXN0KSB7CiAgICAgICAgICB2YXIga2V5ID0gdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5zZWxlY3RlZF9saXN0OwogICAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0ud29yZHNfbGlzdDsKICAgICAgICAgIGZpbmFsX3N0YXRlbWVudHNfbGlzdC5wdXNoKHsKICAgICAgICAgICAgW2tleV06IHZhbGlkX2xpc3RbaV0sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2coZmluYWxfc3RhdGVtZW50c19saXN0KTsKICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KSB7CiAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTsKICAgICAgICB9CiAgICAgICAgLy8gYXhpb3MKICAgICAgICAvLyAgIC5wb3N0KAogICAgICAgIC8vICAgICBhcGlfY2FsbHMudGFnX3NlbnRlbmNlc191cmwoKSwKICAgICAgICAvLyAgICAgewogICAgICAgIC8vICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgLy8gICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAvLyAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIC8vICAgICAgIG5lcl90YWdfc3RhdGVtZW50OiBmaW5hbF9zdGF0ZW1lbnRzX2xpc3QsCiAgICAgICAgLy8gICAgIH0sCiAgICAgICAgLy8gICAgIHsKICAgICAgICAvLyAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgLy8gICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAvLyAgICAgICB9LAogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICApCiAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuc3VjY2VzcygiQWxsIHlvdXIgdGFncyBoYXZlIGJlZW4gc3VibWl0dGVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAvLyAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyAgICAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgIC8vICAgICAgIH0sIDIwMDApOwogICAgICAgIC8vICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpIHsKICAgICAgICAvLyAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICAvLyAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgICAvLyAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7CiAgICAgICAgLy8gICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICB9KQogICAgICAgIC8vICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAvLyAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAvLyAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAvLyAgIH0pOwogICAgICB9CiAgICB9LAogICAgcmVtb3ZlX3RhZyhpbmRleCkgewogICAgICBpZih0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlRhZy5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlN0YXRlbWVudCBoYXZlIG5vIHRhZ3MiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiSWYgeW91IHVudGFnIHRoZSBzdGF0ZW1lbnQsIHlvdSB3aWxsIGhhdmUgdG8gdGFnIGl0IGFnYWluISIsCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgRGVsZXRlISEiLAogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgIGlmIChyZXN1bHQuZGlzbWlzcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLklzVGFnQ29tcGxldGVkID0gIk5PIjsKICAgICAgICB0aGlzLnN0YXRlbWVudHNbaW5kZXhdLlRhZyA9IFtdOwogICAgICAgIHRoaXMuc3RhdGVtZW50c1tpbmRleF0uc2VsZWN0ZWRfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuJHNldCh0aGlzLnN0YXRlbWVudHMsIGluZGV4LCB0aGlzLnN0YXRlbWVudHNbaW5kZXhdKTsKCiAgICAgICAgdmFyIGZpbmFsX3N0YXRlbWVudHNfbGlzdCA9IFtdOwogICAgICAgIHZhciB2YWxpZF9zdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOwogICAgICAgIHZhciBrZXkgPSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQua2V5OwogICAgICAgIGRlbGV0ZSB2YWxpZF9zdGF0ZW1lbnQuc2VsZWN0ZWRfbGlzdDsKICAgICAgICBkZWxldGUgdmFsaWRfc3RhdGVtZW50LndvcmRzX2xpc3Q7CiAgICAgICAgZmluYWxfc3RhdGVtZW50c19saXN0LnB1c2goewogICAgICAgICAgW2tleV06IHZhbGlkX3N0YXRlbWVudCwKICAgICAgICB9KTsKICAgICAgICAvLyBjb25zb2xlLmxvZygic2luZ3VsYXIgZmluYWwiLGZpbmFsX3N0YXRlbWVudHNfbGlzdCk7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLnRhZ19zZW50ZW5jZXNfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBuZXJfdGFnX3N0YXRlbWVudDogZmluYWxfc3RhdGVtZW50c19saXN0LAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciB0YWdzIGhhdmUgYmVlbiByZW1vdmVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAvLyB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVudGl0eV9zZWxlY3RlZCh3b3JkKSB7CiAgICAgIGlmICh0aGlzLmhpZ2hsaWdodGVkX3RleHQgIT0gIiIpIHsKICAgICAgICB0aGlzLnN1Yl9lbnRpdGllcy52YWx1ZSA9IHRoaXMuaGlnaGxpZ2h0ZWRfdGV4dDsKICAgICAgfQogICAgICB2YXIgcG9wb3Zlcl9pZCA9CiAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmlkOwogICAgICAvLyB0aGlzLndvcmRfc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgdGhpcy5zdWJfZW50aXRpZXMuZW50aXR5ID0gdGhpcy5kcm9wX2Rvd25fc2VsZWN0OwogICAgICB0aGlzLmRvbmVfZW50aXRpZXMucHVzaCh0aGlzLnN1Yl9lbnRpdGllcyk7CiAgICAgICQoIiMiICsgcG9wb3Zlcl9pZCkucG9wb3ZlcigiaGlkZSIpOwogICAgICAkKCIucG9wb3ZlckRpdiIpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgIHRoaXMuZHJvcF9kb3duX3NlbGVjdCA9ICIiOwogICAgICB0aGlzLmhpZ2hsaWdodGVkX3RleHQgPSAiIjsKICAgICAgdGhpcy51cGRhdGVfc3RhdGVtZW50cyh0aGlzLnN1Yl9lbnRpdGllcyk7CiAgICAgIHRoaXMuc3ViX2VudGl0aWVzID0ge307CiAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkpIHsKICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKTsKICAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7CiAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0KGUpIHsKICAgICAgbGV0IGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CiAgICAgIGlmIChmaWxlc1swXS5zaXplIDwgMTAwMDAwMCkgewogICAgICAgIGlmICgKICAgICAgICAgIGZpbGVzWzBdLm5hbWUuaW5jbHVkZXMoImNzdiIpIHx8CiAgICAgICAgICBmaWxlc1swXS5uYW1lLmluY2x1ZGVzKCJ0eHQiKSB8fAogICAgICAgICAgZmlsZXNbMF0ubmFtZS5pbmNsdWRlcygieGxzIikgfHwKICAgICAgICAgIGZpbGVzWzBdLnR5cGUuaW5jbHVkZXMoInRleHQiKQogICAgICAgICkgewogICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICAgIHRoaXMuY3JlYXRlQ1NWKGZpbGVzWzBdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJVcGxvYWQgb25seSAuY3N2IGZpbGUgd2l0aCBzaXplIGxlc3MgdGhhbiAxTUIiKTsKICAgICAgfQogICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgfSwKICAgIGNyZWF0ZUNTVihmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHsKICAgICAgICB0aGlzLmNzdl9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQiKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgc2VuZF9jc3YoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICgkKCIjaW5wdXRHcm91cEZpbGUwMSIpLnZhbCgpID09ICcnKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAiVGhlIGlucHV0IGZpZWxkIGlzIGVtcHR5IiwKICAgICAgICAgIHRleHQ6ICJQbGVhc2UgVXBsb2FkIGEgQ1NWIGZpbGUiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy51cGxvYWRfbmVyX2ZpbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICBmaWxlX2RhdGE6IHRoaXMuY3N2X2ZpbGUsCiAgICAgICAgICAgICAgZmlsZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgZGVidWdnZXIKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5Nc2cpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkVycm9yIHdoaWxlIHVwbG9hZGluZyIpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkVycm9yIHdoaWxlIHVwbG9hZGluZyIpOwogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICIiOwogICAgICAgICAgICAgIHRoaXMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJOZXIgVGFnIEluQ29tcGxldGVkIikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgICAgICJUaGVyZSBhcmUgY2VydGFpbiB0YWdzIHdoaWNoIGhhdmUgYmVlbiBhc3NpZ25lZC4gUGxlYXNlIGNvbXBsZXRlIHRoZW0iCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIkludmFsaWQgSGVhZGVyIikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW52YWxpZCBIZWFkZXIiKTsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIlVua25vd24gVGFncyBmb3VuZCwgcGxlYXNlIGNoZWNrIHRoZSBjc3YgZmlsZS4iKSB7CiAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJVbmtub3duIFRhZ3MgZm91bmQhIFN0YXRlbWVudHMgaGFzIGJlZW4gdXBsb2FkZWQsIFBsZWFzZSB0YWcgdGhlIHN0YXRlbWVudHMgbWFudWFsbHkuIikKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6ICJVbmtub3duIFRhZ3MgZm91bmQhIFN0YXRlbWVudHMgaGFzIGJlZW4gdXBsb2FkZWQsIFBsZWFzZSB0YWcgdGhlIHN0YXRlbWVudHMgbWFudWFsbHkuIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9uZXJfc3RhdGVtZW50cygpOwogICAgICAgICAgICAgIC8vIH0sIDI1MDApOyAKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIkluY29ycmVjdCBmaWxlIGZvcm1hdCIpIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkluY29ycmVjdCBmaWxlIGZvcm1hdCIpOwogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICIiOwogICAgICAgICAgICAgIHRoaXMuY3N2X2ZpbGUgPSAiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gIkZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkIikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiRmlsZSB0eXBlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiIjsKICAgICAgICAgICAgICB0aGlzLmNzdl9maWxlID0gIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gImZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5IikgewogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJmaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgIC8vICAgdGhpcy5maWxlX2xhYmVsID0gIiI7CiAgICAgICAgICAgIC8vICAgdGhpcy5jc3ZfZmlsZSA9ICIiOwogICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgLy8gICAgICJEdWUgdG8gc29tZSBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IsIHdlIHdlcmUgdW5hYmxlIHRvIHByb2Nlc3MgdGhpcyByZXF1ZXN0LiBQbGVhc2UgdHJ5IGxhdGVyLiIKICAgICAgICAgICAgLy8gICApOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICQoIiN1cGxvYWRfY3N2X2ZpbGUiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0sCiAgICBjb21tYV90b19saXN0KCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBpZiAodGhpcy5lbnRpdGllc19saXN0X3N0cmluZyA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBlbnRlciBORVIgVGFnIGZpcnN0IiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuZW50aXRpZXNfbGlzdCA9IHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcuc3BsaXQoIiwiKTsKICAgICAgaWYgKHRoaXMuZW50aXRpZXNfbGlzdF9zdHJpbmcgIT0gIiIpIHsKICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYWRkX25lcl90YWcoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRhZ2xpc3Q6IHRoaXMuZW50aXRpZXNfbGlzdCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTmVyIFRhZyBBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgTkVSIHRhZyBhZGRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmVtcHR5X3ZhcmlhYmxlKCk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiU29tZSBFcnJvciBPY2N1cnJlZC4gUGxlYXNlIFRyeSBBZ2FpbiIpOwogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh0aGlzLmRlbGV0ZV9uZXJfdGFncy5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gYXhpb3MKICAgICAgICAvLyAgIC5wb3N0KGFwaV9jYWxscy5kZWxldGVfbmVyX3RhZ3MoKSwgewogICAgICAgIC8vICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAvLyAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAvLyAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAvLyAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgLy8gICAgIHRhZ19uYW1lOiB0aGlzLmRlbGV0ZV9uZXJfdGFncywKICAgICAgICAvLyAgIH0pCiAgICAgICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgLy8gICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgdGFnIGhhcyBiZWVuIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5LiIpOwogICAgICAgIC8vICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vICAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgLy8gICAgICAgfSwgMjUwMCk7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9uZXIoaW5kZXgpIHsKICAgICAgLy8gY29uc29sZS5sb2coInN0YXRlbWVudHMgbGVuZ3RoIix0aGlzLnN0YXRlbWVudHMubGVuZ3RoKTsKICAgICAgdmFyIGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdCA9IFtdOwogICAgICB2YXIgdmFsaWRfbGlzdCA9IHRoaXMuc3RhdGVtZW50cy5maWx0ZXIoKHN0YXRlbWVudCkgPT4gewogICAgICAgIHJldHVybiBzdGF0ZW1lbnQuU3RhdGVtZW50ID09IHRoaXMuc3RhdGVtZW50c1tpbmRleF0uU3RhdGVtZW50OwogICAgICB9KTsKICAgICAgLy8gY29uc29sZS5sb2codmFsaWRfbGlzdCk7CiAgICAgIGZvciAodmFyIGkgaW4gdmFsaWRfbGlzdCkgewogICAgICAgIHZhciBrZXkgPSB2YWxpZF9saXN0W2ldLmtleTsKICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS5rZXk7CiAgICAgICAgZGVsZXRlIHZhbGlkX2xpc3RbaV0uc2VsZWN0ZWRfbGlzdDsKICAgICAgICBkZWxldGUgdmFsaWRfbGlzdFtpXS53b3Jkc19saXN0OwogICAgICAgIGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5wdXNoKHsKICAgICAgICAgIFtrZXldOiB2YWxpZF9saXN0W2ldLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIC8vIGNvbnNvbGUubG9nKGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdCk7CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBEZWxldGUhISIsCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5kZWxldGVfbmVyKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIG5lcl90YWdfc3RhdG1lbnQ6IGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICAvLyB0b2FzdHIuc3VjY2VzcygiWW91ciBORVIgdGFnIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBORVIgdGFnIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDU1MDAsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYoKHRoaXMuc3RhdGVtZW50cy5sZW5ndGggPT09IDEgJiYgCiAgICAgICAgICAgICAgICAgIGRlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5sZW5ndGggPT09IDEpICYmCiAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA+IDEpewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHRoaXMucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyX2ZpZWxkcygpOwogICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAgIC8vIH0sIDE1MDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzZWxlY3RlZF9zdGF0ZW1lbnRzKGluZGV4KSB7CiAgICAgIGlmIChpbmRleCA9PSAiYWxsIikgewogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdmFyIHJvbGVfbGVuZ3RoID0gdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvbGVfbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy5zdGF0ZW1lbnRzW2ldKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIGlmICghdGhpcy5jaGVja2VkX2xpc3QuaW5jbHVkZXMoaW5kZXgpKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy5zdGF0ZW1lbnRzW2luZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcigocm9sZSk9PiB7CiAgICAgICAgICAgIHJldHVybiByb2xlICE9PSB0aGlzLnN0YXRlbWVudHNbaW5kZXhdOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZGVsZXRlX25lcl9tdWx0aXBsZSgpIHsKICAgICAgdmFyIG51bSA9IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsKICAgICAgdmFyIG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdCA9IFtdOwogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09IDApIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJObyBzdGF0ZW1lbnQgc2VsZWN0ZWQhIiwKICAgICAgICAgIHRleHQ6ICIiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKSB7CiAgICAgICAgICB2YXIgdmFsaWRfbGlzdCA9IHRoaXMuc3RhdGVtZW50cy5maWx0ZXIoKHN0YXRlbWVudCkgPT4gewogICAgICAgICAgICByZXR1cm4gc3RhdGVtZW50LlN0YXRlbWVudCA9PSB0aGlzLmNoZWNrZWRfbGlzdFtpXS5TdGF0ZW1lbnQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBrZXkgPSB2YWxpZF9saXN0WzBdLmtleTsKICAgICAgICAgIGRlbGV0ZSB2YWxpZF9saXN0WzBdLmtleTsKICAgICAgICAgIG11bHRpcGxlX2RlbGV0ZV9zdGF0ZW1lbnRfbGlzdC5wdXNoKHsgW2tleV06IHZhbGlkX2xpc3QgfSk7CiAgICAgICAgfQogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIkFyZSB5b3Ugc3VyZT8iLAogICAgICAgICAgdGV4dDogIllvdSB3b24ndCBiZSBhYmxlIHRvIHJldmVydCB0aGlzISIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICJZZXMsIERlbGV0ZSEhIiwKICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLmRlbGV0ZV9uZXIoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgICAgICAgICAgICAgIC5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICBuZXJfdGFnX3N0YXRtZW50OiBtdWx0aXBsZV9kZWxldGVfc3RhdGVtZW50X2xpc3QsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5zdWNjZXNzKCJZb3VyIE5FUiB0YWcgZGVsZXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogIllvdXIgTkVSIHRhZyBkZWxldGVkIHN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiA1NTAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaWYobXVsdGlwbGVfZGVsZXRlX3N0YXRlbWVudF9saXN0Lmxlbmd0aCA9PT0gdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aCAmJiAKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPjEpewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyX2ZpZWxkcygpOwogICAgICAgICAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfbmVyX3N0YXRlbWVudHMoKTsKICAgICAgICAgICAgICAgICAgLy8gfSwgMTUwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyX2ZpZWxkcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB0cmFpbl9uZXJfbW9kZWwoKSB7CiAgICAgIGlmKCF0aGlzLmRpc2FibGVfYnRuX2V4cGlyZWQpewogICAgICBpZiAodGhpcy5ub3RUcmFpbmVkUXVlc3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmUsIHdhbnQgdG8gc2V0dXAgVHJhaW5pbmc/ICIsCiAgICAgICAgICB0ZXh0OiAiVHJhaW5pbmcgbWF5IHRha2Ugc2V2ZXJhbCBtaW51dGVzIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogIlllcywgVHJhaW4gRW50aXR5IG1vZGVsIiwKICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICJHbyBCYWNrIiwKICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgLy8gaWYgKHRoaXMuc3RhdGVtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vIGF4aW9zCiAgICAgICAgICAgIC8vICAgLnBvc3QoYXBpX2NhbGxzLm5vdGlmeV9zdXBlcmFkbWluX3VybCgpLCB7CiAgICAgICAgICAgIC8vICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgLy8gICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIC8vICAgICBub3RpZnlfdHlwZTogIk5lck1vZGVsIiwKICAgICAgICAgICAgLy8gICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIC8vICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgLy8gICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIC8vICAgICBzdWJqZWN0OiAiTm90aWZpY2F0aW9uIHRvIHRyYWluIHRoZSBuZXIgbW9kZWwiLAogICAgICAgICAgICAvLyAgICAgYm9keToKICAgICAgICAgICAgLy8gICAgICAgdGhpcy5jb21wYW55bmFtZSArCiAgICAgICAgICAgIC8vICAgICAgICJoYXMgcmVxdWVzdGVkIHRvIHRyYWluIHRoZSBuZXIgbW9kZWwgb2YgZW50aXRpZXMuIiwKICAgICAgICAgICAgLy8gICB9KQogICAgICAgICAgICAvLyAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAvLyAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5Nc2cpOwogICAgICAgICAgICAvLyAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJBIG1haWwgaGFzIGJlZW4gc2VudCB0byB5b3VyIGVtYWlsIikgewogICAgICAgICAgICAvLyAgICAgICB0b2FzdHIuc3VjY2VzcygKICAgICAgICAgICAgLy8gICAgICAgICAiWW91ciBOZXIgIG1vZGVsIGlzIHN1Y2Nlc3NmdWxseSBzY2hlZHVsZWQgZm9yIGZ1cnRoZXIgdHJhaW5pbmcuIgogICAgICAgICAgICAvLyAgICAgICApOwogICAgICAgICAgICAvLyAgICAgICB0aGlzLm5ld19xdWVzdGlvbnMgPSAwOwogICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy50cmFpbl9uZXJfbW9kZWxzKCksIHsKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBjb21wYW55X2RldGFpbHM6IHsKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikKICAgICAgICAgICAgICAgICAgICAuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAvLyBlcG9jaHM6IDEwMCwKICAgICAgICAgICAgICAgIC8vIGJhdGNoX3NpemU6IDY0CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMud2FudF9zdGF0dXMgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgid2FudF9tb2RlbF9zdGF0dXMiLHRoaXMud2FudF9zdGF0dXMpOwogICAgICAgICAgICAgICAgdGhpcy5jaGVja19uZXJfbW9kZWxfc3RhdHVzKCk7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0dfQ09ERSA9PT0gNDA0NikgewogICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLk1TRyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHX0NPREUgPT09IDEwMzQpIHsKICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEuTVNHKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gfSBlbHNlIHsKICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlRoZXJlIGFyZSBubyB0YWdzIHRvIHRyYWluLiBQbGVhc2UgYWRkIHNvbWUgdGFncyBhbmQiKTsKICAgICAgICAgICAgLy8gfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICJUaGVyZSBhcmUgbm8gdGFncyB0byB0cmFpbi4gUGxlYXNlIGFkZCBzb21lIHRhZ3MgYW5kIFRyeSBBZ2Fpbi4iCiAgICAgICAgKTsKICAgICAgfX1lbHNlewogICAgICAgIHRoaXMuc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsKCk7CiAgICAgIH0KICAgIH0sCiAgICBjbGVhcl9maWVsZHMoKSB7CiAgICAgIHRoaXMud29yZF9pbmZvID0gdGhpcy5idWZmZXJfd29yZF9saXN0OwogICAgICB0aGlzLmVudGl0aWVzX2xpc3Rfc3RyaW5nID0gIiI7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlKCkgewogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKTsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuZmlsZV9kb3dubG9hZCgpLAogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgc2FtcGxlX2ZpbGU6ICJuZXIiLAogICAgICAgIH0sCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgfSwKICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAiTm90IGFibGUgdG8gZG93bmxvYWQgZmlsZSIpIHsKICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKQogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCB0aGlzLmNvbXBhbnlfbmFtZSArICJOZXJGaWxlLmNzdiIpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQuIFBsZWFzZSBUcnkgQWdhaW4iLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogIH0sCn07Cg=="},null]}