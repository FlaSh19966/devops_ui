{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Intents.vue","mtime":1663910265454},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgVGVtcGxhdGUgZnJvbSAiLi4vVGVtcGxhdGUudnVlIjsKaW1wb3J0IHsgVnVlRWRpdG9yIH0gZnJvbSAidnVlMi1lZGl0b3IiOwppbXBvcnQgeyBmcmVlemVfcG9ydGFsLHNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCAsIGNsb3NlX21vZGFsIH0gZnJvbSAiQC9wb3J0YWwvbWl4aW5zIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgVGVtcGxhdGUsIFZ1ZUVkaXRvciB9LAogIG5hbWU6ICJpbnRlbnRzX2NvbXBvbmVudCIsCiAgbWl4aW5zOiBbZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgLCBjbG9zZV9tb2RhbF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBlbmNpbF9zdmc6CiAgICAgICAgJyA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE1LjU0NiIgaGVpZ2h0PSIxNS40NjEiIHZpZXdCb3g9IjAgMCAxNS41NDYgMTUuNDYxIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojOWU5ZTllO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzQ3Ljg4OCAtMzU2Ljc2OSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNzU5LjQxNiwzNTYuNzY5YTIuMzU4LDIuMzU4LDAsMCwxLDEuNzc3LjY2MmMuNTM0LjUxMywxLjA3MiwxLjAyNSwxLjU2NywxLjU3NWEyLjMsMi4zLDAsMCwxLS4wNzEsMy4zMjVjLTIuNzM2LDIuNzYtNS40OTQsNS41LTguMjM4LDguMjUxYTEuMzgxLDEuMzgxLDAsMCwxLS43NTguMjg4Yy0uNzE5LjE3NC0xLjQyOS4zNzktMi4xNDQuNTcyLS45MzIuMjUxLTEuODYyLjUtMi43OTUuNzUxLS42LjE1OC0uOTg5LS4yMTMtLjgzMi0uODA3cS42ODktMi41OTUsMS40MDYtNS4xODJhMS4xNjQsMS4xNjQsMCwwLDEsLjI4OS0uNDg3cTQuMDkxLTQuMTA3LDguMi04LjJBMi4yNjUsMi4yNjUsMCwwLDEsNzU5LjQxNiwzNTYuNzY5Wm0tMS45ODksMi45NTYtNi41NCw2LjUzOCwzLjAyNSwzLjAyNCw2LjUzOC02LjUzN1ptNC4wMjMsMi4xNjVjLjExOC0uMTM1LjIyNS0uMjY5LjM0My0uMzkyYTEuMTM0LDEuMTM0LDAsMCwwLDAtMS43MzRjLS40Ni0uNDY2LS45MjYtLjkyNS0xLjM4OC0xLjM5YTEuMTY2LDEuMTY2LDAsMCwwLS44NjEtLjM2OGMtLjU3OCwwLS44ODEuNC0xLjIxNC43NlptLTEyLjA4NCw4Ljg2MywzLjItLjg2My0yLjMzNy0yLjMzMVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDApIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik04MTMuOTQyLDQyMi42bC0uNzg5LS44LDMuODIxLTMuODE5Ljc4NC44WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU5LjY0OCAtNTUuOTQ3KSIvPjwvZz48L3N2Zz4nLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBuZXdfaW50ZW50X2Rlc2NyaXB0aW9uOiAiIiwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzOiBmYWxzZSwKICAgICAgaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQ6IGZhbHNlLAogICAgICBwYWdlX25vOiAxLAogICAgICBwZXJfcGFnZTogMTUsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIGNoZWNrZWRfbGlzdDogW10sCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwKICAgICAgbmV3X2ludGVudHM6ICIiLAogICAgICBhZGRfcXVlc3Rpb25zX2xpc3Q6IFsiIl0sCiAgICAgIG9sZF9pbnRlbnRfbmFtZTogIiIsCiAgICAgIG9sZF9xdWVzdGlvbl9saXN0OiBbXSwKICAgICAgaW50ZW50bGlzdDogW10sCiAgICAgIGNvbXBhbnluYW1lOiAiIiwKICAgICAgY29tcGFueWlkOiAiIiwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBpc0VkaXRJbnRlbnQ6IGZhbHNlLAogICAgICBzZWxlY3RlZF9pbnRlbnRfZGVzY3JpcHRpb246ICIiLAogICAgICBpc19zZWFyY2hfYWN0aXZlOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9uczogWyIiXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQ6ICIiLAogICAgICBjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleDogMCwKICAgICAgaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzczogZmFsc2UsCiAgICAgIHNwaW5uZXJPbkZpbGVEb3dubG9hZDogZmFsc2UsCiAgICAgIGZpbGVfbGFiZWxfY3N2OiAiQ2hvb3NlIGZpbGUiLAogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgIHRoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgfSwKICBtb3VudGVkKCkgewogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICB0aGlzLiRyb290LiRvbigiaW50ZW50c19jb21wb25lbnREaXNhYmxlZCIsIChkYXRhKSA9PiB7CiAgICAgIGlmKGRhdGE9PT10cnVlKXsKICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uX2V4cGlyZWRfc3dhbCgpOwogICAgICB9CiAgICB9KTsKICAgIHZhciB2bSA9IHRoaXM7CiAgICAkKCIjc2VsZWN0YWxsIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgewogICAgICAgIC8vICQoJ2RpdjppbnB1dCcpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgfQogICAgfSk7CiAgICAkKCIjaW50ZW50bW9kZWwiKS5vbigiaGlkZGVuLmJzLm1vZGFsIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgIH0pOwogICAgJCgnYVtkYXRhLXRhcmdldD0iI2ludGVudG1vZGVsIl0nKS5vbigiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh2bS5pc0VkaXRJbnRlbnQgPT0gdHJ1ZSkgewogICAgICAgIHZtLnZlcmlmeV9jaGFuZ2VzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAkKCIjaW50ZW50bW9kZWwiKS5tb2RhbCgic2hvdyIpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJHJvb3QuJG9uKCJzZW5kX21vZGVsX3N0YXR1cyIsIGRhdGEgPT57CiAgICAgIGlmIChkYXRhID09IHRydWUpewogICAgICAgIHRoaXMuY2hlY2tfaW50ZW50X2NvcmVfbW9kZWxfc3RhdHVzKCk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgd2F0Y2g6IHsKICAgIHNlYXJjaF9uYW1lKCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSA9PT0gIiIpIHsKICAgICAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IGZhbHNlOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoX25hbWUgIT09ICIiKSB7CiAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBuZXdfaW50ZW50cyh2YWwpIHsKICAgICAgdGhpcy5uZXdfaW50ZW50cyA9IHZhbC5yZXBsYWNlKC9bXmEtekEtWjAtOV8gXS9nLCAiIik7CiAgICB9LAogICAgY3VycmVudF9zZWxlY3RlZF9pbnRlbnQodmFsKSB7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSB2YWwucmVwbGFjZSgvW15hLXpBLVowLTlfIF0vZywgIiIpOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIHZlcmlmeV9jaGFuZ2VzKCkgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9zd2FsX2FsZXJ0X21zZzEnKSwKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3N3YWxfY2hhbmdlc19pbl9vYmplY3RpdmVfbXNnJyksCiAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9zd2FsX3NhdmVfYnRuJyksCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogdGhpcy50bHQoJ2ludGVudF9zd2FsX2NhbmNlbF9idG4nKSwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgdGhpcy5lZGl0X2ludGVudCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dfaW50ZW50cyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICBpZiAodGhpcy5pc0VkaXRJbnRlbnQpIHsKICAgICAgICAgIHRoaXMudmVyaWZ5X2NoYW5nZXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zZWFyY2hfaW50ZW50KCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VhcmNoX2ludGVudChjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkgewogICAgICBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPSAiIikgewogICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgaXNfc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVNUFRZX0RBVEFfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3NlYXJjaF9ub19yZXN1bHRfZm91bmRfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy5pbnRlbnRsaXN0ID0gW107CiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gMTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLlRPS0VOX0lOVkFMSURfMDAwMV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2UKICAgICAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5SZXNwb25zZUxpc3Q7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW50ZW50bGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICB0aGlzLmludGVudGxpc3RbaV0uSW50ZW50ID0gdGhpcy5pbnRlbnRsaXN0W2ldLkludGVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfaW50ZW50cyhjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3NlYXJjaF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9zZWFyY2hfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9zZWFyY2hfZGF0YV9mb3Jfc2VhcmNoX21zZycpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X2ludGVudChpbmRleCkgewogICAgICB2YXIgcmV0dXJuX3ZhciA9ICIiOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5pbnRlbnRsaXN0W2luZGV4XS5JbnRlbnQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9oaWdobGlnaHQKICAgICAgKSB7CiAgICAgICAgcmV0dXJuX3ZhciArPSAiY3VycmVudC1hY3RpdmUtaW50ZW50IjsKICAgICAgfQogICAgICByZXR1cm4gcmV0dXJuX3ZhcjsKICAgIH0sCiAgICBjbGVhcl9zZWFyY2hfbmFtZSgpIHsKICAgICAgdGhpcy5zZWFyY2hfbmFtZSA9ICIiOwogICAgfSwKICAgIGFkZF90b19xdWVzdGlvbnNfbGlzdCh0eXBlLCBpbmRleCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LnVuc2hpZnQoIiIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAicmVtb3ZlIikgewogICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImFkZCIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy51bnNoaWZ0KCIiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gInJlbW92ZSIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNob3dfaW50ZW50cyhpbmRleCkgewogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICB2YXIgY2xvbmVfc2VsZWN0ZWRfaW50ZW50ID0gSlNPTi5wYXJzZSgKICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmludGVudGxpc3RbaW5kZXhdKQogICAgICApOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPSBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50OwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2hpZ2hsaWdodCA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5JbnRlbnQ7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucyA9IGNsb25lX3NlbGVjdGVkX2ludGVudC5RdWVzdGlvbnM7CiAgICAgIHRoaXMub2xkX3F1ZXN0aW9uX2xpc3QgPSB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnM7CiAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uID0KICAgICAgICBjbG9uZV9zZWxlY3RlZF9pbnRlbnQuSW50ZW50RGVzY3JpcHRpb247CiAgICAgIHRoaXMub2xkX2ludGVudF9uYW1lID0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudDsKICAgIH0sCiAgICAvLyBUaGlzIGlzIGZvciBjaGVja2luZyB3aGlsZSBlbnRlcmluZyBhIGludGVudCBuYW1lIGlmIGl0IGFscmVhZHkgZXhpc3RzIG9yIG5vdAogICAgZW50ZXJpbnRlbnRpZCgpIHsKICAgICAgbGV0IGludGVudF9zZWFyY2hfa2V5ID0gdGhpcy5uZXdfaW50ZW50czsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgaXNfaW50ZW50X3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgaW50ZW50X3NlYXJjaF9rZXk6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX05BTUVfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUgJiYKICAgICAgICAgICAgdGhpcy5uZXdfaW50ZW50cyA9PT0gaW50ZW50X3NlYXJjaF9rZXkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMubmV3X2ludGVudHMgIT0gIiIpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAgICIxcHggc29saWQgIzAwZjAwMCI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRVUExJQ0FURV9JTlRFTlRfNDAxMV9NT0RFTFMuTVNHX0NPREUgJiYKICAgICAgICAgICAgdGhpcy5uZXdfaW50ZW50cyA9PT0gaW50ZW50X3NlYXJjaF9rZXkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl9pbnRlbnRfaWQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAgICIxcHggc29saWQgcmVkIjsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOSB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICAvLyBUaGlzIGlzIGZvciBjaGVja2luZyB3aGlsZSBlZGl0aW5nIGFuZCBlbnRlcmluZyBhIG9iamVjdGl2ZSBuYW1lIGlmIGl0IGFscmVhZHkgZXhpc3RzIG9yIG5vdAogICAgZW50ZXJpbnRlbnRpZF9lZGl0KCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmludGVudF9xdWVzdGlvbl9yZXNwb25zZSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICBpc19pbnRlbnRfc2VhcmNoOiB0cnVlLAogICAgICAgICAgICBpbnRlbnRfc2VhcmNoX2tleTogdGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudCwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9OQU1FX05PVF9FWElTVFNfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMuaW50ZW50X2FscmVhZHlfZXhpc3RzX2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgIT0gIiIpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkX2VkaXQiKS5zdHlsZS5ib3JkZXIgPQogICAgICAgICAgICAgICAgIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICggcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRVUExJQ0FURV9JTlRFTlRfNDAxMV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgaWYgKHRoaXMub2xkX2ludGVudF9uYW1lID09IHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQpIHsKICAgICAgICAgICAgICB0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0c19lZGl0ID0gZmFsc2U7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IHRydWU7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX2ludGVudF9pZF9lZGl0Iikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAgICIxcHggc29saWQgcmVkIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBlZGl0X2ludGVudF9kZXRhaWxzKCkgewogICAgICBpZiAoIXRoaXMuaXNFZGl0SW50ZW50KSB7CiAgICAgICAgdGhpcy5pc0VkaXRJbnRlbnQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNFZGl0SW50ZW50ID0gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfSwKICAgIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X25vX29iamVjdGl2ZV9zZWxlY3RfbXNnJyksCiAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIG5ld19pbnRlbnRfbGlzdCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaGVja2VkX2xpc3QpIHsKICAgICAgICAgIG5ld19pbnRlbnRfbGlzdC5wdXNoKHRoaXMuY2hlY2tlZF9saXN0W2ldKTsKICAgICAgICB9CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X3N3YWxfYWxlcnRfbXNnMicpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9ub19yZXZlcnRfbXNnJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdpbnRlbnRfc3dhbF9kZWxldGVfYnRuJyksCiAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICAgIGFwaV9jYWxscy5pbnRlbnRfcXVlc3Rpb25fcmVzcG9uc2UoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaW50ZW50X2xpc3Q6IG5ld19pbnRlbnRfbGlzdCwKICAgICAgICAgICAgICAgICAgaXNfZGVsZXRlOiB0cnVlLAogICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UU19ERUxFVEVEX1NVQ0NFU1NfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X29iamVjdGl2ZV9pc19kZWxldGVkX21zZycpLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHt9KTsKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gdGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCAmJgogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA+IDEKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9VU0VEX0lOX0RJQUxPR19ERUxFVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9tb2RpZnlfZGlhbG9nX25vZGVfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgdGltZXI6IDgwMDAsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID09PSB0aGlzLmludGVudGxpc3QubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID4gMQogICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2Vfbm8gLSAxOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9USElOR19UT19ERUxFVEVfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X25vX29iamVjdGl2ZV9zZWxlY3RlZF9tc2cnKSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfREVMRVRFRF9UUkFJTl9NT0RFTF9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF90cmFpbmVkX29iamV0aXZlX2RlbGV0ZWRfbXNnMScpLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PT0gdGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCAmJgogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA+IDEKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVFJBSU5FRF9JTlRFTlRfQU5EX0lOVEVOVF9VU0VEX0lOX0RJQUxPR19ERUxFVEVEX1NVQ0NFU1NGVUxMWV9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF90cmFpbmVkX29iamV0aXZlX2RlbGV0ZWRfbXNnMicpLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAxMDAwMCwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT09IHRoaXMuaW50ZW50bGlzdC5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPiAxCiAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHRoaXMucGFnZV9ubyAtIDE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9kZWxldGVfaW50ZXJuYWxfc2VydmVyX21zZycpLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9pbnRlbnQoKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZWRpdF9pbnRlbnQoKSB7CiAgICAgIGlmICh0aGlzLm9sZF9pbnRlbnRfbmFtZSA9PSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50KSB7CiAgICAgICAgdmFyIGludGVudF90b19zZW5kID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaW50ZW50X3RvX3NlbmQgPSB0aGlzLm9sZF9pbnRlbnRfbmFtZTsKICAgICAgfQogICAgICBpZiAodGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCkgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnaW50ZW50X2VkaXRfb2JqZWN0aXZlX25hbWVfZXhpc3RfbXNnJykpOwogICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY3VycmVudF9zZWxlY3RlZF9pbnRlbnQgPT0gIiIpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfZWRpdF9lbnRlcl9vYmplY3RpdmVfbmFtZV9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5zZWxlY3RlZF9pbnRlbnRfcXVlc3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnNbaV0gPT09ICIiIHx8CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfaW50ZW50X3F1ZXN0aW9uc1tpXSA9PT0gbnVsbAogICAgICAgICAgKSB7CiAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigiUXVlc3Rpb25zIGNhbm5vdCBiZSBibGFuayIpOwogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2VkaXRfcXNfYmxhbmtfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGVkaXRfaW50ZW50OiB0cnVlLAogICAgICAgICAgICBvbGRfaW50ZW50X25hbWU6IGludGVudF90b19zZW5kLAogICAgICAgICAgICBvbGRfcXVlc3Rpb25fbGlzdDogdGhpcy5vbGRfcXVlc3Rpb25fbGlzdCwKICAgICAgICAgICAgaW50ZW50OiB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50LAogICAgICAgICAgICBpbnRlbnRfZGVzY3JpcHRpb246IHRoaXMuc2VsZWN0ZWRfaW50ZW50X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICBxdWVzdGlvbl9saXN0OiB0aGlzLnNlbGVjdGVkX2ludGVudF9xdWVzdGlvbnMsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX1FVRVNUSU9OX0VESVRFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9lZGl0ZWRfc3VjY2Vzc2Z1bF9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAsCiAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfZWRpdF9zd2FsX3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmICh0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICB0aGlzLnNlYXJjaF9pbnRlbnQodGhpcy5jdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVVNFRF9JTlRFTlRfUVVFU1RJT05fRURJVEVEX01PREVMUy5NU0dfQ09ERQogICAgICAgICAgKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2VkaXRfbW9kaWZ5X2RpYWxvZ19ub2RlX21zZycpLAogICAgICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDc1MDAsCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgIGlmICh0aGlzLmlzX3NlYXJjaF9hY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkX2ludGVudCh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFTlRfUVVFU1RJT05fTk9UX0VESVRFRF9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMScpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9lZGl0X2ludGVybmFsX3NlcnZlcl9tc2cyJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfZWRpdF9pbnRlcm5hbF9zZXJ2ZXJfbXNnMycpLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBzaG93X21vZGVsX3Byb2dyZXNzKGluZGV4KXsKICAgICAgaWYodGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID09IHRydWUpewogICAgICAgICBpZiAoaW5kZXggPT0gJ3N0eWxlJyl7CiAgICAgICAgICAgIHJldHVybiAiY3Vyc29yOiBub3QtYWxsb3dlZCI7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmKGluZGV4ID09ICd0aXRsZScpewogICAgICAgICAgICByZXR1cm4gIlRyYWluaW5nIGluIFByb2dyZXNzIChUaGlzIHByb2Nlc3MgbWlnaHQgdGFrZSBhcm91bmQgMzAgbWlucyB0byBmaW5pc2gpICI7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZXsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSwKICAgIGNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpewogICAgICB0aGlzLm1vZGVsX3N0YXR1cyA9IHRoaXMuJHNlc3Npb24uZ2V0KCJNb2RlbFN0YXR1cyIpOwogICAgICBpZiAodGhpcy5tb2RlbF9zdGF0dXMgPT0gIk5vIEZhaWx1cmUiKXsKICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfQogICAgICBlbHNlIGlmKEJvb2xlYW4odGhpcy5tb2RlbF9zdGF0dXMuaW50ZW50X21vZGVsKSA9PT0gdHJ1ZQogICAgICB8fCBCb29sZWFuKHRoaXMubW9kZWxfc3RhdHVzLmRpYWxvZ3VlX21vZGVsKSA9PT0gdHJ1ZSkKICAgICAgewogICAgICAgIGlmKHRoaXMubW9kZWxfc3RhdHVzLmludGVudF9tb2RlbCA9PSAiSW5Qcm9ncmVzcyIgfHwgdGhpcy5tb2RlbF9zdGF0dXMuZGlhbG9ndWVfbW9kZWwgPT0gIkluUHJvZ3Jlc3MiKXsKICAgICAgICAgIHRoaXMuaW50ZW50X2NvcmVfbW9kZWxfaW5wcm9ncmVzcyA9IHRydWU7CiAgICAgIH0KICAgICAgZWxzZXsKICAgICAgICB0aGlzLmludGVudF9jb3JlX21vZGVsX2lucHJvZ3Jlc3MgPSBmYWxzZTsKICAgICAgfQogICAgICB9CiAgICAgIGVsc2V7CiAgICAgICAgdGhpcy5pbnRlbnRfY29yZV9tb2RlbF9pbnByb2dyZXNzID0gZmFsc2U7IAogICAgICB9CiAgICB9LAogICAgdHJhaW5fbW9kZWwoKSB7CiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X3RyYWluX21vZGVsX3N3YWxfbXNnJyksCiAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF90cmFpbl90aGVfbW9kZWxfbXNnJyksCiAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCdpbnRlbnRfdHJhaW5fc3dhbF9jb25maXJtX21zZycpLAogICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy50cmFpbl9tb2RlbCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMud2FudF9zdGF0dXMgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIndhbnRfbW9kZWxfc3RhdHVzIix0aGlzLndhbnRfc3RhdHVzKTsKICAgICAgICAgICAgICB0aGlzLmNoZWNrX2ludGVudF9jb3JlX21vZGVsX3N0YXR1cygpOwogICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVOVF9BTkRfQ09SRV9NT0RFTF9CRUlOR19UUkFJTkVEX1BSRU1JVU1fTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5UUkFJTklOR19MSU1JVF9FWENFRURfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRyk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnaW50ZW50X3RyYWluX2ludGVybmFsX3NlcnZlcl9tc2cnKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdGVkX2ludGVudHMoSW50ZW50KSB7CiAgICAgIGlmIChJbnRlbnQgPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRoaXMuaW50ZW50bGlzdC5tYXAoKGl0ZW0pID0+IHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0uSW50ZW50OwogICAgICAgICAgfSk7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICQoIiNpbnRlbnRfY2hlY2tib3hfIiArIHRoaXMuY2hlY2tlZF9saXN0W2ldKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICBsZXQgdmFsX2luZGV4ID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKChpbnRlbnRzKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBpbnRlbnRzLkludGVudCA9PSBJbnRlbnQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICh2YWxfaW5kZXgubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QucHVzaChJbnRlbnQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKGludGVudHMpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGludGVudHMgIT0gSW50ZW50OwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW50ZW50X25hbWVfY2hlY2tfc3BlY2lhbF9jaGFyYWN0ZXJzKGUpIHsKICAgICAgaWYgKC9eW15hLXpBLVowLTlfIF0qJC8udGVzdChlLmtleSkpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2ludGVudChjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkgewogICAgICAvLyB0aGlzLmludGVudGxpc3QgPSBbXTsKICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gZmFsc2U7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlCiAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhOwogICAgICAgICAgICBpZiAodGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBpZiAoQm9vbGVhbihjdXJyZW50X3NlbGVjdGVkX2ludGVudF9pbmRleCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19pbnRlbnRzKGN1cnJlbnRfc2VsZWN0ZWRfaW50ZW50X2luZGV4KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpbnRlbnQ6IHRoaXMubmV3X2ludGVudHMsCiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhOwogICAgICAgICAgICAgIGlmICh0aGlzLmludGVudGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgaWYgKHRoaXMucGFnZW5vID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFnZW5vID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSB0aGlzLnBhZ2VubzsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5mb3JtX2F1dG9tYXRpb25fc2F2ZV9pbnRlbnRfZXhhbXBsZSgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogIlBsYXRpbnVtIiwKICAgICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlYXJjaF9rZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuRU1QVFlfREFUQV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdpbnRlbnRfcGFnZV9ub19yZXN1bHRfbXNnJyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICAKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEVfTU9ERUxTLk1TR19DT0RFCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuaW50ZW50bGlzdCA9IFtdOwogICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLlRPS0VOX0lOVkFMSURfMDAwMV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlCiAgICAgICAgICAgICAgICB0aGlzLmludGVudGxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEuUmVzcG9uc2VMaXN0OwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludGVudGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlbnRsaXN0W2ldLkludGVudCA9IHRoaXMuaW50ZW50bGlzdFtpXS5JbnRlbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnRlbnRsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5pc19zZWFyY2hfYWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X2ludGVudHMoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFICE9IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl9NT0RFTFMuTVNHX0NPREUgKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2c0JyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X2ludGVybmFsX3NlcnZlcl9tc2c1JyksCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX2ludGVudF91c2VyX2V4YW1wbGUoKSB7CiAgICAgIGlmICh0aGlzLmludGVudF9hbHJlYWR5X2V4aXN0cykgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9vYmplY3RpdmVfbmFtZV9leGlzdF9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiA0NTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5uZXdfaW50ZW50cyA9PSAiIikgewogICAgICAgIFN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9lbnRlcl9vYmplY3RpdmVfbmFtZV9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAzNTAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3RbaV0gPT09ICIiIHx8CiAgICAgICAgICAgIHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0W2ldID09PSBudWxsCiAgICAgICAgICApIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF90eXBlX3VzZXJfZXhhbXBsZV9tc2cnKSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDM1MDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBTd2FsKHsKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3N1Ym1pdF95b3VyX2RldGFpbHNfbXNnJyksCiAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgfSk7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3NhdmVfaW50ZW50X2V4YW1wbGUoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICAgIGludGVudDogdGhpcy5uZXdfaW50ZW50cywKICAgICAgICAgICAgaW50ZW50X2Rlc2NyaXB0aW9uOiB0aGlzLm5ld19pbnRlbnRfZGVzY3JpcHRpb24sCiAgICAgICAgICAgIHF1ZXN0aW9uX2xpc3Q6IHRoaXMuYWRkX3F1ZXN0aW9uc19saXN0LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkFEREVEX1NVQ0NFU1NGVUxMWV8wMDAyX01PREVMUy5NU0dfQ09ERSApIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9leGFtcGxlX3NhdmVkX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICB0aW1lcjogMzUwMCwKICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9zd2FsX3N1Y2Nlc3NfbXNnJyksCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQoIiNpbnRlbnRtb2RlbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgdGhpcy5sb2FkX2ludGVudCgpOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URU5UX05PVF9TQVZFRF9NT0RFTFMuTVNHX0NPREUgKSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9zYXZlX2ludGVybmFsX3NlcnZlcl9tc2cxJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnaW50ZW50X3NhdmVfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF9zYXZlX2ludGVybmFsX3NlcnZlcl9tc2czJyksCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHNldHBhZ2luYXRpb24ocGFnZV9ubykgewogICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKICAgICAgaWYgKHRoaXMudG90YWxfcGFnZXMgPD0gNykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSAzOyBpIDw9IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBlbXB0eV92YXJpYWJsZSgpIHsKICAgICAgdGhpcy5uZXdfaW50ZW50cyA9ICIiOwogICAgICB0aGlzLm5ld19pbnRlbnRfZGVzY3JpcHRpb24gPSAiIjsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgdGhpcy5pbnRlbnRfYWxyZWFkeV9leGlzdHNfZWRpdCA9IGZhbHNlOwogICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIHRoaXMubmV3X2ludGVudHMgPSAiIjsKICAgICAgdGhpcy5hZGRfcXVlc3Rpb25zX2xpc3QgPSBbIiJdOwogICAgICB0aGlzLmlzRWRpdEludGVudCA9IGZhbHNlOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfaW50ZW50X2lkIikuc3R5bGUuYm9yZGVyID0gIiI7CiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgIH0sCiAgICBmaWxlX3N1Ym1pdCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaWYgKCQoIiNpbnB1dEdyb3VwRmlsZWNzdiIpLnZhbCgpID09ICcnKSB7CiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X2lucHV0X2ZpZWxkX2VtcHR5X21zZycpLAogICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2ludGVudF91cGxvYWRfZmlsZV9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciB1c2VyX2RldGFpbHMgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICBpc19mb3JtX2ludGVudHM6IHRydWUsCiAgICAgIH07CiAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkodXNlcl9kZXRhaWxzKTsKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsKICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIH0pOwogICAgICBpZiAodGhpcy5maWxlX2xhYmVsX2NzdiA9PSAiQ2hvb3NlIGZpbGUiKSB7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZmQgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBmZC5hcHBlbmQoCiAgICAgICAgICAiZmlsZSIsCiAgICAgICAgICB0aGlzLmZpbGVfY29udGVudF9jc3YsCiAgICAgICAgICB0aGlzLmNvbXBhbnluYW1lICsgIk9iamVjdGl2ZUZpbGUuY3N2IgogICAgICAgICk7CiAgICAgICAgZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy51cGxvYWRfZmlsZV91cmwoKSwgZmQsIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkZJTEVfVVBMT0FEX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdpbnRlbnRfZmlsZV91cGxvYWRlZF9tc2cnKSwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTkNPUlJFQ1RfRklMRV9GT1JNQVRfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9pbmNvcnJlY3RfZmlsZV9mb3JtYXRfbXNnJyksCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICB0aGlzLnRsdCgnaW50ZW50X2Rvd25sb2FkX3NhbXBsZV9maWxlX21zZzEnKSwKICAgICAgICAgICAgICAgIC8vIHRpbWVyOiA0MDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlZBTElEX0ZJTEVfVFlQRV9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X2ZpbGVfdHlwZV9ub3Rfc3VwcG9ydF9tc2cnKSwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgIHRoaXMudGx0KCdpbnRlbnRfZG93bmxvYWRfc2FtcGxlX2ZpbGVfbXNnMScpLAogICAgICAgICAgICAgICAgLy8gdGltZXI6IDQwMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9lcnJvcl9vY2N1cnJlZF9tc2cxJyksCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF9jc3YgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGVjc3YiKS52YWx1ZSA9ICIiOwogICAgICAgICAgICB0aGlzLmxvYWRfaW50ZW50KCk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCd1cGxvYWRfZmlsZV9idG4nKQogICAgICB9CiAgICB9LAogICAgZG93bmxvYWRfc2FtcGxlX2ZpbGUoKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gdHJ1ZTsKICAgICAgYXhpb3MoewogICAgICAgIG1ldGhvZDogInBvc3QiLAogICAgICAgIHVybDogYXBpX2NhbGxzLmZpbGVfZG93bmxvYWQoKSwKICAgICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBzYW1wbGVfZmlsZTogIm9iamVjdGl2ZSIsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgfSwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICB9LAogICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgICAvLyBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgIC8vICAgICB0aXRsZTogdGhpcy50bHQoJ2ludGVudF9lcnJvcl9vY2N1cnJlZF9tc2cyJyksCiAgICAgICAgICAvLyAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIC8vICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAvLyB9IGVsc2UgewogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSAhPSBudWxsKXsKICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmNvbXBhbnluYW1lKQogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCB0aGlzLmNvbXBhbnluYW1lICsgIk9iamVjdGl2ZUZpbGUuY3N2Iik7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbkZpbGVEb3dubG9hZCA9IGZhbHNlOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnaW50ZW50X2Vycm9yX29jY3VycmVkX21zZzMnKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2xvc2VfbW9kYWwoJ3NhbXBsZV9jc3YnKQogICAgfSwKICAgIGZpbGVpbnB1dF9jc3YoKSB7CiAgICAgIHRoaXMuZmlsZV9sYWJlbF9jc3YgPSBldmVudC50YXJnZXQuZmlsZXNbMF0ubmFtZTsKICAgICAgdGhpcy5maWxlX2NvbnRlbnRfY3N2ID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgfSwKICAgIGRvd25sb2FkX2NzdigpIHsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5xdWVzdGlvbl9pbnRlbnRfY3N2KCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBpc19mb3JtX2ludGVudHM6IHRydWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKXsKICAgICAgICAgICAgdmFyIGEgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBhLmhyZWYgPSByZXNwb25zZS5kYXRhLmRhdGEuQ1NWX1VSTDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICAgIGEuY2xpY2soKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogIH0sCn07Cg=="},null]}