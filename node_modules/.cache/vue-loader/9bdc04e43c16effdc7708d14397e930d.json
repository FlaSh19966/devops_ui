{"remainingRequest":"/home/vimalesh/Elixir/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Elixir/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Elixir/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue","mtime":1643027096132},{"path":"/home/vimalesh/Elixir/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Elixir/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Elixir/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Elixir/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGNvdW50cmllcyBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0NvdW50cmllcyI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBBcmVhQ2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9BcmVhQ2hhcnQudnVlIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7Ci8vIGltcG9ydCB7IFN0cmlwZUNoZWNrb3V0IH0gZnJvbSAiQHZ1ZS1zdHJpcGUvdnVlLXN0cmlwZSI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IHsgdXBkYXRlX3NpZGViYXJfbWVudSwgdXBkYXRlX3Jlc3RyaWN0aW9uX2xpc3R9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJpbGxpbmciLAogIGNvbXBvbmVudHM6IHsKICAgIEFyZWFDaGFydCwKICAgIE11bHRpc2VsZWN0LAogICAgLy8gU3RyaXBlQ2hlY2tvdXQsCiAgfSwKICBtaXhpbnM6IFsKICAgIHVwZGF0ZV9zaWRlYmFyX21lbnUsCiAgICB1cGRhdGVfcmVzdHJpY3Rpb25fbGlzdAogIF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9wbGFuczogW10sCiAgICAgIHNlbGVjdF9zdWJzY3JpcHRpb25fcGxhbjogWyJTaWx2ZXIiLCAiR29sZCIsICJQbGFudGludW0iLCAiRW50ZXJwcmlzZSJdLAogICAgICBzZWxlY3RlZF9zdWJzY3JpcHRpb246ICIiLAogICAgICBzdWJzY3JpcHRpb25faWQ6ICIiLAogICAgICBwbGFuX2lkOiAiIiwKICAgICAgY3VzdG9tZXJfaWQ6ICIiLAogICAgICBwbGFuX3BlcmlvZDogWyJNb250aGx5IiwgIlllYXJseSJdLAogICAgICBzZWxlY3RlZF9wZXJpb2Q6ICIiLAogICAgICBvcmRlcl9pZDogIiIsCiAgICAgIGFtb3VudDogIiIsCiAgICAgIHBheV9zdWNjZXNzX2RhdGE6IHt9LAogICAgICBzdWJzY3JpcHRpb25fYnRuX2Rpc2FibGU6IGZhbHNlLAogICAgICBjb3VudHJ5X2xpc3Q6IGNvdW50cmllcywKICAgICAgcGF5bWVudGlkOiAiIiwKICAgICAgYmFyQ2hhcnQ6ICIiLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IFsiI2U2N2UyMiIsICIjMTZhMDg1IiwgIiMyOTgwYjkiXSwKICAgICAgbGFiZWxzOiBbCiAgICAgICAgIkV4Y2hhbmdlIG9mIE1lc3NhZ2VzIiwKICAgICAgICAiRXhlY3V0aW9uIG9mIFRhc2tzIiwKICAgICAgICAiQXVkaW8vVmlkZW8gSW50ZXJhY3Rpb24iLAogICAgICAgICJTdG9yYWdlIiwKICAgICAgXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY291bnRyeV9uYW1lOiAiIiwKICAgICAgcGF5bWVudF9jdXJyZW5jeTogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3RvcF91cDogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjogIiIsCiAgICAgIElOUjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDogWzUwLCAxMDAsIDIwMCwgNTAwXSwKICAgICAgY29tbW9uX2N1cnJlbmN5OiBbXSwKICAgICAgY3VycmVuY3lfYW1vdW50OiBudWxsLAogICAgICB0b3BfdXBfYW1vdW50OiBudWxsLAogICAgICBwaWVjaGFydF9kYXRhOiBbXSwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgY29uY3VycmVudF91c2Vyc19tb250aDogIiIsCiAgICAgIENvbmN1cnJlbnRfVXNlcnNfRGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgZGF0YTogW10sCiAgICAgIH0sCiAgICAgIG1vbnRoczogWwogICAgICAgICJKYW4iLAogICAgICAgICJGZWIiLAogICAgICAgICJNYXIiLAogICAgICAgICJBcHIiLAogICAgICAgICJNYXkiLAogICAgICAgICJKdW5lIiwKICAgICAgICAiSnVseSIsCiAgICAgICAgIkF1ZyIsCiAgICAgICAgIlNlcHQiLAogICAgICAgICJPY3QiLAogICAgICAgICJOb3YiLAogICAgICAgICJEZWMiLAogICAgICBdLAogICAgICBpbnZvaWNlX2RldGFpbHM6IFtdLAogICAgICBpbnZvaWNlX2RldGFpbHNfY29weTogW10sCiAgICAgIHRvdGFsX3llYXI6IFtdLAogICAgICB5ZWFyX3NlbGVjdGVkOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgLy9oYXJzaAogICAgICBjb21tb25fY3VycmVuY3kyOiBbXSwKICAgICAgSU5SMjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDI6IFsxMDAsIDMwMCwgNTAwXSwKICAgICAgcmV0YWlsX3Nob3BpZnlfY29tcGFueTogZmFsc2UsCiAgICAgIHJldGFpbF9zaG9waWZ5X3N1YnNjcmlwdGlvbl9wbGFuczogWwogICAgICAgIC8vIHsKICAgICAgICAvLyAgIG5hbWU6ICJGcmVlIiwKICAgICAgICAvLyAgIGlzX2NoYXJnZWFibGU6IGZhbHNlLAogICAgICAgIC8vIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIlN0YXJ0ZXIiLAogICAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICAgIG1vbnRobHlfY2hhcmdlOiAyOSwKICAgICAgICAgIGFubnVhbF9jaGFyZ2U6IHsKICAgICAgICAgICAgcGVyX21vbnRoX2VmZmVjdGl2ZTogMjQuMTcsCiAgICAgICAgICAgIGFjdHVhbF9jaGFyZ2U6IDI5MCwKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUHJlbWl1bSIsCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDk5LAogICAgICAgICAgYW5udWFsX2NoYXJnZTogewogICAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiA4Mi41LAogICAgICAgICAgICBhY3R1YWxfY2hhcmdlOiA5OTAsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIHJldGFpbF9ub25fc2hvcGlmeV9zdWJzY3JpcHRpb25fcGxhbnM6IFsKICAgICAgICAvLyB7CiAgICAgICAgLy8gICBuYW1lOiAiRnJlZSIsCiAgICAgICAgLy8gICBpc19jaGFyZ2VhYmxlOiBmYWxzZSwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJTdGFydGVyIiwKICAgICAgICAgIGlzX2NoYXJnZWFibGU6IHRydWUsCiAgICAgICAgICBtb250aGx5X2NoYXJnZTogMjksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUHJlbWl1bSIsCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDk5LAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIHJldGFpbF9wbGFuX2N1cnJlbnQ6IG51bGwsCiAgICAgIHBheW1lbnRfdHlwZXM6IFsiQW5udWFsIiwgIk1vbnRobHkiXSwKICAgICAgcmV0YWlsX3BheW1lbnRfdHlwZTogbnVsbCwKICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuczogbnVsbCwKICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzOiBudWxsLAogICAgICBzdHJpcGVfYWRkb25fcGxhbnM6IFtdLAogICAgICBzaG93X3N1YnNjcmlwdGlvbjpmYWxzZSwKICAgICAgc2VsZWN0ZWRfYWRkb25fcGxhbjogbnVsbCwKICAgICAgaGlkZV9idXR0b246J0ZyZWUnLAogICAgICBjcmVkaXRzX2JhbGFuY2U6IG51bGwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5jb3VudHJ5X2xpc3QgPSBjb3VudHJpZXM7CiAgICBpZiAoCiAgICAgICF0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikgJiYKICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iCiAgICApIHsKICAgICAgdG9hc3RyLndhcm5pbmcoIlBsZWFzZSBzZWxlY3QgYSBjb21wYW55IG5hbWUgZnJvbSB0aGUgZHJvcGRvd24iKTsKICAgIH0KICAgIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIGlmICgKICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZSA9PSAiIiAmJgogICAgICAhdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpCiAgICApIHsKICAgIH0gZWxzZSB7CiAgICAvLyAgIGF4aW9zCiAgICAvLyAgICAgLnBvc3QoCiAgICAvLyAgICAgICBhcGlfY2FsbHMucGllY2hhcnRfdXJsKCksCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgLy8gICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgICAgfSwKICAgIC8vICAgICAgIH0KICAgIC8vICAgICApCiAgICAvLyAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICB0aGlzLnBpZWNoYXJ0X2RhdGEucHVzaChyZXNwb25zZS5kYXRhLlRhc2tVc2FnZSksCiAgICAvLyAgICAgICAgIHRoaXMucGllY2hhcnRfZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuRXhjaGFuZ2VPZk1zZyksCiAgICAvLyAgICAgICAgIHRoaXMucGllY2hhcnRfZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuQ2FsbFVzYWdlKTsKICAgIC8vICAgICAgIHRoaXMucGllY2hhcnRfZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuU3RvcmFnZV9jb3N0KTsKICAgIC8vICAgICAgIGlmICgKICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5UYXNrVXNhZ2UgPiAwIHx8CiAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuRXhjaGFuZ2VPZk1zZyA+IDAgfHwKICAgIC8vICAgICAgICAgcmVzcG9uc2UuZGF0YS5DYWxsVXNhZ2UgPiAwIHx8CiAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuU3RvcmFnZV9jb3N0ID4gMAogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuYmFyQ2hhcnQub3B0aW9ucy5sZWdlbmQuZGlzcGxheSA9IHRydWU7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICB0aGlzLmJhckNoYXJ0LnVwZGF0ZSgpOwogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICBpZiAoCiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICApIHsKICAgIC8vICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KTsKICAgIC8vICAgYXhpb3MKICAgIC8vICAgICAucG9zdCgKICAgIC8vICAgICAgIGFwaV9jYWxscy5iaWxsaW5nX2NoYXJnZV91cmwoKSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAvLyAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAvLyAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAvLyAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgICB9LAogICAgLy8gICAgICAgfQogICAgLy8gICAgICkKICAgIC8vICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgIHRoaXMucGF5bWVudF9jdXJyZW5jeSA9IHJlc3BvbnNlLmRhdGEuY3VycmVuY3lfdHlwZTsKICAgIC8vICAgICAgIHRoaXMudG9nZ2xlX2NoYW5nZSh0aGlzLnBheW1lbnRfY3VycmVuY3kpOwogICAgLy8gICAgICAgdGhpcy5jb25jdXJyZW50X3VzZXJzX21vbnRoID0gcmVzcG9uc2UuZGF0YS5Nb250aDsKICAgIC8vICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgIC8vICAgICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTsKICAgIC8vICAgICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTsKICAgIC8vICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5EYXRhKSB7CiAgICAvLyAgICAgICAgIHZhciByZXNwb25zZV9kYXRlID0gaS5zcGxpdCgiLSIpOwogICAgLy8gICAgICAgICBpZiAoCiAgICAvLyAgICAgICAgICAgTnVtYmVyKHJlc3BvbnNlX2RhdGVbMF0pID4gZGF5ICYmCiAgICAvLyAgICAgICAgICAgcmVzcG9uc2VfZGF0ZVsxXSA9PSB0aGlzLm1vbnRoc1ttb250aF0KICAgIC8vICAgICAgICAgKSB7CiAgICAvLyAgICAgICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICAgICAgdGhpcy5Db25jdXJyZW50X1VzZXJzX0RhdGEubGFiZWxzLnB1c2goaSk7CiAgICAvLyAgICAgICAgICAgdGhpcy5Db25jdXJyZW50X1VzZXJzX0RhdGEuZGF0YS5wdXNoKHJlc3BvbnNlLmRhdGEuRGF0YVtpXSk7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGJ1cy4kZW1pdCgiQmlsbGluZyBjaGFydCB1cGRhdGVkIiwgIlRydWUiKTsKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgICAgIGF4aW9zCiAgICAgICAgLmdldChhcGlfY2FsbHMuYmlsbGluZ19pbnZvaWNlKCksIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnRvdGFsX3llYXIgPSByZXNwb25zZS5kYXRhLlllYXJMaXN0OwogICAgICAgICAgdGhpcy55ZWFyX3NlbGVjdGVkID0gdGhpcy50b3RhbF95ZWFyWzBdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5iaWxsaW5nX2ludm9pY2UoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBkb3dubG9hZF9maWxlOiBmYWxzZSwKICAgICAgICAgICAgeWVhcjogdGhpcy55ZWFyX3NlbGVjdGVkLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuaW52b2ljZV9kZXRhaWxzID0gcmVzcG9uc2UuZGF0YS5CdWNrZXRfbGlzdDsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pbnZvaWNlX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5pbnZvaWNlX2RldGFpbHNfY29weVtpXSA9IHRoaXMuaW52b2ljZV9kZXRhaWxzW2ldLnNsaWNlKDgpOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pbnZvaWNlX2RldGFpbHNfY29weSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgbGV0IGlzX3Nob3BpZnkgPSB0aGlzLiRzZXNzaW9uLmdldCgicmV0YWlsX3dlYl9mcmFtZXdvcmsiKTsKICAgIGlmIChCb29sZWFuKGlzX3Nob3BpZnkpICYmIGlzX3Nob3BpZnkgPT09ICJzaG9waWZ5IikgewogICAgICB0aGlzLnJldGFpbF9zaG9waWZ5X2NvbXBhbnkgPSB0cnVlOwogICAgfQogIH0sCiAgbW91bnRlZCgpIHsgCiAgICB0aGlzLmdldF9zdWJzY3JpcHRpb25fZGV0YWlscygpOyAvLyBHZXQgcGxhbnMgZnJvbSByYXpvcnBheSBkYXNoYm9hcmQKICAgIHRoaXMuZ2V0X2FkZG9uX2RldGFpbHMoKTsgLy8gR2V0IEFkZCBPbnMgZnJvbSBjZW5zZSBkYgogICAgdGhpcy5nZXRfY3VycmVudF9zdWJzY3JpcHRpb24oKTsgLy8gR2V0IGN1cnJlbnQgcGxhbiBkZXRhaWxzIGZyb20gY2Vuc2VfZGIKICAgIHRoaXMuZ2V0X2N1cnJlbnRfc3Vic2NyaXB0aW9uX2RldGFpbHMoKTsgLy8gZ2V0IHN1YnNjcmlwdGlvbiBkZXRhaWxzIGZyb20gY2Vuc2VfZGIKICAgIHRoaXMuY2hlY2tfYWRkb25zX2JhbGFuY2UoKTsKICAgIGlmICgKICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvdW50cnlfbmFtZSA9PSAiIiAmJgogICAgICAhdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpCiAgICApIHsKICAgICAgJCgiI2NvdW50cnltb2RhbCIpCiAgICAgICAgLm1vZGFsKHsKICAgICAgICAgIGJhY2tkcm9wOiAic3RhdGljIiwKICAgICAgICB9KQogICAgICAgIC5vbigiaGlkZGVuLmJzLm1vZGFsIiwgKGUpID0+IHsKICAgICAgICAgIGlmICghdGhpcy4kc2Vzc2lvbi5oYXMoImNvdW50cnlfbmFtZSIpKSB7CiAgICAgICAgICAgICQoIiNjb3VudHJ5bW9kYWwiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgiL2JvdC9kYXNoYm9hcmQiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIC8vIHZhciBDSEFSVCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsaW5lQ2hhcnQiKS5nZXRDb250ZXh0KCIyZCIpOwogICAgLy8gQ2hhcnQuZGVmYXVsdHMuc2NhbGUudGlja3MuYmVnaW5BdFplcm8gPSB0cnVlOwogICAgLy8gdGhpcy5iYXJDaGFydCA9IG5ldyBDaGFydChDSEFSVCwgewogICAgLy8gICB0eXBlOiAicGllIiwKICAgIC8vICAgZGF0YTogewogICAgLy8gICAgIGxhYmVsczogdGhpcy5sYWJlbHMsCiAgICAvLyAgICAgZGF0YXNldHM6IFsKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgbGFiZWw6ICJQb2ludHMiLAogICAgLy8gICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yLAogICAgLy8gICAgICAgICBkYXRhOiB0aGlzLnBpZWNoYXJ0X2RhdGEsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIF0sCiAgICAvLyAgIH0sCiAgICAvLyAgIG9wdGlvbnM6IHsKICAgIC8vICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgLy8gICAgIGxlZ2VuZDogewogICAgLy8gICAgICAgZGlzcGxheTogZmFsc2UsCiAgICAvLyAgICAgICBwb3NpdGlvbjogInJpZ2h0IiwKICAgIC8vICAgICAgIGxhYmVsczogewogICAgLy8gICAgICAgICBib3hXaWR0aDogNjAsCiAgICAvLyAgICAgICAgIGZvbnRGYW1pbHk6ICJGaXJhIFNhbnMsc2Fucy1zZXJpZiIsCiAgICAvLyAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgIC8vICAgICAgICAgcGFkZGluZzogMzAsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIH0sCiAgICAvLyAgICAgcGx1Z2luczogewogICAgLy8gICAgICAgZGlzcGxheTogdHJ1ZSwKICAgIC8vICAgICB9LAogICAgLy8gICB9LAogICAgLy8gfSk7CiAgfSwKICBjb21wdXRlZDogewogICAgY2hlY2tfcmV0YWlsX3BheW1lbnRfdHlwZV9kaXNhYmxlZCgpIHsKICAgICAgaWYgKAogICAgICAgIEJvb2xlYW4odGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50KSAmJgogICAgICAgIHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlID09PSBmYWxzZQogICAgICApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgcmV0YWlsX3BheW1lbnRfcGxhY2Vob2xkZXIoKSB7CiAgICAgIGlmICh0aGlzLmNoZWNrX3JldGFpbF9wYXltZW50X3R5cGVfZGlzYWJsZWQpIHsKICAgICAgICByZXR1cm4gIk5vIEJpbGxpbmcgQ3ljbGUgTmVlZGVkIGZvciBGcmVlIFBsYW4iOwogICAgICB9CiAgICAgIHJldHVybiAiUGljayBPbmUiOwogICAgfSwKICAgIGN1cnJlbnRfcmV0YWlsX3BsYW5fY2hhcmdlcygpIHsKICAgICAgLy8gaWYodGhpcy5yZXRhaWxfc2hvcGlmeV9jb21wYW55KSB7CiAgICAgIHJldHVybiBCb29sZWFuKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCkKICAgICAgICA/IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlCiAgICAgICAgICA/IGAkJHt0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQubW9udGhseV9jaGFyZ2V9L21vbnRoICBvciAkJHt0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuYW5udWFsX2NoYXJnZS5wZXJfbW9udGhfZWZmZWN0aXZlfS9tb250aCBiaWxsZWQgYXQgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmFubnVhbF9jaGFyZ2UuYWN0dWFsX2NoYXJnZX0gb25jZSBwZXIgeWVhcmAKICAgICAgICAgIDogbnVsbAogICAgICAgIDogbnVsbDsKICAgICAgLy8gfSBlbHNlIHsKICAgICAgLy8gICByZXR1cm4gQm9vbGVhbih0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQpCiAgICAgIC8vICAgPyB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZQogICAgICAvLyAgICAgPyBgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm1vbnRobHlfY2hhcmdlfS9tb250aGAKICAgICAgLy8gICAgIDogbnVsbAogICAgICAvLyAgIDogbnVsbDsKICAgICAgLy8gfQogICAgfSwKICAgIGNoZWNrX3JldGFpbF9zaG9waWZ5X2Zvcm1fdmFsaWRhdGlvbnMoKSB7CiAgICAgIGlmICgKICAgICAgICB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQgIT09IG51bGwgJiYKICAgICAgICB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgIT09IG51bGwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ICE9PSBudWxsICYmCiAgICAgICAgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlID09IG51bGwgJiYKICAgICAgICB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICBuYW1lV2l0aExhbmcgKHsgbmFtZSwgdHlwZSB9KSB7CiAgICByZXR1cm4gYCR7bmFtZX0g4oCUIFske3R5cGV9XWAKICB9LAogIHNob3dfc3dhbF9ub3RpZmljYXRpb24oKXsKICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgIHRpdGxlOiAnQXJlIFlvdSBTdXJlPycsCiAgICAgICAgICB0ZXh0OiAiWW91IHdhbnQgdG8gdW5zdWJzY3JpYmUgdGhpcyBwbGFuPyBpdCB3aWxsIHJldmVydCB5b3UgdG8gZnJlZSBwbGFuIiwKICAgICAgICAgIGljb246ICd3YXJuaW5nJywKICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICcjMzA4NWQ2JywKICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAnI2QzMycsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ1llcycKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSA9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnVwZGF0ZV9zdWJzY3JpcHRpb25fcGxhbl9mcmVlKCkKICAgICAgICAgIFN3YWwuZmlyZSgKICAgICAgICAgICAnVW5zdWJjcmliZWQhJywKICAgICAgICAgICAnU3Vic2NyaXB0aW9uIENhbmNlbGVkIFN1Y2Nlc3NmdWxseScsCiAgICAgICAgICAgICdzdWNjZXNzJwogICAgICAgICAgKQogICAgICAgIH0KICAgICAgfSkKICB9LAogIGdldF9zdWJzY3JpcHRpb25fdmFsaWRfdGlsbChzdWJfZGF0ZSl7CiAgICAgIHJldHVybiBtb21lbnQudXRjKHN1Yl9kYXRlKS5mb3JtYXQoIkRvIE1NTU0gWVlZWSIpOwogIH0sCiAgdXBkYXRlX3N1YnNjcmlwdGlvbl9wbGFuX2ZyZWUoKXsKICAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICB1bnN1YnNjcmliZV9wbGFuOiB0cnVlLCAgICAKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikKICAgICAgICAgIHsKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLlVzZXJNZW51OwogICAgICAgICAgICB0aGlzLnVwZGF0ZV9zaWRlYmFyX21lbnUobWVzc2FnZSk7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNpZGVCYXJNZW51VXBkYXRlZCIsIHRydWUpOwogICAgICAgICAgICAvLyAgY29uc29sZS5sb2coInVwZGF0ZSBzdWNjZXNzZnVsbHkiKQogICAgICAgICAgICB0aGlzLnVwZGF0ZV9yZXN0cmljdGlvbl9saXN0KHJlc3BvbnNlLmRhdGEuUmVzdHJpY3Rpb25MaXN0KQogICAgICAgICAgICB0aGlzLmdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICB9LAogIGdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgZ2V0X2FjdGl2ZV9wbGFuOiB0cnVlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU3RhdHVzID09PSAiU3VjY2VzcyIpCiAgICAgICAgICB7CiAgICAgICAgICAgIHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzID0gcmVzcG9uc2UuZGF0YS5EYXRhLmN1cnJlbnRfc3Vic2NyaXB0aW9uOwogICAgICAgICAgICB0aGlzLmhpZGVfYnV0dG9uID0gcmVzcG9uc2UuZGF0YS5EYXRhLmN1cnJlbnRfc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogICAgICAgICAgICB0aGlzLnNob3dfc3Vic2NyaXB0aW9uID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzID0gW107CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCwgUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgfSwKICBnZXRfY3VycmVudF9zdWJzY3JpcHRpb24oKSB7CiAgICBheGlvcwogICAgICAucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgaXNfZ2V0OiB0cnVlLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiQ1VSUkVOVCBQTEFOIERFVEFJTFMiLHJlc3BvbnNlKTsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJObyBBY3RpdmUgU3Vic2NyaXB0aW9uIHBsYW4gZm91bmQiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkN1cnJlbnQgU3Vic2NyaXB0aW9uIFBsYW4iKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJpb2QgPSByZXNwb25zZS5kYXRhLnN1YnNjcmlwdGlvbi5wZXJpb2Q7CiAgICAgICAgICB0aGlzLmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5jdXN0b21lcl9pZDsKICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gQWN0aXZlIFN1YnNjcmlwdGlvbiBwbGFuIGZvdW5kIikgewogICAgICAgICAgdGhpcy5jdXN0b21lcl9pZCA9IHJlc3BvbnNlLmRhdGEuY3VzdG9tZXJfaWQ7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJObyBBY3RpdmUgU3Vic2NyaXB0aW9uIHBsYW4gZm91bmQiLAogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGNoZWNrX2FkZG9uc19iYWxhbmNlKCkgewogICAgYXhpb3MucG9zdCgKICAgICAgYXBpX2NhbGxzLmNoZWNrX2FkZG9uc19iYWxhbmNlKCksCiAgICAgIHsKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgY2hlY2tfYmFsYW5jZTogdHJ1ZQogICAgICB9LAogICAgICB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9CiAgICApCiAgICAudGhlbigocmVzcG9uc2UpID0+ewogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgIGlmKEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5jcmVkaXRzLnNtc19jb3VudCkgPT0gdHJ1ZSkgewogICAgICAgIHZhciBzbXNfY291bnQgPSByZXNwb25zZS5kYXRhLmNyZWRpdHMuc21zX2NvdW50OwogICAgICAgIHRoaXMuY3JlZGl0c19iYWxhbmNlID0gIllvdXIgY3VycmVudCBTTVMgY3JlZGl0cyBhcmUgPHN0cm9uZz4gZm9yIFVTIHJlZ2lvbiA6IiArIHNtc19jb3VudC51cyArICIgfCBmb3IgTm9uLVVTIHJlZ2lvbjogIiArIHNtc19jb3VudC5ub25fdXMgKyAiPC9zdHJvbmc+IgogICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGdldF9hZGRvbl9kZXRhaWxzKCkgewogICAgYXhpb3MKICAgICAgLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgIGdldF9hZGRfb25zOiB0cnVlLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAoCiAgICAgICAgICByZXNwb25zZS5kYXRhLk1TRyA9PT0gIk5vIGFkZC1vbnMgZm91bmQgaW4gZGF0YWJhc2UiCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmlwZV9hZGRvbl9wbGFucyA9IFtdOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoQm9vbGVhbihyZXNwb25zZS5kYXRhLkRhdGEpICE9IGZhbHNlICkgewogICAgICAgICAgdmFyIHRlbXAgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5EYXRhKSB7CiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5PcHRpb25zLmxlbmd0aCA+IDApewogICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLk9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBvYmogPSB7fTsKICAgICAgICAgICAgICAgIG9ialsnbmFtZSddID0gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLlR5cGU7CiAgICAgICAgICAgICAgICBvYmpbJ1ByaWNlJ10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uUHJpY2U7CiAgICAgICAgICAgICAgICBvYmpbJ1NlcnZpY2UnXSA9IHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5TZXJ2aWNlOwogICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5EYXRhW2ldLlR5cGUgPT0gJ1Ntc0FkZE9uJykgewogICAgICAgICAgICAgICAgICBvYmpbJ3R5cGUnXSA9IHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5PcHRpb25zW2pdLnR5cGU7CiAgICAgICAgICAgICAgICAgIG9ialsnc21zX2NvdW50J10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9uc1tqXS5jb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAucHVzaChvYmopOwogICAgICAgICAgICAgICAgLy8gYWRkIGNvbmRpdGlvbiBmb3IgZW1haWwgYWRkIG9uIGFsc28gbGlrZSBhYm92ZSBpbiBmdXR1cmUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc3RyaXBlX2FkZG9uX3BsYW5zID0gdGVtcDsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgfSk7CiAgICAgIH0pOwogIH0sCiAgZ2V0X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCkgewogICAgYXhpb3MKICAgICAgLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBnZXRfcGxhbnM6IHRydWUsCiAgICAgIH0pCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIGlmICgKICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU3RhdHVzID09PSAiU3VjY2VzcyIgJiYKICAgICAgICAgIHJlc3BvbnNlLmRhdGEuRGF0YS5kYXRhLmxlbmd0aCA+IDAKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucyA9IHJlc3BvbnNlLmRhdGEuRGF0YS5kYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMgPSBbXTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgfSk7CiAgICAgIH0pOwogIH0sCiAgY2FuY2VsX3N1YnNjcmlwdGlvbigpIHsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgIGlzX2NhbmNlbDogdHJ1ZSwKICAgICAgICBzdWJzY3JpcHRpb25faWQ6IHRoaXMuc3Vic2NyaXB0aW9uX2lkLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIlN1YnNjcmlwdGlvbiBjYW5jZWxsZWQiKSB7CiAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9idG5fZGlzYWJsZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgaWYgKAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICkgewogICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogIH0sCiAgY3JlYXRlX2N1c3RvbWVyKCkgewogICAgaWYgKHRoaXMuc2VsZWN0ZWRfc3Vic2NyaXB0aW9uID09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfcGVyaW9kID09ICIiKSB7CiAgICAgIFN3YWwoewogICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICB0ZXh0OiAiU2VsZWN0IFN1YnNjcmlwdGlvbiBwbGFuIGFuZCBQZXJpb2QiLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgcGVyaW9kID0gdGhpcy5zZWxlY3RlZF9wZXJpb2QudG9Mb3dlckNhc2UoKTsKICAgIGZvciAodmFyIGkgaW4gdGhpcy5zdWJzY3JpcHRpb25fcGxhbnMpIHsKICAgICAgaWYgKHBlcmlvZCA9PSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5wZXJpb2QpIHsKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9PSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pdGVtLm5hbWUKICAgICAgICApIHsKICAgICAgICAgIHRoaXMucGxhbl9pZCA9IHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zW2ldLmlkOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIlBMQU4gTkFNRToiLCB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pdGVtLm5hbWUpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coIlBMQU4gSUQ6IiwgdGhpcy5zdWJzY3JpcHRpb25fcGxhbnNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHRoaXMucGxhbl9pZCA9PSAiIikgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogIlBsYW4gTm90IEZvdW5kIiwKICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIHRleHQ6ICJQbGVhc2UgY29udGFjdCBDZW5zZSBBZG1pbiIsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIHRpbWVyOiAyMDAwLAogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuY3VzdG9tZXJfaWQgPT0gIiIpIHsKICAgICAgdmFyIGN1c3RfZGF0YSA9IHsKICAgICAgICBuYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbnRhY3Q6ICIiLAogICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgbm90ZXM6IHsgRXh0cmE6ICJEZXRhaWxzIHJlbGF0ZWQgdG8gY3VzdG9tZXIiIH0sCiAgICAgIH07CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNyZWF0ZV9jdXN0b21lcl9pZDogdHJ1ZSwKICAgICAgICAgIGRhdGE6IGN1c3RfZGF0YSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJDdXN0b21lciBjcmVhdGVkIikgewogICAgICAgICAgICB2YXIgY3VzdG9tZXJfZGV0YWlsID0gcmVzcG9uc2UuZGF0YS5DdXN0b21lcl9EZXRhaWw7CiAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJfaWQgPSByZXNwb25zZS5kYXRhLkN1c3RvbWVyX0RldGFpbC5pZDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImN1c3RvbWVyIGlkIix0aGlzLmN1c3RvbWVyX2lkKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVfc3Vic2NyaXB0aW9uKHRoaXMucGxhbl9pZCwgdGhpcy5jdXN0b21lcl9pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiRXJyb3Igb2NjdXJyZWQgd2hpbGUgY3JlYXRpbmcgQ3VzdG9tZXIgSUQsIFBsZWFzZSByZS10cnkiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNyZWF0ZV9zdWJzY3JpcHRpb24odGhpcy5wbGFuX2lkLCB0aGlzLmN1c3RvbWVyX2lkKTsKICAgIH0KICB9LAogIGNyZWF0ZV9zdWJzY3JpcHRpb24ocGxhbl9pZCwgY3VzdG9tZXJfaWQpIHsKICAgIHZhciBzdWJfZGF0YSA9IHsKICAgICAgcGxhbl9pZDogcGxhbl9pZCwKICAgICAgY3VzdG9tZXJfaWQ6IGN1c3RvbWVyX2lkLAogICAgfTsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgIGNyZWF0ZV9zdWJzY3JpcHRpb246IHRydWUsCiAgICAgICAgZGF0YTogc3ViX2RhdGEsCiAgICAgIH0pCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiU3Vic2NyaXB0aW9uIGNyZWF0ZWQiKSB7CiAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbl9pZCA9IHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uX0RldGFpbC5pZDsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJTdWJzY3JpcHRpb24gaWQiLCByZXNwb25zZSk7CiAgICAgICAgICB0aGlzLnN0YXJ0X3BheW1lbnQodGhpcy5zdWJzY3JpcHRpb25faWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICB0ZXh0OiAiRXJyb3Igb2NjdXJyZWQgd2hpbGUgY3JlYXRpbmcgU3Vic2NyaXB0aW9uLCBQbGVhc2UgcmUtdHJ5IiwKICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIHN0YXJ0X3BheW1lbnQoc3Vic2NyaXB0aW9uX2lkKSB7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgLy8gc3RhcnRfcGF5bWVudCgpewogICAgLy8gICB2YXIgdm0gPSB0aGlzOwogICAgLy8gICB2YXIgZGF0YSA9IHsKICAgIC8vICAgICBvcmRlcl9hbW91bnQ6IDUwMDAwLAogICAgLy8gICAgIG9yZGVyX2N1cnJlbmN5OiAnSU5SJywKICAgIC8vICAgICBvcmRlcl9yZWNlaXB0OiAnb3JkZXJfcmNwdGlkXzExJywKICAgIC8vICAgICBwYXltZW50X2NhcHR1cmU6IDEsCiAgICAvLyAgICAgbm90ZXM6IHsnU2hpcHBpbmcgYWRkcmVzcyc6ICdCb21tYW5haGFsbGksIEJhbmdhbG9yZSd9CiAgICAvLyAgIH0KICAgIC8vICAgYXhpb3MuCiAgICAvLyAgICAgcG9zdCgKICAgIC8vICAgICAgIGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgZ2VuZXJhdGVfb3JkZXJfaWQ6IHRydWUsCiAgICAvLyAgICAgICAgIGRhdGE6IGRhdGEKICAgIC8vICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICBpZihyZXNwb25zZS5kYXRhLk1TRyA9PSAiT3JkZXIgSUQgY3JlYXRlZCIpewogICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbCk7CiAgICAvLyAgICAgICAgIHZtLm9yZGVyX2lkID0gcmVzcG9uc2UuZGF0YS5PcmRlcl9EZXRhaWwuaWQ7CiAgICAvLyAgICAgICAgIHZtLmFtb3VudCA9IHJlc3BvbnNlLmRhdGEuT3JkZXJfRGV0YWlsLmFtb3VudDsKICAgIC8vICAgICAgICAgY29uc29sZS5sb2coInJlYWNoZWQiKTsKICAgIHZhciBvcHRpb25zID0gewogICAgICBrZXk6IHByb2Nlc3MuZW52LlZVRV9BUFBfUkFaT1JQQVlfS0VZLCAvLyBFbnRlciB0aGUgS2V5IElEIGdlbmVyYXRlZCBmcm9tIHRoZSBEYXNoYm9hcmQKICAgICAgc3Vic2NyaXB0aW9uX2lkOiBzdWJzY3JpcHRpb25faWQsIC8vIFlvdSBkb250IG5lZWQgYW1vdW50L2N1cnJlbmN5L29yZGVyX2lkIHdoZW4gc3VibWl0dGluZyBzdWJzY3JpcHRpb24gaWQKICAgICAgLy8gImFtb3VudCI6IHRoaXMuYW1vdW50LCAvLyBBbW91bnQgaXMgaW4gY3VycmVuY3kgc3VidW5pdHMuIERlZmF1bHQgY3VycmVuY3kgaXMgSU5SLiBIZW5jZSwgNTAwMDAgcmVmZXJzIHRvIDUwMDAwIHBhaXNlCiAgICAgIC8vICJjdXJyZW5jeSI6ICJJTlIiLAogICAgICBuYW1lOiAiQ2Vuc2UgQUkiLAogICAgICBkZXNjcmlwdGlvbjogIlRlc3QgVHJhbnNhY3Rpb24iLAogICAgICBpbWFnZTogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9jZW5zZV9sb2dvLnBuZyIpLAogICAgICAvLyAib3JkZXJfaWQiOiB0aGlzLm9yZGVyX2lkLCAvL1RoaXMgaXMgYSBzYW1wbGUgT3JkZXIgSUQuIFBhc3MgdGhlIGBpZGAgb2J0YWluZWQgaW4gdGhlIHJlc3BvbnNlIG9mIFN0ZXAgMQogICAgICBoYW5kbGVyOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiRklOQUwgUEFZIiwgcmVzcG9uc2UpOwogICAgICAgIHZhciByYXpvcnBheV9wYXltZW50X2lkID0gcmVzcG9uc2UucmF6b3JwYXlfcGF5bWVudF9pZDsKICAgICAgICAvLyB2YXIgcmF6b3JwYXlfb3JkZXJfaWQgPSByZXNwb25zZS5yYXpvcnBheV9vcmRlcl9pZDsKICAgICAgICB2YXIgcmF6b3JwYXlfc3Vic2NyaXB0aW9uX2lkID0gcmVzcG9uc2UucmF6b3JwYXlfc3Vic2NyaXB0aW9uX2lkOwogICAgICAgIHZhciByYXpvcnBheV9zaWduYXR1cmUgPSByZXNwb25zZS5yYXpvcnBheV9zaWduYXR1cmU7CiAgICAgICAgdm0ucGF5X3N1Y2Nlc3NfZGF0YSA9IHt9OwogICAgICAgIHZtLnBheV9zdWNjZXNzX2RhdGEgPSB7CiAgICAgICAgICByYXpvcnBheV9wYXltZW50X2lkOiByYXpvcnBheV9wYXltZW50X2lkLAogICAgICAgICAgLy8gcmF6b3JwYXlfb3JkZXJfaWQ6IHJhem9ycGF5X29yZGVyX2lkLAogICAgICAgICAgcmF6b3JwYXlfc3Vic2NyaXB0aW9uX2lkOiByYXpvcnBheV9zdWJzY3JpcHRpb25faWQsCiAgICAgICAgICByYXpvcnBheV9zaWduYXR1cmU6IHJhem9ycGF5X3NpZ25hdHVyZSwKICAgICAgICAgIHJhem9ycGF5X2N1c3RvbWVyX2lkOiB2bS5jdXN0b21lcl9pZCwKICAgICAgICAgIC8vIG9yZGVyX2lkOiB0aGlzLm9yZGVyX2lkLAogICAgICAgICAgc3Vic2NyaXB0aW9uX3N0YXR1czogImFjdGl2ZSIsCiAgICAgICAgICBzdWJzY3JpcHRpb25faWQ6IHZtLnN1YnNjcmlwdGlvbl9pZCwKICAgICAgICAgIHBsYW5faWQ6IHZtLnBsYW5faWQsCiAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZTogdm0uc2VsZWN0ZWRfc3Vic2NyaXB0aW9uLAogICAgICAgICAgc3Vic2NyaXB0aW9uX3BlcmlvZDogdm0uc2VsZWN0ZWRfcGVyaW9kLAogICAgICAgIH07CiAgICAgICAgLy8gY29uc29sZS5sb2coIlBBWU1FTlQgU1VDQ0VTUyBEQVRBIix2bS5wYXlfc3VjY2Vzc19kYXRhKTsKICAgICAgICBpZiAoT2JqZWN0LmtleXModm0ucGF5X3N1Y2Nlc3NfZGF0YSkubGVuZ3RoICE9IDApIHsKICAgICAgICAgIHZtLmFkZF9kZXRhaWxzX3RvX3NlcnZlcih2bS5wYXlfc3VjY2Vzc19kYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coIlRyYW5zYWN0aW9uIGRpZCBub3Qgc3VjY2VlZCIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gInByZWZpbGwiOiB7CiAgICAgIC8vICAgICAibmFtZSI6ICJHYXVyYXYgS3VtYXIiLAogICAgICAvLyAgICAgImVtYWlsIjogImdhdXJhdi5rdW1hckBleGFtcGxlLmNvbSIsCiAgICAgIC8vICAgICAiY29udGFjdCI6ICIrOTE5ODc2NTQzMjEwIgogICAgICAvLyB9LAogICAgICBub3RlczogewogICAgICAgIGFkZHJlc3M6ICJSYXpvcnBheSBDb3Jwb3JhdGUgT2ZmaWNlIiwKICAgICAgfSwKICAgICAgdGhlbWU6IHsKICAgICAgICBjb2xvcjogIiMzMzk5Y2MiLAogICAgICB9LAogICAgfTsKICAgIHZhciByenAxID0gbmV3IFJhem9ycGF5KG9wdGlvbnMpOwogICAgcnpwMS5vbigicGF5bWVudC5mYWlsZWQiLCBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgY29uc29sZS5sb2coImVycm9yIiwgcmVzcG9uc2UpOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5jb2RlKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3IuZGVzY3JpcHRpb24pOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5zb3VyY2UpOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5zdGVwKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3IucmVhc29uKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3IubWV0YWRhdGEub3JkZXJfaWQpOwogICAgICBhbGVydChyZXNwb25zZS5lcnJvci5tZXRhZGF0YS5wYXltZW50X2lkKTsKICAgIH0pOwogICAgcnpwMS5vcGVuKCk7CiAgICAvLyB9CiAgICAvLyB9KQogICAgLy8gLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgaWYgKAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICkgewogICAgLy8gICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pOwogIH0sCiAgYWRkX2RldGFpbHNfdG9fc2VydmVyKGRhdGEpIHsKICAgIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgdmVyaWZ5X3N1YnNjcmlwdGlvbjogdHJ1ZSwKICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiU3Vic2NyaXB0aW9uIHZlcmlmaWNhdGlvbiBzdWNjZXNzIikgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3NmdWxseSBTdWJjcmlwdGlvbiBSZWdpc3RlcmVkIiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnBheV9zdWNjZXNzX2RhdGEgPSB7fTsKICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25fYnRuX2Rpc2FibGUgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6ICJFcnJvciBvY2N1cnJlZCB3aGlsZSBnZXR0aW5nIFN1YnNjcmlwdGlvbiB2ZXJpZmljYXRpb24gc3RhdHVzLCBQbGVhc2UgcmUtdHJ5IiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMucGF5X3N1Y2Nlc3NfZGF0YSA9IHt9OwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICB9LAogIHRvZ2dsZV9jaGFuZ2UodmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSAiSU5SIikgewogICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeSA9IHRoaXMuSU5SOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21tb25fY3VycmVuY3kgPSB0aGlzLlVTRDsKICAgIH0KICAgIGlmICh2YWx1ZSA9PSAiSU5SIikgewogICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeTIgPSB0aGlzLklOUjI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbW1vbl9jdXJyZW5jeTIgPSB0aGlzLlVTRDI7CiAgICB9CiAgfSwKICBkb3dubG9hZF9pbnZvaWNlKG51bSkgewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgYXhpb3MoewogICAgICBtZXRob2Q6ICJwb3N0IiwKICAgICAgdXJsOiBhcGlfY2FsbHMuYmlsbGluZ19pbnZvaWNlKCksCiAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICBkYXRhOiB7CiAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgZG93bmxvYWRfZmlsZTogdHJ1ZSwKICAgICAgICBmaWxlX25hbWU6IHRoaXMuaW52b2ljZV9kZXRhaWxzW251bV0sCiAgICAgIH0sCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgfSwKICAgIH0pCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vdCBhYmxlIHRvIGRvd25sb2FkIikgewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIHRvYXN0ci5lcnJvcigKICAgICAgICAgICAgIkR1ZSB0byBzb21lIGludGVybmFsIGVycm9yLCBub3QgYWJsZSB0byBkb3dubG9hZCB0aGUgZmlsZSIKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsICJBc2hpc2giICsgIi5wZGYiKTsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgfSwKICBjYWxsX3BheW1lbnQodHlwZSkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgLy8gY29uc29sZS5sb2coZCk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgdmFyIG9wdGlvbnMgPSB7fTsKICAgIGlmICh0eXBlID09ICJjb3VudHJ5X3NlbGVjdGVkIikgewogICAgICBpZiAodGhpcy5jb3VudHJ5X25hbWUuY29kZSA9PSAiIikgewogICAgICAgIGFsZXJ0KCJZb3UgbmVlZCB0byBzZWxlY3QgY291bnRyeSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5lZGl0X3Byb2ZpbGVfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGZpcnN0X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5maXJzdF9uYW1lLAogICAgICAgICAgICAgIGxhc3RfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxhc3RfbmFtZSwKICAgICAgICAgICAgICBjb3VudHJ5X25hbWU6IHRoaXMuY291bnRyeV9uYW1lLmNvZGUsCiAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucGhvbmVfbm8sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlByb2ZpbGUgVXBkYXRlZCIpIHsKICAgICAgICAgICAgICAvLyAgIFN3YWwoewogICAgICAgICAgICAgIC8vICAgdGl0bGU6ICJVcGRhdGVkIFN1Y2Nlc3NmdWxseSEhIiwKICAgICAgICAgICAgICAvLyAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAvLyAgIHRleHQ6ICJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIiwKICAgICAgICAgICAgICAvLyAgIHRpbWVyOjIwMDAsCiAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoIllvdXIgcHJvZmlsZSBoYXMgYmVlbiB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiY291bnRyeV9uYW1lIiwgdGhpcy5jb3VudHJ5X25hbWUuY29kZSk7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICB9LCAyNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkKCIjY291bnRyeW1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuaW5uZXJUZXh0ID09ICJQYXkiKSB7CiAgICAgIGlmICh0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHNlbGVjdCBhbiBhbW91bnQgdG8gYmUgcGFpZC4iKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwLnNsaWNlKDIsIC0xMCk7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCAqIDExODsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cDsKICAgICAgICBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgLz0gNzA7CiAgICAgICAgfQogICAgICAgIHBheV9hbW91bnQodGhpcy5jdXJyZW5jeV9hbW91bnQsIHRoaXMucGF5bWVudF9jdXJyZW5jeSwgIlRvcCBVcCIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAuc2xpY2UoMik7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCAqIDEwMDsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cDsKCiAgICAgICAgcGF5X2Ftb3VudCh0aGlzLmN1cnJlbmN5X2Ftb3VudCwgdGhpcy5wYXltZW50X2N1cnJlbmN5LCAiVG9wIFVwIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlubmVyVGV4dCA9PSAiU3Vic2NyaWJlIikgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGlmICh0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiA9PSAiIikgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIHNlbGVjdCBhbiBhbW91bnQgdG8gYmUgcGFpZC4iKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiA9CiAgICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbi5zbGljZSgyLCAtMTApOwogICAgICAgIHRoaXMuY3VycmVuY3lfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gKiAxMTg7CiAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb247CiAgICAgICAgaWYgKHRoaXMucGF5bWVudF9jdXJyZW5jeSA9PSAiSU5SIikgewogICAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50IC89IDcwOwogICAgICAgIH0KICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5iaWxsaW5nX3N1YnNjcmlwdGlvbl91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIFBsYW5BbW91bnQ6IHRoaXMudG9wX3VwX2Ftb3VudCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCkgewogICAgICAgICAgICAgIHBheV9hbW91bnQocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCwgIiIsICJTdWJzY3JpYmUiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLkVycm9yKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEuRXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPQogICAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMik7CiAgICAgICAgdGhpcy5jdXJyZW5jeV9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiAqIDEwMDsKICAgICAgICB0aGlzLnRvcF91cF9hbW91bnQgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19zdWJzY3JpcHRpb25fdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBQbGFuQW1vdW50OiB0aGlzLmN1cnJlbmN5X2Ftb3VudCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCkgewogICAgICAgICAgICAgIHBheV9hbW91bnQocmVzcG9uc2UuZGF0YS5TdWJzY3JpcHRpb25JZCwgIiIsICJTdWJzY3JpYmUiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLkVycm9yKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHJlc3BvbnNlLmRhdGEuRXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHBheV9hbW91bnQoYW1vdW50LCBjdXJyZW5jeV90eXBlLCBwYXltZW50X3R5cGUpIHsKICAgICAgaWYgKHBheW1lbnRfdHlwZSA9PSAiU3Vic2NyaWJlIikgewogICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICBrZXk6ICJyenBfdGVzdF9TbkRUYVBubmNmbGlEdCIsCiAgICAgICAgICBzdWJzY3JpcHRpb25faWQ6IGFtb3VudCwgLy9UaGlzIGlzIGFjdHVhbGx5IHN1YnNjcmlwdGlvbiBJRAogICAgICAgICAgLy8gc3Vic2NyaXB0aW9uX2NhcmRfY2hhbmdlOiAxLAogICAgICAgICAgbmFtZTogIkNlbnNlIEFJIiwKICAgICAgICAgIGRlc2NyaXB0aW9uOiAiSW5zdGlsbCBJbnRlbGxpZ2VuY2UiLAogICAgICAgICAgaW1hZ2U6ICIvaW1nL2NlbnNlX2ltYWdlLnBuZyIsIC8vIENPTVBBTlkgTE9HTwogICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQpOwogICAgICAgICAgICAvLyB2YXIgY29udGFjdCA9ICQoJyNjb250YWN0W3R5cGU9InRlbCJdJykudmFsdWU7CiAgICAgICAgICAgIC8vIHZhciBlbWFpbCA9ICQoJyNlbWFpbFt0eXBlPSJlbWFpbCJdJykudmFsdWU7CiAgICAgICAgICAgIHZtLnBheW1lbnRpZCA9IHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQ7CiAgICAgICAgICAgIHZtLnZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbiA9ICIiOwogICAgICAgICAgfSwKICAgICAgICAgIHByZWZpbGw6IHsKICAgICAgICAgICAgbmFtZTogIiIsIC8vIHBhc3MgY3VzdG9tZXIgbmFtZQogICAgICAgICAgICBlbWFpbDogIiIsIC8vIGN1c3RvbWVyIGVtYWlsCiAgICAgICAgICAgIGNvbnRhY3Q6ICIiLCAvL2N1c3RvbWVyIHBob25lIG5vLgogICAgICAgICAgfSwKICAgICAgICAgIG5vdGVzOiB7CiAgICAgICAgICAgIGFkZHJlc3M6ICJhZGRyZXNzIiwgLy9jdXN0b21lciBhZGRyZXNzCiAgICAgICAgICB9LAogICAgICAgICAgdGhlbWU6IHsKICAgICAgICAgICAgY29sb3I6ICIjMjgzNzc3IiwgLy8gc2NyZWVuIGNvbG9yCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgICAgbG9hZF9jaGVja291dCgpOwogICAgICB9IGVsc2UgaWYgKHBheW1lbnRfdHlwZSA9PSAiUGF5IikgewogICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICBrZXk6ICJyenBfdGVzdF9TbkRUYVBubmNmbGlEdCIsCiAgICAgICAgICBhbW91bnQ6IGFtb3VudCwgLy8gRXhhbXBsZTogMjAwMCBwYWlzZSA9IElOUiAyMAogICAgICAgICAgY3VycmVuY3k6IGN1cnJlbmN5X3R5cGUsCiAgICAgICAgICBuYW1lOiAiQ2Vuc2UgQUkiLAogICAgICAgICAgZGVzY3JpcHRpb246ICJJbnN0aWxsIEludGVsbGlnZW5jZSIsCiAgICAgICAgICBpbWFnZTogIi9pbWcvY2Vuc2VfaW1hZ2UucG5nIiwgLy8gQ09NUEFOWSBMT0dPCgogICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQpOwogICAgICAgICAgICB2YXIgY29udGFjdCA9ICQoJyNjb250YWN0W3R5cGU9InRlbCJdJykudmFsdWU7CiAgICAgICAgICAgIHZhciBlbWFpbCA9ICQoJyNlbWFpbFt0eXBlPSJlbWFpbCJdJykudmFsdWU7CiAgICAgICAgICAgIHZtLnBheW1lbnRpZCA9IHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQ7CiAgICAgICAgICAgIHZtLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9ICIiOwogICAgICAgICAgfSwKICAgICAgICAgIHByZWZpbGw6IHsKICAgICAgICAgICAgbmFtZTogIiIsIC8vIHBhc3MgY3VzdG9tZXIgbmFtZQogICAgICAgICAgICBlbWFpbDogIiIsIC8vIGN1c3RvbWVyIGVtYWlsCiAgICAgICAgICAgIGNvbnRhY3Q6ICIiLCAvL2N1c3RvbWVyIHBob25lIG5vLgogICAgICAgICAgfSwKICAgICAgICAgIG5vdGVzOiB7CiAgICAgICAgICAgIGFkZHJlc3M6ICJhZGRyZXNzIiwgLy9jdXN0b21lciBhZGRyZXNzCiAgICAgICAgICB9LAogICAgICAgICAgdGhlbWU6IHsKICAgICAgICAgICAgY29sb3I6ICIjMjgzNzc3IiwgLy8gc2NyZWVuIGNvbG9yCiAgICAgICAgICB9LAogICAgICAgIH07CiAgICAgICAgbG9hZF9jaGVja291dCgpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBsb2FkX2NoZWNrb3V0KCkgewogICAgICB2YXIgcnpwMSA9IG5ldyBSYXpvcnBheShvcHRpb25zKTsKICAgICAgcnpwMS5vcGVuKCk7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CiAgfSwKICBjaGVja19yZXRhaWxfcGxhbih2YWx1ZSwgaWQpIHsKICAgIHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSA9IG51bGw7CiAgfSwKICBzdWJzY3JpYmVfcmV0YWlsX3BsYW4oKSB7CiAgICAvLyBsZXQgc3Vic2NyaXB0aW9uX2RhdGEgPSB7CiAgICAvLyAgIHN1YnNjcmlwdGlvbl9wbGFuOiB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQsCiAgICAvLyAgIGJpbGxpbmdfY3ljbGU6IHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSwKICAgIC8vIH07CiAgICBpZiAodGhpcy5jaGVja19yZXRhaWxfc2hvcGlmeV9mb3JtX3ZhbGlkYXRpb25zKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMuc3Vic2NyaWJlX3Nob3BpZnlfYmlsbGluZygpLCB7CiAgICAgICAgICBzdWJzY3JpcHRpb25fcGxhbjogdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LAogICAgICAgICAgYmlsbGluZ19jeWNsZTogdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBpc19wYWlkX3BsYW46IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5pc19jaGFyZ2VhYmxlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAiU3VjY2VzcyIpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSA9PSAiQW5udWFsIikgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5kYXRhKSAmJgogICAgICAgICAgICAgICAgQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGEuZGF0YS5hcHBTdWJzY3JpcHRpb25DcmVhdGUpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6CiAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSB3YWl0IHdoaWxlIHdlIHJlZGlyZWN0IFlvdSB0byB0aGUgU2hvcGlmeSBNZXJjaGFudCBVSSEiLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YS5hcHBTdWJzY3JpcHRpb25DcmVhdGUuY29uZmlybWF0aW9uVXJsOwogICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSA9PSAiTW9udGhseSIpIHsKICAgICAgICAgICAgICBpZiAoQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGEuY29uZmlybWF0aW9uX3VybCkpIHsKICAgICAgICAgICAgICAgIC8vIFN3YWwoewogICAgICAgICAgICAgICAgLy8gICB0aXRsZTogIlBsZWFzZSB3YWl0IHdoaWxlIHdlIHJlZGlyZWN0IFlvdSB0byB0aGUgU2hvcGlmeSBNZXJjaGFudCBVSSEiLAogICAgICAgICAgICAgICAgLy8gICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIC8vICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgLy8gICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIC8vICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlCiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHJlc3BvbnNlLmRhdGEuZGF0YS5jb25maXJtYXRpb25fdXJsOwogICAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiU3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiVGhhbmsgWW91IGZvciBzdWJzY3JpYmluZyB0byBvdXIgRnJlZSBQbGFuISIsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiU29tZSBFcnJvciBPY2N1cnJlZCIsCiAgICAgICAgICAgIHRleHQ6ICJQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxjdCBhbGwgdGhlIHJlcXVpcmVkIHZhbHVlcyBiZWZvcmUgcHJvY2VlZGluZyEiLAogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICB9KTsKICAgIH0KICB9LAogIHN1Ym1pdF9zdHJpcGVfY2hlY2tvdXQoKSB7CiAgICBpZih0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQgIT09IG51bGwgJiYgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlICE9PSBudWxsKXsKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zKTsKICAgICAgbGV0IGNob3Nlbl9wbGFuX2RhdGEgPSB0aGlzLnJldGFpbF9wYXltZW50X3R5cGU9PT0iTW9udGhseSIgPyB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMuZmluZChpdGVtID0+IGl0ZW0uYW1vdW50LzEwMCA9PT0gdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm1vbnRobHlfY2hhcmdlKSAgOiB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMuZmluZChpdGVtID0+IGl0ZW0uYW1vdW50LzEwMCA9PT0gdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmFubnVhbF9jaGFyZ2UuYWN0dWFsX2NoYXJnZSkgCiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgICBnZW5lcmF0ZV9uZXdfcmVxdWVzdDogdHJ1ZSwKICAgICAgICAgIGNob3Nlbl9wbGFuX2RhdGE6IGNob3Nlbl9wbGFuX2RhdGEsCiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIHJlcXVlc3RfdHlwZTogIlBsYW4iCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLkRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYWxsIGdpdmVuIGZpZWxkIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogIH0sCiAgc3VibWl0X3N0cmlwZV9hZGRvbl9jaGVja291dCgpIHsKICAgIAogICAgdmFyIGNob3Nlbl9wbGFuX2RhdGEgPSB7CiAgICAgICJwbGFuX25hbWUiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl9wbGFuLm5hbWUgLAogICAgICAib3B0aW9uIiA6IHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbi50eXBlLAogICAgICAicHJpY2UiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl9wbGFuLlByaWNlCiAgICB9CgogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICAgIGdlbmVyYXRlX25ld19yZXF1ZXN0OiB0cnVlLAogICAgICAgICAgY2hvc2VuX3BsYW5fZGF0YTogY2hvc2VuX3BsYW5fZGF0YSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgcmVxdWVzdF90eXBlOiAiQWRkT24iCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLkRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogIH0KICB9LAp9Owo="},{"version":3,"sources":["Billing.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Billing.vue","sourceRoot":"src/portal/Chatbot/Dashboard/Account","sourcesContent":["<template>\n  <div>\n    <div class=\"spinner\" id=\"spinner\" v-show=\"spinnerOn\"></div>\n    <!-- <div class=\"dash-cont\"> -->\n    <div class=\"card dash-card\">\n      <div v-show=\"!show_subscription\"  >\n        <div class=\"card-header flex-wrap justify-content-between\">\n          <h4 class=\"mb-0\">Subscribe to Plan</h4>\n          <p>\n            (Your free trial is valid for 30 days after you install the Cense AI\n            App. After that you will be automatically transferred to the Free\n            Plan if you don't upgrade)\n          </p> \n        </div>\n        <div style=\"padding-left: 25px\"  v-if=\"retail_shopify_company\">\n          <div class=\"row mb-2\">\n            <div class=\"col-sm-4\">\n              <span> Select Plan </span>\n              <multiselect\n                track-by=\"name\"\n                label=\"name\"\n                :options=\"retail_shopify_subscription_plans\"\n                v-model=\"retail_plan_current\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                @input=\"check_retail_plan\"\n              ></multiselect>\n              <span>\n                {{ current_retail_plan_charges }}\n              </span>\n            </div>\n            <div class=\"col-sm-4\">\n              <span> Select Billing Cycle </span>\n              <multiselect\n                :options=\"payment_types\"\n                v-model=\"retail_payment_type\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                :disabled=\"check_retail_payment_type_disabled\"\n                :placeholder=\"retail_payment_placeholder\"\n              >\n              </multiselect>\n            </div>\n          </div>\n          <div class=\"row mb-2\">\n            <div class=\"col-sm-12\" style=\"margin:4px 0px;\">\n              <button\n                type=\"button\"\n                class=\"darkblue-btn\"\n                style=\"padding: 6px 15px\"\n                @click=\"subscribe_retail_plan()\"\n              >\n                Subscribe\n              </button>\n               <button\n                  @click=\"show_subscription=!show_subscription\"       \n                  type=\"button\"\n                  class=\"red-btn\"                  \n                  style=\"padding: 6px 15px\"\n                >\n                  Go Back\n            </button>\n            </div>\n          </div>\n        </div>\n        <div style=\"padding-left: 25px\" v-else>\n            <div class=\"row mb-2\">\n            <div class=\"col-sm-4\">\n              <span> Select Plan </span>\n              <multiselect\n                track-by=\"name\"\n                label=\"name\"\n                :options=\"retail_shopify_subscription_plans\"\n                v-model=\"retail_plan_current\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                @input=\"check_retail_plan\"\n              ></multiselect>\n              <span>\n                {{ current_retail_plan_charges }}\n              </span>\n            </div>\n            <div class=\"col-sm-4\">\n              <span> Select Billing Cycle </span>\n              <multiselect\n                :options=\"payment_types\"\n                v-model=\"retail_payment_type\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                :disabled=\"check_retail_payment_type_disabled\"\n                :placeholder=\"retail_payment_placeholder\"\n              >\n              </multiselect>\n            </div>\n          </div>\n            <div class=\"row mb-2\">\n            <div class=\"col-sm-12\" style=\"margin:4px 0px;\">\n              <button\n                type=\"button\"\n                class=\"darkblue-btn\"\n                style=\"padding: 6px 15px\"\n                @click=\"submit_stripe_checkout\"\n              >\n                Subscribe\n              </button>\n               <button\n                  @click=\"show_subscription=!show_subscription\"       \n                  type=\"button\"\n                  class=\"red-btn\"                  \n                  style=\"padding: 6px 15px\"\n                >\n                  Go Back\n            </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div v-if=\"show_subscription\" style=\"margin:10px\">\n        <div style=\"margin:10px;margin-left: 27\">\n          <h4 class=\"mb-0\">Subscription Plan</h4>\n          <br>\n          <p> Your current subscription plan is <strong>{{stripe_subscription_plans_details.subscription_type}}</strong> &nbsp; &nbsp;\n             <span v-if=\"hide_button !=='Free'\">Valid till <strong>{{get_subscription_valid_till(stripe_subscription_plans_details.subscription_valid_till)}}.</strong></span>\n             <span v-else>and your current monthly cycle expires on <strong>{{get_subscription_valid_till(stripe_subscription_plans_details.subscription_valid_till)}}.</strong></span>\n          </p>\n          <button\n                  type=\"button\"\n                  class=\"darkblue-btn\"\n                  style=\"padding: 6px 15px\"\n                  @click=\"show_subscription =false\"\n                >\n                  Upgrade Subscription\n          </button>\n          <button\n                  v-if=\"hide_button !=='Free'\"        \n                  type=\"button\"\n                  class=\"red-btn\"                  \n                  style=\"padding: 6px 15px\"\n                  @click=\"show_swal_notification\"\n                >\n                  Cancel Subscription\n          </button>\n        </div>\n      </div>\n    </div>\n    <div class=\"card dash-card\" v-if=\"stripe_addon_plans.length > 0\">\n      <div style=\"margin:10px\">\n        <div style=\"margin:10px;margin-left: 27\">\n          <h4 class=\"mb-0\">Purchase Cense Add Ons</h4>\n          <br>\n          <p v-show=\"credits_balance != null\"\n          v-html=\"credits_balance\"> &nbsp; &nbsp;\n          </p>\n            <div class=\"row mb-2\">\n            <div class=\"col-sm-4\">\n              <span> Select Add On </span>\n              <multiselect\n                track-by=\"type\"\n                label=\"name\"\n                :options=\"stripe_addon_plans\"\n                v-model=\"selected_addon_plan\"\n                :custom-label=\"nameWithLang\" \n                placeholder=\"Select one\"\n              ></multiselect>\n              <!-- <span>\n                {{ current_retail_plan_charges }}\n              </span> -->\n            </div>\n          </div>\n          <button\n            type=\"button\"\n            class=\"darkblue-btn\"\n            style=\"padding: 6px 15px\"\n            @click=\"submit_stripe_addon_checkout\"\n          >\n            Purchase\n          </button>\n        </div>\n      </div>\n    </div>\n    <div class=\"container-fluid\" id=\"dashboard-chart\" style=\"padding: 0\">\n      <div class=\"card dash-card\">\n        <div class=\"card-header d-flex flex-wrap justify-content-between\">\n          <h4>Cost for the month of {{ concurrent_users_month }}</h4>\n          <div class=\"card-act\"></div>\n        </div>\n        <div class=\"card-body\">\n          <div class=\"chart-box\">\n            <area-chart\n              :labels=\"Concurrent_Users_Data.labels\"\n              :data=\"Concurrent_Users_Data.data\"\n            ></area-chart>\n          </div>\n        </div>\n      </div>\n\n      <!-- <div style=\"height: 10%\"><canvas id=\"lineChart\"></canvas></div> -->\n\n      <div class=\"card dash-card\">\n        <div class=\"card-header d-flex flex-wrap justify-content-between\">\n          <h4>Bill Details</h4>\n          <div class=\"card-act\"></div>\n        </div>\n        <div class=\"card-body\" style=\"width: 60%; margin-left: 10%\">\n          <center\n            v-if=\"\n              piechart_data[0] <= 0 &&\n              piechart_data[1] <= 0 &&\n              piechart_data[2] <= 0\n            \"\n          >\n            <h6>No Data Available</h6>\n          </center>\n          <canvas\n            id=\"lineChart\"\n            v-show=\"\n              piechart_data[0] > 0 &&\n              piechart_data[1] > 0 &&\n              piechart_data[2] > 0\n            \"\n          ></canvas>\n        </div>\n      </div>\n\n      <!-- <div class=\"card dash-card\">\n        <div\n          class=\"card-header d-flex flex-wrap justify-content-between\"\n          style=\"padding-right: 75%\"\n        >\n          <h4>Invoice Details</h4>\n          <div class=\"form-group\" style=\"width: 100px\">\n            <select\n              class=\"form-control\"\n              id=\"year_select_id\"\n              v-model=\"year_selected\"\n            >\n              <option value disabled>Select</option>\n              <option\n                v-for=\"(current, index) in total_year\"\n                :key=\"index\"\n                :value=\"current\"\n              >\n                {{ current }}\n              </option>\n            </select>\n          </div>\n        </div>\n        <div class=\"card-body\">\n          <div class=\"row\" v-if=\"invoice_details.length != 0\">\n            <i class=\"fa fa-spinner fa-spin\" v-show=\"spinnerOn\"></i>\n            <div\n              class=\"col-lg-5\"\n              v-for=\"(invoice, index) in invoice_details_copy\"\n              :key=\"index\"\n            >\n              <a href=\"#\" @click=\"download_invoice(index)\">{{ invoice }}</a>\n            </div>\n          </div>\n          <center v-if=\"invoice_details.length == 0\">\n            <h6>No Invoice has been generated for this account</h6>\n          </center>\n        </div>\n      </div> -->\n      <!-- <div class=\"card dash-card\" v-if=\"!retail_shopify_company\">\n        <div class=\"card-header d-flex flex-wrap justify-content-between\">\n          <h4>Payment Method</h4>\n        </div>\n        <div style=\"display: flex\"> -->\n          <!-- <table class=\"table\" style=\"width: 49%\">\n              <tbody>\n                <tr>\n                  <td style=\"border: none; padding-top: 20px\">\n                    <p style=\"padding-left: 25px; padding-bottom: 31px\">\n                      Credit Your Account\n                    </p>\n                  </td>\n                  <td style=\"border: none\">\n                    <div class=\"form-group\">\n                      <select\n                        v-model=\"value_currency_top_up\"\n                        class=\"form-control\"\n                        style=\"padding: 5px 5px 5px 5px\"\n                        id=\"billing_top_up\"\n                      >\n                        <option value disabled>Top-up by</option>\n                        <option\n                          v-for=\"(currency, index) in common_currency\"\n                          :key=\"index\"\n                        >\n                          <span v-if=\"payment_currency == 'INR'\">\n                            <span>₹</span>\n                            {{ currency }}\n                            <span>+ 18% GST</span>\n                          </span>\n                          <template v-else>\n                            <span>US Dollar</span>\n                            {{ currency }}\n                          </template>\n                        </option>\n                      </select>\n                    </div>\n                  </td>\n                  <td style=\"border: none\">\n                    <a\n                      href=\"javascript:void(0)\"\n                      class=\"darkblue-btn\"\n                      @click=\"call_payment\"\n                      id=\"payment_btn\"\n                      >Pay</a\n                    >\n                  </td>\n                </tr>\n              </tbody>\n            </table> -->\n          <!-- <table class=\"table\" style=\"width: 2%\">\n              <tbody>\n                <tr>\n                  <td style=\"border: none; padding-top: 20px\">\n                    <h5 style=\"padding-left: 25px; padding-bottom: 31px\">OR</h5>\n                  </td>\n                </tr>\n              </tbody>\n            </table> -->\n          <!-- <table class=\"table\" style=\"width: 49%\">\n            <tbody>\n              <tr>\n                <td style=\"border: none; padding-top: 20px\">\n                  <p style=\"padding-left: 25px; padding-bottom: 31px\">\n                    Subscription\n                  </p>\n                </td>\n                <td style=\"border: none\">\n                  <div class=\"form-group d-flex\">\n                    <select\n                      v-model=\"selected_subscription\"\n                      class=\"form-control\"\n                      style=\"padding: 5px 5px 5px 5px; width: auto\"\n                      id=\"billing_top_up\"\n                    >\n                      <option value disabled>Subscription plan</option>\n                      <option\n                        v-for=\"(option, index) in select_subscription_plan\"\n                        :key=\"index\"\n                        :value=\"option\"\n                      >\n                        {{ option }}\n                      </option> -->\n                      <!-- <option\n                          v-for=\"(currency, index) in common_currency2\"\n                          :key=\"index\"\n                        >\n                          <span v-if=\"payment_currency == 'INR'\">\n                            <span>₹</span>\n                            {{ currency }}\n                            <span>+ 18% GST</span>\n                          </span>\n                          <template v-else>\n                            <span>US Dollar</span>\n                            {{ currency }}\n                          </template> \n                        </option> -->\n                    <!-- </select>\n                    <select\n                      v-model=\"selected_period\"\n                      class=\"form-control\"\n                      style=\"\n                        padding: 5px 5px 5px 5px;\n                        margin-left: 15px;\n                        width: auto;\n                      \"\n                      id=\"billing_top_up\"\n                    >\n                      <option value disabled>Period</option>\n                      <option\n                        v-for=\"(option, index) in plan_period\"\n                        :key=\"index\"\n                        :value=\"option\"\n                      >\n                        {{ option }}\n                      </option>\n                    </select>\n                  </div>\n                </td> -->\n                <!-- <td style=\"border: none\">\n                  <button\n                    class=\"darkblue-btn\"\n                    style=\"padding: 6px 15px\"\n                    id=\"rzp-button1\"\n                    v-if=\"subscription_btn_disable\"\n                    @click=\"create_customer\"\n                  >\n                    Subscribe\n                  </button>\n                  <button\n                    class=\"darkblue-btn\"\n                    style=\"padding: 6px 15px\"\n                    @click=\"submit_stripe_checkout\"\n                  >\n                    Subscribe!\n                  </button> -->\n                  <!-- <button\n                    class=\"btn btn-danger\"\n                    style=\"padding: 6px 15px\"\n                    id=\"rzp-button1\"\n                    v-else\n                    @click=\"cancel_subscription\"\n                  >\n                    Cancel\n                  </button> -->\n                  <!-- <a\n                      href=\"javascript:void(0)\"\n                      class=\"darkblue-btn\"\n                      @click=\"call_payment\"\n                      id=\"payment_btn\"\n                      >Subscribe</a\n                    > -->\n                <!-- </td> -->\n                <!-- <td style=\"border: none\">\n                    <button \n                    class=\"darkblue-btn\"\n                    style=\"padding: 6px 15px;\" \n                    id=\"rzp-button1\"\n                    @click=\"cancel_subscription\"\n                    >Cancel</button>\n                  </td> -->\n              <!-- </tr>\n            </tbody>\n          </table>\n        </div>\n      </div> -->\n      <!-- <div class=\"card dash-card\">\n        <div class=\"card-header flex-wrap justify-content-between\">\n          <h4 class=\"mb-0\">Subscribe to Plan</h4>\n          <p>\n            (Your free trial is valid for 30 days after you install the Cense AI\n            App. After that you will be automatically transferred to the Free\n            Plan if you don't upgrade)\n          </p>\n        </div>\n        <div style=\"padding-left: 25px\"  v-if=\"retail_shopify_company\">\n          <div class=\"row mb-2\">\n            <div class=\"col-sm-4\">\n              <span> Select Plan </span>\n              <multiselect\n                track-by=\"name\"\n                label=\"name\"\n                :options=\"retail_shopify_subscription_plans\"\n                v-model=\"retail_plan_current\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                @input=\"check_retail_plan\"\n              ></multiselect>\n              <span>\n                {{ current_retail_plan_charges }}\n              </span>\n            </div>\n            <div class=\"col-sm-4\">\n              <span> Select Billing Cycle </span>\n              <multiselect\n                :options=\"payment_types\"\n                v-model=\"retail_payment_type\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                :disabled=\"check_retail_payment_type_disabled\"\n                :placeholder=\"retail_payment_placeholder\"\n              >\n              </multiselect>\n            </div>\n          </div>\n          <div class=\"row mb-2\">\n            <div class=\"col-sm-12\">\n              <button\n                type=\"button\"\n                class=\"darkblue-btn\"\n                style=\"padding: 6px 15px\"\n                @click=\"subscribe_retail_plan()\"\n              >\n                Subscribe\n              </button>\n            </div>\n          </div>\n        </div>\n        <div style=\"padding-left: 25px\" v-else>\n           <div class=\"row mb-2\">\n            <div class=\"col-sm-4\">\n              <span> Select Plan </span>\n              <multiselect\n                track-by=\"name\"\n                label=\"name\"\n                :options=\"retail_shopify_subscription_plans\"\n                v-model=\"retail_plan_current\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                @input=\"check_retail_plan\"\n              ></multiselect>\n              <span>\n                {{ current_retail_plan_charges }}\n              </span>\n            </div>\n            <div class=\"col-sm-4\">\n              <span> Select Billing Cycle </span>\n              <multiselect\n                :options=\"payment_types\"\n                v-model=\"retail_payment_type\"\n                :searchable=\"false\"\n                :allow-empty=\"false\"\n                :disabled=\"check_retail_payment_type_disabled\"\n                :placeholder=\"retail_payment_placeholder\"\n              >\n              </multiselect>\n            </div>\n          </div>\n           <div class=\"row mb-2\">\n            <div class=\"col-sm-12\">\n              <button\n                type=\"button\"\n                class=\"darkblue-btn\"\n                style=\"padding: 6px 15px\"\n                @click=\"submit_stripe_checkout\"\n              >\n                Subscribe\n              </button>\n            </div>\n          </div>\n        </div>\n      </div> -->\n      <!-- <div class=\"card dash-card\" v-else>\n      </div> -->\n        <!-- <stripe-checkout\n          ref=\"checkoutRef\"\n          mode=\"subscription\"\n          :pk=\"publishableKey\"\n          :line-items=\"lineItems\"\n          :success-url=\"successURL\"\n          :cancel-url=\"cancelURL\"\n          @loading=\"(v) => (loading = v)\"\n        /> -->\n    </div>\n    <!-- </div> -->\n    <div\n      class=\"modal fade dash-modal\"\n      id=\"countrymodal\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n      aria-labelledby=\"countrymodaltitle\"\n      aria-hidden=\"true\"\n    >\n      <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-body\">\n            <div class=\"modal-head d-flex align-items-center\">\n              <div class=\"head-icn\">\n                <img src=\"/img/msg-blue.png\" alt style=\"width: auto\" />\n              </div>\n              <h6>\n                Kindly select the country where your company is registered\n              </h6>\n            </div>\n            <button\n              type=\"button\"\n              class=\"close\"\n              data-dismiss=\"modal\"\n              aria-label=\"Close\"\n            >\n              <img src=\"/img/close-icn.png\" alt />\n            </button>\n            <form @submit.prevent=\"call_payment('country_selected')\">\n              <div class=\"form-group\">\n                <!-- <select class=\"form-control\" v-model=\"country_name\">\n                  <option\n                    :value=\"country.code\"\n                    v-for=\"(country, index) in country_list\"\n                    :key=\"index\"\n                  >\n                    {{ country.name }}\n                  </option>\n                </select>{{this.country_name}} -->\n                <multiselect\n                  v-model=\"country_name\"\n                  :options=\"country_list\"\n                  :searchable=\"true\"\n                  :close-on-select=\"true\"\n                  :taggable=\"false\"\n                  :multiple=\"false\"\n                  placeholder=\"Select Country Name\"\n                  :max-height=\"200\"\n                  track-by=\"code\"\n                  label=\"name\"\n                >\n                  <!-- <span>{{ country_name }}</span> -->\n                </multiselect>\n              </div>\n              <div class=\"btn-wrap text-right\">\n                <button\n                  type=\"button\"\n                  @click=\"country_name = ''\"\n                  class=\"btn btn-link\"\n                  data-dismiss=\"modal\"\n                >\n                  Cancel\n                </button>\n                <button type=\"submit\" class=\"darkblue-btn\">Save</button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport Swal from \"sweetalert2\";\nimport countries from \"@/portal/components/Countries\";\nimport axios from \"axios\";\nimport { bus } from \"@/portal/main\";\nimport api_calls from \"@/portal/api_calls\";\nimport AreaChart from \"@/portal/components/AreaChart.vue\";\nimport Multiselect from \"vue-multiselect\";\n// import { StripeCheckout } from \"@vue-stripe/vue-stripe\";\nimport moment from \"moment\";\nimport { update_sidebar_menu, update_restriction_list} from \"@/portal/mixins\";\n\nexport default {\n  name: \"Billing\",\n  components: {\n    AreaChart,\n    Multiselect,\n    // StripeCheckout,\n  },\n  mixins: [\n    update_sidebar_menu,\n    update_restriction_list\n  ],\n  data() {\n    return {\n      razorpay_subscription_plans: [],\n      select_subscription_plan: [\"Silver\", \"Gold\", \"Plantinum\", \"Enterprise\"],\n      selected_subscription: \"\",\n      subscription_id: \"\",\n      plan_id: \"\",\n      customer_id: \"\",\n      plan_period: [\"Monthly\", \"Yearly\"],\n      selected_period: \"\",\n      order_id: \"\",\n      amount: \"\",\n      pay_success_data: {},\n      subscription_btn_disable: false,\n      country_list: countries,\n      paymentid: \"\",\n      barChart: \"\",\n      backgroundColor: [\"#e67e22\", \"#16a085\", \"#2980b9\"],\n      labels: [\n        \"Exchange of Messages\",\n        \"Execution of Tasks\",\n        \"Audio/Video Interaction\",\n        \"Storage\",\n      ],\n      companyid: null,\n      companyname: null,\n      country_name: \"\",\n      payment_currency: \"\",\n      value_currency_top_up: \"\",\n      value_currency_subscription: \"\",\n      INR: [3500, 7000, 14000, 35000],\n      USD: [50, 100, 200, 500],\n      common_currency: [],\n      currency_amount: null,\n      top_up_amount: null,\n      piechart_data: [],\n      user_role: this.$session.get(\"UserInformation\").role,\n      concurrent_users_month: \"\",\n      Concurrent_Users_Data: {\n        labels: [],\n        data: [],\n      },\n      months: [\n        \"Jan\",\n        \"Feb\",\n        \"Mar\",\n        \"Apr\",\n        \"May\",\n        \"June\",\n        \"July\",\n        \"Aug\",\n        \"Sept\",\n        \"Oct\",\n        \"Nov\",\n        \"Dec\",\n      ],\n      invoice_details: [],\n      invoice_details_copy: [],\n      total_year: [],\n      year_selected: \"\",\n      spinnerOn: false,\n      //harsh\n      common_currency2: [],\n      INR2: [3500, 7000, 14000, 35000],\n      USD2: [100, 300, 500],\n      retail_shopify_company: false,\n      retail_shopify_subscription_plans: [\n        // {\n        //   name: \"Free\",\n        //   is_chargeable: false,\n        // },\n        {\n          name: \"Starter\",\n          is_chargeable: true,\n          monthly_charge: 29,\n          annual_charge: {\n            per_month_effective: 24.17,\n            actual_charge: 290,\n          },\n        },\n        {\n          name: \"Premium\",\n          is_chargeable: true,\n          monthly_charge: 99,\n          annual_charge: {\n            per_month_effective: 82.5,\n            actual_charge: 990,\n          },\n        },\n      ],\n      retail_non_shopify_subscription_plans: [\n        // {\n        //   name: \"Free\",\n        //   is_chargeable: false,\n        // },\n        {\n          name: \"Starter\",\n          is_chargeable: true,\n          monthly_charge: 29,\n        },\n        {\n          name: \"Premium\",\n          is_chargeable: true,\n          monthly_charge: 99,\n        },\n      ],\n      retail_plan_current: null,\n      payment_types: [\"Annual\", \"Monthly\"],\n      retail_payment_type: null,\n      stripe_subscription_plans: null,\n      stripe_subscription_plans_details: null,\n      stripe_addon_plans: [],\n      show_subscription:false,\n      selected_addon_plan: null,\n      hide_button:'Free',\n      credits_balance: null\n    };\n  },\n  created() {\n    this.country_list = countries;\n    if (\n      !this.$session.has(\"CompanyId\") &&\n      this.$session.get(\"UserInformation\").role == \"SuperAdmin\"\n    ) {\n      toastr.warning(\"Please select a company name from the dropdown\");\n    }\n    if (this.user_role == \"SuperAdmin\") {\n      if (this.$session.has(\"CompanyId\")) {\n        this.companyid = this.$session.get(\"CompanyId\");\n        this.companyname = this.$session.get(\"CompanyName\");\n      } else {\n        this.companyid = this.$session.get(\"UserInformation\").company_id;\n        this.companyname = this.$session.get(\"UserInformation\").company_name;\n      }\n    } else {\n      this.companyid = this.$session.get(\"UserInformation\").company_id;\n      this.companyname = this.$session.get(\"UserInformation\").company_name;\n    }\n    if (\n      this.$session.get(\"UserInformation\").country_name == \"\" &&\n      !this.$session.has(\"country_name\")\n    ) {\n    } else {\n    //   axios\n    //     .post(\n    //       api_calls.piechart_url(),\n    //       {\n    //         companyname: this.companyname,\n    //         companyid: this.companyid,\n    //         email: this.$session.get(\"UserInformation\").email,\n    //         token: this.$session.get(\"UserInformation\").tokens,\n    //         license_key: this.$session.get(\"UserInformation\").license_key,\n    //       },\n    //       {\n    //         headers: {\n    //           Authorization: `Bearer ${this.$session.get(\"at\")}`,\n    //         },\n    //       }\n    //     )\n    //     .then((response) => {\n    //       this.piechart_data.push(response.data.TaskUsage),\n    //         this.piechart_data.push(response.data.ExchangeOfMsg),\n    //         this.piechart_data.push(response.data.CallUsage);\n    //       this.piechart_data.push(response.data.Storage_cost);\n    //       if (\n    //         response.data.TaskUsage > 0 ||\n    //         response.data.ExchangeOfMsg > 0 ||\n    //         response.data.CallUsage > 0 ||\n    //         response.data.Storage_cost > 0\n    //       ) {\n    //         this.barChart.options.legend.display = true;\n    //       }\n    //       this.barChart.update();\n    //     })\n    //     .catch((e) => {\n    //       if (\n    //         e.response.status === 410 ||\n    //         e.response.status === 440 ||\n    //         e.response.status === 409\n    //       ) {\n    //         this.$root.$emit(\"Session_Expired\", e.response.data);\n    //       }\n    //     });\n    //   axios\n    //     .post(\n    //       api_calls.billing_charge_url(),\n    //       {\n    //         companyname: this.companyname,\n    //         companyid: this.companyid,\n    //         email: this.$session.get(\"UserInformation\").email,\n    //         token: this.$session.get(\"UserInformation\").tokens,\n    //         license_key: this.$session.get(\"UserInformation\").license_key,\n    //       },\n    //       {\n    //         headers: {\n    //           Authorization: `Bearer ${this.$session.get(\"at\")}`,\n    //         },\n    //       }\n    //     )\n    //     .then((response) => {\n    //       this.payment_currency = response.data.currency_type;\n    //       this.toggle_change(this.payment_currency);\n    //       this.concurrent_users_month = response.data.Month;\n    //       var date = new Date();\n    //       var day = date.getDate();\n    //       var month = date.getMonth();\n    //       for (var i in response.data.Data) {\n    //         var response_date = i.split(\"-\");\n    //         if (\n    //           Number(response_date[0]) > day &&\n    //           response_date[1] == this.months[month]\n    //         ) {\n    //         } else {\n    //           this.Concurrent_Users_Data.labels.push(i);\n    //           this.Concurrent_Users_Data.data.push(response.data.Data[i]);\n    //         }\n    //       }\n    //       bus.$emit(\"Billing chart updated\", \"True\");\n    //     })\n    //     .catch((e) => {\n    //       if (\n    //         e.response.status === 410 ||\n    //         e.response.status === 440 ||\n    //         e.response.status === 409\n    //       ) {\n    //         this.$root.$emit(\"Session_Expired\", e.response.data);\n    //       }\n    //     });\n      axios\n        .get(api_calls.billing_invoice(), {\n          headers: {\n            Authorization: `Bearer ${this.$session.get(\"at\")}`,\n          },\n        })\n        .then((response) => {\n          this.total_year = response.data.YearList;\n          this.year_selected = this.total_year[0];\n        })\n        .catch((e) => {\n          if (\n            e.response.status === 410 ||\n            e.response.status === 440 ||\n            e.response.status === 409\n          ) {\n            this.$root.$emit(\"Session_Expired\", e.response.data);\n          }\n        });\n      axios\n        .post(\n          api_calls.billing_invoice(),\n          {\n            companyid: this.$session.get(\"UserInformation\").company_id,\n            companyname: this.$session.get(\"UserInformation\").company_name,\n            email: this.$session.get(\"UserInformation\").email,\n            license_key: this.$session.get(\"UserInformation\").license_key,\n            token: this.$session.get(\"UserInformation\").tokens,\n            download_file: false,\n            year: this.year_selected,\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${this.$session.get(\"at\")}`,\n            },\n          }\n        )\n        .then((response) => {\n          this.invoice_details = response.data.Bucket_list;\n          for (var i = 0; i < this.invoice_details.length; i++) {\n            this.invoice_details_copy[i] = this.invoice_details[i].slice(8);\n          }\n          // console.log(this.invoice_details_copy);\n        })\n        .catch((e) => {\n          if (\n            e.response.status === 410 ||\n            e.response.status === 440 ||\n            e.response.status === 409\n          ) {\n            this.$root.$emit(\"Session_Expired\", e.response.data);\n          }\n        });\n    }\n    let is_shopify = this.$session.get(\"retail_web_framework\");\n    if (Boolean(is_shopify) && is_shopify === \"shopify\") {\n      this.retail_shopify_company = true;\n    }\n  },\n  mounted() { \n    this.get_subscription_details(); // Get plans from razorpay dashboard\n    this.get_addon_details(); // Get Add Ons from cense db\n    this.get_current_subscription(); // Get current plan details from cense_db\n    this.get_current_subscription_details(); // get subscription details from cense_db\n    this.check_addons_balance();\n    if (\n      this.$session.get(\"UserInformation\").country_name == \"\" &&\n      !this.$session.has(\"country_name\")\n    ) {\n      $(\"#countrymodal\")\n        .modal({\n          backdrop: \"static\",\n        })\n        .on(\"hidden.bs.modal\", (e) => {\n          if (!this.$session.has(\"country_name\")) {\n            $(\"#countrymodal\").modal(\"hide\");\n            this.$router.push(\"/bot/dashboard\");\n          }\n        });\n    }\n    // var CHART = document.getElementById(\"lineChart\").getContext(\"2d\");\n    // Chart.defaults.scale.ticks.beginAtZero = true;\n    // this.barChart = new Chart(CHART, {\n    //   type: \"pie\",\n    //   data: {\n    //     labels: this.labels,\n    //     datasets: [\n    //       {\n    //         label: \"Points\",\n    //         backgroundColor: this.backgroundColor,\n    //         data: this.piechart_data,\n    //       },\n    //     ],\n    //   },\n    //   options: {\n    //     responsive: true,\n    //     legend: {\n    //       display: false,\n    //       position: \"right\",\n    //       labels: {\n    //         boxWidth: 60,\n    //         fontFamily: \"Fira Sans,sans-serif\",\n    //         fontSize: 14,\n    //         padding: 30,\n    //       },\n    //     },\n    //     plugins: {\n    //       display: true,\n    //     },\n    //   },\n    // });\n  },\n  computed: {\n    check_retail_payment_type_disabled() {\n      if (\n        Boolean(this.retail_plan_current) &&\n        this.retail_plan_current.is_chargeable === false\n      ) {\n        return true;\n      }\n      return false;\n    },\n    retail_payment_placeholder() {\n      if (this.check_retail_payment_type_disabled) {\n        return \"No Billing Cycle Needed for Free Plan\";\n      }\n      return \"Pick One\";\n    },\n    current_retail_plan_charges() {\n      // if(this.retail_shopify_company) {\n      return Boolean(this.retail_plan_current)\n        ? this.retail_plan_current.is_chargeable\n          ? `$${this.retail_plan_current.monthly_charge}/month  or $${this.retail_plan_current.annual_charge.per_month_effective}/month billed at $${this.retail_plan_current.annual_charge.actual_charge} once per year`\n          : null\n        : null;\n      // } else {\n      //   return Boolean(this.retail_plan_current)\n      //   ? this.retail_plan_current.is_chargeable\n      //     ? `$${this.retail_plan_current.monthly_charge}/month`\n      //     : null\n      //   : null;\n      // }\n    },\n    check_retail_shopify_form_validations() {\n      if (\n        this.retail_plan_current !== null &&\n        this.retail_payment_type !== null\n      ) {\n        return true;\n      } else if (\n        this.retail_plan_current !== null &&\n        this.retail_payment_type == null &&\n        this.retail_plan_current.is_chargeable === false\n      ) {\n        return true;\n      }\n      return false;\n    },\n  },\n  methods: {\n  nameWithLang ({ name, type }) {\n    return `${name} — [${type}]`\n  },\n  show_swal_notification(){\n      Swal.fire({\n          title: 'Are You Sure?',\n          text: \"You want to unsubscribe this plan? it will revert you to free plan\",\n          icon: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#3085d6',\n          cancelButtonColor: '#d33',\n          confirmButtonText: 'Yes'\n      }).then((result) => {\n        if (result.value == true) {\n          this.update_subscription_plan_free()\n          Swal.fire(\n           'Unsubcribed!',\n           'Subscription Canceled Successfully',\n            'success'\n          )\n        }\n      })\n  },\n  get_subscription_valid_till(sub_date){\n      return moment.utc(sub_date).format(\"Do MMMM YYYY\");\n  },\n  update_subscription_plan_free(){\n       axios\n        .post(\n          api_calls.stripe_payment_gateway(),\n          {\n            company_id: this.companyid,\n            company_name: this.companyname,\n            unsubscribe_plan: true,    \n            email: this.$session.get(\"UserInformation\").email\n          }\n        )\n        .then((response) => {\n          if (\n            response.data.Status === \"Success\")\n          {\n            let message = response.data.UserMenu;\n            this.update_sidebar_menu(message);\n            this.$root.$emit(\"SideBarMenuUpdated\", true);\n            //  console.log(\"update successfully\")\n            this.update_restriction_list(response.data.RestrictionList)\n            this.get_current_subscription_details()\n          } else {\n            Swal({\n            title: \"Some Error Occurred, Please Try Again!\",\n            type: \"error\",\n          });\n          }\n        })\n        .catch((e) => {\n          if (\n            e.response.status === 410 ||\n            e.response.status === 440 ||\n            e.response.status === 409\n          ) {\n            this.$root.$emit(\"Session_Expired\", e.response.data);\n          }\n        });\n  },\n  get_current_subscription_details() {\n      axios\n        .post(api_calls.stripe_payment_gateway(), {\n          company_id: this.companyid,\n          company_name: this.companyname,\n          get_active_plan: true,\n        })\n        .then((response) => {\n          if (\n            response.data.Status === \"Success\")\n          {\n            this.stripe_subscription_plans_details = response.data.Data.current_subscription;\n            this.hide_button = response.data.Data.current_subscription.subscription_type;\n            this.show_subscription = true;\n          } else {\n            this.stripe_subscription_plans_details = [];\n          }\n        })\n        .catch((e) => {\n          Swal.fire({\n            title: \"Some Error Occurred, Please Try Again!\",\n            type: \"error\",\n          });\n        });\n  },\n  get_current_subscription() {\n    axios\n      .post(api_calls.razorpay_communcation(), {\n        company_id: this.companyid,\n        company_name: this.companyname,\n        is_get: true,\n      })\n      .then((response) => {\n        // console.log(\"CURRENT PLAN DETAILS\",response);\n        if (response.data == null) {\n          this.subscription_btn_disable = true;\n          Swal({\n            title: \"No Active Subscription plan found\",\n            type: \"error\",\n            toast: true,\n            showConfirmButton: false,\n            timer: 2000,\n          });\n        } else if (response.data.MSG == \"Current Subscription Plan\") {\n          this.selected_subscription =\n            response.data.subscription.subscription_type;\n          this.selected_period = response.data.subscription.period;\n          this.customer_id = response.data.customer_id;\n          this.subscription_btn_disable = false;\n        } else if (response.data.MSG == \"No Active Subscription plan found\") {\n          this.customer_id = response.data.customer_id;\n          Swal({\n            title: \"No Active Subscription plan found\",\n            type: \"warning\",\n            toast: true,\n            showConfirmButton: false,\n            timer: 2000,\n          });\n          this.subscription_btn_disable = true;\n        }\n      })\n      .catch((e) => {\n        this.spinnerOn = false;\n        if (\n          e.response.status === 410 ||\n          e.response.status === 440 ||\n          e.response.status === 409\n        ) {\n          this.$root.$emit(\"Session_Expired\", e.response.data);\n        }\n      });\n  },\n  check_addons_balance() {\n    axios.post(\n      api_calls.check_addons_balance(),\n      {\n        company_name: this.companyname,\n        company_id: this.companyid,\n        check_balance: true\n      },\n      {\n          headers: {\n            Authorization: `Bearer ${this.$session.get(\"at\")}`,\n          },\n        }\n    )\n    .then((response) =>{\n      console.log(response);\n      if(Boolean(response.data.credits.sms_count) == true) {\n        var sms_count = response.data.credits.sms_count;\n        this.credits_balance = \"Your current SMS credits are <strong> for US region :\" + sms_count.us + \" | for Non-US region: \" + sms_count.non_us + \"</strong>\"\n      }\n      })\n      .catch((e) => {\n        if (\n          e.response.status === 410 ||\n          e.response.status === 440 ||\n          e.response.status === 409\n        ) {\n          this.$root.$emit(\"Session_Expired\", e.response.data);\n        }\n      });\n  },\n  get_addon_details() {\n    axios\n      .post(api_calls.stripe_payment_gateway(), {\n        get_add_ons: true,\n      })\n      .then((response) => {\n        if (\n          response.data.MSG === \"No add-ons found in database\"\n        ) {\n          this.stripe_addon_plans = [];\n          return;\n        } else if (Boolean(response.data.Data) != false ) {\n          var temp = [];\n          for (var i in response.data.Data) {\n            if(response.data.Data[i].Options.length > 0){\n              for (var j in response.data.Data[i].Options) {\n                var obj = {};\n                obj['name'] = response.data.Data[i].Type;\n                obj['Price'] = response.data.Data[i].Price;\n                obj['Service'] = response.data.Data[i].Service;\n                if(response.data.Data[i].Type == 'SmsAddOn') {\n                  obj['type'] = response.data.Data[i].Options[j].type;\n                  obj['sms_count'] = response.data.Data[i].Options[j].count;\n                }\n                temp.push(obj);\n                // add condition for email add on also like above in future\n              }\n            }\n          }\n          this.stripe_addon_plans = temp;\n        }\n      })\n      .catch((e) => {\n        console.log(e);\n        Swal.fire({\n          title: \"Some Error Occurred, Please Try Again!\",\n          type: \"error\",\n        });\n      });\n  },\n  get_subscription_details() {\n    axios\n      .post(api_calls.stripe_payment_gateway(), {\n        company_id: this.companyid,\n        company_name: this.companyname,\n        get_plans: true,\n      })\n      .then((response) => {\n        // console.log(response.data);\n        if (\n          response.data.Status === \"Success\" &&\n          response.data.Data.data.length > 0\n        ) {\n          this.stripe_subscription_plans = response.data.Data.data;\n        } else {\n          this.stripe_subscription_plans = [];\n        }\n      })\n      .catch((e) => {\n        console.log(e);\n        Swal.fire({\n          title: \"Some Error Occurred, Please Try Again!\",\n          type: \"error\",\n        });\n      });\n  },\n  cancel_subscription() {\n    axios\n      .post(api_calls.razorpay_communcation(), {\n        is_cancel: true,\n        subscription_id: this.subscription_id,\n      })\n      .then((response) => {\n        if (response.data.MSG == \"Subscription cancelled\") {\n          this.subscription_btn_disable = true;\n        } else {\n          Swal({\n            title: \"Internal Server Error\",\n            type: \"error\",\n            showConfirmButton: false,\n            timer: 2000,\n          });\n        }\n      })\n      .catch((e) => {\n        this.spinnerOn = false;\n        if (\n          e.response.status === 410 ||\n          e.response.status === 440 ||\n          e.response.status === 409\n        ) {\n          this.$root.$emit(\"Session_Expired\", e.response.data);\n        }\n      });\n  },\n  create_customer() {\n    if (this.selected_subscription == \"\" || this.selected_period == \"\") {\n      Swal({\n        type: \"info\",\n        text: \"Select Subscription plan and Period\",\n        toast: true,\n        position: \"top-right\",\n        showConfirmButton: false,\n        timer: 2000,\n      });\n      return;\n    }\n    var period = this.selected_period.toLowerCase();\n    for (var i in this.subscription_plans) {\n      if (period == this.subscription_plans[i].period) {\n        if (\n          this.selected_subscription == this.subscription_plans[i].item.name\n        ) {\n          this.plan_id = this.subscription_plans[i].id;\n          // console.log(\"PLAN NAME:\", this.subscription_plans[i].item.name);\n          // console.log(\"PLAN ID:\", this.subscription_plans[i].id);\n        }\n      }\n    }\n    if (this.plan_id == \"\") {\n      Swal({\n        title: \"Plan Not Found\",\n        type: \"error\",\n        text: \"Please contact Cense Admin\",\n        showConfirmButton: false,\n        timer: 2000,\n      });\n      return;\n    }\n    if (this.customer_id == \"\") {\n      var cust_data = {\n        name: this.companyname,\n        contact: \"\",\n        email: this.$session.get(\"UserInformation\").email,\n        notes: { Extra: \"Details related to customer\" },\n      };\n      axios\n        .post(api_calls.razorpay_communcation(), {\n          company_id: this.companyid,\n          company_name: this.companyname,\n          create_customer_id: true,\n          data: cust_data,\n        })\n        .then((response) => {\n          if (response.data.MSG == \"Customer created\") {\n            var customer_detail = response.data.Customer_Detail;\n            this.customer_id = response.data.Customer_Detail.id;\n            // console.log(\"customer id\",this.customer_id);\n            this.create_subscription(this.plan_id, this.customer_id);\n          } else {\n            Swal({\n              title: \"Internal Server Error\",\n              type: \"error\",\n              text: \"Error occurred while creating Customer ID, Please re-try\",\n              timer: 2000,\n            });\n          }\n        })\n        .catch((e) => {\n          if (\n            e.response.status === 410 ||\n            e.response.status === 440 ||\n            e.response.status === 409\n          ) {\n            this.$root.$emit(\"Session_Expired\", e.response.data);\n          }\n        });\n    } else {\n      this.create_subscription(this.plan_id, this.customer_id);\n    }\n  },\n  create_subscription(plan_id, customer_id) {\n    var sub_data = {\n      plan_id: plan_id,\n      customer_id: customer_id,\n    };\n    axios\n      .post(api_calls.razorpay_communcation(), {\n        create_subscription: true,\n        data: sub_data,\n      })\n      .then((response) => {\n        if (response.data.MSG == \"Subscription created\") {\n          this.subscription_id = response.data.Subscription_Detail.id;\n          // console.log(\"Subscription id\", response);\n          this.start_payment(this.subscription_id);\n        } else {\n          Swal({\n            title: \"Internal Server Error\",\n            type: \"error\",\n            text: \"Error occurred while creating Subscription, Please re-try\",\n            timer: 2000,\n          });\n        }\n      })\n      .catch((e) => {\n        if (\n          e.response.status === 410 ||\n          e.response.status === 440 ||\n          e.response.status === 409\n        ) {\n          this.$root.$emit(\"Session_Expired\", e.response.data);\n        }\n      });\n  },\n  start_payment(subscription_id) {\n    var vm = this;\n    // start_payment(){\n    //   var vm = this;\n    //   var data = {\n    //     order_amount: 50000,\n    //     order_currency: 'INR',\n    //     order_receipt: 'order_rcptid_11',\n    //     payment_capture: 1,\n    //     notes: {'Shipping address': 'Bommanahalli, Bangalore'}\n    //   }\n    //   axios.\n    //     post(\n    //       api_calls.razorpay_communcation(),\n    //       {\n    //         generate_order_id: true,\n    //         data: data\n    //       }).then((response) => {\n    //       if(response.data.MSG == \"Order ID created\"){\n    //         console.log(response.data.Order_Detail);\n    //         vm.order_id = response.data.Order_Detail.id;\n    //         vm.amount = response.data.Order_Detail.amount;\n    //         console.log(\"reached\");\n    var options = {\n      key: process.env.VUE_APP_RAZORPAY_KEY, // Enter the Key ID generated from the Dashboard\n      subscription_id: subscription_id, // You dont need amount/currency/order_id when submitting subscription id\n      // \"amount\": this.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise\n      // \"currency\": \"INR\",\n      name: \"Cense AI\",\n      description: \"Test Transaction\",\n      image: require(\"@/portal/assets/img/cense_logo.png\"),\n      // \"order_id\": this.order_id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1\n      handler: function (response) {\n        // console.log(\"FINAL PAY\", response);\n        var razorpay_payment_id = response.razorpay_payment_id;\n        // var razorpay_order_id = response.razorpay_order_id;\n        var razorpay_subscription_id = response.razorpay_subscription_id;\n        var razorpay_signature = response.razorpay_signature;\n        vm.pay_success_data = {};\n        vm.pay_success_data = {\n          razorpay_payment_id: razorpay_payment_id,\n          // razorpay_order_id: razorpay_order_id,\n          razorpay_subscription_id: razorpay_subscription_id,\n          razorpay_signature: razorpay_signature,\n          razorpay_customer_id: vm.customer_id,\n          // order_id: this.order_id,\n          subscription_status: \"active\",\n          subscription_id: vm.subscription_id,\n          plan_id: vm.plan_id,\n          subscription_type: vm.selected_subscription,\n          subscription_period: vm.selected_period,\n        };\n        // console.log(\"PAYMENT SUCCESS DATA\",vm.pay_success_data);\n        if (Object.keys(vm.pay_success_data).length != 0) {\n          vm.add_details_to_server(vm.pay_success_data);\n        } else {\n          console.log(\"Transaction did not succeed\");\n        }\n      },\n      // \"prefill\": {\n      //     \"name\": \"Gaurav Kumar\",\n      //     \"email\": \"gaurav.kumar@example.com\",\n      //     \"contact\": \"+919876543210\"\n      // },\n      notes: {\n        address: \"Razorpay Corporate Office\",\n      },\n      theme: {\n        color: \"#3399cc\",\n      },\n    };\n    var rzp1 = new Razorpay(options);\n    rzp1.on(\"payment.failed\", function (response) {\n      console.log(\"error\", response);\n      alert(response.error.code);\n      alert(response.error.description);\n      alert(response.error.source);\n      alert(response.error.step);\n      alert(response.error.reason);\n      alert(response.error.metadata.order_id);\n      alert(response.error.metadata.payment_id);\n    });\n    rzp1.open();\n    // }\n    // })\n    // .catch((e) => {\n    //   this.spinnerOn = false;\n    //     if (\n    //       e.response.status === 410 ||\n    //       e.response.status === 440 ||\n    //       e.response.status === 409\n    //     ) {\n    //       this.$root.$emit(\"Session_Expired\", e.response.data);\n    //     }\n    //   });\n  },\n  add_details_to_server(data) {\n    if (data != null) {\n      axios\n        .post(api_calls.razorpay_communcation(), {\n          company_id: this.companyid,\n          company_name: this.companyname,\n          verify_subscription: true,\n          data: data,\n        })\n        .then((response) => {\n          if (response.data.MSG == \"Subscription verification success\") {\n            Swal({\n              title: \"Successfully Subcription Registered\",\n              type: \"success\",\n              timer: 2000,\n            });\n            this.pay_success_data = {};\n            this.subscription_btn_disable = false;\n          } else {\n            Swal({\n              title: \"Internal Server Error\",\n              type: \"error\",\n              text: \"Error occurred while getting Subscription verification status, Please re-try\",\n              toast: true,\n              timer: 2000,\n            });\n            this.pay_success_data = {};\n          }\n        })\n        .catch((e) => {\n          if (\n            e.response.status === 410 ||\n            e.response.status === 440 ||\n            e.response.status === 409\n          ) {\n            this.$root.$emit(\"Session_Expired\", e.response.data);\n          }\n        });\n    }\n  },\n  toggle_change(value) {\n    if (value == \"INR\") {\n      this.common_currency = this.INR;\n    } else {\n      this.common_currency = this.USD;\n    }\n    if (value == \"INR\") {\n      this.common_currency2 = this.INR2;\n    } else {\n      this.common_currency2 = this.USD2;\n    }\n  },\n  download_invoice(num) {\n    this.spinnerOn = true;\n    axios({\n      method: \"post\",\n      url: api_calls.billing_invoice(),\n      responseType: \"blob\",\n      data: {\n        companyid: this.$session.get(\"UserInformation\").company_id,\n        companyname: this.$session.get(\"UserInformation\").company_name,\n        email: this.$session.get(\"UserInformation\").email,\n        license_key: this.$session.get(\"UserInformation\").license_key,\n        token: this.$session.get(\"UserInformation\").tokens,\n        download_file: true,\n        file_name: this.invoice_details[num],\n      },\n      headers: {\n        Authorization: `Bearer ${this.$session.get(\"at\")}`,\n      },\n    })\n      .then((response) => {\n        this.spinnerOn = false;\n        if (response.data == \"Not able to download\") {\n          this.spinnerOn = false;\n          toastr.error(\n            \"Due to some internal error, not able to download the file\"\n          );\n        } else {\n          this.spinnerOn = false;\n          var url = window.URL.createObjectURL(new Blob([response.data]));\n          var link = document.createElement(\"a\");\n          link.href = url;\n          link.setAttribute(\"download\", \"Ashish\" + \".pdf\");\n          document.body.appendChild(link);\n          link.click();\n        }\n      })\n      .catch((e) => {\n        if (\n          e.response.status === 410 ||\n          e.response.status === 440 ||\n          e.response.status === 409\n        ) {\n          this.$root.$emit(\"Session_Expired\", e.response.data);\n        }\n      });\n  },\n  call_payment(type) {\n    var d = new Date();\n    // console.log(d);\n    var vm = this;\n    var options = {};\n    if (type == \"country_selected\") {\n      if (this.country_name.code == \"\") {\n        alert(\"You need to select country\");\n      } else {\n        this.spinnerOn = true;\n        axios\n          .post(\n            api_calls.edit_profile_url(),\n            {\n              company_id: this.$session.get(\"UserInformation\").company_id,\n              company_name: this.$session.get(\"UserInformation\").company_name,\n              email: this.$session.get(\"UserInformation\").email,\n              license_key: this.$session.get(\"UserInformation\").license_key,\n              token: this.$session.get(\"UserInformation\").tokens,\n              first_name: this.$session.get(\"UserInformation\").first_name,\n              last_name: this.$session.get(\"UserInformation\").last_name,\n              country_name: this.country_name.code,\n              phone_number: this.$session.get(\"UserInformation\").phone_no,\n            },\n            {\n              headers: {\n                Authorization: `Bearer ${this.$session.get(\"at\")}`,\n              },\n            }\n          )\n          .then((response) => {\n            this.spinnerOn = false;\n            if (response.data == \"Profile Updated\") {\n              //   Swal({\n              //   title: \"Updated Successfully!!\",\n              //   type: \"success\",\n              //   text: \"Your profile has been updated successfully.\",\n              //   timer:2000,\n              // });\n              toastr.success(\"Your profile has been updated successfully.\");\n              this.$session.set(\"country_name\", this.country_name.code);\n              setTimeout(() => {\n                this.$router.go();\n              }, 2500);\n            }\n            $(\"#countrymodal\").modal(\"hide\");\n          })\n          .catch((e) => {\n            if (\n              e.response.status === 410 ||\n              e.response.status === 440 ||\n              e.response.status === 409\n            ) {\n              this.$root.$emit(\"Session_Expired\", e.response.data);\n            }\n          });\n      }\n    } else if (event.target.innerText == \"Pay\") {\n      if (this.value_currency_top_up == \"\") {\n        toastr.error(\"Please select an amount to be paid.\");\n      } else if (this.payment_currency == \"INR\") {\n        this.value_currency_top_up = this.value_currency_top_up.slice(2, -10);\n        this.currency_amount = this.value_currency_top_up * 118;\n        this.top_up_amount = this.value_currency_top_up;\n        if (this.payment_currency == \"INR\") {\n          this.top_up_amount /= 70;\n        }\n        pay_amount(this.currency_amount, this.payment_currency, \"Top Up\");\n      } else {\n        this.value_currency_top_up = this.value_currency_top_up.slice(2);\n        this.currency_amount = this.value_currency_top_up * 100;\n        this.top_up_amount = this.value_currency_top_up;\n\n        pay_amount(this.currency_amount, this.payment_currency, \"Top Up\");\n      }\n    } else if (event.target.innerText == \"Subscribe\") {\n      this.spinnerOn = true;\n      if (this.value_currency_subscription == \"\") {\n        toastr.error(\"Please select an amount to be paid.\");\n      } else if (this.payment_currency == \"INR\") {\n        this.value_currency_subscription =\n          this.value_currency_subscription.slice(2, -10);\n        this.currency_amount = this.value_currency_subscription * 118;\n        this.top_up_amount = this.value_currency_subscription;\n        if (this.payment_currency == \"INR\") {\n          this.top_up_amount /= 70;\n        }\n        axios\n          .post(\n            api_calls.billing_subscription_url(),\n            {\n              companyid: this.$session.get(\"UserInformation\").company_id,\n              companyname: this.$session.get(\"UserInformation\").company_name,\n              email: this.$session.get(\"UserInformation\").email,\n              license_key: this.$session.get(\"UserInformation\").license_key,\n              token: this.$session.get(\"UserInformation\").tokens,\n              PlanAmount: this.top_up_amount,\n            },\n            {\n              headers: {\n                Authorization: `Bearer ${this.$session.get(\"at\")}`,\n              },\n            }\n          )\n          .then((response) => {\n            if (response.data.SubscriptionId) {\n              pay_amount(response.data.SubscriptionId, \"\", \"Subscribe\");\n            } else if (response.data.Error) {\n              toastr.error(response.data.Error);\n            }\n          })\n          .catch((e) => {\n            if (\n              e.response.status === 410 ||\n              e.response.status === 440 ||\n              e.response.status === 409\n            ) {\n              this.$root.$emit(\"Session_Expired\", e.response.data);\n            }\n          });\n      } else {\n        this.value_currency_subscription =\n          this.value_currency_subscription.slice(2);\n        this.currency_amount = this.value_currency_subscription * 100;\n        this.top_up_amount = this.value_currency_subscription;\n        this.spinnerOn = true;\n        axios\n          .post(\n            api_calls.billing_subscription_url(),\n            {\n              companyid: this.$session.get(\"UserInformation\").company_id,\n              companyname: this.$session.get(\"UserInformation\").company_name,\n              email: this.$session.get(\"UserInformation\").email,\n              license_key: this.$session.get(\"UserInformation\").license_key,\n              token: this.$session.get(\"UserInformation\").tokens,\n              PlanAmount: this.currency_amount,\n            },\n            {\n              headers: {\n                Authorization: `Bearer ${this.$session.get(\"at\")}`,\n              },\n            }\n          )\n          .then((response) => {\n            this.spinnerOn = false;\n            if (response.data.SubscriptionId) {\n              pay_amount(response.data.SubscriptionId, \"\", \"Subscribe\");\n            } else if (response.data.Error) {\n              toastr.error(response.data.Error);\n            }\n          })\n          .catch((e) => {\n            if (\n              e.response.status === 410 ||\n              e.response.status === 440 ||\n              e.response.status === 409\n            ) {\n              this.$root.$emit(\"Session_Expired\", e.response.data);\n            }\n          });\n      }\n    }\n    function pay_amount(amount, currency_type, payment_type) {\n      if (payment_type == \"Subscribe\") {\n        options = {\n          key: \"rzp_test_SnDTaPnncfliDt\",\n          subscription_id: amount, //This is actually subscription ID\n          // subscription_card_change: 1,\n          name: \"Cense AI\",\n          description: \"Instill Intelligence\",\n          image: \"/img/cense_image.png\", // COMPANY LOGO\n          handler: function (response) {\n            // console.log(response.razorpay_payment_id);\n            // var contact = $('#contact[type=\"tel\"]').value;\n            // var email = $('#email[type=\"email\"]').value;\n            vm.paymentid = response.razorpay_payment_id;\n            vm.value_currency_subscription = \"\";\n          },\n          prefill: {\n            name: \"\", // pass customer name\n            email: \"\", // customer email\n            contact: \"\", //customer phone no.\n          },\n          notes: {\n            address: \"address\", //customer address\n          },\n          theme: {\n            color: \"#283777\", // screen color\n          },\n        };\n        load_checkout();\n      } else if (payment_type == \"Pay\") {\n        options = {\n          key: \"rzp_test_SnDTaPnncfliDt\",\n          amount: amount, // Example: 2000 paise = INR 20\n          currency: currency_type,\n          name: \"Cense AI\",\n          description: \"Instill Intelligence\",\n          image: \"/img/cense_image.png\", // COMPANY LOGO\n\n          handler: function (response) {\n            // console.log(response.razorpay_payment_id);\n            var contact = $('#contact[type=\"tel\"]').value;\n            var email = $('#email[type=\"email\"]').value;\n            vm.paymentid = response.razorpay_payment_id;\n            vm.value_currency_top_up = \"\";\n          },\n          prefill: {\n            name: \"\", // pass customer name\n            email: \"\", // customer email\n            contact: \"\", //customer phone no.\n          },\n          notes: {\n            address: \"address\", //customer address\n          },\n          theme: {\n            color: \"#283777\", // screen color\n          },\n        };\n        load_checkout();\n      }\n    }\n    function load_checkout() {\n      var rzp1 = new Razorpay(options);\n      rzp1.open();\n      event.preventDefault();\n    }\n  },\n  check_retail_plan(value, id) {\n    this.retail_payment_type = null;\n  },\n  subscribe_retail_plan() {\n    // let subscription_data = {\n    //   subscription_plan: this.retail_plan_current,\n    //   billing_cycle: this.retail_payment_type,\n    // };\n    if (this.check_retail_shopify_form_validations) {\n      this.spinnerOn = true;\n      axios\n        .post(api_calls.subscribe_shopify_billing(), {\n          subscription_plan: this.retail_plan_current,\n          billing_cycle: this.retail_payment_type,\n          company_id: this.companyid,\n          company_name: this.companyname,\n          is_paid_plan: this.retail_plan_current.is_chargeable,\n        })\n        .then((response) => {\n          this.spinnerOn = false;\n          if (response.data.status === \"Success\") {\n            if (this.retail_payment_type == \"Annual\") {\n              if (\n                Boolean(response.data.data) &&\n                Boolean(response.data.data.data.appSubscriptionCreate)\n              ) {\n                Swal({\n                  title:\n                    \"Please wait while we redirect You to the Shopify Merchant UI!\",\n                  toast: true,\n                  showCancelButton: false,\n                  type: \"info\",\n                  showConfirmButton: false,\n                });\n                setTimeout(() => {\n                  window.location =\n                    response.data.data.data.appSubscriptionCreate.confirmationUrl;\n                }, 1000);\n              }\n            } else if (this.retail_payment_type == \"Monthly\") {\n              if (Boolean(response.data.data.confirmation_url)) {\n                // Swal({\n                //   title: \"Please wait while we redirect You to the Shopify Merchant UI!\",\n                //   toast: true,\n                //   type: \"info\",\n                //   showCancelButton: false,\n                //   showConfirmButton: false\n                // })\n                setTimeout(() => {\n                  window.location = response.data.data.confirmation_url;\n                }, 1000);\n              } else {\n                Swal({\n                  title: \"Some Error Occurred\",\n                  text: \"Please Try Again!\",\n                  type: \"error\",\n                  showCancelButton: false,\n                });\n              }\n            } else if (this.retail_plan_current.is_chargeable === false) {\n              Swal({\n                title: \"Success\",\n                type: \"success\",\n                text: \"Thank You for subscribing to our Free Plan!\",\n              });\n            }\n          }\n        })\n        .catch((e) => {\n          this.spinnerOn = false;\n          console.log(e);\n          Swal({\n            title: \"Some Error Occurred\",\n            text: \"Please Try Again!\",\n            type: \"error\",\n            showCancelButton: false,\n          });\n        });\n    } else {\n      Swal({\n        title: \"Please selct all the required values before proceeding!\",\n        type: \"error\",\n        toast: true,\n        showCancelButton: false,\n        showConfirmButton: false,\n      });\n    }\n  },\n  submit_stripe_checkout() {\n    if(this.retail_plan_current !== null && this.retail_payment_type !== null){\n      // console.log(this.stripe_subscription_plans);\n      let chosen_plan_data = this.retail_payment_type===\"Monthly\" ? this.stripe_subscription_plans.find(item => item.amount/100 === this.retail_plan_current.monthly_charge)  : this.stripe_subscription_plans.find(item => item.amount/100 === this.retail_plan_current.annual_charge.actual_charge) \n      this.spinnerOn = true;\n      axios\n        .post(api_calls.stripe_payment_gateway(), {\n          generate_new_request: true,\n          chosen_plan_data: chosen_plan_data,\n          company_id: this.companyid,\n          company_name: this.companyname,\n          request_type: \"Plan\"\n        })\n        .then((response) => {\n          this.spinnerOn = false;\n          if (response.data.Status === \"Success\") {\n            window.location = response.data.Data;\n          } else {\n            Swal({\n              title: \"Some Error Occurred, Please Try Again!\",\n              type: \"error\",\n              showCancelButton: false\n            });\n          }\n          // console.log(response.data);\n        })\n        .catch((e) => {\n          this.spinnerOn = false;\n          console.log(e);\n          Swal({\n            title: \"Some Error Occurred, Please Try Again!\",\n            type: \"error\",\n          });\n        });\n    }else {\n            Swal({\n              title: \"Please select all given field\",\n              type: \"error\",\n              showCancelButton: false\n            });\n          }\n  },\n  submit_stripe_addon_checkout() {\n    \n    var chosen_plan_data = {\n      \"plan_name\" : this.selected_addon_plan.name ,\n      \"option\" : this.selected_addon_plan.type,\n      \"price\" : this.selected_addon_plan.Price\n    }\n\n    this.spinnerOn = true;\n      axios\n        .post(api_calls.stripe_payment_gateway(), {\n          generate_new_request: true,\n          chosen_plan_data: chosen_plan_data,\n          company_id: this.companyid,\n          company_name: this.companyname,\n          request_type: \"AddOn\"\n        })\n        .then((response) => {\n          this.spinnerOn = false;\n          if (response.data.Status === \"Success\") {\n            window.location = response.data.Data;\n          } else {\n            Swal({\n              title: \"Some Error Occurred, Please Try Again!\",\n              type: \"error\",\n              showCancelButton: false\n            });\n          }\n          // console.log(response.data);\n        })\n        .catch((e) => {\n          this.spinnerOn = false;\n          console.log(e);\n          Swal({\n            title: \"Some Error Occurred, Please Try Again!\",\n            type: \"error\",\n          });\n        });\n  }\n  },\n};\n</script>\n<style scoped>\n.red-btn{\n    font-size: 14px;\n    color: #fff;\n    background: #F23D3D;;\n    border: solid 1px #F23D3D;;\n    padding: 6px 15px;\n    font-weight: 400;\n    line-height: 20px;\n    display: inline-block;\n    border-radius: 4px;\n    cursor: pointer;\n    margin-left: 18px\n\n}\n.red-btn:hover {\n  background: none;\n  color: #273679;\n}\n\n.dash-card .card-body {\n  min-height: fit-content;\n}\n.col-lg-2 {\n  width: 100%;\n  margin-bottom: 1%;\n}\n#year_select_id {\n  padding: 5px 5px 5px 5px;\n}\n#payment_btn {\n  margin-left: auto;\n  width: auto;\n  text-align: center;\n  padding: 6px 15px;\n}\n.table td,\n.table th {\n  vertical-align: baseline;\n}\n</style>\n\n<style>\n.multiselect__tags {\n  min-height: 38px !important;\n  max-height: 42px !important;\n  height: 42px;\n}\n</style>"]}]}