{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/User Management/Permissions.vue","mtime":1645594423495},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOw0KaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7DQppbXBvcnQgU3dhbCBmcm9tICJzd2VldGFsZXJ0MiI7DQppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsNCmltcG9ydCBzaWRlYmFyaXRlbXMgZnJvbSAiLi4vTGF5b3V0L1NpZGVCYXJJdGVtIjsNCmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsNCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAicGVybWlzc2lvbnMiLA0KICBjb21wb25lbnRzOiB7DQogICAgTXVsdGlzZWxlY3QsDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHVzZXI6IFtdLA0KICAgICAgcm9sZXM6IFtdLA0KICAgICAgcGFnZV9ubzogMSwNCiAgICAgIHBlcl9wYWdlOiAxMCwNCiAgICAgIHNlbGVjdGVkX3JvbGU6ICIiLA0KICAgICAgc2VsZWN0ZWRfcGVybWlzc2lvbnM6IFtdLA0KICAgICAgcm9sZV9saXN0OiBbXSwNCiAgICAgIGNvbXBsZXRlX3JvbGVfbGlzdDogW10sDQogICAgICBwZXJtaXNzaW9uc19saXN0OiBbXSwNCiAgICAgIHBvcnRhbF9wZXJtaXNzaW9uc19saXN0OiBbXSwNCiAgICAgIGJvdF9wZXJtaXNzaW9uc19saXN0OiBbXSwNCiAgICAgIGludGVudGxpc3Q6IFtdLA0KICAgICAgY2hlY2tlZF9saXN0OiBbXSwNCiAgICAgIG51bWJlcl9vZl9yb3dzOiBudWxsLA0KICAgICAgdG90YWxfcGFnZXM6IG51bGwsDQogICAgICB1c2VyX3R5cGU6ICJQb3J0YWwiLA0KICAgICAgbWVudV9saXN0X2Zyb21fYXBpOiBudWxsLA0KICAgICAgc3Bpbm5lck9uOiBmYWxzZSwNCiAgICAgIGNvbXBhbnlpZDoNCiAgICAgICAgdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iDQogICAgICAgICAgPyB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIikNCiAgICAgICAgICA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLA0KICAgICAgY29tcGFueW5hbWU6DQogICAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIg0KICAgICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIikNCiAgICAgICAgICA6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLA0KICAgICAgLy9oYXJzaA0KICAgICAgcGFnZV9hcnJheTogW10sDQogICAgICBzZWFyY2hfbmFtZTogIiIsDQogICAgICBwb3J0YWxfcm9sZXM6IFtdLA0KICAgICAgYm90X3JvbGVzOiBbXSwNCiAgICAgIGlzU2hvd19wb3J0YWxfcm9sZXM6IHRydWUsDQogICAgICBpc1Nob3dfYm90X3JvbGVzOiBmYWxzZSwNCiAgICAgIGlzVmlzaWJsZVNlYXJjaENsZWFyOiBmYWxzZSwNCiAgICAgIHNlbGVjdF9yb2xlX25hbWVfZGlzYWJsZTogZmFsc2UsDQogICAgICBmaWx0ZXJfdXNlcl90eXBlOiAiUG9ydGFsIiwNCiAgICAgIHVzZXJfdHlwZV9jaGFuZ2U6IHRydWUsIA0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgcGVybWlzc2lvbnNfdGl0bGUoKSB7DQogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsNCiAgICAgICAgcmV0dXJuICJQb3J0YWwgTWVudSI7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiKSB7DQogICAgICAgIHJldHVybiAiQm90IEludGVudHMiOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2hlY2tfcG9ydGFsX2JvdF9yb2xlX2xlbmd0aCgpIHsNCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIiAmJiB0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIiAmJiB0aGlzLnBvcnRhbF9yb2xlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiICYmIHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl90eXBlID09ICJCb3QiICYmIHRoaXMuYm90X3JvbGVzLmxlbmd0aCA9PSAwKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCk7DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdmFyIHZtID0gdGhpczsNCiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnBhZ2Vfbm8pOw0KICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoJCh0aGlzKS5pcygiOmNoZWNrZWQiKSkgew0KICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsNCiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsNCiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOw0KICAgICAgfQ0KICAgIH0pOw0KICAgICQoIiNpbnRlbnRtb2RhbCIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgdm0uY2xlYXJfZmllbGRzKCk7DQogICAgICAvLyB2bS51c2VyX3R5cGUgPSAiUG9ydGFsIjsNCiAgICAgIHZtLnVzZXJfdHlwZV9jaGFuZ2UgPSB0cnVlDQogICAgICB2bS5zZWxlY3Rfcm9sZV9uYW1lX2Rpc2FibGUgPSBmYWxzZQ0KICAgIH0pOw0KICAgICQoInNlbGVjdCAuZm9ybS1jb250cm9sIikub24oImNsaWNrIiwgZnVuY3Rpb24gKCkge30pOw0KICB9LA0KICB3YXRjaDp7DQogICAgICAgIHNlYXJjaF9uYW1lKCl7DQogICAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKXsNCiAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgIHRoaXMuaXNWaXNpYmxlU2VhcmNoQ2xlYXIgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpew0KICAgICAgICAgICAgdGhpcy5pc1Zpc2libGVTZWFyY2hDbGVhciA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBmaWx0ZXJfdXNlcl90eXBlKCl7DQogICAgICAgICAgaWYodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKXsNCiAgICAgICAgICAgIHRoaXMuaXNTaG93X3BvcnRhbF9yb2xlcyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLmlzU2hvd19ib3Rfcm9sZXMgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMudXNlcl90eXBlID0gIlBvcnRhbCINCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCkNCiAgICAgICAgICB9ZWxzZSBpZiggdGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJCb3QiKXsNCiAgICAgICAgICAgIHRoaXMuaXNTaG93X2JvdF9yb2xlcyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMudXNlcl90eXBlID0gIkJvdCINCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICB9LA0KICBtZXRob2RzOiB7DQogICAgY2xlYXJfc2VhcmNoX25hbWUoKXsNCiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsNCiAgICB9LA0KICAgIHJlbW92ZV9zZWxlY3RlZF9wZXJtaXNzaW9uKHJlbW92ZWRPcHRpb24sIGlkKXsNCiAgICAgIGlmIChyZW1vdmVkT3B0aW9uLnN1Yl9tZW51ID09ICJEYXNoYm9hcmQiKXsNCiAgICAgICAgdG9hc3RyLndhcm5pbmcoIkRhc2hib2FyZCBpcyBhIGRlZmF1bHQgcGFnZSwgaXQncyBwZXJtaXNzaW9uIGNhbm5vdCBiZSByZW1vdmVkIik7DQogICAgICAgIHRoaXMuYWRkX3NlbGVjdGVkX3Blcm1pc3Npb24ocmVtb3ZlZE9wdGlvbi5zdWJfbWVudSk7DQogICAgICB9DQogICAgfSwNCiAgICBhZGRfc2VsZWN0ZWRfcGVybWlzc2lvbihyZW1vdmVkT3B0aW9uKXsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMudW5zaGlmdCh7DQogICAgICAgIHN1Yl9tZW51OiByZW1vdmVkT3B0aW9uLA0KICAgICAgfSkNCiAgICB9LA0KICAgIGxvYWRfcGVybWlzc2lvbigpew0KICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOw0KICAgICAgdGhpcy5yb2xlcyA9IFtdOw0KICAgICAgdGhpcy5wb3J0YWxfcm9sZXMgPSBbXTsNCiAgICAgIHRoaXMuYm90X3JvbGVzID0gW107DQogICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPVtdOw0KICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucyA9IFtdOw0KICAgICAgdGhpcy5pbnRlbnRsaXN0ID0gW10NCiAgICAgIHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QgPSBbXTsNCiAgICAgIHRoaXMucG9ydGFsX3Blcm1pc3Npb25zX2xpc3QgPSBbXTsNCiAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsNCiAgICAgIGlmICgNCiAgICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSAmJg0KICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiINCiAgICAgICkgew0KICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIGNvbXBhbnkgbmFtZSBmcm9tIHRoZSBkcm9wZG93biIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsNCiAgICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWU7DQogICAgICB9DQogICAgICBpZiAodGhpcy5jb21wYW55bmFtZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QoDQogICAgICAgICAgICBhcGlfY2FsbHMucm9sZV91cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICBpc1Nob3c6IHRydWUsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGFbMV0ubnVtYmVyX29mX3Jvd3M7DQogICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlKTsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlX2xpc3QocmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICBpc0Ryb3Bkb3duOiB0cnVlLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIHRoaXMuY29tcGxldGVfcm9sZV9saXN0ID0gcmVzcG9uc2UuZGF0YTsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhWzBdLlBvcnRhbC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YVswXS5Qb3J0YWwubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB0aGlzLnBvcnRhbF9yb2xlcy5wdXNoKA0KICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YVswXS5Qb3J0YWxbaV0NCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YVswXS5Cb3QubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGFbMF0uQm90Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ib3Rfcm9sZXMucHVzaCgNCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGFbMF0uQm90W2ldDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfcGVybWlzc2lvbnNfdXJsKCksDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgaXNHZXRNZW51OiB0cnVlLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIHRoaXMubWVudV9saXN0X2Zyb21fYXBpID0gcmVzcG9uc2UuZGF0YS5NZW51Ow0KICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLk1lbnU7DQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtZXNzYWdlKTsNCiAgICAgICAgICAgIGxldCBtZW51ID0ge307DQogICAgICAgICAgICBsZXQgbWFpbl9tZW51X2xpc3QgPSBtZXNzYWdlLmZpbHRlcigoYXJyKSA9PiAoYXJyLklzTWFzdGVyTWVudSA9PSB0cnVlKSAmJiAoYXJyLkVuYWJsZWQgPT0gdHJ1ZSkpOw0KICAgICAgICAgICAgbGV0IG1haW5fbWVudV9saXN0X2ZpbHRlcmVkID0gW10NCiAgICAgICAgICAgIGxldCBzdWJfbWVudV9saXN0ID0gbWVzc2FnZS5maWx0ZXIoKGFycikgPT4gKGFyci5IYXNTdWJNZW51cyA9PSBmYWxzZSkgJiYgKGFyci5FbmFibGVkID09IHRydWUpICYmIChhcnIuSXNTdWJNZW51ID09IHRydWUpKTsNCg0KICAgICAgICAgICAgZm9yIChsZXQgaSA9MCwgbiA9IG1haW5fbWVudV9saXN0Lmxlbmd0aDsgaSA8IG47IGkgKz0gMSkgew0KICAgICAgICAgICAgICBsZXQgbWVudUZpbHRlciA9IHNpZGViYXJpdGVtcy5maWx0ZXIoKHNpZGViYXIpID0+IHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICAgICAgICAgIHNpZGViYXIubmFtZSA9PT0gbWFpbl9tZW51X2xpc3RbaV0uTWVudUl0ZW0gJiYgQm9vbGVhbihzaWRlYmFyLnN2Z19odG1sKQ0KICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgaWYgKG1lbnVGaWx0ZXIubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgbWFpbl9tZW51X2xpc3RfZmlsdGVyZWQucHVzaChtZW51RmlsdGVyWzBdKTsNCiAgICAgICAgICAgICAgICAgIG1lbnVbbWVudUZpbHRlclswXS5uYW1lXSA9IHsNCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG1lbnVGaWx0ZXJbMF0ubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgbWVudV9saXN0OiBbXQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKG1haW5fbWVudV9saXN0W2ldLkhhc1N1Yk1lbnVzID09IGZhbHNlKXsNCiAgICAgICAgICAgICAgICAgICAgICBtZW51W21lbnVGaWx0ZXJbMF0ubmFtZV0ubWVudV9saXN0LnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViX21lbnU6IG1lbnVGaWx0ZXJbMF0ubmFtZQ0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwLCBuID0gc3ViX21lbnVfbGlzdC5sZW5ndGg7IGkgPCBuOyBpICs9IDEpew0KICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIChzaWRlYmFyaXRlbXNbal0ubmFtZSA9PT0gc3ViX21lbnVfbGlzdFtpXS5NZW51SXRlbSkgJiYNCiAgICAgICAgICAgICAgICAgIChCb29sZWFuKHNpZGViYXJpdGVtc1tqXS5wYWdlX3BhdGggJiYgc2lkZWJhcml0ZW1zW2pdLm1hc3Rlcl9tZW51ID09PSBzdWJfbWVudV9saXN0W2ldLk1hc3Rlck1lbnUpKQ0KICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coc2lkZWJhcml0ZW1zW2pdLm5hbWUpDQogICAgICAgICAgICAgICAgICBsZXQgdGVtcF92YXIgPSB7DQogICAgICAgICAgICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgbWVudVtzdWJfbWVudV9saXN0W2ldLk1hc3Rlck1lbnVdLm1lbnVfbGlzdC5wdXNoKHRlbXBfdmFyKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaChlKSB7DQogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGUpOw0KICAgICAgICAgICAgICAvLyBkZWJ1Z2dlcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1lbnUgPSBPYmplY3QudmFsdWVzKG1lbnUpDQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtZW51KTsNCiAgICAgICAgICAgIC8vIG1lbnUgPSBbXTsNCiAgICAgICAgICAgIC8vIHZhciB0aXRsZSA9IFtdOw0KICAgICAgICAgICAgLy8gdmFyIHN1Ym1lbnVzID0gW107DQogICAgICAgICAgICAvLyBmb3IgKGxldCBpID0gMCwgbiA9IHJlc3BvbnNlLmRhdGEuTWVudS5sZW5ndGg7IGkgPCBuOyBpICs9IDEpIHsNCiAgICAgICAgICAgIC8vICAgaWYgKA0KICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuTWVudVtpXS5IYXNTdWJNZW51cyA9PSBmYWxzZSAmJg0KICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGEuTWVudVtpXS5Jc01hc3Rlck1lbnUNCiAgICAgICAgICAgIC8vICAgKSB7DQogICAgICAgICAgICAvLyAgICAgZm9yICh2YXIgaiBpbiBzaWRlYmFyaXRlbXMpIHsNCiAgICAgICAgICAgIC8vICAgICAgIGlmIChzaWRlYmFyaXRlbXNbal0ubmFtZSA9PT0gcmVzcG9uc2UuZGF0YS5NZW51W2ldLk1lbnVJdGVtKSB7DQogICAgICAgICAgICAvLyAgICAgICAgIHRpdGxlID0gc2lkZWJhcml0ZW1zW2pdLm5hbWU7DQogICAgICAgICAgICAvLyAgICAgICAgIHN1Ym1lbnVzLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZSwNCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1lbnVbaV0uRW5hYmxlZCkgew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMucHVzaCh7DQogICAgICAgICAgICAvLyAgICAgICAgICAgICBzdWJfbWVudTogc2lkZWJhcml0ZW1zW2pdLm5hbWUsDQogICAgICAgICAgICAvLyAgICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICAgIH0NCiAgICAgICAgICAgIC8vICAgICAgIH0NCiAgICAgICAgICAgIC8vICAgICB9DQogICAgICAgICAgICAvLyAgIH0gZWxzZSBpZiAoDQogICAgICAgICAgICAvLyAgICAgcmVzcG9uc2UuZGF0YS5NZW51W2ldLkhhc1N1Yk1lbnVzID09IHRydWUgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSXNNYXN0ZXJNZW51DQogICAgICAgICAgICAvLyAgICkgew0KICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAvLyAgICAgICBpZiAoc2lkZWJhcml0ZW1zW2pdLm5hbWUgPT09IHJlc3BvbnNlLmRhdGEuTWVudVtpXS5NZW51SXRlbSkgew0KICAgICAgICAgICAgLy8gICAgICAgICB0aXRsZSA9IHNpZGViYXJpdGVtc1tqXS5uYW1lOw0KICAgICAgICAgICAgLy8gICAgICAgfQ0KICAgICAgICAgICAgLy8gICAgIH0NCiAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmICgNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSGFzU3ViTWVudXMgPT0gZmFsc2UgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaV0uSXNTdWJNZW51DQogICAgICAgICAgICAvLyAgICkgew0KICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGogaW4gc2lkZWJhcml0ZW1zKSB7DQogICAgICAgICAgICAvLyAgICAgICBpZiAoc2lkZWJhcml0ZW1zW2pdLm5hbWUgPT09IHJlc3BvbnNlLmRhdGEuTWVudVtpXS5NZW51SXRlbSkgew0KICAgICAgICAgICAgLy8gICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NZW51W2ldLkVuYWJsZWQpIHsNCiAgICAgICAgICAgIC8vICAgICAgICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgICAgc3ViX21lbnU6IHNpZGViYXJpdGVtc1tqXS5uYW1lLA0KICAgICAgICAgICAgLy8gICAgICAgICAgIH0pOw0KICAgICAgICAgICAgLy8gICAgICAgICB9DQogICAgICAgICAgICAvLyAgICAgICAgIHN1Ym1lbnVzLnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgICAgIHN1Yl9tZW51OiBzaWRlYmFyaXRlbXNbal0ubmFtZSwNCiAgICAgICAgICAgIC8vICAgICAgICAgfSk7DQogICAgICAgICAgICAvLyAgICAgICB9DQogICAgICAgICAgICAvLyAgICAgfQ0KICAgICAgICAgICAgLy8gICB9DQogICAgICAgICAgICAvLyAgIGlmIChpID09PSBuIC0gMSkgew0KICAgICAgICAgICAgLy8gICAgIG1lbnUucHVzaCh7DQogICAgICAgICAgICAvLyAgICAgICB0aXRsZTogdGl0bGUsDQogICAgICAgICAgICAvLyAgICAgICBtZW51X2xpc3Q6IHN1Ym1lbnVzLA0KICAgICAgICAgICAgLy8gICAgIH0pOw0KICAgICAgICAgICAgLy8gICAgIHRpdGxlID0gW107DQogICAgICAgICAgICAvLyAgICAgc3VibWVudXMgPSBbXTsNCiAgICAgICAgICAgIC8vICAgfSBlbHNlIGlmICgNCiAgICAgICAgICAgIC8vICAgICBpIDwgbiAtIDEgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaSArIDFdLkhhc1N1Yk1lbnVzID09IHRydWUgJiYNCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhLk1lbnVbaSArIDFdLklzTWFzdGVyTWVudQ0KICAgICAgICAgICAgLy8gICApIHsNCiAgICAgICAgICAgIC8vICAgICBtZW51LnB1c2goew0KICAgICAgICAgICAgLy8gICAgICAgdGl0bGU6IHRpdGxlLA0KICAgICAgICAgICAgLy8gICAgICAgbWVudV9saXN0OiBzdWJtZW51cywNCiAgICAgICAgICAgIC8vICAgICB9KTsNCiAgICAgICAgICAgIC8vICAgICB0aXRsZSA9IFtdOw0KICAgICAgICAgICAgLy8gICAgIHN1Ym1lbnVzID0gW107DQogICAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAgIC8vIH0NCiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG1lbnUpOw0KICAgICAgICAgICAgdGhpcy5wb3J0YWxfcGVybWlzc2lvbnNfbGlzdCA9IG1lbnU7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgYXhpb3MNCiAgICAgICAgLnBvc3QoDQogICAgICAgICAgYXBpX2NhbGxzLmdldF90YXNrX2xpc3QoKSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgaXNHZXRNZW51OiB0cnVlLA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfQ0KICAgICAgICApDQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgew0KICAgICAgICAgICAgdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdC5wdXNoKHsNCiAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGFbaV0sDQogICAgICAgICAgICAgIHRvX2JlX2Rpc3BsYXllZDogcmVzcG9uc2UuZGF0YVtpXSwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3RbDQogICAgICAgICAgICAgIGkNCiAgICAgICAgICAgIF0udG9fYmVfZGlzcGxheWVkID0gdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdFtpXS50b19iZV9kaXNwbGF5ZWQNCiAgICAgICAgICAgICAgLnJlcGxhY2UoL18vZywgIiAiKQ0KICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAuc3BsaXQoIiAiKQ0KICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSkpDQogICAgICAgICAgICAgIC5qb2luKCIgIik7DQogICAgICAgICAgICB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0Ww0KICAgICAgICAgICAgICBpDQogICAgICAgICAgICBdLnRvX2JlX2Rpc3BsYXllZCA9IHRoaXMuYm90X3Blcm1pc3Npb25zX2xpc3RbDQogICAgICAgICAgICAgIGkNCiAgICAgICAgICAgIF0udG9fYmVfZGlzcGxheWVkLnJlcGxhY2UoL0Zvcm0vZywgIiIpOw0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLnVwZGF0ZV9ib3Rfcm9sZXMoKTsNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQ0KICAgICAgICAgICkgew0KICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgaWYodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKXsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfcGVybWlzc2lvbnNfdXJsKCksDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsDQogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgaXNTaG93OiB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMsDQogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLA0KICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YS5Sb2xlUGVybWlzc2lvbkRhdGE7DQogICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsNCiAgICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gbGlzdFtpXS5NZW51LmZpbHRlcigobWVudWxpc3QpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAobWVudWxpc3QuRW5hYmxlZCAmJiAhbWVudWxpc3QuSGFzU3ViTWVudXMpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107DQogICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsNCiAgICAgICAgICAgICAgICBwZXJtX2xpc3QucHVzaChwZXJtaXNzaW9uc1tqXS5NZW51SXRlbSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IGxpc3RbaV0uUm9sZSwNCiAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLA0KICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QsDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50Ow0KICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKDEpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIGF4aW9zDQogICAgICAgIC5wb3N0KA0KICAgICAgICAgIGFwaV9jYWxscy5zaG93X2ludGVudF91cmwoKSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgZ2V0X2ludGVudHM6IHRydWUsDQogICAgICAgICAgICBzaG93aW50ZW50OiAiVHJ1ZSIsDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9DQogICAgICAgICkNCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhKSB7DQogICAgICAgICAgICB0aGlzLmludGVudGxpc3QucHVzaCh7DQogICAgICAgICAgICAgIC8vIHBlcm1pc3Npb25zOiByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwNCiAgICAgICAgICAgICAgLy8gdG9fYmVfZGlzcGxheWVkOiByZXNwb25zZS5kYXRhW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKSwNCiAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGFbaV0sDQogICAgICAgICAgICAgIHRvX2JlX2Rpc3BsYXllZDogcmVzcG9uc2UuZGF0YVtpXSwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQ0KICAgICAgICAgICkgew0KICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgc3ZnX2VuYWJsZSh2YWx1ZSkgew0KICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNlbGVjdGVkX3JvbGUpIHsNCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfcm9sZVtpXS5zdWJfbWVudSA9PSB2YWx1ZSkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gImRpc3BsYXk6bm9uZSI7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHNlbGVjdGVkX3JvbGVzKGluZGV4KSB7DQogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsNCiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkKSB7DQogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLnJvbGVzOw0KICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsNCiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsNCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gdHJ1ZSkgew0KICAgICAgICAgIGxldCB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKHRoaXMucm9sZXNbaW5kZXhdKTsNCiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMucm9sZXNbaW5kZXhdOw0KICAgICAgICAgIGlmICh2YWxfaW5kZXggPT0gLTEpIHsNCiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGVtcCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IGZhbHNlKSB7DQogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsNCiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgc2VsZWN0YWxsLmNoZWNrZWQgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKHJvbGVzKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gcm9sZS5yb2xlICE9PSBpbmRleDsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IHRlbXA7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHJvbGVfbW9kYWwodHlwZSkgew0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIC8vIGRlYnVnZ2VyOw0KICAgICAgLy8gaWYodHlwZSA9PSAndG9nZ2xlJyl7DQogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT09IG51bGwpIHsNCiAgICAgICAgLy8gdG9hc3RyLmVycm9yKCJQbGVhc2Ugc2VsZWN0IGVpdGhlciBvZiB0aGUgVXNlciBUeXBlcyIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5yb2xlX2xpc3QgPSB0aGlzLmNvbXBsZXRlX3JvbGVfbGlzdFt0aGlzLnVzZXJfdHlwZV07DQogICAgICB9DQogICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsNCiAgICAgICAgaWYgKHRoaXMucG9ydGFsX3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLnJvbGVfbGlzdCA9IHRoaXMuY29tcGxldGVfcm9sZV9saXN0WyJQb3J0YWwiXTsNCiAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRvYXN0ci5lcnJvcigiTm8gUm9sZXMgQWRkZWQgZm9yIFBvcnRhbCBVc2VyIFR5cGUuIik7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsNCiAgICAgICAgaWYgKHRoaXMuYm90X3JvbGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLnJvbGVfbGlzdCA9IHRoaXMuY29tcGxldGVfcm9sZV9saXN0WyJCb3QiXTsNCiAgICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSBbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIFR5cGU6ICJBY3Rpb25zIiwNCiAgICAgICAgICAgICAgRGV0YWlsczogdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdCwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIFR5cGU6ICJJbnRlbnRzIiwNCiAgICAgICAgICAgICAgRGV0YWlsczogdGhpcy5pbnRlbnRsaXN0LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICBdOw0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSAiIjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBTd2FsLmZpcmUoew0KICAgICAgICAgICAgdGV4dDoiTm8gUm9sZXMgQWRkZWQgZm9yIEJvdCBVc2VyIFR5cGUuIFBsZWFzZSBBZGQgYSBSb2xlIGZyb20gdGhlICdSb2xlcycgUGFnZSB0byBjb250aW51ZSBhZGRpbmcgUGVybWlzc2lvbnMuIiwNCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLA0KICAgICAgICAgICAgdGltZXI6IDYwMDAsDQogICAgICAgICAgfSk7DQogICAgICAgICAgLy8gdG9hc3RyLndhcm5pbmcoIk5vIFJvbGVzIEFkZGVkIGZvciBCb3QgVXNlciBUeXBlLiBQbGVhc2UgQWRkIGEgUm9sZSBmcm9tIHRoZSAnUm9sZXMnIFBhZ2UgdG8gY29udGludWUgYWRkaW5nIFBlcm1pc3Npb25zLiIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICANCiAgICAgIGlmICh0eXBlID09ICJvcGVuIikgew0KICAgICAgICB0aGlzLnNlbGVjdGVkX3JvbGUgPSAiIjsNCiAgICAgICAgdGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9ucyA9IFtdOw0KICAgICAgICB0aGlzLnVzZXJfdHlwZV9jaGFuZ2UgPSBmYWxzZTsNCiAgICAgICAgLy8gaWYgKHRoaXMucG9ydGFsX3JvbGVzLmxlbmd0aCA+IDAgfHwgdGhpcy5ib3Rfcm9sZXMubGVuZ3RoID4gMCkgew0KICAgICAgICBpZiAodGhpcy5ib3Rfcm9sZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIC8vIHRoaXMuY2xlYXJfZmllbGRzKCkNCiAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgic2hvdyIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcigNCiAgICAgICAgICAvLyAgICJQbGVhc2UgQWRkIGEgUm9sZSBmcm9tIHRoZSAnUm9sZXMnIFBhZ2UgdG8gY29udGludWUgYWRkaW5nIFBlcm1pc3Npb25zIg0KICAgICAgICAgIC8vICk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIGRlbGV0ZV9zZWxlY3RlZCgpIHsNCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICBsZXQgcm9sZWxpc3QgPSBbXSwNCiAgICAgICAgcmVzdHJpY3Rpb25saXN0ID0gW107DQogICAgICBmb3IgKHZhciBpIGluIHRoaXMucm9sZXMpIHsNCiAgICAgICAgcm9sZWxpc3QucHVzaCh0aGlzLnJvbGVzW2luZGV4XS5yb2xlKTsNCiAgICAgICAgcmVzdHJpY3Rpb25saXN0LnB1c2godGhpcy5yb2xlc1tpbmRleF0ucGVybWlzc2lvbnMpOw0KICAgICAgfQ0KICAgICAgdGhpcy5kZWxldGVfcW5zX2FwaShyb2xlbGlzdCwgcmVzdHJpY3Rpb25saXN0KTsNCiAgICB9LA0KICAgIGRlbGV0ZV9yb2xlKGluZGV4KSB7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIH0sDQogICAgZWRpdF9tb2RhbChpbmRleCkgew0KICAgICAgdGhpcy51c2VyX3R5cGVfY2hhbmdlID0gZmFsc2U7DQogICAgICB0aGlzLnNlbGVjdF9yb2xlX25hbWVfZGlzYWJsZSA9IHRydWU7DQogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjcG9ydGFsX2JveCIpLmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNib3RfYm94IikuZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgdGhpcy5zZWxlY3RlZF9yb2xlID0gdGhpcy5yb2xlc1tpbmRleF0udXNlcl9yb2xlOw0KICAgICAgLy8gY29uc29sZS5sb2codGhpcy5yb2xlc1tpbmRleF0udXNlcl9yb2xlKTsNCiAgICAgIHRoaXMudXNlcl90eXBlID0gdGhpcy5yb2xlc1tpbmRleF0udXNlci5yZXBsYWNlKCIgVXNlciIsICIiKTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMgPSBbXTsNCiAgICAgIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiQm90Iikgew0KICAgICAgICAvLyB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLmJvdF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSBbDQogICAgICAgICAgew0KICAgICAgICAgICAgVHlwZTogIkFjdGlvbnMiLA0KICAgICAgICAgICAgRGV0YWlsczogdGhpcy5ib3RfcGVybWlzc2lvbnNfbGlzdCwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIFR5cGU6ICJJbnRlbnRzIiwNCiAgICAgICAgICAgIERldGFpbHM6IHRoaXMuaW50ZW50bGlzdCwNCiAgICAgICAgICB9LA0KICAgICAgICBdOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgew0KICAgICAgICB0aGlzLnBlcm1pc3Npb25zX2xpc3QgPSB0aGlzLnBvcnRhbF9wZXJtaXNzaW9uc19saXN0Ow0KICAgICAgfQ0KICAgICAgZm9yICh2YXIgaiBpbiB0aGlzLnJvbGVzW2luZGV4XS5wZXJtaXNzaW9ucykgew0KICAgICAgICBpZiAodGhpcy51c2VyX3R5cGUgPT0gIkJvdCIpIHsNCiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zLnB1c2goew0KICAgICAgICAgICAgcGVybWlzc2lvbnM6IHRoaXMucm9sZXNbaW5kZXhdLm9yaWdpbmFsX3Blcm1pc3Npb25zW2pdLA0KICAgICAgICAgICAgdG9fYmVfZGlzcGxheWVkOiB0aGlzLnJvbGVzW2luZGV4XS5wZXJtaXNzaW9uc1tqXSwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiUG9ydGFsIikgew0KICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMucHVzaCh7DQogICAgICAgICAgICBzdWJfbWVudTogdGhpcy5yb2xlc1tpbmRleF0ucGVybWlzc2lvbnNbal0sDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMucm9sZV9saXN0ID0gdGhpcy5jb21wbGV0ZV9yb2xlX2xpc3RbdGhpcy51c2VyX3R5cGVdOw0KICAgIH0sDQogICAgcGFnZV9yZXF1aXJlKHBhZ2UpIHsNCiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgew0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT0gIiIpIHsNCiAgICAgICAgICBpZiAodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJQb3J0YWwiKXsNCiAgICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgew0KICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7DQogICAgICAgICAgICAvLyB0aGlzLnBhZ2Vfbm8gPSBwYWdlOw0KICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOw0KICAgICAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcm9sZTogdGhpcy51c2VyX3JvbGUsDQogICAgICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLA0KICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgICAgICAgaXNTaG93OiB0aGlzLmlzU2hvd19wb3J0YWxfcm9sZXMsDQogICAgICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywNCiAgICAgICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLlJvbGVQZXJtaXNzaW9uRGF0YS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7DQogICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YS5Sb2xlUGVybWlzc2lvbkRhdGE7DQogICAgICAgICAgICAgICAgICB0aGlzLnJvbGVzID0gW107DQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gbGlzdFtpXS5NZW51LmZpbHRlcigobWVudWxpc3QpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobWVudWxpc3QuRW5hYmxlZCAmJiAhbWVudWxpc3QuSGFzU3ViTWVudXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51bGlzdC5NZW51SXRlbTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcGVybV9saXN0ID0gW107DQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgICBwZXJtX2xpc3QucHVzaChwZXJtaXNzaW9uc1tqXS5NZW51SXRlbSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IGxpc3RbaV0uUm9sZSwNCiAgICAgICAgICAgICAgICAgICAgICB1c2VyOiBsaXN0W2ldLlVzZXJUeXBlLA0KICAgICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QsDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50Ow0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7DQogICAgICAgICAgICAgICAgfSkgICAgIA0KICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8DQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbHRlcl91c2VyX3R5cGUgPT0gIkJvdCIpIHsNCiAgICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgew0KICAgICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgICAgICBhcGlfY2FsbHMuYWRkX2VkaXRfYm90X3JvbGUoKSwNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICAgICAgaXNTaG93OiB0aGlzLmlzU2hvd19ib3Rfcm9sZXMsDQogICAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsNCiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJvbGVzID0gW107DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLkJvdFJvbGVQZXJtaXNzaW9uRGF0YSkgew0KICAgICAgICAgICAgICAgICAgLy8gbGV0IGJvdFJvbGVzID0gdGhpcy5ib3Rfcm9sZXMubWFwKCh7IHJvbGUgfSkgPT4gew0KICAgICAgICAgICAgICAgICAgLy8gICByZXR1cm4gcm9sZTsNCiAgICAgICAgICAgICAgICAgIC8vIH0pOw0KICAgICAgICAgICAgICAgICAgLy8gaWYgKGJvdFJvbGVzLmluY2x1ZGVzKGkpKSB7DQogICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib3Rfcm9sZXMuaW5jbHVkZXMoaSkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICB1c2VyOiAiQm90IFVzZXIiLA0KICAgICAgICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogYCR7aX1gLA0KICAgICAgICAgICAgICAgICAgICAgIGlucHV0X2VuYWJsZTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogcmVzcG9uc2UuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0ubWFwKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL18vZywgIiAiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoIiAiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgIC5qb2luKCIgIik7DQogICAgICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxfcGVybWlzc2lvbnM6IHJlc3BvbnNlLmRhdGEuQm90Um9sZVBlcm1pc3Npb25EYXRhW2ldLA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50Ow0KICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOw0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8DQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgew0KICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOw0KICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsNCiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOw0KICAgICAgICAgIGF4aW9zDQogICAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsDQogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLA0KICAgICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwNCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICApDQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgIT0gInRva2VuIGludmFsaWQiICYmDQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIFJlc3VsdHMgRm91bmQiICYmDQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIkludHJuYWwgU2VydmVyIEVycm9yIg0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHJlc3BvbnNlLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhOw0KICAgICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLlJvbGVQZXJtaXNzaW9uRGF0YS5sZW5ndGg7DQogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZV9jb3VudDsNCiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJvbGVzID0gW107DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7DQogICAgICAgICAgICAgICAgICB2YXIgcGVybWlzc2lvbnMgPSBsaXN0W2ldLk1lbnUuZmlsdGVyKChtZW51bGlzdCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAobWVudWxpc3QuRW5hYmxlZCAmJiAhbWVudWxpc3QuSGFzU3ViTWVudXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVudWxpc3QuTWVudUl0ZW07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgdmFyIHBlcm1fbGlzdCA9IFtdOw0KICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBwZXJtaXNzaW9ucykgew0KICAgICAgICAgICAgICAgICAgICBwZXJtX2xpc3QucHVzaChwZXJtaXNzaW9uc1tqXS5NZW51SXRlbSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICB1c2VyX3JvbGU6IGxpc3RbaV0uUm9sZSwNCiAgICAgICAgICAgICAgICAgICAgdXNlcjogbGlzdFtpXS5Vc2VyVHlwZSwNCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1fbGlzdCwNCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyBlbHNlIGlmKHJlc3BvbnNlLmRhdGEuTVNHPT0nTm8gUmVzdWx0cyBGb3VuZCcpew0KICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiTm8gcm9sZSBmb3VuZCIpOw0KICAgICAgICAgICAgICAvLyAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAvLyAgICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsNCiAgICAgICAgICAgICAgLy8gICAgIH0sIDI1MDApOw0KICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgIC8vIGVsc2UgaWYocmVzcG9uc2UuZGF0YS5NU0c9PSdJbnRybmFsIFNlcnZlciBFcnJvcicpew0KICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgLy8gICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgLy8gICAgICAgdGhpcy4kcm91dGVyLmdvKCk7DQogICAgICAgICAgICAgIC8vICAgICB9LCAyNTAwKTsNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBzYXZlX3JvbGUoKSB7DQogICAgICBpZiAodGhpcy5zZWxlY3RlZF9yb2xlID09ICIiIHx8IHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMubGVuZ3RoID09IDApIHsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RlZF9yb2xlID09ICJBZG1pbiIpIHsNCiAgICAgICAgdGhpcy5jbGVhcl9maWVsZHMoKTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VyX3R5cGUgPT0gIlBvcnRhbCIpIHsNCiAgICAgICAgdmFyIHNlbGVjdGVkX21lbnUgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zKSB7DQogICAgICAgICAgc2VsZWN0ZWRfbWVudS5wdXNoKHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnNbaV0uc3ViX21lbnUpOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5tZW51X2xpc3RfZnJvbV9hcGkpIHsNCiAgICAgICAgICBpZiAoc2VsZWN0ZWRfbWVudS5pbmNsdWRlcyh0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaVtpXS5NZW51SXRlbSkpDQogICAgICAgICAgICB0aGlzLm1lbnVfbGlzdF9mcm9tX2FwaVtpXS5FbmFibGVkID0gdHJ1ZTsNCiAgICAgICAgICBlbHNlIHRoaXMubWVudV9saXN0X2Zyb21fYXBpW2ldLkVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBheGlvcw0KICAgICAgICAgIC5wb3N0KA0KICAgICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9wZXJtaXNzaW9uc191cmwoKSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwNCiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsDQogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsDQogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksDQogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLA0KICAgICAgICAgICAgICBpc0VkaXQ6IHRydWUsDQogICAgICAgICAgICAgIHJvbGVfbmFtZTogdGhpcy5zZWxlY3RlZF9yb2xlLA0KICAgICAgICAgICAgICB1c2VyX3R5cGU6IHRoaXMudXNlcl90eXBlICsgIiBVc2VyIiwNCiAgICAgICAgICAgICAgbWVudTogdGhpcy5tZW51X2xpc3RfZnJvbV9hcGksDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlVzZXIgUm9sZSBFZGl0ZWQiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJVc2VyIFBlcm1pc3Npb25zIGhhdmUgYmVlbiB1cGRhdGVkLiBUaGUgdXBkYXRlZCBwZXJtaXNzaW9ucyB3aWxsIGJlIGF2YWlsYWJsZSBhZnRlciBuZXh0IGxvZ2luLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJCgiI2ludGVudG1vZGFsIikubW9kYWwoImhpZGUiKTsNCiAgICAgICAgICAgIHRoaXMubG9hZF9wZXJtaXNzaW9uKCk7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfdHlwZSA9PSAiQm90Iikgew0KICAgICAgICB2YXIgc2VsZWN0ZWRfbWVudSA9IFtdOw0KICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuc2VsZWN0ZWRfcGVybWlzc2lvbnMpIHsNCiAgICAgICAgICBzZWxlY3RlZF9tZW51LnB1c2godGhpcy5zZWxlY3RlZF9wZXJtaXNzaW9uc1tpXS5wZXJtaXNzaW9ucyk7DQogICAgICAgIH0NCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5hZGRfZWRpdF9ib3Rfcm9sZSgpLA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGJvdF9yb2xlX25hbWU6IHRoaXMuc2VsZWN0ZWRfcm9sZSwNCiAgICAgICAgICAgICAgcGVybWlzc2lvbl9saXN0OiBzZWxlY3RlZF9tZW51LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJVc2VyIFBlcm1pc3Npb25zIGhhdmUgYmVlbiB1cGRhdGVkLiBUaGUgdXBkYXRlZCBwZXJtaXNzaW9ucyB3aWxsIGJlIGF2YWlsYWJsZSBhZnRlciBuZXh0IGxvZ2luLiIpOw0KICAgICAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhID09ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGVkaXRfcmVzdHJpY3Rpb25zKGluZGV4KSB7DQogICAgICBpZiAodGhpcy5yb2xlc1tpbmRleF0udXNlciAhPSAiIikgew0KICAgICAgICB0aGlzLnJvbGVzW2luZGV4XS5pbnB1dF9lbmFibGUgPSAhdGhpcy5yb2xlc1tpbmRleF0uaW5wdXRfZW5hYmxlOw0KICAgICAgfQ0KICAgICAgdGhpcy5lZGl0ID0gdHJ1ZTsNCiAgICB9LA0KICAgIHVwZGF0ZV9saXN0KHJlc3BvbnNlKSB7DQogICAgICAvLyB0aGlzLnJvbGVzID0gW107DQogICAgICB2YXIgaW5wdXQ7DQogICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSkNCiAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UucmVzdHJpY3Rpb25saXN0KSB7DQogICAgICAgIGlmIChyZXNwb25zZS5yZXN0cmljdGlvbmxpc3RbaV0gPT0gIiIpIHsNCiAgICAgICAgICBpbnB1dCA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaW5wdXQgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnJvbGVzLnB1c2goew0KICAgICAgICAgIHVzZXI6IHJlc3BvbnNlLnJlc3RyaWN0aW9ubGlzdFtpXSwNCiAgICAgICAgICByb2xlOiByZXNwb25zZS5yb2xlbGlzdFtpXSwNCiAgICAgICAgICBpbnB1dF9lbmFibGU6IGlucHV0LA0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHVwZGF0ZV9ib3Rfcm9sZXMoKSB7DQogICAgICBpZiAodGhpcy5maWx0ZXJfdXNlcl90eXBlID09ICJCb3QiKXsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5hZGRfZWRpdF9ib3Rfcm9sZSgpLA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLA0KICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwNCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwNCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwNCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsDQogICAgICAgICAgICAgIGlzU2hvdzogdGhpcy5pc1Nob3dfYm90X3JvbGVzLA0KICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwNCiAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICkNCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsNCiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7DQogICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGEpIHsNCiAgICAgICAgICAgICAgLy8gbGV0IGJvdFJvbGVzID0gdGhpcy5ib3Rfcm9sZXMubWFwKCh7IHJvbGUgfSkgPT4gew0KICAgICAgICAgICAgICAvLyAgIHJldHVybiByb2xlOw0KICAgICAgICAgICAgICAvLyB9KTsNCiAgICAgICAgICAgICAgLy8gaWYgKGJvdFJvbGVzLmluY2x1ZGVzKGkpKSB7DQogICAgICAgICAgICAgIGlmICh0aGlzLmJvdF9yb2xlcy5pbmNsdWRlcyhpKSkgew0KICAgICAgICAgICAgICAgIHRoaXMucm9sZXMucHVzaCh7DQogICAgICAgICAgICAgICAgICB1c2VyOiAiQm90IFVzZXIiLA0KICAgICAgICAgICAgICAgICAgdXNlcl9yb2xlOiBgJHtpfWAsDQogICAgICAgICAgICAgICAgICBpbnB1dF9lbmFibGU6IHRydWUsDQogICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogcmVzcG9uc2UuZGF0YS5Cb3RSb2xlUGVybWlzc2lvbkRhdGFbaV0ubWFwKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcw0KICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9fL2csICIgIikNCiAgICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCgiICIpDQogICAgICAgICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc3Vic3RyaW5nKDEpKQ0KICAgICAgICAgICAgICAgICAgICAgIC5qb2luKCIgIik7DQogICAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Blcm1pc3Npb25zOiByZXNwb25zZS5kYXRhLkJvdFJvbGVQZXJtaXNzaW9uRGF0YVtpXSwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50Ow0KICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7DQogICAgICAgICAgfSkNCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0sDQogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgew0KICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgew0KICAgICAgICByZXR1cm4gIiBhY3RpdmUiOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuICIiOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2xlYXJfZmllbGRzKCkgew0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3BvcnRhbF9ib3giKS5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2JvdF9ib3giKS5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgdGhpcy5zZWxlY3RlZF9yb2xlID0gIiI7DQogICAgICB0aGlzLnNlbGVjdGVkX3Blcm1pc3Npb25zID0gW107DQogICAgICAkKCIjaW50ZW50bW9kYWwiKS5tb2RhbCgiaGlkZSIpOw0KICAgIH0sDQogICAgY2FsbHNlYXJjaCgpIHsNCiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykgew0KICAgICAgICB0aGlzLnNlYXJjaF9wcm9kdWN0KCk7DQogICAgICB9DQogICAgfSwNCiAgICBzZWFyY2hfcHJvZHVjdCgpIHsNCiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7DQogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsNCiAgICAgICAgYXhpb3MNCiAgICAgICAgICAucG9zdCgNCiAgICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfcGVybWlzc2lvbnNfdXJsKCksDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsDQogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLA0KICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LA0KICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLA0KICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywNCiAgICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsDQogICAgICAgICAgICAgIGtleTogdGhpcy5zZWFyY2hfbmFtZSwNCiAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsDQogICAgICAgICAgICAgIHBhZ2Vfbm86IDEsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gew0KICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSAidG9rZW4gaW52YWxpZCIgJiYNCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSBudWxsICYmDQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuTVNHICE9ICJObyBSZXN1bHRzIEZvdW5kIiAmJg0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLk1TRyAhPSAiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhLlJvbGVQZXJtaXNzaW9uRGF0YTsNCiAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEuUm9sZVBlcm1pc3Npb25EYXRhLmxlbmd0aDsNCiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZV9jb3VudDsNCiAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gMTsNCiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7DQogICAgICAgICAgICAgIHRoaXMucm9sZXMgPSBbXTsNCiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7DQogICAgICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gbGlzdFtpXS5NZW51LmZpbHRlcigobWVudWxpc3QpID0+IHsNCiAgICAgICAgICAgICAgICAgIGlmIChtZW51bGlzdC5FbmFibGVkICYmICFtZW51bGlzdC5IYXNTdWJNZW51cykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVudWxpc3QuTWVudUl0ZW07DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgdmFyIHBlcm1fbGlzdCA9IFtdOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcGVybWlzc2lvbnMpIHsNCiAgICAgICAgICAgICAgICAgIHBlcm1fbGlzdC5wdXNoKHBlcm1pc3Npb25zW2pdLk1lbnVJdGVtKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgIHVzZXJfcm9sZTogbGlzdFtpXS5Sb2xlLA0KICAgICAgICAgICAgICAgICAgdXNlcjogbGlzdFtpXS5Vc2VyVHlwZSwNCiAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBwZXJtX2xpc3QsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJlc3VsdHMgRm91bmQiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiTm8gcm9sZSBmb3VuZCIpOw0KICAgICAgICAgICAgICB0aGlzLmxvYWRfcGVybWlzc2lvbigpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKSB7DQogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50cm5hbCBTZXJ2ZXIgRXJyb3IiKTsNCiAgICAgICAgICAgICAgdGhpcy5sb2FkX3Blcm1pc3Npb24oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC5jYXRjaCgoZSkgPT4gew0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8DQogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwNCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQ0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0b2FzdHIuZXJyb3IoIkVudGVyIHByb3BlciBkYXRhIGZvciBzZWFyY2hpbmciKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNldHBhZ2luYXRpb24ocGFnZV9ubykgew0KICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107DQogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7DQogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gMSkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgew0KICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsNCiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzKSB7DQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOw0KICAgICAgICBmb3IgKGxldCBpID0gdGhpcy50b3RhbF9wYWdlcyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgew0KICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsNCiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA+PSB0aGlzLnRvdGFsX3BhZ2VzIC0gNCkgew0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsNCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7DQogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsNCiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IHBhZ2Vfbm8gLSAzOyBpIDw9IHBhZ2Vfbm8gKyAzOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOw0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KfTsNCg=="},null]}