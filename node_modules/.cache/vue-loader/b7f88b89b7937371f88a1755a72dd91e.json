{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/ResponseIntent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Data Inputs/ResponseIntent.vue","mtime":1643027096168},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGF4aW9zIGZyb20gImF4aW9zIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc2hvd19zdXBlcmFkbWluX2RhdGE6IFtdLAogICAgICBhZGRfc3VwZXJhZG1pbl9kYXRhOiBbXSwKICAgICAgaW50ZW50bGlzdDogW10sCiAgICAgIHNvdXJjZTogIldlYiIsCiAgICAgIG9wdGlvbnM6IFtdLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBpbnRlbnRzOiAiIiwKICAgICAgcGFnZV9ubzogMSwKICAgICAgcGVyX3BhZ2U6IDIwLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIHJlc3BvbnNlOiAiIiwKICAgICAgYWRkX2VkaXQ6ICJmYWxzZSIsCiAgICAgIGZpbGVfbGFiZWw6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWwyOiAiQ2hvb3NlIGZpbGUiLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBzcGlubmVyT246IGZhbHNlLAogICAgICBmaWxlX2NvbnRlbnQ6ICIiLAogICAgICBmaWxlX2NvbnRlbnQyOiAiIiwKICAgICAgaW1hZ2VfcmVzcG9uc2U6ICJObyIsCiAgICAgIHZpZGVvX3Jlc3BvbnNlOiAiTm8iLAogICAgICBmaWxlX3R5cGU6ICIiLAogICAgICBpbWFnZV91cmxzOiBbXSwKICAgICAgaW1hZ2VfdXJsOiAiIiwKICAgICAgbmFtZV9maWxlOiAiIiwKICAgICAgdGVtcF9maWxlX25hbWU6ICIiLAogICAgICBpbWFnZV9lZGl0OiBmYWxzZSwKICAgICAgcXVpbGw6ICIiLAogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlLAogICAgICB2aWRlb19saW5rOiAiIiwKICAgICAgZW1iZF9saW5rOiAiIiwKICAgICAgdmlkZW9fdXJsOiBbXSwKICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgc3Bpbm5lck9uRmlsZURvd25sb2FkOiBmYWxzZSwKICAgICAgLy8gc2VsZWN0X2xpc3Q6IFsnUmVzcG9uc2UnLCdJbnRlbnQnLCdTb3VyY2VzJ10sCiAgICAgIC8vIHNlYXJjaF9ieTogJycsCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIGlmICgKICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSAmJgogICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICkgewogICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIGNvbXBhbnkgbmFtZSBmcm9tIHRoZSBkcm9wZG93biIpOwogICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgIGF4aW9zCiAgICAgIC5wb3N0KAogICAgICAgIGFwaV9jYWxscy5zaG93X2ludGVudF91cmwoKSwKICAgICAgICB7CiAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgc2hvd2ludGVudDogIlRydWUiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICApCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgdGhpcy5pbnRlbnRsaXN0LnB1c2goCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGFbaV0ucmVwbGFjZSh0aGlzLmNvbXBhbnlpZCArICJfIiwgIiIpCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgJCgnW2RhdGEtdG9nZ2xlPSJ0b29sdGlwIl0nKS50b29sdGlwKCk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI2V4YW1wbGVNb2RhbENlbnRlciIpLm9uKCJoaWRkZW4uYnMubW9kYWwiLCBmdW5jdGlvbiAoZSkgewogICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgfSk7CgogICAgdGhpcy5xdWlsbCA9IG5ldyBRdWlsbCgiI2VkaXRvciIsIHsKICAgICAgbW9kdWxlczogewogICAgICAgIHRvb2xiYXI6IFsKICAgICAgICAgIFt7IGhlYWRlcjogWzEsIDIsIGZhbHNlXSB9XSwKICAgICAgICAgIFt7IGZvbnQ6IFtdIH1dLAogICAgICAgICAgWyJib2xkIiwgIml0YWxpYyIsICJ1bmRlcmxpbmUiXSwKICAgICAgICAgIFsiY29kZS1ibG9jayIsICJsaW5rIl0sCiAgICAgICAgICBbeyBhbGlnbjogW10gfV0sCiAgICAgICAgICBbeyBjb2xvcjogW10gfSwgeyBiYWNrZ3JvdW5kOiBbXSB9XSwKICAgICAgICAgIFt7IGxpc3Q6ICJvcmRlcmVkIiB9LCB7IGxpc3Q6ICJidWxsZXQiIH1dLAogICAgICAgIF0sCiAgICAgIH0sCiAgICAgIHRoZW1lOiAic25vdyIsCiAgICAgIHBsYWNlaG9sZGVyOiAiUmVzcG9uc2UiLAogICAgfSk7CiAgICB0aGlzLnF1aWxsLm9uKCJ0ZXh0LWNoYW5nZSIsICgpID0+IHsKICAgICAgdGhpcy4kZW1pdCgKICAgICAgICAiaW5wdXQiLAogICAgICAgIHRoaXMucXVpbGwuZ2V0VGV4dCgpID8gdGhpcy5xdWlsbC5yb290LmlubmVySFRNTCA6ICIiCiAgICAgICk7CiAgICAgIHRoaXMucmVzcG9uc2UgPSB0aGlzLnF1aWxsLmdldFRleHQoKSA/IHRoaXMucXVpbGwucm9vdC5pbm5lckhUTUwgOiAiIjsKICAgIH0pOwogICAgaWYodGhpcy4kcm91dGUucGFyYW1zLm1vZGFsX29wZW5fc3dpdGNoX3RhYil7CiAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgic2hvdyIpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgbG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKSB7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5sb2FkX3F1ZXN0aW9uX3Jlc3BvbnNlX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICByb2xlOiB0aGlzLnVzZXJfcm9sZSwKICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICB0aGlzLnVwZGF0ZV9xbnMocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB0aGlzLmltYWdlX3VybHMgPSByZXNwb25zZS5kYXRhLnNob3dfaW50ZW50X2ZpZWxkLmltYWdlX3VybDsKICAgICAgICAgIHRoaXMudmlkZW9fdXJscyA9IHJlc3BvbnNlLmRhdGEuc2hvd19pbnRlbnRfZmllbGQudmlkZW9fdXJsOwogICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICBheGlvcwogICAgICAgIC5nZXQoYXBpX2NhbGxzLnNvdXJjZV9saXN0X3VybCgpLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5vcHRpb25zID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZG93bmxvYWRfY3N2KCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLnF1ZXN0aW9uX3Jlc3BvbnNlX2NzdigpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdmFyIGEgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgYS5ocmVmID0gcmVzcG9uc2UuZGF0YS5DU1ZfVVJMOwogICAgICAgICAgYS5kb3dubG9hZCA9IHRydWU7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOwogICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgZW1iZWRkZWRfY2hhbmdlKCkgewogICAgICB2YXIgcmVnRXhwID0gL14uKih5b3V0dS5iZVwvfHZcL3x1XC9cd1wvfGVtYmVkXC98d2F0Y2hcP3Y9fFwmdj0pKFteI1wmXD9dKikuKi87CiAgICAgIHZhciBtYXRjaCA9IHRoaXMudmlkZW9fbGluay5tYXRjaChyZWdFeHApOwoKICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdLmxlbmd0aCA9PSAxMSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKG1hdGNoWzJdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gImVycm9yIjsKICAgICAgfQogICAgICB0aGlzLmVtYmRfbGluayA9ICJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8iICsgbWF0Y2hbMl07CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZW1iZF9saW5rKTsKICAgIH0sCiAgICBkb3dubG9hZF9zYW1wbGVfZmlsZSgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdGhpcy5zcGlubmVyT25GaWxlRG93bmxvYWQgPSB0cnVlOwogICAgICBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgICAgdXJsOiBhcGlfY2FsbHMuZmlsZV9kb3dubG9hZCgpLAogICAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIHNhbXBsZV9maWxlOiAiVHJ1ZSIsCiAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgIH0sCiAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAvLyBzd2FsKAogICAgICAgICAgLy8gICAiUGxlYXNlIGRvbid0IGVkaXQgdGhlIGZpbGUgbmFtZSIsCiAgICAgICAgICAvLyAgICJZb3UgY2xpY2tlZCB0aGUgYnV0dG9uISIsCiAgICAgICAgICAvLyAgICJlcnJvciIKICAgICAgICAgIC8vICk7CiAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY29tcGFueW5hbWUpCiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2Iik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uRmlsZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGZpbGVpbnB1dCgpIHsKICAgICAgdGhpcy5maWxlX2xhYmVsID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHZhciBmaWxlX25hbWUgPSB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2IjsKICAgICAgaWYgKHRoaXMuZmlsZV9sYWJlbCAhPSBmaWxlX25hbWUpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAiVXNlcnMgbmVlZCB0byBkb3dubG9hZCB0aGUgSW50ZW50IEZpbGUgZnJvbSAnVXBsb2FkIENTViBGaWxlcycgcG9wLXVwLiBDaGFuZ2VzIHRvIHRoaXMgZmlsZSB3aWxsIGJlIGFjY2VwdGVkIGJ5IHRoZSBzeXN0ZW0uIiwKICAgICAgICAgIHRpbWVyOjMwMDAsCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbGVfY29udGVudCA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dDIoZXZlbnQpIHsKICAgICAgbGV0IGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB0aGlzLmZpbGVfbGFiZWwyID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLm5hbWU7CiAgICAgIHRoaXMuZmlsZV90eXBlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdLnR5cGU7CiAgICAgIC8vIGNvbnNvbGUubG9nKGZpbGVzKQogICAgICAvLyBjb25zb2xlLmxvZyhldmVudC50YXJnZXQuZmlsZXNbMF0pCiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwyICE9IHRoaXMudGVtcF9maWxlX25hbWUpIHsKICAgICAgICB0aGlzLmltYWdlX2VkaXQgPSB0cnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZpbGVfdHlwZSA9PSAiaW1hZ2UvcG5nIikgewogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UoZmlsZXMsIHRoaXMuZmlsZV90eXBlKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVfdHlwZSA9PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlKGZpbGVzLCB0aGlzLmZpbGVfdHlwZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgdGV4dDogIlVzZXJzIG5lZWQgdG8gdXBsb2FkIG9ubHkganBlZy9wbmcgZmlsZXMiLAogICAgICAgICAgdGltZXI6MjUwMCwKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHRoaXMuZmlsZV9jb250ZW50MiA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICBmaWxlX3N1Ym1pdCgpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIHVzZXJfZGV0YWlscyA9IHsKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgfTsKICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeSh1c2VyX2RldGFpbHMpOwogICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtqc29uXSwgewogICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgfSk7CiAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwgPT0gIkNob29zZSBmaWxlIikgewogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZmQuYXBwZW5kKAogICAgICAgICAgImZpbGUiLAogICAgICAgICAgdGhpcy5maWxlX2NvbnRlbnQsCiAgICAgICAgICB0aGlzLmNvbXBhbnluYW1lICsgIkludGVudEZpbGUuY3N2IgogICAgICAgICk7CiAgICAgICAgZmQuYXBwZW5kKCJqc29uIiwgYmxvYik7CiAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KGFwaV9jYWxscy51cGxvYWRfZmlsZV91cmwoKSwgZmQsIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiZmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogIkZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgIHRpbWVyOjIwMDAsCiAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgIC8vICQoJyNmaWxlX3VwbG9hZCcpLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRpbWVyOjIwMDAsCiAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAvLyAkKCcjZmlsZV91cGxvYWQnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAkKCIjZmlsZV91cGxvYWQiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfcXVlc3Rpb25zKGluZGV4KSB7CiAgICAgIC8vIGRlYnVnZ2VyOwogICAgICBpZiAoaW5kZXggPT0gImFsbCIpIHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YTsKICAgICAgICB9IGVsc2UgaWYgKCFldmVudC50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jaGVja2VkID09IHRydWUpIHsKICAgICAgICAgIGxldCB2YWxfaW5kZXggPSB0aGlzLmNoZWNrZWRfbGlzdC5pbmRleE9mKAogICAgICAgICAgICB0aGlzLnNob3dfc3VwZXJhZG1pbl9kYXRhW2luZGV4XQogICAgICAgICAgKTsKICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YVtpbmRleF07CiAgICAgICAgICBpZiAodmFsX2luZGV4ID09IC0xKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGVtcCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSBmYWxzZSkgewogICAgICAgICAgdmFyIHNlbGVjdGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZWxlY3RhbGwiKTsKICAgICAgICAgIGlmIChzZWxlY3RhbGwuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdGVtcCA9IHRoaXMuY2hlY2tlZF9saXN0LmZpbHRlcigocXVlc3Rpb24pID0+IHsKICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLnF1ZXN0aW9uICE9PSBpbmRleDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgLy8gZGVidWdnZXI7CiAgICAgIGlmICh0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgIFN3YWwoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6ICJObyByZXNwb25zZSBzZWxlY3RlZCEhIiwKICAgICAgICAgIHRpbWVyOjIwMDAsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHF1ZXN0aW9ubGlzdCA9IFtdLAogICAgICAgICAgcmVzcG9uc2VsaXN0ID0gW10sCiAgICAgICAgICBpbnRlbnRsaXN0ID0gW10sCiAgICAgICAgICBzb3VyY2VsaXN0ID0gW107CiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmNoZWNrZWRfbGlzdCkgewogICAgICAgICAgcXVlc3Rpb25saXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucXVlc3Rpb24pOwogICAgICAgICAgcmVzcG9uc2VsaXN0LnB1c2godGhpcy5jaGVja2VkX2xpc3RbaV0ucmVzcG9uc2UpOwogICAgICAgICAgc291cmNlbGlzdC5wdXNoKHRoaXMuY2hlY2tlZF9saXN0W2ldLnNvdXJjZSk7CiAgICAgICAgICBpbnRlbnRsaXN0LnB1c2godGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLmNoZWNrZWRfbGlzdFtpXS5pbnRlbnQpOwogICAgICAgIH0KICAgICAgICB0aGlzLmRlbGV0ZV9xbnNfYXBpKHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0LCBpbnRlbnRsaXN0KTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9xdWVzdGlvbihpbmRleCkgewogICAgICBsZXQgcXVlc3Rpb25saXN0ID0gW10sCiAgICAgICAgcmVzcG9uc2VsaXN0ID0gW10sCiAgICAgICAgaW50ZW50bGlzdCA9IFtdLAogICAgICAgIHNvdXJjZWxpc3QgPSBbXTsKICAgICAgcXVlc3Rpb25saXN0LnB1c2godGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YVtpbmRleF0ucXVlc3Rpb24pOwogICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNob3dfc3VwZXJhZG1pbl9kYXRhW2luZGV4XS5xdWVzdGlvbik7CiAgICAgIHJlc3BvbnNlbGlzdC5wdXNoKHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGFbaW5kZXhdLnJlc3BvbnNlKTsKICAgICAgc291cmNlbGlzdC5wdXNoKHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGFbaW5kZXhdLnNvdXJjZSk7CiAgICAgIGludGVudGxpc3QucHVzaCgKICAgICAgICB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGFbaW5kZXhdLmludGVudAogICAgICApOwogICAgICB0aGlzLmRlbGV0ZV9xbnNfYXBpKHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0LCBpbnRlbnRsaXN0KTsKICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICB0aGlzLnNlYXJjaF9pbnRlbnQoKTsKICAgICAgfQogICAgfSwKICAgIHNlYXJjaF9pbnRlbnQoKSB7CiAgICAgIC8vIGlmKHRoaXMuc2VhcmNoX2J5IT0nJyl7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmFkZF9yZXNwb25zZV9pbnRlbnRfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAvLyBzZWFyY2hieTogdGhpcy5zZWFyY2hfYnksCiAgICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIHBhZ2Vfbm86IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnZWNvdW50ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IDE7CiAgICAgICAgICAgICAgdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YSA9IFtdOwogICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnZWNvdW50OwogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5SZXNwb25zZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdFtpXS5SZXNwb25zZSwKICAgICAgICAgICAgICAgICAgc291cmNlOiByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdFtpXS5Tb3VyY2UsCiAgICAgICAgICAgICAgICAgIGludGVudDogcmVzcG9uc2UuZGF0YS5SZXNwb25zZUxpc3RbaV0uSW50ZW50LnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wYW55aWQgKyAiXyIsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgc2hvcnQ6IHJlc3BvbnNlLmRhdGEuUmVzcG9uc2VMaXN0W2ldLlJlc3BvbnNlLnNsaWNlKAogICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgNzAKICAgICAgICAgICAgICAgICAgKS5yZXBsYWNlKC8oPChbXj5dKyk+KS9nLCAiIiksCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFJlc3VsdHMgRm91bmQiKSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJObyBSZXNwb25zZSBGb3VuZCIpOwogICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIC8vICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgLy8gfSwgMjUwMCk7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIkVudGVyIHByb3BlciBkYXRhIGZvciBzZWFyY2hpbmciKTsKICAgICAgfQogICAgICAvLyB9ZWxzZXsKICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlNlbGVjdCBoZWFkZXIgZm9yIHNlYXJjaGluZyIpOwogICAgICAvLyB9CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIC8vIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRoaXMucmVzcG9uc2UgPSAiIjsKICAgICAgLy8gdGhpcy4kZW1pdCgKICAgICAgLy8gICAiaW5wdXQiLAogICAgICAvLyAgICAiIgogICAgICAvLyApOwogICAgICB0aGlzLnF1aWxsLnNldFRleHQoIiIpOwogICAgICB0aGlzLnNvdXJjZSA9ICJXZWIiOwogICAgICB0aGlzLmludGVudHMgPSB0aGlzLmludGVudGxpc3RbMF07CiAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIHRoaXMuaW1hZ2VfdXJsID0gIiI7CiAgICAgIHRoaXMuaW1hZ2VfcmVzcG9uc2UgPSAiTm8iOwogICAgICAodGhpcy52aWRlb19saW5rID0gIiIpLCAodGhpcy5lbWJkX2xpbmsgPSAiIik7CiAgICAgIHRoaXMuZmlsZV9sYWJlbCA9ICJDaG9vc2UgZmlsZSI7CiAgICAgIHRoaXMuZmlsZV9jb250ZW50ID0gIiI7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPSAiIjsKICAgIH0sCiAgICB0cmFpbl9jb252ZXJzYXRpb25fbW9kZWwoKSB7CiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiAiQXJlIFlvdSBTdXJlPyIsCiAgICAgICAgdGV4dDogIllvdSB3YW50IHRvIFRyYWluIFRoZSBNb2RlbD8iLAogICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBDb25maXJtISIsCiAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLAogICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLnRyYWluX2NvbnZlcnNhdGlvbl9tb2RlbHMoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgICAgY29tcGFueV9kZXRhaWxzOiB7CiAgICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09PSA0MDQ2KSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhyZXNwb25zZS5kYXRhLk1TRyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TR19DT0RFID09PSAxMDM0KSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UuZGF0YS5NU0cpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbm90aWZ5X3N1cGVyYWRtaW4oKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGlmICh0aGlzLnNob3dfc3VwZXJhZG1pbl9kYXRhLmxlbmd0aCA+PSAxMCkgewogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLm5vdGlmeV9zdXBlcmFkbWluX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgc3ViamVjdDogIk5vdGlmaWNhdGlvbiB0byB0cmFpbiB0aGUgYm90IiwKICAgICAgICAgICAgICBib2R5OgogICAgICAgICAgICAgICAgdGhpcy5jb21wYW55bmFtZSArCiAgICAgICAgICAgICAgICAiaGFzIHJlcXVlc3RlZCB0byB0cmFpbiB0aGUgbW9kZWwgdG8gaW1wcm92ZSBpbnRlbnQgYWNjdXJhY3kiLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiQSBtYWlsIGhhcyBiZWVuIHNlbnQgdG8geW91ciBlbWFpbCIpIHsKICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygiVGhlIE1vZGVsIGhhcyBiZWVuIG1hcmtlZCB0byBiZSB0cmFpbmVkLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJZb3UgbXVzdCBoYXZlIG1pbmltdW0gMTAgcXVlc3Rpb25zIHRvIHRyYWluIHlvdXIgbW9kZWwiKTsKICAgICAgfQogICAgfSwKICAgIGRlbGV0ZV9xbnNfYXBpKHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0LCBpbnRlbnRsaXN0KSB7CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJBcmUgeW91IHN1cmU/IiwKICAgICAgICB0ZXh0OiAiWW91IHdvbid0IGJlIGFibGUgdG8gcmV2ZXJ0IHRoaXMhIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiWWVzLCBkZWxldGUhISIsCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5tdWx0aXBsZV9kZWxldGVfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcXVlc3Rpb25zX2xpc3Q6IHF1ZXN0aW9ubGlzdCwKICAgICAgICAgICAgICAgIHJlc3BvbnNlX2xpc3Q6IHJlc3BvbnNlbGlzdCwKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9saXN0OiBzb3VyY2VsaXN0LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGludGVudF9saXN0OiBpbnRlbnRsaXN0LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJRdWVyeSBFeGVjdXRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiAiRGVsZXRlZCEiLAogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRleHQ6ICJZb3VyIHJlc3BvbnNlIGhhcyBiZWVuIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgdGltZXI6MjAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICQoImlucHV0OmNoZWNrYm94IikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgICAgICAgICAgICAgIH0sIDI1MDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIlF1ZXN0aW9ucyBub3QgZGVsZXRlZCEhIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVfcW5zKG1lc3NhZ2UpIHsKICAgICAgdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YSA9IFtdOwogICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0KICAgICAgICBtZXNzYWdlLnNob3dfaW50ZW50X2ZpZWxkLmludGVudF9xdWVzdGlvbmxpc3QubGVuZ3RoOwogICAgICAvLyB0aGlzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlKTsKICAgICAgdmFyIHF1ZXN0aW9ubGlzdCwgcmVzcG9uc2VsaXN0LCBzb3VyY2VsaXN0OwogICAgICB2YXIgc2hvd19xdWVzdGlvbmxpc3QsCiAgICAgICAgc2hvd19yZXNwb25zZWxpc3QsCiAgICAgICAgc2hvd19zb3VyY2VsaXN0LAogICAgICAgIHNob3dfaW50ZW50bGlzdDsKICAgICAgLy8gc2hvd19pbWFnZWxpc3Q7CiAgICAgIC8vIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIgfHwgdGhpcy51c2VyX3JvbGUgPT0gIkFkbWluIikgewogICAgICBzaG93X3F1ZXN0aW9ubGlzdCA9IG1lc3NhZ2Uuc2hvd19pbnRlbnRfZmllbGQuaW50ZW50X3F1ZXN0aW9ubGlzdDsKICAgICAgc2hvd19yZXNwb25zZWxpc3QgPSBtZXNzYWdlLnNob3dfaW50ZW50X2ZpZWxkLmludGVudF9yZXNwb25zZWxpc3Q7CiAgICAgIHNob3dfc291cmNlbGlzdCA9IG1lc3NhZ2Uuc2hvd19pbnRlbnRfZmllbGQuaW50ZW50X3NvdXJjZWxpc3Q7CiAgICAgIHNob3dfaW50ZW50bGlzdCA9IG1lc3NhZ2Uuc2hvd19pbnRlbnRfZmllbGQuaW50ZW50X2ludGVudGxpc3Q7CiAgICAgIC8vIHNob3dfaW1hZ2VsaXN0ID0gbWVzc2FnZS5zaG93X2ludGVudF9maWVsZC5pbWFnZV91cmw7CiAgICAgIGZvciAodmFyIGkgaW4gcXVlc3Rpb25saXN0KSB7CiAgICAgICAgdGhpcy5hZGRfc3VwZXJhZG1pbl9kYXRhLnB1c2goewogICAgICAgICAgcXVlc3Rpb246IHF1ZXN0aW9ubGlzdFtpXSwKICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZWxpc3RbaV0sCiAgICAgICAgICBzb3VyY2U6IHNvdXJjZWxpc3RbaV0sCiAgICAgICAgICBpbnRlbnQ6ICIiLAogICAgICAgICAgLy8gaW1hZ2U6c2hvd19pbWFnZWxpc3RbaV0KICAgICAgICB9KTsKICAgICAgfQogICAgICBmb3IgKHZhciBpIGluIHNob3dfcXVlc3Rpb25saXN0KSB7CiAgICAgICAgdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YS5wdXNoKHsKICAgICAgICAgIHF1ZXN0aW9uOiBzaG93X3F1ZXN0aW9ubGlzdFtpXSwKICAgICAgICAgIHJlc3BvbnNlOiBzaG93X3Jlc3BvbnNlbGlzdFtpXSwKICAgICAgICAgIHNvdXJjZTogc2hvd19zb3VyY2VsaXN0W2ldLAogICAgICAgICAgaW50ZW50OiBzaG93X2ludGVudGxpc3RbaV0ucmVwbGFjZSh0aGlzLmNvbXBhbnlpZCArICJfIiwgIiIpLAogICAgICAgICAgc2hvcnQ6IHNob3dfcmVzcG9uc2VsaXN0W2ldLnNsaWNlKDAsIDcwKS5yZXBsYWNlKC8oPChbXj5dKyk+KS9nLCAiIiksCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgLy8gfQogICAgfSwKICAgIGVkaXRfcXVlc3Rpb24oaW5kZXgpIHsKICAgICAgdGhpcy5xdWlsbC5yb290LmlubmVySFRNTCA9IHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGFbaW5kZXhdLnJlc3BvbnNlOwogICAgICB0aGlzLnNvdXJjZSA9IHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGFbaW5kZXhdLnNvdXJjZTsKICAgICAgdGhpcy5pbnRlbnRzID0gdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YVtpbmRleF0uaW50ZW50OwogICAgICBpZiAodGhpcy5pbWFnZV91cmxzW2luZGV4XSAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5pbWFnZV91cmwgPSB0aGlzLmltYWdlX3VybHNbaW5kZXhdOwogICAgICAgIHRoaXMuaW1hZ2VfcmVzcG9uc2UgPSAiWWVzIjsKICAgICAgICB0aGlzLm5hbWVfZmlsZSA9IHRoaXMuaW1hZ2VfdXJsc1tpbmRleF0uc3BsaXQoIi8iKTsKICAgICAgICB0aGlzLnRlbXBfZmlsZV9uYW1lID0gdGhpcy5uYW1lX2ZpbGVbdGhpcy5uYW1lX2ZpbGUubGVuZ3RoIC0gMV07CiAgICAgICAgdGhpcy5maWxlX2xhYmVsMiA9IHRoaXMudGVtcF9maWxlX25hbWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbWFnZV9yZXNwb25zZSA9ICJObyI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudmlkZW9fdXJsW2luZGV4XSAhPSB1bmRlZmluZWQgJiYgdGhpcy52aWRlb191cmxbaW5kZXhdICE9ICIiKSB7CiAgICAgICAgdGhpcy52aWRlb19saW5rID0gdGhpcy52aWRlb191cmxzW2luZGV4XTsKICAgICAgICB0aGlzLnZpZGVvX3Jlc3BvbnNlID0gIlllcyI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52aWRlb19yZXNwb25zZSA9ICJObyI7CiAgICAgIH0KICAgICAgdGhpcy5hZGRfZWRpdCA9ICJmYWxzZSI7CiAgICB9LAogICAgYWRkX2VkaXRfcXVlc3Rpb24oKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHZhciBleGlzdGluZ19pbnRlbnRzID0gdGhpcy5zaG93X3N1cGVyYWRtaW5fZGF0YS5maWx0ZXIoKHF1ZXN0aW9uKSA9PiB7CiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmludGVudCA9PSB0aGlzLmludGVudHM7CiAgICAgIH0pOwogICAgICBpZiAodGhpcy5hZGRfZWRpdCA9PSAidHJ1ZSIpIHsKICAgICAgICBpZiAodGhpcy5yZXNwb25zZSA9PSAiIikgewogICAgICAgICAgdG9hc3RyLndhcm5pbmcoIlBsZWFzZSBlbnRlciBhIHZhbGlkIHJlc3BvbnNlIik7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZXJfb3B0aW9ucyA9PSB0cnVlKSB7CiAgICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIHZhbGlkIG9wdGlvbiIpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5pbnRlbnRzID09IHRydWUpIHsKICAgICAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBpbnRlbnQiKTsKICAgICAgICB9IGVsc2UgaWYgKGV4aXN0aW5nX2ludGVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgdG9hc3RyLndhcm5pbmcoCiAgICAgICAgICAgICJUaGlzIGludGVudCBoYXMgYmVlbiBhbHJlYWR5IGFkZGVkLiBQbGVhc2UgdHJ5IHVzaW5nIGFub3RoZXIgaW50ZW50LiIKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGVfbGFiZWwyID09ICJDaG9vc2UgZmlsZSIpIHsKICAgICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLmFkZF9yZXNwb25zZV9pbnRlbnRfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMucmVzcG9uc2UsCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMuaW50ZW50cywKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IG51bGwsCiAgICAgICAgICAgICAgICBmaWxlX2RhdGE6IG51bGwsCiAgICAgICAgICAgICAgICB2aWRlb19saW5rOiB0aGlzLmVtYmRfbGluaywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSAiIjsKICAgICAgICAgICAgICB0aGlzLmludGVudHMgPSAiIjsKICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VfYXBpID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2VfYXBpID09ICJBZGRlZCBTdWNjZXNzZnVsbHkiKSB7CiAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAgICAgICAiQWxsIHlvdXIgcXVlc3Rpb25zIGFuZCByZXNwb25zZXMgaGF2ZSBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSEhIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6MjUwMCwKICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiSW50ZW50IGFscmVhZHkgZXhpc3QiKSB7CiAgICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDoKICAgICAgICAgICAgICAgICAgICAiVGhpcyBJbnRlbnQgaXMgYWxyZWFkeSB1c2VkLCBraW5kbHkgdXNlIGFueSBvdGhlciBJbnRlbnQiLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjoyNTAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLmFkZF9yZXNwb25zZV9pbnRlbnRfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMucmVzcG9uc2UsCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMuaW50ZW50cywKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBmaWxlX25hbWU6IHRoaXMuZmlsZV9sYWJlbDIsCiAgICAgICAgICAgICAgICBmaWxlX2RhdGE6IHRoaXMuZmlsZV9jb250ZW50MiwKICAgICAgICAgICAgICAgIHZpZGVvX2xpbms6IHRoaXMuZW1iZF9saW5rLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHZhciByZXNwb25zZV9hcGkgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZV9hcGkgPT0gIkFkZGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgICAgICJBbGwgeW91ciBxdWVzdGlvbnMgYW5kIHJlc3BvbnNlcyBoYXZlIGJlZW4gYWRkZWQgc3VjY2Vzc2Z1bGx5ISEiLAogICAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOjIwMDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZV9hcGkgPT0gIkR1cGxpY2F0ZSBpbWFnZSIpIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiRmlsZW5hbWUgYWxyZWFkeSBleGlzdCBraW5kbHkgcmVuYW1lIHRoZSBmaWxlIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGltZXI6MjUwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTXNnID09ICJJbnRlbnQgYWxyZWFkeSBleGlzdCIpIHsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICAgICAgICJUaGlzIEludGVudCBpcyBhbHJlYWR5IHVzZWQsIGtpbmRseSB1c2UgYW55IG90aGVyIEludGVudCIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRpbWVyOjI1MDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfcXVlc3Rpb25zX3Jlc3BvbnNlKCk7CiAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gIiI7CiAgICAgICAgICB0aGlzLnNvdXJjZSA9ICIiOwogICAgICAgICAgdGhpcy5pbnRlbnRzID0gIiI7CiAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwyID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgIHRoaXMuZmlsZV9jb250ZW50MiA9ICIiOwogICAgICAgICAgdGhpcy52aWRlb19saW5rID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuYWRkX2VkaXQgPT0gImZhbHNlIikgewogICAgICAgIGlmICh0aGlzLnJlc3BvbnNlID09ICIiKSB7CiAgICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIGVudGVyIGEgdmFsaWQgcmVzcG9uc2UiKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMudXNlcl9vcHRpb25zID09IHRydWUpIHsKICAgICAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2Ugc2VsZWN0IGEgdmFsaWQgb3B0aW9uIik7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmludGVudHMgPT0gdHJ1ZSkgewogICAgICAgICAgdG9hc3RyLndhcm5pbmcoIlBsZWFzZSBlbnRlciBhIHZhbGlkIGludGVudCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCIjZXhhbXBsZU1vZGFsQ2VudGVyIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5lZGl0X3F1ZXN0aW9uX3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlzRGVsZXRlOiAiRmFsc2UiLAogICAgICAgICAgICAgICAgcmVzcG9uc2U6IHRoaXMucmVzcG9uc2UsCiAgICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgaW50ZW50OiB0aGlzLmNvbXBhbnlpZCArICJfIiArIHRoaXMuaW50ZW50cywKICAgICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBvbGRfaW1hZ2VfbmFtZTogdGhpcy50ZW1wX2ZpbGVfbmFtZSwKICAgICAgICAgICAgICAgIG5ld19pbWFnZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwyLAogICAgICAgICAgICAgICAgaW1hZ2VfZWRpdDogdGhpcy5pbWFnZV9lZGl0LAogICAgICAgICAgICAgICAgaW1hZ2VfYmxvYjogdGhpcy5maWxlX2NvbnRlbnQyLAogICAgICAgICAgICAgICAgdmlkZW9fbGluazogdGhpcy5lbWJkX2xpbmssCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5Nc2cgPT0gIlF1ZXJ5IEV4ZWN1dGVkIFN1Y2Nlc3NmdWxseSIpIHsKICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5zdWNjZXNzKCJZb3VyIEluZm9ybWF0aW9uIFVwZGF0ZWQgU3VjY2Vzc2Z1bGx5ISEiKTsKICAgICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiAiWW91ciBJbmZvcm1hdGlvbiBVcGRhdGVkIFN1Y2Nlc3NmdWxseSEhIiwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3F1ZXN0aW9uc19yZXNwb25zZSgpOwogICAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgICAgLy8gJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gICAkKCIubW9kYWwtY29udGVudCIpLmNzcygiZGlzcGxheSIsICJub25lIik7CiAgICAgICAgICAgICAgICAvLyAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1zZyA9PSAiRHVwbGljYXRlIGltYWdlIikgewogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICJGaWxlbmFtZSBhbHJlYWR5IGV4aXN0IGtpbmRseSByZW5hbWUgdGhlIGZpbGUiLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICB0aW1lcjoyNTAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF9xdWVzdGlvbnNfcmVzcG9uc2UoKTsKICAgICAgICAgICAgICAgICAgJCgiI2ZpbGVfdXBsb2FkIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoIllvdXIgSW5mb3JtYXRpb24gaGFzIG5vdCBiZWVuIFVwZGF0ZWQhISIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgc2V0cGFnaW5hdGlvbihwYWdlX25vKSB7CiAgICAgIHRoaXMucGFnZV9hcnJheSA9IFtdOwogICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IHRoaXMudG90YWxfcGFnZXMpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnRvdGFsX3BhZ2VzIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vIDw9IDQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2Vfbm8gKyAzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDM7IGkgPD0gcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICBpZiAocGFnZSA9PSAwIHx8IHBhZ2UgPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgLy8gdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5sb2FkX3F1ZXN0aW9uX3Jlc3BvbnNlX3VybCgpLAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJvbGU6IHRoaXMudXNlcl9yb2xlLAogICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICB0aGlzLnVwZGF0ZV9xbnMocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5pbWFnZV91cmxzID0gcmVzcG9uc2UuZGF0YS5zaG93X2ludGVudF9maWVsZC5pbWFnZV91cmw7CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgLy8gdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgaWYgKHBhZ2UgPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMuYWRkX3Jlc3BvbnNlX2ludGVudF91cmwoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgaXNzZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgICAvLyBzZWFyY2hieTogdGhpcy5zZWFyY2hfYnksCiAgICAgICAgICAgICAgICBrZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnBhZ2Vjb3VudCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGEgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLlJlc3BvbnNlTGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdlY291bnQ7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEuUmVzcG9uc2VMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd19zdXBlcmFkbWluX2RhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlLmRhdGEuUmVzcG9uc2VMaXN0W2ldLlJlc3BvbnNlLAogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogcmVzcG9uc2UuZGF0YS5SZXNwb25zZUxpc3RbaV0uU291cmNlLAogICAgICAgICAgICAgICAgICAgIGludGVudDogcmVzcG9uc2UuZGF0YS5SZXNwb25zZUxpc3RbaV0uSW50ZW50LnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBhbnlpZCArICJfIiwKICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBzaG9ydDogcmVzcG9uc2UuZGF0YS5SZXNwb25zZUxpc3RbaV0uUmVzcG9uc2Uuc2xpY2UoCiAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgICAgNzAKICAgICAgICAgICAgICAgICAgICApLnJlcGxhY2UoLyg8KFtePl0rKT4pL2csICIiKSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICB9LAp9Owo="},null]}