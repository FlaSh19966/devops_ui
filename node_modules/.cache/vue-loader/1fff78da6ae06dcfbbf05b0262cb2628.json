{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Webhook.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ConversationalFlow/Webhook.vue","mtime":1660042032559},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IHsgZnJlZXplX3BvcnRhbCxzaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwgfSBmcm9tICJAL3BvcnRhbC9taXhpbnMiOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgfSwKICBuYW1lOiAid2ViaG9va19jb21wb25lbnQiLAogIG1peGluczogW2ZyZWV6ZV9wb3J0YWwsc2hvd19zdWJzY3JpcHRpb25fZXhwaXJlZF9zd2FsXSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcGVuY2lsX3N2ZzoKICAgICAgICAnPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNS41NDYiIGhlaWdodD0iMTUuNDYxIiB2aWV3Qm94PSIwIDAgMTUuNTQ2IDE1LjQ2MSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzllOWU5ZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc0Ny44ODggLTM1Ni43NjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTc1OS40MTYsMzU2Ljc2OWEyLjM1OCwyLjM1OCwwLDAsMSwxLjc3Ny42NjJjLjUzNC41MTMsMS4wNzIsMS4wMjUsMS41NjcsMS41NzVhMi4zLDIuMywwLDAsMS0uMDcxLDMuMzI1Yy0yLjczNiwyLjc2LTUuNDk0LDUuNS04LjIzOCw4LjI1MWExLjM4MSwxLjM4MSwwLDAsMS0uNzU4LjI4OGMtLjcxOS4xNzQtMS40MjkuMzc5LTIuMTQ0LjU3Mi0uOTMyLjI1MS0xLjg2Mi41LTIuNzk1Ljc1MS0uNi4xNTgtLjk4OS0uMjEzLS44MzItLjgwN3EuNjg5LTIuNTk1LDEuNDA2LTUuMTgyYTEuMTY0LDEuMTY0LDAsMCwxLC4yODktLjQ4N3E0LjA5MS00LjEwNyw4LjItOC4yQTIuMjY1LDIuMjY1LDAsMCwxLDc1OS40MTYsMzU2Ljc2OVptLTEuOTg5LDIuOTU2LTYuNTQsNi41MzgsMy4wMjUsMy4wMjQsNi41MzgtNi41MzdabTQuMDIzLDIuMTY1Yy4xMTgtLjEzNS4yMjUtLjI2OS4zNDMtLjM5MmExLjEzNCwxLjEzNCwwLDAsMCwwLTEuNzM0Yy0uNDYtLjQ2Ni0uOTI2LS45MjUtMS4zODgtMS4zOWExLjE2NiwxLjE2NiwwLDAsMC0uODYxLS4zNjhjLS41NzgsMC0uODgxLjQtMS4yMTQuNzZabS0xMi4wODQsOC44NjMsMy4yLS44NjMtMi4zMzctMi4zMzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNODEzLjk0Miw0MjIuNmwtLjc4OS0uOCwzLjgyMS0zLjgxOS43ODQuOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01OS42NDggLTU1Ljk0NykiLz48L2c+PC9zdmc+JywKICAgICAgaXNWaXNpYmxlU2VhcmNoQ2xlYXI6IGZhbHNlLAogICAgICBpc0VkaXRXZWJob29rOiBmYWxzZSwKICAgICAgY29tcGFueWlkOiAiIiwKICAgICAgY29tcGFueW5hbWU6ICIiLAogICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICBzZWFyY2hfbmFtZTogIiIsCiAgICAgIHdlYmhvb2tzX2xpc3Q6IFtdLAogICAgICB3ZWJob29rc19uYW1lc19saXN0OiBbXSwKICAgICAgd2ViaG9va19hbHJlYWR5X2V4aXN0czogZmFsc2UsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICBwYWdlbm86ICIiLAogICAgICB0b3RhbF9wYWdlczogbnVsbCwKICAgICAgY3VycmVudF9zZWxlY3RlZF93ZWJob29rOiBbXSwKICAgICAgY3VycmVudF9zZWxlY3RlZF93ZWJob29rX2hpZ2hsaWdodDogIiIsCiAgICAgIHNwaW5uZXJPbjogZmFsc2UsCiAgICAgIHdlYmhvb2tfbmFtZTogIiIsCiAgICAgIHdlYmhvb2tfaWQ6ICIiLAogICAgICB3ZWJob29rX3VybDogIiIsCiAgICAgIGh0dHBfbWV0aG9kOiAiR0VUIiwKICAgICAgaHR0cF9tZXRob2RfdHlwZXM6IFsiR0VUIiwgIlBPU1QiXSwKICAgICAgaGVhZGVyc19saXN0OiBbXSwKICAgICAgaGVhZGVyX3R5cGVzX2xpc3Q6IFsKICAgICAgICAiQWNjZXB0IiwKICAgICAgICAiQWNjZXB0LURhdGV0aW1lIiwKICAgICAgICAiQWNjZXB0LUxhbmd1YWdlIiwKICAgICAgICAiQ29va2llIiwKICAgICAgICAiRnJvbSIsCiAgICAgICAgIkF1dGhvcml6YXRpb24iLAogICAgICAgICJXYXJuaW5nIiwKICAgICAgICAiVXNlci1BZ2VudCIsCiAgICAgICAgIkhvc3QiLAogICAgICAgICJSZWZlcmVyIiwKICAgICAgICAiUHJhZ21hIiwKICAgICAgXSwKICAgICAgYXV0aF90eXBlc19saXN0OlsKICAgICAgICAiQmVhcmVyIFRva2VuIiwKICAgICAgICAiQmFzaWMgQXV0aCIsCiAgICAgICAgIkN1c3RvbSBUb2tlbiIKICAgICAgXSwKICAgICAgbm9fd2ViaG9va3NfcHJlc2VudDogZmFsc2UsCiAgICAgIHJlZ191cmw6CiAgICAgICAgL2h0dHBzOlwvXC9bKHd3d1wuKT9hLXpBLVowLTlAOiUuX1wrfiM9XXsyLDI1Nn1cLlthLXpdezIsNn1cYihbLWEtekEtWjAtOUA6JV9cKy5+Iz8mXC9cLz1dKikvaSwKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgd2ViaG9va19uYW1lKHZhbCl7CiAgICAgIHRoaXMud2ViaG9va19uYW1lID0gdmFsLnJlcGxhY2UoL1teYS16QS1aMC05XyBdL2csICIiKTsKICAgIH0sCiAgICBzZWFyY2hfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoX25hbWUgPT09ICIiKSB7CiAgICAgICAgdGhpcy5sb2FkX3dlYmhvb2soKTsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWFyY2hfbmFtZSAhPT0gIiIpIHsKICAgICAgICB0aGlzLmlzVmlzaWJsZVNlYXJjaENsZWFyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgICB0b2FzdHIud2FybmluZygiUGxlYXNlIHNlbGVjdCBhIGNvbXBhbnkgbmFtZSBmcm9tIHRoZSBkcm9wZG93biIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIHRoaXMubG9hZF93ZWJob29rKCk7CiAgfSwKICBtb3VudGVkKCkgewogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIHRoaXMuZnJlZXplX3BvcnRhbCgpOwogICAgfSwgMTAwMCk7CiAgICAgdGhpcy4kcm9vdC4kb24oIndlYmhvb2tfY29tcG9uZW50RGlzYWJsZWQiLCAoZGF0YSkgPT4gewogICAgICBpZihkYXRhPT09dHJ1ZSl7CiAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbl9leHBpcmVkX3N3YWwoKTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgdm0gPSB0aGlzOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAvLyAkKCdkaXY6aW5wdXQnKS5wcm9wKCdjaGVja2VkJyx0cnVlKTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgJCgnYVtkYXRhLXRhcmdldD0iI3dlYmhvb2ttb2RhbCJdJykub24oJ2NsaWNrJyAsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYodm0uaXNFZGl0V2ViaG9vayA9PSB0cnVlKXsKICAgICAgICB2bS52ZXJpZnlfY2hhbmdlcygpOwogICAgICB9ZWxzZXsKICAgICAgICB2bS5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgICQoIiN3ZWJob29rbW9kYWwiKS5tb2RhbCgnc2hvdycpOwogICAgICB9CiAgICB9KTsKICB9LAogIGNvbXB1dGVkOnsKICAgIGN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9va19oZWFkZXJzKCl7CiAgICAgIGlmKHR5cGVvZih0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9vaykgPT09ICdvYmplY3QnKXsKICAgICAgICBpZihPYmplY3Qua2V5cyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9vaykubGVuZ3RoID4wKXsKICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9vay5oZWFkZXJzX2xpc3QpLmxlbmd0aCA+MCl7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIGlmICh0aGlzLmlzRWRpdFdlYmhvb2spIHsKICAgICAgdGhpcy52ZXJpZnlfY2hhbmdlcygpOwogICAgfSBlbHNlIHsKICAgICAgbmV4dCgpOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgdmFsaWRVUkwodXJsKSB7CiAgICAgIGlmICh0aGlzLnJlZ191cmwudGVzdCh1cmwpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAogICAgcGFzc3dvcmRfdG9nZ2xlKGlkKSB7CiAgICAgIHZhciBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgaWYgKHBhc3N3b3JkLnR5cGUgPT0gInRleHQiKSB7CiAgICAgICAgcGFzc3dvcmQudHlwZSA9ICJwYXNzd29yZCI7CiAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQudHlwZSA9PSAicGFzc3dvcmQiKSB7CiAgICAgICAgcGFzc3dvcmQudHlwZSA9ICJ0ZXh0IjsKICAgICAgfQogICAgfSwKICAgIHdlYmhvb2tfbmFtZV9jaGVja19zcGVjaWFsX2NoYXJhY3RlcnMoZSl7CiAgICAgIGlmICgvXlteYS16QS1aMC05XyBdKiQvLnRlc3QoZS5rZXkpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgdmVyaWZ5X2NoYW5nZXMoKSB7CiAgICAgIFN3YWwoewogICAgICAgIHRpdGxlOiB0aGlzLnRsdCgnd2ViaG9va19hcmVfdV9zdXJlX21zZycpLAogICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX2NoYW5nZXNfaW5fd2ViaG9va19tc2cnKSwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgndmVyaWZ5X2NoYW5nZXNfc2F2ZV9idG4nKSwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiB0aGlzLnRsdCgndmVyaWZ5X2NoYW5nZXNfY2FuY2VsX2J0bicpLAogICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaWYgdHJ1ZSIpOwogICAgICAgICAgdGhpcy5zYXZlX3dlYmhvb2soKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJlbHNlIGZhbHNlIik7CiAgICAgICAgICB0aGlzLmlzRWRpdFdlYmhvb2sgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrX3dlYmhvb2tfbmFtZSgpIHsKICAgICAgaWYgKHRoaXMud2ViaG9va3NfbmFtZXNfbGlzdC5pbmNsdWRlcyh0aGlzLndlYmhvb2tfbmFtZSkpewogICAgICAgIHRoaXMud2ViaG9va19hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgIH1lbHNlIHsKICAgICAgICB0aGlzLndlYmhvb2tfYWxyZWFkeV9leGlzdHMgPSBmYWxzZTsKICAgICAgfQogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgaXNfZXhpc3Q6IHRydWUsCiAgICAgICAgICAgIHdlYmhvb2tfbmFtZTogdGhpcy53ZWJob29rX25hbWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy53ZWJob29rX2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl93ZWJob29rX2lkIikuc3R5bGUuYm9yZGVyID0gbnVsbDsKICAgICAgICAgICAgaWYodGhpcy53ZWJob29rX25hbWUgIT0gIiIpewogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl93ZWJob29rX2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgICAiMXB4IHNvbGlkICMwMGYwMDAiOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuQUxSRUFEWV9FWElTVFNfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMud2ViaG9va19hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl93ZWJob29rX2lkIikuc3R5bGUuYm9yZGVyID0KICAgICAgICAgICAgIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrX3dlYmhvb2tfbmFtZV9lZGl0KCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgaXNfZXhpc3Q6IHRydWUsCiAgICAgICAgICAgIHdlYmhvb2tfbmFtZTogdGhpcy53ZWJob29rX25hbWUsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy53ZWJob29rX2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl93ZWJob29rX2VkaXRfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICAgICAgICBpZih0aGlzLndlYmhvb2tfbmFtZSAhPSAiIil7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX3dlYmhvb2tfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgIjFweCBzb2xpZCAjMDBmMDAwIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkFMUkVBRFlfRVhJU1RTX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50X3NlbGVjdGVkX3dlYmhvb2submFtZSA9PSB0aGlzLndlYmhvb2tfbmFtZSl7CiAgICAgICAgICAgICAgdGhpcy53ZWJob29rX2FscmVhZHlfZXhpc3RzID0gZmFsc2U7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX3dlYmhvb2tfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9bnVsbDsgIAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMud2ViaG9va19hbHJlYWR5X2V4aXN0cyA9IHRydWU7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVudGVyX3dlYmhvb2tfZWRpdF9pZCIpLnN0eWxlLmJvcmRlciA9CiAgICAgICAgICAgICAgIjFweCBzb2xpZCByZWQiOwogICAgICAgICAgICB9CiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJfc2VhcmNoX25hbWUoKSB7CiAgICAgIHRoaXMuc2VhcmNoX25hbWUgPSAiIjsKICAgIH0sCiAgICBjYWxsc2VhcmNoKCkgewogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICBpZih0aGlzLmlzRWRpdFdlYmhvb2spewogICAgICAgICAgdGhpcy52ZXJpZnlfY2hhbmdlcygpCiAgICAgICAgfWVsc2V7CiAgICAgICAgICB0aGlzLnNlYXJjaF93ZWJob29rKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VhcmNoX3dlYmhvb2soKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAiUGxhdGludW0iLAogICAgICAgICAgICAgIGlzX3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICBzZWFyY2hfdGVybTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICBwYWdlX25vOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLldFQkhPT0tfREVUQUlMU19SRUNFSVZFRF9NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgICB0aGlzLndlYmhvb2tzX2xpc3QgPSBbXTsKICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEud2ViaG9va1swXS53ZWJob29rKSB7CiAgICAgICAgICAgICAgICB0aGlzLndlYmhvb2tzX2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEud2ViaG9va1swXS53ZWJob29rW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5zaG93X3dlYmhvb2soMCk7CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgICAgdGhpcy5ub193ZWJob29rc19wcmVzZW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5TRUFSQ0hfV0VCSE9PS19OT1RfRk9VTkRfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnd2ViaG9va19ub3RfZm91bmQnKSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX2ZpZWxkX2Nhbm5vdF9lbXB0eV9tc2cnKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgZWRpdF93ZWJob29rX2RldGFpbHMoKSB7CiAgICAgIGlmICghdGhpcy5pc0VkaXRXZWJob29rKSB7CiAgICAgICAgdGhpcy53ZWJob29rX25hbWUgPSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9vay5uYW1lOwogICAgICAgIHRoaXMud2ViaG9va19pZCA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF93ZWJob29rLmlkOwogICAgICAgIHRoaXMud2ViaG9va191cmwgPSB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9vay51cmw7CiAgICAgICAgdGhpcy5odHRwX21ldGhvZCA9IHRoaXMuY3VycmVudF9zZWxlY3RlZF93ZWJob29rLmh0dHBfbWV0aG9kOwogICAgICAgIHRoaXMuaGVhZGVyc19saXN0ID0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3dlYmhvb2suaGVhZGVyc19saXN0OwogICAgICAgIHRoaXMuaXNFZGl0V2ViaG9vayA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc0VkaXRXZWJob29rID0gZmFsc2U7CiAgICAgICAgdGhpcy5lbXB0eV92YXJpYWJsZSgpOwogICAgICAgIHRoaXMubG9hZF93ZWJob29rKCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja19jdXJyZW50X3dlYmhvb2soaW5kZXgpIHsKICAgICAgdmFyIHJldHVybl92YXIgPSAiIjsKICAgICAgaWYgKAogICAgICAgIHRoaXMud2ViaG9va3NfbGlzdFtpbmRleF0uaWQgPT0gdGhpcy5jdXJyZW50X3NlbGVjdGVkX3dlYmhvb2tfaGlnaGxpZ2h0CiAgICAgICkgewogICAgICAgIHJldHVybl92YXIgKz0gImN1cnJlbnQtYWN0aXZlLXdlYmhvb2siOwogICAgICB9CiAgICAgIHJldHVybiByZXR1cm5fdmFyOwogICAgfSwKICAgIHNob3dfd2ViaG9vayhpbmRleCkgewogICAgICB0aGlzLmlzRWRpdFdlYmhvb2sgPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW50X3NlbGVjdGVkX3dlYmhvb2sgPSB0aGlzLndlYmhvb2tzX2xpc3RbaW5kZXhdOwogICAgICB0aGlzLmN1cnJlbnRfc2VsZWN0ZWRfd2ViaG9va19oaWdobGlnaHQgPSB0aGlzLndlYmhvb2tzX2xpc3RbaW5kZXhdLmlkOwogICAgfSwKICAgIGxvYWRfd2ViaG9vaygpIHsKICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgdGhpcy53ZWJob29rc19saXN0ID0gW107CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX0RFVEFJTFNfUkVDRUlWRURfTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgIC8vIHRoaXMud2ViaG9va3NfbGlzdCA9IHJlc3BvbnNlLmRhdGEud2ViaG9va1swXS53ZWJob29rOwogICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS53ZWJob29rWzBdLndlYmhvb2spIHsKICAgICAgICAgICAgICB0aGlzLndlYmhvb2tzX2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEud2ViaG9va1swXS53ZWJob29rW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLndlYmhvb2tzX25hbWVzX2xpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEud2ViaG9va19uYW1lczsKICAgICAgICAgICAgdGhpcy5zaG93X3dlYmhvb2soMCk7CiAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB0aGlzLm5vX3dlYmhvb2tzX3ByZXNlbnQgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX0RFVEFJTFNfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUpIHsKICAgICAgICAgICAgdGhpcy5ub193ZWJob29rc19wcmVzZW50ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy53ZWJob29rc19saXN0ID0gW10KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5sb2FkX3dlYmhvb2soKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgY3JlYXRlX1VVSUQoKSB7CiAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICB2YXIgdXVpZCA9ICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoCiAgICAgICAgL1t4eV0vZywKICAgICAgICBmdW5jdGlvbiAoYykgewogICAgICAgICAgdmFyIHIgPSAoZHQgKyBNYXRoLnJhbmRvbSgpICogMTYpICUgMTYgfCAwOwogICAgICAgICAgZHQgPSBNYXRoLmZsb29yKGR0IC8gMTYpOwogICAgICAgICAgcmV0dXJuIChjID09ICJ4IiA/IHIgOiAociAmIDB4MykgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgICB9CiAgICAgICk7CiAgICAgIHJldHVybiB1dWlkOwogICAgfSwKICAgIGFkZF90b19oZWFkZXJzX2xpc3QoZnVuYywgaW5kZXgpIHsgIAogICAgICBpZiAoZnVuYyA9PSAiYWRkIikgewogICAgICAgIHRoaXMuaGVhZGVyc19saXN0LnB1c2goewogICAgICAgICAgaGVhZGVyX3R5cGU6ICIiLAogICAgICAgICAgaGVhZGVyX3ZhbHVlczogIiIsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoZnVuYyA9PSAicmVtb3ZlIikgewogICAgICAgIHRoaXMuaGVhZGVyc19saXN0LnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICB3ZWJob29rX2hlYWRlcl90eXBlX2NoYW5nZShoZWFkZXJfdHlwZSwgaW5kZXgpewogICAgICB0aGlzLmhlYWRlcnNfbGlzdFtpbmRleF0uaGVhZGVyX3ZhbHVlcyA9ICIiOwogICAgICBpZihoZWFkZXJfdHlwZSA9PSAnQXV0aG9yaXphdGlvbicpewogICAgICAgIHRoaXMuaGVhZGVyc19saXN0W2luZGV4XS5oZWFkZXJfdmFsdWVzID0ge307CiAgICAgIH0KICAgIH0sCiAgICB3ZWJob29rX2hlYWRlcl9hdXRoX3R5cGVfY2hhbmdlKGF1dGhfdHlwZSwgaW5kZXgpewogICAgICB0aGlzLmhlYWRlcnNfbGlzdFtpbmRleF0uaGVhZGVyX3ZhbHVlcy5hdXRoX3ZhbHVlID0ge30KICAgICAgaWYoYXV0aF90eXBlID09PSAnQmVhcmVyIFRva2VuJyl7CiAgICAgICAgdGhpcy5oZWFkZXJzX2xpc3RbaW5kZXhdLmhlYWRlcl92YWx1ZXMuYXV0aF92YWx1ZSA9ICIiOwogICAgICB9CiAgICB9LAogICAgc2V0X2F1dGhfdmFsdWUoaW5kZXgpewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2bS4kc2V0KHZtLmhlYWRlcnNfbGlzdCwgaW5kZXgsIHZtLmhlYWRlcnNfbGlzdFtpbmRleF0pOwogICAgfSwKICAgIGRlbGV0ZV9zZWxlY3RlZCgpIHsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3dlYmhvb2tfZGV0YWlscygpLCB7CiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgIGlzX2RlbGV0ZTogdHJ1ZSwKICAgICAgICAgICAgd2ViaG9va19pZDogdGhpcy5jaGVja2VkX2xpc3QsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5TVUNDRVNTRlVMX0RCX1FVRVJZX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3dlYmhvb2tfZGVsZXRlX3N1Y2Nlc3NmdWxfbXNnJyksCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlVOU1VDQ0VTU0ZVTF9EQl9PUEVSQVRJT05fTU9ERUxTLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3dlYmhvb2tfaW50ZXJuYWxfc2VydmVyX21zZzInKSwKICAgICAgICAgICAgICAgIHRpbWVyOiAzMDAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuTk9fV0VCSE9PS19EQVRBX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX2ludGVybmFsX3NlcnZlcl9tc2czJyksCiAgICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5sb2FkX3dlYmhvb2soKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX29uZV93ZWJob29rX3RvX2RlbGV0ZScpLAogICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzYXZlX3dlYmhvb2soKSB7CiAgICAgIC8vIE5lZWQgdG8gY2hhbmdlIGxvZ2ljIGlmIE11bHRpcGxlIFdlYmhvb2sgZGV0YWlscyBhcmUgYWNjZXB0ZWQKICAgICAgaWYgKHRoaXMud2ViaG9va19pZCA9PSAiIikgewogICAgICAgIHRoaXMud2ViaG9va19pZCA9IHRoaXMuY3JlYXRlX1VVSUQoKTsKICAgICAgfQogICAgICBpZiAodGhpcy53ZWJob29rX25hbWUgPT0gIiIgfHwgdGhpcy53ZWJob29rX2FscmVhZHlfZXhpc3RzKSB7CiAgICAgICAgU3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndW5pcXVlX3dlYmhvb2tfbmFtZV9tc2cnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiA0MDAwLAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIXRoaXMudmFsaWRVUkwodGhpcy53ZWJob29rX3VybCkpIHsKICAgICAgICBTd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfY29ycmVjdF91cmxfbXNnJyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYoQm9vbGVhbih0aGlzLmhlYWRlcnNfbGlzdC5sZW5ndGggPiAwKSl7CiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuaGVhZGVyc19saXN0Lmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgY29uc3QgaGVhZGVyX3RlbXAgPSB0aGlzLmhlYWRlcnNfbGlzdFtpbmRleF07CiAgICAgICAgICBpZihCb29sZWFuKGhlYWRlcl90ZW1wLmhlYWRlcl90eXBlID09JycpKXsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3NlbGVjdF9oZWFkZXJfdHlwZV9tc2cnKSwKICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZihoZWFkZXJfdGVtcC5oZWFkZXJfdHlwZSAhPSdBdXRob3JpemF0aW9uJyAmJiBCb29sZWFuKGhlYWRlcl90ZW1wLmhlYWRlcl92YWx1ZXMgPT09ICcnKSl7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdzZWxlY3RfaGVhZGVyX3ZhbHVlX21zZycpLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmKGhlYWRlcl90ZW1wLmhlYWRlcl90eXBlID09J0F1dGhvcml6YXRpb24nKXsKICAgICAgICAgICAgaWYoIUJvb2xlYW4oaGVhZGVyX3RlbXAuaGVhZGVyX3ZhbHVlcy5hdXRoX3R5cGUpKXsKICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdzZWxlY3RfYXV0aF90eXBlX21zZycpLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGhlYWRlcl90ZW1wLmhlYWRlcl92YWx1ZXMuYXV0aF90eXBlID09PSAnQmVhcmVyIFRva2VuJyAmJgogICAgICAgICAgICAgIEJvb2xlYW4oaGVhZGVyX3RlbXAuaGVhZGVyX3ZhbHVlcy5hdXRoX3ZhbHVlID09PSAnJykpewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRlcl90b2tlbl92YWx1ZV9tc2cnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9ZWxzZSBpZihoZWFkZXJfdGVtcC5oZWFkZXJfdmFsdWVzLmF1dGhfdHlwZSA9PT0gJ0Jhc2ljIEF1dGgnKXsKICAgICAgICAgICAgICBpZighQm9vbGVhbihoZWFkZXJfdGVtcC5oZWFkZXJfdmFsdWVzLmF1dGhfdmFsdWUuVXNlcm5hbWUpKXsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50ZXJfZW50ZXJfYXV0aF91c2VybmFtZV9tc2cnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZighQm9vbGVhbihoZWFkZXJfdGVtcC5oZWFkZXJfdmFsdWVzLmF1dGhfdmFsdWUuUGFzc3dvcmQpKXsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZW50ZXJfYXV0aF9wYXNzd29yZF9tc2cnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH1lbHNlIGlmKGhlYWRlcl90ZW1wLmhlYWRlcl92YWx1ZXMuYXV0aF90eXBlID09PSAnQ3VzdG9tIFRva2VuJyl7CiAgICAgICAgICAgICAgaWYoIUJvb2xlYW4odGhpcy52YWxpZFVSTChoZWFkZXJfdGVtcC5oZWFkZXJfdmFsdWVzLmF1dGhfdmFsdWUudG9rZW5fdXJsKSkpewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd2YWxpZF90b2tlbl91cmxfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYoIUJvb2xlYW4oaGVhZGVyX3RlbXAuaGVhZGVyX3ZhbHVlcy5hdXRoX3ZhbHVlLmpzb25fZGF0YSkpewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdlbnRlcl9qc29uX2RhdGFfbXNnJyksCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgdGltZXI6IDQwMDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLmpzb25fZGF0YV9jbGFzcyhpbmRleCkgPT09ICdpcy1pbnZhbGlkJyl7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3ZhbGlkX2pzb25fZGF0YV9tc2cnKSwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogNDAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBTd2FsKHsKICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnd2ViaG9va19zdWJtaXRfeW91cl9kZXRhaWxzJyksCiAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgfSk7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgdmFyIHdlYmhvb2tfZGV0YWlscyA9IHt9OwogICAgICB3ZWJob29rX2RldGFpbHMuaWQgPSB0aGlzLndlYmhvb2tfaWQ7CiAgICAgIHdlYmhvb2tfZGV0YWlscy5uYW1lID0gdGhpcy53ZWJob29rX25hbWUucmVwbGFjZSgvXHMrL2csICJfIikudG9Mb2NhbGVMb3dlckNhc2UoKTsKICAgICAgd2ViaG9va19kZXRhaWxzLnVybCA9IHRoaXMud2ViaG9va191cmw7CiAgICAgIHdlYmhvb2tfZGV0YWlscy5odHRwX21ldGhvZCA9IHRoaXMuaHR0cF9tZXRob2Q7CiAgICAgIHdlYmhvb2tfZGV0YWlscy5oZWFkZXJzX2xpc3QgPSB0aGlzLmhlYWRlcnNfbGlzdDsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMuZm9ybV9hdXRvbWF0aW9uX3dlYmhvb2tfZGV0YWlscygpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgIGlzX3NhdmU6IHRydWUsCiAgICAgICAgICB3ZWJob29rX2RldGFpbHM6IHdlYmhvb2tfZGV0YWlscywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICB9LAogICAgICB9CiAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX0RFVEFJTFNfU0FWRURfTU9ERUxTLk1TR19DT0RFICkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3dlYmhvb2tfZGV0YWlsX3NhdmVkJyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZighdGhpcy5pc0VkaXRXZWJob29rKXsKICAgICAgICAgICAgICAkKCIjd2ViaG9va21vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmxvYWRfd2ViaG9vaygpOwogICAgICAgICAgfSBlbHNlIGlmICggcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX05PVF9TQVZFRF9NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICkgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX2ludGVybmFsX3NlcnZlcl9tc2c0JyksCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMubG9hZF93ZWJob29rKCk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBwYWdlX3JlcXVpcmUocGFnZSkgewogICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgIGlmIChwYWdlID09IDAgfHwgcGFnZSA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICBpZiAocGFnZSA9PSAiLi4ucyIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCgxICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIGlmIChwYWdlID09ICIuLi5sIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKHRoaXMudG90YWxfcGFnZXMgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgfQogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMud2ViaG9va3NfbGlzdCA9IFtdOwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuV0VCSE9PS19ERVRBSUxTX1JFQ0VJVkVEX01PREVMUy5NU0dfQ09ERQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy53ZWJob29rc19saXN0ID0gW107CiAgICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsgCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YS53ZWJob29rWzBdLndlYmhvb2spIHsKICAgICAgICAgICAgICAgICAgdGhpcy53ZWJob29rc19saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLndlYmhvb2tbMF0ud2ViaG9va1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNob3dfd2ViaG9vaygwKTsKICAgICAgICAgICAgICAgIHRoaXMud2ViaG9va3NfbmFtZXNfbGlzdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS53ZWJob29rOwogICAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgICAgICB0aGlzLm5vX3dlYmhvb2tzX3ByZXNlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX0RFVEFJTFNfTk9UX0VYSVNUU19NT0RFTFMuTVNHX0NPREUKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIC8vIGFkZCBzd2FsIGhlcmUKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd3ZWJob29rX2ludGVybmFsX3NlcnZlcl9tc2c1JyksCiAgICAgICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRfd2ViaG9vaygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICBpZiAodGhpcy5wYWdlbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYWdlbm8gPT0gIi4uLmwiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgodGhpcy50b3RhbF9wYWdlcyArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHRoaXMucGFnZW5vOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgYXBpX2NhbGxzLmZvcm1fYXV0b21hdGlvbl93ZWJob29rX2RldGFpbHMoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICJQbGF0aW51bSIsCiAgICAgICAgICAgICAgICBpc19zZWFyY2g6IHRydWUsCiAgICAgICAgICAgICAgICBzZWFyY2hfdGVybTogdGhpcy5zZWFyY2hfbmFtZSwKICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy53ZWJob29rc19saXN0ID0gW107CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5XRUJIT09LX0RFVEFJTFNfUkVDRUlWRURfTU9ERUxTLk1TR19DT0RFCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGEgPT0gdW5kZWZpbmVkID8gMCA6IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLndlYmhvb2tbMF0ud2ViaG9vaykgewogICAgICAgICAgICAgICAgICB0aGlzLndlYmhvb2tzX2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEud2ViaG9va1swXS53ZWJob29rW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2hvd193ZWJob29rKDApOwogICAgICAgICAgICAgICAgdGhpcy53ZWJob29rc19uYW1lc19saXN0ID0gcmVzcG9uc2UuZGF0YS5kYXRhLndlYmhvb2s7CiAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuU0VBUkNIX1dFQkhPT0tfTk9UX0ZPVU5EX01PREVMUy5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ3dlYmhvb2tfbm90X2ZvdW5kMScpLAogICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0aW1lcjogMzAwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkX3dlYmhvb2soKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgIHJldHVybiAiIGFjdGl2ZSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgc2VsZWN0ZWRfd2ViaG9vayh3ZWJob29rX2lkKSB7CiAgICAgIGlmICh3ZWJob29rX2lkID09ICJhbGwiKSB7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHZhciB0ZW1wID0gW107CiAgICAgICAgICB0ZW1wID0gdGhpcy53ZWJob29rc19saXN0Lm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICByZXR1cm4gaXRlbS5pZDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNoZWNrZWRfbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAkKCIjd2ViaG9va19jaGVja2JveF8iICsgW2ldKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gW107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChldmVudC50YXJnZXQuY2hlY2tlZCA9PSB0cnVlKSB7CiAgICAgICAgICBsZXQgdmFsX2luZGV4ID0gdGhpcy5jaGVja2VkX2xpc3QuZmlsdGVyKCh3ZWJob29rKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB3ZWJob29rLndlYmhvb2tfaWQgPT0gd2ViaG9va19pZDsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHZhbF9pbmRleC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHdlYmhvb2tfaWQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPT0gZmFsc2UpIHsKICAgICAgICAgIHZhciBzZWxlY3RhbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2VsZWN0YWxsIik7CiAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxlY3RhbGwuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKHdlYmhvb2spID0+IHsKICAgICAgICAgICAgcmV0dXJuIHdlYmhvb2sgIT0gd2ViaG9va19pZDsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSB0ZW1wOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGpzb25fZGF0YV9jbGFzcyhpbmRleCkgewogICAgICBpZihCb29sZWFuKHRoaXMuaGVhZGVyc19saXN0W2luZGV4XS5oZWFkZXJfdmFsdWVzLmF1dGhfdmFsdWUuanNvbl9kYXRhKSl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIEpTT04ucGFyc2UodGhpcy5oZWFkZXJzX2xpc3RbaW5kZXhdLmhlYWRlcl92YWx1ZXMuYXV0aF92YWx1ZS5qc29uX2RhdGEpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiAiaXMtaW52YWxpZCI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZW1wdHlfdmFyaWFibGUoKSB7CiAgICAgIGlmKHRoaXMuaXNFZGl0V2ViaG9vayl7CiAgICAgICAgdGhpcy5lZGl0X3dlYmhvb2tfZGV0YWlscygpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbnRlcl93ZWJob29rX2VkaXRfaWQiKS5zdHlsZS5ib3JkZXIgPSBudWxsOwogICAgICB9CiAgICAgIHRoaXMud2ViaG9va19hbHJlYWR5X2V4aXN0cyA9IGZhbHNlOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW50ZXJfd2ViaG9va19pZCIpLnN0eWxlLmJvcmRlciA9IG51bGw7CiAgICAgIHRoaXMud2ViaG9va19pZCA9ICIiOwogICAgICB0aGlzLndlYmhvb2tfbmFtZSA9ICIiOwogICAgICB0aGlzLndlYmhvb2tfdXJsID0gIiI7CiAgICAgIHRoaXMuaHR0cF9tZXRob2QgPSAiR0VUIjsKICAgICAgdGhpcy5odHRwX21ldGhvZF90eXBlcyA9IFsiR0VUIiwgIlBPU1QiXTsKICAgICAgdGhpcy5oZWFkZXJzX2xpc3QgPSBbXTsKICAgICAgdGhpcy5oZWFkZXJfdHlwZXNfbGlzdCA9IFsKICAgICAgICAiQWNjZXB0IiwKICAgICAgICAiQWNjZXB0LURhdGV0aW1lIiwKICAgICAgICAiQWNjZXB0LUxhbmd1YWdlIiwKICAgICAgICAiQ29va2llIiwKICAgICAgICAiRnJvbSIsCiAgICAgICAgIkF1dGhvcml6YXRpb24iLAogICAgICAgICJXYXJuaW5nIiwKICAgICAgICAiVXNlci1BZ2VudCIsCiAgICAgICAgIkhvc3QiLAogICAgICAgICJSZWZlcmVyIiwKICAgICAgICAiUHJhZ21hIiwKICAgICAgXTsKICAgIH0sCiAgfSwKfTsK"},null]}