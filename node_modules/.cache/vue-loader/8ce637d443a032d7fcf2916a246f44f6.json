{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Dashboard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Dashboard.vue","mtime":1663910265458},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBSZXF1ZXN0Q2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9SZXF1ZXN0Q2hhcnQudnVlIjsKaW1wb3J0IEFyZWFDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0FyZWFDaGFydC52dWUiOwppbXBvcnQgQmlsbGluZ0NoYXJ0IGZyb20gIkAvcG9ydGFsL2NvbXBvbmVudHMvQmlsbGluZ0NoYXJ0LnZ1ZSI7CmltcG9ydCBzd2FsIGZyb20gJ3N3ZWV0YWxlcnQyJzsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBjdXJyZW5jeSBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0N1cnJlbmN5IjsKaW1wb3J0IExpbmVDaGFydCBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0xpbmVDaGFydCI7CmltcG9ydCB7ICBjbG9zZV9tb2RhbCB9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgovL2ltcG9ydCBwYWdlX2d1aWRlIGZyb20gIkAvcG9ydGFsL21peGlucy9wYWdlZ3VpZGUuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgLy9taXhpbnM6IFtwYWdlX2d1aWRlXSwKICBwcm9wczoge30sCiAgICBtaXhpbnM6IFsgY2xvc2VfbW9kYWxdLAogIGNvbXBvbmVudHM6IHsKICAgIFJlcXVlc3RDaGFydCwKICAgIEFyZWFDaGFydCwKICAgIEJpbGxpbmdDaGFydCwKICAgIE11bHRpc2VsZWN0LAogICAgTGluZUNoYXJ0LAogIH0sCiAgbW91bnRlZCgpewogICAgdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yayA9IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW5jeS5sZW5ndGg7IGkrKykgewogICAgICB0aGlzLmN1cnJlbmN5X2xpc3QucHVzaCh7CiAgICAgICAgZGlzcGxheV9uYW1lOgogICAgICAgICAgY3VycmVuY3lbaV0uZW1vamkgKwogICAgICAgICAgIiAiICsKICAgICAgICAgIGN1cnJlbmN5W2ldLmN1cnJlbmN5X2NvZGUgKwogICAgICAgICAgIiAtICIgKwogICAgICAgICAgY3VycmVuY3lbaV0uY3VycmVuY3lfbmFtZSwKICAgICAgICB2YWx1ZTogY3VycmVuY3lbaV0uY3VycmVuY3lfY29kZQogICAgICB9KTsKICAgIH0KICAgIHZhciBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCkKICAgIHRoaXMuY3VycmVudF95ZWFyID0gY3VycmVudFRpbWUuZ2V0RnVsbFllYXIoKTsKICAgIGlmKHRoaXMud2hhdHNhcHBfc3Vic2NyaXB0aW9uID09IHRydWUpewogICAgIHRoaXMuZ2V0X21ldHJpY3NfZGF0YSgpOwogICAgIHRoaXMuZ2V0X21ldHJpY3NfcHJpY2VfZGF0YSgpOwogICAgfQogICAgbGV0IGNoZWNrX2RvbWFpbiA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5kb21haW47CiAgICBsZXQgaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2UgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuaXNfc2V0X2RlZmF1bHRfbGFuZ3VhZ2U7CiAgICAgIGlmKGlzX3NldF9kZWZhdWx0X2xhbmd1YWdlID09IHRydWUgKXsKICAgICAgICAkKCIjYm90X2xhbmd1YWdlX3NldHVwIikubW9kYWwoJ3Nob3cnKTsKICAgICAgfQogICAgdGhpcy4kcm9vdC4kb24oJ2NhbGxfZGFzaGJvYXJkX2RldGFpbHMnLCAoZGF0YSkgPT4gewogICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuZGFzaGJvYXJkX2RldGFpbHMoKTsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bih0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIGlmICgKICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSAmJgogICAgICB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikucm9sZSAmJgogICAgICB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSA9PSAiU3VwZXJBZG1pbiIKICAgICkgewogICAgICB0b2FzdHIud2FybmluZyh0aGlzLnRsdCgnc2VsZWN0X2NvbXBhbnlfbmFtZV9sYWJlbCcpKTsKICAgIH0KICAgIGlmICh0aGlzLnVzZXJfcm9sZSA9PSAiU3VwZXJBZG1pbiIpIHsKICAgICAgaWYgKHRoaXMuJHNlc3Npb24uaGFzKCJDb21wYW55SWQiKSkgewogICAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmhhcygiVXNlckluZm9ybWF0aW9uIikKICAgICAgICA/IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkCiAgICAgICAgOiAiIjsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZQogICAgICAgIDogIiI7CiAgICB9CiAgICB0aGlzLndoYXRzYXBwX3N1YnNjcmlwdGlvbiA9IHRoaXMuJHNlc3Npb24uZ2V0KCJ3aGF0c2FwcF9zdWJzY3JpcHRpb24iKTsKICAgIHRoaXMuZGFzaGJvYXJkX2RldGFpbHMoKTsKICAgIC8vIGF4aW9zCiAgICAvLyAgIC5wb3N0KAogICAgLy8gICAgIGFwaV9jYWxscy5iaWxsaW5nX3VzYWdlX3VybCgpLAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgLy8gICAgICAgbG9hZF9kYXRhX2J5OiAiTGFzdCA3IGRheXMiLAogICAgLy8gICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICB9LAogICAgLy8gICAgIHsKICAgIC8vICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgIH0KICAgIC8vICAgKQogICAgLy8gICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMgPSBbXTsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQgPSBbXTsKICAgIC8vICAgICB0aGlzLlNlY29uZF9jaGFydC5Nc2dFeGNoYW5nZSA9IFtdOwogICAgLy8gICAgIHRoaXMuU2Vjb25kX2NoYXJ0LlRhc2tFeGVjdXRpb24gPSBbXTsKICAgIC8vICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PSAiTm8gRGF0YSBhdmFpbGFibGUiKSB7CiAgICAvLyAgICAgICBidXMuJGVtaXQoCiAgICAvLyAgICAgICAgICJjaGFydCBpcyB1cGRhdGVkIiwKICAgIC8vICAgICAgICAgIlRydWUiLAogICAgLy8gICAgICAgICBbXSwKICAgIC8vICAgICAgICAgW10sCiAgICAvLyAgICAgICAgIFtdLAogICAgLy8gICAgICAgICBbXSwKICAgIC8vICAgICAgICAgdGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlCiAgICAvLyAgICAgICApOwogICAgLy8gICAgIH0gZWxzZSB7CiAgICAvLyAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEpIHsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQubGFiZWxzLnB1c2goaSk7CiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LkNhbGxDb3VudC5wdXNoKHJlc3BvbnNlLmRhdGFbaV0uQ2FsbENvdW50KTsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuTXNnRXhjaGFuZ2UucHVzaChyZXNwb25zZS5kYXRhW2ldLk1zZ0V4Y2hhbmdlKTsKICAgIC8vICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuVGFza0V4ZWN1dGlvbi5wdXNoKAogICAgLy8gICAgICAgICAgIHJlc3BvbnNlLmRhdGFbaV0uVGFza0V4ZWN1dGlvbgogICAgLy8gICAgICAgICApOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgYnVzLiRlbWl0KAogICAgLy8gICAgICAgICAiYmlsbGluZyBjaGFydCBpcyB1cGRhdGVkIiwKICAgIC8vICAgICAgICAgIlRydWUiLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5DYWxsQ291bnQsCiAgICAvLyAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0Lk1zZ0V4Y2hhbmdlLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5UYXNrRXhlY3V0aW9uLAogICAgLy8gICAgICAgICB0aGlzLlNlY29uZF9jaGFydC5sYWJlbHMsCiAgICAvLyAgICAgICAgIHRoaXMuYmFyX2NoYXJ0Ml9kcm9wZG93bl92YWx1ZQogICAgLy8gICAgICAgKTsKICAgIC8vICAgICB9CiAgICAvLyAgIH0pCiAgICAvLyAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICApIHsKICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKICAgIGF4aW9zCiAgICAgIC5wb3N0KAogICAgICAgIGFwaV9jYWxscy5kYXNoYm9hcmRfY2hhcnRfdXJsKCksCiAgICAgICAgewogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICBsb2FkX2RhdGFfYnk6ICJNb250aGx5IGJpbGxpbmcgY3ljbGUiLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgKQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkJJTExJTkdfQ0hBUlQuTVNHX0NPREUpIHsKICAgICAgICAgIHRoaXMudXBkYXRlX2NoYXJ0X2RhdGEocmVzcG9uc2UuZGF0YS5kYXRhKTsKICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnMycpKTsKICAgICAgICB9ZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdG9hc3Q6dHJ1ZSwKICAgICAgICAgICAgdGltZXI6MjUwMAogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIHVwZGF0ZWQoKSB7CiAgICBidXMuJG9uKCJjb21wYW55IGF0dHJpYnV0ZXMgdXBkYXRlZCIsIChkYXRhKSA9PiB7CiAgICAgIGlmIChkYXRhID09ICJUcnVlIikgewogICAgICAgIGJ1cy4kZW1pdCgic2VuZCBjb21wYW55IGF0dHJpYnV0ZXMiKTsKICAgICAgfQogICAgfSk7CiAgICBidXMuJG9uKCJjb21wYW55IG5hbWUgYW5kIGNvbXBhbnkgaWQiLCAoZGF0YTEsIGRhdGEyKSA9PiB7CiAgICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgfSk7CiAgfSwKICBjb21wdXRlZDp7CiAgICB2YWxpZEVtYWlsICgpIHsKICAgICAgaWYodGhpcy5jb250YWN0X3VzX2VtYWlsICE9IG51bGwpewogICAgICAgIGlmICh0aGlzLmVtYWlsX3ZhbGlkaXR5LnRlc3QodGhpcy5jb250YWN0X3VzX2VtYWlsKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLnRsdCgndmFsaWRfZW1haWxfYWRkcl9sYWJlbCcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxpbmVfY2hhcnRfcHJvcHNfbW9udGhseV91c2FnZSgpewogICAgICByZXR1cm4gewogICAgICAgIHhBeGlzTGFiZWw6ICdUaW1lbGluZScsCiAgICAgICAgeUF4aXNMYWJlbDogJ1ZhbHVlJywKICAgICAgICB4S2V5OiAnZGF0ZScsCiAgICAgICAgeUtleTogJ3ZhbHVlJywKICAgICAgICBpbnRlcnZhbDogJ2RheScsCiAgICAgICAgZGF0YTogdGhpcy5tb250aGx5X3VzYWdlX2RhdGEKICAgICAgfQogICAgfSwKICAgIGxpbmVfY2hhcnRfcHJvcHNfYXBwcm94X2NoYXJnZSgpewogICAgICByZXR1cm4gewogICAgICAgIHhBeGlzTGFiZWw6ICdUaW1lbGluZScsCiAgICAgICAgeUF4aXNMYWJlbDogJ3ByaWNlICgkKScsCiAgICAgICAgeEtleTogJ2RhdGUnLAogICAgICAgIHlLZXk6ICd2YWx1ZScsCiAgICAgICAgaW50ZXJ2YWw6ICdkYXknLAogICAgICAgIGRhdGE6IHRoaXMucHJpY2luZ19kYXRhCiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93OiBmYWxzZSwKICAgICAgYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlOiAiTW9udGhseSBiaWxsaW5nIGN5Y2xlIiwKICAgICAgYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3c6ICJNb250aGx5IGJpbGxpbmcgY3ljbGUiLAogICAgICBiYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlOiAiTGFzdCA3IGRheXMiLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBwZXJtaXNzaW9uX2xpc3Q6IFtdLAogICAgICBBUElfZGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgU3VjY2Vzc2Z1bDogW10sCiAgICAgICAgVG90YWw6IFtdLAogICAgICAgIFVuc3VjY2Vzc2Z1bDogW10sCiAgICAgICAgeEF4aXNMYWJlbDogIiIsCiAgICAgIH0sCiAgICAgIFNlY29uZF9jaGFydDogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgQ2FsbENvdW50OiBbXSwKICAgICAgICBNc2dFeGNoYW5nZTogW10sCiAgICAgICAgVGFza0V4ZWN1dGlvbjogW10sCiAgICAgIH0sCiAgICAgIENvbmN1cnJlbnRfVXNlcnNfRGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgZGF0YTogW10sCiAgICAgIH0sCiAgICAgIGNvbmN1cnJlbnRfdXNlcnNfbW9udGg6ICIiLAogICAgICB1c2VyX3JvbGU6IHRoaXMuJHNlc3Npb24uaGFzKCJVc2VySW5mb3JtYXRpb24iKQogICAgICAgID8gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUKICAgICAgICA6ICIiLAogICAgICBpbnRlbnRfY291bnQ6IDUzLAogICAgICBpbnRlbnRfY291bnRfZGlzcGxheTogMCwKICAgICAgZGlzcGxheV9saXN0OiBbXSwKICAgICAgcHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3Q6IFsiSW50ZW50cyIsICJRdWVzdGlvbnMiLCAiUmVzcG9uc2VzIiwgIlRyYWluaW5nIl0sCiAgICAgIGRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3Q6IFsKICAgICAgICAiVmVyaWZ5IFJlc3BvbnNlcyBVbmFuc3dlcmVkIiwKICAgICAgICAiVmVyaWZ5IEJvdCBSZXNwb25zZSIsCiAgICAgICAgIlByb2R1Y3RzIiwKICAgICAgICAiU3lub255bXMiLAogICAgICAgICJBY2NvdW50cyIKICAgICAgXSwKICAgICAgaW5mb19pdGVtX2VudGl0aWVzX2xpc3Q6IFtdLAogICAgICBzdWNjZXNzX2l0ZW1faW5mb19saXN0OiBbIkNoZWNrIEJvdCBSZXNwb25zZSIsIkJvdCBDb25maWd1cmF0aW9uIl0sCiAgICAgIGl0ZW1fbGlzdF9vcmRlcjogWyJkYW5nZXJfaXRlbV9lbnRpdGllc19saXN0IiwgInN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3QiLCAicHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3QiXSwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgcmV0YWlsX3dlYl9mcmFtZXdvcms6dGhpcy4kc2Vzc2lvbi5nZXQoInJldGFpbF93ZWJfZnJhbWV3b3JrIiksCiAgICAgIGN1cnJlbmN5X2NvZGU6ICIiLAogICAgICBjdXJyZW5jeV9saXN0OiBbXSwKICAgICAgZW1haWxfdmFsaWRpdHk6IC9eKFswLTlhLXpBLVpdKFstLlx3XSpbMC05YS16QS1aXSkqQChbMC05YS16QS1aXVstXHddKlswLTlhLXpBLVpdXC4pK1thLXpBLVpdezIsOX0pJC8sCiAgICAgIGNvbnRhY3RfdXNfZW1haWw6JycsCiAgICAgIG1vbnRobHlfdXNhZ2VfZGF0YTpbXSwKICAgICAgcHJpY2luZ19kYXRhOltdLAogICAgICBsaW5lX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlIDonYWxsJywKICAgICAgbGlzdF9vZl95ZWFyOiBbXSwKICAgICAgcHJpY2VfY2hhcnRfZHJvcGRvd25fdmFsdWU6JycsCiAgICAgIGN1cnJlbnRfeWVhcjogJycsCiAgICAgIHdoYXRzYXBwX3N1YnNjcmlwdGlvbjpmYWxzZSwKICAgICAgbm90X2Vub3VnaF9kYXRhOiBmYWxzZSwKICAgICAgaXNfYm90X2xhbmdfc2V0IDogZmFsc2UsCiAgICAgIGNvdW50cnlfbGlzdDogWwogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7rwn4e4IEVuZ2xpc2giLAogICAgICAgICAgdmFsdWU6ICJlbiIsCiAgICAgICAgICBsYW5nOiAiZW5nbGlzaCIKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgIGRpc3BsYXlfbmFtZTogIvCfh6rwn4e4IFNwYW5pc2giLAogICAgICAgIC8vICAgdmFsdWU6ICJlcyIsCiAgICAgICAgLy8gICBsYW5nOiAic3BhbmlzaCIKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh67wn4ezIEhpbmRpIiwKICAgICAgICAgIHZhbHVlOiAiaGkiLAogICAgICAgICAgbGFuZyA6ICJoaW5kaSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7Xwn4e5IFBvcnR1Z3Vlc2UiLAogICAgICAgICAgdmFsdWU6ICJwdCIsCiAgICAgICAgICBsYW5nIDogInBvcnR1Z3Vlc2UiCiAgICAgICAgfQogICAgICBdLAogICAgICBsYW5ndWFnZV9jb2RlOiBudWxsCiAgICAgIC8vdG91cl9ndWlkZV9pY29uOiByZXF1aXJlKCJAL3BvcnRhbC9hc3NldHMvaW1nL2luZm9faWNvbi5zdmciKSwKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyBncmFwaF8yX2Jhcl9jaGFydF9kcm9wZG93bigpIHsKICAgIC8vICAgdGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlOwogICAgLy8gICAvLyBjb25zb2xlLmxvZyh0aGlzLmJhcl9jaGFydDJfZHJvcGRvd25fdmFsdWUpCiAgICAvLyAgIGF4aW9zCiAgICAvLyAgICAgLnBvc3QoCiAgICAvLyAgICAgICBhcGlfY2FsbHMuYmlsbGluZ191c2FnZV91cmwoKSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgLy8gICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgIC8vICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgIGxvYWRfZGF0YV9ieTogdGhpcy5iYXJfY2hhcnQyX2Ryb3Bkb3duX3ZhbHVlLAogICAgLy8gICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICAgIHsKICAgIC8vICAgICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgICB9LAogICAgLy8gICAgICAgfQogICAgLy8gICAgICkKICAgIC8vICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgIC8vICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0LmxhYmVscyA9IFtdOwogICAgLy8gICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuQ2FsbENvdW50ID0gW107CiAgICAvLyAgICAgICB0aGlzLlNlY29uZF9jaGFydC5Nc2dFeGNoYW5nZSA9IFtdOwogICAgLy8gICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuVGFza0V4ZWN1dGlvbiA9IFtdOwogICAgLy8gICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIk5vIERhdGEgYXZhaWxhYmxlIikgewogICAgLy8gICAgICAgfSBlbHNlIHsKICAgIC8vICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhKSB7CiAgICAvLyAgICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQubGFiZWxzLnB1c2goaSk7CiAgICAvLyAgICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuQ2FsbENvdW50LnB1c2gocmVzcG9uc2UuZGF0YVtpXS5DYWxsQ291bnQpOwogICAgLy8gICAgICAgICAgIHRoaXMuU2Vjb25kX2NoYXJ0Lk1zZ0V4Y2hhbmdlLnB1c2gocmVzcG9uc2UuZGF0YVtpXS5Nc2dFeGNoYW5nZSk7CiAgICAvLyAgICAgICAgICAgdGhpcy5TZWNvbmRfY2hhcnQuVGFza0V4ZWN1dGlvbi5wdXNoKAogICAgLy8gICAgICAgICAgICAgcmVzcG9uc2UuZGF0YVtpXS5UYXNrRXhlY3V0aW9uCiAgICAvLyAgICAgICAgICAgKTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAvLyAgICAgICBpZiAoCiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICApIHsKICAgIC8vICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgICB9KTsKICAgIC8vIH0sCiAgICBiYXJfY2hhcnRfZHJvcGRvd24odmFsKSB7CiAgICAgIGlmICh0eXBlb2YodmFsKSA9PSAnb2JqZWN0Jyl7CiAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7CiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID0gdmFsCiAgICAgIH0KICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5kYXNoYm9hcmRfY2hhcnRfdXJsKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBsb2FkX2RhdGFfYnk6IHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuQklMTElOR19DSEFSVC5NU0dfQ09ERSkgewogICAgICAgICAgICB0aGlzLnVwZGF0ZV9jaGFydF9kYXRhKHJlc3BvbnNlLmRhdGEuZGF0YSk7CiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVfY2hhcnRfZGF0YShtZXNzYWdlKSB7CiAgICAgIHRoaXMuQVBJX2RhdGEubGFiZWxzID0gW107CiAgICAgIHRoaXMuQVBJX2RhdGEuU3VjY2Vzc2Z1bCA9IFtdOwogICAgICB0aGlzLkFQSV9kYXRhLlRvdGFsID0gW107CiAgICAgIHRoaXMuQVBJX2RhdGEuVW5zdWNjZXNzZnVsID0gW107CiAgICAgIGlmKCB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTW9udGhseSBiaWxsaW5nIGN5Y2xlJyl7CiAgICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2JpbGxpbmdfY3ljbGUnKTsKICAgICAgfWVsc2UgaWYgKCB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZSA9PSAnTGFzdCA3IGRheXMnKXsKICAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWVfc2hvdyA9IHRoaXMudGx0KCdkYXNoYm9hcmRfbGFzdF9zZXZlbicpOwogICAgICB9ZWxzZSBpZiAoIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID09ICdMYXN0IDMwIGRheXMnKXsKICAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWVfc2hvdyA9IHRoaXMudGx0KCdkYXNoYm9hcmRfbGFzdF8zMCcpOwogICAgICB9ZWxzZSBpZiAoIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlID09ICdMYXN0IDMgbW9udGhzJyl7CiAgICAgICAgdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWVfc2hvdyA9IHRoaXMudGx0KCdkYXNoYm9hcmRfbGFzdF8zX21vbnRoJyk7CiAgICAgIH1lbHNlIGlmICggdGhpcy5iYXJfY2hhcnRfZHJvcGRvd25fdmFsdWUgPT0gJ0xhc3QgOSBtb250aHMnKXsKICAgICAgICB0aGlzLmJhcl9jaGFydF9kcm9wZG93bl92YWx1ZV9zaG93ID0gdGhpcy50bHQoJ2Rhc2hib2FyZF9sYXN0XzlfbW9udGgnKTsKICAgICAgfWVsc2UgewogICAgICAgIHRoaXMuYmFyX2NoYXJ0X2Ryb3Bkb3duX3ZhbHVlX3Nob3cgPSB0aGlzLnRsdCgnZGFzaGJvYXJkX2xhc3RfMTJfbW9udGgnKTsKICAgICAgfQogICAgICBpZiAobWVzc2FnZSA9PSAiTm8gRGF0YSBhdmFpbGFibGUiKSB7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiBtZXNzYWdlKSB7CiAgICAgICAgICB0aGlzLkFQSV9kYXRhLmxhYmVscy5wdXNoKGkpOwogICAgICAgICAgdGhpcy5BUElfZGF0YS5TdWNjZXNzZnVsLnB1c2gobWVzc2FnZVtpXS5TdWNjZXNzZnVsKTsKICAgICAgICAgIHRoaXMuQVBJX2RhdGEuVG90YWwucHVzaChtZXNzYWdlW2ldLlRvdGFsKTsKICAgICAgICAgIHRoaXMuQVBJX2RhdGEuVW5zdWNjZXNzZnVsLnB1c2gobWVzc2FnZVtpXS5VbnN1Y2Nlc3NmdWwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdvX3RvX3BhZ2UocGFnZV9uYW1lKSB7CiAgICAgIGlmIChwYWdlX25hbWUgPT0gIlZlcmlmeSBSZXNwb25zZXMgVW5hbnN3ZXJlZCIpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAiVmVyaWZ5IEJvdCBSZXNwb25zZSIsCiAgICAgICAgICBwYXJhbXM6IHsgbW9kYWxfb3Blbl9zd2l0Y2hfdGFiOiBmYWxzZSB9LAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYocGFnZV9uYW1lID09ICJTeW5vbnltcyIpewogICAgICAgIHN3YWwoewogICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCdkYXNoYm9hcmRfc3dhbF9hbGVydF9tc2cnKSwKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdkYXNoYm9hcmRfdHJhaW5fbW9kZWxfbXNnJyksCiAgICAgICAgICB0eXBlOiAicXVlc3Rpb24iLAogICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogIiMzMDg1ZDYiLAogICAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiB0aGlzLnRsdCgnZGFzaGJvYXJkX3N3YWxfY29uZmlybV9tc2cnKSwKICAgICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICAgIGFsbG93RXNjYXBlS2V5OiBmYWxzZSwKICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgYXBpX2NhbGxzLnRyYWluX2ludGVudF9uZXJfbW9kZWwoKSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgdXBkYXRlX21vZGVsOiB0cnVlLAogICAgICAgICAgICAgICAgICB1cGRhdGVfbW9kZWxfc3RhdHVzOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIndhbnRfbW9kZWxfc3RhdHVzIix0cnVlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ2Rhc2hib2FyZF9pbnRlcm5hbF9zZXJ2ZXJfbXNnJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3NvbWVfZXJyb3JfcGxlYXNlX3RyeV9hZ2FpbicsJ2NvZGUnKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAocGFnZV9uYW1lID09ICJQcm9kdWN0cyIpewogICAgICAgICAgJCgiI3N0b3JlX2NvbmZpZyIpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICB0aGlzLmxvYWRfcHJvZHVjdF9zZXR0aW5ncygpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHBhZ2VfbmFtZT09IkFjY291bnRzIil7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogJ1NldHRpbmdzJyxwYXJhbXM6e1N1YnNjcmlwdGlvbjp0cnVlfQogICAgICAgIH0pCiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogcGFnZV9uYW1lLAogICAgICAgICAgcGFyYW1zOiB7IG1vZGFsX29wZW5fc3dpdGNoX3RhYjogdHJ1ZSB9LAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgaW50ZW50c19jb3VudF9mdW5jdGlvbigpIHsKICAgICAgbGV0IHN0YXJ0VGltZXN0YW1wID0gbnVsbDsKICAgICAgbGV0IGR1cmF0aW9uID0gMjAwMDsKICAgICAgbGV0IGVuZCA9IHRoaXMuaW50ZW50X2NvdW50OwogICAgICBsZXQgc3RhcnQgPSAwOwogICAgICBjb25zdCBzdGVwID0gKHRpbWVzdGFtcCkgPT4gewogICAgICAgIGlmICghc3RhcnRUaW1lc3RhbXApIHN0YXJ0VGltZXN0YW1wID0gdGltZXN0YW1wOwogICAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oKHRpbWVzdGFtcCAtIHN0YXJ0VGltZXN0YW1wKSAvIGR1cmF0aW9uLCAxKTsKICAgICAgICB0aGlzLmludGVudF9jb3VudF9kaXNwbGF5ID0gTWF0aC5mbG9vcigKICAgICAgICAgIHByb2dyZXNzICogKGVuZCAtIHN0YXJ0KSArIHN0YXJ0CiAgICAgICAgKTsKICAgICAgICBpZiAocHJvZ3Jlc3MgPCAxKSB7CiAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXApOwogICAgICAgIH0KICAgICAgfTsKICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwKTsKICAgIH0sCiAgICBsaXN0X2dyb3VwX2R5bmFtaWNfY2xhc3Mocm93KSB7CiAgICAgIGlmICh0aGlzLnByaW1hcnlfaXRlbV9lbnRpdGllc19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImxpc3QtZ3JvdXAtaXRlbS1wcmltYXJ5IjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAibGlzdC1ncm91cC1pdGVtLWRhbmdlciI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pbmZvX2l0ZW1fZW50aXRpZXNfbGlzdC5pbmNsdWRlcyhyb3cpKSB7CiAgICAgICAgcmV0dXJuICJsaXN0LWdyb3VwLWl0ZW0taW5mbyI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdWNjZXNzX2l0ZW1faW5mb19saXN0LmluY2x1ZGVzKHJvdykpIHsKICAgICAgICByZXR1cm4gImxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzIjsKICAgICAgfQogICAgfSwKICAgIGxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJvdykgewogICAgICAvKioKICAgICAgICAqIEBwYXJhbS0gcm93IGRldGVybWluZXMgd2hpY2ggbGlzdCBncm91IHBpdCBiZWxvbmdzIHRvLgogICAgICAgICogQHJldHVybnMtIHRoZSByZXNwZWN0aXZlIGxpc3QgaXRlbSBjb2xvdXIgcHJlZml4ZWQgd2l0aCBhbHBoYWJldCBmb3IgZWFzeSBzb3J0aW5nIGFzIHBlciBvdXIgcmVxdWlyZW1lbnQKICAgICAgKi8KICAgICAgaWYgKHRoaXMucHJpbWFyeV9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiZC1wcmltYXJ5IjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRhbmdlcl9pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYS1kYW5nZXIiOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaW5mb19pdGVtX2VudGl0aWVzX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYi1pbmZvIjsKICAgICAgfSBlbHNlIGlmICh0aGlzLnN1Y2Nlc3NfaXRlbV9pbmZvX2xpc3QuaW5jbHVkZXMocm93KSkgewogICAgICAgIHJldHVybiAiYy1zdWNjZXNzIjsKICAgICAgfQogICAgfSwKICAgIGRpc3BsYXlfbGlzdF9keW5hbWljX2NsYXNzKCkgewogICAgICBpZiAodGhpcy5kaXNwbGF5X2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiAicGFkZGluZzogMjBweCAyNXB4OyI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJwYWRkaW5nOiAxMHB4IDI1cHg7IjsKICAgICAgfQogICAgfSwKICAgIGNvbmZpZ3VyZV9wcm9kdWN0X3NldHRpbmdzKCkgewogICAgICBpZih0aGlzLnZhbGlkRW1haWwgIT0gdHJ1ZSl7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgnZGFzaGJvYXJkX3ZhbGlkX2VtYWlsX3RleHQnKSwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgaWYodGhpcy5jdXJyZW5jeV9jb2RlID09ICcnKXsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdkYXNoYm9hcmRfYmFzZV9jdXJyZW5jeV90ZXh0JyksCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybgogICAgICB9ZWxzZSB7CiAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBpc19lbWFpbF9yZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICBlbWFpbF9yZXF1aXJlZDogewogICAgICAgICAgICAgICAgY29udGFjdF9oZWxwX2VtYWlsOnRoaXMuY29udGFjdF91c19lbWFpbCwKICAgICAgICAgICAgICAgIGJhc2VfY3VycmVuY3k6IHRoaXMuY3VycmVuY3lfY29kZSwKICAgICAgICAgICAgICAgICJzaG9wX3NldHRpbmdzX3NhdmVkIjogdHJ1ZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgICAgICQoIiNzdG9yZV9jb25maWciKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLlNVQ0NFU1NGVUxfREJfUVVFUlkuTVNHX0NPREUpIHsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdkYXNoYm9hcmRfY2hhbmdlc19zYXZlZF90ZXh0JyksCiAgICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgICB0aW1lcjogNDAwMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuZW1wdHlfdmFyaWFibGUoKTsKICAgICAgICAgICAgICB0aGlzLmRhc2hib2FyZF9kZXRhaWxzKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZihyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLk1TR19DT0RFKXsKICAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdkYXNoYm9hcmRfaW50ZXJuYWxfc2VydmVyX2Vycm9yJyksCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnc29tZV9lcnJvcl9vY2N1cnJlZF9tc2cnLCAnY29kZScpKTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGVtcHR5X3ZhcmlhYmxlKCkgewogICAgICB0aGlzLmNvbnRhY3RfdXNfZW1haWwgPSAnJzsKICAgICAgdGhpcy5lbWFpbF9yZXF1aXJlZCA9IGZhbHNlOwogICAgICB0aGlzLmN1cnJlbmN5X2NvZGUgPSAiIjsKICAgIH0sCiAgICBkYXNoYm9hcmRfZGV0YWlscygpewogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgYXhpb3MKICAgICAgLnBvc3QoCiAgICAgICAgYXBpX2NhbGxzLmRhc2hib2FyZF9ib3RfZGV0YWlsc19jb3VudCgpLAogICAgICAgIHsKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgIHBvcnRhbF9sYW5nOiB0aGlzLiRzZXNzaW9uLmdldCgiUHJlZmVycmVkTGFuZ3VhZ2UiKSwKICAgICAgICAgIGlzX2dldDogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgKQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIHRoaXMuZGlzcGxheV9saXN0ID0gW107CiAgICAgICAgdGhpcy5wZXJtaXNzaW9uX2xpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMuJHNlc3Npb24uZ2V0KCJDaGF0Ym90TWVudSIpKSB7CiAgICAgICAgICB0aGlzLnBlcm1pc3Npb25fbGlzdC5wdXNoKAogICAgICAgICAgICB0aGlzLiRzZXNzaW9uLmdldCgiQ2hhdGJvdE1lbnUiKVtpXS5tYWluX21lbnUubmFtZQogICAgICAgICAgKTsKICAgICAgICAgIGZvciAodmFyIGogaW4gdGhpcy4kc2Vzc2lvbi5nZXQoIkNoYXRib3RNZW51IilbaV0uc3ViX21lbnVfbGlzdCkgewogICAgICAgICAgICB0aGlzLnBlcm1pc3Npb25fbGlzdC5wdXNoKAogICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJDaGF0Ym90TWVudSIpW2ldLnN1Yl9tZW51X2xpc3Rbal0ubmFtZQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICB2YXIgdmVyaWZ5X2JvdF9yZXNwb25zZSA9IGZhbHNlLAogICAgICAgICAgc3RvcmVfc2V0dGluZ3MgPSBmYWxzZTsKICAgICAgICAgIGZvciAodmFyIG4gaW4gdGhpcy5wZXJtaXNzaW9uX2xpc3QpIHsKICAgICAgICAgICAgaWYgKHRoaXMucGVybWlzc2lvbl9saXN0W25dID09ICJWZXJpZnkgQm90IFJlc3BvbnNlIikgewogICAgICAgICAgICAgIHZlcmlmeV9ib3RfcmVzcG9uc2UgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRoaXMucGVybWlzc2lvbl9saXN0W25dID09PSAiU3RvcmUiKXsKICAgICAgICAgICAgICBzdG9yZV9zZXR0aW5ncyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEpIHsKICAgICAgICAgICAgbGV0IHB1c2hlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKHZhciBqIGluIHRoaXMucGVybWlzc2lvbl9saXN0KSB7CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PSB0aGlzLnBlcm1pc3Npb25fbGlzdFtqXSkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSB0aGlzLmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSkKICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdmVyaWZ5X2JvdF9yZXNwb25zZSA9PSB0cnVlICYmCiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkgPT0gIlZlcmlmeSBSZXNwb25zZXMgVW5hbnN3ZXJlZCIKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHB1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5saXN0X2JlbG9uZyA9IHRoaXMubGlzdF9ncm91cF9keW5hbWljX3R5cGUocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5KQogICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5X2xpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXSk7CiAgICAgICAgICAgICAgICB2ZXJpZnlfYm90X3Jlc3BvbnNlID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHN0b3JlX3NldHRpbmdzID09IHRydWUgJiYKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSA9PSAiUHJvZHVjdHMiCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0ubGlzdF9iZWxvbmcgPSB0aGlzLmxpc3RfZ3JvdXBfZHluYW1pY190eXBlKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmVudGl0eSkKICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheV9saXN0LnB1c2gocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0pOwogICAgICAgICAgICAgICAgc3RvcmVfc2V0dGluZ3MgPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIXB1c2hlZCl7CiAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09PSAiVHJhaW5pbmciKXsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gdGhpcy5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpCiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKQogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIXB1c2hlZCl7CiAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09PSAiU3lub255bXMiKXsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gdGhpcy5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpCiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKQogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIXB1c2hlZCl7CiAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGFbaV0uZW50aXR5ID09PSAiQWNjb3VudHMiKXsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldLmxpc3RfYmVsb25nID0gdGhpcy5saXN0X2dyb3VwX2R5bmFtaWNfdHlwZShyZXNwb25zZS5kYXRhLmRhdGEuZGF0YVtpXS5lbnRpdHkpCiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlfbGlzdC5wdXNoKHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhW2ldKQogICAgICAgICAgICAgICAgcHVzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmRpc3BsYXlfbGlzdC5zb3J0KChhLGIpID0+IChhLmxpc3RfYmVsb25nID4gYi5saXN0X2JlbG9uZykgPyAxIDogLTEgKQogICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbG9hZF9wcm9kdWN0X3NldHRpbmdzKCkgewogICAgICB0aGlzLmNvbnRhY3RfdXNfZW1haWwgPSAnJzsKICAgICAgdGhpcy5lbWFpbF9yZXF1aXJlZCA9IGZhbHNlOwogICAgICB0aGlzLmN1cnJlbmN5X2NvZGUgPSAiIjsKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICB2YXIgd2ViZnJhbWV3b3JrID0gdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yazsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSAKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLmNvbnRhY3RfdXNfZW1haWwgPSByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10uY29udGFjdF9oZWxwX2VtYWlsOwogICAgICAgICAgICB0aGlzLmVtYWlsX3JlcXVpcmVkID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10ub3JkZXJfcmV0cmlldmFsX29ubHlfZW1haWxfcmVxdWlyZWQ7CiAgICAgICAgICAgIHRoaXMuY3VycmVuY3lfY29kZSA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhW3dlYmZyYW1ld29yayArICdfZGV0YWlscyddLmJhc2VfY3VycmVuY3k7CiAgICAgICAgICB9IGVsc2UgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSl7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgnZGFzaGJvYXJkX2ludGVybmFsX3NlcnZlcl9tc2cxJykpOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCdzb21lX2Vycm9yX29jY3VycmVkX21zZycsJ2NvZGUnKSk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZXRfbWV0cmljc19kYXRhKCl7CiAgICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndoYXRzYXBwX21ldHJpY3MoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgaXNfZ2V0OnRoaXMubGluZV9jaGFydF9kcm9wZG93bl92YWx1ZSwKICAgICAgICAgICAgaXNfZ2V0X2NvbnZlcnNhdGlvbl9tZXRyaWNzOnRydWUsCiAgICAgICAgICAgIHllYXI6IHRoaXMuY3VycmVudF95ZWFyCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU5TVUZGSUNJRU5UX1dIQVRTQVBQX01FVFJJQ1NfREFUQS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdF9lbm91Z2hfZGF0YSA9IHRydWU7CgogICAgICAgICAgICB0aGlzLm1vbnRobHlfdXNhZ2VfZGF0YSA9IFtdOwogICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7CiAgICAgICAgICAgIHRoaXMubW9udGhseV91c2FnZV9kYXRhID1yZXNwb25zZS5kYXRhLmRhdGEuZGF0YTsKCiAgICAgICAgICAgIHRoaXMubm90X2Vub3VnaF9kYXRhID0gZmFsc2U7CiAgICAgICAgICB9ZWxzZSB7CiAgU3dhbCh7CiAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgdHlwZTogImVycm9yIgogIH0pCn0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGdldF9tZXRyaWNzX3ByaWNlX2RhdGEoKXsKICAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMud2hhdHNhcHBfbWV0cmljcygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBpc19nZXQ6J3ByaWNlJywKICAgICAgICAgICAgaXNfZ2V0X2NvbnZlcnNhdGlvbl9tZXRyaWNzOnRydWUsCiAgICAgICAgICAgIHllYXI6IHRoaXMuY3VycmVudF95ZWFyCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlNVRkZJQ0lFTlRfV0hBVFNBUFBfTUVUUklDU19EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgIHRoaXMucHJpY2luZ19kYXRhPSBbXTsKICAgICAgICAgICAgdGhpcy5wcmljaW5nX2RhdGEgPSBbXTsKICAgICAgICAgICAgdGhpcy5ub3RfZW5vdWdoX2RhdGEgPSB0cnVlOwogICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7CiAgICAgIAogICAgICAgICAgICB0aGlzLnByaWNpbmdfZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5kYXRhOwogICAgICAgICAgICB0aGlzLmxpc3Rfb2ZfeWVhciA9IHJlc3BvbnNlLmRhdGEuZGF0YS55ZWFyczsKICAgICAgICAgIH1lbHNlIHsKICBTd2FsKHsKICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICB0eXBlOiAiZXJyb3IiCiAgfSkKfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBsaW5lX2NoYXJ0X2Ryb3Bkb3duKCl7CiAgICAgIHRoaXMubGluZV9jaGFydF9kcm9wZG93bl92YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgICAgdGhpcy5nZXRfbWV0cmljc19kYXRhKCk7CiAgICB9LAogICAgbGluZV9jaGFydF95ZWFyX2Ryb3Bkb3duKCl7CiAgICAgIHRoaXMuY3VycmVudF95ZWFyID0gZXZlbnQudGFyZ2V0LnZhbHVlOwogICAgICB0aGlzLmdldF9tZXRyaWNzX3ByaWNlX2RhdGEoKTsKICAgICAgdGhpcy5nZXRfbWV0cmljc19kYXRhKCk7CiAgICB9LAogICAgc2F2ZV9sYW5ndWFnZV9jaGF0Ym90KCl7CiAgICAgIGlmKHRoaXMubGFuZ3VhZ2VfY29kZSA9PSBudWxsKXsKICAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiAiUGxlYXNlIHNlbGVjdCBsYW5ndWFnZSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGxldCBsYW5ndWFnZSA9IHRoaXMubGFuZ3VhZ2VfY29kZS5sYW5nOwogICAgICBsZXQgbGFuZ19jb2RlID0gdGhpcy5sYW5ndWFnZV9jb2RlLnZhbHVlOwogICAgICBheGlvcy4KICAgICAgICBwb3N0KAogICAgICAgICAgYXBpX2NhbGxzLnBvcnRhbF9sYW5ndWFnZV9kYXRhKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICBjaGF0Ym90X2xhbmd1YWdlX2NvZGU6bGFuZ19jb2RlLAogICAgICAgICAgICBjaGF0Ym90X2xhbmd1YWdlOiBsYW5ndWFnZSwKICAgICAgICAgICAgc2F2ZV9jaGF0Ym90X2xhbmd1YWdlOiB0cnVlLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5MQU5HVUFHRV9VUERBVEVELk1TR19DT0RFKXsKICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgdGV4dDogIkJvdCBMYW5ndWFnZSBVcGRhdGUgU3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCB1c2VyaW5mbyA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKTsKICAgICAgICAgICAgdXNlcmluZm9bImlzX3NldF9kZWZhdWx0X2xhbmd1YWdlIl0gPSBmYWxzZTsKICAgICAgICAgICAgdXNlcmluZm9bImNoYXRib3RfbGFuZ3VhZ2UiXSA9IGxhbmd1YWdlOwogICAgICAgICAgICB1c2VyaW5mb1siY2hhdGJvdF9sYW5ndWFnZV9jb2RlIl0gPSBsYW5nX2NvZGU7CiAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCJVc2VySW5mb3JtYXRpb24iLCB1c2VyaW5mbyk7CiAgICAgICAgICB9ZWxzZSBpZihyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX09QRVJBVElPTi5NU0dfQ09ERSl7CiAgICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiAiVW5hYmxlIHRvIHVwZGF0ZSBCb3QgTGFuZ3VhZ2UiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsb3NlX21vZGFsKCdzYXZlX2xhbmd1YWdlX2NoYXRib3RfYnRuJykKICAgIH0KICB9LAp9Owo="},null]}