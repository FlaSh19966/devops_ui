{"remainingRequest":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/Learning/devops_ui/src/portal/Chatbot/Dashboard/BotOutput/BotConfiguration.vue","mtime":1661252053819},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/Learning/devops_ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgeyBzZXRUaW1lb3V0IH0gZnJvbSAidGltZXJzIjsKaW1wb3J0IGFwaV9jYWxscyBmcm9tICJAL3BvcnRhbC9hcGlfY2FsbHMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKaW1wb3J0IFJlc3BvbnNlQm90IGZyb20gIi4uL0RhdGEgSW5wdXRzL1Jlc3BvbnNlQm90IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgRW1vamlQaWNrZXIgZnJvbSAidnVlLWVtb2ppLXBpY2tlciI7CmltcG9ydCB7IFZ1ZUVkaXRvciB9IGZyb20gInZ1ZTItZWRpdG9yIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQm90Q29uZmlndXJhdGlvbiIsCiAgY29tcG9uZW50czogewogICAgTXVsdGlzZWxlY3QsCiAgICBSZXNwb25zZUJvdCwKICAgIGRyYWdnYWJsZSwKICAgIEVtb2ppUGlja2VyLAogICAgVnVlRWRpdG9yCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaW5wdXQ6ICIiLAogICAgICBzZWFyY2g6ICIiLAogICAgICBvbGRDdXJzb3JQb3NpdGlvbjogbnVsbCwKICAgICAgYmlnX3NwaW5uZXI6IGZhbHNlLAogICAgICBib3RfZ3JlZXRpbmdzOiBbXSwKICAgICAgYm90X2JhY2tncm91bmRfdHlwZTogIm5vbmUiLAogICAgICByZXNldF9pY29uX3BhdGg6IHJlcXVpcmUoIkAvcG9ydGFsL2Fzc2V0cy9pbWcvcmVzZXRfaWNvbi5zdmciKSwKICAgICAgaXNfUHJlbWl1bTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnN1YnNjcmlwdGlvbiwKICAgICAgaXNfbGFuZ3VhZ2U6IHRoaXMuJHNlc3Npb24uZ2V0KCJQcmVmZXJyZWRMYW5ndWFnZSIpLAogICAgICBkZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlOiBbCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLmJ1dHRvbl90aGVtZSIsCiAgICAgICAgICB2YWx1ZTogIiMyNzM2NzkiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcuYm90X3RoZW1lIiwKICAgICAgICAgIHZhbHVlOiAiIzI3MzY3OSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lIiwKICAgICAgICAgIHZhbHVlOiAiIzI3MzY3OSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy51c2VyX3Jlc3BvbnNlX2JnX2NvbG9yIiwKICAgICAgICAgIHZhbHVlOiAiIzI3MzY3OSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy5kZWxpdmVyeV9ub3RlX2NvbG9yIiwKICAgICAgICAgIHZhbHVlOiAiIzI3MzY3OSIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfYmdfY29sb3IiLAogICAgICAgICAgdmFsdWU6ICIjZmZmZmZmIgogICAgICAgIH0sCiAgICAgICAgLy8gewogICAgICAgIC8vICAgbmFtZTogImJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UiLAogICAgICAgIC8vICAgdmFsdWU6ICJ0cnVlIiwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3RfYnV0dG9uc19hbGlnbm1lbnQiLAogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgbmFtZTogIkNlbnRlciIsCiAgICAgICAgICAgIHZhbHVlOiAiY2VudGVyIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9zdHlsaW5nLmhvcml6b250YWxfc3BhY2luZyIsCiAgICAgICAgICB2YWx1ZTogIjMiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X3N0eWxpbmcudmVydGljYWxfc3BhY2luZyIsCiAgICAgICAgICB2YWx1ZTogIjUiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2hlYWRlcl9iYWNrZ3JvdW5kIiwKICAgICAgICAgIHZhbHVlOiAiI2ZmZmZmZiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3RfaGVhZGVyX2FsaWdubWVudCIsCiAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICBuYW1lOiAiQ2VudGVyIiwKICAgICAgICAgICAgdmFsdWU6ICJjZW50ZXIiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2FsaWdubWVudCIsCiAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICBuYW1lOiAiUmlnaHQiLAogICAgICAgICAgICB2YWx1ZTogInJpZ2h0IgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF9ob3Jpem9udGFsX3Bvc2l0aW9uIiwKICAgICAgICAgIHZhbHVlOiAzMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogImJvdF92ZXJ0aWNhbF9wb3NpdGlvbiIsCiAgICAgICAgICB2YWx1ZTogMTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3RfZm9udF9zdHlsZSIsCiAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICBuYW1lOiAiUm9ib3RvIiwKICAgICAgICAgICAgdmFsdWU6ICJSb2JvdG8iCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2ZvbnRfY29sb3Jfc2VuZGVyIiwKICAgICAgICAgIHZhbHVlOiAiI2ZmZmZmZiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJib3RfZm9udF9jb2xvcl9yZWNlaXZlciIsCiAgICAgICAgICB2YWx1ZTogIiMwMDAwMDAiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiYm90X2ZvbnRfY29sb3JfYnV0dG9ucyIsCiAgICAgICAgICB2YWx1ZTogIiNmZmZmZmYiCiAgICAgICAgfQogICAgICBdLAogICAgICBpc19iZ19pbWFnZV9jaGFuZ2VkOiBmYWxzZSwKICAgICAgYm90X2hlYWRlcl9iYWNrZ3JvdW5kOiAiIiwKICAgICAgYm90X2hlYWRlcl9hbGlnbm1lbnQ6IG51bGwsCiAgICAgIGJvdF9mb250X3N0eWxlOiAiIiwKICAgICAgYm90X2ZvbnRfY29sb3Jfc2VuZGVyOiAiIiwKICAgICAgYm90X2ZvbnRfY29sb3JfcmVjZWl2ZXI6ICIiLAogICAgICBib3RfZm9udF9jb2xvcl9idXR0b25zOiAiIiwKICAgICAgYm90X2ZvbnRfb3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJBcmlhbCIsCiAgICAgICAgICB2YWx1ZTogImFyaWFsLHNhbnMtc2VyaWYiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUm9ib3RvIiwKICAgICAgICAgIHZhbHVlOiAiUm9ib3RvIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIk9wZW4gU2FucyIsCiAgICAgICAgICB2YWx1ZTogIk9wZW4gU2FucyIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJUaW1lcyBOZXcgUm9tYW4iLAogICAgICAgICAgdmFsdWU6ICJUaW1lcyBOZXcgUm9tYW4iCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiR2VvcmdpYSIsCiAgICAgICAgICB2YWx1ZTogIkdlb3JnaWEiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiTWljcm9zb2Z0IEpoZW5nSGVpIiwKICAgICAgICAgIHZhbHVlOiAiJ01pY3Jvc29mdCBKaGVuZ0hlaScsIFNhbnMtc2VyaWYiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiTWVycml3ZWF0aGVyIiwKICAgICAgICAgIHZhbHVlOiAiJ01lcnJpd2VhdGhlcicsIFNhbnMtc2VyaWYiCiAgICAgICAgfQogICAgICBdLAogICAgICBib3RfaG9yaXpvbnRhbF9wb3NpdGlvbjogMzAsCiAgICAgIGJvdF92ZXJ0aWNhbF9wb3NpdGlvbjogMTIsCiAgICAgIGJvdF9hbGlnbm1lbnQ6IHsKICAgICAgICB2YWx1ZTogInJpZ2h0IiwKICAgICAgICBuYW1lOiAiUmlnaHQiCiAgICAgIH0sCiAgICAgIGJvdF9hbGlnbm1lbnRfb3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJMZWZ0IiwKICAgICAgICAgIHZhbHVlOiAibGVmdCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHZhbHVlOiAicmlnaHQiLAogICAgICAgICAgbmFtZTogIlJpZ2h0IgogICAgICAgIH0KICAgICAgXSwKICAgICAgYm90X2hlYWRlcl9hbGlnbm1lbnRfb3B0aW9uczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJDZW50ZXIiLAogICAgICAgICAgdmFsdWU6ICJjZW50ZXIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiTGVmdCIsCiAgICAgICAgICB2YWx1ZTogImxlZnQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogInJpZ2h0IiwKICAgICAgICAgIG5hbWU6ICJSaWdodCIKICAgICAgICB9CiAgICAgIF0sCiAgICAgIGJvdF9idXR0b25zX2FsaWdubWVudF9vcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgbmFtZTogIkNlbnRlciIsCiAgICAgICAgICB2YWx1ZTogImNlbnRlciIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJMZWZ0IiwKICAgICAgICAgIHZhbHVlOiAiZmxleC1zdGFydCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHZhbHVlOiAiZmxleC1lbmQiLAogICAgICAgICAgbmFtZTogIlJpZ2h0IgogICAgICAgIH0KICAgICAgXSwKICAgICAgYm90X2J1dHRvbnNfYWxpZ25tZW50OiB7fSwKICAgICAgaW1hZ2VfZmlsZV8yOiBudWxsLAogICAgICBpbWFnZV9maWxlXzM6IG51bGwsCiAgICAgIGltYWdlX2ZpbGVfNDogbnVsbCwKICAgICAgaW1hZ2VfZmlsZV81OiBudWxsLAogICAgICB3aWRnZXRfYnV0dG9uc19kZXRhaWxzOiBbXSwKICAgICAgZmlsZV9sYWJlbDogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbF8yOiAiQ2hvb3NlIGZpbGUiLAogICAgICBmaWxlX2xhYmVsXzM6ICJDaG9vc2UgZmlsZSIsCiAgICAgIGZpbGVfbGFiZWxfNDogIkNob29zZSBmaWxlIiwKICAgICAgZmlsZV9sYWJlbF81OiAiQ2hvb3NlIGZpbGUiLAogICAgICBib3Rfc3R5bGluZzogewogICAgICAgIGJvdF90aGVtZTogIiIsCiAgICAgICAgYnV0dG9uX2JvcmRlcl90aGVtZTogIiIsCiAgICAgICAgdXNlcl9yZXNwb25zZV9iZ19jb2xvcjogIiIsCiAgICAgICAgYm90X3Jlc3BvbnNlX2JnX2NvbG9yOiAiIiwKICAgICAgICBkZWxpdmVyeV9ub3RlX2NvbG9yOiAiIiwKICAgICAgICBidXR0b25fdGhlbWU6ICIiLAogICAgICAgIGhvcml6b250YWxfc3BhY2luZzogIiIsCiAgICAgICAgdmVydGljYWxfc3BhY2luZzogIiIsCiAgICAgICAgaXNfcG93ZXJlZF9ieV9jZW5zZTogdHJ1ZSwKICAgICAgICBib3Rfb3Blbl9ieV9kZWZhdWx0OiBmYWxzZSwKICAgICAgICBib3Rfc2hvd25fb25fd2Vic2l0ZTogZmFsc2UsCiAgICAgICAgc2hvd19ib3RfaGlzdG9yeTogdHJ1ZSwKICAgICAgICBpc19jb25mdXNpb25fbXNnOiAiIgogICAgICB9LAogICAgICBpbnRlbnRsaXN0OiBbXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgbG9hZF9ib3RfcHJldmlldzogZmFsc2UsCiAgICAgIGRyYWdfYnV0dG9uczogZmFsc2UsCiAgICAgIGRyYWdfZ3JlZXRpbmdzOiBmYWxzZSwKICAgICAgZGVmYXVsdF9yZXRhaWxfZ3JlZXRpbmdzOiBbIi9vcmRlcl9yZXR1cm4iLCAib3JkZXJfcmV0dXJuIl0sCiAgICAgIHZlcmlmeV9ib3Rfc2V0dGluZ3M6IFtdLAogICAgICB2ZXJpZnlfY2hlY2s6IGZhbHNlLAogICAgICBncmVldGluZ3Nfa2V5OiAwLAogICAgICBidXR0b25zX2tleTogMCwKICAgICAgY3VzdG9tVG9vbGJhcjogWwogICAgICAgIFsiYm9sZCIsICJpdGFsaWMiLCAidW5kZXJsaW5lIl0sCiAgICAgICAgW3sgY29sb3I6IFtdIH0sIHsgYmFja2dyb3VuZDogW10gfV0sCiAgICAgICAgW3sgbGlzdDogIm9yZGVyZWQiIH0sIHsgbGlzdDogImJ1bGxldCIgfV0sCiAgICAgICAgWyJsaW5rIl0KICAgICAgXSwKICAgICAgd2lkZ2V0X2ljb25fdHlwZTogIm5vbmUiLAogICAgICBkZWZhdWxfd2lkZ2V0X2ljb24gOiB0cnVlLAogICAgICBsYW5ndWFnZV9jb2RlOm51bGwsCiAgICAgIGNvdW50cnlfbGlzdDogWwogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7rwn4e4IEVuZ2xpc2giLAogICAgICAgICAgdmFsdWU6ICJlbiIsCiAgICAgICAgICBsYW5nOiAiZW5nbGlzaCIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh67wn4ezIEhpbmRpIiwKICAgICAgICAgIHZhbHVlOiAiaGkiLAogICAgICAgICAgbGFuZyA6ICJoaW5kaSIKICAgICAgICB9LAogICAgICAgIC8vIHsKICAgICAgICAvLyAgIGRpc3BsYXlfbmFtZTogIvCfh6rwn4e4IFNwYW5pc2giLAogICAgICAgIC8vICAgdmFsdWU6ICJlcyIsCiAgICAgICAgLy8gICBsYW5nOiAic3BhbmlzaCIKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIGRpc3BsYXlfbmFtZTogIvCfh7Xwn4e5IFBvcnR1Z3Vlc2UiLAogICAgICAgICAgdmFsdWU6ICJwdCIsCiAgICAgICAgICBsYW5nIDogInBvcnR1Z3Vlc2UiCiAgICAgICAgfQogICAgICBdLAogICAgfTsKICB9LAogIHByb3BzOiB7CiAgICBmcm9tX3NldHVwOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgYm90X2JhY2tncm91bmRfdHlwZShuZXdWYWwsIG9sZFZhbCkgewogICAgICBpZiAobmV3VmFsID09PSAibm9uZSIpIHsKICAgICAgICB0aGlzLmZpbGVfbGFiZWxfMyA9ICJDaG9vc2UgRmlsZSI7CiAgICAgICAgdGhpcy5pbWFnZV9maWxlXzMgPSBudWxsOwogICAgICAgIHRoaXMuaXNfYmdfaW1hZ2VfY2hhbmdlZCA9IHRydWU7CiAgICAgICAgLy8gdGhpcy5vbGRfaW1hZ2VfbmFtZV8zID0gbnVsbDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMyIpLnZhbHVlID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICB3aWRnZXRfaWNvbl90eXBlKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIGlmIChuZXdWYWwgPT0gIm5vbmUiKSB7CiAgICAgICAgdGhpcy5kZWZhdWxfd2lkZ2V0X2ljb24gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGVmYXVsX3dpZGdldF9pY29uID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnJvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIHRoaXMuY29tcGFueWlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlJZCIpOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgIH0KICAgIHRoaXMuZ2V0X2ludGVudHMoKTsKICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGJvdF9hbGlnbm1lbnRfdGV4dCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm90X2FsaWdubWVudC5uYW1lOwogICAgfSwKICAgIHNldHVwX2NzcygpIHsKICAgICAgaWYgKHRoaXMuZnJvbV9zZXR1cCA9PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICItLWRhc2gtY29udC1tYXJnaW4iOiAiMHB4IiwKICAgICAgICAgICItLWRhc2gtY29udC1wYWRkaW5nIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtbWFyZ2luIjogIjBweCIsCiAgICAgICAgICAiLS1jb250YWluZXItZmx1aWQtcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1ib3JkZXIiOiAibm9uZSIsCiAgICAgICAgICAiLS1jYXJkLWJvZHktcGFkZGluZyI6ICIwcHgiLAogICAgICAgICAgIi0tY2FyZC1oZWFkZXItcGFkZGluZyI6ICIyMHB4IDBweCIKICAgICAgICB9OwogICAgICB9CiAgICB9LAogICAgZHJhZ09wdGlvbnNHcmVldGluZ3MoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYW5pbWF0aW9uOiAyMDAsCiAgICAgICAgZ3JvdXA6ICJkZXNjcmlwdGlvbiIsCiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlLAogICAgICAgIGdob3N0Q2xhc3M6ICJnaG9zdCIsCiAgICAgICAgc2Nyb2xsU2Vuc2l0aXZpdHk6IDIwMCwKICAgICAgICBmb3JjZUZhbGxiYWNrOiB0cnVlCiAgICAgIH07CiAgICB9LAogICAgZHJhZ09wdGlvbnNCdXR0b25zKCkgewogICAgICByZXR1cm4gewogICAgICAgIGFuaW1hdGlvbjogMjAwLAogICAgICAgIGdyb3VwOiAiZGVzY3JpcHRpb24iLAogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgICBnaG9zdENsYXNzOiAiZ2hvc3QiLAogICAgICAgIHNjcm9sbFNlbnNpdGl2aXR5OiAyMDAsCiAgICAgICAgZm9yY2VGYWxsYmFjazogdHJ1ZQogICAgICB9OwogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgICQoIiNwcmV2aWV3X2JvdF92aXNpYmxlIikub24oInNob3cuYnMubW9kYWwiLCAoKSA9PiB7CiAgICAgIHRoaXMubG9hZF9ib3RfcHJldmlldyA9IHRydWU7CiAgICB9KTsKICAgICQoIiNwcmV2aWV3X2JvdF92aXNpYmxlIikub24oImhpZGUuYnMubW9kYWwiLCAoKSA9PiB7CiAgICAgIHRoaXMubG9hZF9ib3RfcHJldmlldyA9IGZhbHNlOwogICAgfSk7CiAgICB0aGlzLiRyb290LiRlbWl0KCJjaGFuZ2Vfc2lkZWJhcl9tYWluX21lbnUiLCAiU2ltdWxhdGUgSW50ZXJhY3Rpb24iKTsKICAgIHRoaXMubGFuZ3VhZ2VfY29kZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jaGF0Ym90X2xhbmd1YWdlCiAgICBpZih0aGlzLmxhbmd1YWdlX2NvZGUgIT0gdW5kZWZpbmVkIHx8IHRoaXMubGFuZ3VhZ2VfY29kZSAhPSAiIiB8fCB0aGlzLmxhbmd1YWdlX2NvZGUgIT0gbnVsbCl7CiAgICAgIHRoaXMubGFuZ3VhZ2VfY29kZSA9IHRoaXMuY291bnRyeV9saXN0LmZpbmQoY2w9PnsKICAgICAgICAgIHJldHVybiBjbC5sYW5nID09IHRoaXMubGFuZ3VhZ2VfY29kZTsKICAgICAgfSkKICAgIH1lbHNlewogICAgICB0aGlzLmxhbmd1YWdlX2NvZGUgPSB0aGlzLmNvdW50cnlfbGlzdC5maW5kKGNsPT57CiAgICAgICAgICByZXR1cm4gJ2VuZ2xpc2gnID09IHRoaXMubGFuZ3VhZ2VfY29kZTsKICAgICAgfSkKICAgIH0KICB9LAogIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciBjaGVjayA9IGZhbHNlOwogICAgaWYgKHRoaXMudmVyaWZ5X2NoZWNrKSB7CiAgICAgIGlmICgKICAgICAgICAodGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJnSW1hZ2VOYW1lID09IHRoaXMuZmlsZV9sYWJlbF8zIHx8CiAgICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQmdJbWFnZU5hbWUgPT0gIiIpICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEZvbnQuRm9udENvbG9yQnV0dG9ucyA9PQogICAgICAgICAgdGhpcy5ib3RfZm9udF9jb2xvcl9idXR0b25zICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEZvbnQuRm9udENvbG9yUmVjZWl2ZXIgPT0KICAgICAgICAgIHRoaXMuYm90X2ZvbnRfY29sb3JfcmVjZWl2ZXIgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90Rm9udC5Gb250Q29sb3JTZW5kZXIgPT0KICAgICAgICAgIHRoaXMuYm90X2ZvbnRfY29sb3Jfc2VuZGVyICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdEZvbnQuRm9udFN0eWxlID09IHRoaXMuYm90X2ZvbnRfc3R5bGUgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90SW1hZ2VOYW1lID09IHRoaXMuZmlsZV9sYWJlbF8yICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdE9wZW5CeURlZmF1bHQgPT0KICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X29wZW5fYnlfZGVmYXVsdCAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Cb3RTaG93bk9uV2Vic2l0ZSA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3Rfc2hvd25fb25fd2Vic2l0ZSAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5Jc1Bvd2VyZWRCeUNlbnNlID09CiAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90U3R5bGluZy52YWx1ZSA9PQogICAgICAgICAgdGhpcy5ib3RfYnV0dG9uc19hbGlnbm1lbnQudmFsdWUgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90VGhlbWUgPT0gdGhpcy5ib3Rfc3R5bGluZy5ib3RfdGhlbWUgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuVXNlclJlc3BvbnNlQmdDb2xvciA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy51c2VyX3Jlc3BvbnNlX2JnX2NvbG9yICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJvdFJlc3BvbnNlQmdDb2xvciA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfYmdfY29sb3IgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuRGVsaXZlcnlOb3RlQ29sb3IgPT0KICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuZGVsaXZlcnlfbm90ZV9jb2xvciAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5CdXR0b25Cb3JkZXJUaGVtZSA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJ1dHRvblN0eWxpbmcuaG9yaXpvbnRhbCA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmcgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQnV0dG9uU3R5bGluZy52ZXJ0aWNhbCA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy52ZXJ0aWNhbF9zcGFjaW5nICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkJ1dHRvblRoZW1lID09IHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLkhlYWRlclN0eWxpbmcudmFsdWUgPT0KICAgICAgICAgIHRoaXMuYm90X2hlYWRlcl9hbGlnbm1lbnQudmFsdWUgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuSGVhZGVyVGhlbWUgPT0gdGhpcy5ib3RfaGVhZGVyX2JhY2tncm91bmQgJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuSW1hZ2VOYW1lID09IHRoaXMuZmlsZV9sYWJlbCAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5XaWRnZXRQb3NpdGlvbi52ZXJ0aWNhbCA9PQogICAgICAgICAgdGhpcy5ib3RfdmVydGljYWxfcG9zaXRpb24gJiYKICAgICAgICB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuV2lkZ2V0UG9zaXRpb24uaG9yaXpvbnRhbCA9PQogICAgICAgICAgdGhpcy5ib3RfaG9yaXpvbnRhbF9wb3NpdGlvbiAmJgogICAgICAgIHRoaXMudmVyaWZ5X2JvdF9zZXR0aW5ncy5TaG93Qm90SGlzdG9yeSA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5zaG93X2JvdF9oaXN0b3J5ICYmCiAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzLmNvbmZ1c2lvbl9tc2cudGV4dCA9PQogICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5pc19jb25mdXNpb25fbXNnLnRleHQKICAgICAgKSB7CiAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGlmIChjaGVjaykgewogICAgICBTd2FsKHsKICAgICAgICB0aXRsZTogdGhpcy50bHQoInN3YWxfYXJlX3Vfc3VyZV90ZXh0IiksCiAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfY29uZmlybV90ZXh0IiksCiAgICAgICAgdHlwZTogdGhpcy50bHQoImFsZXJ0X3dhcm5pbmdfdGV4dCIpLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgY2FuY2VsQnV0dG9uQ29sb3I6ICIjZDMzIiwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfc3dhbF9zYXZlX2J0biIpLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX3N3YWxfY2FuY2VsX2J0biIpCiAgICAgIH0pLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICBpZiAocmVzdWx0LnZhbHVlKSB7CiAgICAgICAgICB0aGlzLnVwbG9hZF9pbWFnZSgpOwogICAgICAgICAgdGhpcy5zdWJtaXRfZ3JlZXRpbmdzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5leHQoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgbmV4dCgpOwogICAgfQogIH0sCiAgZGlyZWN0aXZlczogewogICAgZm9jdXM6IHsKICAgICAgaW5zZXJ0ZWQoZWwpIHsKICAgICAgICBlbC5mb2N1cygpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBncmVldGluZ19lbW9qaV9vZmYoaWQpIHsKICAgICAgJChgI2Vtb2ppXyR7aWR9YCkudG9nZ2xlQ2xhc3MoInZpc2libGVfZW1vamkiKTsKICAgIH0sCiAgICBncmVldGluZ19lbW9qaV9vbihpZCkgewogICAgICAkKGAjZW1vamlfJHtpZH1gKS50b2dnbGVDbGFzcygidmlzaWJsZV9lbW9qaSIpOwogICAgfSwKICAgIGJ1dHRvbl9lbW9qaV9vZmYoaWQpIHsKICAgICAgJChgI2Vtb2ppX3RpdGxlXyR7aWR9YCkudG9nZ2xlQ2xhc3MoInZpc2libGVfZW1vamlfYnRuX3RpdGxlIik7CiAgICB9LAogICAgYnV0dG9uX2Vtb2ppX29uKGlkKSB7CiAgICAgICQoYCNlbW9qaV90aXRsZV8ke2lkfWApLnRvZ2dsZUNsYXNzKCJ2aXNpYmxlX2Vtb2ppX2J0bl90aXRsZSIpOwogICAgfSwKICAgIGFwcGVuZChlbW9qaSwgaWQpIHsKICAgICAgLy8gZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgLy8gICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmlkID09PSBpZCkgewogICAgICAvLyAgICAgdmFyIGN1cnNvclBvcyA9ICQoIiMiICsgaWQpLnByb3AoInNlbGVjdGlvblN0YXJ0Iik7CiAgICAgIC8vICAgICBsZXQgdiA9ICQoIiMiICsgaWQpLnZhbCgpOwogICAgICAvLyAgICAgdmFyIHRleHRCZWZvcmUgPSB2LnN1YnN0cmluZygwLCBjdXJzb3JQb3MpOwogICAgICAvLyAgICAgdmFyIHRleHRBZnRlciA9IHYuc3Vic3RyaW5nKGN1cnNvclBvcywgdi5sZW5ndGgpOwogICAgICAvLyAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzW2ldLnRleHQgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgIC8vICAgfQogICAgICAvLyB9CiAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5tYXAoZ3JlZXRpbmcgPT4gewogICAgICAgIGlmIChncmVldGluZy5pZCA9PT0gaWQpIHsKICAgICAgICAgIHZhciBjdXJzb3JQb3MgPSAkKCIjIiArIGlkKS5wcm9wKCJzZWxlY3Rpb25FbmQiKTsKCiAgICAgICAgICBsZXQgdiA9ICQoIiMiICsgaWQpLnZhbCgpOwoKICAgICAgICAgIGlmICh0aGlzLm9sZEN1cnNvclBvc2l0aW9uKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgdGV4dEJlZm9yZSA9IHYuc3Vic3RyaW5nKDAsIHRoaXMub2xkQ3Vyc29yUG9zaXRpb24pOwogICAgICAgICAgICB2YXIgdGV4dEFmdGVyID0gdi5zdWJzdHJpbmcodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiwgdi5sZW5ndGgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciB0ZXh0QmVmb3JlID0gdi5zdWJzdHJpbmcoMCwgY3Vyc29yUG9zKTsKICAgICAgICAgICAgdmFyIHRleHRBZnRlciA9IHYuc3Vic3RyaW5nKGN1cnNvclBvcywgdi5sZW5ndGgpOwogICAgICAgICAgfQogICAgICAgICAgZ3JlZXRpbmcudGV4dCA9IHRleHRCZWZvcmUgKyBlbW9qaSArIHRleHRBZnRlcjsKICAgICAgICAgIC8vIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgICAgICAhdGhpcy5vbGRDdXJzb3JQb3NpdGlvbgogICAgICAgICAgICA/ICh0aGlzLm9sZEN1cnNvclBvc2l0aW9uID0gY3Vyc29yUG9zICsgMikKICAgICAgICAgICAgOiAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IHRoaXMub2xkQ3Vyc29yUG9zaXRpb24gKyAyKTsKICAgICAgICAgIAogICAgICAgICAgLy8gbm9kZS5mb2N1cygpOwogICAgICAgICAgLy8gY29uc3QgdGV4dE5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAvLyBjb25zdCBjYXJldCA9IGN1cnNvclBvcyArIDE7CiAgICAgICAgICAvLyBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAvLyByYW5nZS5zZXRTdGFydCh0ZXh0Tm9kZSwgY2FyZXQpOwogICAgICAgICAgLy8gcmFuZ2Uuc2V0RW5kKHRleHROb2RlLCBjYXJldCk7CiAgICAgICAgICAvLyBjb25zdCBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CiAgICAgICAgICAvLyBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgICAgICAvLyBzZWwuYWRkUmFuZ2UocmFuZ2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIHJlc2V0X2N1cnNvcl9wb3NpdGlvbigpIHsKICAgICAgdGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IG51bGw7CiAgICB9LAoKICAgIGFwcGVuZF9vbl90aXRsZShlbW9qaSwgaWQpIHsKICAgICAgLy8gZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgLy8gICBpZiAodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLmlkID09PSBpZCkgewogICAgICAvLyAgICAgdmFyIGN1cnNvclBvcyA9ICQoIiMiICsgaWQpLnByb3AoInNlbGVjdGlvblN0YXJ0Iik7CiAgICAgIC8vICAgICBsZXQgdiA9ICQoIiMiICsgaWQpLnZhbCgpOwogICAgICAvLyAgICAgdmFyIHRleHRCZWZvcmUgPSB2LnN1YnN0cmluZygwLCBjdXJzb3JQb3MpOwogICAgICAvLyAgICAgdmFyIHRleHRBZnRlciA9IHYuc3Vic3RyaW5nKGN1cnNvclBvcywgdi5sZW5ndGgpOwogICAgICAvLyAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnRpdGxlID0gdGV4dEJlZm9yZSArIGVtb2ppICsgdGV4dEFmdGVyOwogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubWFwKHdpZGdldF9idXR0b25zX2RldGFpbCA9PiB7CiAgICAgICAgaWYgKHdpZGdldF9idXR0b25zX2RldGFpbC5pZCA9PT0gaWQpIHsKICAgICAgICAgIHZhciBjdXJzb3JQb3MgPSAkKCIjIiArIGlkKS5wcm9wKCJzZWxlY3Rpb25FbmQiKTsKICAgICAgICAgIGxldCB2ID0gJCgiIyIgKyBpZCkudmFsKCk7CiAgICAgICAgICBpZiAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbikgewogICAgICAgICAKICAgICAgICAgICAgdmFyIHRleHRCZWZvcmUgPSB2LnN1YnN0cmluZygwLCB0aGlzLm9sZEN1cnNvclBvc2l0aW9uKTsKICAgICAgICAgICAgdmFyIHRleHRBZnRlciA9IHYuc3Vic3RyaW5nKHRoaXMub2xkQ3Vyc29yUG9zaXRpb24sIHYubGVuZ3RoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAKICAgICAgICAgICAgdmFyIHRleHRCZWZvcmUgPSB2LnN1YnN0cmluZygwLCBjdXJzb3JQb3MpOwogICAgICAgICAgICB2YXIgdGV4dEFmdGVyID0gdi5zdWJzdHJpbmcoY3Vyc29yUG9zLCB2Lmxlbmd0aCk7CiAgICAgICAgICB9CiAgICAgICAgICB3aWRnZXRfYnV0dG9uc19kZXRhaWwudGl0bGUgPSB0ZXh0QmVmb3JlICsgZW1vamkgKyB0ZXh0QWZ0ZXI7CiAgICAgICAgICAvLyBjb25zdCBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgICAgIXRoaXMub2xkQ3Vyc29yUG9zaXRpb24KICAgICAgICAgICAgPyAodGhpcy5vbGRDdXJzb3JQb3NpdGlvbiA9IGN1cnNvclBvcyArIDIpCiAgICAgICAgICAgIDogKHRoaXMub2xkQ3Vyc29yUG9zaXRpb24gPSB0aGlzLm9sZEN1cnNvclBvc2l0aW9uICsgMik7CiAgICAKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldF9pbnRlbnRzKCkgewogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLnNob3dfaW50ZW50X3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuc3Vic2NyaXB0aW9uLAogICAgICAgICAgICBzaG93aW50ZW50OiAiVHJ1ZSIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5JTlRFUk5BTF9TRVJWRVJfRVJST1IuTVNHX0NPREUpIHsKICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCJib3RfY29uZmlnX2dldF9pbnRlbnRfZXJyb3JfbXNnIikpOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEuZGF0YSkgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGEpIHsKICAgICAgICAgICAgICB0aGlzLmludGVudGxpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGFbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgiYm90X2NvbmZpZ19nZXRfaW50ZW50X2Vycm9yX21zZzIiKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgYWRkX2JvdF9ncmVldGluZ3MoKSB7CiAgICAgIGxldCBuZXh0X2lkID0gdGhpcy5nZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLnB1c2goewogICAgICAgIHRleHQ6IG51bGwsCiAgICAgICAgaWQ6IG5leHRfaWQsCiAgICAgICAgdmlzaWJsZTogdHJ1ZQogICAgICB9KTsKICAgIH0sCiAgICBkZWxldGVfZ3JlZXRpbmcoaW5kZXgpIHsKICAgICAgaWYgKAogICAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggPT09IDEgJiYKICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoID4gMAogICAgICApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX2RlbGV0ZV9tc2ciKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCB0ZW1wX2luZGV4ID0gbnVsbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvdF9ncmVldGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmlkID09IGluZGV4KSB7CiAgICAgICAgICB0ZW1wX2luZGV4ID0gaTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLnNwbGljZSh0ZW1wX2luZGV4LCAxKTsKICAgIH0sCiAgICBnZXRfd2lkZ2V0X3NldHRpbmdzKCkgewogICAgICB0aGlzLmJvdF9ncmVldGluZ3MgPSBbXTsKICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IHRydWU7CiAgICAgIC8vIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscyA9IFtdOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpewogICAgICAgICAgICB0aGlzLnRpdGxlID0gcmVzcG9uc2UuZGF0YS5kYXRhLldpZGdldFRpdGxlOwogICAgICAgICAgICB0aGlzLm9sZF93aWRnZXRfdGl0bGUgPSB0aGlzLnRpdGxlOwogICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSByZXNwb25zZS5kYXRhLmRhdGEuSW1hZ2VOYW1lOwogICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfMiA9IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RJbWFnZU5hbWU7CiAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF8zID0gcmVzcG9uc2UuZGF0YS5kYXRhLkJnSW1hZ2VOYW1lOwogICAgICAgICAgICB0aGlzLmltYWdlX2ZpbGVfMyA9IHJlc3BvbnNlLmRhdGEuZGF0YS5CZ0ltYWdlVXJsOwogICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRJY29uSW1hZ2VOYW1lOwogICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRJY29uSW1hZ2VOYW1lT25DbG9zZTsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfdGhlbWUgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RUaGVtZS5sZW5ndGggPCA2CiAgICAgICAgICAgICAgICA/ICgKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90VGhlbWUgKwogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RUaGVtZS5zbGljZSgxLCByZXNwb25zZS5kYXRhLmRhdGEuQm90VGhlbWUubGVuZ3RoKQogICAgICAgICAgICAgICAgICApLnN1YnN0cigwLCA3KQogICAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLmRhdGEuQm90VGhlbWU7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSA9CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUubGVuZ3RoIDwgNgogICAgICAgICAgICAgICAgICA/ICgKICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZSArCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUuc2xpY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApLnN1YnN0cigwLCA3KQogICAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUuZmlsdGVyKAogICAgICAgICAgICAgICAgaXRlbSA9PiBpdGVtLm5hbWUgPT09ICJib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lIgogICAgICAgICAgICAgIClbMF0udmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5Vc2VyUmVzcG9uc2VCZ0NvbG9yICE9IG51bGwpIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfcmVzcG9uc2VfYmdfY29sb3IgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLlVzZXJSZXNwb25zZUJnQ29sb3IubGVuZ3RoIDwgNgogICAgICAgICAgICAgICAgICA/ICgKICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Vc2VyUmVzcG9uc2VCZ0NvbG9yICsKICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Vc2VyUmVzcG9uc2VCZ0NvbG9yLnNsaWNlKAogICAgICAgICAgICAgICAgICAgICAgICAxLAogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuVXNlclJlc3BvbnNlQmdDb2xvci5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApLnN1YnN0cigwLCA3KQogICAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5Vc2VyUmVzcG9uc2VCZ0NvbG9yOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudXNlcl9yZXNwb25zZV9iZ19jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZS5maWx0ZXIoCiAgICAgICAgICAgICAgICBpdGVtID0+IGl0ZW0ubmFtZSA9PT0gImJvdF9zdHlsaW5nLnVzZXJfcmVzcG9uc2VfYmdfY29sb3IiCiAgICAgICAgICAgICAgKVswXS52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLkJvdFJlc3BvbnNlQmdDb2xvciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfYmdfY29sb3IgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLkJvdFJlc3BvbnNlQmdDb2xvci5sZW5ndGggPCA2CiAgICAgICAgICAgICAgICAgID8gKAogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLkJvdFJlc3BvbnNlQmdDb2xvciArCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90UmVzcG9uc2VCZ0NvbG9yLnNsaWNlKAogICAgICAgICAgICAgICAgICAgICAgICAxLAogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90UmVzcG9uc2VCZ0NvbG9yLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkuc3Vic3RyKDAsIDcpCiAgICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuZGF0YS5kYXRhLkJvdFJlc3BvbnNlQmdDb2xvcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9iZ19jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZS5maWx0ZXIoCiAgICAgICAgICAgICAgICBpdGVtID0+IGl0ZW0ubmFtZSA9PT0gImJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9iZ19jb2xvciIKICAgICAgICAgICAgICApWzBdLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuRGVsaXZlcnlOb3RlQ29sb3IgIT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuZGVsaXZlcnlfbm90ZV9jb2xvciA9CiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuRGVsaXZlcnlOb3RlQ29sb3IubGVuZ3RoIDwgNgogICAgICAgICAgICAgICAgICA/ICgKICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5EZWxpdmVyeU5vdGVDb2xvciArCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuRGVsaXZlcnlOb3RlQ29sb3Iuc2xpY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5EZWxpdmVyeU5vdGVDb2xvci5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApLnN1YnN0cigwLCA3KQogICAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5EZWxpdmVyeU5vdGVDb2xvcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmRlbGl2ZXJ5X25vdGVfY29sb3IgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUuZmlsdGVyKAogICAgICAgICAgICAgICAgaXRlbSA9PiBpdGVtLm5hbWUgPT09ICJib3Rfc3R5bGluZy5kZWxpdmVyeV9ub3RlX2NvbG9yIgogICAgICAgICAgICAgIClbMF0udmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fdGhlbWUgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25UaGVtZS5sZW5ndGggPCA2CiAgICAgICAgICAgICAgICA/ICgKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uVGhlbWUgKwogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25UaGVtZS5zbGljZSgKICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uVGhlbWUubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICApLnN1YnN0cigwLCA3KQogICAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uVGhlbWU7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuQm90R3JlZXRpbmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MgPSByZXNwb25zZS5kYXRhLmRhdGEuQm90R3JlZXRpbmdzOwogICAgICAgICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscyA9IHRoaXMuYm90X2dyZWV0aW5nc1sKICAgICAgICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgXS5idXR0b25zOwogICAgICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5tYXAoKGN2LCBpbmQsIGFycikgPT4gewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuYm90X2dyZWV0aW5nc1tpbmRdLmJ1dHRvbnM7CiAgICAgICAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3NbaW5kXS5pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgICAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3NbaW5kXS52aXNpYmxlID0KICAgICAgICAgICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzW2luZF0udmlzaWJsZSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmJvdF9ncmVldGluZ3NbaW5kXS52aXNpYmxlCiAgICAgICAgICAgICAgICAgICAgOiB0cnVlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlmICh0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMgPSBbXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlsc1tpXS5pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbCiAgICAgICAgICAgICAgICAvLyAgIGkKICAgICAgICAgICAgICAgIC8vIF0udmFsdWUgPSB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0udmFsdWUucmVwbGFjZSgKICAgICAgICAgICAgICAgIC8vICAgdGhpcy5jb21wYW55aWQgKyAiXyIsCiAgICAgICAgICAgICAgICAvLyAgICIiCiAgICAgICAgICAgICAgICAvLyApOwogICAgICAgICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzWwogICAgICAgICAgICAgICAgICBpCiAgICAgICAgICAgICAgICBdLnZhbHVlID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlOwogICAgICAgICAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzWwogICAgICAgICAgICAgICAgICBpCiAgICAgICAgICAgICAgICBdLnZhbHVlID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2ldLnZhbHVlLnJlcGxhY2UoIi8iLCAiIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYm90X2ZvbnRfc3R5bGUgPSByZXNwb25zZS5kYXRhLmRhdGEuQm90Rm9udC5Gb250U3R5bGU7CiAgICAgICAgICAgIHRoaXMuYm90X2ZvbnRfY29sb3Jfc2VuZGVyID0gcmVzcG9uc2UuZGF0YS5kYXRhLkJvdEZvbnQuRm9udENvbG9yU2VuZGVyOwogICAgICAgICAgICB0aGlzLmJvdF9mb250X2NvbG9yX3JlY2VpdmVyID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90Rm9udC5Gb250Q29sb3JSZWNlaXZlcjsKICAgICAgICAgICAgdGhpcy5ib3RfZm9udF9jb2xvcl9idXR0b25zID0gcmVzcG9uc2UuZGF0YS5kYXRhLkJvdEZvbnQuRm9udENvbG9yQnV0dG9uczsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25TdHlsaW5nKSB7CiAgICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmcgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLkJ1dHRvblN0eWxpbmcuaG9yaXpvbnRhbDsKICAgICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmcgPQogICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLkJ1dHRvblN0eWxpbmcudmVydGljYWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRQb3NpdGlvbikgewogICAgICAgICAgICAgIHRoaXMuYm90X2FsaWdubWVudCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRQb3NpdGlvbi5hbGlnbjsKICAgICAgICAgICAgICB0aGlzLmJvdF92ZXJ0aWNhbF9wb3NpdGlvbiA9IHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRQb3NpdGlvbi52ZXJ0aWNhbDsKICAgICAgICAgICAgICB0aGlzLmJvdF9ob3Jpem9udGFsX3Bvc2l0aW9uID0KICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRQb3NpdGlvbi5ob3Jpem9udGFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuQm90U3R5bGluZykgewogICAgICAgICAgICAgIHRoaXMuYm90X2J1dHRvbnNfYWxpZ25tZW50ID0gcmVzcG9uc2UuZGF0YS5kYXRhLkJvdFN0eWxpbmc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YS5IZWFkZXJTdHlsaW5nKSB7CiAgICAgICAgICAgICAgdGhpcy5ib3RfaGVhZGVyX2FsaWdubWVudCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5IZWFkZXJTdHlsaW5nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEuSGVhZGVyVGhlbWUpIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9oZWFkZXJfYmFja2dyb3VuZCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5IZWFkZXJUaGVtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsXzMgIT0gIiIpIHsKICAgICAgICAgICAgICB0aGlzLmJvdF9iYWNrZ3JvdW5kX3R5cGUgPSAiaW1hZ2UiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWUgPSB0aGlzLmZpbGVfbGFiZWw7CiAgICAgICAgICAgIGlmICh0aGlzLmZpbGVfbGFiZWwgPT0gIiIpIHsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMiA9IHRoaXMuZmlsZV9sYWJlbF8yOwogICAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsXzIgPT0gIiIgfHwgdGhpcy5maWxlX2xhYmVsXzIgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzIgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMyA9IHRoaXMuZmlsZV9sYWJlbF8zOwogICAgICAgICAgICBpZiAodGhpcy5maWxlX2xhYmVsXzMgPT0gIiIgfHwgdGhpcy5maWxlX2xhYmVsXzMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzMgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfNCA9IHRoaXMuZmlsZV9sYWJlbF80OwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzQgPT0gIiIgfHwKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNCA9PSB1bmRlZmluZWQgfHwKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNCA9PSAiQ2hvb3NlIEZpbGUiCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF80ID0gIkNob29zZSBmaWxlIjsKICAgICAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzQgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMud2lkZ2V0X2ljb25fdHlwZSA9ICJpbWFnZSI7CiAgICAgICAgICAgICAgdGhpcy5kZWZhdWxfd2lkZ2V0X2ljb24gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzUgPSB0aGlzLmZpbGVfbGFiZWxfNTsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF81ID09ICIiIHx8CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzUgPT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgdGhpcy5maWxlX2xhYmVsXzUgPT0gIkNob29zZSBGaWxlIgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNSA9ICJDaG9vc2UgZmlsZSI7CiAgICAgICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV81ID0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLndpZGdldF9pY29uX3R5cGUgPSAiaW1hZ2UiOwogICAgICAgICAgICAgIHRoaXMuZGVmYXVsX3dpZGdldF9pY29uID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRJY29uVXJsID09IG51bGwgJiYKICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuV2lkZ2V0SWNvblVybE9uQ2xvc2UgPT0gbnVsbAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLndpZGdldF9pY29uX3R5cGUgPSAibm9uZSI7CiAgICAgICAgICAgICAgdGhpcy5kZWZhdWxfd2lkZ2V0X2ljb24gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X29wZW5fYnlfZGVmYXVsdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RPcGVuQnlEZWZhdWx0OwogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UgPQogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Jc1Bvd2VyZWRCeUNlbnNlID09PSB1bmRlZmluZWQKICAgICAgICAgICAgICAgID8gdGhpcy5ib3Rfc3R5bGluZy5pc19wb3dlcmVkX2J5X2NlbnNlCiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5Jc1Bvd2VyZWRCeUNlbnNlOwogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJvdF9zaG93bl9vbl93ZWJzaXRlID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90U2hvd25PbldlYnNpdGUgPT0gbnVsbCB8fAogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RTaG93bk9uV2Vic2l0ZSA9PSB1bmRlZmluZWQKICAgICAgICAgICAgICAgID8gdHJ1ZQogICAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLmRhdGEuQm90U2hvd25PbldlYnNpdGU7CiAgICAgICAgICAgIGxldCBjaGF0X3BhcmFtcyA9IHsKICAgICAgICAgICAgICBsb2dvOiByZXNwb25zZS5kYXRhLmRhdGEuSW1hZ2VVcmwsCiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEuZGF0YS5XaWRnZXRUaXRsZSwKICAgICAgICAgICAgICBidXR0b25fdGhlbWU6IHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25UaGVtZSwKICAgICAgICAgICAgICBib3RfdGhlbWU6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RUaGVtZSwKICAgICAgICAgICAgICBidXR0b25fYm9yZGVyX3RoZW1lOiByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUsCiAgICAgICAgICAgICAgdXNlcl9yZXNwb25zZV9iZ19jb2xvcjogcmVzcG9uc2UuZGF0YS5kYXRhLlVzZXJSZXNwb25zZUJnQ29sb3IsCiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2JnX2NvbG9yOiByZXNwb25zZS5kYXRhLmRhdGEuQm90UmVzcG9uc2VCZ0NvbG9yLAogICAgICAgICAgICAgIGRlbGl2ZXJ5X25vdGVfY29sb3I6IHJlc3BvbnNlLmRhdGEuZGF0YS5EZWxpdmVyeU5vdGVDb2xvciwKICAgICAgICAgICAgICBib3RfaWNvbjogcmVzcG9uc2UuZGF0YS5kYXRhLkJvdEltYWdlVXJsLAogICAgICAgICAgICAgIGJvdF9iYWNrZ3JvdW5kX2ltYWdlOiByZXNwb25zZS5kYXRhLmRhdGEuQmdJbWFnZVVybCwKICAgICAgICAgICAgICBidXR0b25faG9yaXpvbnRhbF9zcGFjaW5nOiByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uU3R5bGluZy5ob3Jpem9udGFsLAogICAgICAgICAgICAgIGJ1dHRvbl92ZXJ0aWNhbF9zcGFjaW5nOiByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uU3R5bGluZy52ZXJ0aWNhbCwKICAgICAgICAgICAgICBidXR0b25fYWxpZ25tZW50OiByZXNwb25zZS5kYXRhLmRhdGEuQm90U3R5bGluZywKICAgICAgICAgICAgICBpc19wb3dlcmVkX2J5X2NlbnNlOiByZXNwb25zZS5kYXRhLmRhdGEuSXNQb3dlcmVkQnlDZW5zZQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiQ2hhdEJvdEltYWdlUGFyYW1ldGVycyIsIGNoYXRfcGFyYW1zKTsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5kZWxpdmVyeV9ub3RlX2NvbG9yID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuRGVsaXZlcnlOb3RlQ29sb3IgPT09IG51bGwKICAgICAgICAgICAgICAgID8gdGhpcy5ib3Rfc3R5bGluZy5kZWxpdmVyeV9ub3RlX2NvbG9yCiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5EZWxpdmVyeU5vdGVDb2xvcjsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQnV0dG9uQm9yZGVyVGhlbWUgPT09IG51bGwKICAgICAgICAgICAgICAgID8gdGhpcy5ib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lCiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5CdXR0b25Cb3JkZXJUaGVtZTsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy51c2VyX3Jlc3BvbnNlX2JnX2NvbG9yID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuVXNlclJlc3BvbnNlQmdDb2xvciA9PT0gbnVsbAogICAgICAgICAgICAgICAgPyB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfcmVzcG9uc2VfYmdfY29sb3IKICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuZGF0YS5kYXRhLlVzZXJSZXNwb25zZUJnQ29sb3I7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2JnX2NvbG9yID0KICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGEuQm90UmVzcG9uc2VCZ0NvbG9yID09PSBudWxsCiAgICAgICAgICAgICAgICA/IHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2JnX2NvbG9yCiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmRhdGEuZGF0YS5Cb3RSZXNwb25zZUJnQ29sb3I7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuc2hvd19ib3RfaGlzdG9yeSA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLlNob3dCb3RIaXN0b3J5ID09PSB1bmRlZmluZWQKICAgICAgICAgICAgICAgID8gdHJ1ZQogICAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLmRhdGEuU2hvd0JvdEhpc3Rvcnk7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuaXNfY29uZnVzaW9uX21zZyA9CiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmNvbmZ1c2lvbl9tc2cgPT09IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgPyAiIgogICAgICAgICAgICAgICAgOiByZXNwb25zZS5kYXRhLmRhdGEuY29uZnVzaW9uX21zZzsKICAgICAgICAgICAgdGhpcy52ZXJpZnlfYm90X3NldHRpbmdzID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAvLyB0aGlzLnZlcmlmeV9ib3Rfc2V0dGluZ3MuQm90R3JlZXRpbmdzW3RoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggLSAxXS5idXR0b25zID0gdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzOwogICAgICAgICAgICB0aGlzLnZlcmlmeV9jaGVjayA9IHRydWU7CiAgICAgICAgICB9ZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCdhZGRfcm9sZV9pbnRlcm5hbF9zZXJ2ZXJfbXNnJyksCiAgICAgICAgICAgIHRpbWVyOjMwMDAsICAgICAKICAgICAgICAgIH0pOwogICAgICAgICAgfWVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5FTVBUWV9EQVRBLk1TR19DT0RFKSB7CiAgICAgICAgICAgIC8vIFN3YWwoewogICAgICAgICAgICAvLyAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIC8vICAgdGV4dDogdGhpcy50bHQoJ25vX2RhdGFfdGV4dCcpLAogICAgICAgICAgICAvLyAgIHRpbWVyOjMwMDAsICAgICAKICAgICAgICAgICAgLy8gfSk7ICAKICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudmVyaWZ5X2NoZWNrID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIHJlc2V0X3RvX2RlZmF1bHQodmFsdWUpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlW2ldLm5hbWUgPT09IHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5idXR0b25fdGhlbWUiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX3RoZW1lID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ib3RfdGhlbWUiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X3RoZW1lID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5idXR0b25fYm9yZGVyX3RoZW1lIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl9ib3JkZXJfdGhlbWUgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbCiAgICAgICAgICAgICAgaQogICAgICAgICAgICBdLnZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gImJvdF9zdHlsaW5nLnVzZXJfcmVzcG9uc2VfYmdfY29sb3IiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcudXNlcl9yZXNwb25zZV9iZ19jb2xvciA9IHRoaXMuZGVmYXVsdF9ib3Rfc3R5bGluZ192YWx1ZVsKICAgICAgICAgICAgICBpCiAgICAgICAgICAgIF0udmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAiYm90X3N0eWxpbmcuZGVsaXZlcnlfbm90ZV9jb2xvciIpIHsKICAgICAgICAgICAgdGhpcy5ib3Rfc3R5bGluZy5kZWxpdmVyeV9ub3RlX2NvbG9yID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ib3RfcmVzcG9uc2VfYmdfY29sb3IiKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuYm90X3Jlc3BvbnNlX2JnX2NvbG9yID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmciKSB7CiAgICAgICAgICAgIHRoaXMuYm90X3N0eWxpbmcuaG9yaXpvbnRhbF9zcGFjaW5nID0gdGhpcy5kZWZhdWx0X2JvdF9zdHlsaW5nX3ZhbHVlWwogICAgICAgICAgICAgIGkKICAgICAgICAgICAgXS52YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICJib3Rfc3R5bGluZy52ZXJ0aWNhbF9zcGFjaW5nIikgewogICAgICAgICAgICB0aGlzLmJvdF9zdHlsaW5nLnZlcnRpY2FsX3NwYWNpbmcgPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbCiAgICAgICAgICAgICAgaQogICAgICAgICAgICBdLnZhbHVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpc1t2YWx1ZV0gPSB0aGlzLmRlZmF1bHRfYm90X3N0eWxpbmdfdmFsdWVbaV0udmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhZGRfYnV0dG9uc19mb3Jfd2lkZ2V0KCkgewogICAgICBpZiAodGhpcy5ib3RfZ3JlZXRpbmdzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfemVyb19idG5fbXNnIiksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgdGVtcF9pZCA9IHRoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5wdXNoKHsKICAgICAgICB0aXRsZTogbnVsbCwKICAgICAgICB2YWx1ZTogdGhpcy5pbnRlbnRsaXN0WzBdLAogICAgICAgIGlkOiB0ZW1wX2lkLAogICAgICAgIHZpc2libGU6IHRydWUKICAgICAgfSk7CiAgICB9LAogICAgZGVsZXRlX3dpZGdldF9idXR0b24oYnV0dG9uX2RldCkgewogICAgICBpZiAoYnV0dG9uX2RldC5kaXNhYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfZGVmYXVsdF9idG4iKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgdGVtcF9pbmRleCA9IG51bGw7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbaV0uaWQgPT0gYnV0dG9uX2RldC5pZCkgewogICAgICAgICAgICB0ZW1wX2luZGV4ID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzLnNwbGljZSh0ZW1wX2luZGV4LCAxKTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dChlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX2ltZ19zaXplX21zZzEiKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9wbmciIHx8IGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZSA9IHRoaXMuZmlsZV9sYWJlbDsKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UoZmlsZXNbMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgiYm90X2NvbmZpZ19pbWdfdHlwZV9tc2cxIikpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0MihlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDIwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX2ltZ19zaXplX21zZzIiKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9wbmciIHx8IGZpbGVzWzBdLnR5cGUgPT09ICJpbWFnZS9qcGVnIikgewogICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV8yID0gdGhpcy5maWxlX2xhYmVsXzI7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzIgPSBmaWxlc1swXS5uYW1lOwogICAgICAgIHRoaXMuY3JlYXRlSW1hZ2UyKGZpbGVzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoImJvdF9jb25maWdfaW1nX3R5cGVfbXNnMiIpKTsKICAgICAgfQogICAgfSwKICAgIGZpbGVpbnB1dDMoZSkgewoKICAgICAgbGV0IGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgIGlmIChmaWxlc1swXS5zaXplID4gMjA5NzE1MikgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfaW1nX3NpemVfbXNnMyIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL3BuZyIgfHwgZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL2pwZWciKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzX2JnX2ltYWdlX2NoYW5nZWQpIHsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMyA9IHRoaXMuZmlsZV9sYWJlbF8zOwogICAgICAgIH0KICAgICAgICB0aGlzLmZpbGVfbGFiZWxfMyA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZTMoZmlsZXNbMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgiYm90X2NvbmZpZ19pbWdfdHlwZV9tc2czIikpOwogICAgICB9CiAgICB9LAogICAgZmlsZWlucHV0NChlKSB7CiAgICAgIGxldCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzIHx8IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICBpZiAoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICBpZiAoZmlsZXNbMF0uc2l6ZSA+IDEwOTcxNTIpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6ICJVcGxvYWQgaW1hZ2Ugd2l0aCBzaXplIGxlc3MgdGhhbiAxTUIiLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAxMDAwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL3BuZyIgfHwgZmlsZXNbMF0udHlwZSA9PT0gImltYWdlL2pwZWciKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzX2JnX2ltYWdlX2NoYW5nZWQpIHsKICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfNCA9IHRoaXMuZmlsZV9sYWJlbF80OwogICAgICAgIH0KICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNCA9IGZpbGVzWzBdLm5hbWU7CiAgICAgICAgdGhpcy5jcmVhdGVJbWFnZTQoZmlsZXNbMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRvYXN0ci5lcnJvcigiUGxlYXNlIFNlbGVjdCBhbiBJbWFnZSBvZiB0eXBlIFBORyBvciBKUEVHIik7CiAgICAgIH0KICAgIH0sCiAgICBmaWxlaW5wdXQ1KGUpIHsKICAgICAgbGV0IGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXM7CiAgICAgIGlmICghZmlsZXMubGVuZ3RoKSByZXR1cm47CiAgICAgIGlmIChmaWxlc1swXS5zaXplID4gMTA5NzE1MikgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlVwbG9hZCBpbWFnZSB3aXRoIHNpemUgbGVzcyB0aGFuIDFNQiIsCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvcG5nIiB8fCBmaWxlc1swXS50eXBlID09PSAiaW1hZ2UvanBlZyIpIHsKICAgICAgICBpZiAoIXRoaXMuaXNfYmdfaW1hZ2VfY2hhbmdlZCkgewogICAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV81ID0gdGhpcy5maWxlX2xhYmVsXzU7CiAgICAgICAgfQogICAgICAgIHRoaXMuZmlsZV9sYWJlbF81ID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICB0aGlzLmNyZWF0ZUltYWdlNShmaWxlc1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IGFuIEltYWdlIG9mIHR5cGUgUE5HIG9yIEpQRUciKTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUltYWdlKGZpbGUsIHR5cGUpIHsKICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZSA9PiB7CiAgICAgICAgdGhpcy5pbWFnZV9maWxlID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGNyZWF0ZUltYWdlMihmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZV8yID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGNyZWF0ZUltYWdlMyhmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9IGUgPT4gewogICAgICAgIHRoaXMuaW1hZ2VfZmlsZV8zID0gZS50YXJnZXQucmVzdWx0LnNwbGl0KCJiYXNlNjQsIilbMV07CiAgICAgIH07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgfSwKICAgIGNyZWF0ZUltYWdlNChmaWxlLCB0eXBlKSB7CiAgICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIub25sb2FkID0gZSA9PiB7CiAgICAgICAgdGhpcy5pbWFnZV9maWxlXzQgPSBlLnRhcmdldC5yZXN1bHQuc3BsaXQoImJhc2U2NCwiKVsxXTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICB9LAogICAgY3JlYXRlSW1hZ2U1KGZpbGUsIHR5cGUpIHsKICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgICAgICB0aGlzLmltYWdlX2ZpbGVfNSA9IGUudGFyZ2V0LnJlc3VsdC5zcGxpdCgiYmFzZTY0LCIpWzFdOwogICAgICB9OwogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgIH0sCiAgICB1cGxvYWRfaW1hZ2UoKSB7CiAgICAgIGNvbnNvbGUubG9nKHRoaXMuaW1hZ2VfZmlsZV8zKQogICAgICBpZiAodGhpcy5ib3RfdmVydGljYWxfcG9zaXRpb24gPiAxNTApIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX3ZlcnRpY2FsX3Bvc19tc2ciKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMTAwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYm90X2hvcml6b250YWxfcG9zaXRpb24gPiAzMikgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfaG9yaXpvbnRhbF9wb3NfbXNnIiksCiAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDEwMDAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmRlZmF1bF93aWRnZXRfaWNvbiA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzQgPSAiQ2hvb3NlIGZpbGUiOwogICAgICAgIHRoaXMuaW1hZ2VfZmlsZV80ID0gbnVsbDsKICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzQgPSBudWxsOwogICAgICAgIHRoaXMuZmlsZV9sYWJlbF81ID0gIkNob29zZSBmaWxlIjsKICAgICAgICB0aGlzLmltYWdlX2ZpbGVfNSA9IG51bGw7CiAgICAgICAgdGhpcy5vbGRfaW1hZ2VfbmFtZV81ID0gbnVsbDsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRXaWRnZXRGaWxlMDEiKS52YWx1ZSA9PSAiIiB8fAogICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dFdpZGdldEZpbGUwMiIpLnZhbHVlID09ICIiCiAgICAgICAgdGhpcy5maWxlX2xhYmVsXzQgPT0gIiIgfHwgdGhpcy5maWxlX2xhYmVsXzUgPT0gIiIKICAgICAgKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJQbGVhc2UgU2VsZWN0IEJvdGggSW1hZ2UiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYm90X2hlYWRlcl9hbGlnbm1lbnQgPT09IG51bGwpIHsKICAgICAgICBzd2FsKHsKICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX2hlYWRlcl9hbGlnbl9tc2ciKSwKICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmICh0aGlzLmJvdF9idXR0b25zX2FsaWdubWVudCA9PT0gbnVsbCkgewogICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfYnRuX2FsaWduX21zZyIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuZmlsZV9sYWJlbCAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lICYmCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0R3JvdXBGaWxlMDEiKS52YWx1ZSA9PSAiIgogICAgICApIHsKICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoImJvdF9jb25maWdfc2VsZWN0X2ltZ19maWxlX21zZzEiKSk7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5maWxlX2xhYmVsICE9IHRoaXMub2xkX2ltYWdlX25hbWUgJiYKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRHcm91cEZpbGUwMSIpLnZhbHVlID09ICIiCiAgICAgICkgewogICAgICAgIHRvYXN0ci5lcnJvcih0aGlzLnRsdCgiYm90X2NvbmZpZ19zZWxlY3RfaW1nX2ZpbGVfbXNnMiIpKTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0aGlzLmZpbGVfbGFiZWwgIT0gdGhpcy5vbGRfaW1hZ2VfbmFtZSAmJgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dEdyb3VwRmlsZTAxIikudmFsdWUgPT0gIiIKICAgICAgKSB7CiAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCJib3RfY29uZmlnX3NlbGVjdF9pbWdfZmlsZV9tc2czIikpOwogICAgICB9IGVsc2UgaWYodGhpcy5pbWFnZV9maWxlXzMgPT09IG51bGwpewogICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoJ2JvdF9iYWNrZ3JvdW5kX2ltZ190ZXh0JyksCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgICAgfSkKICAgICAgfSBlbHNlewogICAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICB3aWRnZXRfdGl0bGU6IHRoaXMudGl0bGUsCiAgICAgICAgICAgICAgaXNJbWFnZUVkaXQ6CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWwgIT0gdGhpcy5vbGRfaW1hZ2VfbmFtZSA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICBpc0JvdEltYWdlRWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF8yICE9IHRoaXMub2xkX2ltYWdlX25hbWVfMiA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICBpbWFnZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWwsCiAgICAgICAgICAgICAgd2lkZ2V0X2ltYWdlOiB0aGlzLmltYWdlX2ZpbGUsCiAgICAgICAgICAgICAgb2xkX2ltYWdlX25hbWU6CiAgICAgICAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lID09ICJDaG9vc2UgRmlsZSIKICAgICAgICAgICAgICAgICAgPyBudWxsCiAgICAgICAgICAgICAgICAgIDogdGhpcy5vbGRfaW1hZ2VfbmFtZSwKICAgICAgICAgICAgICBpc0VkaXQ6IHRydWUsCgogICAgICAgICAgICAgIGJvdF9pbWFnZV9uYW1lOiB0aGlzLmZpbGVfbGFiZWxfMiwKICAgICAgICAgICAgICBvbGRfYm90X2ltYWdlX25hbWU6CiAgICAgICAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzIgPT0gIkNob29zZSBGaWxlIgogICAgICAgICAgICAgICAgICA/IG51bGwKICAgICAgICAgICAgICAgICAgOiB0aGlzLm9sZF9pbWFnZV9uYW1lXzIsCiAgICAgICAgICAgICAgYm90X2ltYWdlOiB0aGlzLmltYWdlX2ZpbGVfMiwKICAgICAgICAgICAgICBvbGRfYmdfaW1hZ2VfbmFtZToKICAgICAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfMyA9PSAiQ2hvb3NlIEZpbGUiICYmCiAgICAgICAgICAgICAgICAhdGhpcy5pc19iZ19pbWFnZV9jaGFuZ2VkCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMub2xkX2ltYWdlX25hbWVfMywKICAgICAgICAgICAgICBiZ19pbWFnZToKICAgICAgICAgICAgICAgIHRoaXMuYm90X2JhY2tncm91bmRfdHlwZSA9PT0gIm5vbmUiCiAgICAgICAgICAgICAgICAgID8gIk5vX2ltYWdlIgogICAgICAgICAgICAgICAgICA6IHRoaXMuaW1hZ2VfZmlsZV8zLAogICAgICAgICAgICAgIGJnX2ltYWdlX25hbWU6IHRoaXMuZmlsZV9sYWJlbF8zLAogICAgICAgICAgICAgIGlzQmdJbWFnZUVkaXQ6CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfMyAhPSB0aGlzLm9sZF9pbWFnZV9uYW1lXzMgfHwKICAgICAgICAgICAgICAgIHRoaXMuYm90X2JhY2tncm91bmRfdHlwZSA9PT0gIm5vbmUiCiAgICAgICAgICAgICAgICAgID8gdHJ1ZQogICAgICAgICAgICAgICAgICA6IGZhbHNlLAogICAgICAgICAgICAgIGhlYWRlcl90aGVtZTogdGhpcy5ib3RfaGVhZGVyX2JhY2tncm91bmQsCiAgICAgICAgICAgICAgaGVhZGVyX2N1c3RvbV9zdHlsZTogdGhpcy5ib3RfaGVhZGVyX2FsaWdubWVudCwKICAgICAgICAgICAgICBib3RfdGhlbWU6IHRoaXMuYm90X3N0eWxpbmcuYm90X3RoZW1lLAogICAgICAgICAgICAgIGJ1dHRvbl9ib3JkZXJfdGhlbWU6IHRoaXMuYm90X3N0eWxpbmcuYnV0dG9uX2JvcmRlcl90aGVtZSwKICAgICAgICAgICAgICB1c2VyX3Jlc3BvbnNlX2JnX2NvbG9yOiB0aGlzLmJvdF9zdHlsaW5nLnVzZXJfcmVzcG9uc2VfYmdfY29sb3IsCiAgICAgICAgICAgICAgYm90X3Jlc3BvbnNlX2JnX2NvbG9yOiB0aGlzLmJvdF9zdHlsaW5nLmJvdF9yZXNwb25zZV9iZ19jb2xvciwKICAgICAgICAgICAgICBkZWxpdmVyeV9ub3RlX2NvbG9yOiB0aGlzLmJvdF9zdHlsaW5nLmRlbGl2ZXJ5X25vdGVfY29sb3IsCiAgICAgICAgICAgICAgYnV0dG9uX3RoZW1lOiB0aGlzLmJvdF9zdHlsaW5nLmJ1dHRvbl90aGVtZSwKICAgICAgICAgICAgICBib3RfY3VzdG9tX3N0eWxlOiB0aGlzLmJvdF9idXR0b25zX2FsaWdubWVudCwKICAgICAgICAgICAgICBib3RfZm9udDogewogICAgICAgICAgICAgICAgRm9udFN0eWxlOiB0aGlzLmJvdF9mb250X3N0eWxlLAogICAgICAgICAgICAgICAgRm9udENvbG9yU2VuZGVyOiB0aGlzLmJvdF9mb250X2NvbG9yX3NlbmRlciwKICAgICAgICAgICAgICAgIEZvbnRDb2xvclJlY2VpdmVyOiB0aGlzLmJvdF9mb250X2NvbG9yX3JlY2VpdmVyLAogICAgICAgICAgICAgICAgRm9udENvbG9yQnV0dG9uczogdGhpcy5ib3RfZm9udF9jb2xvcl9idXR0b25zCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBib3RfcG9zaXRpb246IHsKICAgICAgICAgICAgICAgIGFsaWduOiB0aGlzLmJvdF9hbGlnbm1lbnQsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogdGhpcy5ib3RfdmVydGljYWxfcG9zaXRpb24sCiAgICAgICAgICAgICAgICBob3Jpem9udGFsOiB0aGlzLmJvdF9ob3Jpem9udGFsX3Bvc2l0aW9uCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBidXR0b25fY3VzdG9tX3N0eWxlOiB7CiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogdGhpcy5ib3Rfc3R5bGluZy52ZXJ0aWNhbF9zcGFjaW5nLAogICAgICAgICAgICAgICAgaG9yaXpvbnRhbDogdGhpcy5ib3Rfc3R5bGluZy5ob3Jpem9udGFsX3NwYWNpbmcKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJvdF9vcGVuX2J5X2RlZmF1bHQ6IHRoaXMuYm90X3N0eWxpbmcuYm90X29wZW5fYnlfZGVmYXVsdCwKICAgICAgICAgICAgICBib3Rfc2hvd25fb25fd2Vic2l0ZTogdGhpcy5ib3Rfc3R5bGluZy5ib3Rfc2hvd25fb25fd2Vic2l0ZSwKICAgICAgICAgICAgICBpc19wb3dlcmVkX2J5X2NlbnNlOiB0aGlzLmJvdF9zdHlsaW5nLmlzX3Bvd2VyZWRfYnlfY2Vuc2UsCiAgICAgICAgICAgICAgc2hvd19ib3RfaGlzdG9yeTogdGhpcy5ib3Rfc3R5bGluZy5zaG93X2JvdF9oaXN0b3J5LAogICAgICAgICAgICAgIHdpZGdldF9pY29uX2ltYWdlX25hbWU6CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNCA9PSAiQ2hvb3NlIGZpbGUiID8gIiIgOiB0aGlzLmZpbGVfbGFiZWxfNCwKICAgICAgICAgICAgICB3aWRnZXRfaWNvbl9pbWFnZTogdGhpcy5pbWFnZV9maWxlXzQsCiAgICAgICAgICAgICAgb2xkX3dpZGdldF9pY29uX25hbWU6CiAgICAgICAgICAgICAgICB0aGlzLm9sZF9pbWFnZV9uYW1lXzQgPT0gIkNob29zZSBmaWxlIgogICAgICAgICAgICAgICAgICA/IG51bGwKICAgICAgICAgICAgICAgICAgOiB0aGlzLm9sZF9pbWFnZV9uYW1lXzQsCiAgICAgICAgICAgICAgaXNXaWRnZXRJY29uRWRpdDoKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF80ICE9IHRoaXMub2xkX2ltYWdlX25hbWVfNCA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgICB3aWRnZXRfaWNvbl9pbWFnZV9uYW1lX29uY2xvc2U6CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVfbGFiZWxfNSA9PSAiQ2hvb3NlIGZpbGUiID8gIiIgOiB0aGlzLmZpbGVfbGFiZWxfNSwKICAgICAgICAgICAgICB3aWRnZXRfaWNvbl9pbWFnZV9vbmNsb3NlOiB0aGlzLmltYWdlX2ZpbGVfNSwKICAgICAgICAgICAgICBvbGRfd2lkZ2V0X2ltYWdlX25hbWVfb25jbG9zZToKICAgICAgICAgICAgICAgIHRoaXMub2xkX2ltYWdlX25hbWVfNSA9PSAiQ2hvb3NlIGZpbGUiCiAgICAgICAgICAgICAgICAgID8gbnVsbAogICAgICAgICAgICAgICAgICA6IHRoaXMub2xkX2ltYWdlX25hbWVfNSwKICAgICAgICAgICAgICBpc1dpZGdldEljb25FZGl0T25DbG9zZToKICAgICAgICAgICAgICAgIHRoaXMuZmlsZV9sYWJlbF81ICE9IHRoaXMub2xkX2ltYWdlX25hbWVfNSA/IHRydWUgOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5nZXRfd2lkZ2V0X3NldHRpbmdzKCk7CiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0V2lkZ2V0RmlsZTAxIikudmFsdWUgPSAiIjsKICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXRXaWRnZXRGaWxlMDIiKS52YWx1ZSA9ICIiOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuSU1HX0RVUExJQ0FURS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKAogICAgICAgICAgICAgICAgLy8gICAiSW1hZ2UgYWxyZWFkeSBmb3VuZC4gUGxlYXNlIHVwbG9hZCBhbm90aGVyIGltYWdlIG9yIHJlbmFtZSBpdC4iCiAgICAgICAgICAgICAgICAvLyApOwogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6CiAgICAgICAgICAgICAgICAgICAgIkltYWdlIGFscmVhZHkgZm91bmQuIFBsZWFzZSB1cGxvYWQgYW5vdGhlciBpbWFnZSBvciByZW5hbWUgaXQuIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkFEREVEX1dJREdFVF9TRVRUSU5HU19TVUNDRVNTRlVMTFlfNDAxOC5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX3NldHRpbmdzX3VwZGF0ZWRfdGV4dDIiKSwKICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc3VibWl0X2dyZWV0aW5ncygpIHsKICAgICAgZm9yIChsZXQgZGF0YSA9IDA7IGRhdGEgPCB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMubGVuZ3RoOyBkYXRhKyspIHsKICAgICAgICBpZiAodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzW2RhdGFdLnRpdGxlLmxlbmd0aCA+IDIwKSB7CiAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgdGV4dDogdGhpcy50bHQoImJvdF9jb25maWdfYnRuX2xlbmd0aF9tc2ciKSwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwKICAgICAgICAgICAgdGltZXI6IDUwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgaW50ZW50X3ZhbHMgPSB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHMuZmlsdGVyKAogICAgICAgIHZhbCA9PiB2YWwudmFsdWUgPT09IG51bGwgfHwgdmFsLnRpdGxlID09PSBudWxsCiAgICAgICk7CiAgICAgIGlmIChpbnRlbnRfdmFscy5sZW5ndGggPiAwKSB7CiAgICAgICAgc3dhbCh7CiAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiYm90X2NvbmZpZ19zZWxlY3RfaW50ZW50X21zZyIpLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCB3aWRnZXRfZGV0YWlscyA9IEpTT04ucGFyc2UoCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzKQogICAgICApOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdpZGdldF9kZXRhaWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gd2lkZ2V0X2RldGFpbHNbaV0udmFsdWUgPQogICAgICAgIC8vICAgIi8iICsgdGhpcy5jb21wYW55aWQgKyAiXyIgKyB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZTsKICAgICAgICB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZSA9ICIvIiArIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlOwogICAgICAgIC8vIGlmICh0aGlzLmRlZmF1bHRfcmV0YWlsX2dyZWV0aW5ncy5pbmNsdWRlcyh3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZSkpIHsKICAgICAgICAvLyAgIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlID0gIi8iICsgIHdpZGdldF9kZXRhaWxzW2ldLnZhbHVlOwogICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgLy8gICB3aWRnZXRfZGV0YWlsc1tpXS52YWx1ZSA9CiAgICAgICAgLy8gICAgICIvIiArIHRoaXMuY29tcGFueWlkICsgIl8iICsgd2lkZ2V0X2RldGFpbHNbaV0udmFsdWU7CiAgICAgICAgLy8gfQogICAgICB9CiAgICAgIGlmICh3aWRnZXRfZGV0YWlscy5sZW5ndGggPiAwKSB7CiAgICAgICAgaWYgKHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBkZWxldGUgdGhpcy5ib3RfZ3JlZXRpbmdzW2ldLmJ1dHRvbnM7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3NbCiAgICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5ncy5sZW5ndGggLSAxCiAgICAgICAgICBdLmJ1dHRvbnMgPSB3aWRnZXRfZGV0YWlsczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLnB1c2goewogICAgICAgICAgICBidXR0b25zOiB3aWRnZXRfZGV0YWlscwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuYmlnX3NwaW5uZXIgPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLndpZGdldF9zZXR0aW5nX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZWRpdF9ncmVldGluZ3M6IHRydWUsCiAgICAgICAgICAgIGJvdF9ncmVldGluZ3M6IHRoaXMuYm90X2dyZWV0aW5ncywKICAgICAgICAgICAgY29uZnVzaW9uX21zZzogdGhpcy5ib3Rfc3R5bGluZy5pc19jb25mdXNpb25fbXNnCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLmJpZ19zcGlubmVyID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkFEREVEX1dJREdFVF9TRVRUSU5HU19TVUNDRVNTRlVMTFlfNDAxOC5NU0dfQ09ERSkgewogICAgICAgICAgICBzd2FsKHsKICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgiYm90X2NvbmZpZ19zZXR0aW5nc191cGRhdGVkX3RleHQyIiksCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAyNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZ2V0X3dpZGdldF9zZXR0aW5ncygpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgdGhpcy5iaWdfc3Bpbm5lciA9IGZhbHNlOwogICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX2Vycl9tc2dfdGV4dDIiKSwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGltZXI6IDI1MDAKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5nZXRfd2lkZ2V0X3NldHRpbmdzKCk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICBnZW5lcmF0ZVVVSUQoKSB7CiAgICAgIC8vIFB1YmxpYyBEb21haW4vTUlUCiAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IC8vVGltZXN0YW1wCiAgICAgIHZhciBkMiA9CiAgICAgICAgKHBlcmZvcm1hbmNlICYmIHBlcmZvcm1hbmNlLm5vdyAmJiBwZXJmb3JtYW5jZS5ub3coKSAqIDEwMDApIHx8IDA7IC8vVGltZSBpbiBtaWNyb3NlY29uZHMgc2luY2UgcGFnZS1sb2FkIG9yIDAgaWYgdW5zdXBwb3J0ZWQKICAgICAgcmV0dXJuICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oCiAgICAgICAgYwogICAgICApIHsKICAgICAgICB2YXIgciA9IE1hdGgucmFuZG9tKCkgKiAxNjsgLy9yYW5kb20gbnVtYmVyIGJldHdlZW4gMCBhbmQgMTYKICAgICAgICBpZiAoZCA+IDApIHsKICAgICAgICAgIC8vVXNlIHRpbWVzdGFtcCB1bnRpbCBkZXBsZXRlZAogICAgICAgICAgciA9IChkICsgcikgJSAxNiB8IDA7CiAgICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL1VzZSBtaWNyb3NlY29uZHMgc2luY2UgcGFnZS1sb2FkIGlmIHN1cHBvcnRlZAogICAgICAgICAgciA9IChkMiArIHIpICUgMTYgfCAwOwogICAgICAgICAgZDIgPSBNYXRoLmZsb29yKGQyIC8gMTYpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGMgPT09ICJ4IiA/IHIgOiAociAmIDB4MykgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgfSk7CiAgICB9LAogICAgY2hlY2tfYWN0aXZlX2J0bl9mb3JfZ3JlZXRpbmcoaWQpIHsKICAgICAgbGV0IGJ0bl9ncmVldGluZ3Nfc3RhdHVzID0gdGhpcy5nZXRfYnRuX2dyZWV0aW5nX3Zpc2libGVfc3RhdHVzKCk7CiAgICAgIGlmICgKICAgICAgICBidG5fZ3JlZXRpbmdzX3N0YXR1c1swXSA9PT0gdHJ1ZSAmJgogICAgICAgIGJ0bl9ncmVldGluZ3Nfc3RhdHVzWzFdID09PSBmYWxzZQogICAgICApIHsKICAgICAgICB0aGlzLm9uZV9ncmVldGluZ19zd2FsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuYm90X2dyZWV0aW5nc1sKICAgICAgICAgICAgdGhpcy5ib3RfZ3JlZXRpbmdzLmZpbmRJbmRleChpID0+IGkuaWQgPT09IGlkKQogICAgICAgICAgXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZ3JlZXRpbmdzX2tleSArPSAxOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNoZWNrX29uZV9ncmVldGluZ19lbmFibGVkKGlkKSB7CiAgICAgIGxldCBidG5fZ3JlZXRpbmdzX3N0YXR1cyA9IHRoaXMuZ2V0X2J0bl9ncmVldGluZ192aXNpYmxlX3N0YXR1cygpOwogICAgICBpZiAoCiAgICAgICAgYnRuX2dyZWV0aW5nc19zdGF0dXNbMF0gPT09IHRydWUgJiYKICAgICAgICBidG5fZ3JlZXRpbmdzX3N0YXR1c1sxXSA9PT0gZmFsc2UKICAgICAgKSB7CiAgICAgICAgdGhpcy5vbmVfZ3JlZXRpbmdfc3dhbCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLndpZGdldF9idXR0b25zX2RldGFpbHNbCiAgICAgICAgICAgIHRoaXMud2lkZ2V0X2J1dHRvbnNfZGV0YWlscy5maW5kSW5kZXgoaSA9PiBpLmlkID09PSBpZCkKICAgICAgICAgIF0udmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy5idXR0b25zX2tleSArPSAxOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdldF9idG5fZ3JlZXRpbmdfdmlzaWJsZV9zdGF0dXMoKSB7CiAgICAgIHJldHVybiBbCiAgICAgICAgdGhpcy53aWRnZXRfYnV0dG9uc19kZXRhaWxzCiAgICAgICAgICAubWFwKGl0ZW0gPT4gewogICAgICAgICAgICByZXR1cm4gaXRlbS52aXNpYmxlOwogICAgICAgICAgfSkKICAgICAgICAgIC5pbmNsdWRlcyh0cnVlKSwKICAgICAgICB0aGlzLmJvdF9ncmVldGluZ3MKICAgICAgICAgIC5tYXAoaXRlbSA9PiB7CiAgICAgICAgICAgIHJldHVybiBpdGVtLnZpc2libGU7CiAgICAgICAgICB9KQogICAgICAgICAgLmluY2x1ZGVzKHRydWUpCiAgICAgIF07CiAgICB9LAogICAgb25lX2dyZWV0aW5nX3N3YWwoKSB7CiAgICAgIHN3YWwoewogICAgICAgIHRleHQ6IHRoaXMudGx0KCJib3RfY29uZmlnX29uZV9ncmVldGluZ19tc2ciKSwKICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIHRpbWVyOiA1NTAwCiAgICAgIH0pOwogICAgfSwKICAgIHNhdmVfbGFuZ3VhZ2VfY2hhdGJvdCgpewogICAgICBpZih0aGlzLmxhbmd1YWdlX2NvZGUgPT0gbnVsbCl7CiAgICAgICAgIHN3YWwoewogICAgICAgICAgdGV4dDogIlBsZWFzZSBzZWxlY3QgbGFuZ3VhZ2UiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgdGltZXI6IDMwMDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBsZXQgbGFuZ3VhZ2UgPSB0aGlzLmxhbmd1YWdlX2NvZGUubGFuZzsKICAgICAgbGV0IGxhbmdfY29kZSA9IHRoaXMubGFuZ3VhZ2VfY29kZS52YWx1ZTsKICAgICAgYXhpb3MuCiAgICAgICAgcG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5wb3J0YWxfbGFuZ3VhZ2VfZGF0YSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgY2hhdGJvdF9sYW5ndWFnZV9jb2RlOmxhbmdfY29kZSwKICAgICAgICAgICAgY2hhdGJvdF9sYW5ndWFnZTogbGFuZ3VhZ2UsCiAgICAgICAgICAgIHNhdmVfY2hhdGJvdF9sYW5ndWFnZTogdHJ1ZSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuTEFOR1VBR0VfVVBEQVRFRC5NU0dfQ09ERSl7CiAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJCb3QgTGFuZ3VhZ2UgVXBkYXRlIFN1Y2Nlc3NmdWxseSIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHRpbWVyOiAzMDAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgdXNlcmluZm8gPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIik7CiAgICAgICAgICAgIHVzZXJpbmZvWyJpc19zZXRfZGVmYXVsdF9sYW5ndWFnZSJdID0gZmFsc2U7CiAgICAgICAgICAgIHVzZXJpbmZvWyJjaGF0Ym90X2xhbmd1YWdlIl0gPSBsYW5ndWFnZTsKICAgICAgICAgICAgdXNlcmluZm9bImNoYXRib3RfbGFuZ3VhZ2VfY29kZSJdID0gbGFuZ19jb2RlOwogICAgICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgiVXNlckluZm9ybWF0aW9uIiwgdXNlcmluZm8pOyAKICAgICAgICAgIH1lbHNlIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5VTlNVQ0NFU1NGVUxfREJfT1BFUkFUSU9OLk1TR19DT0RFKXsKICAgICAgICAgICAgIHN3YWwoewogICAgICAgICAgICAgIHRleHQ6ICJVbmFibGUgdG8gdXBkYXRlIEJvdCBMYW5ndWFnZSIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1lbmQiLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMzAwMAogICAgICAgICAgICB9KTsKICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogIH0sCn07Cg=="},null]}