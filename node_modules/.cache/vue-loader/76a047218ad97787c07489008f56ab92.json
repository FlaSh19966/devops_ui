{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/CouponCodes.vue?vue&type=style&index=0&id=bda05984&scoped=true&lang=css&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/ProductManagement/CouponCodes.vue","mtime":1655807120961},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouc3dpdGNoIHsKICBtYXJnaW4tbGVmdDogMXJlbTsKfQouZGlzYy1jb3Vwb24tY29kZS1oZWFkaW5nIHsKICBmb250LXNpemU6IDEuMjVyZW07CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KLmRhcmtibHVlLWJ0biB7CiAgZm9udC1zaXplOiAxNHB4ICFpbXBvcnRhbnQ7CiAgcGFkZGluZzogNnB4IDE1cHggIWltcG9ydGFudDsKfQo="},{"version":3,"sources":["CouponCodes.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAydA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CouponCodes.vue","sourceRoot":"src/portal/Chatbot/Dashboard/ProductManagement","sourcesContent":["<template>\n  <div>\n    <div class=\"spinner\" id=\"spinner\" v-show=\"spinnerOn\"></div>\n    <div class=\"col-sm-12 mb-1 d-flex px-0\">\n      <span class=\"disc-coupon-code-heading\">{{tlt('coupon_codes_discount_header')}}</span>\n      <button\n        @click=\"sync_coupons\"\n        style=\"margin-right: 1rem\"\n        class=\"darkblue-btn ml-auto\">\n        {{tlt('coupon_codes_sync_btn_label')}}\n      </button>\n      <button\n        id=\"save_coupon_codes_button\"\n        type=\"button\"\n        class=\"darkblue-btn my-auto\"\n        title=\"Save Coupon Details\"\n        @click=\"save_all_coupon_codes_data()\"\n        v-if=\"company_coupon_codes.length > 0\"\n      >\n        {{tlt('coupon_codes_save_all_btn_label')}}\n      </button>\n    </div>\n    <div class=\"col-sm-12 d-flex p-0\">\n      <div class=\"p-0\" style=\"width: 100%\">\n        <div class=\"table-box\">\n          <div class=\"table-responsive\">\n            <table\n              class=\"table table-bordered\"\n              v-if=\"company_coupon_codes.length > 0\"\n            >\n              <thead>\n                <tr>\n                  <th style=\"color: #414141\" scope=\"col\">#</th>\n                  <th style=\"text-align: center; color: #414141\" scope=\"col\">\n                    {{tlt('coupon_codes_name_table_label')}}\n                  </th>\n                  <th style=\"color: #414141\" scope=\"col\">{{tlt('coupon_codes_discount_table_label')}}</th>\n                  <th style=\"text-align: center; color: #414141\" scope=\"col\">\n                    {{tlt('coupon_codes_date_created_table_label')}}\n                  </th>\n                  <th style=\"color: #414141\" scope=\"col\">{{tlt('coupon_codes_starts_at_table_label')}}</th>\n                  <th style=\"color: #414141\" scope=\"col\">{{tlt('coupon_codes_ends_at_table_label')}}</th>\n                  <th style=\"color: #414141\" scope=\"col\">{{tlt('coupon_codes_visible_on_bot_label')}}</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr\n                  v-for=\"(coupon, index) in company_coupon_codes\"\n                  :key=\"index\"\n                >\n                  <td style=\"text-align: center\">{{ index + 1 }}</td>\n                  <td style=\"text-align: center; width: auto\">\n                    <!-- {{ Object.keys(coupon) }} -->\n                    {{ Boolean(coupon.title) ? coupon.title: coupon.discount_code  }}\n                  </td>\n                  <td style=\"text-align: center; width: auto\">\n                    {{ coupon.discount_code }}\n                  </td>\n                  <td style=\"text-align: center; width: auto\">\n                    {{ format_date(coupon.created_at) }}\n                  </td>\n                  <td style=\"text-align: center; width: auto\">\n                    {{ format_date(coupon.starts_at) }}\n                  </td>\n                  <td style=\"text-align: center; width: auto\">\n                    {{ format_date(coupon.ends_at) }}\n                  </td>\n                  <td style=\"text-align: center; width: auto\">\n                    <!-- {{ coupon.visible_on_bot }} -->\n                    <label class=\"switch\" style=\"margin-top: 0px\">\n                      <input\n                        type=\"checkbox\"\n                        v-model=\"coupon.visible_on_bot\"\n                        id=\"email_required_id\"\n                      />\n                      <span\n                        class=\"slider round\"\n                        style=\"border-radius: 20px\"\n                      ></span>\n                    </label>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <div class=\"text-center\" v-else-if=\"company_coupon_codes.length == 0 & !spinnerOn\">\n               <span class=\"disc-coupon-code-heading\"> {{tlt('coupon_codes_no_codes_text')}} </span>\n            </div>\n          </div>\n          <div class=\"pagin-table\" style=\"margin: 0\" v-if=\"company_coupon_codes.length > 0\">\n            <nav aria-label=\"Page navigation example\">\n              <ul class=\"pagination justify-content-center\">\n                <li class=\"page-item\">\n                  <a\n                    class=\"page-link\"\n                    href=\"#\"\n                    @click=\"page_change(page_no - 1)\"\n                  >\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      width=\"8.667\"\n                      height=\"15.204\"\n                      viewBox=\"0 0 8.667 15.204\"\n                    >\n                      <g\n                        id=\"arrow-point-to-left\"\n                        transform=\"translate(105.806 15.204) rotate(180)\"\n                      >\n                        <path\n                          id=\"Path_1136\"\n                          data-name=\"Path 1136\"\n                          d=\"M105.493,8.354l-6.537,6.537a1.065,1.065,0,1,1-1.506-1.506L103.235,7.6,97.45,1.817A1.065,1.065,0,0,1,98.956.312l6.537,6.537a1.065,1.065,0,0,1,0,1.505Z\"\n                          transform=\"translate(0 0)\"\n                          fill=\"#9499ae\"\n                        />\n                      </g>\n                    </svg>\n                  </a>\n                </li>\n                <li\n                  :class=\"'page-item ' + pagination_class(pageno)\"\n                  v-for=\"pageno in page_array\"\n                  :key=\"pageno\"\n                >\n                  <a\n                    v-if=\"pageno == '...s' || pageno == '...l'\"\n                    class=\"page-link\"\n                    href=\"#\"\n                    @click=\"page_change(pageno)\"\n                    >...</a\n                  >\n                  <a\n                    v-if=\"pageno != '...s' && pageno != '...l'\"\n                    class=\"page-link\"\n                    href=\"#\"\n                    @click=\"page_change(pageno)\"\n                    >{{ pageno }}</a\n                  >\n                </li>\n                <li class=\"page-item\">\n                  <a\n                    class=\"page-link\"\n                    href=\"#\"\n                    @click=\"page_change(page_no + 1)\"\n                  >\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      width=\"8.667\"\n                      height=\"15.204\"\n                      viewBox=\"0 0 8.667 15.204\"\n                    >\n                      <g\n                        id=\"arrow-point-to-right\"\n                        transform=\"translate(-97.139 0)\"\n                      >\n                        <path\n                          id=\"Path_1136\"\n                          data-name=\"Path 1136\"\n                          d=\"M105.493,8.354l-6.537,6.537a1.065,1.065,0,1,1-1.506-1.506L103.235,7.6,97.45,1.817A1.065,1.065,0,0,1,98.956.312l6.537,6.537a1.065,1.065,0,0,1,0,1.505Z\"\n                          transform=\"translate(0 0)\"\n                          fill=\"#9499ae\"\n                        />\n                      </g>\n                    </svg>\n                  </a>\n                </li>\n              </ul>\n            </nav>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport api_calls from \"@/portal/api_calls\";\nimport swal from \"sweetalert2\";\nimport moment from \"moment\";\nimport { freeze_portal, show_subscription_expired_swal } from \"@/portal/mixins\";\n\nexport default {\n  name: \"CouponCodes\",\n  mixins: [freeze_portal, show_subscription_expired_swal],\n  data() {\n    return {\n      spinnerOn: false,\n      company_id: this.$session.get(\"UserInformation\").company_id,\n      company_name: this.$session.get(\"UserInformation\").company_name,\n      company_coupon_codes: [],\n      per_page: 10,\n      total_pages: null,\n      number_of_rows: null,\n      page_no: 1,\n      page_array: [],\n      disable_btn_expired: false,\n    };\n  },\n  mounted() {\n    this.get_all_coupon_codes();\n    setTimeout(() => {\n      this.freeze_portal();\n    }, 3000);\n    this.$root.$on(\"CouponCodesDisabled\", (data) =>{\n      if(data===true){\n        this.disable_btn_expired = true\n      }\n    });\n  },\n  methods: {\n    sync_coupons() {\n      this.spinnerOn = true;\n      axios\n        .post(api_calls.retail_coupon_codes(), {\n          company_id: this.company_id,\n          company_name: this.company_name,\n          template_id: this.retail_bot_template_id,\n          is_sync: true,\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${this.$session.get(\"at\")}`,\n        },\n        })\n        .then(({ data }) => {\n          this.spinnerOn = false;\n          if (data.status == \"Success\"){\n            if (data.message == \"Coupons found\"){\n              swal({\n              title: \"Latest coupons are synced\",\n              type: \"success\",\n              showCancelButton: false,\n              timer: 2500,\n            })\n            this.get_all_coupon_codes();\n            }\n            if (data.message == \"No Coupons found\"){\n              swal({\n              title: \"No Coupons found\",\n              type: \"warning\",\n              showCancelButton: false,\n              timer: 2500,\n            })\n            }\n          }else {\n            swal({\n              title: \"Some Error Occurred!\",\n              text: \"Please try again!\",\n              type: \"error\",\n              showCancelButton: false,\n            });\n          }\n        }).catch((e) => {\n          this.spinnerOn = false;\n            if (\n              e.response.status === 410 ||\n              e.response.status === 440 ||\n              e.response.status === 409\n            ) {\n              this.$root.$emit(\"Session_Expired\", e.response.data);\n            }\n          });\n    },\n    get_all_coupon_codes() {\n      this.spinnerOn = true;\n      axios\n        .post(\n          api_calls.retail_coupon_codes(),\n          {\n            is_get: true,\n            company_id: this.company_id,\n            company_name: this.company_name,\n            page_no: this.page_no,\n            per_page: this.per_page,\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${this.$session.get(\"at\")}`,\n            },\n          }\n        )\n        .then(({ data }) => {\n          this.spinnerOn = false;\n          if (data.Status === \"Failure\") {\n            this.company_coupon_codes = [];\n          } else if (data.Status === \"Success\") {\n            this.company_coupon_codes = data.Data;\n            this.total_pages = data.PageCount;\n            for (let i = 0; i < this.company_coupon_codes.length; i++) {\n              if (\n                ![true, false].includes(\n                  this.company_coupon_codes[i].visible_on_bot\n                )\n              ) {\n                this.company_coupon_codes[i].visible_on_bot = false;\n              }\n              // this.company_coupon_codes[i].date_valid =\n              //   this.check_valid_end_date(this.company_coupon_codes[i].ends_at);\n            }\n            this.company_coupon_codes.sort((a, b) =>\n              a.visible_on_bot < b.visible_on_bot ? 1 : -1\n            );\n            this.setpagination(this.page_no);\n          }\n        })\n        .catch((e) => {\n          this.spinnerOn = false;\n          swal({\n            title: \"Some Error Occurred\",\n            text: \"Please Refresh or Try Again!\",\n            type: \"error\",\n            showCancelButton: false,\n          });\n          if (Boolean(e.response)) {\n            if (\n              e.response.status === 410 ||\n              e.response.status === 440 ||\n              e.response.status === 409\n            ) {\n              this.$root.$emit(\"Session_Expired\", e.response.data);\n            }\n          }\n        });\n    },\n    format_date(date) {\n      if(date == null) {\n        return \"N/A\"\n      }\n      return moment(date).format(\"Do MMM YYYY\");\n    },\n    check_valid_end_date(end_date) {\n      let current_date = new Date();\n      end_date = new Date(end_date);\n      if (current_date.getTime() > end_date.getTime()) {\n        return false;\n      }\n      return true;\n    },\n    save_all_coupon_codes_data() {\n      if(!this.disable_btn_expired){\n      swal({\n        title: \"Are you sure?\",\n        text: \" You want to save this coupons data?\",\n        type: \"question\",\n        showCancelButton: true,\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        confirmButtonText: \"Yes, Confirm!\",\n      }).then((result) => {\n        if (result.value) {\n          this.spinnerOn = true;\n          axios\n            .post(\n              api_calls.retail_coupon_codes(),\n              {\n                is_save: true,\n                company_id: this.company_id,\n                company_name: this.company_name,\n                company_coupon_codes: this.company_coupon_codes,\n              },\n              {\n                headers: {\n                  Authorization: `Bearer ${this.$session.get(\"at\")}`,\n                },\n              }\n            )\n            .then(({ data }) => {\n              this.spinnerOn = false;\n              if (data.Status === \"Success\") {\n                swal({\n                  title: \"Success!\",\n                  text: \" Your coupons data is saved successfully\",\n                  type: \"success\",\n                  showCancelButton: false,\n                });\n                this.get_all_coupon_codes();\n              } else {\n                swal({\n                  title: \"Some Error Occurred!\",\n                  text: \"Please try again!\",\n                  type: \"success\",\n                  showCancelButton: false,\n                });\n              }\n            })\n            .catch((e) => {\n              this.spinnerOn = false;\n              swal({\n                title: \"Some Error Occurred\",\n                text: \"Please Refresh or Try Again!\",\n                type: \"error\",\n                showCancelButton: false,\n              });\n              if (Boolean(e.response)) {\n                if (\n                  e.response.status === 410 ||\n                  e.response.status === 440 ||\n                  e.response.status === 409\n                ) {\n                  this.$root.$emit(\"Session_Expired\", e.response.data);\n                }\n              }\n            });\n        }\n      });}else{\n        this.show_subscription_expired_swal()\n      }\n    },\n    pagination_class(index) {\n      if (index == this.page_no) {\n        return \" active\";\n      } else {\n        return \"\";\n      }\n    },\n    setpagination(page_no) {\n      this.page_array = [];\n      if (this.total_pages <= 7) {\n        for (let i = 0; i < this.total_pages; i++) {\n          this.page_array.push(i + 1);\n        }\n      } else if (page_no == 1) {\n        for (let i = 0; i < 4; i++) {\n          this.page_array.push(i + 1);\n        }\n        this.page_array.push(\"...l\");\n        this.page_array.push(this.total_pages);\n      } else if (page_no == this.total_pages) {\n        this.page_array.push(1);\n        this.page_array.push(\"...s\");\n        for (let i = this.total_pages - 4; i < this.total_pages; i++) {\n          this.page_array.push(i + 1);\n        }\n      } else if (page_no <= 4) {\n        for (let i = 0; i < page_no + 3; i++) {\n          this.page_array.push(i + 1);\n        }\n        this.page_array.push(\"...l\");\n        this.page_array.push(this.total_pages);\n      } else if (page_no >= this.total_pages - 4) {\n        this.page_array.push(1);\n        this.page_array.push(\"...s\");\n        for (let i = page_no - 4; i < this.total_pages; i++) {\n          this.page_array.push(i + 1);\n        }\n      } else {\n        this.page_array.push(1);\n        this.page_array.push(\"...s\");\n        for (let i = page_no - 3; i <= page_no + 3; i++) {\n          this.page_array.push(i);\n        }\n        this.page_array.push(\"...l\");\n        this.page_array.push(this.total_pages);\n      }\n    },\n    page_change(pageno) {\n      if (pageno == 0 || pageno == this.total_pages + 1) {\n      } else {\n        if (pageno == \"...s\") {\n          this.page_no = Math.ceil((1 + this.page_no) / 2);\n        } else if (pageno == \"...l\") {\n          this.page_no = Math.ceil((this.total_pages + this.page_no) / 2);\n        } else {\n          this.page_no = pageno;\n        }\n        this.get_all_coupon_codes();\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.switch {\n  margin-left: 1rem;\n}\n.disc-coupon-code-heading {\n  font-size: 1.25rem;\n  font-weight: bold;\n}\n.darkblue-btn {\n  font-size: 14px !important;\n  padding: 6px 15px !important;\n}\n</style>\n"]}]}