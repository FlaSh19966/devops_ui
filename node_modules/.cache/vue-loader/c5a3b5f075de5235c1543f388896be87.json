{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/VerifyResponsesUserFeedback.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/VerifyResponsesUserFeedback.vue","mtime":1663910265470},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBzd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IFN3YWwgZnJvbSAic3dlZXRhbGVydDIiOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgTXVsdGlzZWxlY3QgZnJvbSAidnVlLW11bHRpc2VsZWN0IjsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICdWZXJpZnlSZXNwb25zZXNVc2VyRmVlZGJhY2snLAogICAgY29tcG9uZW50czogewogICAgICAgIE11bHRpc2VsZWN0LAogICAgfSwKICAgIHdhdGNoOiB7CiAgICBzZWxlY3RlZF91c2VyX2xpc3QobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgaWYgKG5ld1ZhbC5sZW5ndGggPT09IDApIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfdXNlcl9saXN0ID0gWyJObyJdOwogICAgICAgIH0sIDIwMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYWdlX25vID0gMTsKICAgICAgICB0aGlzLnNlbGVjdGVkX3VzZXJfbGlzdCA9IG5ld1ZhbAogICAgICAgICQoIiNzZWxlY3RhbGwiKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIHRoaXMubG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2soKTsKICAgICAgfQogICAgfSwKICB9LAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgIHVuYW5zd2VyZWRfbGlzdDogW10sCiAgICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgIGludGVudF9saXN0OiBbXSwKICAgICAgICBjaGVja2VkX2xpc3Q6IFtdLAogICAgICAgIHVzZXJfbGlzdDogWyJZZXMiLCAiTm8iXSwKICAgICAgICBzZWxlY3RlZF91c2VyX2xpc3Q6IFsiWWVzIiwiTm8iXSwKICAgICAgICBpbnRlbnRsaXN0OiAiIiwKICAgICAgICBwZXJfcGFnZTogMTAsCiAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICB0b3RhbF9wYWdlczogMCwKICAgICAgICBzaG93X2xvYWRlcjogZmFsc2UsCiAgICAgICAgbnVtYmVyX29mX3Jvd3M6IG51bGwsCiAgICAgICAgc2VhcmNoX25hbWU6ICIiLAogICAgICAgIHBhZ2VfYXJyYXk6IFtdLAogICAgICAgIG9sZF9xdWVzdGlvbjogIiIsCiAgICAgICAgb2xkX2ludGVudDogIiIsCiAgICAgICAgbmV3X2ludGVudF9saXN0OiBbXSwKICAgICAgICBvbGRfZGF0YTogeyBxdWVzdGlvbjogbnVsbCwgaW50ZW50OiBudWxsIH0sCiAgICAgICAgdGh1bWJzX2Rvd25faWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9Hcm91cCA2MS5zdmciKSwKICAgICAgICB0aHVtYnNfdXBfaWNvbjogcmVxdWlyZSgiQC9wb3J0YWwvYXNzZXRzL2ltZy9Hcm91cCA3MS5zdmciKSwKICAgICAgICAvLyB2aWV3X2NvbXBvbmVudF9uYW1lOiAidW5hbnN3ZXJlZF9xdWVzdGlvbnMiLAogICAgICAgIH07CiAgICB9LAogICAgbW91bnRlZCgpIHsKICAgICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAgICQoIiNzZWxlY3RhbGwiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAgICAgJCgiLmNoZWNraW5nIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAkKCIuY2hlY2tpbmciKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyb290LiRvbigiYWRkX3F1ZXN0aW9uc191c2VyX3Jlc3BvbnNlcyIsIChkYXRhKSA9PiB7CiAgICAgICAgICAgIHRoaXMuYWRkX3F1ZXN0aW9ucygpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuJHJvb3QuJG9uKCJzZWFyY2hfdXNlcl9yZXNwb25zZXMiLCAoZGF0YSkgPT4gewogICAgICAgICAgICB0aGlzLnNlYXJjaF9uYW1lID0gZGF0YTsKICAgICAgICAgICAgdGhpcy5zZWFyY2hfcXVlc3Rpb24oKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyb290LiRvbigiZGVsZXRlX211bHRpcGxlX3VzZXJfcmVzcG9uc2VzIiwgKGRhdGEpID0+IHsKICAgICAgICAgICAgdGhpcy5kZWxldGVfbXVsdGlwbGUoKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyb290LiRvbigibG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2siLCAoZGF0YSkgPT4gewogICAgICAgICAgICB0aGlzLmxvYWRfdmVyaWZ5X3Jlc3BvbnNlc191c2VyX2ZlZWRiYWNrKCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgIGJlZm9yZURlc3Ryb3koKSB7CiAgICAgICAgdGhpcy4kcm9vdC4kb2ZmKCJhZGRfcXVlc3Rpb25zX3VzZXJfcmVzcG9uc2VzIik7CiAgICAgICAgdGhpcy4kcm9vdC4kb2ZmKCJzZWFyY2hfdXNlcl9yZXNwb25zZXMiKTsKICAgICAgICB0aGlzLiRyb290LiRvZmYoImRlbGV0ZV9tdWx0aXBsZV91c2VyX3Jlc3BvbnNlcyIpOwogICAgICAgIHRoaXMuJHJvb3QuJG9mZigibG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2siKTsKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICB0aGlzLmxvYWRfdmVyaWZ5X3Jlc3BvbnNlc191c2VyX2ZlZWRiYWNrKCk7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGxvYWRfdmVyaWZ5X3Jlc3BvbnNlc191c2VyX2ZlZWRiYWNrKCl7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAvLyAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3QgPSBbXTsKICAgICAgICB0aGlzLmludGVudF9saXN0ID0gW107CiAgICAgICAgdGhpcy5uZXdfaW50ZW50X2xpc3QgPSBbXTsKICAgICAgICB0aGlzLnNlYXJjaF9uYW1lID0gIiI7CiAgICAgICAgaWYgKHRoaXMudXNlcl9yb2xlID09ICJTdXBlckFkbWluIikgewogICAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueUlkIik7CiAgICAgICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiQ29tcGFueU5hbWUiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkOwogICAgICAgIHRoaXMuY29tcGFueW5hbWUgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5jb21wYW55bmFtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5nZXRfdW5hbnN3ZXJlZF91cmwoKSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgaXNEZWxldGU6ICJGYWxzZSIsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIGlzX2dldF91c2VyX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLnNlbGVjdGVkX3VzZXJfbGlzdAoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YTsKICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gIHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICB0aGlzLnVuYW5zd2VyZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YVswXSkgewogICAgICAgICAgICAgICAgICBsZXQgdGVtcF9pbnQgPSAiIjsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YVsyXVtpXSk7CiAgICAgICAgICAgICAgICAgIGlmIChCb29sZWFuKGRhdGFbMl1baV0pKSB7CiAgICAgICAgICAgICAgICAgIC8vIHRlbXBfaW50ID0gZGF0YVsyXVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIik7CiAgICAgICAgICAgICAgICAgIHRlbXBfaW50ID0gZGF0YVsyXVtpXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZW1wX2ludCk7CiAgICAgICAgICAgICAgICAgIHRoaXMudW5hbnN3ZXJlZF9saXN0LnB1c2goewogICAgICAgICAgICAgICAgICBxdWVzdGlvbjogZGF0YVswXVtpXSwKICAgICAgICAgICAgICAgICAgaW50ZW50OiB0ZW1wX2ludCwKICAgICAgICAgICAgICAgICAgbmV3X2ludGVudDogIiIsCiAgICAgICAgICAgICAgICAgIHNvdXJjZTogZGF0YVsxXVtpXSwKICAgICAgICAgICAgICAgICAgdXNlcl9yZXNwb25zZTogZGF0YVsyXVtpXSwKICAgICAgICAgICAgICAgICAgdXNlcl9mZWVkYmFjazogZGF0YVszXVtpXSwKICAgICAgICAgICAgICAgICAgZWRpdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgIH1lbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLk5PX0RBVEFfQVZBSUxBQkxFLk1TR19DT0RFKXsKICAgICAgICAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfZGF0YSA9PSB1bmRlZmluZWQgPyAwIDogcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gIHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlID09IHVuZGVmaW5lZCA/IDAgOiByZXNwb25zZS5kYXRhLnBhZ2luYXRpb24udG90YWxfcGFnZTsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX25vX3FzX2ZvdW5kX21zZycpLAogICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgdGltZXI6IDI1MDAsCiAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoZS5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuZ2V0X3VuYW5zd2VyZWRfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgaXNEcm9wZG93bjogIlRydWUiLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhWzBdKSB7CiAgICAgICAgICAgIC8vIHRoaXMuaW50ZW50X2xpc3QucHVzaCgKICAgICAgICAgICAgLy8gICAgIHJlc3BvbnNlLmRhdGFbMF1baV0ucmVwbGFjZSh0aGlzLmNvbXBhbnlpZCArICJfIiwgIiIpCiAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgIC8vIHRoaXMubmV3X2ludGVudF9saXN0LnB1c2goCiAgICAgICAgICAgIC8vICAgICByZXNwb25zZS5kYXRhWzBdW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKQogICAgICAgICAgICAvLyApOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRBVEFfQVZBSUxBQkxFLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGFbMF0pIHsKICAgICAgICAgICAgICAgIHRoaXMuaW50ZW50X2xpc3QucHVzaCgKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmRhdGFbMF1baV0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB0aGlzLm5ld19pbnRlbnRfbGlzdC5wdXNoKAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZGF0YVswXVtpXQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9ICAgICAKICAgICAgICAgICAgfWVsc2UgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtZW5kIiwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgdHlwZTogImluZm8iCiAgICAgICAgICAgICAgICB9KTsgICAgCiAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkgPSBbXTsKICAgICAgICBpZiAodGhpcy50b3RhbF9wYWdlcyA8PSA3KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLnMiKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA8PSA0KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2godGhpcy50b3RhbF9wYWdlcyk7CiAgICAgICAgfSBlbHNlIGlmIChwYWdlX25vID49IHRoaXMudG90YWxfcGFnZXMgLSA0KSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gcGFnZV9ubyAtIDQ7IGkgPCB0aGlzLnRvdGFsX3BhZ2VzOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goMSk7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKGkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5sIik7CiAgICAgICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhZ2VfcmVxdWlyZShwYWdlKSB7CiAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAvLyAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgaWYgKHBhZ2UgPT0gMCB8fCBwYWdlID09IHRoaXMudG90YWxfcGFnZXMgKyAxKSB7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJCgiLmNoZWNraW5nIikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgJCgiI3NlbGVjdGFsbCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChwYWdlID09ICIuLi5zIikgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBNYXRoLmNlaWwoKDEgKyB0aGlzLnBhZ2Vfbm8pIC8gMik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2Vfbm8gPSBwYWdlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lID09ICIiKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSB0cnVlOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgICBhcGlfY2FsbHMuZ2V0X3VuYW5zd2VyZWRfdXJsKCksCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgaXNEZWxldGU6ICJGYWxzZSIsCiAgICAgICAgICAgICAgICAgICAgcGFnZV9ubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgICAgIGlzX2dldF91c2VyX3Jlc3BvbnNlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5zZWxlY3RlZF91c2VyX2xpc3QKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuREFUQV9BVkFJTEFCTEUuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuZGF0YVswXSkgewogICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBfaW50ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoQm9vbGVhbihyZXNwb25zZS5kYXRhLmRhdGFbMl1baV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyB0ZW1wX2ludCA9IHJlc3BvbnNlLmRhdGFbMl1baV0ucmVwbGFjZSh0aGlzLmNvbXBhbnlpZCArICJfIiwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgdGVtcF9pbnQgPSByZXNwb25zZS5kYXRhLmRhdGFbMl1baV07CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuYW5zd2VyZWRfbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiByZXNwb25zZS5kYXRhLmRhdGFbMF1baV0sCiAgICAgICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRlbXBfaW50LAogICAgICAgICAgICAgICAgICAgICAgc291cmNlOiByZXNwb25zZS5kYXRhLmRhdGFbMV1baV0sCiAgICAgICAgICAgICAgICAgICAgICB1c2VyX3Jlc3BvbnNlOiByZXNwb25zZS5kYXRhLmRhdGFbMl1baV0sCiAgICAgICAgICAgICAgICAgICAgICB1c2VyX2ZlZWRiYWNrOiByZXNwb25zZS5kYXRhLmRhdGFbM11baV0sCiAgICAgICAgICAgICAgICAgICAgICBlZGl0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsgICAgICAgICAgCiAgICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSB0cnVlOwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgICBhcGlfY2FsbHMuZ2V0X3VuYW5zd2VyZWRfdXJsKCksCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBpc3NlYXJjaDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAvLyBzZWFyY2hieTogdGhpcy5zZWFyY2hfYnksCiAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLnNlYXJjaF9uYW1lLAogICAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgICAgICAgIHBhZ2Vfbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICAgICAgICBpc19nZXRfdXNlcl9yZXNwb25zZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc2VsZWN0ZWRfdXNlcl9saXN0CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhWzRdLnBhZ2Vjb3VudCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IHBhZ2U7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuYW5zd2VyZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEuZGF0YVswXS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5kYXRhWzRdLnBhZ2Vjb3VudDsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLmRhdGFbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wX2ludCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgaWYgKEJvb2xlYW4oZGF0YVsyXVtpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGVtcF9pbnQgPSBkYXRhWzJdW2ldLnJlcGxhY2UodGhpcy5jb21wYW55aWQgKyAiXyIsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9pbnQgPSBkYXRhWzJdW2ldOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb246IHJlc3BvbnNlLmRhdGEuZGF0YVswXVtpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnQ6IHRlbXBfaW50LAogICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogcmVzcG9uc2UuZGF0YS5kYXRhWzFdW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfcmVzcG9uc2U6IHJlc3BvbnNlLmRhdGEuZGF0YVsyXVtpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2ZlZWRiYWNrOiByZXNwb25zZS5kYXRhLmRhdGFbM11baV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgICAgICAvLyB9LCAyNTAwKTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2soKTsKICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBxdWVzdGlvbl9zZWxlY3RlZCh2YWx1ZSkgewogICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAiYWxsIikgewogICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudW5hbnN3ZXJlZF9saXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdC5wdXNoKHRoaXMudW5hbnN3ZXJlZF9saXN0W2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0LnB1c2godGhpcy51bmFuc3dlcmVkX2xpc3RbdmFsdWVdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICghZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAiYWxsIikgewogICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0YWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NlbGVjdGFsbCIpOwogICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0YWxsLmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGFsbC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmNoZWNrZWRfbGlzdC5maWx0ZXIoKHF1ZXN0aW9uKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24gIT09IHRoaXMudW5hbnN3ZXJlZF9saXN0W3ZhbHVlXTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tlZF9saXN0ID0gdGVtcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGVsZXRlX3NpbmdsZShpbmRleCkgewogICAgICAgICAgICBsZXQgcXVlc3Rpb25saXN0ID0gW107CiAgICAgICAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICB0aXRsZTogdGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfZGVsZXRlX3N3YWxfbXNnJyksCiAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnRsdCgndXNlcl9mZWVkYmFja19kZWxldGVfdGhpc19xc19tc2cnKSwKICAgICAgICAgICAgICAgIHR5cGU6ICJxdWVzdGlvbiIsCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAiIzMwODVkNiIsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogIiNkMzMiLAogICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX2RlbGV0ZV9zd2FsX2NvbmZpcm1fbXNnJyksCiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzdWx0LnZhbHVlKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkZWxldGVkIik7CiAgICAgICAgICAgICAgICBxdWVzdGlvbmxpc3QucHVzaCh0aGlzLnVuYW5zd2VyZWRfbGlzdFtpbmRleF0ucXVlc3Rpb24pOwogICAgICAgICAgICAgICAgdGhpcy5kZWxldGVfcXVlc3Rpb25zX2FwaShxdWVzdGlvbmxpc3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGRlbGV0ZV9tdWx0aXBsZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tlZF9saXN0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX2RlbGV0ZV9ub19xc19zZWxlY3RlZF9tc2cnKSwKICAgICAgICAgICAgICAgIHRleHQ6IiIsCiAgICAgICAgICAgICAgICB0eXBlOiJlcnJvciIsCiAgICAgICAgICAgICAgICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jaGVja2VkX2xpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGV0IHF1ZXN0aW9ubGlzdCA9IFtdOwogICAgICAgICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRsdCgndXNlcl9mZWVkYmFja19kZWxldGVfc3dhbF9hbGVydF9tc2cnKSwKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX2RlbGV0ZV90aGlzX3FzX211bHRpcGxlX21zZycpLAogICAgICAgICAgICAgICAgdHlwZTogInF1ZXN0aW9uIiwKICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uQ29sb3I6ICIjMzA4NWQ2IiwKICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvbkNvbG9yOiAiI2QzMyIsCiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogdGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfZGVsZXRlX2NvbmZpcm1fc3dhbF9tc2cnKSwKICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5jaGVja2VkX2xpc3QpIHsKICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbmxpc3QucHVzaCh0aGlzLmNoZWNrZWRfbGlzdFtpXS5xdWVzdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlX3F1ZXN0aW9uc19hcGkocXVlc3Rpb25saXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkZWxldGVfcXVlc3Rpb25zX2FwaShxdWVzdGlvbmxpc3QpIHsKICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmdldF91bmFuc3dlcmVkX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgIHF1ZXN0aW9ubGlzdDogcXVlc3Rpb25saXN0LAogICAgICAgICAgICAgICAgaXNEZWxldGU6ICJUcnVlIiwKICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkRFTEVURURfU1VDQ0VTU0ZVTExZXzAwMDQuTVNHX0NPREUpIHsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkZWxldGVkIHN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICAgICAgdGhpcy5jaGVja2VkX2xpc3QgPSBbXTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgdGhpcy5udW1iZXJfb2Zfcm93cyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9kYXRhOwogICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlOwogICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3ModGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfZGVsZXRlX3N1Y2Nlc3NfbXNnJykpOwogICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgIC8vIH0sIDE1MDApOwogICAgICAgICAgICAgICAgaWYocXVlc3Rpb25saXN0Lmxlbmd0aCA9PT0gdGhpcy51bmFuc3dlcmVkX2xpc3QubGVuZ3RoICYmIAogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA+MSl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlKHRoaXMucGFnZV9ubyA+IDEgJiYgdGhpcy5wYWdlX25vID4gdGhpcy50b3RhbF9wYWdlcyl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2soKTsKICAgICAgICAgICAgfWVsc2UgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSl7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgIH0pCgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSA9PT0gdGhpcy5hcGlfc3RhdHVzX2NvZGUuVU5TVUNDRVNTRlVMX0RCX1FVRVJZLk1TR19DT0RFKXsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdHlwZTogImluZm8iLAogICAgICAgICAgICAgICAgdGV4dDogcmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TRywKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAoKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIFN3YWwoewogICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgIHRleHQ6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0csCiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVyOiAyNTAwLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihlLm1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBlZGl0X2l0ZW0oaW5kZXgpIHsKICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3RbaW5kZXhdLmVkaXQgPSAhdGhpcy51bmFuc3dlcmVkX2xpc3RbaW5kZXhdLmVkaXQ7CiAgICAgICAgICAgIHRoaXMub2xkX3F1ZXN0aW9uID0gdGhpcy51bmFuc3dlcmVkX2xpc3RbaW5kZXhdLnF1ZXN0aW9uOwogICAgICAgICAgICAvLyB0aGlzLm9sZF9pbnRlbnQgPSB0aGlzLnVuYW5zd2VyZWRfbGlzdFtpbmRleF0uaW50ZW50OwogICAgICAgICAgICB0aGlzLm9sZF9kYXRhLnF1ZXN0aW9uID0gdGhpcy5vbGRfcXVlc3Rpb247CiAgICAgICAgICAgIC8vIHRoaXMub2xkX2RhdGEuaW50ZW50ID0gdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm9sZF9pbnRlbnQ7CiAgICAgICAgICAgIC8vIHRoaXMucXVlc3Rpb24gPSBxdWVzdGlvbi5xdWVzdGlvbjsKICAgICAgICAgICAgLy8gdGhpcy5pbnRlbnQgPSBxdWVzdGlvbi5pbnRlbnQ7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMub2xkX2RhdGEpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm9sZF9xdWVzdGlvbik7CiAgICAgICAgfSwKICAgICAgICBzdWJtaXRfcXVlc3Rpb24oKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJzdWJtaXQiKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInF1ZXN0aW9uIiwgdGhpcy5vbGRfcXVlc3Rpb24pOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaW50ZW50IiwgdGhpcy5vbGRfaW50ZW50KTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImludGVudCIsIHRoaXMuaXNlZGl0KTsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKHRoaXMub2xkX3F1ZXN0aW9uID09ICIiKSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfZW50ZXJfYWxsX2ZpZWxkX21zZycpKTsKICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgCSQoIiNleGFtcGxlTW9kYWxDZW50ZXIiKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLmdldF91bmFuc3dlcmVkX3VybCgpLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpc19FZGl0OiAiVHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb246IHRoaXMub2xkX3F1ZXN0aW9uLAogICAgICAgICAgICAgICAgICAgIC8vIGludGVudDogdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLm9sZF9pbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICAgIG9sZF9xdWVzdGlvbl9kYXRhOiB0aGlzLm9sZF9kYXRhLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUi5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfaW50ZXJ2YWxfc2VydmVyX21zZycpKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkVESVRFRF9TVUNDRVNTRlVMTFlfMDAwNS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX3FzX2VkaXRlZF9zdWNjZXNzZnVsX21zZycpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyOjI1MDAsCiAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIChyZXN1bHQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIC8vIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3ZlcmlmeV9yZXNwb25zZXNfdXNlcl9mZWVkYmFjaygpOwoKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmRhdGEubWVzc2FnZS5NU0dfQ09ERSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgIC8vIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgPT0gIlF1ZXN0aW9uIEludGVudCBVcGRhdGVkIikgewogICAgICAgICAgICAgICAgICAvLyBTd2FsKHsKICAgICAgICAgICAgICAgICAgLy8gICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgLy8gICAgIHRleHQ6ICJZb3VyIHF1ZXN0aW9uIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICAgICAgICAgICAgLy8gICAgIHRpbWVyOjIwMDAsCiAgICAgICAgICAgICAgICAgIC8vIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAvLyAgICAgLy8gaWYgKHJlc3VsdC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAvLyAgICAgLy8gdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgICAgIC8vICAgICAvLyB9CiAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmxvYWRfdmVyaWZ5X3Jlc3BvbnNlc191c2VyX2ZlZWRiYWNrKCk7CiAgICAgICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfaW50ZXJ2YWxfc2VydmVyX21zZzEnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHBhZ2luYXRpb25fY2xhc3MoaW5kZXgpIHsKICAgICAgICAgICAgaWYgKGluZGV4ID09IHRoaXMucGFnZV9ubykgewogICAgICAgICAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWRkX3F1ZXN0aW9ucygpIHsKICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgICAgICAgIHZhciBxdWVzdGlvbmxpc3QgPSBbXTsKICAgICAgICAgICAgdmFyIHRlbXBfbGlzdCA9IFtdOwogICAgICAgICAgICB2YXIgZW1wdHkgPSB0aGlzLnVuYW5zd2VyZWRfbGlzdC5maWx0ZXIoKHVuYW5zd2VyZWQpID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmFuc3dlcmVkLm5ld19pbnRlbnQgPT0gIiI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmb3IgKHZhciBpIGluIHRoaXMudW5hbnN3ZXJlZF9saXN0KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51bmFuc3dlcmVkX2xpc3RbaV0ubmV3X2ludGVudCAhPSAiIikgewogICAgICAgICAgICAgICAgdGVtcF9saXN0LnB1c2goCiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3RbaV0ucXVlc3Rpb24sCiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jb21wYW55aWQgKyAiXyIgKyB0aGlzLnVuYW5zd2VyZWRfbGlzdFtpXS5uZXdfaW50ZW50CiAgICAgICAgICAgICAgICAgICAgdGhpcy51bmFuc3dlcmVkX2xpc3RbaV0ubmV3X2ludGVudAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHF1ZXN0aW9ubGlzdC5wdXNoKHRlbXBfbGlzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wX2xpc3QgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocXVlc3Rpb25saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgICAgICAgIGFwaV9jYWxscy5nZXRfdW5hbnN3ZXJlZF91cmwoKSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgICAgIGlzQWRkOiAiVHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25pbnRlbnQ6IHF1ZXN0aW9ubGlzdCwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUgPT09IHRoaXMuYXBpX3N0YXR1c19jb2RlLkFEREVEX1NVQ0NFU1NGVUxMWV8wMDAyLk1TR19DT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgc3dhbCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX2FkZGVkX3N1Y2Nlc3NmdWxfbXNnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYocXVlc3Rpb25saXN0Lmxlbmd0aCA9PT0gdGhpcy51bmFuc3dlcmVkX2xpc3QubGVuZ3RoICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZV9ubyA+MSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gdGhpcy5wYWdlX25vIC0gMTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRfdmVyaWZ5X3Jlc3BvbnNlc191c2VyX2ZlZWRiYWNrKCk7CiAgICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHX0NPREUsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuTVNHLAogICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMCwKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX2FkZF9xdWVzdGlvbl9tc2cnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgc2VhcmNoX3F1ZXN0aW9uKCkgewogICAgICAgICAgICAvLyBpZih0aGlzLnNlYXJjaF9ieSE9JycpewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaGV5Iik7CiAgICAgICAgICAgIGlmICh0aGlzLnNlYXJjaF9uYW1lICE9ICIiKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgYXBpX2NhbGxzLmdldF91bmFuc3dlcmVkX3VybCgpLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgICAgIGlzc2VhcmNoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIC8vIHNlYXJjaGJ5OiB0aGlzLnNlYXJjaF9ieSwKICAgICAgICAgICAgICAgICAgICBrZXk6IHRoaXMuc2VhcmNoX25hbWUsCiAgICAgICAgICAgICAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICAgICAgICAgICAgcGFnZV9ubzogMSwKICAgICAgICAgICAgICAgICAgICBpc19nZXRfdXNlcl9yZXNwb25zZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc2VsZWN0ZWRfdXNlcl9saXN0CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlLk1TR19DT0RFID09PSB0aGlzLmFwaV9zdGF0dXNfY29kZS5OT19EQVRBX0FWQUlMQUJMRS5NU0dfQ09ERSkgewogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIi0tLSIpCiAgICAgICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX25vX3FzX2ZvdW5kX21zZycpKTsKICAgICAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMudGx0KCd1c2VyX2ZlZWRiYWNrX25vX3FzX2ZvdW5kX21zZycpLAogICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLWVuZCIsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lcjogMjUwMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgIC8vIH0sIDI1MDApOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZF92ZXJpZnlfcmVzcG9uc2VzX3VzZXJfZmVlZGJhY2soKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucGFnaW5hdGlvbi50b3RhbF9wYWdlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gMTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5hbnN3ZXJlZF9saXN0ID0gW107CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm51bWJlcl9vZl9yb3dzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX2RhdGE7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5wYWdpbmF0aW9uLnRvdGFsX3BhZ2U7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2UuZGF0YS5kYXRhWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wX2ludCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQm9vbGVhbihkYXRhWzJdW2ldKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRlbXBfaW50ID0gZGF0YVsyXVtpXS5yZXBsYWNlKHRoaXMuY29tcGFueWlkICsgIl8iLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9pbnQgPSBkYXRhWzJdW2ldOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5hbnN3ZXJlZF9saXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbjogZGF0YVswXVtpXSwKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZW50OiB0ZW1wX2ludCwKICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBkYXRhWzFdW2ldLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3Jlc3BvbnNlOiBkYXRhWzJdW2ldLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2ZlZWRiYWNrOiBkYXRhWzNdW2ldLAogICAgICAgICAgICAgICAgICAgICAgICBlZGl0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudW5hbnN3ZXJlZF9saXN0KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk5vIFF1ZXN0aW9ucyBGb3VuZCIpIHsKICAgICAgICAgICAgICAgICAgICAvLyAgIHRvYXN0ci5lcnJvcigiTm8gUXVlc3Rpb24gRm91bmQiKTsKICAgICAgICAgICAgICAgICAgICAvLyAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLiRyb3V0ZXIuZ28oKTsKICAgICAgICAgICAgICAgICAgICAvLyAgIH0sIDI1MDApOwogICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfaW50ZXJuYWxfc2VydmVyX21zZzInKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuJHJvdXRlci5nbygpOwogICAgICAgICAgICAgICAgICAgIC8vICAgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkX3ZlcmlmeV9yZXNwb25zZXNfdXNlcl9mZWVkYmFjaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IodGhpcy50bHQoJ3VzZXJfZmVlZGJhY2tfZGF0YV9mb3Jfc2VhcmNoX21zZycpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB9ZWxzZXsKICAgICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIlNlbGVjdCBoZWFkZXIgZm9yIHNlYXJjaGluZyIpOwogICAgICAgICAgICAvLyB9CiAgICAgICAgfSwKICAgIH0KfQo="},null]}