{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/BotUserChatHistory.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/End User Response/BotUserChatHistory.vue","mtime":1645594423487},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBhcGlfY2FsbHMgZnJvbSAiQC9wb3J0YWwvYXBpX2NhbGxzIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIE11bHRpc2VsZWN0LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG51bWJlcl9vZl9yb3dzOiAiIiwKICAgICAgdG90YWxfcGFnZXM6IDAsCiAgICAgIHBhZ2Vfbm86IDEsCiAgICAgIHBlcl9wYWdlOiAxNSwKICAgICAgdXNlcl9saXN0OiBbXSwKICAgICAgdXNlcl9yZXBseTogW10sCiAgICAgIGJvdF9yZXBseTogW10sCiAgICAgIGNoYXREZXRhaWxzOiBbXSwKICAgICAgYWN0aW9uX3N0YXRzOiBbXSwKICAgICAgdXNlcl9hY3Rpb25fc3RhdHM6IFtdLAogICAgICBjdXJyZW50X3VzZXI6ICIiLAogICAgICB0aW1lc3RhbXA6ICIiLAogICAgICBzZW5kZXJfaWQ6IFtdLAogICAgICBzZWxlY3RlZDogImdlbmVyYWxfY2hhdF9oaXN0b3J5IiwKICAgICAgc2VsZWN0ZWRfZGF0ZTogIiIsCiAgICAgIHNlbGVjdGVkX2luZGV4OiBudWxsLAogICAgICBjaGF0X2RhdGVzOiBbXSwKICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgIGlzc2VhcmNoOiBmYWxzZSwKICAgICAgc2VhcmNoc3RyaW5nOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgdmlld19jb21wb25lbnRfbmFtZTogInBvcnRhbF91c2VyIiwKICAgICAgLy8gZmluZ2VycHJpbnRyZWdleDovXlswLTldezEwfSQvLAogICAgICBmaW5nZXJwcmludHJlZ2V4OiAvXlswLTktK1wvXHNdezksfSQvLAogICAgICBwYWdlX2FycmF5OiBbXSwKICAgICAgc2hvd19sb2FkZXI6IGZhbHNlLAogICAgICBjb250YWN0X2hlbHBfZW1haWw6IG51bGwsCiAgICAgIHJldGFpbF93ZWJfZnJhbWV3b3JrOiB0aGlzLiRzZXNzaW9uLmdldCgicmV0YWlsX3dlYl9mcmFtZXdvcmsiKSwKICAgICAgZmlsdGVyX2NoYXRfaGlzdG9yeTogdGhpcy4kc2Vzc2lvbi5nZXQoImZpbHRlcl9jaGF0X2hpc3RvcnkiKSwKICAgIH07CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yayA9IHRoaXMuJHNlc3Npb24uZ2V0KCJyZXRhaWxfd2ViX2ZyYW1ld29yayIpOwogICAgJCgiI3NlbGVjdGFsbCIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkKCJpbnB1dDpjaGVja2JveCIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oInNlYXJjaF9ib3RfdXNlcl9jaGF0X2hpc3RvcnkiLCAoZGF0YSkgPT4gewogICAgICAgIHRoaXMuc2VhcmNoc3RyaW5nID0gZGF0YTsKICAgICAgICB0aGlzLnNlYXJjaF9jaGF0KCk7CiAgICAgICAgLy8gdGhpcy5zZWFyY2hfcXVlc3Rpb24oKTsKICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oImxvYWRfYm90X3VzZXJfY2hhdF9oaXN0b3J5IiwgKGRhdGEpID0+IHsKICAgICAgdGhpcy5sb2FkX2JvdF91c2VyX2NoYXRfaGlzdG9yeSgpOwogICAgfSk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy4kcm9vdC4kb2ZmKCJzZWFyY2hfYm90X3VzZXJfY2hhdF9oaXN0b3J5Iik7CiAgICB0aGlzLiRyb290LiRvZmYoImxvYWRfYm90X3VzZXJfY2hhdF9oaXN0b3J5Iik7CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5sb2FkX3Byb2R1Y3Rfc2V0dGluZ3MoKTsKICAgIHRoaXMubG9hZF9ib3RfdXNlcl9jaGF0X2hpc3RvcnkoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGZvcm1hdF9kYXRlX2luX2xvY2FsX3RpbWV6b25lKGRhdGUpewogICAgICB2YXIgdGVzdERhdGVVdGMgPSBtb21lbnQudXRjKGRhdGUpOwogICAgICB2YXIgbG9jYWxEYXRlID0gbW9tZW50KHRlc3REYXRlVXRjKS5sb2NhbCgpLnRvRGF0ZSgpOwogICAgICAvLyBub3RlOiBkbyBub3QgZm9ybWF0IHRpbWUgYmVsb3cgdG8gc2hvdyBob3VyIGFuZCBtaW51dGUgYmVjYXVzZSAiVmlldyBDaGF0IEhpc3RvcnkiIHNob3cgYWxsIG1lc3NhZ2Ugb2YgdGhhdCBkYXRlIG5vdCBzcGVjaWZpYyBob3VyLW1pbnV0ZSB0aW1lLgogICAgICBsb2NhbERhdGUgPSBtb21lbnQobG9jYWxEYXRlKS5mb3JtYXQoImRkZCBNTU0gRCBZWVlZIik7CiAgICAgIHJldHVybiBsb2NhbERhdGUudG9TdHJpbmcoKTsKICAgIH0sCiAgICBtZXNzYWdpbmdfcGxhdGZvcm1fZm9ybWF0aW5nKG1lc3NhZ2UpewogICAgICByZXR1cm4gIlBsZWFzZSBmZWVsIGZyZWUgdG8gcmVhY2hvdXQgdG8gdXMgYXQgOiAiKyBtZXNzYWdlOwogICAgfSwKICAgIG1lc3NhZ2luZ19wbGF0Zm9ybV9mb3JtYXRpbmdfbnVtYmVyKG1lc3NhZ2UpewogICAgICBpZihtZXNzYWdlICE9IG51bGwpewogICAgICAgIHJldHVybiAiIG9yIGNhbGwgdXMgYXQgOiIrbWVzc2FnZTsKICAgICAgfWVsc2V7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAogICAgY29uZnVzaW9uX21lc3NhZ2VfZm9ybWF0aW5nKG1lc3NhZ2UpewogICAgICByZXR1cm4gbWVzc2FnZS5zcGxpdCgne2VtYWlsfScpLmpvaW4odGhpcy5jb250YWN0X2hlbHBfZW1haWwpOwogICAgfSwKICAgIGxvYWRfcHJvZHVjdF9zZXR0aW5ncygpIHsKICAgICAgdGhpcy5zaG93X2xvYWRlciA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMucHJvZHVjdF9zZXR0aW5ncygpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgaXNfZ2V0OiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB2YXIgd2ViZnJhbWV3b3JrID0gdGhpcy5yZXRhaWxfd2ViX2ZyYW1ld29yazsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSAiIiAmJgogICAgICAgICAgICByZXNwb25zZS5kYXRhICE9IG51bGwgJiYKICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSAhPSAiSW50ZXJuYWwgc2VydmVyIEVycm9yIgogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuY29udGFjdF9oZWxwX2VtYWlsID0gCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGFbd2ViZnJhbWV3b3JrICsgJ19kZXRhaWxzJ10uY29udGFjdF9oZWxwX2VtYWlsOwogICAgICAgICAgfSAKICAgICAgICAgIC8vIGVsc2UgewogICAgICAgICAgLy8gICB0b2FzdHIuZXJyb3IoIkludGVybmFsIFNlcnZlciBFcnJvciIpOwogICAgICAgICAgLy8gfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9LAogICAgY2hlY2tfaW1hZ2VfdHlwZShpbWFnZSl7CiAgICAgIGlmICh0eXBlb2YoaW1hZ2UpID09ICdzdHJpbmcnKXsKICAgICAgICByZXR1cm4gaW1hZ2UKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICByZXR1cm4gaW1hZ2Uuc3JjCiAgICAgIH0KICAgIH0sCiAgICBsb2FkX2JvdF91c2VyX2NoYXRfaGlzdG9yeSgpewogICAgICB0aGlzLnBhZ2Vfbm8gPSAxOwogICAgICB0aGlzLmNoZWNrZWRfbGlzdCA9IFtdOwogICAgICB0aGlzLnNlYXJjaHN0cmluZyA9ICIiOwogICAgICB0aGlzLmFjdGlvbl9zdGF0cyA9IFtdOwogICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzID0gW107CiAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSB0cnVlOyAgCiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuYWN0aW9uX3N0YXRzX3VybCgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5hY3Rpb25fc3RhdHMgPSByZXNwb25zZS5kYXRhLmFjdGlvbl9zdGF0czsKICAgICAgICAgIHRoaXMuYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICBIaXRzOiAxLAogICAgICAgICAgICBOYW1lOiAiZ2VuZXJhbF9jaGF0X2hpc3RvcnkiLAogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd19sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB0aGlzLnNob3dfbG9hZGVyID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5nZW5lcmFsX2NoYXRfaGlzdG9yeSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIGlzc2hvdzogdHJ1ZSwKICAgICAgICAgICAgYWN0aW9uOiAiZ2VuZXJhbF9jaGF0X2hpc3RvcnkiLAogICAgICAgICAgICBmaWx0ZXJfY2hhdF9oaXN0b3J5OiB0aGlzLiRzZXNzaW9uLmdldCgiZmlsdGVyX2NoYXRfaGlzdG9yeSIpLAogICAgICAgICAgICBwYWdlbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgaXNzZWFyY2g6IHRoaXMuaXNzZWFyY2gsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zaG93X2xvYWRlciA9IGZhbHNlOwogICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cyA9IFtdOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAvLyAgIHRoaXMuZmluZ2VycHJpbnRyZWdleC50ZXN0KHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIpCiAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB0aGlzLmZpbmdlcnByaW50cmVnZXgudGVzdChyZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgdXNlcmVtYWlsOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLkVtYWlsLAogICAgICAgICAgICAgICAgdXNlcnBob25lbnVtYmVyOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLlBob25lTnVtYmVyLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUgPT0gbnVsbCA/ICJHdWVzdCB1c2VyIiA6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICB1c2VyaWQ6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIsCiAgICAgICAgICAgICAgICBkYXRlOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLkRhdGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy51c2VyX2FjdGlvbl9zdGF0cywgcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cy5wdXNoKHsKICAgICAgICAgICAgICAgIHVzZXJlbWFpbDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAgIHVzZXJwaG9uZW51bWJlcjogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLlVzZXJOYW1lID09IG51bGwgPyAiR3Vlc3QgdXNlciIgOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLlVzZXJOYW1lLAogICAgICAgICAgICAgICAgdXNlcmlkOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAgICAgZGF0ZTogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5EYXRlLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHRoaXMudXNlcl9hY3Rpb25fc3RhdHMucHVzaCh7CiAgICAgICAgICAgIC8vICAgICB1c2VyZW1haWwgOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAvLyAgICAgdXNlcnBob25lbnVtYmVyIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgICAgICAgICAgLy8gICAgIHVzZXJuYW1lIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5Vc2VyTmFtZSwKICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5QYWdlQ291bnQ7CiAgICAgICAgICB0aGlzLnNldHBhZ2luYXRpb24odGhpcy5wYWdlX25vKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNob3dfbG9hZGVyID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgcGFnZV9yZXF1aXJlKHBhZ2Vfbm8pIHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQgIT0gImdlbmVyYWxfY2hhdF9oaXN0b3J5IikgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudG90YWxfcGFnZXMsIHBhZ2Vfbm8pOwogICAgICAgIGlmIChwYWdlX25vID09IDAgfHwgcGFnZV9ubyA9PSB0aGlzLnRvdGFsX3BhZ2VzICsgMSkgewogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyB0aGlzLnBhZ2Vfbm8gPSBwYWdlX25vOwogICAgICAgICAgaWYgKHBhZ2UgPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZSA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICAgIGFwaV9jYWxscy5hY3Rpb25fdXNhZ2Vfc3RhdHNfdXJsKCksCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICAgIC8vIGFjdGlvbjogdGhpcy5hY3Rpb25fc3RhdHNbaW5kZXhdLk5hbWUsCiAgICAgICAgICAgICAgICBhY3Rpb246IHRoaXMuc2VsZWN0ZWQsCiAgICAgICAgICAgICAgICBwYWdlX25vOiB0aGlzLnBhZ2Vfbm8sCiAgICAgICAgICAgICAgICBwZXJfcGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgKQogICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICAgIC8vIHRoaXMudXNlcl9saXN0ID0gW107CiAgICAgICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhWzBdKSB7CiAgICAgICAgICAgICAgLy8gICB0aGlzLmludGVudGxpc3QucHVzaCh7CiAgICAgICAgICAgICAgLy8gICAgIGludGVudDogcmVzcG9uc2UuZGF0YVswXVtpXSwKICAgICAgICAgICAgICAvLyAgICAgZW1haWw6IHJlc3BvbnNlLmRhdGFbMV1baV0sCiAgICAgICAgICAgICAgLy8gICAgIGNyZWF0ZWQ6IHJlc3BvbnNlLmRhdGFbMl1baV0KICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocGFnZV9ubyA9PSAwIHx8IHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcyArIDEpIHsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHBhZ2Vfbm8gPT0gIi4uLnMiKSB7CiAgICAgICAgICAgIHRoaXMucGFnZV9ubyA9IE1hdGguY2VpbCgoMSArIHRoaXMucGFnZV9ubykgLyAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocGFnZV9ubyA9PSAiLi4ubCIpIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gTWF0aC5jZWlsKCh0aGlzLnRvdGFsX3BhZ2VzICsgdGhpcy5wYWdlX25vKSAvIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdlX25vID0gcGFnZV9ubzsKICAgICAgICAgIH0KICAgICAgICAgIC8vIHRoaXMucGFnZV9ubyA9IHBhZ2Vfbm87CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgICBheGlvcwogICAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgICBhcGlfY2FsbHMuZ2VuZXJhbF9jaGF0X2hpc3RvcnkoKSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgICAgICAgICAgaXNzaG93OiB0cnVlLAogICAgICAgICAgICAgICAgYWN0aW9uOiB0aGlzLnNlbGVjdGVkLAogICAgICAgICAgICAgICAgZmlsdGVyX2NoYXRfaGlzdG9yeTogdGhpcy4kc2Vzc2lvbi5nZXQoImZpbHRlcl9jaGF0X2hpc3RvcnkiKSwKICAgICAgICAgICAgICAgIHBhZ2VubzogdGhpcy5wYWdlX25vLAogICAgICAgICAgICAgICAgcGVycGFnZTogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICApCiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cyA9IFtdOwogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmdlcnByaW50cmVnZXgudGVzdCgKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHVzZXJlbWFpbDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5FbWFpbCwKICAgICAgICAgICAgICAgICAgICB1c2VycGhvbmVudW1iZXI6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uUGhvbmVOdW1iZXIsCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICAgICAgdXNlcmlkOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAgICAgICAgIGRhdGU6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uRGF0ZSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHVzZXJlbWFpbDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5faWQuVXNlciwKICAgICAgICAgICAgICAgICAgICB1c2VycGhvbmVudW1iZXI6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uUGhvbmVOdW1iZXIsCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICAgICAgdXNlcmlkOiByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5W2ldLl9pZC5Vc2VyLAogICAgICAgICAgICAgICAgICAgIGRhdGU6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uRGF0ZSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgLy8gICAgIHVzZXJlbWFpbCA6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIsCiAgICAgICAgICAgICAgICAvLyAgICAgdXNlcnBob25lbnVtYmVyIDogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5QaG9uZU51bWJlciwKICAgICAgICAgICAgICAgIC8vICAgICB1c2VybmFtZSA6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uVXNlck5hbWUsCiAgICAgICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlcyA9IHJlc3BvbnNlLmRhdGEuUGFnZUNvdW50OwogICAgICAgICAgICAgIHRoaXMuc2V0cGFnaW5hdGlvbih0aGlzLnBhZ2Vfbm8pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcGFnaW5hdGlvbl9jbGFzcyhpbmRleCkgewogICAgICBpZiAoaW5kZXggPT0gdGhpcy5wYWdlX25vKSB7CiAgICAgICAgcmV0dXJuICIgYWN0aXZlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0sCiAgICBzZXRwYWdpbmF0aW9uKHBhZ2Vfbm8pIHsKICAgICAgdGhpcy5wYWdlX2FycmF5ID0gW107CiAgICAgIGlmICh0aGlzLnRvdGFsX3BhZ2VzIDw9IDcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwYWdlX25vID09IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPT0gdGhpcy50b3RhbF9wYWdlcykgewogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKDEpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKCIuLi5zIik7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMudG90YWxfcGFnZXMgLSA0OyBpIDwgdGhpcy50b3RhbF9wYWdlczsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpICsgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPD0gNCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9ubyArIDM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ubCIpOwogICAgICAgIHRoaXMucGFnZV9hcnJheS5wdXNoKHRoaXMudG90YWxfcGFnZXMpOwogICAgICB9IGVsc2UgaWYgKHBhZ2Vfbm8gPj0gdGhpcy50b3RhbF9wYWdlcyAtIDQpIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gNDsgaSA8IHRoaXMudG90YWxfcGFnZXM7IGkrKykgewogICAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goaSArIDEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgxKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCgiLi4ucyIpOwogICAgICAgIGZvciAobGV0IGkgPSBwYWdlX25vIC0gMzsgaSA8PSBwYWdlX25vICsgMzsgaSsrKSB7CiAgICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wYWdlX2FycmF5LnB1c2goIi4uLmwiKTsKICAgICAgICB0aGlzLnBhZ2VfYXJyYXkucHVzaCh0aGlzLnRvdGFsX3BhZ2VzKTsKICAgICAgfQogICAgfSwKICAgIC8vIHZpZXdfYWN0aW9uKCkgewogICAgLy8gICB2YXIgYWN0aW9uX25hbWUgPSBldmVudC50YXJnZXQudmFsdWU7CiAgICAvLyAgIHRoaXMuc2VsZWN0ZWQgPSBhY3Rpb25fbmFtZTsKICAgIC8vICAgdGhpcy5zZWFyY2hzdHJpbmcgPSAiIjsKICAgIC8vICAgaWYgKGFjdGlvbl9uYW1lICE9ICJnZW5lcmFsX2NoYXRfaGlzdG9yeSIpIHsKICAgIC8vICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAvLyAgICAgYXhpb3MKICAgIC8vICAgICAgIC5wb3N0KAogICAgLy8gICAgICAgICBhcGlfY2FsbHMuYWN0aW9uX3VzYWdlX3N0YXRzX3VybCgpLAogICAgLy8gICAgICAgICB7CiAgICAvLyAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAvLyAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgIC8vICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25fbmFtZSwKICAgIC8vICAgICAgICAgICBwYWdlX25vOiAxLAogICAgLy8gICAgICAgICAgIHBlcl9wYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgLy8gICAgICAgICB9LAogICAgLy8gICAgICAgICB7CiAgICAvLyAgICAgICAgICAgaGVhZGVyczogewogICAgLy8gICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgKQogICAgLy8gICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAvLyAgICAgICAgIHRoaXMubnVtYmVyX29mX3Jvd3MgPSByZXNwb25zZS5kYXRhLm51bWJlcl9vZl9yb3dzOwogICAgLy8gICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gTWF0aC5jZWlsKHRoaXMubnVtYmVyX29mX3Jvd3MgLyB0aGlzLnBlcl9wYWdlKTsKICAgIC8vICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cyA9IFtdOwogICAgLy8gICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEudXNlcnMpIHsKICAgIC8vICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS51c2Vyc1tpXS5hY3Rpb25faGl0cyAhPSAwKSB7CiAgICAvLyAgICAgICAgICAgICBsZXQgYWN0aW9uX2hpc3RvcnkgPSBbXTsKICAgIC8vICAgICAgICAgICAgIGZvciAodmFyIGogaW4gcmVzcG9uc2UuZGF0YS51c2Vyc1tpXS5hY3Rpb25faGl0cykgewogICAgLy8gICAgICAgICAgICAgICBhY3Rpb25faGlzdG9yeS5wdXNoKHJlc3BvbnNlLmRhdGEudXNlcnNbaV0uYWN0aW9uX2hpdHNbal0pOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cy5wdXNoKHsKICAgIC8vICAgICAgICAgICAgICAgdXNlcm5hbWU6IHJlc3BvbnNlLmRhdGEudXNlcnNbaV0udXNlcm5hbWUsCiAgICAvLyAgICAgICAgICAgICAgIGFjdGlvbl9saXN0OiBhY3Rpb25faGlzdG9yeSwKICAgIC8vICAgICAgICAgICAgICAgc2VuZGVyX2lkOiByZXNwb25zZS5kYXRhLnVzZXJzW2ldLnNlbmRlcl9pZCwKICAgIC8vICAgICAgICAgICAgIH0pOwogICAgLy8gICAgICAgICAgIH0KICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgfSkKICAgIC8vICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgICBpZiAoCiAgICAvLyAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICAgICkgewogICAgLy8gICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgIH0pOwogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIC8vICAgICBheGlvcwogICAgLy8gICAgICAgLnBvc3QoCiAgICAvLyAgICAgICAgIGFwaV9jYWxscy5nZW5lcmFsX2NoYXRfaGlzdG9yeSgpLAogICAgLy8gICAgICAgICB7CiAgICAvLyAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAvLyAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgIC8vICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgICAgaXNzaG93OiB0cnVlLAogICAgLy8gICAgICAgICAgIGFjdGlvbjogYWN0aW9uX25hbWUsCiAgICAvLyAgICAgICAgICAgcGFnZW5vOiB0aGlzLnBhZ2Vfbm8sCiAgICAvLyAgICAgICAgICAgcGVycGFnZTogdGhpcy5wZXJfcGFnZSwKICAgIC8vICAgICAgICAgICBpc3NlYXJjaDogdGhpcy5pc3NlYXJjaCwKICAgIC8vICAgICAgICAgfSwKICAgIC8vICAgICAgICAgewogICAgLy8gICAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgLy8gICAgICAgICAgIH0sCiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgICkKICAgIC8vICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzID0gW107CiAgICAvLyAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeS5sZW5ndGg7IGkrKykgewogICAgLy8gICAgICAgICAgIHRoaXMudXNlcl9hY3Rpb25fc3RhdHMucHVzaCh7CiAgICAvLyAgICAgICAgICAgICB1c2VyZW1haWw6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uX2lkLlVzZXIsCiAgICAvLyAgICAgICAgICAgICB1c2VycGhvbmVudW1iZXI6IHJlc3BvbnNlLmRhdGEuY2hhdEhpc3RvcnlbaV0uUGhvbmVOdW1iZXIsCiAgICAvLyAgICAgICAgICAgICB1c2VybmFtZTogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXS5Vc2VyTmFtZSwKICAgIC8vICAgICAgICAgICB9KTsKICAgIC8vICAgICAgICAgfQogICAgLy8gICAgICAgfSkKICAgIC8vICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgICBpZiAoCiAgICAvLyAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAvLyAgICAgICAgICkgewogICAgLy8gICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICAgIH0KICAgIC8vICAgICAgIH0pOwogICAgLy8gICB9CiAgICAvLyB9LAogICAgc2Nyb2xsX2RpdigpIHsKICAgICAgdmFyIGRvYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5idXktcHJvZHVjdHMiKTsKICAgICAgaWYgKGV2ZW50LmRlbHRhWCA+IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0ICs9IDEwOwogICAgICB9IGVsc2UgaWYgKGV2ZW50LmRlbHRhWCA8IGV2ZW50LmRlbHRhWSkgewogICAgICAgIGRvYy5zY3JvbGxMZWZ0IC09IDEwOwogICAgICB9CiAgICB9LAogICAgY2hlY2tpbnRlbnQoaW5kZXgpIHsKICAgICAgaWYgKHRoaXMuY2hhdERldGFpbHNbaW5kZXggLSAxXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodGhpcy5jaGF0RGV0YWlsc1tpbmRleCAtIDFdLkJPVFJlc3BvbnNlWzBdICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHRoaXMuY2hhdERldGFpbHNbaW5kZXggLSAxXS5CT1RSZXNwb25zZVswXS5pbnRlbnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgY2hhdF9kYXRlKGluZGV4KSB7CiAgICAgIHRoaXMuY2hhdERldGFpbHMgPSBbXTsKICAgICAgdGhpcy5zZW5kZXJfaWQgPSB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS51c2VyaWQ7CiAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdCgKICAgICAgICAgIGFwaV9jYWxscy5nZW5lcmFsX2NoYXRfaGlzdG9yeSgpLAogICAgICAgICAgewogICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnNlbmRlcl9pZCwKICAgICAgICAgICAgaXNzaG93ZGF0ZXM6IHRydWUsCiAgICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgICAgICBzZWFyY2hzdHJpbmc6IHRoaXMuc2VhcmNoc3RyaW5nLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICB9LAogICAgICAgICAgfQogICAgICAgICkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmNoYXRfZGF0ZXMgPSByZXNwb25zZS5kYXRhLkRhdGVzOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9kYXRlID0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5EYXRlc1tyZXNwb25zZS5kYXRhLkRhdGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgdGhpcy5jaGF0X2RhdGVzLnJldmVyc2UoKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRfaW5kZXgpOwogICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbmRleCA9IGluZGV4OwogICAgICAgICAgdGhpcy5jaGF0X2NvbnZlcnNhdGlvbihpbmRleCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGNoYXRfY29udmVyc2F0aW9uKGluZGV4LCBjaGF0X2luZGV4KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGluZGV4LCBjaGF0X2luZGV4KTsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQgIT0gImdlbmVyYWxfY2hhdF9oaXN0b3J5IikgewogICAgICAgIHRoaXMuc2VuZGVyX2lkID0gdGhpcy51c2VyX2FjdGlvbl9zdGF0c1tpbmRleF0udXNlcmlkOwogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5jb252ZXJzYXRpb25fc3RhdHNfdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBzZW5kZXJfaWQ6IHRoaXMudXNlcl9hY3Rpb25fc3RhdHNbaW5kZXhdLnNlbmRlcl9pZCwKICAgICAgICAgICAgICBhY3Rpb25fdGltZXN0YW1wOiB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzW2luZGV4XS5hY3Rpb25fbGlzdFsKICAgICAgICAgICAgICAgIGNoYXRfaW5kZXgKICAgICAgICAgICAgICBdLnRpbWVzdGFtcCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnVzZXJfcmVwbHkgPSBbXTsKICAgICAgICAgICAgdGhpcy5ib3RfcmVwbHkgPSBbXTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMuY3VycmVudF91c2VyID0gcmVzcG9uc2UuZGF0YS51c2VyX2NvbnZlcnNhdGlvbnMudXNlcm5hbWU7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiByZXNwb25zZS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS51c2VyX2NvbnZlcnNhdGlvbnMuaW50ZXJhY3Rpb25zW2ldLnVzZXIgIT0KICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy51c2VyX3JlcGx5LnB1c2goCiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS51c2VyX2NvbnZlcnNhdGlvbnMuaW50ZXJhY3Rpb25zW2ldLnVzZXIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEudXNlcl9jb252ZXJzYXRpb25zLmludGVyYWN0aW9uc1tpXS5ib3QgIT0KICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5ib3RfcmVwbHkucHVzaCgKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLnVzZXJfY29udmVyc2F0aW9ucy5pbnRlcmFjdGlvbnNbaV0uYm90CiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICQoIiNjb252ZXJzYXRpb25fbW9kZWwxIDppbnB1dCIpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJObyBDaGF0cyBBdmFpbGFibGUiKTsKICAgICAgICAgICAgICAkKCIjY29udmVyc2F0aW9uX21vZGVsMSIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEgOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNoYXREZXRhaWxzID0gW107CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmdlbmVyYWxfY2hhdF9oaXN0b3J5KCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy5zZW5kZXJfaWQsCiAgICAgICAgICAgICAgaXNzaG93Y2hhdGRldGFpbHM6IHRydWUsCiAgICAgICAgICAgICAgZGF0ZTogdGhpcy5zZWxlY3RlZF9kYXRlLAogICAgICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hzdHJpbmcsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zZWxlY3RlZF9pbmRleCwgdGhpcy51c2VyX2FjdGlvbl9zdGF0cyk7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMudXNlcl9yZXBseSA9IFtdOwogICAgICAgICAgICB0aGlzLmJvdF9yZXBseSA9IFtdOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3VzZXIgPSB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzWwogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9pbmRleAogICAgICAgICAgICAgIF0udXNlcmVtYWlsOwogICAgICAgICAgICAgIHRoaXMuY2hhdERldGFpbHMgPSByZXNwb25zZS5kYXRhLmNoYXREZXRhaWxzOwogICAgICAgICAgICAgIGxldCBvZmZlcnNfaW5kZXggPSBudWxsIDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmNoYXREZXRhaWxzLmxlbmd0aCA7IGkrKyl7CiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPTAgOyBqPHRoaXMuY2hhdERldGFpbHNbaV0uQk9UUmVzcG9uc2UubGVuZ3RoOyBqKyspewogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY2hhdERldGFpbHNbaV0uQk9UUmVzcG9uc2Vbal0uc2hvcGlmeV9mZXRjaF9jdXN0b21lcl9pZCA9PSB0cnVlICYmIHRoaXMuY2hhdERldGFpbHNbaV0uQk9UUmVzcG9uc2Vbal0udGV4dCA9PSBudWxsICYmIAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGF0RGV0YWlsc1tpXS5Vc2VyUXVlcnkgPT09ICJQcm9tb3Rpb25hbCBvZmZlcnMiICl7CiAgICAgICAgICAgICAgICAgICAgICAgIG9mZmVyc19pbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAob2ZmZXJzX2luZGV4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2hhdERldGFpbHNbb2ZmZXJzX2luZGV4XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBvZmZlcnNfaW5kZXggPSBudWxsOyAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgbmV3X2FyciA9IHRoaXMuY2hhdERldGFpbHMuZmlsdGVyKChhKSA9PiBhKTsKICAgICAgICAgICAgICAgIHRoaXMuY2hhdERldGFpbHM9IG5ld19hcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIC8vICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEgOmlucHV0IikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgLy8gICAkKCIjY29udmVyc2F0aW9uX21vZGVsMSA6YnV0dG9uIikucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIC8vIH0sIDUwMCk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwcm9kdWN0X3ZhcmlhdGlvbihwcm9kdWN0c19saXN0KXsKICAgICAgZm9yICh2YXIgaSBpbiBwcm9kdWN0c19saXN0KXsKICAgICAgICBwcm9kdWN0c19saXN0W2ldLm9yZGVyX3F0eSA9IDE7CiAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5idXlfcXR5ID0gMTsKICAgICAgICBpZiAocHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zICYmIHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9ucy5sZW5ndGggPiAwKXsKICAgICAgICAgIHByb2R1Y3RzX2xpc3RbaV0uaWQgPSBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnNbMF0uaWQ7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLmltZ191cmwgPSAocHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLmltZ191cmwgPT09IG51bGwpID8gcHJvZHVjdHNfbGlzdFtpXS5pbWdfdXJsIDogcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLmltZ191cmw7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLnBlcm1hbGluayA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5wZXJtYWxpbms7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLnZhcmlhbnRfdGl0bGUgPSBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnNbMF0udmFyaWFudF90aXRsZTsKICAgICAgICAgIHByb2R1Y3RzX2xpc3RbaV0uc3RvY2tfcXVhbnRpdHkgPSBwcm9kdWN0c19saXN0W2ldLnZhcmlhdGlvbnNbMF0uc3RvY2tfcXVhbnRpdHk7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLnN0b2NrX3N0YXR1cyA9IHByb2R1Y3RzX2xpc3RbaV0udmFyaWF0aW9uc1swXS5zdG9ja19zdGF0dXM7CiAgICAgICAgICBwcm9kdWN0c19saXN0W2ldLnByaWNlID0gcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLnByaWNlOwogICAgICAgICAgcHJvZHVjdHNfbGlzdFtpXS5yZWd1bGFyX3ByaWNlID0gcHJvZHVjdHNfbGlzdFtpXS52YXJpYXRpb25zWzBdLnJlZ3VsYXJfcHJpY2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBwcm9kdWN0c19saXN0OwogICAgfSwKICAgIHNlYXJjaF9jaGF0KCkgewogICAgICBpZiAodGhpcy5zZWFyY2hzdHJpbmcgIT0gIiIpIHsKICAgICAgICAvLyB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgdGhpcy5wYWdlX25vID0gMTsKICAgICAgICAodGhpcy5pc3NlYXJjaCA9IHRydWUpLCAodGhpcy5zcGlubmVyT24gPSB0cnVlKTsKICAgICAgICBheGlvcwogICAgICAgICAgLnBvc3QoCiAgICAgICAgICAgIGFwaV9jYWxscy5nZW5lcmFsX2NoYXRfaGlzdG9yeSgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgaXNzaG93OiB0cnVlLAogICAgICAgICAgICAgIGFjdGlvbjogImdlbmVyYWxfY2hhdF9oaXN0b3J5IiwKICAgICAgICAgICAgICBwYWdlbm86IHRoaXMucGFnZV9ubywKICAgICAgICAgICAgICBwZXJwYWdlOiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgICAgIGlzc2VhcmNoOiB0aGlzLmlzc2VhcmNoLAogICAgICAgICAgICAgIHNlYXJjaHN0cmluZzogdGhpcy5zZWFyY2hzdHJpbmcsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy51c2VyX2FjdGlvbl9zdGF0cyA9IFtdOwogICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgIT0gIk5vIFJlc3VsdHMgRm91bmQiICYmCiAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5NU0cgIT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpCiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmNoYXRIaXN0b3J5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0aGlzLnVzZXJfYWN0aW9uX3N0YXRzLnB1c2goewogICAgICAgICAgICAgICAgICB1c2VybmFtZTogcmVzcG9uc2UuZGF0YS5jaGF0SGlzdG9yeVtpXSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VzID0gcmVzcG9uc2UuZGF0YS5QYWdlQ291bnQ7CiAgICAgICAgICAgICAgdGhpcy5zZXRwYWdpbmF0aW9uKHRoaXMucGFnZV9ubyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZihyZXNwb25zZS5kYXRhLk1TRyA9PSAiTm8gUmVzdWx0cyBGb3VuZCIpewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiTm8gUmVzdWx0cyBmb3VuZCIpOwoKICAgICAgICAgICAgfWVsc2UgaWYocmVzcG9uc2UuZGF0YS5NU0cgPT0gIkludGVybmFsIFNlcnZlciBFcnJvciIpewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcigiSW50ZXJuYWwgU2VydmVyIEVycm9yIik7CiAgICAgICAgICAgICAgdGhpcy5sb2FkX2JvdF91c2VyX2NoYXRfaGlzdG9yeSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiKTsKICAgICAgICAgICAgICAgIHRoaXMubG9hZF9ib3RfdXNlcl9jaGF0X2hpc3RvcnkoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9hc3RyLmVycm9yKCJFbnRlciBwcm9wZXIgZGF0YSBmb3Igc2VhcmNoaW5nIik7CiAgICAgIH0KICAgIH0sCiAgICBjbG9zZV9tb2RhbCgpIHsKICAgICAgJCgiI2NvbnZlcnNhdGlvbl9tb2RlbDEiKS5tb2RhbCgiaGlkZSIpOwogICAgfSwKICAgIGNoZWNrX2JvdF9vZmZlcnMoYm90X3JlcG9uc2UpewogICAgICBsZXQgcmVzdWx0X2JvdCA9IGJvdF9yZXBvbnNlLmZpbHRlcigoaXRlbSkgPT4gewogICAgICAgIHJldHVybiBCb29sZWFuKGl0ZW0ub2ZmZXJzKSA9PT0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIGlmKHJlc3VsdF9ib3QubGVuZ3RoID4gMCl7CiAgICAgICAgcmV0dXJuICJkaXNwbGF5IDpibG9jayI7CiAgICAgIH0KICAgICAgcmV0dXJuICJkaXNwbGF5IDogZmxleCI7CiAgICB9LAogIH0sCn07Cg=="},null]}