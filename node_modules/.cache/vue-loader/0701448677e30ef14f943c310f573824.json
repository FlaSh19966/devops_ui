{"remainingRequest":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vimalesh/CENSE/chatbot-portal/src/portal/Chatbot/Dashboard/Account/Billing.vue","mtime":1645594423479},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vimalesh/CENSE/chatbot-portal/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBTd2FsIGZyb20gInN3ZWV0YWxlcnQyIjsKaW1wb3J0IGNvdW50cmllcyBmcm9tICJAL3BvcnRhbC9jb21wb25lbnRzL0NvdW50cmllcyI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7IGJ1cyB9IGZyb20gIkAvcG9ydGFsL21haW4iOwppbXBvcnQgYXBpX2NhbGxzIGZyb20gIkAvcG9ydGFsL2FwaV9jYWxscyI7CmltcG9ydCBBcmVhQ2hhcnQgZnJvbSAiQC9wb3J0YWwvY29tcG9uZW50cy9BcmVhQ2hhcnQudnVlIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7Ci8vIGltcG9ydCB7IFN0cmlwZUNoZWNrb3V0IH0gZnJvbSAiQHZ1ZS1zdHJpcGUvdnVlLXN0cmlwZSI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IHsgdXBkYXRlX3NpZGViYXJfbWVudSwgdXBkYXRlX3Jlc3RyaWN0aW9uX2xpc3R9IGZyb20gIkAvcG9ydGFsL21peGlucyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJpbGxpbmciLAogIGNvbXBvbmVudHM6IHsKICAgIEFyZWFDaGFydCwKICAgIE11bHRpc2VsZWN0LAogICAgLy8gU3RyaXBlQ2hlY2tvdXQsCiAgfSwKICBtaXhpbnM6IFsKICAgIHVwZGF0ZV9zaWRlYmFyX21lbnUsCiAgICB1cGRhdGVfcmVzdHJpY3Rpb25fbGlzdAogIF0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9wbGFuczogW10sCiAgICAgIHNlbGVjdF9zdWJzY3JpcHRpb25fcGxhbjogWyJTaWx2ZXIiLCAiR29sZCIsICJQbGFudGludW0iLCAiRW50ZXJwcmlzZSJdLAogICAgICBzZWxlY3RlZF9zdWJzY3JpcHRpb246ICIiLAogICAgICBzdWJzY3JpcHRpb25faWQ6ICIiLAogICAgICBwbGFuX2lkOiAiIiwKICAgICAgY3VzdG9tZXJfaWQ6ICIiLAogICAgICBwbGFuX3BlcmlvZDogWyJNb250aGx5IiwgIlllYXJseSJdLAogICAgICBzZWxlY3RlZF9wZXJpb2Q6ICIiLAogICAgICBvcmRlcl9pZDogIiIsCiAgICAgIGFtb3VudDogIiIsCiAgICAgIHBheV9zdWNjZXNzX2RhdGE6IHt9LAogICAgICBzdWJzY3JpcHRpb25fYnRuX2Rpc2FibGU6IGZhbHNlLAogICAgICBjb3VudHJ5X2xpc3Q6IGNvdW50cmllcywKICAgICAgcGF5bWVudGlkOiAiIiwKICAgICAgYmFyQ2hhcnQ6ICIiLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IFsiI2U2N2UyMiIsICIjMTZhMDg1IiwgIiMyOTgwYjkiXSwKICAgICAgbGFiZWxzOiBbCiAgICAgICAgIkV4Y2hhbmdlIG9mIE1lc3NhZ2VzIiwKICAgICAgICAiRXhlY3V0aW9uIG9mIFRhc2tzIiwKICAgICAgICAiQXVkaW8vVmlkZW8gSW50ZXJhY3Rpb24iLAogICAgICAgICJTdG9yYWdlIiwKICAgICAgXSwKICAgICAgY29tcGFueWlkOiBudWxsLAogICAgICBjb21wYW55bmFtZTogbnVsbCwKICAgICAgY291bnRyeV9uYW1lOiAiIiwKICAgICAgcGF5bWVudF9jdXJyZW5jeTogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3RvcF91cDogIiIsCiAgICAgIHZhbHVlX2N1cnJlbmN5X3N1YnNjcmlwdGlvbjogIiIsCiAgICAgIElOUjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDogWzUwLCAxMDAsIDIwMCwgNTAwXSwKICAgICAgY29tbW9uX2N1cnJlbmN5OiBbXSwKICAgICAgY3VycmVuY3lfYW1vdW50OiBudWxsLAogICAgICB0b3BfdXBfYW1vdW50OiBudWxsLAogICAgICBwaWVjaGFydF9kYXRhOiBbXSwKICAgICAgdXNlcl9yb2xlOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikucm9sZSwKICAgICAgY29uY3VycmVudF91c2Vyc19tb250aDogIiIsCiAgICAgIENvbmN1cnJlbnRfVXNlcnNfRGF0YTogewogICAgICAgIGxhYmVsczogW10sCiAgICAgICAgZGF0YTogW10sCiAgICAgIH0sCiAgICAgIG1vbnRoczogWwogICAgICAgICJKYW4iLAogICAgICAgICJGZWIiLAogICAgICAgICJNYXIiLAogICAgICAgICJBcHIiLAogICAgICAgICJNYXkiLAogICAgICAgICJKdW5lIiwKICAgICAgICAiSnVseSIsCiAgICAgICAgIkF1ZyIsCiAgICAgICAgIlNlcHQiLAogICAgICAgICJPY3QiLAogICAgICAgICJOb3YiLAogICAgICAgICJEZWMiLAogICAgICBdLAogICAgICBpbnZvaWNlX2RldGFpbHM6IFtdLAogICAgICBpbnZvaWNlX2RldGFpbHNfY29weTogW10sCiAgICAgIHRvdGFsX3llYXI6IFtdLAogICAgICB5ZWFyX3NlbGVjdGVkOiAiIiwKICAgICAgc3Bpbm5lck9uOiBmYWxzZSwKICAgICAgLy9oYXJzaAogICAgICBjb21tb25fY3VycmVuY3kyOiBbXSwKICAgICAgSU5SMjogWzM1MDAsIDcwMDAsIDE0MDAwLCAzNTAwMF0sCiAgICAgIFVTRDI6IFsxMDAsIDMwMCwgNTAwXSwKICAgICAgcmV0YWlsX3Nob3BpZnlfY29tcGFueTogZmFsc2UsCiAgICAgIHJldGFpbF9zaG9waWZ5X3N1YnNjcmlwdGlvbl9wbGFuczogWwogICAgICAgIC8vIHsKICAgICAgICAvLyAgIG5hbWU6ICJGcmVlIiwKICAgICAgICAvLyAgIGlzX2NoYXJnZWFibGU6IGZhbHNlLAogICAgICAgIC8vIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogIlN0YXJ0ZXIiLAogICAgICAgICAgaXNfY2hhcmdlYWJsZTogdHJ1ZSwKICAgICAgICAgIG1vbnRobHlfY2hhcmdlOiAyOSwKICAgICAgICAgIGFubnVhbF9jaGFyZ2U6IHsKICAgICAgICAgICAgcGVyX21vbnRoX2VmZmVjdGl2ZTogMjQuMTcsCiAgICAgICAgICAgIGFjdHVhbF9jaGFyZ2U6IDI5MCwKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUHJlbWl1bSIsCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDk5LAogICAgICAgICAgYW5udWFsX2NoYXJnZTogewogICAgICAgICAgICBwZXJfbW9udGhfZWZmZWN0aXZlOiA4Mi41LAogICAgICAgICAgICBhY3R1YWxfY2hhcmdlOiA5OTAsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIHJldGFpbF9ub25fc2hvcGlmeV9zdWJzY3JpcHRpb25fcGxhbnM6IFsKICAgICAgICAvLyB7CiAgICAgICAgLy8gICBuYW1lOiAiRnJlZSIsCiAgICAgICAgLy8gICBpc19jaGFyZ2VhYmxlOiBmYWxzZSwKICAgICAgICAvLyB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJTdGFydGVyIiwKICAgICAgICAgIGlzX2NoYXJnZWFibGU6IHRydWUsCiAgICAgICAgICBtb250aGx5X2NoYXJnZTogMjksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUHJlbWl1bSIsCiAgICAgICAgICBpc19jaGFyZ2VhYmxlOiB0cnVlLAogICAgICAgICAgbW9udGhseV9jaGFyZ2U6IDk5LAogICAgICAgIH0sCiAgICAgIF0sCiAgICAgIHJldGFpbF9wbGFuX2N1cnJlbnQ6IG51bGwsCiAgICAgIHBheW1lbnRfdHlwZXM6IFsiQW5udWFsIiwgIk1vbnRobHkiXSwKICAgICAgcmV0YWlsX3BheW1lbnRfdHlwZTogbnVsbCwKICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuczogbnVsbCwKICAgICAgc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFuc19kZXRhaWxzOiB7fSwKICAgICAgc3RyaXBlX2FkZG9uX3BsYW5zOiBbXSwKICAgICAgc2hvd19zdWJzY3JpcHRpb246ZmFsc2UsCiAgICAgIHNlbGVjdGVkX2FkZG9uX3BsYW46IG51bGwsCiAgICAgIGhpZGVfYnV0dG9uOidGcmVlJywKICAgICAgY3JlZGl0c19iYWxhbmNlOiBudWxsCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuY291bnRyeV9saXN0ID0gY291bnRyaWVzOwogICAgaWYgKAogICAgICAhdGhpcy4kc2Vzc2lvbi5oYXMoIkNvbXBhbnlJZCIpICYmCiAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5yb2xlID09ICJTdXBlckFkbWluIgogICAgKSB7CiAgICAgIHRvYXN0ci53YXJuaW5nKCJQbGVhc2Ugc2VsZWN0IGEgY29tcGFueSBuYW1lIGZyb20gdGhlIGRyb3Bkb3duIik7CiAgICB9CiAgICBpZiAodGhpcy51c2VyX3JvbGUgPT0gIlN1cGVyQWRtaW4iKSB7CiAgICAgIGlmICh0aGlzLiRzZXNzaW9uLmhhcygiQ29tcGFueUlkIikpIHsKICAgICAgICB0aGlzLmNvbXBhbnlpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCJDb21wYW55SWQiKTsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIkNvbXBhbnlOYW1lIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgICB0aGlzLmNvbXBhbnluYW1lID0gdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21wYW55aWQgPSB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZDsKICAgICAgdGhpcy5jb21wYW55bmFtZSA9IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWU7CiAgICB9CiAgICBpZiAoCiAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb3VudHJ5X25hbWUgPT0gIiIgJiYKICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKQogICAgKSB7CiAgICB9IGVsc2UgewogICAgLy8gICBheGlvcwogICAgLy8gICAgIC5wb3N0KAogICAgLy8gICAgICAgYXBpX2NhbGxzLnBpZWNoYXJ0X3VybCgpLAogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBjb21wYW55bmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgIC8vICAgICAgICAgY29tcGFueWlkOiB0aGlzLmNvbXBhbnlpZCwKICAgIC8vICAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgIC8vICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAvLyAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAvLyAgICAgICB9LAogICAgLy8gICAgICAgewogICAgLy8gICAgICAgICBoZWFkZXJzOiB7CiAgICAvLyAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAvLyAgICAgICAgIH0sCiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgKQogICAgLy8gICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgICAgdGhpcy5waWVjaGFydF9kYXRhLnB1c2gocmVzcG9uc2UuZGF0YS5UYXNrVXNhZ2UpLAogICAgLy8gICAgICAgICB0aGlzLnBpZWNoYXJ0X2RhdGEucHVzaChyZXNwb25zZS5kYXRhLkV4Y2hhbmdlT2ZNc2cpLAogICAgLy8gICAgICAgICB0aGlzLnBpZWNoYXJ0X2RhdGEucHVzaChyZXNwb25zZS5kYXRhLkNhbGxVc2FnZSk7CiAgICAvLyAgICAgICB0aGlzLnBpZWNoYXJ0X2RhdGEucHVzaChyZXNwb25zZS5kYXRhLlN0b3JhZ2VfY29zdCk7CiAgICAvLyAgICAgICBpZiAoCiAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuVGFza1VzYWdlID4gMCB8fAogICAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLkV4Y2hhbmdlT2ZNc2cgPiAwIHx8CiAgICAvLyAgICAgICAgIHJlc3BvbnNlLmRhdGEuQ2FsbFVzYWdlID4gMCB8fAogICAgLy8gICAgICAgICByZXNwb25zZS5kYXRhLlN0b3JhZ2VfY29zdCA+IDAKICAgIC8vICAgICAgICkgewogICAgLy8gICAgICAgICB0aGlzLmJhckNoYXJ0Lm9wdGlvbnMubGVnZW5kLmRpc3BsYXkgPSB0cnVlOwogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgdGhpcy5iYXJDaGFydC51cGRhdGUoKTsKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICAgICAgaWYgKAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgLy8gICAgICAgKSB7CiAgICAvLyAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgfSk7CiAgICAvLyAgIGF4aW9zCiAgICAvLyAgICAgLnBvc3QoCiAgICAvLyAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19jaGFyZ2VfdXJsKCksCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgLy8gICAgICAgICBjb21wYW55aWQ6IHRoaXMuY29tcGFueWlkLAogICAgLy8gICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgLy8gICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgIC8vICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgIC8vICAgICAgIH0sCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGhlYWRlcnM6IHsKICAgIC8vICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgIC8vICAgICAgICAgfSwKICAgIC8vICAgICAgIH0KICAgIC8vICAgICApCiAgICAvLyAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAvLyAgICAgICB0aGlzLnBheW1lbnRfY3VycmVuY3kgPSByZXNwb25zZS5kYXRhLmN1cnJlbmN5X3R5cGU7CiAgICAvLyAgICAgICB0aGlzLnRvZ2dsZV9jaGFuZ2UodGhpcy5wYXltZW50X2N1cnJlbmN5KTsKICAgIC8vICAgICAgIHRoaXMuY29uY3VycmVudF91c2Vyc19tb250aCA9IHJlc3BvbnNlLmRhdGEuTW9udGg7CiAgICAvLyAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAvLyAgICAgICB2YXIgZGF5ID0gZGF0ZS5nZXREYXRlKCk7CiAgICAvLyAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7CiAgICAvLyAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuRGF0YSkgewogICAgLy8gICAgICAgICB2YXIgcmVzcG9uc2VfZGF0ZSA9IGkuc3BsaXQoIi0iKTsKICAgIC8vICAgICAgICAgaWYgKAogICAgLy8gICAgICAgICAgIE51bWJlcihyZXNwb25zZV9kYXRlWzBdKSA+IGRheSAmJgogICAgLy8gICAgICAgICAgIHJlc3BvbnNlX2RhdGVbMV0gPT0gdGhpcy5tb250aHNbbW9udGhdCiAgICAvLyAgICAgICAgICkgewogICAgLy8gICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgIHRoaXMuQ29uY3VycmVudF9Vc2Vyc19EYXRhLmxhYmVscy5wdXNoKGkpOwogICAgLy8gICAgICAgICAgIHRoaXMuQ29uY3VycmVudF9Vc2Vyc19EYXRhLmRhdGEucHVzaChyZXNwb25zZS5kYXRhLkRhdGFbaV0pOwogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBidXMuJGVtaXQoIkJpbGxpbmcgY2hhcnQgdXBkYXRlZCIsICJUcnVlIik7CiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuY2F0Y2goKGUpID0+IHsKICAgIC8vICAgICAgIGlmICgKICAgIC8vICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgLy8gICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAvLyAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICAgICkgewogICAgLy8gICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0pOwogICAgICBheGlvcwogICAgICAgIC5nZXQoYXBpX2NhbGxzLmJpbGxpbmdfaW52b2ljZSgpLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLiRzZXNzaW9uLmdldCgiYXQiKX1gLAogICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy50b3RhbF95ZWFyID0gcmVzcG9uc2UuZGF0YS5ZZWFyTGlzdDsKICAgICAgICAgIHRoaXMueWVhcl9zZWxlY3RlZCA9IHRoaXMudG90YWxfeWVhclswXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoCiAgICAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19pbnZvaWNlKCksCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgZG93bmxvYWRfZmlsZTogZmFsc2UsCiAgICAgICAgICAgIHllYXI6IHRoaXMueWVhcl9zZWxlY3RlZCwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB0aGlzLmludm9pY2VfZGV0YWlscyA9IHJlc3BvbnNlLmRhdGEuQnVja2V0X2xpc3Q7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW52b2ljZV9kZXRhaWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMuaW52b2ljZV9kZXRhaWxzX2NvcHlbaV0gPSB0aGlzLmludm9pY2VfZGV0YWlsc1tpXS5zbGljZSg4KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaW52b2ljZV9kZXRhaWxzX2NvcHkpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIGxldCBpc19zaG9waWZ5ID0gdGhpcy4kc2Vzc2lvbi5nZXQoInJldGFpbF93ZWJfZnJhbWV3b3JrIik7CiAgICBpZiAoQm9vbGVhbihpc19zaG9waWZ5KSAmJiBpc19zaG9waWZ5ID09PSAic2hvcGlmeSIpIHsKICAgICAgdGhpcy5yZXRhaWxfc2hvcGlmeV9jb21wYW55ID0gdHJ1ZTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7IAogICAgdGhpcy5nZXRfc3Vic2NyaXB0aW9uX2RldGFpbHMoKTsgLy8gR2V0IHBsYW5zIGZyb20gcmF6b3JwYXkgZGFzaGJvYXJkCiAgICB0aGlzLmdldF9hZGRvbl9kZXRhaWxzKCk7IC8vIEdldCBBZGQgT25zIGZyb20gY2Vuc2UgZGIKICAgIHRoaXMuZ2V0X2N1cnJlbnRfc3Vic2NyaXB0aW9uKCk7IC8vIEdldCBjdXJyZW50IHBsYW4gZGV0YWlscyBmcm9tIGNlbnNlX2RiCiAgICB0aGlzLmdldF9jdXJyZW50X3N1YnNjcmlwdGlvbl9kZXRhaWxzKCk7IC8vIGdldCBzdWJzY3JpcHRpb24gZGV0YWlscyBmcm9tIGNlbnNlX2RiCiAgICB0aGlzLmNoZWNrX2FkZG9uc19iYWxhbmNlKCk7CiAgICBpZiAoCiAgICAgIHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb3VudHJ5X25hbWUgPT0gIiIgJiYKICAgICAgIXRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKQogICAgKSB7CiAgICAgICQoIiNjb3VudHJ5bW9kYWwiKQogICAgICAgIC5tb2RhbCh7CiAgICAgICAgICBiYWNrZHJvcDogInN0YXRpYyIsCiAgICAgICAgfSkKICAgICAgICAub24oImhpZGRlbi5icy5tb2RhbCIsIChlKSA9PiB7CiAgICAgICAgICBpZiAoIXRoaXMuJHNlc3Npb24uaGFzKCJjb3VudHJ5X25hbWUiKSkgewogICAgICAgICAgICAkKCIjY291bnRyeW1vZGFsIikubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9ib3QvZGFzaGJvYXJkIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvLyB2YXIgQ0hBUlQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGluZUNoYXJ0IikuZ2V0Q29udGV4dCgiMmQiKTsKICAgIC8vIENoYXJ0LmRlZmF1bHRzLnNjYWxlLnRpY2tzLmJlZ2luQXRaZXJvID0gdHJ1ZTsKICAgIC8vIHRoaXMuYmFyQ2hhcnQgPSBuZXcgQ2hhcnQoQ0hBUlQsIHsKICAgIC8vICAgdHlwZTogInBpZSIsCiAgICAvLyAgIGRhdGE6IHsKICAgIC8vICAgICBsYWJlbHM6IHRoaXMubGFiZWxzLAogICAgLy8gICAgIGRhdGFzZXRzOiBbCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGxhYmVsOiAiUG9pbnRzIiwKICAgIC8vICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLmJhY2tncm91bmRDb2xvciwKICAgIC8vICAgICAgICAgZGF0YTogdGhpcy5waWVjaGFydF9kYXRhLAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICBdLAogICAgLy8gICB9LAogICAgLy8gICBvcHRpb25zOiB7CiAgICAvLyAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwKICAgIC8vICAgICBsZWdlbmQ6IHsKICAgIC8vICAgICAgIGRpc3BsYXk6IGZhbHNlLAogICAgLy8gICAgICAgcG9zaXRpb246ICJyaWdodCIsCiAgICAvLyAgICAgICBsYWJlbHM6IHsKICAgIC8vICAgICAgICAgYm94V2lkdGg6IDYwLAogICAgLy8gICAgICAgICBmb250RmFtaWx5OiAiRmlyYSBTYW5zLHNhbnMtc2VyaWYiLAogICAgLy8gICAgICAgICBmb250U2l6ZTogMTQsCiAgICAvLyAgICAgICAgIHBhZGRpbmc6IDMwLAogICAgLy8gICAgICAgfSwKICAgIC8vICAgICB9LAogICAgLy8gICAgIHBsdWdpbnM6IHsKICAgIC8vICAgICAgIGRpc3BsYXk6IHRydWUsCiAgICAvLyAgICAgfSwKICAgIC8vICAgfSwKICAgIC8vIH0pOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNoZWNrX3JldGFpbF9wYXltZW50X3R5cGVfZGlzYWJsZWQoKSB7CiAgICAgIGlmICgKICAgICAgICBCb29sZWFuKHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCkgJiYKICAgICAgICB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSA9PT0gZmFsc2UKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIHJldGFpbF9wYXltZW50X3BsYWNlaG9sZGVyKCkgewogICAgICBpZiAodGhpcy5jaGVja19yZXRhaWxfcGF5bWVudF90eXBlX2Rpc2FibGVkKSB7CiAgICAgICAgcmV0dXJuICJObyBCaWxsaW5nIEN5Y2xlIE5lZWRlZCBmb3IgRnJlZSBQbGFuIjsKICAgICAgfQogICAgICByZXR1cm4gIlBpY2sgT25lIjsKICAgIH0sCiAgICBjdXJyZW50X3JldGFpbF9wbGFuX2NoYXJnZXMoKSB7CiAgICAgIC8vIGlmKHRoaXMucmV0YWlsX3Nob3BpZnlfY29tcGFueSkgewogICAgICByZXR1cm4gQm9vbGVhbih0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQpCiAgICAgICAgPyB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZQogICAgICAgICAgPyBgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50Lm1vbnRobHlfY2hhcmdlfS9tb250aCAgb3IgJCR7dGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmFubnVhbF9jaGFyZ2UucGVyX21vbnRoX2VmZmVjdGl2ZX0vbW9udGggYmlsbGVkIGF0ICQke3RoaXMucmV0YWlsX3BsYW5fY3VycmVudC5hbm51YWxfY2hhcmdlLmFjdHVhbF9jaGFyZ2V9IG9uY2UgcGVyIHllYXJgCiAgICAgICAgICA6IG51bGwKICAgICAgICA6IG51bGw7CiAgICAgIC8vIH0gZWxzZSB7CiAgICAgIC8vICAgcmV0dXJuIEJvb2xlYW4odGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50KQogICAgICAvLyAgID8gdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUKICAgICAgLy8gICAgID8gYCQke3RoaXMucmV0YWlsX3BsYW5fY3VycmVudC5tb250aGx5X2NoYXJnZX0vbW9udGhgCiAgICAgIC8vICAgICA6IG51bGwKICAgICAgLy8gICA6IG51bGw7CiAgICAgIC8vIH0KICAgIH0sCiAgICBjaGVja19yZXRhaWxfc2hvcGlmeV9mb3JtX3ZhbGlkYXRpb25zKCkgewogICAgICBpZiAoCiAgICAgICAgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ICE9PSBudWxsICYmCiAgICAgICAgdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlICE9PSBudWxsCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCAhPT0gbnVsbCAmJgogICAgICAgIHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSA9PSBudWxsICYmCiAgICAgICAgdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUgPT09IGZhbHNlCiAgICAgICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgbmFtZVdpdGhMYW5nICh7IG5hbWUsIHR5cGUgfSkgewogICAgcmV0dXJuIGAke25hbWV9IOKAlCBbJHt0eXBlfV1gCiAgfSwKICBzaG93X3N3YWxfbm90aWZpY2F0aW9uKCl7CiAgICAgIFN3YWwuZmlyZSh7CiAgICAgICAgICB0aXRsZTogJ0FyZSBZb3UgU3VyZT8nLAogICAgICAgICAgdGV4dDogIllvdSB3YW50IHRvIHVuc3Vic2NyaWJlIHRoaXMgcGxhbj8gaXQgd2lsbCByZXZlcnQgeW91IHRvIGZyZWUgcGxhbiIsCiAgICAgICAgICBpY29uOiAnd2FybmluZycsCiAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiAnIzMwODVkNicsCiAgICAgICAgICBjYW5jZWxCdXR0b25Db2xvcjogJyNkMzMnLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdZZXMnCiAgICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQudmFsdWUgPT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy51cGRhdGVfc3Vic2NyaXB0aW9uX3BsYW5fZnJlZSgpCiAgICAgICAgICBTd2FsLmZpcmUoCiAgICAgICAgICAgJ1Vuc3ViY3JpYmVkIScsCiAgICAgICAgICAgJ1N1YnNjcmlwdGlvbiBDYW5jZWxlZCBTdWNjZXNzZnVsbHknLAogICAgICAgICAgICAnc3VjY2VzcycKICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0pCiAgfSwKICBnZXRfc3Vic2NyaXB0aW9uX3ZhbGlkX3RpbGwoc3ViX2RhdGUpewogICAgICByZXR1cm4gbW9tZW50LnV0YyhzdWJfZGF0ZSkuZm9ybWF0KCJEbyBNTU1NIFlZWVkiKTsKICB9LAogIHVwZGF0ZV9zdWJzY3JpcHRpb25fcGxhbl9mcmVlKCl7CiAgICAgICBheGlvcwogICAgICAgIC5wb3N0KAogICAgICAgICAgYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgICAgdW5zdWJzY3JpYmVfcGxhbjogdHJ1ZSwgICAgCiAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwKICAgICAgICAgIH0KICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuU3RhdHVzID09PSAiU3VjY2VzcyIpCiAgICAgICAgICB7CiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5Vc2VyTWVudTsKICAgICAgICAgICAgdGhpcy51cGRhdGVfc2lkZWJhcl9tZW51KG1lc3NhZ2UpOwogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTaWRlQmFyTWVudVVwZGF0ZWQiLCB0cnVlKTsKICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKCJ1cGRhdGUgc3VjY2Vzc2Z1bGx5IikKICAgICAgICAgICAgdGhpcy51cGRhdGVfcmVzdHJpY3Rpb25fbGlzdChyZXNwb25zZS5kYXRhLlJlc3RyaWN0aW9uTGlzdCkKICAgICAgICAgICAgdGhpcy5nZXRfY3VycmVudF9zdWJzY3JpcHRpb25fZGV0YWlscygpCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgfSwKICBnZXRfY3VycmVudF9zdWJzY3JpcHRpb25fZGV0YWlscygpIHsKICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgICAgYXhpb3MKICAgICAgICAucG9zdChhcGlfY2FsbHMuc3RyaXBlX3BheW1lbnRfZ2F0ZXdheSgpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIGdldF9hY3RpdmVfcGxhbjogdHJ1ZSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICByZXNwb25zZS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiKQogICAgICAgICAgewogICAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnNfZGV0YWlscyA9IHJlc3BvbnNlLmRhdGEuRGF0YS5jdXJyZW50X3N1YnNjcmlwdGlvbjsKICAgICAgICAgICAgdGhpcy5oaWRlX2J1dHRvbiA9IHJlc3BvbnNlLmRhdGEuRGF0YS5jdXJyZW50X3N1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZTsKICAgICAgICAgICAgdGhpcy5zaG93X3N1YnNjcmlwdGlvbiA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnNfZGV0YWlscyA9IFtdOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICB9LAogIGdldF9jdXJyZW50X3N1YnNjcmlwdGlvbigpIHsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBpc19nZXQ6IHRydWUsCiAgICAgIH0pCiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJDVVJSRU5UIFBMQU4gREVUQUlMUyIscmVzcG9uc2UpOwogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09IG51bGwpIHsKICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gdHJ1ZTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIk5vIEFjdGl2ZSBTdWJzY3JpcHRpb24gcGxhbiBmb3VuZCIsCiAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQ3VycmVudCBTdWJzY3JpcHRpb24gUGxhbiIpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfc3Vic2NyaXB0aW9uID0KICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5zdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uX3R5cGU7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkX3BlcmlvZCA9IHJlc3BvbnNlLmRhdGEuc3Vic2NyaXB0aW9uLnBlcmlvZDsKICAgICAgICAgIHRoaXMuY3VzdG9tZXJfaWQgPSByZXNwb25zZS5kYXRhLmN1c3RvbWVyX2lkOwogICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25fYnRuX2Rpc2FibGUgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJObyBBY3RpdmUgU3Vic2NyaXB0aW9uIHBsYW4gZm91bmQiKSB7CiAgICAgICAgICB0aGlzLmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5jdXN0b21lcl9pZDsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIk5vIEFjdGl2ZSBTdWJzY3JpcHRpb24gcGxhbiBmb3VuZCIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgaWYgKAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICkgewogICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogIH0sCiAgY2hlY2tfYWRkb25zX2JhbGFuY2UoKSB7CiAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICBheGlvcy5wb3N0KAogICAgICBhcGlfY2FsbHMuY2hlY2tfYWRkb25zX2JhbGFuY2UoKSwKICAgICAgewogICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjaGVja19iYWxhbmNlOiB0cnVlCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICkKICAgIC50aGVuKChyZXNwb25zZSkgPT57CiAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgaWYoQm9vbGVhbihyZXNwb25zZS5kYXRhLmNyZWRpdHMuc21zX2NvdW50KSA9PSB0cnVlKSB7CiAgICAgICAgdmFyIHNtc19jb3VudCA9IHJlc3BvbnNlLmRhdGEuY3JlZGl0cy5zbXNfY291bnQ7CiAgICAgICAgdGhpcy5jcmVkaXRzX2JhbGFuY2UgPSAiWW91ciBjdXJyZW50IFNNUyBjcmVkaXRzIGFyZSA8c3Ryb25nPiBmb3IgVVMgcmVnaW9uIDoiICsgc21zX2NvdW50LnVzICsgIiB8IGZvciBOb24tVVMgcmVnaW9uOiAiICsgc21zX2NvdW50Lm5vbl91cyArICI8L3N0cm9uZz4iCiAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgfSwKICBnZXRfYWRkb25fZGV0YWlscygpIHsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICBnZXRfYWRkX29uczogdHJ1ZSwKICAgICAgfSkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgcmVzcG9uc2UuZGF0YS5NU0cgPT09ICJObyBhZGQtb25zIGZvdW5kIGluIGRhdGFiYXNlIgogICAgICAgICkgewogICAgICAgICAgdGhpcy5zdHJpcGVfYWRkb25fcGxhbnMgPSBbXTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5EYXRhKSAhPSBmYWxzZSApIHsKICAgICAgICAgIHZhciB0ZW1wID0gW107CiAgICAgICAgICBmb3IgKHZhciBpIGluIHJlc3BvbnNlLmRhdGEuRGF0YSkgewogICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9ucy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5PcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307CiAgICAgICAgICAgICAgICBvYmpbJ25hbWUnXSA9IHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5UeXBlOwogICAgICAgICAgICAgICAgb2JqWydQcmljZSddID0gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLlByaWNlOwogICAgICAgICAgICAgICAgb2JqWydTZXJ2aWNlJ10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uU2VydmljZTsKICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuRGF0YVtpXS5UeXBlID09ICdTbXNBZGRPbicpIHsKICAgICAgICAgICAgICAgICAgb2JqWyd0eXBlJ10gPSByZXNwb25zZS5kYXRhLkRhdGFbaV0uT3B0aW9uc1tqXS50eXBlOwogICAgICAgICAgICAgICAgICBvYmpbJ3Ntc19jb3VudCddID0gcmVzcG9uc2UuZGF0YS5EYXRhW2ldLk9wdGlvbnNbal0uY291bnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wLnB1c2gob2JqKTsKICAgICAgICAgICAgICAgIC8vIGFkZCBjb25kaXRpb24gZm9yIGVtYWlsIGFkZCBvbiBhbHNvIGxpa2UgYWJvdmUgaW4gZnV0dXJlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnN0cmlwZV9hZGRvbl9wbGFucyA9IHRlbXA7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIH0pOwogICAgICB9KTsKICB9LAogIGdldF9zdWJzY3JpcHRpb25fZGV0YWlscygpIHsKICAgIGF4aW9zCiAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgZ2V0X3BsYW5zOiB0cnVlLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAgICAgICBpZiAoCiAgICAgICAgICByZXNwb25zZS5kYXRhLlN0YXR1cyA9PT0gIlN1Y2Nlc3MiICYmCiAgICAgICAgICByZXNwb25zZS5kYXRhLkRhdGEuZGF0YS5sZW5ndGggPiAwCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmlwZV9zdWJzY3JpcHRpb25fcGxhbnMgPSByZXNwb25zZS5kYXRhLkRhdGEuZGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zID0gW107CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkLCBQbGVhc2UgVHJ5IEFnYWluISIsCiAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIH0pOwogICAgICB9KTsKICB9LAogIGNhbmNlbF9zdWJzY3JpcHRpb24oKSB7CiAgICBheGlvcwogICAgICAucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAgICAgICBpc19jYW5jZWw6IHRydWUsCiAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiB0aGlzLnN1YnNjcmlwdGlvbl9pZCwKICAgICAgfSkKICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuTVNHID09ICJTdWJzY3JpcHRpb24gY2FuY2VsbGVkIikgewogICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25fYnRuX2Rpc2FibGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgdGl0bGU6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmICgKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICB9LAogIGNyZWF0ZV9jdXN0b21lcigpIHsKICAgIGlmICh0aGlzLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiA9PSAiIiB8fCB0aGlzLnNlbGVjdGVkX3BlcmlvZCA9PSAiIikgewogICAgICBTd2FsKHsKICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgdGV4dDogIlNlbGVjdCBTdWJzY3JpcHRpb24gcGxhbiBhbmQgUGVyaW9kIiwKICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIHRpbWVyOiAyMDAwLAogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIHBlcmlvZCA9IHRoaXMuc2VsZWN0ZWRfcGVyaW9kLnRvTG93ZXJDYXNlKCk7CiAgICBmb3IgKHZhciBpIGluIHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zKSB7CiAgICAgIGlmIChwZXJpb2QgPT0gdGhpcy5zdWJzY3JpcHRpb25fcGxhbnNbaV0ucGVyaW9kKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgdGhpcy5zZWxlY3RlZF9zdWJzY3JpcHRpb24gPT0gdGhpcy5zdWJzY3JpcHRpb25fcGxhbnNbaV0uaXRlbS5uYW1lCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnBsYW5faWQgPSB0aGlzLnN1YnNjcmlwdGlvbl9wbGFuc1tpXS5pZDsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJQTEFOIE5BTUU6IiwgdGhpcy5zdWJzY3JpcHRpb25fcGxhbnNbaV0uaXRlbS5uYW1lKTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJQTEFOIElEOiIsIHRoaXMuc3Vic2NyaXB0aW9uX3BsYW5zW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnBsYW5faWQgPT0gIiIpIHsKICAgICAgU3dhbCh7CiAgICAgICAgdGl0bGU6ICJQbGFuIE5vdCBGb3VuZCIsCiAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICB0ZXh0OiAiUGxlYXNlIGNvbnRhY3QgQ2Vuc2UgQWRtaW4iLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmN1c3RvbWVyX2lkID09ICIiKSB7CiAgICAgIHZhciBjdXN0X2RhdGEgPSB7CiAgICAgICAgbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICBjb250YWN0OiAiIiwKICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgIG5vdGVzOiB7IEV4dHJhOiAiRGV0YWlscyByZWxhdGVkIHRvIGN1c3RvbWVyIiB9LAogICAgICB9OwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5yYXpvcnBheV9jb21tdW5jYXRpb24oKSwgewogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICBjcmVhdGVfY3VzdG9tZXJfaWQ6IHRydWUsCiAgICAgICAgICBkYXRhOiBjdXN0X2RhdGEsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLk1TRyA9PSAiQ3VzdG9tZXIgY3JlYXRlZCIpIHsKICAgICAgICAgICAgdmFyIGN1c3RvbWVyX2RldGFpbCA9IHJlc3BvbnNlLmRhdGEuQ3VzdG9tZXJfRGV0YWlsOwogICAgICAgICAgICB0aGlzLmN1c3RvbWVyX2lkID0gcmVzcG9uc2UuZGF0YS5DdXN0b21lcl9EZXRhaWwuaWQ7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJjdXN0b21lciBpZCIsdGhpcy5jdXN0b21lcl9pZCk7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlX3N1YnNjcmlwdGlvbih0aGlzLnBsYW5faWQsIHRoaXMuY3VzdG9tZXJfaWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgdGV4dDogIkVycm9yIG9jY3VycmVkIHdoaWxlIGNyZWF0aW5nIEN1c3RvbWVyIElELCBQbGVhc2UgcmUtdHJ5IiwKICAgICAgICAgICAgICB0aW1lcjogMjAwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICkgewogICAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jcmVhdGVfc3Vic2NyaXB0aW9uKHRoaXMucGxhbl9pZCwgdGhpcy5jdXN0b21lcl9pZCk7CiAgICB9CiAgfSwKICBjcmVhdGVfc3Vic2NyaXB0aW9uKHBsYW5faWQsIGN1c3RvbWVyX2lkKSB7CiAgICB2YXIgc3ViX2RhdGEgPSB7CiAgICAgIHBsYW5faWQ6IHBsYW5faWQsCiAgICAgIGN1c3RvbWVyX2lkOiBjdXN0b21lcl9pZCwKICAgIH07CiAgICBheGlvcwogICAgICAucG9zdChhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksIHsKICAgICAgICBjcmVhdGVfc3Vic2NyaXB0aW9uOiB0cnVlLAogICAgICAgIGRhdGE6IHN1Yl9kYXRhLAogICAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIlN1YnNjcmlwdGlvbiBjcmVhdGVkIikgewogICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25faWQgPSByZXNwb25zZS5kYXRhLlN1YnNjcmlwdGlvbl9EZXRhaWwuaWQ7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiU3Vic2NyaXB0aW9uIGlkIiwgcmVzcG9uc2UpOwogICAgICAgICAgdGhpcy5zdGFydF9wYXltZW50KHRoaXMuc3Vic2NyaXB0aW9uX2lkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgIHRpdGxlOiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgdGV4dDogIkVycm9yIG9jY3VycmVkIHdoaWxlIGNyZWF0aW5nIFN1YnNjcmlwdGlvbiwgUGxlYXNlIHJlLXRyeSIsCiAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KQogICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICBpZiAoCiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDQwIHx8CiAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJTZXNzaW9uX0V4cGlyZWQiLCBlLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgfSwKICBzdGFydF9wYXltZW50KHN1YnNjcmlwdGlvbl9pZCkgewogICAgdmFyIHZtID0gdGhpczsKICAgIC8vIHN0YXJ0X3BheW1lbnQoKXsKICAgIC8vICAgdmFyIHZtID0gdGhpczsKICAgIC8vICAgdmFyIGRhdGEgPSB7CiAgICAvLyAgICAgb3JkZXJfYW1vdW50OiA1MDAwMCwKICAgIC8vICAgICBvcmRlcl9jdXJyZW5jeTogJ0lOUicsCiAgICAvLyAgICAgb3JkZXJfcmVjZWlwdDogJ29yZGVyX3JjcHRpZF8xMScsCiAgICAvLyAgICAgcGF5bWVudF9jYXB0dXJlOiAxLAogICAgLy8gICAgIG5vdGVzOiB7J1NoaXBwaW5nIGFkZHJlc3MnOiAnQm9tbWFuYWhhbGxpLCBCYW5nYWxvcmUnfQogICAgLy8gICB9CiAgICAvLyAgIGF4aW9zLgogICAgLy8gICAgIHBvc3QoCiAgICAvLyAgICAgICBhcGlfY2FsbHMucmF6b3JwYXlfY29tbXVuY2F0aW9uKCksCiAgICAvLyAgICAgICB7CiAgICAvLyAgICAgICAgIGdlbmVyYXRlX29yZGVyX2lkOiB0cnVlLAogICAgLy8gICAgICAgICBkYXRhOiBkYXRhCiAgICAvLyAgICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgLy8gICAgICAgaWYocmVzcG9uc2UuZGF0YS5NU0cgPT0gIk9yZGVyIElEIGNyZWF0ZWQiKXsKICAgIC8vICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YS5PcmRlcl9EZXRhaWwpOwogICAgLy8gICAgICAgICB2bS5vcmRlcl9pZCA9IHJlc3BvbnNlLmRhdGEuT3JkZXJfRGV0YWlsLmlkOwogICAgLy8gICAgICAgICB2bS5hbW91bnQgPSByZXNwb25zZS5kYXRhLk9yZGVyX0RldGFpbC5hbW91bnQ7CiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCJyZWFjaGVkIik7CiAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAga2V5OiBwcm9jZXNzLmVudi5WVUVfQVBQX1JBWk9SUEFZX0tFWSwgLy8gRW50ZXIgdGhlIEtleSBJRCBnZW5lcmF0ZWQgZnJvbSB0aGUgRGFzaGJvYXJkCiAgICAgIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uX2lkLCAvLyBZb3UgZG9udCBuZWVkIGFtb3VudC9jdXJyZW5jeS9vcmRlcl9pZCB3aGVuIHN1Ym1pdHRpbmcgc3Vic2NyaXB0aW9uIGlkCiAgICAgIC8vICJhbW91bnQiOiB0aGlzLmFtb3VudCwgLy8gQW1vdW50IGlzIGluIGN1cnJlbmN5IHN1YnVuaXRzLiBEZWZhdWx0IGN1cnJlbmN5IGlzIElOUi4gSGVuY2UsIDUwMDAwIHJlZmVycyB0byA1MDAwMCBwYWlzZQogICAgICAvLyAiY3VycmVuY3kiOiAiSU5SIiwKICAgICAgbmFtZTogIkNlbnNlIEFJIiwKICAgICAgZGVzY3JpcHRpb246ICJUZXN0IFRyYW5zYWN0aW9uIiwKICAgICAgaW1hZ2U6IHJlcXVpcmUoIkAvcG9ydGFsL2Fzc2V0cy9pbWcvY2Vuc2VfbG9nby5wbmciKSwKICAgICAgLy8gIm9yZGVyX2lkIjogdGhpcy5vcmRlcl9pZCwgLy9UaGlzIGlzIGEgc2FtcGxlIE9yZGVyIElELiBQYXNzIHRoZSBgaWRgIG9idGFpbmVkIGluIHRoZSByZXNwb25zZSBvZiBTdGVwIDEKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coIkZJTkFMIFBBWSIsIHJlc3BvbnNlKTsKICAgICAgICB2YXIgcmF6b3JwYXlfcGF5bWVudF9pZCA9IHJlc3BvbnNlLnJhem9ycGF5X3BheW1lbnRfaWQ7CiAgICAgICAgLy8gdmFyIHJhem9ycGF5X29yZGVyX2lkID0gcmVzcG9uc2UucmF6b3JwYXlfb3JkZXJfaWQ7CiAgICAgICAgdmFyIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZCA9IHJlc3BvbnNlLnJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZDsKICAgICAgICB2YXIgcmF6b3JwYXlfc2lnbmF0dXJlID0gcmVzcG9uc2UucmF6b3JwYXlfc2lnbmF0dXJlOwogICAgICAgIHZtLnBheV9zdWNjZXNzX2RhdGEgPSB7fTsKICAgICAgICB2bS5wYXlfc3VjY2Vzc19kYXRhID0gewogICAgICAgICAgcmF6b3JwYXlfcGF5bWVudF9pZDogcmF6b3JwYXlfcGF5bWVudF9pZCwKICAgICAgICAgIC8vIHJhem9ycGF5X29yZGVyX2lkOiByYXpvcnBheV9vcmRlcl9pZCwKICAgICAgICAgIHJhem9ycGF5X3N1YnNjcmlwdGlvbl9pZDogcmF6b3JwYXlfc3Vic2NyaXB0aW9uX2lkLAogICAgICAgICAgcmF6b3JwYXlfc2lnbmF0dXJlOiByYXpvcnBheV9zaWduYXR1cmUsCiAgICAgICAgICByYXpvcnBheV9jdXN0b21lcl9pZDogdm0uY3VzdG9tZXJfaWQsCiAgICAgICAgICAvLyBvcmRlcl9pZDogdGhpcy5vcmRlcl9pZCwKICAgICAgICAgIHN1YnNjcmlwdGlvbl9zdGF0dXM6ICJhY3RpdmUiLAogICAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiB2bS5zdWJzY3JpcHRpb25faWQsCiAgICAgICAgICBwbGFuX2lkOiB2bS5wbGFuX2lkLAogICAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGU6IHZtLnNlbGVjdGVkX3N1YnNjcmlwdGlvbiwKICAgICAgICAgIHN1YnNjcmlwdGlvbl9wZXJpb2Q6IHZtLnNlbGVjdGVkX3BlcmlvZCwKICAgICAgICB9OwogICAgICAgIC8vIGNvbnNvbGUubG9nKCJQQVlNRU5UIFNVQ0NFU1MgREFUQSIsdm0ucGF5X3N1Y2Nlc3NfZGF0YSk7CiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHZtLnBheV9zdWNjZXNzX2RhdGEpLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICB2bS5hZGRfZGV0YWlsc190b19zZXJ2ZXIodm0ucGF5X3N1Y2Nlc3NfZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJUcmFuc2FjdGlvbiBkaWQgbm90IHN1Y2NlZWQiKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vICJwcmVmaWxsIjogewogICAgICAvLyAgICAgIm5hbWUiOiAiR2F1cmF2IEt1bWFyIiwKICAgICAgLy8gICAgICJlbWFpbCI6ICJnYXVyYXYua3VtYXJAZXhhbXBsZS5jb20iLAogICAgICAvLyAgICAgImNvbnRhY3QiOiAiKzkxOTg3NjU0MzIxMCIKICAgICAgLy8gfSwKICAgICAgbm90ZXM6IHsKICAgICAgICBhZGRyZXNzOiAiUmF6b3JwYXkgQ29ycG9yYXRlIE9mZmljZSIsCiAgICAgIH0sCiAgICAgIHRoZW1lOiB7CiAgICAgICAgY29sb3I6ICIjMzM5OWNjIiwKICAgICAgfSwKICAgIH07CiAgICB2YXIgcnpwMSA9IG5ldyBSYXpvcnBheShvcHRpb25zKTsKICAgIHJ6cDEub24oInBheW1lbnQuZmFpbGVkIiwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJlcnJvciIsIHJlc3BvbnNlKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3IuY29kZSk7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLmRlc2NyaXB0aW9uKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3Iuc291cmNlKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3Iuc3RlcCk7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLnJlYXNvbik7CiAgICAgIGFsZXJ0KHJlc3BvbnNlLmVycm9yLm1ldGFkYXRhLm9yZGVyX2lkKTsKICAgICAgYWxlcnQocmVzcG9uc2UuZXJyb3IubWV0YWRhdGEucGF5bWVudF9pZCk7CiAgICB9KTsKICAgIHJ6cDEub3BlbigpOwogICAgLy8gfQogICAgLy8gfSkKICAgIC8vIC5jYXRjaCgoZSkgPT4gewogICAgLy8gICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgLy8gICAgIGlmICgKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MTAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgIC8vICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgIC8vICAgICApIHsKICAgIC8vICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAvLyAgICAgfQogICAgLy8gICB9KTsKICB9LAogIGFkZF9kZXRhaWxzX3RvX3NlcnZlcihkYXRhKSB7CiAgICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnJhem9ycGF5X2NvbW11bmNhdGlvbigpLCB7CiAgICAgICAgICBjb21wYW55X2lkOiB0aGlzLmNvbXBhbnlpZCwKICAgICAgICAgIGNvbXBhbnlfbmFtZTogdGhpcy5jb21wYW55bmFtZSwKICAgICAgICAgIHZlcmlmeV9zdWJzY3JpcHRpb246IHRydWUsCiAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5NU0cgPT0gIlN1YnNjcmlwdGlvbiB2ZXJpZmljYXRpb24gc3VjY2VzcyIpIHsKICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgdGl0bGU6ICJTdWNjZXNzZnVsbHkgU3ViY3JpcHRpb24gUmVnaXN0ZXJlZCIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgIHRpbWVyOiAyMDAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5wYXlfc3VjY2Vzc19kYXRhID0ge307CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uX2J0bl9kaXNhYmxlID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICB0ZXh0OiAiRXJyb3Igb2NjdXJyZWQgd2hpbGUgZ2V0dGluZyBTdWJzY3JpcHRpb24gdmVyaWZpY2F0aW9uIHN0YXR1cywgUGxlYXNlIHJlLXRyeSIsCiAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgdGltZXI6IDIwMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnBheV9zdWNjZXNzX2RhdGEgPSB7fTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgfSwKICB0b2dnbGVfY2hhbmdlKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT0gIklOUiIpIHsKICAgICAgdGhpcy5jb21tb25fY3VycmVuY3kgPSB0aGlzLklOUjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29tbW9uX2N1cnJlbmN5ID0gdGhpcy5VU0Q7CiAgICB9CiAgICBpZiAodmFsdWUgPT0gIklOUiIpIHsKICAgICAgdGhpcy5jb21tb25fY3VycmVuY3kyID0gdGhpcy5JTlIyOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb21tb25fY3VycmVuY3kyID0gdGhpcy5VU0QyOwogICAgfQogIH0sCiAgZG93bmxvYWRfaW52b2ljZShudW0pIHsKICAgIHRoaXMuc3Bpbm5lck9uID0gdHJ1ZTsKICAgIGF4aW9zKHsKICAgICAgbWV0aG9kOiAicG9zdCIsCiAgICAgIHVybDogYXBpX2NhbGxzLmJpbGxpbmdfaW52b2ljZSgpLAogICAgICByZXNwb25zZVR5cGU6ICJibG9iIiwKICAgICAgZGF0YTogewogICAgICAgIGNvbXBhbnlpZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgY29tcGFueW5hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X25hbWUsCiAgICAgICAgZW1haWw6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5lbWFpbCwKICAgICAgICBsaWNlbnNlX2tleTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmxpY2Vuc2Vfa2V5LAogICAgICAgIHRva2VuOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikudG9rZW5zLAogICAgICAgIGRvd25sb2FkX2ZpbGU6IHRydWUsCiAgICAgICAgZmlsZV9uYW1lOiB0aGlzLmludm9pY2VfZGV0YWlsc1tudW1dLAogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgIH0sCiAgICB9KQogICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJOb3QgYWJsZSB0byBkb3dubG9hZCIpIHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICB0b2FzdHIuZXJyb3IoCiAgICAgICAgICAgICJEdWUgdG8gc29tZSBpbnRlcm5hbCBlcnJvciwgbm90IGFibGUgdG8gZG93bmxvYWQgdGhlIGZpbGUiCiAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IGZhbHNlOwogICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCAiQXNoaXNoIiArICIucGRmIik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIH0KICAgICAgfSkKICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgaWYgKAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwOQogICAgICAgICkgewogICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogIH0sCiAgY2FsbF9wYXltZW50KHR5cGUpIHsKICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgIC8vIGNvbnNvbGUubG9nKGQpOwogICAgdmFyIHZtID0gdGhpczsKICAgIHZhciBvcHRpb25zID0ge307CiAgICBpZiAodHlwZSA9PSAiY291bnRyeV9zZWxlY3RlZCIpIHsKICAgICAgaWYgKHRoaXMuY291bnRyeV9uYW1lLmNvZGUgPT0gIiIpIHsKICAgICAgICBhbGVydCgiWW91IG5lZWQgdG8gc2VsZWN0IGNvdW50cnkiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuZWRpdF9wcm9maWxlX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueV9pZDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBmaXJzdF9uYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZmlyc3RfbmFtZSwKICAgICAgICAgICAgICBsYXN0X25hbWU6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5sYXN0X25hbWUsCiAgICAgICAgICAgICAgY291bnRyeV9uYW1lOiB0aGlzLmNvdW50cnlfbmFtZS5jb2RlLAogICAgICAgICAgICAgIHBob25lX251bWJlcjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnBob25lX25vLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuJHNlc3Npb24uZ2V0KCJhdCIpfWAsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgICAgKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09ICJQcm9maWxlIFVwZGF0ZWQiKSB7CiAgICAgICAgICAgICAgLy8gICBTd2FsKHsKICAgICAgICAgICAgICAvLyAgIHRpdGxlOiAiVXBkYXRlZCBTdWNjZXNzZnVsbHkhISIsCiAgICAgICAgICAgICAgLy8gICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgICAgLy8gICB0ZXh0OiAiWW91ciBwcm9maWxlIGhhcyBiZWVuIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LiIsCiAgICAgICAgICAgICAgLy8gICB0aW1lcjoyMDAwLAogICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCJZb3VyIHByb2ZpbGUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgdGhpcy4kc2Vzc2lvbi5zZXQoImNvdW50cnlfbmFtZSIsIHRoaXMuY291bnRyeV9uYW1lLmNvZGUpOwogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKCk7CiAgICAgICAgICAgICAgfSwgMjUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJCgiI2NvdW50cnltb2RhbCIpLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlKSA9PiB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEwIHx8CiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQ0MCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0MDkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgiU2Vzc2lvbl9FeHBpcmVkIiwgZS5yZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlubmVyVGV4dCA9PSAiUGF5IikgewogICAgICBpZiAodGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAgPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYW4gYW1vdW50IHRvIGJlIHBhaWQuIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAgPSB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cC5zbGljZSgyLCAtMTApOwogICAgICAgIHRoaXMuY3VycmVuY3lfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAgKiAxMTg7CiAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXA7CiAgICAgICAgaWYgKHRoaXMucGF5bWVudF9jdXJyZW5jeSA9PSAiSU5SIikgewogICAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50IC89IDcwOwogICAgICAgIH0KICAgICAgICBwYXlfYW1vdW50KHRoaXMuY3VycmVuY3lfYW1vdW50LCB0aGlzLnBheW1lbnRfY3VycmVuY3ksICJUb3AgVXAiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnZhbHVlX2N1cnJlbmN5X3RvcF91cCA9IHRoaXMudmFsdWVfY3VycmVuY3lfdG9wX3VwLnNsaWNlKDIpOwogICAgICAgIHRoaXMuY3VycmVuY3lfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXAgKiAxMDA7CiAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV90b3BfdXA7CgogICAgICAgIHBheV9hbW91bnQodGhpcy5jdXJyZW5jeV9hbW91bnQsIHRoaXMucGF5bWVudF9jdXJyZW5jeSwgIlRvcCBVcCIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pbm5lclRleHQgPT0gIlN1YnNjcmliZSIpIHsKICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBpZiAodGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPT0gIiIpIHsKICAgICAgICB0b2FzdHIuZXJyb3IoIlBsZWFzZSBzZWxlY3QgYW4gYW1vdW50IHRvIGJlIHBhaWQuIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5wYXltZW50X2N1cnJlbmN5ID09ICJJTlIiKSB7CiAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPQogICAgICAgICAgdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24uc2xpY2UoMiwgLTEwKTsKICAgICAgICB0aGlzLmN1cnJlbmN5X2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uICogMTE4OwogICAgICAgIHRoaXMudG9wX3VwX2Ftb3VudCA9IHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uOwogICAgICAgIGlmICh0aGlzLnBheW1lbnRfY3VycmVuY3kgPT0gIklOUiIpIHsKICAgICAgICAgIHRoaXMudG9wX3VwX2Ftb3VudCAvPSA3MDsKICAgICAgICB9CiAgICAgICAgYXhpb3MKICAgICAgICAgIC5wb3N0KAogICAgICAgICAgICBhcGlfY2FsbHMuYmlsbGluZ19zdWJzY3JpcHRpb25fdXJsKCksCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb21wYW55aWQ6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5jb21wYW55X2lkLAogICAgICAgICAgICAgIGNvbXBhbnluYW1lOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9uYW1lLAogICAgICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgICAgICAgbGljZW5zZV9rZXk6IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS5saWNlbnNlX2tleSwKICAgICAgICAgICAgICB0b2tlbjogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLnRva2VucywKICAgICAgICAgICAgICBQbGFuQW1vdW50OiB0aGlzLnRvcF91cF9hbW91bnQsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICBwYXlfYW1vdW50KHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQsICIiLCAiU3Vic2NyaWJlIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5FcnJvcikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLkVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uID0KICAgICAgICAgIHRoaXMudmFsdWVfY3VycmVuY3lfc3Vic2NyaXB0aW9uLnNsaWNlKDIpOwogICAgICAgIHRoaXMuY3VycmVuY3lfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gKiAxMDA7CiAgICAgICAgdGhpcy50b3BfdXBfYW1vdW50ID0gdGhpcy52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb247CiAgICAgICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICAgIGF4aW9zCiAgICAgICAgICAucG9zdCgKICAgICAgICAgICAgYXBpX2NhbGxzLmJpbGxpbmdfc3Vic2NyaXB0aW9uX3VybCgpLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29tcGFueWlkOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuY29tcGFueV9pZCwKICAgICAgICAgICAgICBjb21wYW55bmFtZTogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmNvbXBhbnlfbmFtZSwKICAgICAgICAgICAgICBlbWFpbDogdGhpcy4kc2Vzc2lvbi5nZXQoIlVzZXJJbmZvcm1hdGlvbiIpLmVtYWlsLAogICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikubGljZW5zZV9rZXksCiAgICAgICAgICAgICAgdG9rZW46IHRoaXMuJHNlc3Npb24uZ2V0KCJVc2VySW5mb3JtYXRpb24iKS50b2tlbnMsCiAgICAgICAgICAgICAgUGxhbkFtb3VudDogdGhpcy5jdXJyZW5jeV9hbW91bnQsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy4kc2Vzc2lvbi5nZXQoImF0Iil9YCwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9CiAgICAgICAgICApCiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQpIHsKICAgICAgICAgICAgICBwYXlfYW1vdW50KHJlc3BvbnNlLmRhdGEuU3Vic2NyaXB0aW9uSWQsICIiLCAiU3Vic2NyaWJlIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5FcnJvcikgewogICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5kYXRhLkVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZSkgPT4gewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgZS5yZXNwb25zZS5zdGF0dXMgPT09IDQxMCB8fAogICAgICAgICAgICAgIGUucmVzcG9uc2Uuc3RhdHVzID09PSA0NDAgfHwKICAgICAgICAgICAgICBlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA5CiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIlNlc3Npb25fRXhwaXJlZCIsIGUucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwYXlfYW1vdW50KGFtb3VudCwgY3VycmVuY3lfdHlwZSwgcGF5bWVudF90eXBlKSB7CiAgICAgIGlmIChwYXltZW50X3R5cGUgPT0gIlN1YnNjcmliZSIpIHsKICAgICAgICBvcHRpb25zID0gewogICAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgICAgc3Vic2NyaXB0aW9uX2lkOiBhbW91bnQsIC8vVGhpcyBpcyBhY3R1YWxseSBzdWJzY3JpcHRpb24gSUQKICAgICAgICAgIC8vIHN1YnNjcmlwdGlvbl9jYXJkX2NoYW5nZTogMSwKICAgICAgICAgIG5hbWU6ICJDZW5zZSBBSSIsCiAgICAgICAgICBkZXNjcmlwdGlvbjogIkluc3RpbGwgSW50ZWxsaWdlbmNlIiwKICAgICAgICAgIGltYWdlOiAiL2ltZy9jZW5zZV9pbWFnZS5wbmciLCAvLyBDT01QQU5ZIExPR08KICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkKTsKICAgICAgICAgICAgLy8gdmFyIGNvbnRhY3QgPSAkKCcjY29udGFjdFt0eXBlPSJ0ZWwiXScpLnZhbHVlOwogICAgICAgICAgICAvLyB2YXIgZW1haWwgPSAkKCcjZW1haWxbdHlwZT0iZW1haWwiXScpLnZhbHVlOwogICAgICAgICAgICB2bS5wYXltZW50aWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwogICAgICAgICAgICB2bS52YWx1ZV9jdXJyZW5jeV9zdWJzY3JpcHRpb24gPSAiIjsKICAgICAgICAgIH0sCiAgICAgICAgICBwcmVmaWxsOiB7CiAgICAgICAgICAgIG5hbWU6ICIiLCAvLyBwYXNzIGN1c3RvbWVyIG5hbWUKICAgICAgICAgICAgZW1haWw6ICIiLCAvLyBjdXN0b21lciBlbWFpbAogICAgICAgICAgICBjb250YWN0OiAiIiwgLy9jdXN0b21lciBwaG9uZSBuby4KICAgICAgICAgIH0sCiAgICAgICAgICBub3RlczogewogICAgICAgICAgICBhZGRyZXNzOiAiYWRkcmVzcyIsIC8vY3VzdG9tZXIgYWRkcmVzcwogICAgICAgICAgfSwKICAgICAgICAgIHRoZW1lOiB7CiAgICAgICAgICAgIGNvbG9yOiAiIzI4Mzc3NyIsIC8vIHNjcmVlbiBjb2xvcgogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICAgIGxvYWRfY2hlY2tvdXQoKTsKICAgICAgfSBlbHNlIGlmIChwYXltZW50X3R5cGUgPT0gIlBheSIpIHsKICAgICAgICBvcHRpb25zID0gewogICAgICAgICAga2V5OiAicnpwX3Rlc3RfU25EVGFQbm5jZmxpRHQiLAogICAgICAgICAgYW1vdW50OiBhbW91bnQsIC8vIEV4YW1wbGU6IDIwMDAgcGFpc2UgPSBJTlIgMjAKICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeV90eXBlLAogICAgICAgICAgbmFtZTogIkNlbnNlIEFJIiwKICAgICAgICAgIGRlc2NyaXB0aW9uOiAiSW5zdGlsbCBJbnRlbGxpZ2VuY2UiLAogICAgICAgICAgaW1hZ2U6ICIvaW1nL2NlbnNlX2ltYWdlLnBuZyIsIC8vIENPTVBBTlkgTE9HTwoKICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkKTsKICAgICAgICAgICAgdmFyIGNvbnRhY3QgPSAkKCcjY29udGFjdFt0eXBlPSJ0ZWwiXScpLnZhbHVlOwogICAgICAgICAgICB2YXIgZW1haWwgPSAkKCcjZW1haWxbdHlwZT0iZW1haWwiXScpLnZhbHVlOwogICAgICAgICAgICB2bS5wYXltZW50aWQgPSByZXNwb25zZS5yYXpvcnBheV9wYXltZW50X2lkOwogICAgICAgICAgICB2bS52YWx1ZV9jdXJyZW5jeV90b3BfdXAgPSAiIjsKICAgICAgICAgIH0sCiAgICAgICAgICBwcmVmaWxsOiB7CiAgICAgICAgICAgIG5hbWU6ICIiLCAvLyBwYXNzIGN1c3RvbWVyIG5hbWUKICAgICAgICAgICAgZW1haWw6ICIiLCAvLyBjdXN0b21lciBlbWFpbAogICAgICAgICAgICBjb250YWN0OiAiIiwgLy9jdXN0b21lciBwaG9uZSBuby4KICAgICAgICAgIH0sCiAgICAgICAgICBub3RlczogewogICAgICAgICAgICBhZGRyZXNzOiAiYWRkcmVzcyIsIC8vY3VzdG9tZXIgYWRkcmVzcwogICAgICAgICAgfSwKICAgICAgICAgIHRoZW1lOiB7CiAgICAgICAgICAgIGNvbG9yOiAiIzI4Mzc3NyIsIC8vIHNjcmVlbiBjb2xvcgogICAgICAgICAgfSwKICAgICAgICB9OwogICAgICAgIGxvYWRfY2hlY2tvdXQoKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gbG9hZF9jaGVja291dCgpIHsKICAgICAgdmFyIHJ6cDEgPSBuZXcgUmF6b3JwYXkob3B0aW9ucyk7CiAgICAgIHJ6cDEub3BlbigpOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQogIH0sCiAgY2hlY2tfcmV0YWlsX3BsYW4odmFsdWUsIGlkKSB7CiAgICB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPSBudWxsOwogIH0sCiAgc3Vic2NyaWJlX3JldGFpbF9wbGFuKCkgewogICAgLy8gbGV0IHN1YnNjcmlwdGlvbl9kYXRhID0gewogICAgLy8gICBzdWJzY3JpcHRpb25fcGxhbjogdGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LAogICAgLy8gICBiaWxsaW5nX2N5Y2xlOiB0aGlzLnJldGFpbF9wYXltZW50X3R5cGUsCiAgICAvLyB9OwogICAgaWYgKHRoaXMuY2hlY2tfcmV0YWlsX3Nob3BpZnlfZm9ybV92YWxpZGF0aW9ucykgewogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnN1YnNjcmliZV9zaG9waWZ5X2JpbGxpbmcoKSwgewogICAgICAgICAgc3Vic2NyaXB0aW9uX3BsYW46IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudCwKICAgICAgICAgIGJpbGxpbmdfY3ljbGU6IHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgaXNfcGFpZF9wbGFuOiB0aGlzLnJldGFpbF9wbGFuX2N1cnJlbnQuaXNfY2hhcmdlYWJsZSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy5zcGlubmVyT24gPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gIlN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPT0gIkFubnVhbCIpIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBCb29sZWFuKHJlc3BvbnNlLmRhdGEuZGF0YSkgJiYKICAgICAgICAgICAgICAgIEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEuYXBwU3Vic2NyaXB0aW9uQ3JlYXRlKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICAgIHRpdGxlOgogICAgICAgICAgICAgICAgICAgICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSByZWRpcmVjdCBZb3UgdG8gdGhlIFNob3BpZnkgTWVyY2hhbnQgVUkhIiwKICAgICAgICAgICAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eXBlOiAiaW5mbyIsCiAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5kYXRhLmRhdGEuYXBwU3Vic2NyaXB0aW9uQ3JlYXRlLmNvbmZpcm1hdGlvblVybDsKICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJldGFpbF9wYXltZW50X3R5cGUgPT0gIk1vbnRobHkiKSB7CiAgICAgICAgICAgICAgaWYgKEJvb2xlYW4ocmVzcG9uc2UuZGF0YS5kYXRhLmNvbmZpcm1hdGlvbl91cmwpKSB7CiAgICAgICAgICAgICAgICAvLyBTd2FsKHsKICAgICAgICAgICAgICAgIC8vICAgdGl0bGU6ICJQbGVhc2Ugd2FpdCB3aGlsZSB3ZSByZWRpcmVjdCBZb3UgdG8gdGhlIFNob3BpZnkgTWVyY2hhbnQgVUkhIiwKICAgICAgICAgICAgICAgIC8vICAgdG9hc3Q6IHRydWUsCiAgICAgICAgICAgICAgICAvLyAgIHR5cGU6ICJpbmZvIiwKICAgICAgICAgICAgICAgIC8vICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICAvLyAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLmRhdGEuY29uZmlybWF0aW9uX3VybDsKICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6ICJTb21lIEVycm9yIE9jY3VycmVkIiwKICAgICAgICAgICAgICAgICAgdGV4dDogIlBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50LmlzX2NoYXJnZWFibGUgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgU3dhbCh7CiAgICAgICAgICAgICAgICB0aXRsZTogIlN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdGV4dDogIlRoYW5rIFlvdSBmb3Igc3Vic2NyaWJpbmcgdG8gb3VyIEZyZWUgUGxhbiEiLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQiLAogICAgICAgICAgICB0ZXh0OiAiUGxlYXNlIFRyeSBBZ2FpbiEiLAogICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgU3dhbCh7CiAgICAgICAgdGl0bGU6ICJQbGVhc2Ugc2VsY3QgYWxsIHRoZSByZXF1aXJlZCB2YWx1ZXMgYmVmb3JlIHByb2NlZWRpbmchIiwKICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgIHRvYXN0OiB0cnVlLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwKICAgICAgfSk7CiAgICB9CiAgfSwKICBzdWJtaXRfc3RyaXBlX2NoZWNrb3V0KCkgewogICAgaWYodGhpcy5yZXRhaWxfcGxhbl9jdXJyZW50ICE9PSBudWxsICYmIHRoaXMucmV0YWlsX3BheW1lbnRfdHlwZSAhPT0gbnVsbCl7CiAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc3RyaXBlX3N1YnNjcmlwdGlvbl9wbGFucyk7CiAgICAgIGxldCBjaG9zZW5fcGxhbl9kYXRhID0gdGhpcy5yZXRhaWxfcGF5bWVudF90eXBlPT09Ik1vbnRobHkiID8gdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zLmZpbmQoaXRlbSA9PiBpdGVtLmFtb3VudC8xMDAgPT09IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5tb250aGx5X2NoYXJnZSkgIDogdGhpcy5zdHJpcGVfc3Vic2NyaXB0aW9uX3BsYW5zLmZpbmQoaXRlbSA9PiBpdGVtLmFtb3VudC8xMDAgPT09IHRoaXMucmV0YWlsX3BsYW5fY3VycmVudC5hbm51YWxfY2hhcmdlLmFjdHVhbF9jaGFyZ2UpIAogICAgICB0aGlzLnNwaW5uZXJPbiA9IHRydWU7CiAgICAgIGF4aW9zCiAgICAgICAgLnBvc3QoYXBpX2NhbGxzLnN0cmlwZV9wYXltZW50X2dhdGV3YXkoKSwgewogICAgICAgICAgZ2VuZXJhdGVfbmV3X3JlcXVlc3Q6IHRydWUsCiAgICAgICAgICBjaG9zZW5fcGxhbl9kYXRhOiBjaG9zZW5fcGxhbl9kYXRhLAogICAgICAgICAgY29tcGFueV9pZDogdGhpcy5jb21wYW55aWQsCiAgICAgICAgICBjb21wYW55X25hbWU6IHRoaXMuY29tcGFueW5hbWUsCiAgICAgICAgICByZXF1ZXN0X3R5cGU6ICJQbGFuIiwKICAgICAgICAgIGVtYWlsOiB0aGlzLiRzZXNzaW9uLmdldCgiVXNlckluZm9ybWF0aW9uIikuZW1haWwsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLkRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfWVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlBsZWFzZSBzZWxlY3QgYWxsIGdpdmVuIGZpZWxkIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogIH0sCiAgc3VibWl0X3N0cmlwZV9hZGRvbl9jaGVja291dCgpIHsKICAgIAogICAgdmFyIGNob3Nlbl9wbGFuX2RhdGEgPSB7CiAgICAgICJwbGFuX25hbWUiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl9wbGFuLm5hbWUgLAogICAgICAib3B0aW9uIiA6IHRoaXMuc2VsZWN0ZWRfYWRkb25fcGxhbi50eXBlLAogICAgICAicHJpY2UiIDogdGhpcy5zZWxlY3RlZF9hZGRvbl9wbGFuLlByaWNlCiAgICB9CgogICAgdGhpcy5zcGlubmVyT24gPSB0cnVlOwogICAgICBheGlvcwogICAgICAgIC5wb3N0KGFwaV9jYWxscy5zdHJpcGVfcGF5bWVudF9nYXRld2F5KCksIHsKICAgICAgICAgIGdlbmVyYXRlX25ld19yZXF1ZXN0OiB0cnVlLAogICAgICAgICAgY2hvc2VuX3BsYW5fZGF0YTogY2hvc2VuX3BsYW5fZGF0YSwKICAgICAgICAgIGNvbXBhbnlfaWQ6IHRoaXMuY29tcGFueWlkLAogICAgICAgICAgY29tcGFueV9uYW1lOiB0aGlzLmNvbXBhbnluYW1lLAogICAgICAgICAgcmVxdWVzdF90eXBlOiAiQWRkT24iCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5TdGF0dXMgPT09ICJTdWNjZXNzIikgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSByZXNwb25zZS5kYXRhLkRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTd2FsKHsKICAgICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGUpID0+IHsKICAgICAgICAgIHRoaXMuc3Bpbm5lck9uID0gZmFsc2U7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIFN3YWwoewogICAgICAgICAgICB0aXRsZTogIlNvbWUgRXJyb3IgT2NjdXJyZWQsIFBsZWFzZSBUcnkgQWdhaW4hIiwKICAgICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogIH0KICB9LAp9Owo="},null]}