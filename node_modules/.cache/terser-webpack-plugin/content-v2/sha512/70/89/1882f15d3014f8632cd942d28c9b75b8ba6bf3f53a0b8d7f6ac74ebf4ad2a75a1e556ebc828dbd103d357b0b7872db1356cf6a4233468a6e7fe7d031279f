{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-7fabef72\"],{\"0a1c\":function(e,t,s){},\"2ae4\":function(e,t,s){\"use strict\";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"dash-cont\"},[s(\"div\",{staticClass:\"container-fluid\"},[s(\"div\",{staticClass:\"card dash-card\"},[s(\"div\",{staticClass:\"card-body p-0\"},[s(\"div\",{staticClass:\"d-flex\",staticStyle:{\"border-bottom\":\"1px solid #dbe2e8\"}},[s(\"div\",{staticClass:\"col-md-3\",staticStyle:{\"border-right\":\"1px solid #dbe2e8\"}},[s(\"div\",{staticStyle:{display:\"flex\"}},[s(\"h4\",{staticStyle:{\"margin-top\":\"3%\"}},[e._v(e._s(e.tlt(\"livechat_online_customers\")))])])]),s(\"div\",{staticClass:\"col-md-9\"},[s(\"div\",{staticClass:\"card-act d-flex flex-wrap\",staticStyle:{\"margin-top\":\"1%\"}},[Boolean(e.current_user.username)?s(\"h4\",{staticClass:\"mb-sm-0\"},[e._v(e._s(e.current_user.username))]):(e.current_user.username,s(\"h4\",{staticClass:\"mb-sm-0\"},[e._v(e._s(e.tlt(\"livechat_select_customer\")))])),s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.user_list.length,expression:\"user_list.length\"}],staticClass:\"ml-auto\"},[\"joined\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",staticStyle:{color:\"red\"},attrs:{href:\"#\"},on:{click:e.disconnect_support_chat}},[e._v(e._s(e.tlt(\"livechat_stop_chat\")))]):\"ended\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",staticStyle:{color:\"black\"},attrs:{href:\"#\"}},[e._v(e._s(e.tlt(\"livechat_end_chat\")))]):\"waiting\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",attrs:{href:\"#\"},on:{click:function(t){return e.join_customer(e.current_user)}}},[e._v(e._s(e.tlt(\"livechat_join_chat\")))]):e._e()])])])]),s(\"div\",{staticClass:\"d-flex\"},[s(\"div\",{staticClass:\"col-sm-3 p-0\",staticStyle:{\"border-right\":\"1px solid #dbe2e8\"}},[s(\"ul\",{staticClass:\"navbar-nav flex-column\",staticStyle:{width:\"100%\"}},e._l(e.user_list,(function(t,n){return s(\"div\",{key:n},[t.agent_username==e.agent_username||null==t.agent_username?s(\"li\",{staticClass:\"nav-item\",class:e.check_current_active_user(n),staticStyle:{cursor:\"pointer\"},on:{click:function(s){return e.select_user(t)}}},[s(\"a\",{staticClass:\"d-flex\",attrs:{href:\"#\",role:\"button\"}},[\"\"==t.username?[s(\"p\",{staticStyle:{color:\"black\",margin:\"0\"}},[e._v(e._s(e.tlt(\"livechat_user\")))])]:\"\"!=t.username?[s(\"p\",{staticStyle:{color:\"black\",margin:\"0\"}},[e._v(e._s(t.username))])]:e._e(),0==t.is_connected?s(\"span\",{staticClass:\"ml-auto\",attrs:{href:\"#\"},on:{click:function(s){e.select_user(t),e.join_customer(t)}}},[e._v(\" \"+e._s(e.tlt(\"livechat_join_chat\"))+\" \")]):e._e(),\"ended\"==t.state?s(\"span\",{staticClass:\"ml-auto\",staticStyle:{color:\"black\"}},[e._v(\" \"+e._s(e.tlt(\"livechat_end_chat\"))+\" \")]):e._e()],2)]):e._e()])})),0)]),s(\"div\",{staticClass:\"col-md-9\",attrs:{id:\"chat\"}},[s(\"div\",{staticClass:\"chat-master\"},[s(\"div\",{staticClass:\"chat-body\",staticStyle:{height:\"65vh\",\"overflow-y\":\"auto\"}},e._l(e.chat_list,(function(t,n){return s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.current_channel==e.current_user.channel_name,expression:\"chat.current_channel == current_user.channel_name\"}],key:n,staticClass:\"chat-inner\"},[t.sent?s(\"div\",{staticClass:\"chat-row sender\"},[s(\"div\",{staticClass:\"chat\",domProps:{innerHTML:e._s(t.text)}}),s(\"div\",{staticClass:\"chat-his justify-content-between\",staticStyle:{position:\"unset !important\",\"margin-top\":\"unset !important\"}},[s(\"span\",{staticClass:\"time\",staticStyle:{color:\"#000\"}},[e._v(e._s(t.time))]),s(\"span\",{staticClass:\"del-note delivered\"},[e._v(e._s(e.tlt(\"livechat_delivered\")))])])]):e._e(),t.received?s(\"div\",{staticClass:\"chat-row receiver\"},[s(\"div\",{staticClass:\"chat\",domProps:{innerHTML:e._s(t.text)}}),s(\"div\",{staticClass:\"chat-his justify-content-between\",staticStyle:{position:\"unset !important\",\"margin-top\":\"unset !important\"}},[s(\"span\",{staticClass:\"time\",staticStyle:{color:\"#000\"}},[e._v(e._s(t.time))]),s(\"span\",{staticClass:\"del-note delivered\"},[e._v(e._s(e.tlt(\"livechat_delivered\")))])])]):e._e()])})),0),s(\"div\",{staticClass:\"chat-footer\",staticStyle:{\"margin-bottom\":\"20px\"}},[s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.is_typing_indicator_on,expression:\"is_typing_indicator_on\"}],staticClass:\"typing-indicator\",staticStyle:{\"margin-left\":\"10px\"}},[s(\"p\",{staticStyle:{\"font-size\":\"13px\",\"font-weight\":\"300\"}},[e._v(\" \"+e._s(e.msg_sender)+\" \"+e._s(e.tlt(\"livechat_typing\"))+\" \")]),s(\"span\"),s(\"span\"),s(\"span\")])]),s(\"div\",{staticClass:\"chat-footer\",staticStyle:{\"border-top\":\"solid 1px #dbe2e8\",\"border-radius\":\"0 0 0 0\",overflow:\"hidden\"}},[s(\"div\",{staticClass:\"chat-txt\"},[s(\"div\",{staticClass:\"input-group mb-0\"},[s(\"input\",{directives:[{name:\"model\",rawName:\"v-model\",value:e.to_send,expression:\"to_send\"}],staticClass:\"form-control\",attrs:{type:\"text\",placeholder:e.tlt(\"livechat_type_placeholder\")},domProps:{value:e.to_send},on:{keypress:function(t){return!t.type.indexOf(\"key\")&&e._k(t.keyCode,\"enter\",13,t.key,\"Enter\")?null:e.send_message(t)},input:function(t){t.target.composing||(e.to_send=t.target.value)}}}),s(\"div\",{staticClass:\"input-group-append\"},[s(\"button\",{staticClass:\"btn\",attrs:{type:\"button\"},on:{click:e.send_message}},[s(\"svg\",{staticStyle:{fill:\"#8a8a8a63\"},attrs:{xmlns:\"http://www.w3.org/2000/svg\",width:\"40\",height:\"25\",viewBox:\"0 0 24 24\"}},[s(\"path\",{attrs:{d:\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"}}),s(\"path\",{attrs:{d:\"M0 0h24v24H0z\",fill:\"none\"}})])])])])])])])])])])])])])},a=[],i=(s(\"cb29\"),s(\"4de4\"),s(\"c740\"),s(\"a15b\"),s(\"45fc\"),s(\"b0c0\"),s(\"bc3a\"),s(\"3d20\")),r=s.n(i),c=s(\"9aed\"),o=(s(\"5118\"),s(\"00e2\")),l=s.n(o),_=s(\"61b2\"),u={name:\"LiveChatPage\",data:function(){return{user_list:[],current_user:{},current_channel:\"\",first_name:this.$session.has(\"UserFirstName\")?this.$session.get(\"UserFirstName\"):this.$session.get(\"UserInformation\").first_name,last_name:this.$session.has(\"UserLastName\")?this.$session.get(\"UserLastName\"):this.$session.get(\"UserInformation\").last_name,agent_username:this.$session.get(\"UserInformation\").email,chat_list:[],to_send:\"\",ch:null,message:null,user_channels:{},socket:null,msg_sender:\"\",delay:1e4,is_typing_indicator_on:!1,disable_btn_expired:!1}},watch:{to_send:function(e){this.button_fill()}},mixins:[_[\"f\"],_[\"e\"]],mounted:function(){var e=this;setTimeout((function(){e.freeze_portal()}),1e3),this.$root.$on(\"LiveChatPageDisabled\",(function(t){!0===t&&(e.disable_btn_expired=!0)})),setTimeout((function(){e.disable_btn_expired?r()({type:\"warning\",text:\"You are on free trial please, kindly upgrade your plan to use this feature\",showCancelButton:!0,confirmButtonColor:\"#3085d6\",confirmButtonText:\"Subscribe Now\",cancelButtonText:\"Later\",cancelButtonColor:\"#d33\"}).then((function(t){1==t.value?e.$router.push({name:\"Settings\",params:{Subscription:!0}}):(e.$router.push(\"/bot/dashboard\"),e.$root.$emit(\"change_sidebar_main_menu\",\"Dashboard\"))})):(e.socket=new c[\"Socket\"](Object({NODE_ENV:\"production\",BASE_URL:\"/\"}).VUE_APP_LIVE_CHAT_WEBSOCKET_ENDPOINT,{params:{jwt:e.$session.get(\"at\"),company_name:e.$session.get(\"UserInformation\").company_name,company_id:e.$session.get(\"UserInformation\").company_id,email:e.$session.get(\"UserInformation\").email,first_name:e.$session.get(\"UserInformation\").first_name,last_name:e.$session.get(\"UserInformation\").last_name}}),e.socket.connect(),e.ch=e.socket.channel(\"companies:\"+e.$session.get(\"UserInformation\").company_id),e.ch.join(),e.ch.on(\"new_name\",(function(t){var s=e.user_list.some((function(e){return e.channel_name===t.topic})),n=e.user_list.findIndex((function(e){return e.channel_name===t.topic}));s&&(e.user_list[n].username=t.name)})),e.ch.on(\"customer_needs_support_agent\",(function(t){var s=t;for(var n in s.metas){var a=s.customer_chat_group,i=e.user_list.some((function(e){return e.channel_name===a}));if(i){var r=e.user_list.findIndex((function(e){return e.channel_name===a}));Boolean(s.metas[n].user_info.is_customer)&&1==s.metas.length?(e.user_list[r].is_connected=!1,e.user_list[r].agent_role=null,e.user_list[r].agent_username=null,e.user_list[r].state):(e.user_list[r].is_connected=!0,e.user_list[r].agent_role=s.metas[n].user_info.role,e.user_list[r].agent_username=s.metas[n].user_info.username,e.user_list[r].state)}else e.user_list.push({channel_name:a,username:\"\",is_connected:!1,agent_username:null,agent_role:null,state:\"waiting\"}),e.user_channels[a]=e.socket.channel(a)}})))}),1e3)},beforeDestroy:function(){if(!this.disable_btn_expired){for(var e in this.ch.leave(),this.user_channels)this.user_channels[e].push(\"stopped_chat\",{name:\"Support Agent\",message:\" has ended this conversation.\"}),this.user_channels[e].leave();this.socket.disconnect()}},methods:{join_customer:function(e){var t=this;this.user_channels[e.channel_name].join();var s=this.user_list.findIndex((function(t){return t.channel_name===e.channel_name}));this.user_list[s].agent_username=this.agent_username,this.user_list[s].is_connected=!0,this.user_list[s].state=\"joined\",this.user_channels[e.channel_name].on(\"started_typing\",(function(s){if(e.channel_name==t.current_user.channel_name){if(\"support_agent\"!=s.sender){var n=t.user_list.filter((function(t){return t.channel_name==e.channel_name}));\"\"==n[0].username?t.msg_sender=s.sender:t.msg_sender=n[0].username}t.is_typing_indicator_on=!0}})),this.user_channels[e.channel_name].on(\"stopped_typing\",(function(){t.is_typing_indicator_on=!1})),this.user_channels[e.channel_name].on(\"new_chat_message\",(function(s){\"customer\"==s.sender&&(t.chat_list.push({received:!0,text:s.message,current_channel:e.channel_name,time:t.generate_time()}),t.update_scrollbar(),t.no_response(t))})),this.user_channels[e.channel_name].on(\"stopped_chat\",(function(e){t.chat_list.push({received:!0,text:e.name+e.message,current_channel:e.topic,time:t.generate_time()}),t.update_scrollbar(),r()({text:e.name+e.message,toast:!0,showConfirmButton:!1,position:\"top-end\",type:\"info\",timer:5e3});var s=t.user_list.findIndex((function(t){return t.channel_name===e.topic}));t.user_list[s].agent_username=t.agent_username,t.user_list[s].is_connected=!0,t.user_list[s].state=\"ended\"}))},button_fill:function(){document.querySelector(\"svg\").style.fill=\"#273679\",\"\"==this.to_send?document.querySelector(\"svg\").style.fill=\"#8a8a8a63\":\"\"!=this.to_send&&this.user_channels[this.current_user.channel_name].push(\"started_typing\"),this.stop_typing(this)},stop_typing:l()((function(e){e.user_channels[e.current_user.channel_name].push(\"stopped_typing\")}),5e3),no_response:l()((function(e){e.user_channels[e.current_user.channel_name].push(\"no_response\",{sender:\"sender\"})}),1e4),send_message:function(){\"\"!=this.to_send&&this.user_list.length>0&&(this.chat_list.push({sent:!0,text:this.to_send,time:this.generate_time(),current_channel:this.current_user.channel_name}),this.user_channels[this.current_user.channel_name].push(\"new_chat_message\",{message:this.to_send}),this.to_send=\"\",this.no_response(this),this.update_scrollbar())},disconnect_support_chat:function(){var e=this;this.user_channels[this.current_user.channel_name].push(\"stopped_chat\",{name:\"Support Agent\",message:\" has ended this conversation.\"}),this.user_channels[this.current_user.channel_name].leave();var t=this.user_list.findIndex((function(t){return t.channel_name===e.current_user.channel_name}));this.user_list[t].agent_username=this.agent_username,this.user_list[t].is_connected=!0,this.user_list[t].state=\"ended\"},update_scrollbar:function(){var e=this;setTimeout((function(){e.is_typing_indicator_on=!1}),1500),setTimeout((function(){document.querySelector(\".chat-body\").scrollTop=document.querySelector(\".chat-body\").scrollHeight}),200)},select_user:function(e){this.current_user=e,this.update_scrollbar()},check_current_active_user:function(e){if(!0===Boolean(this.current_user))return this.current_user.channel_name===this.user_list[e].channel_name?\"current-active-user\":null}}},h=u,d=(s(\"a6d6\"),s(\"2877\")),m=Object(d[\"a\"])(h,n,a,!1,null,\"28b4acb2\",null);t[\"default\"]=m.exports},a6d6:function(e,t,s){\"use strict\";var n=s(\"0a1c\"),a=s.n(n);a.a}}]);","extractedComments":[]}