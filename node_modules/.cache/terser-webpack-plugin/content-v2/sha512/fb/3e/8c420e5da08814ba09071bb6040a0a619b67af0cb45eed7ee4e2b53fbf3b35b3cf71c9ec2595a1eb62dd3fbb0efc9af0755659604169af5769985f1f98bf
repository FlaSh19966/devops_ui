{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-7c462396\"],{\"2ae4\":function(e,t,s){\"use strict\";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"dash-cont\"},[s(\"div\",{staticClass:\"container-fluid\"},[s(\"div\",{staticClass:\"card dash-card\"},[s(\"div\",{staticClass:\"card-body p-0\"},[s(\"div\",{staticClass:\"d-flex\",staticStyle:{\"border-bottom\":\"1px solid #dbe2e8\"}},[e._m(0),s(\"div\",{staticClass:\"col-md-9\"},[s(\"div\",{staticClass:\"card-act d-flex flex-wrap\",staticStyle:{\"margin-top\":\"1%\"}},[Boolean(e.current_user.username)?s(\"h4\",{staticClass:\"mb-sm-0\"},[e._v(e._s(e.current_user.username))]):\"\"==e.current_user.username?s(\"h4\",{staticClass:\"mb-sm-0\"},[e._v(e._s(\"Customer\"))]):s(\"h4\",{staticClass:\"mb-sm-0\"},[e._v(e._s(\"Select a Customer\"))]),s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.user_list.length,expression:\"user_list.length\"}],staticClass:\"ml-auto\"},[\"joined\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",staticStyle:{color:\"red\"},attrs:{href:\"#\"},on:{click:e.disconnect_support_chat}},[e._v(\"Stop Chat\")]):\"ended\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",staticStyle:{color:\"black\"},attrs:{href:\"#\"}},[e._v(\"Chat Ended\")]):\"waiting\"==e.current_user.state?s(\"a\",{staticClass:\"ml-auto\",attrs:{href:\"#\"},on:{click:function(t){return e.join_customer(e.user)}}},[e._v(\"Join\")]):e._e()])])])]),s(\"div\",{staticClass:\"d-flex\"},[s(\"div\",{staticClass:\"col-sm-3 p-0\",staticStyle:{\"border-right\":\"1px solid #dbe2e8\"}},[s(\"ul\",{staticClass:\"navbar-nav flex-column\",staticStyle:{width:\"100%\"}},e._l(e.user_list,(function(t,n){return s(\"div\",{key:n},[t.agent_username==e.agent_username||null==t.agent_username?s(\"li\",{staticClass:\"nav-item\",class:e.check_current_active_user(n),staticStyle:{cursor:\"pointer\"},on:{click:function(s){return e.select_user(t)}}},[s(\"a\",{staticClass:\"d-flex\",attrs:{href:\"#\",role:\"button\"}},[\"\"==t.username?[s(\"p\",{staticStyle:{color:\"black\",margin:\"0\"}},[e._v(\"User\")])]:\"\"!=t.username?[s(\"p\",{staticStyle:{color:\"black\",margin:\"0\"}},[e._v(e._s(t.username))])]:e._e(),0==t.is_connected?s(\"span\",{staticClass:\"ml-auto\",attrs:{href:\"#\"},on:{click:function(s){e.select_user(t),e.join_customer(t)}}},[e._v(\" Join \")]):e._e(),\"ended\"==t.state?s(\"span\",{staticClass:\"ml-auto\",staticStyle:{color:\"black\"}},[e._v(\" Chat Ended \")]):e._e()],2)]):e._e()])})),0)]),s(\"div\",{staticClass:\"col-md-9\",attrs:{id:\"chat\"}},[s(\"div\",{staticClass:\"chat-master\"},[s(\"div\",{staticClass:\"chat-body\",staticStyle:{height:\"65vh\",\"overflow-y\":\"auto\"}},e._l(e.chat_list,(function(t,n){return s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.current_channel==e.current_user.channel_name,expression:\"chat.current_channel == current_user.channel_name\"}],key:n,staticClass:\"chat-inner\"},[t.sent?s(\"div\",{staticClass:\"chat-row sender\"},[s(\"div\",{staticClass:\"chat\",domProps:{innerHTML:e._s(t.text)}}),s(\"div\",{staticClass:\"chat-his justify-content-between\"},[s(\"span\",{staticClass:\"time\",staticStyle:{color:\"#000\"}},[e._v(e._s(t.time))]),s(\"span\",{staticClass:\"del-note delivered\"},[e._v(\"Delivered\")])])]):e._e(),t.received?s(\"div\",{staticClass:\"chat-row receiver\"},[s(\"div\",{staticClass:\"chat\",domProps:{innerHTML:e._s(t.text)}}),s(\"div\",{staticClass:\"chat-his justify-content-between\"},[s(\"span\",{staticClass:\"time\",staticStyle:{color:\"#000\"}},[e._v(e._s(t.time))]),s(\"span\",{staticClass:\"del-note delivered\"},[e._v(\"Delivered\")])])]):e._e()])})),0),s(\"div\",{staticClass:\"chat-footer\",staticStyle:{\"margin-bottom\":\"20px\"}},[s(\"div\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.is_typing_indicator_on,expression:\"is_typing_indicator_on\"}],staticClass:\"typing-indicator\",staticStyle:{\"margin-left\":\"10px\"}},[s(\"p\",{staticStyle:{\"font-size\":\"13px\",\"font-weight\":\"300\"}},[e._v(\" \"+e._s(e.msg_sender)+\" is typing \")]),s(\"span\"),s(\"span\"),s(\"span\")])]),s(\"div\",{staticClass:\"chat-footer\",staticStyle:{\"border-top\":\"solid 1px #dbe2e8\",\"border-radius\":\"0 0 0 0\",overflow:\"hidden\"}},[s(\"div\",{staticClass:\"chat-txt\"},[s(\"div\",{staticClass:\"input-group mb-0\"},[s(\"input\",{directives:[{name:\"model\",rawName:\"v-model\",value:e.to_send,expression:\"to_send\"}],staticClass:\"form-control\",attrs:{type:\"text\",placeholder:\"Type your message here ...\"},domProps:{value:e.to_send},on:{keypress:function(t){return!t.type.indexOf(\"key\")&&e._k(t.keyCode,\"enter\",13,t.key,\"Enter\")?null:e.send_message(t)},input:function(t){t.target.composing||(e.to_send=t.target.value)}}}),s(\"div\",{staticClass:\"input-group-append\"},[s(\"button\",{staticClass:\"btn\",attrs:{type:\"button\"},on:{click:e.send_message}},[s(\"svg\",{staticStyle:{fill:\"#8a8a8a63\"},attrs:{xmlns:\"http://www.w3.org/2000/svg\",width:\"40\",height:\"25\",viewBox:\"0 0 24 24\"}},[s(\"path\",{attrs:{d:\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"}}),s(\"path\",{attrs:{d:\"M0 0h24v24H0z\",fill:\"none\"}})])])])])])])])])])])])])])},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"col-md-3\",staticStyle:{\"border-right\":\"1px solid #dbe2e8\"}},[s(\"div\",{staticStyle:{display:\"flex\"}},[s(\"h4\",{staticStyle:{\"margin-top\":\"3%\"}},[e._v(\"Online Customers\")])])])}],r=(s(\"cb29\"),s(\"4de4\"),s(\"c740\"),s(\"a15b\"),s(\"45fc\"),s(\"b0c0\"),s(\"bc3a\"),s(\"3d20\")),i=s.n(r),c=s(\"9aed\"),o=(s(\"5118\"),s(\"00e2\")),l=s.n(o),u=s(\"61b2\"),_={data:function(){return{user_list:[],current_user:{},current_channel:\"\",first_name:this.$session.has(\"UserFirstName\")?this.$session.get(\"UserFirstName\"):this.$session.get(\"UserInformation\").first_name,last_name:this.$session.has(\"UserLastName\")?this.$session.get(\"UserLastName\"):this.$session.get(\"UserInformation\").last_name,agent_username:this.$session.get(\"UserInformation\").email,chat_list:[],to_send:\"\",ch:null,message:null,user_channels:{},socket:null,msg_sender:\"\",delay:1e4,is_typing_indicator_on:!1}},watch:{to_send:function(e){this.button_fill()}},mixins:[u[\"c\"]],mounted:function(){var e=this;this.socket=new c[\"Socket\"](\"wss://staging.cense.ai:8443/live-chat/socket\",{params:{username:this.$session.get(\"UserInformation\").email,token:this.$session.get(\"UserInformation\").tokens,role:this.$session.get(\"UserInformation\").role}}),this.socket.connect(),this.ch=this.socket.channel(\"companies:\"+this.$session.get(\"UserInformation\").company_name),this.ch.join(),this.ch.on(\"new_name\",(function(t){var s=e.user_list.some((function(e){return e.channel_name===t.topic})),n=e.user_list.findIndex((function(e){return e.channel_name===t.topic}));s&&(e.user_list[n].username=t.name)})),this.ch.on(\"customer_group_presence\",(function(t){console.log(\"customer group interval update\",t);var s=t;for(var n in s.metas)if(Boolean(s.metas[n].user_info.is_customer)){var a=\"customers_groups:\"+s.metas[n].user_info.customer_group_name,r=e.user_list.some((function(e){return e.channel_name===a}));if(r){var i=e.user_list.findIndex((function(e){return e.channel_name===a}));s.metas.length>1?(e.user_list[i].is_connected=!0,e.user_list[i].agent_role=s.metas[1].user_info.role,e.user_list[i].agent_username=s.metas[1].user_info.username,e.user_list[i].state):(e.user_list[i].is_connected=!1,e.user_list[i].agent_role=null,e.user_list[i].agent_username=null,e.user_list[i].state)}else e.user_list.push({channel_name:a,username:\"\",is_connected:!1,agent_username:null,agent_role:null,state:\"waiting\"}),e.user_channels[a]=e.socket.channel(a)}})),this.ch.on(\"customer_needs_support_agent\",(function(t){console.log(\"userchannel\"),e.user_channels[t.customer_chat_group]=e.socket.channel(t.customer_chat_group),e.message=e.socket.channel(t.customer_chat_group),e.user_channels[t.customer_chat_group].on(\"started_typing\",(function(s){if(t.customer_chat_group==e.current_user.channel_name){if(\"support_agent\"!=s.sender){var n=e.user_list.filter((function(e){return e.channel_name==t.customer_chat_group}));\"\"==n[0].username?e.msg_sender=s.sender:e.msg_sender=n[0].username}e.is_typing_indicator_on=!0}})),e.user_channels[t.customer_chat_group].on(\"stopped_typing\",(function(){e.is_typing_indicator_on=!1})),e.user_channels[t.customer_chat_group].on(\"new_chat_message\",(function(s){\"customer\"==s.sender&&(e.chat_list.push({received:!0,text:s.message,current_channel:t.customer_chat_group,time:e.generate_time()}),e.update_scrollbar(),e.no_response(e))})),e.user_channels[t.customer_chat_group].on(\"stopped_chat\",(function(s){e.chat_list.push({received:!0,text:s.name+s.message,current_channel:s.topic,time:e.generate_time()}),e.update_scrollbar(),i()({text:t.name+t.message,toast:!0,showConfirmButton:!1,position:\"top-end\",type:\"info\",timer:5e3});var n=e.user_list.findIndex((function(e){return e.channel_name===s.topic}));e.user_list[n].agent_username=e.agent_username,e.user_list[n].is_connected=!0,e.user_list[n].state=\"ended\"}))}))},beforeDestroy:function(){for(var e in this.ch.leave(),this.user_channels)this.user_channels[e].push(\"stopped_chat\",{name:\"Support Agent\",message:\"has ended this conversation.\"}),this.user_channels[e].leave();this.socket.disconnect()},methods:{join_customer:function(e){console.log(e),this.user_channels[e.channel_name].join();var t=this.user_list.findIndex((function(t){return t.channel_name===e.channel_name}));this.user_list[t].agent_username=this.agent_username,this.user_list[t].is_connected=!0,this.user_list[t].state=\"joined\",this.ch.on(\"customer_group_presence\",(function(e){}))},button_fill:function(){document.querySelector(\"svg\").style.fill=\"#273679\",\"\"==this.to_send?document.querySelector(\"svg\").style.fill=\"#8a8a8a63\":\"\"!=this.to_send&&this.user_channels[this.current_user.channel_name].push(\"started_typing\"),this.stop_typing(this)},stop_typing:l()((function(e){e.user_channels[e.current_user.channel_name].push(\"stopped_typing\")}),5e3),no_response:l()((function(e){e.user_channels[e.current_user.channel_name].push(\"no_response\",{sender:\"sender\"})}),1e4),send_message:function(){\"\"!=this.to_send&&this.user_list.length>0&&(this.chat_list.push({sent:!0,text:this.to_send,time:this.generate_time(),current_channel:this.current_user.channel_name}),this.user_channels[this.current_user.channel_name].push(\"new_chat_message\",{message:this.to_send}),this.to_send=\"\",this.no_response(this),this.update_scrollbar())},disconnect_support_chat:function(){var e=this;this.user_channels[this.current_user.channel_name].push(\"stopped_chat\",{name:\"Support Agent\",message:\"has ended this conversation.\"}),this.user_channels[this.current_user.channel_name].leave();var t=this.user_list.findIndex((function(t){return t.channel_name===e.current_user.channel_name}));this.user_list[t].agent_username=this.agent_username,this.user_list[t].is_connected=!0,this.user_list[t].state=\"ended\"},update_scrollbar:function(){var e=this;setTimeout((function(){e.is_typing_indicator_on=!1}),1500),setTimeout((function(){document.querySelector(\".chat-body\").scrollTop=document.querySelector(\".chat-body\").scrollHeight}),200)},select_user:function(e){this.current_user=e,this.update_scrollbar()},check_current_active_user:function(e){if(!0===Boolean(this.current_user))return this.current_user.channel_name===this.user_list[e].channel_name?\"current-active-user\":null}}},h=_,d=(s(\"adb6\"),s(\"2877\")),m=Object(d[\"a\"])(h,n,a,!1,null,\"3d7792fa\",null);t[\"default\"]=m.exports},adb6:function(e,t,s){\"use strict\";var n=s(\"ed24\"),a=s.n(n);a.a},ed24:function(e,t,s){}}]);","extractedComments":[]}